var Sx=Object.create;var Ko=Object.defineProperty;var Rx=Object.getOwnPropertyDescriptor;var Px=Object.getOwnPropertyNames;var Ix=Object.getPrototypeOf,Cx=Object.prototype.hasOwnProperty;var Vx=(n,t,e)=>t in n?Ko(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Lx=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),kx=(n,t)=>{for(var e in t)Ko(n,e,{get:t[e],enumerable:!0})},Dx=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Px(t))!Cx.call(n,i)&&i!==e&&Ko(n,i,{get:()=>t[i],enumerable:!(r=Rx(t,i))||r.enumerable});return n};var Ox=(n,t,e)=>(e=n!=null?Sx(Ix(n)):{},Dx(t||!n||!n.__esModule?Ko(e,"default",{value:n,enumerable:!0}):e,n));var vd=(n,t,e)=>(Vx(n,typeof t!="symbol"?t+"":t,e),e);var gf=Lx((qp,Qp)=>{(function(n,t){typeof qp=="object"&&typeof Qp<"u"?Qp.exports=t():typeof define=="function"&&define.amd?define(t):n.CardboardVRDisplay=t()})(qp,function(){"use strict";var n=function(){function l(u){this.value=u}function c(u){var m,f;function v(T,b){return new Promise(function(y,I){var F={key:T,arg:b,resolve:y,reject:I,next:null};f?f=f.next=F:(m=f=F,_(T,b))})}function _(T,b){try{var y=u[T](b),I=y.value;I instanceof l?Promise.resolve(I.value).then(function(F){_("next",F)},function(F){_("throw",F)}):M(y.done?"return":"normal",y.value)}catch(F){M("throw",F)}}function M(T,b){switch(T){case"return":m.resolve({value:b,done:!0});break;case"throw":m.reject(b);break;default:m.resolve({value:b,done:!1});break}m=m.next,m?_(m.key,m.arg):f=null}this._invoke=v,typeof u.return!="function"&&(this.return=void 0)}return typeof Symbol=="function"&&Symbol.asyncIterator&&(c.prototype[Symbol.asyncIterator]=function(){return this}),c.prototype.next=function(u){return this._invoke("next",u)},c.prototype.throw=function(u){return this._invoke("throw",u)},c.prototype.return=function(u){return this._invoke("return",u)},{wrap:function(u){return function(){return new c(u.apply(this,arguments))}},await:function(u){return new l(u)}}}(),t=function(l,c){if(!(l instanceof c))throw new TypeError("Cannot call a class as a function")},e=function(){function l(c,u){for(var m=0;m<u.length;m++){var f=u[m];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(c,f.key,f)}}return function(c,u,m){return u&&l(c.prototype,u),m&&l(c,m),c}}(),r=function(){function l(c,u){var m=[],f=!0,v=!1,_=void 0;try{for(var M=c[Symbol.iterator](),T;!(f=(T=M.next()).done)&&(m.push(T.value),!(u&&m.length===u));f=!0);}catch(b){v=!0,_=b}finally{try{!f&&M.return&&M.return()}finally{if(v)throw _}}return m}return function(c,u){if(Array.isArray(c))return c;if(Symbol.iterator in Object(c))return l(c,u);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=.001,o=1,s=function(c,u){return"data:"+c+","+encodeURIComponent(u)},a=function(c,u,m){return c+(u-c)*m},p=function(){var l=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return l}}(),d=function(){var l=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return l}}(),h=function(){var l=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return l}}(),x=function(){var l=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return l}}(),A=function(){var l=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),c=l?parseInt(l[1],10):null;return function(){return c}}(),E=function(){var l=!1;return l=p()&&h()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return l}}(),S=function(){var l=!1;if(A()===65){var c=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(c){var u=c[1].split("."),m=r(u,4),f=m[0],v=m[1],_=m[2],M=m[3];l=parseInt(_,10)===3325&&parseInt(M,10)<148}}return function(){return l}}(),P=function(){var l=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return l}}(),R=function(){var c=window.orientation==90||window.orientation==-90;return P()?!c:c},V=function(c){return!(isNaN(c)||c<=i||c>o)},B=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},L=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},k=function(c){if(d())return!1;if(c.requestFullscreen)c.requestFullscreen();else if(c.webkitRequestFullscreen)c.webkitRequestFullscreen();else if(c.mozRequestFullScreen)c.mozRequestFullScreen();else if(c.msRequestFullscreen)c.msRequestFullscreen();else return!1;return!0},H=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},C=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},D=function(c,u,m,f){var v=c.createShader(c.VERTEX_SHADER);c.shaderSource(v,u),c.compileShader(v);var _=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(_,m),c.compileShader(_);var M=c.createProgram();c.attachShader(M,v),c.attachShader(M,_);for(var T in f)c.bindAttribLocation(M,f[T],T);return c.linkProgram(M),c.deleteShader(v),c.deleteShader(_),M},$=function(c,u){for(var m={},f=c.getProgramParameter(u,c.ACTIVE_UNIFORMS),v="",_=0;_<f;_++){var M=c.getActiveUniform(u,_);v=M.name.replace("[0]",""),m[v]=c.getUniformLocation(u,v)}return m},W=function(c,u,m,f,v,_,M){var T=1/(u-m),b=1/(f-v),y=1/(_-M);return c[0]=-2*T,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*b,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*y,c[11]=0,c[12]=(u+m)*T,c[13]=(v+f)*b,c[14]=(M+_)*y,c[15]=1,c},z=function(){var c=!1;return function(u){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(u)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(u.substr(0,4)))&&(c=!0)}(navigator.userAgent||navigator.vendor||window.opera),c},K=function(c,u){for(var m in u)u.hasOwnProperty(m)&&(c[m]=u[m]);return c},be=function(c){if(p()){var u=c.style.width,m=c.style.height;c.style.width=parseInt(u)+1+"px",c.style.height=parseInt(m)+"px",setTimeout(function(){c.style.width=u,c.style.height=m},100)}window.canvas=c},ge=function(){var l=Math.PI/180,c=Math.PI*.25;function u(b,y,I,F){var N=Math.tan(y?y.upDegrees*l:c),X=Math.tan(y?y.downDegrees*l:c),Y=Math.tan(y?y.leftDegrees*l:c),G=Math.tan(y?y.rightDegrees*l:c),U=2/(Y+G),ce=2/(N+X);return b[0]=U,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=ce,b[6]=0,b[7]=0,b[8]=-((Y-G)*U*.5),b[9]=(N-X)*ce*.5,b[10]=F/(I-F),b[11]=-1,b[12]=0,b[13]=0,b[14]=F*I/(I-F),b[15]=0,b}function m(b,y,I){var F=y[0],N=y[1],X=y[2],Y=y[3],G=F+F,U=N+N,ce=X+X,ye=F*G,Ie=F*U,Ae=F*ce,je=N*U,tt=N*ce,nt=X*ce,rt=Y*G,it=Y*U,un=Y*ce;return b[0]=1-(je+nt),b[1]=Ie+un,b[2]=Ae-it,b[3]=0,b[4]=Ie-un,b[5]=1-(ye+nt),b[6]=tt+rt,b[7]=0,b[8]=Ae+it,b[9]=tt-rt,b[10]=1-(ye+je),b[11]=0,b[12]=I[0],b[13]=I[1],b[14]=I[2],b[15]=1,b}function f(b,y,I){var F=I[0],N=I[1],X=I[2],Y,G,U,ce,ye,Ie,Ae,je,tt,nt,rt,it;return y===b?(b[12]=y[0]*F+y[4]*N+y[8]*X+y[12],b[13]=y[1]*F+y[5]*N+y[9]*X+y[13],b[14]=y[2]*F+y[6]*N+y[10]*X+y[14],b[15]=y[3]*F+y[7]*N+y[11]*X+y[15]):(Y=y[0],G=y[1],U=y[2],ce=y[3],ye=y[4],Ie=y[5],Ae=y[6],je=y[7],tt=y[8],nt=y[9],rt=y[10],it=y[11],b[0]=Y,b[1]=G,b[2]=U,b[3]=ce,b[4]=ye,b[5]=Ie,b[6]=Ae,b[7]=je,b[8]=tt,b[9]=nt,b[10]=rt,b[11]=it,b[12]=Y*F+ye*N+tt*X+y[12],b[13]=G*F+Ie*N+nt*X+y[13],b[14]=U*F+Ae*N+rt*X+y[14],b[15]=ce*F+je*N+it*X+y[15]),b}function v(b,y){var I=y[0],F=y[1],N=y[2],X=y[3],Y=y[4],G=y[5],U=y[6],ce=y[7],ye=y[8],Ie=y[9],Ae=y[10],je=y[11],tt=y[12],nt=y[13],rt=y[14],it=y[15],un=I*G-F*Y,Ri=I*U-N*Y,Pi=I*ce-X*Y,Ii=F*U-N*G,Ci=F*ce-X*G,Vi=N*ce-X*U,Li=ye*nt-Ie*tt,ki=ye*rt-Ae*tt,Di=ye*it-je*tt,Oi=Ie*rt-Ae*nt,Bi=Ie*it-je*nt,Fi=Ae*it-je*rt,Se=un*Fi-Ri*Bi+Pi*Oi+Ii*Di-Ci*ki+Vi*Li;return Se?(Se=1/Se,b[0]=(G*Fi-U*Bi+ce*Oi)*Se,b[1]=(N*Bi-F*Fi-X*Oi)*Se,b[2]=(nt*Vi-rt*Ci+it*Ii)*Se,b[3]=(Ae*Ci-Ie*Vi-je*Ii)*Se,b[4]=(U*Di-Y*Fi-ce*ki)*Se,b[5]=(I*Fi-N*Di+X*ki)*Se,b[6]=(rt*Pi-tt*Vi-it*Ri)*Se,b[7]=(ye*Vi-Ae*Pi+je*Ri)*Se,b[8]=(Y*Bi-G*Di+ce*Li)*Se,b[9]=(F*Di-I*Bi-X*Li)*Se,b[10]=(tt*Ci-nt*Pi+it*un)*Se,b[11]=(Ie*Pi-ye*Ci-je*un)*Se,b[12]=(G*ki-Y*Oi-U*Li)*Se,b[13]=(I*Oi-F*ki+N*Li)*Se,b[14]=(nt*Ri-tt*Ii-rt*un)*Se,b[15]=(ye*Ii-Ie*Ri+Ae*un)*Se,b):null}var _=new Float32Array([0,0,0,1]),M=new Float32Array([0,0,0]);function T(b,y,I,F,N,X){u(b,F||null,X.depthNear,X.depthFar);var Y=I.orientation||_,G=I.position||M;m(y,Y,G),N&&f(y,y,N),v(y,y)}return function(b,y,I){return!b||!y?!1:(b.pose=y,b.timestamp=y.timestamp,T(b.leftProjectionMatrix,b.leftViewMatrix,y,I._getFieldOfView("left"),I._getEyeOffset("left"),I),T(b.rightProjectionMatrix,b.rightViewMatrix,y,I._getFieldOfView("right"),I._getEyeOffset("right"),I),!0)}}(),ne=function(){var c=window.self!==window.top,u=Qe(document.referrer),m=Qe(window.location.href);return c&&u!==m},Qe=function(c){var u,m=c.indexOf("://");m!==-1?u=m+3:u=0;var f=c.indexOf("/",u);return f===-1&&(f=c.length),c.substring(0,f)},Dr=function(c){if(c.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var u=2*Math.acos(c.w);return u},dn=function(){var l={};return function(c,u){l[c]===void 0&&(console.warn("webvr-polyfill: "+u),l[c]=!0)}}(),Gt=function(c,u){var m=u?"Please use "+u+" instead.":"";dn(c,c+" has been deprecated. This may not work on native WebVR displays. "+m)};function Kf(l,c,u){if(!c){u(l);return}for(var m=[],f=null,v=0;v<c.length;++v){var _=c[v];switch(_){case l.TEXTURE_BINDING_2D:case l.TEXTURE_BINDING_CUBE_MAP:var M=c[++v];if(M<l.TEXTURE0||M>l.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),m.push(null,null);break}f||(f=l.getParameter(l.ACTIVE_TEXTURE)),l.activeTexture(M),m.push(l.getParameter(_),null);break;case l.ACTIVE_TEXTURE:f=l.getParameter(l.ACTIVE_TEXTURE),m.push(null);break;default:m.push(l.getParameter(_));break}}u(l);for(var v=0;v<c.length;++v){var _=c[v],T=m[v];switch(_){case l.ACTIVE_TEXTURE:break;case l.ARRAY_BUFFER_BINDING:l.bindBuffer(l.ARRAY_BUFFER,T);break;case l.COLOR_CLEAR_VALUE:l.clearColor(T[0],T[1],T[2],T[3]);break;case l.COLOR_WRITEMASK:l.colorMask(T[0],T[1],T[2],T[3]);break;case l.CURRENT_PROGRAM:l.useProgram(T);break;case l.ELEMENT_ARRAY_BUFFER_BINDING:l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,T);break;case l.FRAMEBUFFER_BINDING:l.bindFramebuffer(l.FRAMEBUFFER,T);break;case l.RENDERBUFFER_BINDING:l.bindRenderbuffer(l.RENDERBUFFER,T);break;case l.TEXTURE_BINDING_2D:var M=c[++v];if(M<l.TEXTURE0||M>l.TEXTURE31)break;l.activeTexture(M),l.bindTexture(l.TEXTURE_2D,T);break;case l.TEXTURE_BINDING_CUBE_MAP:var M=c[++v];if(M<l.TEXTURE0||M>l.TEXTURE31)break;l.activeTexture(M),l.bindTexture(l.TEXTURE_CUBE_MAP,T);break;case l.VIEWPORT:l.viewport(T[0],T[1],T[2],T[3]);break;case l.BLEND:case l.CULL_FACE:case l.DEPTH_TEST:case l.SCISSOR_TEST:case l.STENCIL_TEST:T?l.enable(_):l.disable(_);break;default:console.log("No GL restore behavior for 0x"+_.toString(16));break}f&&l.activeTexture(f)}}var Ti=Kf,Yf=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),Jf=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function gt(l,c,u,m){this.gl=l,this.cardboardUI=c,this.bufferScale=u,this.dirtySubmitFrameBindings=m,this.ctxAttribs=l.getContextAttributes(),this.instanceExt=l.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=l.drawingBufferWidth,this.bufferHeight=l.drawingBufferHeight,this.realBindFramebuffer=l.bindFramebuffer,this.realEnable=l.enable,this.realDisable=l.disable,this.realColorMask=l.colorMask,this.realClearColor=l.clearColor,this.realViewport=l.viewport,p()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(l.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(l.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=D(l,Yf,Jf,this.attribs),this.uniforms=$(l,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=l.createBuffer(),this.indexBuffer=l.createBuffer(),this.indexCount=0,this.renderTarget=l.createTexture(),this.framebuffer=l.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=l.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=l.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=l.createRenderbuffer()),this.patch(),this.onResize()}gt.prototype.destroy=function(){var l=this.gl;this.unpatch(),l.deleteProgram(this.program),l.deleteBuffer(this.vertexBuffer),l.deleteBuffer(this.indexBuffer),l.deleteTexture(this.renderTarget),l.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&l.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&l.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&l.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},gt.prototype.onResize=function(){var l=this.gl,c=this,u=[l.RENDERBUFFER_BINDING,l.TEXTURE_BINDING_2D,l.TEXTURE0];Ti(l,u,function(m){c.realBindFramebuffer.call(m,m.FRAMEBUFFER,null),c.scissorTest&&c.realDisable.call(m,m.SCISSOR_TEST),c.realColorMask.call(m,!0,!0,!0,!0),c.realViewport.call(m,0,0,m.drawingBufferWidth,m.drawingBufferHeight),c.realClearColor.call(m,0,0,0,1),m.clear(m.COLOR_BUFFER_BIT),c.realBindFramebuffer.call(m,m.FRAMEBUFFER,c.framebuffer),m.bindTexture(m.TEXTURE_2D,c.renderTarget),m.texImage2D(m.TEXTURE_2D,0,c.ctxAttribs.alpha?m.RGBA:m.RGB,c.bufferWidth,c.bufferHeight,0,c.ctxAttribs.alpha?m.RGBA:m.RGB,m.UNSIGNED_BYTE,null),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,c.renderTarget,0),c.ctxAttribs.depth&&c.ctxAttribs.stencil?(m.bindRenderbuffer(m.RENDERBUFFER,c.depthStencilBuffer),m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_STENCIL,c.bufferWidth,c.bufferHeight),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,c.depthStencilBuffer)):c.ctxAttribs.depth?(m.bindRenderbuffer(m.RENDERBUFFER,c.depthBuffer),m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_COMPONENT16,c.bufferWidth,c.bufferHeight),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,c.depthBuffer)):c.ctxAttribs.stencil&&(m.bindRenderbuffer(m.RENDERBUFFER,c.stencilBuffer),m.renderbufferStorage(m.RENDERBUFFER,m.STENCIL_INDEX8,c.bufferWidth,c.bufferHeight),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.STENCIL_ATTACHMENT,m.RENDERBUFFER,c.stencilBuffer)),!m.checkFramebufferStatus(m.FRAMEBUFFER)===m.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),c.realBindFramebuffer.call(m,m.FRAMEBUFFER,c.lastBoundFramebuffer),c.scissorTest&&c.realEnable.call(m,m.SCISSOR_TEST),c.realColorMask.apply(m,c.colorMask),c.realViewport.apply(m,c.viewport),c.realClearColor.apply(m,c.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},gt.prototype.patch=function(){if(!this.isPatched){var l=this,c=this.gl.canvas,u=this.gl;p()||(c.width=B()*this.bufferScale,c.height=L()*this.bufferScale,Object.defineProperty(c,"width",{configurable:!0,enumerable:!0,get:function(){return l.bufferWidth},set:function(f){l.bufferWidth=f,l.realCanvasWidth.set.call(c,f),l.onResize()}}),Object.defineProperty(c,"height",{configurable:!0,enumerable:!0,get:function(){return l.bufferHeight},set:function(f){l.bufferHeight=f,l.realCanvasHeight.set.call(c,f),l.onResize()}})),this.lastBoundFramebuffer=u.getParameter(u.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(u.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(m,f){l.lastBoundFramebuffer=f||l.framebuffer,l.realBindFramebuffer.call(u,m,l.lastBoundFramebuffer)},this.cullFace=u.getParameter(u.CULL_FACE),this.depthTest=u.getParameter(u.DEPTH_TEST),this.blend=u.getParameter(u.BLEND),this.scissorTest=u.getParameter(u.SCISSOR_TEST),this.stencilTest=u.getParameter(u.STENCIL_TEST),u.enable=function(m){switch(m){case u.CULL_FACE:l.cullFace=!0;break;case u.DEPTH_TEST:l.depthTest=!0;break;case u.BLEND:l.blend=!0;break;case u.SCISSOR_TEST:l.scissorTest=!0;break;case u.STENCIL_TEST:l.stencilTest=!0;break}l.realEnable.call(u,m)},u.disable=function(m){switch(m){case u.CULL_FACE:l.cullFace=!1;break;case u.DEPTH_TEST:l.depthTest=!1;break;case u.BLEND:l.blend=!1;break;case u.SCISSOR_TEST:l.scissorTest=!1;break;case u.STENCIL_TEST:l.stencilTest=!1;break}l.realDisable.call(u,m)},this.colorMask=u.getParameter(u.COLOR_WRITEMASK),u.colorMask=function(m,f,v,_){l.colorMask[0]=m,l.colorMask[1]=f,l.colorMask[2]=v,l.colorMask[3]=_,l.realColorMask.call(u,m,f,v,_)},this.clearColor=u.getParameter(u.COLOR_CLEAR_VALUE),u.clearColor=function(m,f,v,_){l.clearColor[0]=m,l.clearColor[1]=f,l.clearColor[2]=v,l.clearColor[3]=_,l.realClearColor.call(u,m,f,v,_)},this.viewport=u.getParameter(u.VIEWPORT),u.viewport=function(m,f,v,_){l.viewport[0]=m,l.viewport[1]=f,l.viewport[2]=v,l.viewport[3]=_,l.realViewport.call(u,m,f,v,_)},this.isPatched=!0,be(c)}},gt.prototype.unpatch=function(){if(!!this.isPatched){var l=this.gl,c=this.gl.canvas;p()||(Object.defineProperty(c,"width",this.realCanvasWidth),Object.defineProperty(c,"height",this.realCanvasHeight)),c.width=this.bufferWidth,c.height=this.bufferHeight,l.bindFramebuffer=this.realBindFramebuffer,l.enable=this.realEnable,l.disable=this.realDisable,l.colorMask=this.realColorMask,l.clearColor=this.realClearColor,l.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&l.bindFramebuffer(l.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){be(c)},1)}},gt.prototype.setTextureBounds=function(l,c){l||(l=[0,0,.5,1]),c||(c=[.5,0,.5,1]),this.viewportOffsetScale[0]=l[0],this.viewportOffsetScale[1]=l[1],this.viewportOffsetScale[2]=l[2],this.viewportOffsetScale[3]=l[3],this.viewportOffsetScale[4]=c[0],this.viewportOffsetScale[5]=c[1],this.viewportOffsetScale[6]=c[2],this.viewportOffsetScale[7]=c[3]},gt.prototype.submitFrame=function(){var l=this.gl,c=this,u=[];if(this.dirtySubmitFrameBindings||u.push(l.CURRENT_PROGRAM,l.ARRAY_BUFFER_BINDING,l.ELEMENT_ARRAY_BUFFER_BINDING,l.TEXTURE_BINDING_2D,l.TEXTURE0),Ti(l,u,function(f){c.realBindFramebuffer.call(f,f.FRAMEBUFFER,null);var v=0,_=0;c.instanceExt&&(v=f.getVertexAttrib(c.attribs.position,c.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),_=f.getVertexAttrib(c.attribs.texCoord,c.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),c.cullFace&&c.realDisable.call(f,f.CULL_FACE),c.depthTest&&c.realDisable.call(f,f.DEPTH_TEST),c.blend&&c.realDisable.call(f,f.BLEND),c.scissorTest&&c.realDisable.call(f,f.SCISSOR_TEST),c.stencilTest&&c.realDisable.call(f,f.STENCIL_TEST),c.realColorMask.call(f,!0,!0,!0,!0),c.realViewport.call(f,0,0,f.drawingBufferWidth,f.drawingBufferHeight),(c.ctxAttribs.alpha||p())&&(c.realClearColor.call(f,0,0,0,1),f.clear(f.COLOR_BUFFER_BIT)),f.useProgram(c.program),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c.indexBuffer),f.bindBuffer(f.ARRAY_BUFFER,c.vertexBuffer),f.enableVertexAttribArray(c.attribs.position),f.enableVertexAttribArray(c.attribs.texCoord),f.vertexAttribPointer(c.attribs.position,2,f.FLOAT,!1,20,0),f.vertexAttribPointer(c.attribs.texCoord,3,f.FLOAT,!1,20,8),c.instanceExt&&(v!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.position,0),_!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.texCoord,0)),f.activeTexture(f.TEXTURE0),f.uniform1i(c.uniforms.diffuse,0),f.bindTexture(f.TEXTURE_2D,c.renderTarget),f.uniform4fv(c.uniforms.viewportOffsetScale,c.viewportOffsetScale),f.drawElements(f.TRIANGLES,c.indexCount,f.UNSIGNED_SHORT,0),c.cardboardUI&&c.cardboardUI.renderNoState(),c.realBindFramebuffer.call(c.gl,f.FRAMEBUFFER,c.framebuffer),c.ctxAttribs.preserveDrawingBuffer||(c.realClearColor.call(f,0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c.dirtySubmitFrameBindings||c.realBindFramebuffer.call(f,f.FRAMEBUFFER,c.lastBoundFramebuffer),c.cullFace&&c.realEnable.call(f,f.CULL_FACE),c.depthTest&&c.realEnable.call(f,f.DEPTH_TEST),c.blend&&c.realEnable.call(f,f.BLEND),c.scissorTest&&c.realEnable.call(f,f.SCISSOR_TEST),c.stencilTest&&c.realEnable.call(f,f.STENCIL_TEST),c.realColorMask.apply(f,c.colorMask),c.realViewport.apply(f,c.viewport),(c.ctxAttribs.alpha||!c.ctxAttribs.preserveDrawingBuffer)&&c.realClearColor.apply(f,c.clearColor),c.instanceExt&&(v!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.position,v),_!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.texCoord,_))}),p()){var m=l.canvas;(m.width!=c.bufferWidth||m.height!=c.bufferHeight)&&(c.bufferWidth=m.width,c.bufferHeight=m.height,c.onResize())}},gt.prototype.updateDeviceInfo=function(l){var c=this.gl,u=this,m=[c.ARRAY_BUFFER_BINDING,c.ELEMENT_ARRAY_BUFFER_BINDING];Ti(c,m,function(f){var v=u.computeMeshVertices_(u.meshWidth,u.meshHeight,l);if(f.bindBuffer(f.ARRAY_BUFFER,u.vertexBuffer),f.bufferData(f.ARRAY_BUFFER,v,f.STATIC_DRAW),!u.indexCount){var _=u.computeMeshIndices_(u.meshWidth,u.meshHeight);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,u.indexBuffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,_,f.STATIC_DRAW),u.indexCount=_.length}})},gt.prototype.computeMeshVertices_=function(l,c,u){for(var m=new Float32Array(2*l*c*5),f=u.getLeftEyeVisibleTanAngles(),v=u.getLeftEyeNoLensTanAngles(),_=u.getLeftEyeVisibleScreenRect(v),M=0,T=0;T<2;T++){for(var b=0;b<c;b++)for(var y=0;y<l;y++,M++){var I=y/(l-1),F=b/(c-1),N=I,X=F,Y=a(f[0],f[2],I),G=a(f[3],f[1],F),U=Math.sqrt(Y*Y+G*G),ce=u.distortion.distortInverse(U),ye=Y*ce/U,Ie=G*ce/U;I=(ye-v[0])/(v[2]-v[0]),F=(Ie-v[3])/(v[1]-v[3]),I=(_.x+I*_.width-.5)*2,F=(_.y+F*_.height-.5)*2,m[M*5+0]=I,m[M*5+1]=F,m[M*5+2]=N,m[M*5+3]=X,m[M*5+4]=T}var Ae=f[2]-f[0];f[0]=-(Ae+f[0]),f[2]=Ae-f[2],Ae=v[2]-v[0],v[0]=-(Ae+v[0]),v[2]=Ae-v[2],_.x=1-(_.x+_.width)}return m},gt.prototype.computeMeshIndices_=function(l,c){for(var u=new Uint16Array(2*(l-1)*(c-1)*6),m=l/2,f=c/2,v=0,_=0,M=0;M<2;M++)for(var T=0;T<c;T++)for(var b=0;b<l;b++,v++)b==0||T==0||(b<=m==T<=f?(u[_++]=v,u[_++]=v-l-1,u[_++]=v-l,u[_++]=v-l-1,u[_++]=v,u[_++]=v-1):(u[_++]=v-1,u[_++]=v-l,u[_++]=v,u[_++]=v-l,u[_++]=v-1,u[_++]=v-l-1));return u},gt.prototype.getOwnPropertyDescriptor_=function(l,c){var u=Object.getOwnPropertyDescriptor(l,c);return(u.get===void 0||u.set===void 0)&&(u.configurable=!0,u.enumerable=!0,u.get=function(){return this.getAttribute(c)},u.set=function(m){this.setAttribute(c,m)}),u};var $f=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),Zf=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),pd=Math.PI/180,Rl=60,dd=12,ud=20,Pl=1,md=.75,hd=.3125,ex=4,jn=28,Il=1.5;function zn(l){this.gl=l,this.attribs={position:0},this.program=D(l,$f,Zf,this.attribs),this.uniforms=$(l,this.program),this.vertexBuffer=l.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}zn.prototype.destroy=function(){var l=this.gl;this.listener&&l.canvas.removeEventListener("click",this.listener,!1),l.deleteProgram(this.program),l.deleteBuffer(this.vertexBuffer)},zn.prototype.listen=function(l,c){var u=this.gl.canvas;this.listener=function(m){var f=u.clientWidth/2,v=jn*Il;m.clientX>f-v&&m.clientX<f+v&&m.clientY>u.clientHeight-v?l(m):m.clientX<v&&m.clientY<v&&c(m)},u.addEventListener("click",this.listener,!1)},zn.prototype.onResize=function(){var l=this.gl,c=this,u=[l.ARRAY_BUFFER_BINDING];Ti(l,u,function(m){var f=[],v=m.drawingBufferWidth/2,_=Math.max(screen.width,screen.height)*window.devicePixelRatio,M=m.drawingBufferWidth/_,T=M*window.devicePixelRatio,b=ex*T/2,y=jn*Il*T,I=jn*T/2,F=(jn*Il-jn)*T;f.push(v-b,y),f.push(v-b,m.drawingBufferHeight),f.push(v+b,y),f.push(v+b,m.drawingBufferHeight),c.gearOffset=f.length/2;function N(ce,ye){var Ie=(90-ce)*pd,Ae=Math.cos(Ie),je=Math.sin(Ie);f.push(hd*Ae*I+v,hd*je*I+I),f.push(ye*Ae*I+v,ye*je*I+I)}for(var X=0;X<=6;X++){var Y=X*Rl;N(Y,Pl),N(Y+dd,Pl),N(Y+ud,md),N(Y+(Rl-ud),md),N(Y+(Rl-dd),Pl)}c.gearVertexCount=f.length/2-c.gearOffset,c.arrowOffset=f.length/2;function G(ce,ye){f.push(F+ce,m.drawingBufferHeight-F-ye)}var U=b/Math.sin(45*pd);G(0,I),G(I,0),G(I+U,U),G(U,I+U),G(U,I-U),G(0,I),G(I,I*2),G(I+U,I*2-U),G(U,I-U),G(0,I),G(U,I-b),G(jn*T,I-b),G(U,I+b),G(jn*T,I+b),c.arrowVertexCount=f.length/2-c.arrowOffset,m.bindBuffer(m.ARRAY_BUFFER,c.vertexBuffer),m.bufferData(m.ARRAY_BUFFER,new Float32Array(f),m.STATIC_DRAW)})},zn.prototype.render=function(){var l=this.gl,c=this,u=[l.CULL_FACE,l.DEPTH_TEST,l.BLEND,l.SCISSOR_TEST,l.STENCIL_TEST,l.COLOR_WRITEMASK,l.VIEWPORT,l.CURRENT_PROGRAM,l.ARRAY_BUFFER_BINDING];Ti(l,u,function(m){m.disable(m.CULL_FACE),m.disable(m.DEPTH_TEST),m.disable(m.BLEND),m.disable(m.SCISSOR_TEST),m.disable(m.STENCIL_TEST),m.colorMask(!0,!0,!0,!0),m.viewport(0,0,m.drawingBufferWidth,m.drawingBufferHeight),c.renderNoState()})},zn.prototype.renderNoState=function(){var l=this.gl;l.useProgram(this.program),l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.enableVertexAttribArray(this.attribs.position),l.vertexAttribPointer(this.attribs.position,2,l.FLOAT,!1,8,0),l.uniform4f(this.uniforms.color,1,1,1,1),W(this.projMat,0,l.drawingBufferWidth,0,l.drawingBufferHeight,.1,1024),l.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),l.drawArrays(l.TRIANGLE_STRIP,0,4),l.drawArrays(l.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),l.drawArrays(l.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function qo(l){this.coefficients=l}qo.prototype.distortInverse=function(l){for(var c=0,u=1,m=l-this.distort(c);Math.abs(u-c)>1e-4;){var f=l-this.distort(u),v=u-f*((u-c)/(f-m));c=u,u=v,m=f}return u},qo.prototype.distort=function(l){for(var c=l*l,u=0,m=0;m<this.coefficients.length;m++)u=c*(u+this.coefficients[m]);return(u+1)*l};var Rt=Math.PI/180,Pt=180/Math.PI,ve=function(c,u,m){this.x=c||0,this.y=u||0,this.z=m||0};ve.prototype={constructor:ve,set:function(c,u,m){return this.x=c,this.y=u,this.z=m,this},copy:function(c){return this.x=c.x,this.y=c.y,this.z=c.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var c=this.length();if(c!==0){var u=1/c;this.multiplyScalar(u)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(c){this.x*=c,this.y*=c,this.z*=c},applyQuaternion:function(c){var u=this.x,m=this.y,f=this.z,v=c.x,_=c.y,M=c.z,T=c.w,b=T*u+_*f-M*m,y=T*m+M*u-v*f,I=T*f+v*m-_*u,F=-v*u-_*m-M*f;return this.x=b*T+F*-v+y*-M-I*-_,this.y=y*T+F*-_+I*-v-b*-M,this.z=I*T+F*-M+b*-_-y*-v,this},dot:function(c){return this.x*c.x+this.y*c.y+this.z*c.z},crossVectors:function(c,u){var m=c.x,f=c.y,v=c.z,_=u.x,M=u.y,T=u.z;return this.x=f*T-v*M,this.y=v*_-m*T,this.z=m*M-f*_,this}};var re=function(c,u,m,f){this.x=c||0,this.y=u||0,this.z=m||0,this.w=f!==void 0?f:1};re.prototype={constructor:re,set:function(c,u,m,f){return this.x=c,this.y=u,this.z=m,this.w=f,this},copy:function(c){return this.x=c.x,this.y=c.y,this.z=c.z,this.w=c.w,this},setFromEulerXYZ:function(c,u,m){var f=Math.cos(c/2),v=Math.cos(u/2),_=Math.cos(m/2),M=Math.sin(c/2),T=Math.sin(u/2),b=Math.sin(m/2);return this.x=M*v*_+f*T*b,this.y=f*T*_-M*v*b,this.z=f*v*b+M*T*_,this.w=f*v*_-M*T*b,this},setFromEulerYXZ:function(c,u,m){var f=Math.cos(c/2),v=Math.cos(u/2),_=Math.cos(m/2),M=Math.sin(c/2),T=Math.sin(u/2),b=Math.sin(m/2);return this.x=M*v*_+f*T*b,this.y=f*T*_-M*v*b,this.z=f*v*b-M*T*_,this.w=f*v*_+M*T*b,this},setFromAxisAngle:function(c,u){var m=u/2,f=Math.sin(m);return this.x=c.x*f,this.y=c.y*f,this.z=c.z*f,this.w=Math.cos(m),this},multiply:function(c){return this.multiplyQuaternions(this,c)},multiplyQuaternions:function(c,u){var m=c.x,f=c.y,v=c.z,_=c.w,M=u.x,T=u.y,b=u.z,y=u.w;return this.x=m*y+_*M+f*b-v*T,this.y=f*y+_*T+v*M-m*b,this.z=v*y+_*b+m*T-f*M,this.w=_*y-m*M-f*T-v*b,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var c=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return c===0?(this.x=0,this.y=0,this.z=0,this.w=1):(c=1/c,this.x=this.x*c,this.y=this.y*c,this.z=this.z*c,this.w=this.w*c),this},slerp:function(c,u){if(u===0)return this;if(u===1)return this.copy(c);var m=this.x,f=this.y,v=this.z,_=this.w,M=_*c.w+m*c.x+f*c.y+v*c.z;if(M<0?(this.w=-c.w,this.x=-c.x,this.y=-c.y,this.z=-c.z,M=-M):this.copy(c),M>=1)return this.w=_,this.x=m,this.y=f,this.z=v,this;var T=Math.acos(M),b=Math.sqrt(1-M*M);if(Math.abs(b)<.001)return this.w=.5*(_+this.w),this.x=.5*(m+this.x),this.y=.5*(f+this.y),this.z=.5*(v+this.z),this;var y=Math.sin((1-u)*T)/b,I=Math.sin(u*T)/b;return this.w=_*y+this.w*I,this.x=m*y+this.x*I,this.y=f*y+this.y*I,this.z=v*y+this.z*I,this},setFromUnitVectors:function(){var l,c,u=1e-6;return function(m,f){return l===void 0&&(l=new ve),c=m.dot(f)+1,c<u?(c=0,Math.abs(m.x)>Math.abs(m.z)?l.set(-m.y,m.x,0):l.set(0,-m.z,m.y)):l.crossVectors(m,f),this.x=l.x,this.y=l.y,this.z=l.z,this.w=c,this.normalize(),this}}()};function Cl(l){this.width=l.width||B(),this.height=l.height||L(),this.widthMeters=l.widthMeters,this.heightMeters=l.heightMeters,this.bevelMeters=l.bevelMeters}var tx=new Cl({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),nx=new Cl({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),Vl={CardboardV1:new Ll({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new Ll({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function Te(l,c){this.viewer=Vl.CardboardV2,this.updateDeviceParams(l),this.distortion=new qo(this.viewer.distortionCoefficients);for(var u=0;u<c.length;u++){var m=c[u];Vl[m.id]=new Ll(m)}}Te.prototype.updateDeviceParams=function(l){this.device=this.determineDevice_(l)||this.device},Te.prototype.getDevice=function(){return this.device},Te.prototype.setViewer=function(l){this.viewer=l,this.distortion=new qo(this.viewer.distortionCoefficients)},Te.prototype.determineDevice_=function(l){if(!l)return p()?(console.warn("Using fallback iOS device measurements."),nx):(console.warn("Using fallback Android device measurements."),tx);var c=.0254,u=c/l.xdpi,m=c/l.ydpi,f=B(),v=L();return new Cl({widthMeters:u*f,heightMeters:m*v,bevelMeters:l.bevelMm*.001})},Te.prototype.getDistortedFieldOfViewLeftEye=function(){var l=this.viewer,c=this.device,u=this.distortion,m=l.screenLensDistance,f=(c.widthMeters-l.interLensDistance)/2,v=l.interLensDistance/2,_=l.baselineLensDistance-c.bevelMeters,M=c.heightMeters-_,T=Pt*Math.atan(u.distort(f/m)),b=Pt*Math.atan(u.distort(v/m)),y=Pt*Math.atan(u.distort(_/m)),I=Pt*Math.atan(u.distort(M/m));return{leftDegrees:Math.min(T,l.fov),rightDegrees:Math.min(b,l.fov),downDegrees:Math.min(y,l.fov),upDegrees:Math.min(I,l.fov)}},Te.prototype.getLeftEyeVisibleTanAngles=function(){var l=this.viewer,c=this.device,u=this.distortion,m=Math.tan(-Rt*l.fov),f=Math.tan(Rt*l.fov),v=Math.tan(Rt*l.fov),_=Math.tan(-Rt*l.fov),M=c.widthMeters/4,T=c.heightMeters/2,b=l.baselineLensDistance-c.bevelMeters-T,y=l.interLensDistance/2-M,I=-b,F=l.screenLensDistance,N=u.distort((y-M)/F),X=u.distort((I+T)/F),Y=u.distort((y+M)/F),G=u.distort((I-T)/F),U=new Float32Array(4);return U[0]=Math.max(m,N),U[1]=Math.min(f,X),U[2]=Math.min(v,Y),U[3]=Math.max(_,G),U},Te.prototype.getLeftEyeNoLensTanAngles=function(){var l=this.viewer,c=this.device,u=this.distortion,m=new Float32Array(4),f=u.distortInverse(Math.tan(-Rt*l.fov)),v=u.distortInverse(Math.tan(Rt*l.fov)),_=u.distortInverse(Math.tan(Rt*l.fov)),M=u.distortInverse(Math.tan(-Rt*l.fov)),T=c.widthMeters/4,b=c.heightMeters/2,y=l.baselineLensDistance-c.bevelMeters-b,I=l.interLensDistance/2-T,F=-y,N=l.screenLensDistance,X=(I-T)/N,Y=(F+b)/N,G=(I+T)/N,U=(F-b)/N;return m[0]=Math.max(f,X),m[1]=Math.min(v,Y),m[2]=Math.min(_,G),m[3]=Math.max(M,U),m},Te.prototype.getLeftEyeVisibleScreenRect=function(l){var c=this.viewer,u=this.device,m=c.screenLensDistance,f=(u.widthMeters-c.interLensDistance)/2,v=c.baselineLensDistance-u.bevelMeters,_=(l[0]*m+f)/u.widthMeters,M=(l[1]*m+v)/u.heightMeters,T=(l[2]*m+f)/u.widthMeters,b=(l[3]*m+v)/u.heightMeters;return{x:_,y:b,width:T-_,height:M-b}},Te.prototype.getFieldOfViewLeftEye=function(l){return l?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},Te.prototype.getFieldOfViewRightEye=function(l){var c=this.getFieldOfViewLeftEye(l);return{leftDegrees:c.rightDegrees,rightDegrees:c.leftDegrees,upDegrees:c.upDegrees,downDegrees:c.downDegrees}},Te.prototype.getUndistortedFieldOfViewLeftEye=function(){var l=this.getUndistortedParams_();return{leftDegrees:Pt*Math.atan(l.outerDist),rightDegrees:Pt*Math.atan(l.innerDist),downDegrees:Pt*Math.atan(l.bottomDist),upDegrees:Pt*Math.atan(l.topDist)}},Te.prototype.getUndistortedViewportLeftEye=function(){var l=this.getUndistortedParams_(),c=this.viewer,u=this.device,m=c.screenLensDistance,f=u.widthMeters/m,v=u.heightMeters/m,_=u.width/f,M=u.height/v,T=Math.round((l.eyePosX-l.outerDist)*_),b=Math.round((l.eyePosY-l.bottomDist)*M);return{x:T,y:b,width:Math.round((l.eyePosX+l.innerDist)*_)-T,height:Math.round((l.eyePosY+l.topDist)*M)-b}},Te.prototype.getUndistortedParams_=function(){var l=this.viewer,c=this.device,u=this.distortion,m=l.screenLensDistance,f=l.interLensDistance/2/m,v=c.widthMeters/m,_=c.heightMeters/m,M=v/2-f,T=(l.baselineLensDistance-c.bevelMeters)/m,b=l.fov,y=u.distortInverse(Math.tan(Rt*b)),I=Math.min(M,y),F=Math.min(f,y),N=Math.min(T,y),X=Math.min(_-T,y);return{outerDist:I,innerDist:F,topDist:X,bottomDist:N,eyePosX:M,eyePosY:T}};function Ll(l){this.id=l.id,this.label=l.label,this.fov=l.fov,this.interLensDistance=l.interLensDistance,this.baselineLensDistance=l.baselineLensDistance,this.screenLensDistance=l.screenLensDistance,this.distortionCoefficients=l.distortionCoefficients,this.inverseCoefficients=l.inverseCoefficients}Te.Viewers=Vl;var rx=1,ix="2019-11-09T17:36:14Z",ox=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],sx={format:rx,last_updated:ix,devices:ox};function Mi(l,c){if(this.dpdb=sx,this.recalculateDeviceParams_(),l){this.onDeviceParamsUpdated=c;var u=new XMLHttpRequest,m=this;u.open("GET",l,!0),u.addEventListener("load",function(){m.loading=!1,u.status>=200&&u.status<=299?(m.dpdb=JSON.parse(u.response),m.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),u.send()}}Mi.prototype.getDeviceParams=function(){return this.deviceParams},Mi.prototype.recalculateDeviceParams_=function(){var l=this.calcDeviceParams_();l?(this.deviceParams=l,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},Mi.prototype.calcDeviceParams_=function(){var l=this.dpdb;if(!l)return console.error("DPDB not available."),null;if(l.format!=1)return console.error("DPDB has unexpected format version."),null;if(!l.devices||!l.devices.length)return console.error("DPDB does not have a devices section."),null;var c=navigator.userAgent||navigator.vendor||window.opera,u=B(),m=L();if(!l.devices)return console.error("DPDB has no devices section."),null;for(var f=0;f<l.devices.length;f++){var v=l.devices[f];if(!v.rules){console.warn("Device["+f+"] has no rules section.");continue}if(v.type!="ios"&&v.type!="android"){console.warn("Device["+f+"] has invalid type.");continue}if(p()==(v.type=="ios")){for(var _=!1,M=0;M<v.rules.length;M++){var T=v.rules[M];if(this.ruleMatches_(T,c,u,m)){_=!0;break}}if(!!_){var b=v.dpi[0]||v.dpi,y=v.dpi[1]||v.dpi;return new ax({xdpi:b,ydpi:y,bevelMm:v.bw})}}}return console.warn("No DPDB device match."),null},Mi.prototype.ruleMatches_=function(l,c,u,m){if(!l.ua&&!l.res||(l.ua&&l.ua.substring(0,2)==="SM"&&(l.ua=l.ua.substring(0,7)),l.ua&&c.indexOf(l.ua)<0))return!1;if(l.res){if(!l.res[0]||!l.res[1])return!1;var f=l.res[0],v=l.res[1];if(Math.min(u,m)!=Math.min(f,v)||Math.max(u,m)!=Math.max(f,v))return!1}return!0};function ax(l){this.xdpi=l.xdpi,this.ydpi=l.ydpi,this.bevelMm=l.bevelMm}function Si(l,c){this.set(l,c)}Si.prototype.set=function(l,c){this.sample=l,this.timestampS=c},Si.prototype.copy=function(l){this.set(l.sample,l.timestampS)};function Un(l,c){this.kFilter=l,this.isDebug=c,this.currentAccelMeasurement=new Si,this.currentGyroMeasurement=new Si,this.previousGyroMeasurement=new Si,p()?this.filterQ=new re(-1,0,0,1):this.filterQ=new re(1,0,0,1),this.previousFilterQ=new re,this.previousFilterQ.copy(this.filterQ),this.accelQ=new re,this.isOrientationInitialized=!1,this.estimatedGravity=new ve,this.measuredGravity=new ve,this.gyroIntegralQ=new re}Un.prototype.addAccelMeasurement=function(l,c){this.currentAccelMeasurement.set(l,c)},Un.prototype.addGyroMeasurement=function(l,c){this.currentGyroMeasurement.set(l,c);var u=c-this.previousGyroMeasurement.timestampS;V(u)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},Un.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var l=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,c=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,l);this.gyroIntegralQ.multiply(c),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(c);var u=new re;u.copy(this.filterQ),u.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(u),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var m=new re;m.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),m.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",Pt*Dr(m),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var f=new re;f.copy(this.filterQ),f.multiply(m),this.filterQ.slerp(f,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},Un.prototype.getOrientation=function(){return this.filterQ},Un.prototype.accelToQuaternion_=function(l){var c=new ve;c.copy(l),c.normalize();var u=new re;return u.setFromUnitVectors(new ve(0,0,-1),c),u.inverse(),u},Un.prototype.gyroToQuaternionDelta_=function(l,c){var u=new re,m=new ve;return m.copy(l),m.normalize(),u.setFromAxisAngle(m,l.length()*c),u};function fd(l,c){this.predictionTimeS=l,this.isDebug=c,this.previousQ=new re,this.previousTimestampS=null,this.deltaQ=new re,this.outQ=new re}fd.prototype.getPrediction=function(l,c,u){if(!this.previousTimestampS)return this.previousQ.copy(l),this.previousTimestampS=u,l;var m=new ve;m.copy(c),m.normalize();var f=c.length();if(f<Rt*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(Pt*f).toFixed(1)),this.outQ.copy(l),this.previousQ.copy(l),this.outQ;var v=f*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(m,v),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(l),this.previousTimestampS=u,this.outQ};function ct(l,c,u,m){this.yawOnly=u,this.accelerometer=new ve,this.gyroscope=new ve,this.filter=new Un(l,m),this.posePredictor=new fd(c,m),this.isFirefoxAndroid=x(),this.isIOS=p();var f=A();this.isDeviceMotionInRadians=!this.isIOS&&f&&f<66,this.isWithoutDeviceMotion=S()||E(),this.filterToWorldQ=new re,p()?this.filterToWorldQ.setFromAxisAngle(new ve(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new ve(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new re,this.worldToScreenQ=new re,this.originalPoseAdjustQ=new re,this.originalPoseAdjustQ.setFromAxisAngle(new ve(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),R()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new re,this.orientationOut_=new Float32Array(4),this.start()}ct.prototype.getPosition=function(){return null},ct.prototype.getOrientation=function(){var l=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var f=new re().setFromAxisAngle(new ve(0,0,-1),0),v=new re;return window.orientation===-90?v.setFromAxisAngle(new ve(0,1,0),Math.PI/-2):v.setFromAxisAngle(new ve(0,1,0),Math.PI/2),f.multiply(v)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var f=new re;return f.setFromAxisAngle(new ve(1,0,0),-Math.PI/2),f}(),l=this._deviceOrientationQ;var u=new re;return u.copy(l),u.multiply(this.deviceOrientationFilterToWorldQ),u.multiply(this.resetQ),u.multiply(this.worldToScreenQ),u.multiplyQuaternions(this.deviceOrientationFixQ,u),this.yawOnly&&(u.x=0,u.z=0,u.normalize()),this.orientationOut_[0]=u.x,this.orientationOut_[1]=u.y,this.orientationOut_[2]=u.z,this.orientationOut_[3]=u.w,this.orientationOut_}else{var c=this.filter.getOrientation();l=this.posePredictor.getPrediction(c,this.gyroscope,this.previousTimestampS)}var u=new re;return u.copy(this.filterToWorldQ),u.multiply(this.resetQ),u.multiply(l),u.multiply(this.worldToScreenQ),this.yawOnly&&(u.x=0,u.z=0,u.normalize()),this.orientationOut_[0]=u.x,this.orientationOut_[1]=u.y,this.orientationOut_[2]=u.z,this.orientationOut_[3]=u.w,this.orientationOut_},ct.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),R()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},ct.prototype.onDeviceOrientation_=function(l){this._deviceOrientationQ=this._deviceOrientationQ||new re;var c=l.alpha,u=l.beta,m=l.gamma;c=(c||0)*Math.PI/180,u=(u||0)*Math.PI/180,m=(m||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(u,c,-m)},ct.prototype.onDeviceMotion_=function(l){this.updateDeviceMotion_(l)},ct.prototype.updateDeviceMotion_=function(l){var c=l.accelerationIncludingGravity,u=l.rotationRate,m=l.timeStamp/1e3,f=m-this.previousTimestampS;if(f<0){dn("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=m;return}else if(f<=i||f>o){dn("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=m;return}this.accelerometer.set(-c.x,-c.y,-c.z),u&&(P()?this.gyroscope.set(-u.beta,u.alpha,u.gamma):this.gyroscope.set(u.alpha,u.beta,u.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,m)),this.filter.addAccelMeasurement(this.accelerometer,m),this.previousTimestampS=m},ct.prototype.onOrientationChange_=function(l){this.setScreenTransform_()},ct.prototype.onMessage_=function(l){var c=l.data;if(!(!c||!c.type)){var u=c.type.toLowerCase();u==="devicemotion"&&this.updateDeviceMotion_(c.deviceMotionEvent)}},ct.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new ve(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new ve(0,0,1),Math.PI/2);break;case 180:break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},ct.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),p()&&ne()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},ct.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var lx=60,cx=new ve(1,0,0),px=new ve(0,0,1),kl=new re;kl.setFromAxisAngle(cx,-Math.PI/2),kl.multiply(new re().setFromAxisAngle(px,Math.PI/2));var dx=function(){function l(c){t(this,l),this.config=c,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new re,this._outQ=new re,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return e(l,[{key:"init",value:function(){var u=null;try{u=new RelativeOrientationSensor({frequency:lx,referenceFrame:"screen"}),u.addEventListener("error",this._onSensorError)}catch(m){this.errors.push(m),m.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):m.name==="ReferenceError"?this.useDeviceMotion():console.error(m)}u&&(this.api="sensor",this.sensor=u,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new ct(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var u=this.sensor.quaternion;this._sensorQ.set(u[0],u[1],u[2],u[3]);var m=this._outQ;return m.copy(kl),m.multiply(this._sensorQ),this.config.YAW_ONLY&&(m.x=m.z=0,m.normalize()),this._out[0]=m.x,this._out[1]=m.y,this._out[2]=m.z,this._out[3]=m.w,this._out}},{key:"_onSensorError",value:function(u){this.errors.push(u.error),u.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):u.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(u.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),l}(),ux="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function Gn(){this.loadIcon_();var l=document.createElement("div"),_=l.style;_.position="fixed",_.top=0,_.right=0,_.bottom=0,_.left=0,_.backgroundColor="gray",_.fontFamily="sans-serif",_.zIndex=1e6;var c=document.createElement("img");c.src=this.icon;var _=c.style;_.marginLeft="25%",_.marginTop="25%",_.width="50%",l.appendChild(c);var u=document.createElement("div"),_=u.style;_.textAlign="center",_.fontSize="16px",_.lineHeight="24px",_.margin="24px 25%",_.width="50%",u.innerHTML="Place your phone into your Cardboard viewer.",l.appendChild(u);var m=document.createElement("div"),_=m.style;_.backgroundColor="#CFD8DC",_.position="fixed",_.bottom=0,_.width="100%",_.height="48px",_.padding="14px 24px",_.boxSizing="border-box",_.color="#656A6B",l.appendChild(m);var f=document.createElement("div");f.style.float="left",f.innerHTML="No Cardboard viewer?";var v=document.createElement("a");v.href="https://www.google.com/get/cardboard/get-cardboard/",v.innerHTML="get one",v.target="_blank";var _=v.style;_.float="right",_.fontWeight=600,_.textTransform="uppercase",_.borderLeft="1px solid gray",_.paddingLeft="24px",_.textDecoration="none",_.color="#656A6B",m.appendChild(f),m.appendChild(v),this.overlay=l,this.text=u,this.hide()}Gn.prototype.show=function(l){!l&&!this.overlay.parentElement?document.body.appendChild(this.overlay):l&&(this.overlay.parentElement&&this.overlay.parentElement!=l&&this.overlay.parentElement.removeChild(this.overlay),l.appendChild(this.overlay)),this.overlay.style.display="block";var c=this.overlay.querySelector("img"),u=c.style;R()?(u.width="20%",u.marginLeft="40%",u.marginTop="3%"):(u.width="50%",u.marginLeft="25%",u.marginTop="25%")},Gn.prototype.hide=function(){this.overlay.style.display="none"},Gn.prototype.showTemporarily=function(l,c){this.show(c),this.timer=setTimeout(this.hide.bind(this),l)},Gn.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},Gn.prototype.update=function(){this.disableShowTemporarily(),!R()&&z()?this.show():this.hide()},Gn.prototype.loadIcon_=function(){this.icon=s("image/svg+xml",ux)};var mx="CardboardV1",xd="WEBVR_CARDBOARD_VIEWER",hx="webvr-polyfill-viewer-selector";function pt(l){try{this.selectedKey=localStorage.getItem(xd)}catch(c){console.error("Failed to load viewer profile: %s",c)}this.selectedKey||(this.selectedKey=l||mx),this.dialog=this.createDialog_(Te.Viewers),this.root=null,this.onChangeCallbacks_=[]}pt.prototype.show=function(l){this.root=l,l.appendChild(this.dialog);var c=this.dialog.querySelector("#"+this.selectedKey);c.checked=!0,this.dialog.style.display="block"},pt.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},pt.prototype.getCurrentViewer=function(){return Te.Viewers[this.selectedKey]},pt.prototype.getSelectedKey_=function(){var l=this.dialog.querySelector("input[name=field]:checked");return l?l.id:null},pt.prototype.onChange=function(l){this.onChangeCallbacks_.push(l)},pt.prototype.fireOnChange_=function(l){for(var c=0;c<this.onChangeCallbacks_.length;c++)this.onChangeCallbacks_[c](l)},pt.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!Te.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(Te.Viewers[this.selectedKey]);try{localStorage.setItem(xd,this.selectedKey)}catch(l){console.error("Failed to save viewer profile: %s",l)}this.hide()},pt.prototype.createDialog_=function(l){var c=document.createElement("div");c.classList.add(hx),c.style.display="none";var u=document.createElement("div"),v=u.style;v.position="fixed",v.left=0,v.top=0,v.width="100%",v.height="100%",v.background="rgba(0, 0, 0, 0.3)",u.addEventListener("click",this.hide.bind(this));var m=280,f=document.createElement("div"),v=f.style;v.boxSizing="border-box",v.position="fixed",v.top="24px",v.left="50%",v.marginLeft=-m/2+"px",v.width=m+"px",v.padding="24px",v.overflow="hidden",v.background="#fafafa",v.fontFamily="'Roboto', sans-serif",v.boxShadow="0px 5px 20px #666",f.appendChild(this.createH1_("Select your viewer"));for(var _ in l)f.appendChild(this.createChoice_(_,l[_].label));return f.appendChild(this.createButton_("Save",this.onSave_.bind(this))),c.appendChild(u),c.appendChild(f),c},pt.prototype.createH1_=function(l){var c=document.createElement("h1"),u=c.style;return u.color="black",u.fontSize="20px",u.fontWeight="bold",u.marginTop=0,u.marginBottom="24px",c.innerHTML=l,c},pt.prototype.createChoice_=function(l,c){var u=document.createElement("div");u.style.marginTop="8px",u.style.color="black";var m=document.createElement("input");m.style.fontSize="30px",m.setAttribute("id",l),m.setAttribute("type","radio"),m.setAttribute("value",l),m.setAttribute("name","field");var f=document.createElement("label");return f.style.marginLeft="4px",f.setAttribute("for",l),f.innerHTML=c,u.appendChild(m),u.appendChild(f),u},pt.prototype.createButton_=function(l,c){var u=document.createElement("button");u.innerHTML=l;var m=u.style;return m.float="right",m.textTransform="uppercase",m.color="#1094f7",m.fontSize="14px",m.letterSpacing=0,m.border=0,m.background="none",m.marginTop="16px",u.addEventListener("click",c),u};var fx=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xx(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}function gx(l,c){return c={exports:{}},l(c,c.exports),c.exports}var vx=gx(function(l,c){(function(m,f){l.exports=f()})(fx,function(){return function(u){var m={};function f(v){if(m[v])return m[v].exports;var _=m[v]={i:v,l:!1,exports:{}};return u[v].call(_.exports,_,_.exports,f),_.l=!0,_.exports}return f.m=u,f.c=m,f.d=function(v,_,M){f.o(v,_)||Object.defineProperty(v,_,{configurable:!1,enumerable:!0,get:M})},f.n=function(v){var _=v&&v.__esModule?function(){return v.default}:function(){return v};return f.d(_,"a",_),_},f.o=function(v,_){return Object.prototype.hasOwnProperty.call(v,_)},f.p="",f(f.s=0)}([function(u,m,f){"use strict";var v=function(){function y(I,F){for(var N=0;N<F.length;N++){var X=F[N];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(I,X.key,X)}}return function(I,F,N){return F&&y(I.prototype,F),N&&y(I,N),I}}();function _(y,I){if(!(y instanceof I))throw new TypeError("Cannot call a class as a function")}var M=f(1),T=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,b=function(){function y(){_(this,y),T?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",M),this.noSleepVideo.addEventListener("timeupdate",function(I){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return v(y,[{key:"enable",value:function(){T?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){T?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),y}();u.exports=b},function(u,m,f){"use strict";u.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),Ax=xx(vx),_x=1e3,bx=[0,0,.5,1],Ex=[.5,0,.5,1],yx=window.requestAnimationFrame,wx=window.cancelAnimationFrame;function Tx(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function gd(l){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:l.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:l.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:l.canPresent},maxLayers:{writable:!1,enumerable:!0,value:l.maxLayers},hasOrientation:{enumerable:!0,get:function(){return Gt("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),l.hasOrientation}}})}function ue(l){l=l||{};var c="wakelock"in l?l.wakelock:!0;this.isPolyfilled=!0,this.displayId=_x++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return Gt("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new gd({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,c&&z()&&(this.wakelock_=new Ax)}ue.prototype.getFrameData=function(l){return ge(l,this._getPose(),this)},ue.prototype.getPose=function(){return Gt("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},ue.prototype.resetPose=function(){return Gt("VRDisplay.prototype.resetPose"),this._resetPose()},ue.prototype.getImmediatePose=function(){return Gt("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},ue.prototype.requestAnimationFrame=function(l){return yx(l)},ue.prototype.cancelAnimationFrame=function(l){return wx(l)},ue.prototype.wrapForFullscreen=function(l){if(p())return l;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var c=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",c.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==l)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=l,this.originalParent_=l.parentElement,this.originalParent_||document.body.appendChild(l),!this.fullscreenWrapper_.parentElement){var u=this.fullscreenElement_.parentElement;u.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),u.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var m=this;function f(){if(!!m.fullscreenElement_){var v=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];m.fullscreenElement_.setAttribute("style",v.join("; ")+";")}}return f(),this.fullscreenWrapper_},ue.prototype.removeFullscreenWrapper=function(){if(!!this.fullscreenElement_){var l=this.fullscreenElement_;this.fullscreenElementCachedStyle_?l.setAttribute("style",this.fullscreenElementCachedStyle_):l.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var c=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(l),this.originalParent_===c?c.insertBefore(l,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(l),c.removeChild(this.fullscreenWrapper_),l}},ue.prototype.requestPresent=function(l){var c=this.isPresenting,u=this;return l instanceof Array||(Gt("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),l=[l]),new Promise(function(m,f){if(!u.capabilities.canPresent){f(new Error("VRDisplay is not capable of presenting."));return}if(l.length==0||l.length>u.capabilities.maxLayers){f(new Error("Invalid number of layers."));return}var v=l[0];if(!v.source){m();return}var _=v.leftBounds||bx,M=v.rightBounds||Ex;if(c){var T=u.layer_;T.source!==v.source&&(T.source=v.source);for(var b=0;b<4;b++)T.leftBounds[b]=_[b],T.rightBounds[b]=M[b];u.wrapForFullscreen(u.layer_.source),u.updatePresent_(),m();return}if(u.layer_={predistorted:v.predistorted,source:v.source,leftBounds:_.slice(0),rightBounds:M.slice(0)},u.waitingForPresent_=!1,u.layer_&&u.layer_.source){var y=u.wrapForFullscreen(u.layer_.source),I=function(){var X=C();u.isPresenting=y===X,u.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(Y){console.error("screen.orientation.lock() failed due to",Y.message)}),u.waitingForPresent_=!1,u.beginPresent_(),m()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),u.removeFullscreenWrapper(),u.disableWakeLock(),u.endPresent_(),u.removeFullscreenListeners_()),u.fireVRDisplayPresentChange_()},F=function(){!u.waitingForPresent_||(u.removeFullscreenWrapper(),u.removeFullscreenListeners_(),u.disableWakeLock(),u.waitingForPresent_=!1,u.isPresenting=!1,f(new Error("Unable to present.")))};u.addFullscreenListeners_(y,I,F),k(y)?(u.enableWakeLock(),u.waitingForPresent_=!0):(p()||d())&&(u.enableWakeLock(),u.isPresenting=!0,u.beginPresent_(),u.fireVRDisplayPresentChange_(),m())}!u.waitingForPresent_&&!p()&&(H(),f(new Error("Unable to present.")))})},ue.prototype.exitPresent=function(){var l=this.isPresenting,c=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(u,m){l?(!H()&&p()&&(c.endPresent_(),c.fireVRDisplayPresentChange_()),d()&&(c.removeFullscreenWrapper(),c.removeFullscreenListeners_(),c.endPresent_(),c.fireVRDisplayPresentChange_()),u()):m(new Error("Was not presenting to VRDisplay."))})},ue.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},ue.prototype.fireVRDisplayPresentChange_=function(){var l=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(l)},ue.prototype.fireVRDisplayConnect_=function(){var l=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(l)},ue.prototype.addFullscreenListeners_=function(l,c,u){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=l,this.fullscreenChangeHandler_=c,this.fullscreenErrorHandler_=u,c&&(document.fullscreenEnabled?l.addEventListener("fullscreenchange",c,!1):document.webkitFullscreenEnabled?l.addEventListener("webkitfullscreenchange",c,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",c,!1):document.msFullscreenEnabled&&l.addEventListener("msfullscreenchange",c,!1)),u&&(document.fullscreenEnabled?l.addEventListener("fullscreenerror",u,!1):document.webkitFullscreenEnabled?l.addEventListener("webkitfullscreenerror",u,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",u,!1):document.msFullscreenEnabled&&l.addEventListener("msfullscreenerror",u,!1))},ue.prototype.removeFullscreenListeners_=function(){if(!!this.fullscreenEventTarget_){var l=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var c=this.fullscreenChangeHandler_;l.removeEventListener("fullscreenchange",c,!1),l.removeEventListener("webkitfullscreenchange",c,!1),document.removeEventListener("mozfullscreenchange",c,!1),l.removeEventListener("msfullscreenchange",c,!1)}if(this.fullscreenErrorHandler_){var u=this.fullscreenErrorHandler_;l.removeEventListener("fullscreenerror",u,!1),l.removeEventListener("webkitfullscreenerror",u,!1),document.removeEventListener("mozfullscreenerror",u,!1),l.removeEventListener("msfullscreenerror",u,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},ue.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},ue.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},ue.prototype.beginPresent_=function(){},ue.prototype.endPresent_=function(){},ue.prototype.submitFrame=function(l){},ue.prototype.getEyeParameters=function(l){return null};var Mx={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},Qo={LEFT:"left",RIGHT:"right"};function Me(l){var c=K({},Mx);l=K(c,l||{}),ue.call(this,{wakelock:l.MOBILE_WAKE_LOCK}),this.config=l,this.displayName="Cardboard VRDisplay",this.capabilities=new gd({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new dx(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new Mi(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new Te(this.dpdb_.getDeviceParams(),l.ADDITIONAL_VIEWERS),this.viewerSelector_=new pt(l.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Gn),p()&&window.addEventListener("resize",this.onResize_.bind(this))}return Me.prototype=Object.create(ue.prototype),Me.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},Me.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},Me.prototype._getFieldOfView=function(l){var c;if(l==Qo.LEFT)c=this.deviceInfo_.getFieldOfViewLeftEye();else if(l==Qo.RIGHT)c=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",l),null;return c},Me.prototype._getEyeOffset=function(l){var c;if(l==Qo.LEFT)c=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(l==Qo.RIGHT)c=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",l),null;return c},Me.prototype.getEyeParameters=function(l){var c=this._getEyeOffset(l),u=this._getFieldOfView(l),m={offset:c,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(m,"fieldOfView",{enumerable:!0,get:function(){return Gt("VRFieldOfView","VRFrameData's projection matrices"),u}}),m},Me.prototype.onDeviceParamsUpdated_=function(l){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(l),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},Me.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},Me.prototype.beginPresent_=function(){var l=this.layer_.source.getContext("webgl");l||(l=this.layer_.source.getContext("experimental-webgl")),l||(l=this.layer_.source.getContext("webgl2")),l&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(l.canvas.width=B()*this.bufferScale_,l.canvas.height=L()*this.bufferScale_,this.cardboardUI_=new zn(l)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new zn(l)),this.distorter_=new gt(l,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(c){this.viewerSelector_.show(this.layer_.source.parentElement),c.stopPropagation(),c.preventDefault()}.bind(this),function(c){this.exitPresent(),c.stopPropagation(),c.preventDefault()}.bind(this)),this.rotateInstructions_&&(R()&&z()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},Me.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},Me.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},Me.prototype.submitFrame=function(l){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var c=this.layer_.source.getContext("webgl");c||(c=this.layer_.source.getContext("experimental-webgl")),c||(c=this.layer_.source.getContext("webgl2"));var u=c.canvas;(u.width!=this.lastWidth||u.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=u.width,this.lastHeight=u.height,this.cardboardUI_.render()}},Me.prototype.onOrientationChange_=function(l){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},Me.prototype.onResize_=function(l){if(this.layer_){var c=this.layer_.source.getContext("webgl");c||(c=this.layer_.source.getContext("experimental-webgl")),c||(c=this.layer_.source.getContext("webgl2"));var u=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];c.canvas.setAttribute("style",u.join("; ")+";"),be(c.canvas)}},Me.prototype.onViewerChanged_=function(l){this.deviceInfo_.setViewer(l),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},Me.prototype.fireVRDisplayDeviceParamsChange_=function(){var l=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(l)},Me.VRFrameData=Tx,Me.VRDisplay=ue,Me})});function Bx(n){return n}function Ad(n,t,e){let r=0,i=n.length,o=Math.floor((r+i)/2),s=!1;for(;r<i&&o<n.length;){let a=n[o],p=O(a)?null:e(a);g(p)&&t<p?i=o:(t===p&&(s=!0),r=o+1),o=Math.floor((r+i)/2)}return s||(o+=.5),o}function Dl(n,t,e){e=e||Bx;let r=e(t);return Ad(n,r,e)}function Hi(n,t){return n.splice(t,1)[0]}function pe(n){return n.splice(0)}function Yo(n,t){for(let e=0;e<n.length;++e)if(n[e]!==t[e])return e;return-1}function Jo(n,t,e){n.splice(e,0,t)}function Ke(n,t){let e=n.indexOf(t);return e>-1?(Hi(n,e),!0):!1}function _d(n,...t){n.splice(0,n.length,...t)}function $e(n,...t){for(let e of t)for(let r of n)if(e(r))return r;return null}function Ni(n,t,e,r){let i;return se(e)?i=e:De(e)&&(r=e),O(r)&&(r=!0),Fx(n,t,i,r)}function Fx(n,t,e,r){let i=Dl(n,t,e),o=i%1===0;return i=i|0,(!o||r)&&Jo(n,t,i),i}function bd(n,t){let e=Array.from(n);return Wn(e,t),e}function Wn(n,t){n.sort((e,r)=>{let i=t(e),o=t(r);return i<o?-1:i>o?1:0})}var Xi=class{constructor(t){this.value=t;this._forward=new Array;this._reverse=new Array}connectSorted(t,e){g(e)?(Ni(this._forward,t,r=>e(r.value)),t._reverse.push(this)):this.connectTo(t)}connectTo(t){this.connectAt(t,this._forward.length)}connectAt(t,e){Jo(this._forward,t,e),t._reverse.push(this)}disconnectFrom(t){Ke(this._forward,t),Ke(t._reverse,this)}isConnectedTo(t){return this._forward.indexOf(t)>=0||this._reverse.indexOf(t)>=0}flatten(){let t=new Set,e=[this];for(;e.length>0;){let r=e.shift();g(r)&&!t.has(r)&&(t.add(r),e.push(...r._forward))}return Array.from(t)}get _isEntryPoint(){return this._reverse.length===0}get _isExitPoint(){return this._forward.length===0}get isDisconnected(){return this._isEntryPoint&&this._isExitPoint}get isConnected(){return!this._isExitPoint||!this._isEntryPoint}get isTerminus(){return this._isEntryPoint||this._isExitPoint}get isInternal(){return!this._isEntryPoint&&!this._isExitPoint}};var $o=class extends Xi{connectTo(t){super.connectTo(t)}connectAt(t,e){super.connectAt(t,e)}connectSorted(t,e){super.connectSorted(t,e)}disconnectFrom(t){super.disconnectFrom(t)}isConnectedTo(t){return super.isConnectedTo(t)}flatten(){return super.flatten()}get connections(){return this._forward}get isEntryPoint(){return this._isEntryPoint}get isExitPoint(){return this._isExitPoint}};function ji(n,t,e){return new Map(n.map(r=>[t(r),e(r)]))}function Ol(n,t){return ji(n,t,Wt)}function Ed(n,...t){for(let e of t)if(g(e))for(let[r,i]of e)n.set(r,i);return n}var dt=class{constructor(t){this.items=new Map;this.defaultItems=new Array;if(g(t))for(let[e,r]of t)this.add(e,r)}add(t,e){if(O(t))this.defaultItems.push(e);else{let r=this.items.get(t);O(r)&&this.items.set(t,r=[]),r.push(e)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let t of this.defaultItems)yield t;for(let t of this.items.values())for(let e of t)yield e}has(t){return g(t)?this.items.has(t):this.defaultItems.length>0}get(t){return O(t)?this.defaultItems:this.items.get(t)||[]}count(t){if(O(t))return this.defaultItems.length;let e=this.get(t);return g(e)?e.length:0}get size(){let t=this.defaultItems.length;for(let e of this.items.values())t+=e.length;return t}delete(t){return O(t)?pe(this.defaultItems).length>0:this.items.delete(t)}remove(t,e){if(O(t))Ke(this.defaultItems,e);else{let r=this.items.get(t);g(r)&&(Ke(r,e),r.length===0&&this.items.delete(t))}}clear(){this.items.clear(),pe(this.defaultItems)}};var ze=class{constructor(t){this.items=new Map;if(g(t))for(let[e,r,i]of t)this.add(e,r,i)}add(t,e,r){let i=this.items.get(t);return O(i)&&this.items.set(t,i=new Map),i.set(e,r),this}*entries(){for(let[t,e]of this.items)for(let[r,i]of e)yield[t,r,i]}keys(t){return O(t)?this.items.keys():this.items.get(t).keys()}*values(){for(let t of this.items.values())for(let e of t.values())yield e}has(t,e){return this.items.has(t)&&(O(e)||this.items.get(t).has(e))}get(t,e){return O(e)?this.items.get(t):this.items.has(t)?this.items.get(t).get(e):null}count(t){return this.items.has(t)?this.items.get(t).size:null}get size(){let t=0;for(let e of this.items.values())t+=e.size;return t}delete(t,e){return O(e)?this.items.delete(t):this.items.has(t)?this.items.get(t).delete(e):!1}clear(){this.items.clear()}};var zi=class{constructor(){this.listeners=new Map;this.listenerOptions=new Map}addEventListener(t,e,r){if(se(e)){let i=this.listeners.get(t);i||(i=new Array,this.listeners.set(t,i)),i.find(o=>o===e)||(i.push(e),r&&this.listenerOptions.set(e,r))}}removeEventListener(t,e){if(se(e)){let r=this.listeners.get(t);r&&this.removeListener(r,e)}}clearEventListeners(t){for(let[e,r]of this.listeners)if(O(t)||t===e){for(let i of r)this.removeEventListener(t,i);pe(r),this.listeners.delete(e)}}removeListener(t,e){let r=t.findIndex(i=>i===e);r>=0&&(Hi(t,r),this.listenerOptions.has(e)&&this.listenerOptions.delete(e))}dispatchEvent(t){let e=this.listeners.get(t.type);if(e)for(let r of e){let i=this.listenerOptions.get(r);g(i)&&!De(i)&&i.once&&this.removeListener(e,r),r.call(this,t)}return!t.defaultPrevented}},j=class extends Event{get type(){return super.type}constructor(t){super(t)}},Z=class extends zi{constructor(){super(...arguments);this.bubblers=new Set;this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addEventListener(e,r,i){super.addEventListener(e,r,i)}removeEventListener(e,r){super.removeEventListener(e,r)}clearEventListeners(e){return super.clearEventListeners(e)}addScopedEventListener(e,r,i,o){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([r,i]),this.addEventListener(r,i,o)}removeScope(e){let r=this.scopes.get(e);if(r){this.scopes.delete(e);for(let[i,o]of r)this.removeEventListener(i,o)}}dispatchEvent(e){if(!super.dispatchEvent(e))return!1;for(let r of this.bubblers)if(!r.dispatchEvent(e))return!1;return!0}};var Ce=class{constructor(t,e,r=!0){this._resolve=null;this._reject=null;this._result=null;this._error=null;this._started=!1;this._finished=!1;this.resolve=null;this.reject=null;let i=Ui,o=Ui;se(t)&&(i=t),se(e)&&(o=e),De(t)?r=t:De(e)&&(r=e),this.resolve=s=>{g(this._resolve)&&this._resolve(s)},this.reject=s=>{g(this._reject)&&this._reject(s)},this.promise=new Promise((s,a)=>{this._resolve=p=>{i(p)&&(this._result=p,this._finished=!0,s(p))},this._reject=p=>{o(p)&&(this._error=p,this._finished=!0,a(p))}}),r&&this.start()}get result(){if(g(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}start(){this._started=!0}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};function yd(n,t){return"on"+t in n}function le(n,t,e,...r){O(r)&&(r=[]);let i;if(q(e)?r.unshift(e):ae(e)&&(i=e),!(n instanceof zi)){if(!yd(n,t))throw new vt(`Target does not have a ${t} rejection event`);for(let d of r)if(!yd(n,d))throw new vt(`Target does not have a ${d} rejection event`)}let o=new Ce;if(ae(i)){let d=setTimeout(o.reject,i,`'${t}' has timed out.`);o.finally(clearTimeout.bind(globalThis,d))}let s=(d,h)=>{n.addEventListener(d,h),o.finally(()=>n.removeEventListener(d,h))},a=d=>o.resolve(d),p=d=>o.reject(d);s(t,a);for(let d of r)s(d,p);return o}function At(n){return n.then(Ui).catch(wd)}var Td=class{constructor(t,e,r){this.callback=null;this.promise=new Promise((i,o)=>{this.callback=(...s)=>{t(...s)?i(e(...s)):o(r(...s))}})}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};function Md(n){let t=new Ce(n),e=setInterval(()=>{n()&&(clearInterval(e),t.resolve())},100);return t}var vt=class extends Error{constructor(e,r=null){super(e);this.innerError=r}};function Sd(){return"chrome"in globalThis&&!navigator.userAgent.match("CriOS")}function Rd(){return"InstallTrigger"in globalThis}function Hx(){return/^mac/i.test(navigator.platform)}function Nx(){return/iP(ad|hone|od)/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||Hx()&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>2}function It(){return/Mobile VR/.test(navigator.userAgent)||/Pico Neo 3 Link/.test(navigator.userAgent)||qt}function es(){return"xr"in navigator&&"isSessionSupported"in navigator.xr}function Bl(){return"getVRDisplays"in navigator}function ts(){return es()||Bl()}function Gi(){return/Android/.test(navigator.userAgent)||/BlackBerry/.test(navigator.userAgent)||/(UC Browser |UCWEB)/.test(navigator.userAgent)||Nx()||It()}function Or(){return!Gi()}var Xx=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,Zo=navigator.userAgent.match(Xx),qt=!!Zo,Pd=qt&&{major:parseFloat(Zo[1]),minor:parseFloat(Zo[2]),patch:parseFloat(Zo[3])},Bb=qt&&/pacific/i.test(navigator.userAgent),Fb=qt&&/quest/i.test(navigator.userAgent),Hb=qt&&/quest 2/i.test(navigator.userAgent);var mn=!("Document"in globalThis);var jx=298.257223563,zx=6378137;var Fl=1/jx,rs=1-Fl,te=Fl/(2-Fl),Xb=zx/(1+te)*(1+te*te/4+te*te*te*te/64),ns=Math.sqrt(1-rs*rs),ut=1-rs*rs,jb=ns*ns/(1-ns*ns),zb=1-ut*(.25+ut*(3/64+5*ut/256)),Ub=ut*(3/8+ut*(3/32+45*ut/1024)),Gb=ut*ut*(15/256+ut*45/1024),Wb=ut*ut*ut*(35/3072),qb=[te/2-2*te*te/3+37*te*te*te/96,te*te/48+te*te*te/15,17*te*te*te/480],Qb=[2*te-2*te*te/3,7*te*te/3-8*te*te*te/5,56*te*te*te/15];var is=1e-6,Wi=typeof Float32Array<"u"?Float32Array:Array,Hl=Math.random;var Yb=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Oe={};kx(Oe,{add:()=>Kx,angle:()=>gg,bezier:()=>cg,ceil:()=>Yx,clone:()=>Gx,copy:()=>qx,create:()=>Id,cross:()=>sg,dist:()=>Tg,distance:()=>Dd,div:()=>wg,divide:()=>kd,dot:()=>Fd,equals:()=>bg,exactEquals:()=>_g,floor:()=>Jx,forEach:()=>Pg,fromValues:()=>Wx,hermite:()=>lg,inverse:()=>ig,len:()=>Sg,length:()=>Cd,lerp:()=>ag,max:()=>Zx,min:()=>$x,mul:()=>yg,multiply:()=>Ld,negate:()=>rg,normalize:()=>og,random:()=>pg,rotateX:()=>hg,rotateY:()=>fg,rotateZ:()=>xg,round:()=>eg,scale:()=>tg,scaleAndAdd:()=>ng,set:()=>Qx,sqrDist:()=>Mg,sqrLen:()=>Rg,squaredDistance:()=>Od,squaredLength:()=>Bd,str:()=>Ag,sub:()=>Eg,subtract:()=>Vd,transformMat3:()=>ug,transformMat4:()=>dg,transformQuat:()=>mg,zero:()=>vg});function Id(){var n=new Wi(3);return Wi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Gx(n){var t=new Wi(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function Cd(n){var t=n[0],e=n[1],r=n[2];return Math.hypot(t,e,r)}function Wx(n,t,e){var r=new Wi(3);return r[0]=n,r[1]=t,r[2]=e,r}function qx(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function Qx(n,t,e,r){return n[0]=t,n[1]=e,n[2]=r,n}function Kx(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function Vd(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function Ld(n,t,e){return n[0]=t[0]*e[0],n[1]=t[1]*e[1],n[2]=t[2]*e[2],n}function kd(n,t,e){return n[0]=t[0]/e[0],n[1]=t[1]/e[1],n[2]=t[2]/e[2],n}function Yx(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n}function Jx(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n}function $x(n,t,e){return n[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n[2]=Math.min(t[2],e[2]),n}function Zx(n,t,e){return n[0]=Math.max(t[0],e[0]),n[1]=Math.max(t[1],e[1]),n[2]=Math.max(t[2],e[2]),n}function eg(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n}function tg(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function ng(n,t,e,r){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function Dd(n,t){var e=t[0]-n[0],r=t[1]-n[1],i=t[2]-n[2];return Math.hypot(e,r,i)}function Od(n,t){var e=t[0]-n[0],r=t[1]-n[1],i=t[2]-n[2];return e*e+r*r+i*i}function Bd(n){var t=n[0],e=n[1],r=n[2];return t*t+e*e+r*r}function rg(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n}function ig(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n}function og(n,t){var e=t[0],r=t[1],i=t[2],o=e*e+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n}function Fd(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function sg(n,t,e){var r=t[0],i=t[1],o=t[2],s=e[0],a=e[1],p=e[2];return n[0]=i*p-o*a,n[1]=o*s-r*p,n[2]=r*a-i*s,n}function ag(n,t,e,r){var i=t[0],o=t[1],s=t[2];return n[0]=i+r*(e[0]-i),n[1]=o+r*(e[1]-o),n[2]=s+r*(e[2]-s),n}function lg(n,t,e,r,i,o){var s=o*o,a=s*(2*o-3)+1,p=s*(o-2)+o,d=s*(o-1),h=s*(3-2*o);return n[0]=t[0]*a+e[0]*p+r[0]*d+i[0]*h,n[1]=t[1]*a+e[1]*p+r[1]*d+i[1]*h,n[2]=t[2]*a+e[2]*p+r[2]*d+i[2]*h,n}function cg(n,t,e,r,i,o){var s=1-o,a=s*s,p=o*o,d=a*s,h=3*o*a,x=3*p*s,A=p*o;return n[0]=t[0]*d+e[0]*h+r[0]*x+i[0]*A,n[1]=t[1]*d+e[1]*h+r[1]*x+i[1]*A,n[2]=t[2]*d+e[2]*h+r[2]*x+i[2]*A,n}function pg(n,t){t=t||1;var e=Hl()*2*Math.PI,r=Hl()*2-1,i=Math.sqrt(1-r*r)*t;return n[0]=Math.cos(e)*i,n[1]=Math.sin(e)*i,n[2]=r*t,n}function dg(n,t,e){var r=t[0],i=t[1],o=t[2],s=e[3]*r+e[7]*i+e[11]*o+e[15];return s=s||1,n[0]=(e[0]*r+e[4]*i+e[8]*o+e[12])/s,n[1]=(e[1]*r+e[5]*i+e[9]*o+e[13])/s,n[2]=(e[2]*r+e[6]*i+e[10]*o+e[14])/s,n}function ug(n,t,e){var r=t[0],i=t[1],o=t[2];return n[0]=r*e[0]+i*e[3]+o*e[6],n[1]=r*e[1]+i*e[4]+o*e[7],n[2]=r*e[2]+i*e[5]+o*e[8],n}function mg(n,t,e){var r=e[0],i=e[1],o=e[2],s=e[3],a=t[0],p=t[1],d=t[2],h=i*d-o*p,x=o*a-r*d,A=r*p-i*a,E=i*A-o*x,S=o*h-r*A,P=r*x-i*h,R=s*2;return h*=R,x*=R,A*=R,E*=2,S*=2,P*=2,n[0]=a+h+E,n[1]=p+x+S,n[2]=d+A+P,n}function hg(n,t,e,r){var i=[],o=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),n[0]=o[0]+e[0],n[1]=o[1]+e[1],n[2]=o[2]+e[2],n}function fg(n,t,e,r){var i=[],o=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),n[0]=o[0]+e[0],n[1]=o[1]+e[1],n[2]=o[2]+e[2],n}function xg(n,t,e,r){var i=[],o=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],n[0]=o[0]+e[0],n[1]=o[1]+e[1],n[2]=o[2]+e[2],n}function gg(n,t){var e=n[0],r=n[1],i=n[2],o=t[0],s=t[1],a=t[2],p=Math.sqrt(e*e+r*r+i*i),d=Math.sqrt(o*o+s*s+a*a),h=p*d,x=h&&Fd(n,t)/h;return Math.acos(Math.min(Math.max(x,-1),1))}function vg(n){return n[0]=0,n[1]=0,n[2]=0,n}function Ag(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function _g(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]}function bg(n,t){var e=n[0],r=n[1],i=n[2],o=t[0],s=t[1],a=t[2];return Math.abs(e-o)<=is*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(r-s)<=is*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=is*Math.max(1,Math.abs(i),Math.abs(a))}var Eg=Vd,yg=Ld,wg=kd,Tg=Dd,Mg=Od,Sg=Cd,Rg=Bd,Pg=function(){var n=Id();return function(t,e,r,i,o,s){var a,p;for(e||(e=3),r||(r=0),i?p=Math.min(i*e+r,t.length):p=t.length,a=r;a<p;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],o(n,n,s),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2];return t}}();function Wt(n){return n}function Ui(){return!0}function wd(){return!1}function Hd(n,t){return n&&t}var Nl=2*Math.PI;function fn(n){return(n%Nl+Nl)%Nl}function Ct(n,t,e){return Math.min(e,Math.max(t,n))}function Ze(n){return n*Math.PI/180}function ss(n,t,e){let r=e-t;return r===0?0:(n-t)/r}function as(n,t,e){return n*(e-t)+t}function Nd(n,t,e){return(1-e)*n+e*t}function Xl(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function os(n){return n*180/Math.PI}function qi(n){return Math.abs(n)>1e-4?n:0}var xn=class extends Z{constructor(){super(...arguments);this.attached=new Array;this.soFar=null;this.total=null;this.msg=null;this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(e,r,i,o){this.soFar=e,this.total=r,this.msg=i,this.est=o;for(let s of this.attached)s.report(e,r,i,o)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(e){this.report(0,1,e||"starting")}end(e){this.report(1,1,e||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,pe(this.attached)}};var Qi=class extends xn{constructor(e,r){super();this.i=e;this.prog=r}report(e,r,i,o){super.report(e,r,i,o),this.prog.update(this.i,e,r,i)}};var Br=class{constructor(t){this.prog=t;this.weightTotal=0;this.subProgressCallbacks=new Array;this.subProgressWeights=new Array;this.subProgressValues=new Array;this.start=performance.now();for(let e=0;e<this.subProgressWeights.length;++e)this.subProgressValues[e]=0,this.subProgressCallbacks[e]=new Qi(e,this)}addSubProgress(t){t=t||1,this.weightTotal+=t,this.subProgressWeights.push(t),this.subProgressValues.push(0);let e=new Qi(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(e),e}update(t,e,r,i){if(this.prog){this.subProgressValues[t]=e/r;let o=0;for(let d=0;d<this.subProgressWeights.length;++d)o+=this.subProgressValues[d]*this.subProgressWeights[d];let s=performance.now(),a=s-this.start,p=this.start-s+a*this.weightTotal/o;this.prog.report(o,this.weightTotal,i,p)}}};function jl(n){return g(n)&&se(n.report)&&se(n.attach)&&se(n.end)}function Fr(n,t){return new zl(t,n).subProgressCallbacks}function Xd(n,t){let e=new Array(t);for(let r=0;r<t;++r)e[r]=1;return Fr(n,e)}var zl=class extends Br{constructor(t,e){super(e);for(let r of t)this.addSubProgress(r)}};function ls(n){return new Ul(n)}var Ul=class extends Br{pop(t){return this.addSubProgress(t)}};async function Ki(n,t){let e=new Array(t.length),r=new Array(t.length);for(let s=0;s<t.length;++s){let a=t[s];e[s]=a[0],r[s]=a[1]}let i=Fr(n,e),o=new Array(t.length);for(let s=0;s<t.length;++s)o[s]=r[s](i[s]);return await Promise.all(o)}function cs(n,...t){let e=t.map(r=>[1,r]);return Ki(n,e)}function Yi(n,t,e){return typeof n===t||n instanceof e}function se(n){return Yi(n,"function",Function)}function q(n){return Yi(n,"string",String)}function De(n){return Yi(n,"boolean",Boolean)}function ae(n){return Yi(n,"number",Number)}function jd(n){return ae(n)&&!Number.isNaN(n)}function hn(n){return g(n)&&Yi(n,"object",Object)}function Gl(n){return n instanceof Date}function Be(n){return n instanceof Array}function de(n,t){throw new Error((t||"Unexpected object: ")+n)}function O(n){return n==null}function g(n){return!O(n)}function zd(n){return n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Int8Array||n instanceof Uint16Array||n instanceof Int16Array||n instanceof Uint32Array||n instanceof Int32Array||n instanceof Float32Array||n instanceof Float64Array||"BigUint64Array"in globalThis&&n instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&n instanceof globalThis.BigInt64Array}function Ud(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function _t(n,t){let e=globalThis,r=e[n];if(O(r)){if(O(t))throw new Error(`No value ${n} found`);r=t(),e[n]=r}return r}var Cg="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function bt(n,t){if(n<0)throw new Error("Length must be greater than 0");O(t)&&(t=Cg);let e="";for(let r=0;r<n;++r){let i=Math.floor(Math.random()*t.length);e+=t[i]}return e}function qn(...n){let t=[];for(let e of n)g(e)&&e.length>0&&t.indexOf(e)===-1&&t.push(e);return t.join("-")}var Ji=class{constructor(){this.t=0;this.dt=0;this.sdt=0;this.fps=0}set(t,e){this.t=t,this.dt=e,this.sdt=Nd(this.sdt,e,.01),e>0&&(this.fps=1e3/e)}},ps=class extends Ji{constructor(){super(),Object.seal(this)}};var Hr=class{constructor(t){this.timer=null;this.lt=-1;this.tickHandlers=new Array;this._targetFPS=null;this.targetFPS=t;let e=new ps,r=0;this.onTick=i=>{this.lt>=0&&(r=i-this.lt,e.set(i,r),this.tick(e)),this.lt=i}}get targetFPS(){return this._targetFPS}set targetFPS(t){this._targetFPS=t}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){Ke(this.tickHandlers,t)}tick(t){for(let e of this.tickHandlers)e(t)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};var ds=class extends Hr{constructor(t){super(t)}start(){let t=()=>{this.timer=setTimeout(t,this.targetFrameTime),this.onTick(performance.now())};this.timer=setTimeout(t,this.targetFrameTime)}stop(){this.isRunning&&(clearTimeout(this.timer),super.stop())}};function Wl(n){return g(n)&&n.length>0?parseFloat(n):null}var Gd=class{constructor(t,e){this._url=null;this._base=void 0;this._protocol=null;this._host=null;this._hostName=null;this._userName=null;this._password=null;this._port=null;this._pathName=null;this._hash=null;this._query=new Map;t!==void 0&&(this._url=new URL(t,e),this.rehydrate())}rehydrate(){g(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),g(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),g(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),g(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),g(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),g(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),g(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),g(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[t,e]of this._query)this._url.searchParams.set(t,e);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=Wl(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((t,e)=>this._query.set(e,t))}refresh(){if(this._url===null){if(g(this._protocol)&&(g(this._host)||g(this._hostName))){if(g(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=Wl(this._url.port),this.rehydrate(),!1;if(g(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(g(this._pathName)&&g(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return g(this._url)}base(t){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=t,this.refresh(),this}protocol(t){return this._protocol=t,this.refresh()&&(this._url.protocol=t),this}host(t){return this._host=t,this.refresh()&&(this._url.host=t,this._hostName=this._url.hostname,this._port=Wl(this._url.port)),this}hostName(t){return this._hostName=t,this.refresh()&&(this._url.hostname=t,this._host=`${this._url.hostname}:${this._url.port}`),this}port(t){return this._port=t,this.refresh()&&(this._url.port=t.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(t){return this._userName=t,this.refresh()&&(this._url.username=t),this}password(t){return this._password=t,this.refresh()&&(this._url.password=t),this}path(t){return this._pathName=t,this.refresh()&&(this._url.pathname=t),this}pathPop(t){return t=t||/\/[^\/]+\/?$/,this.path(this._pathName.replace(t,""))}pathPush(t){let e=this._pathName;return e.endsWith("/")||(e+="/"),e+=t,this.path(e)}query(t,e){return this._query.set(t,e),this.refresh()&&this._url.searchParams.set(t,e),this}hash(t){return this._hash=t,this.refresh()&&(this._url.hash=t),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};function ql(n){let t=new Map;for(let[e,r]of n)t.set(r,e);return t}var Vg=new Map([[1,"KiB"],[2,"MiB"],[3,"GiB"],[4,"TiB"]]),Lg=new Map([[1,"KB"],[2,"MB"],[3,"GB"],[4,"TB"]]),Ay=ql(Vg),_y=ql(Lg);var Wd=304.79999999999995,Ey=Wd*3,kg=10*100,Dg=Wd*16.5,Og=Dg*40,yy=kg*1e3,wy=Og*8,qd=2.54*4,Qd=qd*3,Ty=Qd*3,Bg=Qd*16.5,Fg=Bg*40,My=100*1e3,Sy=Fg*8,Ql=4*3,Hg=Ql*3,Kl=100/2.54,Ng=Ql*16.5,Xg=Ng*40,Ry=Kl*1e3,Py=Xg*8,Iy=3*3,jg=100/qd,zg=3*16.5,Ug=zg*40,Cy=jg*1e3,Vy=Ug*8,Yl=Kl/Ql,Gg=16.5*40,Ly=Yl*1e3,ky=Gg*8,Wg=Kl/Hg,qg=16.5/3,Qg=qg*40,Dy=Wg*1e3,Oy=Qg*8,Kd=16.5/Yl,Yd=Kd*40,By=Yd*8,Fy=1e3/Kd,Hy=40*8,Kg=1e3/Yd,Ny=8/Kg;function Jd(n){return n/Yl}function Jl(n,...t){if(!hn(n))return!1;n=n;for(let e of t){if(!(e in n))return!1;let r=n[e];if(!se(r))return!1}return!0}function Nr(n){return Jl(n,"dispose")}function Yg(n){return Jl(n,"destroy")}function Jg(n){return Jl(n,"close")}function Xr(n){Nr(n)&&n.dispose(),Jg(n)&&n.close(),Yg(n)&&n.destroy()}function $d(n,t){try{return t(n)}finally{Xr(n)}}var Qt=class{constructor(t,e){this.path=t;this.getter=e;this.promise=new Promise((r,i)=>{this.resolve=o=>{this._result=o,this._finished=!0,r(o)},this.reject=o=>{this._error=o,this._finished=!0,i(o)}})}promise;_result=null;_error=null;_started=!1;_finished=!1;get result(){if(g(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}resolve=null;reject=null;getSize(t){return t.head(this.path).exec().then(e=>[this,e.contentLength])}async getContent(t){try{let e=await this.getter(this.path,t);this.resolve(e)}catch(e){this.reject(e)}}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};var fe=class{constructor(t,e,r,...i){this.key=t;this.value=e;this.bySetAttribute=r;this.tags=i.map(o=>o.toLocaleUpperCase()),Object.freeze(this)}tags;applyToElement(t){let e=this.key.startsWith("data-");if(!(this.tags.length===0||this.tags.indexOf(t.tagName)>-1||e))console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`);else if(e){let i=this.key.substring(5);t.dataset[i]=this.value}else this.key==="style"?Object.assign(t.style,this.value):this.key==="classList"?this.value.forEach(i=>t.classList.add(i)):this.bySetAttribute?t.setAttribute(this.key,this.value):this.key in t?t[this.key]=this.value:this.value===!1?t.removeAttribute(this.key):this.value===!0?t.setAttribute(this.key,""):t.setAttribute(this.key,this.value)}};function Kt(n){return new fe("autoplay",n,!1,"audio","video")}function Ee(n){return new fe("className",n,!1)}function jr(...n){return new fe("classList",n,!1)}function gn(n){return new fe("controls",n,!1,"audio","video")}function Zd(n,t){return new fe("data-"+n,t,!1)}function eu(n){return new fe("height",n,!1,"canvas","embed","iframe","img","input","object","video")}function Qn(n){return new fe("id",n,!1)}function Kn(n){return new fe("loop",n,!1,"audio","bgsound","marquee","video")}function $l(n){return new fe("max",n,!1,"input","meter","progress")}function Zl(n){return new fe("min",n,!1,"input","meter")}function ec(n){return new fe("muted",n,!1,"audio","video")}function Yt(n){return new fe("playsInline",n,!1,"audio","video")}function $g(n){return n instanceof URL&&(n=n.href),n}function $i(n){return new fe("src",$g(n),!1,"audio","embed","iframe","img","input","script","source","track","video")}function tc(n){return new fe("srcObject",n,!1,"audio","video")}function nc(n){return new fe("step",n,!1,"input")}function zr(n){return new fe("title",n,!1)}function Yn(n){return q(n)||(n=n.value),new fe("type",n,!1,"button","input","command","embed","link","object","script","source","style","menu")}function Ur(n){return new fe("value",n,!1,"button","data","input","li","meter","option","progress","param")}function tu(n){return new fe("width",n,!1,"canvas","embed","iframe","img","input","object","video")}var Q=class{constructor(t,e){this.key=t;this.value=e;this.name=t.replace(/[A-Z]/g,r=>`-${r.toLocaleLowerCase()}`)}name;applyToElement(t){t.style[this.key]=this.value}},rc=class{rest;constructor(...t){this.rest=t}applyToElement(t){for(let e of this.rest)e.applyToElement(t)}};function ot(...n){return new rc(...n)}function Zi(n){return new Q("backgroundColor",n)}function nu(n){return new Q("border",n)}function ru(n){return new Q("borderRadius",n)}function iu(n){return new Q("boxShadow",n)}function ou(n){return new Q("columnGap",n)}function Ue(n){return new Q("display",n)}function su(n){return new Q("flexFlow",n)}function au(n){return new Q("float",n)}function us(n){return new Q("fontSize",n)}function ms(n,t,e,r){return q(n)||(n=[n,t,e,r].filter(g).join("/")),new Q("gridArea",n)}function hs(n){return new Q("gridAutoFlow",n)}function Jn(n,t){return q(n)||(n=[n,t].filter(g).join("/")),new Q("gridColumn",n)}function fs(n,t){return q(n)||(n=[n,t].filter(g).join("/")),new Q("gridRow",n)}function vn(n){return new Q("gridTemplateColumns",n)}function xs(n){return new Q("gridTemplateRows",n)}function Jt(n){return new Q("height",n)}function $n(n){return new Q("left",n)}function An(n){return new Q("margin",n)}function lu(n){return new Q("marginInlineStart",n)}function cu(n){return new Q("marginLeft",n)}function pu(n){return new Q("maxHeight",n)}function eo(n){return new Q("maxWidth",n)}function du(n){return new Q("minWidth",n)}function uu(n){return new Q("overflow",n)}function _n(...n){return new Q("padding",n.join(" "))}function mu(n){return new Q("paddingRight",n)}function oc(n){return new Q("pointerEvents",n)}function Gr(n){return new Q("position",n)}function Zn(n){return new Q("textAlign",n)}function er(n){return new Q("top",n)}function hu(n){return new Q("touchAction",n)}function fu(n){return new Q("transform",n)}function Et(n){return new Q("width",n)}function xu(n){return new Q("zIndex",ae(n)?n.toFixed(0):n)}function gu(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}var ic=class{constructor(t,e){this.selector=t;this.props=e}apply(t){let e=this.props.map(r=>`${r.name}: ${r.value};`).join("");t.insertRule(`${this.selector} {${e}}`,t.cssRules.length)}};function ee(n,...t){return new ic(n,t)}function nr(n){return hn(n)?n.element instanceof Node:!1}function sc(n){return hn(n)&&"elements"in n&&n.elements instanceof Array}function tr(n){return nr(n)?n.element:n}function Zg(n){return hn(n)&&"applyToElement"in n&&se(n.applyToElement)}function Re(n,t,e="block"){n=tr(n),n.style.display=t?e:"none"}function Vt(n){return n=tr(n),n.style.display!=="none"}function me(n,...t){n=tr(n);for(let e of t)g(e)&&(e instanceof Node?n.append(e):nr(e)?n.append(tr(e)):sc(e)?n.append(...e.elements.map(tr)):Zg(e)?e.applyToElement(n):n.append(document.createTextNode(e.toLocaleString())));return n}function ev(n){return document.querySelector(n)}function vu(n){return ev(n)}function Fe(n,...t){let e=null;for(let r of t)if(r instanceof fe&&r.key==="id"){e=document.getElementById(r.value);break}return e==null&&(e=document.createElement(n)),me(e,...t),e}function gs(n){return"disabled"in n&&De(n.disabled)}function Au(n){for(n=tr(n);n.lastChild;)n.lastChild.remove()}function Wr(n,t){n=tr(n),Au(n),n.append(nv(t))}async function _u(n,t,e){g(e)&&e.start();let r=n==="canplay"?t.HAVE_CURRENT_DATA:t.HAVE_ENOUGH_DATA;if(t.readyState>=r)return!0;try{return await le(t,n,"error"),!0}catch(i){return console.warn(t.error,i),!1}finally{g(e)&&e.end()}}function vs(n,t){return _u("canplay",n,t)}function As(n,t){return _u("canplaythrough",n,t)}function rr(...n){return Fe("audio",...n)}function tv(...n){return Fe("button",...n)}function bu(...n){return tv(...n,Yn("button"))}function qr(...n){return bu(...n,jr("btn","btn-primary"))}function _s(...n){return bu(...n,jr("btn","btn-secondary"))}function bs(...n){return Fe("canvas",...n)}function Eu(...n){return Fe("dd",...n)}function he(...n){return Fe("div",...n)}function yu(...n){return Fe("dl",...n)}function wu(...n){return Fe("dt",...n)}function Tu(...n){return Fe("h1",...n)}function Mu(...n){return Fe("h2",...n)}function ir(...n){return Fe("img",...n)}function ac(...n){return Fe("input",...n)}function Su(...n){return Fe("label",...n)}function Ru(...n){return Fe("meter",...n)}function Es(...n){return Fe("option",...n)}function Pu(...n){return Fe("script",...n)}function lc(...n){return Fe("select",...n)}function cc(...n){return Fe("video",...n)}function Iu(...n){return ac(Yn("checkbox"),...n)}function Cu(...n){return ac(Yn("number"),...n)}function Vu(...n){return ac(Yn("range"),...n)}function nv(n){return document.createTextNode(n)}function Lt(...n){let t=document.createElement("style");document.head.append(t);for(let e of n)e.apply(t.sheet);return t}function to(n,t,e,...r){return rr(Yt(!0),gn(!1),ec(t),Kt(n),Kn(e),ot(Ue("none")),...r)}function Lu(n,t,e,...r){return cc(Yt(!0),gn(!1),ec(t),Kt(n),Kn(e),ot(Ue("none")),...r)}var ys="HTMLCanvasElement"in globalThis,Lw="HTMLImageElement"in globalThis,ku=!1,bn=!ku&&"OffscreenCanvas"in globalThis,Du=!ku&&"createImageBitmap"in globalThis;function Qr(n){return ys&&n instanceof HTMLCanvasElement}function Ou(n){return bn&&n instanceof OffscreenCanvas}function Bu(n){return Du&&n instanceof ImageBitmap}function rv(n,t){let e=n.getContext("2d");if(O(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function iv(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var ov=bn&&iv(),or=ov&&pc||ys&&no||null,ws=ys?no:or;function sv(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var kw=bn&&sv();function av(){if(!ys&&!bn)return!1;try{return or(1,1).getContext("bitmaprenderer")!=null}catch{return!1}}var Dw=Du&&av();function pc(n,t){return new OffscreenCanvas(n,t)}function no(n,t){return bs(tu(n),eu(t))}function Fu(n){let t=no(n.width,n.height);return rv(t,n),t}function dc(n,t){let e=n.getContext("2d");if(O(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function Hu(n,t,e,r=1){return t=Math.floor(t*r),e=Math.floor(e*r),n.width!=t||n.height!=e?(n.width=t,n.height=e,!0):!1}function lv(n){return g(n.textBaseline)}function cv(n,t,e,r=1){let i=n.imageSmoothingEnabled,o=n.textBaseline,s=n.textAlign,a=n.font,p=Hu(n.canvas,t,e,r);return p&&(n.imageSmoothingEnabled=i,n.textBaseline=o,n.textAlign=s,n.font=a),p}function uc(n,t,e,r=1){return lv(n)?cv(n,t,e,r):Hu(n.canvas,t,e,r)}var En=class extends Z{constructor(e,r,i){super();this._scale=250;this._visible=!0;this.wasVisible=null;this.redrawnEvt=new j("redrawn");this.element=null;g(i)&&g(i.scale)&&(this._scale=i.scale),this._canvas=ws(e,r),this._g=this.canvas.getContext("2d"),Qr(this._canvas)&&(this.element=this._canvas)}fillRect(e,r,i,o,s,a){this.g.fillStyle=e,this.g.fillRect(r+a,i+a,o-2*a,s-2*a)}drawText(e,r,i,o){this.g.textAlign=o,this.g.strokeText(e,r,i),this.g.fillText(e,r,i)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(e){this.scale!==e&&(this._scale=e,this.redraw())}get visible(){return this._visible}set visible(e){this.visible!==e&&(this.wasVisible=this._visible,this._visible=e,this.redraw())}};var Ts=class extends En{_pitch=0;_heading=0;constructor(){super(128,128),this.redraw()}get pitch(){return this._pitch}set pitch(t){t!==this.pitch&&(this._pitch=t,this.redraw())}get heading(){return this._heading}set heading(t){t!==this.heading&&(this._heading=t,this.redraw())}setPitchAndHeading(t,e){(t!==this.pitch||e!==this.heading)&&(this._pitch=t,this._heading=e,this.redraw())}onRedraw(){let t=Ze(this.pitch),e=Ze(this.heading-180),r=5,i=this.canvas.width-2*r,o=this.canvas.height-2*r,s=.5*i,a=.5*o,p=Math.sin(t),d=this.g;return d.save(),d.clearRect(0,0,this.canvas.width,this.canvas.height),d.translate(r,r),d.scale(s,a),d.translate(1,1),d.fillStyle="#808080",d.beginPath(),d.arc(0,0,1,0,2*Math.PI),d.fill(),d.fillStyle="#d0d0d0",d.beginPath(),d.arc(0,0,1,0,Math.PI,!0),d.fill(),d.save(),d.scale(1,Math.abs(p)),p<0&&(d.fillStyle="#808080"),d.beginPath(),d.arc(0,0,1,0,Math.PI,p<0),d.fill(),d.restore(),d.save(),d.shadowColor="#404040",d.shadowBlur=4,d.shadowOffsetX=3,d.shadowOffsetY=3,d.rotate(e),d.fillStyle="#ff0000",d.beginPath(),d.moveTo(-.1,0),d.lineTo(0,.667),d.lineTo(.1,0),d.closePath(),d.fill(),d.fillStyle="#ffffff",d.beginPath(),d.moveTo(-.1,0),d.lineTo(0,-.667),d.lineTo(.1,0),d.closePath(),d.fill(),d.restore(),d.beginPath(),d.strokeStyle="#000000",d.lineWidth=.1,d.arc(0,0,1,0,2*Math.PI),d.stroke(),d.restore(),!0}};var pv="The quick brown fox jumps over the lazy dog",Nu=_t("juniper::loadedFonts",()=>[]);function ro(n){let t=[];return n.fontStyle&&n.fontStyle!=="normal"&&t.push(n.fontStyle),n.fontVariant&&n.fontVariant!=="normal"&&t.push(n.fontVariant),n.fontWeight&&n.fontWeight!=="normal"&&t.push(n.fontWeight),t.push(`${n.fontSize}px`),t.push(n.fontFamily),t.join(" ")}async function Xu(n,t=null,e){if(q(n)||(n=ro(n)),Nu.indexOf(n)===-1){t=t||pv,e&&e.start(n);let r=await document.fonts.load(n,t);e&&e.end(n),r.length===0?console.warn(`Failed to load font "${n}". If this is a system font, just set the object's \`value\` property, instead of calling \`loadFontAndSetText\`.`):Nu.push(n)}}function ju(n){return"getBattery"in n}var dv=["","N/A","charging"],Kr=class extends En{battery=null;lastChargeDirection=null;lastLevel=null;chargeDirection=0;level=.5;constructor(){super(256,128),ju(navigator)?this.readBattery(navigator):this.redraw()}onRedraw(){this.battery?(this.chargeDirection=this.battery.charging?1:-1,this.level=this.battery.level):(this.level+=.1,this.level>1&&(this.level=0));let t=this.chargeDirection!==this.lastChargeDirection,e=this.level!==this.lastLevel;if(!t&&!e)return!1;this.lastChargeDirection=this.chargeDirection,this.lastLevel=this.level;let r=this.level<.1?"red":"#ccc",i=7,o=.7,s=(1-o)/2,a=this.canvas.width-2*i,p=a-4*i,d=this.canvas.height-4*i,h=a/2,x=this.canvas.height/2,A=dv[this.chargeDirection+1];return this.g.clearRect(0,0,a,this.canvas.height),this.g.save(),this.g.translate(s*this.canvas.width,s*this.canvas.height),this.g.globalAlpha=.75,this.g.scale(o,o),this.fillRect("#ccc",0,0,a,this.canvas.height,0),this.fillRect("#ccc",a,x-2*i-10,i+10,4*i+20,0),this.g.clearRect(i,i,a-2*i,this.canvas.height-2*i),this.fillRect("black",i,i,a-2*i,this.canvas.height-2*i,0),this.g.clearRect(2*i,2*i,p*this.level,d),this.fillRect(r,2*i,2*i,p*this.level,d,0),this.g.fillStyle="white",this.g.strokeStyle="black",this.g.lineWidth=4,this.g.textBaseline="middle",this.g.font=ro({fontSize:d/2,fontFamily:"Lato"}),this.drawText(A,h,x,"center"),this.g.restore(),!0}async readBattery(t){let e=this.redraw.bind(this);e(),this.battery=await t.getBattery(),this.battery.addEventListener("chargingchange",e),this.battery.addEventListener("levelchange",e),setInterval(e,1e3),e()}};vd(Kr,"isAvailable",ju(navigator));var yn=class extends En{constructor(e){super(10,10,e);this.trueWidth=null;this.trueHeight=null;this.trueFontSize=null;this.dx=null;this._minWidth=null;this._maxWidth=null;this._minHeight=null;this._maxHeight=null;this._freezeDimensions=!1;this._dimensionsFrozen=!1;this._bgFillColor=null;this._bgStrokeColor=null;this._bgStrokeSize=null;this._textStrokeColor=null;this._textStrokeSize=null;this._textFillColor="black";this._textDirection="horizontal";this._wrapWords=!0;this._fontStyle="normal";this._fontVariant="normal";this._fontWeight="normal";this._fontFamily="sans-serif";this._fontSize=20;this._value=null;g(e)&&(g(e.minWidth)&&(this._minWidth=e.minWidth),g(e.maxWidth)&&(this._maxWidth=e.maxWidth),g(e.minHeight)&&(this._minHeight=e.minHeight),g(e.maxHeight)&&(this._maxHeight=e.maxHeight),g(e.freezeDimensions)&&(this._freezeDimensions=e.freezeDimensions),g(e.textStrokeColor)&&(this._textStrokeColor=e.textStrokeColor),g(e.textStrokeSize)&&(this._textStrokeSize=e.textStrokeSize),g(e.bgFillColor)&&(this._bgFillColor=e.bgFillColor),g(e.bgStrokeColor)&&(this._bgStrokeColor=e.bgStrokeColor),g(e.bgStrokeSize)&&(this._bgStrokeSize=e.bgStrokeSize),g(e.value)&&(this._value=e.value),g(e.textFillColor)&&(this._textFillColor=e.textFillColor),g(e.textDirection)&&(this._textDirection=e.textDirection),g(e.wrapWords)&&(this._wrapWords=e.wrapWords),g(e.fontStyle)&&(this._fontStyle=e.fontStyle),g(e.fontVariant)&&(this._fontVariant=e.fontVariant),g(e.fontWeight)&&(this._fontWeight=e.fontWeight),g(e.fontFamily)&&(this._fontFamily=e.fontFamily),g(e.fontSize)&&(this._fontSize=e.fontSize),g(e.padding)&&(ae(e.padding)?this._padding={left:e.padding,right:e.padding,top:e.padding,bottom:e.padding}:this._padding=e.padding)),O(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(e){this.minWidth!==e&&(this._minWidth=e,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(e){this.maxWidth!==e&&(this._maxWidth=e,this.redraw())}get minHeight(){return this._minHeight}set minHeight(e){this.minHeight!==e&&(this._minHeight=e,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(e){this.maxHeight!==e&&(this._maxHeight=e,this.redraw())}get padding(){return this._padding}set padding(e){if(e instanceof Array)throw new Error("Invalid padding");(this.padding.top!==e.top||this.padding.right!=e.right||this.padding.bottom!=e.bottom||this.padding.left!=e.left)&&(this._padding=e,this.redraw())}get wrapWords(){return this._wrapWords}set wrapWords(e){this.wrapWords!==e&&(this._wrapWords=e,this.redraw())}get textDirection(){return this._textDirection}set textDirection(e){this.textDirection!==e&&(this._textDirection=e,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(e){this.fontStyle!==e&&(this._fontStyle=e,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(e){this.fontVariant!==e&&(this._fontVariant=e,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(e){this.fontWeight!==e&&(this._fontWeight=e,this.redraw())}get fontSize(){return this._fontSize}set fontSize(e){this.fontSize!==e&&(this._fontSize=e,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(e){this.textFillColor!==e&&(this._textFillColor=e,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(e){this.textStrokeColor!==e&&(this._textStrokeColor=e,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(e){this.textStrokeSize!==e&&(this._textStrokeSize=e,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(e){this.bgFillColor!==e&&(this._bgFillColor=e,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(e){this.bgStrokeColor!==e&&(this._bgStrokeColor=e,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(e){this.bgStrokeSize!==e&&(this._bgStrokeSize=e,this.redraw())}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.redraw())}draw(e,r,i){this.canvas.width>0&&this.canvas.height>0&&e.drawImage(this.canvas,r,i,this.width,this.height)}split(e){return this.wrapWords?e.split(" ").join(`
`).replace(/\r\n/,`
`).split(`
`):e.replace(/\r\n/,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value){let e=this.split(this.value),r=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let o=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,s=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,a=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,p=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,d=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,h=r?p:s,x=r?d:a,A=r?s:p,E=r?a:d,S=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let P=!1,R=!1,V=1e4,B=0;this.trueFontSize=Ct(this.fontSize*this.scale,B,V);let L=null,k=Number.MAX_VALUE;do{let D=this.fontSize;this._fontSize=this.trueFontSize;let $=ro(this);this._fontSize=D,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=$,this.trueWidth=0,this.trueHeight=0;for(let W of e){let z=this.g.measureText(W);this.trueWidth=Math.max(this.trueWidth,z.width),this.trueHeight+=this.trueFontSize,ae(z.actualBoundingBoxLeft)&&ae(z.actualBoundingBoxRight)&&ae(z.actualBoundingBoxAscent)&&ae(z.actualBoundingBoxDescent)&&(o||(this.trueWidth=z.actualBoundingBoxLeft+z.actualBoundingBoxRight,this.trueHeight=z.actualBoundingBoxAscent+z.actualBoundingBoxDescent,this.dx=(z.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(o){let W=this.trueWidth-h,z=this.trueWidth-x,K=this.trueHeight-A,be=this.trueHeight-E,ge=Math.abs(W),ne=Math.abs(z),Qe=Math.abs(K),Dr=Math.abs(be);P=z>1||be>1,R=W<-1&&K<-1;let dn=Math.min(ge,Math.min(ne,Math.min(Qe,Dr)));dn<k&&(k=dn,L=this.g.font),(P||R)&&S.indexOf(this.g.font)>-1&&L&&(this.g.font=L,P=!1,R=!1),P?(V=this.trueFontSize,this.trueFontSize=(B+this.trueFontSize)/2):R&&(B=this.trueFontSize,this.trueFontSize=(this.trueFontSize+V)/2)}S.push(this.g.font)}while(P||R);o&&(this.trueWidth<h?this.trueWidth=h:this.trueWidth>x&&(this.trueWidth=x),this.trueHeight<A?this.trueHeight=A:this.trueHeight>E&&(this.trueHeight=E));let H=this.trueWidth+this.scale*(this.padding.right+this.padding.left),C=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{uc(this.g,H,C)}catch(D){throw console.error(D),D}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let i=.5*(e.length-1);for(let o=0;o<e.length;++o){let s=e[o],a=(o-i)*this.trueFontSize,p=this.dx+this.trueWidth/2+this.scale*this.padding.left,d=a+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(s,p,d),this.textFillColor&&this.g.fillText(s,p,d)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let o=this.bgStrokeSize/2;this.g.strokeRect(o,o,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(r){let o=or(this.canvas.height,this.canvas.width),s=o.getContext("2d");s?(s.translate(o.width/2,o.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?s.rotate(Math.PI/2):this.textDirection==="vertical-right"&&s.rotate(-Math.PI/2),s.translate(-this.canvas.width/2,-this.canvas.height/2),s.drawImage(this.canvas,0,0),uc(this.g,o.width,o.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(o,0,0)}return!0}else return!1}};var Ms=class extends yn{constructor(){super({textFillColor:"#ffffff",textStrokeColor:"rgba(0, 0, 0, 0.25)",textStrokeSize:.05,fontFamily:gu(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,wrapWords:!1,freezeDimensions:!0});let t=this.update.bind(this);setInterval(t,500),t()}fps=null;drawCalls=null;triangles=null;setStats(t,e,r){this.fps=t,this.drawCalls=e,this.triangles=r}lastLen=0;update(){let e=new Date().toLocaleTimeString();this.fps!==null&&(e+=` ${Math.round(this.fps).toFixed(0)}hz ${this.drawCalls}c ${this.triangles}t`),e.length!==this.lastLen&&(this.lastLen=e.length,this.unfreeze()),this.value=e}};var zu=["change","click","contextmenu","dblclick","mouseup","pointerup","reset","submit","touchend"];function Uu(n,t){let e=t||(async()=>!0),r=async i=>{if(i.isTrusted&&await e()){for(let o of zu)window.removeEventListener(o,r);await n()}};for(let i of zu)window.addEventListener(i,r)}var uv="AudioContext"in globalThis,Gu=uv&&"AudioListener"in globalThis,Wu=Gu&&"setPosition"in AudioListener.prototype,io=Gu&&"positionX"in AudioListener.prototype,c2=se(HTMLMediaElement.prototype.captureStream)||se(HTMLMediaElement.prototype.mozCaptureStream);function qu(n){return g(n)&&n.node instanceof AudioNode}function Qu(n){return g(n)&&n.input instanceof AudioNode&&n.output instanceof AudioNode}var wn=_t("Juniper:Audio:connections",()=>new Map),mc=_t("Juniper:Audio:names",()=>new Map);function Ku(n){return Qu(n)?n.output:qu(n)?n.node:n}function Yu(n){if(O(n))return;let t=null;Be(n)?n.length===2?t=n[1]:t=n[2]:t=n;let e=null;return Qu(t)?e=t.input:qu(t)?e=t.node:e=t,e}function Ju(n){return Be(n)?n.length===2?[n[0]]:[n[0],n[1]]:[]}function mv(n){return g(n)&&g(n.context)}function $u(n,t){mc.set(t,n)}function ie(n){mc.delete(n),mv(n)&&kt(n)}function Zu(...n){for(let t=1;t<n.length;++t)yt(n[t-1],n[t])}function yt(n,t){let e=Ku(n),r=Yu(t),i=Ju(t);if(O(r))throw new Error("Must have a target to connect to");r instanceof AudioParam?e.connect(r,i[0]):r instanceof AudioNode?e.connect(r,i[0],i[1]):de(r),wn.has(e)||wn.set(e,new Set);let o=wn.get(e);return o.has(r)?!1:(o.add(r),!0)}function kt(n,t){let e=Ku(n),r=Yu(t),i=Ju(t);if(O(r)?e.disconnect():r instanceof AudioParam?e.disconnect(r,i[0]):r instanceof AudioNode?e.disconnect(r,i[0],i[1]):de(r),!wn.has(e))return!1;let o=wn.get(e),s=!1;return O(r)?(s=o.size>0,o.clear()):o.has(r)&&(s=!0,o.delete(r)),o.size===0&&wn.delete(e),s}function hv(){let n=new Map;function t(e){n.has(e)||n.set(e,new $o(e))}for(let e of mc.keys())t(e);for(let[e,r]of wn){t(e);for(let i of r)t(i)}for(let[e,r]of wn){let i=n.get(e);for(let o of r)n.has(o)&&i.connectTo(n.get(o))}return Array.from(n.values())}globalThis.getAudioGraph=hv;async function Yr(n){if($u("speakers",n.destination),n.state!=="running")if(n.state==="closed")await n.resume();else if(n.state==="suspended"){let t=le(n,"statechange");Uu(()=>n.resume()),await t}else de(n.state)}function $t(n,t,...e){$u(n,t);for(let r of e)g(r)&&yt(t,r);return t}function em(n,t,e,...r){return $t(n,new AnalyserNode(t,e),...r)}function Jr(n,t,e,...r){return $t(n,new BiquadFilterNode(t,e),...r)}function tm(n,t,e,...r){return $t(n,new DelayNode(t,e),...r)}function nm(n,t,e,...r){return $t(n,new DynamicsCompressorNode(t,e),...r)}function He(n,t,e,...r){return $t(n,new GainNode(t,e),...r)}function sr(n,t,e,...r){return $t(n,t.createMediaElementSource(e),...r)}function hc(n,t,e,...r){return $t(n,new MediaStreamAudioDestinationNode(t,e),...r)}function rm(n,t,e,...r){return $t(n,t.createMediaStreamSource(e),...r)}function im(n,t,e,...r){return $t(n,new PannerNode(t,e),...r)}var Ss=class{constructor(){this.t=0;this.p=Oe.create();this.f=Oe.set(Oe.create(),0,0,-1);this.u=Oe.set(Oe.create(),0,1,0);this.o=Oe.create();Object.seal(this)}set(t,e,r,i,o,s,a,p,d){this.setPosition(t,e,r),this.setOrientation(i,o,s,a,p,d)}setPosition(t,e,r){Oe.set(this.p,t,e,r)}setOrientation(t,e,r,i,o,s){Oe.set(this.f,t,e,r),Oe.set(this.u,i,o,s)}setOffset(t,e,r){Oe.set(this.o,t,e,r)}copy(t){Oe.copy(this.p,t.p),Oe.copy(this.f,t.f),Oe.copy(this.u,t.u),Oe.copy(this.o,t.o)}};var $r=class extends Z{constructor(e,r,i){super();this.id=e;this.audioCtx=r;this.spatializer=i;this.pose=new Ss;this.disposed=!1;this.volumeControl=He(`volume-control-${this.id}`,r)}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){ie(this.volumeControl),Nr(this.spatializer)&&this.spatializer.dispose()}audioTick(e){this.spatializer.setPose(this.pose,e)}};var Zr=class{constructor(t){this.id=t;this.minDistance=1;this.maxDistance=10;this.algorithm="inverse"}setAudioProperties(t,e,r){this.minDistance=t,this.maxDistance=e,this.algorithm=r}};var ei=class extends Zr{constructor(){super(...arguments);this.disposed=!1}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){ie(this.input)}};var fc=_t("Juniper:Audio:Destinations:Spatializers:NoSpatializationNode:nodes",()=>new WeakMap),Ge=class extends ei{static instance(t){if(!fc.has(t)){let e=`no-spatialization-hook-${bt(8)}`;fc.set(t,new Ge(e,t))}return fc.get(t)}constructor(t,e){super(t),this.input=this.output=He(this.id,e),Object.seal(this)}setPose(t,e){}};var Rs=class extends $r{constructor(e,r,i){super("final",e,i);this._trueDestination=r;this._remoteUserInput=He("remote-user-input",this.audioCtx,null,this._spatializedInput=He("spatialized-input",this.audioCtx,null,this.volumeControl)),this._nonSpatializedInput=He("non-spatialized-input",this.audioCtx,null,this.volumeControl),yt(this.volumeControl,this._trueDestination),yt(Ge.instance(this.audioCtx),this.nonSpatializedInput)}onDisposing(){ie(this._remoteUserInput),ie(this._spatializedInput),ie(this._nonSpatializedInput),super.onDisposing()}get remoteUserInput(){return this._remoteUserInput}get spatializedInput(){return this._spatializedInput}get nonSpatializedInput(){return this._nonSpatializedInput}get trueDestination(){return this._trueDestination}};var ti=class extends Zr{constructor(e){super("listener");this.audioCtx=e}get listener(){return this.audioCtx.listener}};var Ps=class extends ti{constructor(t){if(super(t),!io)throw new Error("Latest WebAudio Listener API is not supported");Object.seal(this)}setPose(t,e){let{p:r,f:i,u:o}=t;this.listener.positionX.setValueAtTime(r[0],e),this.listener.positionY.setValueAtTime(r[1],e),this.listener.positionZ.setValueAtTime(r[2],e),this.listener.forwardX.setValueAtTime(i[0],e),this.listener.forwardY.setValueAtTime(i[1],e),this.listener.forwardZ.setValueAtTime(i[2],e),this.listener.upX.setValueAtTime(o[0],e),this.listener.upY.setValueAtTime(o[1],e),this.listener.upZ.setValueAtTime(o[2],e)}};var Is=class extends ti{constructor(t){if(super(t),!Wu)throw new Error("WebAudio Listener API is not supported");Object.seal(this)}setPose(t,e){let{p:r,f:i,u:o}=t;this.listener.setPosition(r[0],r[1],r[2]),this.listener.setOrientation(i[0],i[1],i[2],o[0],o[1],o[2])}};var st=se(HTMLAudioElement.prototype.setSinkId);function fv(n){let t=[];for(let e=0;e<n.length;++e){let r=n[e],i=!1;for(let o=0;o<t.length&&!i;++o){let s=t[o];i=r.kind===s.kind&&s.label.indexOf(r.label)>0}i||t.push(r)}return t}var xc=class extends j{constructor(e){super("audiooutputchanged");this.device=e}},gc=class extends j{constructor(e){super("audioinputchanged");this.audio=e}},vc=class extends j{constructor(e){super("videoinputchanged");this.video=e}},om="calla:preferredAudioOutputID",sm="calla:preferredAudioInputID",am="calla:preferredVideoInputID",Cs=class extends Z{constructor(e,r=!1){super();this.element=e;this.needsVideoDevice=r;this.ready=this.start(),Object.seal(this)}_hasAudioPermission=!1;get hasAudioPermission(){return this._hasAudioPermission}_hasVideoPermission=!1;get hasVideoPermission(){return this._hasVideoPermission}_currentStream=null;get currentStream(){return this._currentStream}set currentStream(e){if(e!==this.currentStream){if(g(this.currentStream)&&this.currentStream.active)for(let r of this.currentStream.getTracks())r.stop();this._currentStream=e}}ready;async start(){if(st){let e=await this.getPreferredAudioOutput();e&&await this.setAudioOutputDevice(e)}}async startPreferredAudioInput(){let e=await this.getPreferredAudioInput();e&&(await this.setAudioInputDevice(e),this.currentStream=await this.startStream())}async startPreferredVideoInput(){let e=await this.getPreferredVideoInput();e&&(await this.setVideoInputDevice(e),this.currentStream=await this.startStream())}get preferredAudioOutputID(){return st?localStorage.getItem(om):null}get preferredAudioInputID(){return localStorage.getItem(sm)}get preferredVideoInputID(){return localStorage.getItem(am)}async getAudioOutputDevices(e=!1){if(!st)return[];let r=await this.getAvailableDevices(e);return r&&r.audioOutput||[]}async getAudioInputDevices(e=!1){let r=await this.getAvailableDevices(e);return r&&r.audioInput||[]}async getVideoInputDevices(e=!1){let r=await this.getAvailableDevices(e);return r&&r.videoInput||[]}async getAudioOutputDevice(){if(!st)return null;let e=this.element&&this.element.sinkId;if(O(e))return null;let r=await this.getAudioOutputDevices();return $e(r,o=>o.deviceId===e)}async getAudioInputDevice(){if(O(this.currentStream)||!this.currentStream.active)return null;let e=this.currentStream.getAudioTracks();if(e.length===0)return null;let r=e[0],i=await this.getAudioInputDevices();return $e(i,s=>r.label===s.label)}async getVideoInputDevice(){if(O(this.currentStream)||!this.currentStream.active)return null;let e=this.currentStream.getVideoTracks();if(e.length===0)return null;let r=e[0],i=await this.getVideoInputDevices();return $e(i,s=>r.label===s.label)}async getPreferredAudioOutput(){if(!st)return null;let e=await this.getAudioOutputDevices();return $e(e,i=>i.deviceId===this.preferredAudioOutputID,i=>i.deviceId==="default",i=>i.deviceId.length>0)}async getPreferredAudioInput(){let e=await this.getAudioInputDevices();return $e(e,i=>i.deviceId===this.preferredAudioInputID,i=>i.deviceId==="default",i=>i.deviceId.length>0)}async getPreferredVideoInput(){let e=await this.getVideoInputDevices();return $e(e,i=>i.deviceId===this.preferredVideoInputID,i=>this.needsVideoDevice&&i.deviceId.length>0)}async setAudioOutputDevice(e){if(st){if(g(e)&&e.kind!=="audiooutput")throw new Error(`Device is not an audio output device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(om,e&&e.deviceId||null);let r=this.element,i=r&&r.sinkId;this.preferredAudioOutputID!==i&&(g(this.preferredAudioOutputID)&&await this.element.setSinkId(this.preferredAudioOutputID),this.dispatchEvent(new xc(e)))}}async setAudioInputDevice(e){if(g(e)&&e.kind!=="audioinput")throw new Error(`Device is not an audio input device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(sm,e&&e.deviceId||null);let r=await this.getAudioInputDevice(),i=r&&r.deviceId;this.preferredAudioInputID!==i&&this.dispatchEvent(new gc(e))}async setVideoInputDevice(e){if(g(e)&&e.kind!=="videoinput")throw new Error(`Device is not an video input device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(am,e&&e.deviceId||null);let r=await this.getVideoInputDevice(),i=r&&r.deviceId;this.preferredVideoInputID!==i&&this.dispatchEvent(new vc(e))}async getAvailableDevices(e=!1){let r=await this.getDevices();return e&&(r=fv(r)),{audioOutput:st?r.filter(i=>i.kind==="audiooutput"):[],audioInput:r.filter(i=>i.kind==="audioinput"),videoInput:r.filter(i=>i.kind==="videoinput")}}async getDevices(){let e=null,r=null;for(let i=0;i<3;++i){e=await navigator.mediaDevices.enumerateDevices();for(let o of e)o.deviceId.length>0&&(this.hasAudioPermission||(this._hasAudioPermission=o.kind==="audioinput"&&o.label.length>0),this.needsVideoDevice&&!this.hasVideoPermission&&(this._hasVideoPermission=o.kind==="videoinput"&&o.label.length>0));if(this.hasAudioPermission&&(!this.needsVideoDevice||this.hasVideoPermission))break;try{(!this.hasAudioPermission||this.needsVideoDevice&&!this.hasVideoPermission)&&(r=await this.startStream())}catch(o){console.warn(o)}}if(r)for(let i of r.getTracks())i.stop();return e=bd(e||[],i=>i.label),e}startStream(){return navigator.mediaDevices.getUserMedia({audio:this.preferredAudioInputID&&{deviceId:this.preferredAudioInputID}||!0,video:this.needsVideoDevice&&(this.preferredVideoInputID&&{deviceId:this.preferredVideoInputID}||!0)||!1})}async getMediaPermissions(){return await this.getDevices(),{audio:this.hasAudioPermission,video:this.hasVideoPermission}}};function*xv(n,t,e=-1){let r=0;for(;e<0||r<e;){yield n,++r;let i=n+t;n=t,t=i}}function lm(n,t,e){return new _c(n,t,3,e)}var Ac=class{constructor(t,e,r,i,o){this.input=He(`${t}-input`,e,{gain:r},this.output=tm(`${t}-delay`,e,{maxDelayTime:i,delayTime:i},o))}dispose(){ie(this.input),ie(this.output)}},_c=class{constructor(t,e,r,i){this.output=He(`${t}-output`,e,null,i);let o=Array.from(xv(1,2,r));this.layers=o.map(s=>new Ac(`${t}-echo-layer-${s}`,e,.5/s,s,this.output)),this.input=He(`${t}-input`,e,null,...this.layers)}dispose(){ie(this.input);for(let t of this.layers)t.dispose();ie(this.output),pe(this.layers)}};function cm(n,t,e){return new bc(n,t,e)}var bc=class{constructor(t,e,r){this.node=Jr(`${t}-biquad-filter`,e,{type:"bandpass",frequency:2500,Q:4.5},r)}dispose(){ie(this.node)}};function pm(n,t,e){return new Ec(n,t,e)}var Ec=class{constructor(t,e,r){this.node=Jr(`${t}-biquad-filter`,e,{type:"bandpass",frequency:400,Q:4.5},r)}dispose(){ie(this.node)}};var dm=new Map([["Radio",cm],["Wall",pm],["Echo",lm]]);var yc=class extends j{constructor(e){super("sourceadded");this.source=e}},Dt=class extends $r{constructor(e,r,i,...o){super(e,r,i);this.source=null;this.effects=new Array;this._connected=!1;this.setEffects(...o)}onDisposing(){for(let e of this.effects)Nr(e)&&e.dispose();pe(this.effects),super.onDisposing()}setEffects(...e){kt(this.volumeControl);for(let r of this.effects)Nr(r)&&r.dispose();pe(this.effects);for(let r of e)if(g(r)){let i=dm.get(r);g(i)&&this.effects.push(i(`${r}-${this.id}`,this.audioCtx))}Zu(this.volumeControl,...this.effects,this.spatializer)}get spatialized(){return!(this.spatializer instanceof Ge)}get input(){return this.source}get connected(){return this._connected}connect(){this.connected||yt(this.source,this.volumeControl)}disconnect(){this.connected&&kt(this.source,this.volumeControl)}set input(e){e!==this.input&&(this.source&&ie(this.source),e&&(this.source=e,this.connect(),this.dispatchEvent(new yc(this.source))))}get output(){return this.volumeControl}};var Ot=class extends j{constructor(e,r){super(e);this.source=r}},Tn=class extends Ot{constructor(t){super("loaded",t)}},Vs=class extends Ot{constructor(e,r){super("errored",e);this.error=r}},Mn=class extends Ot{constructor(t){super("played",t)}},Sn=class extends Ot{constructor(t){super("paused",t)}},Rn=class extends Ot{constructor(t){super("stopped",t)}},Pn=class extends Ot{constructor(e){super("progress",e);this.value=0;this.total=0}};var Ls=new WeakMap,ks=new WeakMap;function um(n,t){let e=(ks.get(n)||0)+t;ks.set(n,e);let r=n.mediaElement,i=(Ls.get(r)||0)+t;return Ls.set(r,i),i}function gv(n){um(n,1)}function vv(n){um(n,-1),ks.get(n)===0&&(ks.delete(n),ie(n)),Ls.get(n.mediaElement)===0&&(Ls.delete(n.mediaElement),n.mediaElement.isConnected&&n.mediaElement.remove())}var Ds=class extends Dt{constructor(e,r,i,o,s,...a){super(e,r,s,...a);this.randomize=o;gv(this.input=i),this.audio=i.mediaElement,this.disconnect(),this.loadEvt=new Tn(this),this.playEvt=new Mn(this),this.pauseEvt=new Sn(this),this.stopEvt=new Rn(this),this.progEvt=new Pn(this);let p=d=>{this.disconnect(),this.audio.currentTime===0||d.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};this.audio.addEventListener("ended",p),this.audio.addEventListener("pause",p),this.audio.addEventListener("play",()=>{if(this.connect(),this.randomize&&this.audio.loop&&this.audio.duration>1){let d=this.audio.duration*Math.random();this.audio.currentTime=d}this.dispatchEvent(this.playEvt)}),this.audio.addEventListener("timeupdate",()=>{this.progEvt.value=this.audio.currentTime,this.progEvt.total=this.audio.duration,this.dispatchEvent(this.progEvt)}),vs(this.audio).then(d=>this.dispatchEvent(d?this.loadEvt:new Vs(this,this.audio.error)))}get playbackState(){return this.audio.error?"errored":this.audio.ended||this.audio.paused&&this.audio.currentTime===0?"stopped":this.audio.paused?"paused":"playing"}async play(){await Yr(this.audioCtx),await this.audio.play()}async playThrough(){let e=le(this,"stopped");await this.play(),await e}pause(){this.audio.pause()}stop(){this.audio.currentTime=0,this.pause()}restart(){return this.stop(),this.play()}onDisposing(){this.disconnect(),vv(this.input),super.onDisposing()}};var Os=class extends Dt{constructor(t,e,r,...i){super(t,e,r,...i)}};var ni=class extends ei{constructor(e,r){super(e);this.lpx=0;this.lpy=0;this.lpz=0;this.lox=0;this.loy=0;this.loz=0;this.input=this.output=this.panner=im(this.id,r,{panningModel:"HRTF",distanceModel:"inverse",coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:0})}setAudioProperties(e,r,i){super.setAudioProperties(e,r,i),this.panner.refDistance=this.minDistance,this.panner.distanceModel=i,this.maxDistance<=0?this.panner.rolloffFactor=1/0:this.panner.rolloffFactor=1/this.maxDistance}setPose(e,r){let{p:i,f:o}=e,[s,a,p]=i,[d,h,x]=o;(s!==this.lpx||a!==this.lpy||p!==this.lpz)&&(this.lpx=s,this.lpy=a,this.lpz=p,this.setPosition(s,a,p,r)),(d!==this.lox||h!==this.loy||x!==this.loz)&&(this.lox=d,this.loy=h,this.loz=x,this.setOrientation(d,h,x,r))}};var Bs=class extends ni{constructor(t,e){super(t,e),Object.seal(this)}setPosition(t,e,r,i){this.panner.positionX.setValueAtTime(t,i),this.panner.positionY.setValueAtTime(e,i),this.panner.positionZ.setValueAtTime(r,i)}setOrientation(t,e,r,i){this.panner.orientationX.setValueAtTime(-t,i),this.panner.orientationY.setValueAtTime(-e,i),this.panner.orientationZ.setValueAtTime(-r,i)}};var Fs=class extends ni{constructor(t,e){super(t,e),Object.seal(this)}setPosition(t,e,r,i){this.panner.setPosition(t,e,r)}setOrientation(t,e,r,i){this.panner.setOrientation(t,e,r)}};!("AudioContext"in globalThis)&&"webkitAudioContext"in globalThis&&(globalThis.AudioContext=globalThis.webkitAudioContext);!("OfflineAudioContext"in globalThis)&&"webkitOfflineAudioContext"in globalThis&&(globalThis.OfflineAudioContext=globalThis.webkitOfflineAudioContext);var mm="juniper::useHeadphones",Av=new j("useheadphonestoggled"),_v="createMediaStreamSource"in AudioContext.prototype,hm=!_v,Hs=class extends Z{sortedUserIDs=new Array;users=new Map;clips=new Map;clipPaths=new Map;pathSources=new Map;pathCounts=new Map;localFilter;localCompressor;_minDistance=1;_maxDistance=10;_offsetRadius=0;_useHeadphones=!1;_algorithm="inverse";get algorithm(){return this._algorithm}element=null;audioDestination=null;devices;input;localAutoControlledGain;output;audioCtx;ready;localUserID=null;constructor(t){super(),this.audioCtx=new AudioContext;let e=null;st?(e=hc("final-destination",this.audioCtx),this.element=rr(Qn("Audio-Device-Manager"),Yt(!0),Kt(!0),tc(e.stream),ot(Ue("none"))),me(document.body,this)):e=this.audioCtx.destination,this.devices=new Cs(this.element),this.input=He("local-mic-user-gain",this.audioCtx,null,this.localAutoControlledGain=He("local-mic-auto-gain",this.audioCtx,null,this.localFilter=Jr("local-mic-filter",this.audioCtx,{type:"bandpass",frequency:1500,Q:.25},this.localCompressor=nm("local-mic-compressor",this.audioCtx,{threshold:-15,knee:40,ratio:17},this.output=hc("local-mic-destination",this.audioCtx))))),this.audioDestination=new Rs(this.audioCtx,e,io?new Ps(this.audioCtx):new Is(this.audioCtx)),Ge.instance(this.audioCtx).setAudioProperties(this._minDistance,this._maxDistance,this.algorithm),this.setLocalUserID(t);let r=localStorage.getItem(mm);g(r)?this._useHeadphones=r==="true":this._useHeadphones=It(),this.ready=this.start(),Object.seal(this)}get useHeadphones(){return this._useHeadphones}set useHeadphones(t){t!==this.useHeadphones&&(this._useHeadphones=t,localStorage.setItem(mm,this.useHeadphones.toString()),this.dispatchEvent(Av))}dispose(){for(let t of this.sortedUserIDs)this.removeUser(t);for(let t of this.clips.keys())this.removeClip(t);kt(this.input),kt(this.localAutoControlledGain),kt(this.localFilter),kt(this.localCompressor),kt(this.output),this.audioDestination.dispose(),this.audioCtx.suspend()}async start(){await Yr(this.audioCtx),this.element&&await this.element.play(),await this.devices.ready}get offsetRadius(){return this._offsetRadius}set offsetRadius(t){this._offsetRadius=t,this.updateUserOffsets()}get filter(){return this.localFilter}get filterFrequency(){return this.localFilter.frequency.value}set filterFrequency(t){this.localFilter.frequency.value=t}get compressor(){return this.localCompressor}get isReady(){return this.audioCtx.state==="running"}get currentTime(){return this.audioCtx.currentTime}update(){let t=this.currentTime;this.audioDestination.audioTick(t);for(let e of this.clips.values())e.audioTick(t);for(let e of this.users.values())e.audioTick(t)}counter=0;newSpatializer(t,e,r){if(e){let i=r?this.audioDestination.remoteUserInput:this.audioDestination.spatializedInput,o=`spatializer-${++this.counter}-${t}`,s=io?new Bs(o+"-new-wa",this.audioCtx):new Fs(t+"-old-wa",this.audioCtx);return yt(s,i),s}else return Ge.instance(this.audioCtx)}createSpatializer(t,e,r){let i=this.newSpatializer(t,e,r);return i.setAudioProperties(this._minDistance,this._maxDistance,this._algorithm),i}createUser(t,e){if(!this.users.has(t)){let r=qn(e,t),i=this.createSpatializer(r,!0,!0),o=new Os(r,this.audioCtx,i);this.users.set(t,o),Ni(this.sortedUserIDs,t),this.updateUserOffsets()}return this.users.get(t)}setLocalUserID(t){return this.audioDestination&&(Ke(this.sortedUserIDs,this.localUserID),this.localUserID=t,Ni(this.sortedUserIDs,this.localUserID),this.updateUserOffsets()),this.audioDestination}loadBasicClip(t,e,r,i){return this.loadClip(t,e,!1,!1,!1,!1,r,[],i)}createBasicClip(t,e,r){return this.createClip(t,e,!1,!1,!1,r,[])}async loadClip(t,e,r,i,o,s,a,p,d){if(O(e)||q(e)&&e.length===0)throw new Error("No clip source path provided");g(d)&&d.start(e);let h=await this.getSourceTask(t,e,e,r,i,d),x=this.makeClip(h,t,e,o,s,i,a,...p);return this.clips.set(t,x),g(d)&&d.end(e),x}createClip(t,e,r,i,o,s,a){if(O(e)||q(e)&&e.length===0)throw new Error("No clip source path provided");let p=e.currentSrc,d=this.createSourceFromElement(t,e),h=this.makeClip(d,t,p,i,o,r,s,...a);return this.clips.set(t,h),h}getSourceTask(t,e,r,i,o,s){this.clipPaths.set(t,e);let a=this.pathSources.get(e);return g(a)?this.pathCounts.set(e,this.pathCounts.get(e)+1):(a=this.createSourceFromFile(t,r,i,o,s),this.pathSources.set(e,a),this.pathCounts.set(e,1)),a}async createSourceFromFile(t,e,r,i,o){g(o)&&o.start(t);let s=to(i,!1,r,$i(e));if(!await vs(s))throw s.error;return g(o)&&o.end(t),this.createSourceFromElement(t,s)}createSourceFromStream(t,e){let r=to(!0,!hm,!1,tc(e));return hm?this.createSourceFromElement(t,r):rm(qn("media-stream-source",t,e.id),this.audioCtx,e)}createSourceFromElement(t,e){return sr(qn("media-element-source",t),this.audioCtx,e)}makeClip(t,e,r,i,o,s,a,...p){let d=qn(e,r),h=this.createSpatializer(d,i,!1),x=new Ds(qn("audio-clip-element",d),this.audioCtx,t,o,h,...p);return s&&x.play(),x.volume=a,x}hasClip(t){return this.clips.has(t)}async playClip(t){this.isReady&&this.hasClip(t)&&await this.clips.get(t).play()}async playClipThrough(t){this.isReady&&this.hasClip(t)&&await this.clips.get(t).playThrough()}stopClip(t){this.isReady&&this.hasClip(t)&&this.clips.get(t).stop()}getUser(t){return this.users.get(t)}getClip(t){return this.clips.get(t)}removeSource(t,e){let r=t.get(e);return g(r)&&(t.delete(e),r.dispose()),r}removeUser(t){let e=this.removeSource(this.users,t);g(e.input)&&(e.input=null),Ke(this.sortedUserIDs,t),this.updateUserOffsets()}removeClip(t){let e=this.clipPaths.get(t);return this.pathCounts.set(e,this.pathCounts.get(e)-1),this.pathCounts.get(e)===0&&(this.pathCounts.delete(e),this.pathSources.delete(e)),this.removeSource(this.clips,t)}setUserStream(t,e,r){if(this.users.has(t)){let i=this.users.get(t);r?i.input=this.createSourceFromStream(qn(e,t),r):g(i.input)&&(i.input=null)}}updateUserOffsets(){if(this.offsetRadius>0){let t=this.sortedUserIDs.indexOf(this.localUserID),e=2*Math.PI/this.sortedUserIDs.length,r=(t+1)*e,i=this.offsetRadius*Math.sin(r),o=this.offsetRadius*(Math.cos(r)-1);for(let s=0;s<this.sortedUserIDs.length;++s){let a=this.sortedUserIDs[s],p=(s+1)*e,d=this.offsetRadius*Math.sin(p)-i,h=this.offsetRadius*(Math.cos(p)-1)-o;this.setUserOffset(a,d,0,h)}}}setAudioProperties(t,e,r){this._minDistance=t,this._maxDistance=e,this._algorithm=r,Ge.instance(this.audioCtx).setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let i of this.users.values())i.spatializer.setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let i of this.clips.values())i.spatializer.setAudioProperties(i.spatializer.minDistance,i.spatializer.maxDistance,this.algorithm)}withPose(t,e,r){let i=t.get(e),o=null;return i?o=i.pose:e===this.localUserID&&(o=this.audioDestination.pose),o?r(o):null}withUser(t,e){return this.withPose(this.users,t,e)}setUserOffset(t,e,r,i){this.withUser(t,o=>{o.setOffset(e,r,i)})}getUserOffset(t){return this.withUser(t,e=>e.o)}setUserPose(t,e,r,i,o,s,a,p,d,h){this.withUser(t,x=>{x.set(e,r,i,o,s,a,p,d,h)})}withClip(t,e){return this.withPose(this.clips,t,e)}setClipPosition(t,e,r,i){this.withClip(t,o=>{o.setPosition(e,r,i)})}setClipOrientation(t,e,r,i,o,s,a){this.withClip(t,p=>{p.setOrientation(e,r,i,o,s,a)})}setClipPose(t,e,r,i,o,s,a,p,d,h){this.withClip(t,x=>{x.set(e,r,i,o,s,a,p,d,h)})}};var wc=class extends Ot{constructor(t,e){super(t,e)}},ri=class extends wc{constructor(t){super("loading",t)}};var Ns=class extends Dt{loadingEvt;loadEvt;playEvt;pauseEvt;stopEvt;progEvt;onError;onPlay;onCanPlay;onWaiting;onPause;onTimeUpdate;_data=null;get data(){return this._data}_loaded=!1;get loaded(){return this._loaded}element;audioSource;get title(){return this.element.title}setTitle(t){this.element.title=t}sourcesByURL=new Map;sources=new Array;potatoes=new Array;constructor(t){super("JuniperAudioPlayer",t,Ge.instance(t)),this.element=rr(Yt(!0),Kt(!1),Kn(!1),gn(!0)),this.input=sr("JuniperAudioPlayer-Input",t,this.element),this.loadingEvt=new ri(this),this.loadEvt=new Tn(this),this.playEvt=new Mn(this),this.pauseEvt=new Sn(this),this.stopEvt=new Rn(this),this.progEvt=new Pn(this),this.onPlay=async()=>{this.connect(),this.dispatchEvent(this.playEvt)},this.onPause=e=>{this.disconnect(),this.element.currentTime===0||e.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)},this.onTimeUpdate=async()=>{this.progEvt.value=this.element.currentTime,this.progEvt.total=this.element.duration,this.dispatchEvent(this.progEvt)},this.onError=()=>this.loadAudio(),this.element.addEventListener("play",this.onPlay),this.element.addEventListener("pause",this.onPause),this.element.addEventListener("ended",this.onPause),this.element.addEventListener("error",this.onError),this.element.addEventListener("waiting",this.onWaiting),this.element.addEventListener("canplay",this.onCanPlay),this.element.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{audioPlayer:this})}get hasAudio(){let t=this.sourcesByURL.get(this.element.src);return g(t)&&t.acodec!=="none"||g(this.element.audioTracks)&&this.element.audioTracks.length>0||g(this.element.webkitAudioDecodedByteCount)&&this.element.webkitAudioDecodedByteCount>0||g(this.element.mozHasAudio)&&this.element.mozHasAudio}onDisposing(){super.onDisposing(),this.clear(),ie(this.input),ie(this.audioSource),this.element.removeEventListener("play",this.onPlay),this.element.removeEventListener("pause",this.onPause),this.element.removeEventListener("ended",this.onPause),this.element.removeEventListener("error",this.onError),this.element.removeEventListener("waiting",this.onWaiting),this.element.removeEventListener("canplay",this.onCanPlay),this.element.removeEventListener("timeupdate",this.onTimeUpdate)}clear(){this.stop(),this.sourcesByURL.clear(),pe(this.sources),pe(this.potatoes),this.element.src="",this._data=null,this._loaded=!1}async load(t,e){this.clear(),this._data=t,q(t)?(this.setTitle(t),this.potatoes.push(t)):(this.setTitle(t.title),Wn(t.audios,r=>-r.resolution),_d(this.sources,...t.audios));for(let r of this.sources)this.sourcesByURL.set(r.url,r);if(!this.hasSources)throw new Error("No audio sources");if(this.dispatchEvent(this.loadingEvt),await this.loadAudio(e),!this.hasSources)throw new Error("No audio sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}async getMediaCapabilities(t){let e={type:"file",audio:{contentType:t.contentType,bitrate:t.abr*1024,samplerate:t.asr}};try{return await navigator.mediaCapabilities.decodingInfo(e)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:e}}}get hasSources(){return this.sources.length>0||this.potatoes.length>0}async loadAudio(t){for(g(t)&&t.start(),this.element.removeEventListener("error",this.onError);this.hasSources;){let e=null,r=this.sources.shift();if(g(r)){let i=await this.getMediaCapabilities(r);if(!i.smooth||!i.powerEfficient){this.potatoes.push(r.url);continue}else e=r.url}else e=this.potatoes.shift();if(this.element.src=e,this.element.load(),await As(this.element)){g(r)?this.sources.unshift(r):this.potatoes.unshift(e),this.element.addEventListener("error",this.onError),g(t)&&t.end();return}}}get playbackState(){return O(this.data)?"empty":this.loaded?this.element.error?"errored":this.element.ended||this.element.paused&&this.element.currentTime===0?"stopped":this.element.paused?"paused":"playing":"loading"}async play(){await Yr(this.audioCtx),await this.element.play()}async playThrough(){let t=le(this,"stopped");await this.play(),await t}pause(){this.element.pause()}stop(){this.pause(),this.element.currentTime=0}restart(){return this.stop(),this.play()}};var fm="local-user";async function bv(n,t,e,r,i){let{content:o}=await n.get(r).progress(i.pop()).image();return[t,e,o]}var Xs=class{constructor(t,e,r){this.fetcher=t;this.imagePaths=e;this.padding=r;this.uvDescrips=new ze;this.geoms=new ze;this.canvas=null;this.texture=null;this.enabledMaterial=null;this.disabledMaterial=null;this.readyTask=new Ce}async load(t){let e=ls(t),r=new ze(await Promise.all(Array.from(this.imagePaths.entries()).map(([H,C,D])=>bv(this.fetcher,H,C,D,e)))),i=Array.from(r.values()),o=Math.max(...i.map(H=>H.width)),s=Math.max(...i.map(H=>H.height)),a=o*s*i.length,p=Math.sqrt(a),d=Math.floor(p/o),h=Math.ceil(i.length/d),x=d*o,A=h*s,E=Xl(x),S=Xl(A),P=x/E,R=A/S,V=o/E,B=s/S;this.canvas=ws(E,S);let L=this.canvas.getContext("2d");L.fillStyle="#1e4388",L.fillRect(0,0,E,S);let k=0;for(let[H,C,D]of r.entries()){let $=k%d,W=(k-$)/d,z=P*($*o/x),K=R*(1-W/h)-B,be=$*o,ge=W*s+S-A,ne=o-2*this.padding,Qe=s-2*this.padding;L.drawImage(D,0,0,D.width,D.height,be+this.padding,ge+this.padding,ne,Qe),this.uvDescrips.add(H,C,{u:z,v:K,du:V,dv:B}),++k}this.texture=new THREE.CanvasTexture(this.canvas),this.enabledMaterial=new THREE.MeshBasicMaterial({map:this.texture}),this.enabledMaterial.needsUpdate=!0,this.disabledMaterial=new THREE.MeshBasicMaterial({map:this.texture,transparent:!0,opacity:.5}),this.disabledMaterial.needsUpdate=!0,this.readyTask.resolve()}getSets(){return Array.from(this.imagePaths.keys())}getIcons(t){if(!this.imagePaths.has(t))throw new vt(`Button set ${t} does not exist`);return Array.from(this.imagePaths.get(t).keys())}async getMaterial(t){return await this.readyTask,t?this.enabledMaterial:this.disabledMaterial}async getGeometry(t,e){await this.readyTask;let r=this.uvDescrips.get(t),i=r&&r.get(e);if(!r||!i)throw new vt(`Button ${t}/${e} does not exist`,this.uvDescrips);let o=this.geoms.get(t,e);if(!o){o=new THREE.PlaneBufferGeometry(1,1,1,1),o.name=`Geometry:${t}/${e}`,this.geoms.add(t,e,o);let s=o.getAttribute("uv");for(let a=0;a<s.count;++a){let p=s.getX(a)*i.du+i.u,d=s.getY(a)*i.dv+i.v;s.setX(a,p),s.setY(a,d)}}return o}async getMesh(t,e,r){let i=await this.getGeometry(t,e),o=new THREE.Mesh(i,r?this.enabledMaterial:this.disabledMaterial);return o.name=`Mesh:${t}/${e}`,o}async getGeometryAndMaterials(t,e){let[r,i,o]=await Promise.all([this.getGeometry(t,e),this.getMaterial(!0),this.getMaterial(!1)]);return{geometry:r,enabledMaterial:i,disabledMaterial:o}}getImageSrc(t,e){let r=this.imagePaths.get(t),i=r&&r.get(e);if(!r||!i)throw new vt(`Button ${t}/${e} does not exist`,this.uvDescrips);return i}getImageElement(t,e){return ir(zr(t+" "+e),$i(this.getImageSrc(t,e)))}};var js=class{animations=new Array;update(t){t=.001*t;for(let e of this.animations)e(t)}clear(){pe(this.animations)}start(t,e,r){let i=-t;r(0);let o=new Ce;return this.animations.push(s=>{i+=s/e,i>=1?(r(1),o.resolve()):i>=0&&r(i)}),o}};function xm(n,t){let e=n*Math.PI;return .5*(1-Math.cos(e))-t*Math.sin(2*e)}function gm(n,t){let e=(n-.5)*Math.PI;return n*n+t*Math.cos(e)}Lt(ee(".dialog, .dialog-container",Gr("fixed")),ee(".dialog",er(0),$n(0),Et("100%"),Jt("100%"),Zi("rgba(0, 0, 0, 0.5)"),xu(100)),ee(".dialog-container",er("50%"),$n("50%"),eo("100%"),pu("100%"),fu("translateX(-50%) translateY(-50%)"),Zi("white"),iu("rgba(0,0,0,0.5) 0px 5px 30px"),Ue("grid"),vn("2em auto 2em"),xs("auto 1fr auto 2em")),ee(".dialog .title-bar",ms(1,1,2,-1),_n("0.25em")),ee(".dialog-content",ms(2,2,-4,-2),uu("auto")),ee(".dialog-controls",ms(-2,2,-3,-2)),ee(".dialog .confirm-button",au("right")),ee(".dialog h1, .dialog h2, .dialog h3, .dialog h4, .dialog h5, .dialog h6",Zn("left")),ee(".dialog select",eo("10em")));var ii=class{element;subEventer=new Z;_title;titleElement;container;contentArea;confirmButton;cancelButton;constructor(t){this.element=he(Ee("dialog"),Zd("dialogname",t),ot(Ue("none")),this.container=he(Ee("dialog-container"),this.titleElement=Tu(Ee("title-bar"),t),this.contentArea=he(Ee("dialog-content")),he(Ee("dialog-controls"),this.confirmButton=qr("Confirm",jr("confirm-button")),this.cancelButton=_s("Cancel",jr("cancel-button"))))),this.confirmButton.addEventListener("click",()=>this.subEventer.dispatchEvent(new j("confirm"))),this.cancelButton.addEventListener("click",()=>this.subEventer.dispatchEvent(new j("cancel"))),me(document.body,this)}get title(){return this._title}set title(t){Wr(this.titleElement,this._title=t)}async onShowing(){}onShown(){}async onConfirm(){}onCancel(){}async onClosing(){}onClosed(){}show(t){Re(this,t)}get isOpen(){return Vt(this)}async showDialog(){await this.onShowing(),this.show(!0),this.onShown();let t=le(this.subEventer,"confirm","cancel"),e=await At(t);return e?await this.onConfirm():this.onCancel(),await this.onClosing(),this.show(!1),this.onClosed(),e}};function ar(n){return g(n)&&n.isMesh}function Ev(n){return g(n)&&n.isMaterial}function vm(n){return Ev(n)&&n.type==="MeshBasicMaterial"}function oo(n){return g(n)&&n.isObject3D}function Am(n){return g(n)&&n.isQuaternion}function _m(n){return g(n)&&n.isEuler}function bm(n){return g(n)&&oo(n.object)}function wt(n){return bm(n)?n.object:n}function Ve(n,t){return n=wt(n),n.visible=t,t}function oi(n){return n=wt(n),n.visible}function Em(n){for(n=wt(n);n;){if(!n.visible)return!1;n=n.parent}return!0}function Le(n,...t){let e=t.filter(g).map(wt);return e.length>0&&wt(n).add(...e),n}function Tt(n,...t){let e=new THREE.Object3D;return e.name=n,Le(e,...t),e}function zs(n,t){n=wt(n),gs(n)&&(n.disabled=!t)}var Us=_t("Juniper:ScaledItems",()=>new Map),ym=1,yv=1.1,wv=.005,Tc=class{constructor(t){this.obj=t;this.base=t.scale.clone(),this.p=0,this.dir=0,this.running=!1,this.wasDisabled=this.disabled,this.onEnter=()=>this.run(1),this.onExit=()=>this.run(-1),this.obj.addEventListener("enter",this.onEnter),this.obj.addEventListener("exit",this.onExit)}get enabled(){return!this.obj.disabled}get disabled(){return!this.enabled}run(t){(this.enabled||t===-1||this.p>0)&&(this.dir=t,this.running=!0)}updateScaling(t){if(this.disabled!==this.wasDisabled&&(this.wasDisabled=this.disabled,this.disabled&&this.onExit()),this.running){this.p+=this.dir*t,(this.dir>0&&this.p>=1||this.dir<0&&this.p<0)&&(this.p=Math.max(0,Math.min(1,this.p)),this.running=!1);let e=xm(this.p,1.1);this.obj.scale.copy(this.base).multiplyScalar(e*(yv-ym)+ym)}}dispose(){this.obj.removeEventListener("enter",this.onEnter),this.obj.removeEventListener("exit",this.onExit)}};function wm(n){n*=wv;for(let t of Us.values())t.updateScaling(n)}function Tm(n){let t=Us.get(n);t&&(Us.delete(n),t.dispose())}function Gs(n){Us.set(n,new Tc(n))}THREE.UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new THREE.Vector2(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};THREE.ShaderLib.line={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var Zt=class extends THREE.ShaderMaterial{constructor(t){super({type:"LineMaterial",uniforms:THREE.UniformsUtils.clone(THREE.ShaderLib.line.uniforms),vertexShader:THREE.ShaderLib.line.vertexShader,fragmentShader:THREE.ShaderLib.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(t)}};Zt.prototype.isLineMaterial=!0;var Mc=_t("Juniper:Three:Materials",()=>new Map);function Tv(n,t){t in n&&delete n[t]}function Ws(n,t,e){let r=`${n}_${Object.keys(e).map(i=>`${i}:${e[i]}`).join(",")}`;return Mc.has(r)||(Tv(e,"name"),Mc.set(r,new t(e))),Mc.get(r)}function Mv(n){return Object.assign(n,{transparent:!0})}function Mm(n){return Ws("solid",THREE.MeshBasicMaterial,n)}function lr(n){return Ws("solidTransparent",THREE.MeshBasicMaterial,Mv(n))}function Sm(n){return Ws("lit",THREE.MeshStandardMaterial,n)}function Rm(n){return Ws("line2",Zt,n)}var Sv=0;var Rv=12632256,Sc=16777215;function so(n){return lr({color:Sv,opacity:n})}var Pm=Sm({color:Rv}),Im=Sm({color:Sc});var Qs=new THREE.PlaneBufferGeometry(1,1,1,1);Qs.name="PlaneGeom";var Rc=class extends THREE.Mesh{constructor(e,r,i,o){super(Qs,i);this.isCollider=o;this.scale.set(e,r,1)}};var qs=class extends Rc{constructor(t,e){super(t,e,so(0),!0),this.visible=!1}};function In(n){let t=new Array,e=new Set;for(t.push(n);t.length>0;){let r=t.shift();r&&!e.has(r)&&(e.add(r),r.isMesh&&t.push(r.material,r.geometry),r.isMaterial&&t.push(...Object.values(r)),r.isObject3D&&(t.push(...r.children),r.clear(),Tm(r)),Be(r)&&t.push(...r),Xr(r))}e.clear()}var Pv=new THREE.Matrix4,Ks=new THREE.Vector3;function Pc(n,t,e,r,i){Pv.copy(n.matrixWorld).invert().multiply(t.matrixWorld).decompose(Ks,r,i),e.set(Ks.x,Ks.y,Ks.z,1)}var Cm=39.3701,si=class extends THREE.Mesh{constructor(e,r){super(e,r);this._imageWidth=0;this._imageHeight=0}copy(e,r=!0){return super.copy(e,r),this._imageWidth=e.imageWidth,this._imageHeight=e.imageHeight,this}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get imageAspectRatio(){return this.imageWidth/this.imageHeight}get objectWidth(){return this.scale.x}set objectWidth(e){this.scale.x=e,this.scale.y=e/this.imageAspectRatio}get objectHeight(){return this.scale.y}set objectHeight(e){this.scale.x=this.imageAspectRatio*e,this.scale.y=e}get pixelDensity(){return this.imageWidth/this.objectWidth/Cm}set pixelDensity(e){let r=e*Cm;this.objectWidth=this.imageWidth/r}setImage(e){return Bu(e)&&(e=Fu(e)),Ou(e)&&(e=e),e instanceof HTMLVideoElement?(this.material.map=new THREE.VideoTexture(e),this._imageWidth=e.videoWidth,this._imageHeight=e.videoHeight):(this.material.map=new THREE.Texture(e),this._imageWidth=e.width,this._imageHeight=e.height,this.material.map.needsUpdate=!0),this.material.needsUpdate=!0,this.material.map}async loadImage(e,r,i){let{content:o}=await e.get(r).progress(i).image(),s=this.setImage(o);s.name=r}updateTexture(){let e=this.material.map.image;ae(e.width)&&ae(e.height)&&(this.imageWidth!==e.width||this.imageHeight!==e.height)&&(this._imageWidth=e.width,this._imageHeight=e.height,this.material.map.dispose(),this.material.map=new THREE.Texture(e),this.material.needsUpdate=!0),this.material.map.needsUpdate=!0}};var Ys=new THREE.Vector4,Js=new THREE.Quaternion,ai=new THREE.Vector3,Iv=0,Bt=class extends THREE.Object3D{constructor(e,r,i,o=null){super();this.isStatic=i;this.lastMatrixWorld=new THREE.Matrix4;this.layer=null;this.tryWebXRLayers=!0;this.wasUsingLayer=!1;this.lastImage=null;this.lastWidth=null;this.lastHeight=null;this.stereoLayoutName="mono";this.env=null;this.mesh=null;this.webXRLayersEnabled=!0;if(e){this.setEnvAndName(e,r);let s=vm(o)?o:lr(Object.assign({},o,{name:this.name}));this.mesh=new si(Qs,s),this.add(this.mesh)}}dispose(){In(this.layer)}setEnvAndName(e,r){this.env=e,this.name=r,this.tryWebXRLayers&&=this.env&&this.env.hasXRCompositionLayers}copy(e,r=!0){super.copy(e,r),this.setEnvAndName(e.env,e.name+ ++Iv);for(let i=this.children.length-1;i>=0;--i){let o=this.children[i];o.parent instanceof Bt&&o instanceof si&&(o.removeFromParent(),this.mesh=new si(o.geometry,o.material))}return O(this.mesh)&&(this.mesh=e.mesh.clone(),this.add(this.mesh)),this}get needsLayer(){if(!Em(this)||O(this.mesh.material.map)||O(this.mesh.material.map.image))return!1;let e=this.mesh.material.map.image;return e instanceof HTMLVideoElement?!e.paused||e.currentTime>0:!0}removeWebXRLayer(){if(g(this.layer)){this.wasUsingLayer=!1,this.env.removeWebXRLayer(this.layer);let e=this.layer;this.layer=null,setTimeout(()=>{e.destroy(),this.mesh.visible=!0},100)}}update(e,r){if(this.mesh.material.map&&this.mesh.material.map.image){let i=this.mesh.material.map instanceof THREE.VideoTexture,s=this.tryWebXRLayers&&this.webXRLayersEnabled&&g(r)&&(i&&g(this.env.xrMediaBinding)||!i&&g(this.env.xrBinding))&&this.needsLayer,a=s!==this.wasUsingLayer,p=this.mesh.material.map.image!==this.lastImage||this.mesh.material.needsUpdate||this.mesh.material.map.needsUpdate,d=this.mesh.imageWidth!==this.lastWidth||this.mesh.imageHeight!==this.lastHeight;if(this.wasUsingLayer=s,this.lastImage=this.mesh.material.map.image,this.lastWidth=this.mesh.imageWidth,this.lastHeight=this.mesh.imageHeight,(a||d)&&((!s||d)&&this.layer&&this.removeWebXRLayer(),s)){let h=this.env.referenceSpace;Pc(this.env.stage,this.mesh,Ys,Js,ai),this.lastMatrixWorld.copy(this.matrixWorld);let x=new XRRigidTransform(Ys,Js),A=ai.x/2,E=ai.y/2,S=this.stereoLayoutName==="mono"?"mono":this.stereoLayoutName==="left-right"||this.stereoLayoutName==="right-left"?"stereo-left-right":"stereo-top-bottom";if(i){let P=this.stereoLayoutName==="right-left"||this.stereoLayoutName==="bottom-top";this.layer=this.env.xrMediaBinding.createQuadLayer(this.mesh.material.map.image,{space:h,layout:S,invertStereo:P,transform:x,width:A,height:E})}else this.layer=this.env.xrBinding.createQuadLayer({space:h,layout:S,textureType:"texture",isStatic:this.isStatic,viewPixelWidth:this.mesh.imageWidth,viewPixelHeight:this.mesh.imageHeight,transform:x,width:A,height:E});this.env.addWebXRLayer(this.layer,500),this.mesh.visible=!1}if(this.layer){if(p||this.layer.needsRedraw){let h=this.env.gl,x=this.env.xrBinding.getSubImage(this.layer,r);h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!0),h.bindTexture(h.TEXTURE_2D,x.colorTexture),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.mesh.material.map.image),h.generateMipmap(h.TEXTURE_2D),h.bindTexture(h.TEXTURE_2D,null)}Yo(this.matrixWorld.elements,this.lastMatrixWorld.elements)>=0&&(Pc(this.env.stage,this.mesh,Ys,Js,ai),this.lastMatrixWorld.copy(this.matrixWorld),this.layer.transform=new XRRigidTransform(Ys,Js),this.layer.width=ai.x/2,this.layer.height=ai.y/2)}}}};var Cv={type:"redrawn"},$s=class extends Bt{constructor(e,r,i){super(e,r,!1,i);this._textImage=null;this._onRedrawn=this.onRedrawn.bind(this)}onRedrawn(){this.mesh.updateTexture(),this.scale.set(this._textImage.width,this._textImage.height,.01),this.dispatchEvent(Cv)}get textImage(){return this._textImage}set textImage(e){e!==this.textImage&&(this.textImage&&this.textImage.clearEventListeners(),this._textImage=e,this.textImage&&(this.textImage.addEventListener("redrawn",this._onRedrawn),this.mesh.setImage(this.textImage.canvas),this._onRedrawn()))}createTextImage(e){this.textImage=new yn(e)}get wrapWords(){return this._textImage.wrapWords}set wrapWords(e){this._textImage.wrapWords=e}get minWidth(){return this._textImage.minWidth}set minWidth(e){this._textImage.minWidth=e}get maxWidth(){return this._textImage.maxWidth}set maxWidth(e){this._textImage.maxWidth=e}get minHeight(){return this._textImage.minHeight}set minHeight(e){this._textImage.minHeight=e}get maxHeight(){return this._textImage.maxHeight}set maxHeight(e){this._textImage.maxHeight=e}get textDirection(){return this._textImage.textDirection}set textDirection(e){this._textImage.textDirection=e}get textScale(){return this._textImage.scale}set textScale(e){this._textImage.scale=e}get textWidth(){return this._textImage.width}get textHeight(){return this._textImage.height}get textPadding(){return this._textImage.padding}set textPadding(e){this._textImage.padding=e}get fontStyle(){return this._textImage.fontStyle}set fontStyle(e){this._textImage.fontStyle=e}get fontVariant(){return this._textImage.fontVariant}set fontVariant(e){this._textImage.fontVariant=e}get fontWeight(){return this._textImage.fontWeight}set fontWeight(e){this._textImage.fontWeight=e}get fontSize(){return this._textImage.fontSize}set fontSize(e){this._textImage.fontSize=e}get fontFamily(){return this._textImage.fontFamily}set fontFamily(e){this._textImage.fontFamily=e}get textFillColor(){return this._textImage.textFillColor}set textFillColor(e){this._textImage.textFillColor=e}get textStrokeColor(){return this._textImage.textStrokeColor}set textStrokeColor(e){this._textImage.textStrokeColor=e}get textStrokeSize(){return this._textImage.textStrokeSize}set textStrokeSize(e){this._textImage.textStrokeSize=e}get textBgColor(){return this._textImage.bgFillColor}set textBgColor(e){this._textImage.bgFillColor=e}get value(){return this._textImage.value}set value(e){this._textImage.value=e}};var li=class extends THREE.Object3D{constructor(e,r,i,o,s){super();this.fetcher=e;this.env=r;this._disabled=!1;if(g(o)){this.name=i,s=Object.assign({textFillColor:"#ffffff",fontFamily:"Segoe UI Emoji",fontSize:20,minHeight:.25,maxHeight:.25},s,{value:o}),this.image=new yn(s);let a=bt(16);this.enabledImage=this.createImage(`${a}-enabled`,1),this.disabledImage=this.createImage(`${a}-disabled`,.5),this.disabledImage.visible=!1,this.add(this.enabledImage,this.disabledImage)}}createImage(e,r){let i=new $s(this.env,`text-${e}`,{side:THREE.FrontSide,opacity:r});return i.textImage=this.image,i}get disabled(){return this._disabled}set disabled(e){e!==this.disabled&&(this._disabled=e,this.enabledImage.visible=!e,this.disabledImage.visible=e)}};var ao=class extends li{constructor(e,r,i,o,s){super(e,r,i,o,s);this.collider=null;this.isClickable=!0;g(o)&&(this.image.addEventListener("redrawn",()=>{this.collider.scale.x=this.image.width,this.collider.scale.y=this.image.height}),this.collider=new qs(this.image.width,this.image.height),this.collider.name=`collider-${this.name}`,this.add(this.collider),Gs(this))}};var Vm={bgStrokeColor:"#000000",bgStrokeSize:.04,wrapWords:!1,textFillColor:"#ffffff",scale:150},Lm=Object.assign({},Vm,{padding:{left:.1,right:.1,top:.025,bottom:.025},fontSize:20,minHeight:.5,maxHeight:.5}),Vv=Object.assign({},Lm,{bgFillColor:"#0078d7"}),Lv=Object.assign({},Lm,{bgFillColor:"#780000"}),kv=Object.assign({},Vm,{bgFillColor:"#ffffff",textFillColor:"#000000",padding:{top:.1,left:.1,bottom:.4,right:.1},fontSize:25,minHeight:1,maxHeight:1}),Dv=.9;function Ic(n,t){return Object.assign({},n,{fontFamily:t})}var Zs=class extends ii{constructor(e,r){super("Confirm action");this.env=e;this.object=new THREE.Object3D;this.name="ConfirmationDialog";this.root=new THREE.Object3D;this.animator=new js;this.confirmButton.innerText="Yes",this.cancelButton.innerText="No",this.mesh=new li(this.env.fetcher,this.env,"confirmationDialogLabel","",Ic(kv,r)),this.confirmButton3D=new ao(this.env.fetcher,this.env,"confirmationDialogConfirmButton","Yes",Ic(Vv,r)),this.confirmButton3D.addEventListener("click",()=>this.confirmButton.click()),this.confirmButton3D.position.set(1,-.5,.5),this.cancelButton3D=new ao(this.env.fetcher,this.env,"confirmationDialogCancelButton","No",Ic(Lv,r)),this.cancelButton3D.addEventListener("click",()=>this.cancelButton.click()),this.cancelButton3D.position.set(2,-.5,.5),me(this.container,ot(eo("calc(100% - 2em)"),Et("max-content"))),me(this.contentArea,ot(us("18pt"),Zn("center"),_n("1em"))),Le(this,Le(this.root,this.mesh,this.confirmButton3D,this.cancelButton3D)),Ve(this.root,!1)}get visible(){return Vt(this)}set visible(e){Re(this,e,"inline-block"),this.mesh.visible=e}update(e){this.animator.update(e)}async showHide(e,r){await this.animator.start(0,.25,i=>{let o=gm(e+r*i,Dv);this.root.scale.set(o,o,.01)}),this.animator.clear()}get use3D(){return this.env.renderer.xr.isPresenting||this.env.testSpaceLayout}async onShowing(){await super.onShowing(),this.use3D&&(this.root.visible=!0,await this.showHide(0,1))}onShown(){this.use3D&&(this.element.style.display="none")}async onClosing(){this.use3D&&(await this.showHide(1,-1),this.root.visible=!1),await super.onClosing()}prompt(e,r){return this.title=e,Wr(this.contentArea,r),this.mesh.image.value=r,this.showDialog()}};function Cc(n){for(;n!=null;){if(!n.visible)return!1;n=n.parent}return!0}function cr(n){return oo(n)&&De(n.isCollider)&&g(n.parent)}function lo(n){return g(n)&&cr(n.object)}function Bm(n){return g(n)&&cr(n.object)&&(en(n.object)&&Cc(n.object)||en(n.object.parent)&&Cc(n.object.parent))}function en(n){return oo(n)&&(De(n.disabled)||De(n.isDraggable)||De(n.isClickable))}function km(n){return en(n)&&n.isClickable&&!n.disabled}function pr(n){return lo(n)&&cr(n.object)&&(km(n.object)||km(n.object.parent))}function Dm(n){return en(n)&&n.isDraggable&&!n.disabled}function dr(n){return lo(n)&&cr(n.object)&&(Dm(n.object)||Dm(n.object.parent))}function Om(n){return en(n)&&n.disabled}function Fm(n){return lo(n)&&cr(n.object)&&(Om(n.object)||Om(n.object.parent))}function Hm(n,t){return n==="click"&&t&&(n="error"),`InteractionAudio-${n}`}var ea=class{constructor(t,e){this.audio=t,this.eventSys=e,this.enabled=!0;let r=i=>{let o=i.object;if(this.enabled&&en(o)&&o.isClickable){let s=Hm(i.type,o.disabled);if(this.audio.hasClip(s)){let{x:a,y:p,z:d}=i.point;this.audio.setClipPosition(s,a,p,d),this.audio.playClip(s)}}};this.eventSys.addEventListener("enter",r),this.eventSys.addEventListener("exit",r),this.eventSys.addEventListener("click",r)}async load(t,e,r,i){return await this.audio.loadClip(Hm(t,!1),e,!1,!1,!0,!1,r,[],i)}};var co=(i=>(i.None="None",i.Fullscreen="Fullscreen",i.VR="VR",i.AR="AR",i))(co||{});Lt(ee("#controls",Gr("absolute"),$n(0),er(0),Et("100%"),Jt("100%")),ee("#controls",Ue("grid"),us("20pt"),xs("auto 1fr auto")),ee("#controls, #controls *",oc("none")),ee("#controls canvas",Jt("58px")),ee("#controls > .row",Ue("grid"),An("10px 5px"),vn("repeat(2, auto)")),ee("#controls > .row.top",fs(1)),ee("#controls > .row.middle",fs(2,-2)),ee("#controls > .row.bottom",fs(-2)),ee("#controls > .row > .cell",Ue("flex")),ee("#controls > .row > .cell.left",Jn(1)),ee("#controls > .row > .cell.right",Jn(-2),su("row-reverse")),ee("#controls > .row > .cell > .btn",ru(0),Zi("#1e4388"),Jt("58px !important"),Et("58px"),_n("0.25em"),An("0 5px"),oc("initial")),ee("#controls .btn-primary img",Jt("calc(100% - 0.5em)")));var ta=class{constructor(){this.element=he(Qn("controls"),he(Ee("row top"),this.topRowLeft=he(Ee("cell left")),this.topRowRight=he(Ee("cell right"))),he(Ee("row middle"),this.middleRowLeft=he(Ee("cell left")),this.middleRowRight=he(Ee("cell right"))),he(Ee("row bottom"),this.bottomRowLeft=he(Ee("cell left")),this.bottomRowRight=he(Ee("cell right")))),this.cells=[[this.topRowLeft,this.topRowRight],[this.middleRowLeft,this.middleRowRight],[this.bottomRowLeft,this.bottomRowRight]]}};var Vc=1.25,Nm=Ze(30),Ov=Ze(32),Bv=new THREE.Vector3(0,0,0),na=class extends THREE.Object3D{constructor(){super(),this.name="SpaceUI",this.position.y=-.25}addItem(t,e){t=wt(t),Le(this,t),this.add(t),t.position.set(Vc*Math.sin(e.x*Nm),Vc*Math.sin(e.y*Ov),-Vc*Math.cos(e.x*Nm)),t.scale.set(e.scale,e.scale,1);for(let r of this.children)r.lookAt(Bv)}};var Xm=/([^\/]+)\/(.+)/,Fv=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/,ur=class{constructor(t,e,r){this._type=t;this._fullSubType=e;this._primaryExtension=null;this.depMessage=null;let i=new Map;this._parameters=i;let o=this._fullSubType.match(Fv);this._tree=o[1],this._subType=o[2],this._suffix=o[3];let s=o[4];if(this._value=this._fullValue=this._type+"/",g(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,g(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),g(s)){let a=s.split(";").map(p=>p.trim()).filter(p=>p.length>0).map(p=>p.split("="));for(let[p,...d]of a){let h=d.join("=");i.set(p,h);let x=`; ${p}=${h}`;this._fullValue+=x,p!=="q"&&(this._value+=x)}}this._extensions=r||[],this._primaryExtension=this._extensions[0]||null}static parse(t){if(!t)return null;let e=t.match(Xm);if(!e)return null;let r=e[1],i=e[2];return new ur(r,i)}deprecate(t){return this.depMessage=t,this}check(){g(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(t){if(O(t))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let e=null,r=null;if(q(t)){let i=t.match(Xm);if(!i)return!1;e=i[1],r=i[2]}else e=t.typeName,r=t._fullSubType;return this.typeName===e&&(this._fullSubType==="*"||this._fullSubType===r)}withParameter(t,e){let r=`${this._fullSubType}; ${t}=${e}`;return new ur(this.typeName,r,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}addExtension(t){if(!t)throw new Error("File name is not defined");if(this.primaryExtension){let e=t.lastIndexOf(".");if(e>-1){let r=t.substring(e+1);this.extensions.indexOf(r)>-1&&(t=t.substring(0,e))}t=`${t}.${this.primaryExtension}`}return t}};function Hv(n,t,...e){return new ur(n,t,e)}function ke(n){return Hv.bind(null,n)}var Lc=ke("application");var po=Lc("javascript","js");var jm=Lc("json","json");var kc=Lc("wasm","wasm");var Nv=ke("audio");var zm=Nv("mpeg","mp3","mp2","mp2a","mpga","m2a","m3a");var Dc=ke("image");var Um=Dc("jpeg","jpeg","jpg","jpe");var Gm=Dc("png","png");var aR=Dc("vnd.google.streetview.pano");var Xv=ke("model");var Wm=Xv("gltf-binary","glb");var qm=ke("text");var Qm=qm("plain","txt","text","conf","def","list","log","in");var Km=qm("xml");var jv=ke("video");var Ym=jv("vnd.mpeg.dash.mpd","mpd");function Jm(n){return q(n.vcodec)}var ra=class extends Dt{loadingEvt;loadEvt;playEvt;pauseEvt;stopEvt;progEvt;onPlay;onSeeked;onCanPlay;onWaiting;onPause;onTimeUpdate=null;wasUsingAudioElement=!1;_data=null;get data(){return this._data}_loaded=!1;get loaded(){return this._loaded}video;audio;videoSource;audioSource;get title(){return this.video.title}setTitle(t){this.video.title=t,this.audio.title=t}onError=new Map;sourcesByURL=new Map;sources=new dt;potatoes=new dt;constructor(t){super("JuniperVideoPlayer",t,Ge.instance(t)),this.video=this.createMediaElement(cc,gn(!0)),this.audio=this.createMediaElement(rr,gn(!1)),this.input=He("JuniperVideoPlayer-combiner",t),this.videoSource=sr("JuniperVideoPlayer-VideoNode",t,this.video,this.input),this.audioSource=sr("JuniperVideoPlayer-AudioNode",t,this.audio,this.input),this.loadingEvt=new ri(this),this.loadEvt=new Tn(this),this.playEvt=new Mn(this),this.pauseEvt=new Sn(this),this.stopEvt=new Rn(this),this.progEvt=new Pn(this),this.onSeeked=()=>{this.useAudioElement&&(this.audio.currentTime=this.video.currentTime)},this.onPlay=async()=>{this.connect(),this.onSeeked(),this.useAudioElement&&await this.audio.play(),this.dispatchEvent(this.playEvt)},this.onPause=r=>{this.disconnect(),this.useAudioElement&&(this.onSeeked(),this.audio.pause()),this.video.currentTime===0||r.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};let e=!1;this.onWaiting=()=>{this.useAudioElement&&(e=!0,this.audio.pause())},this.onCanPlay=async()=>{this.useAudioElement&&e&&(await this.audio.play(),e=!1)},this.wasUsingAudioElement=!1,this.onTimeUpdate=async()=>{if(this.video.getVideoPlaybackQuality().totalVideoFrames===0){let i=this.onError.get(this.video);g(i)&&await i()}else if(this.useAudioElement){this.wasUsingAudioElement=!1;let i=this.video.currentTime-this.audio.currentTime;Math.abs(i)>.25&&(this.audio.currentTime=this.video.currentTime)}else this.wasUsingAudioElement||(this.wasUsingAudioElement=!0,this.audio.pause());this.progEvt.value=this.video.currentTime,this.progEvt.total=this.video.duration,this.dispatchEvent(this.progEvt)},this.video.addEventListener("seeked",this.onSeeked),this.video.addEventListener("play",this.onPlay),this.video.addEventListener("pause",this.onPause),this.video.addEventListener("ended",this.onPause),this.video.addEventListener("waiting",this.onWaiting),this.video.addEventListener("canplay",this.onCanPlay),this.video.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{videoPlayer:this})}elementHasAudio(t){let e=this.sourcesByURL.get(t.src);return g(e)&&e.acodec!=="none"||g(t.audioTracks)&&t.audioTracks.length>0||g(t.webkitAudioDecodedByteCount)&&t.webkitAudioDecodedByteCount>0||g(t.mozHasAudio)&&t.mozHasAudio}get useAudioElement(){return!this.elementHasAudio(this.video)&&this.elementHasAudio(this.audio)}onDisposing(){super.onDisposing(),this.clear(),ie(this.input),ie(this.videoSource),ie(this.audioSource),this.video.removeEventListener("seeked",this.onSeeked),this.video.removeEventListener("play",this.onPlay),this.video.removeEventListener("pause",this.onPause),this.video.removeEventListener("ended",this.onPause),this.video.removeEventListener("waiting",this.onWaiting),this.video.removeEventListener("canplay",this.onCanPlay),this.video.removeEventListener("timeupdate",this.onTimeUpdate)}clear(){this.stop();for(let[t,e]of this.onError)t.removeEventListener("error",e);this.onError.clear(),this.sourcesByURL.clear(),this.sources.clear(),this.potatoes.clear(),this.video.src="",this.audio.src="",this.wasUsingAudioElement=!1,this._data=null,this._loaded=!1}async load(t,e){if(this.clear(),this._data=t,q(t)?(this.setTitle(t),this.potatoes.add(this.video,t)):(this.setTitle(t.title),this.fillSources(this.video,t.videos),this.fillSources(this.audio,t.audios)),!this.hasSources(this.video))throw new Error("No video sources found");if(this.dispatchEvent(this.loadingEvt),await cs(e,r=>this.loadMediaElement(this.audio,r),r=>this.loadMediaElement(this.video,r)),!this.hasSources(this.video))throw new Error("No video playable sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}fillSources(t,e){Wn(e,r=>-r.resolution);for(let r of e)Ym.matches(r.contentType)||(this.sources.add(t,r),this.sourcesByURL.set(r.url,r))}createMediaElement(t,...e){return t(Yt(!0),Kt(!1),Kn(!1),...e)}async getMediaCapabilities(t){let e={type:"file"};Jm(t)?e.video={contentType:t.contentType,bitrate:t.vbr*1024,framerate:t.fps,width:t.width,height:t.height}:t.acodec!=="none"&&(e.audio={contentType:t.contentType,bitrate:t.abr*1024,samplerate:t.asr});try{return await navigator.mediaCapabilities.decodingInfo(e)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:e}}}hasSources(t){return this.sources.get(t).length>0||this.potatoes.count(t)>0}async loadMediaElement(t,e){for(g(e)&&e.start(),this.onError.has(t)&&(t.removeEventListener("error",this.onError.get(t)),this.onError.delete(t));this.hasSources(t);){let r=null,i=this.sources.get(t).shift();if(g(i)){let o=await this.getMediaCapabilities(i);if(!o.smooth||!o.powerEfficient){this.potatoes.add(t,i.url);continue}else r=i.url}else r=this.potatoes.get(t).shift();if(t.src=r,t.load(),await As(t)){g(i)?this.sources.get(t).unshift(i):this.potatoes.get(t).unshift(r);let o=()=>this.loadMediaElement(t,e);t.addEventListener("error",o),this.onError.set(t,o),this.wasUsingAudioElement=this.wasUsingAudioElement,g(e)&&e.end();return}}}get width(){return this.video.videoWidth}get height(){return this.video.videoHeight}get playbackState(){return O(this.data)?"empty":this.loaded?this.video.error?"errored":this.video.ended||this.video.paused&&this.video.currentTime===0?"stopped":this.video.paused?"paused":"playing":"loading"}play(){return this.video.play()}async playThrough(){let t=le(this,"stopped");await this.play(),await t}pause(){this.video.pause()}stop(){this.pause(),this.video.currentTime=0}restart(){return this.stop(),this.play()}};function zv(n){return[Zm([n[1],n[0],n[2]]),Zm([n[2],n[0],n[3]])]}function th(n){return n.map(zv).flat()}var Oc=new THREE.Vector3,$m=new THREE.Vector3,ia=new THREE.Vector3;function Zm(n){let t=[[n[0][0],n[0][1],n[0][2]],[n[1][0],n[1][1],n[1][2]],[n[2][0],n[2][1],n[2][2]]],e=[[n[0][3],n[0][4]],[n[1][3],n[1][4]],[n[2][3],n[2][4]]];ia.fromArray(t[0]),Oc.fromArray(t[1]).sub(ia),ia.fromArray(t[2]),$m.fromArray(t[1]).sub(ia),Oc.cross($m);let r=Oc.toArray();return{positions:t,uvs:e,normal:r}}function nh(n){let t=n.map(o=>o.positions).flat(2),e=n.map(o=>o.uvs).flat(2),r=n.flatMap(o=>o.normal),i=new THREE.BufferGeometry;return i.setAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3,!1)),i.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(e),2,!1)),i.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(r),3,!0)),i}function Mt(...n){let t=th(n);return nh(t)}function ci(n,...t){let e=Uv(t);for(let i=0;i<n;++i)e=Wv(e);t=Gv(e);let r=th(t);return nh(r)}function Uv(n){return n.map(t=>{let e=Number.MAX_VALUE,r=Number.MIN_VALUE,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(let p of t){let d=p[3],h=p[4];e=Math.min(e,d),r=Math.max(r,d),i=Math.min(i,h),o=Math.max(o,h)}let s=[e,i],a=[r-e,o-i];return{minUV:s,deltaUV:a,verts:[oa(s,a,t[0]),oa(s,a,t[1]),oa(s,a,t[2]),oa(s,a,t[3])]}})}function oa(n,t,e){return{pos:[e[0],e[1],e[2]],uv:[e[3],e[4]],pUV:[(e[3]-n[0])/t[0],(e[4]-n[1])/t[1]]}}function Gv(n){return n.map(t=>[sa(t,0),sa(t,1),sa(t,2),sa(t,3)])}function sa(n,t){let e=n.verts[t];return[e.pos[0],e.pos[1],e.pos[2],e.uv[0],e.uv[1]]}function Wv(n){return n.flatMap(t=>{let e=uo(t,t.verts[0],t.verts[1]),r=uo(t,t.verts[2],t.verts[3]),i=uo(t,t.verts[0],t.verts[3]),o=uo(t,t.verts[1],t.verts[2]),s=uo(t,e,r);return[{minUV:t.minUV,deltaUV:t.deltaUV,verts:[t.verts[0],e,s,i]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[e,t.verts[1],o,s]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[s,o,t.verts[2],r]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[i,s,r,t.verts[3]]}]})}function uo(n,t,e){let r=e.pos[0]-t.pos[0],i=e.pos[1]-t.pos[1],o=e.pos[2]-t.pos[2],s=t.pos[0]+.5*r,a=t.pos[1]+.5*i,p=t.pos[2]+.5*o,d=e.pUV[0]-t.pUV[0],h=e.pUV[1]-t.pUV[1],x=t.pUV[0]+.5*d,A=t.pUV[1]+.5*h,E=eh(x-.5)+.5,S=eh(A-.5)+.5,P=E*n.deltaUV[0]+n.minUV[0],R=S*n.deltaUV[1]+n.minUV[1];return{pos:[s,a,p],pUV:[x,A],uv:[P,R]}}function eh(n){return 2*Math.atan(2*n)/Math.PI}var la=class extends ra{constructor(e,r){super(r);this.material=lr({name:"videoPlayer-material"}),this.vidMeshes=[];for(let i=0;i<2;++i){let o=new Bt(e,`videoPlayer-view${i+1}`,!1,this.material);o.mesh.setImage(this.video),o.renderOrder=4,i>0?o.mesh.layers.disable(0):o.mesh.layers.enable(0),this.vidMeshes.push(o)}this.object=Tt("videoPlayer",...this.vidMeshes)}onDisposing(){super.onDisposing(),In(this.object),pe(this.vidMeshes)}update(e,r){for(let i of this.vidMeshes)i.update(e,r)}isSupported(e,r){return r.split("-").map(i=>rh.has(e,i)).reduce(Hd,!0)}setStereoParameters(e,r){if(!this.isSupported(e,r))throw new Error(`Not supported [encoding: ${e}, layout: ${r}]`);for(let s=0;s<this.vidMeshes.length;++s){let a=this.vidMeshes[s];a.webXRLayersEnabled=!1,a.mesh.layers.disable(1),a.mesh.layers.disable(2),r==="left-right"||r==="top-bottom"?a.mesh.layers.enable(this.vidMeshes.length-s):r!=="mono"&&a.mesh.layers.enable(s+1)}let i=this.height/this.width;e!=="N/A"?this.vidMeshes[0].scale.set(100,100,100):r==="mono"?this.vidMeshes[0].scale.set(1,i,1):r==="left-right"||r==="right-left"?this.vidMeshes[0].scale.set(1,2*i,1):this.vidMeshes[0].scale.set(1,.5*i,1);for(let s=1;s<this.vidMeshes.length;++s)this.vidMeshes[s].scale.copy(this.vidMeshes[0].scale);let o=r.split("-");for(let s=0;s<o.length;++s){let a=o[s],p=rh.get(e,a),d=this.vidMeshes[s];d.webXRLayersEnabled=!0,d.visible=!0,d.mesh.geometry!==p&&(d.mesh.geometry.dispose(),d.mesh.geometry=p)}}},qv=Mt([[-1/2,1/2,0,0,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,0,0]]),ih=[[-1/2,1/2,0,0,1],[1/2,1/2,0,.5,1],[1/2,-1/2,0,.5,0],[-1/2,-1/2,0,0,0]],oh=[[-1/2,1/2,0,.5,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,.5,0]],sh=[[[-1/2,1/2,-1/2,1/3,1],[1/2,1/2,-1/2,2/3,1],[1/2,-1/2,-1/2,2/3,1/2],[-1/2,-1/2,-1/2,1/3,1/2]],[[1/2,1/2,-1/2,2/3,1],[1/2,1/2,1/2,1,1],[1/2,-1/2,1/2,1,1/2],[1/2,-1/2,-1/2,2/3,1/2]],[[-1/2,1/2,1/2,0,1],[-1/2,1/2,-1/2,1/3,1],[-1/2,-1/2,-1/2,1/3,1/2],[-1/2,-1/2,1/2,0,1/2]],[[1/2,1/2,1/2,2/3,1/2],[-1/2,1/2,1/2,2/3,0],[-1/2,-1/2,1/2,1/3,0],[1/2,-1/2,1/2,1/3,1/2]],[[1/2,1/2,-1/2,1,1/2],[-1/2,1/2,-1/2,1,0],[-1/2,1/2,1/2,2/3,0],[1/2,1/2,1/2,2/3,1/2]],[[1/2,-1/2,1/2,1/3,1/2],[-1/2,-1/2,1/2,1/3,0],[-1/2,-1/2,-1/2,0,0],[1/2,-1/2,-1/2,0,1/2]]],Bc=[[[-1/2,1/2,-1/2,0,1/3],[1/2,1/2,-1/2,0,2/3],[1/2,-1/2,-1/2,1/4,2/3],[-1/2,-1/2,-1/2,1/4,1/3]],[[1/2,1/2,-1/2,0,2/3],[1/2,1/2,1/2,0,1],[1/2,-1/2,1/2,1/4,1],[1/2,-1/2,-1/2,1/4,2/3]],[[-1/2,1/2,1/2,0,0],[-1/2,1/2,-1/2,0,1/3],[-1/2,-1/2,-1/2,1/4,1/3],[-1/2,-1/2,1/2,1/4,0]],[[1/2,1/2,1/2,1/4,2/3],[-1/2,1/2,1/2,1/2,2/3],[-1/2,-1/2,1/2,1/2,1/3],[1/2,-1/2,1/2,1/4,1/3]],[[1/2,1/2,-1/2,1/4,1],[-1/2,1/2,-1/2,1/2,1],[-1/2,1/2,1/2,1/2,2/3],[1/2,1/2,1/2,1/4,2/3]],[[1/2,-1/2,1/2,1/4,1/3],[-1/2,-1/2,1/2,1/2,1/3],[-1/2,-1/2,-1/2,1/2,0],[1/2,-1/2,-1/2,1/4,0]]],Fc=[[[-1/2,1/2,-1/2,1/2,1/3],[1/2,1/2,-1/2,1/2,2/3],[1/2,-1/2,-1/2,3/4,2/3],[-1/2,-1/2,-1/2,3/4,1/3]],[[1/2,1/2,-1/2,1/2,2/3],[1/2,1/2,1/2,1/2,1],[1/2,-1/2,1/2,3/4,1],[1/2,-1/2,-1/2,3/4,2/3]],[[-1/2,1/2,1/2,1/2,0],[-1/2,1/2,-1/2,1/2,1/3],[-1/2,-1/2,-1/2,3/4,1/3],[-1/2,-1/2,1/2,3/4,0]],[[1/2,1/2,1/2,3/4,2/3],[-1/2,1/2,1/2,1,2/3],[-1/2,-1/2,1/2,1,1/3],[1/2,-1/2,1/2,3/4,1/3]],[[1/2,1/2,-1/2,3/4,1],[-1/2,1/2,-1/2,1,1],[-1/2,1/2,1/2,1,2/3],[1/2,1/2,1/2,3/4,2/3]],[[1/2,-1/2,1/2,3/4,1/3],[-1/2,-1/2,1/2,1,1/3],[-1/2,-1/2,-1/2,1,0],[1/2,-1/2,-1/2,3/4,0]]],Qv=Mt(ih),Kv=Mt(oh),Yv=Mt(Hc(ih)),Jv=Mt(Hc(oh)),ah=ch(Bc),lh=ch(Fc),$v=Mt(...sh),Zv=Mt(...Bc),eA=Mt(...Fc),tA=Mt(...ah),nA=Mt(...lh),mo=4,rA=ci(mo,...sh),iA=ci(mo,...Bc),oA=ci(mo,...Fc),sA=ci(mo,...ah),aA=ci(mo,...lh),rh=new ze([["N/A","mono",qv],["N/A","left",Qv],["N/A","right",Kv],["N/A","top",Yv],["N/A","bottom",Jv],["Cubemap Strips","mono",$v],["Cubemap Strips","left",Zv],["Cubemap Strips","right",eA],["Cubemap Strips","top",tA],["Cubemap Strips","bottom",nA],["Equi-Angular Cubemap (YouTube)","mono",rA],["Equi-Angular Cubemap (YouTube)","left",iA],["Equi-Angular Cubemap (YouTube)","right",oA],["Equi-Angular Cubemap (YouTube)","top",sA],["Equi-Angular Cubemap (YouTube)","bottom",aA]]);function aa(n){return[n[0],n[1],n[2],n[4],1-n[3]]}function Hc(n){return[aa(n[0]),aa(n[1]),aa(n[2]),aa(n[3])]}function ch(n){return n.map(Hc)}var ca=class extends THREE.Mesh{constructor(e){super(e,so(0));this.isCollider=!0;this.visible=!1}};var pa=class extends THREE.Object3D{constructor(e,r,i,o,s){super();this._disabled=!1;let a=bt(16);this.name=e+a,this.enabledMesh=this.createMesh(`${this.name}-enabled`,r,i),this.disabledMesh=this.createMesh(`${this.name}-disabled`,r,o),this.disabledMesh.visible=!1,this.size=s,this.add(this.enabledMesh,this.disabledMesh)}get size(){return this.enabledMesh.scale.x}set size(e){this.enabledMesh.scale.setScalar(e),this.disabledMesh.scale.setScalar(e)}createMesh(e,r,i){let o=new THREE.Mesh(r,i);return o.name="Mesh-"+e,o}get disabled(){return this._disabled}set disabled(e){e!==this.disabled&&(this._disabled=e,this.enabledMesh.visible=!e,this.disabledMesh.visible=e)}};var mr=class extends pa{constructor(e,r,i,o,s){super(e,r,i,o,s);this.isDraggable=!1;this.isClickable=!0;this.collider=new ca(r),this.collider.name=`Collider-${this.name}`,this.size=s,this.add(this.collider),Gs(this)}set size(e){super.size=e,this.collider&&this.collider.scale.setScalar(e)}};var pi=class{constructor(t,e,r){this.mesh=null;this.element=qr(zr(r),t.getImageElement(e,r)),this.object=Tt(`${name}-button`),this.load(t,e,r)}async load(t,e,r){let{geometry:i,enabledMaterial:o,disabledMaterial:s}=await t.getGeometryAndMaterials(e,r);this.mesh=new mr(r,i,o,s,.2),this.object.add(this.mesh),this.mesh.visible=this.visible,this.mesh.addEventListener("click",()=>{this.element.click()})}get name(){return this.object.name}addEventListener(t,e,r){this.element.addEventListener(t,e,r)}dispatchEvent(t){return this.element.dispatchEvent(t)}removeEventListener(t,e,r){this.element.removeEventListener(t,e,r)}click(){this.element.click()}get visible(){return Vt(this)}set visible(t){Re(this,t,"inline-block"),this.mesh&&(this.mesh.visible=t)}};var di=class extends Bt{constructor(e,r,i){super(e,r,!1);this.image=i;this.mesh&&this.setImage(i)}get object(){return this}setImage(e){this.mesh.setImage(e.canvas),this.mesh.objectHeight=.1,this.mesh.updateTexture(),e.addEventListener("redrawn",()=>this.mesh.updateTexture())}copy(e,r=!0){return super.copy(e,r),this.setImage(e.image),this}get element(){return Qr(this.image.canvas)?this.image.canvas:null}get isVisible(){return Vt(this)}set isVisible(e){Re(this,e,"inline-block"),Ve(this,e),Ve(this.mesh,e),this.image.visible=e}};function Nc(n,t,e){let r=g(e),i=r&&n.classList.contains(e);r&&i!==t&&(t?n.classList.add(e):n.classList.remove(e))}var lA=["danger","dark","info","light","primary","secondary","success","warning"];function hr(n,t,e,r){if(nr(n)&&(n=n.element),q(e))for(let i of lA)Nc(n,t&&i===e,`btn-${i}`),Nc(n,!t&&i===e,`btn-outline-${i}`);gs(n)&&(n.disabled=!t),r&&Wr(n,r)}var fr=class{constructor(t,e,r,i){this.buttons=t;this.setName=e;this.activeName=r;this.inactiveName=i;this.enterButton=null;this.exitButton=null;this._isAvailable=!0;this._isEnabled=!0;this._isVisible=!0;this._isActive=!1;this.element=qr(this.btnImage=ir()),this.object=Tt(`${this.setName}-button`),this.load()}get name(){return this.object.name}addEventListener(t,e,r){this.element.addEventListener(t,e,r)}dispatchEvent(t){return this.element.dispatchEvent(t)}removeEventListener(t,e,r){this.element.removeEventListener(t,e,r)}click(){this.element.click()}async load(){let[t,e]=await Promise.all([this.buttons.getGeometryAndMaterials(this.setName,this.activeName),this.buttons.getGeometryAndMaterials(this.setName,this.inactiveName)]);Le(this.object,this.enterButton=new mr(`${this.setName}-activate-button`,t.geometry,t.enabledMaterial,t.disabledMaterial,.2),this.exitButton=new mr(`${this.setName}-deactivate-button`,e.geometry,e.enabledMaterial,e.disabledMaterial,.2)),this.enterButton.addEventListener("click",()=>this.element.click()),this.exitButton.addEventListener("click",()=>this.element.click()),this.refreshState()}get mesh(){return this.active?this.enterButton:this.exitButton}get available(){return this._isAvailable}set available(t){this._isAvailable=t,this.refreshState()}get active(){return this._isActive}set active(t){this._isActive=t,this.refreshState()}get enabled(){return this._isEnabled}set enabled(t){this._isEnabled=t,this.refreshState()}get visible(){return this._isVisible}set visible(t){this._isVisible=t,this.refreshState()}refreshState(){let t=this.active?this.inactiveName:this.activeName,e=`${t} ${this.setName}`;if(this.element.title=this.btnImage.title=e,this.btnImage.src=this.buttons.getImageSrc(this.setName,t),hr(this,this.available&&this.visible&&this.enabled,"primary"),Re(this,this.available&&this.visible,"inline-block"),this.enterButton&&this.exitButton){zs(this,this.available&&this.visible&&this.enabled);let r=Ve(this.object,this.available&&this.visible);Ve(this.enterButton,r&&!this.active),Ve(this.exitButton,r&&this.active)}}};var ho=class extends fr{constructor(e,r){let i=co[r];super(e,i.toLowerCase(),"enter","exit");this.mode=r}};function Xc(n,t,e){n.element instanceof HTMLButtonElement&&hr(n,t,e),zs(n,t)}var fo=class extends j{constructor(e,r){super(e);this.appName=r}},jc=class extends fo{constructor(e,r){super("apploading",e);this.appLoadParams=r;this.preLoadTask=null}},zc=class extends fo{constructor(e,r){super("apploaded",e);this.app=r}},Uc=class extends fo{constructor(e,r){super("appshown",e);this.app=r}},Gc=class{constructor(t,e){this.loader=t;this.name=e;this.params=new Map}param(t,e){return this.params.set(t,e),this}load(t){return this.loader(this.name,this.params,t)}},da=class extends Z{constructor(e,r){super();this.env=e;this.JS_EXT=r;this.loadedModules=new Map;this.loadingApps=new Map;this.currentApps=new Map;this.cacheBustString=null}[Symbol.iterator](){return this.currentApps.values()}isLoaded(e){return this.currentApps.has(e)}get(e){return this.currentApps.get(e)}async loadAppConstructor(e,r){if(this.loadedModules.has(e))g(r)&&r.end();else{let o=`/js/${e}/index${this.JS_EXT}`;g(this.cacheBustString)&&(o+="#"+this.cacheBustString);let s=this.env.fetcher.get(o).progress(r).module();this.loadedModules.set(e,s)}let{default:i}=await this.loadedModules.get(e);return i}app(e){return new Gc(this.loadApp.bind(this),e)}loadApp(e,r,i){let o=null;r instanceof Map?o=r:i=r,i=i||this.env.loadingBar;let s=new jc(e,o);this.dispatchEvent(s);let a=s.preLoadTask||Promise.resolve();if(!this.loadingApps.has(e)){let d=ls(i),h=a.then(()=>this.loadAppInstance(this.env,e,o,d.pop(10)));this.loadingApps.set(e,h),i=d.pop(1)}return this.loadingApps.get(e).then(async d=>(await d.show(i),this.dispatchEvent(new Uc(e,d)),d))}async loadAppInstance(e,r,i,o){if(!this.currentApps.has(r)){let[s,a]=Fr(o,[1,10]),p=await this.loadAppConstructor(r,s),d=new p(e);d.addEventListener("quit",()=>this.unloadApp(r)),g(i)&&await d.init(i),await d.load(a),this.currentApps.set(r,d),this.dispatchEvent(new zc(r,d))}return g(o)&&o.end(),this.currentApps.get(r)}unloadApp(e){let r=this.currentApps.get(e);r.clearEventListeners(),r.dispose(),this.currentApps.delete(e),this.loadingApps.delete(e)}};var xo=new THREE.Vector3;function ua(n){return xo.copy(n),xo.y=0,xo.normalize(),fn(Math.atan2(xo.x,xo.z))}function ph(n){return fn(Math.asin(n.y))}var ui=new THREE.Vector3,dh=0,cA=new THREE.Vector3,ma=new THREE.Vector3,uh=new THREE.Vector3,ha=new THREE.Quaternion,mh=0,pA=0;function dA(n,t){let e=n-t,r=e+2*Math.PI,i=e-2*Math.PI,o=Math.abs(e),s=Math.abs(r),a=Math.abs(i);return o<s&&o<a?e:s<a?r:i}var fa=class extends THREE.Object3D{constructor(e,r,i,o,s=1){super();this.minDistance=r;this.heightOffset=o;this.speed=s;this.name=e,this.lerp=this.minAngle>0||this.minDistance>0,this.maxDistance=this.minDistance*5,this.minAngle=Ze(i),this.maxAngle=Math.PI-this.minAngle,Object.seal(this)}copy(e,r=!0){return super.copy(e,r),this.name=e.name+ ++pA,this.lerp=e.lerp,this.maxDistance=e.maxDistance,this.minAngle=e.minAngle,this.maxAngle=e.maxAngle,this}update(e,r,i,o){o*=.001,this.clampTo(this.lerp,e,r,this.minDistance,this.maxDistance,i,this.minAngle,this.maxAngle,o)}reset(e,r,i){this.clampTo(!1,e,r,0,0,i,0,0,0)}clampTo(e,r,i,o,s,a,p,d,h){ui.copy(i),ui.y-=this.heightOffset*r,dh=a,this.getWorldPosition(ma),this.getWorldDirection(uh),mh=ua(uh),ha.identity();let x=!e,A=!e;if(e){let E=cA.copy(ui).sub(ma).length();o<E&&(E<s&&ui.lerpVectors(ma,ui,this.speed*h),x=!0);let S=dA(dh,mh),P=Math.abs(S);p<P&&(P<d?ha.setFromAxisAngle(this.up,S*this.speed*h):ha.setFromAxisAngle(this.up,S),A=!0)}(x||A)&&(x&&this.position.add(ui.sub(ma)),A&&this.quaternion.multiply(ha))}};function ga(n){return!(n.shiftKey||n.altKey||n.ctrlKey||n.metaKey)}var xa=class{constructor(t,e,r){this.name=t;this.callback=e;if(!se(e))throw new Error("A function instance is required for this parameter");this.opts=r,Object.freeze(this)}opts;applyToElement(t){this.add(t)}add(t){t.addEventListener(this.name,this.callback,this.opts)}remove(t){t.removeEventListener(this.name,this.callback)}};function hh(n,t){return new xa("click",n,t)}function mi(n,t){return new xa("input",n,t)}var va=class extends j{px=0;py=0;pz=0;fx=0;fy=0;fz=0;ux=0;uy=0;uz=0;height=0;name=0;constructor(){super("avatarmoved")}set(t,e,r,i,o,s,a,p,d,h){this.px=t,this.py=e,this.pz=r,this.fx=i,this.fy=o,this.fz=s,this.ux=a,this.uy=p,this.uz=d,this.height=h}};function hi(n,t){return n.xr.isPresenting?n.xr.getCamera():t}function fh(n,t,e,r,i){let o=n.elements;t.set(o[0],o[1],o[2]),e.set(o[4],o[5],o[6]),r.set(-o[8],-o[9],-o[10]),i.set(o[12],o[13],o[14]),t.normalize(),e.normalize(),r.normalize()}var uA=100,mA=50,hA=1,fA=Math.PI/3,xA=new THREE.Vector3(0,0,1),gA=new THREE.Vector3,xr=new THREE.Vector3,_a=new THREE.Vector3,ba=new THREE.Vector3,xh=new THREE.Matrix4,fi=new THREE.Euler,gh=new THREE.Quaternion,vh=new THREE.Quaternion,vA=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),Ft=new THREE.Vector3,Ah=new THREE.Quaternion,Wc=new THREE.Vector3,_h=new THREE.Matrix4,bh=new va;function AA(n){return n===DeviceOrientationEvent&&"requestPermission"in n&&se(n.requestPermission)}var Ea=class extends Z{constructor(e,r,i,o){super();this.renderer=e;this.camera=r;this.controlMode="none";this.requiredMouseButton=new Map([["mousedrag",1],["touchswipe",1]]);this._heading=0;this._pitch=0;this._roll=0;this.fwrd=!1;this.back=!1;this.left=!1;this.rgth=!1;this.up=!1;this.down=!1;this.grow=!1;this.shrk=!1;this.viewEuler=new THREE.Euler;this.move=new THREE.Vector3;this.followers=new Array;this.worldPos=new THREE.Vector3;this._worldHeading=0;this._worldPitch=0;this.lastTouchInputTime=Number.MIN_SAFE_INTEGER;this.evtSys=null;this.requiredTouchCount=1;this.disableHorizontal=!1;this.disableVertical=!1;this.invertHorizontal=!1;this.invertVertical=!0;this.minimumX=-85*Math.PI/180;this.maximumX=85*Math.PI/180;this.target=new THREE.Quaternion(0,0,0,1);this.edgeFactor=1/3;this.accelerationX=2;this.accelerationY=2;this.speedX=3;this.speedY=2;this.deviceQ=new THREE.Quaternion().identity();this.u=0;this.v=0;this.du=0;this.dv=0;this._keyboardControlEnabled=!1;this.deviceOrientation=null;this.screenOrientation=0;this.alphaOffset=0;this.onDeviceOrientationChangeEvent=null;this.onScreenOrientationChangeEvent=null;this.motionEnabled=!1;this._height=o,this.head=Tt("Head",i),this.onKeyDown=s=>{let a=ga(s);s.key==="w"&&(this.fwrd=a),s.key==="s"&&(this.back=a),s.key==="a"&&(this.left=a),s.key==="d"&&(this.rgth=a),s.key==="e"&&(this.up=a),s.key==="q"&&(this.down=a),s.key==="r"&&(this.grow=a),s.key==="f"&&(this.shrk=a)},this.onKeyUp=s=>{s.key==="w"&&(this.fwrd=!1),s.key==="s"&&(this.back=!1),s.key==="a"&&(this.left=!1),s.key==="d"&&(this.rgth=!1),s.key==="e"&&(this.up=!1),s.key==="q"&&(this.down=!1),s.key==="r"&&(this.grow=!1),s.key==="f"&&(this.shrk=!1)},this.keyboardControlEnabled=!0,It()?this.controlMode="motioncontroller":matchMedia("(pointer: coarse)").matches?this.controlMode="touchswipe":matchMedia("(pointer: fine)").matches&&(this.controlMode="mousedrag"),globalThis.isSecureContext&&Gi()&&!It()&&(this.onDeviceOrientationChangeEvent=s=>{this.deviceOrientation=s,s&&(s.alpha||s.beta||s.gamma)&&this.motionEnabled&&performance.now()-this.lastTouchInputTime>1e3&&(this.controlMode="magicwindow")},this.onScreenOrientationChangeEvent=()=>{q(globalThis.orientation)||(this.screenOrientation=globalThis.orientation||0)},this.startMotionControl())}get worldHeading(){return this._worldHeading}get worldPitch(){return this._worldPitch}get height(){return this.head.position.y}get object(){return this.head}get stage(){return this.head.parent}onFlick(e){Wc.set(fA*e,0,0)}get keyboardControlEnabled(){return this._keyboardControlEnabled}set keyboardControlEnabled(e){this._keyboardControlEnabled!==e&&(this._keyboardControlEnabled=e,this._keyboardControlEnabled?(globalThis.addEventListener("keydown",this.onKeyDown),globalThis.addEventListener("keyup",this.onKeyUp)):(globalThis.removeEventListener("keydown",this.onKeyDown),globalThis.removeEventListener("keyup",this.onKeyUp)))}addFollower(e){this.followers.push(e)}onDown(e){e.pointer.enabled&&this.setMode(e)}onMove(e){e.pointer.enabled&&(this.setMode(e),e.pointer.canMoveView&&this.checkMode(this.controlMode,e)&&(this.u=e.pointer.state.u,this.v=e.pointer.state.v,this.du=e.pointer.state.du,this.dv=e.pointer.state.dv))}setMode(e){e.pointer.type==="touch"||e.pointer.type==="pen"?(this.lastTouchInputTime=performance.now(),this.controlMode="touchswipe"):e.pointer.type==="gamepad"?this.controlMode="gamepad":e.pointer.type==="hand"?this.controlMode="motioncontroller":e.pointer.type!=="mouse"?this.controlMode="none":this.evtSys.mouse.isPointerLocked?this.controlMode="mousefirstperson":e.pointer.draggedHit?this.controlMode="mouseedge":this.controlMode="mousedrag"}checkMode(e,r){return e!=="none"&&this.gestureSatisfied(e,r)&&this.dragSatisfied(e,r)}gestureSatisfied(e,r){let i=this.requiredMouseButton.get(e);return O(i)?e==="mouseedge"||e==="mousefirstperson"||e==="touchswipe"||e==="gamepad":r.pointer.state.buttons===i}dragSatisfied(e,r){return!this.requiredMouseButton.has(e)||this.requiredMouseButton.get(e)==0||r.pointer.state.dragging}get name(){return this.object.name}set name(e){this.object.name=e}get heading(){return this._heading}setHeading(e){this._heading=fn(e)}get pitch(){return this._pitch}setPitch(e,r,i){this._pitch=fn(e+Math.PI)-Math.PI,this._pitch=Ct(this._pitch,r,i)}get roll(){return this._roll}setRoll(e){this._roll=fn(e)}setHeadingImmediate(e){this.setHeading(e),this.updateOrientation(),this.resetFollowers()}setOrientationImmediate(e,r){this.setHeading(e),this._pitch=fn(r),this.updateOrientation()}update(e){if(e*=.001,this.controlMode==="magicwindow"){let r=this.deviceOrientation;if(r){let i=r.alpha?Ze(r.alpha)+this.alphaOffset:0,o=r.beta?Ze(r.beta):0,s=r.gamma?Ze(r.gamma):0,a=this.screenOrientation?Ze(this.screenOrientation):0;fi.set(o,i,-s,"YXZ"),vh.setFromAxisAngle(xA,-a),this.deviceQ.setFromEuler(fi).multiply(vA).multiply(vh)}}else if(this.controlMode==="mousefirstperson")this.setHeading(this.heading-this.du*5),this.setPitch(this.pitch+this.dv*5,this.minimumX,this.maximumX),this.setRoll(0),this.du*=.5,this.dv*=.5;else if(this.controlMode!=="none"){let r=this.pitch,i=this.heading;if(this.controlMode==="motioncontroller")Ft.copy(Wc),Wc.set(0,0,0);else if(this.controlMode==="mouseedge")Ft.set(this.scaleRadialComponent(this.u,this.speedX,this.accelerationX),this.scaleRadialComponent(-this.v,this.speedY,this.accelerationY),0);else{let a=this.controlMode==="mousedrag"?uA:this.controlMode==="touchswipe"?mA:this.controlMode==="gamepad"?hA:de(this.controlMode);Ft.set(-a*this.du,a*this.dv,0)}if(this.controlMode==="mousedrag"||this.controlMode==="touchswipe"){let a=Math.pow(.95,100*e);this.du=qi(a*this.du),this.dv=qi(a*this.dv)}this.disableVertical?Ft.x=0:this.invertVertical&&(Ft.x*=-1),this.disableHorizontal?Ft.y=0:this.invertHorizontal&&(Ft.y*=-1),this.controlMode!=="motioncontroller"&&Ft.multiplyScalar(e),fi.set(Ft.y,Ft.x,0,"YXZ"),Ah.setFromEuler(fi),this.viewEuler.setFromQuaternion(Ah,"YXZ");let{x:o,y:s}=this.viewEuler;this.setHeading(this.heading+s),this.setPitch(this.pitch+o,this.minimumX,this.maximumX),this.setRoll(0),this.evtSys&&(r!==this.pitch||i!==this.heading)&&this.controlMode==="mouseedge"&&this.evtSys.recheckPointers()}if(this.fwrd||this.back||this.left||this.rgth||this.up||this.down){gh.setFromAxisAngle(this.stage.up,this.worldHeading);let r=(this.left?-1:0)+(this.rgth?1:0),i=(this.down?-1:0)+(this.up?1:0),o=(this.fwrd?-1:0)+(this.back?1:0);this.move.set(r,i,o);let s=this.move.length();s>0&&(this.move.multiplyScalar(e/s).applyQuaternion(gh),this.stage.position.add(this.move))}if(this.grow||this.shrk){let r=(this.shrk?-1:0)+(this.grow?1:0);this._height+=r*e,this._height=Ct(this._height,1,2)}this.updateOrientation(),bh.set(ba.x,ba.y,ba.z,xr.x,xr.y,xr.z,_a.x,_a.y,_a.z,this.height),this.dispatchEvent(bh)}scaleRadialComponent(e,r,i){let o=Math.abs(e);return Math.sign(e)*Math.pow(Math.max(0,o-this.edgeFactor)/(1-this.edgeFactor),i)*r}updateOrientation(){let e=hi(this.renderer,this.camera);_h.makeRotationY(this._heading),this.stage.matrix.makeTranslation(this.stage.position.x,this.stage.position.y,this.stage.position.z).multiply(_h),this.stage.matrix.decompose(this.stage.position,this.stage.quaternion,this.stage.scale),this.renderer.xr.isPresenting?(xh.copy(this.stage.matrixWorld).invert(),this.head.position.copy(e.position).applyMatrix4(xh),this.head.quaternion.copy(this.stage.quaternion).invert().multiply(e.quaternion)):(this.head.position.set(0,this._height,0),fi.set(this._pitch,0,this._roll,"XYZ"),this.head.quaternion.setFromEuler(fi).premultiply(this.deviceQ)),this.camera.position.copy(this.head.position),this.camera.quaternion.copy(this.head.quaternion),this.head.getWorldPosition(this.worldPos),this.head.getWorldDirection(xr),this._worldHeading=ua(xr),this._worldPitch=ph(xr),fh(this.head.matrixWorld,gA,_a,xr,ba)}reset(){this.stage.position.set(0,0,0),this.setHeadingImmediate(0)}resetFollowers(){for(let e of this.followers)e.reset(this.height,this.worldPos,this.worldHeading)}async getPermission(){return"DeviceOrientationEvent"in globalThis?AA(DeviceOrientationEvent)?await DeviceOrientationEvent.requestPermission():"granted":"not-supported"}async startMotionControl(){if(!this.motionEnabled){this.onScreenOrientationChangeEvent();let e=await this.getPermission();this.motionEnabled=e==="granted",this.motionEnabled&&(globalThis.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),globalThis.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}}stopMotionControl(){this.motionEnabled&&(globalThis.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),globalThis.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.motionEnabled=!1)}dispose(){this.stopMotionControl()}};var ya=class{constructor(t){this.camera=t;this.fovZoomEnabled=!0;this.minFOV=15;this.maxFOV=120;this.dz=0}onMove(t){t.pointer.enabled&&t.pointer.canMoveView&&t.pointer.state.dz!==0&&(this.dz=t.pointer.state.dz)}get fov(){return this.camera.fov}set fov(t){t!==this.fov&&(this.camera.fov=t,this.camera.updateProjectionMatrix())}update(t){if(this.fovZoomEnabled&&Math.abs(this.dz)>0){let e=Math.pow(.95,5*t);this.dz=qi(e*this.dz),this.fov=Ct(this.camera.fov-this.dz,this.minFOV,this.maxFOV)}}};var wa=0;var xi=3;function Eh(n,t){n=wt(n),n.traverse(e=>e.layers.set(t))}function yh(n,t){n=wt(n),n.traverse(e=>e.layers.enable(t))}var Qc=new THREE.Vector3,go=new THREE.Vector3,wh=new THREE.Quaternion,Ht=class{constructor(){this._object=null;this._visible=!0;this._style="default"}get object(){return this._object}set object(t){this._object=t}get style(){return this._style}set style(t){this._style=t}get visible(){return this._visible}set visible(t){this._visible=t}update(t,e,r,i,o,s,a){e&&e.face?(this.position.copy(e.point),e.object.getWorldQuaternion(wh),Qc.copy(e.face.normal).applyQuaternion(wh),go.copy(Qc).multiplyScalar(.02),this.position.add(go),go.copy(Qc).multiplyScalar(10).add(this.position)):(this.position.copy(a).multiplyScalar(r).add(s),go.copy(t)),this.object.parent.worldToLocal(this.position),this.lookAt(go),this.style=e?Fm(e)?"not-allowed":dr(e)?o.dragging?"grabbing":"move":pr(e)?"pointer":"default":i?o.buttons===1?"grabbing":"grab":"default"}lookAt(t){}};var gi=class extends Ht{constructor(e){super();this.cursorSystem=null;this.object=new THREE.Object3D,this.cursorSystem=e}add(e,r){this.object.add(r),yh(r,xi),r.visible=e==="default"}get position(){return this.object.position}get style(){for(let e of this.object.children)if(e.visible)return e.name;return null}set style(e){for(let r of this.object.children)r.visible=r.name===e;if(this.style==null&&this.object.children.length>0){let r=$e(this.object.children,i=>i.name==="default",i=>i!=null);r!=null&&(r.visible=!0)}this.cursorSystem&&(this.cursorSystem.style="none")}get visible(){return oi(this)}set visible(e){Ve(this,e)}lookAt(e){this.object.lookAt(e)}clone(){let e=new gi;for(let r of this.object.children)e.add(r.name,r.clone());return e}};var Ta=class extends j{constructor(e=null){super("objectMoved");this.name=e}px=0;py=0;pz=0;fx=0;fy=0;fz=0;ux=0;uy=0;uz=0;set(e,r,i,o,s,a,p,d,h){this.px=e,this.py=r,this.pz=i,this.fx=o,this.fy=s,this.fz=a,this.ux=p,this.uy=d,this.uz=h}};function mt(n){if(!n||!cr(n.object))return null;let t=n.object;for(;g(t)&&!en(t);)t=t.parent;return t}var Ma=class extends j{constructor(e,r){super(e);this.pointer=r;this._hit=null;this._point=null;this._distance=Number.POSITIVE_INFINITY;this._object=null;Object.seal(this)}get hit(){return this._hit}set hit(e){e!==this.hit&&(this._hit=e,this._point=null,this._distance=Number.POSITIVE_INFINITY,this._object=null,e&&(this._point=e.point,this._distance=e.distance,this._object=mt(e)))}get object(){return this._object}get point(){return this._point}get distance(){return this._distance}to3(e){return new Kc(this.type,this.pointer,e,this.pointer.state.buttons)}},Kc=class{constructor(t,e,r,i){this.type=t;this.pointer=e;this.hit=r;this.buttons=i;this._point=this.hit&&this.hit.point,this._distance=this.hit&&this.hit.distance||Number.POSITIVE_INFINITY,this._object=mt(this.hit)}get object(){return this._object}get point(){return this._point}get distance(){return this._distance}};var Sa=class extends j{constructor(e,r){super(e);this.button=r}},Yc=class extends Sa{constructor(t){super("gamepadbuttonup",t)}},Jc=class extends Sa{constructor(t){super("gamepadbuttondown",t)}},$c=class extends j{constructor(e,r,i){super(e);this.axis=r;this.value=i}},Zc=class extends $c{constructor(t,e){super("gamepadaxismaxed",t,e)}},Ra=class extends Z{constructor(e){super();this.pad=e;this._isStick=r=>r%2===0&&r<e.axes.length-1;for(let r=0;r<e.buttons.length;++r)this.btnDownEvts[r]=new Jc(r),this.btnUpEvts[r]=new Yc(r),this.wasPressed[r]=!1;for(let r=0;r<e.axes.length;++r)this.axisMaxEvts[r]=new Zc(r,0),this.wasAxisMaxed[r]=!1,this._isStick(r)&&(this.sticks[r/2]={x:0,y:0}),this.lastAxisValues[r]=e.axes[r];Object.seal(this)}lastAxisValues=new Array;_isStick;btnDownEvts=new Array;btnUpEvts=new Array;wasPressed=new Array;axisThresholdMax=.9;axisThresholdMin=.1;axisMaxEvts=new Array;wasAxisMaxed=new Array;sticks=new Array;setPad(e){this.pad=e,this.update()}get id(){return this.pad.id}get index(){return this.pad.index}get connected(){return this.pad.connected}get mapping(){return this.pad.mapping}get timestamp(){return this.pad.timestamp}get hand(){return this.pad.hand}get pose(){return this.pad.pose}get buttons(){return this.pad.buttons}get axes(){return this.pad.axes}get hapticActuators(){return this.pad.hapticActuators}update(){for(let e=0;e<this.pad.buttons.length;++e){let r=this.wasPressed[e],i=this.pad.buttons[e].pressed;i!==r&&(this.wasPressed[e]=i,this.dispatchEvent((i?this.btnDownEvts:this.btnUpEvts)[e]))}for(let e=0;e<this.pad.axes.length;++e){let r=this.wasAxisMaxed[e],i=this.pad.axes[e],o=Math.sign(i),s=Math.abs(i),a=s>=this.axisThresholdMax,p=s<=this.axisThresholdMin,d=o*(a?1:p?0:s);a&&!r&&(this.axisMaxEvts[e].value=d,this.dispatchEvent(this.axisMaxEvts[e])),this.wasAxisMaxed[e]=a,this.lastAxisValues[e]=d}for(let e=0;e<this.axes.length-1;e+=2){let r=this.sticks[e/2];r.x=this.axes[e],r.y=this.axes[e+1]}}};var Vn=class extends THREE.Loader{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new rp(e)}),this.register(function(e){return new cp(e)}),this.register(function(e){return new pp(e)}),this.register(function(e){return new ip(e)}),this.register(function(e){return new op(e)}),this.register(function(e){return new sp(e)}),this.register(function(e){return new ap(e)}),this.register(function(e){return new lp(e)}),this.register(function(e){return new tp(e)}),this.register(function(e){return new dp(e)})}load(t,e,r,i){let o=this,s;this.resourcePath!==""?s=this.resourcePath:this.path!==""?s=this.path:s=THREE.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);let a=function(d){i?i(d):console.error(d),o.manager.itemError(t),o.manager.itemEnd(t)},p=new THREE.FileLoader(this.manager);p.setPath(this.path),p.setResponseType("arraybuffer"),p.setRequestHeader(this.requestHeader),p.setWithCredentials(this.withCredentials),p.load(t,function(d){try{o.parse(d,s,function(h){e(h),o.manager.itemEnd(t)},a)}catch(h){a(h)}},r,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,r,i){let o,s={},a={};if(typeof t=="string")o=t;else if(THREE.LoaderUtils.decodeText(new Uint8Array(t,0,4))===Vh){try{s[J.KHR_BINARY_GLTF]=new up(t)}catch(x){i&&i(x);return}o=s[J.KHR_BINARY_GLTF].content}else o=THREE.LoaderUtils.decodeText(new Uint8Array(t));let p=JSON.parse(o);if(p.asset===void 0||p.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let d=new _p(p,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){let x=this.pluginCallbacks[h](d);a[x.name]=x,s[x.name]=!0}if(p.extensionsUsed)for(let h=0;h<p.extensionsUsed.length;++h){let x=p.extensionsUsed[h],A=p.extensionsRequired||[];switch(x){case J.KHR_MATERIALS_UNLIT:s[x]=new np;break;case J.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[x]=new fp;break;case J.KHR_DRACO_MESH_COMPRESSION:s[x]=new mp(p,this.dracoLoader);break;case J.KHR_TEXTURE_TRANSFORM:s[x]=new hp;break;case J.KHR_MESH_QUANTIZATION:s[x]=new xp;break;default:A.indexOf(x)>=0&&a[x]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+x+'".')}}d.setExtensions(s),d.setPlugins(a),d.parse(r,i)}parseAsync(t,e){let r=this;return new Promise(function(i,o){r.parse(t,e,i,o)})}};function _A(){let n={};return{get:function(t){return n[t]},add:function(t,e){n[t]=e},remove:function(t){delete n[t]},removeAll:function(){n={}}}}var J={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},tp=class{constructor(t){this.parser=t,this.name=J.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let t=this.parser,e=this.parser.json.nodes||[];for(let r=0,i=e.length;r<i;r++){let o=e[r];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(t){let e=this.parser,r="light:"+t,i=e.cache.get(r);if(i)return i;let o=e.json,p=((o.extensions&&o.extensions[this.name]||{}).lights||[])[t],d,h=new THREE.Color(16777215);p.color!==void 0&&h.fromArray(p.color);let x=p.range!==void 0?p.range:0;switch(p.type){case"directional":d=new THREE.DirectionalLight(h),d.target.position.set(0,0,-1),d.add(d.target);break;case"point":d=new THREE.PointLight(h),d.distance=x;break;case"spot":d=new THREE.SpotLight(h),d.distance=x,p.spot=p.spot||{},p.spot.innerConeAngle=p.spot.innerConeAngle!==void 0?p.spot.innerConeAngle:0,p.spot.outerConeAngle=p.spot.outerConeAngle!==void 0?p.spot.outerConeAngle:Math.PI/4,d.angle=p.spot.outerConeAngle,d.penumbra=1-p.spot.innerConeAngle/p.spot.outerConeAngle,d.target.position.set(0,0,-1),d.add(d.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+p.type)}return d.position.set(0,0,0),d.decay=2,p.intensity!==void 0&&(d.intensity=p.intensity),d.name=e.createUniqueName(p.name||"light_"+t),i=Promise.resolve(d),e.cache.add(r,i),i}createNodeAttachment(t){let e=this,r=this.parser,o=r.json.nodes[t],a=(o.extensions&&o.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(p){return r._getNodeRef(e.cache,a,p)})}},np=class{constructor(){this.name=J.KHR_MATERIALS_UNLIT}getMaterialType(){return THREE.MeshBasicMaterial}extendParams(t,e,r){let i=[];t.color=new THREE.Color(1,1,1),t.opacity=1;let o=e.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){let s=o.baseColorFactor;t.color.fromArray(s),t.opacity=s[3]}o.baseColorTexture!==void 0&&i.push(r.assignTexture(t,"map",o.baseColorTexture))}return Promise.all(i)}},rp=class{constructor(t){this.parser=t,this.name=J.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let r=this.parser,i=r.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];if(s.clearcoatFactor!==void 0&&(e.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&o.push(r.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&o.push(r.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(o.push(r.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){let a=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new THREE.Vector2(a,a)}return Promise.all(o)}},ip=class{constructor(t){this.parser=t,this.name=J.KHR_MATERIALS_SHEEN}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let r=this.parser,i=r.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[];e.sheenColor=new THREE.Color(0,0,0),e.sheenRoughness=0,e.sheen=1;let s=i.extensions[this.name];return s.sheenColorFactor!==void 0&&e.sheenColor.fromArray(s.sheenColorFactor),s.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&o.push(r.assignTexture(e,"sheenColorMap",s.sheenColorTexture)),s.sheenRoughnessTexture!==void 0&&o.push(r.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(o)}},op=class{constructor(t){this.parser=t,this.name=J.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let r=this.parser,i=r.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];return s.transmissionFactor!==void 0&&(e.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&o.push(r.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(o)}},sp=class{constructor(t){this.parser=t,this.name=J.KHR_MATERIALS_VOLUME}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let r=this.parser,i=r.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];e.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&o.push(r.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||0;let a=s.attenuationColor||[1,1,1];return e.attenuationColor=new THREE.Color(a[0],a[1],a[2]),Promise.all(o)}},ap=class{constructor(t){this.parser=t,this.name=J.KHR_MATERIALS_IOR}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=i.extensions[this.name];return e.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}},lp=class{constructor(t){this.parser=t,this.name=J.KHR_MATERIALS_SPECULAR}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let r=this.parser,i=r.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];e.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&o.push(r.assignTexture(e,"specularIntensityMap",s.specularTexture));let a=s.specularColorFactor||[1,1,1];return e.specularColor=new THREE.Color(a[0],a[1],a[2]),s.specularColorTexture!==void 0&&o.push(r.assignTexture(e,"specularColorMap",s.specularColorTexture).then(function(p){p.encoding=THREE.sRGBEncoding})),Promise.all(o)}},cp=class{constructor(t){this.parser=t,this.name=J.KHR_TEXTURE_BASISU}loadTexture(t){let e=this.parser,r=e.json,i=r.textures[t];if(!i.extensions||!i.extensions[this.name])return null;let o=i.extensions[this.name],s=r.images[o.source],a=e.options.ktx2Loader;if(!a){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,s,a)}},pp=class{constructor(t){this.parser=t,this.name=J.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){let e=this.name,r=this.parser,i=r.json,o=i.textures[t];if(!o.extensions||!o.extensions[e])return null;let s=o.extensions[e],a=i.images[s.source],p=r.textureLoader;if(a.uri){let d=r.options.manager.getHandler(a.uri);d!==null&&(p=d)}return this.detectSupport().then(function(d){if(d)return r.loadTextureImage(t,a,p);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){let e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}},dp=class{constructor(t){this.name=J.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){let e=this.parser.json,r=e.bufferViews[t];if(r.extensions&&r.extensions[this.name]){let i=r.extensions[this.name],o=this.parser.getDependency("buffer",i.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([o,s.ready]).then(function(a){let p=i.byteOffset||0,d=i.byteLength||0,h=i.count,x=i.byteStride,A=new ArrayBuffer(h*x),E=new Uint8Array(a[0],p,d);return s.decodeGltfBuffer(new Uint8Array(A),h,x,E,i.mode,i.filter),A})}else return null}},Vh="glTF",vo=12,Th={JSON:1313821514,BIN:5130562},up=class{constructor(t){this.name=J.KHR_BINARY_GLTF,this.content=null,this.body=null;let e=new DataView(t,0,vo);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Vh)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-vo,i=new DataView(t,vo),o=0;for(;o<r;){let s=i.getUint32(o,!0);o+=4;let a=i.getUint32(o,!0);if(o+=4,a===Th.JSON){let p=new Uint8Array(t,vo+o,s);this.content=THREE.LoaderUtils.decodeText(p)}else if(a===Th.BIN){let p=vo+o;this.body=t.slice(p,p+s)}o+=s}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},mp=class{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=J.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){let r=this.json,i=this.dracoLoader,o=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,a={},p={},d={};for(let h in s){let x=vp[h]||h.toLowerCase();a[x]=s[h]}for(let h in t.attributes){let x=vp[h]||h.toLowerCase();if(s[h]!==void 0){let A=r.accessors[t.attributes[h]],E=bo[A.componentType];d[x]=E,p[x]=A.normalized===!0}}return e.getDependency("bufferView",o).then(function(h){return new Promise(function(x){i.decodeDracoFile(h,function(A){for(let E in A.attributes){let S=A.attributes[E],P=p[E];P!==void 0&&(S.normalized=P)}x(A)},a,d)})})}},hp=class{constructor(){this.name=J.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return e.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}},_o=class extends THREE.MeshStandardMaterial{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;let e=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),r=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new THREE.Color().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(p){for(let d in a)p.uniforms[d]=a[d];p.fragmentShader=p.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(p){a.specular.value=p}},specularMap:{get:function(){return a.specularMap.value},set:function(p){a.specularMap.value=p,p?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(p){a.glossiness.value=p}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(p){a.glossinessMap.value=p,p?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}},fp=class{constructor(){this.name=J.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return _o}extendParams(t,e,r){let i=e.extensions[this.name];t.color=new THREE.Color(1,1,1),t.opacity=1;let o=[];if(Array.isArray(i.diffuseFactor)){let s=i.diffuseFactor;t.color.fromArray(s),t.opacity=s[3]}if(i.diffuseTexture!==void 0&&o.push(r.assignTexture(t,"map",i.diffuseTexture)),t.emissive=new THREE.Color(0,0,0),t.glossiness=i.glossinessFactor!==void 0?i.glossinessFactor:1,t.specular=new THREE.Color(1,1,1),Array.isArray(i.specularFactor)&&t.specular.fromArray(i.specularFactor),i.specularGlossinessTexture!==void 0){let s=i.specularGlossinessTexture;o.push(r.assignTexture(t,"glossinessMap",s)),o.push(r.assignTexture(t,"specularMap",s))}return Promise.all(o)}createMaterial(t){let e=new _o(t);return e.fog=!0,e.color=t.color,e.map=t.map===void 0?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=t.aoMap===void 0?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=t.emissiveMap===void 0?null:t.emissiveMap,e.bumpMap=t.bumpMap===void 0?null:t.bumpMap,e.bumpScale=1,e.normalMap=t.normalMap===void 0?null:t.normalMap,e.normalMapType=THREE.TangentSpaceNormalMap,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=t.specularMap===void 0?null:t.specularMap,e.specular=t.specular,e.glossinessMap=t.glossinessMap===void 0?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=t.envMap===void 0?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}},xp=class{constructor(){this.name=J.KHR_MESH_QUANTIZATION}},nn=class extends THREE.Interpolant{constructor(t,e,r,i){super(t,e,r,i)}copySampleValue_(t){let e=this.resultBuffer,r=this.sampleValues,i=this.valueSize,o=t*i*3+i;for(let s=0;s!==i;s++)e[s]=r[o+s];return e}};nn.prototype.beforeStart_=nn.prototype.copySampleValue_;nn.prototype.afterEnd_=nn.prototype.copySampleValue_;nn.prototype.interpolate_=function(n,t,e,r){let i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=s*2,p=s*3,d=r-t,h=(e-t)/d,x=h*h,A=x*h,E=n*p,S=E-p,P=-2*A+3*x,R=A-x,V=1-P,B=R-x+h;for(let L=0;L!==s;L++){let k=o[S+L+s],H=o[S+L+a]*d,C=o[E+L+s],D=o[E+L]*d;i[L]=V*k+B*H+P*C+R*D}return i};var bA=new THREE.Quaternion,gp=class extends nn{interpolate_(t,e,r,i){let o=super.interpolate_(t,e,r,i);return bA.fromArray(o).normalize().toArray(o),o}},tn={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},bo={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Mh={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},Sh={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},Rh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vp={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Cn={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},EA={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},ep={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function yA(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),n.DefaultMaterial}function Ao(n,t,e){for(let r in e.extensions)n[r]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=e.extensions[r])}function gr(n,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(n.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function wA(n,t,e){let r=!1,i=!1;for(let a=0,p=t.length;a<p;a++){let d=t[a];if(d.POSITION!==void 0&&(r=!0),d.NORMAL!==void 0&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(n);let o=[],s=[];for(let a=0,p=t.length;a<p;a++){let d=t[a];if(r){let h=d.POSITION!==void 0?e.getDependency("accessor",d.POSITION):n.attributes.position;o.push(h)}if(i){let h=d.NORMAL!==void 0?e.getDependency("accessor",d.NORMAL):n.attributes.normal;s.push(h)}}return Promise.all([Promise.all(o),Promise.all(s)]).then(function(a){let p=a[0],d=a[1];return r&&(n.morphAttributes.position=p),i&&(n.morphAttributes.normal=d),n.morphTargetsRelative=!0,n})}function TA(n,t){if(n.updateMorphTargets(),t.weights!==void 0)for(let e=0,r=t.weights.length;e<r;e++)n.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){let e=t.extras.targetNames;if(n.morphTargetInfluences.length===e.length){n.morphTargetDictionary={};for(let r=0,i=e.length;r<i;r++)n.morphTargetDictionary[e[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function MA(n){let t=n.extensions&&n.extensions[J.KHR_DRACO_MESH_COMPRESSION],e;return t?e="draco:"+t.bufferView+":"+t.indices+":"+Ph(t.attributes):e=n.indices+":"+Ph(n.attributes)+":"+n.mode,e}function Ph(n){let t="",e=Object.keys(n).sort();for(let r=0,i=e.length;r<i;r++)t+=e[r]+":"+n[e[r]]+";";return t}function Ap(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var _p=class{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new _A,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap<"u"&&/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!1?this.textureLoader=new THREE.ImageBitmapLoader(this.options.manager):this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){let r=this,i=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(s){let a={scene:s[0][i.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:i.asset,parser:r,userData:{}};Ao(o,a,i),gr(a,i),Promise.all(r._invokeAll(function(p){return p.afterRoot&&p.afterRoot(a)})).then(function(){t(a)})}).catch(e)}_markDefs(){let t=this.json.nodes||[],e=this.json.skins||[],r=this.json.meshes||[];for(let i=0,o=e.length;i<o;i++){let s=e[i].joints;for(let a=0,p=s.length;a<p;a++)t[s[a]].isBone=!0}for(let i=0,o=t.length;i<o;i++){let s=t[i];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(r[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,r){if(t.refs[e]<=1)return r;let i=r.clone(),o=(s,a)=>{let p=this.associations.get(s);p!=null&&this.associations.set(a,p);for(let[d,h]of s.children.entries())o(h,a.children[d])};return o(r,i),i.name+="_instance_"+t.uses[e]++,i}_invokeOne(t){let e=Object.values(this.plugins);e.push(this);for(let r=0;r<e.length;r++){let i=t(e[r]);if(i)return i}return null}_invokeAll(t){let e=Object.values(this.plugins);e.unshift(this);let r=[];for(let i=0;i<e.length;i++){let o=t(e[i]);o&&r.push(o)}return r}getDependency(t,e){let r=t+":"+e,i=this.cache.get(r);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this.loadNode(e);break;case"mesh":i=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(e)});break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(e)});break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(e)});break;case"texture":i=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(e)});break;case"skin":i=this.loadSkin(e);break;case"animation":i=this.loadAnimation(e);break;case"camera":i=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(r,i)}return i}getDependencies(t){let e=this.cache.get(t);if(!e){let r=this,i=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(i.map(function(o,s){return r.getDependency(t,s)})),this.cache.add(t,e)}return e}loadBuffer(t){let e=this.json.buffers[t],r=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[J.KHR_BINARY_GLTF].body);let i=this.options;return new Promise(function(o,s){r.load(THREE.LoaderUtils.resolveURL(e.uri,i.path),o,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){let e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(r){let i=e.byteLength||0,o=e.byteOffset||0;return r.slice(o,o+i)})}loadAccessor(t){let e=this,r=this.json,i=this.json.accessors[t];if(i.bufferView===void 0&&i.sparse===void 0)return Promise.resolve(null);let o=[];return i.bufferView!==void 0?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),i.sparse!==void 0&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then(function(s){let a=s[0],p=Rh[i.type],d=bo[i.componentType],h=d.BYTES_PER_ELEMENT,x=h*p,A=i.byteOffset||0,E=i.bufferView!==void 0?r.bufferViews[i.bufferView].byteStride:void 0,S=i.normalized===!0,P,R;if(E&&E!==x){let V=Math.floor(A/E),B="THREE.InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+V+":"+i.count,L=e.cache.get(B);L||(P=new d(a,V*E,i.count*E/h),L=new THREE.InterleavedBuffer(P,E/h),e.cache.add(B,L)),R=new THREE.InterleavedBufferAttribute(L,p,A%E/h,S)}else a===null?P=new d(i.count*p):P=new d(a,A,i.count*p),R=new THREE.BufferAttribute(P,p,S);if(i.sparse!==void 0){let V=Rh.SCALAR,B=bo[i.sparse.indices.componentType],L=i.sparse.indices.byteOffset||0,k=i.sparse.values.byteOffset||0,H=new B(s[1],L,i.sparse.count*V),C=new d(s[2],k,i.sparse.count*p);a!==null&&(R=new THREE.BufferAttribute(R.array.slice(),R.itemSize,R.normalized));for(let D=0,$=H.length;D<$;D++){let W=H[D];if(R.setX(W,C[D*p]),p>=2&&R.setY(W,C[D*p+1]),p>=3&&R.setZ(W,C[D*p+2]),p>=4&&R.setW(W,C[D*p+3]),p>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.")}}return R})}loadTexture(t){let e=this.json,r=this.options,i=e.textures[t],o=e.images[i.source],s=this.textureLoader;if(o.uri){let a=r.manager.getHandler(o.uri);a!==null&&(s=a)}return this.loadTextureImage(t,o,s)}loadTextureImage(t,e,r){let i=this,o=this.json,s=this.options,a=o.textures[t],p=(e.uri||e.bufferView)+":"+a.sampler;if(this.textureCache[p])return this.textureCache[p];let d=self.URL||self.webkitURL,h=e.uri||"",x=!1;if(e.bufferView!==void 0)h=i.getDependency("bufferView",e.bufferView).then(function(E){x=!0;let S=new Blob([E],{type:e.mimeType});return h=d.createObjectURL(S),h});else if(e.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");let A=Promise.resolve(h).then(function(E){return new Promise(function(S,P){let R=S;r.isImageBitmapLoader===!0&&(R=function(V){let B=new THREE.Texture(V);B.needsUpdate=!0,S(B)}),r.load(THREE.LoaderUtils.resolveURL(E,s.path),R,void 0,P)})}).then(function(E){x===!0&&d.revokeObjectURL(h),E.flipY=!1,a.name&&(E.name=a.name);let P=(o.samplers||{})[a.sampler]||{};return E.magFilter=Mh[P.magFilter]||THREE.LinearFilter,E.minFilter=Mh[P.minFilter]||THREE.LinearMipmapLinearFilter,E.wrapS=Sh[P.wrapS]||THREE.RepeatWrapping,E.wrapT=Sh[P.wrapT]||THREE.RepeatWrapping,i.associations.set(E,{textures:t}),E}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",h),null});return this.textureCache[p]=A,A}assignTexture(t,e,r){let i=this;return this.getDependency("texture",r.index).then(function(o){if(r.texCoord!==void 0&&r.texCoord!=0&&!(e==="aoMap"&&r.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+e+" not yet supported."),i.extensions[J.KHR_TEXTURE_TRANSFORM]){let s=r.extensions!==void 0?r.extensions[J.KHR_TEXTURE_TRANSFORM]:void 0;if(s){let a=i.associations.get(o);o=i.extensions[J.KHR_TEXTURE_TRANSFORM].extendTexture(o,s),i.associations.set(o,a)}}return t[e]=o,o})}assignFinalMaterial(t){let e=t.geometry,r=t.material,i=e.attributes.tangent===void 0,o=e.attributes.color!==void 0,s=e.attributes.normal===void 0;if(t.isPoints){let a="THREE.PointsMaterial:"+r.uuid,p=this.cache.get(a);p||(p=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(p,r),p.color.copy(r.color),p.map=r.map,p.sizeAttenuation=!1,this.cache.add(a,p)),r=p}else if(t.isLine){let a="THREE.LineBasicMaterial:"+r.uuid,p=this.cache.get(a);p||(p=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(p,r),p.color.copy(r.color),this.cache.add(a,p)),r=p}if(i||o||s){let a="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(a+="specular-glossiness:"),i&&(a+="derivative-tangents:"),o&&(a+="vertex-colors:"),s&&(a+="flat-shading:");let p=this.cache.get(a);p||(p=r.clone(),o&&(p.vertexColors=!0),s&&(p.flatShading=!0),i&&(p.normalScale&&(p.normalScale.y*=-1),p.clearcoatNormalScale&&(p.clearcoatNormalScale.y*=-1)),this.cache.add(a,p),this.associations.set(p,this.associations.get(r))),r=p}r.aoMap&&e.attributes.uv2===void 0&&e.attributes.uv!==void 0&&e.setAttribute("uv2",e.attributes.uv),t.material=r}getMaterialType(){return THREE.MeshStandardMaterial}loadMaterial(t){let e=this,r=this.json,i=this.extensions,o=r.materials[t],s,a={},p=o.extensions||{},d=[];if(p[J.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){let x=i[J.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=x.getMaterialType(),d.push(x.extendParams(a,o,e))}else if(p[J.KHR_MATERIALS_UNLIT]){let x=i[J.KHR_MATERIALS_UNLIT];s=x.getMaterialType(),d.push(x.extendParams(a,o,e))}else{let x=o.pbrMetallicRoughness||{};if(a.color=new THREE.Color(1,1,1),a.opacity=1,Array.isArray(x.baseColorFactor)){let A=x.baseColorFactor;a.color.fromArray(A),a.opacity=A[3]}x.baseColorTexture!==void 0&&d.push(e.assignTexture(a,"map",x.baseColorTexture)),a.metalness=x.metallicFactor!==void 0?x.metallicFactor:1,a.roughness=x.roughnessFactor!==void 0?x.roughnessFactor:1,x.metallicRoughnessTexture!==void 0&&(d.push(e.assignTexture(a,"metalnessMap",x.metallicRoughnessTexture)),d.push(e.assignTexture(a,"roughnessMap",x.metallicRoughnessTexture))),s=this._invokeOne(function(A){return A.getMaterialType&&A.getMaterialType(t)}),d.push(Promise.all(this._invokeAll(function(A){return A.extendMaterialParams&&A.extendMaterialParams(t,a)})))}o.doubleSided===!0&&(a.side=THREE.DoubleSide);let h=o.alphaMode||ep.OPAQUE;if(h===ep.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===ep.MASK&&(a.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&s!==THREE.MeshBasicMaterial&&(d.push(e.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new THREE.Vector2(1,1),o.normalTexture.scale!==void 0)){let x=o.normalTexture.scale;a.normalScale.set(x,x)}return o.occlusionTexture!==void 0&&s!==THREE.MeshBasicMaterial&&(d.push(e.assignTexture(a,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&s!==THREE.MeshBasicMaterial&&(a.emissive=new THREE.Color().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&s!==THREE.MeshBasicMaterial&&d.push(e.assignTexture(a,"emissiveMap",o.emissiveTexture)),Promise.all(d).then(function(){let x;return s===_o?x=i[J.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):x=new s(a),o.name&&(x.name=o.name),x.map&&(x.map.encoding=THREE.sRGBEncoding),x.emissiveMap&&(x.emissiveMap.encoding=THREE.sRGBEncoding),gr(x,o),e.associations.set(x,{materials:t}),o.extensions&&Ao(i,x,o),x})}createUniqueName(t){let e=THREE.PropertyBinding.sanitizeNodeName(t||""),r=e;for(let i=1;this.nodeNamesUsed[r];++i)r=e+"_"+i;return this.nodeNamesUsed[r]=!0,r}loadGeometries(t){let e=this,r=this.extensions,i=this.primitiveCache;function o(a){return r[J.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,e).then(function(p){return Ih(p,a,e)})}let s=[];for(let a=0,p=t.length;a<p;a++){let d=t[a],h=MA(d),x=i[h];if(x)s.push(x.promise);else{let A;d.extensions&&d.extensions[J.KHR_DRACO_MESH_COMPRESSION]?A=o(d):A=Ih(new THREE.BufferGeometry,d,e),i[h]={primitive:d,promise:A},s.push(A)}}return Promise.all(s)}loadMesh(t){let e=this,r=this.json,i=this.extensions,o=r.meshes[t],s=o.primitives,a=[];for(let p=0,d=s.length;p<d;p++){let h=s[p].material===void 0?yA(this.cache):this.getDependency("material",s[p].material);a.push(h)}return a.push(e.loadGeometries(s)),Promise.all(a).then(function(p){let d=p.slice(0,p.length-1),h=p[p.length-1],x=[];for(let E=0,S=h.length;E<S;E++){let P=h[E],R=s[E],V,B=d[E];if(R.mode===tn.TRIANGLES||R.mode===tn.TRIANGLE_STRIP||R.mode===tn.TRIANGLE_FAN||R.mode===void 0)V=o.isSkinnedMesh===!0?new THREE.SkinnedMesh(P,B):new THREE.Mesh(P,B),V.isSkinnedMesh===!0&&!V.geometry.attributes.skinWeight.normalized&&V.normalizeSkinWeights(),R.mode===tn.TRIANGLE_STRIP?V.geometry=Ch(V.geometry,THREE.TriangleStripDrawMode):R.mode===tn.TRIANGLE_FAN&&(V.geometry=Ch(V.geometry,THREE.TriangleFanDrawMode));else if(R.mode===tn.LINES)V=new THREE.LineSegments(P,B);else if(R.mode===tn.LINE_STRIP)V=new THREE.Line(P,B);else if(R.mode===tn.LINE_LOOP)V=new THREE.LineLoop(P,B);else if(R.mode===tn.POINTS)V=new THREE.Points(P,B);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+R.mode);Object.keys(V.geometry.morphAttributes).length>0&&TA(V,o),V.name=e.createUniqueName(o.name||"mesh_"+t),gr(V,o),R.extensions&&Ao(i,V,R),e.assignFinalMaterial(V),x.push(V)}for(let E=0,S=x.length;E<S;E++)e.associations.set(x[E],{meshes:t,primitives:E});if(x.length===1)return x[0];let A=new THREE.Group;e.associations.set(A,{meshes:t});for(let E=0,S=x.length;E<S;E++)A.add(x[E]);return A})}loadCamera(t){let e,r=this.json.cameras[t],i=r[r.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?e=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):r.type==="orthographic"&&(e=new THREE.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(e.name=this.createUniqueName(r.name)),gr(e,r),Promise.resolve(e)}loadSkin(t){let e=this.json.skins[t],r={joints:e.joints};return e.inverseBindMatrices===void 0?Promise.resolve(r):this.getDependency("accessor",e.inverseBindMatrices).then(function(i){return r.inverseBindMatrices=i,r})}loadAnimation(t){let r=this.json.animations[t],i=[],o=[],s=[],a=[],p=[];for(let d=0,h=r.channels.length;d<h;d++){let x=r.channels[d],A=r.samplers[x.sampler],E=x.target,S=E.node!==void 0?E.node:E.id,P=r.parameters!==void 0?r.parameters[A.input]:A.input,R=r.parameters!==void 0?r.parameters[A.output]:A.output;i.push(this.getDependency("node",S)),o.push(this.getDependency("accessor",P)),s.push(this.getDependency("accessor",R)),a.push(A),p.push(E)}return Promise.all([Promise.all(i),Promise.all(o),Promise.all(s),Promise.all(a),Promise.all(p)]).then(function(d){let h=d[0],x=d[1],A=d[2],E=d[3],S=d[4],P=[];for(let V=0,B=h.length;V<B;V++){let L=h[V],k=x[V],H=A[V],C=E[V],D=S[V];if(L===void 0)continue;L.updateMatrix(),L.matrixAutoUpdate=!0;let $;switch(Cn[D.path]){case Cn.weights:$=THREE.NumberKeyframeTrack;break;case Cn.rotation:$=THREE.QuaternionKeyframeTrack;break;case Cn.position:case Cn.scale:default:$=THREE.VectorKeyframeTrack;break}let W=L.name?L.name:L.uuid,z=C.interpolation!==void 0?EA[C.interpolation]:THREE.InterpolateLinear,K=[];Cn[D.path]===Cn.weights?L.traverse(function(ge){ge.morphTargetInfluences&&K.push(ge.name?ge.name:ge.uuid)}):K.push(W);let be=H.array;if(H.normalized){let ge=Ap(be.constructor),ne=new Float32Array(be.length);for(let Qe=0,Dr=be.length;Qe<Dr;Qe++)ne[Qe]=be[Qe]*ge;be=ne}for(let ge=0,ne=K.length;ge<ne;ge++){let Qe=new $(K[ge]+"."+Cn[D.path],k.array,be,z);C.interpolation==="CUBICSPLINE"&&(Qe.createInterpolant=function(dn){let Gt=this instanceof THREE.QuaternionKeyframeTrack?gp:nn;return new Gt(this.times,this.values,this.getValueSize()/3,dn)},Qe.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),P.push(Qe)}}let R=r.name?r.name:"animation_"+t;return new THREE.AnimationClip(R,void 0,P)})}createNodeMesh(t){let e=this.json,r=this,i=e.nodes[t];return i.mesh===void 0?null:r.getDependency("mesh",i.mesh).then(function(o){let s=r._getNodeRef(r.meshCache,i.mesh,o);return i.weights!==void 0&&s.traverse(function(a){if(!!a.isMesh)for(let p=0,d=i.weights.length;p<d;p++)a.morphTargetInfluences[p]=i.weights[p]}),s})}loadNode(t){let e=this.json,r=this.extensions,i=this,o=e.nodes[t],s=o.name?i.createUniqueName(o.name):"";return function(){let a=[],p=i._invokeOne(function(d){return d.createNodeMesh&&d.createNodeMesh(t)});return p&&a.push(p),o.camera!==void 0&&a.push(i.getDependency("camera",o.camera).then(function(d){return i._getNodeRef(i.cameraCache,o.camera,d)})),i._invokeAll(function(d){return d.createNodeAttachment&&d.createNodeAttachment(t)}).forEach(function(d){a.push(d)}),Promise.all(a)}().then(function(a){let p;if(o.isBone===!0?p=new THREE.Bone:a.length>1?p=new THREE.Group:a.length===1?p=a[0]:p=new THREE.Object3D,p!==a[0])for(let d=0,h=a.length;d<h;d++)p.add(a[d]);if(o.name&&(p.userData.name=o.name,p.name=s),gr(p,o),o.extensions&&Ao(r,p,o),o.matrix!==void 0){let d=new THREE.Matrix4;d.fromArray(o.matrix),p.applyMatrix4(d)}else o.translation!==void 0&&p.position.fromArray(o.translation),o.rotation!==void 0&&p.quaternion.fromArray(o.rotation),o.scale!==void 0&&p.scale.fromArray(o.scale);return i.associations.has(p)||i.associations.set(p,{}),i.associations.get(p).nodes=t,p})}loadScene(t){let e=this.json,r=this.extensions,i=this.json.scenes[t],o=this,s=new THREE.Group;i.name&&(s.name=o.createUniqueName(i.name)),gr(s,i),i.extensions&&Ao(r,s,i);let a=i.nodes||[],p=[];for(let d=0,h=a.length;d<h;d++)p.push(Lh(a[d],s,e,o));return Promise.all(p).then(function(){let d=h=>{let x=new Map;for(let[A,E]of o.associations)(A instanceof THREE.Material||A instanceof THREE.Texture)&&x.set(A,E);return h.traverse(A=>{let E=o.associations.get(A);E!=null&&x.set(A,E)}),x};return o.associations=d(s),s})}};function Lh(n,t,e,r){let i=e.nodes[n];return r.getDependency("node",n).then(function(o){if(i.skin===void 0)return o;let s;return r.getDependency("skin",i.skin).then(function(a){s=a;let p=[];for(let d=0,h=s.joints.length;d<h;d++)p.push(r.getDependency("node",s.joints[d]));return Promise.all(p)}).then(function(a){return o.traverse(function(p){if(!p.isMesh)return;let d=[],h=[];for(let x=0,A=a.length;x<A;x++){let E=a[x];if(E){d.push(E);let S=new THREE.Matrix4;s.inverseBindMatrices!==void 0&&S.fromArray(s.inverseBindMatrices.array,x*16),h.push(S)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[x])}p.bind(new THREE.Skeleton(d,h),p.matrixWorld)}),o})}).then(function(o){t.add(o);let s=[];if(i.children){let a=i.children;for(let p=0,d=a.length;p<d;p++){let h=a[p];s.push(Lh(h,o,e,r))}}return Promise.all(s)})}function SA(n,t,e){let r=t.attributes,i=new THREE.Box3;if(r.POSITION!==void 0){let a=e.json.accessors[r.POSITION],p=a.min,d=a.max;if(p!==void 0&&d!==void 0){if(i.set(new THREE.Vector3(p[0],p[1],p[2]),new THREE.Vector3(d[0],d[1],d[2])),a.normalized){let h=Ap(bo[a.componentType]);i.min.multiplyScalar(h),i.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let o=t.targets;if(o!==void 0){let a=new THREE.Vector3,p=new THREE.Vector3;for(let d=0,h=o.length;d<h;d++){let x=o[d];if(x.POSITION!==void 0){let A=e.json.accessors[x.POSITION],E=A.min,S=A.max;if(E!==void 0&&S!==void 0){if(p.setX(Math.max(Math.abs(E[0]),Math.abs(S[0]))),p.setY(Math.max(Math.abs(E[1]),Math.abs(S[1]))),p.setZ(Math.max(Math.abs(E[2]),Math.abs(S[2]))),A.normalized){let P=Ap(bo[A.componentType]);p.multiplyScalar(P)}a.max(p)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}n.boundingBox=i;let s=new THREE.Sphere;i.getCenter(s.center),s.radius=i.min.distanceTo(i.max)/2,n.boundingSphere=s}function Ih(n,t,e){let r=t.attributes,i=[];function o(s,a){return e.getDependency("accessor",s).then(function(p){n.setAttribute(a,p)})}for(let s in r){let a=vp[s]||s.toLowerCase();a in n.attributes||i.push(o(r[s],a))}if(t.indices!==void 0&&!n.index){let s=e.getDependency("accessor",t.indices).then(function(a){n.setIndex(a)});i.push(s)}return gr(n,t),SA(n,t,e),Promise.all(i).then(function(){return t.targets!==void 0?wA(n,t.targets,e):n})}function Ch(n,t){let e=n.getIndex();if(e===null){let s=[],a=n.getAttribute("position");if(a!==void 0){for(let p=0;p<a.count;p++)s.push(p);n.setIndex(s),e=n.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}let r=e.count-2,i=[];if(t===THREE.TriangleFanDrawMode)for(let s=1;s<=r;s++)i.push(e.getX(0)),i.push(e.getX(s)),i.push(e.getX(s+1));else for(let s=0;s<r;s++)s%2===0?(i.push(e.getX(s)),i.push(e.getX(s+1)),i.push(e.getX(s+2))):(i.push(e.getX(s+2)),i.push(e.getX(s+1)),i.push(e.getX(s)));i.length/3!==r&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let o=n.clone();return o.setIndex(i),o}var xe={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function kh(n){let t=await fetch(n);if(t.ok)return t.json();throw new Error(t.statusText)}async function RA(n){if(!n)throw new Error("No basePath supplied");return await kh(`${n}/profilesList.json`)}async function Dh(n,t,e=null,r=!0){if(!n)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");let i=await RA(t),o;if(n.profiles.some(p=>{let d=i[p];return d&&(o={profileId:p,profilePath:`${t}/${d.path}`,deprecated:!!d.deprecated}),!!o}),!o){if(!e)throw new Error("No matching profile name found");let p=i[e];if(!p)throw new Error(`No matching profile name found and default profile "${e}" missing.`);o={profileId:e,profilePath:`${t}/${p.path}`,deprecated:!!p.deprecated}}let s=await kh(o.profilePath),a;if(r){let p;if(n.handedness==="any"?p=s.layouts[Object.keys(s.layouts)[0]]:p=s.layouts[n.handedness],!p)throw new Error(`No matching handedness, ${n.handedness}, in profile ${o.profileId}`);p.assetPath&&(a=o.profilePath.replace("profile.json",p.assetPath))}return{profile:s,assetPath:a}}var PA={xAxis:0,yAxis:0,button:0,state:xe.ComponentState.DEFAULT};function IA(n=0,t=0){let e=n,r=t;if(Math.sqrt(n*n+t*t)>1){let s=Math.atan2(t,n);e=Math.cos(s),r=Math.sin(s)}return{normalizedXAxis:e*.5+.5,normalizedYAxis:r*.5+.5}}var bp=class{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===xe.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(PA)}updateFromComponent({xAxis:t,yAxis:e,button:r,state:i}){let{normalizedXAxis:o,normalizedYAxis:s}=IA(t,e);switch(this.componentProperty){case xe.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?o:.5;break;case xe.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?s:.5;break;case xe.ComponentProperty.BUTTON:this.value=this.states.includes(i)?r:0;break;case xe.ComponentProperty.STATE:this.valueNodeProperty===xe.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},Ep=class{constructor(t,e){if(!t||!e||!e.visualResponses||!e.gamepadIndices||Object.keys(e.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach(r=>{let i=new bp(e.visualResponses[r]);this.visualResponses[r]=i}),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:xe.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(t){if(this.values.state=xe.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&t.buttons.length>this.gamepadIndices.button){let e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||this.values.button===1?this.values.state=xe.ComponentState.PRESSED:(e.touched||this.values.button>xe.ButtonTouchThreshold)&&(this.values.state=xe.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===xe.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>xe.AxisTouchThreshold&&(this.values.state=xe.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===xe.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>xe.AxisTouchThreshold&&(this.values.state=xe.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}},Pa=class{constructor(t,e,r){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=r,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(i=>{let o=this.layoutDescription.components[i];this.components[i]=new Ep(i,o)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let t=[];return Object.values(this.components).forEach(e=>{t.push(e.data)}),t}updateFromGamepad(){Object.values(this.components).forEach(t=>{t.updateFromGamepad(this.xrInputSource.gamepad)})}};var CA="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",VA="generic-trigger",yp=class extends THREE.Object3D{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(t){return this.envMap==t?this:(this.envMap=t,this.traverse(e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}),this)}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(r=>{let{valueNode:i,minNode:o,maxNode:s,value:a,valueNodeProperty:p}=r;!i||(p===xe.VisualResponseProperty.VISIBILITY?i.visible=a:p===xe.VisualResponseProperty.TRANSFORM&&(i.quaternion.slerpQuaternions(o.quaternion,s.quaternion,a),i.position.lerpVectors(o.position,s.position,a)))})}))}};function LA(n,t){Object.values(n.components).forEach(e=>{let{type:r,touchPointNodeName:i,visualResponses:o}=e;if(r===xe.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(i),e.touchPointNode){let s=new THREE.SphereGeometry(.001),a=new THREE.MeshBasicMaterial({color:255}),p=new THREE.Mesh(s,a);e.touchPointNode.add(p)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(o).forEach(s=>{let{valueNodeName:a,minNodeName:p,maxNodeName:d,valueNodeProperty:h}=s;if(h===xe.VisualResponseProperty.TRANSFORM){if(s.minNode=t.getObjectByName(p),s.maxNode=t.getObjectByName(d),!s.minNode){console.warn(`Could not find ${p} in the model`);return}if(!s.maxNode){console.warn(`Could not find ${d} in the model`);return}}s.valueNode=t.getObjectByName(a),s.valueNode||console.warn(`Could not find ${a} in the model`)})})}function Oh(n,t){LA(n.motionController,t),n.envMap&&t.traverse(e=>{e.isMesh&&(e.material.envMap=n.envMap,e.material.needsUpdate=!0)}),n.add(t)}var Ia=class{constructor(t=null){this.gltfLoader=t,this.path=CA,this._assetCache={},this.gltfLoader||(this.gltfLoader=new Vn)}createControllerModel(t){let e=new yp,r=null;return t.addEventListener("connected",i=>{let o=i.data;o.targetRayMode!=="tracked-pointer"||!o.gamepad||Dh(o,this.path,VA).then(({profile:s,assetPath:a})=>{e.motionController=new Pa(o,s,a);let p=this._assetCache[e.motionController.assetUrl];if(p)r=p.scene.clone(),Oh(e,r);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(e.motionController.assetUrl,d=>{this._assetCache[e.motionController.assetUrl]=d,r=d.scene.clone(),Oh(e,r)},null,()=>{throw new Error(`Asset ${e.motionController.assetUrl} missing or malformed.`)})}}).catch(s=>{console.warn(s)})}),t.addEventListener("disconnected",()=>{e.motionController=null,e.remove(r),r=null}),e}};var wp=new THREE.Matrix4,Bh=new THREE.Vector3,Fh=new THREE.Matrix4().identity(),Hh=new THREE.Matrix4().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(Fh.makeRotationY(Math.PI/2),Hh.makeRotationY(-Math.PI/2));var vi=class{constructor(t,e,r,i,o){this.controller=e,this.handModel=t,this.envMap=null,this.oculusBrowserV14Correction=i==="left"?Hh:Fh;let s;!o||!o.primitive||o.primitive==="sphere"?s=new THREE.SphereGeometry(1,10,10):o.primitive==="box"?s=new THREE.BoxGeometry(1,1,1):o.primitive==="bone"&&(s=new THREE.CylinderGeometry(.5,.75,2.25,10,1).rotateX(-Math.PI/2));let a=new THREE.MeshStandardMaterial;this.handMesh=new THREE.InstancedMesh(s,a,30),this.handMesh.instanceMatrix.setUsage(THREE.DynamicDrawUsage),this.handMesh.castShadow=!0,this.handMesh.receiveShadow=!0,this.handModel.add(this.handMesh),this.joints=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]}updateMesh(){let e=this.controller.joints,r=0;for(let i=0;i<this.joints.length;i++){let o=e[this.joints[i]];o.visible&&(Bh.setScalar(o.jointRadius||.008),wp.compose(o.position,o.quaternion,Bh),wp.multiply(this.oculusBrowserV14Correction),this.handMesh.setMatrixAt(i,wp),r++)}this.handMesh.count=r,this.handMesh.instanceMatrix.needsUpdate=!0}};var Tp=new THREE.Quaternion().identity(),Nh=new THREE.Quaternion().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(Tp.setFromAxisAngle({x:0,y:1,z:0},Math.PI/2),Nh.setFromAxisAngle({x:1,y:0,z:0},Math.PI).premultiply(Tp));var kA="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/",Ca=class{constructor(t,e,r,i){this.controller=e,this.handModel=t,this.oculusBrowserV14Correction=i==="left"?Nh:Tp,this.bones=[];let o=new Vn;o.setPath(r||kA),o.load(`${i}.glb`,s=>{let a=s.scene.children[0];this.handModel.add(a);let p=a.getObjectByProperty("type","SkinnedMesh");p.frustumCulled=!1,p.castShadow=!0,p.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(h=>{let x=a.getObjectByName(h);x!==void 0?x.jointName=h:console.warn(`Couldn't find ${h} in ${i} hand mesh`),this.bones.push(x)})})}updateMesh(){let t=this.controller.joints;for(let e=0;e<this.bones.length;e++){let r=this.bones[e];if(r){let i=t[r.jointName];if(i.visible){let o=i.position;r&&(r.position.copy(o),r.quaternion.copy(i.quaternion).multiply(this.oculusBrowserV14Correction))}}}}};var Mp=class extends THREE.Object3D{constructor(t){super(),this.controller=t,this.motionController=null,this.envMap=null,this.mesh=null}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&this.motionController.updateMesh()}},Va=class{constructor(){this.path=null}setPath(t){return this.path=t,this}createHandModel(t,e){let r=new Mp(t);return t.addEventListener("connected",i=>{let o=i.data;o.hand&&!r.motionController&&(r.xrInputSource=o,e===void 0||e==="spheres"?r.motionController=new vi(r,t,this.path,o.handedness,{primitive:"sphere"}):e==="boxes"?r.motionController=new vi(r,t,this.path,o.handedness,{primitive:"box"}):e==="bones"?r.motionController=new vi(r,t,this.path,o.handedness,{primitive:"bone"}):e==="mesh"&&(r.motionController=new Ca(r,t,this.path,o.handedness)))}),t.addEventListener("disconnected",()=>{}),r}};var Eo=class{buttons=0;moveDistance=0;dragDistance=0;x=0;y=0;dx=0;dy=0;dz=0;u=0;v=0;du=0;dv=0;canClick=!1;dragging=!1;ctrl=!1;alt=!1;shift=!1;meta=!1;constructor(){Object.seal(this)}copy(t){this.buttons=t.buttons,this.moveDistance=t.moveDistance,this.dragDistance=t.dragDistance,this.x=t.x,this.y=t.y,this.dx=t.dx,this.dy=t.dy,this.dz=t.dz,this.u=t.u,this.v=t.v,this.du=t.du,this.dv=t.dv,this.canClick=t.canClick,this.dragging=t.dragging,this.ctrl=t.ctrl,this.alt=t.alt,this.shift=t.shift,this.meta=t.meta}};function Xh(n){let t=n.attributes.position,e=n.attributes.normal,r=n.attributes.uv;for(let i=0;i<e.count;++i){let o=i*e.itemSize,s=i*e.itemSize+1,a=i*e.itemSize+2,p=e.array[o],d=e.array[s],h=e.array[a],x=Math.abs(p),A=Math.abs(d),E=Math.abs(h),S=t.array[o],P=t.array[s],R=t.array[a],V=Math.abs(S),B=Math.abs(P),L=Math.abs(R),k=i*r.itemSize,H=i*r.itemSize+1,C=r.array[k],D=r.array[H],$=0,W=x,z=V;A>W&&($=1,W=A,z=B),E>W&&($=2,W=E,z=L),$===0?S<0?(C=-R,D=P):(C=R,D=P):$===1?P<0?(C=S,D=-R):(C=S,D=R):R<0?(C=S,D=P):(C=-S,D=P),C=(C/z+1)/8,D=(D/z+1)/6,$===0?S<0?(C+=0,D+=1/3):(C+=.5,D+=1/3):$===1?P<0?(C+=.25,D+=0):(C+=.25,D+=2/3):R<0?(C+=.25,D+=1/3):(C+=.75,D+=1/3);let K=r.array;K[k]=C,K[H]=D}}var yo=new THREE.BoxBufferGeometry(1,1,1,1,1,1);yo.name="CubeGeom";var jh=yo.clone();jh.name="InvertedCubeGeom";Xh(jh);var Sp=class extends THREE.Mesh{constructor(e,r,i,o,s){super(yo,o);this.isCollider=s;this.scale.set(e,r,i)}},vr=class extends Sp{constructor(e,r,i,o){super(e,r,i,o,!1);this.isDraggable=!1}};var Ai=class extends Ht{constructor(){super();this.material=Mm({name:"CursorMat",color:16776960}),this.object=new vr(.01,.01,.01,this.material)}get position(){return this.object.position}get style(){return this._currentStyle}set style(e){if(this._currentStyle=e,ar(this.object)&&!Be(this.object.material))switch(this._currentStyle){case"pointer":this.material.color=new THREE.Color(65280),this.material.needsUpdate=!0;break;case"not-allowed":this.material.color=new THREE.Color(16711680),this.material.needsUpdate=!0;break;case"move":this.material.color=new THREE.Color(255),this.material.needsUpdate=!0;break;case"grab":this.material.color=new THREE.Color(16711935),this.material.needsUpdate=!0;break;case"grabbing":this.material.color=new THREE.Color(65535),this.material.needsUpdate=!0;break;default:this._currentStyle="default",this.material.color=new THREE.Color(16776960),this.material.needsUpdate=!0;break}}get visible(){return oi(this)}set visible(e){Ve(this,e)}};var La=class extends Ht{constructor(e){super();this.element=e;this._hidden=!1;this.visible=!0,this.style="default",document.addEventListener("pointerlockchange",()=>{this._hidden=!!document.pointerLockElement,this.refresh()})}get position(){throw new Error("BaseCursor::get_Position(): Method not implemented.")}get style(){return super.style}set style(e){super.style=e,this.refresh()}get visible(){return super.visible&&!this._hidden}set visible(e){super.visible=e,this.refresh()}refresh(){this.element.style.cursor=this.visible?this.style:"none"}};var Ln=class extends Ht{constructor(e){super();this.renderer=e;this.xr=new Ai;this.system=new La(this.renderer.domElement),this.visible=!1}get object(){return this.xr.object}get cursor(){return this.xr}set cursor(e){this.xr=e,this._refresh()}get position(){return this.object.position}get style(){return this.system.style}get visible(){return this.renderer.xr.isPresenting&&this.xr.visible||!this.renderer.xr.isPresenting&&this.system.visible}set visible(e){super.visible=e,this._refresh()}set style(e){this.system.style=e,this.xr.style=e,this._refresh()}_refresh(){Ve(this.xr,this.visible&&(this.renderer.xr.isPresenting||document.pointerLockElement!=null))}lookAt(e){this.xr.lookAt(e)}};var DA=5,_i=class{constructor(t,e,r,i){this.type=t;this.name=e;this.evtSys=r;this._canMoveView=!1;this._enabled=!1;this.isActive=!1;this.movementDragThreshold=DA;this.state=new Eo;this.lastState=null;this.origin=new THREE.Vector3;this.direction=new THREE.Vector3;this.curHit=null;this.hoveredHit=null;this._pressedHit=null;this.draggedHit=null;this._cursor=i,this.enabled=!1,this.canMoveView=!1}get pressedHit(){return this._pressedHit}set pressedHit(t){this._pressedHit=t,dr(t)&&!pr(t)&&this.onDragStart()}get canMoveView(){return this._canMoveView}set canMoveView(t){this._canMoveView=t}vibrate(){}get cursor(){return this._cursor}set cursor(t){if(t!==this.cursor){let e=this.cursor,r=this.cursor&&this.cursor.object&&this.cursor.object.name||"cursor",i=e&&e.object&&e.object.parent;i&&i.remove(e.object),t&&(t.object.name=r,e instanceof Ln?(e.cursor=t,i&&i.add(e.object)):(this._cursor=t,e&&(i&&i.add(t.object),t.style=e.style,t.visible=e.visible)))}}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this.cursor&&(this.cursor.visible=t)}get needsUpdate(){return this.enabled&&this.isActive}recheck(){}setEventState(t){this.evtSys.checkPointer(this,t)}update(){this.onUpdate(),this.lastState||(this.lastState=new Eo),this.lastState.copy(this.state)}onUpdate(){}updateCursor(t,e,r){this.cursor&&this.cursor.update(t,e,r,this.canMoveView,this.state,this.origin,this.direction)}onZoom(t){this.state.dz=t,this.setEventState("move")}onPointerDown(){this.state.dragging=!1,this.state.canClick=!0,this.setEventState("down")}onPointerMove(){this.setEventState("move"),this.state.buttons!==0&&(O(this.pressedHit)||dr(this.pressedHit))&&(this.lastState&&this.lastState.buttons===this.state.buttons?(this.state.dragDistance+=this.state.moveDistance,this.state.dragDistance>this.movementDragThreshold&&this.onDragStart()):this.state.dragging&&(this.state.dragging=!1,this.setEventState("dragcancel")))}onDragStart(){this.state.dragging=!0,this.lastState&&!this.lastState.dragging&&this.setEventState("dragstart"),this.state.canClick=!1,this.setEventState("drag")}onPointerUp(){if(this.state.canClick&&this.lastState){let t=this.state.buttons;this.state.buttons=this.lastState.buttons,this.setEventState("click"),this.state.buttons=t}this.setEventState("up"),this.state.dragDistance=0,this.state.dragging=!1,this.lastState&&this.lastState.dragging&&this.setEventState("dragend")}};var zh=new THREE.Box3,ka=new THREE.Vector3,Ar=class extends THREE.InstancedBufferGeometry{constructor(){super(),this.type="LineSegmentsGeometry";let t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],r=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(r),this.setAttribute("position",new THREE.Float32BufferAttribute(t,3)),this.setAttribute("uv",new THREE.Float32BufferAttribute(e,2))}applyMatrix4(t){let e=this.attributes.instanceStart,r=this.attributes.instanceEnd;return e!==void 0&&(e.applyMatrix4(t),r.applyMatrix4(t),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let r=new THREE.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceStart",new THREE.InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceEnd",new THREE.InterleavedBufferAttribute(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let r=new THREE.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceColorStart",new THREE.InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceColorEnd",new THREE.InterleavedBufferAttribute(r,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new THREE.WireframeGeometry(t.geometry)),this}fromLineSegments(t){let e=t.geometry;if(e.isGeometry){console.error("THREE.LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new THREE.Box3);let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;t!==void 0&&e!==void 0&&(this.boundingBox.setFromBufferAttribute(t),zh.setFromBufferAttribute(e),this.boundingBox.union(zh))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new THREE.Sphere),this.boundingBox===null&&this.computeBoundingBox();let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(t!==void 0&&e!==void 0){let r=this.boundingSphere.center;this.boundingBox.getCenter(r);let i=0;for(let o=0,s=t.count;o<s;o++)ka.fromBufferAttribute(t,o),i=Math.max(i,r.distanceToSquared(ka)),ka.fromBufferAttribute(e,o),i=Math.max(i,r.distanceToSquared(ka));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}};Ar.prototype.isLineSegmentsGeometry=!0;var Uh=new THREE.Vector3,Gh=new THREE.Vector3,Ne=new THREE.Vector4,Xe=new THREE.Vector4,Nt=new THREE.Vector4,Rp=new THREE.Vector3,Pp=new THREE.Matrix4,ht=new THREE.Line3,Wh=new THREE.Vector3,rn=new THREE.Box3,Da=new THREE.Sphere,Xt=new THREE.Vector4;function qh(n,t,e,r){return Xt.set(0,0,-t,1).applyMatrix4(n.projectionMatrix),Xt.multiplyScalar(1/Xt.w),Xt.x=e/r.width,Xt.y=e/r.height,Xt.applyMatrix4(n.projectionMatrixInverse),Xt.multiplyScalar(1/Xt.w),Math.abs(Math.max(Xt.x,Xt.y))}var wo=class extends THREE.Mesh{constructor(t=new Ar,e=new Zt({color:Math.random()*16777215})){super(t,e),this.type="LineSegments2"}computeLineDistances(){let t=this.geometry,e=t.attributes.instanceStart,r=t.attributes.instanceEnd,i=new Float32Array(2*e.count);for(let s=0,a=0,p=e.count;s<p;s++,a+=2)Uh.fromBufferAttribute(e,s),Gh.fromBufferAttribute(r,s),i[a]=a===0?0:i[a-1],i[a+1]=i[a]+Uh.distanceTo(Gh);let o=new THREE.InstancedInterleavedBuffer(i,2,1);return t.setAttribute("instanceDistanceStart",new THREE.InterleavedBufferAttribute(o,1,0)),t.setAttribute("instanceDistanceEnd",new THREE.InterleavedBufferAttribute(o,1,1)),this}raycast(t,e){t.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');let r=t.params.Line2!==void 0&&t.params.Line2.threshold||0,i=t.ray,o=t.camera,s=o.projectionMatrix,a=this.matrixWorld,p=this.geometry,d=this.material,h=d.resolution,x=d.linewidth+r,A=p.attributes.instanceStart,E=p.attributes.instanceEnd,S=-o.near;p.boundingSphere===null&&p.computeBoundingSphere(),Da.copy(p.boundingSphere).applyMatrix4(a);let P=Math.max(o.near,Da.distanceToPoint(i.origin)),R=qh(o,P,x,h);if(Da.radius+=R,t.ray.intersectsSphere(Da)===!1)return;p.boundingBox===null&&p.computeBoundingBox(),rn.copy(p.boundingBox).applyMatrix4(a);let V=Math.max(o.near,rn.distanceToPoint(i.origin)),B=qh(o,V,x,h);if(rn.max.x+=B,rn.max.y+=B,rn.max.z+=B,rn.min.x-=B,rn.min.y-=B,rn.min.z-=B,t.ray.intersectsBox(rn)!==!1){i.at(1,Nt),Nt.w=1,Nt.applyMatrix4(o.matrixWorldInverse),Nt.applyMatrix4(s),Nt.multiplyScalar(1/Nt.w),Nt.x*=h.x/2,Nt.y*=h.y/2,Nt.z=0,Rp.copy(Nt),Pp.multiplyMatrices(o.matrixWorldInverse,a);for(let k=0,H=A.count;k<H;k++){Ne.fromBufferAttribute(A,k),Xe.fromBufferAttribute(E,k),Ne.w=1,Xe.w=1,Ne.applyMatrix4(Pp),Xe.applyMatrix4(Pp);var L=Ne.z>S&&Xe.z>S;if(L)continue;if(Ne.z>S){let z=Ne.z-Xe.z,K=(Ne.z-S)/z;Ne.lerp(Xe,K)}else if(Xe.z>S){let z=Xe.z-Ne.z,K=(Xe.z-S)/z;Xe.lerp(Ne,K)}Ne.applyMatrix4(s),Xe.applyMatrix4(s),Ne.multiplyScalar(1/Ne.w),Xe.multiplyScalar(1/Xe.w),Ne.x*=h.x/2,Ne.y*=h.y/2,Xe.x*=h.x/2,Xe.y*=h.y/2,ht.start.copy(Ne),ht.start.z=0,ht.end.copy(Xe),ht.end.z=0;let C=ht.closestPointToPointParameter(Rp,!0);ht.at(C,Wh);let D=THREE.MathUtils.lerp(Ne.z,Xe.z,C),$=D>=-1&&D<=1,W=Rp.distanceTo(Wh)<x*.5;if($&&W){ht.start.fromBufferAttribute(A,k),ht.end.fromBufferAttribute(E,k),ht.start.applyMatrix4(a),ht.end.applyMatrix4(a);let z=new THREE.Vector3,K=new THREE.Vector3;i.distanceSqToSegment(ht.start,ht.end,K,z),e.push({point:K,pointOnLine:z,distance:i.origin.distanceTo(K),object:this,face:null,faceIndex:k,uv:null,uv2:null})}}}}};wo.prototype.isLineSegments2=!0;var _r=class extends Ar{constructor(){super(),this.type="LineGeometry"}setPositions(t){for(var e=t.length-3,r=new Float32Array(2*e),i=0;i<e;i+=3)r[2*i]=t[i],r[2*i+1]=t[i+1],r[2*i+2]=t[i+2],r[2*i+3]=t[i+3],r[2*i+4]=t[i+4],r[2*i+5]=t[i+5];return super.setPositions(r),this}setColors(t){for(var e=t.length-3,r=new Float32Array(2*e),i=0;i<e;i+=3)r[2*i]=t[i],r[2*i+1]=t[i+1],r[2*i+2]=t[i+2],r[2*i+3]=t[i+3],r[2*i+4]=t[i+4],r[2*i+5]=t[i+5];return super.setColors(r),this}fromLine(t){var e=t.geometry;if(e.isGeometry){console.error("THREE.LineGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}};_r.prototype.isLineGeometry=!0;var To=class extends wo{constructor(t=new _r,e=new Zt({color:Math.random()*16777215})){super(t,e),this.type="Line2"}};To.prototype.isLine2=!0;var Qh=new _r;Qh.setPositions([0,0,0,0,0,-1]);var Oa=class extends THREE.Object3D{constructor(e,r=1){super();this._length=1;this.line=new To(Qh,Rm({color:e,linewidth:r})),this.line.computeLineDistances(),this.add(this.line)}get length(){return this._length}set length(e){this._length=e,this.line.scale.set(1,1,e)}};var BA=new Ia,FA=new Va,HA=new THREE.Matrix4().makeRotationX(-7*Math.PI/9),Kh=new THREE.Vector3,Yh=new THREE.Vector3,Ip=new THREE.Vector3,Cp=new ze([["left",1,0],["left",2,1],["left",3,2],["left",4,3],["right",1,0],["right",2,1],["right",3,2],["right",4,3]]),Jh=new Map([["none",15],["left",16],["right",17]]),Ba=class extends _i{constructor(e,r,i){super("hand",15,e,new Ai);this.renderer=r;this.laser=new Oa(Sc,.002);this.object=new THREE.Object3D;this._handedness="none";this._isHand=!1;this.inputSource=null;this._gamepad=null;this.useHaptics=!0;if(this.object.add(this.controller=this.renderer.xr.getController(i),this.grip=this.renderer.xr.getControllerGrip(i),this.hand=this.renderer.xr.getHand(i)),Or()&&Sd()&&!qt){let a=!1;this.controller.traverse(p=>{p.name.toLocaleLowerCase().indexOf("oculus")>=0&&(a=!0)}),a&&this.laser.matrix.copy(HA)}this.controller.add(this.laser),this.grip.add(BA.createControllerModel(this.controller)),this.hand.add(FA.createHandModel(this.hand,"mesh")),this.onAxisMaxed=a=>{a.axis===2&&this.evtSys.onFlick(a.value)},this.controller.addEventListener("connected",()=>{let a=this.renderer.xr.getSession();this.inputSource=a.inputSources[i],this.setGamepad(this.inputSource.gamepad),this._isHand=g(this.inputSource.hand),this._handedness=this.inputSource.handedness,this.name=Jh.get(this.handedness),this.updateCursorSide(),this.grip.visible=!this.isHand,this.controller.visible=!this.isHand,this.hand.visible=this.isHand,this.enabled=!0,this.isActive=!0,this.evtSys.onConnected(this)}),this.controller.addEventListener("disconnected",()=>{this.inputSource=null,this.setGamepad(null),this._isHand=!1,this._handedness="none",this.name=Jh.get(this.handedness),this.updateCursorSide(),this.grip.visible=!1,this.controller.visible=!1,this.hand.visible=!1,this.enabled=!1,this.isActive=!1,this.evtSys.onDisconnected(this),this.isActive=!1});let o=a=>{this.updateState(),this.state.buttons=this.state.buttons|a,this.onPointerDown()},s=a=>{this.updateState(),this.state.buttons=this.state.buttons&~a,this.onPointerUp()};this.controller.addEventListener("selectstart",()=>o(1)),this.controller.addEventListener("selectend",()=>s(1)),this.controller.addEventListener("squeezestart",()=>o(2)),this.controller.addEventListener("squeezeend",()=>s(2))}vibrate(){this._vibrate()}async _vibrate(){if(this._gamepad&&this.useHaptics)try{await Promise.all(this._gamepad.hapticActuators.map(e=>e.pulse(.25,125)))}catch{this.useHaptics=!1}}setGamepad(e){g(this._gamepad)&&O(e)&&(this._gamepad.clearEventListeners(),this._gamepad=null),g(e)&&(g(this._gamepad)?this._gamepad.setPad(e):(this._gamepad=new Ra(e),this._gamepad.addEventListener("gamepadaxismaxed",this.onAxisMaxed)))}get gamepad(){return this._gamepad}get gamepadId(){return this._gamepad&&this._gamepad.id}get handedness(){return this._handedness}get isHand(){return this._isHand}get cursor(){return super.cursor}set cursor(e){super.cursor=e,this.updateCursorSide()}updateCursorSide(){let e=this.cursor.object;if(e){let r=this.handedness==="left"?-1:1;e.scale.set(r,1,1)}}onUpdate(){super.onUpdate(),this.enabled&&(this.updateState(),this.onPointerMove())}updateState(){this.laser.getWorldPosition(Kh),this.laser.getWorldDirection(Yh).multiplyScalar(-1),Ip.copy(this.origin).add(this.direction),this.origin.lerp(Kh,.9),this.direction.lerp(Yh,.9).normalize(),Ip.sub(this.origin).sub(this.direction),this.state.moveDistance+=.001*Ip.length(),g(this._gamepad)&&g(this.inputSource)&&this.setGamepad(this.inputSource.gamepad)}isPressed(e){if(!this._gamepad||!Cp.has(this.handedness)||!Cp.get(this.handedness).has(e))return!1;let r=Cp.get(this.handedness).get(e);return this._gamepad.buttons[r].pressed}};var kn=class extends _i{constructor(e,r,i,o,s,a){super(e,r,i,a);this.renderer=o;this.camera=s;this.id=null;this.moveOnUpdate=!1;let p=x=>{this.checkEvent(x)&&(this.readEvent(x),this.onPointerDown())};this.element=this.renderer.domElement,this.element.addEventListener("pointerdown",p);let d=x=>{this.checkEvent(x)&&(this.readEvent(x),this.onPointerMove())};this.element.addEventListener("pointermove",d);let h=x=>{this.checkEvent(x)&&(this.readEvent(x),this.onPointerUp())};this.element.addEventListener("pointerup",h)}get isTracking(){return this.id!=null}checkEvent(e){return e.pointerType===this.type&&e.pointerId===this.id}readEvent(e){this.checkEvent(e)&&(this.basicReadEvent(e),this.state.buttons=e.buttons,this.state.x=e.offsetX,this.state.y=e.offsetY,this.state.dx=e.movementX,this.state.dy=e.movementY,this.stateDelta(e.type))}basicReadEvent(e){this.state.ctrl=e.ctrlKey,this.state.alt=e.altKey,this.state.shift=e.shiftKey,this.state.meta=e.metaKey,this.state.dz=0}stateDelta(e){e==="pointermove"&&this.lastState&&(document.pointerLockElement?(this.state.x=this.lastState.x+this.state.dx,this.state.y=this.lastState.y+this.state.dy):(this.state.dx=this.state.x-this.lastState.x,this.state.dy=this.state.y-this.lastState.y)),this.state.moveDistance=Math.sqrt(this.state.dx*this.state.dx+this.state.dy*this.state.dy),this.state.u=as(ss(this.state.x,0,this.element.clientWidth),-1,1),this.state.v=as(ss(this.state.y,0,this.element.clientHeight),-1,1),this.state.du=2*this.state.dx/this.element.clientWidth,this.state.dv=2*this.state.dy/this.element.clientHeight}recheck(){this.moveOnUpdate=!0,super.recheck()}onUpdate(){super.onUpdate();let e=hi(this.renderer,this.camera);this.origin.setFromMatrixPosition(e.matrixWorld),this.direction.set(this.state.u,-this.state.v,.5).unproject(e).sub(this.origin).normalize(),this.moveOnUpdate&&this.onPointerMove(),this.origin.setFromMatrixPosition(e.matrixWorld),this.direction.set(this.state.u,-this.state.v,.5).unproject(e).sub(this.origin).normalize()}onPointerMove(){this.moveOnUpdate=!1,super.onPointerMove()}isPressed(e){let r=1<<e;return this.state.buttons===r}};var Fa=class extends kn{constructor(e,r,i){let o=p=>{p.pointerType==="mouse"&&this.id==null&&(this.id=p.pointerId)},s=p=>{p.pointerType==="mouse"&&this.id!=null&&(this.id=null)},a=r.domElement;a.addEventListener("pointerdown",o),a.addEventListener("pointermove",o);super("mouse",1,e,r,i,new Ln(r));this.allowPointerLock=!1;this.element.addEventListener("wheel",p=>{p.preventDefault();let d=-p.deltaY*.5;this.onZoom(d)},{passive:!1}),this.element.addEventListener("contextmenu",p=>{p.preventDefault()}),this.element.addEventListener("pointerup",s),this.element.addEventListener("pointercancel",s),this.element.addEventListener("pointerdown",()=>{this.allowPointerLock&&!this.isPointerLocked&&this.lockPointer()}),this.canMoveView=!0,Object.seal(this)}lockPointer(){this.element.requestPointerLock()}unlockPointer(){document.exitPointerLock()}get isPointerLocked(){return document.pointerLockElement!=null}};function NA(n,t){let e=t.offsetX-n.offsetY,r=t.offsetY-n.offsetY;return Math.sqrt(e*e+r*r)}var Ha=class extends kn{constructor(e,r,i){super("touch",14,e,r,i,null);this.lastPinchDist=0;this.points=new Map;this.canMoveView=!0,Object.seal(this)}checkEvent(e){return e.pointerType===this.type}readEvent(e){if(this.checkEvent(e)){if(this.basicReadEvent(e),e.type==="pointerdown"||e.type==="pointermove"?this.points.set(e.pointerId,e):this.points.has(e.pointerId)&&(e.type==="pointerup"||e.type==="pointercancel")&&this.points.delete(e.pointerId),this.state.buttons=0,this.state.dz*=.9,this.points.size===0)this.state.x*=.9,this.state.y*=.9,this.state.dx*=.9,this.state.dy*=.9;else{this.state.x=0,this.state.y=0,this.state.dx=0,this.state.dy=0;let r=1/this.points.size;for(let i of this.points.values())this.state.buttons|=i.buttons<<this.points.size-1,this.state.x+=r*i.offsetX,this.state.y+=r*i.offsetY,this.state.dx+=r*i.movementX,this.state.dy+=r*i.movementY;if(this.points.size===2){let[i,o]=Array.from(this.points.values()),s=NA(i,o);this.lastState&&this.lastState.buttons===2&&(this.state.dz=(s-this.lastPinchDist)*2.5),this.lastPinchDist=s}}this.stateDelta(e.type)}}vibrate(){navigator.vibrate(125)}};var Na=class extends kn{constructor(t,e,r){let i=a=>{a.pointerType==="pen"&&this.id==null&&(this.id=a.pointerId)},o=a=>{a.pointerType==="pen"&&this.id!=null&&(this.id=null)},s=e.domElement;s.addEventListener("pointerdown",i),s.addEventListener("pointermove",i),super("pen",2,t,e,r,new Ln(e)),s.addEventListener("pointerup",o),s.addEventListener("pointercancel",o),this.canMoveView=!0,Object.seal(this)}};function Vp(n,t){g(n)&&n.point.copy(t.direction).multiplyScalar(n.distance).add(t.origin)}var Xa=class extends Z{constructor(e){super();this.env=e;this.raycaster=new THREE.Raycaster;this.hands=new Array;this.localPointerMovedEvt=new Ta;this.hits=new Array;this.infoPressed=!1;this.menuPressed=!1;this.pointerEvents=new Map;this.raycaster.camera=this.env.camera,this.raycaster.layers.set(wa),this.mouse=new Fa(this,this.env.renderer,this.env.camera),this.pen=new Na(this,this.env.renderer,this.env.camera),this.touches=new Ha(this,this.env.renderer,this.env.camera);for(let r=0;r<2;++r)this.hands[r]=new Ba(this,this.env.renderer,r);this.pointers=[this.mouse,this.pen,this.touches,...this.hands];for(let r of this.pointers)r.cursor&&Le(this.env.stage,r.cursor);window.addEventListener("keydown",r=>{let i=ga(r);r.key==="/"&&(this.infoPressed=i),r.key==="ContextMenu"&&(this.menuPressed=i)}),window.addEventListener("keyup",r=>{r.key==="/"&&(this.infoPressed=!1),r.key==="ContextMenu"&&(this.menuPressed=!1)}),this.env.avatar.evtSys=this,this.checkXRMouse()}onFlick(e){this.env.avatar.onFlick(e)}onConnected(e){this.checkXRMouse()}onDisconnected(e){this.checkXRMouse()}checkXRMouse(){let e=0;for(let i of this.hands.values())i.enabled&&++e;let r=e===0;this.mouse.enabled=r,this.pen.enabled=r,this.touches.enabled=r}checkPointer(e,r){e.isActive=!0,this.fireRay(e);let{curHit:i,hoveredHit:o,pressedHit:s,draggedHit:a}=e,p=mt(i),d=mt(o),h=mt(s),x=mt(a);switch((r==="move"||r==="drag")&&(Vp(o,e),Vp(s,e),Vp(a,e)),r){case"move":{let A=this.getEvent(e,"move",i);this.env.avatar.onMove(A),this.env.fovControl.onMove(A),g(a)?x.dispatchEvent(A.to3(a)):g(s)?h.dispatchEvent(A.to3(s)):e.state.buttons===0&&(this.checkExit(i,o,e),this.checkEnter(i,o,e),p&&p.dispatchEvent(A.to3(i))),this.localPointerMovedEvt.name=e.name,this.localPointerMovedEvt.set(e.origin.x,e.origin.y,e.origin.z,e.direction.x,e.direction.y,e.direction.z,0,1,0),this.dispatchEvent(this.localPointerMovedEvt)}break;case"down":{let A=this.getEvent(e,"down",i);this.env.avatar.onDown(A),(pr(o)||dr(o))&&(e.pressedHit=o,d.dispatchEvent(A.to3(o)))}break;case"up":{let A=this.getEvent(e,"up",i);this.dispatchEvent(A),e.state.buttons===0&&(g(s)&&(e.pressedHit=null,h.dispatchEvent(A.to3(s))),this.checkExit(i,o,e),this.checkEnter(i,o,e))}break;case"click":{let A=this.getEvent(e,"click",i);this.dispatchEvent(A),pr(i)&&(e.vibrate(),p.dispatchEvent(A.to3(i)))}break;case"dragstart":{let A=this.getEvent(e,"dragstart",s,i);this.dispatchEvent(A),g(s)&&(e.draggedHit=s,h.dispatchEvent(A.to3(s)))}break;case"drag":{let A=this.getEvent(e,"drag",a,i);this.dispatchEvent(A),g(a)&&x.dispatchEvent(A.to3(a))}break;case"dragcancel":{let A=this.getEvent(e,"dragcancel",a,i);this.dispatchEvent(A),g(a)&&(e.draggedHit=null,x.dispatchEvent(A.to3(a)))}break;case"dragend":{let A=this.getEvent(e,"dragend",a,i);this.dispatchEvent(A),g(a)&&(e.draggedHit=null,x.dispatchEvent(A.to3(a)))}break;case"enter":case"exit":console.log(e,r);break;default:de(r)}e.updateCursor(this.env.avatar.worldPos,a||s||o||i,2)}getEvent(e,r,...i){this.pointerEvents.has(e)||this.pointerEvents.set(e,new Map);let o=this.pointerEvents.get(e);o.has(r)||o.set(r,new Ma(r,e));let s=o.get(r);if(i.length>0){s.hit=$e(i,g);let a=$e(i,p=>g(p)&&p!==s.hit);g(a)&&(s.hit.uv=a.uv)}return s}checkExit(e,r,i){let o=mt(e),s=mt(r);if(o!==s&&g(s)){i.hoveredHit=null;let a=this.getEvent(i,"exit",r);this.dispatchEvent(a),s.dispatchEvent(a.to3(r))}}checkEnter(e,r,i){let o=mt(e),s=mt(r);if(o!==s&&g(e)){i.hoveredHit=e;let a=this.getEvent(i,"enter",e);this.dispatchEvent(a),o.dispatchEvent(a.to3(e))}}refreshCursors(){for(let e of this.pointers)e.cursor&&(e.cursor=this.env.cursor3D.clone())}fireRay(e){pe(this.hits),this.raycaster.ray.origin.copy(e.origin),this.raycaster.ray.direction.copy(e.direction),this.raycaster.intersectObject(this.env.scene,!0,this.hits),e.curHit=null;let r=Number.MAX_VALUE;for(let i of this.hits)lo(i)&&Bm(i)&&i.distance<r&&(e.curHit=i,r=i.distance);e.curHit&&e.hoveredHit&&e.curHit.object===e.hoveredHit.object&&(e.hoveredHit=e.curHit)}update(){for(let e of this.pointers)e.needsUpdate&&e.update()}recheckPointers(){for(let e of this.pointers)e.needsUpdate&&e.recheck()}isPressed(e){for(let r of this.pointers)if(r.isPressed(e))return!0;return e===3&&this.menuPressed||e===4&&this.infoPressed}};var XA=new j("fadecomplete"),ja=class extends Z{constructor(e,r=.15){super();this.opacity=1;this.direction=0;this.material=lr({name:"FaderMaterial",color:0,side:THREE.BackSide}),this.object=new THREE.Mesh(yo,this.material),this.object.name=e,this.object.renderOrder=Number.MAX_VALUE,this.speed=1/r,this.object.layers.enableAll()}async fadeOut(){this.direction!=1&&(this.direction=1,await le(this,"fadecomplete"))}async fadeIn(){this.direction!=-1&&(this.direction=-1,await le(this,"fadecomplete"))}update(e){if(this.direction!==0){let r=this.direction*this.speed*e/1e3;0<=this.opacity&&this.opacity<=1&&(this.opacity+=r),(this.direction===1&&this.opacity>=1||this.direction===-1&&this.opacity<=0)&&(this.opacity=Ct(this.opacity,0,1),this.direction=0,this.dispatchEvent(XA))}this.material.opacity=this.opacity,this.material.transparent=this.opacity<1,this.material.needsUpdate=!0}};function ft(n,t,e,r,i,o){let s=new vr(r,i,o,Im);return s.position.set(n,t,e),s}var jA=.1,za=class extends xn{constructor(){super();this.value=0;this.targetValue=0;this.object=new THREE.Object3D;this._enabled=!0;this.valueBar=new vr(0,1,1,Pm),this.valueBar.scale.set(0,1,1);let e=new THREE.Object3D;e.scale.set(1,.1,.1),Le(this,Le(e,this.valueBar),ft(-.5,0,-.05,.01,.1,.01),ft(-.5,0,.05,.01,.1,.01),ft(.5,0,-.05,.01,.1,.01),ft(.5,0,.05,.01,.1,.01),ft(-.5,-.05,0,.01,.01,.1),ft(.5,-.05,0,.01,.01,.1),ft(-.5,.05,0,.01,.01,.1),ft(.5,.05,0,.01,.01,.1),ft(0,-.05,-.05,1,.01,.01),ft(0,.05,-.05,1,.01,.01),ft(0,-.05,.05,1,.01,.01),ft(0,.05,.05,1,.01,.01)),Eh(this,xi)}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,Ve(this,oi(this)||this.enabled))}report(e,r,i){super.report(e,r,i),this.targetValue=this.p}update(e){this.object.parent.visible&&(this.value=Math.min(this.targetValue,this.value+jA*e),this.valueBar.scale.set(this.value,1,1),this.valueBar.position.x=this.value/2-.5,Ve(this,this.enabled&&this.value>0))}};if(!Lp()){let n=Element.prototype,t=Document.prototype;"webkitRequestFullscreen"in n?(n.requestFullscreen=n.webkitRequestFullscreen,t.exitFullscreen=t.webkitRequestFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.webkitFullscreenEnabled}},fullscreenElement:{get:function(){return this.webkitFullscreenElement}}})):"mozRequestFullScreen"in n?(n.requestFullscreen=n.mozRequestFullScreen,t.exitFullscreen=t.mozCancelFullScreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.mozFullScreenEnabled}},fullscreenElement:{get:function(){return this.mozFullScreenElement}}})):"msRequestFullscreen"in n&&(n.requestFullscreen=n.msRequestFullscreen,t.exitFullscreen=t.msExitFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.msFullscreenEnabled}},fullscreenElement:{get:function(){return this.msFullscreenElement}}}))}function Lp(){return"requestFullscreen"in HTMLElement.prototype}var zA=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},Ua=zA;var Mo=Symbol("@@webxr-polyfill/EventTarget"),on=class{constructor(){this[Mo]={listeners:new Map}}addEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let r=this[Mo].listeners.get(t)||[];r.push(e),this[Mo].listeners.set(t,r)}removeEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let r=this[Mo].listeners.get(t)||[];for(let i=r.length;i>=0;i--)r[i]===e&&r.pop()}dispatchEvent(t,e){let r=this[Mo].listeners.get(t)||[],i=[];for(let o=0;o<r.length;o++)i[o]=r[o];for(let o of i)o(e);typeof this[`on${t}`]=="function"&&this[`on${t}`](e)}};var Pe=typeof Float32Array<"u"?Float32Array:Array;var rV=Math.PI/180;function jt(){let n=new Pe(16);return Pe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function $h(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function Dn(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function br(n,t){let e=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],p=t[6],d=t[7],h=t[8],x=t[9],A=t[10],E=t[11],S=t[12],P=t[13],R=t[14],V=t[15],B=e*a-r*s,L=e*p-i*s,k=e*d-o*s,H=r*p-i*a,C=r*d-o*a,D=i*d-o*p,$=h*P-x*S,W=h*R-A*S,z=h*V-E*S,K=x*R-A*P,be=x*V-E*P,ge=A*V-E*R,ne=B*ge-L*be+k*K+H*z-C*W+D*$;return ne?(ne=1/ne,n[0]=(a*ge-p*be+d*K)*ne,n[1]=(i*be-r*ge-o*K)*ne,n[2]=(P*D-R*C+V*H)*ne,n[3]=(A*C-x*D-E*H)*ne,n[4]=(p*z-s*ge-d*W)*ne,n[5]=(e*ge-i*z+o*W)*ne,n[6]=(R*k-S*D-V*L)*ne,n[7]=(h*D-A*k+E*L)*ne,n[8]=(s*be-a*z+d*$)*ne,n[9]=(r*z-e*be-o*$)*ne,n[10]=(S*C-P*k+V*B)*ne,n[11]=(x*k-h*C-E*B)*ne,n[12]=(a*W-s*K-p*$)*ne,n[13]=(e*K-r*W+i*$)*ne,n[14]=(P*L-S*H-R*B)*ne,n[15]=(h*H-x*L+A*B)*ne,n):null}function sn(n,t,e){let r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],p=t[5],d=t[6],h=t[7],x=t[8],A=t[9],E=t[10],S=t[11],P=t[12],R=t[13],V=t[14],B=t[15],L=e[0],k=e[1],H=e[2],C=e[3];return n[0]=L*r+k*a+H*x+C*P,n[1]=L*i+k*p+H*A+C*R,n[2]=L*o+k*d+H*E+C*V,n[3]=L*s+k*h+H*S+C*B,L=e[4],k=e[5],H=e[6],C=e[7],n[4]=L*r+k*a+H*x+C*P,n[5]=L*i+k*p+H*A+C*R,n[6]=L*o+k*d+H*E+C*V,n[7]=L*s+k*h+H*S+C*B,L=e[8],k=e[9],H=e[10],C=e[11],n[8]=L*r+k*a+H*x+C*P,n[9]=L*i+k*p+H*A+C*R,n[10]=L*o+k*d+H*E+C*V,n[11]=L*s+k*h+H*S+C*B,L=e[12],k=e[13],H=e[14],C=e[15],n[12]=L*r+k*a+H*x+C*P,n[13]=L*i+k*p+H*A+C*R,n[14]=L*o+k*d+H*E+C*V,n[15]=L*s+k*h+H*S+C*B,n}function On(n,t,e){let r=t[0],i=t[1],o=t[2],s=t[3],a=r+r,p=i+i,d=o+o,h=r*a,x=r*p,A=r*d,E=i*p,S=i*d,P=o*d,R=s*a,V=s*p,B=s*d;return n[0]=1-(E+P),n[1]=x+B,n[2]=A-V,n[3]=0,n[4]=x-B,n[5]=1-(h+P),n[6]=S+R,n[7]=0,n[8]=A+V,n[9]=S-R,n[10]=1-(h+E),n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}function Ga(n,t){return n[0]=t[12],n[1]=t[13],n[2]=t[14],n}function Wa(n,t){let e=t[0]+t[5]+t[10],r=0;return e>0?(r=Math.sqrt(e+1)*2,n[3]=.25*r,n[0]=(t[6]-t[9])/r,n[1]=(t[8]-t[2])/r,n[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=Math.sqrt(1+t[0]-t[5]-t[10])*2,n[3]=(t[6]-t[9])/r,n[0]=.25*r,n[1]=(t[1]+t[4])/r,n[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=Math.sqrt(1+t[5]-t[0]-t[10])*2,n[3]=(t[8]-t[2])/r,n[0]=(t[1]+t[4])/r,n[1]=.25*r,n[2]=(t[6]+t[9])/r):(r=Math.sqrt(1+t[10]-t[0]-t[5])*2,n[3]=(t[1]-t[4])/r,n[0]=(t[8]+t[2])/r,n[1]=(t[6]+t[9])/r,n[2]=.25*r),n}function qa(n,t,e,r,i){let o=1/Math.tan(t/2),s;return n[0]=o/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,i!=null&&i!==1/0?(s=1/(r-i),n[10]=(i+r)*s,n[14]=2*i*r*s):(n[10]=-1,n[14]=-2*r),n}function at(){let n=new Pe(3);return Pe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function kp(n){var t=new Pe(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function UA(n){let t=n[0],e=n[1],r=n[2];return Math.sqrt(t*t+e*e+r*r)}function et(n,t,e){let r=new Pe(3);return r[0]=n,r[1]=t,r[2]=e,r}function Dp(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function bi(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function Op(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function Qa(n,t){let e=t[0],r=t[1],i=t[2],o=e*e+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o),n}function Po(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Ka(n,t,e){let r=t[0],i=t[1],o=t[2],s=e[0],a=e[1],p=e[2];return n[0]=i*p-o*a,n[1]=o*s-r*p,n[2]=r*a-i*s,n}function yr(n,t,e){let r=e[0],i=e[1],o=e[2],s=e[3],a=t[0],p=t[1],d=t[2],h=i*d-o*p,x=o*a-r*d,A=r*p-i*a,E=i*A-o*x,S=o*h-r*A,P=r*x-i*h,R=s*2;return h*=R,x*=R,A*=R,E*=2,S*=2,P*=2,n[0]=a+h+E,n[1]=p+x+S,n[2]=d+A+P,n}function ef(n,t){let e=et(n[0],n[1],n[2]),r=et(t[0],t[1],t[2]);Qa(e,e),Qa(r,r);let i=Po(e,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}var tf=UA;var iV=function(){let n=at();return function(t,e,r,i,o,s){let a,p;for(e||(e=3),r||(r=0),i?p=Math.min(i*e+r,t.length):p=t.length,a=r;a<p;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],o(n,n,s),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2];return t}}();function nf(){let n=new Pe(9);return Pe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function WA(){let n=new Pe(4);return Pe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function rf(n){let t=new Pe(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function of(n,t,e,r){let i=new Pe(4);return i[0]=n,i[1]=t,i[2]=e,i[3]=r,i}function sf(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function af(n,t){let e=t[0],r=t[1],i=t[2],o=t[3],s=e*e+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s),n[0]=e*s,n[1]=r*s,n[2]=i*s,n[3]=o*s),n}var oV=function(){let n=WA();return function(t,e,r,i,o,s){let a,p;for(e||(e=4),r||(r=0),i?p=Math.min(i*e+r,t.length):p=t.length,a=r;a<p;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],n[3]=t[a+3],o(n,n,s),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2],t[a+3]=n[3];return t}}();function lt(){let n=new Pe(4);return Pe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function QA(n,t,e){e=e*.5;let r=Math.sin(e);return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=Math.cos(e),n}function Bp(n,t,e){let r=t[0],i=t[1],o=t[2],s=t[3],a=e[0],p=e[1],d=e[2],h=e[3];return n[0]=r*h+s*a+i*d-o*p,n[1]=i*h+s*p+o*a-r*d,n[2]=o*h+s*d+r*p-i*a,n[3]=s*h-r*a-i*p-o*d,n}function Ei(n,t,e,r){let i=t[0],o=t[1],s=t[2],a=t[3],p=e[0],d=e[1],h=e[2],x=e[3],A,E,S,P,R;return E=i*p+o*d+s*h+a*x,E<0&&(E=-E,p=-p,d=-d,h=-h,x=-x),1-E>1e-6?(A=Math.acos(E),S=Math.sin(A),P=Math.sin((1-r)*A)/S,R=Math.sin(r*A)/S):(P=1-r,R=r),n[0]=P*i+R*p,n[1]=P*o+R*d,n[2]=P*s+R*h,n[3]=P*a+R*x,n}function Fp(n,t){let e=t[0],r=t[1],i=t[2],o=t[3],s=e*e+r*r+i*i+o*o,a=s?1/s:0;return n[0]=-e*a,n[1]=-r*a,n[2]=-i*a,n[3]=o*a,n}function KA(n,t){let e=t[0]+t[4]+t[8],r;if(e>0)r=Math.sqrt(e+1),n[3]=.5*r,r=.5/r,n[0]=(t[5]-t[7])*r,n[1]=(t[6]-t[2])*r,n[2]=(t[1]-t[3])*r;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);let o=(i+1)%3,s=(i+2)%3;r=Math.sqrt(t[i*3+i]-t[o*3+o]-t[s*3+s]+1),n[i]=.5*r,r=.5/r,n[3]=(t[o*3+s]-t[s*3+o])*r,n[o]=(t[o*3+i]+t[i*3+o])*r,n[s]=(t[s*3+i]+t[i*3+s])*r}return n}function lf(n,t,e,r){let i=.5*Math.PI/180;t*=i,e*=i,r*=i;let o=Math.sin(t),s=Math.cos(t),a=Math.sin(e),p=Math.cos(e),d=Math.sin(r),h=Math.cos(r);return n[0]=o*p*h-s*a*d,n[1]=s*a*h+o*p*d,n[2]=s*p*d-o*a*h,n[3]=s*p*h+o*a*d,n}var Hp=rf,cf=of,Ja=sf;var Io=af;var fV=function(){let n=at(),t=et(1,0,0),e=et(0,1,0);return function(r,i,o){let s=Po(i,o);return s<-.999999?(Ka(n,t,i),tf(n)<1e-6&&Ka(n,e,i),Qa(n,n),QA(r,n,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Ka(n,i,o),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=1+s,Io(r,r))}}(),xV=function(){let n=lt(),t=lt();return function(e,r,i,o,s,a){return Ei(n,r,s,a),Ei(t,i,o,a),Ei(e,n,t,2*a*(1-a)),e}}(),gV=function(){let n=nf();return function(t,e,r,i){return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],Io(t,KA(t,n))}}();var oe=Symbol("@@webxr-polyfill/XRRigidTransform"),an=class{constructor(){if(this[oe]={matrix:null,position:null,orientation:null,inverse:null},arguments.length===0)this[oe].matrix=Dn(new Float32Array(16));else if(arguments.length===1)arguments[0]instanceof Float32Array?this[oe].matrix=arguments[0]:(this[oe].position=this._getPoint(arguments[0]),this[oe].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(arguments.length===2)this[oe].position=this._getPoint(arguments[0]),this[oe].orientation=this._getPoint(arguments[1]);else throw new Error("Too many arguments!");if(this[oe].matrix){let t=at();Ga(t,this[oe].matrix),this[oe].position=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2]});let e=lt();Wa(e,this[oe].matrix),this[oe].orientation=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2],w:e[3]})}else this[oe].matrix=Dn(new Float32Array(16)),On(this[oe].matrix,cf(this[oe].orientation.x,this[oe].orientation.y,this[oe].orientation.z,this[oe].orientation.w),et(this[oe].position.x,this[oe].position.y,this[oe].position.z))}_getPoint(t){return t instanceof DOMPointReadOnly?t:DOMPointReadOnly.fromPoint(t)}get matrix(){return this[oe].matrix}get position(){return this[oe].position}get orientation(){return this[oe].orientation}get inverse(){if(this[oe].inverse===null){let t=Dn(new Float32Array(16));br(t,this[oe].matrix),this[oe].inverse=new an(t),this[oe].inverse[oe].inverse=this}return this[oe].inverse}};var _e=Symbol("@@webxr-polyfill/XRSpace");var xt=class{constructor(t=null,e=null){this[_e]={specialType:t,inputSource:e,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[_e].specialType}get _inputSource(){return this[_e].inputSource}_ensurePoseUpdated(t,e){e!=this[_e].lastFrameId&&(this[_e].lastFrameId=e,this._onPoseUpdate(t))}_onPoseUpdate(t){this[_e].specialType=="viewer"&&(this._baseMatrix=t.getBasePoseMatrix())}set _baseMatrix(t){this[_e].baseMatrix=t,this[_e].inverseBaseMatrix=null}get _baseMatrix(){return this[_e].baseMatrix||this[_e].inverseBaseMatrix&&(this[_e].baseMatrix=new Float32Array(16),br(this[_e].baseMatrix,this[_e].inverseBaseMatrix)),this[_e].baseMatrix}set _inverseBaseMatrix(t){this[_e].inverseBaseMatrix=t,this[_e].baseMatrix=null}get _inverseBaseMatrix(){return this[_e].inverseBaseMatrix||this[_e].baseMatrix&&(this[_e].inverseBaseMatrix=new Float32Array(16),br(this[_e].inverseBaseMatrix,this[_e].baseMatrix)),this[_e].inverseBaseMatrix}_getSpaceRelativeTransform(t){if(!this._inverseBaseMatrix||!t._baseMatrix)return null;let e=new Float32Array(16);return sn(e,this._inverseBaseMatrix,t._baseMatrix),new an(e)}};var YA=1.6,Bn=Symbol("@@webxr-polyfill/XRReferenceSpace"),Co=["viewer","local","local-floor","bounded-floor","unbounded"];function JA(n){return n==="bounded-floor"||n==="local-floor"}var zt=class extends xt{constructor(t,e=null){if(!Co.includes(t))throw new Error(`XRReferenceSpaceType must be one of ${Co}`);if(super(t),t==="bounded-floor"&&!e)throw new Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");JA(t)&&!e&&(e=Dn(new Float32Array(16)),e[13]=YA),this._inverseBaseMatrix=e||Dn(new Float32Array(16)),this[Bn]={type:t,transform:e,originOffset:Dn(new Float32Array(16))}}_transformBasePoseMatrix(t,e){sn(t,this._inverseBaseMatrix,e)}_originOffsetMatrix(){return this[Bn].originOffset}_adjustForOriginOffset(t){let e=new Float32Array(16);br(e,this[Bn].originOffset),sn(t,e,t)}_getSpaceRelativeTransform(t){let e=super._getSpaceRelativeTransform(t);return this._adjustForOriginOffset(e.matrix),new XRRigidTransform(e.matrix)}getOffsetReferenceSpace(t){let e=new zt(this[Bn].type,this[Bn].transform,this[Bn].bounds);return sn(e[Bn].originOffset,this[Bn].originOffset,t.matrix),e}};var Ye=Symbol("@@webxr-polyfill/XR"),$A=["inline","immersive-vr","immersive-ar"],ZA={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},e_=`Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode
or navigator.xr.requestSession('inline') prior to requesting an immersive
session. This is a limitation specific to the WebXR Polyfill and does not apply
to native implementations of the API.`,Vo=class extends on{constructor(t){super(),this[Ye]={device:null,devicePromise:t,immersiveSession:null,inlineSessions:new Set},t.then(e=>{this[Ye].device=e})}async isSessionSupported(t){return this[Ye].device||await this[Ye].devicePromise,t!="inline"?Promise.resolve(this[Ye].device.isSessionSupported(t)):Promise.resolve(!0)}async requestSession(t,e){if(!this[Ye].device){if(t!="inline")throw new Error(e_);await this[Ye].devicePromise}if(!$A.includes(t))throw new TypeError(`The provided value '${t}' is not a valid enum value of type XRSessionMode`);let r=ZA[t],i=r.requiredFeatures.concat(e&&e.requiredFeatures?e.requiredFeatures:[]),o=r.optionalFeatures.concat(e&&e.optionalFeatures?e.optionalFeatures:[]),s=new Set,a=!1;for(let x of i)this[Ye].device.isFeatureSupported(x)?s.add(x):(console.error(`The required feature '${x}' is not supported`),a=!0);if(a)throw new DOMException("Session does not support some required features","NotSupportedError");for(let x of o)this[Ye].device.isFeatureSupported(x)?s.add(x):console.log(`The optional feature '${x}' is not supported`);let p=await this[Ye].device.requestSession(t,s),d=new XRSession(this[Ye].device,t,p);t=="inline"?this[Ye].inlineSessions.add(d):this[Ye].immersiveSession=d;let h=()=>{t=="inline"?this[Ye].inlineSessions.delete(d):this[Ye].immersiveSession=null,d.removeEventListener("end",h)};return d.addEventListener("end",h),d}};var Xp;if("performance"in Ua)Xp=()=>performance.now();else{let n=Date.now();Xp=()=>Date.now()-n}var $a=Xp;var jp=Symbol("@@webxr-polyfill/XRPose"),wr=class{constructor(t,e){this[jp]={transform:t,emulatedPosition:e}}get transform(){return this[jp].transform}get emulatedPosition(){return this[jp].emulatedPosition}};var pf=Symbol("@@webxr-polyfill/XRViewerPose"),Tr=class extends wr{constructor(t,e,r=!1){super(t,r),this[pf]={views:e}}get views(){return this[pf].views}};var Lo=Symbol("@@webxr-polyfill/XRViewport"),Mr=class{constructor(t){this[Lo]={target:t}}get x(){return this[Lo].target.x}get y(){return this[Lo].target.y}get width(){return this[Lo].target.width}get height(){return this[Lo].target.height}};var df=["left","right","none"],Fn=Symbol("@@webxr-polyfill/XRView"),Sr=class{constructor(t,e,r,i){if(!df.includes(r))throw new Error(`XREye must be one of: ${df}`);let o=Object.create(null),s=new Mr(o);this[Fn]={device:t,eye:r,viewport:s,temp:o,sessionId:i,transform:e}}get eye(){return this[Fn].eye}get projectionMatrix(){return this[Fn].device.getProjectionMatrix(this.eye)}get transform(){return this[Fn].transform}_getViewport(t){if(this[Fn].device.getViewport(this[Fn].sessionId,this.eye,t,this[Fn].temp))return this[Fn].viewport}};var we=Symbol("@@webxr-polyfill/XRFrame"),uf="XRFrame access outside the callback that produced it is invalid.",t_="getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.",n_=0,Hn=class{constructor(t,e,r){this[we]={id:++n_,active:!1,animationFrame:!1,device:t,session:e,sessionId:r}}get session(){return this[we].session}getViewerPose(t){if(!this[we].animationFrame)throw new DOMException(t_,"InvalidStateError");if(!this[we].active)throw new DOMException(uf,"InvalidStateError");let e=this[we].device,r=this[we].session;r[w].viewerSpace._ensurePoseUpdated(e,this[we].id),t._ensurePoseUpdated(e,this[we].id);let i=t._getSpaceRelativeTransform(r[w].viewerSpace),o=[];for(let a of r[w].viewSpaces){a._ensurePoseUpdated(e,this[we].id);let p=t._getSpaceRelativeTransform(a),d=new Sr(e,p,a.eye,this[we].sessionId);o.push(d)}return new Tr(i,o,!1)}getPose(t,e){if(!this[we].active)throw new DOMException(uf,"InvalidStateError");let r=this[we].device;if(t._specialType==="target-ray"||t._specialType==="grip")return r.getInputPose(t._inputSource,e,t._specialType);{t._ensurePoseUpdated(r,this[we].id),e._ensurePoseUpdated(r,this[we].id);let i=e._getSpaceRelativeTransform(t);return i?new XRPose(i,!1):null}return null}};var ko=Symbol("@@webxr-polyfill/XRRenderState"),r_=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null}),Nn=class{constructor(t={}){let e=Object.assign({},r_,t);this[ko]={config:e}}get depthNear(){return this[ko].config.depthNear}get depthFar(){return this[ko].config.depthFar}get inlineVerticalFieldOfView(){return this[ko].config.inlineVerticalFieldOfView}get baseLayer(){return this[ko].config.baseLayer}};var Za=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),Do=Symbol("@@webxr-polyfill/xr-compatible");var Rr=Symbol("@@webxr-polyfill/XRWebGLLayer"),i_=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),Oo=class{constructor(t,e,r={}){let i=Object.assign({},i_,r);if(!(t instanceof Pr))throw new Error("session must be a XRSession");if(t.ended)throw new Error("InvalidStateError");if(e[Za]&&e[Do]!==!0)throw new Error("InvalidStateError");let o=e.getParameter(e.FRAMEBUFFER_BINDING);this[Rr]={context:e,config:i,framebuffer:o,session:t}}get context(){return this[Rr].context}get antialias(){return this[Rr].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return this[Rr].framebuffer}get framebufferWidth(){return this[Rr].context.drawingBufferWidth}get framebufferHeight(){return this[Rr].context.drawingBufferHeight}get _session(){return this[Rr].session}getViewport(t){return t._getViewport(this)}static getNativeFramebufferScaleFactor(t){if(!t)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return t[w].ended?0:1}};var zp=Symbol("@@webxr-polyfill/XRInputSourceEvent"),ln=class extends Event{constructor(t,e){super(t,e),this[zp]={frame:e.frame,inputSource:e.inputSource},Object.setPrototypeOf(this,ln.prototype)}get frame(){return this[zp].frame}get inputSource(){return this[zp].inputSource}};var mf=Symbol("@@webxr-polyfill/XRSessionEvent"),Ut=class extends Event{constructor(t,e){super(t,e),this[mf]={session:e.session},Object.setPrototypeOf(this,Ut.prototype)}get session(){return this[mf].session}};var el=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),cn=class extends Event{constructor(t,e){super(t,e),this[el]={session:e.session,added:e.added,removed:e.removed},Object.setPrototypeOf(this,cn.prototype)}get session(){return this[el].session}get added(){return this[el].added}get removed(){return this[el].removed}};var w=Symbol("@@webxr-polyfill/XRSession"),Bo=class extends xt{constructor(t){super(t)}get eye(){return this._specialType}_onPoseUpdate(t){this._inverseBaseMatrix=t.getBaseViewMatrix(this._specialType)}},Pr=class extends on{constructor(t,e,r){super();let i=e!="inline",o=new Nn({inlineVerticalFieldOfView:i?null:Math.PI*.5});this[w]={device:t,mode:e,immersive:i,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:r,activeRenderState:o,pendingRenderState:null,viewerSpace:new zt("viewer"),viewSpaces:[],currentInputSources:[]},i?this[w].viewSpaces.push(new Bo("left"),new Bo("right")):this[w].viewSpaces.push(new Bo("none")),this[w].onDeviceFrame=()=>{if(this[w].ended||this[w].suspended||(this[w].deviceFrameHandle=null,this[w].startDeviceFrameLoop(),this[w].pendingRenderState!==null&&(this[w].activeRenderState=new Nn(this[w].pendingRenderState),this[w].pendingRenderState=null,this[w].activeRenderState.baseLayer&&this[w].device.onBaseLayerSet(this[w].id,this[w].activeRenderState.baseLayer)),this[w].activeRenderState.baseLayer===null))return;let s=new Hn(t,this,this[w].id),a=this[w].currentFrameCallbacks=this[w].frameCallbacks;this[w].frameCallbacks=[],s[we].active=!0,s[we].animationFrame=!0,this[w].device.onFrameStart(this[w].id,this[w].activeRenderState),this._checkInputSourcesChange();let p=$a();for(let d=0;d<a.length;d++)try{!a[d].cancelled&&typeof a[d].callback=="function"&&a[d].callback(p,s)}catch(h){console.error(h)}this[w].currentFrameCallbacks=null,s[we].active=!1,this[w].device.onFrameEnd(this[w].id)},this[w].startDeviceFrameLoop=()=>{this[w].deviceFrameHandle===null&&(this[w].deviceFrameHandle=this[w].device.requestAnimationFrame(this[w].onDeviceFrame))},this[w].stopDeviceFrameLoop=()=>{let s=this[w].deviceFrameHandle;s!==null&&(this[w].device.cancelAnimationFrame(s),this[w].deviceFrameHandle=null)},this[w].onPresentationEnd=s=>{if(s!==this[w].id){this[w].suspended=!1,this[w].startDeviceFrameLoop(),this.dispatchEvent("focus",{session:this});return}this[w].ended=!0,this[w].stopDeviceFrameLoop(),t.removeEventListener("@@webxr-polyfill/vr-present-end",this[w].onPresentationEnd),t.removeEventListener("@@webxr-polyfill/vr-present-start",this[w].onPresentationStart),t.removeEventListener("@@webxr-polyfill/input-select-start",this[w].onSelectStart),t.removeEventListener("@@webxr-polyfill/input-select-end",this[w].onSelectEnd),this.dispatchEvent("end",new Ut("end",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-end",this[w].onPresentationEnd),this[w].onPresentationStart=s=>{s!==this[w].id&&(this[w].suspended=!0,this[w].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-start",this[w].onPresentationStart),this[w].onSelectStart=s=>{s.sessionId===this[w].id&&this[w].dispatchInputSourceEvent("selectstart",s.inputSource)},t.addEventListener("@@webxr-polyfill/input-select-start",this[w].onSelectStart),this[w].onSelectEnd=s=>{s.sessionId===this[w].id&&(this[w].dispatchInputSourceEvent("selectend",s.inputSource),this[w].dispatchInputSourceEvent("select",s.inputSource))},t.addEventListener("@@webxr-polyfill/input-select-end",this[w].onSelectEnd),this[w].onSqueezeStart=s=>{s.sessionId===this[w].id&&this[w].dispatchInputSourceEvent("squeezestart",s.inputSource)},t.addEventListener("@@webxr-polyfill/input-squeeze-start",this[w].onSqueezeStart),this[w].onSqueezeEnd=s=>{s.sessionId===this[w].id&&(this[w].dispatchInputSourceEvent("squeezeend",s.inputSource),this[w].dispatchInputSourceEvent("squeeze",s.inputSource))},t.addEventListener("@@webxr-polyfill/input-squeeze-end",this[w].onSqueezeEnd),this[w].dispatchInputSourceEvent=(s,a)=>{let p=new Hn(t,this,this[w].id),d=new ln(s,{frame:p,inputSource:a});p[we].active=!0,this.dispatchEvent(s,d),p[we].active=!1},this[w].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[w].activeRenderState}get environmentBlendMode(){return this[w].device.environmentBlendMode||"opaque"}async requestReferenceSpace(t){if(this[w].ended)return;if(!Co.includes(t))throw new TypeError(`XRReferenceSpaceType must be one of ${Co}`);if(!this[w].device.doesSessionSupportReferenceSpace(this[w].id,t))throw new DOMException(`The ${t} reference space is not supported by this session.`,"NotSupportedError");if(t==="viewer")return this[w].viewerSpace;let e=await this[w].device.requestFrameOfReferenceTransform(t);if(t==="bounded-floor")throw e?this[w].device.requestStageBounds()?new DOMException(`The WebXR polyfill does not support the ${t} reference space yet.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError");return new zt(t,e)}requestAnimationFrame(t){if(this[w].ended)return;let e=++this[w].frameHandle;return this[w].frameCallbacks.push({handle:e,callback:t,cancelled:!1}),e}cancelAnimationFrame(t){let e=this[w].frameCallbacks,r=e.findIndex(i=>i&&i.handle===t);r>-1&&(e[r].cancelled=!0,e.splice(r,1)),e=this[w].currentFrameCallbacks,e&&(r=e.findIndex(i=>i&&i.handle===t),r>-1&&(e[r].cancelled=!0))}get inputSources(){return this[w].device.getInputSources()}async end(){if(!this[w].ended)return this[w].immersive&&(this[w].ended=!0,this[w].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[w].onPresentationStart),this[w].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[w].onPresentationEnd),this[w].device.removeEventListener("@@webxr-polyfill/input-select-start",this[w].onSelectStart),this[w].device.removeEventListener("@@webxr-polyfill/input-select-end",this[w].onSelectEnd),this.dispatchEvent("end",new Ut("end",{session:this}))),this[w].stopDeviceFrameLoop(),this[w].device.endSession(this[w].id)}updateRenderState(t){if(this[w].ended){let r="Can't call updateRenderState on an XRSession that has already ended.";throw new Error(r)}if(t.baseLayer&&t.baseLayer._session!==this){let r="Called updateRenderState with a base layer that was created by a different session.";throw new Error(r)}if(t.inlineVerticalFieldOfView!==null&&t.inlineVerticalFieldOfView!==void 0)if(this[w].immersive){let r="inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.";throw new Error(r)}else t.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,t.inlineVerticalFieldOfView));if(this[w].pendingRenderState===null){let r=this[w].activeRenderState;this[w].pendingRenderState={depthNear:r.depthNear,depthFar:r.depthFar,inlineVerticalFieldOfView:r.inlineVerticalFieldOfView,baseLayer:r.baseLayer}}Object.assign(this[w].pendingRenderState,t)}_checkInputSourcesChange(){let t=[],e=[],r=this.inputSources,i=this[w].currentInputSources;for(let o of r)i.includes(o)||t.push(o);for(let o of i)r.includes(o)||e.push(o);(t.length>0||e.length>0)&&this.dispatchEvent("inputsourceschange",new cn("inputsourceschange",{session:this,added:t,removed:e})),this[w].currentInputSources.length=0;for(let o of r)this[w].currentInputSources.push(o)}};var Xn=Symbol("@@webxr-polyfill/XRInputSource"),Ir=class{constructor(t){this[Xn]={impl:t,gripSpace:new xt("grip",this),targetRaySpace:new xt("target-ray",this)}}get handedness(){return this[Xn].impl.handedness}get targetRayMode(){return this[Xn].impl.targetRayMode}get gripSpace(){let t=this[Xn].impl.targetRayMode;return t==="gaze"||t==="screen"?null:this[Xn].gripSpace}get targetRaySpace(){return this[Xn].targetRaySpace}get profiles(){return this[Xn].impl.profiles}get gamepad(){return this[Xn].impl.gamepad}};var Up=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),Cr=class extends Event{constructor(t,e){super(t,e),this[Up]={referenceSpace:e.referenceSpace,transform:e.transform||null},Object.setPrototypeOf(this,Cr.prototype)}get referenceSpace(){return this[Up].referenceSpace}get transform(){return this[Up].transform}};var tl={XRSystem:Vo,XRSession:Pr,XRSessionEvent:Ut,XRFrame:Hn,XRView:Sr,XRViewport:Mr,XRViewerPose:Tr,XRWebGLLayer:Oo,XRSpace:xt,XRReferenceSpace:zt,XRReferenceSpaceEvent:Cr,XRInputSource:Ir,XRInputSourceEvent:ln,XRInputSourcesChangeEvent:cn,XRRenderState:Nn,XRRigidTransform:an,XRPose:wr};var Gp=n=>typeof n.prototype.makeXRCompatible=="function"?!1:(n.prototype.makeXRCompatible=function(){return this[Do]=!0,Promise.resolve()},!0),Wp=n=>{let t=n.prototype.getContext;n.prototype.getContext=function(e,r){let i=t.call(this,e,r);return i&&(i[Za]=!0,r&&"xrCompatible"in r&&(i[Do]=r.xrCompatible)),i}};var hf=n=>!!(n.ImageBitmapRenderingContext&&n.createImageBitmap),ff=n=>{var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(n.navigator.userAgent||n.navigator.vendor||n.opera),t},xf=n=>{n.style.display="block",n.style.position="absolute",n.style.width=n.style.height="1px",n.style.top=n.style.left="0px"};var Sf=Ox(gf());var Vr=class extends on{constructor(t){super(),this.global=t,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(t,e){throw new Error("Not implemented")}isSessionSupported(t){throw new Error("Not implemented")}isFeatureSupported(t){throw new Error("Not implemented")}async requestSession(t,e){throw new Error("Not implemented")}requestAnimationFrame(t){throw new Error("Not implemented")}onFrameStart(t){throw new Error("Not implemented")}onFrameEnd(t){throw new Error("Not implemented")}doesSessionSupportReferenceSpace(t,e){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(t,e){}cancelAnimationFrame(t){throw new Error("Not implemented")}endSession(t){throw new Error("Not implemented")}getViewport(t,e,r,i){throw new Error("Not implemented")}getProjectionMatrix(t){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(t){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(t,e,r){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}};var o_={mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},s_={mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},a_={mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},vf={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},l_={mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[Math.PI*-.08,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},c_={mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},p_={mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},Kp={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},d_={"Daydream Controller":o_,"Gear VR Controller":c_,"HTC Vive Focus Controller":s_,"Oculus Go Controller":a_,"Oculus Touch (Right)":vf,"Oculus Touch (Left)":vf,"OpenVR Gamepad":l_,"Spatial Controller (Spatial Interaction Source) 045E-065A":Kp,"Spatial Controller (Spatial Interaction Source) 045E-065D":p_,"Windows Mixed Reality (Right)":Kp,"Windows Mixed Reality (Left)":Kp},Af=d_;var _f=et(.155,-.465,-.15),u_=et(-.155,-.465,-.15),m_=et(0,0,-.25),h_=et(0,0,.05),bf=et(-.08,.14,.08),Ef=.4,f_=.4,x_=.61,g_=.175,v_=.12,A_=.87,yf=180/Math.PI;function __(n,t,e){function r(p,d,h){return p<d?d:p>h?h:p}var i=t[0]*t[0],o=t[1]*t[1],s=t[2]*t[2],a=t[3]*t[3];if(e==="XYZ")n[0]=Math.atan2(2*(t[0]*t[3]-t[1]*t[2]),a-i-o+s),n[1]=Math.asin(r(2*(t[0]*t[2]+t[1]*t[3]),-1,1)),n[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),a+i-o-s);else if(e==="YXZ")n[0]=Math.asin(r(2*(t[0]*t[3]-t[1]*t[2]),-1,1)),n[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),a-i-o+s),n[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),a-i+o-s);else if(e==="ZXY")n[0]=Math.asin(r(2*(t[0]*t[3]+t[1]*t[2]),-1,1)),n[1]=Math.atan2(2*(t[1]*t[3]-t[2]*t[0]),a-i-o+s),n[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),a-i+o-s);else if(e==="ZYX")n[0]=Math.atan2(2*(t[0]*t[3]+t[2]*t[1]),a-i-o+s),n[1]=Math.asin(r(2*(t[1]*t[3]-t[0]*t[2]),-1,1)),n[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),a+i-o-s);else if(e==="YZX")n[0]=Math.atan2(2*(t[0]*t[3]-t[2]*t[1]),a-i+o-s),n[1]=Math.atan2(2*(t[1]*t[3]-t[0]*t[2]),a+i-o-s),n[2]=Math.asin(r(2*(t[0]*t[1]+t[2]*t[3]),-1,1));else if(e==="XZY")n[0]=Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),a-i+o-s),n[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),a+i-o-s),n[2]=Math.asin(r(2*(t[2]*t[3]-t[0]*t[1]),-1,1));else{console.log("No order given for quaternion to euler conversion.");return}}var Fo=class{constructor(){this.hand="right",this.headElbowOffset=_f,this.controllerQ=lt(),this.lastControllerQ=lt(),this.headQ=lt(),this.headPos=at(),this.elbowPos=at(),this.wristPos=at(),this.time=null,this.lastTime=null,this.rootQ=lt(),this.position=at()}setHandedness(t){this.hand!=t&&(this.hand=t,this.hand=="left"?this.headElbowOffset=u_:this.headElbowOffset=_f)}update(t,e){this.time=$a(),t&&(Ja(this.lastControllerQ,this.controllerQ),Ja(this.controllerQ,t)),e&&(Ga(this.headPos,e),Wa(this.headQ,e));let r=this.getHeadYawOrientation_(),i=this.quatAngle_(this.lastControllerQ,this.controllerQ),o=(this.time-this.lastTime)/1e3;i/o>x_?Ei(this.rootQ,this.rootQ,r,Math.min(i/g_,1)):Ja(this.rootQ,r);let a=et(0,0,-1);yr(a,a,this.controllerQ);let p=Po(a,[0,1,0]),d=this.clamp_((p-v_)/A_,0,1),h=Hp(this.rootQ);Fp(h,h),Bp(h,h,this.controllerQ);let x=this.elbowPos;Dp(x,this.headPos),bi(x,x,this.headElbowOffset);let A=kp(bf);Op(A,A,d),bi(x,x,A);let S=this.quatAngle_(h,lt())*yf,P=1-Math.pow(S/180,4);sssss;let R=Ef,V=1-Ef,B=P*(R+V*d*f_),L=lt();Ei(L,L,h,B);let k=Fp(lt(),L),H=Hp(h);Bp(H,H,k);let C=this.wristPos;Dp(C,h_),yr(C,C,L),bi(C,C,m_),yr(C,C,H),bi(C,C,x);let D=kp(bf);Op(D,D,d),bi(this.position,this.wristPos,D),yr(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let t=at();return __(t,this.headQ,"YXZ"),lf(lt(),0,t[1]*yf,0)}clamp_(t,e,r){return Math.min(Math.max(t,e),r)}quatAngle_(t,e){let r=[0,0,-1],i=[0,0,-1];return yr(r,r,t),yr(i,i,e),ef(r,i)}};var We=Symbol("@@webxr-polyfill/XRRemappedGamepad"),wf={pressed:!1,touched:!1,value:0};Object.freeze(wf);var Yp=class{constructor(t,e,r){if(r||(r={}),r.userAgentOverrides){for(let d in r.userAgentOverrides)if(navigator.userAgent.includes(d)){let h=r.userAgentOverrides[d];for(let x in h)x in r?Object.assign(r[x],h[x]):r[x]=h[x];break}}let i=new Array(r.axes&&r.axes.length?r.axes.length:t.axes.length),o=new Array(r.buttons&&r.buttons.length?r.buttons.length:t.buttons.length),s=null;if(r.gripTransform){let d=r.gripTransform.orientation||[0,0,0,1];s=jt(),On(s,Io(d,d),r.gripTransform.position||[0,0,0])}let a=null;if(r.targetRayTransform){let d=r.targetRayTransform.orientation||[0,0,0,1];a=jt(),On(a,Io(d,d),r.targetRayTransform.position||[0,0,0])}let p=r.profiles;r.displayProfiles&&e.displayName in r.displayProfiles&&(p=r.displayProfiles[e.displayName]),this[We]={gamepad:t,map:r,profiles:p||[t.id],mapping:r.mapping||t.mapping,axes:i,buttons:o,gripTransform:s,targetRayTransform:a},this._update()}_update(){let t=this[We].gamepad,e=this[We].map,r=this[We].axes;for(let o=0;o<r.length;++o)e.axes&&o in e.axes?e.axes[o]===null?r[o]=0:r[o]=t.axes[e.axes[o]]:r[o]=t.axes[o];if(e.axes&&e.axes.invert)for(let o of e.axes.invert)o<r.length&&(r[o]*=-1);let i=this[We].buttons;for(let o=0;o<i.length;++o)e.buttons&&o in e.buttons?e.buttons[o]===null?i[o]=wf:i[o]=t.buttons[e.buttons[o]]:i[o]=t.buttons[o]}get id(){return""}get _profiles(){return this[We].profiles}get index(){return-1}get connected(){return this[We].gamepad.connected}get timestamp(){return this[We].gamepad.timestamp}get mapping(){return this[We].mapping}get axes(){return this[We].axes}get buttons(){return this[We].buttons}get hapticActuators(){return this[We].gamepad.hapticActuators}},Ho=class{constructor(t,e,r=0,i=-1){this.polyfill=t,this.display=e,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new Ir(this),this.lastPosition=at(),this.emulatedPosition=!1,this.basePoseMatrix=jt(),this.outputMatrix=jt(),this.primaryButtonIndex=r,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=i,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(t){this.nativeGamepad!==t&&(this.nativeGamepad=t,t?this.gamepad=new Yp(t,this.display,Af[t.id]):this.gamepad=null),this.handedness=t.hand===""?"none":t.hand,this.gamepad&&this.gamepad._update(),t.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!t.pose.hasPosition):t.hand===""&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let t=this.nativeGamepad.pose,e=t.position,r=t.orientation;if(!e&&!r)return;e?(this.lastPosition[0]=e[0],this.lastPosition[1]=e[1],this.lastPosition[2]=e[2]):t.hasPosition?e=this.lastPosition:(this.armModel||(this.armModel=new Fo),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(r,this.polyfill.getBasePoseMatrix()),e=this.armModel.getPosition()),On(this.basePoseMatrix,r,e)}else $h(this.basePoseMatrix,this.polyfill.getBasePoseMatrix());return this.basePoseMatrix}getXRPose(t,e){switch(this.updateBasePoseMatrix(),e){case"target-ray":t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[We].targetRayTransform&&sn(this.outputMatrix,this.outputMatrix,this.gamepad[We].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[We].gripTransform&&sn(this.outputMatrix,this.outputMatrix,this.gamepad[We].gripTransform);break;default:return null}return t._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}};var G4=Symbol("@@webxr-polyfill/WebVRDevice"),No=!1,Tf={highRefreshRate:!0},Mf={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},b_=0,Jp=class{constructor(t,e,r={}){if(this.mode=t,this.enabledFeatures=e,this.outputContext=null,this.immersive=t=="immersive-vr"||t=="immersive-ar",this.ended=null,this.baseLayer=null,this.id=++b_,this.modifiedCanvasLayer=!1,this.outputContext&&!No){let i=r.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(i)}}},Lr=class extends Vr{constructor(t,e){let{canPresent:r}=e.capabilities;super(t),this.display=e,this.frame=new t.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=r,this.baseModelMatrix=jt(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),t.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=t.navigator&&"getGamepads"in t.navigator,this.HAS_BITMAP_SUPPORT=hf(t)}get depthNear(){return this.display.depthNear}set depthNear(t){this.display.depthNear=t}get depthFar(){return this.display.depthFar}set depthFar(t){this.display.depthFar=t}onBaseLayerSet(t,e){let r=this.sessions.get(t),i=e.context.canvas;if(r.immersive){let o=this.display.getEyeParameters("left"),s=this.display.getEyeParameters("right");i.width=Math.max(o.renderWidth,s.renderWidth)*2,i.height=Math.max(o.renderHeight,s.renderHeight),this.display.requestPresent([{source:i,attributes:Tf}]).then(()=>{!No&&!this.global.document.body.contains(i)&&(r.modifiedCanvasLayer=!0,this.global.document.body.appendChild(i),xf(i)),r.baseLayer=e})}else r.baseLayer=e}isSessionSupported(t){return!(t=="immersive-ar"||t=="immersive-vr"&&this.canPresent===!1)}isFeatureSupported(t){switch(t){case"viewer":return!0;case"local":return!0;case"local-floor":return!0;case"bounded":return!1;case"unbounded":return!1;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let r=t=="immersive-vr";if(r){let o=this.global.document.createElement("canvas");if(!No){let s=o.getContext("webgl")}await this.display.requestPresent([{source:o,attributes:Tf}])}let i=new Jp(t,e,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(i.id,i),r&&(this.immersiveSession=i,this.dispatchEvent("@@webxr-polyfill/vr-present-start",i.id)),Promise.resolve(i.id)}requestAnimationFrame(t){return this.display.requestAnimationFrame(t)}getPrimaryButtonIndex(t){let e=0,r=t.id.toLowerCase();for(let i in Mf)if(r.includes(i)){e=Mf[i];break}return Math.min(e,t.buttons.length-1)}onFrameStart(t,e){this.display.depthNear=e.depthNear,this.display.depthFar=e.depthFar,this.display.getFrameData(this.frame);let r=this.sessions.get(t);if(r.immersive&&this.CAN_USE_GAMEPAD){let i=this.gamepadInputSources;this.gamepadInputSources={};let o=this.global.navigator.getGamepads();for(let s=0;s<o.length;++s){let a=o[s];if(a&&a.displayId>0){let p=i[s];if(p||(p=new Ho(this,this.display,this.getPrimaryButtonIndex(a))),p.updateFromGamepad(a),this.gamepadInputSources[s]=p,p.primaryButtonIndex!=-1){let d=a.buttons[p.primaryButtonIndex].pressed;d&&!p.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:r.id,inputSource:p.inputSource}):!d&&p.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:r.id,inputSource:p.inputSource}),p.primaryActionPressed=d}if(p.primarySqueezeButtonIndex!=-1){let d=a.buttons[p.primarySqueezeButtonIndex].pressed;d&&!p.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:r.id,inputSource:p.inputSource}):!d&&p.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:r.id,inputSource:p.inputSource}),p.primarySqueezeActionPressed=d}}}}if(!No&&!r.immersive&&r.baseLayer){let i=r.baseLayer.context.canvas;qa(this.frame.leftProjectionMatrix,e.inlineVerticalFieldOfView,i.width/i.height,e.depthNear,e.depthFar)}}onFrameEnd(t){let e=this.sessions.get(t);if(!(e.ended||!e.baseLayer)){if(e.outputContext&&!(e.immersive&&!this.display.capabilities.hasExternalDisplay)){let r=e.immersive&&this.display.capabilities.hasExternalDisplay,i=e.baseLayer.context.canvas,o=r?i.width/2:i.width,s=i.height;if(!No){let a=e.outputContext.canvas,p=a.width,d=a.height,h=e.renderContext;this.HAS_BITMAP_SUPPORT?i.transferToImageBitmap?h.transferFromImageBitmap(i.transferToImageBitmap()):this.global.createImageBitmap(i,0,0,o,s,{resizeWidth:p,resizeHeight:d}).then(x=>h.transferFromImageBitmap(x)):h.drawImage(i,0,0,o,s,0,0,p,d)}}e.immersive&&e.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(t){this.display.cancelAnimationFrame(t)}async endSession(t){let e=this.sessions.get(t);if(!e.ended){if(e.immersive)return this.display.exitPresent();e.ended=!0}}doesSessionSupportReferenceSpace(t,e){let r=this.sessions.get(t);return r.ended?!1:r.enabledFeatures.has(e)}requestStageBounds(){if(this.display.stageParameters){let t=this.display.stageParameters.sizeX,e=this.display.stageParameters.sizeZ,r=[];return r.push(-t/2),r.push(-e/2),r.push(t/2),r.push(-e/2),r.push(t/2),r.push(e/2),r.push(-t/2),r.push(e/2),r}return null}async requestFrameOfReferenceTransform(t,e){return(t==="local-floor"||t==="bounded-floor")&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(t){if(t==="left")return this.frame.leftProjectionMatrix;if(t==="right")return this.frame.rightProjectionMatrix;if(t==="none")return this.frame.leftProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(t,e,r,i){let o=this.sessions.get(t),{width:s,height:a}=r.context.canvas;if(!o.immersive)return i.x=i.y=0,i.width=s,i.height=a,!0;if(e==="left"||e==="none")i.x=0;else if(e==="right")i.x=s/2;else return!1;return i.y=0,i.width=s/2,i.height=a,!0}getBasePoseMatrix(){let{position:t,orientation:e}=this.frame.pose;return!t&&!e?this.baseModelMatrix:(t||(t=this.tempVec3,t[0]=t[1]=t[2]=0),On(this.baseModelMatrix,e,t),this.baseModelMatrix)}getBaseViewMatrix(t){if(t==="left"||t==="none")return this.frame.leftViewMatrix;if(t==="right")return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let t=[];for(let e in this.gamepadInputSources)t.push(this.gamepadInputSources[e].inputSource);return t}getInputPose(t,e,r){if(!e)return null;for(let i in this.gamepadInputSources){let o=this.gamepadInputSources[i];if(o.inputSource===t)return o.getXRPose(e,r)}return null}onWindowResize(){}onVRDisplayPresentChange(t){this.display.isPresenting||this.sessions.forEach(e=>{if(e.immersive&&!e.ended){if(e.modifiedCanvasLayer){let r=e.baseLayer.context.canvas;document.body.removeChild(r),r.setAttribute("style","")}this.immersiveSession===e&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",e.id)}})}};var Xo=class extends Lr{constructor(t,e){let r=new Sf.default(e||{});super(t,r),this.display=r,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}};var E_=!1,y_=0,$p=class{constructor(t,e){this.mode=t,this.enabledFeatures=e,this.ended=null,this.baseLayer=null,this.id=++y_}},jo=class extends Vr{constructor(t){super(t),this.sessions=new Map,this.projectionMatrix=jt(),this.identityMatrix=jt()}onBaseLayerSet(t,e){let r=this.sessions.get(t);r.baseLayer=e}isSessionSupported(t){return t=="inline"}isFeatureSupported(t){switch(t){case"viewer":return!0;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let r=new $p(t,e);return this.sessions.set(r.id,r),Promise.resolve(r.id)}requestAnimationFrame(t){return window.requestAnimationFrame(t)}cancelAnimationFrame(t){window.cancelAnimationFrame(t)}onFrameStart(t,e){if(E_)return;let r=this.sessions.get(t);if(r.baseLayer){let i=r.baseLayer.context.canvas;qa(this.projectionMatrix,e.inlineVerticalFieldOfView,i.width/i.height,e.depthNear,e.depthFar)}}onFrameEnd(t){}async endSession(t){let e=this.sessions.get(t);e.ended=!0}doesSessionSupportReferenceSpace(t,e){let r=this.sessions.get(t);return r.ended?!1:r.enabledFeatures.has(e)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(t,e){return null}getProjectionMatrix(t){return this.projectionMatrix}getViewport(t,e,r,i){let o=this.sessions.get(t),{width:s,height:a}=r.context.canvas;return i.x=i.y=0,i.width=s,i.height=a,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(t){return this.identityMatrix}getInputSources(){return[]}getInputPose(t,e,r){return null}onWindowResize(){}};var w_=async function(n){let t=null;if("getVRDisplays"in n.navigator)try{let e=await n.navigator.getVRDisplays();e&&e.length&&(t=new Lr(n,e[0]))}catch{}return t},Rf=async function(n,t){if(t.webvr){let r=await w_(n);if(r)return r}let e=ff(n);return e&&t.cardboard||!e&&t.allowCardboardOnDesktop?(n.VRFrameData||(n.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new Xo(n,t.cardboardConfig)):new jo(n)};var T_={global:Ua,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},nl=["navigator","HTMLCanvasElement","WebGLRenderingContext"],zo=class{constructor(t={}){this.config=Object.freeze(Object.assign({},T_,t)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}_injectPolyfill(t){if(!nl.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${nl}`);for(let e of Object.keys(tl))t[e]!==void 0?console.warn(`${e} already defined on global.`):t[e]=tl[e];Gp(t.WebGLRenderingContext)&&(Wp(t.HTMLCanvasElement),t.OffscreenCanvas&&Wp(t.OffscreenCanvas),t.WebGL2RenderingContext&&Gp(t.WebGL2RenderingContext),window.isSecureContext||console.warn(`WebXR Polyfill Warning:
This page is not running in a secure context (https:// or localhost)!
This means that although the page may be able to use the WebXR Polyfill it will
not be able to use native WebXR implementations, and as such will not be able to
access dedicated VR or AR hardware, and will not be able to take advantage of
any performance improvements a native WebXR implementation may offer. Please
host this content on a secure origin for the best user experience.
`)),this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let t=Rf(this.global,this.config);this.xr=new tl.XRSystem(t),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(t){if(!nl.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${nl}`);if(t.navigator.xr&&"supportsSession"in t.navigator.xr&&!("isSessionSupported"in t.navigator.xr)){let e=t.navigator.xr.supportsSession;t.navigator.xr.isSessionSupported=function(r){return e.call(this,r).then(()=>!0).catch(()=>!1)},t.navigator.xr.supportsSession=function(r){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),e.call(this,r)}}}};navigator.xr||(console.info("Polyfilling WebXR API"),new zo);var il=class extends j{constructor(e,r,i,o,s){super(e);this.mode=r;this.session=i;this.referenceSpaceType=o;this.sessionMode=s}},ol=class extends il{constructor(t,e,r,i){super("sessionstarted",t,e,r,i)}},sl=class extends il{constructor(t,e,r,i){super("sessionstopped",t,e,r,i)}},rl=new Map([["VR",{referenceSpaceType:"local-floor",sessionMode:"immersive-vr"}],["AR",{referenceSpaceType:"local-floor",sessionMode:"immersive-ar"}]]),al=class extends Z{constructor(e,r,i,o){super();this.renderer=e;this.camera=r;this.fullscreenElement=i;this.enableFullResolution=o;this._currentMode="None";this.buttons=new Map;this.currentSession=null;this.screenUI=null;this.wasVisible=new Map;this.lastWidth=0;this.lastHeight=0;this.addEventListener("sessionstarted",s=>{s.sessionMode==="inline"&&(this.camera.fov=s.session.renderState.inlineVerticalFieldOfView*180/Math.PI)}),this.addEventListener("sessionstopped",s=>{s.sessionMode==="inline"&&(this.camera.fov=50)}),this.renderer.xr.addEventListener("sessionstart",()=>this.onSessionStarted()),this.renderer.xr.addEventListener("sessionend",()=>this.onSessionEnded()),this.refresh()}setUI(e,r,i,o){this.screenUI=e,this.buttons.set(r.mode,r),this.buttons.set(i.mode,i),o&&(this.buttons.set(o.mode,o),o.available=es());for(let s of this.buttons.values())this.wasVisible.set(s,s.visible),s.addEventListener("click",this.toggleMode.bind(this,s.mode));r.available=!It()&&Lp(),i.available=ts()}get visible(){return Vt(this.renderer.domElement)}set visible(e){Re(this.renderer.domElement,e),this.screenUI&&Re(this.screenUI,e,"grid")}get currentMode(){return this._currentMode}resize(){if(!this.renderer.xr.isPresenting){let e=this.renderer.domElement.clientWidth,r=this.renderer.domElement.clientHeight;e>0&&r>0&&(e!==this.lastWidth||r!==this.lastHeight)&&(this.renderer.setPixelRatio(devicePixelRatio),this.renderer.setSize(e,r,!1),this.camera.aspect=e/r,this.camera.updateProjectionMatrix(),this.lastWidth=e,this.lastHeight=r)}}getMetrics(){let e=this.renderer.domElement.clientWidth,r=this.renderer.domElement.clientHeight,i=this.renderer.getPixelRatio(),o=this.camera.fov;return{width:e,height:r,pixelRatio:i,fov:o}}setMetrics(e,r,i,o){this.renderer.setPixelRatio(i),this.renderer.setSize(e,r,!1),this.camera.aspect=e/r,this.camera.fov=o,this.camera.updateProjectionMatrix()}async refresh(){await Promise.all(Array.from(this.buttons.values()).filter(e=>e.available&&e.mode!=="Fullscreen").map(async e=>{let r=rl.get(e.mode);if(e.available=g(r),e.available){let i=navigator.xr&&await navigator.xr.isSessionSupported(r.sessionMode),o=!es()&&Bl()&&r.sessionMode==="immersive-vr"&&r.referenceSpaceType==="local-floor";e.available=i||o}}))}async toggleMode(e){e==="Fullscreen"?await this.toggleFullscreen():e!=="None"&&await this.toggleXR(e)}async start(e){e!==this.currentMode&&(await this.toggleMode(this.currentMode),await this.toggleMode(e))}async stop(){await this.toggleMode(this.currentMode)}get isFullscreen(){return document.fullscreen}async startFullscreen(){this.isFullscreen||(await this.fullscreenElement.requestFullscreen({navigationUI:"show"}),this.setActive("Fullscreen"),this.dispatchEvent(new ol("Fullscreen",null,null,null)))}async stopFullscreen(){this.isFullscreen&&(await document.exitFullscreen(),this.setActive("None"),this.dispatchEvent(new sl("Fullscreen",null,null,null)))}async toggleFullscreen(){this.isFullscreen?await this.stopFullscreen():await this.startFullscreen()}async toggleXR(e){let r=rl.get(e);if(g(r)){if(this.currentSession)this.currentSession.end();else if(navigator.xr){this.camera.position.set(0,0,0),this.camera.quaternion.identity();try{let i=await navigator.xr.requestSession(r.sessionMode,{optionalFeatures:["local-floor","bounded-floor","high-refresh-rate","hand-tracking","layers"]});if(this.setActive(e),this.currentSession=i,this.renderer.xr.setReferenceSpaceType(r.referenceSpaceType),this.enableFullResolution&&"XRWebGLLayer"in window&&"getNativeFramebufferScaleFactor"in XRWebGLLayer){let o=XRWebGLLayer.getNativeFramebufferScaleFactor(i);this.renderer.xr.setFramebufferScaleFactor(o)}this.renderer.xr.setSession(i)}catch(i){console.error(`Couldn't start session type '${r.sessionMode}'. Reason: ${i&&i.message||i||"UNKNOWN"}`)}}}}onSessionStarted(){let e=this.currentMode,r=rl.get(this.currentMode),i=this.currentSession;if(i.supportedFrameRates){let o=Math.max(...i.supportedFrameRates);console.log("Changing framerate to",o),i.updateTargetFrameRate(o)}this.dispatchEvent(new ol(e,i,r.referenceSpaceType,r.sessionMode))}onSessionEnded(){let e=this.currentMode,r=rl.get(this.currentMode),i=this.currentSession;this.currentSession=null,this.renderer.xr.setSession(null),this.setActive("None"),this.dispatchEvent(new sl(e,i,r.referenceSpaceType,r.sessionMode))}setActive(e){for(let r of this.buttons.values())r.active=r.mode===e,r.visible=this.wasVisible.get(r)&&(e==="None"||r.mode===e||e==="Fullscreen");this._currentMode=e}};var Pf=new THREE.Vector3(0,1,0),Je=2048,yi=Je/2,M_=[1,0,2,3,4,5],pn={rows:3,columns:4,indices:[[-1,2,-1,-1],[0,5,1,4],[-1,3,-1,-1]],rotations:[[0,Math.PI,0,0],[0,0,0,0],[0,Math.PI,0,0]]},Zp=new THREE.Color(0),ll=class{constructor(t){this.env=t;this.rt=new THREE.WebGLCubeRenderTarget(Je);this.rtScene=new THREE.Scene;this.rtCamera=new THREE.CubeCamera(.01,10,this.rt);this._rotation=new THREE.Quaternion;this.layerRotation=new THREE.Quaternion().identity();this.stageRotation=new THREE.Quaternion().identity();this.images=null;this.canvases=new Array(6);this.contexts=new Array(6);this.curImagePath=null;this.layer=null;this.wasVisible=!1;this.wasWebXRLayerAvailable=null;this.stageHeading=0;this.rotationNeedsUpdate=!1;this.imageNeedsUpdate=!1;this.webXRLayerEnabled=!0;this.visible=!0;this.webXRLayerEnabled&&=this.env.hasXRCompositionLayers,this.env.scene.background=Zp;for(let e=0;e<this.canvases.length;++e){let r=this.canvases[e]=or(Je,Je);this.contexts[e]=r.getContext("2d")}for(let e=0;e<pn.rows;++e){let r=pn.indices[e],i=pn.rotations[e];for(let o=0;o<pn.columns;++o){let s=r[o];if(s>-1){let a=this.contexts[s],p=i[o];p>0&&(p%2,a.translate(yi,yi),a.rotate(p),a.translate(-yi,-yi))}}}this.rt.texture.name="SkyboxOutput",this.rtScene.add(this.rtCamera),this.flipped=or(Je,Je),this.flipper=this.flipped.getContext("2d"),this.flipper.fillStyle=Zp.getHexString(),this.flipper.scale(-1,1),this.flipper.translate(-Je,0),this.setImages("",this.canvases),Object.seal(this)}setImage(t,e){if(t!==this.curImagePath){let r=e.width/pn.columns,i=e.height/pn.rows;for(let o=0;o<pn.rows;++o){let s=pn.indices[o];for(let a=0;a<pn.columns;++a){let p=s[a];p>-1&&this.contexts[p].drawImage(e,a*r,o*i,r,i,0,0,Je,Je)}}this.setImages(t,this.canvases)}}setImages(t,e){(t!==this.curImagePath||e!==this.images)&&(this.curImagePath=t,e!==this.images&&(g(this.cube)&&In(this.cube),this.images=e,this.rtScene.background=this.cube=new THREE.CubeTexture(this.images),this.cube.name="SkyboxInput")),this.updateImages()}updateImages(){this.cube.needsUpdate=!0,this.imageNeedsUpdate=!0}get rotation(){return this._rotation}set rotation(t){let{x:e,y:r,z:i,w:o}=this._rotation;if(Am(t))this._rotation.copy(t);else if(_m(t))this._rotation.setFromEuler(t);else if(Be(t))if(t.length===4&&ae(t[0])&&ae(t[1])&&ae(t[2])&&ae(t[3]))this._rotation.fromArray(t);else throw new Error("Skybox rotation was not a valid array format. Needs an array of 4 numbers.");else jd(t)?this._rotation.setFromAxisAngle(Pf,t):(g(t)&&console.warn("Skybox rotation must be a THREE.Quaternion, THREE.Euler, number[] (representing a Quaternion), or a number (representing rotation about the Y-axis)."),this._rotation.identity());this.rotationNeedsUpdate=this._rotation.x!==e||this._rotation.y!==r||this._rotation.z!==i||this._rotation.w!==o}update(t){if(this.cube){let e=this.webXRLayerEnabled&&this.env.renderer.xr.isPresenting&&g(t)&&g(this.env.xrBinding);if(e!==this.wasWebXRLayerAvailable){if(e){let r=this.env.renderer.xr.getReferenceSpace();this.layer=this.env.xrBinding.createCubeLayer({space:r,layout:"mono",isStatic:!1,viewPixelWidth:Je,viewPixelHeight:Je}),this.env.addWebXRLayer(this.layer,Number.MAX_VALUE)}else this.layer&&(this.env.removeWebXRLayer(this.layer),this.layer.destroy(),this.layer=null);this.imageNeedsUpdate=this.rotationNeedsUpdate=!0}if(this.env.scene.background=this.layer?null:this.visible?this.rt.texture:Zp,this.layer?((this.visible!==this.wasVisible||this.layer.needsRedraw)&&(this.imageNeedsUpdate=!0),this.env.avatar.heading!==this.stageHeading&&(this.rotationNeedsUpdate=!0,this.stageHeading=this.env.avatar.heading,this.stageRotation.setFromAxisAngle(Pf,this.env.avatar.heading))):this.rotationNeedsUpdate=this.imageNeedsUpdate=this.imageNeedsUpdate||this.rotationNeedsUpdate,this.rotationNeedsUpdate&&(this.layerRotation.copy(this.rotation).invert(),this.layer?(this.layerRotation.multiply(this.stageRotation),this.layer.orientation=new DOMPointReadOnly(this.layerRotation.x,this.layerRotation.y,this.layerRotation.z,this.layerRotation.w)):this.rtCamera.quaternion.copy(this.layerRotation)),this.imageNeedsUpdate)if(this.layer){let r=this.env.renderer.getContext(),i=this.env.xrBinding.getSubImage(this.layer,t),o=this.cube.images;this.flipper.fillRect(0,0,Je,Je),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.bindTexture(r.TEXTURE_CUBE_MAP,i.colorTexture);for(let s=0;s<o.length;++s){if(this.visible){let a=o[M_[s]];this.flipper.drawImage(a,0,0,a.width,a.height,0,0,Je,Je)}r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.flipped)}r.bindTexture(r.TEXTURE_CUBE_MAP,null)}else this.rtCamera.update(this.env.renderer,this.rtScene);this.imageNeedsUpdate=!1,this.rotationNeedsUpdate=!1,this.wasVisible=this.visible,this.wasWebXRLayerAvailable=e}}};var ed=class extends Ji{constructor(){super();this.frame=null;Object.seal(this)}set(e,r,i){super.set(e,r),this.frame=i}},cl=class{constructor(t){this.renderer=t;this.tickHandlers=new Array;this.lt=-1;this._isRunning=!1;let e=new ed,r=0;this._onTick=(i,o)=>{this.lt>=0&&(r=i-this.lt,e.set(i,r,o),this.tick(e)),this.lt=i}}get isRunning(){return this._isRunning}restart(){this.stop(),this.start()}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){Ke(this.tickHandlers,t)}setAnimationLoop(t){this.renderer.setAnimationLoop(t),this._isRunning=g(t)}start(){this.isRunning||this.setAnimationLoop(this._onTick)}stop(){this.isRunning&&(this.setAnimationLoop(null),this.lt=-1)}tick(t){for(let e of this.tickHandlers)e(t)}};var pl=new THREE.PerspectiveCamera,If=new THREE.Vector4,td=new THREE.Vector4,Cf=15,S_=Jd(Cf);Lt(ee("#frontBuffer",Gr("absolute"),$n(0),er(0),Et("100%"),Jt("100%"),An(0),_n(0),nu(0),hu("none")));var dl=class extends Z{constructor(e,r,i,o){super();this.fetcher=r;this.defaultAvatarHeight=i;this.layers=new Array;this.layerSortOrder=new Map;this.fadeDepth=0;this.cursor3D=new gi;this.camera=new THREE.PerspectiveCamera(50,1,.01,1e3);this.scene=new THREE.Scene;this.stage=Tt("Stage");this.ambient=new THREE.AmbientLight(16777215,.5);this.sun=new THREE.DirectionalLight(16777215,.75);this.ground=new THREE.GridHelper(S_,Cf,12632256,8421504);this.foreground=Tt("Foreground");this.loadingBar=new za;this.enableSpectator=!1;this._xrBinding=null;this._xrMediaBinding=null;this._hasXRMediaLayers=null;this._hasXRCompositionLayers=null;Qr(e)&&(e.style.backgroundColor="black"),this.renderer=new THREE.WebGLRenderer({canvas:e,powerPreference:"high-performance",precision:"lowp",antialias:!0,alpha:!0,premultipliedAlpha:!0,depth:!0,logarithmicDepthBuffer:!0,stencil:!1,preserveDrawingBuffer:!1}),this.renderer.domElement.tabIndex=1,this.fovControl=new ya(this.camera),this.screenControl=new al(this.renderer,this.camera,this.renderer.domElement.parentElement,o),this.fader=new ja("ViewFader"),this.worldUISpace=new fa("WorldUISpace",.2,20,.125),this.avatar=new Ea(this.renderer,this.camera,this.fader,i),this.eventSystem=new Xa(this),this.skybox=new ll(this),this.timer=new cl(this.renderer),this.renderer.xr.enabled=!0,this.sun.name="Sun",this.sun.position.set(0,1,1),this.sun.lookAt(0,0,0),this.sun.layers.enableAll();let s=()=>{this.ground.visible=this.renderer.xr.isPresenting};this.screenControl.addEventListener("sessionstarted",s),this.screenControl.addEventListener("sessionstopped",s),s(),this.ambient.name="Fill",this.ambient.layers.enableAll(),this.loadingBar.object.name="MainLoadingBar",this.loadingBar.object.position.set(0,-.25,-2),this.scene.layers.enableAll(),this.avatar.addFollower(this.worldUISpace),this.timer.addTickHandler(a=>this.update(a)),Le(this.scene,this.sun,this.ambient,Le(this.stage,this.ground,this.camera,this.avatar,...this.eventSystem.hands),this.foreground,Le(this.worldUISpace,this.loadingBar)),this.timer.start(),globalThis.env=this}get gl(){return this.renderer.getContext()}get referenceSpace(){return this.renderer.xr.getReferenceSpace()}update(e){if(this.screenControl.visible){let r=this.xrSession;this._xrBinding=this.renderer.xr.getBinding(),this.hasXRMediaLayers&&this._xrMediaBinding===null===this.renderer.xr.isPresenting&&(this._xrMediaBinding===null&&g(r)?(this._xrMediaBinding=new XRMediaBinding(r),console.log("Media binding created")):this._xrMediaBinding=null);let i=r&&this.renderer.xr.getBaseLayer();i!==this.baseLayer&&(g(this.baseLayer)&&(this.removeWebXRLayer(this.baseLayer),this.baseLayer=null),g(i)&&(this.baseLayer=i,this.addWebXRLayer(i,0))),this.screenControl.resize(),this.eventSystem.update(),this.fovControl.update(e.dt),this.avatar.update(e.dt),this.worldUISpace.update(this.avatar.height,this.avatar.worldPos,this.avatar.worldHeading,e.dt),this.fader.update(e.dt),wm(e.dt),this.loadingBar.update(e.sdt),this.preRender(e),this.skybox.update(e.frame);let o=hi(this.renderer,this.camera);if(o!==this.camera){let s=o;s.layers.mask=this.camera.layers.mask;for(let a=0;a<s.cameras.length;++a){let p=s.cameras[a];p.layers.mask=this.camera.layers.mask,p.layers.enable(a+1),s.layers.enable(a+1)}}if(this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.enableSpectator){if(!this.renderer.xr.isPresenting)If.copy(td),this.renderer.getViewport(td);else if(Or()&&!Rd()){pl.projectionMatrix.copy(this.camera.projectionMatrix),pl.position.copy(o.position),pl.quaternion.copy(o.quaternion);let s=this.renderer.getRenderTarget();this.renderer.xr.isPresenting=!1,this.renderer.setRenderTarget(null),this.renderer.setViewport(If),this.renderer.clear(),this.renderer.render(this.scene,pl),this.renderer.setViewport(td),this.renderer.setRenderTarget(s),this.renderer.xr.isPresenting=!0}}}}preRender(e){}async onQuitting(){this.dispatchEvent(new j("quitting")),window.location.href="/"}get hasAlpha(){return this.renderer.getContextAttributes().alpha}get xrSession(){return this.renderer.xr.getSession()}get xrBinding(){return this._xrBinding}get xrMediaBinding(){return this._xrMediaBinding}get isReadyForLayers(){return this.hasAlpha&&(!qt||Pd.major>=15)}get hasXRMediaLayers(){return this._hasXRMediaLayers===null&&(this._hasXRMediaLayers=this.isReadyForLayers&&"XRMediaBinding"in globalThis&&se(XRMediaBinding.prototype.createQuadLayer)),this._hasXRMediaLayers}get hasXRCompositionLayers(){return this._hasXRCompositionLayers===null&&(this._hasXRCompositionLayers=this.isReadyForLayers&&"XRWebGLBinding"in globalThis&&se(XRWebGLBinding.prototype.createCubeLayer)),this._hasXRCompositionLayers}addWebXRLayer(e,r){this.layers.push(e),this.layerSortOrder.set(e,r),Wn(this.layers,i=>-this.layerSortOrder.get(i)),this.updateLayers()}removeWebXRLayer(e){this.layerSortOrder.delete(e),Ke(this.layers,e),this.updateLayers()}updateLayers(){let e=this.xrSession;g(e)&&e.updateRenderState({layers:this.layers})}clearScene(){this.dispatchEvent(new j("sceneclearing")),In(this.foreground),this.dispatchEvent(new j("scenecleared"))}async fadeOut(){++this.fadeDepth,this.fadeDepth===1&&(await this.fader.fadeOut(),this.skybox.visible=!1,this.camera.layers.set(xi),this.loadingBar.start(),await this.fader.fadeIn())}async fadeIn(){--this.fadeDepth,this.fadeDepth===0&&(await this.fader.fadeOut(),this.camera.layers.set(wa),this.skybox.visible=!0,await this.fader.fadeIn())}async loadModel(e,r){let o=await new Vn().loadAsync(e,s=>{g(r)&&r.report(s.loaded,s.total,e)});return o.scene.traverse(s=>{if(ar(s)){s.isCollider=!0;let a=s.material;a.side=THREE.FrontSide,a.needsUpdate=!0}}),o.scene}async load3DCursor(e,r){let o=(await this.loadModel(e,r)).children.slice(0);for(let s of o)this.cursor3D.add(s.name,s);this.eventSystem.refreshCursors(),this.dispatchEvent(new j("newcursorloaded"))}async load(e){await this.load3DCursor("/models/Cursors.glb",e)}};var ul=class{constructor(t,e){this.name=t;this.analyzer=em(this.name,e,{fftSize:32,minDecibels:-70}),this.buffer=new Uint8Array(this.analyzer.frequencyBinCount)}_level=0;maxLevel=0;analyzer;buffer;dispose(){ie(this.analyzer)}get level(){return this.analyzer.getByteFrequencyData(this.buffer),this._level=Math.max(...this.buffer),isFinite(this._level)&&(this.maxLevel=Math.max(this.maxLevel,this._level),this.maxLevel>0&&(this._level/=this.maxLevel)),this._level}get input(){return this.analyzer}get output(){return this.analyzer}};Lt(ee(".input-range-with-number",Ue("grid"),hs("column"),ou("5px"),vn("1fr auto")));var nd=class extends Z{element;rangeInput;numberInput;constructor(...t){super(),this.element=he(Ee("input-range-with-number"),this.rangeInput=Vu(...t),this.numberInput=Cu()),this.numberInput.min=this.rangeInput.min,this.numberInput.max=this.rangeInput.max,this.numberInput.step=this.rangeInput.step,this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.numberInput.disabled=this.rangeInput.disabled,this.numberInput.placeholder=this.rangeInput.placeholder,this.numberInput.addEventListener("input",()=>{this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber,this.rangeInput.dispatchEvent(new Event("input"))}),this.rangeInput.addEventListener("input",()=>{this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.dispatchEvent(new j("input"))})}get value(){return this.rangeInput.value}set value(t){this.rangeInput.value=this.numberInput.value=t}get valueAsNumber(){return this.rangeInput.valueAsNumber}set valueAsNumber(t){this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber=t}get disabled(){return this.rangeInput.disabled}set disabled(t){this.rangeInput.disabled=this.numberInput.disabled=t}};function rd(...n){return new nd(...n)}var ml=class{constructor(t,...e){this.name=t;this.properties=e}properties};function Vf(n,...t){return new ml(n,...t)}Lt(ee("dl",Ue("grid"),hs("row"),vn("auto 1fr"),An("1em")),ee("dt",Jn(1),Zn("right"),mu("1em")),ee("dd",Zn("left"),Jn(2),lu("0")),ee("dl > span, dl > div",Jn(1,3)),ee("dl .alert",Et("20em")));var R_="DefaultPropertyGroup"+bt(16),hl=class{element;rowGroups=new Map;constructor(...t){this.element=yu(...this.createElements(t))}append(...t){me(this.element,...this.createElements(t))}createElements(t){return t.flatMap(e=>this.createGroups(e).flatMap(Wt))}createGroups(t){let e=R_,r=new Array;return t instanceof ml?(e=t.name,r.push(...t.properties.map(i=>this.createRow(i)))):r.push(this.createRow(t)),this.rowGroups.has(e)||this.rowGroups.set(e,[]),this.rowGroups.get(e).push(...r),r}createRow(t){if(Be(t)){let[e,...r]=t,i=Su(e);for(let o of r)if(o instanceof HTMLInputElement||o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement){o.id.length===0&&(o.id=bt(10)),i.htmlFor=o.id;break}return[wu(i),Eu(...r)]}else return q(t)||ae(t)||De(t)||Gl(t)?[he(Mu(t))]:[t]}setGroupVisible(t,e){let r=this.rowGroups.get(t);if(r)for(let i of r)for(let o of i)if(sc(o))for(let s of o.elements)Re(s,e);else(nr(o)||o instanceof HTMLElement)&&Re(o,e)}};var Lf="micFields"+bt(8),fl=class extends ii{constructor(e){super("Configure devices");this.env=e;this.micLookup=null;this.spkrLookup=null;this.spkrVolumeControl=null;this.ready=null;this.speakers=null;this.timer=new ds(30);this._showMic=!0;this.cancelButton.style.display="none";let r=this.env.audio.loadBasicClip("test-audio","/audio/test-clip.mp3",.5);me(this.container,ot(du("max-content"))),me(this.contentArea,this.properties=new hl(Vf(Lf,"Input",["Microphones",this.microphones=lc(mi(async()=>{let i=this.microphones.value,o=this.micLookup.get(i);await this.env.audio.devices.setAudioInputDevice(o)}))],["Input level",this.micScenario=Ru()],["Volume",this.micVolumeControl=rd(Zl(0),$l(100),nc(1),Ur(0),mi(()=>{e.audio.input.gain.setValueAtTime(this.micVolumeControl.valueAsNumber/100,0)}))],"Output"))),this.env.audio.devices.addEventListener("audioinputchanged",i=>{this.microphones.value=i.audio&&i.audio.deviceId||""}),st&&(this.properties.append(["Speakers",this.speakers=lc(mi(async()=>{let i=this.speakers.value,o=this.spkrLookup.get(i);await this.env.audio.devices.setAudioOutputDevice(o)}))]),this.env.audio.devices.addEventListener("audiooutputchanged",i=>{this.speakers.value=i.device&&i.device.deviceId||""})),this.properties.append(["Using headphones",this.useHeadphones=Iu(mi(()=>{this.env.audio.useHeadphones=this.useHeadphones.checked,Re(this.headphoneWarning,!this.env.audio.useHeadphones,"inline-block")})),this.testSpkrButton=_s("Test",zr("Test audio"),ot(cu("0.5em")),hh(async()=>{hr(this.testSpkrButton,!1,"secondary"),await r,await this.env.audio.playClipThrough("test-audio"),hr(this.testSpkrButton,!0,"secondary")}))],this.headphoneWarning=he(Ee("alert alert-warning"),"\u{1F3A7}\u{1F399}\uFE0F This site has a voice chat feature. Voice chat is best experienced using headphones."),["Volume",this.spkrVolumeControl=rd(Zl(0),$l(100),nc(1),Ur(0),mi(()=>e.audio.audioDestination.volume=this.spkrVolumeControl.valueAsNumber/100))]),this.activity=new ul("device-settings-dialog-activity",this.env.audio.audioCtx),this.timer.addTickHandler(()=>{this.micScenario.value=this.activity.level})}async load(){await this.env.audio.ready,await this.env.audio.devices.ready;let e=await this.env.audio.devices.getAudioInputDevices();if(this.micLookup=Ol(e,r=>r.deviceId),me(this.microphones,Es(Ur(""),"NONE"),...e.map(r=>Es(Ur(r.deviceId),r.label))),st){let r=await this.env.audio.devices.getAudioOutputDevices();this.spkrLookup=Ol(r,i=>i.deviceId),me(this.speakers,...r.map(i=>Es(Ur(i.deviceId),i.label)))}yt(this.env.audio.input,this.activity)}async onShowing(){this.ready===null&&(this.ready=this.load()),await this.ready;let e=await this.env.audio.devices.getAudioInputDevice();if(this.microphones.value=e&&e.deviceId||"",this.micVolumeControl.valueAsNumber=this.env.audio.input.gain.value*100,st){let r=await this.env.audio.devices.getAudioOutputDevice();this.speakers.value=r&&r.deviceId||""}this.spkrVolumeControl.valueAsNumber=this.env.audio.audioDestination.volume*100,this.useHeadphones.checked=this.env.audio.useHeadphones,Re(this.headphoneWarning,!this.env.audio.useHeadphones,"inline-block"),this.timer.start(),await super.onShowing()}onClosed(){this.timer.stop(),super.onClosed()}get showMic(){return this._showMic}set showMic(e){e!==this.showMic&&(this._showMic=e,this.properties.setGroupVisible(Lf,this.showMic))}};var id=class extends j{constructor(e){super("roomjoined");this.roomName=e}},xl=class extends dl{audio;interactionAudio;xrUI;screenUISpace=new ta;confirmationDialog;compassImage;clockImage;batteryImage;settingsButton;muteMicButton;muteEnvAudioButton;quitButton;lobbyButton;vrButton;fullscreenButton;devicesDialog;apps;uiButtons;audioPlayer;videoPlayer;envAudioToggleEvt=new j("environmentaudiotoggled");_currentRoom=null;get currentRoom(){return this._currentRoom}DEBUG;constructor(t,e,r,i,o,s,a){super(t,e,o,s),this.compassImage=new di(this,"Horizon",new Ts),this.compassImage.mesh.renderOrder=5,this.clockImage=new di(this,"Clock",new Ms),this.clockImage.mesh.renderOrder=5,a=a||{};let p=a.JS_EXT||".js";this.DEBUG=a.DEBUG||!1,this.apps=new da(this,p),this.apps.addEventListener("apploading",h=>{h.preLoadTask=this.fadeOut().then(()=>{this.clearScene(),this.avatar.reset()})}),this.apps.addEventListener("apploaded",h=>{h.app.addEventListener("joinroom",x=>{x.roomName!==this._currentRoom&&(this._currentRoom=x.roomName,this.dispatchEvent(new id(x.roomName)))})}),this.apps.addEventListener("appshown",async h=>{this.lobbyButton.visible=h.appName!=="menu",await this.fadeIn()}),this.audio=new Hs(fm),this.audio.setAudioProperties(1,4,"exponential"),this.audioPlayer=new Ns(this.audio.audioCtx),this.videoPlayer=new la(this,this.audio.audioCtx),this.videoPlayer.object.visible=!1,this.interactionAudio=new ea(this.audio,this.eventSystem),this.confirmationDialog=new Zs(this,r),this.devicesDialog=new fl(this),me(this.renderer.domElement.parentElement,this.screenUISpace,this.confirmationDialog,this.devicesDialog),this.uiButtons=new Xs(this.fetcher,i,20),this.settingsButton=new pi(this.uiButtons,"ui","settings"),this.quitButton=new pi(this.uiButtons,"ui","quit"),this.lobbyButton=new pi(this.uiButtons,"ui","lobby"),this.muteMicButton=new fr(this.uiButtons,"microphone","mute","unmute"),this.muteEnvAudioButton=new fr(this.uiButtons,"environment-audio","mute","unmute"),this.vrButton=new ho(this.uiButtons,"VR"),this.fullscreenButton=new ho(this.uiButtons,"Fullscreen"),this.xrUI=new na,this.xrUI.addItem(this.clockImage,{x:-1,y:1,scale:1}),this.xrUI.addItem(this.quitButton,{x:1,y:1,scale:.5}),this.xrUI.addItem(this.confirmationDialog,{x:0,y:0,scale:.25}),this.xrUI.addItem(this.settingsButton,{x:-1,y:-1,scale:.5}),this.xrUI.addItem(this.muteMicButton,{x:-.84,y:-1,scale:.5}),this.xrUI.addItem(this.muteEnvAudioButton,{x:-.68,y:-1,scale:.5}),this.xrUI.addItem(this.lobbyButton,{x:-.473,y:-1,scale:.5}),this.xrUI.addItem(this.vrButton,{x:1,y:-1,scale:.5}),this.xrUI.addItem(this.fullscreenButton,{x:1,y:-1,scale:.5}),this.worldUISpace.add(this.xrUI),me(this.screenUISpace.topRowLeft,this.compassImage,this.clockImage),me(this.screenUISpace.topRowRight,this.quitButton),me(this.screenUISpace.bottomRowLeft,this.settingsButton,this.muteMicButton,this.muteEnvAudioButton,this.lobbyButton),me(this.screenUISpace.bottomRowRight,this.fullscreenButton,this.vrButton),Kr.isAvailable&&Gi()&&(this.batteryImage=new di(this,"Battery",new Kr),this.xrUI.addItem(this.batteryImage,{x:.75,y:-1,scale:1}),me(this.screenUISpace.topRowRight,this.batteryImage)),this.vrButton.visible=Or()&&ts()||It(),this.lobbyButton.visible=!1,this.muteMicButton.visible=!1,this.screenControl.setUI(this.screenUISpace,this.fullscreenButton,this.vrButton),this.refreshSpaceUI(),this.quitButton.addEventListener("click",()=>this.withConfirmation("Confirm quit","Are you sure you want to quit?",async()=>{this.renderer.xr.isPresenting&&this.screenControl.stop(),await this.onQuitting()})),this.lobbyButton.addEventListener("click",()=>this.withConfirmation("Confirm return to lobby","Are you sure you want to return to the lobby?",()=>this.dispatchEvent(new j("home")))),this.settingsButton.addEventListener("click",async()=>{let h=this.screenControl.currentMode,x=this.renderer.xr.isPresenting;x&&await this.screenControl.stop(),await this.devicesDialog.showDialog(),x&&await this.screenControl.start(h)});let d=()=>this.refreshSpaceUI();this.screenControl.addEventListener("sessionstarted",d),this.screenControl.addEventListener("sessionstopped",d),this.muteEnvAudioButton.addEventListener("click",()=>{this.muteEnvAudioButton.active=!this.muteEnvAudioButton.active,this.dispatchEvent(this.envAudioToggleEvt)}),this.avatar.addEventListener("avatarmoved",h=>this.audio.setUserPose(this.audio.localUserID,h.px,h.py,h.pz,h.fx,h.fy,h.fz,h.ux,h.uy,h.uz))}refreshSpaceUI(){this.xrUI.visible=this.renderer.xr.isPresenting||this.testSpaceLayout,this.clockImage.isVisible=this.xrUI.visible||this.DEBUG}_testSpaceLayout=!1;get testSpaceLayout(){return this._testSpaceLayout}set testSpaceLayout(t){t!==this.testSpaceLayout&&(this._testSpaceLayout=t,this.refreshSpaceUI())}countTick=0;fpses=new Array;avgFPS=0;preRender(t){if(super.preRender(t),this.audio.update(),this.videoPlayer.update(t.dt,t.frame),this.compassImage.image.setPitchAndHeading(os(this.avatar.worldPitch),os(this.avatar.worldHeading)),this.DEBUG){let e=Math.round(t.fps);if(this.avgFPS+=e/100,this.fpses.push(e),this.fpses.length>100){let r=this.fpses.shift();this.avgFPS-=r/100}++this.countTick%100===0&&this.clockImage.image.setStats(this.avgFPS,this.renderer.info.render.calls,this.renderer.info.render.triangles)}this.confirmationDialog.update(t.dt);for(let e of this.apps)e.update(t)}get environmentAudioMuted(){return this.muteEnvAudioButton.active}async withConfirmation(t,e,r){this.onConfirmationShowing(!0),await this.confirmationDialog.prompt(t,e)&&r(),this.onConfirmationShowing(!1)}onConfirmationShowing(t){Xc(this.quitButton,!t,"primary"),Xc(this.lobbyButton,!t,"primary")}async load(t){await cs(t,e=>super.load(e),e=>this.uiButtons.load(e),e=>this.audio.loadBasicClip("footsteps","/audio/TransitionFootstepAudio.mp3",.5,e),e=>this.interactionAudio.load("enter","/audio/basic_enter.mp3",.25,e),e=>this.interactionAudio.load("exit","/audio/basic_exit.mp3",.25,e),e=>this.interactionAudio.load("error","/audio/basic_error.mp3",.25,e),e=>this.interactionAudio.load("click","/audio/vintage_radio_button_pressed.mp3",1,e))}};async function qe(n,t){let{status:e,path:r,content:i,contentType:o,contentLength:s,fileName:a,headers:p,date:d}=n;return{status:e,path:r,content:await t(i),contentType:o,contentLength:s,fileName:a,headers:p,date:d}}var gl=class{constructor(t){this.impl=t}defaultPostHeaders=new Map;setRequestVerificationToken(t){this.defaultPostHeaders.set("RequestVerificationToken",t)}clearCache(){return this.impl.clearCache()}sendNothingGetNothing(t){return this.impl.sendNothingGetNothing(t)}sendNothingGetBlob(t,e){return this.impl.sendNothingGetSomething("blob",t,e)}sendObjectGetBlob(t,e){return this.impl.sendSomethingGetSomething("blob",t,this.defaultPostHeaders,e)}sendNothingGetBuffer(t,e){return this.impl.sendNothingGetSomething("arraybuffer",t,e)}sendObjectGetBuffer(t,e){return this.impl.sendSomethingGetSomething("arraybuffer",t,this.defaultPostHeaders,e)}sendNothingGetText(t,e){return this.impl.sendNothingGetSomething("text",t,e)}sendObjectGetText(t,e){return this.impl.sendSomethingGetSomething("text",t,this.defaultPostHeaders,e)}async sendNothingGetObject(t,e){return(await this.impl.sendNothingGetSomething("json",t,e)).content}async sendObjectGetObject(t,e){return(await this.impl.sendSomethingGetSomething("json",t,this.defaultPostHeaders,e)).content}sendObjectGetNothing(t,e){return this.impl.sendSomethingGetSomething("",t,this.defaultPostHeaders,e)}drawImageToCanvas(t,e,r){return this.impl.drawImageToCanvas(t,e,r)}async sendNothingGetFile(t,e){return qe(await this.sendNothingGetBlob(t,e),URL.createObjectURL)}async sendObjectGetFile(t,e){return qe(await this.sendObjectGetBlob(t,e),URL.createObjectURL)}async sendNothingGetXml(t,e){return qe(await this.impl.sendNothingGetSomething("document",t,e),r=>r.documentElement)}async sendObjectGetXml(t,e){return qe(await this.impl.sendSomethingGetSomething("document",t,this.defaultPostHeaders,e),r=>r.documentElement)}async sendNothingGetImageBitmap(t,e){return qe(await this.sendNothingGetBlob(t,e),createImageBitmap)}async sendObjectGetImageBitmap(t,e){return qe(await this.sendObjectGetBlob(t,e),createImageBitmap)}};var wi=class{constructor(t){this.db=t}static async getCurrentVersion(t){if(g(indexedDB.databases)){let e=await indexedDB.databases();for(let{name:r,version:i}of e)if(r===t)return i}return null}static delete(t){let e=indexedDB.deleteDatabase(t),r=le(e,"success","error","blocked");return At(r)}static async open(t,...e){let r=ji(e,V=>V.name,Wt),i=new ze(e.filter(V=>g(V.indexes)).flatMap(V=>V.indexes.map(B=>[V.name,B.name,B]))),o=new Array,s=new Array,a=new Array,p=new dt,d=new dt,h=await this.getCurrentVersion(t);if(O(h)){o.push(...r.keys());for(let V of e)if(g(V.indexes))for(let B of V.indexes)p.add(V.name,B.name)}else{let V=indexedDB.open(t);if(await At(le(V,"success","error","blocked"))){let B=V.result,L=new Array;for(let k of Array.from(B.objectStoreNames))r.has(k)||s.push(k);for(let k of r.keys())B.objectStoreNames.contains(k)?L.push(k):o.push(k);if(L.length>0){let k=B.transaction(L),H=le(k,"complete","error","abort"),C=At(H);for(let D of L){let $=k.objectStore(D);for(let W of Array.from($.indexNames))i.has(D,W)||(a.indexOf(D)===-1&&a.push(D),d.add(D,W));if(i.has(D))for(let W of i.get(D).keys())if(!$.indexNames.contains(W))a.indexOf(D)===-1&&a.push(D),p.add(D,W);else{let z=i.get(D,W),K=$.index(W);(q(z.keyPath)!==q(K.keyPath)||q(z.keyPath)&&q(K.keyPath)&&z.keyPath!==K.keyPath||Be(z.keyPath)&&Be(K.keyPath)&&Yo(z.keyPath,K.keyPath))&&(a.indexOf(D)===-1&&a.push(D),d.add(D,W),p.add(D,W))}}k.commit(),await C}B.close()}(o.length>0||s.length>0||p.size>0||d.size>0)&&++h}let x=new Ce,A=g(h)?indexedDB.open(t,h):indexedDB.open(t),E=le(A,"success","error","blocked"),S=At(x),P=At(E),R=()=>x.resolve(!1);if(A.addEventListener("success",R),A.addEventListener("upgradeneeded",()=>{let V=le(A.transaction,"complete","error","abort"),B=A.result;for(let k of s)B.deleteObjectStore(k);let L=new Map;for(let k of o){let H=r.get(k),C=B.createObjectStore(k,H.options);L.set(k,C)}for(let k of a){let H=A.transaction.objectStore(k);L.set(k,H)}for(let[k,H]of L){for(let C of d.get(k))H.deleteIndex(C);for(let C of p.get(k)){let D=i.get(k,C);H.createIndex(C,D.keyPath,D.options)}}At(V).then(x.resolve).catch(x.reject).finally(()=>A.removeEventListener("success",R))}),!await S)throw x.error;if(!await P)throw E.error;return new wi(A.result)}dispose(){this.db.close()}get name(){return this.db.name}get version(){return this.db.version}get storeNames(){return Array.from(this.db.objectStoreNames)}getStore(t){return new od(this.db,t)}},od=class{constructor(t,e){this.db=t;this.storeName=e}async request(t,e){let r=this.db.transaction(this.storeName,e),i=le(r,"complete","error"),o=r.objectStore(this.storeName),s=t(o),a=le(s,"success","error");if(!await At(a))throw r.abort(),a.error;if(r.commit(),!await At(i))throw i.error;return s.result}add(t,e){return this.request(r=>r.add(t,e),"readwrite")}clear(){return this.request(t=>t.clear(),"readwrite")}getCount(t){return this.request(e=>e.count(t),"readonly")}delete(t){return this.request(e=>e.delete(t),"readwrite")}get(t){return this.request(e=>e.get(t),"readonly")}getAll(){return this.request(t=>t.getAll(),"readonly")}getAllKeys(){return this.request(t=>t.getAllKeys(),"readonly")}getKey(t){return this.request(e=>e.getKey(t),"readonly")}openCursor(t,e){return this.request(r=>r.openCursor(t,e),"readonly")}openKeyCursor(t,e){return this.request(r=>r.openKeyCursor(t,e),"readonly")}put(t,e){return this.request(r=>r.put(t,e),"readwrite")}};function P_(n){return q(n)||zd(n)||n instanceof Blob||n instanceof FormData||Ud(n)||n instanceof ReadableStream||"Document"in globalThis&&n instanceof Document}function vl(n,t,e,r,i,o){let s=!o;o&&o.then(()=>s=!0);let a=!1,p=i,d=new Ce(()=>p&&a,()=>s);e.addEventListener("loadstart",()=>{s&&!a&&r&&r.start(n)}),e.addEventListener("progress",x=>{if(s&&!a){let A=x;r&&r.report(A.loaded,Math.max(A.loaded,A.total),n),A.loaded===A.total&&(p=!0,d.resolve())}}),e.addEventListener("load",()=>{s&&!a&&(r&&r.end(n),a=!0,d.resolve())});let h=x=>()=>d.reject(`${x} (${t.status})`);return e.addEventListener("error",h("error")),e.addEventListener("abort",h("abort")),e.addEventListener("timeout",h("timeout")),d}function sd(n,t,e,r,i,o){if(n.open(t,e),n.responseType="blob",n.timeout=r,i)for(let[s,a]of i)n.setRequestHeader(s,a);g(o)?n.send(o):n.send()}function Al(n,t,e){if(!n.has(t))return null;let r=n.get(t);try{let i=e(r);return n.delete(t),i}catch(i){console.warn(t,i)}return null}var I_=/filename=\"(.+)\"(;|$)/,C_="Juniper:Fetcher:Cache",_l=class{cacheReady;cache=null;store=null;constructor(){this.cacheReady=this.openCache()}async drawImageToCanvas(t,e,r){let i=await this.sendNothingGetSomething("blob",t,r),o=i.content;return $d(await createImageBitmap(o,{imageOrientation:"none"}),s=>(e.width=s.width,e.height=s.height,e.getContext("2d").drawImage(s,0,0),qe(i,()=>null)))}async openCache(){this.cache=await wi.open(C_,{name:"files",options:{keyPath:"path"}}),this.store=await this.cache.getStore("files")}async clearCache(){await this.cacheReady,await this.store.clear()}async readResponseHeaders(t,e){let r=e.getAllResponseHeaders().split(/[\r\n]+/).map(A=>A.trim()).filter(A=>A.length>0).map(A=>{let E=A.split(": "),S=E.shift().toLowerCase(),P=E.join(": ");return[S,P]}),i=new dt(r),o=Array.from(i.keys()).map(A=>[A,i.get(A).join(", ")]),s=new Map(o),a=Al(s,"content-type",Wt),p=Al(s,"content-length",parseFloat),d=Al(s,"date",A=>new Date(A)),h=Al(s,"content-disposition",A=>{if(g(A)){let E=A.match(I_);if(g(E))return E[1]}return null});return{status:e.status,path:t,content:void 0,contentType:a,contentLength:p,fileName:h,date:d,headers:s}}async readResponse(t,e){let{status:r,contentType:i,contentLength:o,fileName:s,date:a,headers:p}=await this.readResponseHeaders(t,e),d={path:t,status:r,contentType:i,contentLength:o,fileName:s,date:a,headers:p,content:e.response};return g(d.content)&&(d.contentType=d.contentType||d.content.type,d.contentLength=d.contentLength||d.content.size),d}async decodeContent(t,e){return qe(e,async r=>{if(t==="")return null;if(O(e.contentType)){let i=Array.from(e.headers.entries()).map(o=>o.join(": ")).join(`
  `);throw new Error(`No content type found in headers: 
  `+i)}else{if(t==="blob")return r;if(t==="arraybuffer")return await r.arrayBuffer();if(t==="json"){let i=await r.text();return i.length>0?JSON.parse(i):null}else if(t==="document"){let i=new DOMParser;if(e.contentType==="application/xhtml+xml"||e.contentType==="text/html"||e.contentType==="application/xml"||e.contentType==="image/svg+xml"||e.contentType==="text/xml")return i.parseFromString(await r.text(),e.contentType);throw new Error("Couldn't parse document")}else{if(t==="text")return await r.text();de(t)}}})}tasks=new ze;async withCachedTask(t,e){return t.method!=="GET"&&t.method!=="HEAD"&&t.method!=="OPTIONS"?await e():(this.tasks.has(t.method,t.path)||this.tasks.add(t.method,t.path,e().finally(()=>this.tasks.delete(t.method,t.path))),this.tasks.get(t.method,t.path))}sendNothingGetNothing(t){return this.withCachedTask(t,async()=>{let e=new XMLHttpRequest,r=vl(`requesting: ${t.path}`,e,e,null,!0);return sd(e,t.method,t.path,t.timeout,t.headers),await r,await this.readResponseHeaders(t.path,e)})}sendNothingGetSomething(t,e,r){return this.withCachedTask(e,async()=>{let i=null,o=e.useCache&&e.method==="GET";o&&(g(r)&&r.start(),await this.cacheReady,i=await this.store.get(e.path));let s=O(i);if(s){let p=new XMLHttpRequest,d=vl(`requesting: ${e.path}`,p,p,r,!0);sd(p,e.method,e.path,e.timeout,e.headers),await d,i=await this.readResponse(e.path,p),o&&await this.store.add(i)}let a=await this.decodeContent(t,i);return s&&g(r)&&r.end(),a})}async sendSomethingGetSomething(t,e,r,i){let o=null,s=Ed(new Map,r,e.headers);if(e.body instanceof FormData&&g(s)){let E=new Array;for(let S of s.keys())S.toLowerCase()==="content-type"&&E.push(S);for(let S of E)s.delete(S)}P_(e.body)&&!q(e.body)?o=e.body:g(e.body)&&(o=JSON.stringify(e.body));let a=Xd(i,2),p=new XMLHttpRequest,d=g(o)?vl("uploading",p,p.upload,a.shift(),!1):Promise.resolve(),h=a.shift(),x=vl("saving",p,p,h,!0,d);sd(p,e.method,e.path,e.timeout,s,o),await d,await x;let A=await this.readResponse(e.path,p);return await this.decodeContent(t,A)}};var ad=null;function kf(n){return ad===null&&(ad=new Audio),ad.canPlayType(n)!==""}var bl=class{constructor(t,e,r){this.fetcher=t;this.method=e;this.prog=null;this.path=r,this.request={method:e,path:this.path.href,body:null,headers:null,timeout:null,withCredentials:!1,useCache:!1}}query(t,e){return this.path.searchParams.set(t,e),this.request.path=this.path.href,this}header(t,e){return this.request.headers===null&&(this.request.headers=new Map),this.request.headers.set(t.toLowerCase(),e),this}timeout(t){return this.request.timeout=t,this}progress(t){return this.prog=t,this}body(t,e){return this.request.body=t,this.content(e),this}withCredentials(){return this.request.withCredentials=!0,this}useCache(t=!0){return this.request.useCache=t,this}media(t,e){g(e)&&(q(e)||(e=e.value),this.header(t,e))}content(t){this.media("content-type",t)}accept(t){this.media("accept",t)}blob(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBlob(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBlob(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}buffer(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBuffer(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBuffer(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}file(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetFile(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetFile(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}text(t){if(this.accept(t||Qm),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetText(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetText(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}object(t){if(this.accept(t||jm),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetObject(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetObject(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}xml(t){if(this.accept(t||Km),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetXml(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetXml(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}imageBitmap(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetImageBitmap(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetImageBitmap(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}exec(){if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetNothing(this.request,this.prog);if(this.method==="GET")throw new vt("GET requests should expect a response type");if(this.method==="HEAD"||this.method==="OPTIONS")return this.fetcher.sendNothingGetNothing(this.request);de(this.method)}async audioBlob(t){if(g(t)&&(q(t)||(t=t.value),!kf(t)))throw new Error(`Probably can't play file of type "${t}" at path: ${this.request.path}`);let e=await this.blob(t);if(kf(e.contentType))return e;throw new Error(`Cannot play file of type "${e.contentType}" at path: ${this.request.path}`)}async audioBuffer(t,e){return qe(await this.audioBlob(e),async r=>await t.decodeAudioData(await r.arrayBuffer()))}async htmlElement(t,e,r){let i=await this.file(r),o=le(t,e,"error");return t.src=i.content,await o,await qe(i,()=>t)}image(t){return this.htmlElement(ir(),"load",t)}async htmlCanvas(t){if(mn)throw new Error("HTMLCanvasElement not supported in Workers.");let e=no(1,1);if(this.method==="GET")if(bn){this.accept(t);let r=await this.fetcher.drawImageToCanvas(this.request,e.transferControlToOffscreen(),this.prog);return await qe(r,()=>e)}else{let r=await(mn?this.imageBitmap(t):this.image(t));return await qe(r,i=>(e.width=i.width,e.height=i.height,dc(e,i),Xr(i),e))}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}}canvas(t){return bn?this.offscreenCanvas(t):this.htmlCanvas(t)}async offscreenCanvas(t){if(!bn)throw new Error("This system does not support OffscreenCanvas");if(this.method==="GET"){let e=await(mn?this.imageBitmap(t):this.image(t));return await qe(e,r=>{let i=pc(r.width,r.height);return dc(i,r),Xr(r),i})}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}}audio(t,e,r){return this.htmlElement(to(t,!1,e),"canplay",r)}video(t,e,r){return this.htmlElement(Lu(t,!1,e),"canplay",r)}async getScript(){let t=Pu(Yn(po));document.body.append(t),await this.htmlElement(t,"load",po)}async script(t){if(!t)await this.getScript();else if(!t()){let e=Md(t);await this.getScript(),await e}}async module(){let t=this.request.path,{content:e}=await this.file(po),r=await import(e);return this.prog&&this.prog.end(t),r}async wasm(t){let{content:e,contentType:r}=await this.buffer(kc);if(!kc.matches(r))throw new Error(`Server did not respond with WASM file. Was: ${r}`);let i=await WebAssembly.compile(e);return(await WebAssembly.instantiate(i,t)).exports}async worker(t="module"){let{content:e}=await this.file(po);return this.prog=null,this.request.timeout=null,new Worker(e,{type:t})}};var El=class{constructor(t){this.service=t;if(!mn){let e=vu("input[name=__RequestVerificationToken]");e&&this.service.setRequestVerificationToken(e.value)}}createRequest(t,e,r){return new bl(this.service,t,new URL(e,r||location.href))}clearCache(){return this.service.clearCache()}head(t,e){return this.createRequest("HEAD",t,e)}options(t,e){return this.createRequest("OPTIONS",t,e)}get(t,e){return this.createRequest("GET",t,e)}post(t,e){return this.createRequest("POST",t,e)}put(t,e){return this.createRequest("PUT",t,e)}patch(t,e){return this.createRequest("PATCH",t,e)}delete(t,e){return this.createRequest("DELETE",t,e)}async assets(t,...e){e=e.filter(g);let r=new Map(await Promise.all(e.map(i=>i.getSize(this))));await Ki(t,e.map(i=>[r.get(i),o=>i.getContent(o)]))}};var yl=class extends Z{constructor(e){super();this.worker=e;this.taskCounter=0;this.invocations=new Map;yl.isSupported||console.warn("Workers are not supported on this system."),this.worker.addEventListener("message",r=>{let i=r.data;switch(i.type){case"event":this.propogateEvent(i);break;case"progress":this.progressReport(i);break;case"return":this.methodReturned(i);break;case"error":this.invocationError(i);break;default:de(i)}})}postMessage(e,r){e.type!=="methodCall"&&de(e.type),r?this.worker.postMessage(e,r):this.worker.postMessage(e)}dispose(){this.worker.terminate()}propogateEvent(e){let r=new j(e.eventName);this.dispatchEvent(Object.assign(r,e.data))}progressReport(e){let r=this.invocations.get(e.taskID),{prog:i}=r;i&&i.report(e.soFar,e.total,e.msg,e.est)}methodReturned(e){let r=this.removeInvocation(e.taskID),{resolve:i}=r;i(e.returnValue)}invocationError(e){let r=this.removeInvocation(e.taskID),{reject:i,methodName:o}=r;i(new Error(`${o} failed. Reason: ${e.errorMessage}`))}removeInvocation(e){let r=this.invocations.get(e);return this.invocations.delete(e),r}callMethod(e,r,i,o){if(!yl.isSupported)return Promise.reject(new Error("Workers are not supported on this system."));let s=null,a=null;jl(r)&&(o=r,r=null,i=null),jl(i)&&!o&&(o=i,i=null),Be(r)&&(s=r),Be(i)&&(a=i);let p=this.taskCounter++,d=new Ce,h={prog:o,resolve:d.resolve,reject:d.reject,methodName:e};this.invocations.set(p,h);let x=null;return g(r)?x={type:"methodCall",taskID:p,methodName:e,params:s}:x={type:"methodCall",taskID:p,methodName:e},this.postMessage(x,a),d}},Uo=yl;Uo.isSupported="Worker"in globalThis;var Go=class extends Z{constructor(e,r){super();this.scriptPath=e.scriptPath;let i=-1,o=e.workers,s=null;if(ae(o)?i=o:g(o)?(this.taskCounter=o.curTaskCounter,s=o.workers,i=s.length):i=navigator.hardwareConcurrency||4,i<1)throw new Error("Worker pool size must be a postive integer greater than 0");if(this.workers=new Array(i),O(s)){this.taskCounter=0;for(let a=0;a<i;++a)this.workers[a]=new r(new Worker(this.scriptPath,{type:"module"}))}else for(let a=0;a<i;++a)this.workers[a]=new r(s[a]);for(let a of this.workers)a.addBubbler(this)}dispose(){for(let e of this.workers)e.dispose();pe(this.workers)}nextWorker(){let e=this.peekWorker();return this.taskCounter++,e}peekWorker(){return this.workers[this.taskCounter%this.workers.length]}};Go.isSupported="Worker"in globalThis;function V_(n){return n==="application/xhtml+xml"||n==="application/xml"||n==="image/svg+xml"||n==="text/html"||n==="text/xml"}function Df(n){let{status:t,path:e,content:r,contentType:i,contentLength:o,fileName:s,headers:a,date:p}=n;if(!V_(i))throw new Error(`Content-Type ${i} is not one supported by the DOM parser.`);let h=new TextDecoder().decode(r),A=new DOMParser().parseFromString(h,i);return{status:t,path:e,content:A.documentElement,contentType:i,contentLength:o,fileName:s,date:p,headers:a}}function Of(n){let{status:t,path:e,content:r,contentType:i,contentLength:o,fileName:s,headers:a,date:p}=n,d=new Blob([r],{type:i});return{status:t,path:e,content:d,contentType:i,contentLength:o,fileName:s,date:p,headers:a}}function Bf(n){return n={method:n.method,path:n.path,timeout:n.timeout,headers:n.headers,withCredentials:n.withCredentials,useCache:n.useCache},n}function L_(n){return n={method:n.method,path:n.path,body:n.body,timeout:n.timeout,headers:n.headers,withCredentials:n.withCredentials,useCache:n.useCache},n}var wl=class extends Uo{setRequestVerificationToken(t){this.callMethod("setRequestVerificationToken",[t])}clearCache(){return this.callMethod("clearCache")}makeRequest(t,e,r){return this.callMethod(t,[Bf(e)],r)}makeRequestWithBody(t,e,r){return this.callMethod(t,[L_(e)],r)}sendNothingGetNothing(t){return this.makeRequest("sendNothingGetNothing",t,null)}sendNothingGetBuffer(t,e){return this.makeRequest("sendNothingGetBuffer",t,e)}sendNothingGetText(t,e){return this.makeRequest("sendNothingGetText",t,e)}sendNothingGetObject(t,e){return this.makeRequest("sendNothingGetObject",t,e)}sendNothingGetFile(t,e){return this.makeRequest("sendNothingGetFile",t,e)}sendNothingGetImageBitmap(t,e){return this.makeRequest("sendNothingGetImageBitmap",t,e)}sendObjectGetNothing(t,e){return this.makeRequestWithBody("sendObjectGetNothing",t,e)}sendObjectGetBuffer(t,e){return this.makeRequestWithBody("sendObjectGetBuffer",t,e)}sendObjectGetText(t,e){return this.makeRequestWithBody("sendObjectGetText",t,e)}sendObjectGetObject(t,e){return this.makeRequestWithBody("sendObjectGetObject",t,e)}sendObjectGetFile(t,e){return this.makeRequestWithBody("sendObjectGetFile",t,e)}sendObjectGetImageBitmap(t,e){return this.makeRequestWithBody("sendObjectGetImageBitmap",t,e)}drawImageToCanvas(t,e,r){return this.callMethod("drawImageToCanvas",[Bf(t),e],[e],r)}async sendNothingGetBlob(t,e){let r=await this.sendNothingGetBuffer(t,e);return Of(r)}async sendNothingGetXml(t,e){let r=await this.sendNothingGetBuffer(t,e);return Df(r)}async sendObjectGetBlob(t,e){let r=await this.sendObjectGetBuffer(t,e);return Of(r)}async sendObjectGetXml(t,e){let r=await this.sendObjectGetBuffer(t,e);return Df(r)}};var ld=class extends Go{constructor(e,r,i){super(e,r);this.fetcher=i}getFetcher(e){return e instanceof FormData?this.fetcher:this.nextWorker()}setRequestVerificationToken(e){this.fetcher.setRequestVerificationToken(e);for(let r of this.workers)r.setRequestVerificationToken(e)}async clearCache(){await Promise.all(this.workers.map(e=>e.clearCache()))}sendNothingGetNothing(e){return this.nextWorker().sendNothingGetNothing(e)}sendNothingGetBlob(e,r){return this.nextWorker().sendNothingGetBlob(e,r)}sendNothingGetBuffer(e,r){return this.nextWorker().sendNothingGetBuffer(e,r)}sendNothingGetFile(e,r){return this.nextWorker().sendNothingGetFile(e,r)}sendNothingGetText(e,r){return this.nextWorker().sendNothingGetText(e,r)}sendNothingGetObject(e,r){return this.nextWorker().sendNothingGetObject(e,r)}sendNothingGetXml(e,r){return this.nextWorker().sendNothingGetXml(e,r)}sendNothingGetImageBitmap(e,r){return this.nextWorker().sendNothingGetImageBitmap(e,r)}drawImageToCanvas(e,r,i){return this.nextWorker().drawImageToCanvas(e,r,i)}sendObjectGetBlob(e,r){return this.getFetcher(e.body).sendObjectGetBlob(e,r)}sendObjectGetBuffer(e,r){return this.getFetcher(e.body).sendObjectGetBuffer(e,r)}sendObjectGetFile(e,r){return this.getFetcher(e.body).sendObjectGetFile(e,r)}sendObjectGetText(e,r){return this.getFetcher(e.body).sendObjectGetText(e,r)}sendObjectGetNothing(e,r){return this.getFetcher(e.body).sendObjectGetNothing(e,r)}sendObjectGetObject(e,r){return this.getFetcher(e.body).sendObjectGetObject(e,r)}sendObjectGetXml(e,r){return this.getFetcher(e.body).sendObjectGetXml(e,r)}sendObjectGetImageBitmap(e,r){return this.getFetcher(e.body).sendObjectGetImageBitmap(e,r)}},Tl=class extends ld{};var Ff="1.0.8";var Hf=Ff,Nf=1.75,Xf=!1,jf={fontFamily:"Segoe UI",fontSize:20},D_={fontFamily:"Segoe UI Emoji",fontSize:20};async function zf(){await Promise.all([Xu(D_)])}function Uf(){let n=new dt([["arrow","arrow-up"],["arrow","arrow-down"],["arrow","arrow-left"],["arrow","arrow-right"],["chat","user"],["chat","chat"],["ui","menu"],["ui","settings"],["ui","quit"],["ui","lobby"],["zoom","zoom-in"],["zoom","zoom-out"],["environment-audio","environment-audio-mute"],["environment-audio","environment-audio-unmute"],["headphones","headphones-unmuted"],["headphones","headphones-muted"],["microphone","microphone-mute"],["microphone","microphone-unmute"],["volume","volume-muted"],["volume","volume-low"],["volume","volume-medium"],["volume","volume-high"],["media","media-pause"],["media","media-play"],["media","media-stop"],["media","media-replay"],["ar","ar-enter"],["ar","ar-exit"],["vr","vr-enter"],["vr","vr-exit"],["fullscreen","fullscreen-enter"],["fullscreen","fullscreen-exit"]]),t=new ze;for(let[e,r]of n.entries())for(let i of r)t.add(e,i.replace(e+"-",""),`/img/ui/${i}.png`);return t}function Gf(n=!0){let t=new gl(new _l);return!mn&&n&&(t=new Tl({scriptPath:`/js/fetcher-worker/index.min.js?${Hf}`},wl,t)),new El(t)}async function Wf(n=!0){let t=bs(Qn("frontBuffer"));document.body.append(he(Qn("appContainer"),t)),await zf();let e=Gf(!n);return new xl(t,e,jf.fontFamily,Uf(),Nf,Xf,{DEBUG:n})}function Ml(n,t){let e=[n];for(;e.length>0;){let r=e.shift();if(t(r))return r;r.children.length>0&&e.push(...r.children)}return null}function qf(n){return t=>ar(t)&&t.name===n}function cd(n,t){let e=Object.assign({alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,defines:n.defines,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,dithering:n.dithering,envMap:n.envMap,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.map,name:n.name+"-Basic",opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,shadowSide:n.shadowSide,side:n.side,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth},t);for(let[r,i]of Object.entries(e))O(i)&&delete e[r];return new THREE.MeshBasicMaterial(e)}var Sl=class{constructor(t,e=.05){this.env=t;this.density=e;this.getJpeg=this.getJpeg.bind(this),this.getPng=this.getPng.bind(this),this.getModel=this.getModel.bind(this),this.getAudio=this.getAudio.bind(this),this.skybox=new Qt("/skyboxes/BearfenceMountain.jpeg",this.getJpeg),this.forest=new Qt("/models/Forest-Ground.glb",this.getModel),this.bgAudio=new Qt("/audio/forest.mp3",this.getAudio),this.density>0&&(this.tree=new Qt("/models/Forest-Tree.glb",this.getModel)),this.raycaster=new THREE.Raycaster(new THREE.Vector3,new THREE.Vector3(0,-1,0),.1,100),this.hits=new Array}skybox;forest;tree;bgAudio;raycaster;hits;_ground;_water;_trees;get ground(){return this._ground}get water(){return this._water}get trees(){return this._trees}async load(...t){if(await Ki(this.env.loadingBar,[[1,e=>this.env.load(e)],[10,e=>this.env.fetcher.assets(e,this.skybox,this.forest,this.tree,this.bgAudio,...t)]]),this.env.skybox.setImage("forest",this.skybox.result),this.env.audio.createClip("forest",this.bgAudio.result,!0,!0,!0,1,[]),this.env.audio.setClipPosition("forest",25,5,25),this.env.foreground.add(this.forest.result),this.forest.result.updateMatrixWorld(),this.raycaster.camera=this.env.camera,this._ground=Ml(this.forest.result,qf("Ground")),this._ground.material=cd(this._ground.material,{transparent:!1}),this.env.timer.addTickHandler(()=>{let e=this.groundTest(this.env.avatar.worldPos);e&&(this.env.avatar.stage.position.y=e.point.y)}),this._water=Ml(this.forest.result,qf("Water")),this._water.material=cd(this._water.material,{transparent:!1}),this.density>0){let e=this.makeTrees(),r=Ml(this.tree.result,ar),i=r.geometry,o=cd(r.material,{transparent:!1});this._trees=new THREE.InstancedMesh(i,o,e.length);for(let s=0;s<e.length;++s)this._trees.setMatrixAt(s,e[s]);this.env.foreground.add(this._trees)}return t}getJpeg(t,e){return this.env.fetcher.get(t).useCache(!0).progress(e).image(Um).then(r=>r.content)}getPng(t,e){return this.env.fetcher.get(t).useCache(!1).progress(e).image(Gm).then(r=>r.content)}getAudio(t,e){return this.env.fetcher.get(t).useCache(!0).progress(e).audio(!0,!0,zm).then(r=>r.content)}getModel(t,e){return this.env.fetcher.get(t).useCache(!0).progress(e).file(Wm).then(r=>this.env.loadModel(r.content))}makeTrees(){let t=new Array,e=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),i=new THREE.Vector3,o=new THREE.Quaternion().setFromAxisAngle(r,Math.PI/2),s=new THREE.Vector3(0,1,0),a=new THREE.Vector3;for(let p=-25;p<=25;++p)for(let d=-25;d<=25;++d)if(Math.random()<=this.density){let h=Math.random()*.1+d,x=Math.random()*.1+p;i.set(h,0,x);let A=this.groundTest(i);if(A){let E=THREE.MathUtils.randFloat(.6,1.3),S=THREE.MathUtils.randFloat(.6,1.3);a.set(E,S,E);let P=THREE.MathUtils.randFloat(0,2*Math.PI),R=new THREE.Matrix4().compose(A.point,e.setFromAxisAngle(s,P).multiply(o),a);t.push(R)}}return t}groundTest(t){this.raycaster.ray.origin.copy(t),this.raycaster.ray.origin.y+=10,this.raycaster.intersectObject(this.ground,!0,this.hits);let e=$e(this.hits,g);return pe(this.hits),e}};var Wo=await Wf();await Wo.fadeOut();var Qf=new Sl(Wo),[O_]=await Qf.load(new Qt("/img/spatter.png",Qf.getPng)),B_=new THREE.PlaneBufferGeometry(5,5,1,1),F_=new THREE.CanvasTexture(O_.result),H_=new THREE.MeshBasicMaterial({map:F_,transparent:!0,opacity:1,side:THREE.DoubleSide}),St=new THREE.InstancedMesh(B_,H_,25),kr=new THREE.Object3D;kr.rotation.set(Math.PI/2,0,0);for(let n=0;n<St.count;++n)kr.position.set(0,n/(5*St.count),0),kr.updateMatrix(),St.setMatrixAt(n,kr.matrix),St.setColorAt(n,new THREE.Color(.25,.25+n/(2*St.count),0));Wo.foreground.add(St);Wo.timer.addTickHandler(n=>{for(let t=0;t<St.count;++t)kr.position.set(.08+.05*Math.cos(n.t/1e3)*t/St.count,t/(5*St.count),0),kr.updateMatrix(),St.setMatrixAt(t,kr.matrix);St.instanceMatrix.needsUpdate=!0});await Wo.fadeIn();
//# sourceMappingURL=index.min.js.map
