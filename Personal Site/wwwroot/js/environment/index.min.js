var Kh=Object.create;var Ja=Object.defineProperty;var Yh=Object.getOwnPropertyDescriptor;var Jh=Object.getOwnPropertyNames;var $h=Object.getPrototypeOf,Zh=Object.prototype.hasOwnProperty;var ef=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),tf=(n,t)=>{for(var e in t)Ja(n,e,{get:t[e],enumerable:!0})},nf=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Jh(t))!Zh.call(n,o)&&o!==e&&Ja(n,o,{get:()=>t[o],enumerable:!(r=Yh(t,o))||r.enumerable});return n};var rf=(n,t,e)=>(e=n!=null?Kh($h(n)):{},nf(t||!n||!n.__esModule?Ja(e,"default",{value:n,enumerable:!0}):e,n));var th=ef((ec,tc)=>{(function(n,t){typeof ec=="object"&&typeof tc<"u"?tc.exports=t():typeof define=="function"&&define.amd?define(t):n.CardboardVRDisplay=t()})(ec,function(){"use strict";var n=function(){function a(d){this.value=d}function l(d){var u,f;function g(T,_){return new Promise(function(E,R){var L={key:T,arg:_,resolve:E,reject:R,next:null};f?f=f.next=L:(u=f=L,v(T,_))})}function v(T,_){try{var E=d[T](_),R=E.value;R instanceof a?Promise.resolve(R.value).then(function(L){v("next",L)},function(L){v("throw",L)}):M(E.done?"return":"normal",E.value)}catch(L){M("throw",L)}}function M(T,_){switch(T){case"return":u.resolve({value:_,done:!0});break;case"throw":u.reject(_);break;default:u.resolve({value:_,done:!1});break}u=u.next,u?v(u.key,u.arg):f=null}this._invoke=g,typeof d.return!="function"&&(this.return=void 0)}return typeof Symbol=="function"&&Symbol.asyncIterator&&(l.prototype[Symbol.asyncIterator]=function(){return this}),l.prototype.next=function(d){return this._invoke("next",d)},l.prototype.throw=function(d){return this._invoke("throw",d)},l.prototype.return=function(d){return this._invoke("return",d)},{wrap:function(d){return function(){return new l(d.apply(this,arguments))}},await:function(d){return new a(d)}}}(),t=function(a,l){if(!(a instanceof l))throw new TypeError("Cannot call a class as a function")},e=function(){function a(l,d){for(var u=0;u<d.length;u++){var f=d[u];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(l,f.key,f)}}return function(l,d,u){return d&&a(l.prototype,d),u&&a(l,u),l}}(),r=function(){function a(l,d){var u=[],f=!0,g=!1,v=void 0;try{for(var M=l[Symbol.iterator](),T;!(f=(T=M.next()).done)&&(u.push(T.value),!(d&&u.length===d));f=!0);}catch(_){g=!0,v=_}finally{try{!f&&M.return&&M.return()}finally{if(g)throw v}}return u}return function(l,d){if(Array.isArray(l))return l;if(Symbol.iterator in Object(l))return a(l,d);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=.001,i=1,s=function(l,d){return"data:"+l+","+encodeURIComponent(d)},p=function(l,d,u){return l+(d-l)*u},c=function(){var a=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return a}}(),m=function(){var a=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return a}}(),h=function(){var a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return a}}(),x=function(){var a=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return a}}(),b=function(){var a=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),l=a?parseInt(a[1],10):null;return function(){return l}}(),y=function(){var a=!1;return a=c()&&h()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return a}}(),C=function(){var a=!1;if(b()===65){var l=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(l){var d=l[1].split("."),u=r(d,4),f=u[0],g=u[1],v=u[2],M=u[3];a=parseInt(v,10)===3325&&parseInt(M,10)<148}}return function(){return a}}(),P=function(){var a=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return a}}(),S=function(){var l=window.orientation==90||window.orientation==-90;return P()?!l:l},k=function(l){return!(isNaN(l)||l<=o||l>i)},O=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},V=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},H=function(l){if(m())return!1;if(l.requestFullscreen)l.requestFullscreen();else if(l.webkitRequestFullscreen)l.webkitRequestFullscreen();else if(l.mozRequestFullScreen)l.mozRequestFullScreen();else if(l.msRequestFullscreen)l.msRequestFullscreen();else return!1;return!0},N=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},I=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},B=function(l,d,u,f){var g=l.createShader(l.VERTEX_SHADER);l.shaderSource(g,d),l.compileShader(g);var v=l.createShader(l.FRAGMENT_SHADER);l.shaderSource(v,u),l.compileShader(v);var M=l.createProgram();l.attachShader(M,g),l.attachShader(M,v);for(var T in f)l.bindAttribLocation(M,f[T],T);return l.linkProgram(M),l.deleteShader(g),l.deleteShader(v),M},oe=function(l,d){for(var u={},f=l.getProgramParameter(d,l.ACTIVE_UNIFORMS),g="",v=0;v<f;v++){var M=l.getActiveUniform(d,v);g=M.name.replace("[0]",""),u[g]=l.getUniformLocation(d,g)}return u},ie=function(l,d,u,f,g,v,M){var T=1/(d-u),_=1/(f-g),E=1/(v-M);return l[0]=-2*T,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*_,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*E,l[11]=0,l[12]=(d+u)*T,l[13]=(g+f)*_,l[14]=(M+v)*E,l[15]=1,l},W=function(){var l=!1;return function(d){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(d)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(d.substr(0,4)))&&(l=!0)}(navigator.userAgent||navigator.vendor||window.opera),l},ne=function(l,d){for(var u in d)d.hasOwnProperty(u)&&(l[u]=d[u]);return l},_e=function(l){if(c()){var d=l.style.width,u=l.style.height;l.style.width=parseInt(d)+1+"px",l.style.height=parseInt(u)+"px",setTimeout(function(){l.style.width=d,l.style.height=u},100)}window.canvas=l},fe=function(){var a=Math.PI/180,l=Math.PI*.25;function d(_,E,R,L){var F=Math.tan(E?E.upDegrees*a:l),X=Math.tan(E?E.downDegrees*a:l),K=Math.tan(E?E.leftDegrees*a:l),U=Math.tan(E?E.rightDegrees*a:l),z=2/(K+U),pe=2/(F+X);return _[0]=z,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=pe,_[6]=0,_[7]=0,_[8]=-((K-U)*z*.5),_[9]=(F-X)*pe*.5,_[10]=L/(R-L),_[11]=-1,_[12]=0,_[13]=0,_[14]=L*R/(R-L),_[15]=0,_}function u(_,E,R){var L=E[0],F=E[1],X=E[2],K=E[3],U=L+L,z=F+F,pe=X+X,Ee=L*U,Pe=L*z,ge=L*pe,Oe=F*z,$e=F*pe,Ze=X*pe,et=K*U,tt=K*z,on=K*pe;return _[0]=1-(Oe+Ze),_[1]=Pe+on,_[2]=ge-tt,_[3]=0,_[4]=Pe-on,_[5]=1-(Ee+Ze),_[6]=$e+et,_[7]=0,_[8]=ge+tt,_[9]=$e-et,_[10]=1-(Ee+Oe),_[11]=0,_[12]=R[0],_[13]=R[1],_[14]=R[2],_[15]=1,_}function f(_,E,R){var L=R[0],F=R[1],X=R[2],K,U,z,pe,Ee,Pe,ge,Oe,$e,Ze,et,tt;return E===_?(_[12]=E[0]*L+E[4]*F+E[8]*X+E[12],_[13]=E[1]*L+E[5]*F+E[9]*X+E[13],_[14]=E[2]*L+E[6]*F+E[10]*X+E[14],_[15]=E[3]*L+E[7]*F+E[11]*X+E[15]):(K=E[0],U=E[1],z=E[2],pe=E[3],Ee=E[4],Pe=E[5],ge=E[6],Oe=E[7],$e=E[8],Ze=E[9],et=E[10],tt=E[11],_[0]=K,_[1]=U,_[2]=z,_[3]=pe,_[4]=Ee,_[5]=Pe,_[6]=ge,_[7]=Oe,_[8]=$e,_[9]=Ze,_[10]=et,_[11]=tt,_[12]=K*L+Ee*F+$e*X+E[12],_[13]=U*L+Pe*F+Ze*X+E[13],_[14]=z*L+ge*F+et*X+E[14],_[15]=pe*L+Oe*F+tt*X+E[15]),_}function g(_,E){var R=E[0],L=E[1],F=E[2],X=E[3],K=E[4],U=E[5],z=E[6],pe=E[7],Ee=E[8],Pe=E[9],ge=E[10],Oe=E[11],$e=E[12],Ze=E[13],et=E[14],tt=E[15],on=R*U-L*K,_o=R*z-F*K,bo=R*pe-X*K,Eo=L*z-F*U,yo=L*pe-X*U,wo=F*pe-X*z,To=Ee*Ze-Pe*$e,Mo=Ee*et-ge*$e,So=Ee*tt-Oe*$e,Ro=Pe*et-ge*Ze,Po=Pe*tt-Oe*Ze,Co=ge*tt-Oe*et,Me=on*Co-_o*Po+bo*Ro+Eo*So-yo*Mo+wo*To;return Me?(Me=1/Me,_[0]=(U*Co-z*Po+pe*Ro)*Me,_[1]=(F*Po-L*Co-X*Ro)*Me,_[2]=(Ze*wo-et*yo+tt*Eo)*Me,_[3]=(ge*yo-Pe*wo-Oe*Eo)*Me,_[4]=(z*So-K*Co-pe*Mo)*Me,_[5]=(R*Co-F*So+X*Mo)*Me,_[6]=(et*bo-$e*wo-tt*_o)*Me,_[7]=(Ee*wo-ge*bo+Oe*_o)*Me,_[8]=(K*Po-U*So+pe*To)*Me,_[9]=(L*So-R*Po-X*To)*Me,_[10]=($e*yo-Ze*bo+tt*on)*Me,_[11]=(Pe*bo-Ee*yo-Oe*on)*Me,_[12]=(U*Mo-K*Ro-z*To)*Me,_[13]=(R*Ro-L*Mo+F*To)*Me,_[14]=(Ze*_o-$e*Eo-et*on)*Me,_[15]=(Ee*Eo-Pe*_o+ge*on)*Me,_):null}var v=new Float32Array([0,0,0,1]),M=new Float32Array([0,0,0]);function T(_,E,R,L,F,X){d(_,L||null,X.depthNear,X.depthFar);var K=R.orientation||v,U=R.position||M;u(E,K,U),F&&f(E,E,F),g(E,E)}return function(_,E,R){return!_||!E?!1:(_.pose=E,_.timestamp=E.timestamp,T(_.leftProjectionMatrix,_.leftViewMatrix,E,R._getFieldOfView("left"),R._getEyeOffset("left"),R),T(_.rightProjectionMatrix,_.rightViewMatrix,E,R._getFieldOfView("right"),R._getEyeOffset("right"),R),!0)}}(),se=function(){var l=window.self!==window.top,d=Je(document.referrer),u=Je(window.location.href);return l&&d!==u},Je=function(l){var d,u=l.indexOf("://");u!==-1?d=u+3:d=0;var f=l.indexOf("/",d);return f===-1&&(f=l.length),l.substring(0,f)},_r=function(l){if(l.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var d=2*Math.acos(l.w);return d},rn=function(){var a={};return function(l,d){a[l]===void 0&&(console.warn("webvr-polyfill: "+d),a[l]=!0)}}(),Ft=function(l,d){var u=d?"Please use "+d+" instead.":"";rn(l,l+" has been deprecated. This may not work on native WebVR displays. "+u)};function gh(a,l,d){if(!l){d(a);return}for(var u=[],f=null,g=0;g<l.length;++g){var v=l[g];switch(v){case a.TEXTURE_BINDING_2D:case a.TEXTURE_BINDING_CUBE_MAP:var M=l[++g];if(M<a.TEXTURE0||M>a.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),u.push(null,null);break}f||(f=a.getParameter(a.ACTIVE_TEXTURE)),a.activeTexture(M),u.push(a.getParameter(v),null);break;case a.ACTIVE_TEXTURE:f=a.getParameter(a.ACTIVE_TEXTURE),u.push(null);break;default:u.push(a.getParameter(v));break}}d(a);for(var g=0;g<l.length;++g){var v=l[g],T=u[g];switch(v){case a.ACTIVE_TEXTURE:break;case a.ARRAY_BUFFER_BINDING:a.bindBuffer(a.ARRAY_BUFFER,T);break;case a.COLOR_CLEAR_VALUE:a.clearColor(T[0],T[1],T[2],T[3]);break;case a.COLOR_WRITEMASK:a.colorMask(T[0],T[1],T[2],T[3]);break;case a.CURRENT_PROGRAM:a.useProgram(T);break;case a.ELEMENT_ARRAY_BUFFER_BINDING:a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,T);break;case a.FRAMEBUFFER_BINDING:a.bindFramebuffer(a.FRAMEBUFFER,T);break;case a.RENDERBUFFER_BINDING:a.bindRenderbuffer(a.RENDERBUFFER,T);break;case a.TEXTURE_BINDING_2D:var M=l[++g];if(M<a.TEXTURE0||M>a.TEXTURE31)break;a.activeTexture(M),a.bindTexture(a.TEXTURE_2D,T);break;case a.TEXTURE_BINDING_CUBE_MAP:var M=l[++g];if(M<a.TEXTURE0||M>a.TEXTURE31)break;a.activeTexture(M),a.bindTexture(a.TEXTURE_CUBE_MAP,T);break;case a.VIEWPORT:a.viewport(T[0],T[1],T[2],T[3]);break;case a.BLEND:case a.CULL_FACE:case a.DEPTH_TEST:case a.SCISSOR_TEST:case a.STENCIL_TEST:T?a.enable(v):a.disable(v);break;default:console.log("No GL restore behavior for 0x"+v.toString(16));break}f&&a.activeTexture(f)}}var go=gh,vh=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),Ah=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function mt(a,l,d,u){this.gl=a,this.cardboardUI=l,this.bufferScale=d,this.dirtySubmitFrameBindings=u,this.ctxAttribs=a.getContextAttributes(),this.instanceExt=a.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=a.drawingBufferWidth,this.bufferHeight=a.drawingBufferHeight,this.realBindFramebuffer=a.bindFramebuffer,this.realEnable=a.enable,this.realDisable=a.disable,this.realColorMask=a.colorMask,this.realClearColor=a.clearColor,this.realViewport=a.viewport,c()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(a.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(a.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=B(a,vh,Ah,this.attribs),this.uniforms=oe(a,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.indexCount=0,this.renderTarget=a.createTexture(),this.framebuffer=a.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=a.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=a.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=a.createRenderbuffer()),this.patch(),this.onResize()}mt.prototype.destroy=function(){var a=this.gl;this.unpatch(),a.deleteProgram(this.program),a.deleteBuffer(this.vertexBuffer),a.deleteBuffer(this.indexBuffer),a.deleteTexture(this.renderTarget),a.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&a.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&a.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&a.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},mt.prototype.onResize=function(){var a=this.gl,l=this,d=[a.RENDERBUFFER_BINDING,a.TEXTURE_BINDING_2D,a.TEXTURE0];go(a,d,function(u){l.realBindFramebuffer.call(u,u.FRAMEBUFFER,null),l.scissorTest&&l.realDisable.call(u,u.SCISSOR_TEST),l.realColorMask.call(u,!0,!0,!0,!0),l.realViewport.call(u,0,0,u.drawingBufferWidth,u.drawingBufferHeight),l.realClearColor.call(u,0,0,0,1),u.clear(u.COLOR_BUFFER_BIT),l.realBindFramebuffer.call(u,u.FRAMEBUFFER,l.framebuffer),u.bindTexture(u.TEXTURE_2D,l.renderTarget),u.texImage2D(u.TEXTURE_2D,0,l.ctxAttribs.alpha?u.RGBA:u.RGB,l.bufferWidth,l.bufferHeight,0,l.ctxAttribs.alpha?u.RGBA:u.RGB,u.UNSIGNED_BYTE,null),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,l.renderTarget,0),l.ctxAttribs.depth&&l.ctxAttribs.stencil?(u.bindRenderbuffer(u.RENDERBUFFER,l.depthStencilBuffer),u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_STENCIL,l.bufferWidth,l.bufferHeight),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,l.depthStencilBuffer)):l.ctxAttribs.depth?(u.bindRenderbuffer(u.RENDERBUFFER,l.depthBuffer),u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_COMPONENT16,l.bufferWidth,l.bufferHeight),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,l.depthBuffer)):l.ctxAttribs.stencil&&(u.bindRenderbuffer(u.RENDERBUFFER,l.stencilBuffer),u.renderbufferStorage(u.RENDERBUFFER,u.STENCIL_INDEX8,l.bufferWidth,l.bufferHeight),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.STENCIL_ATTACHMENT,u.RENDERBUFFER,l.stencilBuffer)),!u.checkFramebufferStatus(u.FRAMEBUFFER)===u.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),l.realBindFramebuffer.call(u,u.FRAMEBUFFER,l.lastBoundFramebuffer),l.scissorTest&&l.realEnable.call(u,u.SCISSOR_TEST),l.realColorMask.apply(u,l.colorMask),l.realViewport.apply(u,l.viewport),l.realClearColor.apply(u,l.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},mt.prototype.patch=function(){if(!this.isPatched){var a=this,l=this.gl.canvas,d=this.gl;c()||(l.width=O()*this.bufferScale,l.height=V()*this.bufferScale,Object.defineProperty(l,"width",{configurable:!0,enumerable:!0,get:function(){return a.bufferWidth},set:function(f){a.bufferWidth=f,a.realCanvasWidth.set.call(l,f),a.onResize()}}),Object.defineProperty(l,"height",{configurable:!0,enumerable:!0,get:function(){return a.bufferHeight},set:function(f){a.bufferHeight=f,a.realCanvasHeight.set.call(l,f),a.onResize()}})),this.lastBoundFramebuffer=d.getParameter(d.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(d.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(u,f){a.lastBoundFramebuffer=f||a.framebuffer,a.realBindFramebuffer.call(d,u,a.lastBoundFramebuffer)},this.cullFace=d.getParameter(d.CULL_FACE),this.depthTest=d.getParameter(d.DEPTH_TEST),this.blend=d.getParameter(d.BLEND),this.scissorTest=d.getParameter(d.SCISSOR_TEST),this.stencilTest=d.getParameter(d.STENCIL_TEST),d.enable=function(u){switch(u){case d.CULL_FACE:a.cullFace=!0;break;case d.DEPTH_TEST:a.depthTest=!0;break;case d.BLEND:a.blend=!0;break;case d.SCISSOR_TEST:a.scissorTest=!0;break;case d.STENCIL_TEST:a.stencilTest=!0;break}a.realEnable.call(d,u)},d.disable=function(u){switch(u){case d.CULL_FACE:a.cullFace=!1;break;case d.DEPTH_TEST:a.depthTest=!1;break;case d.BLEND:a.blend=!1;break;case d.SCISSOR_TEST:a.scissorTest=!1;break;case d.STENCIL_TEST:a.stencilTest=!1;break}a.realDisable.call(d,u)},this.colorMask=d.getParameter(d.COLOR_WRITEMASK),d.colorMask=function(u,f,g,v){a.colorMask[0]=u,a.colorMask[1]=f,a.colorMask[2]=g,a.colorMask[3]=v,a.realColorMask.call(d,u,f,g,v)},this.clearColor=d.getParameter(d.COLOR_CLEAR_VALUE),d.clearColor=function(u,f,g,v){a.clearColor[0]=u,a.clearColor[1]=f,a.clearColor[2]=g,a.clearColor[3]=v,a.realClearColor.call(d,u,f,g,v)},this.viewport=d.getParameter(d.VIEWPORT),d.viewport=function(u,f,g,v){a.viewport[0]=u,a.viewport[1]=f,a.viewport[2]=g,a.viewport[3]=v,a.realViewport.call(d,u,f,g,v)},this.isPatched=!0,_e(l)}},mt.prototype.unpatch=function(){if(!!this.isPatched){var a=this.gl,l=this.gl.canvas;c()||(Object.defineProperty(l,"width",this.realCanvasWidth),Object.defineProperty(l,"height",this.realCanvasHeight)),l.width=this.bufferWidth,l.height=this.bufferHeight,a.bindFramebuffer=this.realBindFramebuffer,a.enable=this.realEnable,a.disable=this.realDisable,a.colorMask=this.realColorMask,a.clearColor=this.realClearColor,a.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&a.bindFramebuffer(a.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){_e(l)},1)}},mt.prototype.setTextureBounds=function(a,l){a||(a=[0,0,.5,1]),l||(l=[.5,0,.5,1]),this.viewportOffsetScale[0]=a[0],this.viewportOffsetScale[1]=a[1],this.viewportOffsetScale[2]=a[2],this.viewportOffsetScale[3]=a[3],this.viewportOffsetScale[4]=l[0],this.viewportOffsetScale[5]=l[1],this.viewportOffsetScale[6]=l[2],this.viewportOffsetScale[7]=l[3]},mt.prototype.submitFrame=function(){var a=this.gl,l=this,d=[];if(this.dirtySubmitFrameBindings||d.push(a.CURRENT_PROGRAM,a.ARRAY_BUFFER_BINDING,a.ELEMENT_ARRAY_BUFFER_BINDING,a.TEXTURE_BINDING_2D,a.TEXTURE0),go(a,d,function(f){l.realBindFramebuffer.call(f,f.FRAMEBUFFER,null);var g=0,v=0;l.instanceExt&&(g=f.getVertexAttrib(l.attribs.position,l.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),v=f.getVertexAttrib(l.attribs.texCoord,l.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),l.cullFace&&l.realDisable.call(f,f.CULL_FACE),l.depthTest&&l.realDisable.call(f,f.DEPTH_TEST),l.blend&&l.realDisable.call(f,f.BLEND),l.scissorTest&&l.realDisable.call(f,f.SCISSOR_TEST),l.stencilTest&&l.realDisable.call(f,f.STENCIL_TEST),l.realColorMask.call(f,!0,!0,!0,!0),l.realViewport.call(f,0,0,f.drawingBufferWidth,f.drawingBufferHeight),(l.ctxAttribs.alpha||c())&&(l.realClearColor.call(f,0,0,0,1),f.clear(f.COLOR_BUFFER_BIT)),f.useProgram(l.program),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l.indexBuffer),f.bindBuffer(f.ARRAY_BUFFER,l.vertexBuffer),f.enableVertexAttribArray(l.attribs.position),f.enableVertexAttribArray(l.attribs.texCoord),f.vertexAttribPointer(l.attribs.position,2,f.FLOAT,!1,20,0),f.vertexAttribPointer(l.attribs.texCoord,3,f.FLOAT,!1,20,8),l.instanceExt&&(g!=0&&l.instanceExt.vertexAttribDivisorANGLE(l.attribs.position,0),v!=0&&l.instanceExt.vertexAttribDivisorANGLE(l.attribs.texCoord,0)),f.activeTexture(f.TEXTURE0),f.uniform1i(l.uniforms.diffuse,0),f.bindTexture(f.TEXTURE_2D,l.renderTarget),f.uniform4fv(l.uniforms.viewportOffsetScale,l.viewportOffsetScale),f.drawElements(f.TRIANGLES,l.indexCount,f.UNSIGNED_SHORT,0),l.cardboardUI&&l.cardboardUI.renderNoState(),l.realBindFramebuffer.call(l.gl,f.FRAMEBUFFER,l.framebuffer),l.ctxAttribs.preserveDrawingBuffer||(l.realClearColor.call(f,0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),l.dirtySubmitFrameBindings||l.realBindFramebuffer.call(f,f.FRAMEBUFFER,l.lastBoundFramebuffer),l.cullFace&&l.realEnable.call(f,f.CULL_FACE),l.depthTest&&l.realEnable.call(f,f.DEPTH_TEST),l.blend&&l.realEnable.call(f,f.BLEND),l.scissorTest&&l.realEnable.call(f,f.SCISSOR_TEST),l.stencilTest&&l.realEnable.call(f,f.STENCIL_TEST),l.realColorMask.apply(f,l.colorMask),l.realViewport.apply(f,l.viewport),(l.ctxAttribs.alpha||!l.ctxAttribs.preserveDrawingBuffer)&&l.realClearColor.apply(f,l.clearColor),l.instanceExt&&(g!=0&&l.instanceExt.vertexAttribDivisorANGLE(l.attribs.position,g),v!=0&&l.instanceExt.vertexAttribDivisorANGLE(l.attribs.texCoord,v))}),c()){var u=a.canvas;(u.width!=l.bufferWidth||u.height!=l.bufferHeight)&&(l.bufferWidth=u.width,l.bufferHeight=u.height,l.onResize())}},mt.prototype.updateDeviceInfo=function(a){var l=this.gl,d=this,u=[l.ARRAY_BUFFER_BINDING,l.ELEMENT_ARRAY_BUFFER_BINDING];go(l,u,function(f){var g=d.computeMeshVertices_(d.meshWidth,d.meshHeight,a);if(f.bindBuffer(f.ARRAY_BUFFER,d.vertexBuffer),f.bufferData(f.ARRAY_BUFFER,g,f.STATIC_DRAW),!d.indexCount){var v=d.computeMeshIndices_(d.meshWidth,d.meshHeight);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,d.indexBuffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,v,f.STATIC_DRAW),d.indexCount=v.length}})},mt.prototype.computeMeshVertices_=function(a,l,d){for(var u=new Float32Array(2*a*l*5),f=d.getLeftEyeVisibleTanAngles(),g=d.getLeftEyeNoLensTanAngles(),v=d.getLeftEyeVisibleScreenRect(g),M=0,T=0;T<2;T++){for(var _=0;_<l;_++)for(var E=0;E<a;E++,M++){var R=E/(a-1),L=_/(l-1),F=R,X=L,K=p(f[0],f[2],R),U=p(f[3],f[1],L),z=Math.sqrt(K*K+U*U),pe=d.distortion.distortInverse(z),Ee=K*pe/z,Pe=U*pe/z;R=(Ee-g[0])/(g[2]-g[0]),L=(Pe-g[3])/(g[1]-g[3]),R=(v.x+R*v.width-.5)*2,L=(v.y+L*v.height-.5)*2,u[M*5+0]=R,u[M*5+1]=L,u[M*5+2]=F,u[M*5+3]=X,u[M*5+4]=T}var ge=f[2]-f[0];f[0]=-(ge+f[0]),f[2]=ge-f[2],ge=g[2]-g[0],g[0]=-(ge+g[0]),g[2]=ge-g[2],v.x=1-(v.x+v.width)}return u},mt.prototype.computeMeshIndices_=function(a,l){for(var d=new Uint16Array(2*(a-1)*(l-1)*6),u=a/2,f=l/2,g=0,v=0,M=0;M<2;M++)for(var T=0;T<l;T++)for(var _=0;_<a;_++,g++)_==0||T==0||(_<=u==T<=f?(d[v++]=g,d[v++]=g-a-1,d[v++]=g-a,d[v++]=g-a-1,d[v++]=g,d[v++]=g-1):(d[v++]=g-1,d[v++]=g-a,d[v++]=g,d[v++]=g-a,d[v++]=g-1,d[v++]=g-a-1));return d},mt.prototype.getOwnPropertyDescriptor_=function(a,l){var d=Object.getOwnPropertyDescriptor(a,l);return(d.get===void 0||d.set===void 0)&&(d.configurable=!0,d.enumerable=!0,d.get=function(){return this.getAttribute(l)},d.set=function(u){this.setAttribute(l,u)}),d};var _h=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),bh=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),mc=Math.PI/180,ja=60,hc=12,fc=20,Ga=1,xc=.75,gc=.3125,Eh=4,kn=28,Wa=1.5;function On(a){this.gl=a,this.attribs={position:0},this.program=B(a,_h,bh,this.attribs),this.uniforms=oe(a,this.program),this.vertexBuffer=a.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}On.prototype.destroy=function(){var a=this.gl;this.listener&&a.canvas.removeEventListener("click",this.listener,!1),a.deleteProgram(this.program),a.deleteBuffer(this.vertexBuffer)},On.prototype.listen=function(a,l){var d=this.gl.canvas;this.listener=function(u){var f=d.clientWidth/2,g=kn*Wa;u.clientX>f-g&&u.clientX<f+g&&u.clientY>d.clientHeight-g?a(u):u.clientX<g&&u.clientY<g&&l(u)},d.addEventListener("click",this.listener,!1)},On.prototype.onResize=function(){var a=this.gl,l=this,d=[a.ARRAY_BUFFER_BINDING];go(a,d,function(u){var f=[],g=u.drawingBufferWidth/2,v=Math.max(screen.width,screen.height)*window.devicePixelRatio,M=u.drawingBufferWidth/v,T=M*window.devicePixelRatio,_=Eh*T/2,E=kn*Wa*T,R=kn*T/2,L=(kn*Wa-kn)*T;f.push(g-_,E),f.push(g-_,u.drawingBufferHeight),f.push(g+_,E),f.push(g+_,u.drawingBufferHeight),l.gearOffset=f.length/2;function F(pe,Ee){var Pe=(90-pe)*mc,ge=Math.cos(Pe),Oe=Math.sin(Pe);f.push(gc*ge*R+g,gc*Oe*R+R),f.push(Ee*ge*R+g,Ee*Oe*R+R)}for(var X=0;X<=6;X++){var K=X*ja;F(K,Ga),F(K+hc,Ga),F(K+fc,xc),F(K+(ja-fc),xc),F(K+(ja-hc),Ga)}l.gearVertexCount=f.length/2-l.gearOffset,l.arrowOffset=f.length/2;function U(pe,Ee){f.push(L+pe,u.drawingBufferHeight-L-Ee)}var z=_/Math.sin(45*mc);U(0,R),U(R,0),U(R+z,z),U(z,R+z),U(z,R-z),U(0,R),U(R,R*2),U(R+z,R*2-z),U(z,R-z),U(0,R),U(z,R-_),U(kn*T,R-_),U(z,R+_),U(kn*T,R+_),l.arrowVertexCount=f.length/2-l.arrowOffset,u.bindBuffer(u.ARRAY_BUFFER,l.vertexBuffer),u.bufferData(u.ARRAY_BUFFER,new Float32Array(f),u.STATIC_DRAW)})},On.prototype.render=function(){var a=this.gl,l=this,d=[a.CULL_FACE,a.DEPTH_TEST,a.BLEND,a.SCISSOR_TEST,a.STENCIL_TEST,a.COLOR_WRITEMASK,a.VIEWPORT,a.CURRENT_PROGRAM,a.ARRAY_BUFFER_BINDING];go(a,d,function(u){u.disable(u.CULL_FACE),u.disable(u.DEPTH_TEST),u.disable(u.BLEND),u.disable(u.SCISSOR_TEST),u.disable(u.STENCIL_TEST),u.colorMask(!0,!0,!0,!0),u.viewport(0,0,u.drawingBufferWidth,u.drawingBufferHeight),l.renderNoState()})},On.prototype.renderNoState=function(){var a=this.gl;a.useProgram(this.program),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.enableVertexAttribArray(this.attribs.position),a.vertexAttribPointer(this.attribs.position,2,a.FLOAT,!1,8,0),a.uniform4f(this.uniforms.color,1,1,1,1),ie(this.projMat,0,a.drawingBufferWidth,0,a.drawingBufferHeight,.1,1024),a.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),a.drawArrays(a.TRIANGLE_STRIP,0,4),a.drawArrays(a.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),a.drawArrays(a.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function Si(a){this.coefficients=a}Si.prototype.distortInverse=function(a){for(var l=0,d=1,u=a-this.distort(l);Math.abs(d-l)>1e-4;){var f=a-this.distort(d),g=d-f*((d-l)/(f-u));l=d,d=g,u=f}return d},Si.prototype.distort=function(a){for(var l=a*a,d=0,u=0;u<this.coefficients.length;u++)d=l*(d+this.coefficients[u]);return(d+1)*a};var At=Math.PI/180,_t=180/Math.PI,xe=function(l,d,u){this.x=l||0,this.y=d||0,this.z=u||0};xe.prototype={constructor:xe,set:function(l,d,u){return this.x=l,this.y=d,this.z=u,this},copy:function(l){return this.x=l.x,this.y=l.y,this.z=l.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var l=this.length();if(l!==0){var d=1/l;this.multiplyScalar(d)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(l){this.x*=l,this.y*=l,this.z*=l},applyQuaternion:function(l){var d=this.x,u=this.y,f=this.z,g=l.x,v=l.y,M=l.z,T=l.w,_=T*d+v*f-M*u,E=T*u+M*d-g*f,R=T*f+g*u-v*d,L=-g*d-v*u-M*f;return this.x=_*T+L*-g+E*-M-R*-v,this.y=E*T+L*-v+R*-g-_*-M,this.z=R*T+L*-M+_*-v-E*-g,this},dot:function(l){return this.x*l.x+this.y*l.y+this.z*l.z},crossVectors:function(l,d){var u=l.x,f=l.y,g=l.z,v=d.x,M=d.y,T=d.z;return this.x=f*T-g*M,this.y=g*v-u*T,this.z=u*M-f*v,this}};var Z=function(l,d,u,f){this.x=l||0,this.y=d||0,this.z=u||0,this.w=f!==void 0?f:1};Z.prototype={constructor:Z,set:function(l,d,u,f){return this.x=l,this.y=d,this.z=u,this.w=f,this},copy:function(l){return this.x=l.x,this.y=l.y,this.z=l.z,this.w=l.w,this},setFromEulerXYZ:function(l,d,u){var f=Math.cos(l/2),g=Math.cos(d/2),v=Math.cos(u/2),M=Math.sin(l/2),T=Math.sin(d/2),_=Math.sin(u/2);return this.x=M*g*v+f*T*_,this.y=f*T*v-M*g*_,this.z=f*g*_+M*T*v,this.w=f*g*v-M*T*_,this},setFromEulerYXZ:function(l,d,u){var f=Math.cos(l/2),g=Math.cos(d/2),v=Math.cos(u/2),M=Math.sin(l/2),T=Math.sin(d/2),_=Math.sin(u/2);return this.x=M*g*v+f*T*_,this.y=f*T*v-M*g*_,this.z=f*g*_-M*T*v,this.w=f*g*v+M*T*_,this},setFromAxisAngle:function(l,d){var u=d/2,f=Math.sin(u);return this.x=l.x*f,this.y=l.y*f,this.z=l.z*f,this.w=Math.cos(u),this},multiply:function(l){return this.multiplyQuaternions(this,l)},multiplyQuaternions:function(l,d){var u=l.x,f=l.y,g=l.z,v=l.w,M=d.x,T=d.y,_=d.z,E=d.w;return this.x=u*E+v*M+f*_-g*T,this.y=f*E+v*T+g*M-u*_,this.z=g*E+v*_+u*T-f*M,this.w=v*E-u*M-f*T-g*_,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var l=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return l===0?(this.x=0,this.y=0,this.z=0,this.w=1):(l=1/l,this.x=this.x*l,this.y=this.y*l,this.z=this.z*l,this.w=this.w*l),this},slerp:function(l,d){if(d===0)return this;if(d===1)return this.copy(l);var u=this.x,f=this.y,g=this.z,v=this.w,M=v*l.w+u*l.x+f*l.y+g*l.z;if(M<0?(this.w=-l.w,this.x=-l.x,this.y=-l.y,this.z=-l.z,M=-M):this.copy(l),M>=1)return this.w=v,this.x=u,this.y=f,this.z=g,this;var T=Math.acos(M),_=Math.sqrt(1-M*M);if(Math.abs(_)<.001)return this.w=.5*(v+this.w),this.x=.5*(u+this.x),this.y=.5*(f+this.y),this.z=.5*(g+this.z),this;var E=Math.sin((1-d)*T)/_,R=Math.sin(d*T)/_;return this.w=v*E+this.w*R,this.x=u*E+this.x*R,this.y=f*E+this.y*R,this.z=g*E+this.z*R,this},setFromUnitVectors:function(){var a,l,d=1e-6;return function(u,f){return a===void 0&&(a=new xe),l=u.dot(f)+1,l<d?(l=0,Math.abs(u.x)>Math.abs(u.z)?a.set(-u.y,u.x,0):a.set(0,-u.z,u.y)):a.crossVectors(u,f),this.x=a.x,this.y=a.y,this.z=a.z,this.w=l,this.normalize(),this}}()};function qa(a){this.width=a.width||O(),this.height=a.height||V(),this.widthMeters=a.widthMeters,this.heightMeters=a.heightMeters,this.bevelMeters=a.bevelMeters}var yh=new qa({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),wh=new qa({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),Qa={CardboardV1:new Ka({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new Ka({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function we(a,l){this.viewer=Qa.CardboardV2,this.updateDeviceParams(a),this.distortion=new Si(this.viewer.distortionCoefficients);for(var d=0;d<l.length;d++){var u=l[d];Qa[u.id]=new Ka(u)}}we.prototype.updateDeviceParams=function(a){this.device=this.determineDevice_(a)||this.device},we.prototype.getDevice=function(){return this.device},we.prototype.setViewer=function(a){this.viewer=a,this.distortion=new Si(this.viewer.distortionCoefficients)},we.prototype.determineDevice_=function(a){if(!a)return c()?(console.warn("Using fallback iOS device measurements."),wh):(console.warn("Using fallback Android device measurements."),yh);var l=.0254,d=l/a.xdpi,u=l/a.ydpi,f=O(),g=V();return new qa({widthMeters:d*f,heightMeters:u*g,bevelMeters:a.bevelMm*.001})},we.prototype.getDistortedFieldOfViewLeftEye=function(){var a=this.viewer,l=this.device,d=this.distortion,u=a.screenLensDistance,f=(l.widthMeters-a.interLensDistance)/2,g=a.interLensDistance/2,v=a.baselineLensDistance-l.bevelMeters,M=l.heightMeters-v,T=_t*Math.atan(d.distort(f/u)),_=_t*Math.atan(d.distort(g/u)),E=_t*Math.atan(d.distort(v/u)),R=_t*Math.atan(d.distort(M/u));return{leftDegrees:Math.min(T,a.fov),rightDegrees:Math.min(_,a.fov),downDegrees:Math.min(E,a.fov),upDegrees:Math.min(R,a.fov)}},we.prototype.getLeftEyeVisibleTanAngles=function(){var a=this.viewer,l=this.device,d=this.distortion,u=Math.tan(-At*a.fov),f=Math.tan(At*a.fov),g=Math.tan(At*a.fov),v=Math.tan(-At*a.fov),M=l.widthMeters/4,T=l.heightMeters/2,_=a.baselineLensDistance-l.bevelMeters-T,E=a.interLensDistance/2-M,R=-_,L=a.screenLensDistance,F=d.distort((E-M)/L),X=d.distort((R+T)/L),K=d.distort((E+M)/L),U=d.distort((R-T)/L),z=new Float32Array(4);return z[0]=Math.max(u,F),z[1]=Math.min(f,X),z[2]=Math.min(g,K),z[3]=Math.max(v,U),z},we.prototype.getLeftEyeNoLensTanAngles=function(){var a=this.viewer,l=this.device,d=this.distortion,u=new Float32Array(4),f=d.distortInverse(Math.tan(-At*a.fov)),g=d.distortInverse(Math.tan(At*a.fov)),v=d.distortInverse(Math.tan(At*a.fov)),M=d.distortInverse(Math.tan(-At*a.fov)),T=l.widthMeters/4,_=l.heightMeters/2,E=a.baselineLensDistance-l.bevelMeters-_,R=a.interLensDistance/2-T,L=-E,F=a.screenLensDistance,X=(R-T)/F,K=(L+_)/F,U=(R+T)/F,z=(L-_)/F;return u[0]=Math.max(f,X),u[1]=Math.min(g,K),u[2]=Math.min(v,U),u[3]=Math.max(M,z),u},we.prototype.getLeftEyeVisibleScreenRect=function(a){var l=this.viewer,d=this.device,u=l.screenLensDistance,f=(d.widthMeters-l.interLensDistance)/2,g=l.baselineLensDistance-d.bevelMeters,v=(a[0]*u+f)/d.widthMeters,M=(a[1]*u+g)/d.heightMeters,T=(a[2]*u+f)/d.widthMeters,_=(a[3]*u+g)/d.heightMeters;return{x:v,y:_,width:T-v,height:M-_}},we.prototype.getFieldOfViewLeftEye=function(a){return a?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},we.prototype.getFieldOfViewRightEye=function(a){var l=this.getFieldOfViewLeftEye(a);return{leftDegrees:l.rightDegrees,rightDegrees:l.leftDegrees,upDegrees:l.upDegrees,downDegrees:l.downDegrees}},we.prototype.getUndistortedFieldOfViewLeftEye=function(){var a=this.getUndistortedParams_();return{leftDegrees:_t*Math.atan(a.outerDist),rightDegrees:_t*Math.atan(a.innerDist),downDegrees:_t*Math.atan(a.bottomDist),upDegrees:_t*Math.atan(a.topDist)}},we.prototype.getUndistortedViewportLeftEye=function(){var a=this.getUndistortedParams_(),l=this.viewer,d=this.device,u=l.screenLensDistance,f=d.widthMeters/u,g=d.heightMeters/u,v=d.width/f,M=d.height/g,T=Math.round((a.eyePosX-a.outerDist)*v),_=Math.round((a.eyePosY-a.bottomDist)*M);return{x:T,y:_,width:Math.round((a.eyePosX+a.innerDist)*v)-T,height:Math.round((a.eyePosY+a.topDist)*M)-_}},we.prototype.getUndistortedParams_=function(){var a=this.viewer,l=this.device,d=this.distortion,u=a.screenLensDistance,f=a.interLensDistance/2/u,g=l.widthMeters/u,v=l.heightMeters/u,M=g/2-f,T=(a.baselineLensDistance-l.bevelMeters)/u,_=a.fov,E=d.distortInverse(Math.tan(At*_)),R=Math.min(M,E),L=Math.min(f,E),F=Math.min(T,E),X=Math.min(v-T,E);return{outerDist:R,innerDist:L,topDist:X,bottomDist:F,eyePosX:M,eyePosY:T}};function Ka(a){this.id=a.id,this.label=a.label,this.fov=a.fov,this.interLensDistance=a.interLensDistance,this.baselineLensDistance=a.baselineLensDistance,this.screenLensDistance=a.screenLensDistance,this.distortionCoefficients=a.distortionCoefficients,this.inverseCoefficients=a.inverseCoefficients}we.Viewers=Qa;var Th=1,Mh="2019-11-09T17:36:14Z",Sh=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],Rh={format:Th,last_updated:Mh,devices:Sh};function vo(a,l){if(this.dpdb=Rh,this.recalculateDeviceParams_(),a){this.onDeviceParamsUpdated=l;var d=new XMLHttpRequest,u=this;d.open("GET",a,!0),d.addEventListener("load",function(){u.loading=!1,d.status>=200&&d.status<=299?(u.dpdb=JSON.parse(d.response),u.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),d.send()}}vo.prototype.getDeviceParams=function(){return this.deviceParams},vo.prototype.recalculateDeviceParams_=function(){var a=this.calcDeviceParams_();a?(this.deviceParams=a,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},vo.prototype.calcDeviceParams_=function(){var a=this.dpdb;if(!a)return console.error("DPDB not available."),null;if(a.format!=1)return console.error("DPDB has unexpected format version."),null;if(!a.devices||!a.devices.length)return console.error("DPDB does not have a devices section."),null;var l=navigator.userAgent||navigator.vendor||window.opera,d=O(),u=V();if(!a.devices)return console.error("DPDB has no devices section."),null;for(var f=0;f<a.devices.length;f++){var g=a.devices[f];if(!g.rules){console.warn("Device["+f+"] has no rules section.");continue}if(g.type!="ios"&&g.type!="android"){console.warn("Device["+f+"] has invalid type.");continue}if(c()==(g.type=="ios")){for(var v=!1,M=0;M<g.rules.length;M++){var T=g.rules[M];if(this.ruleMatches_(T,l,d,u)){v=!0;break}}if(!!v){var _=g.dpi[0]||g.dpi,E=g.dpi[1]||g.dpi;return new Ph({xdpi:_,ydpi:E,bevelMm:g.bw})}}}return console.warn("No DPDB device match."),null},vo.prototype.ruleMatches_=function(a,l,d,u){if(!a.ua&&!a.res||(a.ua&&a.ua.substring(0,2)==="SM"&&(a.ua=a.ua.substring(0,7)),a.ua&&l.indexOf(a.ua)<0))return!1;if(a.res){if(!a.res[0]||!a.res[1])return!1;var f=a.res[0],g=a.res[1];if(Math.min(d,u)!=Math.min(f,g)||Math.max(d,u)!=Math.max(f,g))return!1}return!0};function Ph(a){this.xdpi=a.xdpi,this.ydpi=a.ydpi,this.bevelMm=a.bevelMm}function Ao(a,l){this.set(a,l)}Ao.prototype.set=function(a,l){this.sample=a,this.timestampS=l},Ao.prototype.copy=function(a){this.set(a.sample,a.timestampS)};function Dn(a,l){this.kFilter=a,this.isDebug=l,this.currentAccelMeasurement=new Ao,this.currentGyroMeasurement=new Ao,this.previousGyroMeasurement=new Ao,c()?this.filterQ=new Z(-1,0,0,1):this.filterQ=new Z(1,0,0,1),this.previousFilterQ=new Z,this.previousFilterQ.copy(this.filterQ),this.accelQ=new Z,this.isOrientationInitialized=!1,this.estimatedGravity=new xe,this.measuredGravity=new xe,this.gyroIntegralQ=new Z}Dn.prototype.addAccelMeasurement=function(a,l){this.currentAccelMeasurement.set(a,l)},Dn.prototype.addGyroMeasurement=function(a,l){this.currentGyroMeasurement.set(a,l);var d=l-this.previousGyroMeasurement.timestampS;k(d)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},Dn.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var a=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,l=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,a);this.gyroIntegralQ.multiply(l),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(l);var d=new Z;d.copy(this.filterQ),d.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(d),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var u=new Z;u.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),u.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",_t*_r(u),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var f=new Z;f.copy(this.filterQ),f.multiply(u),this.filterQ.slerp(f,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},Dn.prototype.getOrientation=function(){return this.filterQ},Dn.prototype.accelToQuaternion_=function(a){var l=new xe;l.copy(a),l.normalize();var d=new Z;return d.setFromUnitVectors(new xe(0,0,-1),l),d.inverse(),d},Dn.prototype.gyroToQuaternionDelta_=function(a,l){var d=new Z,u=new xe;return u.copy(a),u.normalize(),d.setFromAxisAngle(u,a.length()*l),d};function vc(a,l){this.predictionTimeS=a,this.isDebug=l,this.previousQ=new Z,this.previousTimestampS=null,this.deltaQ=new Z,this.outQ=new Z}vc.prototype.getPrediction=function(a,l,d){if(!this.previousTimestampS)return this.previousQ.copy(a),this.previousTimestampS=d,a;var u=new xe;u.copy(l),u.normalize();var f=l.length();if(f<At*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(_t*f).toFixed(1)),this.outQ.copy(a),this.previousQ.copy(a),this.outQ;var g=f*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(u,g),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(a),this.previousTimestampS=d,this.outQ};function ot(a,l,d,u){this.yawOnly=d,this.accelerometer=new xe,this.gyroscope=new xe,this.filter=new Dn(a,u),this.posePredictor=new vc(l,u),this.isFirefoxAndroid=x(),this.isIOS=c();var f=b();this.isDeviceMotionInRadians=!this.isIOS&&f&&f<66,this.isWithoutDeviceMotion=C()||y(),this.filterToWorldQ=new Z,c()?this.filterToWorldQ.setFromAxisAngle(new xe(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new xe(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new Z,this.worldToScreenQ=new Z,this.originalPoseAdjustQ=new Z,this.originalPoseAdjustQ.setFromAxisAngle(new xe(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),S()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new Z,this.orientationOut_=new Float32Array(4),this.start()}ot.prototype.getPosition=function(){return null},ot.prototype.getOrientation=function(){var a=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var f=new Z().setFromAxisAngle(new xe(0,0,-1),0),g=new Z;return window.orientation===-90?g.setFromAxisAngle(new xe(0,1,0),Math.PI/-2):g.setFromAxisAngle(new xe(0,1,0),Math.PI/2),f.multiply(g)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var f=new Z;return f.setFromAxisAngle(new xe(1,0,0),-Math.PI/2),f}(),a=this._deviceOrientationQ;var d=new Z;return d.copy(a),d.multiply(this.deviceOrientationFilterToWorldQ),d.multiply(this.resetQ),d.multiply(this.worldToScreenQ),d.multiplyQuaternions(this.deviceOrientationFixQ,d),this.yawOnly&&(d.x=0,d.z=0,d.normalize()),this.orientationOut_[0]=d.x,this.orientationOut_[1]=d.y,this.orientationOut_[2]=d.z,this.orientationOut_[3]=d.w,this.orientationOut_}else{var l=this.filter.getOrientation();a=this.posePredictor.getPrediction(l,this.gyroscope,this.previousTimestampS)}var d=new Z;return d.copy(this.filterToWorldQ),d.multiply(this.resetQ),d.multiply(a),d.multiply(this.worldToScreenQ),this.yawOnly&&(d.x=0,d.z=0,d.normalize()),this.orientationOut_[0]=d.x,this.orientationOut_[1]=d.y,this.orientationOut_[2]=d.z,this.orientationOut_[3]=d.w,this.orientationOut_},ot.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),S()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},ot.prototype.onDeviceOrientation_=function(a){this._deviceOrientationQ=this._deviceOrientationQ||new Z;var l=a.alpha,d=a.beta,u=a.gamma;l=(l||0)*Math.PI/180,d=(d||0)*Math.PI/180,u=(u||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(d,l,-u)},ot.prototype.onDeviceMotion_=function(a){this.updateDeviceMotion_(a)},ot.prototype.updateDeviceMotion_=function(a){var l=a.accelerationIncludingGravity,d=a.rotationRate,u=a.timeStamp/1e3,f=u-this.previousTimestampS;if(f<0){rn("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=u;return}else if(f<=o||f>i){rn("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=u;return}this.accelerometer.set(-l.x,-l.y,-l.z),d&&(P()?this.gyroscope.set(-d.beta,d.alpha,d.gamma):this.gyroscope.set(d.alpha,d.beta,d.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,u)),this.filter.addAccelMeasurement(this.accelerometer,u),this.previousTimestampS=u},ot.prototype.onOrientationChange_=function(a){this.setScreenTransform_()},ot.prototype.onMessage_=function(a){var l=a.data;if(!(!l||!l.type)){var d=l.type.toLowerCase();d==="devicemotion"&&this.updateDeviceMotion_(l.deviceMotionEvent)}},ot.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new xe(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new xe(0,0,1),Math.PI/2);break;case 180:break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},ot.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),c()&&se()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},ot.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var Ch=60,Ih=new xe(1,0,0),Vh=new xe(0,0,1),Ya=new Z;Ya.setFromAxisAngle(Ih,-Math.PI/2),Ya.multiply(new Z().setFromAxisAngle(Vh,Math.PI/2));var Lh=function(){function a(l){t(this,a),this.config=l,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new Z,this._outQ=new Z,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return e(a,[{key:"init",value:function(){var d=null;try{d=new RelativeOrientationSensor({frequency:Ch,referenceFrame:"screen"}),d.addEventListener("error",this._onSensorError)}catch(u){this.errors.push(u),u.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):u.name==="ReferenceError"?this.useDeviceMotion():console.error(u)}d&&(this.api="sensor",this.sensor=d,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new ot(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var d=this.sensor.quaternion;this._sensorQ.set(d[0],d[1],d[2],d[3]);var u=this._outQ;return u.copy(Ya),u.multiply(this._sensorQ),this.config.YAW_ONLY&&(u.x=u.z=0,u.normalize()),this._out[0]=u.x,this._out[1]=u.y,this._out[2]=u.z,this._out[3]=u.w,this._out}},{key:"_onSensorError",value:function(d){this.errors.push(d.error),d.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):d.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(d.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),a}(),kh="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function Bn(){this.loadIcon_();var a=document.createElement("div"),v=a.style;v.position="fixed",v.top=0,v.right=0,v.bottom=0,v.left=0,v.backgroundColor="gray",v.fontFamily="sans-serif",v.zIndex=1e6;var l=document.createElement("img");l.src=this.icon;var v=l.style;v.marginLeft="25%",v.marginTop="25%",v.width="50%",a.appendChild(l);var d=document.createElement("div"),v=d.style;v.textAlign="center",v.fontSize="16px",v.lineHeight="24px",v.margin="24px 25%",v.width="50%",d.innerHTML="Place your phone into your Cardboard viewer.",a.appendChild(d);var u=document.createElement("div"),v=u.style;v.backgroundColor="#CFD8DC",v.position="fixed",v.bottom=0,v.width="100%",v.height="48px",v.padding="14px 24px",v.boxSizing="border-box",v.color="#656A6B",a.appendChild(u);var f=document.createElement("div");f.style.float="left",f.innerHTML="No Cardboard viewer?";var g=document.createElement("a");g.href="https://www.google.com/get/cardboard/get-cardboard/",g.innerHTML="get one",g.target="_blank";var v=g.style;v.float="right",v.fontWeight=600,v.textTransform="uppercase",v.borderLeft="1px solid gray",v.paddingLeft="24px",v.textDecoration="none",v.color="#656A6B",u.appendChild(f),u.appendChild(g),this.overlay=a,this.text=d,this.hide()}Bn.prototype.show=function(a){!a&&!this.overlay.parentElement?document.body.appendChild(this.overlay):a&&(this.overlay.parentElement&&this.overlay.parentElement!=a&&this.overlay.parentElement.removeChild(this.overlay),a.appendChild(this.overlay)),this.overlay.style.display="block";var l=this.overlay.querySelector("img"),d=l.style;S()?(d.width="20%",d.marginLeft="40%",d.marginTop="3%"):(d.width="50%",d.marginLeft="25%",d.marginTop="25%")},Bn.prototype.hide=function(){this.overlay.style.display="none"},Bn.prototype.showTemporarily=function(a,l){this.show(l),this.timer=setTimeout(this.hide.bind(this),a)},Bn.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},Bn.prototype.update=function(){this.disableShowTemporarily(),!S()&&W()?this.show():this.hide()},Bn.prototype.loadIcon_=function(){this.icon=s("image/svg+xml",kh)};var Oh="CardboardV1",Ac="WEBVR_CARDBOARD_VIEWER",Dh="webvr-polyfill-viewer-selector";function it(a){try{this.selectedKey=localStorage.getItem(Ac)}catch(l){console.error("Failed to load viewer profile: %s",l)}this.selectedKey||(this.selectedKey=a||Oh),this.dialog=this.createDialog_(we.Viewers),this.root=null,this.onChangeCallbacks_=[]}it.prototype.show=function(a){this.root=a,a.appendChild(this.dialog);var l=this.dialog.querySelector("#"+this.selectedKey);l.checked=!0,this.dialog.style.display="block"},it.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},it.prototype.getCurrentViewer=function(){return we.Viewers[this.selectedKey]},it.prototype.getSelectedKey_=function(){var a=this.dialog.querySelector("input[name=field]:checked");return a?a.id:null},it.prototype.onChange=function(a){this.onChangeCallbacks_.push(a)},it.prototype.fireOnChange_=function(a){for(var l=0;l<this.onChangeCallbacks_.length;l++)this.onChangeCallbacks_[l](a)},it.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!we.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(we.Viewers[this.selectedKey]);try{localStorage.setItem(Ac,this.selectedKey)}catch(a){console.error("Failed to save viewer profile: %s",a)}this.hide()},it.prototype.createDialog_=function(a){var l=document.createElement("div");l.classList.add(Dh),l.style.display="none";var d=document.createElement("div"),g=d.style;g.position="fixed",g.left=0,g.top=0,g.width="100%",g.height="100%",g.background="rgba(0, 0, 0, 0.3)",d.addEventListener("click",this.hide.bind(this));var u=280,f=document.createElement("div"),g=f.style;g.boxSizing="border-box",g.position="fixed",g.top="24px",g.left="50%",g.marginLeft=-u/2+"px",g.width=u+"px",g.padding="24px",g.overflow="hidden",g.background="#fafafa",g.fontFamily="'Roboto', sans-serif",g.boxShadow="0px 5px 20px #666",f.appendChild(this.createH1_("Select your viewer"));for(var v in a)f.appendChild(this.createChoice_(v,a[v].label));return f.appendChild(this.createButton_("Save",this.onSave_.bind(this))),l.appendChild(d),l.appendChild(f),l},it.prototype.createH1_=function(a){var l=document.createElement("h1"),d=l.style;return d.color="black",d.fontSize="20px",d.fontWeight="bold",d.marginTop=0,d.marginBottom="24px",l.innerHTML=a,l},it.prototype.createChoice_=function(a,l){var d=document.createElement("div");d.style.marginTop="8px",d.style.color="black";var u=document.createElement("input");u.style.fontSize="30px",u.setAttribute("id",a),u.setAttribute("type","radio"),u.setAttribute("value",a),u.setAttribute("name","field");var f=document.createElement("label");return f.style.marginLeft="4px",f.setAttribute("for",a),f.innerHTML=l,d.appendChild(u),d.appendChild(f),d},it.prototype.createButton_=function(a,l){var d=document.createElement("button");d.innerHTML=a;var u=d.style;return u.float="right",u.textTransform="uppercase",u.color="#1094f7",u.fontSize="14px",u.letterSpacing=0,u.border=0,u.background="none",u.marginTop="16px",d.addEventListener("click",l),d};var Bh=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fh(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function Hh(a,l){return l={exports:{}},a(l,l.exports),l.exports}var Nh=Hh(function(a,l){(function(u,f){a.exports=f()})(Bh,function(){return function(d){var u={};function f(g){if(u[g])return u[g].exports;var v=u[g]={i:g,l:!1,exports:{}};return d[g].call(v.exports,v,v.exports,f),v.l=!0,v.exports}return f.m=d,f.c=u,f.d=function(g,v,M){f.o(g,v)||Object.defineProperty(g,v,{configurable:!1,enumerable:!0,get:M})},f.n=function(g){var v=g&&g.__esModule?function(){return g.default}:function(){return g};return f.d(v,"a",v),v},f.o=function(g,v){return Object.prototype.hasOwnProperty.call(g,v)},f.p="",f(f.s=0)}([function(d,u,f){"use strict";var g=function(){function E(R,L){for(var F=0;F<L.length;F++){var X=L[F];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(R,X.key,X)}}return function(R,L,F){return L&&E(R.prototype,L),F&&E(R,F),R}}();function v(E,R){if(!(E instanceof R))throw new TypeError("Cannot call a class as a function")}var M=f(1),T=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,_=function(){function E(){v(this,E),T?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",M),this.noSleepVideo.addEventListener("timeupdate",function(R){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return g(E,[{key:"enable",value:function(){T?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){T?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),E}();d.exports=_},function(d,u,f){"use strict";d.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),Xh=Fh(Nh),zh=1e3,Uh=[0,0,.5,1],jh=[.5,0,.5,1],Gh=window.requestAnimationFrame,Wh=window.cancelAnimationFrame;function qh(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function _c(a){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:a.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:a.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:a.canPresent},maxLayers:{writable:!1,enumerable:!0,value:a.maxLayers},hasOrientation:{enumerable:!0,get:function(){return Ft("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),a.hasOrientation}}})}function de(a){a=a||{};var l="wakelock"in a?a.wakelock:!0;this.isPolyfilled=!0,this.displayId=zh++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return Ft("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new _c({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,l&&W()&&(this.wakelock_=new Xh)}de.prototype.getFrameData=function(a){return fe(a,this._getPose(),this)},de.prototype.getPose=function(){return Ft("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},de.prototype.resetPose=function(){return Ft("VRDisplay.prototype.resetPose"),this._resetPose()},de.prototype.getImmediatePose=function(){return Ft("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},de.prototype.requestAnimationFrame=function(a){return Gh(a)},de.prototype.cancelAnimationFrame=function(a){return Wh(a)},de.prototype.wrapForFullscreen=function(a){if(c())return a;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var l=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",l.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==a)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=a,this.originalParent_=a.parentElement,this.originalParent_||document.body.appendChild(a),!this.fullscreenWrapper_.parentElement){var d=this.fullscreenElement_.parentElement;d.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),d.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var u=this;function f(){if(!!u.fullscreenElement_){var g=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];u.fullscreenElement_.setAttribute("style",g.join("; ")+";")}}return f(),this.fullscreenWrapper_},de.prototype.removeFullscreenWrapper=function(){if(!!this.fullscreenElement_){var a=this.fullscreenElement_;this.fullscreenElementCachedStyle_?a.setAttribute("style",this.fullscreenElementCachedStyle_):a.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var l=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(a),this.originalParent_===l?l.insertBefore(a,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(a),l.removeChild(this.fullscreenWrapper_),a}},de.prototype.requestPresent=function(a){var l=this.isPresenting,d=this;return a instanceof Array||(Ft("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),a=[a]),new Promise(function(u,f){if(!d.capabilities.canPresent){f(new Error("VRDisplay is not capable of presenting."));return}if(a.length==0||a.length>d.capabilities.maxLayers){f(new Error("Invalid number of layers."));return}var g=a[0];if(!g.source){u();return}var v=g.leftBounds||Uh,M=g.rightBounds||jh;if(l){var T=d.layer_;T.source!==g.source&&(T.source=g.source);for(var _=0;_<4;_++)T.leftBounds[_]=v[_],T.rightBounds[_]=M[_];d.wrapForFullscreen(d.layer_.source),d.updatePresent_(),u();return}if(d.layer_={predistorted:g.predistorted,source:g.source,leftBounds:v.slice(0),rightBounds:M.slice(0)},d.waitingForPresent_=!1,d.layer_&&d.layer_.source){var E=d.wrapForFullscreen(d.layer_.source),R=function(){var X=I();d.isPresenting=E===X,d.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(K){console.error("screen.orientation.lock() failed due to",K.message)}),d.waitingForPresent_=!1,d.beginPresent_(),u()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),d.removeFullscreenWrapper(),d.disableWakeLock(),d.endPresent_(),d.removeFullscreenListeners_()),d.fireVRDisplayPresentChange_()},L=function(){!d.waitingForPresent_||(d.removeFullscreenWrapper(),d.removeFullscreenListeners_(),d.disableWakeLock(),d.waitingForPresent_=!1,d.isPresenting=!1,f(new Error("Unable to present.")))};d.addFullscreenListeners_(E,R,L),H(E)?(d.enableWakeLock(),d.waitingForPresent_=!0):(c()||m())&&(d.enableWakeLock(),d.isPresenting=!0,d.beginPresent_(),d.fireVRDisplayPresentChange_(),u())}!d.waitingForPresent_&&!c()&&(N(),f(new Error("Unable to present.")))})},de.prototype.exitPresent=function(){var a=this.isPresenting,l=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(d,u){a?(!N()&&c()&&(l.endPresent_(),l.fireVRDisplayPresentChange_()),m()&&(l.removeFullscreenWrapper(),l.removeFullscreenListeners_(),l.endPresent_(),l.fireVRDisplayPresentChange_()),d()):u(new Error("Was not presenting to VRDisplay."))})},de.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},de.prototype.fireVRDisplayPresentChange_=function(){var a=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(a)},de.prototype.fireVRDisplayConnect_=function(){var a=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(a)},de.prototype.addFullscreenListeners_=function(a,l,d){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=a,this.fullscreenChangeHandler_=l,this.fullscreenErrorHandler_=d,l&&(document.fullscreenEnabled?a.addEventListener("fullscreenchange",l,!1):document.webkitFullscreenEnabled?a.addEventListener("webkitfullscreenchange",l,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",l,!1):document.msFullscreenEnabled&&a.addEventListener("msfullscreenchange",l,!1)),d&&(document.fullscreenEnabled?a.addEventListener("fullscreenerror",d,!1):document.webkitFullscreenEnabled?a.addEventListener("webkitfullscreenerror",d,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",d,!1):document.msFullscreenEnabled&&a.addEventListener("msfullscreenerror",d,!1))},de.prototype.removeFullscreenListeners_=function(){if(!!this.fullscreenEventTarget_){var a=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var l=this.fullscreenChangeHandler_;a.removeEventListener("fullscreenchange",l,!1),a.removeEventListener("webkitfullscreenchange",l,!1),document.removeEventListener("mozfullscreenchange",l,!1),a.removeEventListener("msfullscreenchange",l,!1)}if(this.fullscreenErrorHandler_){var d=this.fullscreenErrorHandler_;a.removeEventListener("fullscreenerror",d,!1),a.removeEventListener("webkitfullscreenerror",d,!1),document.removeEventListener("mozfullscreenerror",d,!1),a.removeEventListener("msfullscreenerror",d,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},de.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},de.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},de.prototype.beginPresent_=function(){},de.prototype.endPresent_=function(){},de.prototype.submitFrame=function(a){},de.prototype.getEyeParameters=function(a){return null};var Qh={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},Ri={LEFT:"left",RIGHT:"right"};function Te(a){var l=ne({},Qh);a=ne(l,a||{}),de.call(this,{wakelock:a.MOBILE_WAKE_LOCK}),this.config=a,this.displayName="Cardboard VRDisplay",this.capabilities=new _c({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new Lh(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new vo(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new we(this.dpdb_.getDeviceParams(),a.ADDITIONAL_VIEWERS),this.viewerSelector_=new it(a.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Bn),c()&&window.addEventListener("resize",this.onResize_.bind(this))}return Te.prototype=Object.create(de.prototype),Te.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},Te.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},Te.prototype._getFieldOfView=function(a){var l;if(a==Ri.LEFT)l=this.deviceInfo_.getFieldOfViewLeftEye();else if(a==Ri.RIGHT)l=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",a),null;return l},Te.prototype._getEyeOffset=function(a){var l;if(a==Ri.LEFT)l=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(a==Ri.RIGHT)l=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",a),null;return l},Te.prototype.getEyeParameters=function(a){var l=this._getEyeOffset(a),d=this._getFieldOfView(a),u={offset:l,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(u,"fieldOfView",{enumerable:!0,get:function(){return Ft("VRFieldOfView","VRFrameData's projection matrices"),d}}),u},Te.prototype.onDeviceParamsUpdated_=function(a){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(a),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},Te.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},Te.prototype.beginPresent_=function(){var a=this.layer_.source.getContext("webgl");a||(a=this.layer_.source.getContext("experimental-webgl")),a||(a=this.layer_.source.getContext("webgl2")),a&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(a.canvas.width=O()*this.bufferScale_,a.canvas.height=V()*this.bufferScale_,this.cardboardUI_=new On(a)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new On(a)),this.distorter_=new mt(a,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(l){this.viewerSelector_.show(this.layer_.source.parentElement),l.stopPropagation(),l.preventDefault()}.bind(this),function(l){this.exitPresent(),l.stopPropagation(),l.preventDefault()}.bind(this)),this.rotateInstructions_&&(S()&&W()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},Te.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},Te.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},Te.prototype.submitFrame=function(a){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var l=this.layer_.source.getContext("webgl");l||(l=this.layer_.source.getContext("experimental-webgl")),l||(l=this.layer_.source.getContext("webgl2"));var d=l.canvas;(d.width!=this.lastWidth||d.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=d.width,this.lastHeight=d.height,this.cardboardUI_.render()}},Te.prototype.onOrientationChange_=function(a){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},Te.prototype.onResize_=function(a){if(this.layer_){var l=this.layer_.source.getContext("webgl");l||(l=this.layer_.source.getContext("experimental-webgl")),l||(l=this.layer_.source.getContext("webgl2"));var d=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];l.canvas.setAttribute("style",d.join("; ")+";"),_e(l.canvas)}},Te.prototype.onViewerChanged_=function(a){this.deviceInfo_.setViewer(a),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},Te.prototype.fireVRDisplayDeviceParamsChange_=function(){var a=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(a)},Te.VRFrameData=qh,Te.VRDisplay=de,Te})});function of(n){return n}function bc(n,t,e){let r=0,o=n.length,i=Math.floor((r+o)/2),s=!1;for(;r<o&&i<n.length;){let p=n[i],c=D(p)?null:e(p);A(c)&&t<c?o=i:(t===c&&(s=!0),r=i+1),i=Math.floor((r+o)/2)}return s||(i+=.5),i}function $a(n,t,e){e=e||of;let r=e(t);return bc(n,r,e)}function br(n,t){return n.splice(t,1)[0]}function ae(n){return n.splice(0)}function Za(n,t){for(let e=0;e<n.length;++e)if(n[e]!==t[e])return e;return-1}function Pi(n,t,e){n.splice(e,0,t)}function st(n,t){let e=n.indexOf(t);return e>-1?(br(n,e),!0):!1}function sf(n,t){for(let e=n.length-1;e>=0;--e)if(t(n[e]))return br(n,e);return null}function Ec(n,t,e){return sf(n,r=>e(r)===t)}function yc(n,...t){n.splice(0,n.length,...t)}function af(n,t,e){let r=n?0:t.length-1,o=n?t.length:-1,i=n?1:-1;for(let s of e)for(let p=r;p!=o;p+=i){let c=t[p];if(s(c))return c}return null}function bt(n,...t){return af(!0,n,t)}function wc(n,t,e,r){let o;return ce(e)?o=e:qe(e)&&(r=e),D(r)&&(r=!0),lf(n,t,o,r)}function lf(n,t,e,r){let o=$a(n,t,e),i=o%1===0;return o=o|0,(!i||r)&&Pi(n,t,o),o}function Tc(n,t){let e=Array.from(n);return Fn(e,t),e}function Fn(n,t){n.sort((e,r)=>{let o=t(e),i=t(r);return o<i?-1:o>i?1:0})}var Io=class{constructor(t){this.value=t;this._forward=new Array;this._reverse=new Array}connectSorted(t,e){A(e)?(wc(this._forward,t,r=>e(r.value)),t._reverse.push(this)):this.connectTo(t)}connectTo(t){this.connectAt(t,this._forward.length)}connectAt(t,e){Pi(this._forward,t,e),t._reverse.push(this)}disconnectFrom(t){st(this._forward,t),st(t._reverse,this)}isConnectedTo(t){return this._forward.indexOf(t)>=0||this._reverse.indexOf(t)>=0}flatten(){let t=new Set,e=[this];for(;e.length>0;){let r=e.shift();A(r)&&!t.has(r)&&(t.add(r),e.push(...r._forward))}return Array.from(t)}get _isEntryPoint(){return this._reverse.length===0}get _isExitPoint(){return this._forward.length===0}get isDisconnected(){return this._isEntryPoint&&this._isExitPoint}get isConnected(){return!this._isExitPoint||!this._isEntryPoint}get isTerminus(){return this._isEntryPoint||this._isExitPoint}get isInternal(){return!this._isEntryPoint&&!this._isExitPoint}};var Ci=class extends Io{connectTo(t){super.connectTo(t)}connectAt(t,e){super.connectAt(t,e)}connectSorted(t,e){super.connectSorted(t,e)}disconnectFrom(t){super.disconnectFrom(t)}isConnectedTo(t){return super.isConnectedTo(t)}flatten(){return super.flatten()}get connections(){return this._forward}get isEntryPoint(){return this._isEntryPoint}get isExitPoint(){return this._isExitPoint}};function Ii(n,t,e){return new Map(n.map(r=>[t(r),e(r)]))}function el(n,t){return Ii(n,t,Hn)}var Nn=class{constructor(t){this.items=new Map;this.defaultItems=new Array;if(A(t))for(let[e,r]of t)this.add(e,r)}add(t,e){if(D(t))this.defaultItems.push(e);else{let r=this.items.get(t);D(r)&&this.items.set(t,r=[]),r.push(e)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let t of this.defaultItems)yield t;for(let t of this.items.values())for(let e of t)yield e}has(t){return A(t)?this.items.has(t):this.defaultItems.length>0}get(t){return D(t)?this.defaultItems:this.items.get(t)||[]}count(t){if(D(t))return this.defaultItems.length;let e=this.get(t);return A(e)?e.length:0}get size(){let t=this.defaultItems.length;for(let e of this.items.values())t+=e.length;return t}delete(t){return D(t)?ae(this.defaultItems).length>0:this.items.delete(t)}remove(t,e){if(D(t))st(this.defaultItems,e);else{let r=this.items.get(t);A(r)&&(st(r,e),r.length===0&&this.items.delete(t))}}clear(){this.items.clear(),ae(this.defaultItems)}};var Et=class{constructor(t){this.items=new Map;if(A(t))for(let[e,r,o]of t)this.add(e,r,o)}add(t,e,r){let o=this.items.get(t);return D(o)&&this.items.set(t,o=new Map),o.set(e,r),this}*entries(){for(let[t,e]of this.items)for(let[r,o]of e)yield[t,r,o]}keys(t){return D(t)?this.items.keys():this.items.get(t).keys()}*values(){for(let t of this.items.values())for(let e of t.values())yield e}has(t,e){return this.items.has(t)&&(D(e)||this.items.get(t).has(e))}get(t,e){return D(e)?this.items.get(t):this.items.has(t)?this.items.get(t).get(e):null}count(t){return this.items.has(t)?this.items.get(t).size:null}get size(){let t=0;for(let e of this.items.values())t+=e.size;return t}delete(t,e){return D(e)?this.items.delete(t):this.items.has(t)?this.items.get(t).delete(e):!1}clear(){this.items.clear()}};var Vo=class{constructor(){this.listeners=new Map;this.listenerOptions=new Map}addEventListener(t,e,r){if(ce(e)){let o=this.listeners.get(t);o||(o=new Array,this.listeners.set(t,o)),o.find(i=>i===e)||(o.push(e),r&&this.listenerOptions.set(e,r))}}removeEventListener(t,e){if(ce(e)){let r=this.listeners.get(t);r&&this.removeListener(r,e)}}clearEventListeners(t){for(let[e,r]of this.listeners)if(D(t)||t===e){for(let o of r)this.removeEventListener(t,o);ae(r),this.listeners.delete(e)}}removeListener(t,e){let r=t.findIndex(o=>o===e);r>=0&&(br(t,r),this.listenerOptions.has(e)&&this.listenerOptions.delete(e))}dispatchEvent(t){let e=this.listeners.get(t.type);if(e)for(let r of e){let o=this.listenerOptions.get(r);A(o)&&!qe(o)&&o.once&&this.removeListener(e,r),r.call(this,t)}return!t.defaultPrevented}},j=class extends Event{get type(){return super.type}constructor(t){super(t)}},q=class extends Vo{constructor(){super(...arguments);this.bubblers=new Set;this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addEventListener(e,r,o){super.addEventListener(e,r,o)}removeEventListener(e,r){super.removeEventListener(e,r)}clearEventListeners(e){return super.clearEventListeners(e)}addScopedEventListener(e,r,o,i){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([r,o]),this.addEventListener(r,o,i)}removeScope(e){let r=this.scopes.get(e);if(r){this.scopes.delete(e);for(let[o,i]of r)this.removeEventListener(o,i)}}dispatchEvent(e){if(!super.dispatchEvent(e))return!1;for(let r of this.bubblers)if(!r.dispatchEvent(e))return!1;return!0}};function Hn(n){return n}function sn(){return!0}function Mc(){return!1}function Sc(n,t){return n&&t}var at=class{constructor(t,e,r=!0){this.onThens=new Array;this.onCatches=new Array;this._result=null;this._error=null;this._started=!1;this._errored=!1;this._finished=!1;ce(t)?this.resolveTest=t:this.resolveTest=sn,ce(e)?this.rejectTest=e:this.rejectTest=sn,qe(t)?this.autoStart=t:qe(e)?this.autoStart=e:A(r)?this.autoStart=r:this.autoStart=!1,this.autoStart&&this.start(),this.resolve=this._resolve.bind(this),this.reject=this._reject.bind(this)}get result(){if(A(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}get errored(){return this._errored}start(){this._started=!0}_resolve(t){if(this.started&&!this.finished&&this.resolveTest(t)){this._result=t;for(let e of this.onThens)e(t);this._finished=!0}}_reject(t){if(this.started&&!this.finished&&this.rejectTest(t)){this._error=t,this._errored=!0;for(let e of this.onCatches)e(t);this._finished=!0}}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((t,e)=>{this.finished?this.errored?e(this.error):t(this.result):(this.onThens.push(t),this.onCatches.push(e))})}then(t,e){return this.project().then(t,e)}catch(t){return this.project().catch(t)}finally(t){return this.project().finally(t)}reset(){this.started&&!this.finished&&this.reject("Resetting previous invocation"),ae(this.onThens),ae(this.onCatches),this._started=this.autoStart,this._errored=!1,this._finished=!1}};function Rc(n,t){return"on"+t in n}function Ce(n,t,e,...r){D(r)&&(r=[]);let o;if(re(e)?r.unshift(e):le(e)&&(o=e),!(n instanceof Vo)){if(!Rc(n,t))throw new yt(`Target does not have a ${t} rejection event`);for(let m of r)if(!Rc(n,m))throw new yt(`Target does not have a ${m} rejection event`)}let i=new at;if(le(o)){let m=setTimeout(i.reject,o,`'${t}' has timed out.`);i.finally(clearTimeout.bind(globalThis,m))}let s=(m,h)=>{n.addEventListener(m,h),i.finally(()=>n.removeEventListener(m,h))},p=m=>i.resolve(m),c=m=>i.reject(m);s(t,p);for(let m of r)s(m,c);return i}function tl(n){return n.then(sn).catch(Mc)}var an=(c=>(c[c.LocalUser=0]="LocalUser",c[c.Mouse=1]="Mouse",c[c.Pen=2]="Pen",c[c.Touch=3]="Touch",c[c.MotionController=4]="MotionController",c[c.MotionControllerLeft=5]="MotionControllerLeft",c[c.MotionControllerRight=6]="MotionControllerRight",c[c.RemoteUser=7]="RemoteUser",c))(an||{});var Pc=class{constructor(t,e,r){this.callback=null;this.promise=new Promise((o,i)=>{this.callback=(...s)=>{t(...s)?o(e(...s)):i(r(...s))}})}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};function Lo(n,t,e){return typeof n===t||n instanceof e}function ce(n){return Lo(n,"function",Function)}function re(n){return Lo(n,"string",String)}function qe(n){return Lo(n,"boolean",Boolean)}function le(n){return Lo(n,"number",Number)}function De(n){return le(n)&&Number.isFinite(n)&&!Number.isNaN(n)}function ln(n){return A(n)&&Lo(n,"object",Object)}function nl(n){return n instanceof Date}function Qe(n){return n instanceof Array}function wt(n,t){throw new Error((t||"Unexpected object: ")+n)}function D(n){return n==null}function A(n){return!D(n)}var yt=class extends Error{constructor(e,r=null){super(e);this.innerError=r}};function Cc(){return"chrome"in globalThis&&!navigator.userAgent.match("CriOS")}function Ic(){return"InstallTrigger"in globalThis}function pf(){return/^mac/i.test(navigator.platform)}function cf(){return/iP(ad|hone|od)/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||pf()&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>2}function Ht(){return/Mobile VR/.test(navigator.userAgent)||/Pico Neo 3 Link/.test(navigator.userAgent)||Nt}function Li(){return"xr"in navigator&&"isSessionSupported"in navigator.xr}function rl(){return"getVRDisplays"in navigator}function ki(){return Li()||rl()}function ko(){return/Android/.test(navigator.userAgent)||/BlackBerry/.test(navigator.userAgent)||/(UC Browser |UCWEB)/.test(navigator.userAgent)||cf()||Ht()}function Er(){return!ko()}var df=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,Vi=navigator.userAgent.match(df),Nt=!!Vi,Vc=Nt&&{major:parseFloat(Vi[1]),minor:parseFloat(Vi[2]),patch:parseFloat(Vi[3])},K_=Nt&&/pacific/i.test(navigator.userAgent),Y_=Nt&&/quest/i.test(navigator.userAgent),J_=Nt&&/quest 2/i.test(navigator.userAgent);var uf="Worker"in globalThis;var mf=298.257223563,hf=6378137;var ol=1/mf,Di=1-ol,$=ol/(2-ol),Z_=hf/(1+$)*(1+$*$/4+$*$*$*$/64),Oi=Math.sqrt(1-Di*Di),lt=1-Di*Di,e0=Oi*Oi/(1-Oi*Oi),t0=1-lt*(.25+lt*(3/64+5*lt/256)),n0=lt*(3/8+lt*(3/32+45*lt/1024)),r0=lt*lt*(15/256+lt*45/1024),o0=lt*lt*lt*(35/3072),i0=[$/2-2*$*$/3+37*$*$*$/96,$*$/48+$*$*$/15,17*$*$*$/480],s0=[2*$-2*$*$/3,7*$*$/3-8*$*$*$/5,56*$*$*$/15];var Bi=1e-6,Oo=typeof Float32Array<"u"?Float32Array:Array,il=Math.random;var l0=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Ke={};tf(Ke,{add:()=>_f,angle:()=>zf,bezier:()=>kf,ceil:()=>bf,clone:()=>xf,copy:()=>vf,create:()=>Lc,cross:()=>If,dist:()=>Yf,distance:()=>Fc,div:()=>Kf,divide:()=>Bc,dot:()=>Xc,equals:()=>Wf,exactEquals:()=>Gf,floor:()=>Ef,forEach:()=>ex,fromValues:()=>gf,hermite:()=>Lf,inverse:()=>Pf,len:()=>$f,length:()=>kc,lerp:()=>Vf,max:()=>wf,min:()=>yf,mul:()=>Qf,multiply:()=>Dc,negate:()=>Rf,normalize:()=>Cf,random:()=>Of,rotateX:()=>Hf,rotateY:()=>Nf,rotateZ:()=>Xf,round:()=>Tf,scale:()=>Mf,scaleAndAdd:()=>Sf,set:()=>Af,sqrDist:()=>Jf,sqrLen:()=>Zf,squaredDistance:()=>Hc,squaredLength:()=>Nc,str:()=>jf,sub:()=>qf,subtract:()=>Oc,transformMat3:()=>Bf,transformMat4:()=>Df,transformQuat:()=>Ff,zero:()=>Uf});function Lc(){var n=new Oo(3);return Oo!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function xf(n){var t=new Oo(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function kc(n){var t=n[0],e=n[1],r=n[2];return Math.hypot(t,e,r)}function gf(n,t,e){var r=new Oo(3);return r[0]=n,r[1]=t,r[2]=e,r}function vf(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function Af(n,t,e,r){return n[0]=t,n[1]=e,n[2]=r,n}function _f(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function Oc(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function Dc(n,t,e){return n[0]=t[0]*e[0],n[1]=t[1]*e[1],n[2]=t[2]*e[2],n}function Bc(n,t,e){return n[0]=t[0]/e[0],n[1]=t[1]/e[1],n[2]=t[2]/e[2],n}function bf(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n}function Ef(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n}function yf(n,t,e){return n[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n[2]=Math.min(t[2],e[2]),n}function wf(n,t,e){return n[0]=Math.max(t[0],e[0]),n[1]=Math.max(t[1],e[1]),n[2]=Math.max(t[2],e[2]),n}function Tf(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n}function Mf(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function Sf(n,t,e,r){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function Fc(n,t){var e=t[0]-n[0],r=t[1]-n[1],o=t[2]-n[2];return Math.hypot(e,r,o)}function Hc(n,t){var e=t[0]-n[0],r=t[1]-n[1],o=t[2]-n[2];return e*e+r*r+o*o}function Nc(n){var t=n[0],e=n[1],r=n[2];return t*t+e*e+r*r}function Rf(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n}function Pf(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n}function Cf(n,t){var e=t[0],r=t[1],o=t[2],i=e*e+r*r+o*o;return i>0&&(i=1/Math.sqrt(i)),n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n}function Xc(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function If(n,t,e){var r=t[0],o=t[1],i=t[2],s=e[0],p=e[1],c=e[2];return n[0]=o*c-i*p,n[1]=i*s-r*c,n[2]=r*p-o*s,n}function Vf(n,t,e,r){var o=t[0],i=t[1],s=t[2];return n[0]=o+r*(e[0]-o),n[1]=i+r*(e[1]-i),n[2]=s+r*(e[2]-s),n}function Lf(n,t,e,r,o,i){var s=i*i,p=s*(2*i-3)+1,c=s*(i-2)+i,m=s*(i-1),h=s*(3-2*i);return n[0]=t[0]*p+e[0]*c+r[0]*m+o[0]*h,n[1]=t[1]*p+e[1]*c+r[1]*m+o[1]*h,n[2]=t[2]*p+e[2]*c+r[2]*m+o[2]*h,n}function kf(n,t,e,r,o,i){var s=1-i,p=s*s,c=i*i,m=p*s,h=3*i*p,x=3*c*s,b=c*i;return n[0]=t[0]*m+e[0]*h+r[0]*x+o[0]*b,n[1]=t[1]*m+e[1]*h+r[1]*x+o[1]*b,n[2]=t[2]*m+e[2]*h+r[2]*x+o[2]*b,n}function Of(n,t){t=t||1;var e=il()*2*Math.PI,r=il()*2-1,o=Math.sqrt(1-r*r)*t;return n[0]=Math.cos(e)*o,n[1]=Math.sin(e)*o,n[2]=r*t,n}function Df(n,t,e){var r=t[0],o=t[1],i=t[2],s=e[3]*r+e[7]*o+e[11]*i+e[15];return s=s||1,n[0]=(e[0]*r+e[4]*o+e[8]*i+e[12])/s,n[1]=(e[1]*r+e[5]*o+e[9]*i+e[13])/s,n[2]=(e[2]*r+e[6]*o+e[10]*i+e[14])/s,n}function Bf(n,t,e){var r=t[0],o=t[1],i=t[2];return n[0]=r*e[0]+o*e[3]+i*e[6],n[1]=r*e[1]+o*e[4]+i*e[7],n[2]=r*e[2]+o*e[5]+i*e[8],n}function Ff(n,t,e){var r=e[0],o=e[1],i=e[2],s=e[3],p=t[0],c=t[1],m=t[2],h=o*m-i*c,x=i*p-r*m,b=r*c-o*p,y=o*b-i*x,C=i*h-r*b,P=r*x-o*h,S=s*2;return h*=S,x*=S,b*=S,y*=2,C*=2,P*=2,n[0]=p+h+y,n[1]=c+x+C,n[2]=m+b+P,n}function Hf(n,t,e,r){var o=[],i=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],i[0]=o[0],i[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),i[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function Nf(n,t,e,r){var o=[],i=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],i[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),i[1]=o[1],i[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function Xf(n,t,e,r){var o=[],i=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],i[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),i[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),i[2]=o[2],n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function zf(n,t){var e=n[0],r=n[1],o=n[2],i=t[0],s=t[1],p=t[2],c=Math.sqrt(e*e+r*r+o*o),m=Math.sqrt(i*i+s*s+p*p),h=c*m,x=h&&Xc(n,t)/h;return Math.acos(Math.min(Math.max(x,-1),1))}function Uf(n){return n[0]=0,n[1]=0,n[2]=0,n}function jf(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function Gf(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]}function Wf(n,t){var e=n[0],r=n[1],o=n[2],i=t[0],s=t[1],p=t[2];return Math.abs(e-i)<=Bi*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(r-s)<=Bi*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-p)<=Bi*Math.max(1,Math.abs(o),Math.abs(p))}var qf=Oc,Qf=Dc,Kf=Bc,Yf=Fc,Jf=Hc,$f=kc,Zf=Nc,ex=function(){var n=Lc();return function(t,e,r,o,i,s){var p,c;for(e||(e=3),r||(r=0),o?c=Math.min(o*e+r,t.length):c=t.length,p=r;p<c;p+=e)n[0]=t[p],n[1]=t[p+1],n[2]=t[p+2],i(n,n,s),t[p]=n[0],t[p+1]=n[1],t[p+2]=n[2];return t}}();var sl=2*Math.PI;function pn(n){return(n%sl+sl)%sl}function Xt(n,t,e){return Math.min(e,Math.max(t,n))}function Xe(n){return n*Math.PI/180}function zc(n,t,e){return(1-e)*n+e*t}function al(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function Fi(n){return n*180/Math.PI}function Uc(n){return Math.abs(n)>1e-4?n:0}var zt=class extends q{constructor(){super(...arguments);this.attached=new Array;this.soFar=null;this.total=null;this.msg=null;this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(e,r,o,i){this.soFar=e,this.total=r,this.msg=o,this.est=i;for(let s of this.attached)s.report(e,r,o,i)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(e){this.report(0,1,e||"starting")}end(e){this.report(1,1,e||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,ae(this.attached)}};var Do=class extends zt{constructor(e,r){super();this.i=e;this.prog=r}report(e,r,o,i){super.report(e,r,o,i),this.prog.update(this.i,e,r,o)}};var yr=class{constructor(t){this.prog=t;this.weightTotal=0;this.subProgressCallbacks=new Array;this.subProgressWeights=new Array;this.subProgressValues=new Array;this.start=performance.now();for(let e=0;e<this.subProgressWeights.length;++e)this.subProgressValues[e]=0,this.subProgressCallbacks[e]=new Do(e,this)}addSubProgress(t){t=t||1,this.weightTotal+=t,this.subProgressWeights.push(t),this.subProgressValues.push(0);let e=new Do(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(e),e}update(t,e,r,o){if(this.prog){this.subProgressValues[t]=e/r;let i=0;for(let m=0;m<this.subProgressWeights.length;++m)i+=this.subProgressValues[m]*this.subProgressWeights[m];let s=performance.now(),p=s-this.start,c=this.start-s+p*this.weightTotal/i;this.prog.report(i,this.weightTotal,o,c)}}};function Bo(n,t){return new ll(t,n).subProgressCallbacks}var ll=class extends yr{constructor(t,e){super(e);for(let r of t)this.addSubProgress(r)}};function jc(n){return new pl(n)}var pl=class extends yr{pop(t){return this.addSubProgress(t)}};async function Gc(n,t){let e=new Array(t.length),r=new Array(t.length);for(let s=0;s<t.length;++s){let p=t[s];e[s]=p[0],r[s]=p[1]}let o=Bo(n,e),i=new Array(t.length);for(let s=0;s<t.length;++s)i[s]=r[s](o[s]);return await Promise.all(i)}function Wc(n,...t){let e=t.map(r=>[1,r]);return Gc(n,e)}function ht(n,t){let e=globalThis,r=e[n];if(D(r)){if(D(t))throw new Error(`No value ${n} found`);r=t(),e[n]=r}return r}var nx="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function ft(n,t){if(n<0)throw new Error("Length must be greater than 0");D(t)&&(t=nx);let e="";for(let r=0;r<n;++r){let o=Math.floor(Math.random()*t.length);e+=t[o]}return e}function Xn(...n){let t=[];for(let e of n)A(e)&&e.length>0&&t.indexOf(e)===-1&&t.push(e);return t.join("-")}var Fo=class{constructor(){this.t=0;this.dt=0;this.sdt=0;this.fps=0}set(t,e){this.t=t,this.dt=e,this.sdt=zc(this.sdt,e,.01),e>0&&(this.fps=1e3/e)}},Hi=class extends Fo{constructor(){super(),Object.seal(this)}};var wr=class{constructor(t){this.timer=null;this.lt=-1;this.tickHandlers=new Array;this._targetFPS=null;this.targetFPS=t;let e=new Hi,r=0;this.onTick=o=>{this.lt>=0&&(r=o-this.lt,e.set(o,r),this.tick(e)),this.lt=o}}get targetFPS(){return this._targetFPS}set targetFPS(t){this._targetFPS=t}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){st(this.tickHandlers,t)}tick(t){for(let e of this.tickHandlers)e(t)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};var Ni=class extends wr{constructor(t){super(t)}start(){let t=()=>{this.timer=setTimeout(t,this.targetFrameTime),this.onTick(performance.now())};this.timer=setTimeout(t,this.targetFrameTime)}stop(){this.isRunning&&(clearTimeout(this.timer),super.stop())}};function cl(n){let t=new Map;for(let[e,r]of n)t.set(r,e);return t}var rx=new Map([[1,"KiB"],[2,"MiB"],[3,"GiB"],[4,"TiB"]]),ox=new Map([[1,"KB"],[2,"MB"],[3,"GB"],[4,"TB"]]),V1=cl(rx),L1=cl(ox);var qc=304.79999999999995,O1=qc*3,ix=10*100,sx=qc*16.5,ax=sx*40,D1=ix*1e3,B1=ax*8,Qc=2.54*4,Kc=Qc*3,F1=Kc*3,lx=Kc*16.5,px=lx*40,H1=100*1e3,N1=px*8,dl=4*3,cx=dl*3,Ho=100/2.54,dx=dl*16.5,ux=dx*40,X1=Ho*1e3,z1=ux*8,U1=3*3,mx=100/Qc,hx=3*16.5,fx=hx*40,j1=mx*1e3,G1=fx*8,ul=Ho/dl,xx=16.5*40,W1=ul*1e3,q1=xx*8,gx=Ho/cx,vx=16.5/3,Ax=vx*40,Q1=gx*1e3,K1=Ax*8,Yc=16.5/ul,Jc=Yc*40,Y1=Jc*8,J1=1e3/Yc,$1=40*8,_x=1e3/Jc,Z1=8/_x;function $c(n){return n/ul}function Zc(n){return n/Ho}function ed(n){return n*Ho}function ml(n){return A(n)&&n.length>0?parseFloat(n):null}var Xi=class{constructor(t,e){this._url=null;this._base=void 0;this._protocol=null;this._host=null;this._hostName=null;this._userName=null;this._password=null;this._port=null;this._pathName=null;this._hash=null;this._query=new Map;t!==void 0&&(this._url=new URL(t,e),this.rehydrate())}rehydrate(){A(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),A(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),A(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),A(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),A(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),A(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),A(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),A(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[t,e]of this._query)this._url.searchParams.set(t,e);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=ml(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((t,e)=>this._query.set(e,t))}refresh(){if(this._url===null){if(A(this._protocol)&&(A(this._host)||A(this._hostName))){if(A(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=ml(this._url.port),this.rehydrate(),!1;if(A(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(A(this._pathName)&&A(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return A(this._url)}base(t){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=t,this.refresh(),this}protocol(t){return this._protocol=t,this.refresh()&&(this._url.protocol=t),this}host(t){return this._host=t,this.refresh()&&(this._url.host=t,this._hostName=this._url.hostname,this._port=ml(this._url.port)),this}hostName(t){return this._hostName=t,this.refresh()&&(this._url.hostname=t,this._host=`${this._url.hostname}:${this._url.port}`),this}port(t){return this._port=t,this.refresh()&&(this._url.port=t.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(t){return this._userName=t,this.refresh()&&(this._url.username=t),this}password(t){return this._password=t,this.refresh()&&(this._url.password=t),this}path(t){return this._pathName=t,this.refresh()&&(this._url.pathname=t),this}pathPop(t){return t=t||/\/[^\/]+\/?$/,this.path(this._pathName.replace(t,""))}pathPush(t){let e=this._pathName;return e.endsWith("/")||(e+="/"),e+=t,this.path(e)}query(t,e){return this._query.set(t,e),this.refresh()&&this._url.searchParams.set(t,e),this}hash(t){return this._hash=t,this.refresh()&&(this._url.hash=t),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};function hl(n,...t){if(!ln(n))return!1;n=n;for(let e of t){if(!(e in n))return!1;let r=n[e];if(!ce(r))return!1}return!0}function Tr(n){return hl(n,"dispose")}function bx(n){return hl(n,"destroy")}function Ex(n){return hl(n,"close")}function fl(n){Tr(n)&&n.dispose(),Ex(n)&&n.close(),bx(n)&&n.destroy()}var me=class{constructor(t,e,r,...o){this.key=t;this.value=e;this.bySetAttribute=r;this.tags=o.map(i=>i.toLocaleUpperCase()),Object.freeze(this)}applyToElement(t){let e=this.key.startsWith("data-");if(!(this.tags.length===0||this.tags.indexOf(t.tagName)>-1||e))console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`);else if(e){let o=this.key.substring(5);t.dataset[o]=this.value}else this.key==="style"?Object.assign(t.style,this.value):this.key==="classList"?this.value.forEach(o=>t.classList.add(o)):this.bySetAttribute?t.setAttribute(this.key,this.value):this.key in t?t[this.key]=this.value:this.value===!1?t.removeAttribute(this.key):this.value===!0?t.setAttribute(this.key,""):t.setAttribute(this.key,this.value)}};function cn(n){return new me("autoplay",n,!1,"audio","video")}function be(n){return new me("className",n,!1)}function Mr(...n){return new me("classList",n,!1)}function zn(n){return new me("controls",n,!1,"audio","video")}function td(n,t){return new me("data-"+n,t,!1)}function nd(n){return new me("height",n,!1,"canvas","embed","iframe","img","input","object","video")}function zi(n){return new me("id",n,!1)}function Sr(n){return new me("loop",n,!1,"audio","bgsound","marquee","video")}function xl(n){return new me("max",n,!1,"input","meter","progress")}function gl(n){return new me("min",n,!1,"input","meter")}function rd(n){return new me("muted",n,!1,"audio","video")}function dn(n){return new me("playsInline",n,!1,"audio","video")}function yx(n){return n instanceof URL&&(n=n.href),n}function No(n){return new me("src",yx(n),!1,"audio","embed","iframe","img","input","script","source","track","video")}function vl(n){return new me("srcObject",n,!1,"audio","video")}function Al(n){return new me("step",n,!1,"input")}function Rr(n){return new me("title",n,!1)}function Pr(n){return re(n)||(n=n.value),new me("type",n,!1,"button","input","command","embed","link","object","script","source","style","menu")}function Cr(n){return new me("value",n,!1,"button","data","input","li","meter","option","progress","param")}function od(n){return new me("width",n,!1,"canvas","embed","iframe","img","input","object","video")}var Q=class{constructor(t,e){this.key=t;this.value=e;this.name=t.replace(/[A-Z]/g,r=>`-${r.toLocaleLowerCase()}`)}applyToElement(t){t.style[this.key]=this.value}},_l=class{constructor(...t){this.rest=t}applyToElement(t){for(let e of this.rest)e.applyToElement(t)}};function pt(...n){return new _l(...n)}function Xo(n){return new Q("backgroundColor",n)}function id(n){return new Q("border",n)}function sd(n){return new Q("borderRadius",n)}function ad(n){return new Q("boxShadow",n)}function ld(n){return new Q("columnGap",n)}function ze(n){return new Q("display",n)}function pd(n){return new Q("flexFlow",n)}function cd(n){return new Q("float",n)}function Ui(n){return new Q("fontSize",n)}function ji(n,t,e,r){return re(n)||(n=[n,t,e,r].filter(A).join("/")),new Q("gridArea",n)}function Gi(n){return new Q("gridAutoFlow",n)}function Un(n,t){return re(n)||(n=[n,t].filter(A).join("/")),new Q("gridColumn",n)}function Wi(n,t){return re(n)||(n=[n,t].filter(A).join("/")),new Q("gridRow",n)}function un(n){return new Q("gridTemplateColumns",n)}function qi(n){return new Q("gridTemplateRows",n)}function Ut(n){return new Q("height",n)}function jn(n){return new Q("left",n)}function mn(n){return new Q("margin",n)}function dd(n){return new Q("marginInlineStart",n)}function ud(n){return new Q("marginLeft",n)}function md(n){return new Q("maxHeight",n)}function zo(n){return new Q("maxWidth",n)}function hd(n){return new Q("minWidth",n)}function fd(n){return new Q("overflow",n)}function hn(...n){return new Q("padding",n.join(" "))}function xd(n){return new Q("paddingRight",n)}function El(n){return new Q("pointerEvents",n)}function Ir(n){return new Q("position",n)}function Gn(n){return new Q("textAlign",n)}function Wn(n){return new Q("top",n)}function gd(n){return new Q("touchAction",n)}function vd(n){return new Q("transform",n)}function xt(n){return new Q("width",n)}function Qi(n){return new Q("zIndex",le(n)?n.toFixed(0):n)}function Ad(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}var bl=class{constructor(t,e){this.selector=t;this.props=e}apply(t){let e=this.props.map(r=>`${r.name}: ${r.value};`).join("");t.insertRule(`${this.selector} {${e}}`,t.cssRules.length)}};function J(n,...t){return new bl(n,t)}var Ki=["change","click","contextmenu","dblclick","mouseup","pointerup","reset","submit","touchend"];function _d(n,t){let e=t||sn,r=async o=>{if(o.isTrusted&&await e()){for(let i of Ki)window.removeEventListener(i,r);await n()}};for(let o of Ki)window.addEventListener(o,r)}function bd(n,t){let e=t||sn;return new Promise(r=>{let o=async i=>{if(i.isTrusted&&await e()){for(let s of Ki)window.removeEventListener(s,o);r(await n())}};for(let i of Ki)window.addEventListener(i,o)})}function Uo(n){return ln(n)?n.element instanceof Node:!1}function yl(n){return ln(n)&&"elements"in n&&n.elements instanceof Array}function jt(n){return Uo(n)?n.element:n}function wx(n){return ln(n)&&"applyToElement"in n&&ce(n.applyToElement)}function Se(n,t,e="block"){n=jt(n),n.style.display=t?e:"none"}function Tt(n){return n=jt(n),n.style.display!=="none"}function ue(n,...t){n=jt(n);for(let e of t)A(e)&&(e instanceof Node?n.append(e):Uo(e)?n.append(jt(e)):yl(e)?n.append(...e.elements.map(jt)):wx(e)?e.applyToElement(n):n.append(document.createTextNode(e.toLocaleString())));return n}function Be(n,...t){let e=null;for(let r of t)if(r instanceof me&&r.key==="id"){e=document.getElementById(r.value);break}return e==null&&(e=document.createElement(n)),ue(e,...t),e}function yd(n){return"disabled"in n&&qe(n.disabled)}function jo(n){for(n=jt(n);n.lastChild;)n.lastChild.remove()}function Go(n,t){n=jt(n),jo(n),n.append(Rx(t))}function Tx(n,t){n=jt(n),n.title=t}function Ed(n,t,e){let r=A(e),o=r&&n.classList.contains(e);r&&o!==t&&(t?n.classList.add(e):n.classList.remove(e))}var Mx=["danger","dark","info","light","primary","secondary","success","warning"];function qn(n,t,e,r,o){if(n=jt(n),re(e))for(let i of Mx)Ed(n,t&&i===e,`btn-${i}`),Ed(n,!t&&i===e,`btn-outline-${i}`);n.disabled=!t,r&&Go(n,r),o&&Tx(n,o)}async function wd(n,t,e){A(e)&&e.start();let r=n==="canplay"?t.HAVE_CURRENT_DATA:t.HAVE_ENOUGH_DATA;if(t.readyState>=r)return!0;try{return await Ce(t,n,"error"),!0}catch(o){return console.warn(t.error,o),!1}finally{A(e)&&e.end()}}function Yi(n,t){return wd("canplay",n,t)}function Ji(n,t){return wd("canplaythrough",n,t)}function Qn(...n){return Be("audio",...n)}function Sx(...n){return Be("button",...n)}function Td(...n){return Sx(...n,Pr("button"))}function Vr(...n){return Td(...n,Mr("btn","btn-primary"))}function $i(...n){return Td(...n,Mr("btn","btn-secondary"))}function Md(...n){return Be("canvas",...n)}function Sd(...n){return Be("dd",...n)}function ve(...n){return Be("div",...n)}function Rd(...n){return Be("dl",...n)}function Pd(...n){return Be("dt",...n)}function Cd(...n){return Be("h1",...n)}function Id(...n){return Be("h2",...n)}function Lr(...n){return Be("img",...n)}function wl(...n){return Be("input",...n)}function Vd(...n){return Be("label",...n)}function Ld(...n){return Be("meter",...n)}function Zi(...n){return Be("option",...n)}function Tl(...n){return Be("select",...n)}function kd(...n){return Be("video",...n)}function Od(...n){return wl(Pr("checkbox"),...n)}function Dd(...n){return wl(Pr("number"),...n)}function Bd(...n){return wl(Pr("range"),...n)}function Rx(n){return document.createTextNode(n)}function Mt(...n){let t=document.createElement("style");document.head.append(t);for(let e of n)e.apply(t.sheet);return t}function es(n,t,e,...r){return Qn(dn(!0),zn(!1),rd(t),cn(n),Sr(e),pt(ze("none")),...r)}var Px="AudioContext"in globalThis,Fd=Px&&"AudioListener"in globalThis,Hd=Fd&&"setPosition"in AudioListener.prototype,Wo=Fd&&"positionX"in AudioListener.prototype,UE=ce(HTMLMediaElement.prototype.captureStream)||ce(HTMLMediaElement.prototype.mozCaptureStream);function Nd(n){return A(n)&&n.node instanceof AudioNode}function Xd(n){return A(n)&&n.input instanceof AudioNode&&n.output instanceof AudioNode}var fn=ht("Juniper:Audio:connections",()=>new Map),Ml=ht("Juniper:Audio:names",()=>new Map);function zd(n){return Xd(n)?n.output:Nd(n)?n.node:n}function Ud(n){if(D(n))return;let t=null;Qe(n)?n.length===2?t=n[1]:t=n[2]:t=n;let e=null;return Xd(t)?e=t.input:Nd(t)?e=t.node:e=t,e}function jd(n){return Qe(n)?n.length===2?[n[0]]:[n[0],n[1]]:[]}function Cx(n){return A(n)&&A(n.context)}function Gd(n,t){Ml.set(t,n)}function ee(n){Ml.delete(n),Cx(n)&&St(n)}function Wd(...n){for(let t=1;t<n.length;++t)gt(n[t-1],n[t])}function gt(n,t){let e=zd(n),r=Ud(t),o=jd(t);if(D(r))throw new Error("Must have a target to connect to");r instanceof AudioParam?e.connect(r,o[0]):r instanceof AudioNode?e.connect(r,o[0],o[1]):wt(r),fn.has(e)||fn.set(e,new Set);let i=fn.get(e);return i.has(r)?!1:(i.add(r),!0)}function St(n,t){let e=zd(n),r=Ud(t),o=jd(t);if(D(r)?e.disconnect():r instanceof AudioParam?e.disconnect(r,o[0]):r instanceof AudioNode?e.disconnect(r,o[0],o[1]):wt(r),!fn.has(e))return!1;let i=fn.get(e),s=!1;return D(r)?(s=i.size>0,i.clear()):i.has(r)&&(s=!0,i.delete(r)),i.size===0&&fn.delete(e),s}function Ix(){let n=new Map;function t(e){n.has(e)||n.set(e,new Ci(e))}for(let e of Ml.keys())t(e);for(let[e,r]of fn){t(e);for(let o of r)t(o)}for(let[e,r]of fn){let o=n.get(e);for(let i of r)n.has(i)&&o.connectTo(n.get(i))}return Array.from(n.values())}globalThis.getAudioGraph=Ix;async function Rt(n){if(Gd("speakers",n.destination),n.state!=="running")if(n.state==="closed")await n.resume();else if(n.state==="suspended"){let t=Ce(n,"statechange");_d(()=>n.resume()),await t}else wt(n.state)}function Gt(n,t,...e){Gd(n,t);for(let r of e)A(r)&&gt(t,r);return t}function qd(n,t,e,...r){return Gt(n,new AnalyserNode(t,e),...r)}function kr(n,t,e,...r){return Gt(n,new BiquadFilterNode(t,e),...r)}function Qd(n,t,e,...r){return Gt(n,new DelayNode(t,e),...r)}function Kd(n,t,e,...r){return Gt(n,new DynamicsCompressorNode(t,e),...r)}function Ve(n,t,e,...r){return Gt(n,new GainNode(t,e),...r)}function Kn(n,t,e,...r){return Gt(n,t.createMediaElementSource(e),...r)}function Sl(n,t,e,...r){return Gt(n,new MediaStreamAudioDestinationNode(t,e),...r)}function Yd(n,t,e,...r){return Gt(n,t.createMediaStreamSource(e),...r)}function Jd(n,t,e,...r){return Gt(n,new PannerNode(t,e),...r)}var ts=class{constructor(){this.t=0;this.p=Ke.create();this.f=Ke.set(Ke.create(),0,0,-1);this.u=Ke.set(Ke.create(),0,1,0);Object.seal(this)}set(t,e,r,o,i,s,p,c,m){this.setPosition(t,e,r),this.setOrientation(o,i,s,p,c,m)}setPosition(t,e,r){Ke.set(this.p,t,e,r)}setOrientation(t,e,r,o,i,s){Ke.set(this.f,t,e,r),Ke.set(this.u,o,i,s)}copy(t){Ke.copy(this.p,t.p),Ke.copy(this.f,t.f),Ke.copy(this.u,t.u)}};var Or=class extends q{constructor(e,r,o){super();this.id=e;this.audioCtx=r;this.spatializer=o;this.pose=new ts;this.disposed=!1;this.volumeControl=Ve(`volume-control-${this.id}`,r)}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){ee(this.volumeControl),Tr(this.spatializer)&&this.spatializer.dispose()}audioTick(e){this.spatializer.setPose(this.pose,e)}};var Dr=class{constructor(t){this.id=t;this.minDistance=1;this.maxDistance=10;this.algorithm="inverse"}setAudioProperties(t,e,r){this.minDistance=t,this.maxDistance=e,this.algorithm=r}};var Br=class extends Dr{constructor(){super(...arguments);this.disposed=!1}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){ee(this.input)}};var Rl=ht("Juniper:Audio:Destinations:Spatializers:NoSpatializationNode:nodes",()=>new WeakMap),Fe=class extends Br{static instance(t){if(!Rl.has(t)){let e=`no-spatialization-hook-${ft(8)}`;Rl.set(t,new Fe(e,t))}return Rl.get(t)}constructor(t,e){super(t),this.input=this.output=Ve(this.id,e),Object.seal(this)}setPose(t,e){}};var ns=class extends Or{constructor(e,r,o){super("final",e,o);this._trueDestination=r;this._remoteUserInput=Ve("remote-user-input",this.audioCtx,null,this._spatializedInput=Ve("spatialized-input",this.audioCtx,null,this.volumeControl)),this._nonSpatializedInput=Ve("non-spatialized-input",this.audioCtx,null,this.volumeControl),gt(this.volumeControl,this._trueDestination),gt(Fe.instance(this.audioCtx),this.nonSpatializedInput)}onDisposing(){ee(this._remoteUserInput),ee(this._spatializedInput),ee(this._nonSpatializedInput),super.onDisposing()}get remoteUserInput(){return this._remoteUserInput}get spatializedInput(){return this._spatializedInput}get nonSpatializedInput(){return this._nonSpatializedInput}get trueDestination(){return this._trueDestination}};var Fr=class extends Dr{constructor(e){super("listener");this.audioCtx=e}get listener(){return this.audioCtx.listener}};var rs=class extends Fr{constructor(t){if(super(t),!Wo)throw new Error("Latest WebAudio Listener API is not supported");Object.seal(this)}setPose(t,e){let{p:r,f:o,u:i}=t;this.listener.positionX.setValueAtTime(r[0],e),this.listener.positionY.setValueAtTime(r[1],e),this.listener.positionZ.setValueAtTime(r[2],e),this.listener.forwardX.setValueAtTime(o[0],e),this.listener.forwardY.setValueAtTime(o[1],e),this.listener.forwardZ.setValueAtTime(o[2],e),this.listener.upX.setValueAtTime(i[0],e),this.listener.upY.setValueAtTime(i[1],e),this.listener.upZ.setValueAtTime(i[2],e)}};var os=class extends Fr{constructor(t){if(super(t),!Hd)throw new Error("WebAudio Listener API is not supported");Object.seal(this)}setPose(t,e){let{p:r,f:o,u:i}=t;this.listener.setPosition(r[0],r[1],r[2]),this.listener.setOrientation(o[0],o[1],o[2],i[0],i[1],i[2])}};function*Vx(n,t,e=-1){let r=0;for(;e<0||r<e;){yield n,++r;let o=n+t;n=t,t=o}}function $d(n,t,e){return new Cl(n,t,3,e)}var Pl=class{constructor(t,e,r,o,i){this.input=Ve(`${t}-input`,e,{gain:r},this.output=Qd(`${t}-delay`,e,{maxDelayTime:o,delayTime:o},i))}dispose(){ee(this.input),ee(this.output)}},Cl=class{constructor(t,e,r,o){this.output=Ve(`${t}-output`,e,null,o);let i=Array.from(Vx(1,2,r));this.layers=i.map(s=>new Pl(`${t}-echo-layer-${s}`,e,.5/s,s,this.output)),this.input=Ve(`${t}-input`,e,null,...this.layers)}dispose(){ee(this.input);for(let t of this.layers)t.dispose();ee(this.output),ae(this.layers)}};function Zd(n,t,e){return new Il(n,t,e)}var Il=class{constructor(t,e,r){this.node=kr(`${t}-biquad-filter`,e,{type:"bandpass",frequency:2500,Q:4.5},r)}dispose(){ee(this.node)}};function eu(n,t,e){return new Vl(n,t,e)}var Vl=class{constructor(t,e,r){this.node=kr(`${t}-biquad-filter`,e,{type:"bandpass",frequency:400,Q:4.5},r)}dispose(){ee(this.node)}};var tu=new Map([["Radio",Zd],["Wall",eu],["Echo",$d]]);var Ll=class extends j{constructor(e){super("sourceadded");this.source=e}},Pt=class extends Or{constructor(e,r,o,...i){super(e,r,o);this.source=null;this.effects=new Array;this._connected=!1;this.setEffects(...i)}onDisposing(){for(let e of this.effects)Tr(e)&&e.dispose();ae(this.effects),super.onDisposing()}setEffects(...e){St(this.volumeControl);for(let r of this.effects)Tr(r)&&r.dispose();ae(this.effects);for(let r of e)if(A(r)){let o=tu.get(r);A(o)&&this.effects.push(o(`${r}-${this.id}`,this.audioCtx))}Wd(this.volumeControl,...this.effects,this.spatializer)}get spatialized(){return!(this.spatializer instanceof Fe)}get input(){return this.source}get connected(){return this._connected}connect(){this.connected||gt(this.source,this.volumeControl)}disconnect(){this.connected&&St(this.source,this.volumeControl)}set input(e){e!==this.input&&(this.source&&ee(this.source),e&&(this.source=e,this.connect(),this.dispatchEvent(new Ll(this.source))))}get output(){return this.volumeControl}};var Ct=class extends j{constructor(e,r){super(e);this.source=r}},xn=class extends Ct{constructor(t){super("loaded",t)}},is=class extends Ct{constructor(e,r){super("errored",e);this.error=r}},gn=class extends Ct{constructor(t){super("played",t)}},vn=class extends Ct{constructor(t){super("paused",t)}},An=class extends Ct{constructor(t){super("stopped",t)}},_n=class extends Ct{constructor(e){super("progress",e);this.value=0;this.total=0}};var ss=new WeakMap,as=new WeakMap;function nu(n,t){let e=(as.get(n)||0)+t;as.set(n,e);let r=n.mediaElement,o=(ss.get(r)||0)+t;return ss.set(r,o),o}function Lx(n){nu(n,1)}function kx(n){nu(n,-1),as.get(n)===0&&(as.delete(n),ee(n)),ss.get(n.mediaElement)===0&&(ss.delete(n.mediaElement),n.mediaElement.isConnected&&n.mediaElement.remove())}var ls=class extends Pt{constructor(e,r,o,i,s,...p){super(e,r,s,...p);this.randomize=i;Lx(this.input=o),this.audio=o.mediaElement,this.disconnect(),this.loadEvt=new xn(this),this.playEvt=new gn(this),this.pauseEvt=new vn(this),this.stopEvt=new An(this),this.progEvt=new _n(this);let c=m=>{this.disconnect(),this.audio.currentTime===0||m.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};this.audio.addEventListener("ended",c),this.audio.addEventListener("pause",c),this.audio.addEventListener("play",()=>{if(this.connect(),this.randomize&&this.audio.loop&&this.audio.duration>1){let m=this.audio.duration*Math.random();this.audio.currentTime=m}this.dispatchEvent(this.playEvt)}),this.audio.addEventListener("timeupdate",()=>{this.progEvt.value=this.audio.currentTime,this.progEvt.total=this.audio.duration,this.dispatchEvent(this.progEvt)}),Yi(this.audio).then(m=>this.dispatchEvent(m?this.loadEvt:new is(this,this.audio.error)))}get playbackState(){return this.audio.error?"errored":this.audio.ended||this.audio.paused&&this.audio.currentTime===0?"stopped":this.audio.paused?"paused":"playing"}async play(){await Rt(this.audioCtx),await this.audio.play()}async playThrough(){let e=Ce(this,"stopped");await this.play(),await e}pause(){this.audio.pause()}stop(){this.audio.currentTime=0,this.pause()}restart(){return this.stop(),this.play()}onDisposing(){this.disconnect(),kx(this.input),super.onDisposing()}};var ps=class extends Pt{constructor(t,e,r,...o){super(t,e,r,...o)}};var Hr=class extends Br{constructor(e,r){super(e);this.lpx=0;this.lpy=0;this.lpz=0;this.lox=0;this.loy=0;this.loz=0;this.input=this.output=this.panner=Jd(this.id,r,{panningModel:"HRTF",distanceModel:"inverse",coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:0})}setAudioProperties(e,r,o){super.setAudioProperties(e,r,o),this.panner.refDistance=this.minDistance,this.panner.distanceModel=o,this.maxDistance<=0?this.panner.rolloffFactor=1/0:this.panner.rolloffFactor=1/this.maxDistance}setPose(e,r){let{p:o,f:i}=e,[s,p,c]=o,[m,h,x]=i;(s!==this.lpx||p!==this.lpy||c!==this.lpz)&&(this.lpx=s,this.lpy=p,this.lpz=c,this.setPosition(s,p,c,r)),(m!==this.lox||h!==this.loy||x!==this.loz)&&(this.lox=m,this.loy=h,this.loz=x,this.setOrientation(m,h,x,r))}};var cs=class extends Hr{constructor(t,e){super(t,e),Object.seal(this)}setPosition(t,e,r,o){De(t)&&De(e)&&De(r)&&De(o)&&(this.panner.positionX.setValueAtTime(t,o),this.panner.positionY.setValueAtTime(e,o),this.panner.positionZ.setValueAtTime(r,o))}setOrientation(t,e,r,o){De(t)&&De(e)&&De(r)&&De(o)&&(this.panner.orientationX.setValueAtTime(-t,o),this.panner.orientationY.setValueAtTime(-e,o),this.panner.orientationZ.setValueAtTime(-r,o))}};var ds=class extends Hr{constructor(t,e){super(t,e),Object.seal(this)}setPosition(t,e,r,o){this.panner.setPosition(t,e,r)}setOrientation(t,e,r,o){this.panner.setOrientation(t,e,r)}};function ru(n){let t=[];for(let e=0;e<n.length;++e){let r=n[e],o=!1;for(let i=0;i<t.length&&!o;++i){let s=t[i];o=r.kind===s.kind&&s.label.indexOf(r.label)>0}o||t.push(r)}return t}var It=ce(HTMLAudioElement.prototype.setSinkId),kl=class extends j{constructor(e){super("audiooutputchanged");this.device=e}},ou="calla:preferredAudioOutputID",us=class extends q{constructor(e){super();this.element=e;this._hasAudioPermission=!1;this.ready=this.start(),Object.seal(this)}get hasAudioPermission(){return this._hasAudioPermission}async start(){if(It){let e=await navigator.mediaDevices.enumerateDevices(),r=bt(e,o=>o.kind==="audiooutput"&&o.label.length>0);if(A(r)){this._hasAudioPermission=!0;let o=await this.getPreferredAudioOutput();o&&await this.setAudioOutputDevice(o)}}}get preferredAudioOutputID(){return It?localStorage.getItem(ou):null}async getAudioOutputDevices(e=!1){return It?await this.getAvailableDevices(e)||[]:[]}async getAudioOutputDevice(){if(!It)return null;let e=this.element&&this.element.sinkId;if(D(e))return null;let r=await this.getAudioOutputDevices();return bt(r,i=>i.deviceId===e)}async getPreferredAudioOutput(){if(!It)return null;let e=await this.getAudioOutputDevices();return bt(e,o=>o.deviceId===this.preferredAudioOutputID,o=>o.deviceId==="default",o=>o.deviceId.length>0)}async setAudioOutputDevice(e){if(It){if(A(e)&&e.kind!=="audiooutput")throw new Error(`Device is not an audio output device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(ou,e&&e.deviceId||null);let r=this.element,o=r&&r.sinkId;this.preferredAudioOutputID!==o&&(A(this.preferredAudioOutputID)&&await this.element.setSinkId(this.preferredAudioOutputID),this.dispatchEvent(new kl(e)))}}async getAvailableDevices(e=!1){let r=null,o=null;for(let i=0;i<3;++i){r=await navigator.mediaDevices.enumerateDevices();for(let s of r)s.deviceId.length>0&&(this.hasAudioPermission||(this._hasAudioPermission=s.kind==="audioinput"&&s.label.length>0));if(this.hasAudioPermission)break;try{o=await this.startStream()}catch(s){console.warn(s)}}if(o)for(let i of o.getTracks())i.stop();return r=Tc(r||[],i=>i.label),e&&(r=ru(r)),It?r.filter(i=>i.kind==="audiooutput"):[]}startStream(){return navigator.mediaDevices.getUserMedia({audio:!0})}};!("AudioContext"in globalThis)&&"webkitAudioContext"in globalThis&&(globalThis.AudioContext=globalThis.webkitAudioContext);!("OfflineAudioContext"in globalThis)&&"webkitOfflineAudioContext"in globalThis&&(globalThis.OfflineAudioContext=globalThis.webkitOfflineAudioContext);var iu="juniper::useHeadphones",Ox=new j("useheadphonestoggled"),Dx="createMediaStreamSource"in AudioContext.prototype,su=!Dx,ms=class extends q{constructor(e){super();this.users=new Map;this.clips=new Map;this.clipPaths=new Map;this.pathSources=new Map;this.pathCounts=new Map;this._minDistance=1;this._maxDistance=10;this._useHeadphones=!1;this._algorithm="inverse";this.element=null;this.audioDestination=null;this.localUserID=null;this.counter=0;this.audioCtx=new AudioContext;let r=Sl("final-destination",this.audioCtx);this.element=Qn(zi("Audio-Device-Manager"),dn(!0),cn(!0),vl(r.stream),pt(ze("none"))),ue(document.body,this),this.speakers=new us(this.element),this.input=Ve("local-mic-user-gain",this.audioCtx,null,this.localAutoControlledGain=Ve("local-mic-auto-gain",this.audioCtx,null,this.localFilter=kr("local-mic-filter",this.audioCtx,{type:"bandpass",frequency:1500,Q:.25},this.localCompressor=Kd("local-mic-compressor",this.audioCtx,{threshold:-15,knee:40,ratio:17},this.output=Sl("local-mic-destination",this.audioCtx))))),this.audioDestination=new ns(this.audioCtx,r,Wo?new rs(this.audioCtx):new os(this.audioCtx)),Fe.instance(this.audioCtx).setAudioProperties(this._minDistance,this._maxDistance,this.algorithm),this.setLocalUserID(e);let o=localStorage.getItem(iu);A(o)?this._useHeadphones=o==="true":this._useHeadphones=Ht(),this.ready=this.start(),Object.seal(this)}get algorithm(){return this._algorithm}get useHeadphones(){return this._useHeadphones}set useHeadphones(e){e!==this.useHeadphones&&(this._useHeadphones=e,localStorage.setItem(iu,this.useHeadphones.toString()),this.dispatchEvent(Ox))}dispose(){for(let e of this.users.keys())this.removeUser(e);for(let e of this.clips.keys())this.removeClip(e);St(this.input),St(this.localAutoControlledGain),St(this.localFilter),St(this.localCompressor),St(this.output),this.audioDestination.dispose(),this.audioCtx.suspend()}async start(){await Promise.all([Rt(this.audioCtx),bd(()=>this.element.play()),this.speakers.ready])}get filter(){return this.localFilter}get filterFrequency(){return this.localFilter.frequency.value}set filterFrequency(e){this.localFilter.frequency.value=e}get compressor(){return this.localCompressor}get currentTime(){return this.audioCtx.currentTime}update(){let e=this.currentTime;this.audioDestination.audioTick(e);for(let r of this.clips.values())r.audioTick(e);for(let r of this.users.values())r.audioTick(e)}newSpatializer(e,r,o){if(r){let i=o?this.audioDestination.remoteUserInput:this.audioDestination.spatializedInput,s=`spatializer-${++this.counter}-${e}`,p=Wo?new cs(s+"-new-wa",this.audioCtx):new ds(e+"-old-wa",this.audioCtx);return gt(p,i),p}else return Fe.instance(this.audioCtx)}createSpatializer(e,r,o){let i=this.newSpatializer(e,r,o);return i.setAudioProperties(this._minDistance,this._maxDistance,this._algorithm),i}createUser(e,r){if(!this.users.has(e)){let o=Xn(r,e),i=this.createSpatializer(o,!0,!0),s=new ps(o,this.audioCtx,i);this.users.set(e,s)}return this.users.get(e)}setLocalUserID(e){return this.audioDestination&&(this.localUserID=e),this.audioDestination}loadBasicClip(e,r,o,i){return this.loadClip(e,r,!1,!1,!1,!1,o,[],i)}createBasicClip(e,r,o){return this.createClip(e,r,!1,!1,!1,o,[])}async loadClip(e,r,o,i,s,p,c,m,h){if(D(r)||re(r)&&r.length===0)throw new Error("No clip source path provided");A(h)&&h.start(r);let x=await this.getSourceTask(e,r,r,o,i,h),b=this.makeClip(x,e,r,s,p,i,c,...m);return this.clips.set(e,b),A(h)&&h.end(r),b}createClip(e,r,o,i,s,p,c){if(D(r)||re(r)&&r.length===0)throw new Error("No clip source path provided");let m=r.currentSrc,h=this.createSourceFromElement(e,r),x=this.makeClip(h,e,m,i,s,o,p,...c);return this.clips.set(e,x),x}getSourceTask(e,r,o,i,s,p){this.clipPaths.set(e,r);let c=this.pathSources.get(r);return A(c)?this.pathCounts.set(r,this.pathCounts.get(r)+1):(c=this.createSourceFromFile(e,o,i,s,p),this.pathSources.set(r,c),this.pathCounts.set(r,1)),c}async createSourceFromFile(e,r,o,i,s){A(s)&&s.start(e);let p=es(i,!1,o,No(r));if(!await Yi(p))throw p.error;return A(s)&&s.end(e),this.createSourceFromElement(e,p)}createSourceFromStream(e,r){let o=es(!0,!su,!1,vl(r));return su?this.createSourceFromElement(e,o):Yd(Xn("media-stream-source",e,r.id),this.audioCtx,r)}createSourceFromElement(e,r){return Kn(Xn("media-element-source",e),this.audioCtx,r)}makeClip(e,r,o,i,s,p,c,...m){let h=Xn(r,o),x=this.createSpatializer(h,i,!1),b=new ls(Xn("audio-clip-element",h),this.audioCtx,e,s,x,...m);return p&&b.play(),b.volume=c,b}hasClip(e){return this.clips.has(e)}async playClip(e){this.hasClip(e)&&await this.clips.get(e).play()}async playClipThrough(e){this.hasClip(e)&&await this.clips.get(e).playThrough()}stopClip(e){this.hasClip(e)&&this.clips.get(e).stop()}getUser(e){return this.users.get(e)}getClip(e){return this.clips.get(e)}removeSource(e,r){let o=e.get(r);return A(o)&&(e.delete(r),o.dispose()),o}removeUser(e){let r=this.removeSource(this.users,e);A(r.input)&&(r.input=null)}removeClip(e){let r=this.clipPaths.get(e);return this.pathCounts.set(r,this.pathCounts.get(r)-1),this.pathCounts.get(r)===0&&(this.pathCounts.delete(r),this.pathSources.delete(r)),this.removeSource(this.clips,e)}setUserStream(e,r,o){if(this.users.has(e)){let i=this.users.get(e);o?i.input=this.createSourceFromStream(Xn(r,e),o):A(i.input)&&(i.input=null)}}setAudioProperties(e,r,o){this._minDistance=e,this._maxDistance=r,this._algorithm=o,Fe.instance(this.audioCtx).setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let i of this.users.values())i.spatializer.setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let i of this.clips.values())i.spatializer.setAudioProperties(i.spatializer.minDistance,i.spatializer.maxDistance,this.algorithm)}withPose(e,r,o){let i=e.get(r),s=null;return i?s=i.pose:r===this.localUserID&&(s=this.audioDestination.pose),s?o(s):null}withUser(e,r){return this.withPose(this.users,e,r)}setUserPose(e,r,o,i,s,p,c,m,h,x){this.withUser(e,b=>{b.set(r,o,i,s,p,c,m,h,x)})}withClip(e,r){return this.withPose(this.clips,e,r)}setClipPosition(e,r,o,i){this.withClip(e,s=>{s.setPosition(r,o,i)})}setClipOrientation(e,r,o,i,s,p,c){this.withClip(e,m=>{m.setOrientation(r,o,i,s,p,c)})}setClipPose(e,r,o,i,s,p,c,m,h,x){this.withClip(e,b=>{b.set(r,o,i,s,p,c,m,h,x)})}};var Ol=class extends Ct{constructor(t,e){super(t,e)}},Nr=class extends Ol{constructor(t){super("loading",t)}};var hs=class extends Pt{constructor(e){super("JuniperAudioPlayer",e,Fe.instance(e));this._data=null;this._loaded=!1;this.sourcesByURL=new Map;this.sources=new Array;this.potatoes=new Array;this.element=Qn(dn(!0),cn(!1),Sr(!1),zn(!0)),this.input=Kn("JuniperAudioPlayer-Input",e,this.element),this.loadingEvt=new Nr(this),this.loadEvt=new xn(this),this.playEvt=new gn(this),this.pauseEvt=new vn(this),this.stopEvt=new An(this),this.progEvt=new _n(this),this.onPlay=async()=>{this.connect(),this.dispatchEvent(this.playEvt)},this.onPause=r=>{this.disconnect(),this.element.currentTime===0||r.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)},this.onTimeUpdate=async()=>{this.progEvt.value=this.element.currentTime,this.progEvt.total=this.element.duration,this.dispatchEvent(this.progEvt)},this.onError=()=>this.loadAudio(),this.element.addEventListener("play",this.onPlay),this.element.addEventListener("pause",this.onPause),this.element.addEventListener("ended",this.onPause),this.element.addEventListener("error",this.onError),this.element.addEventListener("waiting",this.onWaiting),this.element.addEventListener("canplay",this.onCanPlay),this.element.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{audioPlayer:this})}get data(){return this._data}get loaded(){return this._loaded}get title(){return this.element.title}setTitle(e){this.element.title=e}get hasAudio(){let e=this.sourcesByURL.get(this.element.src);return A(e)&&e.acodec!=="none"||A(this.element.audioTracks)&&this.element.audioTracks.length>0||A(this.element.webkitAudioDecodedByteCount)&&this.element.webkitAudioDecodedByteCount>0||A(this.element.mozHasAudio)&&this.element.mozHasAudio}onDisposing(){super.onDisposing(),this.clear(),ee(this.input),ee(this.audioSource),this.element.removeEventListener("play",this.onPlay),this.element.removeEventListener("pause",this.onPause),this.element.removeEventListener("ended",this.onPause),this.element.removeEventListener("error",this.onError),this.element.removeEventListener("waiting",this.onWaiting),this.element.removeEventListener("canplay",this.onCanPlay),this.element.removeEventListener("timeupdate",this.onTimeUpdate)}clear(){this.stop(),this.sourcesByURL.clear(),ae(this.sources),ae(this.potatoes),this.element.src="",this._data=null,this._loaded=!1}async load(e,r){this.clear(),this._data=e,re(e)?(this.setTitle(e),this.potatoes.push(e)):(this.setTitle(e.title),Fn(e.audios,o=>-o.resolution),yc(this.sources,...e.audios));for(let o of this.sources)this.sourcesByURL.set(o.url,o);if(!this.hasSources)throw new Error("No audio sources");if(this.dispatchEvent(this.loadingEvt),await this.loadAudio(r),!this.hasSources)throw new Error("No audio sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}async getMediaCapabilities(e){let r={type:"file",audio:{contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr}};try{return await navigator.mediaCapabilities.decodingInfo(r)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:r}}}get hasSources(){return this.sources.length>0||this.potatoes.length>0}async loadAudio(e){for(A(e)&&e.start(),this.element.removeEventListener("error",this.onError);this.hasSources;){let r=null,o=this.sources.shift();if(A(o)){let i=await this.getMediaCapabilities(o);if(!i.smooth||!i.powerEfficient){this.potatoes.push(o.url);continue}else r=o.url}else r=this.potatoes.shift();if(this.element.src=r,this.element.load(),await Ji(this.element)){A(o)?this.sources.unshift(o):this.potatoes.unshift(r),this.element.addEventListener("error",this.onError),A(e)&&e.end();return}}}get playbackState(){return D(this.data)?"empty":this.loaded?this.element.error?"errored":this.element.ended||this.element.paused&&this.element.currentTime===0?"stopped":this.element.paused?"paused":"playing":"loading"}async play(){await Rt(this.audioCtx),await this.element.play()}async playThrough(){let e=Ce(this,"stopped");await this.play(),await e}pause(){this.element.pause()}stop(){this.pause(),this.element.currentTime=0}restart(){return this.stop(),this.play()}};var au=/([^\/]+)\/(.+)/,Bx=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/,Yn=class{constructor(t,e,r){this._type=t;this._fullSubType=e;this._primaryExtension=null;this.depMessage=null;let o=new Map;this._parameters=o;let i=this._fullSubType.match(Bx);this._tree=i[1],this._subType=i[2],this._suffix=i[3];let s=i[4];if(this._value=this._fullValue=this._type+"/",A(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,A(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),A(s)){let p=s.split(";").map(c=>c.trim()).filter(c=>c.length>0).map(c=>c.split("="));for(let[c,...m]of p){let h=m.join("=");o.set(c,h);let x=`; ${c}=${h}`;this._fullValue+=x,c!=="q"&&(this._value+=x)}}this._extensions=r||[],this._primaryExtension=this._extensions[0]||null}static parse(t){if(!t)return null;let e=t.match(au);if(!e)return null;let r=e[1],o=e[2];return new Yn(r,o)}deprecate(t){return this.depMessage=t,this}check(){A(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(t){if(D(t))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let e=null,r=null;if(re(t)){let o=t.match(au);if(!o)return!1;e=o[1],r=o[2]}else e=t.typeName,r=t._fullSubType;return this.typeName===e&&(this._fullSubType==="*"||this._fullSubType===r)}withParameter(t,e){let r=`${this._fullSubType}; ${t}=${e}`;return new Yn(this.typeName,r,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}addExtension(t){if(!t)throw new Error("File name is not defined");if(this.primaryExtension){let e=t.lastIndexOf(".");if(e>-1){let r=t.substring(e+1);this.extensions.indexOf(r)>-1&&(t=t.substring(0,e))}t=`${t}.${this.primaryExtension}`}return t}};function Fx(n,t,...e){return new Yn(n,t,e)}function He(n){return Fx.bind(null,n)}var Hx=He("audio");var Xr=Hx("mpeg","mp3","mp2","mp2a","mpga","m2a","m3a");var Nx=He("image");var lu=Nx("png","png");var pu=He("model");var fs=pu("gltf-binary","glb"),cu=pu("gltf+json","gltf");var Xx=He("video");var du=Xx("vnd.mpeg.dash.mpd","mpd");var Jn=class{constructor(t,e){this.path=t;this.type=e;this._result=null;this._error=null;this._started=!1;this._finished=!1;this.resolve=null;this.reject=null;this.promise=new Promise((r,o)=>{this.resolve=i=>{this._result=i,this._finished=!0,r(i)},this.reject=i=>{this._error=i,this._finished=!0,o(i)}})}get result(){if(A(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}async getSize(t){try{let{contentLength:e}=await t.head(this.path).accept(this.type).exec();return[this,e||1]}catch(e){return console.warn(e),[this,1]}}async fetch(t,e){try{let r=await this.getResult(t,e);this.resolve(r)}catch(r){this.reject(r)}}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};var zr=class extends Jn{constructor(e,r,o){let i;qe(r)?o=r:i=r;super(e,i);this.useCache=!!o}async getResult(e,r){return(await this.getRequest(e,r)).content}getRequest(e,r){let o=e.get(this.path).useCache(this.useCache).progress(r);return this.getResponse(o)}},bn=class extends zr{getResponse(t){return t.audio(!1,!1,this.type)}};var xs=class extends zr{getResponse(t){return t.image(this.type)}};var Dl="HTMLCanvasElement"in globalThis,zT="HTMLImageElement"in globalThis,uu=!1,gs=!uu&&"OffscreenCanvas"in globalThis,Ux=!uu&&"createImageBitmap"in globalThis;function Ur(n){return Dl&&n instanceof HTMLCanvasElement}function mu(n){return gs&&n instanceof OffscreenCanvas}function hu(n){return Ux&&n instanceof ImageBitmap}function jx(n,t){let e=n.getContext("2d");if(D(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function Gx(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var Wx=gs&&Gx(),jr=Wx&&fu||Dl&&As||null,vs=Dl?As:jr;function qx(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var UT=gs&&qx();function fu(n,t){return new OffscreenCanvas(n,t)}function As(n,t){return Md(od(n),nd(t))}function xu(n){let t=As(n.width,n.height);return jx(t,n),t}function gu(n,t,e,r=1){return t=Math.floor(t*r),e=Math.floor(e*r),n.width!=t||n.height!=e?(n.width=t,n.height=e,!0):!1}function Qx(n){return A(n.textBaseline)}function Kx(n,t,e,r=1){let o=n.imageSmoothingEnabled,i=n.textBaseline,s=n.textAlign,p=n.font,c=gu(n.canvas,t,e,r);return c&&(n.imageSmoothingEnabled=o,n.textBaseline=i,n.textAlign=s,n.font=p),c}function Bl(n,t,e,r=1){return Qx(n)?Kx(n,t,e,r):gu(n.canvas,t,e,r)}async function qo(n,t){let{status:e,path:r,content:o,contentType:i,contentLength:s,fileName:p,headers:c,date:m}=n;return{status:e,path:r,content:await t(o),contentType:i,contentLength:s,fileName:p,headers:c,date:m}}var En=class extends q{constructor(e,r,o){super();this._scale=250;this._visible=!0;this.wasVisible=null;this.redrawnEvt=new j("redrawn");this.element=null;A(o)&&A(o.scale)&&(this._scale=o.scale),this._canvas=vs(e,r),this._g=this.canvas.getContext("2d"),Ur(this._canvas)&&(this.element=this._canvas)}fillRect(e,r,o,i,s,p){this.g.fillStyle=e,this.g.fillRect(r+p,o+p,i-2*p,s-2*p)}drawText(e,r,o,i){this.g.textAlign=i,this.g.strokeText(e,r,o),this.g.fillText(e,r,o)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(e){this.scale!==e&&(this._scale=e,this.redraw())}get visible(){return this._visible}set visible(e){this.visible!==e&&(this.wasVisible=this._visible,this._visible=e,this.redraw())}};var _s=class extends En{constructor(){super(128,128);this._pitch=0;this._heading=0;this.redraw()}get pitch(){return this._pitch}set pitch(e){e!==this.pitch&&(this._pitch=e,this.redraw())}get heading(){return this._heading}set heading(e){e!==this.heading&&(this._heading=e,this.redraw())}setPitchAndHeading(e,r){(e!==this.pitch||r!==this.heading)&&(this._pitch=e,this._heading=r,this.redraw())}onRedraw(){let e=Xe(this.pitch),r=Xe(this.heading-180),o=5,i=this.canvas.width-2*o,s=this.canvas.height-2*o,p=.5*i,c=.5*s,m=Math.sin(e),h=this.g;return h.save(),h.clearRect(0,0,this.canvas.width,this.canvas.height),h.translate(o,o),h.scale(p,c),h.translate(1,1),h.fillStyle="#808080",h.beginPath(),h.arc(0,0,1,0,2*Math.PI),h.fill(),h.fillStyle="#d0d0d0",h.beginPath(),h.arc(0,0,1,0,Math.PI,!0),h.fill(),h.save(),h.scale(1,Math.abs(m)),m<0&&(h.fillStyle="#808080"),h.beginPath(),h.arc(0,0,1,0,Math.PI,m<0),h.fill(),h.restore(),h.save(),h.shadowColor="#404040",h.shadowBlur=4,h.shadowOffsetX=3,h.shadowOffsetY=3,h.rotate(r),h.fillStyle="#ff0000",h.beginPath(),h.moveTo(-.1,0),h.lineTo(0,.667),h.lineTo(.1,0),h.closePath(),h.fill(),h.fillStyle="#ffffff",h.beginPath(),h.moveTo(-.1,0),h.lineTo(0,-.667),h.lineTo(.1,0),h.closePath(),h.fill(),h.restore(),h.beginPath(),h.strokeStyle="#000000",h.lineWidth=.1,h.arc(0,0,1,0,2*Math.PI),h.stroke(),h.restore(),!0}};var XM=ht("juniper::loadedFonts",()=>[]);function bs(n){let t=[];return n.fontStyle&&n.fontStyle!=="normal"&&t.push(n.fontStyle),n.fontVariant&&n.fontVariant!=="normal"&&t.push(n.fontVariant),n.fontWeight&&n.fontWeight!=="normal"&&t.push(n.fontWeight),t.push(`${n.fontSize}px`),t.push(n.fontFamily),t.join(" ")}function vu(n){return"getBattery"in n}var Yx=["","N/A","charging"],Gr=class extends En{constructor(){super(256,128);this.battery=null;this.lastChargeDirection=null;this.lastLevel=null;this.chargeDirection=0;this.level=.5;vu(navigator)?this.readBattery(navigator):this.redraw()}onRedraw(){this.battery?(this.chargeDirection=this.battery.charging?1:-1,this.level=this.battery.level):(this.level+=.1,this.level>1&&(this.level=0));let e=this.chargeDirection!==this.lastChargeDirection,r=this.level!==this.lastLevel;if(!e&&!r)return!1;this.lastChargeDirection=this.chargeDirection,this.lastLevel=this.level;let o=this.level<.1?"red":"#ccc",i=7,s=.7,p=(1-s)/2,c=this.canvas.width-2*i,m=c-4*i,h=this.canvas.height-4*i,x=c/2,b=this.canvas.height/2,y=Yx[this.chargeDirection+1];return this.g.clearRect(0,0,c,this.canvas.height),this.g.save(),this.g.translate(p*this.canvas.width,p*this.canvas.height),this.g.globalAlpha=.75,this.g.scale(s,s),this.fillRect("#ccc",0,0,c,this.canvas.height,0),this.fillRect("#ccc",c,b-2*i-10,i+10,4*i+20,0),this.g.clearRect(i,i,c-2*i,this.canvas.height-2*i),this.fillRect("black",i,i,c-2*i,this.canvas.height-2*i,0),this.g.clearRect(2*i,2*i,m*this.level,h),this.fillRect(o,2*i,2*i,m*this.level,h,0),this.g.fillStyle="white",this.g.strokeStyle="black",this.g.lineWidth=4,this.g.textBaseline="middle",this.g.font=bs({fontSize:h/2,fontFamily:"Lato"}),this.drawText(y,x,b,"center"),this.g.restore(),!0}async readBattery(e){let r=this.redraw.bind(this);r(),this.battery=await e.getBattery(),this.battery.addEventListener("chargingchange",r),this.battery.addEventListener("levelchange",r),setInterval(r,1e3),r()}};Gr.isAvailable=vu(navigator);var Wt=class extends En{constructor(e){super(10,10,e);this.trueWidth=null;this.trueHeight=null;this.trueFontSize=null;this.dx=null;this._minWidth=null;this._maxWidth=null;this._minHeight=null;this._maxHeight=null;this._freezeDimensions=!1;this._dimensionsFrozen=!1;this._bgFillColor=null;this._bgStrokeColor=null;this._bgStrokeSize=null;this._textStrokeColor=null;this._textStrokeSize=null;this._textFillColor="black";this._textDirection="horizontal";this._wrapWords=!0;this._fontStyle="normal";this._fontVariant="normal";this._fontWeight="normal";this._fontFamily="sans-serif";this._fontSize=20;this._value=null;A(e)&&(A(e.minWidth)&&(this._minWidth=e.minWidth),A(e.maxWidth)&&(this._maxWidth=e.maxWidth),A(e.minHeight)&&(this._minHeight=e.minHeight),A(e.maxHeight)&&(this._maxHeight=e.maxHeight),A(e.freezeDimensions)&&(this._freezeDimensions=e.freezeDimensions),A(e.textStrokeColor)&&(this._textStrokeColor=e.textStrokeColor),A(e.textStrokeSize)&&(this._textStrokeSize=e.textStrokeSize),A(e.bgFillColor)&&(this._bgFillColor=e.bgFillColor),A(e.bgStrokeColor)&&(this._bgStrokeColor=e.bgStrokeColor),A(e.bgStrokeSize)&&(this._bgStrokeSize=e.bgStrokeSize),A(e.value)&&(this._value=e.value),A(e.textFillColor)&&(this._textFillColor=e.textFillColor),A(e.textDirection)&&(this._textDirection=e.textDirection),A(e.wrapWords)&&(this._wrapWords=e.wrapWords),A(e.fontStyle)&&(this._fontStyle=e.fontStyle),A(e.fontVariant)&&(this._fontVariant=e.fontVariant),A(e.fontWeight)&&(this._fontWeight=e.fontWeight),A(e.fontFamily)&&(this._fontFamily=e.fontFamily),A(e.fontSize)&&(this._fontSize=e.fontSize),A(e.padding)&&(le(e.padding)?this._padding={left:e.padding,right:e.padding,top:e.padding,bottom:e.padding}:this._padding=e.padding)),D(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(e){this.minWidth!==e&&(this._minWidth=e,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(e){this.maxWidth!==e&&(this._maxWidth=e,this.redraw())}get minHeight(){return this._minHeight}set minHeight(e){this.minHeight!==e&&(this._minHeight=e,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(e){this.maxHeight!==e&&(this._maxHeight=e,this.redraw())}get padding(){return this._padding}set padding(e){if(e instanceof Array)throw new Error("Invalid padding");(this.padding.top!==e.top||this.padding.right!=e.right||this.padding.bottom!=e.bottom||this.padding.left!=e.left)&&(this._padding=e,this.redraw())}get wrapWords(){return this._wrapWords}set wrapWords(e){this.wrapWords!==e&&(this._wrapWords=e,this.redraw())}get textDirection(){return this._textDirection}set textDirection(e){this.textDirection!==e&&(this._textDirection=e,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(e){this.fontStyle!==e&&(this._fontStyle=e,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(e){this.fontVariant!==e&&(this._fontVariant=e,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(e){this.fontWeight!==e&&(this._fontWeight=e,this.redraw())}get fontSize(){return this._fontSize}set fontSize(e){this.fontSize!==e&&(this._fontSize=e,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(e){this.textFillColor!==e&&(this._textFillColor=e,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(e){this.textStrokeColor!==e&&(this._textStrokeColor=e,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(e){this.textStrokeSize!==e&&(this._textStrokeSize=e,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(e){this.bgFillColor!==e&&(this._bgFillColor=e,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(e){this.bgStrokeColor!==e&&(this._bgStrokeColor=e,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(e){this.bgStrokeSize!==e&&(this._bgStrokeSize=e,this.redraw())}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.redraw())}split(e){return this.wrapWords?e.split(" ").join(`
`).replace(/\r\n/,`
`).split(`
`):e.replace(/\r\n/,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value){let e=this.split(this.value),r=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let i=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,s=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,p=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,c=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,m=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,h=r?c:s,x=r?m:p,b=r?s:c,y=r?p:m,C=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let P=!1,S=!1,k=1e4,O=0;this.trueFontSize=Xt(this.fontSize*this.scale,O,k);let V=null,H=Number.MAX_VALUE;do{let B=this.fontSize;this._fontSize=this.trueFontSize;let oe=bs(this);this._fontSize=B,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=oe,this.trueWidth=0,this.trueHeight=0;for(let ie of e){let W=this.g.measureText(ie);this.trueWidth=Math.max(this.trueWidth,W.width),this.trueHeight+=this.trueFontSize,le(W.actualBoundingBoxLeft)&&le(W.actualBoundingBoxRight)&&le(W.actualBoundingBoxAscent)&&le(W.actualBoundingBoxDescent)&&(i||(this.trueWidth=W.actualBoundingBoxLeft+W.actualBoundingBoxRight,this.trueHeight=W.actualBoundingBoxAscent+W.actualBoundingBoxDescent,this.dx=(W.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(i){let ie=this.trueWidth-h,W=this.trueWidth-x,ne=this.trueHeight-b,_e=this.trueHeight-y,fe=Math.abs(ie),se=Math.abs(W),Je=Math.abs(ne),_r=Math.abs(_e);P=W>1||_e>1,S=ie<-1&&ne<-1;let rn=Math.min(fe,Math.min(se,Math.min(Je,_r)));rn<H&&(H=rn,V=this.g.font),(P||S)&&C.indexOf(this.g.font)>-1&&V&&(this.g.font=V,P=!1,S=!1),P?(k=this.trueFontSize,this.trueFontSize=(O+this.trueFontSize)/2):S&&(O=this.trueFontSize,this.trueFontSize=(this.trueFontSize+k)/2)}C.push(this.g.font)}while(P||S);i&&(this.trueWidth<h?this.trueWidth=h:this.trueWidth>x&&(this.trueWidth=x),this.trueHeight<b?this.trueHeight=b:this.trueHeight>y&&(this.trueHeight=y));let N=this.trueWidth+this.scale*(this.padding.right+this.padding.left),I=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{Bl(this.g,N,I)}catch(B){throw console.error(B),B}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let o=.5*(e.length-1);for(let i=0;i<e.length;++i){let s=e[i],p=(i-o)*this.trueFontSize,c=this.dx+this.trueWidth/2+this.scale*this.padding.left,m=p+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(s,c,m),this.textFillColor&&this.g.fillText(s,c,m)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let i=this.bgStrokeSize/2;this.g.strokeRect(i,i,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(r){let i=jr(this.canvas.height,this.canvas.width),s=i.getContext("2d");s?(s.translate(i.width/2,i.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?s.rotate(Math.PI/2):this.textDirection==="vertical-right"&&s.rotate(-Math.PI/2),s.translate(-this.canvas.width/2,-this.canvas.height/2),s.drawImage(this.canvas,0,0),Bl(this.g,i.width,i.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(i,0,0)}return!0}else return!1}};var Es=class extends Wt{constructor(){super({textFillColor:"#ffffff",textStrokeColor:"rgba(0, 0, 0, 0.5)",textStrokeSize:.025,fontFamily:Ad(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,wrapWords:!1,freezeDimensions:!0});this.fps=null;this.drawCalls=null;this.triangles=null;let e=this.update.bind(this);setInterval(e,500),e()}setStats(e,r,o){this.fps=e,this.drawCalls=r,this.triangles=o}update(){let r=new Date().toLocaleTimeString();this.fps!==null&&(r+=` ${Math.round(this.fps).toFixed(0)}hz ${this.drawCalls}c ${this.triangles}t`),(D(this.value)||r.length!==this.value.length)&&this.unfreeze(),this.value=r}};var Au="local-user";function _u(n){return!n.started||n.finished}var Fl=class extends at{constructor(){super(!1);this.time=0;this.duration=0;this.onTick=null}begin(e,r,o){this.reset(),this.start(),this.time=-e,this.duration=r,this.onTick=o,this.onTick(0)}update(e){_u(this)||(this.time+=e/this.duration,this.time>=1?(this.onTick(1),this.resolve()):this.time>=0&&this.onTick(this.time))}},ys=class{constructor(){this.animations=new Array}update(t){t=.001*t;for(let e of this.animations)e.update(t)}clear(){for(let t of this.animations)t.resolve()}start(t,e,r){let o=bt(this.animations,_u);return o||this.animations.push(o=new Fl),o.begin(t,e,r),o}};function bu(n,t){let e=n*Math.PI;return .5*(1-Math.cos(e))-t*Math.sin(2*e)}function Eu(n,t){let e=(n-.5)*Math.PI;return n*n+t*Math.cos(e)}Mt(J(".dialog, .dialog-container",Ir("fixed")),J(".dialog",Wn(0),jn(0),xt("100%"),Ut("100%"),Xo("rgba(0, 0, 0, 0.5)"),Qi(100)),J(".dialog-container",Wn("50%"),jn("50%"),zo("100%"),md("100%"),vd("translateX(-50%) translateY(-50%)"),Xo("white"),ad("rgba(0,0,0,0.5) 0px 5px 30px"),ze("grid"),un("2em auto 2em"),qi("auto 1fr auto 2em")),J(".dialog .title-bar",ji(1,1,2,-1),hn("0.25em")),J(".dialog-content",ji(2,2,-4,-2),fd("auto")),J(".dialog-controls",ji(-2,2,-3,-2)),J(".dialog .confirm-button",cd("right")),J(".dialog h1, .dialog h2, .dialog h3, .dialog h4, .dialog h5, .dialog h6",Gn("left")),J(".dialog select",zo("10em")));var Wr=class{constructor(t){this.subEventer=new q;this.element=ve(be("dialog"),td("dialogname",t),pt(ze("none")),this.container=ve(be("dialog-container"),this.titleElement=Cd(be("title-bar"),t),this.contentArea=ve(be("dialog-content")),ve(be("dialog-controls"),this.confirmButton=Vr("Confirm",Mr("confirm-button")),this.cancelButton=$i("Cancel",Mr("cancel-button"))))),this.confirmButton.addEventListener("click",()=>this.subEventer.dispatchEvent(new j("confirm"))),this.cancelButton.addEventListener("click",()=>this.subEventer.dispatchEvent(new j("cancel"))),ue(document.body,this)}get title(){return this._title}set title(t){Go(this.titleElement,this._title=t)}async onShowing(){}onShown(){}async onConfirm(){}onCancel(){}async onClosing(){}onClosed(){}show(t){Se(this,t)}get isOpen(){return Tt(this)}async showDialog(){await this.onShowing(),this.show(!0),this.onShown();let t=Ce(this.subEventer,"confirm","cancel"),e=await tl(t);return e?await this.onConfirm():this.onCancel(),await this.onClosing(),this.show(!1),this.onClosed(),e}};function yn(n){return A(n)&&n.isMesh}function Hl(n){return A(n)&&n.isMaterial}function Jx(n,t){return Hl(t)&&t.type===n}function yu(n){return Jx("MeshBasicMaterial",n)}function wu(n){return A(n)&&n.isObject3D}function Tu(n){return A(n)&&n.isQuaternion}function Mu(n){return A(n)&&n.isEuler}function Su(n){return A(n)&&wu(n.object)}function Ue(n){return Su(n)?n.object:n}function Ie(n,t){return n=Ue(n),n.visible=t,t}function qr(n){return n=Ue(n),n.visible}function ws(n){for(n=Ue(n);n;){if(!n.visible)return!1;n=n.parent}return!0}function G(n,...t){let e=t.filter(A).map(Ue);return e.length>0&&Ue(n).add(...e),n}function je(n,...t){let e=new THREE.Object3D;return e.name=n,G(e,...t),e}function Ts(n,t){n=Ue(n),yd(n)&&(n.disabled=!t)}var $n=ht("Juniper:ScaledItems",()=>new Map),Ru=1,$x=1.1,Zx=.005,Nl=class{constructor(t){this.target=t;this.obj=Ue(this.target),this.base=this.obj.scale.clone(),this.p=0,this.dir=0,this.running=!1,this.wasDisabled=this.disabled,this.onEnter=()=>this.run(1),this.onExit=()=>this.run(-1),this.target.addEventListener("enter",this.onEnter),this.target.addEventListener("exit",this.onExit),this.obj.traverse(e=>{yn(e)&&this.target.addMesh(e)})}get disabled(){return this.target.disabled}run(t){(!this.disabled||t===-1||this.p>0)&&(this.dir=t,this.running=!0)}updateScaling(t){if(this.disabled!==this.wasDisabled&&(this.wasDisabled=this.disabled,this.disabled&&this.onExit()),this.running){this.p+=this.dir*t,(this.dir>0&&this.p>=1||this.dir<0&&this.p<0)&&(this.p=Math.max(0,Math.min(1,this.p)),this.running=!1);let e=bu(this.p,1.1);this.obj.scale.copy(this.base).multiplyScalar(e*($x-Ru)+Ru)}}dispose(){this.target.removeEventListener("enter",this.onEnter),this.target.removeEventListener("exit",this.onExit)}};function Pu(n){n*=Zx;for(let t of $n.values())t.updateScaling(n)}function Cu(n){let t=$n.get(n);t&&($n.delete(n),t.dispose())}function Ms(n,t){let e=$n.has(n);t!=e&&(t?$n.set(n,new Nl(n)):($n.get(n).dispose(),$n.delete(n)))}function wn(n){let t=new Array,e=new Set;for(t.push(n);t.length>0;){let r=t.shift();r&&!e.has(r)&&(e.add(r),r.isMesh&&t.push(r.material,r.geometry),r.isMaterial&&t.push(...Object.values(r)),r.isObject3D&&(t.push(...r.children),r.clear(),Cu(r)),Qe(r)&&t.push(...r),fl(r))}e.clear()}THREE.UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new THREE.Vector2(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};THREE.ShaderLib.line={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var qt=class extends THREE.ShaderMaterial{constructor(t){super({type:"LineMaterial",uniforms:THREE.UniformsUtils.clone(THREE.ShaderLib.line.uniforms),vertexShader:THREE.ShaderLib.line.vertexShader,fragmentShader:THREE.ShaderLib.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(t)}};qt.prototype.isLineMaterial=!0;var Xl=ht("Juniper:Three:Materials",()=>new Map);function eg(n,t){t in n&&delete n[t]}function Ss(n,t,e){let r=`${n}_${Object.keys(e).map(o=>`${o}:${e[o]}`).join(",")}`;return Xl.has(r)||(eg(e,"name"),Xl.set(r,new t(e))),Xl.get(r)}function tg(n){return Object.assign(n,{transparent:!0})}function Iu(n){return Ss("solid",THREE.MeshBasicMaterial,n)}function Qr(n){return Ss("solidTransparent",THREE.MeshBasicMaterial,tg(n))}function Vu(n){return Ss("lit",THREE.MeshPhongMaterial,n)}function Lu(n){return Ss("line2",qt,n)}function ku(n,t){let e=new Set;n.traverse(r=>{if(yn(r)&&Hl(r.material)){let o=r.material,i=t(o);o!==i&&(e.add(o),r.material=i)}});for(let r of e)r.dispose()}function Ou(n){if(n.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let t={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,dithering:n.dithering,envMap:n.envMap,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.emissiveMap||n.map,name:n.name+"-Standard-To-Basic",opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,shadowSide:n.shadowSide,side:n.side,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[e,r]of Object.entries(t))D(r)&&delete t[e];return new THREE.MeshBasicMaterial(t)}var ng=12632256,zl=16777215;var Du=Vu({color:ng}),Bu=Vu({color:zl});var rg=new THREE.Matrix4,Rs=new THREE.Vector3;function Ul(n,t,e,r,o){rg.copy(n.matrixWorld).invert().multiply(t.matrixWorld).decompose(Rs,r,o),e.set(Rs.x,Rs.y,Rs.z,1)}var Ps=new THREE.PlaneBufferGeometry(1,1,1,1);Ps.name="PlaneGeom";var Fu=class extends THREE.Mesh{constructor(t,e,r){super(Ps,r),this.scale.set(t,e,1)}};var Cs=new THREE.Vector4,Is=new THREE.Quaternion,Kr=new THREE.Vector3,og=0,Yr=class extends THREE.Object3D{constructor(e,r,o,i=null){super();this.isStatic=o;this.lastMatrixWorld=new THREE.Matrix4;this.layer=null;this.tryWebXRLayers=!0;this.wasUsingLayer=!1;this._imageWidth=0;this._imageHeight=0;this.lastImage=null;this.lastWidth=null;this.lastHeight=null;this.stereoLayoutName="mono";this.env=null;this.mesh=null;this.webXRLayersEnabled=!0;this.sizeMode="none";if(e){this.setEnvAndName(e,r);let s=yu(i)?i:Qr(Object.assign({},i,{name:this.name}));this.mesh=new THREE.Mesh(Ps,s),G(this,this.mesh)}}copy(e,r=!0){return super.copy(e,r),this.setImageSize(e.imageWidth,e.imageHeight),this.setEnvAndName(e.env,e.name+ ++og),this.mesh=bt(this.children,yn),D(this.mesh)&&(this.mesh=e.mesh.clone()),G(this,this.mesh),this}dispose(){wn(this.layer)}setImageSize(e,r){if(e!==this.imageWidth||r!==this.imageHeight){let{objectWidth:o,objectHeight:i}=this;this._imageWidth=e,this._imageHeight=r,this.sizeMode!=="none"&&(this.sizeMode==="fixed-width"?this.objectWidth=o:this.objectHeight=i)}}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get imageAspectRatio(){return this.imageWidth/this.imageHeight}get objectWidth(){return this.scale.x}set objectWidth(e){this.scale.set(e,this.scale.y=e/this.imageAspectRatio,1)}get objectHeight(){return this.scale.y}set objectHeight(e){this.scale.set(this.imageAspectRatio*e,e,1)}get pixelDensity(){let e=ed(this.objectWidth);return this.imageWidth/e}set pixelDensity(e){let r=this.imageWidth/e,o=Zc(r);this.objectWidth=o}setEnvAndName(e,r){this.env=e,this.name=r,this.tryWebXRLayers&&=this.env&&this.env.hasXRCompositionLayers}get needsLayer(){if(!ws(this)||D(this.mesh.material.map)||D(this.mesh.material.map.image))return!1;let e=this.mesh.material.map.image;return e instanceof HTMLVideoElement?!e.paused||e.currentTime>0:!0}removeWebXRLayer(){if(A(this.layer)){this.wasUsingLayer=!1,this.env.removeWebXRLayer(this.layer);let e=this.layer;this.layer=null,setTimeout(()=>{e.destroy(),this.mesh.visible=!0},100)}}setTextureMap(e){return hu(e)&&(e=xu(e)),mu(e)&&(e=e),e instanceof HTMLVideoElement?(this.mesh.material.map=new THREE.VideoTexture(e),this.setImageSize(e.videoWidth,e.videoHeight)):(this.mesh.material.map=new THREE.Texture(e),this.setImageSize(e.width,e.height),this.mesh.material.map.needsUpdate=!0),this.mesh.material.needsUpdate=!0,this.mesh.material.map}async loadTextureMap(e,r,o){let{content:i}=await e.get(r).progress(o).image(),s=this.setTextureMap(i);s.name=r}updateTexture(){let e=this.mesh.material.map.image;le(e.width)&&le(e.height)&&(this.imageWidth!==e.width||this.imageHeight!==e.height)&&(this.mesh.material.map.dispose(),this.mesh.material.map=new THREE.Texture(e),this.mesh.material.needsUpdate=!0,this.setImageSize(e.width,e.height)),this.mesh.material.map.needsUpdate=!0}update(e,r){if(this.mesh.material.map&&this.mesh.material.map.image){let o=this.mesh.material.map instanceof THREE.VideoTexture,s=this.tryWebXRLayers&&this.webXRLayersEnabled&&A(r)&&(o&&A(this.env.xrMediaBinding)||!o&&A(this.env.xrBinding))&&this.needsLayer,p=s!==this.wasUsingLayer,c=this.mesh.material.map.image!==this.lastImage||this.mesh.material.needsUpdate||this.mesh.material.map.needsUpdate,m=this.imageWidth!==this.lastWidth||this.imageHeight!==this.lastHeight;if(this.wasUsingLayer=s,this.lastImage=this.mesh.material.map.image,this.lastWidth=this.imageWidth,this.lastHeight=this.imageHeight,(p||m)&&((!s||m)&&this.layer&&this.removeWebXRLayer(),s)){let h=this.env.referenceSpace;Ul(this.env.stage,this.mesh,Cs,Is,Kr),this.lastMatrixWorld.copy(this.matrixWorld);let x=new XRRigidTransform(Cs,Is),b=Kr.x/2,y=Kr.y/2,C=this.stereoLayoutName==="mono"?"mono":this.stereoLayoutName==="left-right"||this.stereoLayoutName==="right-left"?"stereo-left-right":"stereo-top-bottom";if(o){let P=this.stereoLayoutName==="right-left"||this.stereoLayoutName==="bottom-top";this.layer=this.env.xrMediaBinding.createQuadLayer(this.mesh.material.map.image,{space:h,layout:C,invertStereo:P,transform:x,width:b,height:y})}else this.layer=this.env.xrBinding.createQuadLayer({space:h,layout:C,textureType:"texture",isStatic:this.isStatic,viewPixelWidth:this.imageWidth,viewPixelHeight:this.imageHeight,transform:x,width:b,height:y});this.env.addWebXRLayer(this.layer,500),this.mesh.visible=!1}if(this.layer){if(c||this.layer.needsRedraw){let h=this.env.gl,x=this.env.xrBinding.getSubImage(this.layer,r);h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!0),h.bindTexture(h.TEXTURE_2D,x.colorTexture),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.mesh.material.map.image),h.generateMipmap(h.TEXTURE_2D),h.bindTexture(h.TEXTURE_2D,null)}Za(this.matrixWorld.elements,this.lastMatrixWorld.elements)>=0&&(Ul(this.env.stage,this.mesh,Cs,Is,Kr),this.lastMatrixWorld.copy(this.matrixWorld),this.layer.transform=new XRRigidTransform(Cs,Is),this.layer.width=Kr.x/2,this.layer.height=Kr.y/2)}}}};var ig={type:"redrawn"},Zn=class extends Yr{constructor(e,r,o,i){super(e,r,!1,i);this._image=null;this._onRedrawn=this.onRedrawn.bind(this),this.image=o}get object(){return this}get element(){return Ur(this.image.canvas)?this.image.canvas:null}onRedrawn(){this.updateTexture(),this.dispatchEvent(ig)}get image(){return this._image}set image(e){this.image&&this.image.removeEventListener("redrawn",this._onRedrawn),this._image=e,this.image&&(this.image.addEventListener("redrawn",this._onRedrawn),this.setTextureMap(this.image.canvas),this.onRedrawn())}get imageWidth(){return this.image.width}get imageHeight(){return this.image.height}copy(e,r=!0){return super.copy(e,r),this.image=e.image,this}get isVisible(){return Tt(this)}set isVisible(e){Se(this,e,"inline-block"),Ie(this,e),Ie(this.mesh,e),this.image.visible=e}};var Jr=class extends Zn{constructor(t,e,r,o){let i;r instanceof Wt?i=r:i=new Wt(r),super(t,e,i,o)}onRedrawn(){this.objectHeight=this.imageHeight,super.onRedrawn()}};var jl="Juniper:ThreeJS:EventSystem:RayTarget",er=class extends q{constructor(e){super();this.object=e;this.meshes=new Array;this._disabled=!1;this._clickable=!1;this._draggable=!1;this.object.userData[jl]=this}addMesh(e){return e.userData[jl]=this,this.meshes.push(e),this}get disabled(){return this._disabled}set disabled(e){this._disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get clickable(){return this._clickable}set clickable(e){this._clickable=e}get draggable(){return this._draggable}set draggable(e){this._draggable=e}};function sg(n){return n instanceof er}function $r(n){let t=null;return n&&(sg(n)?t=n:(n=Ue(n),n&&(t=n.userData[jl])),t&&!ws(t)&&(t=null)),t}var Qo=class extends er{constructor(e,r,o,i,s){super(je(o));this.fetcher=e;this.env=r;if(A(i)){s=Object.assign({textFillColor:"#ffffff",fontFamily:"Segoe UI Emoji",fontSize:20,minHeight:.25,maxHeight:.25},s,{value:i}),this.image=new Wt(s);let p=ft(16);this.enabledImage=this.createImage(`${p}-enabled`,1),this.disabledImage=this.createImage(`${p}-disabled`,.5),this.disabledImage.visible=!1,G(this,this.enabledImage,this.disabledImage)}this.addMesh(this.enabledImage.mesh),this.addMesh(this.disabledImage.mesh),this.clickable=!0,A(i)&&Ms(this,!0)}createImage(e,r){return new Jr(this.env,`text-${e}`,this.image,{side:THREE.FrontSide,opacity:r})}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.enabledImage.visible=!e,this.disabledImage.visible=e}};var Hu={bgStrokeColor:"#000000",bgStrokeSize:.04,wrapWords:!1,textFillColor:"#ffffff",scale:150},Nu=Object.assign({},Hu,{padding:{left:.1,right:.1,top:.025,bottom:.025},fontSize:20,minHeight:.5,maxHeight:.5}),ag=Object.assign({},Nu,{bgFillColor:"#0078d7"}),lg=Object.assign({},Nu,{bgFillColor:"#780000"}),pg=Object.assign({},Hu,{bgFillColor:"#ffffff",textFillColor:"#000000",padding:{top:.1,left:.1,bottom:.4,right:.1},fontSize:25,minHeight:1,maxHeight:1}),cg=.9;function Gl(n,t){return Object.assign({},n,{fontFamily:t})}var Vs=class extends Wr{constructor(e,r){super("Confirm action");this.env=e;this.object=new THREE.Object3D;this.name="ConfirmationDialog";this.root=new THREE.Object3D;this.animator=new ys;this.a=0;this.b=0;this.confirmButton.innerText="Yes",this.cancelButton.innerText="No",this.mesh=new Jr(this.env,"confirmationDialogLabel",Gl(pg,r)),this.confirmButton3D=new Qo(this.env.fetcher,this.env,"confirmationDialogConfirmButton","Yes",Gl(ag,r)),this.confirmButton3D.addEventListener("click",()=>this.confirmButton.click()),this.confirmButton3D.object.position.set(1,-.5,.5),this.cancelButton3D=new Qo(this.env.fetcher,this.env,"confirmationDialogCancelButton","No",Gl(lg,r)),this.cancelButton3D.addEventListener("click",()=>this.cancelButton.click()),this.cancelButton3D.object.position.set(2,-.5,.5),ue(this.container,pt(zo("calc(100% - 2em)"),xt("max-content"))),ue(this.contentArea,pt(Ui("18pt"),Gn("center"),hn("1em"))),G(this,G(this.root,this.mesh,this.confirmButton3D,this.cancelButton3D)),Ie(this.root,!1),this.root.scale.setScalar(0),this.onTick=o=>{let i=Eu(this.a+this.b*o,cg);this.root.scale.set(i,i,.01)}}get visible(){return Tt(this)}set visible(e){Se(this,e,"inline-block"),this.mesh.visible=e}update(e){this.animator.update(e)}async showHide(e,r){this.a=e,this.b=r,await this.animator.start(0,.25,this.onTick),this.animator.clear()}get use3D(){return this.env.renderer.xr.isPresenting||this.env.testSpaceLayout}async onShowing(){await super.onShowing(),this.use3D&&(this.root.visible=!0,await this.showHide(0,1))}onShown(){this.use3D&&(this.element.style.display="none")}async onClosing(){this.use3D&&(await this.showHide(1,-1),this.root.visible=!1),await super.onClosing()}prompt(e,r){return this.title=e,Go(this.contentArea,r),this.mesh.image.value=r,this.showDialog()}};function Wl(n,t){return n==="click"&&t&&(n="error"),`InteractionAudio-${n}`}var Ls=class{constructor(t,e){this.audio=t,this.pointers=e,this.enabled=!0;let r=o=>{if(this.enabled&&o.rayTarget&&o.rayTarget.clickable){let i=Wl(o.type,!o.rayTarget.enabled);if(this.audio.hasClip(i)){let{x:s,y:p,z:c}=o.point;this.audio.setClipPosition(i,s,p,c),this.audio.playClip(i)}}};this.pointers.addEventListener("enter",r),this.pointers.addEventListener("exit",r),this.pointers.addEventListener("click",r)}async load(t,e,r,o){return await this.audio.loadClip(Wl(t,!1),e,!1,!1,!0,!1,r,[],o)}create(t,e,r){return this.audio.createClip(Wl(t,!1),e,!1,!0,!1,r,[])}};var Ko=(o=>(o.None="None",o.Fullscreen="Fullscreen",o.VR="VR",o.AR="AR",o))(Ko||{});Mt(J("#controls",Ir("absolute"),jn(0),Wn(0),xt("100%"),Ut("100%")),J("#controls",ze("grid"),Ui("20pt"),qi("auto 1fr auto"),Qi(1)),J("#controls, #controls *",El("none")),J("#controls canvas",Ut("58px")),J("#controls > .row",ze("grid"),mn("10px 5px"),un("repeat(2, auto)")),J("#controls > .row.top",Wi(1)),J("#controls > .row.middle",Wi(2,-2)),J("#controls > .row.bottom",Wi(-2)),J("#controls > .row > .cell",ze("flex")),J("#controls > .row > .cell.left",Un(1)),J("#controls > .row > .cell.right",Un(-2),pd("row-reverse")),J("#controls > .row > .cell > .btn",sd(0),Xo("#1e4388"),Ut("58px !important"),xt("58px"),hn("0.25em"),mn("0 5px"),El("initial")),J("#controls .btn-primary img",Ut("calc(100% - 0.5em)")));var ks=class{constructor(){this.element=ve(zi("controls"),ve(be("row top"),this.topRowLeft=ve(be("cell left")),this.topRowRight=ve(be("cell right"))),ve(be("row middle"),this.middleRowLeft=ve(be("cell left")),this.middleRowRight=ve(be("cell right"))),ve(be("row bottom"),this.bottomRowLeft=ve(be("cell left")),this.bottomRowRight=ve(be("cell right")))),this.cells=[[this.topRowLeft,this.topRowRight],[this.middleRowLeft,this.middleRowRight],[this.bottomRowLeft,this.bottomRowRight]]}};function Xu(n){return"height"in n}function zu(n){return"width"in n}var ql=1.25,Uu=Xe(30),dg=Xe(32),ug=new THREE.Vector3(0,0,0),Os=class extends THREE.Object3D{constructor(){super(),this.name="SpaceUI",this.position.y=-.25}addItem(t,e){t=Ue(t),G(this,t),t.position.set(ql*Math.sin(e.x*Uu),ql*Math.sin(e.y*dg),-ql*Math.cos(e.x*Uu)),Xu(e)&&zu(e)?t.scale.set(e.width,e.height,1):Xu(e)?t.scale.multiplyScalar(e.height/t.scale.y):zu(e)?t.scale.multiplyScalar(e.width/t.scale.x):t.scale.setScalar(e.scale),t.scale.z=1;for(let r of this.children)r.lookAt(ug)}};function ju(n){return re(n.vcodec)}var Ds=class extends Pt{constructor(e){super("JuniperVideoPlayer",e,Fe.instance(e));this.onTimeUpdate=null;this.wasUsingAudioElement=!1;this._data=null;this._loaded=!1;this.onError=new Map;this.sourcesByURL=new Map;this.sources=new Nn;this.potatoes=new Nn;this.video=this.createMediaElement(kd,zn(!0)),this.audio=this.createMediaElement(Qn,zn(!1)),this.input=Ve("JuniperVideoPlayer-combiner",e),this.videoSource=Kn("JuniperVideoPlayer-VideoNode",e,this.video,this.input),this.audioSource=Kn("JuniperVideoPlayer-AudioNode",e,this.audio,this.input),this.loadingEvt=new Nr(this),this.loadEvt=new xn(this),this.playEvt=new gn(this),this.pauseEvt=new vn(this),this.stopEvt=new An(this),this.progEvt=new _n(this),this.onSeeked=()=>{this.useAudioElement&&(this.audio.currentTime=this.video.currentTime)},this.onPlay=async()=>{this.connect(),this.onSeeked(),this.useAudioElement&&(await Rt(this.audioCtx),await this.audio.play()),this.dispatchEvent(this.playEvt)},this.onPause=o=>{this.disconnect(),this.useAudioElement&&(this.onSeeked(),this.audio.pause()),this.video.currentTime===0||o.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};let r=!1;this.onWaiting=()=>{this.useAudioElement&&(r=!0,this.audio.pause())},this.onCanPlay=async()=>{this.useAudioElement&&r&&(await Rt(this.audioCtx),await this.audio.play(),r=!1)},this.wasUsingAudioElement=!1,this.onTimeUpdate=async()=>{if(this.video.getVideoPlaybackQuality().totalVideoFrames===0){let i=this.onError.get(this.video);A(i)&&await i()}else if(this.useAudioElement){this.wasUsingAudioElement=!1;let i=this.video.currentTime-this.audio.currentTime;Math.abs(i)>.25&&(this.audio.currentTime=this.video.currentTime)}else this.wasUsingAudioElement||(this.wasUsingAudioElement=!0,this.audio.pause());this.progEvt.value=this.video.currentTime,this.progEvt.total=this.video.duration,this.dispatchEvent(this.progEvt)},this.video.addEventListener("seeked",this.onSeeked),this.video.addEventListener("play",this.onPlay),this.video.addEventListener("pause",this.onPause),this.video.addEventListener("ended",this.onPause),this.video.addEventListener("waiting",this.onWaiting),this.video.addEventListener("canplay",this.onCanPlay),this.video.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{videoPlayer:this})}get data(){return this._data}get loaded(){return this._loaded}get title(){return this.video.title}setTitle(e){this.video.title=e,this.audio.title=e}elementHasAudio(e){let r=this.sourcesByURL.get(e.src);return A(r)&&r.acodec!=="none"||A(e.audioTracks)&&e.audioTracks.length>0||A(e.webkitAudioDecodedByteCount)&&e.webkitAudioDecodedByteCount>0||A(e.mozHasAudio)&&e.mozHasAudio}get useAudioElement(){return!this.elementHasAudio(this.video)&&this.elementHasAudio(this.audio)}onDisposing(){super.onDisposing(),this.clear(),ee(this.input),ee(this.videoSource),ee(this.audioSource),this.video.removeEventListener("seeked",this.onSeeked),this.video.removeEventListener("play",this.onPlay),this.video.removeEventListener("pause",this.onPause),this.video.removeEventListener("ended",this.onPause),this.video.removeEventListener("waiting",this.onWaiting),this.video.removeEventListener("canplay",this.onCanPlay),this.video.removeEventListener("timeupdate",this.onTimeUpdate)}clear(){this.stop();for(let[e,r]of this.onError)e.removeEventListener("error",r);this.onError.clear(),this.sourcesByURL.clear(),this.sources.clear(),this.potatoes.clear(),this.video.src="",this.audio.src="",this.wasUsingAudioElement=!1,this._data=null,this._loaded=!1}async load(e,r){if(this.clear(),this._data=e,re(e)?(this.setTitle(e),this.potatoes.add(this.video,e)):(this.setTitle(e.title),this.fillSources(this.video,e.videos),this.fillSources(this.audio,e.audios)),!this.hasSources(this.video))throw new Error("No video sources found");if(this.dispatchEvent(this.loadingEvt),await Wc(r,o=>this.loadMediaElement(this.audio,o),o=>this.loadMediaElement(this.video,o)),!this.hasSources(this.video))throw new Error("No video playable sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}fillSources(e,r){Fn(r,o=>-o.resolution);for(let o of r)du.matches(o.contentType)||(this.sources.add(e,o),this.sourcesByURL.set(o.url,o))}createMediaElement(e,...r){return e(dn(!0),cn(!1),Sr(!1),...r)}async getMediaCapabilities(e){let r={type:"file"};ju(e)?r.video={contentType:e.contentType,bitrate:e.vbr*1024,framerate:e.fps,width:e.width,height:e.height}:e.acodec!=="none"&&(r.audio={contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr});try{return await navigator.mediaCapabilities.decodingInfo(r)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:r}}}hasSources(e){return this.sources.get(e).length>0||this.potatoes.count(e)>0}async loadMediaElement(e,r){for(A(r)&&r.start(),this.onError.has(e)&&(e.removeEventListener("error",this.onError.get(e)),this.onError.delete(e));this.hasSources(e);){let o=null,i=this.sources.get(e).shift();if(A(i)){let s=await this.getMediaCapabilities(i);if(!s.smooth||!s.powerEfficient){this.potatoes.add(e,i.url);continue}else o=i.url}else o=this.potatoes.get(e).shift();if(e.src=o,e.load(),await Ji(e)){A(i)?this.sources.get(e).unshift(i):this.potatoes.get(e).unshift(o);let s=()=>this.loadMediaElement(e,r);e.addEventListener("error",s),this.onError.set(e,s),this.wasUsingAudioElement=this.wasUsingAudioElement,A(r)&&r.end();return}}}get width(){return this.video.videoWidth}get height(){return this.video.videoHeight}get playbackState(){return D(this.data)?"empty":this.loaded?this.video.error?"errored":this.video.ended||this.video.paused&&this.video.currentTime===0?"stopped":this.video.paused?"paused":"playing":"loading"}async play(){await Rt(this.audioCtx),await this.video.play()}async playThrough(){let e=Ce(this,"stopped");await this.play(),await e}pause(){this.video.pause()}stop(){this.pause(),this.video.currentTime=0}restart(){return this.stop(),this.play()}};function mg(n){return[Wu([n[1],n[0],n[2]]),Wu([n[2],n[0],n[3]])]}function Qu(n){return n.map(mg).flat()}var Ql=new THREE.Vector3,Gu=new THREE.Vector3,Bs=new THREE.Vector3;function Wu(n){let t=[[n[0][0],n[0][1],n[0][2]],[n[1][0],n[1][1],n[1][2]],[n[2][0],n[2][1],n[2][2]]],e=[[n[0][3],n[0][4]],[n[1][3],n[1][4]],[n[2][3],n[2][4]]];Bs.fromArray(t[0]),Ql.fromArray(t[1]).sub(Bs),Bs.fromArray(t[2]),Gu.fromArray(t[1]).sub(Bs),Ql.cross(Gu);let r=Ql.toArray();return{positions:t,uvs:e,normal:r}}function Ku(n){let t=n.map(i=>i.positions).flat(2),e=n.map(i=>i.uvs).flat(2),r=n.flatMap(i=>i.normal),o=new THREE.BufferGeometry;return o.setAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3,!1)),o.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(e),2,!1)),o.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(r),3,!0)),o}function vt(...n){let t=Qu(n);return Ku(t)}function Zr(n,...t){let e=hg(t);for(let o=0;o<n;++o)e=xg(e);t=fg(e);let r=Qu(t);return Ku(r)}function hg(n){return n.map(t=>{let e=Number.MAX_VALUE,r=Number.MIN_VALUE,o=Number.MAX_VALUE,i=Number.MIN_VALUE;for(let c of t){let m=c[3],h=c[4];e=Math.min(e,m),r=Math.max(r,m),o=Math.min(o,h),i=Math.max(i,h)}let s=[e,o],p=[r-e,i-o];return{minUV:s,deltaUV:p,verts:[Fs(s,p,t[0]),Fs(s,p,t[1]),Fs(s,p,t[2]),Fs(s,p,t[3])]}})}function Fs(n,t,e){return{pos:[e[0],e[1],e[2]],uv:[e[3],e[4]],pUV:[(e[3]-n[0])/t[0],(e[4]-n[1])/t[1]]}}function fg(n){return n.map(t=>[Hs(t,0),Hs(t,1),Hs(t,2),Hs(t,3)])}function Hs(n,t){let e=n.verts[t];return[e.pos[0],e.pos[1],e.pos[2],e.uv[0],e.uv[1]]}function xg(n){return n.flatMap(t=>{let e=Yo(t,t.verts[0],t.verts[1]),r=Yo(t,t.verts[2],t.verts[3]),o=Yo(t,t.verts[0],t.verts[3]),i=Yo(t,t.verts[1],t.verts[2]),s=Yo(t,e,r);return[{minUV:t.minUV,deltaUV:t.deltaUV,verts:[t.verts[0],e,s,o]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[e,t.verts[1],i,s]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[s,i,t.verts[2],r]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[o,s,r,t.verts[3]]}]})}function Yo(n,t,e){let r=e.pos[0]-t.pos[0],o=e.pos[1]-t.pos[1],i=e.pos[2]-t.pos[2],s=t.pos[0]+.5*r,p=t.pos[1]+.5*o,c=t.pos[2]+.5*i,m=e.pUV[0]-t.pUV[0],h=e.pUV[1]-t.pUV[1],x=t.pUV[0]+.5*m,b=t.pUV[1]+.5*h,y=qu(x-.5)+.5,C=qu(b-.5)+.5,P=y*n.deltaUV[0]+n.minUV[0],S=C*n.deltaUV[1]+n.minUV[1];return{pos:[s,p,c],pUV:[x,b],uv:[P,S]}}function qu(n){return 2*Math.atan(2*n)/Math.PI}var Xs=class extends Ds{constructor(e,r){super(r);this.material=Qr({name:"videoPlayer-material"}),this.vidMeshes=[];for(let o=0;o<2;++o){let i=new Yr(e,`videoPlayer-view${o+1}`,!1,this.material);i.setTextureMap(this.video),i.mesh.renderOrder=4,o>0?i.mesh.layers.disable(0):i.mesh.layers.enable(0),this.vidMeshes.push(i)}this.object=je("videoPlayer",...this.vidMeshes)}onDisposing(){super.onDisposing(),wn(this.object),ae(this.vidMeshes)}update(e,r){for(let o of this.vidMeshes)o.update(e,r)}isSupported(e,r){return r.split("-").map(o=>Yu.has(e,o)).reduce(Sc,!0)}setStereoParameters(e,r){if(!this.isSupported(e,r))throw new Error(`Not supported [encoding: ${e}, layout: ${r}]`);for(let s=0;s<this.vidMeshes.length;++s){let p=this.vidMeshes[s];p.webXRLayersEnabled=!1,p.mesh.layers.disable(1),p.mesh.layers.disable(2),r==="left-right"||r==="top-bottom"?p.mesh.layers.enable(this.vidMeshes.length-s):r!=="mono"&&p.mesh.layers.enable(s+1)}let o=this.height/this.width;e!=="N/A"?this.vidMeshes[0].scale.setScalar(100):r==="mono"?this.vidMeshes[0].scale.set(1,o,1):r==="left-right"||r==="right-left"?this.vidMeshes[0].scale.set(1,2*o,1):this.vidMeshes[0].scale.set(1,.5*o,1);for(let s=1;s<this.vidMeshes.length;++s)this.vidMeshes[s].scale.copy(this.vidMeshes[0].scale);let i=r.split("-");for(let s=0;s<i.length;++s){let p=i[s],c=Yu.get(e,p),m=this.vidMeshes[s];m.webXRLayersEnabled=!0,m.visible=!0,m.mesh.geometry!==c&&(m.mesh.geometry.dispose(),m.mesh.geometry=c)}}},gg=vt([[-1/2,1/2,0,0,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,0,0]]),Ju=[[-1/2,1/2,0,0,1],[1/2,1/2,0,.5,1],[1/2,-1/2,0,.5,0],[-1/2,-1/2,0,0,0]],$u=[[-1/2,1/2,0,.5,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,.5,0]],Zu=[[[-1/2,1/2,-1/2,1/3,1],[1/2,1/2,-1/2,2/3,1],[1/2,-1/2,-1/2,2/3,1/2],[-1/2,-1/2,-1/2,1/3,1/2]],[[1/2,1/2,-1/2,2/3,1],[1/2,1/2,1/2,1,1],[1/2,-1/2,1/2,1,1/2],[1/2,-1/2,-1/2,2/3,1/2]],[[-1/2,1/2,1/2,0,1],[-1/2,1/2,-1/2,1/3,1],[-1/2,-1/2,-1/2,1/3,1/2],[-1/2,-1/2,1/2,0,1/2]],[[1/2,1/2,1/2,2/3,1/2],[-1/2,1/2,1/2,2/3,0],[-1/2,-1/2,1/2,1/3,0],[1/2,-1/2,1/2,1/3,1/2]],[[1/2,1/2,-1/2,1,1/2],[-1/2,1/2,-1/2,1,0],[-1/2,1/2,1/2,2/3,0],[1/2,1/2,1/2,2/3,1/2]],[[1/2,-1/2,1/2,1/3,1/2],[-1/2,-1/2,1/2,1/3,0],[-1/2,-1/2,-1/2,0,0],[1/2,-1/2,-1/2,0,1/2]]],Kl=[[[-1/2,1/2,-1/2,0,1/3],[1/2,1/2,-1/2,0,2/3],[1/2,-1/2,-1/2,1/4,2/3],[-1/2,-1/2,-1/2,1/4,1/3]],[[1/2,1/2,-1/2,0,2/3],[1/2,1/2,1/2,0,1],[1/2,-1/2,1/2,1/4,1],[1/2,-1/2,-1/2,1/4,2/3]],[[-1/2,1/2,1/2,0,0],[-1/2,1/2,-1/2,0,1/3],[-1/2,-1/2,-1/2,1/4,1/3],[-1/2,-1/2,1/2,1/4,0]],[[1/2,1/2,1/2,1/4,2/3],[-1/2,1/2,1/2,1/2,2/3],[-1/2,-1/2,1/2,1/2,1/3],[1/2,-1/2,1/2,1/4,1/3]],[[1/2,1/2,-1/2,1/4,1],[-1/2,1/2,-1/2,1/2,1],[-1/2,1/2,1/2,1/2,2/3],[1/2,1/2,1/2,1/4,2/3]],[[1/2,-1/2,1/2,1/4,1/3],[-1/2,-1/2,1/2,1/2,1/3],[-1/2,-1/2,-1/2,1/2,0],[1/2,-1/2,-1/2,1/4,0]]],Yl=[[[-1/2,1/2,-1/2,1/2,1/3],[1/2,1/2,-1/2,1/2,2/3],[1/2,-1/2,-1/2,3/4,2/3],[-1/2,-1/2,-1/2,3/4,1/3]],[[1/2,1/2,-1/2,1/2,2/3],[1/2,1/2,1/2,1/2,1],[1/2,-1/2,1/2,3/4,1],[1/2,-1/2,-1/2,3/4,2/3]],[[-1/2,1/2,1/2,1/2,0],[-1/2,1/2,-1/2,1/2,1/3],[-1/2,-1/2,-1/2,3/4,1/3],[-1/2,-1/2,1/2,3/4,0]],[[1/2,1/2,1/2,3/4,2/3],[-1/2,1/2,1/2,1,2/3],[-1/2,-1/2,1/2,1,1/3],[1/2,-1/2,1/2,3/4,1/3]],[[1/2,1/2,-1/2,3/4,1],[-1/2,1/2,-1/2,1,1],[-1/2,1/2,1/2,1,2/3],[1/2,1/2,1/2,3/4,2/3]],[[1/2,-1/2,1/2,3/4,1/3],[-1/2,-1/2,1/2,1,1/3],[-1/2,-1/2,-1/2,1,0],[1/2,-1/2,-1/2,3/4,0]]],vg=vt(Ju),Ag=vt($u),_g=vt(Jl(Ju)),bg=vt(Jl($u)),em=nm(Kl),tm=nm(Yl),Eg=vt(...Zu),yg=vt(...Kl),wg=vt(...Yl),Tg=vt(...em),Mg=vt(...tm),Jo=4,Sg=Zr(Jo,...Zu),Rg=Zr(Jo,...Kl),Pg=Zr(Jo,...Yl),Cg=Zr(Jo,...em),Ig=Zr(Jo,...tm),Yu=new Et([["N/A","mono",gg],["N/A","left",vg],["N/A","right",Ag],["N/A","top",_g],["N/A","bottom",bg],["Cubemap Strips","mono",Eg],["Cubemap Strips","left",yg],["Cubemap Strips","right",wg],["Cubemap Strips","top",Tg],["Cubemap Strips","bottom",Mg],["Equi-Angular Cubemap (YouTube)","mono",Sg],["Equi-Angular Cubemap (YouTube)","left",Rg],["Equi-Angular Cubemap (YouTube)","right",Pg],["Equi-Angular Cubemap (YouTube)","top",Cg],["Equi-Angular Cubemap (YouTube)","bottom",Ig]]);function Ns(n){return[n[0],n[1],n[2],n[4],1-n[3]]}function Jl(n){return[Ns(n[0]),Ns(n[1]),Ns(n[2]),Ns(n[3])]}function nm(n){return n.map(Jl)}var zs=class{constructor(t,e,r){this.imagePaths=t;this.padding=e;this.uvDescrips=new Et;this.geoms=new Et;this.canvas=null;this.texture=null;this.enabledMaterial=null;this.disabledMaterial=null;this.assetSets=new Et(Array.from(this.imagePaths.entries()).map(([o,i,s])=>[o,i,new xs(s,lu,!r)])),this.assets=Array.from(this.assetSets.values()),this.ready=Promise.all(this.assets).then(()=>this.finish())}finish(){let t=this.assets.map(O=>O.result),e=Math.max(...t.map(O=>O.width)),r=Math.max(...t.map(O=>O.height)),o=e*r*t.length,i=Math.sqrt(o),s=Math.floor(i/e),p=Math.ceil(t.length/s),c=s*e,m=p*r,h=al(c),x=al(m),b=c/h,y=m/x,C=e/h,P=r/x;this.canvas=vs(h,x);let S=this.canvas.getContext("2d");S.fillStyle="#1e4388",S.fillRect(0,0,h,x);let k=0;for(let[O,V,H]of this.assetSets.entries()){let N=H.result,I=k%s,B=(k-I)/s,oe=b*(I*e/c),ie=y*(1-B/p)-P,W=I*e,ne=B*r+x-m,_e=e-2*this.padding,fe=r-2*this.padding;S.drawImage(N,0,0,N.width,N.height,W+this.padding,ne+this.padding,_e,fe),this.uvDescrips.add(O,V,{u:oe,v:ie,du:C,dv:P}),++k}this.texture=new THREE.CanvasTexture(this.canvas),this.enabledMaterial=new THREE.MeshBasicMaterial({map:this.texture}),this.enabledMaterial.needsUpdate=!0,this.disabledMaterial=new THREE.MeshBasicMaterial({map:this.texture,transparent:!0,opacity:.5}),this.disabledMaterial.needsUpdate=!0}getSets(){return Array.from(this.imagePaths.keys())}getIcons(t){if(!this.imagePaths.has(t))throw new yt(`Button set ${t} does not exist`);return Array.from(this.imagePaths.get(t).keys())}async getMaterial(t){return await this.ready,t?this.enabledMaterial:this.disabledMaterial}async getGeometry(t,e){await this.ready;let r=this.uvDescrips.get(t),o=r&&r.get(e);if(!r||!o)throw new yt(`Button ${t}/${e} does not exist`,this.uvDescrips);let i=this.geoms.get(t,e);if(!i){i=new THREE.PlaneBufferGeometry(1,1,1,1),i.name=`Geometry:${t}/${e}`,this.geoms.add(t,e,i);let s=i.getAttribute("uv");for(let p=0;p<s.count;++p){let c=s.getX(p)*o.du+o.u,m=s.getY(p)*o.dv+o.v;s.setX(p,c),s.setY(p,m)}}return i}async getGeometryAndMaterials(t,e){let[r,o,i]=await Promise.all([this.getGeometry(t,e),this.getMaterial(!0),this.getMaterial(!1)]);return{geometry:r,enabledMaterial:o,disabledMaterial:i}}getImageSrc(t,e){let r=this.imagePaths.get(t),o=r&&r.get(e);if(!r||!o)throw new yt(`Button ${t}/${e} does not exist`,this.uvDescrips);return o}getImageElement(t,e){return Lr(Rr(t+" "+e),No(this.getImageSrc(t,e)))}};var tr=class extends er{constructor(e,r,o,i,s){e=e+ft(16);super(je(e));this.enabledMesh=this.createMesh(`${e}-enabled`,r,o),this.disabledMesh=this.createMesh(`${e}-disabled`,r,i),this.disabledMesh.visible=!1,this.size=s,G(this,this.enabledMesh,this.disabledMesh),this.addMesh(this.enabledMesh),this.addMesh(this.disabledMesh),this.clickable=!0,this.disabled=this.disabled,Ms(this,!0)}get size(){return this.enabledMesh.scale.x}set size(e){this.enabledMesh.scale.setScalar(e),this.disabledMesh.scale.setScalar(e)}createMesh(e,r,o){let i=new THREE.Mesh(r,o);return i.name="Mesh-"+e,i}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.enabledMesh.visible=!e,this.disabledMesh.visible=e}};var eo=class{constructor(t,e,r){this.mesh=null;this.element=Vr(Rr(r),t.getImageElement(e,r)),this.object=je(`${name}-button`),this.load(t,e,r)}async load(t,e,r){let{geometry:o,enabledMaterial:i,disabledMaterial:s}=await t.getGeometryAndMaterials(e,r);this.mesh=new tr(r,o,i,s,.2),G(this,this.mesh),this.mesh.object.visible=this.visible,this.mesh.addEventListener("click",()=>{this.element.click()})}get name(){return this.object.name}addEventListener(t,e,r){this.element.addEventListener(t,e,r)}dispatchEvent(t){return this.element.dispatchEvent(t)}removeEventListener(t,e,r){this.element.removeEventListener(t,e,r)}click(){this.element.click()}get visible(){return Tt(this)}set visible(t){Se(this,t,"inline-block"),this.mesh&&(this.mesh.object.visible=t)}};var nr=class{constructor(t,e,r,o){this.buttons=t;this.setName=e;this.activeName=r;this.inactiveName=o;this.enterButton=null;this.exitButton=null;this._isAvailable=!0;this._isEnabled=!0;this._isVisible=!0;this._isActive=!1;this.element=Vr(this.btnImage=Lr()),this.object=je(`${this.setName}-button`),this.load()}get name(){return this.object.name}addEventListener(t,e,r){this.element.addEventListener(t,e,r)}dispatchEvent(t){return this.element.dispatchEvent(t)}removeEventListener(t,e,r){this.element.removeEventListener(t,e,r)}click(){this.element.click()}async load(){let[t,e]=await Promise.all([this.buttons.getGeometryAndMaterials(this.setName,this.activeName),this.buttons.getGeometryAndMaterials(this.setName,this.inactiveName)]);G(this.object,this.enterButton=new tr(`${this.setName}-activate-button`,t.geometry,t.enabledMaterial,t.disabledMaterial,.2),this.exitButton=new tr(`${this.setName}-deactivate-button`,e.geometry,e.enabledMaterial,e.disabledMaterial,.2)),this.enterButton.addEventListener("click",()=>this.element.click()),this.exitButton.addEventListener("click",()=>this.element.click()),this.refreshState()}get mesh(){return this.active?this.enterButton:this.exitButton}get available(){return this._isAvailable}set available(t){this._isAvailable=t,this.refreshState()}get active(){return this._isActive}set active(t){this._isActive=t,this.refreshState()}get enabled(){return this._isEnabled}set enabled(t){this._isEnabled=t,this.refreshState()}get visible(){return this._isVisible}set visible(t){this._isVisible=t,this.refreshState()}refreshState(){let t=this.active?this.inactiveName:this.activeName,e=`${t} ${this.setName}`;if(this.element.title=this.btnImage.title=e,this.btnImage.src=this.buttons.getImageSrc(this.setName,t),qn(this,this.available&&this.visible&&this.enabled,"primary"),Se(this,this.available&&this.visible,"inline-block"),this.enterButton&&this.exitButton){Ts(this,this.available&&this.visible&&this.enabled);let r=Ie(this.object,this.available&&this.visible);Ie(this.enterButton,r&&!this.active),Ie(this.exitButton,r&&this.active)}}};var $o=class extends nr{constructor(e,r){let o=Ko[r];super(e,o.toLowerCase(),"enter","exit");this.mode=r}};function $l(n,t,e){n.element instanceof HTMLButtonElement&&qn(n,t,e),Ts(n,t)}var Zo=class extends j{constructor(e,r){super(e);this.appName=r}},Zl=class extends Zo{constructor(e,r){super("apploading",e);this.appLoadParams=r;this.preLoadTask=null}},ep=class extends Zo{constructor(e,r){super("apploaded",e);this.app=r}},tp=class extends Zo{constructor(e,r){super("appshown",e);this.app=r}},np=class{constructor(t,e){this.loader=t;this.name=e;this.params=new Map}param(t,e){return this.params.set(t,e),this}load(t){return this.loader(this.name,this.params,t)}},Us=class extends q{constructor(e){super();this.env=e;this.loadedModules=new Map;this.loadingApps=new Map;this.currentApps=new Map;this.cacheBustString=null}[Symbol.iterator](){return this.currentApps.values()}isLoaded(e){return this.currentApps.has(e)}get(e){return this.currentApps.get(e)}waitFor(e){return this.isLoaded(e)?Promise.resolve(this.get(e)):new Promise(r=>{let o=i=>{i.appName===e&&(this.removeEventListener("apploaded",o),r(i.app))};this.addEventListener("apploaded",o)})}async loadAppConstructor(e,r){if(this.loadedModules.has(e))A(r)&&r.end();else{let i=this.env.DEBUG?".js":".min.js",s=`/js/${e}/index${i}`;if(A(this.cacheBustString)){let c=new Xi(s,location.href);c.query("v",this.cacheBustString),s=c.toString()}let p=this.env.fetcher.get(s).progress(r).useCache(!this.env.DEBUG).module();this.loadedModules.set(e,p)}let{default:o}=await this.loadedModules.get(e);return o}app(e){return new np(this.loadApp.bind(this),e)}loadApp(e,r,o){let i=null;r instanceof Map?i=r:o=r,o=o||this.env.loadingBar;let s=new Zl(e,i);this.dispatchEvent(s);let p=s.preLoadTask||Promise.resolve();if(!this.loadingApps.has(e)){let m=jc(o),h=p.then(()=>this.loadAppInstance(this.env,e,i,m.pop(10)));this.loadingApps.set(e,h),o=m.pop(1)}return this.loadingApps.get(e).then(async m=>(await m.show(o),this.dispatchEvent(new tp(e,m)),m))}async loadAppInstance(e,r,o,i){if(!this.currentApps.has(r)){let[s,p]=Bo(i,[1,10]),c=await this.loadAppConstructor(r,s),m=new c(e);m.addEventListener("quit",()=>this.unloadApp(r)),A(o)&&await m.init(o),await m.load(p),this.currentApps.set(r,m),this.dispatchEvent(new ep(r,m))}return A(i)&&i.end(),this.currentApps.get(r)}unloadApp(e){let r=this.currentApps.get(e);r.clearEventListeners(),r.dispose(),this.currentApps.delete(e),this.loadingApps.delete(e)}};var ei=new THREE.Vector3;function js(n){return ei.copy(n),ei.y=0,ei.normalize(),pn(Math.atan2(ei.x,ei.z))}function rm(n){return pn(Math.asin(n.y))}var to=new THREE.Vector3,om=0,Vg=new THREE.Vector3,Gs=new THREE.Vector3,rp=new THREE.Vector3,Ws=new THREE.Quaternion,im=0,Lg=0;function kg(n,t){let e=n-t,r=e+2*Math.PI,o=e-2*Math.PI,i=Math.abs(e),s=Math.abs(r),p=Math.abs(o);return i<s&&i<p?e:s<p?r:o}var qs=class extends THREE.Object3D{constructor(e,r,o,i,s=1){super();this.minDistance=r;this.heightOffset=i;this.speed=s;this.name=e,this.lerp=this.minAngle>0||this.minDistance>0,this.maxDistance=this.minDistance*5,this.minAngle=Xe(o),this.maxAngle=Math.PI-this.minAngle,Object.seal(this)}copy(e,r=!0){return super.copy(e,r),this.name=e.name+ ++Lg,this.lerp=e.lerp,this.maxDistance=e.maxDistance,this.minAngle=e.minAngle,this.maxAngle=e.maxAngle,this}update(e,r,o,i){i*=.001,this.clampTo(this.lerp,e,r,this.minDistance,this.maxDistance,o,this.minAngle,this.maxAngle,i)}reset(e,r,o){this.clampTo(!1,e,r,0,0,o,0,0,0)}clampTo(e,r,o,i,s,p,c,m,h){to.copy(o),to.y-=this.heightOffset*r,om=p,this.getWorldPosition(Gs),this.getWorldDirection(rp),rp.negate(),im=js(rp),Ws.identity();let x=!e,b=!e;if(e){let y=Vg.copy(to).sub(Gs).length();i<y&&(y<s&&to.lerpVectors(Gs,to,this.speed*h),x=!0);let C=kg(om,im),P=Math.abs(C);c<P&&(P<m?Ws.setFromAxisAngle(this.up,C*this.speed*h):Ws.setFromAxisAngle(this.up,C),b=!0)}(x||b)&&(x&&this.position.add(to.sub(Gs)),b&&this.quaternion.multiply(Ws))}};var Mn=class extends THREE.Loader{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new ap(e)}),this.register(function(e){return new mp(e)}),this.register(function(e){return new hp(e)}),this.register(function(e){return new lp(e)}),this.register(function(e){return new pp(e)}),this.register(function(e){return new cp(e)}),this.register(function(e){return new dp(e)}),this.register(function(e){return new up(e)}),this.register(function(e){return new ip(e)}),this.register(function(e){return new fp(e)})}load(t,e,r,o){let i=this,s;this.resourcePath!==""?s=this.resourcePath:this.path!==""?s=this.path:s=THREE.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);let p=function(m){o?o(m):console.error(m),i.manager.itemError(t),i.manager.itemEnd(t)},c=new THREE.FileLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,function(m){try{i.parse(m,s,function(h){e(h),i.manager.itemEnd(t)},p)}catch(h){p(h)}},r,p)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,r,o){let i,s={},p={};if(typeof t=="string")i=t;else if(THREE.LoaderUtils.decodeText(new Uint8Array(t,0,4))===mm){try{s[Y.KHR_BINARY_GLTF]=new xp(t)}catch(x){o&&o(x);return}i=s[Y.KHR_BINARY_GLTF].content}else i=THREE.LoaderUtils.decodeText(new Uint8Array(t));let c=JSON.parse(i);if(c.asset===void 0||c.asset.version[0]<2){o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let m=new wp(c,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});m.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){let x=this.pluginCallbacks[h](m);p[x.name]=x,s[x.name]=!0}if(c.extensionsUsed)for(let h=0;h<c.extensionsUsed.length;++h){let x=c.extensionsUsed[h],b=c.extensionsRequired||[];switch(x){case Y.KHR_MATERIALS_UNLIT:s[x]=new sp;break;case Y.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[x]=new Ap;break;case Y.KHR_DRACO_MESH_COMPRESSION:s[x]=new gp(c,this.dracoLoader);break;case Y.KHR_TEXTURE_TRANSFORM:s[x]=new vp;break;case Y.KHR_MESH_QUANTIZATION:s[x]=new _p;break;default:b.indexOf(x)>=0&&p[x]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+x+'".')}}m.setExtensions(s),m.setPlugins(p),m.parse(r,o)}parseAsync(t,e){let r=this;return new Promise(function(o,i){r.parse(t,e,o,i)})}};function Og(){let n={};return{get:function(t){return n[t]},add:function(t,e){n[t]=e},remove:function(t){delete n[t]},removeAll:function(){n={}}}}var Y={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},ip=class{constructor(t){this.parser=t,this.name=Y.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let t=this.parser,e=this.parser.json.nodes||[];for(let r=0,o=e.length;r<o;r++){let i=e[r];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){let e=this.parser,r="light:"+t,o=e.cache.get(r);if(o)return o;let i=e.json,c=((i.extensions&&i.extensions[this.name]||{}).lights||[])[t],m,h=new THREE.Color(16777215);c.color!==void 0&&h.fromArray(c.color);let x=c.range!==void 0?c.range:0;switch(c.type){case"directional":m=new THREE.DirectionalLight(h),m.target.position.set(0,0,-1),m.add(m.target);break;case"point":m=new THREE.PointLight(h),m.distance=x;break;case"spot":m=new THREE.SpotLight(h),m.distance=x,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,m.angle=c.spot.outerConeAngle,m.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,m.target.position.set(0,0,-1),m.add(m.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return m.position.set(0,0,0),m.decay=2,c.intensity!==void 0&&(m.intensity=c.intensity),m.name=e.createUniqueName(c.name||"light_"+t),o=Promise.resolve(m),e.cache.add(r,o),o}createNodeAttachment(t){let e=this,r=this.parser,i=r.json.nodes[t],p=(i.extensions&&i.extensions[this.name]||{}).light;return p===void 0?null:this._loadLight(p).then(function(c){return r._getNodeRef(e.cache,p,c)})}},sp=class{constructor(){this.name=Y.KHR_MATERIALS_UNLIT}getMaterialType(){return THREE.MeshBasicMaterial}extendParams(t,e,r){let o=[];t.color=new THREE.Color(1,1,1),t.opacity=1;let i=e.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){let s=i.baseColorFactor;t.color.fromArray(s),t.opacity=s[3]}i.baseColorTexture!==void 0&&o.push(r.assignTexture(t,"map",i.baseColorTexture))}return Promise.all(o)}},ap=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[],s=o.extensions[this.name];if(s.clearcoatFactor!==void 0&&(e.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&i.push(r.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&i.push(r.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(i.push(r.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){let p=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new THREE.Vector2(p,p)}return Promise.all(i)}},lp=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_SHEEN}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[];e.sheenColor=new THREE.Color(0,0,0),e.sheenRoughness=0,e.sheen=1;let s=o.extensions[this.name];return s.sheenColorFactor!==void 0&&e.sheenColor.fromArray(s.sheenColorFactor),s.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&i.push(r.assignTexture(e,"sheenColorMap",s.sheenColorTexture)),s.sheenRoughnessTexture!==void 0&&i.push(r.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(i)}},pp=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[],s=o.extensions[this.name];return s.transmissionFactor!==void 0&&(e.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&i.push(r.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(i)}},cp=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_VOLUME}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[],s=o.extensions[this.name];e.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&i.push(r.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||0;let p=s.attenuationColor||[1,1,1];return e.attenuationColor=new THREE.Color(p[0],p[1],p[2]),Promise.all(i)}},dp=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_IOR}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let o=this.parser.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=o.extensions[this.name];return e.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}},up=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_SPECULAR}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[],s=o.extensions[this.name];e.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&i.push(r.assignTexture(e,"specularIntensityMap",s.specularTexture));let p=s.specularColorFactor||[1,1,1];return e.specularColor=new THREE.Color(p[0],p[1],p[2]),s.specularColorTexture!==void 0&&i.push(r.assignTexture(e,"specularColorMap",s.specularColorTexture).then(function(c){c.encoding=THREE.sRGBEncoding})),Promise.all(i)}},mp=class{constructor(t){this.parser=t,this.name=Y.KHR_TEXTURE_BASISU}loadTexture(t){let e=this.parser,r=e.json,o=r.textures[t];if(!o.extensions||!o.extensions[this.name])return null;let i=o.extensions[this.name],s=r.images[i.source],p=e.options.ktx2Loader;if(!p){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,s,p)}},hp=class{constructor(t){this.parser=t,this.name=Y.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){let e=this.name,r=this.parser,o=r.json,i=o.textures[t];if(!i.extensions||!i.extensions[e])return null;let s=i.extensions[e],p=o.images[s.source],c=r.textureLoader;if(p.uri){let m=r.options.manager.getHandler(p.uri);m!==null&&(c=m)}return this.detectSupport().then(function(m){if(m)return r.loadTextureImage(t,p,c);if(o.extensionsRequired&&o.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){let e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}},fp=class{constructor(t){this.name=Y.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){let e=this.parser.json,r=e.bufferViews[t];if(r.extensions&&r.extensions[this.name]){let o=r.extensions[this.name],i=this.parser.getDependency("buffer",o.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,s.ready]).then(function(p){let c=o.byteOffset||0,m=o.byteLength||0,h=o.count,x=o.byteStride,b=new ArrayBuffer(h*x),y=new Uint8Array(p[0],c,m);return s.decodeGltfBuffer(new Uint8Array(b),h,x,y,o.mode,o.filter),b})}else return null}},mm="glTF",ti=12,sm={JSON:1313821514,BIN:5130562},xp=class{constructor(t){this.name=Y.KHR_BINARY_GLTF,this.content=null,this.body=null;let e=new DataView(t,0,ti);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==mm)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-ti,o=new DataView(t,ti),i=0;for(;i<r;){let s=o.getUint32(i,!0);i+=4;let p=o.getUint32(i,!0);if(i+=4,p===sm.JSON){let c=new Uint8Array(t,ti+i,s);this.content=THREE.LoaderUtils.decodeText(c)}else if(p===sm.BIN){let c=ti+i;this.body=t.slice(c,c+s)}i+=s}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},gp=class{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Y.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){let r=this.json,o=this.dracoLoader,i=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,p={},c={},m={};for(let h in s){let x=Ep[h]||h.toLowerCase();p[x]=s[h]}for(let h in t.attributes){let x=Ep[h]||h.toLowerCase();if(s[h]!==void 0){let b=r.accessors[t.attributes[h]],y=oi[b.componentType];m[x]=y,c[x]=b.normalized===!0}}return e.getDependency("bufferView",i).then(function(h){return new Promise(function(x){o.decodeDracoFile(h,function(b){for(let y in b.attributes){let C=b.attributes[y],P=c[y];P!==void 0&&(C.normalized=P)}x(b)},p,m)})})}},vp=class{constructor(){this.name=Y.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return e.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}},ri=class extends THREE.MeshStandardMaterial{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;let e=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),r=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),o=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),p={specular:{value:new THREE.Color().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=p,this.onBeforeCompile=function(c){for(let m in p)c.uniforms[m]=p[m];c.fragmentShader=c.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",o).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return p.specular.value},set:function(c){p.specular.value=c}},specularMap:{get:function(){return p.specularMap.value},set:function(c){p.specularMap.value=c,c?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return p.glossiness.value},set:function(c){p.glossiness.value=c}},glossinessMap:{get:function(){return p.glossinessMap.value},set:function(c){p.glossinessMap.value=c,c?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}},Ap=class{constructor(){this.name=Y.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return ri}extendParams(t,e,r){let o=e.extensions[this.name];t.color=new THREE.Color(1,1,1),t.opacity=1;let i=[];if(Array.isArray(o.diffuseFactor)){let s=o.diffuseFactor;t.color.fromArray(s),t.opacity=s[3]}if(o.diffuseTexture!==void 0&&i.push(r.assignTexture(t,"map",o.diffuseTexture)),t.emissive=new THREE.Color(0,0,0),t.glossiness=o.glossinessFactor!==void 0?o.glossinessFactor:1,t.specular=new THREE.Color(1,1,1),Array.isArray(o.specularFactor)&&t.specular.fromArray(o.specularFactor),o.specularGlossinessTexture!==void 0){let s=o.specularGlossinessTexture;i.push(r.assignTexture(t,"glossinessMap",s)),i.push(r.assignTexture(t,"specularMap",s))}return Promise.all(i)}createMaterial(t){let e=new ri(t);return e.fog=!0,e.color=t.color,e.map=t.map===void 0?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=t.aoMap===void 0?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=t.emissiveMap===void 0?null:t.emissiveMap,e.bumpMap=t.bumpMap===void 0?null:t.bumpMap,e.bumpScale=1,e.normalMap=t.normalMap===void 0?null:t.normalMap,e.normalMapType=THREE.TangentSpaceNormalMap,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=t.specularMap===void 0?null:t.specularMap,e.specular=t.specular,e.glossinessMap=t.glossinessMap===void 0?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=t.envMap===void 0?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}},_p=class{constructor(){this.name=Y.KHR_MESH_QUANTIZATION}},Kt=class extends THREE.Interpolant{constructor(t,e,r,o){super(t,e,r,o)}copySampleValue_(t){let e=this.resultBuffer,r=this.sampleValues,o=this.valueSize,i=t*o*3+o;for(let s=0;s!==o;s++)e[s]=r[i+s];return e}};Kt.prototype.beforeStart_=Kt.prototype.copySampleValue_;Kt.prototype.afterEnd_=Kt.prototype.copySampleValue_;Kt.prototype.interpolate_=function(n,t,e,r){let o=this.resultBuffer,i=this.sampleValues,s=this.valueSize,p=s*2,c=s*3,m=r-t,h=(e-t)/m,x=h*h,b=x*h,y=n*c,C=y-c,P=-2*b+3*x,S=b-x,k=1-P,O=S-x+h;for(let V=0;V!==s;V++){let H=i[C+V+s],N=i[C+V+p]*m,I=i[y+V+s],B=i[y+V]*m;o[V]=k*H+O*N+P*I+S*B}return o};var Dg=new THREE.Quaternion,bp=class extends Kt{interpolate_(t,e,r,o){let i=super.interpolate_(t,e,r,o);return Dg.fromArray(i).normalize().toArray(i),i}},Qt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},oi={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},am={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},lm={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},pm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ep={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Tn={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Bg={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},op={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Fg(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),n.DefaultMaterial}function ni(n,t,e){for(let r in e.extensions)n[r]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=e.extensions[r])}function rr(n,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(n.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Hg(n,t,e){let r=!1,o=!1;for(let p=0,c=t.length;p<c;p++){let m=t[p];if(m.POSITION!==void 0&&(r=!0),m.NORMAL!==void 0&&(o=!0),r&&o)break}if(!r&&!o)return Promise.resolve(n);let i=[],s=[];for(let p=0,c=t.length;p<c;p++){let m=t[p];if(r){let h=m.POSITION!==void 0?e.getDependency("accessor",m.POSITION):n.attributes.position;i.push(h)}if(o){let h=m.NORMAL!==void 0?e.getDependency("accessor",m.NORMAL):n.attributes.normal;s.push(h)}}return Promise.all([Promise.all(i),Promise.all(s)]).then(function(p){let c=p[0],m=p[1];return r&&(n.morphAttributes.position=c),o&&(n.morphAttributes.normal=m),n.morphTargetsRelative=!0,n})}function Ng(n,t){if(n.updateMorphTargets(),t.weights!==void 0)for(let e=0,r=t.weights.length;e<r;e++)n.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){let e=t.extras.targetNames;if(n.morphTargetInfluences.length===e.length){n.morphTargetDictionary={};for(let r=0,o=e.length;r<o;r++)n.morphTargetDictionary[e[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Xg(n){let t=n.extensions&&n.extensions[Y.KHR_DRACO_MESH_COMPRESSION],e;return t?e="draco:"+t.bufferView+":"+t.indices+":"+cm(t.attributes):e=n.indices+":"+cm(n.attributes)+":"+n.mode,e}function cm(n){let t="",e=Object.keys(n).sort();for(let r=0,o=e.length;r<o;r++)t+=e[r]+":"+n[e[r]]+";";return t}function yp(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var wp=class{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new Og,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap<"u"&&/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!1?this.textureLoader=new THREE.ImageBitmapLoader(this.options.manager):this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){let r=this,o=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(s){let p={scene:s[0][o.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:o.asset,parser:r,userData:{}};ni(i,p,o),rr(p,o),Promise.all(r._invokeAll(function(c){return c.afterRoot&&c.afterRoot(p)})).then(function(){t(p)})}).catch(e)}_markDefs(){let t=this.json.nodes||[],e=this.json.skins||[],r=this.json.meshes||[];for(let o=0,i=e.length;o<i;o++){let s=e[o].joints;for(let p=0,c=s.length;p<c;p++)t[s[p]].isBone=!0}for(let o=0,i=t.length;o<i;o++){let s=t[o];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(r[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,r){if(t.refs[e]<=1)return r;let o=r.clone(),i=(s,p)=>{let c=this.associations.get(s);c!=null&&this.associations.set(p,c);for(let[m,h]of s.children.entries())i(h,p.children[m])};return i(r,o),o.name+="_instance_"+t.uses[e]++,o}_invokeOne(t){let e=Object.values(this.plugins);e.push(this);for(let r=0;r<e.length;r++){let o=t(e[r]);if(o)return o}return null}_invokeAll(t){let e=Object.values(this.plugins);e.unshift(this);let r=[];for(let o=0;o<e.length;o++){let i=t(e[o]);i&&r.push(i)}return r}getDependency(t,e){let r=t+":"+e,o=this.cache.get(r);if(!o){switch(t){case"scene":o=this.loadScene(e);break;case"node":o=this.loadNode(e);break;case"mesh":o=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(e)});break;case"accessor":o=this.loadAccessor(e);break;case"bufferView":o=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(e)});break;case"buffer":o=this.loadBuffer(e);break;case"material":o=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(e)});break;case"texture":o=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(e)});break;case"skin":o=this.loadSkin(e);break;case"animation":o=this.loadAnimation(e);break;case"camera":o=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(r,o)}return o}getDependencies(t){let e=this.cache.get(t);if(!e){let r=this,o=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(o.map(function(i,s){return r.getDependency(t,s)})),this.cache.add(t,e)}return e}loadBuffer(t){let e=this.json.buffers[t],r=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[Y.KHR_BINARY_GLTF].body);let o=this.options;return new Promise(function(i,s){r.load(THREE.LoaderUtils.resolveURL(e.uri,o.path),i,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){let e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(r){let o=e.byteLength||0,i=e.byteOffset||0;return r.slice(i,i+o)})}loadAccessor(t){let e=this,r=this.json,o=this.json.accessors[t];if(o.bufferView===void 0&&o.sparse===void 0)return Promise.resolve(null);let i=[];return o.bufferView!==void 0?i.push(this.getDependency("bufferView",o.bufferView)):i.push(null),o.sparse!==void 0&&(i.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(i).then(function(s){let p=s[0],c=pm[o.type],m=oi[o.componentType],h=m.BYTES_PER_ELEMENT,x=h*c,b=o.byteOffset||0,y=o.bufferView!==void 0?r.bufferViews[o.bufferView].byteStride:void 0,C=o.normalized===!0,P,S;if(y&&y!==x){let k=Math.floor(b/y),O="THREE.InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+k+":"+o.count,V=e.cache.get(O);V||(P=new m(p,k*y,o.count*y/h),V=new THREE.InterleavedBuffer(P,y/h),e.cache.add(O,V)),S=new THREE.InterleavedBufferAttribute(V,c,b%y/h,C)}else p===null?P=new m(o.count*c):P=new m(p,b,o.count*c),S=new THREE.BufferAttribute(P,c,C);if(o.sparse!==void 0){let k=pm.SCALAR,O=oi[o.sparse.indices.componentType],V=o.sparse.indices.byteOffset||0,H=o.sparse.values.byteOffset||0,N=new O(s[1],V,o.sparse.count*k),I=new m(s[2],H,o.sparse.count*c);p!==null&&(S=new THREE.BufferAttribute(S.array.slice(),S.itemSize,S.normalized));for(let B=0,oe=N.length;B<oe;B++){let ie=N[B];if(S.setX(ie,I[B*c]),c>=2&&S.setY(ie,I[B*c+1]),c>=3&&S.setZ(ie,I[B*c+2]),c>=4&&S.setW(ie,I[B*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.")}}return S})}loadTexture(t){let e=this.json,r=this.options,o=e.textures[t],i=e.images[o.source],s=this.textureLoader;if(i.uri){let p=r.manager.getHandler(i.uri);p!==null&&(s=p)}return this.loadTextureImage(t,i,s)}loadTextureImage(t,e,r){let o=this,i=this.json,s=this.options,p=i.textures[t],c=(e.uri||e.bufferView)+":"+p.sampler;if(this.textureCache[c])return this.textureCache[c];let m=self.URL||self.webkitURL,h=e.uri||"",x=!1;if(e.bufferView!==void 0)h=o.getDependency("bufferView",e.bufferView).then(function(y){x=!0;let C=new Blob([y],{type:e.mimeType});return h=m.createObjectURL(C),h});else if(e.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");let b=Promise.resolve(h).then(function(y){return new Promise(function(C,P){let S=C;r.isImageBitmapLoader===!0&&(S=function(k){let O=new THREE.Texture(k);O.needsUpdate=!0,C(O)}),r.load(THREE.LoaderUtils.resolveURL(y,s.path),S,void 0,P)})}).then(function(y){x===!0&&m.revokeObjectURL(h),y.flipY=!1,p.name&&(y.name=p.name);let P=(i.samplers||{})[p.sampler]||{};return y.magFilter=am[P.magFilter]||THREE.LinearFilter,y.minFilter=am[P.minFilter]||THREE.LinearMipmapLinearFilter,y.wrapS=lm[P.wrapS]||THREE.RepeatWrapping,y.wrapT=lm[P.wrapT]||THREE.RepeatWrapping,o.associations.set(y,{textures:t}),y}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",h),null});return this.textureCache[c]=b,b}assignTexture(t,e,r){let o=this;return this.getDependency("texture",r.index).then(function(i){if(r.texCoord!==void 0&&r.texCoord!=0&&!(e==="aoMap"&&r.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+e+" not yet supported."),o.extensions[Y.KHR_TEXTURE_TRANSFORM]){let s=r.extensions!==void 0?r.extensions[Y.KHR_TEXTURE_TRANSFORM]:void 0;if(s){let p=o.associations.get(i);i=o.extensions[Y.KHR_TEXTURE_TRANSFORM].extendTexture(i,s),o.associations.set(i,p)}}return t[e]=i,i})}assignFinalMaterial(t){let e=t.geometry,r=t.material,o=e.attributes.tangent===void 0,i=e.attributes.color!==void 0,s=e.attributes.normal===void 0;if(t.isPoints){let p="THREE.PointsMaterial:"+r.uuid,c=this.cache.get(p);c||(c=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(c,r),c.color.copy(r.color),c.map=r.map,c.sizeAttenuation=!1,this.cache.add(p,c)),r=c}else if(t.isLine){let p="THREE.LineBasicMaterial:"+r.uuid,c=this.cache.get(p);c||(c=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(c,r),c.color.copy(r.color),this.cache.add(p,c)),r=c}if(o||i||s){let p="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(p+="specular-glossiness:"),o&&(p+="derivative-tangents:"),i&&(p+="vertex-colors:"),s&&(p+="flat-shading:");let c=this.cache.get(p);c||(c=r.clone(),i&&(c.vertexColors=!0),s&&(c.flatShading=!0),o&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(p,c),this.associations.set(c,this.associations.get(r))),r=c}r.aoMap&&e.attributes.uv2===void 0&&e.attributes.uv!==void 0&&e.setAttribute("uv2",e.attributes.uv),t.material=r}getMaterialType(){return THREE.MeshStandardMaterial}loadMaterial(t){let e=this,r=this.json,o=this.extensions,i=r.materials[t],s,p={},c=i.extensions||{},m=[];if(c[Y.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){let x=o[Y.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=x.getMaterialType(),m.push(x.extendParams(p,i,e))}else if(c[Y.KHR_MATERIALS_UNLIT]){let x=o[Y.KHR_MATERIALS_UNLIT];s=x.getMaterialType(),m.push(x.extendParams(p,i,e))}else{let x=i.pbrMetallicRoughness||{};if(p.color=new THREE.Color(1,1,1),p.opacity=1,Array.isArray(x.baseColorFactor)){let b=x.baseColorFactor;p.color.fromArray(b),p.opacity=b[3]}x.baseColorTexture!==void 0&&m.push(e.assignTexture(p,"map",x.baseColorTexture)),p.metalness=x.metallicFactor!==void 0?x.metallicFactor:1,p.roughness=x.roughnessFactor!==void 0?x.roughnessFactor:1,x.metallicRoughnessTexture!==void 0&&(m.push(e.assignTexture(p,"metalnessMap",x.metallicRoughnessTexture)),m.push(e.assignTexture(p,"roughnessMap",x.metallicRoughnessTexture))),s=this._invokeOne(function(b){return b.getMaterialType&&b.getMaterialType(t)}),m.push(Promise.all(this._invokeAll(function(b){return b.extendMaterialParams&&b.extendMaterialParams(t,p)})))}i.doubleSided===!0&&(p.side=THREE.DoubleSide);let h=i.alphaMode||op.OPAQUE;if(h===op.BLEND?(p.transparent=!0,p.depthWrite=!1):(p.transparent=!1,h===op.MASK&&(p.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&s!==THREE.MeshBasicMaterial&&(m.push(e.assignTexture(p,"normalMap",i.normalTexture)),p.normalScale=new THREE.Vector2(1,1),i.normalTexture.scale!==void 0)){let x=i.normalTexture.scale;p.normalScale.set(x,x)}return i.occlusionTexture!==void 0&&s!==THREE.MeshBasicMaterial&&(m.push(e.assignTexture(p,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(p.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&s!==THREE.MeshBasicMaterial&&(p.emissive=new THREE.Color().fromArray(i.emissiveFactor)),i.emissiveTexture!==void 0&&s!==THREE.MeshBasicMaterial&&m.push(e.assignTexture(p,"emissiveMap",i.emissiveTexture)),Promise.all(m).then(function(){let x;return s===ri?x=o[Y.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(p):x=new s(p),i.name&&(x.name=i.name),x.map&&(x.map.encoding=THREE.sRGBEncoding),x.emissiveMap&&(x.emissiveMap.encoding=THREE.sRGBEncoding),rr(x,i),e.associations.set(x,{materials:t}),i.extensions&&ni(o,x,i),x})}createUniqueName(t){let e=THREE.PropertyBinding.sanitizeNodeName(t||""),r=e;for(let o=1;this.nodeNamesUsed[r];++o)r=e+"_"+o;return this.nodeNamesUsed[r]=!0,r}loadGeometries(t){let e=this,r=this.extensions,o=this.primitiveCache;function i(p){return r[Y.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(p,e).then(function(c){return dm(c,p,e)})}let s=[];for(let p=0,c=t.length;p<c;p++){let m=t[p],h=Xg(m),x=o[h];if(x)s.push(x.promise);else{let b;m.extensions&&m.extensions[Y.KHR_DRACO_MESH_COMPRESSION]?b=i(m):b=dm(new THREE.BufferGeometry,m,e),o[h]={primitive:m,promise:b},s.push(b)}}return Promise.all(s)}loadMesh(t){let e=this,r=this.json,o=this.extensions,i=r.meshes[t],s=i.primitives,p=[];for(let c=0,m=s.length;c<m;c++){let h=s[c].material===void 0?Fg(this.cache):this.getDependency("material",s[c].material);p.push(h)}return p.push(e.loadGeometries(s)),Promise.all(p).then(function(c){let m=c.slice(0,c.length-1),h=c[c.length-1],x=[];for(let y=0,C=h.length;y<C;y++){let P=h[y],S=s[y],k,O=m[y];if(S.mode===Qt.TRIANGLES||S.mode===Qt.TRIANGLE_STRIP||S.mode===Qt.TRIANGLE_FAN||S.mode===void 0)k=i.isSkinnedMesh===!0?new THREE.SkinnedMesh(P,O):new THREE.Mesh(P,O),k.isSkinnedMesh===!0&&!k.geometry.attributes.skinWeight.normalized&&k.normalizeSkinWeights(),S.mode===Qt.TRIANGLE_STRIP?k.geometry=um(k.geometry,THREE.TriangleStripDrawMode):S.mode===Qt.TRIANGLE_FAN&&(k.geometry=um(k.geometry,THREE.TriangleFanDrawMode));else if(S.mode===Qt.LINES)k=new THREE.LineSegments(P,O);else if(S.mode===Qt.LINE_STRIP)k=new THREE.Line(P,O);else if(S.mode===Qt.LINE_LOOP)k=new THREE.LineLoop(P,O);else if(S.mode===Qt.POINTS)k=new THREE.Points(P,O);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+S.mode);Object.keys(k.geometry.morphAttributes).length>0&&Ng(k,i),k.name=e.createUniqueName(i.name||"mesh_"+t),rr(k,i),S.extensions&&ni(o,k,S),e.assignFinalMaterial(k),x.push(k)}for(let y=0,C=x.length;y<C;y++)e.associations.set(x[y],{meshes:t,primitives:y});if(x.length===1)return x[0];let b=new THREE.Group;e.associations.set(b,{meshes:t});for(let y=0,C=x.length;y<C;y++)b.add(x[y]);return b})}loadCamera(t){let e,r=this.json.cameras[t],o=r[r.type];if(!o){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?e=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):r.type==="orthographic"&&(e=new THREE.OrthographicCamera(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),r.name&&(e.name=this.createUniqueName(r.name)),rr(e,r),Promise.resolve(e)}loadSkin(t){let e=this.json.skins[t],r={joints:e.joints};return e.inverseBindMatrices===void 0?Promise.resolve(r):this.getDependency("accessor",e.inverseBindMatrices).then(function(o){return r.inverseBindMatrices=o,r})}loadAnimation(t){let r=this.json.animations[t],o=[],i=[],s=[],p=[],c=[];for(let m=0,h=r.channels.length;m<h;m++){let x=r.channels[m],b=r.samplers[x.sampler],y=x.target,C=y.node!==void 0?y.node:y.id,P=r.parameters!==void 0?r.parameters[b.input]:b.input,S=r.parameters!==void 0?r.parameters[b.output]:b.output;o.push(this.getDependency("node",C)),i.push(this.getDependency("accessor",P)),s.push(this.getDependency("accessor",S)),p.push(b),c.push(y)}return Promise.all([Promise.all(o),Promise.all(i),Promise.all(s),Promise.all(p),Promise.all(c)]).then(function(m){let h=m[0],x=m[1],b=m[2],y=m[3],C=m[4],P=[];for(let k=0,O=h.length;k<O;k++){let V=h[k],H=x[k],N=b[k],I=y[k],B=C[k];if(V===void 0)continue;V.updateMatrix(),V.matrixAutoUpdate=!0;let oe;switch(Tn[B.path]){case Tn.weights:oe=THREE.NumberKeyframeTrack;break;case Tn.rotation:oe=THREE.QuaternionKeyframeTrack;break;case Tn.position:case Tn.scale:default:oe=THREE.VectorKeyframeTrack;break}let ie=V.name?V.name:V.uuid,W=I.interpolation!==void 0?Bg[I.interpolation]:THREE.InterpolateLinear,ne=[];Tn[B.path]===Tn.weights?V.traverse(function(fe){fe.morphTargetInfluences&&ne.push(fe.name?fe.name:fe.uuid)}):ne.push(ie);let _e=N.array;if(N.normalized){let fe=yp(_e.constructor),se=new Float32Array(_e.length);for(let Je=0,_r=_e.length;Je<_r;Je++)se[Je]=_e[Je]*fe;_e=se}for(let fe=0,se=ne.length;fe<se;fe++){let Je=new oe(ne[fe]+"."+Tn[B.path],H.array,_e,W);I.interpolation==="CUBICSPLINE"&&(Je.createInterpolant=function(rn){let Ft=this instanceof THREE.QuaternionKeyframeTrack?bp:Kt;return new Ft(this.times,this.values,this.getValueSize()/3,rn)},Je.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),P.push(Je)}}let S=r.name?r.name:"animation_"+t;return new THREE.AnimationClip(S,void 0,P)})}createNodeMesh(t){let e=this.json,r=this,o=e.nodes[t];return o.mesh===void 0?null:r.getDependency("mesh",o.mesh).then(function(i){let s=r._getNodeRef(r.meshCache,o.mesh,i);return o.weights!==void 0&&s.traverse(function(p){if(!!p.isMesh)for(let c=0,m=o.weights.length;c<m;c++)p.morphTargetInfluences[c]=o.weights[c]}),s})}loadNode(t){let e=this.json,r=this.extensions,o=this,i=e.nodes[t],s=i.name?o.createUniqueName(i.name):"";return function(){let p=[],c=o._invokeOne(function(m){return m.createNodeMesh&&m.createNodeMesh(t)});return c&&p.push(c),i.camera!==void 0&&p.push(o.getDependency("camera",i.camera).then(function(m){return o._getNodeRef(o.cameraCache,i.camera,m)})),o._invokeAll(function(m){return m.createNodeAttachment&&m.createNodeAttachment(t)}).forEach(function(m){p.push(m)}),Promise.all(p)}().then(function(p){let c;if(i.isBone===!0?c=new THREE.Bone:p.length>1?c=new THREE.Group:p.length===1?c=p[0]:c=new THREE.Object3D,c!==p[0])for(let m=0,h=p.length;m<h;m++)c.add(p[m]);if(i.name&&(c.userData.name=i.name,c.name=s),rr(c,i),i.extensions&&ni(r,c,i),i.matrix!==void 0){let m=new THREE.Matrix4;m.fromArray(i.matrix),c.applyMatrix4(m)}else i.translation!==void 0&&c.position.fromArray(i.translation),i.rotation!==void 0&&c.quaternion.fromArray(i.rotation),i.scale!==void 0&&c.scale.fromArray(i.scale);return o.associations.has(c)||o.associations.set(c,{}),o.associations.get(c).nodes=t,c})}loadScene(t){let e=this.json,r=this.extensions,o=this.json.scenes[t],i=this,s=new THREE.Group;o.name&&(s.name=i.createUniqueName(o.name)),rr(s,o),o.extensions&&ni(r,s,o);let p=o.nodes||[],c=[];for(let m=0,h=p.length;m<h;m++)c.push(hm(p[m],s,e,i));return Promise.all(c).then(function(){let m=h=>{let x=new Map;for(let[b,y]of i.associations)(b instanceof THREE.Material||b instanceof THREE.Texture)&&x.set(b,y);return h.traverse(b=>{let y=i.associations.get(b);y!=null&&x.set(b,y)}),x};return i.associations=m(s),s})}};function hm(n,t,e,r){let o=e.nodes[n];return r.getDependency("node",n).then(function(i){if(o.skin===void 0)return i;let s;return r.getDependency("skin",o.skin).then(function(p){s=p;let c=[];for(let m=0,h=s.joints.length;m<h;m++)c.push(r.getDependency("node",s.joints[m]));return Promise.all(c)}).then(function(p){return i.traverse(function(c){if(!c.isMesh)return;let m=[],h=[];for(let x=0,b=p.length;x<b;x++){let y=p[x];if(y){m.push(y);let C=new THREE.Matrix4;s.inverseBindMatrices!==void 0&&C.fromArray(s.inverseBindMatrices.array,x*16),h.push(C)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[x])}c.bind(new THREE.Skeleton(m,h),c.matrixWorld)}),i})}).then(function(i){t.add(i);let s=[];if(o.children){let p=o.children;for(let c=0,m=p.length;c<m;c++){let h=p[c];s.push(hm(h,i,e,r))}}return Promise.all(s)})}function zg(n,t,e){let r=t.attributes,o=new THREE.Box3;if(r.POSITION!==void 0){let p=e.json.accessors[r.POSITION],c=p.min,m=p.max;if(c!==void 0&&m!==void 0){if(o.set(new THREE.Vector3(c[0],c[1],c[2]),new THREE.Vector3(m[0],m[1],m[2])),p.normalized){let h=yp(oi[p.componentType]);o.min.multiplyScalar(h),o.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let i=t.targets;if(i!==void 0){let p=new THREE.Vector3,c=new THREE.Vector3;for(let m=0,h=i.length;m<h;m++){let x=i[m];if(x.POSITION!==void 0){let b=e.json.accessors[x.POSITION],y=b.min,C=b.max;if(y!==void 0&&C!==void 0){if(c.setX(Math.max(Math.abs(y[0]),Math.abs(C[0]))),c.setY(Math.max(Math.abs(y[1]),Math.abs(C[1]))),c.setZ(Math.max(Math.abs(y[2]),Math.abs(C[2]))),b.normalized){let P=yp(oi[b.componentType]);c.multiplyScalar(P)}p.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(p)}n.boundingBox=o;let s=new THREE.Sphere;o.getCenter(s.center),s.radius=o.min.distanceTo(o.max)/2,n.boundingSphere=s}function dm(n,t,e){let r=t.attributes,o=[];function i(s,p){return e.getDependency("accessor",s).then(function(c){n.setAttribute(p,c)})}for(let s in r){let p=Ep[s]||s.toLowerCase();p in n.attributes||o.push(i(r[s],p))}if(t.indices!==void 0&&!n.index){let s=e.getDependency("accessor",t.indices).then(function(p){n.setIndex(p)});o.push(s)}return rr(n,t),zg(n,t,e),Promise.all(o).then(function(){return t.targets!==void 0?Hg(n,t.targets,e):n})}function um(n,t){let e=n.getIndex();if(e===null){let s=[],p=n.getAttribute("position");if(p!==void 0){for(let c=0;c<p.count;c++)s.push(c);n.setIndex(s),e=n.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}let r=e.count-2,o=[];if(t===THREE.TriangleFanDrawMode)for(let s=1;s<=r;s++)o.push(e.getX(0)),o.push(e.getX(s)),o.push(e.getX(s+1));else for(let s=0;s<r;s++)s%2===0?(o.push(e.getX(s)),o.push(e.getX(s+1)),o.push(e.getX(s+2))):(o.push(e.getX(s+2)),o.push(e.getX(s+1)),o.push(e.getX(s)));o.length/3!==r&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let i=n.clone();return i.setIndex(o),i}var Tp=class extends zr{constructor(t,e,r){if(!fs.matches(e)&&!cu.matches(e))throw new Error("Only GLTF model types are currently supported");super(t,e,r)}async getResponse(t){let e=await t.file();return qo(e,r=>Tp.loader.loadAsync(r))}},ii=Tp;ii.loader=new Mn;function Ks(n){return!(n.shiftKey||n.altKey||n.ctrlKey||n.metaKey)}var Qs=class{constructor(t,e,r){this.name=t;this.callback=e;if(!ce(e))throw new Error("A function instance is required for this parameter");this.opts=r,Object.freeze(this)}applyToElement(t){this.add(t)}add(t){t.addEventListener(this.name,this.callback,this.opts)}remove(t){t.removeEventListener(this.name,this.callback)}};function fm(n,t){return new Qs("click",n,t)}function no(n,t){return new Qs("input",n,t)}var Ys=class extends j{constructor(){super("avatarmoved");this.px=0;this.py=0;this.pz=0;this.fx=0;this.fy=0;this.fz=0;this.ux=0;this.uy=0;this.uz=0;this.height=0;this.changed=!1;this.pointerID=0}set(e,r,o,i,s,p,c,m,h,x){this.changed=this.px!==e||this.py!==r||this.pz!==o||this.fx!==i||this.fy!==s||this.fz!==p||this.ux!==c||this.uy!==m||this.uz!==h,this.px=e,this.py=r,this.pz=o,this.fx=i,this.fy=s,this.fz=p,this.ux=c,this.uy=m,this.uz=h,this.height=x}};function ro(n,t){return n.xr.isPresenting?n.xr.getCamera():t}function xm(n,t,e,r,o){let i=n.elements;t.set(i[0],i[1],i[2]),e.set(i[4],i[5],i[6]),r.set(-i[8],-i[9],-i[10]),o.set(i[12],i[13],i[14]),t.normalize(),e.normalize(),r.normalize()}function Ug(n){return n===DeviceOrientationEvent&&"requestPermission"in n&&ce(n.requestPermission)}var Js=class extends q{constructor(e,r,o){super();this.env=e;this.controlMode="none";this.snapTurnAngle=Xe(30);this.sensitivities=new Map([["mousedrag",100],["mousefirstperson",-100],["touchswipe",50],["gamepad",1]]);this.B=new THREE.Vector3(0,0,1);this.R=new THREE.Vector3;this.F=new THREE.Vector3;this.U=new THREE.Vector3;this.P=new THREE.Vector3;this.M=new THREE.Matrix4;this.E=new THREE.Euler;this.Q1=new THREE.Quaternion;this.Q2=new THREE.Quaternion;this.Q3=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));this.Q4=new THREE.Quaternion;this.motion=new THREE.Vector2;this.rotStage=new THREE.Matrix4;this.userMovedEvt=new Ys;this.acceleration=new THREE.Vector2(2,2);this.speed=new THREE.Vector2(3,2);this.axisControl=new THREE.Vector2(0,0);this.deviceQ=new THREE.Quaternion().identity();this.uv=new THREE.Vector2;this.duv=new THREE.Vector2;this.move=new THREE.Vector3;this.move2=new THREE.Vector3;this.followers=new Array;this.dz=0;this._heading=0;this._pitch=0;this._roll=0;this.headX=0;this.headZ=0;this._worldHeading=0;this._worldPitch=0;this.fwrd=!1;this.back=!1;this.left=!1;this.rght=!1;this.fwrd2=!1;this.back2=!1;this.left2=!1;this.rght2=!1;this.up=!1;this.down=!1;this.grow=!1;this.shrk=!1;this._keyboardControlEnabled=!1;this.worldPos=new THREE.Vector3;this.worldQuat=new THREE.Quaternion;this.fovZoomEnabled=!0;this.minFOV=15;this.maxFOV=120;this.minimumX=-85*Math.PI/180;this.maximumX=85*Math.PI/180;this.edgeFactor=1/3;this.deviceOrientation=null;this.screenOrientation=0;this.alphaOffset=0;this.onDeviceOrientationChangeEvent=null;this.onScreenOrientationChangeEvent=null;this.motionEnabled=!1;this.disableHorizontal=!1,this.disableVertical=!1,this.invertHorizontal=!1,this.invertVertical=!0,this._height=o,this.head=je("Head",r);let i=(s,p)=>{s==="w"&&(this.fwrd=p),s==="s"&&(this.back=p),s==="a"&&(this.left=p),s==="d"&&(this.rght=p),s==="e"&&(this.up=p),s==="q"&&(this.down=p),s==="ArrowUp"&&(this.fwrd2=p),s==="ArrowDown"&&(this.back2=p),s==="ArrowLeft"&&(this.left2=p),s==="ArrowRight"&&(this.rght2=p),s==="r"&&(this.grow=p),s==="f"&&(this.shrk=p)};this.onKeyDown=s=>i(s.key,Ks(s)),this.onKeyUp=s=>i(s.key,!1),this.keyboardControlEnabled=!0,matchMedia("(pointer: coarse)").matches?this.controlMode="touchswipe":matchMedia("(pointer: fine)").matches&&(this.controlMode="mousedrag"),globalThis.isSecureContext&&ko()&&!Ht()&&(this.onDeviceOrientationChangeEvent=s=>{this.deviceOrientation=s},this.onScreenOrientationChangeEvent=()=>{re(globalThis.orientation)||(this.screenOrientation=globalThis.orientation||0)},this.startMotionControl())}set disableVertical(e){this._disableVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set invertVertical(e){this._invertVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set disableHorizontal(e){this._disableHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}set invertHorizontal(e){this._invertHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}get height(){return this.head.position.y}get object(){return this.head}get worldHeading(){return this._worldHeading}get worldPitch(){return this._worldPitch}get fov(){return this.env.camera.fov}set fov(e){e!==this.fov&&(this.env.camera.fov=e,this.env.camera.updateProjectionMatrix())}get stage(){return this.head.parent}snapTurn(e){this.setHeading(this.heading-this.snapTurnAngle*e)}get keyboardControlEnabled(){return this._keyboardControlEnabled}set keyboardControlEnabled(e){this._keyboardControlEnabled!==e&&(this._keyboardControlEnabled=e,this._keyboardControlEnabled?(globalThis.addEventListener("keydown",this.onKeyDown),globalThis.addEventListener("keyup",this.onKeyUp)):(globalThis.removeEventListener("keydown",this.onKeyDown),globalThis.removeEventListener("keyup",this.onKeyUp)))}addFollower(e){this.followers.push(e)}onMove(e,r,o){this.setMode(e),e.canMoveView&&this.controlMode!=="none"&&this.gestureSatisfied(e)&&(this.uv.copy(r),this.duv.copy(o))}setMode(e){e.type==="remote"||(e.type==="hand"?this.controlMode="none":e.type==="gamepad"?this.controlMode="gamepad":e.rayTarget&&e.rayTarget.draggable&&!this.env.pointers.mouse.isPointerLocked&&e.isPressed(0)?this.controlMode="mouseedge":e.type==="touch"||e.type==="pen"?this.controlMode="touchswipe":e.type==="mouse"?this.controlMode=this.env.pointers.mouse.isPointerLocked?"mousefirstperson":"mousedrag":wt(e.type))}gestureSatisfied(e){return this.controlMode==="none"?!1:this.controlMode==="gamepad"||this.controlMode==="mousefirstperson"||this.controlMode==="mouseedge"||e.isPressed(0)}get name(){return this.object.name}set name(e){this.object.name=e}get heading(){return this._heading}setHeading(e){this._heading=pn(e)}get pitch(){return this._pitch}setPitch(e,r,o){this._pitch=pn(e+Math.PI)-Math.PI,this._pitch=Xt(this._pitch,r,o)}get roll(){return this._roll}setRoll(e){this._roll=pn(e)}setHeadingImmediate(e){this.setHeading(e),this.updateOrientation(),this.resetFollowers()}setOrientationImmediate(e,r){this.setHeading(e),this._pitch=pn(r),this.updateOrientation()}zoom(e){this.dz=e}update(e){if(this.fovZoomEnabled&&Math.abs(this.dz)>0){let i=Math.pow(.95,5*e);this.dz=Uc(i*this.dz),this.fov=Xt(this.env.camera.fov-this.dz,this.minFOV,this.maxFOV)}e*=.001;let r=this.deviceOrientation;if(r&&De(r.alpha)&&De(r.beta)&&De(r.gamma)){let i=Xe(r.alpha)+this.alphaOffset,s=Xe(r.beta),p=Xe(r.gamma),c=this.screenOrientation?Xe(this.screenOrientation):0;this.E.set(s,i,-p,"YXZ"),this.Q2.setFromAxisAngle(this.B,-c),this.Q4.setFromEuler(this.E).multiply(this.Q3).multiply(this.Q2),this.deviceQ.slerp(this.Q4,.8)}if(this.controlMode==="mouseedge")this.uv.manhattanLength()>0&&(this.motion.set(this.scaleRadialComponent(-this.uv.x,this.speed.x,this.acceleration.x),this.scaleRadialComponent(this.uv.y,this.speed.y,this.acceleration.y)).multiplyScalar(e),this.setHeading(this.heading+this.motion.x),this.setPitch(this.pitch+this.motion.y,this.minimumX,this.maximumX),this.setRoll(0));else if(this.sensitivities.has(this.controlMode)&&this.duv.manhattanLength()>0){let i=this.sensitivities.get(this.controlMode)||1;this.motion.copy(this.duv).multiplyScalar(i*e).multiply(this.axisControl),this.setHeading(this.heading+this.motion.x),this.setPitch(this.pitch+this.motion.y,this.minimumX,this.maximumX),this.setRoll(0)}if(this.Q1.setFromAxisAngle(this.stage.up,this.worldHeading),this.fwrd||this.back||this.left||this.rght||this.up||this.down){let i=(this.left?1:0)+(this.rght?-1:0),s=(this.down?1:0)+(this.up?-1:0),p=(this.fwrd?1:0)+(this.back?-1:0);this.move.set(i,s,p);let c=this.move.length();c>0&&(this.move.multiplyScalar(e/c).applyQuaternion(this.Q1),this.stage.position.add(this.move))}if(this.fwrd2||this.back2||this.left2||this.rght2){let i=(this.left2?1:0)+(this.rght2?-1:0),s=(this.fwrd2?1:0)+(this.back2?-1:0);this.move2.set(i,0,s);let p=this.move2.length();p>0&&(this.move2.multiplyScalar(e/p).applyQuaternion(this.Q1),this.headX+=this.move2.x,this.headZ+=this.move2.z)}if(this.grow||this.shrk){let i=(this.shrk?-1:0)+(this.grow?1:0);this._height+=i*e,this._height=Xt(this._height,1,2)}this.updateOrientation(),this.userMovedEvt.set(this.P.x,this.P.y,this.P.z,this.F.x,this.F.y,this.F.z,this.U.x,this.U.y,this.U.z,this.height),this.dispatchEvent(this.userMovedEvt);let o=Math.pow(.95,100*e);this.duv.multiplyScalar(o),this.duv.manhattanLength()<=1e-4&&this.duv.setScalar(0)}scaleRadialComponent(e,r,o){let i=Math.abs(e);return Math.sign(e)*Math.pow(Math.max(0,i-this.edgeFactor)/(1-this.edgeFactor),o)*r}updateOrientation(){let e=ro(this.env.renderer,this.env.camera);this.rotStage.makeRotationY(this._heading),this.stage.matrix.makeTranslation(this.stage.position.x,this.stage.position.y,this.stage.position.z).multiply(this.rotStage),this.stage.matrix.decompose(this.stage.position,this.stage.quaternion,this.stage.scale),this.env.renderer.xr.isPresenting?(this.M.copy(this.stage.matrixWorld).invert(),this.head.position.copy(e.position).applyMatrix4(this.M),this.head.quaternion.copy(this.stage.quaternion).invert().multiply(e.quaternion)):(this.head.position.set(this.headX,this._height,this.headZ),this.E.set(this._pitch,0,this._roll,"XYZ"),this.head.quaternion.setFromEuler(this.E).premultiply(this.deviceQ)),this.env.camera.position.copy(this.head.position),this.env.camera.quaternion.copy(this.head.quaternion),this.head.getWorldPosition(this.worldPos),this.head.getWorldQuaternion(this.worldQuat),this.F.set(0,0,-1).applyQuaternion(this.worldQuat),this._worldHeading=js(this.F),this._worldPitch=rm(this.F),xm(this.head.matrixWorld,this.R,this.U,this.F,this.P)}reset(){this.stage.position.setScalar(0),this.setHeadingImmediate(0)}resetFollowers(){for(let e of this.followers)e.reset(this.height,this.worldPos,this.worldHeading)}async getPermission(){return"DeviceOrientationEvent"in globalThis?Ug(DeviceOrientationEvent)?await DeviceOrientationEvent.requestPermission():"granted":"not-supported"}async startMotionControl(){if(!this.motionEnabled){this.onScreenOrientationChangeEvent();let e=await this.getPermission();this.motionEnabled=e==="granted",this.motionEnabled&&(globalThis.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),globalThis.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}}stopMotionControl(){this.motionEnabled&&(globalThis.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),globalThis.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.motionEnabled=!1)}dispose(){this.stopMotionControl()}};var $s=0;var oo=3;function gm(n,t){n=Ue(n),n.traverse(e=>e.layers.set(t))}function vm(n,t){n=Ue(n),n.traverse(e=>e.layers.enable(t))}var io=new THREE.Vector3;function Am(n,t,e,r){io.crossVectors(t,n),n.crossVectors(io,t),io.normalize(),n.normalize(),t.normalize(),r.set(io.x,n.x,-t.x,e.x,io.y,n.y,-t.y,e.y,io.z,n.z,-t.z,e.z,0,0,0,1)}var Vt=class{constructor(t){this.env=t;this._object=null;this._visible=!0;this._style="default";this.T=new THREE.Vector3;this.V=new THREE.Vector3;this.Q=new THREE.Quaternion}get object(){return this._object}set object(t){this._object=t}get style(){return this._style}set style(t){this._style=t}get visible(){return this._visible}set visible(t){this._visible=t}update(t,e,r,o,i,s,p,c,m,h){r&&r.face?(this.position.copy(r.point),r.object.getWorldQuaternion(this.Q),this.T.copy(r.face.normal).applyQuaternion(this.Q),this.V.copy(this.T).multiplyScalar(.02),this.position.add(this.V),this.V.copy(this.T).multiplyScalar(10).add(this.position)):(s?this.position.copy(m).multiplyScalar(2).add(c).sub(this.env.avatar.worldPos).normalize().multiplyScalar(i).add(this.env.avatar.worldPos):(this.V.copy(c).add(e).sub(t).multiplyScalar(2),this.position.copy(m).multiplyScalar(i).add(this.V).add(this.env.avatar.worldPos)),this.V.copy(this.env.avatar.worldPos)),this.lookAt(this.position,this.V),this.style=o?o.enabled?o.draggable?h?"grabbing":"move":o.clickable?"pointer":"default":"not-allowed":p?h?"grabbing":"grab":"default"}lookAt(t,e){}};var so=class extends Vt{constructor(e,r){super(e);this.cursorSystem=null;this.f=new THREE.Vector3;this.up=new THREE.Vector3;this.right=new THREE.Vector3;this.object=new THREE.Object3D,this.cursorSystem=r,this.object.matrixAutoUpdate=!1}add(e,r){G(this,r),vm(r,oo),r.visible=e==="default"}get position(){return this.object.position}get style(){for(let e of this.object.children)if(e.visible)return e.name;return null}set style(e){for(let r of this.object.children)r.visible=r.name===e;if(this.style==null&&this.object.children.length>0){let r=bt(this.object.children,o=>o.name==="default",o=>o!=null);r!=null&&(r.visible=!0)}this.cursorSystem&&(this.cursorSystem.style="none")}get visible(){return qr(this)}set visible(e){Ie(this,e)}lookAt(e,r){this.f.copy(r).sub(e).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat),this.right.crossVectors(this.up,this.f),this.up.crossVectors(this.f,this.right),Am(this.up,this.f,e,this.object.matrixWorld),this.object.matrix.copy(this.object.parent.matrixWorld).invert().multiply(this.object.matrixWorld).decompose(this.object.position,this.object.quaternion,this.object.scale)}clone(){let e=new so(this.env);for(let r of this.object.children)e.add(r.name,r.clone());return e}};var Zs=class extends j{constructor(e,r){super(e);this.button=r}},Sp=class extends Zs{constructor(t){super("gamepadbuttonup",t)}},Rp=class extends Zs{constructor(t){super("gamepadbuttondown",t)}},Pp=class extends j{constructor(e,r,o){super(e);this.axis=r;this.value=o}},Cp=class extends Pp{constructor(t,e){super("gamepadaxismaxed",t,e)}},ea=class extends q{constructor(){super();this.lastAxisValues=new Array;this.btnDownEvts=new Array;this.btnUpEvts=new Array;this.wasPressed=new Array;this.axisMaxEvts=new Array;this.wasAxisMaxed=new Array;this.sticks=new Array;this.axisThresholdMax=.9;this.axisThresholdMin=.1;this._pad=null;Object.seal(this)}get displayId(){if("displayId"in this.pad)return this.pad.displayId}get pad(){return this._pad}set pad(e){if(this._pad=e,this.pad){if(this.btnUpEvts.length===0){for(let r=0;r<e.buttons.length;++r)this.btnDownEvts[r]=new Rp(r),this.btnUpEvts[r]=new Sp(r),this.wasPressed[r]=!1;for(let r=0;r<e.axes.length;++r)this.axisMaxEvts[r]=new Cp(r,0),this.wasAxisMaxed[r]=!1,r%2===0&&r<e.axes.length-1&&(this.sticks[r/2]={x:0,y:0}),this.lastAxisValues[r]=e.axes[r]}for(let r=0;r<this.pad.buttons.length;++r){let o=this.wasPressed[r],i=this.pad.buttons[r].pressed;i!==o&&(this.wasPressed[r]=i,this.dispatchEvent((i?this.btnDownEvts:this.btnUpEvts)[r]))}for(let r=0;r<this.pad.axes.length;++r){let o=this.wasAxisMaxed[r],i=this.pad.axes[r],s=Math.sign(i),p=Math.abs(i),c=p>=this.axisThresholdMax,m=p<=this.axisThresholdMin,h=s*(c?1:m?0:p);c&&!o&&(this.axisMaxEvts[r].value=h,this.dispatchEvent(this.axisMaxEvts[r])),this.wasAxisMaxed[r]=c,this.lastAxisValues[r]=h}for(let r=0;r<this.axes.length-1;r+=2){let o=this.sticks[r/2];o.x=this.axes[r],o.y=this.axes[r+1]}}}get id(){return this.pad?this.pad.id:null}get index(){return this.pad?this.pad.index:null}get connected(){return this.pad&&this.pad.connected}get mapping(){return this.pad?this.pad.mapping:null}get timestamp(){return this.pad?this.pad.timestamp:null}get hand(){return this.pad?this.pad.hand:null}get pose(){return this.pad?this.pad.pose:null}get buttons(){return this.pad?this.pad.buttons:null}get axes(){return this.pad?this.pad.axes:null}get hapticActuators(){return this.pad?this.pad.hapticActuators:null}};var he={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function _m(n){let t=await fetch(n);if(t.ok)return t.json();throw new Error(t.statusText)}async function jg(n){if(!n)throw new Error("No basePath supplied");return await _m(`${n}/profilesList.json`)}async function bm(n,t,e=null,r=!0){if(!n)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");let o=await jg(t),i;if(n.profiles.some(c=>{let m=o[c];return m&&(i={profileId:c,profilePath:`${t}/${m.path}`,deprecated:!!m.deprecated}),!!i}),!i){if(!e)throw new Error("No matching profile name found");let c=o[e];if(!c)throw new Error(`No matching profile name found and default profile "${e}" missing.`);i={profileId:e,profilePath:`${t}/${c.path}`,deprecated:!!c.deprecated}}let s=await _m(i.profilePath),p;if(r){let c;if(n.handedness==="any"?c=s.layouts[Object.keys(s.layouts)[0]]:c=s.layouts[n.handedness],!c)throw new Error(`No matching handedness, ${n.handedness}, in profile ${i.profileId}`);c.assetPath&&(p=i.profilePath.replace("profile.json",c.assetPath))}return{profile:s,assetPath:p}}var Gg={xAxis:0,yAxis:0,button:0,state:he.ComponentState.DEFAULT};function Wg(n=0,t=0){let e=n,r=t;if(Math.sqrt(n*n+t*t)>1){let s=Math.atan2(t,n);e=Math.cos(s),r=Math.sin(s)}return{normalizedXAxis:e*.5+.5,normalizedYAxis:r*.5+.5}}var Ip=class{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===he.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(Gg)}updateFromComponent({xAxis:t,yAxis:e,button:r,state:o}){let{normalizedXAxis:i,normalizedYAxis:s}=Wg(t,e);switch(this.componentProperty){case he.ComponentProperty.X_AXIS:this.value=this.states.includes(o)?i:.5;break;case he.ComponentProperty.Y_AXIS:this.value=this.states.includes(o)?s:.5;break;case he.ComponentProperty.BUTTON:this.value=this.states.includes(o)?r:0;break;case he.ComponentProperty.STATE:this.valueNodeProperty===he.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(o):this.value=this.states.includes(o)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},Vp=class{constructor(t,e){if(!t||!e||!e.visualResponses||!e.gamepadIndices||Object.keys(e.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach(r=>{let o=new Ip(e.visualResponses[r]);this.visualResponses[r]=o}),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:he.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(t){if(this.values.state=he.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&t.buttons.length>this.gamepadIndices.button){let e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||this.values.button===1?this.values.state=he.ComponentState.PRESSED:(e.touched||this.values.button>he.ButtonTouchThreshold)&&(this.values.state=he.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===he.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>he.AxisTouchThreshold&&(this.values.state=he.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===he.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>he.AxisTouchThreshold&&(this.values.state=he.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}},ta=class{constructor(t,e,r){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=r,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(o=>{let i=this.layoutDescription.components[o];this.components[o]=new Vp(o,i)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let t=[];return Object.values(this.components).forEach(e=>{t.push(e.data)}),t}updateFromGamepad(){Object.values(this.components).forEach(t=>{t.updateFromGamepad(this.xrInputSource.gamepad)})}};var qg="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Qg="generic-trigger",Lp=class extends THREE.Object3D{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(t){return this.envMap==t?this:(this.envMap=t,this.traverse(e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}),this)}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(r=>{let{valueNode:o,minNode:i,maxNode:s,value:p,valueNodeProperty:c}=r;!o||(c===he.VisualResponseProperty.VISIBILITY?o.visible=p:c===he.VisualResponseProperty.TRANSFORM&&(o.quaternion.slerpQuaternions(i.quaternion,s.quaternion,p),o.position.lerpVectors(i.position,s.position,p)))})}))}};function Kg(n,t){Object.values(n.components).forEach(e=>{let{type:r,touchPointNodeName:o,visualResponses:i}=e;if(r===he.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(o),e.touchPointNode){let s=new THREE.SphereGeometry(.001),p=new THREE.MeshBasicMaterial({color:255}),c=new THREE.Mesh(s,p);e.touchPointNode.add(c)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(i).forEach(s=>{let{valueNodeName:p,minNodeName:c,maxNodeName:m,valueNodeProperty:h}=s;if(h===he.VisualResponseProperty.TRANSFORM){if(s.minNode=t.getObjectByName(c),s.maxNode=t.getObjectByName(m),!s.minNode){console.warn(`Could not find ${c} in the model`);return}if(!s.maxNode){console.warn(`Could not find ${m} in the model`);return}}s.valueNode=t.getObjectByName(p),s.valueNode||console.warn(`Could not find ${p} in the model`)})})}function Em(n,t){Kg(n.motionController,t),n.envMap&&t.traverse(e=>{e.isMesh&&(e.material.envMap=n.envMap,e.material.needsUpdate=!0)}),n.add(t)}var na=class{constructor(t=null){this.gltfLoader=t,this.path=qg,this._assetCache={},this.gltfLoader||(this.gltfLoader=new Mn)}createControllerModel(t){let e=new Lp,r=null;return t.addEventListener("connected",o=>{let i=o.data;i.targetRayMode!=="tracked-pointer"||!i.gamepad||bm(i,this.path,Qg).then(({profile:s,assetPath:p})=>{e.motionController=new ta(i,s,p);let c=this._assetCache[e.motionController.assetUrl];if(c)r=c.scene.clone(),Em(e,r);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(e.motionController.assetUrl,m=>{this._assetCache[e.motionController.assetUrl]=m,r=m.scene.clone(),Em(e,r)},null,()=>{throw new Error(`Asset ${e.motionController.assetUrl} missing or malformed.`)})}}).catch(s=>{console.warn(s)})}),t.addEventListener("disconnected",()=>{e.motionController=null,e.remove(r),r=null}),e}};var kp=new THREE.Matrix4,ym=new THREE.Vector3,wm=new THREE.Matrix4().identity(),Tm=new THREE.Matrix4().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(wm.makeRotationY(Math.PI/2),Tm.makeRotationY(-Math.PI/2));var ao=class{constructor(t,e,r,o,i){this.controller=e,this.handModel=t,this.envMap=null,this.oculusBrowserV14Correction=o==="left"?Tm:wm;let s;!i||!i.primitive||i.primitive==="sphere"?s=new THREE.SphereGeometry(1,10,10):i.primitive==="box"?s=new THREE.BoxGeometry(1,1,1):i.primitive==="bone"&&(s=new THREE.CylinderGeometry(.5,.75,2.25,10,1).rotateX(-Math.PI/2));let p=new THREE.MeshStandardMaterial;this.handMesh=new THREE.InstancedMesh(s,p,30),this.handMesh.instanceMatrix.setUsage(THREE.DynamicDrawUsage),this.handMesh.castShadow=!0,this.handMesh.receiveShadow=!0,this.handModel.add(this.handMesh),this.joints=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]}updateMesh(){let e=this.controller.joints,r=0;for(let o=0;o<this.joints.length;o++){let i=e[this.joints[o]];i.visible&&(ym.setScalar(i.jointRadius||.008),kp.compose(i.position,i.quaternion,ym),kp.multiply(this.oculusBrowserV14Correction),this.handMesh.setMatrixAt(o,kp),r++)}this.handMesh.count=r,this.handMesh.instanceMatrix.needsUpdate=!0}};var Op=new THREE.Quaternion().identity(),Mm=new THREE.Quaternion().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(Op.setFromAxisAngle({x:0,y:1,z:0},Math.PI/2),Mm.setFromAxisAngle({x:1,y:0,z:0},Math.PI).premultiply(Op));var Yg="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/",ra=class{constructor(t,e,r,o){this.controller=e,this.handModel=t,this.oculusBrowserV14Correction=o==="left"?Mm:Op,this.bones=[];let i=new Mn;i.setPath(r||Yg),i.load(`${o}.glb`,s=>{let p=s.scene.children[0];this.handModel.add(p);let c=p.getObjectByProperty("type","SkinnedMesh");c.frustumCulled=!1,c.castShadow=!0,c.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(h=>{let x=p.getObjectByName(h);x!==void 0?x.jointName=h:console.warn(`Couldn't find ${h} in ${o} hand mesh`),this.bones.push(x)})})}updateMesh(){let t=this.controller.joints;for(let e=0;e<this.bones.length;e++){let r=this.bones[e];if(r){let o=t[r.jointName];if(o.visible){let i=o.position;r&&(r.position.copy(i),r.quaternion.copy(o.quaternion).multiply(this.oculusBrowserV14Correction))}}}}};var Dp=class extends THREE.Object3D{constructor(t){super(),this.controller=t,this.motionController=null,this.envMap=null,this.mesh=null}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&this.motionController.updateMesh()}},oa=class{constructor(){this.path=null}setPath(t){return this.path=t,this}createHandModel(t,e){let r=new Dp(t);return t.addEventListener("connected",o=>{let i=o.data;i.hand&&!r.motionController&&(r.xrInputSource=i,e===void 0||e==="spheres"?r.motionController=new ao(r,t,this.path,i.handedness,{primitive:"sphere"}):e==="boxes"?r.motionController=new ao(r,t,this.path,i.handedness,{primitive:"box"}):e==="bones"?r.motionController=new ao(r,t,this.path,i.handedness,{primitive:"bone"}):e==="mesh"&&(r.motionController=new ra(r,t,this.path,i.handedness)))}),t.addEventListener("disconnected",()=>{}),r}};function Sm(n){let t=n.attributes.position,e=n.attributes.normal,r=n.attributes.uv;for(let o=0;o<e.count;++o){let i=o*e.itemSize,s=o*e.itemSize+1,p=o*e.itemSize+2,c=e.array[i],m=e.array[s],h=e.array[p],x=Math.abs(c),b=Math.abs(m),y=Math.abs(h),C=t.array[i],P=t.array[s],S=t.array[p],k=Math.abs(C),O=Math.abs(P),V=Math.abs(S),H=o*r.itemSize,N=o*r.itemSize+1,I=r.array[H],B=r.array[N],oe=0,ie=x,W=k;b>ie&&(oe=1,ie=b,W=O),y>ie&&(oe=2,ie=y,W=V),oe===0?C<0?(I=-S,B=P):(I=S,B=P):oe===1?P<0?(I=C,B=-S):(I=C,B=S):S<0?(I=C,B=P):(I=-C,B=P),I=(I/W+1)/8,B=(B/W+1)/6,oe===0?C<0?(I+=0,B+=1/3):(I+=.5,B+=1/3):oe===1?P<0?(I+=.25,B+=0):(I+=.25,B+=2/3):S<0?(I+=.25,B+=1/3):(I+=.75,B+=1/3);let ne=r.array;ne[H]=I,ne[N]=B}}var si=new THREE.BoxBufferGeometry(1,1,1,1,1,1);si.name="CubeGeom";var Bp=si.clone();Bp.name="InvertedCubeGeom";Sm(Bp);var or=class extends THREE.Mesh{constructor(t,e,r,o){super(si,o),this.scale.set(t,e,r)}},Rm=class extends THREE.Mesh{constructor(t,e,r,o){super(Bp,o),this.scale.set(t,e,r)}};var lo=class extends Vt{constructor(e){super(e);this.material=Iu({name:"CursorMat",color:16776960}),this.object=new or(.01,.01,.01,this.material)}get position(){return this.object.position}get style(){return this._currentStyle}set style(e){if(this._currentStyle=e,yn(this.object)&&!Qe(this.object.material))switch(this._currentStyle){case"pointer":this.material.color=new THREE.Color(65280),this.material.needsUpdate=!0;break;case"not-allowed":this.material.color=new THREE.Color(16711680),this.material.needsUpdate=!0;break;case"move":this.material.color=new THREE.Color(255),this.material.needsUpdate=!0;break;case"grab":this.material.color=new THREE.Color(16711935),this.material.needsUpdate=!0;break;case"grabbing":this.material.color=new THREE.Color(65535),this.material.needsUpdate=!0;break;default:this._currentStyle="default",this.material.color=new THREE.Color(16776960),this.material.needsUpdate=!0;break}}get visible(){return qr(this)}set visible(e){Ie(this,e)}};var ia=class extends Vt{constructor(e,r){super(e);this.element=r;this._hidden=!1;this.visible=!0,this.style="default",document.addEventListener("pointerlockchange",()=>{this._hidden=!!document.pointerLockElement,this.refresh()})}get position(){throw new Error("BaseCursor::get_Position(): Method not implemented.")}get style(){return super.style}set style(e){super.style=e,this.refresh()}get visible(){return super.visible&&!this._hidden}set visible(e){super.visible=e,this.refresh()}refresh(){this.element.style.cursor=this.visible?this.style:"none"}};var po=class extends Vt{constructor(e){super(e);this.xr=e.cursor3D&&e.cursor3D.clone()||new lo(this.env),this.system=new ia(this.env,this.env.renderer.domElement),this.visible=!1}get object(){return this.xr.object}get cursor(){return this.xr}set cursor(e){this.xr=e,this._refresh()}get position(){return this.object.position}get style(){return this.system.style}get visible(){return super.visible}set visible(e){super.visible=e,this._refresh()}set style(e){this.system.style=e,this.xr.style=e,this._refresh()}_refresh(){let e=this.env.pointers&&this.env.pointers.mouse&&this.env.pointers.mouse.isPointerLocked,r=this.env.renderer.xr.isPresenting||e;Ie(this.xr,this.visible&&r),this.system.visible=this.visible&&!r}lookAt(e,r){this.xr.lookAt(e,r)}};var sa=class extends j{constructor(e,r){super(e);this.pointer=r;this._hit=null;this._point=null;this._distance=Number.POSITIVE_INFINITY;this._rayTarget=null;Object.seal(this)}set(e,r){e!==this.hit&&(this._hit=e,e?(this._point=e.point,this._distance=e.distance):(this._point=null,this._distance=Number.POSITIVE_INFINITY)),this._rayTarget=r}get hit(){return this._hit}get rayTarget(){return this._rayTarget}get point(){return this._point}get distance(){return this._distance}};var Jg=5,$g=new THREE.Vector3,co=class extends q{constructor(e,r,o,i){super();this.type=e;this.id=r;this.env=o;this.origin=new THREE.Vector3;this.direction=new THREE.Vector3;this.up=new THREE.Vector3(0,1,0);this.canMoveView=!1;this.buttons=0;this.isActive=!1;this.moveDistance=0;this.hits=new Array;this.pointerEvents=new Map;this.lastButtons=0;this.canClick=!1;this.dragDistance=0;this._enabled=!1;this._cursor=null;this._curHit=null;this._curTarget=null;this._hoveredHit=null;this._hoveredTarget=null;this._cursor=i,this.cursor&&(this.cursor.visible=!1),this.canMoveView=!1}get curHit(){return this._curHit}set curHit(e){if(e!==this.curHit){let r=$r(e);this._curHit=e,this._curTarget=r}}get curTarget(){return this._curTarget}get hoveredHit(){return this._hoveredHit}set hoveredHit(e){if(e!==this.hoveredHit){let r=$r(e);this._hoveredHit=e,this._hoveredTarget=r}}get name(){return an[this.id]}get rayTarget(){return this._hoveredTarget}get cursor(){return this._cursor}set cursor(e){if(e!==this.cursor){let r=this.cursor,o=this.cursor&&this.cursor.object&&this.cursor.object.name||"cursor",i=r&&r.object&&r.object.parent;i&&i.remove(r.object),e&&(e.object.name=o,r instanceof po?(r.cursor=e,i&&G(i,r)):(this._cursor=e,r&&(i&&G(i,e),e.style=r.style,e.visible=r.visible)))}}get needsUpdate(){return this.enabled&&this.isActive}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.cursor&&(this.cursor.visible=e)}setButton(e,r){this.lastButtons=this.buttons;let o=1<<e;if(r?this.buttons|=o:this.buttons&=~o,r)this.canClick=!0,this.dragDistance=0,this.env.avatar.setMode(this),this.setEventState("down");else{if(this.canClick){let i=this.buttons;this.buttons=this.lastButtons,this.setEventState("click"),this.buttons=i}this.setEventState("up")}}isPressed(e){let r=1<<e;return(this.buttons&r)!==0}wasPressed(e){let r=1<<e;return(this.lastButtons&r)!==0}fireRay(e,r){ae(this.hits),this.env.pointers.fireRay(e,r,this.hits);let o=null,i=Number.MAX_VALUE;for(let s of this.hits)$r(s)&&s.distance<i&&(o=s,i=s.distance);return this.curHit=o,!!o}getEvent(e){this.pointerEvents.has(e)||this.pointerEvents.set(e,new sa(e,this));let r=this.pointerEvents.get(e);if(this.hoveredHit?r.set(this.hoveredHit,this.rayTarget):this.curHit?r.set(this.curHit,this.curTarget):r.set(null,null),r.hit){let o=this.curHit||this.hoveredHit;o&&r.hit!==o&&(r.hit.uv=o.uv)}return r}update(){this.needsUpdate&&this.onUpdate()}onUpdate(){this.updatePointerOrientation();let e=this.isPressed(0);(this.moveDistance>0||e)&&(e&&(this.dragDistance+=this.moveDistance,this.dragDistance>Jg&&(this.canClick=!1)),this.setEventState("move")),this.moveDistance=0}setEventState(e){if(this.fireRay(this.origin,this.direction),this.curTarget===this.rayTarget)this.hoveredHit=this.curHit;else{let o=this.isPressed(0),i=this.wasPressed(0);if(e==="move"&&!o||e==="down"&&o&&!i||e==="up"&&!o&&i){if(this.rayTarget){let m=this.getEvent("up");this.rayTarget.dispatchEvent(m);let h=this.getEvent("exit");this.rayTarget.dispatchEvent(h)}if(this.hoveredHit=this.curHit,this.rayTarget){let m=this.getEvent("enter");this.rayTarget.dispatchEvent(m)}}this.hoveredHit&&this.hoveredHit.point.copy(this.direction).multiplyScalar(this.hoveredHit.distance).add(this.origin)}let r=this.getEvent(e);this.dispatchEvent(r),r.rayTarget&&(e==="click"&&this.vibrate(),r.rayTarget.enabled&&r.rayTarget.dispatchEvent(r)),this.updateCursor(this.env.avatar.worldPos,$g,!0,2)}updateCursor(e,r,o,i){this.cursor&&this.cursor.update(e,r,this.hoveredHit||this.curHit,this.rayTarget||this.curTarget,i,o,this.canMoveView,this.origin,this.direction,this.isPressed(0))}};var Pm=new THREE.Box3,aa=new THREE.Vector3,ir=class extends THREE.InstancedBufferGeometry{constructor(){super(),this.type="LineSegmentsGeometry";let t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],r=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(r),this.setAttribute("position",new THREE.Float32BufferAttribute(t,3)),this.setAttribute("uv",new THREE.Float32BufferAttribute(e,2))}applyMatrix4(t){let e=this.attributes.instanceStart,r=this.attributes.instanceEnd;return e!==void 0&&(e.applyMatrix4(t),r.applyMatrix4(t),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let r=new THREE.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceStart",new THREE.InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceEnd",new THREE.InterleavedBufferAttribute(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let r=new THREE.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceColorStart",new THREE.InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceColorEnd",new THREE.InterleavedBufferAttribute(r,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new THREE.WireframeGeometry(t.geometry)),this}fromLineSegments(t){let e=t.geometry;if(e.isGeometry){console.error("THREE.LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new THREE.Box3);let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;t!==void 0&&e!==void 0&&(this.boundingBox.setFromBufferAttribute(t),Pm.setFromBufferAttribute(e),this.boundingBox.union(Pm))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new THREE.Sphere),this.boundingBox===null&&this.computeBoundingBox();let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(t!==void 0&&e!==void 0){let r=this.boundingSphere.center;this.boundingBox.getCenter(r);let o=0;for(let i=0,s=t.count;i<s;i++)aa.fromBufferAttribute(t,i),o=Math.max(o,r.distanceToSquared(aa)),aa.fromBufferAttribute(e,i),o=Math.max(o,r.distanceToSquared(aa));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}};ir.prototype.isLineSegmentsGeometry=!0;var Cm=new THREE.Vector3,Im=new THREE.Vector3,Le=new THREE.Vector4,ke=new THREE.Vector4,Lt=new THREE.Vector4,Fp=new THREE.Vector3,Hp=new THREE.Matrix4,ct=new THREE.Line3,Vm=new THREE.Vector3,Yt=new THREE.Box3,la=new THREE.Sphere,kt=new THREE.Vector4;function Lm(n,t,e,r){return kt.set(0,0,-t,1).applyMatrix4(n.projectionMatrix),kt.multiplyScalar(1/kt.w),kt.x=e/r.width,kt.y=e/r.height,kt.applyMatrix4(n.projectionMatrixInverse),kt.multiplyScalar(1/kt.w),Math.abs(Math.max(kt.x,kt.y))}var ai=class extends THREE.Mesh{constructor(t=new ir,e=new qt({color:Math.random()*16777215})){super(t,e),this.type="LineSegments2"}computeLineDistances(){let t=this.geometry,e=t.attributes.instanceStart,r=t.attributes.instanceEnd,o=new Float32Array(2*e.count);for(let s=0,p=0,c=e.count;s<c;s++,p+=2)Cm.fromBufferAttribute(e,s),Im.fromBufferAttribute(r,s),o[p]=p===0?0:o[p-1],o[p+1]=o[p]+Cm.distanceTo(Im);let i=new THREE.InstancedInterleavedBuffer(o,2,1);return t.setAttribute("instanceDistanceStart",new THREE.InterleavedBufferAttribute(i,1,0)),t.setAttribute("instanceDistanceEnd",new THREE.InterleavedBufferAttribute(i,1,1)),this}raycast(t,e){t.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');let r=t.params.Line2!==void 0&&t.params.Line2.threshold||0,o=t.ray,i=t.camera,s=i.projectionMatrix,p=this.matrixWorld,c=this.geometry,m=this.material,h=m.resolution,x=m.linewidth+r,b=c.attributes.instanceStart,y=c.attributes.instanceEnd,C=-i.near;c.boundingSphere===null&&c.computeBoundingSphere(),la.copy(c.boundingSphere).applyMatrix4(p);let P=Math.max(i.near,la.distanceToPoint(o.origin)),S=Lm(i,P,x,h);if(la.radius+=S,t.ray.intersectsSphere(la)===!1)return;c.boundingBox===null&&c.computeBoundingBox(),Yt.copy(c.boundingBox).applyMatrix4(p);let k=Math.max(i.near,Yt.distanceToPoint(o.origin)),O=Lm(i,k,x,h);if(Yt.max.x+=O,Yt.max.y+=O,Yt.max.z+=O,Yt.min.x-=O,Yt.min.y-=O,Yt.min.z-=O,t.ray.intersectsBox(Yt)!==!1){o.at(1,Lt),Lt.w=1,Lt.applyMatrix4(i.matrixWorldInverse),Lt.applyMatrix4(s),Lt.multiplyScalar(1/Lt.w),Lt.x*=h.x/2,Lt.y*=h.y/2,Lt.z=0,Fp.copy(Lt),Hp.multiplyMatrices(i.matrixWorldInverse,p);for(let H=0,N=b.count;H<N;H++){Le.fromBufferAttribute(b,H),ke.fromBufferAttribute(y,H),Le.w=1,ke.w=1,Le.applyMatrix4(Hp),ke.applyMatrix4(Hp);var V=Le.z>C&&ke.z>C;if(V)continue;if(Le.z>C){let W=Le.z-ke.z,ne=(Le.z-C)/W;Le.lerp(ke,ne)}else if(ke.z>C){let W=ke.z-Le.z,ne=(ke.z-C)/W;ke.lerp(Le,ne)}Le.applyMatrix4(s),ke.applyMatrix4(s),Le.multiplyScalar(1/Le.w),ke.multiplyScalar(1/ke.w),Le.x*=h.x/2,Le.y*=h.y/2,ke.x*=h.x/2,ke.y*=h.y/2,ct.start.copy(Le),ct.start.z=0,ct.end.copy(ke),ct.end.z=0;let I=ct.closestPointToPointParameter(Fp,!0);ct.at(I,Vm);let B=THREE.MathUtils.lerp(Le.z,ke.z,I),oe=B>=-1&&B<=1,ie=Fp.distanceTo(Vm)<x*.5;if(oe&&ie){ct.start.fromBufferAttribute(b,H),ct.end.fromBufferAttribute(y,H),ct.start.applyMatrix4(p),ct.end.applyMatrix4(p);let W=new THREE.Vector3,ne=new THREE.Vector3;o.distanceSqToSegment(ct.start,ct.end,ne,W),e.push({point:ne,pointOnLine:W,distance:o.origin.distanceTo(ne),object:this,face:null,faceIndex:H,uv:null,uv2:null})}}}}};ai.prototype.isLineSegments2=!0;var sr=class extends ir{constructor(){super(),this.type="LineGeometry"}setPositions(t){for(var e=t.length-3,r=new Float32Array(2*e),o=0;o<e;o+=3)r[2*o]=t[o],r[2*o+1]=t[o+1],r[2*o+2]=t[o+2],r[2*o+3]=t[o+3],r[2*o+4]=t[o+4],r[2*o+5]=t[o+5];return super.setPositions(r),this}setColors(t){for(var e=t.length-3,r=new Float32Array(2*e),o=0;o<e;o+=3)r[2*o]=t[o],r[2*o+1]=t[o+1],r[2*o+2]=t[o+2],r[2*o+3]=t[o+3],r[2*o+4]=t[o+4],r[2*o+5]=t[o+5];return super.setColors(r),this}fromLine(t){var e=t.geometry;if(e.isGeometry){console.error("THREE.LineGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}};sr.prototype.isLineGeometry=!0;var li=class extends ai{constructor(t=new sr,e=new qt({color:Math.random()*16777215})){super(t,e),this.type="Line2"}};li.prototype.isLine2=!0;var km=new sr;km.setPositions([0,0,0,0,0,-1]);var pa=class extends THREE.Object3D{constructor(e,r=1){super();this._length=1;this.line=new li(km,Lu({color:e,linewidth:r})),this.line.computeLineDistances(),G(this,this.line)}get length(){return this._length}set length(e){this._length=e,this.line.scale.set(1,1,e)}};var Zg=new na,ev=new oa,tv=new THREE.Matrix4().makeRotationX(-7*Math.PI/9),Om=new Map([["none",4],["left",5],["right",6]]);var Dm=new Map([[5,2],[4,3]]),ca=class extends co{constructor(e,r){super("hand",4,e,new lo(e));this.laser=new pa(zl,.002);this.object=new THREE.Object3D;this._handedness="none";this._isHand=!1;this.inputSource=null;this._gamepad=new ea;this.delta=new THREE.Vector3;this.newOrigin=new THREE.Vector3;this.quaternion=new THREE.Quaternion;this.newQuat=new THREE.Quaternion;this.useHaptics=!0;if(this.quaternion.identity(),G(this,this.controller=this.env.renderer.xr.getController(r),this.grip=this.env.renderer.xr.getControllerGrip(r),this.hand=this.env.renderer.xr.getHand(r)),Er()&&Cc()&&!Nt){let s=!1;this.controller.traverse(p=>{p.name.toLocaleLowerCase().indexOf("oculus")>=0&&(s=!0)}),s&&this.laser.matrix.copy(tv)}G(this.controller,this.laser),G(this.grip,Zg.createControllerModel(this.controller)),G(this.hand,ev.createHandModel(this.hand,"mesh")),this.gamepad.addEventListener("gamepadaxismaxed",s=>{s.axis===2&&this.env.avatar.snapTurn(s.value)});let o=s=>p=>{Dm.has(p.button)&&this.setButton(Dm.get(p.button),s)};this.gamepad.addEventListener("gamepadbuttondown",o(!0)),this.gamepad.addEventListener("gamepadbuttonup",o(!1));let i=(s,p)=>()=>this.setButton(s,p);this.controller.addEventListener("selectstart",i(0,!0)),this.controller.addEventListener("selectend",i(0,!1)),this.controller.addEventListener("squeezestart",i(1,!0)),this.controller.addEventListener("squeezeend",i(1,!1)),this.controller.addEventListener("connected",s=>{s.target===this.controller&&(this.inputSource=s.data,this.gamepad.pad=this.inputSource.gamepad,this._isHand=A(this.inputSource.hand),this._handedness=this.inputSource.handedness,this.id=Om.get(this.handedness),this.updateCursorSide(),this.grip.visible=!this.isHand,this.controller.visible=!this.isHand,this.hand.visible=this.isHand,this.enabled=!0,this.isActive=!0,this.env.pointers.checkXRMouse(),console.log(this.handedness,"connected"))}),this.controller.addEventListener("disconnected",s=>{s.target===this.controller&&(this.inputSource=null,this.gamepad.pad=null,this._isHand=!1,this._handedness="none",this.id=Om.get(this.handedness),this.updateCursorSide(),this.grip.visible=!1,this.controller.visible=!1,this.hand.visible=!1,this.enabled=!1,this.isActive=!1,this.env.pointers.checkXRMouse(),console.log(this.handedness,"disconnected"))}),Object.seal(this)}vibrate(){this._vibrate()}async _vibrate(){if(this.useHaptics&&this.gamepad.hapticActuators)try{await Promise.all(this.gamepad.hapticActuators.map(e=>e.pulse(.25,125)))}catch{this.useHaptics=!1}}get gamepad(){return this._gamepad}get handedness(){return this._handedness}get isHand(){return this._isHand}get cursor(){return super.cursor}set cursor(e){super.cursor=e,this.updateCursorSide()}updateCursorSide(){let e=this.cursor.object;if(e){let r=this.handedness==="left"?-1:1;e.scale.set(r,1,1)}}updatePointerOrientation(){this.laser.getWorldPosition(this.newOrigin),this.laser.getWorldQuaternion(this.newQuat),this.origin.lerp(this.newOrigin,.9),this.quaternion.slerp(this.newQuat,.9),this.delta.copy(this.origin).add(this.direction),this.direction.set(0,0,-1).applyQuaternion(this.quaternion),this.up.set(0,1,0).applyQuaternion(this.quaternion),this.delta.sub(this.direction).sub(this.origin),this.moveDistance+=50*this.delta.length()}onUpdate(){this.gamepad.pad=this.inputSource&&this.inputSource.gamepad||null,super.onUpdate()}};var uo=class extends co{constructor(e,r,o,i){super(e,r,o,i);this.position=new THREE.Vector2;this.motion=new THREE.Vector2;this.uv=new THREE.Vector2;this.duv=new THREE.Vector2;this.uvComp=new THREE.Vector2(1,-1);this.uvOff=new THREE.Vector2(-1,1);this.canMoveView=!0;let s=p=>{this.checkEvent(p)&&this.readEvent(p)};this.element=this.env.renderer.domElement,this.element.addEventListener("pointerdown",s),this.element.addEventListener("pointermove",s),this.element.addEventListener("pointerup",s),this.element.addEventListener("pointercancel",s)}checkEvent(e){return this.isActive=this.onCheckEvent(e)}onCheckEvent(e){return e.pointerType===this.type}readEvent(e){this.checkEvent(e)&&this.onReadEvent(e)}onReadEvent(e){this.updatePointerOrientation()}updatePointerOrientation(){this.element.clientWidth>0&&this.element.clientHeight>0&&(this.uv.copy(this.position),this.uv.x/=this.element.clientWidth,this.uv.y/=this.element.clientHeight,this.uv.multiplyScalar(2).multiply(this.uvComp).add(this.uvOff),this.duv.copy(this.motion),this.duv.x/=this.element.clientWidth,this.duv.y/=this.element.clientHeight,this.duv.multiplyScalar(2).multiply(this.uvComp),this.moveDistance=200*this.duv.length());let e=ro(this.env.renderer,this.env.camera);this.origin.setFromMatrixPosition(e.matrixWorld),this.direction.set(this.uv.x,this.uv.y,.5).unproject(e).sub(this.origin).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat)}onUpdate(){this.env.avatar.onMove(this,this.uv,this.duv),super.onUpdate(),this.motion.setScalar(0),this.duv.setScalar(0)}};var mo=class extends uo{constructor(e,r,o){let i=c=>{c.pointerType===e&&this.pointerID==null&&(this.pointerID=c.pointerId)},s=c=>{c.pointerType===e&&this.pointerID!=null&&(this.pointerID=null)},p=o.renderer.domElement;p.addEventListener("pointerdown",i),p.addEventListener("pointermove",i);super(e,r,o,new po(o));this.pointerID=null;p.addEventListener("pointerup",s),p.addEventListener("pointercancel",s),this.canMoveView=!0}onCheckEvent(e){return super.onCheckEvent(e)&&e.pointerId===this.pointerID}onReadEvent(e){this.position.set(e.offsetX,e.offsetY),this.motion.x+=e.movementX,this.motion.y+=e.movementY,super.onReadEvent(e),(e.type==="pointerdown"||e.type==="pointerup"||e.type==="pointercancel")&&this.setButton(e.button,e.type==="pointerdown")}};var da=class extends mo{constructor(e){super("mouse",1,e);this.allowPointerLock=!1;this.dz=0;this.keyMap=new Map([["`",3],["ContextMenu",2]]);this.element.addEventListener("wheel",r=>{r.preventDefault(),this.dz+=-r.deltaY*.1},{passive:!1}),this.element.addEventListener("contextmenu",r=>{r.preventDefault()}),this.element.addEventListener("pointerdown",r=>{this.onCheckEvent(r)&&this.allowPointerLock&&!this.isPointerLocked&&this.lockPointer()}),document.addEventListener("pointerlockchange",()=>{this.cursor.visible=!0}),window.addEventListener("keydown",r=>{this.isActive&&this.keyMap.has(r.key)&&this.setButton(this.keyMap.get(r.key),Ks(r))}),window.addEventListener("keyup",r=>{this.keyMap.has(r.key)&&this.setButton(this.keyMap.get(r.key),!1)}),Object.seal(this)}updatePointerOrientation(){this.isPointerLocked&&this.position.set(this.env.renderer.domElement.clientWidth,this.env.renderer.domElement.clientHeight).multiplyScalar(.5),super.updatePointerOrientation()}onUpdate(){super.onUpdate(),this.env.avatar.zoom(this.dz),this.dz=0}get isPointerLocked(){return document.pointerLockElement!=null}lockPointer(){this.element.requestPointerLock()}unlockPointer(){document.exitPointerLock()}vibrate(){}};var ua=class extends mo{constructor(t){super("pen",2,t),Object.seal(this)}vibrate(){}};function nv(n){return n.pointerId}var ma=class extends uo{constructor(e){super("touch",3,e,null);this.dz=0;this.lastZ=0;this.points=new Array;Object.seal(this)}get enabled(){return super.enabled}set enabled(e){super.enabled=e,ae(this.points)}onCheckEvent(e){return super.onCheckEvent(e)&&e.pointerId>-1}onReadEvent(e){if(Ec(this.points,e.pointerId,nv),(e.type==="pointerdown"||e.type==="pointermove")&&this.points.push(e),this.points.length===2){let o=this.points[0],i=this.points[1],s=i.offsetX-o.offsetX,p=i.offsetY-o.offsetY,c=5*Math.sqrt(s*s+p*p),m=c-this.lastZ;e.type==="pointermove"&&(this.dz+=m),this.lastZ=c}let r=1/this.points.length;if(e.type==="pointerdown"||e.type==="pointermove"){this.position.setScalar(0);for(let o of this.points)this.position.x+=r*o.offsetX,this.position.y+=r*o.offsetY,this.motion.x+=r*o.movementX,this.motion.y+=r*o.movementY}if(super.onReadEvent(e),e.type!=="pointermove"){let o=0;for(let i=0;i<this.points.length;++i){let s=this.points[i],p=1<<i;s.buttons!==0?o|=p:o&=~p}for(let i=0;i<10;++i){let s=this.isPressed(i),p=1<<i,c=(o&p)!==0;c!==s&&this.setButton(i,c)}}}onUpdate(){this.env.avatar.zoom(this.dz),super.onUpdate(),this.dz=0}vibrate(){navigator.vibrate(125)}};var ha=class extends q{constructor(e){super();this.env=e;this.raycaster=new THREE.Raycaster;this.queue=new Array;this.targetsFound=new Set;this.targets=new Array;this.hands=new Array;this.raycaster.camera=this.env.camera,this.raycaster.layers.set($s),this.mouse=new da(this.env),this.pen=new ua(this.env),this.touches=new ma(this.env);for(let r=0;r<2;++r)this.hands[r]=new ca(this.env,r);this.pointers=[this.mouse,this.pen,this.touches,...this.hands];for(let r of this.pointers)r.addBubbler(this),r.cursor&&G(this.env.stage,r.cursor);this.checkXRMouse(),Object.seal(this)}checkXRMouse(){let e=0;for(let o of this.hands.values())o.enabled&&++e;let r=e===0;this.mouse.enabled=r,this.pen.enabled=r,this.touches.enabled=r}refreshCursors(){for(let e of this.pointers)e.cursor&&(e.cursor=this.env.cursor3D.clone())}fireRay(e,r,o){this.raycaster.ray.origin.copy(e),this.raycaster.ray.direction.copy(r),this.raycaster.intersectObjects(this.targets,!1,o)}update(){for(this.targetsFound.clear(),ae(this.targets),this.queue.push(this.env.scene);this.queue.length>0;){let e=this.queue.shift();e.children.length>0&&this.queue.push(...e.children);let r=$r(e);r&&!this.targetsFound.has(r)&&(this.targetsFound.add(r),this.targets.push(...r.meshes))}for(let e of this.pointers)e.needsUpdate&&e.update()}};var rv=new j("fadecomplete"),fa=class extends q{constructor(e,r=.15){super();this.opacity=1;this.direction=0;this.material=Qr({name:"FaderMaterial",color:0,side:THREE.BackSide}),this.object=new THREE.Mesh(si,this.material),this.object.name=e,this.object.renderOrder=Number.MAX_VALUE,this.speed=1/r,this.object.layers.enableAll()}async fadeOut(){this.direction!=1&&(this.direction=1,await Ce(this,"fadecomplete"))}async fadeIn(){this.direction!=-1&&(this.direction=-1,await Ce(this,"fadecomplete"))}update(e){if(this.direction!==0){let r=this.direction*this.speed*e/1e3;0<=this.opacity&&this.opacity<=1&&(this.opacity+=r),(this.direction===1&&this.opacity>=1||this.direction===-1&&this.opacity<=0)&&(this.opacity=Xt(this.opacity,0,1),this.direction=0,this.dispatchEvent(rv))}this.material.opacity=this.opacity,this.material.transparent=this.opacity<1,this.material.needsUpdate=!0}};function dt(n,t,e,r,o,i){let s=new or(r,o,i,Bu);return s.position.set(n,t,e),s}var ov=.1,xa=class extends zt{constructor(){super();this.value=0;this.targetValue=0;this.object=new THREE.Object3D;this._enabled=!0;this.valueBar=new or(0,1,1,Du),this.valueBar.scale.set(0,1,1);let e=new THREE.Object3D;e.scale.set(1,.1,.1),G(this,G(e,this.valueBar),dt(-.5,0,-.05,.01,.1,.01),dt(-.5,0,.05,.01,.1,.01),dt(.5,0,-.05,.01,.1,.01),dt(.5,0,.05,.01,.1,.01),dt(-.5,-.05,0,.01,.01,.1),dt(.5,-.05,0,.01,.01,.1),dt(-.5,.05,0,.01,.01,.1),dt(.5,.05,0,.01,.01,.1),dt(0,-.05,-.05,1,.01,.01),dt(0,.05,-.05,1,.01,.01),dt(0,-.05,.05,1,.01,.01),dt(0,.05,.05,1,.01,.01)),gm(this,oo)}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,Ie(this,qr(this)||this.enabled))}report(e,r,o){super.report(e,r,o),this.targetValue=this.p}update(e){this.object.parent.visible&&(this.value=Math.min(this.targetValue,this.value+ov*e),this.valueBar.scale.set(this.value,1,1),this.valueBar.position.x=this.value/2-.5,Ie(this,this.enabled&&this.value>0))}};if(!Np()){let n=Element.prototype,t=Document.prototype;"webkitRequestFullscreen"in n?(n.requestFullscreen=n.webkitRequestFullscreen,t.exitFullscreen=t.webkitRequestFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.webkitFullscreenEnabled}},fullscreenElement:{get:function(){return this.webkitFullscreenElement}}})):"mozRequestFullScreen"in n?(n.requestFullscreen=n.mozRequestFullScreen,t.exitFullscreen=t.mozCancelFullScreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.mozFullScreenEnabled}},fullscreenElement:{get:function(){return this.mozFullScreenElement}}})):"msRequestFullscreen"in n&&(n.requestFullscreen=n.msRequestFullscreen,t.exitFullscreen=t.msExitFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.msFullscreenEnabled}},fullscreenElement:{get:function(){return this.msFullscreenElement}}}))}function Np(){return"requestFullscreen"in HTMLElement.prototype}var iv=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},ga=iv;var pi=Symbol("@@webxr-polyfill/EventTarget"),Jt=class{constructor(){this[pi]={listeners:new Map}}addEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let r=this[pi].listeners.get(t)||[];r.push(e),this[pi].listeners.set(t,r)}removeEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let r=this[pi].listeners.get(t)||[];for(let o=r.length;o>=0;o--)r[o]===e&&r.pop()}dispatchEvent(t,e){let r=this[pi].listeners.get(t)||[],o=[];for(let i=0;i<r.length;i++)o[i]=r[i];for(let i of o)i(e);typeof this[`on${t}`]=="function"&&this[`on${t}`](e)}};var Re=typeof Float32Array<"u"?Float32Array:Array;var GI=Math.PI/180;function Ot(){let n=new Re(16);return Re!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function Bm(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function Sn(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ar(n,t){let e=t[0],r=t[1],o=t[2],i=t[3],s=t[4],p=t[5],c=t[6],m=t[7],h=t[8],x=t[9],b=t[10],y=t[11],C=t[12],P=t[13],S=t[14],k=t[15],O=e*p-r*s,V=e*c-o*s,H=e*m-i*s,N=r*c-o*p,I=r*m-i*p,B=o*m-i*c,oe=h*P-x*C,ie=h*S-b*C,W=h*k-y*C,ne=x*S-b*P,_e=x*k-y*P,fe=b*k-y*S,se=O*fe-V*_e+H*ne+N*W-I*ie+B*oe;return se?(se=1/se,n[0]=(p*fe-c*_e+m*ne)*se,n[1]=(o*_e-r*fe-i*ne)*se,n[2]=(P*B-S*I+k*N)*se,n[3]=(b*I-x*B-y*N)*se,n[4]=(c*W-s*fe-m*ie)*se,n[5]=(e*fe-o*W+i*ie)*se,n[6]=(S*H-C*B-k*V)*se,n[7]=(h*B-b*H+y*V)*se,n[8]=(s*_e-p*W+m*oe)*se,n[9]=(r*W-e*_e-i*oe)*se,n[10]=(C*I-P*H+k*O)*se,n[11]=(x*H-h*I-y*O)*se,n[12]=(p*ie-s*ne-c*oe)*se,n[13]=(e*ne-r*ie+o*oe)*se,n[14]=(P*V-C*N-S*O)*se,n[15]=(h*N-x*V+b*O)*se,n):null}function $t(n,t,e){let r=t[0],o=t[1],i=t[2],s=t[3],p=t[4],c=t[5],m=t[6],h=t[7],x=t[8],b=t[9],y=t[10],C=t[11],P=t[12],S=t[13],k=t[14],O=t[15],V=e[0],H=e[1],N=e[2],I=e[3];return n[0]=V*r+H*p+N*x+I*P,n[1]=V*o+H*c+N*b+I*S,n[2]=V*i+H*m+N*y+I*k,n[3]=V*s+H*h+N*C+I*O,V=e[4],H=e[5],N=e[6],I=e[7],n[4]=V*r+H*p+N*x+I*P,n[5]=V*o+H*c+N*b+I*S,n[6]=V*i+H*m+N*y+I*k,n[7]=V*s+H*h+N*C+I*O,V=e[8],H=e[9],N=e[10],I=e[11],n[8]=V*r+H*p+N*x+I*P,n[9]=V*o+H*c+N*b+I*S,n[10]=V*i+H*m+N*y+I*k,n[11]=V*s+H*h+N*C+I*O,V=e[12],H=e[13],N=e[14],I=e[15],n[12]=V*r+H*p+N*x+I*P,n[13]=V*o+H*c+N*b+I*S,n[14]=V*i+H*m+N*y+I*k,n[15]=V*s+H*h+N*C+I*O,n}function Rn(n,t,e){let r=t[0],o=t[1],i=t[2],s=t[3],p=r+r,c=o+o,m=i+i,h=r*p,x=r*c,b=r*m,y=o*c,C=o*m,P=i*m,S=s*p,k=s*c,O=s*m;return n[0]=1-(y+P),n[1]=x+O,n[2]=b-k,n[3]=0,n[4]=x-O,n[5]=1-(h+P),n[6]=C+S,n[7]=0,n[8]=b+k,n[9]=C-S,n[10]=1-(h+y),n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}function va(n,t){return n[0]=t[12],n[1]=t[13],n[2]=t[14],n}function Aa(n,t){let e=t[0]+t[5]+t[10],r=0;return e>0?(r=Math.sqrt(e+1)*2,n[3]=.25*r,n[0]=(t[6]-t[9])/r,n[1]=(t[8]-t[2])/r,n[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=Math.sqrt(1+t[0]-t[5]-t[10])*2,n[3]=(t[6]-t[9])/r,n[0]=.25*r,n[1]=(t[1]+t[4])/r,n[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=Math.sqrt(1+t[5]-t[0]-t[10])*2,n[3]=(t[8]-t[2])/r,n[0]=(t[1]+t[4])/r,n[1]=.25*r,n[2]=(t[6]+t[9])/r):(r=Math.sqrt(1+t[10]-t[0]-t[5])*2,n[3]=(t[1]-t[4])/r,n[0]=(t[8]+t[2])/r,n[1]=(t[6]+t[9])/r,n[2]=.25*r),n}function _a(n,t,e,r,o){let i=1/Math.tan(t/2),s;return n[0]=i/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,o!=null&&o!==1/0?(s=1/(r-o),n[10]=(o+r)*s,n[14]=2*o*r*s):(n[10]=-1,n[14]=-2*r),n}function nt(){let n=new Re(3);return Re!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Xp(n){var t=new Re(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function sv(n){let t=n[0],e=n[1],r=n[2];return Math.sqrt(t*t+e*e+r*r)}function Ye(n,t,e){let r=new Re(3);return r[0]=n,r[1]=t,r[2]=e,r}function zp(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function ho(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function Up(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function ba(n,t){let e=t[0],r=t[1],o=t[2],i=e*e+r*r+o*o;return i>0&&(i=1/Math.sqrt(i),n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i),n}function ui(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Ea(n,t,e){let r=t[0],o=t[1],i=t[2],s=e[0],p=e[1],c=e[2];return n[0]=o*c-i*p,n[1]=i*s-r*c,n[2]=r*p-o*s,n}function pr(n,t,e){let r=e[0],o=e[1],i=e[2],s=e[3],p=t[0],c=t[1],m=t[2],h=o*m-i*c,x=i*p-r*m,b=r*c-o*p,y=o*b-i*x,C=i*h-r*b,P=r*x-o*h,S=s*2;return h*=S,x*=S,b*=S,y*=2,C*=2,P*=2,n[0]=p+h+y,n[1]=c+x+C,n[2]=m+b+P,n}function Hm(n,t){let e=Ye(n[0],n[1],n[2]),r=Ye(t[0],t[1],t[2]);ba(e,e),ba(r,r);let o=ui(e,r);return o>1?0:o<-1?Math.PI:Math.acos(o)}var Nm=sv;var WI=function(){let n=nt();return function(t,e,r,o,i,s){let p,c;for(e||(e=3),r||(r=0),o?c=Math.min(o*e+r,t.length):c=t.length,p=r;p<c;p+=e)n[0]=t[p],n[1]=t[p+1],n[2]=t[p+2],i(n,n,s),t[p]=n[0],t[p+1]=n[1],t[p+2]=n[2];return t}}();function Xm(){let n=new Re(9);return Re!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function lv(){let n=new Re(4);return Re!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function zm(n){let t=new Re(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function Um(n,t,e,r){let o=new Re(4);return o[0]=n,o[1]=t,o[2]=e,o[3]=r,o}function jm(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function Gm(n,t){let e=t[0],r=t[1],o=t[2],i=t[3],s=e*e+r*r+o*o+i*i;return s>0&&(s=1/Math.sqrt(s),n[0]=e*s,n[1]=r*s,n[2]=o*s,n[3]=i*s),n}var qI=function(){let n=lv();return function(t,e,r,o,i,s){let p,c;for(e||(e=4),r||(r=0),o?c=Math.min(o*e+r,t.length):c=t.length,p=r;p<c;p+=e)n[0]=t[p],n[1]=t[p+1],n[2]=t[p+2],n[3]=t[p+3],i(n,n,s),t[p]=n[0],t[p+1]=n[1],t[p+2]=n[2],t[p+3]=n[3];return t}}();function rt(){let n=new Re(4);return Re!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function cv(n,t,e){e=e*.5;let r=Math.sin(e);return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=Math.cos(e),n}function jp(n,t,e){let r=t[0],o=t[1],i=t[2],s=t[3],p=e[0],c=e[1],m=e[2],h=e[3];return n[0]=r*h+s*p+o*m-i*c,n[1]=o*h+s*c+i*p-r*m,n[2]=i*h+s*m+r*c-o*p,n[3]=s*h-r*p-o*c-i*m,n}function fo(n,t,e,r){let o=t[0],i=t[1],s=t[2],p=t[3],c=e[0],m=e[1],h=e[2],x=e[3],b,y,C,P,S;return y=o*c+i*m+s*h+p*x,y<0&&(y=-y,c=-c,m=-m,h=-h,x=-x),1-y>1e-6?(b=Math.acos(y),C=Math.sin(b),P=Math.sin((1-r)*b)/C,S=Math.sin(r*b)/C):(P=1-r,S=r),n[0]=P*o+S*c,n[1]=P*i+S*m,n[2]=P*s+S*h,n[3]=P*p+S*x,n}function Gp(n,t){let e=t[0],r=t[1],o=t[2],i=t[3],s=e*e+r*r+o*o+i*i,p=s?1/s:0;return n[0]=-e*p,n[1]=-r*p,n[2]=-o*p,n[3]=i*p,n}function dv(n,t){let e=t[0]+t[4]+t[8],r;if(e>0)r=Math.sqrt(e+1),n[3]=.5*r,r=.5/r,n[0]=(t[5]-t[7])*r,n[1]=(t[6]-t[2])*r,n[2]=(t[1]-t[3])*r;else{let o=0;t[4]>t[0]&&(o=1),t[8]>t[o*3+o]&&(o=2);let i=(o+1)%3,s=(o+2)%3;r=Math.sqrt(t[o*3+o]-t[i*3+i]-t[s*3+s]+1),n[o]=.5*r,r=.5/r,n[3]=(t[i*3+s]-t[s*3+i])*r,n[i]=(t[i*3+o]+t[o*3+i])*r,n[s]=(t[s*3+o]+t[o*3+s])*r}return n}function Wm(n,t,e,r){let o=.5*Math.PI/180;t*=o,e*=o,r*=o;let i=Math.sin(t),s=Math.cos(t),p=Math.sin(e),c=Math.cos(e),m=Math.sin(r),h=Math.cos(r);return n[0]=i*c*h-s*p*m,n[1]=s*p*h+i*c*m,n[2]=s*c*m-i*p*h,n[3]=s*c*h+i*p*m,n}var Wp=zm,qm=Um,wa=jm;var mi=Gm;var rV=function(){let n=nt(),t=Ye(1,0,0),e=Ye(0,1,0);return function(r,o,i){let s=ui(o,i);return s<-.999999?(Ea(n,t,o),Nm(n)<1e-6&&Ea(n,e,o),ba(n,n),cv(r,n,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Ea(n,o,i),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=1+s,mi(r,r))}}(),oV=function(){let n=rt(),t=rt();return function(e,r,o,i,s,p){return fo(n,r,s,p),fo(t,o,i,p),fo(e,n,t,2*p*(1-p)),e}}(),iV=function(){let n=Xm();return function(t,e,r,o){return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=o[0],n[4]=o[1],n[7]=o[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],mi(t,dv(t,n))}}();var te=Symbol("@@webxr-polyfill/XRRigidTransform"),Zt=class{constructor(){if(this[te]={matrix:null,position:null,orientation:null,inverse:null},arguments.length===0)this[te].matrix=Sn(new Float32Array(16));else if(arguments.length===1)arguments[0]instanceof Float32Array?this[te].matrix=arguments[0]:(this[te].position=this._getPoint(arguments[0]),this[te].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(arguments.length===2)this[te].position=this._getPoint(arguments[0]),this[te].orientation=this._getPoint(arguments[1]);else throw new Error("Too many arguments!");if(this[te].matrix){let t=nt();va(t,this[te].matrix),this[te].position=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2]});let e=rt();Aa(e,this[te].matrix),this[te].orientation=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2],w:e[3]})}else this[te].matrix=Sn(new Float32Array(16)),Rn(this[te].matrix,qm(this[te].orientation.x,this[te].orientation.y,this[te].orientation.z,this[te].orientation.w),Ye(this[te].position.x,this[te].position.y,this[te].position.z))}_getPoint(t){return t instanceof DOMPointReadOnly?t:DOMPointReadOnly.fromPoint(t)}get matrix(){return this[te].matrix}get position(){return this[te].position}get orientation(){return this[te].orientation}get inverse(){if(this[te].inverse===null){let t=Sn(new Float32Array(16));ar(t,this[te].matrix),this[te].inverse=new Zt(t),this[te].inverse[te].inverse=this}return this[te].inverse}};var Ae=Symbol("@@webxr-polyfill/XRSpace");var ut=class{constructor(t=null,e=null){this[Ae]={specialType:t,inputSource:e,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[Ae].specialType}get _inputSource(){return this[Ae].inputSource}_ensurePoseUpdated(t,e){e!=this[Ae].lastFrameId&&(this[Ae].lastFrameId=e,this._onPoseUpdate(t))}_onPoseUpdate(t){this[Ae].specialType=="viewer"&&(this._baseMatrix=t.getBasePoseMatrix())}set _baseMatrix(t){this[Ae].baseMatrix=t,this[Ae].inverseBaseMatrix=null}get _baseMatrix(){return this[Ae].baseMatrix||this[Ae].inverseBaseMatrix&&(this[Ae].baseMatrix=new Float32Array(16),ar(this[Ae].baseMatrix,this[Ae].inverseBaseMatrix)),this[Ae].baseMatrix}set _inverseBaseMatrix(t){this[Ae].inverseBaseMatrix=t,this[Ae].baseMatrix=null}get _inverseBaseMatrix(){return this[Ae].inverseBaseMatrix||this[Ae].baseMatrix&&(this[Ae].inverseBaseMatrix=new Float32Array(16),ar(this[Ae].inverseBaseMatrix,this[Ae].baseMatrix)),this[Ae].inverseBaseMatrix}_getSpaceRelativeTransform(t){if(!this._inverseBaseMatrix||!t._baseMatrix)return null;let e=new Float32Array(16);return $t(e,this._inverseBaseMatrix,t._baseMatrix),new Zt(e)}};var uv=1.6,Pn=Symbol("@@webxr-polyfill/XRReferenceSpace"),hi=["viewer","local","local-floor","bounded-floor","unbounded"];function mv(n){return n==="bounded-floor"||n==="local-floor"}var Dt=class extends ut{constructor(t,e=null){if(!hi.includes(t))throw new Error(`XRReferenceSpaceType must be one of ${hi}`);if(super(t),t==="bounded-floor"&&!e)throw new Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");mv(t)&&!e&&(e=Sn(new Float32Array(16)),e[13]=uv),this._inverseBaseMatrix=e||Sn(new Float32Array(16)),this[Pn]={type:t,transform:e,originOffset:Sn(new Float32Array(16))}}_transformBasePoseMatrix(t,e){$t(t,this._inverseBaseMatrix,e)}_originOffsetMatrix(){return this[Pn].originOffset}_adjustForOriginOffset(t){let e=new Float32Array(16);ar(e,this[Pn].originOffset),$t(t,e,t)}_getSpaceRelativeTransform(t){let e=super._getSpaceRelativeTransform(t);return this._adjustForOriginOffset(e.matrix),new XRRigidTransform(e.matrix)}getOffsetReferenceSpace(t){let e=new Dt(this[Pn].type,this[Pn].transform,this[Pn].bounds);return $t(e[Pn].originOffset,this[Pn].originOffset,t.matrix),e}};var Ge=Symbol("@@webxr-polyfill/XR"),hv=["inline","immersive-vr","immersive-ar"],fv={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},xv=`Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode
or navigator.xr.requestSession('inline') prior to requesting an immersive
session. This is a limitation specific to the WebXR Polyfill and does not apply
to native implementations of the API.`,fi=class extends Jt{constructor(t){super(),this[Ge]={device:null,devicePromise:t,immersiveSession:null,inlineSessions:new Set},t.then(e=>{this[Ge].device=e})}async isSessionSupported(t){return this[Ge].device||await this[Ge].devicePromise,t!="inline"?Promise.resolve(this[Ge].device.isSessionSupported(t)):Promise.resolve(!0)}async requestSession(t,e){if(!this[Ge].device){if(t!="inline")throw new Error(xv);await this[Ge].devicePromise}if(!hv.includes(t))throw new TypeError(`The provided value '${t}' is not a valid enum value of type XRSessionMode`);let r=fv[t],o=r.requiredFeatures.concat(e&&e.requiredFeatures?e.requiredFeatures:[]),i=r.optionalFeatures.concat(e&&e.optionalFeatures?e.optionalFeatures:[]),s=new Set,p=!1;for(let x of o)this[Ge].device.isFeatureSupported(x)?s.add(x):(console.error(`The required feature '${x}' is not supported`),p=!0);if(p)throw new DOMException("Session does not support some required features","NotSupportedError");for(let x of i)this[Ge].device.isFeatureSupported(x)?s.add(x):console.log(`The optional feature '${x}' is not supported`);let c=await this[Ge].device.requestSession(t,s),m=new XRSession(this[Ge].device,t,c);t=="inline"?this[Ge].inlineSessions.add(m):this[Ge].immersiveSession=m;let h=()=>{t=="inline"?this[Ge].inlineSessions.delete(m):this[Ge].immersiveSession=null,m.removeEventListener("end",h)};return m.addEventListener("end",h),m}};var Qp;if("performance"in ga)Qp=()=>performance.now();else{let n=Date.now();Qp=()=>Date.now()-n}var Ta=Qp;var Kp=Symbol("@@webxr-polyfill/XRPose"),cr=class{constructor(t,e){this[Kp]={transform:t,emulatedPosition:e}}get transform(){return this[Kp].transform}get emulatedPosition(){return this[Kp].emulatedPosition}};var Qm=Symbol("@@webxr-polyfill/XRViewerPose"),dr=class extends cr{constructor(t,e,r=!1){super(t,r),this[Qm]={views:e}}get views(){return this[Qm].views}};var xi=Symbol("@@webxr-polyfill/XRViewport"),ur=class{constructor(t){this[xi]={target:t}}get x(){return this[xi].target.x}get y(){return this[xi].target.y}get width(){return this[xi].target.width}get height(){return this[xi].target.height}};var Km=["left","right","none"],Cn=Symbol("@@webxr-polyfill/XRView"),mr=class{constructor(t,e,r,o){if(!Km.includes(r))throw new Error(`XREye must be one of: ${Km}`);let i=Object.create(null),s=new ur(i);this[Cn]={device:t,eye:r,viewport:s,temp:i,sessionId:o,transform:e}}get eye(){return this[Cn].eye}get projectionMatrix(){return this[Cn].device.getProjectionMatrix(this.eye)}get transform(){return this[Cn].transform}_getViewport(t){if(this[Cn].device.getViewport(this[Cn].sessionId,this.eye,t,this[Cn].temp))return this[Cn].viewport}};var ye=Symbol("@@webxr-polyfill/XRFrame"),Ym="XRFrame access outside the callback that produced it is invalid.",gv="getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.",vv=0,In=class{constructor(t,e,r){this[ye]={id:++vv,active:!1,animationFrame:!1,device:t,session:e,sessionId:r}}get session(){return this[ye].session}getViewerPose(t){if(!this[ye].animationFrame)throw new DOMException(gv,"InvalidStateError");if(!this[ye].active)throw new DOMException(Ym,"InvalidStateError");let e=this[ye].device,r=this[ye].session;r[w].viewerSpace._ensurePoseUpdated(e,this[ye].id),t._ensurePoseUpdated(e,this[ye].id);let o=t._getSpaceRelativeTransform(r[w].viewerSpace),i=[];for(let p of r[w].viewSpaces){p._ensurePoseUpdated(e,this[ye].id);let c=t._getSpaceRelativeTransform(p),m=new mr(e,c,p.eye,this[ye].sessionId);i.push(m)}return new dr(o,i,!1)}getPose(t,e){if(!this[ye].active)throw new DOMException(Ym,"InvalidStateError");let r=this[ye].device;if(t._specialType==="target-ray"||t._specialType==="grip")return r.getInputPose(t._inputSource,e,t._specialType);{t._ensurePoseUpdated(r,this[ye].id),e._ensurePoseUpdated(r,this[ye].id);let o=e._getSpaceRelativeTransform(t);return o?new XRPose(o,!1):null}return null}};var gi=Symbol("@@webxr-polyfill/XRRenderState"),Av=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null}),Vn=class{constructor(t={}){let e=Object.assign({},Av,t);this[gi]={config:e}}get depthNear(){return this[gi].config.depthNear}get depthFar(){return this[gi].config.depthFar}get inlineVerticalFieldOfView(){return this[gi].config.inlineVerticalFieldOfView}get baseLayer(){return this[gi].config.baseLayer}};var Ma=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),vi=Symbol("@@webxr-polyfill/xr-compatible");var hr=Symbol("@@webxr-polyfill/XRWebGLLayer"),_v=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),Ai=class{constructor(t,e,r={}){let o=Object.assign({},_v,r);if(!(t instanceof fr))throw new Error("session must be a XRSession");if(t.ended)throw new Error("InvalidStateError");if(e[Ma]&&e[vi]!==!0)throw new Error("InvalidStateError");let i=e.getParameter(e.FRAMEBUFFER_BINDING);this[hr]={context:e,config:o,framebuffer:i,session:t}}get context(){return this[hr].context}get antialias(){return this[hr].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return this[hr].framebuffer}get framebufferWidth(){return this[hr].context.drawingBufferWidth}get framebufferHeight(){return this[hr].context.drawingBufferHeight}get _session(){return this[hr].session}getViewport(t){return t._getViewport(this)}static getNativeFramebufferScaleFactor(t){if(!t)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return t[w].ended?0:1}};var Yp=Symbol("@@webxr-polyfill/XRInputSourceEvent"),en=class extends Event{constructor(t,e){super(t,e),this[Yp]={frame:e.frame,inputSource:e.inputSource},Object.setPrototypeOf(this,en.prototype)}get frame(){return this[Yp].frame}get inputSource(){return this[Yp].inputSource}};var Jm=Symbol("@@webxr-polyfill/XRSessionEvent"),Bt=class extends Event{constructor(t,e){super(t,e),this[Jm]={session:e.session},Object.setPrototypeOf(this,Bt.prototype)}get session(){return this[Jm].session}};var Sa=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),tn=class extends Event{constructor(t,e){super(t,e),this[Sa]={session:e.session,added:e.added,removed:e.removed},Object.setPrototypeOf(this,tn.prototype)}get session(){return this[Sa].session}get added(){return this[Sa].added}get removed(){return this[Sa].removed}};var w=Symbol("@@webxr-polyfill/XRSession"),_i=class extends ut{constructor(t){super(t)}get eye(){return this._specialType}_onPoseUpdate(t){this._inverseBaseMatrix=t.getBaseViewMatrix(this._specialType)}},fr=class extends Jt{constructor(t,e,r){super();let o=e!="inline",i=new Vn({inlineVerticalFieldOfView:o?null:Math.PI*.5});this[w]={device:t,mode:e,immersive:o,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:r,activeRenderState:i,pendingRenderState:null,viewerSpace:new Dt("viewer"),viewSpaces:[],currentInputSources:[]},o?this[w].viewSpaces.push(new _i("left"),new _i("right")):this[w].viewSpaces.push(new _i("none")),this[w].onDeviceFrame=()=>{if(this[w].ended||this[w].suspended||(this[w].deviceFrameHandle=null,this[w].startDeviceFrameLoop(),this[w].pendingRenderState!==null&&(this[w].activeRenderState=new Vn(this[w].pendingRenderState),this[w].pendingRenderState=null,this[w].activeRenderState.baseLayer&&this[w].device.onBaseLayerSet(this[w].id,this[w].activeRenderState.baseLayer)),this[w].activeRenderState.baseLayer===null))return;let s=new In(t,this,this[w].id),p=this[w].currentFrameCallbacks=this[w].frameCallbacks;this[w].frameCallbacks=[],s[ye].active=!0,s[ye].animationFrame=!0,this[w].device.onFrameStart(this[w].id,this[w].activeRenderState),this._checkInputSourcesChange();let c=Ta();for(let m=0;m<p.length;m++)try{!p[m].cancelled&&typeof p[m].callback=="function"&&p[m].callback(c,s)}catch(h){console.error(h)}this[w].currentFrameCallbacks=null,s[ye].active=!1,this[w].device.onFrameEnd(this[w].id)},this[w].startDeviceFrameLoop=()=>{this[w].deviceFrameHandle===null&&(this[w].deviceFrameHandle=this[w].device.requestAnimationFrame(this[w].onDeviceFrame))},this[w].stopDeviceFrameLoop=()=>{let s=this[w].deviceFrameHandle;s!==null&&(this[w].device.cancelAnimationFrame(s),this[w].deviceFrameHandle=null)},this[w].onPresentationEnd=s=>{if(s!==this[w].id){this[w].suspended=!1,this[w].startDeviceFrameLoop(),this.dispatchEvent("focus",{session:this});return}this[w].ended=!0,this[w].stopDeviceFrameLoop(),t.removeEventListener("@@webxr-polyfill/vr-present-end",this[w].onPresentationEnd),t.removeEventListener("@@webxr-polyfill/vr-present-start",this[w].onPresentationStart),t.removeEventListener("@@webxr-polyfill/input-select-start",this[w].onSelectStart),t.removeEventListener("@@webxr-polyfill/input-select-end",this[w].onSelectEnd),this.dispatchEvent("end",new Bt("end",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-end",this[w].onPresentationEnd),this[w].onPresentationStart=s=>{s!==this[w].id&&(this[w].suspended=!0,this[w].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-start",this[w].onPresentationStart),this[w].onSelectStart=s=>{s.sessionId===this[w].id&&this[w].dispatchInputSourceEvent("selectstart",s.inputSource)},t.addEventListener("@@webxr-polyfill/input-select-start",this[w].onSelectStart),this[w].onSelectEnd=s=>{s.sessionId===this[w].id&&(this[w].dispatchInputSourceEvent("selectend",s.inputSource),this[w].dispatchInputSourceEvent("select",s.inputSource))},t.addEventListener("@@webxr-polyfill/input-select-end",this[w].onSelectEnd),this[w].onSqueezeStart=s=>{s.sessionId===this[w].id&&this[w].dispatchInputSourceEvent("squeezestart",s.inputSource)},t.addEventListener("@@webxr-polyfill/input-squeeze-start",this[w].onSqueezeStart),this[w].onSqueezeEnd=s=>{s.sessionId===this[w].id&&(this[w].dispatchInputSourceEvent("squeezeend",s.inputSource),this[w].dispatchInputSourceEvent("squeeze",s.inputSource))},t.addEventListener("@@webxr-polyfill/input-squeeze-end",this[w].onSqueezeEnd),this[w].dispatchInputSourceEvent=(s,p)=>{let c=new In(t,this,this[w].id),m=new en(s,{frame:c,inputSource:p});c[ye].active=!0,this.dispatchEvent(s,m),c[ye].active=!1},this[w].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[w].activeRenderState}get environmentBlendMode(){return this[w].device.environmentBlendMode||"opaque"}async requestReferenceSpace(t){if(this[w].ended)return;if(!hi.includes(t))throw new TypeError(`XRReferenceSpaceType must be one of ${hi}`);if(!this[w].device.doesSessionSupportReferenceSpace(this[w].id,t))throw new DOMException(`The ${t} reference space is not supported by this session.`,"NotSupportedError");if(t==="viewer")return this[w].viewerSpace;let e=await this[w].device.requestFrameOfReferenceTransform(t);if(t==="bounded-floor")throw e?this[w].device.requestStageBounds()?new DOMException(`The WebXR polyfill does not support the ${t} reference space yet.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError");return new Dt(t,e)}requestAnimationFrame(t){if(this[w].ended)return;let e=++this[w].frameHandle;return this[w].frameCallbacks.push({handle:e,callback:t,cancelled:!1}),e}cancelAnimationFrame(t){let e=this[w].frameCallbacks,r=e.findIndex(o=>o&&o.handle===t);r>-1&&(e[r].cancelled=!0,e.splice(r,1)),e=this[w].currentFrameCallbacks,e&&(r=e.findIndex(o=>o&&o.handle===t),r>-1&&(e[r].cancelled=!0))}get inputSources(){return this[w].device.getInputSources()}async end(){if(!this[w].ended)return this[w].immersive&&(this[w].ended=!0,this[w].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[w].onPresentationStart),this[w].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[w].onPresentationEnd),this[w].device.removeEventListener("@@webxr-polyfill/input-select-start",this[w].onSelectStart),this[w].device.removeEventListener("@@webxr-polyfill/input-select-end",this[w].onSelectEnd),this.dispatchEvent("end",new Bt("end",{session:this}))),this[w].stopDeviceFrameLoop(),this[w].device.endSession(this[w].id)}updateRenderState(t){if(this[w].ended){let r="Can't call updateRenderState on an XRSession that has already ended.";throw new Error(r)}if(t.baseLayer&&t.baseLayer._session!==this){let r="Called updateRenderState with a base layer that was created by a different session.";throw new Error(r)}if(t.inlineVerticalFieldOfView!==null&&t.inlineVerticalFieldOfView!==void 0)if(this[w].immersive){let r="inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.";throw new Error(r)}else t.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,t.inlineVerticalFieldOfView));if(this[w].pendingRenderState===null){let r=this[w].activeRenderState;this[w].pendingRenderState={depthNear:r.depthNear,depthFar:r.depthFar,inlineVerticalFieldOfView:r.inlineVerticalFieldOfView,baseLayer:r.baseLayer}}Object.assign(this[w].pendingRenderState,t)}_checkInputSourcesChange(){let t=[],e=[],r=this.inputSources,o=this[w].currentInputSources;for(let i of r)o.includes(i)||t.push(i);for(let i of o)r.includes(i)||e.push(i);(t.length>0||e.length>0)&&this.dispatchEvent("inputsourceschange",new tn("inputsourceschange",{session:this,added:t,removed:e})),this[w].currentInputSources.length=0;for(let i of r)this[w].currentInputSources.push(i)}};var Ln=Symbol("@@webxr-polyfill/XRInputSource"),xr=class{constructor(t){this[Ln]={impl:t,gripSpace:new ut("grip",this),targetRaySpace:new ut("target-ray",this)}}get handedness(){return this[Ln].impl.handedness}get targetRayMode(){return this[Ln].impl.targetRayMode}get gripSpace(){let t=this[Ln].impl.targetRayMode;return t==="gaze"||t==="screen"?null:this[Ln].gripSpace}get targetRaySpace(){return this[Ln].targetRaySpace}get profiles(){return this[Ln].impl.profiles}get gamepad(){return this[Ln].impl.gamepad}};var Jp=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),gr=class extends Event{constructor(t,e){super(t,e),this[Jp]={referenceSpace:e.referenceSpace,transform:e.transform||null},Object.setPrototypeOf(this,gr.prototype)}get referenceSpace(){return this[Jp].referenceSpace}get transform(){return this[Jp].transform}};var Ra={XRSystem:fi,XRSession:fr,XRSessionEvent:Bt,XRFrame:In,XRView:mr,XRViewport:ur,XRViewerPose:dr,XRWebGLLayer:Ai,XRSpace:ut,XRReferenceSpace:Dt,XRReferenceSpaceEvent:gr,XRInputSource:xr,XRInputSourceEvent:en,XRInputSourcesChangeEvent:tn,XRRenderState:Vn,XRRigidTransform:Zt,XRPose:cr};var $p=n=>typeof n.prototype.makeXRCompatible=="function"?!1:(n.prototype.makeXRCompatible=function(){return this[vi]=!0,Promise.resolve()},!0),Zp=n=>{let t=n.prototype.getContext;n.prototype.getContext=function(e,r){let o=t.call(this,e,r);return o&&(o[Ma]=!0,r&&"xrCompatible"in r&&(o[vi]=r.xrCompatible)),o}};var $m=n=>!!(n.ImageBitmapRenderingContext&&n.createImageBitmap),Zm=n=>{var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(n.navigator.userAgent||n.navigator.vendor||n.opera),t},eh=n=>{n.style.display="block",n.style.position="absolute",n.style.width=n.style.height="1px",n.style.top=n.style.left="0px"};var dh=rf(th());var vr=class extends Jt{constructor(t){super(),this.global=t,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(t,e){throw new Error("Not implemented")}isSessionSupported(t){throw new Error("Not implemented")}isFeatureSupported(t){throw new Error("Not implemented")}async requestSession(t,e){throw new Error("Not implemented")}requestAnimationFrame(t){throw new Error("Not implemented")}onFrameStart(t){throw new Error("Not implemented")}onFrameEnd(t){throw new Error("Not implemented")}doesSessionSupportReferenceSpace(t,e){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(t,e){}cancelAnimationFrame(t){throw new Error("Not implemented")}endSession(t){throw new Error("Not implemented")}getViewport(t,e,r,o){throw new Error("Not implemented")}getProjectionMatrix(t){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(t){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(t,e,r){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}};var bv={mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},Ev={mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},yv={mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},nh={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},wv={mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[Math.PI*-.08,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},Tv={mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},Mv={mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},nc={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},Sv={"Daydream Controller":bv,"Gear VR Controller":Tv,"HTC Vive Focus Controller":Ev,"Oculus Go Controller":yv,"Oculus Touch (Right)":nh,"Oculus Touch (Left)":nh,"OpenVR Gamepad":wv,"Spatial Controller (Spatial Interaction Source) 045E-065A":nc,"Spatial Controller (Spatial Interaction Source) 045E-065D":Mv,"Windows Mixed Reality (Right)":nc,"Windows Mixed Reality (Left)":nc},rh=Sv;var oh=Ye(.155,-.465,-.15),Rv=Ye(-.155,-.465,-.15),Pv=Ye(0,0,-.25),Cv=Ye(0,0,.05),ih=Ye(-.08,.14,.08),sh=.4,Iv=.4,Vv=.61,Lv=.175,kv=.12,Ov=.87,ah=180/Math.PI;function Dv(n,t,e){function r(c,m,h){return c<m?m:c>h?h:c}var o=t[0]*t[0],i=t[1]*t[1],s=t[2]*t[2],p=t[3]*t[3];if(e==="XYZ")n[0]=Math.atan2(2*(t[0]*t[3]-t[1]*t[2]),p-o-i+s),n[1]=Math.asin(r(2*(t[0]*t[2]+t[1]*t[3]),-1,1)),n[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),p+o-i-s);else if(e==="YXZ")n[0]=Math.asin(r(2*(t[0]*t[3]-t[1]*t[2]),-1,1)),n[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),p-o-i+s),n[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),p-o+i-s);else if(e==="ZXY")n[0]=Math.asin(r(2*(t[0]*t[3]+t[1]*t[2]),-1,1)),n[1]=Math.atan2(2*(t[1]*t[3]-t[2]*t[0]),p-o-i+s),n[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),p-o+i-s);else if(e==="ZYX")n[0]=Math.atan2(2*(t[0]*t[3]+t[2]*t[1]),p-o-i+s),n[1]=Math.asin(r(2*(t[1]*t[3]-t[0]*t[2]),-1,1)),n[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),p+o-i-s);else if(e==="YZX")n[0]=Math.atan2(2*(t[0]*t[3]-t[2]*t[1]),p-o+i-s),n[1]=Math.atan2(2*(t[1]*t[3]-t[0]*t[2]),p+o-i-s),n[2]=Math.asin(r(2*(t[0]*t[1]+t[2]*t[3]),-1,1));else if(e==="XZY")n[0]=Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),p-o+i-s),n[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),p+o-i-s),n[2]=Math.asin(r(2*(t[2]*t[3]-t[0]*t[1]),-1,1));else{console.log("No order given for quaternion to euler conversion.");return}}var bi=class{constructor(){this.hand="right",this.headElbowOffset=oh,this.controllerQ=rt(),this.lastControllerQ=rt(),this.headQ=rt(),this.headPos=nt(),this.elbowPos=nt(),this.wristPos=nt(),this.time=null,this.lastTime=null,this.rootQ=rt(),this.position=nt()}setHandedness(t){this.hand!=t&&(this.hand=t,this.hand=="left"?this.headElbowOffset=Rv:this.headElbowOffset=oh)}update(t,e){this.time=Ta(),t&&(wa(this.lastControllerQ,this.controllerQ),wa(this.controllerQ,t)),e&&(va(this.headPos,e),Aa(this.headQ,e));let r=this.getHeadYawOrientation_(),o=this.quatAngle_(this.lastControllerQ,this.controllerQ),i=(this.time-this.lastTime)/1e3;o/i>Vv?fo(this.rootQ,this.rootQ,r,Math.min(o/Lv,1)):wa(this.rootQ,r);let p=Ye(0,0,-1);pr(p,p,this.controllerQ);let c=ui(p,[0,1,0]),m=this.clamp_((c-kv)/Ov,0,1),h=Wp(this.rootQ);Gp(h,h),jp(h,h,this.controllerQ);let x=this.elbowPos;zp(x,this.headPos),ho(x,x,this.headElbowOffset);let b=Xp(ih);Up(b,b,m),ho(x,x,b);let C=this.quatAngle_(h,rt())*ah,P=1-Math.pow(C/180,4);sssss;let S=sh,k=1-sh,O=P*(S+k*m*Iv),V=rt();fo(V,V,h,O);let H=Gp(rt(),V),N=Wp(h);jp(N,N,H);let I=this.wristPos;zp(I,Cv),pr(I,I,V),ho(I,I,Pv),pr(I,I,N),ho(I,I,x);let B=Xp(ih);Up(B,B,m),ho(this.position,this.wristPos,B),pr(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let t=nt();return Dv(t,this.headQ,"YXZ"),Wm(rt(),0,t[1]*ah,0)}clamp_(t,e,r){return Math.min(Math.max(t,e),r)}quatAngle_(t,e){let r=[0,0,-1],o=[0,0,-1];return pr(r,r,t),pr(o,o,e),Hm(r,o)}};var Ne=Symbol("@@webxr-polyfill/XRRemappedGamepad"),lh={pressed:!1,touched:!1,value:0};Object.freeze(lh);var rc=class{constructor(t,e,r){if(r||(r={}),r.userAgentOverrides){for(let m in r.userAgentOverrides)if(navigator.userAgent.includes(m)){let h=r.userAgentOverrides[m];for(let x in h)x in r?Object.assign(r[x],h[x]):r[x]=h[x];break}}let o=new Array(r.axes&&r.axes.length?r.axes.length:t.axes.length),i=new Array(r.buttons&&r.buttons.length?r.buttons.length:t.buttons.length),s=null;if(r.gripTransform){let m=r.gripTransform.orientation||[0,0,0,1];s=Ot(),Rn(s,mi(m,m),r.gripTransform.position||[0,0,0])}let p=null;if(r.targetRayTransform){let m=r.targetRayTransform.orientation||[0,0,0,1];p=Ot(),Rn(p,mi(m,m),r.targetRayTransform.position||[0,0,0])}let c=r.profiles;r.displayProfiles&&e.displayName in r.displayProfiles&&(c=r.displayProfiles[e.displayName]),this[Ne]={gamepad:t,map:r,profiles:c||[t.id],mapping:r.mapping||t.mapping,axes:o,buttons:i,gripTransform:s,targetRayTransform:p},this._update()}_update(){let t=this[Ne].gamepad,e=this[Ne].map,r=this[Ne].axes;for(let i=0;i<r.length;++i)e.axes&&i in e.axes?e.axes[i]===null?r[i]=0:r[i]=t.axes[e.axes[i]]:r[i]=t.axes[i];if(e.axes&&e.axes.invert)for(let i of e.axes.invert)i<r.length&&(r[i]*=-1);let o=this[Ne].buttons;for(let i=0;i<o.length;++i)e.buttons&&i in e.buttons?e.buttons[i]===null?o[i]=lh:o[i]=t.buttons[e.buttons[i]]:o[i]=t.buttons[i]}get id(){return""}get _profiles(){return this[Ne].profiles}get index(){return-1}get connected(){return this[Ne].gamepad.connected}get timestamp(){return this[Ne].gamepad.timestamp}get mapping(){return this[Ne].mapping}get axes(){return this[Ne].axes}get buttons(){return this[Ne].buttons}get hapticActuators(){return this[Ne].gamepad.hapticActuators}},Ei=class{constructor(t,e,r=0,o=-1){this.polyfill=t,this.display=e,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new xr(this),this.lastPosition=nt(),this.emulatedPosition=!1,this.basePoseMatrix=Ot(),this.outputMatrix=Ot(),this.primaryButtonIndex=r,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=o,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(t){this.nativeGamepad!==t&&(this.nativeGamepad=t,t?this.gamepad=new rc(t,this.display,rh[t.id]):this.gamepad=null),this.handedness=t.hand===""?"none":t.hand,this.gamepad&&this.gamepad._update(),t.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!t.pose.hasPosition):t.hand===""&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let t=this.nativeGamepad.pose,e=t.position,r=t.orientation;if(!e&&!r)return;e?(this.lastPosition[0]=e[0],this.lastPosition[1]=e[1],this.lastPosition[2]=e[2]):t.hasPosition?e=this.lastPosition:(this.armModel||(this.armModel=new bi),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(r,this.polyfill.getBasePoseMatrix()),e=this.armModel.getPosition()),Rn(this.basePoseMatrix,r,e)}else Bm(this.basePoseMatrix,this.polyfill.getBasePoseMatrix());return this.basePoseMatrix}getXRPose(t,e){switch(this.updateBasePoseMatrix(),e){case"target-ray":t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[Ne].targetRayTransform&&$t(this.outputMatrix,this.outputMatrix,this.gamepad[Ne].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[Ne].gripTransform&&$t(this.outputMatrix,this.outputMatrix,this.gamepad[Ne].gripTransform);break;default:return null}return t._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}};var L4=Symbol("@@webxr-polyfill/WebVRDevice"),yi=!1,ph={highRefreshRate:!0},ch={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},Bv=0,oc=class{constructor(t,e,r={}){if(this.mode=t,this.enabledFeatures=e,this.outputContext=null,this.immersive=t=="immersive-vr"||t=="immersive-ar",this.ended=null,this.baseLayer=null,this.id=++Bv,this.modifiedCanvasLayer=!1,this.outputContext&&!yi){let o=r.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(o)}}},Ar=class extends vr{constructor(t,e){let{canPresent:r}=e.capabilities;super(t),this.display=e,this.frame=new t.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=r,this.baseModelMatrix=Ot(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),t.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=t.navigator&&"getGamepads"in t.navigator,this.HAS_BITMAP_SUPPORT=$m(t)}get depthNear(){return this.display.depthNear}set depthNear(t){this.display.depthNear=t}get depthFar(){return this.display.depthFar}set depthFar(t){this.display.depthFar=t}onBaseLayerSet(t,e){let r=this.sessions.get(t),o=e.context.canvas;if(r.immersive){let i=this.display.getEyeParameters("left"),s=this.display.getEyeParameters("right");o.width=Math.max(i.renderWidth,s.renderWidth)*2,o.height=Math.max(i.renderHeight,s.renderHeight),this.display.requestPresent([{source:o,attributes:ph}]).then(()=>{!yi&&!this.global.document.body.contains(o)&&(r.modifiedCanvasLayer=!0,this.global.document.body.appendChild(o),eh(o)),r.baseLayer=e})}else r.baseLayer=e}isSessionSupported(t){return!(t=="immersive-ar"||t=="immersive-vr"&&this.canPresent===!1)}isFeatureSupported(t){switch(t){case"viewer":return!0;case"local":return!0;case"local-floor":return!0;case"bounded":return!1;case"unbounded":return!1;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let r=t=="immersive-vr";if(r){let i=this.global.document.createElement("canvas");if(!yi){let s=i.getContext("webgl")}await this.display.requestPresent([{source:i,attributes:ph}])}let o=new oc(t,e,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(o.id,o),r&&(this.immersiveSession=o,this.dispatchEvent("@@webxr-polyfill/vr-present-start",o.id)),Promise.resolve(o.id)}requestAnimationFrame(t){return this.display.requestAnimationFrame(t)}getPrimaryButtonIndex(t){let e=0,r=t.id.toLowerCase();for(let o in ch)if(r.includes(o)){e=ch[o];break}return Math.min(e,t.buttons.length-1)}onFrameStart(t,e){this.display.depthNear=e.depthNear,this.display.depthFar=e.depthFar,this.display.getFrameData(this.frame);let r=this.sessions.get(t);if(r.immersive&&this.CAN_USE_GAMEPAD){let o=this.gamepadInputSources;this.gamepadInputSources={};let i=this.global.navigator.getGamepads();for(let s=0;s<i.length;++s){let p=i[s];if(p&&p.displayId>0){let c=o[s];if(c||(c=new Ei(this,this.display,this.getPrimaryButtonIndex(p))),c.updateFromGamepad(p),this.gamepadInputSources[s]=c,c.primaryButtonIndex!=-1){let m=p.buttons[c.primaryButtonIndex].pressed;m&&!c.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:r.id,inputSource:c.inputSource}):!m&&c.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:r.id,inputSource:c.inputSource}),c.primaryActionPressed=m}if(c.primarySqueezeButtonIndex!=-1){let m=p.buttons[c.primarySqueezeButtonIndex].pressed;m&&!c.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:r.id,inputSource:c.inputSource}):!m&&c.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:r.id,inputSource:c.inputSource}),c.primarySqueezeActionPressed=m}}}}if(!yi&&!r.immersive&&r.baseLayer){let o=r.baseLayer.context.canvas;_a(this.frame.leftProjectionMatrix,e.inlineVerticalFieldOfView,o.width/o.height,e.depthNear,e.depthFar)}}onFrameEnd(t){let e=this.sessions.get(t);if(!(e.ended||!e.baseLayer)){if(e.outputContext&&!(e.immersive&&!this.display.capabilities.hasExternalDisplay)){let r=e.immersive&&this.display.capabilities.hasExternalDisplay,o=e.baseLayer.context.canvas,i=r?o.width/2:o.width,s=o.height;if(!yi){let p=e.outputContext.canvas,c=p.width,m=p.height,h=e.renderContext;this.HAS_BITMAP_SUPPORT?o.transferToImageBitmap?h.transferFromImageBitmap(o.transferToImageBitmap()):this.global.createImageBitmap(o,0,0,i,s,{resizeWidth:c,resizeHeight:m}).then(x=>h.transferFromImageBitmap(x)):h.drawImage(o,0,0,i,s,0,0,c,m)}}e.immersive&&e.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(t){this.display.cancelAnimationFrame(t)}async endSession(t){let e=this.sessions.get(t);if(!e.ended){if(e.immersive)return this.display.exitPresent();e.ended=!0}}doesSessionSupportReferenceSpace(t,e){let r=this.sessions.get(t);return r.ended?!1:r.enabledFeatures.has(e)}requestStageBounds(){if(this.display.stageParameters){let t=this.display.stageParameters.sizeX,e=this.display.stageParameters.sizeZ,r=[];return r.push(-t/2),r.push(-e/2),r.push(t/2),r.push(-e/2),r.push(t/2),r.push(e/2),r.push(-t/2),r.push(e/2),r}return null}async requestFrameOfReferenceTransform(t,e){return(t==="local-floor"||t==="bounded-floor")&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(t){if(t==="left")return this.frame.leftProjectionMatrix;if(t==="right")return this.frame.rightProjectionMatrix;if(t==="none")return this.frame.leftProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(t,e,r,o){let i=this.sessions.get(t),{width:s,height:p}=r.context.canvas;if(!i.immersive)return o.x=o.y=0,o.width=s,o.height=p,!0;if(e==="left"||e==="none")o.x=0;else if(e==="right")o.x=s/2;else return!1;return o.y=0,o.width=s/2,o.height=p,!0}getBasePoseMatrix(){let{position:t,orientation:e}=this.frame.pose;return!t&&!e?this.baseModelMatrix:(t||(t=this.tempVec3,t[0]=t[1]=t[2]=0),Rn(this.baseModelMatrix,e,t),this.baseModelMatrix)}getBaseViewMatrix(t){if(t==="left"||t==="none")return this.frame.leftViewMatrix;if(t==="right")return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let t=[];for(let e in this.gamepadInputSources)t.push(this.gamepadInputSources[e].inputSource);return t}getInputPose(t,e,r){if(!e)return null;for(let o in this.gamepadInputSources){let i=this.gamepadInputSources[o];if(i.inputSource===t)return i.getXRPose(e,r)}return null}onWindowResize(){}onVRDisplayPresentChange(t){this.display.isPresenting||this.sessions.forEach(e=>{if(e.immersive&&!e.ended){if(e.modifiedCanvasLayer){let r=e.baseLayer.context.canvas;document.body.removeChild(r),r.setAttribute("style","")}this.immersiveSession===e&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",e.id)}})}};var wi=class extends Ar{constructor(t,e){let r=new dh.default(e||{});super(t,r),this.display=r,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}};var Fv=!1,Hv=0,ic=class{constructor(t,e){this.mode=t,this.enabledFeatures=e,this.ended=null,this.baseLayer=null,this.id=++Hv}},Ti=class extends vr{constructor(t){super(t),this.sessions=new Map,this.projectionMatrix=Ot(),this.identityMatrix=Ot()}onBaseLayerSet(t,e){let r=this.sessions.get(t);r.baseLayer=e}isSessionSupported(t){return t=="inline"}isFeatureSupported(t){switch(t){case"viewer":return!0;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let r=new ic(t,e);return this.sessions.set(r.id,r),Promise.resolve(r.id)}requestAnimationFrame(t){return window.requestAnimationFrame(t)}cancelAnimationFrame(t){window.cancelAnimationFrame(t)}onFrameStart(t,e){if(Fv)return;let r=this.sessions.get(t);if(r.baseLayer){let o=r.baseLayer.context.canvas;_a(this.projectionMatrix,e.inlineVerticalFieldOfView,o.width/o.height,e.depthNear,e.depthFar)}}onFrameEnd(t){}async endSession(t){let e=this.sessions.get(t);e.ended=!0}doesSessionSupportReferenceSpace(t,e){let r=this.sessions.get(t);return r.ended?!1:r.enabledFeatures.has(e)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(t,e){return null}getProjectionMatrix(t){return this.projectionMatrix}getViewport(t,e,r,o){let i=this.sessions.get(t),{width:s,height:p}=r.context.canvas;return o.x=o.y=0,o.width=s,o.height=p,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(t){return this.identityMatrix}getInputSources(){return[]}getInputPose(t,e,r){return null}onWindowResize(){}};var Nv=async function(n){let t=null;if("getVRDisplays"in n.navigator)try{let e=await n.navigator.getVRDisplays();e&&e.length&&(t=new Ar(n,e[0]))}catch{}return t},uh=async function(n,t){if(t.webvr){let r=await Nv(n);if(r)return r}let e=Zm(n);return e&&t.cardboard||!e&&t.allowCardboardOnDesktop?(n.VRFrameData||(n.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new wi(n,t.cardboardConfig)):new Ti(n)};var Xv={global:ga,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},Pa=["navigator","HTMLCanvasElement","WebGLRenderingContext"],Mi=class{constructor(t={}){this.config=Object.freeze(Object.assign({},Xv,t)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}_injectPolyfill(t){if(!Pa.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${Pa}`);for(let e of Object.keys(Ra))t[e]!==void 0?console.warn(`${e} already defined on global.`):t[e]=Ra[e];$p(t.WebGLRenderingContext)&&(Zp(t.HTMLCanvasElement),t.OffscreenCanvas&&Zp(t.OffscreenCanvas),t.WebGL2RenderingContext&&$p(t.WebGL2RenderingContext),window.isSecureContext||console.warn(`WebXR Polyfill Warning:
This page is not running in a secure context (https:// or localhost)!
This means that although the page may be able to use the WebXR Polyfill it will
not be able to use native WebXR implementations, and as such will not be able to
access dedicated VR or AR hardware, and will not be able to take advantage of
any performance improvements a native WebXR implementation may offer. Please
host this content on a secure origin for the best user experience.
`)),this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let t=uh(this.global,this.config);this.xr=new Ra.XRSystem(t),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(t){if(!Pa.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${Pa}`);if(t.navigator.xr&&"supportsSession"in t.navigator.xr&&!("isSessionSupported"in t.navigator.xr)){let e=t.navigator.xr.supportsSession;t.navigator.xr.isSessionSupported=function(r){return e.call(this,r).then(()=>!0).catch(()=>!1)},t.navigator.xr.supportsSession=function(r){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),e.call(this,r)}}}};navigator.xr||(console.info("Polyfilling WebXR API"),new Mi);var Ia=class extends j{constructor(e,r,o,i,s){super(e);this.mode=r;this.session=o;this.referenceSpaceType=i;this.sessionMode=s}},Va=class extends Ia{constructor(t,e,r,o){super("sessionstarted",t,e,r,o)}},La=class extends Ia{constructor(t,e,r,o){super("sessionstopped",t,e,r,o)}},Ca=new Map([["VR",{referenceSpaceType:"local-floor",sessionMode:"immersive-vr"}],["AR",{referenceSpaceType:"local-floor",sessionMode:"immersive-ar"}]]),ka=class extends q{constructor(e,r,o,i){super();this.renderer=e;this.camera=r;this.fullscreenElement=o;this.enableFullResolution=i;this._currentMode="None";this.buttons=new Map;this.currentSession=null;this.screenUI=null;this.wasVisible=new Map;this.lastWidth=0;this.lastHeight=0;this.addEventListener("sessionstarted",s=>{s.sessionMode==="inline"&&(this.camera.fov=s.session.renderState.inlineVerticalFieldOfView*180/Math.PI)}),this.addEventListener("sessionstopped",s=>{s.sessionMode==="inline"&&(this.camera.fov=50)}),this.renderer.xr.addEventListener("sessionstart",()=>this.onSessionStarted()),this.renderer.xr.addEventListener("sessionend",()=>this.onSessionEnded()),this.refresh()}setUI(e,r,o,i){this.screenUI=e,this.buttons.set(r.mode,r),this.buttons.set(o.mode,o),i&&(this.buttons.set(i.mode,i),i.available=Li());for(let s of this.buttons.values())this.wasVisible.set(s,s.visible),s.addEventListener("click",this.toggleMode.bind(this,s.mode));r.available=!Ht()&&Np(),o.available=ki()}get visible(){return Tt(this.renderer.domElement)}set visible(e){Se(this.renderer.domElement,e),this.screenUI&&Se(this.screenUI,e,"grid")}get currentMode(){return this._currentMode}resize(){if(!this.renderer.xr.isPresenting){let e=this.renderer.domElement.clientWidth,r=this.renderer.domElement.clientHeight;e>0&&r>0&&(e!==this.lastWidth||r!==this.lastHeight)&&(this.renderer.setPixelRatio(devicePixelRatio),this.renderer.setSize(e,r,!1),this.camera.aspect=e/r,this.camera.updateProjectionMatrix(),this.lastWidth=e,this.lastHeight=r)}}getMetrics(){let e=this.renderer.domElement.clientWidth,r=this.renderer.domElement.clientHeight,o=this.renderer.getPixelRatio(),i=this.camera.fov;return{width:e,height:r,pixelRatio:o,fov:i}}setMetrics(e,r,o,i){this.renderer.setPixelRatio(o),this.renderer.setSize(e,r,!1),this.camera.aspect=e/r,this.camera.fov=i,this.camera.updateProjectionMatrix()}async refresh(){await Promise.all(Array.from(this.buttons.values()).filter(e=>e.available&&e.mode!=="Fullscreen").map(async e=>{let r=Ca.get(e.mode);if(e.available=A(r),e.available){let o=navigator.xr&&await navigator.xr.isSessionSupported(r.sessionMode),i=!Li()&&rl()&&r.sessionMode==="immersive-vr"&&r.referenceSpaceType==="local-floor";e.available=o||i}}))}async toggleMode(e){e==="Fullscreen"?await this.toggleFullscreen():e!=="None"&&await this.toggleXR(e)}async start(e){e!==this.currentMode&&(await this.toggleMode(this.currentMode),await this.toggleMode(e))}async stop(){await this.toggleMode(this.currentMode)}get isFullscreen(){return document.fullscreen}async startFullscreen(){this.isFullscreen||(await this.fullscreenElement.requestFullscreen({navigationUI:"show"}),this.setActive("Fullscreen"),this.dispatchEvent(new Va("Fullscreen",null,null,null)))}async stopFullscreen(){this.isFullscreen&&(await document.exitFullscreen(),this.setActive("None"),this.dispatchEvent(new La("Fullscreen",null,null,null)))}async toggleFullscreen(){this.isFullscreen?await this.stopFullscreen():await this.startFullscreen()}async toggleXR(e){let r=Ca.get(e);if(A(r)){if(this.currentSession)this.currentSession.end();else if(navigator.xr){this.camera.position.setScalar(0),this.camera.quaternion.identity();try{let o=await navigator.xr.requestSession(r.sessionMode,{optionalFeatures:["local-floor","bounded-floor","high-refresh-rate","hand-tracking","layers"]});if(this.setActive(e),this.currentSession=o,this.renderer.xr.setReferenceSpaceType(r.referenceSpaceType),this.enableFullResolution&&"XRWebGLLayer"in window&&"getNativeFramebufferScaleFactor"in XRWebGLLayer){let i=XRWebGLLayer.getNativeFramebufferScaleFactor(o);this.renderer.xr.setFramebufferScaleFactor(i)}this.renderer.xr.setSession(o)}catch(o){console.error(`Couldn't start session type '${r.sessionMode}'. Reason: ${o&&o.message||o||"UNKNOWN"}`)}}}}onSessionStarted(){let e=this.currentMode,r=Ca.get(this.currentMode),o=this.currentSession;if(o.supportedFrameRates){let i=Math.max(...o.supportedFrameRates);console.log("Changing framerate to",i),o.updateTargetFrameRate(i)}this.dispatchEvent(new Va(e,o,r.referenceSpaceType,r.sessionMode))}onSessionEnded(){let e=this.currentMode,r=Ca.get(this.currentMode),o=this.currentSession;this.currentSession=null,this.renderer.xr.setSession(null),this.setActive("None"),this.dispatchEvent(new La(e,o,r.referenceSpaceType,r.sessionMode))}setActive(e){for(let r of this.buttons.values())r.active=r.mode===e,r.visible=this.wasVisible.get(r)&&(e==="None"||e==="Fullscreen"||r.mode===e);this._currentMode=e}};var mh=new THREE.Vector3(0,1,0),We=2048,xo=We/2,zv=[1,0,2,3,4,5],nn={rows:3,columns:4,indices:[[-1,2,-1,-1],[0,5,1,4],[-1,3,-1,-1]],rotations:[[0,Math.PI,0,0],[0,0,0,0],[0,Math.PI,0,0]]},sc=new THREE.Color(0),Oa=class{constructor(t){this.env=t;this.rt=new THREE.WebGLCubeRenderTarget(We);this.rtScene=new THREE.Scene;this.rtCamera=new THREE.CubeCamera(.01,10,this.rt);this._rotation=new THREE.Quaternion;this.layerRotation=new THREE.Quaternion().identity();this.stageRotation=new THREE.Quaternion().identity();this.canvases=new Array(6);this.contexts=new Array(6);this.onNeedsRedraw=null;this.layerOrientation=null;this.images=null;this.curImagePath=null;this.layer=null;this.wasVisible=!1;this.stageHeading=0;this.rotationNeedsUpdate=!1;this.imageNeedsUpdate=!1;this.wasWebXRLayerAvailable=null;this.visible=!0;this.framecount=0;this.onNeedsRedraw=()=>this.imageNeedsUpdate=!0,this.env.scene.background=sc;for(let e=0;e<this.canvases.length;++e){let r=this.canvases[e]=jr(We,We);this.contexts[e]=r.getContext("2d")}for(let e=0;e<nn.rows;++e){let r=nn.indices[e],o=nn.rotations[e];for(let i=0;i<nn.columns;++i){let s=r[i];if(s>-1){let p=this.contexts[s],c=o[i];c>0&&(c%2,p.translate(xo,xo),p.rotate(c),p.translate(-xo,-xo))}}}this.rt.texture.name="SkyboxOutput",this.rtScene.add(this.rtCamera),this.flipped=jr(We,We),this.flipper=this.flipped.getContext("2d"),this.flipper.fillStyle=sc.getHexString(),this.flipper.scale(-1,1),this.flipper.translate(-We,0),this.setImages("",this.canvases),Object.seal(this)}setImage(t,e){if(t!==this.curImagePath){let r=e.width/nn.columns,o=e.height/nn.rows;for(let i=0;i<nn.rows;++i){let s=nn.indices[i];for(let p=0;p<nn.columns;++p){let c=s[p];c>-1&&this.contexts[c].drawImage(e,p*r,i*o,r,o,0,0,We,We)}}this.setImages(t,this.canvases)}}setImages(t,e){(t!==this.curImagePath||e!==this.images)&&(this.curImagePath=t,e!==this.images&&(A(this.cube)&&wn(this.cube),this.images=e,this.rtScene.background=this.cube=new THREE.CubeTexture(this.images),this.cube.name="SkyboxInput")),this.updateImages()}updateImages(){this.cube.needsUpdate=!0,this.imageNeedsUpdate=!0}get rotation(){return this._rotation}set rotation(t){let{x:e,y:r,z:o,w:i}=this._rotation;if(Tu(t))this._rotation.copy(t);else if(Mu(t))this._rotation.setFromEuler(t);else if(Qe(t))if(t.length===4&&le(t[0])&&le(t[1])&&le(t[2])&&le(t[3]))this._rotation.fromArray(t);else throw new Error("Skybox rotation was not a valid array format. Needs an array of 4 numbers.");else De(t)?this._rotation.setFromAxisAngle(mh,t):(A(t)&&console.warn("Skybox rotation must be a THREE.Quaternion, THREE.Euler, number[] (representing a Quaternion), or a number (representing rotation about the Y-axis)."),this._rotation.identity());this.rotationNeedsUpdate=this._rotation.x!==e||this._rotation.y!==r||this._rotation.z!==o||this._rotation.w!==i}update(t){if(this.framecount++,this.cube){let e=this.env.hasXRCompositionLayers&&!!this.env.xrBinding&&!!t,r=e!==this.wasWebXRLayerAvailable;if(r){if(e){console.log("Layer created on frame "+this.framecount);let o=this.env.renderer.xr.getReferenceSpace();this.layer=this.env.xrBinding.createCubeLayer({space:o,layout:"mono",isStatic:!1,viewPixelWidth:We,viewPixelHeight:We,orientation:this.layerOrientation}),this.layer.addEventListener("redraw",this.onNeedsRedraw),this.env.addWebXRLayer(this.layer,Number.MAX_VALUE)}else this.layer&&(this.env.removeWebXRLayer(this.layer),this.layer.removeEventListener("redraw",this.onNeedsRedraw),this.layer.destroy(),this.layer=null);this.imageNeedsUpdate=!0}if(!this.layer||!r){let o=this.visible!==this.wasVisible,i=this.env.avatar.heading!==this.stageHeading;if(this.imageNeedsUpdate=this.imageNeedsUpdate||o||this.layer&&this.layer.needsRedraw,this.rotationNeedsUpdate=this.rotationNeedsUpdate||i,this.env.scene.background=this.layer?null:this.visible?this.rt.texture:sc,this.rotationNeedsUpdate&&(this.layerRotation.copy(this.rotation).invert(),this.stageRotation.setFromAxisAngle(mh,this.env.avatar.heading).premultiply(this.layerRotation),this.layerOrientation=new DOMPointReadOnly(this.stageRotation.x,this.stageRotation.y,this.stageRotation.z,this.stageRotation.w),this.layer?this.layer.orientation=this.layerOrientation:(this.rtCamera.quaternion.copy(this.layerRotation),this.imageNeedsUpdate=!0)),this.imageNeedsUpdate)if(this.layer){console.log("layer rendering on frame "+this.framecount);let s=this.env.renderer.getContext(),p=this.env.xrBinding.getSubImage(this.layer,t),c=this.cube.images;this.flipper.fillRect(0,0,We,We),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.bindTexture(s.TEXTURE_CUBE_MAP,p.colorTexture);for(let m=0;m<c.length;++m){if(this.visible){let h=c[zv[m]];this.flipper.drawImage(h,0,0,h.width,h.height,0,0,We,We)}s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.flipped)}s.bindTexture(s.TEXTURE_CUBE_MAP,null)}else this.rtCamera.update(this.env.renderer,this.rtScene);this.stageHeading=this.env.avatar.heading,this.imageNeedsUpdate=!1,this.rotationNeedsUpdate=!1,this.wasVisible=this.visible}this.wasWebXRLayerAvailable=e}}};var ac=class extends Fo{constructor(){super();this.frame=null;Object.seal(this)}set(e,r,o){super.set(e,r),this.frame=o}},Da=class{constructor(t){this.renderer=t;this.tickHandlers=new Array;this.lt=-1;this._isRunning=!1;let e=new ac,r=0;this._onTick=(o,i)=>{this.lt>=0&&(r=o-this.lt,e.set(o,r,i),this.tick(e)),this.lt=o}}get isRunning(){return this._isRunning}restart(){this.stop(),this.start()}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){st(this.tickHandlers,t)}setAnimationLoop(t){this.renderer.setAnimationLoop(t),this._isRunning=A(t)}start(){this.isRunning||this.setAnimationLoop(this._onTick)}stop(){this.isRunning&&(this.setAnimationLoop(null),this.lt=-1)}tick(t){for(let e of this.tickHandlers)e(t)}};var Ba=new THREE.PerspectiveCamera,hh=new THREE.Vector4,lc=new THREE.Vector4,fh=15,Uv=$c(fh);Mt(J("#frontBuffer",Ir("absolute"),jn(0),Wn(0),xt("100%"),Ut("100%"),mn(0),hn(0),id(0),gd("none")));var Fa=class extends q{constructor(e,r,o,i,s){super();this.fetcher=r;this.defaultAvatarHeight=o;this.DEBUG=s;this.layers=new Array;this.layerSortOrder=new Map;this.fadeDepth=0;this.camera=new THREE.PerspectiveCamera(50,1,.01,1e3);this.scene=new THREE.Scene;this.stage=je("Stage");this.ambient=new THREE.AmbientLight(16777215,.5);this.sun=new THREE.DirectionalLight(16777215,.75);this.ground=new THREE.GridHelper(Uv,fh,12632256,8421504);this.foreground=je("Foreground");this.loadingBar=new xa;this.enableSpectator=!1;this._xrBinding=null;this._xrMediaBinding=null;this._hasXRMediaLayers=null;this._hasXRCompositionLayers=null;this.cursor3D=new so(this),Ur(e)&&(e.style.backgroundColor="black"),this.renderer=new THREE.WebGLRenderer({canvas:e,powerPreference:"high-performance",precision:"lowp",antialias:!0,alpha:!0,premultipliedAlpha:!0,depth:!0,logarithmicDepthBuffer:!0,stencil:!1,preserveDrawingBuffer:!1}),this.renderer.domElement.setAttribute("touch-action","none"),this.renderer.domElement.tabIndex=1,this.screenControl=new ka(this.renderer,this.camera,this.renderer.domElement.parentElement,i),this.fader=new fa("ViewFader"),this.worldUISpace=new qs("WorldUISpace",.2,20,.125),this.avatar=new Js(this,this.fader,o),this.pointers=new ha(this),this.skybox=new Oa(this),this.timer=new Da(this.renderer),this.renderer.xr.enabled=!0,this.sun.name="Sun",this.sun.position.set(0,1,1),this.sun.lookAt(0,0,0),this.sun.layers.enableAll();let p=()=>{this.ground.visible=this.renderer.xr.isPresenting};this.screenControl.addEventListener("sessionstarted",p),this.screenControl.addEventListener("sessionstopped",p),p(),this.ambient.name="Fill",this.ambient.layers.enableAll(),this.loadingBar.object.name="MainLoadingBar",this.loadingBar.object.position.set(0,-.25,-2),this.scene.layers.enableAll(),this.avatar.addFollower(this.worldUISpace),G(this.scene,this.sun,this.ambient,G(this.stage,this.ground,this.camera,this.avatar,...this.pointers.hands),this.foreground,G(this.worldUISpace,this.loadingBar)),this.timer.addTickHandler(c=>this.update(c)),this.timer.start(),globalThis.env=this}get gl(){return this.renderer.getContext()}get referenceSpace(){return this.renderer.xr.getReferenceSpace()}update(e){if(this.screenControl.visible){let r=this.xrSession;this._xrBinding=this.renderer.xr.getBinding(),this.hasXRMediaLayers&&this._xrMediaBinding===null===this.renderer.xr.isPresenting&&(this._xrMediaBinding===null&&A(r)?this._xrMediaBinding=new XRMediaBinding(r):this._xrMediaBinding=null);let o=r&&this.renderer.xr.getBaseLayer();o!==this.baseLayer&&(A(this.baseLayer)&&(this.removeWebXRLayer(this.baseLayer),this.baseLayer=null),A(o)&&(this.baseLayer=o,this.addWebXRLayer(o,0))),this.screenControl.resize(),this.pointers.update(),this.avatar.update(e.dt),this.worldUISpace.update(this.avatar.height,this.avatar.worldPos,this.avatar.worldHeading,e.dt),this.fader.update(e.dt),Pu(e.dt),this.loadingBar.update(e.sdt),this.preRender(e),this.skybox.update(e.frame);let i=ro(this.renderer,this.camera);if(i!==this.camera){let s=i;s.layers.mask=this.camera.layers.mask;for(let p=0;p<s.cameras.length;++p){let c=s.cameras[p];c.layers.mask=this.camera.layers.mask,c.layers.enable(p+1),s.layers.enable(p+1)}}if(this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.enableSpectator){if(!this.renderer.xr.isPresenting)hh.copy(lc),this.renderer.getViewport(lc);else if(Er()&&!Ic()){Ba.projectionMatrix.copy(this.camera.projectionMatrix),Ba.position.copy(i.position),Ba.quaternion.copy(i.quaternion);let s=this.renderer.getRenderTarget();this.renderer.xr.isPresenting=!1,this.renderer.setRenderTarget(null),this.renderer.setViewport(hh),this.renderer.clear(),this.renderer.render(this.scene,Ba),this.renderer.setViewport(lc),this.renderer.setRenderTarget(s),this.renderer.xr.isPresenting=!0}}}}preRender(e){}async onQuitting(){this.dispatchEvent(new j("quitting")),window.location.href="/"}get hasAlpha(){return this.renderer.getContextAttributes().alpha}get xrSession(){return this.renderer.xr.getSession()}get xrBinding(){return this._xrBinding}get xrMediaBinding(){return this._xrMediaBinding}get isReadyForLayers(){return this.hasAlpha&&(!Nt||Vc.major>=15)}get hasXRMediaLayers(){return this._hasXRMediaLayers===null&&(this._hasXRMediaLayers=this.isReadyForLayers&&"XRMediaBinding"in globalThis&&ce(XRMediaBinding.prototype.createQuadLayer)),this._hasXRMediaLayers}get hasXRCompositionLayers(){return this._hasXRCompositionLayers===null&&(this._hasXRCompositionLayers=this.isReadyForLayers&&"XRWebGLBinding"in globalThis&&ce(XRWebGLBinding.prototype.createCubeLayer)),this._hasXRCompositionLayers}addWebXRLayer(e,r){this.layers.push(e),this.layerSortOrder.set(e,r),Fn(this.layers,o=>-this.layerSortOrder.get(o)),this.updateLayers()}removeWebXRLayer(e){this.layerSortOrder.delete(e),st(this.layers,e),this.updateLayers()}updateLayers(){let e=this.xrSession;A(e)&&e.updateRenderState({layers:this.layers})}clearScene(){this.dispatchEvent(new j("sceneclearing")),wn(this.foreground),this.dispatchEvent(new j("scenecleared"))}async fadeOut(){++this.fadeDepth,this.fadeDepth===1&&(await this.fader.fadeOut(),this.skybox.visible=!1,this.camera.layers.set(oo),this.loadingBar.start(),await this.fader.fadeIn())}async fadeIn(){--this.fadeDepth,this.fadeDepth===0&&(await this.fader.fadeOut(),this.camera.layers.set($s),this.skybox.visible=!0,await this.fader.fadeIn())}set3DCursor(e){let r=e.children.slice(0);for(let o of r)this.cursor3D.add(o.name,o);this.pointers.refreshCursors(),this.dispatchEvent(new j("newcursorloaded"))}async load(e,...r){let o=null;e instanceof Jn?r.push(e):o=e;let i=new ii("/models/Cursors.glb",fs,!this.DEBUG);r.push(i),await this.fetcher.assets(o,...r),ku(i.result.scene,Ou),this.set3DCursor(i.result.scene)}};var Ha=class{constructor(t,e){this.name=t;this._level=0;this.maxLevel=0;this.analyzer=qd(this.name,e,{fftSize:32,minDecibels:-70}),this.buffer=new Uint8Array(this.analyzer.frequencyBinCount)}dispose(){ee(this.analyzer)}get level(){return this.analyzer.getByteFrequencyData(this.buffer),this._level=Math.max(...this.buffer),isFinite(this._level)&&(this.maxLevel=Math.max(this.maxLevel,this._level),this.maxLevel>0&&(this._level/=this.maxLevel)),this._level}get input(){return this.analyzer}get output(){return this.analyzer}};Mt(J(".input-range-with-number",ze("grid"),Gi("column"),ld("5px"),un("1fr auto")));var pc=class extends q{constructor(...e){super();this.element=ve(be("input-range-with-number"),this.rangeInput=Bd(...e),this.numberInput=Dd()),this.numberInput.min=this.rangeInput.min,this.numberInput.max=this.rangeInput.max,this.numberInput.step=this.rangeInput.step,this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.numberInput.disabled=this.rangeInput.disabled,this.numberInput.placeholder=this.rangeInput.placeholder,this.numberInput.addEventListener("input",()=>{this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber,this.rangeInput.dispatchEvent(new Event("input"))}),this.rangeInput.addEventListener("input",()=>{this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.dispatchEvent(new j("input"))})}get value(){return this.rangeInput.value}set value(e){this.rangeInput.value=this.numberInput.value=e}get valueAsNumber(){return this.rangeInput.valueAsNumber}set valueAsNumber(e){this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber=e}get disabled(){return this.rangeInput.disabled}set disabled(e){this.rangeInput.disabled=this.numberInput.disabled=e}};function cc(...n){return new pc(...n)}var Na=class{constructor(t,...e){this.name=t;this.properties=e}};function xh(n,...t){return new Na(n,...t)}Mt(J("dl",ze("grid"),Gi("row"),un("auto 1fr"),mn("1em")),J("dt",Un(1),Gn("right"),xd("1em")),J("dd",Gn("left"),Un(2),dd("0")),J("dl > span, dl > div",Un(1,3)),J("dl .alert",xt("20em")));var jv="DefaultPropertyGroup"+ft(16),Xa=class{constructor(...t){this.rowGroups=new Map;this.element=Rd(...this.createElements(t))}append(...t){ue(this.element,...this.createElements(t))}createElements(t){return t.flatMap(e=>this.createGroups(e).flatMap(Hn))}createGroups(t){let e=jv,r=new Array;return t instanceof Na?(e=t.name,r.push(...t.properties.map(o=>this.createRow(o)))):r.push(this.createRow(t)),this.rowGroups.has(e)||this.rowGroups.set(e,[]),this.rowGroups.get(e).push(...r),r}createRow(t){if(Qe(t)){let[e,...r]=t,o=Vd(e);for(let i of r)if(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement){i.id.length===0&&(i.id=ft(10)),o.htmlFor=i.id;break}return[Pd(o),Sd(...r)]}else return re(t)||le(t)||qe(t)||nl(t)?[ve(Id(t))]:[t]}setGroupVisible(t,e){let r=this.rowGroups.get(t);if(r)for(let o of r)for(let i of o)if(yl(i))for(let s of i.elements)Se(s,e);else(Uo(i)||i instanceof HTMLElement)&&Se(i,e)}};var dc="micFields"+ft(8),za=class extends Wr{constructor(e){super("Configure devices");this.env=e;this.micLookup=null;this.spkrLookup=null;this.spkrVolumeControl=null;this.ready=null;this.speakers=null;this.timer=new Ni(30);this.tele=null;this.cancelButton.style.display="none";let r=this.env.audio.loadBasicClip("test-audio","/audio/test-clip.mp3",.5);ue(this.container,pt(hd("max-content"))),ue(this.contentArea,this.properties=new Xa(xh(dc,"Input",["Microphones",this.microphones=Tl(no(async()=>{let o=this.env.apps.get("tele"),i=this.microphones.value,s=this.micLookup.get(i);await o.conference.microphones.setAudioInputDevice(s)}))],["Input level",this.micScenario=Ld()],["Volume",this.micVolumeControl=cc(gl(0),xl(100),Al(1),Cr(0),no(()=>{e.audio.input.gain.setValueAtTime(this.micVolumeControl.valueAsNumber/100,0)}))],"Output"))),It&&(this.properties.append(["Speakers",this.speakers=Tl(no(async()=>{let o=this.speakers.value,i=this.spkrLookup.get(o);await this.env.audio.speakers.setAudioOutputDevice(i)}))]),this.env.audio.speakers.addEventListener("audiooutputchanged",o=>{this.speakers.value=o.device&&o.device.deviceId||""})),this.properties.append(["Using headphones",this.useHeadphones=Od(no(()=>{this.env.audio.useHeadphones=this.useHeadphones.checked,Se(this.headphoneWarning,!this.env.audio.useHeadphones,"inline-block")})),this.testSpkrButton=$i("Test",Rr("Test audio"),pt(ud("0.5em")),fm(async()=>{qn(this.testSpkrButton,!1,"secondary"),await r,await this.env.audio.playClipThrough("test-audio"),qn(this.testSpkrButton,!0,"secondary")}))],this.headphoneWarning=ve(be("alert alert-warning"),"\u{1F3A7}\u{1F399}\uFE0F This site has a voice chat feature. Voice chat is best experienced using headphones."),["Volume",this.spkrVolumeControl=cc(gl(0),xl(100),Al(1),Cr(0),no(()=>e.audio.audioDestination.volume=this.spkrVolumeControl.valueAsNumber/100))]),this.activity=new Ha("device-settings-dialog-activity",this.env.audio.audioCtx),this.timer.addTickHandler(()=>{this.micScenario.value=this.activity.level}),this.properties.setGroupVisible(dc,!1),this.waitForTele(),Object.seal(this)}async waitForTele(){this.tele=await this.env.apps.waitFor("tele"),this.properties.setGroupVisible(dc,!0),this.tele.conference.microphones.addEventListener("audioinputchanged",e=>{this.microphones.value=e.audio&&e.audio.deviceId||""}),gt(this.env.audio.input,this.activity)}async load(){await this.env.audio.ready}async onShowing(){if(this.ready===null&&(this.ready=this.load()),await this.ready,this.tele){await this.tele.ready,await this.tele.conference.microphones.ready;let e=await this.tele.conference.microphones.getAudioInputDevices();this.micLookup=el(e,o=>o.deviceId),jo(this.microphones),ue(this.microphones,Zi(Cr(""),"NONE"),...e.map(o=>Zi(Cr(o.deviceId),o.label)));let r=await this.tele.conference.microphones.getAudioInputDevice();this.microphones.value=r&&r.deviceId||"",this.micVolumeControl.valueAsNumber=this.env.audio.input.gain.value*100}if(It){await this.env.audio.speakers.ready;let e=await this.env.audio.speakers.getAudioOutputDevices();this.spkrLookup=el(e,o=>o.deviceId),jo(this.speakers),ue(this.speakers,...e.map(o=>Zi(Cr(o.deviceId),o.label)));let r=await this.env.audio.speakers.getAudioOutputDevice();r||(r=await this.env.audio.speakers.getPreferredAudioOutput(),await this.env.audio.speakers.setAudioOutputDevice(r)),this.speakers.value=r&&r.deviceId||""}this.spkrVolumeControl.valueAsNumber=this.env.audio.audioDestination.volume*100,this.useHeadphones.checked=this.env.audio.useHeadphones,Se(this.headphoneWarning,!this.env.audio.useHeadphones,"inline-block"),this.timer.start(),await super.onShowing()}onClosed(){this.timer.stop(),super.onClosed()}};var uc=class extends j{constructor(e){super("roomjoined");this.roomName=e}},Ua=class extends Fa{constructor(e,r,o,i,s,p,c){super(e,r,s,p,c&&c.DEBUG);this.screenUISpace=new ks;this.envAudioToggleEvt=new j("environmentaudiotoggled");this._currentRoom=null;this._testSpaceLayout=!1;this.countTick=0;this.fpses=new Array;this.avgFPS=0;this.compassImage=new _s,this.clockImage=new Zn(this,"Clock",new Es),this.clockImage.sizeMode="fixed-height",this.clockImage.mesh.renderOrder=5,c=c||{},this.apps=new Us(this),this.apps.addEventListener("apploading",h=>{h.preLoadTask=this.fadeOut().then(()=>{this.clearScene(),this.avatar.reset()})}),this.apps.addEventListener("apploaded",h=>{h.app.addEventListener("joinroom",x=>{x.roomName!==this._currentRoom&&(this._currentRoom=x.roomName,this.dispatchEvent(new uc(x.roomName)))})}),this.apps.addEventListener("appshown",async h=>{this.lobbyButton.visible=h.appName!=="menu",await this.fadeIn()}),this.audio=new ms(Au),this.audio.setAudioProperties(1,4,"exponential"),this.audioPlayer=new hs(this.audio.audioCtx),this.videoPlayer=new Xs(this,this.audio.audioCtx),this.videoPlayer.object.visible=!1,this.interactionAudio=new Ls(this.audio,this.pointers),this.confirmationDialog=new Vs(this,o),this.devicesDialog=new za(this),ue(this.renderer.domElement.parentElement,this.screenUISpace,this.confirmationDialog,this.devicesDialog,this.renderer.domElement),this.uiButtons=new zs(i,20,this.DEBUG),this.settingsButton=new eo(this.uiButtons,"ui","settings"),this.quitButton=new eo(this.uiButtons,"ui","quit"),this.lobbyButton=new eo(this.uiButtons,"ui","lobby"),this.muteMicButton=new nr(this.uiButtons,"microphone","mute","unmute"),this.muteEnvAudioButton=new nr(this.uiButtons,"environment-audio","mute","unmute"),this.muteEnvAudioButton.active=!0,this.audio.ready.then(()=>this.muteEnvAudioButton.active=!1),this.vrButton=new $o(this.uiButtons,"VR"),this.fullscreenButton=new $o(this.uiButtons,"Fullscreen"),this.xrUI=new Os,this.xrUI.addItem(this.clockImage,{x:-1,y:1,height:.1}),this.xrUI.addItem(this.quitButton,{x:1,y:1,scale:.5}),this.xrUI.addItem(this.confirmationDialog,{x:0,y:0,scale:.25}),this.xrUI.addItem(this.settingsButton,{x:-1,y:-1,scale:.5}),this.xrUI.addItem(this.muteMicButton,{x:-.84,y:-1,scale:.5}),this.xrUI.addItem(this.muteEnvAudioButton,{x:-.68,y:-1,scale:.5}),this.xrUI.addItem(this.lobbyButton,{x:-.473,y:-1,scale:.5}),this.xrUI.addItem(this.vrButton,{x:1,y:-1,scale:.5}),this.xrUI.addItem(this.fullscreenButton,{x:1,y:-1,scale:.5}),G(this.worldUISpace,this.xrUI),ue(this.screenUISpace.topRowLeft,this.compassImage,this.clockImage),ue(this.screenUISpace.topRowRight,this.quitButton),ue(this.screenUISpace.bottomRowLeft,this.settingsButton,this.muteMicButton,this.muteEnvAudioButton,this.lobbyButton),ue(this.screenUISpace.bottomRowRight,this.fullscreenButton,this.vrButton),Gr.isAvailable&&ko()&&(this.batteryImage=new Zn(this,"Battery",new Gr),this.batteryImage.sizeMode="fixed-height",this.xrUI.addItem(this.batteryImage,{x:.75,y:-1,width:.2,height:.1}),ue(this.screenUISpace.topRowRight,this.batteryImage)),this.vrButton.visible=Er()&&ki()||Ht(),this.lobbyButton.visible=!1,this.muteMicButton.visible=!1,this.screenControl.setUI(this.screenUISpace,this.fullscreenButton,this.vrButton),this.refreshSpaceUI(),this.quitButton.addEventListener("click",()=>this.withConfirmation("Confirm quit","Are you sure you want to quit?",async()=>{this.renderer.xr.isPresenting&&this.screenControl.stop(),await this.onQuitting()})),this.lobbyButton.addEventListener("click",()=>this.withConfirmation("Confirm return to lobby","Are you sure you want to return to the lobby?",()=>this.dispatchEvent(new j("home")))),this.settingsButton.addEventListener("click",async()=>{let h=this.screenControl.currentMode,x=this.renderer.xr.isPresenting;x&&await this.screenControl.stop(),await this.devicesDialog.showDialog(),x&&await this.screenControl.start(h)});let m=()=>this.refreshSpaceUI();this.screenControl.addEventListener("sessionstarted",m),this.screenControl.addEventListener("sessionstopped",m),this.muteEnvAudioButton.addEventListener("click",()=>{this.muteEnvAudioButton.active=!this.muteEnvAudioButton.active,this.dispatchEvent(this.envAudioToggleEvt)}),this.avatar.addEventListener("avatarmoved",h=>this.audio.setUserPose(this.audio.localUserID,h.px,h.py,h.pz,h.fx,h.fy,h.fz,h.ux,h.uy,h.uz))}get currentRoom(){return this._currentRoom}refreshSpaceUI(){this.xrUI.visible=this.renderer.xr.isPresenting||this.testSpaceLayout,this.clockImage.isVisible=this.xrUI.visible||this.DEBUG}get testSpaceLayout(){return this._testSpaceLayout}set testSpaceLayout(e){e!==this.testSpaceLayout&&(this._testSpaceLayout=e,this.refreshSpaceUI())}preRender(e){if(super.preRender(e),this.audio.update(),this.videoPlayer.update(e.dt,e.frame),this.renderer.xr.isPresenting||this.compassImage.setPitchAndHeading(Fi(this.avatar.worldPitch),Fi(this.avatar.worldHeading)),this.DEBUG){let r=Math.round(e.fps);if(this.avgFPS+=r/100,this.fpses.push(r),this.fpses.length>100){let o=this.fpses.shift();this.avgFPS-=o/100}++this.countTick%100===0&&this.clockImage.image.setStats(this.avgFPS,this.renderer.info.render.calls,this.renderer.info.render.triangles)}this.confirmationDialog.update(e.dt);for(let r of this.apps)r.update(e)}get environmentAudioMuted(){return this.muteEnvAudioButton.active}async withConfirmation(e,r,o){this.onConfirmationShowing(!0),await this.confirmationDialog.prompt(e,r)&&o(),this.onConfirmationShowing(!1)}onConfirmationShowing(e){$l(this.quitButton,!e,"primary"),$l(this.lobbyButton,!e,"primary")}async load(e,...r){let o=null;e instanceof Jn?(r.push(e),o=this.loadingBar):o=e;let i=new bn("/audio/TransitionFootstepAudio.mp3",Xr,!this.DEBUG),s=new bn("/audio/basic_enter.mp3",Xr,!this.DEBUG),p=new bn("/audio/basic_exit.mp3",Xr,!this.DEBUG),c=new bn("/audio/basic_error.mp3",Xr,!this.DEBUG),m=new bn("/audio/vintage_radio_button_pressed.mp3",Xr,!this.DEBUG);r.push(...this.uiButtons.assets,i,s,p,c,m),await super.load(o,...r),this.audio.createBasicClip("footsteps",i.result,.5),this.interactionAudio.create("enter",s.result,.25),this.interactionAudio.create("exit",p.result,.25),this.interactionAudio.create("error",c.result,.25),this.interactionAudio.create("click",m.result,1)}};var Y5=Ua;export{Y5 as default};
