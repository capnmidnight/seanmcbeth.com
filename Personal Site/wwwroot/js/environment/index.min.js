var Lx=Object.create;var Cl=Object.defineProperty;var kx=Object.getOwnPropertyDescriptor;var Bx=Object.getOwnPropertyNames;var Ox=Object.getPrototypeOf,Dx=Object.prototype.hasOwnProperty;var Fx=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),Nx=(n,t)=>{for(var e in t)Cl(n,e,{get:t[e],enumerable:!0})},Xx=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Bx(t))!Dx.call(n,o)&&o!==e&&Cl(n,o,{get:()=>t[o],enumerable:!(r=kx(t,o))||r.enumerable});return n};var Gx=(n,t,e)=>(e=n!=null?Lx(Ox(n)):{},Xx(t||!n||!n.__esModule?Cl(e,"default",{value:n,enumerable:!0}):e,n));var Xf=Fx((Gc,Hc)=>{(function(n,t){typeof Gc=="object"&&typeof Hc<"u"?Hc.exports=t():typeof define=="function"&&define.amd?define(t):n.CardboardVRDisplay=t()})(Gc,function(){"use strict";var n=function(){function a(d){this.value=d}function l(d){var m,f;function g(T,_){return new Promise(function(y,P){var L={key:T,arg:_,resolve:y,reject:P,next:null};f?f=f.next=L:(m=f=L,A(T,_))})}function A(T,_){try{var y=d[T](_),P=y.value;P instanceof a?Promise.resolve(P.value).then(function(L){A("next",L)},function(L){A("throw",L)}):S(y.done?"return":"normal",y.value)}catch(L){S("throw",L)}}function S(T,_){switch(T){case"return":m.resolve({value:_,done:!0});break;case"throw":m.reject(_);break;default:m.resolve({value:_,done:!1});break}m=m.next,m?A(m.key,m.arg):f=null}this._invoke=g,typeof d.return!="function"&&(this.return=void 0)}return typeof Symbol=="function"&&Symbol.asyncIterator&&(l.prototype[Symbol.asyncIterator]=function(){return this}),l.prototype.next=function(d){return this._invoke("next",d)},l.prototype.throw=function(d){return this._invoke("throw",d)},l.prototype.return=function(d){return this._invoke("return",d)},{wrap:function(d){return function(){return new l(d.apply(this,arguments))}},await:function(d){return new a(d)}}}(),t=function(a,l){if(!(a instanceof l))throw new TypeError("Cannot call a class as a function")},e=function(){function a(l,d){for(var m=0;m<d.length;m++){var f=d[m];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(l,f.key,f)}}return function(l,d,m){return d&&a(l.prototype,d),m&&a(l,m),l}}(),r=function(){function a(l,d){var m=[],f=!0,g=!1,A=void 0;try{for(var S=l[Symbol.iterator](),T;!(f=(T=S.next()).done)&&(m.push(T.value),!(d&&m.length===d));f=!0);}catch(_){g=!0,A=_}finally{try{!f&&S.return&&S.return()}finally{if(g)throw A}}return m}return function(l,d){if(Array.isArray(l))return l;if(Symbol.iterator in Object(l))return a(l,d);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=.001,i=1,s=function(l,d){return"data:"+l+","+encodeURIComponent(d)},p=function(l,d,m){return l+(d-l)*m},c=function(){var a=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return a}}(),u=function(){var a=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return a}}(),h=function(){var a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return a}}(),x=function(){var a=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return a}}(),b=function(){var a=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),l=a?parseInt(a[1],10):null;return function(){return l}}(),w=function(){var a=!1;return a=c()&&h()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return a}}(),R=function(){var a=!1;if(b()===65){var l=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(l){var d=l[1].split("."),m=r(d,4),f=m[0],g=m[1],A=m[2],S=m[3];a=parseInt(A,10)===3325&&parseInt(S,10)<148}}return function(){return a}}(),C=function(){var a=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return a}}(),M=function(){var l=window.orientation==90||window.orientation==-90;return C()?!l:l},k=function(l){return!(isNaN(l)||l<=o||l>i)},O=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},V=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},X=function(l){if(u())return!1;if(l.requestFullscreen)l.requestFullscreen();else if(l.webkitRequestFullscreen)l.webkitRequestFullscreen();else if(l.mozRequestFullScreen)l.mozRequestFullScreen();else if(l.msRequestFullscreen)l.msRequestFullscreen();else return!1;return!0},G=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},I=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},F=function(l,d,m,f){var g=l.createShader(l.VERTEX_SHADER);l.shaderSource(g,d),l.compileShader(g);var A=l.createShader(l.FRAGMENT_SHADER);l.shaderSource(A,m),l.compileShader(A);var S=l.createProgram();l.attachShader(S,g),l.attachShader(S,A);for(var T in f)l.bindAttribLocation(S,f[T],T);return l.linkProgram(S),l.deleteShader(g),l.deleteShader(A),S},se=function(l,d){for(var m={},f=l.getProgramParameter(d,l.ACTIVE_UNIFORMS),g="",A=0;A<f;A++){var S=l.getActiveUniform(d,A);g=S.name.replace("[0]",""),m[g]=l.getUniformLocation(d,g)}return m},ae=function(l,d,m,f,g,A,S){var T=1/(d-m),_=1/(f-g),y=1/(A-S);return l[0]=-2*T,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*_,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*y,l[11]=0,l[12]=(d+m)*T,l[13]=(g+f)*_,l[14]=(S+A)*y,l[15]=1,l},q=function(){var l=!1;return function(d){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(d)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(d.substr(0,4)))&&(l=!0)}(navigator.userAgent||navigator.vendor||window.opera),l},ie=function(l,d){for(var m in d)d.hasOwnProperty(m)&&(l[m]=d[m]);return l},Te=function(l){if(c()){var d=l.style.width,m=l.style.height;l.style.width=parseInt(d)+1+"px",l.style.height=parseInt(m)+"px",setTimeout(function(){l.style.width=d,l.style.height=m},100)}window.canvas=l},Ae=function(){var a=Math.PI/180,l=Math.PI*.25;function d(_,y,P,L){var N=Math.tan(y?y.upDegrees*a:l),H=Math.tan(y?y.downDegrees*a:l),J=Math.tan(y?y.leftDegrees*a:l),U=Math.tan(y?y.rightDegrees*a:l),z=2/(J+U),ce=2/(N+H);return _[0]=z,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=ce,_[6]=0,_[7]=0,_[8]=-((J-U)*z*.5),_[9]=(N-H)*ce*.5,_[10]=L/(P-L),_[11]=-1,_[12]=0,_[13]=0,_[14]=L*P/(P-L),_[15]=0,_}function m(_,y,P){var L=y[0],N=y[1],H=y[2],J=y[3],U=L+L,z=N+N,ce=H+H,Se=L*U,Le=L*z,be=L*ce,He=N*z,it=N*ce,st=H*ce,at=J*U,lt=J*z,vn=J*ce;return _[0]=1-(He+st),_[1]=Le+vn,_[2]=be-lt,_[3]=0,_[4]=Le-vn,_[5]=1-(Se+st),_[6]=it+at,_[7]=0,_[8]=be+lt,_[9]=it-at,_[10]=1-(Se+He),_[11]=0,_[12]=P[0],_[13]=P[1],_[14]=P[2],_[15]=1,_}function f(_,y,P){var L=P[0],N=P[1],H=P[2],J,U,z,ce,Se,Le,be,He,it,st,at,lt;return y===_?(_[12]=y[0]*L+y[4]*N+y[8]*H+y[12],_[13]=y[1]*L+y[5]*N+y[9]*H+y[13],_[14]=y[2]*L+y[6]*N+y[10]*H+y[14],_[15]=y[3]*L+y[7]*N+y[11]*H+y[15]):(J=y[0],U=y[1],z=y[2],ce=y[3],Se=y[4],Le=y[5],be=y[6],He=y[7],it=y[8],st=y[9],at=y[10],lt=y[11],_[0]=J,_[1]=U,_[2]=z,_[3]=ce,_[4]=Se,_[5]=Le,_[6]=be,_[7]=He,_[8]=it,_[9]=st,_[10]=at,_[11]=lt,_[12]=J*L+Se*N+it*H+y[12],_[13]=U*L+Le*N+st*H+y[13],_[14]=z*L+be*N+at*H+y[14],_[15]=ce*L+He*N+lt*H+y[15]),_}function g(_,y){var P=y[0],L=y[1],N=y[2],H=y[3],J=y[4],U=y[5],z=y[6],ce=y[7],Se=y[8],Le=y[9],be=y[10],He=y[11],it=y[12],st=y[13],at=y[14],lt=y[15],vn=P*U-L*J,Fo=P*z-N*J,No=P*ce-H*J,Xo=L*z-N*U,Go=L*ce-H*U,Ho=N*ce-H*z,zo=Se*st-Le*it,Uo=Se*at-be*it,jo=Se*lt-He*it,Wo=Le*at-be*st,qo=Le*lt-He*st,Qo=be*lt-He*at,Re=vn*Qo-Fo*qo+No*Wo+Xo*jo-Go*Uo+Ho*zo;return Re?(Re=1/Re,_[0]=(U*Qo-z*qo+ce*Wo)*Re,_[1]=(N*qo-L*Qo-H*Wo)*Re,_[2]=(st*Ho-at*Go+lt*Xo)*Re,_[3]=(be*Go-Le*Ho-He*Xo)*Re,_[4]=(z*jo-J*Qo-ce*Uo)*Re,_[5]=(P*Qo-N*jo+H*Uo)*Re,_[6]=(at*No-it*Ho-lt*Fo)*Re,_[7]=(Se*Ho-be*No+He*Fo)*Re,_[8]=(J*qo-U*jo+ce*zo)*Re,_[9]=(L*jo-P*qo-H*zo)*Re,_[10]=(it*Go-st*No+lt*vn)*Re,_[11]=(Le*No-Se*Go-He*vn)*Re,_[12]=(U*Uo-J*Wo-z*zo)*Re,_[13]=(P*Wo-L*Uo+N*zo)*Re,_[14]=(st*Fo-it*Xo-at*vn)*Re,_[15]=(Se*Xo-Le*Fo+be*vn)*Re,_):null}var A=new Float32Array([0,0,0,1]),S=new Float32Array([0,0,0]);function T(_,y,P,L,N,H){d(_,L||null,H.depthNear,H.depthFar);var J=P.orientation||A,U=P.position||S;m(y,J,U),N&&f(y,y,N),g(y,y)}return function(_,y,P){return!_||!y?!1:(_.pose=y,_.timestamp=y.timestamp,T(_.leftProjectionMatrix,_.leftViewMatrix,y,P._getFieldOfView("left"),P._getEyeOffset("left"),P),T(_.rightProjectionMatrix,_.rightViewMatrix,y,P._getFieldOfView("right"),P._getEyeOffset("right"),P),!0)}}(),le=function(){var l=window.self!==window.top,d=ot(document.referrer),m=ot(window.location.href);return l&&d!==m},ot=function(l){var d,m=l.indexOf("://");m!==-1?d=m+3:d=0;var f=l.indexOf("/",d);return f===-1&&(f=l.length),l.substring(0,f)},Or=function(l){if(l.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var d=2*Math.acos(l.w);return d},gn=function(){var a={};return function(l,d){a[l]===void 0&&(console.warn("webvr-polyfill: "+d),a[l]=!0)}}(),Yt=function(l,d){var m=d?"Please use "+d+" instead.":"";gn(l,l+" has been deprecated. This may not work on native WebVR displays. "+m)};function tx(a,l,d){if(!l){d(a);return}for(var m=[],f=null,g=0;g<l.length;++g){var A=l[g];switch(A){case a.TEXTURE_BINDING_2D:case a.TEXTURE_BINDING_CUBE_MAP:var S=l[++g];if(S<a.TEXTURE0||S>a.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),m.push(null,null);break}f||(f=a.getParameter(a.ACTIVE_TEXTURE)),a.activeTexture(S),m.push(a.getParameter(A),null);break;case a.ACTIVE_TEXTURE:f=a.getParameter(a.ACTIVE_TEXTURE),m.push(null);break;default:m.push(a.getParameter(A));break}}d(a);for(var g=0;g<l.length;++g){var A=l[g],T=m[g];switch(A){case a.ACTIVE_TEXTURE:break;case a.ARRAY_BUFFER_BINDING:a.bindBuffer(a.ARRAY_BUFFER,T);break;case a.COLOR_CLEAR_VALUE:a.clearColor(T[0],T[1],T[2],T[3]);break;case a.COLOR_WRITEMASK:a.colorMask(T[0],T[1],T[2],T[3]);break;case a.CURRENT_PROGRAM:a.useProgram(T);break;case a.ELEMENT_ARRAY_BUFFER_BINDING:a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,T);break;case a.FRAMEBUFFER_BINDING:a.bindFramebuffer(a.FRAMEBUFFER,T);break;case a.RENDERBUFFER_BINDING:a.bindRenderbuffer(a.RENDERBUFFER,T);break;case a.TEXTURE_BINDING_2D:var S=l[++g];if(S<a.TEXTURE0||S>a.TEXTURE31)break;a.activeTexture(S),a.bindTexture(a.TEXTURE_2D,T);break;case a.TEXTURE_BINDING_CUBE_MAP:var S=l[++g];if(S<a.TEXTURE0||S>a.TEXTURE31)break;a.activeTexture(S),a.bindTexture(a.TEXTURE_CUBE_MAP,T);break;case a.VIEWPORT:a.viewport(T[0],T[1],T[2],T[3]);break;case a.BLEND:case a.CULL_FACE:case a.DEPTH_TEST:case a.SCISSOR_TEST:case a.STENCIL_TEST:T?a.enable(A):a.disable(A);break;default:console.log("No GL restore behavior for 0x"+A.toString(16));break}f&&a.activeTexture(f)}}var Bo=tx,nx=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),rx=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function yt(a,l,d,m){this.gl=a,this.cardboardUI=l,this.bufferScale=d,this.dirtySubmitFrameBindings=m,this.ctxAttribs=a.getContextAttributes(),this.instanceExt=a.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=a.drawingBufferWidth,this.bufferHeight=a.drawingBufferHeight,this.realBindFramebuffer=a.bindFramebuffer,this.realEnable=a.enable,this.realDisable=a.disable,this.realColorMask=a.colorMask,this.realClearColor=a.clearColor,this.realViewport=a.viewport,c()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(a.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(a.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=F(a,nx,rx,this.attribs),this.uniforms=se(a,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.indexCount=0,this.renderTarget=a.createTexture(),this.framebuffer=a.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=a.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=a.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=a.createRenderbuffer()),this.patch(),this.onResize()}yt.prototype.destroy=function(){var a=this.gl;this.unpatch(),a.deleteProgram(this.program),a.deleteBuffer(this.vertexBuffer),a.deleteBuffer(this.indexBuffer),a.deleteTexture(this.renderTarget),a.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&a.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&a.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&a.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},yt.prototype.onResize=function(){var a=this.gl,l=this,d=[a.RENDERBUFFER_BINDING,a.TEXTURE_BINDING_2D,a.TEXTURE0];Bo(a,d,function(m){l.realBindFramebuffer.call(m,m.FRAMEBUFFER,null),l.scissorTest&&l.realDisable.call(m,m.SCISSOR_TEST),l.realColorMask.call(m,!0,!0,!0,!0),l.realViewport.call(m,0,0,m.drawingBufferWidth,m.drawingBufferHeight),l.realClearColor.call(m,0,0,0,1),m.clear(m.COLOR_BUFFER_BIT),l.realBindFramebuffer.call(m,m.FRAMEBUFFER,l.framebuffer),m.bindTexture(m.TEXTURE_2D,l.renderTarget),m.texImage2D(m.TEXTURE_2D,0,l.ctxAttribs.alpha?m.RGBA:m.RGB,l.bufferWidth,l.bufferHeight,0,l.ctxAttribs.alpha?m.RGBA:m.RGB,m.UNSIGNED_BYTE,null),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,l.renderTarget,0),l.ctxAttribs.depth&&l.ctxAttribs.stencil?(m.bindRenderbuffer(m.RENDERBUFFER,l.depthStencilBuffer),m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_STENCIL,l.bufferWidth,l.bufferHeight),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,l.depthStencilBuffer)):l.ctxAttribs.depth?(m.bindRenderbuffer(m.RENDERBUFFER,l.depthBuffer),m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_COMPONENT16,l.bufferWidth,l.bufferHeight),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,l.depthBuffer)):l.ctxAttribs.stencil&&(m.bindRenderbuffer(m.RENDERBUFFER,l.stencilBuffer),m.renderbufferStorage(m.RENDERBUFFER,m.STENCIL_INDEX8,l.bufferWidth,l.bufferHeight),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.STENCIL_ATTACHMENT,m.RENDERBUFFER,l.stencilBuffer)),!m.checkFramebufferStatus(m.FRAMEBUFFER)===m.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),l.realBindFramebuffer.call(m,m.FRAMEBUFFER,l.lastBoundFramebuffer),l.scissorTest&&l.realEnable.call(m,m.SCISSOR_TEST),l.realColorMask.apply(m,l.colorMask),l.realViewport.apply(m,l.viewport),l.realClearColor.apply(m,l.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},yt.prototype.patch=function(){if(!this.isPatched){var a=this,l=this.gl.canvas,d=this.gl;c()||(l.width=O()*this.bufferScale,l.height=V()*this.bufferScale,Object.defineProperty(l,"width",{configurable:!0,enumerable:!0,get:function(){return a.bufferWidth},set:function(f){a.bufferWidth=f,a.realCanvasWidth.set.call(l,f),a.onResize()}}),Object.defineProperty(l,"height",{configurable:!0,enumerable:!0,get:function(){return a.bufferHeight},set:function(f){a.bufferHeight=f,a.realCanvasHeight.set.call(l,f),a.onResize()}})),this.lastBoundFramebuffer=d.getParameter(d.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(d.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(m,f){a.lastBoundFramebuffer=f||a.framebuffer,a.realBindFramebuffer.call(d,m,a.lastBoundFramebuffer)},this.cullFace=d.getParameter(d.CULL_FACE),this.depthTest=d.getParameter(d.DEPTH_TEST),this.blend=d.getParameter(d.BLEND),this.scissorTest=d.getParameter(d.SCISSOR_TEST),this.stencilTest=d.getParameter(d.STENCIL_TEST),d.enable=function(m){switch(m){case d.CULL_FACE:a.cullFace=!0;break;case d.DEPTH_TEST:a.depthTest=!0;break;case d.BLEND:a.blend=!0;break;case d.SCISSOR_TEST:a.scissorTest=!0;break;case d.STENCIL_TEST:a.stencilTest=!0;break}a.realEnable.call(d,m)},d.disable=function(m){switch(m){case d.CULL_FACE:a.cullFace=!1;break;case d.DEPTH_TEST:a.depthTest=!1;break;case d.BLEND:a.blend=!1;break;case d.SCISSOR_TEST:a.scissorTest=!1;break;case d.STENCIL_TEST:a.stencilTest=!1;break}a.realDisable.call(d,m)},this.colorMask=d.getParameter(d.COLOR_WRITEMASK),d.colorMask=function(m,f,g,A){a.colorMask[0]=m,a.colorMask[1]=f,a.colorMask[2]=g,a.colorMask[3]=A,a.realColorMask.call(d,m,f,g,A)},this.clearColor=d.getParameter(d.COLOR_CLEAR_VALUE),d.clearColor=function(m,f,g,A){a.clearColor[0]=m,a.clearColor[1]=f,a.clearColor[2]=g,a.clearColor[3]=A,a.realClearColor.call(d,m,f,g,A)},this.viewport=d.getParameter(d.VIEWPORT),d.viewport=function(m,f,g,A){a.viewport[0]=m,a.viewport[1]=f,a.viewport[2]=g,a.viewport[3]=A,a.realViewport.call(d,m,f,g,A)},this.isPatched=!0,Te(l)}},yt.prototype.unpatch=function(){if(!!this.isPatched){var a=this.gl,l=this.gl.canvas;c()||(Object.defineProperty(l,"width",this.realCanvasWidth),Object.defineProperty(l,"height",this.realCanvasHeight)),l.width=this.bufferWidth,l.height=this.bufferHeight,a.bindFramebuffer=this.realBindFramebuffer,a.enable=this.realEnable,a.disable=this.realDisable,a.colorMask=this.realColorMask,a.clearColor=this.realClearColor,a.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&a.bindFramebuffer(a.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){Te(l)},1)}},yt.prototype.setTextureBounds=function(a,l){a||(a=[0,0,.5,1]),l||(l=[.5,0,.5,1]),this.viewportOffsetScale[0]=a[0],this.viewportOffsetScale[1]=a[1],this.viewportOffsetScale[2]=a[2],this.viewportOffsetScale[3]=a[3],this.viewportOffsetScale[4]=l[0],this.viewportOffsetScale[5]=l[1],this.viewportOffsetScale[6]=l[2],this.viewportOffsetScale[7]=l[3]},yt.prototype.submitFrame=function(){var a=this.gl,l=this,d=[];if(this.dirtySubmitFrameBindings||d.push(a.CURRENT_PROGRAM,a.ARRAY_BUFFER_BINDING,a.ELEMENT_ARRAY_BUFFER_BINDING,a.TEXTURE_BINDING_2D,a.TEXTURE0),Bo(a,d,function(f){l.realBindFramebuffer.call(f,f.FRAMEBUFFER,null);var g=0,A=0;l.instanceExt&&(g=f.getVertexAttrib(l.attribs.position,l.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),A=f.getVertexAttrib(l.attribs.texCoord,l.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),l.cullFace&&l.realDisable.call(f,f.CULL_FACE),l.depthTest&&l.realDisable.call(f,f.DEPTH_TEST),l.blend&&l.realDisable.call(f,f.BLEND),l.scissorTest&&l.realDisable.call(f,f.SCISSOR_TEST),l.stencilTest&&l.realDisable.call(f,f.STENCIL_TEST),l.realColorMask.call(f,!0,!0,!0,!0),l.realViewport.call(f,0,0,f.drawingBufferWidth,f.drawingBufferHeight),(l.ctxAttribs.alpha||c())&&(l.realClearColor.call(f,0,0,0,1),f.clear(f.COLOR_BUFFER_BIT)),f.useProgram(l.program),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l.indexBuffer),f.bindBuffer(f.ARRAY_BUFFER,l.vertexBuffer),f.enableVertexAttribArray(l.attribs.position),f.enableVertexAttribArray(l.attribs.texCoord),f.vertexAttribPointer(l.attribs.position,2,f.FLOAT,!1,20,0),f.vertexAttribPointer(l.attribs.texCoord,3,f.FLOAT,!1,20,8),l.instanceExt&&(g!=0&&l.instanceExt.vertexAttribDivisorANGLE(l.attribs.position,0),A!=0&&l.instanceExt.vertexAttribDivisorANGLE(l.attribs.texCoord,0)),f.activeTexture(f.TEXTURE0),f.uniform1i(l.uniforms.diffuse,0),f.bindTexture(f.TEXTURE_2D,l.renderTarget),f.uniform4fv(l.uniforms.viewportOffsetScale,l.viewportOffsetScale),f.drawElements(f.TRIANGLES,l.indexCount,f.UNSIGNED_SHORT,0),l.cardboardUI&&l.cardboardUI.renderNoState(),l.realBindFramebuffer.call(l.gl,f.FRAMEBUFFER,l.framebuffer),l.ctxAttribs.preserveDrawingBuffer||(l.realClearColor.call(f,0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),l.dirtySubmitFrameBindings||l.realBindFramebuffer.call(f,f.FRAMEBUFFER,l.lastBoundFramebuffer),l.cullFace&&l.realEnable.call(f,f.CULL_FACE),l.depthTest&&l.realEnable.call(f,f.DEPTH_TEST),l.blend&&l.realEnable.call(f,f.BLEND),l.scissorTest&&l.realEnable.call(f,f.SCISSOR_TEST),l.stencilTest&&l.realEnable.call(f,f.STENCIL_TEST),l.realColorMask.apply(f,l.colorMask),l.realViewport.apply(f,l.viewport),(l.ctxAttribs.alpha||!l.ctxAttribs.preserveDrawingBuffer)&&l.realClearColor.apply(f,l.clearColor),l.instanceExt&&(g!=0&&l.instanceExt.vertexAttribDivisorANGLE(l.attribs.position,g),A!=0&&l.instanceExt.vertexAttribDivisorANGLE(l.attribs.texCoord,A))}),c()){var m=a.canvas;(m.width!=l.bufferWidth||m.height!=l.bufferHeight)&&(l.bufferWidth=m.width,l.bufferHeight=m.height,l.onResize())}},yt.prototype.updateDeviceInfo=function(a){var l=this.gl,d=this,m=[l.ARRAY_BUFFER_BINDING,l.ELEMENT_ARRAY_BUFFER_BINDING];Bo(l,m,function(f){var g=d.computeMeshVertices_(d.meshWidth,d.meshHeight,a);if(f.bindBuffer(f.ARRAY_BUFFER,d.vertexBuffer),f.bufferData(f.ARRAY_BUFFER,g,f.STATIC_DRAW),!d.indexCount){var A=d.computeMeshIndices_(d.meshWidth,d.meshHeight);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,d.indexBuffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,A,f.STATIC_DRAW),d.indexCount=A.length}})},yt.prototype.computeMeshVertices_=function(a,l,d){for(var m=new Float32Array(2*a*l*5),f=d.getLeftEyeVisibleTanAngles(),g=d.getLeftEyeNoLensTanAngles(),A=d.getLeftEyeVisibleScreenRect(g),S=0,T=0;T<2;T++){for(var _=0;_<l;_++)for(var y=0;y<a;y++,S++){var P=y/(a-1),L=_/(l-1),N=P,H=L,J=p(f[0],f[2],P),U=p(f[3],f[1],L),z=Math.sqrt(J*J+U*U),ce=d.distortion.distortInverse(z),Se=J*ce/z,Le=U*ce/z;P=(Se-g[0])/(g[2]-g[0]),L=(Le-g[3])/(g[1]-g[3]),P=(A.x+P*A.width-.5)*2,L=(A.y+L*A.height-.5)*2,m[S*5+0]=P,m[S*5+1]=L,m[S*5+2]=N,m[S*5+3]=H,m[S*5+4]=T}var be=f[2]-f[0];f[0]=-(be+f[0]),f[2]=be-f[2],be=g[2]-g[0],g[0]=-(be+g[0]),g[2]=be-g[2],A.x=1-(A.x+A.width)}return m},yt.prototype.computeMeshIndices_=function(a,l){for(var d=new Uint16Array(2*(a-1)*(l-1)*6),m=a/2,f=l/2,g=0,A=0,S=0;S<2;S++)for(var T=0;T<l;T++)for(var _=0;_<a;_++,g++)_==0||T==0||(_<=m==T<=f?(d[A++]=g,d[A++]=g-a-1,d[A++]=g-a,d[A++]=g-a-1,d[A++]=g,d[A++]=g-1):(d[A++]=g-1,d[A++]=g-a,d[A++]=g,d[A++]=g-a,d[A++]=g-1,d[A++]=g-a-1));return d},yt.prototype.getOwnPropertyDescriptor_=function(a,l){var d=Object.getOwnPropertyDescriptor(a,l);return(d.get===void 0||d.set===void 0)&&(d.configurable=!0,d.enumerable=!0,d.get=function(){return this.getAttribute(l)},d.set=function(m){this.setAttribute(l,m)}),d};var ox=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),ix=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),Jc=Math.PI/180,yl=60,$c=12,Zc=20,wl=1,ed=.75,td=.3125,sx=4,qn=28,El=1.5;function Qn(a){this.gl=a,this.attribs={position:0},this.program=F(a,ox,ix,this.attribs),this.uniforms=se(a,this.program),this.vertexBuffer=a.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}Qn.prototype.destroy=function(){var a=this.gl;this.listener&&a.canvas.removeEventListener("click",this.listener,!1),a.deleteProgram(this.program),a.deleteBuffer(this.vertexBuffer)},Qn.prototype.listen=function(a,l){var d=this.gl.canvas;this.listener=function(m){var f=d.clientWidth/2,g=qn*El;m.clientX>f-g&&m.clientX<f+g&&m.clientY>d.clientHeight-g?a(m):m.clientX<g&&m.clientY<g&&l(m)},d.addEventListener("click",this.listener,!1)},Qn.prototype.onResize=function(){var a=this.gl,l=this,d=[a.ARRAY_BUFFER_BINDING];Bo(a,d,function(m){var f=[],g=m.drawingBufferWidth/2,A=Math.max(screen.width,screen.height)*window.devicePixelRatio,S=m.drawingBufferWidth/A,T=S*window.devicePixelRatio,_=sx*T/2,y=qn*El*T,P=qn*T/2,L=(qn*El-qn)*T;f.push(g-_,y),f.push(g-_,m.drawingBufferHeight),f.push(g+_,y),f.push(g+_,m.drawingBufferHeight),l.gearOffset=f.length/2;function N(ce,Se){var Le=(90-ce)*Jc,be=Math.cos(Le),He=Math.sin(Le);f.push(td*be*P+g,td*He*P+P),f.push(Se*be*P+g,Se*He*P+P)}for(var H=0;H<=6;H++){var J=H*yl;N(J,wl),N(J+$c,wl),N(J+Zc,ed),N(J+(yl-Zc),ed),N(J+(yl-$c),wl)}l.gearVertexCount=f.length/2-l.gearOffset,l.arrowOffset=f.length/2;function U(ce,Se){f.push(L+ce,m.drawingBufferHeight-L-Se)}var z=_/Math.sin(45*Jc);U(0,P),U(P,0),U(P+z,z),U(z,P+z),U(z,P-z),U(0,P),U(P,P*2),U(P+z,P*2-z),U(z,P-z),U(0,P),U(z,P-_),U(qn*T,P-_),U(z,P+_),U(qn*T,P+_),l.arrowVertexCount=f.length/2-l.arrowOffset,m.bindBuffer(m.ARRAY_BUFFER,l.vertexBuffer),m.bufferData(m.ARRAY_BUFFER,new Float32Array(f),m.STATIC_DRAW)})},Qn.prototype.render=function(){var a=this.gl,l=this,d=[a.CULL_FACE,a.DEPTH_TEST,a.BLEND,a.SCISSOR_TEST,a.STENCIL_TEST,a.COLOR_WRITEMASK,a.VIEWPORT,a.CURRENT_PROGRAM,a.ARRAY_BUFFER_BINDING];Bo(a,d,function(m){m.disable(m.CULL_FACE),m.disable(m.DEPTH_TEST),m.disable(m.BLEND),m.disable(m.SCISSOR_TEST),m.disable(m.STENCIL_TEST),m.colorMask(!0,!0,!0,!0),m.viewport(0,0,m.drawingBufferWidth,m.drawingBufferHeight),l.renderNoState()})},Qn.prototype.renderNoState=function(){var a=this.gl;a.useProgram(this.program),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.enableVertexAttribArray(this.attribs.position),a.vertexAttribPointer(this.attribs.position,2,a.FLOAT,!1,8,0),a.uniform4f(this.uniforms.color,1,1,1,1),ae(this.projMat,0,a.drawingBufferWidth,0,a.drawingBufferHeight,.1,1024),a.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),a.drawArrays(a.TRIANGLE_STRIP,0,4),a.drawArrays(a.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),a.drawArrays(a.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function Ki(a){this.coefficients=a}Ki.prototype.distortInverse=function(a){for(var l=0,d=1,m=a-this.distort(l);Math.abs(d-l)>1e-4;){var f=a-this.distort(d),g=d-f*((d-l)/(f-m));l=d,d=g,m=f}return d},Ki.prototype.distort=function(a){for(var l=a*a,d=0,m=0;m<this.coefficients.length;m++)d=l*(d+this.coefficients[m]);return(d+1)*a};var Rt=Math.PI/180,It=180/Math.PI,_e=function(l,d,m){this.x=l||0,this.y=d||0,this.z=m||0};_e.prototype={constructor:_e,set:function(l,d,m){return this.x=l,this.y=d,this.z=m,this},copy:function(l){return this.x=l.x,this.y=l.y,this.z=l.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var l=this.length();if(l!==0){var d=1/l;this.multiplyScalar(d)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(l){this.x*=l,this.y*=l,this.z*=l},applyQuaternion:function(l){var d=this.x,m=this.y,f=this.z,g=l.x,A=l.y,S=l.z,T=l.w,_=T*d+A*f-S*m,y=T*m+S*d-g*f,P=T*f+g*m-A*d,L=-g*d-A*m-S*f;return this.x=_*T+L*-g+y*-S-P*-A,this.y=y*T+L*-A+P*-g-_*-S,this.z=P*T+L*-S+_*-A-y*-g,this},dot:function(l){return this.x*l.x+this.y*l.y+this.z*l.z},crossVectors:function(l,d){var m=l.x,f=l.y,g=l.z,A=d.x,S=d.y,T=d.z;return this.x=f*T-g*S,this.y=g*A-m*T,this.z=m*S-f*A,this}};var te=function(l,d,m,f){this.x=l||0,this.y=d||0,this.z=m||0,this.w=f!==void 0?f:1};te.prototype={constructor:te,set:function(l,d,m,f){return this.x=l,this.y=d,this.z=m,this.w=f,this},copy:function(l){return this.x=l.x,this.y=l.y,this.z=l.z,this.w=l.w,this},setFromEulerXYZ:function(l,d,m){var f=Math.cos(l/2),g=Math.cos(d/2),A=Math.cos(m/2),S=Math.sin(l/2),T=Math.sin(d/2),_=Math.sin(m/2);return this.x=S*g*A+f*T*_,this.y=f*T*A-S*g*_,this.z=f*g*_+S*T*A,this.w=f*g*A-S*T*_,this},setFromEulerYXZ:function(l,d,m){var f=Math.cos(l/2),g=Math.cos(d/2),A=Math.cos(m/2),S=Math.sin(l/2),T=Math.sin(d/2),_=Math.sin(m/2);return this.x=S*g*A+f*T*_,this.y=f*T*A-S*g*_,this.z=f*g*_-S*T*A,this.w=f*g*A+S*T*_,this},setFromAxisAngle:function(l,d){var m=d/2,f=Math.sin(m);return this.x=l.x*f,this.y=l.y*f,this.z=l.z*f,this.w=Math.cos(m),this},multiply:function(l){return this.multiplyQuaternions(this,l)},multiplyQuaternions:function(l,d){var m=l.x,f=l.y,g=l.z,A=l.w,S=d.x,T=d.y,_=d.z,y=d.w;return this.x=m*y+A*S+f*_-g*T,this.y=f*y+A*T+g*S-m*_,this.z=g*y+A*_+m*T-f*S,this.w=A*y-m*S-f*T-g*_,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var l=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return l===0?(this.x=0,this.y=0,this.z=0,this.w=1):(l=1/l,this.x=this.x*l,this.y=this.y*l,this.z=this.z*l,this.w=this.w*l),this},slerp:function(l,d){if(d===0)return this;if(d===1)return this.copy(l);var m=this.x,f=this.y,g=this.z,A=this.w,S=A*l.w+m*l.x+f*l.y+g*l.z;if(S<0?(this.w=-l.w,this.x=-l.x,this.y=-l.y,this.z=-l.z,S=-S):this.copy(l),S>=1)return this.w=A,this.x=m,this.y=f,this.z=g,this;var T=Math.acos(S),_=Math.sqrt(1-S*S);if(Math.abs(_)<.001)return this.w=.5*(A+this.w),this.x=.5*(m+this.x),this.y=.5*(f+this.y),this.z=.5*(g+this.z),this;var y=Math.sin((1-d)*T)/_,P=Math.sin(d*T)/_;return this.w=A*y+this.w*P,this.x=m*y+this.x*P,this.y=f*y+this.y*P,this.z=g*y+this.z*P,this},setFromUnitVectors:function(){var a,l,d=1e-6;return function(m,f){return a===void 0&&(a=new _e),l=m.dot(f)+1,l<d?(l=0,Math.abs(m.x)>Math.abs(m.z)?a.set(-m.y,m.x,0):a.set(0,-m.z,m.y)):a.crossVectors(m,f),this.x=a.x,this.y=a.y,this.z=a.z,this.w=l,this.normalize(),this}}()};function Tl(a){this.width=a.width||O(),this.height=a.height||V(),this.widthMeters=a.widthMeters,this.heightMeters=a.heightMeters,this.bevelMeters=a.bevelMeters}var ax=new Tl({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),lx=new Tl({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),Sl={CardboardV1:new Ml({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new Ml({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function Pe(a,l){this.viewer=Sl.CardboardV2,this.updateDeviceParams(a),this.distortion=new Ki(this.viewer.distortionCoefficients);for(var d=0;d<l.length;d++){var m=l[d];Sl[m.id]=new Ml(m)}}Pe.prototype.updateDeviceParams=function(a){this.device=this.determineDevice_(a)||this.device},Pe.prototype.getDevice=function(){return this.device},Pe.prototype.setViewer=function(a){this.viewer=a,this.distortion=new Ki(this.viewer.distortionCoefficients)},Pe.prototype.determineDevice_=function(a){if(!a)return c()?(console.warn("Using fallback iOS device measurements."),lx):(console.warn("Using fallback Android device measurements."),ax);var l=.0254,d=l/a.xdpi,m=l/a.ydpi,f=O(),g=V();return new Tl({widthMeters:d*f,heightMeters:m*g,bevelMeters:a.bevelMm*.001})},Pe.prototype.getDistortedFieldOfViewLeftEye=function(){var a=this.viewer,l=this.device,d=this.distortion,m=a.screenLensDistance,f=(l.widthMeters-a.interLensDistance)/2,g=a.interLensDistance/2,A=a.baselineLensDistance-l.bevelMeters,S=l.heightMeters-A,T=It*Math.atan(d.distort(f/m)),_=It*Math.atan(d.distort(g/m)),y=It*Math.atan(d.distort(A/m)),P=It*Math.atan(d.distort(S/m));return{leftDegrees:Math.min(T,a.fov),rightDegrees:Math.min(_,a.fov),downDegrees:Math.min(y,a.fov),upDegrees:Math.min(P,a.fov)}},Pe.prototype.getLeftEyeVisibleTanAngles=function(){var a=this.viewer,l=this.device,d=this.distortion,m=Math.tan(-Rt*a.fov),f=Math.tan(Rt*a.fov),g=Math.tan(Rt*a.fov),A=Math.tan(-Rt*a.fov),S=l.widthMeters/4,T=l.heightMeters/2,_=a.baselineLensDistance-l.bevelMeters-T,y=a.interLensDistance/2-S,P=-_,L=a.screenLensDistance,N=d.distort((y-S)/L),H=d.distort((P+T)/L),J=d.distort((y+S)/L),U=d.distort((P-T)/L),z=new Float32Array(4);return z[0]=Math.max(m,N),z[1]=Math.min(f,H),z[2]=Math.min(g,J),z[3]=Math.max(A,U),z},Pe.prototype.getLeftEyeNoLensTanAngles=function(){var a=this.viewer,l=this.device,d=this.distortion,m=new Float32Array(4),f=d.distortInverse(Math.tan(-Rt*a.fov)),g=d.distortInverse(Math.tan(Rt*a.fov)),A=d.distortInverse(Math.tan(Rt*a.fov)),S=d.distortInverse(Math.tan(-Rt*a.fov)),T=l.widthMeters/4,_=l.heightMeters/2,y=a.baselineLensDistance-l.bevelMeters-_,P=a.interLensDistance/2-T,L=-y,N=a.screenLensDistance,H=(P-T)/N,J=(L+_)/N,U=(P+T)/N,z=(L-_)/N;return m[0]=Math.max(f,H),m[1]=Math.min(g,J),m[2]=Math.min(A,U),m[3]=Math.max(S,z),m},Pe.prototype.getLeftEyeVisibleScreenRect=function(a){var l=this.viewer,d=this.device,m=l.screenLensDistance,f=(d.widthMeters-l.interLensDistance)/2,g=l.baselineLensDistance-d.bevelMeters,A=(a[0]*m+f)/d.widthMeters,S=(a[1]*m+g)/d.heightMeters,T=(a[2]*m+f)/d.widthMeters,_=(a[3]*m+g)/d.heightMeters;return{x:A,y:_,width:T-A,height:S-_}},Pe.prototype.getFieldOfViewLeftEye=function(a){return a?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},Pe.prototype.getFieldOfViewRightEye=function(a){var l=this.getFieldOfViewLeftEye(a);return{leftDegrees:l.rightDegrees,rightDegrees:l.leftDegrees,upDegrees:l.upDegrees,downDegrees:l.downDegrees}},Pe.prototype.getUndistortedFieldOfViewLeftEye=function(){var a=this.getUndistortedParams_();return{leftDegrees:It*Math.atan(a.outerDist),rightDegrees:It*Math.atan(a.innerDist),downDegrees:It*Math.atan(a.bottomDist),upDegrees:It*Math.atan(a.topDist)}},Pe.prototype.getUndistortedViewportLeftEye=function(){var a=this.getUndistortedParams_(),l=this.viewer,d=this.device,m=l.screenLensDistance,f=d.widthMeters/m,g=d.heightMeters/m,A=d.width/f,S=d.height/g,T=Math.round((a.eyePosX-a.outerDist)*A),_=Math.round((a.eyePosY-a.bottomDist)*S);return{x:T,y:_,width:Math.round((a.eyePosX+a.innerDist)*A)-T,height:Math.round((a.eyePosY+a.topDist)*S)-_}},Pe.prototype.getUndistortedParams_=function(){var a=this.viewer,l=this.device,d=this.distortion,m=a.screenLensDistance,f=a.interLensDistance/2/m,g=l.widthMeters/m,A=l.heightMeters/m,S=g/2-f,T=(a.baselineLensDistance-l.bevelMeters)/m,_=a.fov,y=d.distortInverse(Math.tan(Rt*_)),P=Math.min(S,y),L=Math.min(f,y),N=Math.min(T,y),H=Math.min(A-T,y);return{outerDist:P,innerDist:L,topDist:H,bottomDist:N,eyePosX:S,eyePosY:T}};function Ml(a){this.id=a.id,this.label=a.label,this.fov=a.fov,this.interLensDistance=a.interLensDistance,this.baselineLensDistance=a.baselineLensDistance,this.screenLensDistance=a.screenLensDistance,this.distortionCoefficients=a.distortionCoefficients,this.inverseCoefficients=a.inverseCoefficients}Pe.Viewers=Sl;var px=1,cx="2019-11-09T17:36:14Z",dx=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],ux={format:px,last_updated:cx,devices:dx};function Oo(a,l){if(this.dpdb=ux,this.recalculateDeviceParams_(),a){this.onDeviceParamsUpdated=l;var d=new XMLHttpRequest,m=this;d.open("GET",a,!0),d.addEventListener("load",function(){m.loading=!1,d.status>=200&&d.status<=299?(m.dpdb=JSON.parse(d.response),m.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),d.send()}}Oo.prototype.getDeviceParams=function(){return this.deviceParams},Oo.prototype.recalculateDeviceParams_=function(){var a=this.calcDeviceParams_();a?(this.deviceParams=a,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},Oo.prototype.calcDeviceParams_=function(){var a=this.dpdb;if(!a)return console.error("DPDB not available."),null;if(a.format!=1)return console.error("DPDB has unexpected format version."),null;if(!a.devices||!a.devices.length)return console.error("DPDB does not have a devices section."),null;var l=navigator.userAgent||navigator.vendor||window.opera,d=O(),m=V();if(!a.devices)return console.error("DPDB has no devices section."),null;for(var f=0;f<a.devices.length;f++){var g=a.devices[f];if(!g.rules){console.warn("Device["+f+"] has no rules section.");continue}if(g.type!="ios"&&g.type!="android"){console.warn("Device["+f+"] has invalid type.");continue}if(c()==(g.type=="ios")){for(var A=!1,S=0;S<g.rules.length;S++){var T=g.rules[S];if(this.ruleMatches_(T,l,d,m)){A=!0;break}}if(!!A){var _=g.dpi[0]||g.dpi,y=g.dpi[1]||g.dpi;return new mx({xdpi:_,ydpi:y,bevelMm:g.bw})}}}return console.warn("No DPDB device match."),null},Oo.prototype.ruleMatches_=function(a,l,d,m){if(!a.ua&&!a.res||(a.ua&&a.ua.substring(0,2)==="SM"&&(a.ua=a.ua.substring(0,7)),a.ua&&l.indexOf(a.ua)<0))return!1;if(a.res){if(!a.res[0]||!a.res[1])return!1;var f=a.res[0],g=a.res[1];if(Math.min(d,m)!=Math.min(f,g)||Math.max(d,m)!=Math.max(f,g))return!1}return!0};function mx(a){this.xdpi=a.xdpi,this.ydpi=a.ydpi,this.bevelMm=a.bevelMm}function Do(a,l){this.set(a,l)}Do.prototype.set=function(a,l){this.sample=a,this.timestampS=l},Do.prototype.copy=function(a){this.set(a.sample,a.timestampS)};function Kn(a,l){this.kFilter=a,this.isDebug=l,this.currentAccelMeasurement=new Do,this.currentGyroMeasurement=new Do,this.previousGyroMeasurement=new Do,c()?this.filterQ=new te(-1,0,0,1):this.filterQ=new te(1,0,0,1),this.previousFilterQ=new te,this.previousFilterQ.copy(this.filterQ),this.accelQ=new te,this.isOrientationInitialized=!1,this.estimatedGravity=new _e,this.measuredGravity=new _e,this.gyroIntegralQ=new te}Kn.prototype.addAccelMeasurement=function(a,l){this.currentAccelMeasurement.set(a,l)},Kn.prototype.addGyroMeasurement=function(a,l){this.currentGyroMeasurement.set(a,l);var d=l-this.previousGyroMeasurement.timestampS;k(d)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},Kn.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var a=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,l=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,a);this.gyroIntegralQ.multiply(l),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(l);var d=new te;d.copy(this.filterQ),d.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(d),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var m=new te;m.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),m.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",It*Or(m),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var f=new te;f.copy(this.filterQ),f.multiply(m),this.filterQ.slerp(f,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},Kn.prototype.getOrientation=function(){return this.filterQ},Kn.prototype.accelToQuaternion_=function(a){var l=new _e;l.copy(a),l.normalize();var d=new te;return d.setFromUnitVectors(new _e(0,0,-1),l),d.inverse(),d},Kn.prototype.gyroToQuaternionDelta_=function(a,l){var d=new te,m=new _e;return m.copy(a),m.normalize(),d.setFromAxisAngle(m,a.length()*l),d};function nd(a,l){this.predictionTimeS=a,this.isDebug=l,this.previousQ=new te,this.previousTimestampS=null,this.deltaQ=new te,this.outQ=new te}nd.prototype.getPrediction=function(a,l,d){if(!this.previousTimestampS)return this.previousQ.copy(a),this.previousTimestampS=d,a;var m=new _e;m.copy(l),m.normalize();var f=l.length();if(f<Rt*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(It*f).toFixed(1)),this.outQ.copy(a),this.previousQ.copy(a),this.outQ;var g=f*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(m,g),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(a),this.previousTimestampS=d,this.outQ};function dt(a,l,d,m){this.yawOnly=d,this.accelerometer=new _e,this.gyroscope=new _e,this.filter=new Kn(a,m),this.posePredictor=new nd(l,m),this.isFirefoxAndroid=x(),this.isIOS=c();var f=b();this.isDeviceMotionInRadians=!this.isIOS&&f&&f<66,this.isWithoutDeviceMotion=R()||w(),this.filterToWorldQ=new te,c()?this.filterToWorldQ.setFromAxisAngle(new _e(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new _e(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new te,this.worldToScreenQ=new te,this.originalPoseAdjustQ=new te,this.originalPoseAdjustQ.setFromAxisAngle(new _e(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),M()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new te,this.orientationOut_=new Float32Array(4),this.start()}dt.prototype.getPosition=function(){return null},dt.prototype.getOrientation=function(){var a=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var f=new te().setFromAxisAngle(new _e(0,0,-1),0),g=new te;return window.orientation===-90?g.setFromAxisAngle(new _e(0,1,0),Math.PI/-2):g.setFromAxisAngle(new _e(0,1,0),Math.PI/2),f.multiply(g)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var f=new te;return f.setFromAxisAngle(new _e(1,0,0),-Math.PI/2),f}(),a=this._deviceOrientationQ;var d=new te;return d.copy(a),d.multiply(this.deviceOrientationFilterToWorldQ),d.multiply(this.resetQ),d.multiply(this.worldToScreenQ),d.multiplyQuaternions(this.deviceOrientationFixQ,d),this.yawOnly&&(d.x=0,d.z=0,d.normalize()),this.orientationOut_[0]=d.x,this.orientationOut_[1]=d.y,this.orientationOut_[2]=d.z,this.orientationOut_[3]=d.w,this.orientationOut_}else{var l=this.filter.getOrientation();a=this.posePredictor.getPrediction(l,this.gyroscope,this.previousTimestampS)}var d=new te;return d.copy(this.filterToWorldQ),d.multiply(this.resetQ),d.multiply(a),d.multiply(this.worldToScreenQ),this.yawOnly&&(d.x=0,d.z=0,d.normalize()),this.orientationOut_[0]=d.x,this.orientationOut_[1]=d.y,this.orientationOut_[2]=d.z,this.orientationOut_[3]=d.w,this.orientationOut_},dt.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),M()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},dt.prototype.onDeviceOrientation_=function(a){this._deviceOrientationQ=this._deviceOrientationQ||new te;var l=a.alpha,d=a.beta,m=a.gamma;l=(l||0)*Math.PI/180,d=(d||0)*Math.PI/180,m=(m||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(d,l,-m)},dt.prototype.onDeviceMotion_=function(a){this.updateDeviceMotion_(a)},dt.prototype.updateDeviceMotion_=function(a){var l=a.accelerationIncludingGravity,d=a.rotationRate,m=a.timeStamp/1e3,f=m-this.previousTimestampS;if(f<0){gn("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=m;return}else if(f<=o||f>i){gn("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=m;return}this.accelerometer.set(-l.x,-l.y,-l.z),d&&(C()?this.gyroscope.set(-d.beta,d.alpha,d.gamma):this.gyroscope.set(d.alpha,d.beta,d.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,m)),this.filter.addAccelMeasurement(this.accelerometer,m),this.previousTimestampS=m},dt.prototype.onOrientationChange_=function(a){this.setScreenTransform_()},dt.prototype.onMessage_=function(a){var l=a.data;if(!(!l||!l.type)){var d=l.type.toLowerCase();d==="devicemotion"&&this.updateDeviceMotion_(l.deviceMotionEvent)}},dt.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new _e(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new _e(0,0,1),Math.PI/2);break;case 180:break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},dt.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),c()&&le()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},dt.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var hx=60,fx=new _e(1,0,0),xx=new _e(0,0,1),Pl=new te;Pl.setFromAxisAngle(fx,-Math.PI/2),Pl.multiply(new te().setFromAxisAngle(xx,Math.PI/2));var gx=function(){function a(l){t(this,a),this.config=l,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new te,this._outQ=new te,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return e(a,[{key:"init",value:function(){var d=null;try{d=new RelativeOrientationSensor({frequency:hx,referenceFrame:"screen"}),d.addEventListener("error",this._onSensorError)}catch(m){this.errors.push(m),m.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):m.name==="ReferenceError"?this.useDeviceMotion():console.error(m)}d&&(this.api="sensor",this.sensor=d,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new dt(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var d=this.sensor.quaternion;this._sensorQ.set(d[0],d[1],d[2],d[3]);var m=this._outQ;return m.copy(Pl),m.multiply(this._sensorQ),this.config.YAW_ONLY&&(m.x=m.z=0,m.normalize()),this._out[0]=m.x,this._out[1]=m.y,this._out[2]=m.z,this._out[3]=m.w,this._out}},{key:"_onSensorError",value:function(d){this.errors.push(d.error),d.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):d.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(d.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),a}(),vx="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function Yn(){this.loadIcon_();var a=document.createElement("div"),A=a.style;A.position="fixed",A.top=0,A.right=0,A.bottom=0,A.left=0,A.backgroundColor="gray",A.fontFamily="sans-serif",A.zIndex=1e6;var l=document.createElement("img");l.src=this.icon;var A=l.style;A.marginLeft="25%",A.marginTop="25%",A.width="50%",a.appendChild(l);var d=document.createElement("div"),A=d.style;A.textAlign="center",A.fontSize="16px",A.lineHeight="24px",A.margin="24px 25%",A.width="50%",d.innerHTML="Place your phone into your Cardboard viewer.",a.appendChild(d);var m=document.createElement("div"),A=m.style;A.backgroundColor="#CFD8DC",A.position="fixed",A.bottom=0,A.width="100%",A.height="48px",A.padding="14px 24px",A.boxSizing="border-box",A.color="#656A6B",a.appendChild(m);var f=document.createElement("div");f.style.float="left",f.innerHTML="No Cardboard viewer?";var g=document.createElement("a");g.href="https://www.google.com/get/cardboard/get-cardboard/",g.innerHTML="get one",g.target="_blank";var A=g.style;A.float="right",A.fontWeight=600,A.textTransform="uppercase",A.borderLeft="1px solid gray",A.paddingLeft="24px",A.textDecoration="none",A.color="#656A6B",m.appendChild(f),m.appendChild(g),this.overlay=a,this.text=d,this.hide()}Yn.prototype.show=function(a){!a&&!this.overlay.parentElement?document.body.appendChild(this.overlay):a&&(this.overlay.parentElement&&this.overlay.parentElement!=a&&this.overlay.parentElement.removeChild(this.overlay),a.appendChild(this.overlay)),this.overlay.style.display="block";var l=this.overlay.querySelector("img"),d=l.style;M()?(d.width="20%",d.marginLeft="40%",d.marginTop="3%"):(d.width="50%",d.marginLeft="25%",d.marginTop="25%")},Yn.prototype.hide=function(){this.overlay.style.display="none"},Yn.prototype.showTemporarily=function(a,l){this.show(l),this.timer=setTimeout(this.hide.bind(this),a)},Yn.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},Yn.prototype.update=function(){this.disableShowTemporarily(),!M()&&q()?this.show():this.hide()},Yn.prototype.loadIcon_=function(){this.icon=s("image/svg+xml",vx)};var Ax="CardboardV1",rd="WEBVR_CARDBOARD_VIEWER",_x="webvr-polyfill-viewer-selector";function ut(a){try{this.selectedKey=localStorage.getItem(rd)}catch(l){console.error("Failed to load viewer profile: %s",l)}this.selectedKey||(this.selectedKey=a||Ax),this.dialog=this.createDialog_(Pe.Viewers),this.root=null,this.onChangeCallbacks_=[]}ut.prototype.show=function(a){this.root=a,a.appendChild(this.dialog);var l=this.dialog.querySelector("#"+this.selectedKey);l.checked=!0,this.dialog.style.display="block"},ut.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},ut.prototype.getCurrentViewer=function(){return Pe.Viewers[this.selectedKey]},ut.prototype.getSelectedKey_=function(){var a=this.dialog.querySelector("input[name=field]:checked");return a?a.id:null},ut.prototype.onChange=function(a){this.onChangeCallbacks_.push(a)},ut.prototype.fireOnChange_=function(a){for(var l=0;l<this.onChangeCallbacks_.length;l++)this.onChangeCallbacks_[l](a)},ut.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!Pe.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(Pe.Viewers[this.selectedKey]);try{localStorage.setItem(rd,this.selectedKey)}catch(a){console.error("Failed to save viewer profile: %s",a)}this.hide()},ut.prototype.createDialog_=function(a){var l=document.createElement("div");l.classList.add(_x),l.style.display="none";var d=document.createElement("div"),g=d.style;g.position="fixed",g.left=0,g.top=0,g.width="100%",g.height="100%",g.background="rgba(0, 0, 0, 0.3)",d.addEventListener("click",this.hide.bind(this));var m=280,f=document.createElement("div"),g=f.style;g.boxSizing="border-box",g.position="fixed",g.top="24px",g.left="50%",g.marginLeft=-m/2+"px",g.width=m+"px",g.padding="24px",g.overflow="hidden",g.background="#fafafa",g.fontFamily="'Roboto', sans-serif",g.boxShadow="0px 5px 20px #666",f.appendChild(this.createH1_("Select your viewer"));for(var A in a)f.appendChild(this.createChoice_(A,a[A].label));return f.appendChild(this.createButton_("Save",this.onSave_.bind(this))),l.appendChild(d),l.appendChild(f),l},ut.prototype.createH1_=function(a){var l=document.createElement("h1"),d=l.style;return d.color="black",d.fontSize="20px",d.fontWeight="bold",d.marginTop=0,d.marginBottom="24px",l.innerHTML=a,l},ut.prototype.createChoice_=function(a,l){var d=document.createElement("div");d.style.marginTop="8px",d.style.color="black";var m=document.createElement("input");m.style.fontSize="30px",m.setAttribute("id",a),m.setAttribute("type","radio"),m.setAttribute("value",a),m.setAttribute("name","field");var f=document.createElement("label");return f.style.marginLeft="4px",f.setAttribute("for",a),f.innerHTML=l,d.appendChild(m),d.appendChild(f),d},ut.prototype.createButton_=function(a,l){var d=document.createElement("button");d.innerHTML=a;var m=d.style;return m.float="right",m.textTransform="uppercase",m.color="#1094f7",m.fontSize="14px",m.letterSpacing=0,m.border=0,m.background="none",m.marginTop="16px",d.addEventListener("click",l),d};var bx=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yx(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function wx(a,l){return l={exports:{}},a(l,l.exports),l.exports}var Ex=wx(function(a,l){(function(m,f){a.exports=f()})(bx,function(){return function(d){var m={};function f(g){if(m[g])return m[g].exports;var A=m[g]={i:g,l:!1,exports:{}};return d[g].call(A.exports,A,A.exports,f),A.l=!0,A.exports}return f.m=d,f.c=m,f.d=function(g,A,S){f.o(g,A)||Object.defineProperty(g,A,{configurable:!1,enumerable:!0,get:S})},f.n=function(g){var A=g&&g.__esModule?function(){return g.default}:function(){return g};return f.d(A,"a",A),A},f.o=function(g,A){return Object.prototype.hasOwnProperty.call(g,A)},f.p="",f(f.s=0)}([function(d,m,f){"use strict";var g=function(){function y(P,L){for(var N=0;N<L.length;N++){var H=L[N];H.enumerable=H.enumerable||!1,H.configurable=!0,"value"in H&&(H.writable=!0),Object.defineProperty(P,H.key,H)}}return function(P,L,N){return L&&y(P.prototype,L),N&&y(P,N),P}}();function A(y,P){if(!(y instanceof P))throw new TypeError("Cannot call a class as a function")}var S=f(1),T=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,_=function(){function y(){A(this,y),T?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",S),this.noSleepVideo.addEventListener("timeupdate",function(P){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return g(y,[{key:"enable",value:function(){T?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){T?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),y}();d.exports=_},function(d,m,f){"use strict";d.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),Tx=yx(Ex),Sx=1e3,Mx=[0,0,.5,1],Px=[.5,0,.5,1],Cx=window.requestAnimationFrame,Rx=window.cancelAnimationFrame;function Ix(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function od(a){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:a.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:a.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:a.canPresent},maxLayers:{writable:!1,enumerable:!0,value:a.maxLayers},hasOrientation:{enumerable:!0,get:function(){return Yt("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),a.hasOrientation}}})}function me(a){a=a||{};var l="wakelock"in a?a.wakelock:!0;this.isPolyfilled=!0,this.displayId=Sx++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return Yt("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new od({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,l&&q()&&(this.wakelock_=new Tx)}me.prototype.getFrameData=function(a){return Ae(a,this._getPose(),this)},me.prototype.getPose=function(){return Yt("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},me.prototype.resetPose=function(){return Yt("VRDisplay.prototype.resetPose"),this._resetPose()},me.prototype.getImmediatePose=function(){return Yt("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},me.prototype.requestAnimationFrame=function(a){return Cx(a)},me.prototype.cancelAnimationFrame=function(a){return Rx(a)},me.prototype.wrapForFullscreen=function(a){if(c())return a;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var l=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",l.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==a)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=a,this.originalParent_=a.parentElement,this.originalParent_||document.body.appendChild(a),!this.fullscreenWrapper_.parentElement){var d=this.fullscreenElement_.parentElement;d.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),d.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var m=this;function f(){if(!!m.fullscreenElement_){var g=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];m.fullscreenElement_.setAttribute("style",g.join("; ")+";")}}return f(),this.fullscreenWrapper_},me.prototype.removeFullscreenWrapper=function(){if(!!this.fullscreenElement_){var a=this.fullscreenElement_;this.fullscreenElementCachedStyle_?a.setAttribute("style",this.fullscreenElementCachedStyle_):a.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var l=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(a),this.originalParent_===l?l.insertBefore(a,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(a),l.removeChild(this.fullscreenWrapper_),a}},me.prototype.requestPresent=function(a){var l=this.isPresenting,d=this;return a instanceof Array||(Yt("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),a=[a]),new Promise(function(m,f){if(!d.capabilities.canPresent){f(new Error("VRDisplay is not capable of presenting."));return}if(a.length==0||a.length>d.capabilities.maxLayers){f(new Error("Invalid number of layers."));return}var g=a[0];if(!g.source){m();return}var A=g.leftBounds||Mx,S=g.rightBounds||Px;if(l){var T=d.layer_;T.source!==g.source&&(T.source=g.source);for(var _=0;_<4;_++)T.leftBounds[_]=A[_],T.rightBounds[_]=S[_];d.wrapForFullscreen(d.layer_.source),d.updatePresent_(),m();return}if(d.layer_={predistorted:g.predistorted,source:g.source,leftBounds:A.slice(0),rightBounds:S.slice(0)},d.waitingForPresent_=!1,d.layer_&&d.layer_.source){var y=d.wrapForFullscreen(d.layer_.source),P=function(){var H=I();d.isPresenting=y===H,d.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(J){console.error("screen.orientation.lock() failed due to",J.message)}),d.waitingForPresent_=!1,d.beginPresent_(),m()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),d.removeFullscreenWrapper(),d.disableWakeLock(),d.endPresent_(),d.removeFullscreenListeners_()),d.fireVRDisplayPresentChange_()},L=function(){!d.waitingForPresent_||(d.removeFullscreenWrapper(),d.removeFullscreenListeners_(),d.disableWakeLock(),d.waitingForPresent_=!1,d.isPresenting=!1,f(new Error("Unable to present.")))};d.addFullscreenListeners_(y,P,L),X(y)?(d.enableWakeLock(),d.waitingForPresent_=!0):(c()||u())&&(d.enableWakeLock(),d.isPresenting=!0,d.beginPresent_(),d.fireVRDisplayPresentChange_(),m())}!d.waitingForPresent_&&!c()&&(G(),f(new Error("Unable to present.")))})},me.prototype.exitPresent=function(){var a=this.isPresenting,l=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(d,m){a?(!G()&&c()&&(l.endPresent_(),l.fireVRDisplayPresentChange_()),u()&&(l.removeFullscreenWrapper(),l.removeFullscreenListeners_(),l.endPresent_(),l.fireVRDisplayPresentChange_()),d()):m(new Error("Was not presenting to VRDisplay."))})},me.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},me.prototype.fireVRDisplayPresentChange_=function(){var a=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(a)},me.prototype.fireVRDisplayConnect_=function(){var a=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(a)},me.prototype.addFullscreenListeners_=function(a,l,d){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=a,this.fullscreenChangeHandler_=l,this.fullscreenErrorHandler_=d,l&&(document.fullscreenEnabled?a.addEventListener("fullscreenchange",l,!1):document.webkitFullscreenEnabled?a.addEventListener("webkitfullscreenchange",l,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",l,!1):document.msFullscreenEnabled&&a.addEventListener("msfullscreenchange",l,!1)),d&&(document.fullscreenEnabled?a.addEventListener("fullscreenerror",d,!1):document.webkitFullscreenEnabled?a.addEventListener("webkitfullscreenerror",d,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",d,!1):document.msFullscreenEnabled&&a.addEventListener("msfullscreenerror",d,!1))},me.prototype.removeFullscreenListeners_=function(){if(!!this.fullscreenEventTarget_){var a=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var l=this.fullscreenChangeHandler_;a.removeEventListener("fullscreenchange",l,!1),a.removeEventListener("webkitfullscreenchange",l,!1),document.removeEventListener("mozfullscreenchange",l,!1),a.removeEventListener("msfullscreenchange",l,!1)}if(this.fullscreenErrorHandler_){var d=this.fullscreenErrorHandler_;a.removeEventListener("fullscreenerror",d,!1),a.removeEventListener("webkitfullscreenerror",d,!1),document.removeEventListener("mozfullscreenerror",d,!1),a.removeEventListener("msfullscreenerror",d,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},me.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},me.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},me.prototype.beginPresent_=function(){},me.prototype.endPresent_=function(){},me.prototype.submitFrame=function(a){},me.prototype.getEyeParameters=function(a){return null};var Vx={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},Yi={LEFT:"left",RIGHT:"right"};function Ce(a){var l=ie({},Vx);a=ie(l,a||{}),me.call(this,{wakelock:a.MOBILE_WAKE_LOCK}),this.config=a,this.displayName="Cardboard VRDisplay",this.capabilities=new od({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new gx(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new Oo(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new Pe(this.dpdb_.getDeviceParams(),a.ADDITIONAL_VIEWERS),this.viewerSelector_=new ut(a.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Yn),c()&&window.addEventListener("resize",this.onResize_.bind(this))}return Ce.prototype=Object.create(me.prototype),Ce.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},Ce.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},Ce.prototype._getFieldOfView=function(a){var l;if(a==Yi.LEFT)l=this.deviceInfo_.getFieldOfViewLeftEye();else if(a==Yi.RIGHT)l=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",a),null;return l},Ce.prototype._getEyeOffset=function(a){var l;if(a==Yi.LEFT)l=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(a==Yi.RIGHT)l=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",a),null;return l},Ce.prototype.getEyeParameters=function(a){var l=this._getEyeOffset(a),d=this._getFieldOfView(a),m={offset:l,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(m,"fieldOfView",{enumerable:!0,get:function(){return Yt("VRFieldOfView","VRFrameData's projection matrices"),d}}),m},Ce.prototype.onDeviceParamsUpdated_=function(a){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(a),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},Ce.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},Ce.prototype.beginPresent_=function(){var a=this.layer_.source.getContext("webgl");a||(a=this.layer_.source.getContext("experimental-webgl")),a||(a=this.layer_.source.getContext("webgl2")),a&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(a.canvas.width=O()*this.bufferScale_,a.canvas.height=V()*this.bufferScale_,this.cardboardUI_=new Qn(a)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new Qn(a)),this.distorter_=new yt(a,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(l){this.viewerSelector_.show(this.layer_.source.parentElement),l.stopPropagation(),l.preventDefault()}.bind(this),function(l){this.exitPresent(),l.stopPropagation(),l.preventDefault()}.bind(this)),this.rotateInstructions_&&(M()&&q()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},Ce.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},Ce.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},Ce.prototype.submitFrame=function(a){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var l=this.layer_.source.getContext("webgl");l||(l=this.layer_.source.getContext("experimental-webgl")),l||(l=this.layer_.source.getContext("webgl2"));var d=l.canvas;(d.width!=this.lastWidth||d.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=d.width,this.lastHeight=d.height,this.cardboardUI_.render()}},Ce.prototype.onOrientationChange_=function(a){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},Ce.prototype.onResize_=function(a){if(this.layer_){var l=this.layer_.source.getContext("webgl");l||(l=this.layer_.source.getContext("experimental-webgl")),l||(l=this.layer_.source.getContext("webgl2"));var d=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];l.canvas.setAttribute("style",d.join("; ")+";"),Te(l.canvas)}},Ce.prototype.onViewerChanged_=function(a){this.deviceInfo_.setViewer(a),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},Ce.prototype.fireVRDisplayDeviceParamsChange_=function(){var a=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(a)},Ce.VRFrameData=Ix,Ce.VRDisplay=me,Ce})});function Hx(n){return n}function id(n,t,e){let r=0,o=n.length,i=Math.floor((r+o)/2),s=!1;for(;r<o&&i<n.length;){let p=n[i],c=B(p)?null:e(p);v(c)&&t<c?o=i:(t===c&&(s=!0),r=i+1),i=Math.floor((r+o)/2)}return s||(i+=.5),i}function Rl(n,t,e){e=e||Hx;let r=e(t);return id(n,r,e)}function Dr(n,t){return n.splice(t,1)[0]}function pe(n){return n.splice(0)}function Il(n,t){for(let e=0;e<n.length;++e)if(n[e]!==t[e])return e;return-1}function Ji(n,t,e){n.splice(e,0,t)}function mt(n,t){let e=n.indexOf(t);return e>-1?(Dr(n,e),!0):!1}function zx(n,t){for(let e=n.length-1;e>=0;--e)if(t(n[e]))return Dr(n,e);return null}function sd(n,t,e){return zx(n,r=>e(r)===t)}function ad(n,...t){n.splice(0,n.length,...t)}function Ux(n,t,e){let r=n?0:t.length-1,o=n?t.length:-1,i=n?1:-1;for(let s of e)for(let p=r;p!=o;p+=i){let c=t[p];if(s(c))return c}return null}function wt(n,...t){return Ux(!0,n,t)}function Vl(n,t,e,r){let o;return Z(e)?o=e:et(e)&&(r=e),B(r)&&(r=!0),jx(n,t,o,r)}function jx(n,t,e,r){let o=Rl(n,t,e),i=o%1===0;return o=o|0,(!i||r)&&Ji(n,t,o),o}function ld(n,t){let e=Array.from(n);return Jn(e,t),e}function Jn(n,t){n.sort((e,r)=>{let o=t(e),i=t(r);return o<i?-1:o>i?1:0})}var Ko=class{constructor(t){this.value=t;this._forward=new Array;this._reverse=new Array}connectSorted(t,e){v(e)?(Vl(this._forward,t,r=>e(r.value)),Vl(t._reverse,this,r=>e(r.value))):this.connectTo(t)}connectTo(t){this.connectAt(t,this._forward.length)}connectAt(t,e){Ji(this._forward,t,e),t._reverse.push(this)}disconnectFrom(t){mt(this._forward,t),mt(t._reverse,this)}isConnectedTo(t){return this._forward.indexOf(t)>=0||this._reverse.indexOf(t)>=0}flatten(){let t=new Set,e=[this];for(;e.length>0;){let r=e.shift();v(r)&&!t.has(r)&&(t.add(r),e.push(...r._forward))}return Array.from(t)}get _isEntryPoint(){return this._reverse.length===0}get _isExitPoint(){return this._forward.length===0}get isDisconnected(){return this._isEntryPoint&&this._isExitPoint}get isConnected(){return!this._isExitPoint||!this._isEntryPoint}get isTerminus(){return this._isEntryPoint||this._isExitPoint}get isInternal(){return!this._isEntryPoint&&!this._isExitPoint}};var $i=class extends Ko{connectTo(t){super.connectTo(t)}connectAt(t,e){super.connectAt(t,e)}connectSorted(t,e){super.connectSorted(t,e)}disconnectFrom(t){super.disconnectFrom(t)}isConnectedTo(t){return super.isConnectedTo(t)}flatten(){return super.flatten()}get connections(){return this._forward}get isEntryPoint(){return this._isEntryPoint}get isExitPoint(){return this._isExitPoint}};function Zi(n,t,e){return new Map(n.map(r=>[t(r),e(r)]))}function Ll(n,t){return Zi(n,t,An)}var _n=class{constructor(t){this.items=new Map;this.defaultItems=new Array;if(v(t))for(let[e,r]of t)this.add(e,r)}add(t,e){if(B(t))this.defaultItems.push(e);else{let r=this.items.get(t);B(r)&&this.items.set(t,r=[]),r.push(e)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let t of this.defaultItems)yield t;for(let t of this.items.values())for(let e of t)yield e}has(t){return v(t)?this.items.has(t):this.defaultItems.length>0}get(t){return B(t)?this.defaultItems:this.items.get(t)||[]}count(t){if(B(t))return this.defaultItems.length;let e=this.get(t);return v(e)?e.length:0}get size(){let t=this.defaultItems.length;for(let e of this.items.values())t+=e.length;return t}delete(t){return B(t)?pe(this.defaultItems).length>0:this.items.delete(t)}remove(t,e){if(B(t))mt(this.defaultItems,e);else{let r=this.items.get(t);v(r)&&(mt(r,e),r.length===0&&this.items.delete(t))}}clear(){this.items.clear(),pe(this.defaultItems)}};var Et=class{constructor(t){this.items=new Map;if(v(t))for(let[e,r,o]of t)this.add(e,r,o)}add(t,e,r){let o=this.items.get(t);return B(o)&&this.items.set(t,o=new Map),o.set(e,r),this}*entries(){for(let[t,e]of this.items)for(let[r,o]of e)yield[t,r,o]}keys(t){return B(t)?this.items.keys():this.items.get(t).keys()}*values(){for(let t of this.items.values())for(let e of t.values())yield e}has(t,e){return this.items.has(t)&&(B(e)||this.items.get(t).has(e))}get(t,e){return B(e)?this.items.get(t):this.items.has(t)?this.items.get(t).get(e):null}count(t){return this.items.has(t)?this.items.get(t).size:null}get size(){let t=0;for(let e of this.items.values())t+=e.size;return t}delete(t,e){return B(e)?this.items.delete(t):this.items.has(t)?this.items.get(t).delete(e):!1}clear(){this.items.clear()}};function An(n){return n}function bn(){return!0}function pd(){return!1}function cd(n,t){return n&&t}function Yo(n,t,e){return typeof n===t||n instanceof e}function Z(n){return Yo(n,"function",Function)}function ne(n){return Yo(n,"string",String)}function et(n){return Yo(n,"boolean",Boolean)}function he(n){return Yo(n,"number",Number)}function ze(n){return he(n)&&Number.isFinite(n)&&!Number.isNaN(n)}function $n(n){return v(n)&&Yo(n,"object",Object)}function kl(n){return n instanceof Date}function tt(n){return n instanceof Array}function ht(n,t){throw new Error((t||"Unexpected object: ")+n)}function B(n){return n==null}function v(n){return!B(n)}var Jo=class{constructor(){this.listeners=new Map;this.listenerOptions=new Map}addEventListener(t,e,r){if(Z(e)){let o=this.listeners.get(t);o||(o=new Array,this.listeners.set(t,o)),o.find(i=>i===e)||(o.push(e),r&&this.listenerOptions.set(e,r))}}removeEventListener(t,e){if(Z(e)){let r=this.listeners.get(t);r&&this.removeListener(r,e)}}clearEventListeners(t){for(let[e,r]of this.listeners)if(B(t)||t===e){for(let o of r)this.removeEventListener(t,o);pe(r),this.listeners.delete(e)}}removeListener(t,e){let r=t.findIndex(o=>o===e);r>=0&&(Dr(t,r),this.listenerOptions.has(e)&&this.listenerOptions.delete(e))}dispatchEvent(t){let e=this.listeners.get(t.type);if(e)for(let r of e){let o=this.listenerOptions.get(r);v(o)&&!et(o)&&o.once&&this.removeListener(e,r),r.call(this,t)}return!t.defaultPrevented}},W=class extends Event{get type(){return super.type}constructor(t){super(t)}},Y=class extends Jo{constructor(){super(...arguments);this.bubblers=new Set;this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addEventListener(e,r,o){super.addEventListener(e,r,o)}removeEventListener(e,r){super.removeEventListener(e,r)}clearEventListeners(e){return super.clearEventListeners(e)}addScopedEventListener(e,r,o,i){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([r,o]),this.addEventListener(r,o,i)}removeScope(e){let r=this.scopes.get(e);if(r){this.scopes.delete(e);for(let[o,i]of r)this.removeEventListener(o,i)}}dispatchEvent(e){if(!super.dispatchEvent(e))return!1;for(let r of this.bubblers)if(!r.dispatchEvent(e))return!1;return!0}};var ft=class{constructor(t,e,r=!0){this.onThens=new Array;this.onCatches=new Array;this._result=void 0;this._error=void 0;this._started=!1;this._errored=!1;this._finished=!1;Z(t)?this.resolveTest=t:this.resolveTest=bn,Z(e)?this.rejectTest=e:this.rejectTest=bn,et(t)?this.autoStart=t:et(e)?this.autoStart=e:v(r)?this.autoStart=r:this.autoStart=!1,this.resolve=o=>{if(this.running&&this.resolveTest(o)){this._result=o;for(let i of this.onThens)i(o);this.clear(),this._finished=!0}},this.reject=o=>{if(this.running&&this.rejectTest(o)){this._error=o,this._errored=!0;for(let i of this.onCatches)i(o);this.clear(),this._finished=!0}},this.autoStart&&this.start()}clear(){pe(this.onThens),pe(this.onCatches)}start(){this._started=!0}get result(){if(v(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}get running(){return this.started&&!this.finished}get errored(){return this._errored}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((t,e)=>{this.finished?this.errored?e(this.error):t(this.result):(this.onThens.push(t),this.onCatches.push(e))})}then(t,e){return this.project().then(t,e)}catch(t){return this.project().catch(t)}finally(t){return this.project().finally(t)}reset(){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._errored=!1,this._finished=!1,this._started=!1,this.autoStart&&this.start()}};function dd(n,t){return"on"+t in n}function ke(n,t,e,...r){B(r)&&(r=[]);let o;if(ne(e)?r.unshift(e):he(e)&&(o=e),!(n instanceof Jo)){if(!dd(n,t))throw new Vt(`Target does not have a ${t} rejection event`);for(let u of r)if(!dd(n,u))throw new Vt(`Target does not have a ${u} rejection event`)}let i=new ft;if(he(o)){let u=setTimeout(i.reject,o,`'${t}' has timed out.`);i.finally(clearTimeout.bind(globalThis,u))}let s=(u,h)=>{n.addEventListener(u,h),i.finally(()=>n.removeEventListener(u,h))},p=u=>i.resolve(u),c=u=>i.reject(u);s(t,p);for(let u of r)s(u,c);return i}function Bl(n){return n.then(bn).catch(pd)}var yn=(c=>(c[c.LocalUser=0]="LocalUser",c[c.Mouse=1]="Mouse",c[c.Pen=2]="Pen",c[c.Touch=3]="Touch",c[c.MotionController=4]="MotionController",c[c.MotionControllerLeft=5]="MotionControllerLeft",c[c.MotionControllerRight=6]="MotionControllerRight",c[c.RemoteUser=7]="RemoteUser",c))(yn||{});var ud=class{constructor(t,e,r){this.callback=null;this.promise=new Promise((o,i)=>{this.callback=(...s)=>{t(...s)?o(e(...s)):i(r(...s))}})}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};var Vt=class extends Error{constructor(e,r=null){super(e);this.innerError=r}};function md(){return"chrome"in globalThis&&!navigator.userAgent.match("CriOS")}function hd(){return"InstallTrigger"in globalThis}function Wx(){return/^mac/i.test(navigator.platform)}function qx(){return/iP(ad|hone|od)/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||Wx()&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>2}function Jt(){return/Mobile VR/.test(navigator.userAgent)||/Pico Neo 3 Link/.test(navigator.userAgent)||$t}function ts(){return"xr"in navigator&&"isSessionSupported"in navigator.xr}function Ol(){return"getVRDisplays"in navigator}function ns(){return ts()||Ol()}function $o(){return/Android/.test(navigator.userAgent)||/BlackBerry/.test(navigator.userAgent)||/(UC Browser |UCWEB)/.test(navigator.userAgent)||qx()||Jt()}function Fr(){return!$o()}var Qx=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,es=navigator.userAgent.match(Qx),$t=!!es,fd=$t&&{major:parseFloat(es[1]),minor:parseFloat(es[2]),patch:parseFloat(es[3])},Hb=$t&&/pacific/i.test(navigator.userAgent),zb=$t&&/quest/i.test(navigator.userAgent),Ub=$t&&/quest 2/i.test(navigator.userAgent);var Kx="Worker"in globalThis;var Yx=298.257223563,Jx=6378137;var Dl=1/Yx,os=1-Dl,ee=Dl/(2-Dl),Wb=Jx/(1+ee)*(1+ee*ee/4+ee*ee*ee*ee/64),rs=Math.sqrt(1-os*os),xt=1-os*os,qb=rs*rs/(1-rs*rs),Qb=1-xt*(.25+xt*(3/64+5*xt/256)),Kb=xt*(3/8+xt*(3/32+45*xt/1024)),Yb=xt*xt*(15/256+xt*45/1024),Jb=xt*xt*xt*(35/3072),$b=[ee/2-2*ee*ee/3+37*ee*ee*ee/96,ee*ee/48+ee*ee*ee/15,17*ee*ee*ee/480],Zb=[2*ee-2*ee*ee/3,7*ee*ee/3-8*ee*ee*ee/5,56*ee*ee*ee/15];var is=1e-6,Zo=typeof Float32Array<"u"?Float32Array:Array,Fl=Math.random;var t1=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var nt={};Nx(nt,{add:()=>rg,angle:()=>Tg,bezier:()=>gg,ceil:()=>og,clone:()=>Zx,copy:()=>tg,create:()=>xd,cross:()=>hg,dist:()=>Lg,distance:()=>bd,div:()=>Vg,divide:()=>_d,dot:()=>Ed,equals:()=>Cg,exactEquals:()=>Pg,floor:()=>ig,forEach:()=>Dg,fromValues:()=>eg,hermite:()=>xg,inverse:()=>ug,len:()=>Bg,length:()=>gd,lerp:()=>fg,max:()=>ag,min:()=>sg,mul:()=>Ig,multiply:()=>Ad,negate:()=>dg,normalize:()=>mg,random:()=>vg,rotateX:()=>yg,rotateY:()=>wg,rotateZ:()=>Eg,round:()=>lg,scale:()=>pg,scaleAndAdd:()=>cg,set:()=>ng,sqrDist:()=>kg,sqrLen:()=>Og,squaredDistance:()=>yd,squaredLength:()=>wd,str:()=>Mg,sub:()=>Rg,subtract:()=>vd,transformMat3:()=>_g,transformMat4:()=>Ag,transformQuat:()=>bg,zero:()=>Sg});function xd(){var n=new Zo(3);return Zo!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Zx(n){var t=new Zo(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function gd(n){var t=n[0],e=n[1],r=n[2];return Math.hypot(t,e,r)}function eg(n,t,e){var r=new Zo(3);return r[0]=n,r[1]=t,r[2]=e,r}function tg(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function ng(n,t,e,r){return n[0]=t,n[1]=e,n[2]=r,n}function rg(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function vd(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function Ad(n,t,e){return n[0]=t[0]*e[0],n[1]=t[1]*e[1],n[2]=t[2]*e[2],n}function _d(n,t,e){return n[0]=t[0]/e[0],n[1]=t[1]/e[1],n[2]=t[2]/e[2],n}function og(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n}function ig(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n}function sg(n,t,e){return n[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n[2]=Math.min(t[2],e[2]),n}function ag(n,t,e){return n[0]=Math.max(t[0],e[0]),n[1]=Math.max(t[1],e[1]),n[2]=Math.max(t[2],e[2]),n}function lg(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n}function pg(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function cg(n,t,e,r){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function bd(n,t){var e=t[0]-n[0],r=t[1]-n[1],o=t[2]-n[2];return Math.hypot(e,r,o)}function yd(n,t){var e=t[0]-n[0],r=t[1]-n[1],o=t[2]-n[2];return e*e+r*r+o*o}function wd(n){var t=n[0],e=n[1],r=n[2];return t*t+e*e+r*r}function dg(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n}function ug(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n}function mg(n,t){var e=t[0],r=t[1],o=t[2],i=e*e+r*r+o*o;return i>0&&(i=1/Math.sqrt(i)),n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n}function Ed(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function hg(n,t,e){var r=t[0],o=t[1],i=t[2],s=e[0],p=e[1],c=e[2];return n[0]=o*c-i*p,n[1]=i*s-r*c,n[2]=r*p-o*s,n}function fg(n,t,e,r){var o=t[0],i=t[1],s=t[2];return n[0]=o+r*(e[0]-o),n[1]=i+r*(e[1]-i),n[2]=s+r*(e[2]-s),n}function xg(n,t,e,r,o,i){var s=i*i,p=s*(2*i-3)+1,c=s*(i-2)+i,u=s*(i-1),h=s*(3-2*i);return n[0]=t[0]*p+e[0]*c+r[0]*u+o[0]*h,n[1]=t[1]*p+e[1]*c+r[1]*u+o[1]*h,n[2]=t[2]*p+e[2]*c+r[2]*u+o[2]*h,n}function gg(n,t,e,r,o,i){var s=1-i,p=s*s,c=i*i,u=p*s,h=3*i*p,x=3*c*s,b=c*i;return n[0]=t[0]*u+e[0]*h+r[0]*x+o[0]*b,n[1]=t[1]*u+e[1]*h+r[1]*x+o[1]*b,n[2]=t[2]*u+e[2]*h+r[2]*x+o[2]*b,n}function vg(n,t){t=t||1;var e=Fl()*2*Math.PI,r=Fl()*2-1,o=Math.sqrt(1-r*r)*t;return n[0]=Math.cos(e)*o,n[1]=Math.sin(e)*o,n[2]=r*t,n}function Ag(n,t,e){var r=t[0],o=t[1],i=t[2],s=e[3]*r+e[7]*o+e[11]*i+e[15];return s=s||1,n[0]=(e[0]*r+e[4]*o+e[8]*i+e[12])/s,n[1]=(e[1]*r+e[5]*o+e[9]*i+e[13])/s,n[2]=(e[2]*r+e[6]*o+e[10]*i+e[14])/s,n}function _g(n,t,e){var r=t[0],o=t[1],i=t[2];return n[0]=r*e[0]+o*e[3]+i*e[6],n[1]=r*e[1]+o*e[4]+i*e[7],n[2]=r*e[2]+o*e[5]+i*e[8],n}function bg(n,t,e){var r=e[0],o=e[1],i=e[2],s=e[3],p=t[0],c=t[1],u=t[2],h=o*u-i*c,x=i*p-r*u,b=r*c-o*p,w=o*b-i*x,R=i*h-r*b,C=r*x-o*h,M=s*2;return h*=M,x*=M,b*=M,w*=2,R*=2,C*=2,n[0]=p+h+w,n[1]=c+x+R,n[2]=u+b+C,n}function yg(n,t,e,r){var o=[],i=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],i[0]=o[0],i[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),i[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function wg(n,t,e,r){var o=[],i=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],i[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),i[1]=o[1],i[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function Eg(n,t,e,r){var o=[],i=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],i[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),i[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),i[2]=o[2],n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function Tg(n,t){var e=n[0],r=n[1],o=n[2],i=t[0],s=t[1],p=t[2],c=Math.sqrt(e*e+r*r+o*o),u=Math.sqrt(i*i+s*s+p*p),h=c*u,x=h&&Ed(n,t)/h;return Math.acos(Math.min(Math.max(x,-1),1))}function Sg(n){return n[0]=0,n[1]=0,n[2]=0,n}function Mg(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function Pg(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]}function Cg(n,t){var e=n[0],r=n[1],o=n[2],i=t[0],s=t[1],p=t[2];return Math.abs(e-i)<=is*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(r-s)<=is*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-p)<=is*Math.max(1,Math.abs(o),Math.abs(p))}var Rg=vd,Ig=Ad,Vg=_d,Lg=bd,kg=yd,Bg=gd,Og=wd,Dg=function(){var n=xd();return function(t,e,r,o,i,s){var p,c;for(e||(e=3),r||(r=0),o?c=Math.min(o*e+r,t.length):c=t.length,p=r;p<c;p+=e)n[0]=t[p],n[1]=t[p+1],n[2]=t[p+2],i(n,n,s),t[p]=n[0],t[p+1]=n[1],t[p+2]=n[2];return t}}();var Nl=2*Math.PI;function wn(n){return(n%Nl+Nl)%Nl}function Zt(n,t,e){return Math.min(e,Math.max(t,n))}function Ke(n){return n*Math.PI/180}function Td(n,t,e){return(1-e)*n+e*t}function Xl(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function ss(n){return n*180/Math.PI}function Sd(n){return Math.abs(n)>1e-4?n:0}var Lt=class extends Y{constructor(){super(...arguments);this.attached=new Array;this.soFar=null;this.total=null;this.msg=null;this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(e,r,o,i){this.soFar=e,this.total=r,this.msg=o,this.est=i;for(let s of this.attached)s.report(e,r,o,i)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(e){this.report(0,1,e||"starting")}end(e){this.report(1,1,e||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,pe(this.attached)}};var ei=class extends Lt{constructor(e,r){super();this.i=e;this.prog=r}report(e,r,o,i){super.report(e,r,o,i),this.prog.update(this.i,e,r,o)}};var Nr=class{constructor(t){this.prog=t;this.weightTotal=0;this.subProgressCallbacks=new Array;this.subProgressWeights=new Array;this.subProgressValues=new Array;this.start=performance.now();for(let e=0;e<this.subProgressWeights.length;++e)this.subProgressValues[e]=0,this.subProgressCallbacks[e]=new ei(e,this)}addSubProgress(t){t=t||1,this.weightTotal+=t,this.subProgressWeights.push(t),this.subProgressValues.push(0);let e=new ei(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(e),e}update(t,e,r,o){if(this.prog){this.subProgressValues[t]=e/r;let i=0;for(let u=0;u<this.subProgressWeights.length;++u)i+=this.subProgressValues[u]*this.subProgressWeights[u];let s=performance.now(),p=s-this.start,c=this.start-s+p*this.weightTotal/i;this.prog.report(i,this.weightTotal,o,c)}}};function ti(n,t){return new Gl(t,n).subProgressCallbacks}var Gl=class extends Nr{constructor(t,e){super(e);for(let r of t)this.addSubProgress(r)}};function Md(n){return new Hl(n)}var Hl=class extends Nr{pop(t){return this.addSubProgress(t)}};async function Pd(n,t){let e=new Array(t.length),r=new Array(t.length);for(let s=0;s<t.length;++s){let p=t[s];e[s]=p[0],r[s]=p[1]}let o=ti(n,e),i=new Array(t.length);for(let s=0;s<t.length;++s)i[s]=r[s](o[s]);return await Promise.all(i)}function Cd(n,...t){let e=t.map(r=>[1,r]);return Pd(n,e)}function Tt(n,t){let e=globalThis,r=e[n];if(B(r)){if(B(t))throw new Error(`No value ${n} found`);r=t(),e[n]=r}return r}var Ng="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function St(n,t){if(n<0)throw new Error("Length must be greater than 0");B(t)&&(t=Ng);let e="";for(let r=0;r<n;++r){let o=Math.floor(Math.random()*t.length);e+=t[o]}return e}function Zn(...n){let t=[];for(let e of n)v(e)&&e.length>0&&t.indexOf(e)===-1&&t.push(e);return t.join("-")}var ni=class{constructor(){this.t=0;this.dt=0;this.sdt=0;this.fps=0}set(t,e){this.t=t,this.dt=e,this.sdt=Td(this.sdt,e,.01),e>0&&(this.fps=1e3/e)}},as=class extends ni{constructor(){super(),Object.seal(this)}};var Xr=class{constructor(t){this.timer=null;this.lt=-1;this.tickHandlers=new Array;this._targetFPS=null;this.targetFPS=t;let e=new as,r=0;this.onTick=o=>{this.lt>=0&&(r=o-this.lt,e.set(o,r),this.tick(e)),this.lt=o}}get targetFPS(){return this._targetFPS}set targetFPS(t){this._targetFPS=t}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){mt(this.tickHandlers,t)}tick(t){for(let e of this.tickHandlers)e(t)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};var ls=class extends Xr{constructor(t){super(t)}start(){let t=()=>{this.timer=setTimeout(t,this.targetFrameTime),this.onTick(performance.now())};this.timer=setTimeout(t,this.targetFrameTime)}stop(){this.isRunning&&(clearTimeout(this.timer),super.stop())}};var Rd=304.79999999999995,Rw=Rd*3,Xg=10*100,Gg=Rd*16.5,Hg=Gg*40,Iw=Xg*1e3,Vw=Hg*8,Id=2.54*4,Vd=Id*3,Lw=Vd*3,zg=Vd*16.5,Ug=zg*40,kw=100*1e3,Bw=Ug*8,zl=4*3,jg=zl*3,ri=100/2.54,Wg=zl*16.5,qg=Wg*40,Ow=ri*1e3,Dw=qg*8,Fw=3*3,Qg=100/Id,Kg=3*16.5,Yg=Kg*40,Nw=Qg*1e3,Xw=Yg*8,Ul=ri/zl,Jg=16.5*40,Gw=Ul*1e3,Hw=Jg*8,$g=ri/jg,Zg=16.5/3,ev=Zg*40,zw=$g*1e3,Uw=ev*8,Ld=16.5/Ul,kd=Ld*40,jw=kd*8,Ww=1e3/Ld,qw=40*8,tv=1e3/kd,Qw=8/tv;function Bd(n){return n/Ul}function Od(n){return n/ri}function Dd(n){return n*ri}function jl(n){return v(n)&&n.length>0?parseFloat(n):null}var ps=class{constructor(t,e){this._url=null;this._base=void 0;this._protocol=null;this._host=null;this._hostName=null;this._userName=null;this._password=null;this._port=null;this._pathName=null;this._hash=null;this._query=new Map;t!==void 0&&(this._url=new URL(t,e),this.rehydrate())}rehydrate(){v(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),v(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),v(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),v(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),v(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),v(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),v(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),v(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[t,e]of this._query)this._url.searchParams.set(t,e);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=jl(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((t,e)=>this._query.set(e,t))}refresh(){if(this._url===null){if(v(this._protocol)&&(v(this._host)||v(this._hostName))){if(v(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=jl(this._url.port),this.rehydrate(),!1;if(v(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(v(this._pathName)&&v(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return v(this._url)}base(t){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=t,this.refresh(),this}protocol(t){return this._protocol=t,this.refresh()&&(this._url.protocol=t),this}host(t){return this._host=t,this.refresh()&&(this._url.host=t,this._hostName=this._url.hostname,this._port=jl(this._url.port)),this}hostName(t){return this._hostName=t,this.refresh()&&(this._url.hostname=t,this._host=`${this._url.hostname}:${this._url.port}`),this}port(t){return this._port=t,this.refresh()&&(this._url.port=t.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(t){return this._userName=t,this.refresh()&&(this._url.username=t),this}password(t){return this._password=t,this.refresh()&&(this._url.password=t),this}path(t){return this._pathName=t,this.refresh()&&(this._url.pathname=t),this}pathPop(t){return t=t||/\/[^\/]+\/?$/,this.path(this._pathName.replace(t,""))}pathPush(t){let e=this._pathName;return e.endsWith("/")||(e+="/"),e+=t,this.path(e)}query(t,e){return this._query.set(t,e),this.refresh()&&this._url.searchParams.set(t,e),this}hash(t){return this._hash=t,this.refresh()&&(this._url.hash=t),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};function Wl(n,...t){if(!$n(n))return!1;n=n;for(let e of t){if(!(e in n))return!1;let r=n[e];if(!Z(r))return!1}return!0}function Gr(n){return Wl(n,"dispose")}function nv(n){return Wl(n,"destroy")}function rv(n){return Wl(n,"close")}function ql(n){Gr(n)&&n.dispose(),rv(n)&&n.close(),nv(n)&&n.destroy()}var xe=class{constructor(t,e,r,...o){this.key=t;this.value=e;this.bySetAttribute=r;this.tags=o.map(i=>i.toLocaleUpperCase()),Object.freeze(this)}applyToElement(t){let e=this.key.startsWith("data-");if(!(this.tags.length===0||this.tags.indexOf(t.tagName)>-1||e))console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`);else if(e){let o=this.key.substring(5);t.dataset[o]=this.value}else this.key==="style"?Object.assign(t.style,this.value):this.key==="classList"?this.value.forEach(o=>t.classList.add(o)):this.bySetAttribute?t.setAttribute(this.key,this.value):this.key in t?t[this.key]=this.value:this.value===!1?t.removeAttribute(this.key):this.value===!0?t.setAttribute(this.key,""):t.setAttribute(this.key,this.value)}};function En(n){return new xe("autoplay",n,!1,"audio","video")}function ge(n){return new xe("className",n,!1)}function Hr(...n){return new xe("classList",n,!1)}function er(n){return new xe("controls",n,!1,"audio","video")}function Fd(n,t){return new xe("data-"+n,t,!1)}function Nd(n){return new xe("height",n,!1,"canvas","embed","iframe","img","input","object","video")}function cs(n){return new xe("id",n,!1)}function zr(n){return new xe("loop",n,!1,"audio","bgsound","marquee","video")}function Ql(n){return new xe("max",n,!1,"input","meter","progress")}function Kl(n){return new xe("min",n,!1,"input","meter")}function Xd(n){return new xe("muted",n,!1,"audio","video")}function Tn(n){return new xe("playsInline",n,!1,"audio","video")}function ov(n){return n instanceof URL&&(n=n.href),n}function oi(n){return new xe("src",ov(n),!1,"audio","embed","iframe","img","input","script","source","track","video")}function Yl(n){return new xe("srcObject",n,!1,"audio","video")}function Jl(n){return new xe("step",n,!1,"input")}function Ur(n){return new xe("title",n,!1)}function jr(n){return ne(n)||(n=n.value),new xe("type",n,!1,"button","input","command","embed","link","object","script","source","style","menu")}function Wr(n){return new xe("value",n,!1,"button","data","input","li","meter","option","progress","param")}function Gd(n){return new xe("width",n,!1,"canvas","embed","iframe","img","input","object","video")}var K=class{constructor(t,e){this.key=t;this.value=e;this.name=t.replace(/[A-Z]/g,r=>`-${r.toLocaleLowerCase()}`)}applyToElement(t){t.style[this.key]=this.value}},$l=class{constructor(...t){this.rest=t}applyToElement(t){for(let e of this.rest)e.applyToElement(t)}};function gt(...n){return new $l(...n)}function ii(n){return new K("backgroundColor",n)}function Hd(n){return new K("border",n)}function zd(n){return new K("borderRadius",n)}function Ud(n){return new K("boxShadow",n)}function jd(n){return new K("color",n)}function Wd(n){return new K("columnGap",n)}function Fe(n){return new K("display",n)}function qd(n){return new K("filter",n)}function Qd(n){return new K("flexFlow",n)}function Kd(n){return new K("float",n)}function ds(n){return new K("fontSize",n)}function us(n,t,e,r){return ne(n)||(n=[n,t,e,r].filter(v).join("/")),new K("gridArea",n)}function Yd(n){return new K("gridAutoFlow",n)}function tr(n,t){return ne(n)||(n=[n,t].filter(v).join("/")),new K("gridColumn",n)}function Jd(n){return new K("gridColumnGap",n)}function ms(n,t){return ne(n)||(n=[n,t].filter(v).join("/")),new K("gridRow",n)}function en(n){return new K("gridTemplateColumns",n)}function hs(n){return new K("gridTemplateRows",n)}function vt(n){return new K("height",n)}function nr(n){return new K("left",n)}function Sn(...n){return new K("margin",n.join(" "))}function $d(n){return new K("marginLeft",n)}function Zd(n){return new K("maxHeight",n)}function rr(n){return new K("maxWidth",n)}function eu(n){return new K("minWidth",n)}function tu(...n){return new K("overflow",n.join(" "))}function kt(...n){return new K("padding",n.join(" "))}function ep(n){return new K("pointerEvents",n)}function qr(n){return new K("position",n)}function Mn(n){return new K("textAlign",n)}function or(n){return new K("top",n)}function nu(n){return new K("touchAction",n)}function ru(n){return new K("transform",n)}function ou(n){return new K("verticalAlign",n)}function tn(n){return new K("width",n)}function fs(n){return new K("zIndex",he(n)?n.toFixed(0):n)}function iu(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}var Zl=class{constructor(t,e){this.selector=t;this.props=e}apply(t){let e=this.props.map(r=>`${r.name}: ${r.value};`).join("");t.insertRule(`${this.selector} {${e}}`,t.cssRules.length)}};function Q(n,...t){return new Zl(n,t)}var xs=["change","click","contextmenu","dblclick","mouseup","pointerup","reset","submit","touchend"];function su(n,t){let e=t||bn,r=async o=>{if(o.isTrusted&&await e()){for(let i of xs)window.removeEventListener(i,r);await n()}};for(let o of xs)window.addEventListener(o,r)}function au(n,t){let e=t||bn;return new Promise(r=>{let o=async i=>{if(i.isTrusted&&await e()){for(let s of xs)window.removeEventListener(s,o);r(await n())}};for(let i of xs)window.addEventListener(i,o)})}function tp(n){return $n(n)?n.element instanceof Node:!1}function ir(n){return tp(n)?n.element:n}function iv(n){return $n(n)&&"applyToElement"in n&&Z(n.applyToElement)}function Be(n,t,e="block"){n=ir(n),n.style.display=t?e:"none"}function Bt(n){return n=ir(n),n.style.display!=="none"}function fe(n,...t){n=ir(n);for(let e of t)v(e)&&(e instanceof Node?n.append(e):tp(e)?n.append(ir(e)):iv(e)?e.applyToElement(n):n.append(document.createTextNode(e.toLocaleString())));return n}function Ue(n,...t){let e=null;for(let r of t)if(r instanceof xe&&r.key==="id"){e=document.getElementById(r.value);break}return e==null&&(e=document.createElement(n)),fe(e,...t),e}function si(n){return"disabled"in n&&et(n.disabled)}function ai(n){for(n=ir(n);n.lastChild;)n.lastChild.remove()}function gs(n,t){n=ir(n),ai(n),n.append(av(t))}function np(n,t,e){n=ir(n);let r=v(e),o=r&&n.classList.contains(e);r&&o!==t&&(t?n.classList.add(e):n.classList.remove(e))}async function lu(n,t,e){v(e)&&e.start();let r=n==="canplay"?t.HAVE_CURRENT_DATA:t.HAVE_ENOUGH_DATA;if(t.readyState>=r)return!0;try{return await ke(t,n,"error"),!0}catch(o){return console.warn(t.error,o),!1}finally{v(e)&&e.end()}}function vs(n,t){return lu("canplay",n,t)}function As(n,t){return lu("canplaythrough",n,t)}function sr(...n){return Ue("audio",...n)}function sv(...n){return Ue("button",...n)}function pu(...n){return sv(...n,jr("button"))}function Qr(...n){return pu(...n,Hr("btn","btn-primary"))}function _s(...n){return pu(...n,Hr("btn","btn-secondary"))}function cu(...n){return Ue("canvas",...n)}function du(...n){return Ue("dd",...n)}function ye(...n){return Ue("div",...n)}function uu(...n){return Ue("dl",...n)}function mu(...n){return Ue("dt",...n)}function hu(...n){return Ue("h1",...n)}function fu(...n){return Ue("h2",...n)}function Kr(...n){return Ue("img",...n)}function rp(...n){return Ue("input",...n)}function xu(...n){return Ue("label",...n)}function gu(...n){return Ue("meter",...n)}function bs(...n){return Ue("option",...n)}function op(...n){return Ue("select",...n)}function vu(...n){return Ue("video",...n)}function Au(...n){return rp(jr("checkbox"),...n)}function _u(...n){return rp(jr("number"),...n)}function bu(...n){return rp(jr("range"),...n)}function av(n){return document.createTextNode(n)}function Ot(...n){let t=document.createElement("style");document.head.append(t);for(let e of n)e.apply(t.sheet);return t}function ys(n,t,e,...r){return sr(Tn(!0),er(!1),Xd(t),En(n),zr(e),gt(Fe("none")),...r)}var lv="AudioContext"in globalThis,yu=lv&&"AudioListener"in globalThis,wu=yu&&"setPosition"in AudioListener.prototype,li=yu&&"positionX"in AudioListener.prototype,DE=Z(HTMLMediaElement.prototype.captureStream)||Z(HTMLMediaElement.prototype.mozCaptureStream);function Eu(n){return v(n)&&n.node instanceof AudioNode}function Tu(n){return v(n)&&n.input instanceof AudioNode&&n.output instanceof AudioNode}var Pn=Tt("Juniper:Audio:connections",()=>new Map),ip=Tt("Juniper:Audio:names",()=>new Map);function Su(n){return Tu(n)?n.output:Eu(n)?n.node:n}function Mu(n){if(B(n))return;let t=null;tt(n)?n.length===2?t=n[1]:t=n[2]:t=n;let e=null;return Tu(t)?e=t.input:Eu(t)?e=t.node:e=t,e}function Pu(n){return tt(n)?n.length===2?[n[0]]:[n[0],n[1]]:[]}function pv(n){return v(n)&&v(n.context)}function Cu(n,t){ip.set(t,n)}function re(n){ip.delete(n),pv(n)&&Dt(n)}function Ru(...n){for(let t=1;t<n.length;++t)Mt(n[t-1],n[t])}function Mt(n,t){let e=Su(n),r=Mu(t),o=Pu(t);if(B(r))throw new Error("Must have a target to connect to");r instanceof AudioParam?e.connect(r,o[0]):r instanceof AudioNode?e.connect(r,o[0],o[1]):ht(r),Pn.has(e)||Pn.set(e,new Set);let i=Pn.get(e);return i.has(r)?!1:(i.add(r),!0)}function Dt(n,t){let e=Su(n),r=Mu(t),o=Pu(t);if(B(r)?e.disconnect():r instanceof AudioParam?e.disconnect(r,o[0]):r instanceof AudioNode?e.disconnect(r,o[0],o[1]):ht(r),!Pn.has(e))return!1;let i=Pn.get(e),s=!1;return B(r)?(s=i.size>0,i.clear()):i.has(r)&&(s=!0,i.delete(r)),i.size===0&&Pn.delete(e),s}function cv(){let n=new Map;function t(e){n.has(e)||n.set(e,new $i(e))}for(let e of ip.keys())t(e);for(let[e,r]of Pn){t(e);for(let o of r)t(o)}for(let[e,r]of Pn){let o=n.get(e);for(let i of r)n.has(i)&&o.connectTo(n.get(i))}return Array.from(n.values())}globalThis.getAudioGraph=cv;async function Ft(n){if(Cu("speakers",n.destination),n.state!=="running")if(n.state==="closed")await n.resume();else if(n.state==="suspended"){let t=ke(n,"statechange");su(()=>n.resume()),await t}else ht(n.state)}function nn(n,t,...e){Cu(n,t);for(let r of e)v(r)&&Mt(t,r);return t}function Iu(n,t,e,...r){return nn(n,new AnalyserNode(t,e),...r)}function Yr(n,t,e,...r){return nn(n,new BiquadFilterNode(t,e),...r)}function Vu(n,t,e,...r){return nn(n,new DelayNode(t,e),...r)}function Lu(n,t,e,...r){return nn(n,new DynamicsCompressorNode(t,e),...r)}function Ne(n,t,e,...r){return nn(n,new GainNode(t,e),...r)}function ar(n,t,e,...r){return nn(n,t.createMediaElementSource(e),...r)}function sp(n,t,e,...r){return nn(n,new MediaStreamAudioDestinationNode(t,e),...r)}function ku(n,t,e,...r){return nn(n,t.createMediaStreamSource(e),...r)}function Bu(n,t,e,...r){return nn(n,new PannerNode(t,e),...r)}var ws=class{constructor(){this.t=0;this.p=nt.create();this.f=nt.set(nt.create(),0,0,-1);this.u=nt.set(nt.create(),0,1,0);Object.seal(this)}set(t,e,r,o,i,s,p,c,u){this.setPosition(t,e,r),this.setOrientation(o,i,s,p,c,u)}setPosition(t,e,r){nt.set(this.p,t,e,r)}setOrientation(t,e,r,o,i,s){nt.set(this.f,t,e,r),nt.set(this.u,o,i,s)}copy(t){nt.copy(this.p,t.p),nt.copy(this.f,t.f),nt.copy(this.u,t.u)}};var Jr=class extends Y{constructor(e,r,o){super();this.id=e;this.audioCtx=r;this.spatializer=o;this.pose=new ws;this.disposed=!1;this.volumeControl=Ne(`volume-control-${this.id}`,r)}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){re(this.volumeControl),Gr(this.spatializer)&&this.spatializer.dispose()}audioTick(e){this.spatializer.setPose(this.pose,e)}};var $r=class{constructor(t){this.id=t;this.minDistance=1;this.maxDistance=10;this.algorithm="inverse"}setAudioProperties(t,e,r){this.minDistance=t,this.maxDistance=e,this.algorithm=r}};var Zr=class extends $r{constructor(){super(...arguments);this.disposed=!1}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){re(this.input)}};var ap=Tt("Juniper:Audio:Destinations:Spatializers:NoSpatializationNode:nodes",()=>new WeakMap),je=class extends Zr{static instance(t){if(!ap.has(t)){let e=`no-spatialization-hook-${St(8)}`;ap.set(t,new je(e,t))}return ap.get(t)}constructor(t,e){super(t),this.input=this.output=Ne(this.id,e),Object.seal(this)}setPose(t,e){}};var Es=class extends Jr{constructor(e,r,o){super("final",e,o);this._trueDestination=r;this._remoteUserInput=Ne("remote-user-input",this.audioCtx,null,this._spatializedInput=Ne("spatialized-input",this.audioCtx,null,this.volumeControl)),this._nonSpatializedInput=Ne("non-spatialized-input",this.audioCtx,null,this.volumeControl),Mt(this.volumeControl,this._trueDestination),Mt(je.instance(this.audioCtx),this.nonSpatializedInput)}onDisposing(){re(this._remoteUserInput),re(this._spatializedInput),re(this._nonSpatializedInput),super.onDisposing()}get remoteUserInput(){return this._remoteUserInput}get spatializedInput(){return this._spatializedInput}get nonSpatializedInput(){return this._nonSpatializedInput}get trueDestination(){return this._trueDestination}};var eo=class extends $r{constructor(e){super("listener");this.audioCtx=e}get listener(){return this.audioCtx.listener}};var Ts=class extends eo{constructor(t){if(super(t),!li)throw new Error("Latest WebAudio Listener API is not supported");Object.seal(this)}setPose(t,e){let{p:r,f:o,u:i}=t;this.listener.positionX.setValueAtTime(r[0],e),this.listener.positionY.setValueAtTime(r[1],e),this.listener.positionZ.setValueAtTime(r[2],e),this.listener.forwardX.setValueAtTime(o[0],e),this.listener.forwardY.setValueAtTime(o[1],e),this.listener.forwardZ.setValueAtTime(o[2],e),this.listener.upX.setValueAtTime(i[0],e),this.listener.upY.setValueAtTime(i[1],e),this.listener.upZ.setValueAtTime(i[2],e)}};var Ss=class extends eo{constructor(t){if(super(t),!wu)throw new Error("WebAudio Listener API is not supported");Object.seal(this)}setPose(t,e){let{p:r,f:o,u:i}=t;this.listener.setPosition(r[0],r[1],r[2]),this.listener.setOrientation(o[0],o[1],o[2],i[0],i[1],i[2])}};function*dv(n,t,e=-1){let r=0;for(;e<0||r<e;){yield n,++r;let o=n+t;n=t,t=o}}function Ou(n,t,e){return new pp(n,t,3,e)}var lp=class{constructor(t,e,r,o,i){this.input=Ne(`${t}-input`,e,{gain:r},this.output=Vu(`${t}-delay`,e,{maxDelayTime:o,delayTime:o},i))}dispose(){re(this.input),re(this.output)}},pp=class{constructor(t,e,r,o){this.output=Ne(`${t}-output`,e,null,o);let i=Array.from(dv(1,2,r));this.layers=i.map(s=>new lp(`${t}-echo-layer-${s}`,e,.5/s,s,this.output)),this.input=Ne(`${t}-input`,e,null,...this.layers)}dispose(){re(this.input);for(let t of this.layers)t.dispose();re(this.output),pe(this.layers)}};function Du(n,t,e){return new cp(n,t,e)}var cp=class{constructor(t,e,r){this.node=Yr(`${t}-biquad-filter`,e,{type:"bandpass",frequency:2500,Q:4.5},r)}dispose(){re(this.node)}};function Fu(n,t,e){return new dp(n,t,e)}var dp=class{constructor(t,e,r){this.node=Yr(`${t}-biquad-filter`,e,{type:"bandpass",frequency:400,Q:4.5},r)}dispose(){re(this.node)}};var Nu=new Map([["Radio",Du],["Wall",Fu],["Echo",Ou]]);var up=class extends W{constructor(e){super("sourceadded");this.source=e}},Nt=class extends Jr{constructor(e,r,o,...i){super(e,r,o);this.source=null;this.effects=new Array;this._connected=!1;this.setEffects(...i)}onDisposing(){for(let e of this.effects)Gr(e)&&e.dispose();pe(this.effects),super.onDisposing()}setEffects(...e){Dt(this.volumeControl);for(let r of this.effects)Gr(r)&&r.dispose();pe(this.effects);for(let r of e)if(v(r)){let o=Nu.get(r);v(o)&&this.effects.push(o(`${r}-${this.id}`,this.audioCtx))}Ru(this.volumeControl,...this.effects,this.spatializer)}get spatialized(){return!(this.spatializer instanceof je)}get input(){return this.source}get connected(){return this._connected}connect(){this.connected||Mt(this.source,this.volumeControl)}disconnect(){this.connected&&Dt(this.source,this.volumeControl)}set input(e){e!==this.input&&(this.source&&re(this.source),e&&(this.source=e,this.connect(),this.dispatchEvent(new up(this.source))))}get output(){return this.volumeControl}};var Xt=class extends W{constructor(e,r){super(e);this.source=r}},Cn=class extends Xt{constructor(t){super("loaded",t)}},Ms=class extends Xt{constructor(e,r){super("errored",e);this.error=r}},Rn=class extends Xt{constructor(t){super("played",t)}},In=class extends Xt{constructor(t){super("paused",t)}},Vn=class extends Xt{constructor(t){super("stopped",t)}},Ln=class extends Xt{constructor(e){super("progress",e);this.value=0;this.total=0}};var Ps=new WeakMap,Cs=new WeakMap;function Xu(n,t){let e=(Cs.get(n)||0)+t;Cs.set(n,e);let r=n.mediaElement,o=(Ps.get(r)||0)+t;return Ps.set(r,o),o}function uv(n){Xu(n,1)}function mv(n){Xu(n,-1),Cs.get(n)===0&&(Cs.delete(n),re(n)),Ps.get(n.mediaElement)===0&&(Ps.delete(n.mediaElement),n.mediaElement.isConnected&&n.mediaElement.remove())}var Rs=class extends Nt{constructor(e,r,o,i,s,...p){super(e,r,s,...p);this.randomize=i;uv(this.input=o),this.audio=o.mediaElement,this.disconnect(),this.loadEvt=new Cn(this),this.playEvt=new Rn(this),this.pauseEvt=new In(this),this.stopEvt=new Vn(this),this.progEvt=new Ln(this);let c=u=>{this.disconnect(),this.audio.currentTime===0||u.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};this.audio.addEventListener("ended",c),this.audio.addEventListener("pause",c),this.audio.addEventListener("play",()=>{if(this.connect(),this.randomize&&this.audio.loop&&this.audio.duration>1){let u=this.audio.duration*Math.random();this.audio.currentTime=u}this.dispatchEvent(this.playEvt)}),this.audio.addEventListener("timeupdate",()=>{this.progEvt.value=this.audio.currentTime,this.progEvt.total=this.audio.duration,this.dispatchEvent(this.progEvt)}),vs(this.audio).then(u=>this.dispatchEvent(u?this.loadEvt:new Ms(this,this.audio.error)))}get playbackState(){return this.audio.error?"errored":this.audio.ended||this.audio.paused&&this.audio.currentTime===0?"stopped":this.audio.paused?"paused":"playing"}async play(){await Ft(this.audioCtx),await this.audio.play()}async playThrough(){let e=ke(this,"stopped");await this.play(),await e}pause(){this.audio.pause()}stop(){this.audio.currentTime=0,this.pause()}restart(){return this.stop(),this.play()}onDisposing(){this.disconnect(),mv(this.input),super.onDisposing()}};var Is=class extends Nt{constructor(t,e,r,...o){super(t,e,r,...o)}};var to=class extends Zr{constructor(e,r){super(e);this.lpx=0;this.lpy=0;this.lpz=0;this.lox=0;this.loy=0;this.loz=0;this.input=this.output=this.panner=Bu(this.id,r,{panningModel:"HRTF",distanceModel:"inverse",coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:0})}setAudioProperties(e,r,o){super.setAudioProperties(e,r,o),this.panner.refDistance=this.minDistance,this.panner.distanceModel=o,this.maxDistance<=0?this.panner.rolloffFactor=1/0:this.panner.rolloffFactor=1/this.maxDistance}setPose(e,r){let{p:o,f:i}=e,[s,p,c]=o,[u,h,x]=i;(s!==this.lpx||p!==this.lpy||c!==this.lpz)&&(this.lpx=s,this.lpy=p,this.lpz=c,this.setPosition(s,p,c,r)),(u!==this.lox||h!==this.loy||x!==this.loz)&&(this.lox=u,this.loy=h,this.loz=x,this.setOrientation(u,h,x,r))}};var Vs=class extends to{constructor(t,e){super(t,e),Object.seal(this)}setPosition(t,e,r,o){ze(t)&&ze(e)&&ze(r)&&ze(o)&&(this.panner.positionX.setValueAtTime(t,o),this.panner.positionY.setValueAtTime(e,o),this.panner.positionZ.setValueAtTime(r,o))}setOrientation(t,e,r,o){ze(t)&&ze(e)&&ze(r)&&ze(o)&&(this.panner.orientationX.setValueAtTime(-t,o),this.panner.orientationY.setValueAtTime(-e,o),this.panner.orientationZ.setValueAtTime(-r,o))}};var Ls=class extends to{constructor(t,e){super(t,e),Object.seal(this)}setPosition(t,e,r,o){this.panner.setPosition(t,e,r)}setOrientation(t,e,r,o){this.panner.setOrientation(t,e,r)}};function Gu(n){let t=[];for(let e=0;e<n.length;++e){let r=n[e],o=!1;for(let i=0;i<t.length&&!o;++i){let s=t[i];o=r.kind===s.kind&&s.label.indexOf(r.label)>0}o||t.push(r)}return t}var Gt=Z(HTMLAudioElement.prototype.setSinkId),mp=class extends W{constructor(e){super("audiooutputchanged");this.device=e}},Hu="calla:preferredAudioOutputID",ks=class extends Y{constructor(e){super();this.element=e;this._hasAudioPermission=!1;this.ready=this.start(),Object.seal(this)}get hasAudioPermission(){return this._hasAudioPermission}async start(){if(Gt){let e=await navigator.mediaDevices.enumerateDevices(),r=wt(e,o=>o.kind==="audiooutput"&&o.label.length>0);if(v(r)){this._hasAudioPermission=!0;let o=await this.getPreferredAudioOutput();o&&await this.setAudioOutputDevice(o)}}}get preferredAudioOutputID(){return Gt?localStorage.getItem(Hu):null}async getAudioOutputDevices(e=!1){return Gt?await this.getAvailableDevices(e)||[]:[]}async getAudioOutputDevice(){if(!Gt)return null;let e=this.element&&this.element.sinkId;if(B(e))return null;let r=await this.getAudioOutputDevices();return wt(r,i=>i.deviceId===e)}async getPreferredAudioOutput(){if(!Gt)return null;let e=await this.getAudioOutputDevices();return wt(e,o=>o.deviceId===this.preferredAudioOutputID,o=>o.deviceId==="default",o=>o.deviceId.length>0)}async setAudioOutputDevice(e){if(Gt){if(v(e)&&e.kind!=="audiooutput")throw new Error(`Device is not an audio output device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(Hu,e&&e.deviceId||null);let r=this.element,o=r&&r.sinkId;this.preferredAudioOutputID!==o&&(v(this.preferredAudioOutputID)&&await this.element.setSinkId(this.preferredAudioOutputID),this.dispatchEvent(new mp(e)))}}async getAvailableDevices(e=!1){let r=null,o=null;for(let i=0;i<3;++i){r=await navigator.mediaDevices.enumerateDevices();for(let s of r)s.deviceId.length>0&&(this.hasAudioPermission||(this._hasAudioPermission=s.kind==="audioinput"&&s.label.length>0));if(this.hasAudioPermission)break;try{o=await this.startStream()}catch(s){console.warn(s)}}if(o)for(let i of o.getTracks())i.stop();return r=ld(r||[],i=>i.label),e&&(r=Gu(r)),Gt?r.filter(i=>i.kind==="audiooutput"):[]}startStream(){return navigator.mediaDevices.getUserMedia({audio:!0})}};!("AudioContext"in globalThis)&&"webkitAudioContext"in globalThis&&(globalThis.AudioContext=globalThis.webkitAudioContext);!("OfflineAudioContext"in globalThis)&&"webkitOfflineAudioContext"in globalThis&&(globalThis.OfflineAudioContext=globalThis.webkitOfflineAudioContext);var zu="juniper::useHeadphones",hv=new W("useheadphonestoggled"),fv="createMediaStreamSource"in AudioContext.prototype,Uu=!fv,Bs=class extends Y{constructor(e){super();this.users=new Map;this.clips=new Map;this.clipPaths=new Map;this.pathSources=new Map;this.pathCounts=new Map;this._minDistance=1;this._maxDistance=10;this._useHeadphones=!1;this._algorithm="inverse";this.element=null;this.audioDestination=null;this.localUserID=null;this.counter=0;this.audioCtx=new AudioContext;let r=sp("final-destination",this.audioCtx);this.element=sr(cs("Audio-Device-Manager"),Tn(!0),En(!0),Yl(r.stream),gt(Fe("none"))),fe(document.body,this),this.speakers=new ks(this.element),this.input=Ne("local-mic-user-gain",this.audioCtx,null,this.localAutoControlledGain=Ne("local-mic-auto-gain",this.audioCtx,null,this.localFilter=Yr("local-mic-filter",this.audioCtx,{type:"bandpass",frequency:1500,Q:.25},this.localCompressor=Lu("local-mic-compressor",this.audioCtx,{threshold:-15,knee:40,ratio:17},this.output=sp("local-mic-destination",this.audioCtx))))),this.audioDestination=new Es(this.audioCtx,r,li?new Ts(this.audioCtx):new Ss(this.audioCtx)),je.instance(this.audioCtx).setAudioProperties(this._minDistance,this._maxDistance,this.algorithm),this.setLocalUserID(e);let o=localStorage.getItem(zu);v(o)?this._useHeadphones=o==="true":this._useHeadphones=Jt(),this.ready=this.start(),Object.seal(this)}get algorithm(){return this._algorithm}get useHeadphones(){return this._useHeadphones}set useHeadphones(e){e!==this.useHeadphones&&(this._useHeadphones=e,localStorage.setItem(zu,this.useHeadphones.toString()),this.dispatchEvent(hv))}dispose(){for(let e of this.users.keys())this.removeUser(e);for(let e of this.clips.keys())this.removeClip(e);Dt(this.input),Dt(this.localAutoControlledGain),Dt(this.localFilter),Dt(this.localCompressor),Dt(this.output),this.audioDestination.dispose(),this.audioCtx.suspend()}async start(){await Promise.all([Ft(this.audioCtx),au(()=>this.element.play()),this.speakers.ready])}get filter(){return this.localFilter}get filterFrequency(){return this.localFilter.frequency.value}set filterFrequency(e){this.localFilter.frequency.value=e}get compressor(){return this.localCompressor}get currentTime(){return this.audioCtx.currentTime}update(){let e=this.currentTime;this.audioDestination.audioTick(e);for(let r of this.clips.values())r.audioTick(e);for(let r of this.users.values())r.audioTick(e)}newSpatializer(e,r,o){if(r){let i=o?this.audioDestination.remoteUserInput:this.audioDestination.spatializedInput,s=`spatializer-${++this.counter}-${e}`,p=li?new Vs(s+"-new-wa",this.audioCtx):new Ls(e+"-old-wa",this.audioCtx);return Mt(p,i),p}else return je.instance(this.audioCtx)}createSpatializer(e,r,o){let i=this.newSpatializer(e,r,o);return i.setAudioProperties(this._minDistance,this._maxDistance,this._algorithm),i}createUser(e,r){if(!this.users.has(e)){let o=Zn(r,e),i=this.createSpatializer(o,!0,!0),s=new Is(o,this.audioCtx,i);this.users.set(e,s)}return this.users.get(e)}setLocalUserID(e){return this.audioDestination&&(this.localUserID=e),this.audioDestination}loadBasicClip(e,r,o,i){return this.loadClip(e,r,!1,!1,!1,!1,o,[],i)}createBasicClip(e,r,o){return this.createClip(e,r,!1,!1,!1,o,[])}async loadClip(e,r,o,i,s,p,c,u,h){if(B(r)||ne(r)&&r.length===0)throw new Error("No clip source path provided");v(h)&&h.start(r);let x=await this.getSourceTask(e,r,r,o,i,h),b=this.makeClip(x,e,r,s,p,i,c,...u);return this.clips.set(e,b),v(h)&&h.end(r),b}createClip(e,r,o,i,s,p,c){if(B(r)||ne(r)&&r.length===0)throw new Error("No clip source path provided");let u=r.currentSrc,h=this.createSourceFromElement(e,r),x=this.makeClip(h,e,u,i,s,o,p,...c);return this.clips.set(e,x),x}getSourceTask(e,r,o,i,s,p){this.clipPaths.set(e,r);let c=this.pathSources.get(r);return v(c)?this.pathCounts.set(r,this.pathCounts.get(r)+1):(c=this.createSourceFromFile(e,o,i,s,p),this.pathSources.set(r,c),this.pathCounts.set(r,1)),c}async createSourceFromFile(e,r,o,i,s){v(s)&&s.start(e);let p=ys(i,!1,o,oi(r));if(!await vs(p))throw p.error;return v(s)&&s.end(e),this.createSourceFromElement(e,p)}createSourceFromStream(e,r){let o=ys(!0,!Uu,!1,Yl(r));return Uu?this.createSourceFromElement(e,o):ku(Zn("media-stream-source",e,r.id),this.audioCtx,r)}createSourceFromElement(e,r){return ar(Zn("media-element-source",e),this.audioCtx,r)}makeClip(e,r,o,i,s,p,c,...u){let h=Zn(r,o),x=this.createSpatializer(h,i,!1),b=new Rs(Zn("audio-clip-element",h),this.audioCtx,e,s,x,...u);return p&&b.play(),b.volume=c,b}hasClip(e){return this.clips.has(e)}async playClip(e){this.hasClip(e)&&await this.clips.get(e).play()}async playClipThrough(e){this.hasClip(e)&&await this.clips.get(e).playThrough()}stopClip(e){this.hasClip(e)&&this.clips.get(e).stop()}getUser(e){return this.users.get(e)}getClip(e){return this.clips.get(e)}removeSource(e,r){let o=e.get(r);return v(o)&&(e.delete(r),o.dispose()),o}removeUser(e){let r=this.removeSource(this.users,e);v(r.input)&&(r.input=null)}removeClip(e){let r=this.clipPaths.get(e);return this.pathCounts.set(r,this.pathCounts.get(r)-1),this.pathCounts.get(r)===0&&(this.pathCounts.delete(r),this.pathSources.delete(r)),this.removeSource(this.clips,e)}setUserStream(e,r,o){if(this.users.has(e)){let i=this.users.get(e);o?i.input=this.createSourceFromStream(Zn(r,e),o):v(i.input)&&(i.input=null)}}setAudioProperties(e,r,o){this._minDistance=e,this._maxDistance=r,this._algorithm=o,je.instance(this.audioCtx).setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let i of this.users.values())i.spatializer.setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let i of this.clips.values())i.spatializer.setAudioProperties(i.spatializer.minDistance,i.spatializer.maxDistance,this.algorithm)}withPose(e,r,o){let i=e.get(r),s=null;return i?s=i.pose:r===this.localUserID&&(s=this.audioDestination.pose),s?o(s):null}withUser(e,r){return this.withPose(this.users,e,r)}setUserPose(e,r,o,i,s,p,c,u,h,x){this.withUser(e,b=>{b.set(r,o,i,s,p,c,u,h,x)})}withClip(e,r){return this.withPose(this.clips,e,r)}setClipPosition(e,r,o,i){this.withClip(e,s=>{s.setPosition(r,o,i)})}setClipOrientation(e,r,o,i,s,p,c){this.withClip(e,u=>{u.setOrientation(r,o,i,s,p,c)})}setClipPose(e,r,o,i,s,p,c,u,h,x){this.withClip(e,b=>{b.set(r,o,i,s,p,c,u,h,x)})}};var hp=class extends Xt{constructor(t,e){super(t,e)}},no=class extends hp{constructor(t){super("loading",t)}};var Os=class extends Nt{constructor(e){super("JuniperAudioPlayer",e,je.instance(e));this._data=null;this._loaded=!1;this.sourcesByURL=new Map;this.sources=new Array;this.potatoes=new Array;this.element=sr(Tn(!0),En(!1),zr(!1),er(!0)),this.input=ar("JuniperAudioPlayer-Input",e,this.element),this.loadingEvt=new no(this),this.loadEvt=new Cn(this),this.playEvt=new Rn(this),this.pauseEvt=new In(this),this.stopEvt=new Vn(this),this.progEvt=new Ln(this),this.onPlay=async()=>{this.connect(),this.dispatchEvent(this.playEvt)},this.onPause=r=>{this.disconnect(),this.element.currentTime===0||r.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)},this.onTimeUpdate=async()=>{this.progEvt.value=this.element.currentTime,this.progEvt.total=this.element.duration,this.dispatchEvent(this.progEvt)},this.onError=()=>this.loadAudio(),this.element.addEventListener("play",this.onPlay),this.element.addEventListener("pause",this.onPause),this.element.addEventListener("ended",this.onPause),this.element.addEventListener("error",this.onError),this.element.addEventListener("waiting",this.onWaiting),this.element.addEventListener("canplay",this.onCanPlay),this.element.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{audioPlayer:this})}get data(){return this._data}get loaded(){return this._loaded}get title(){return this.element.title}setTitle(e){this.element.title=e}get hasAudio(){let e=this.sourcesByURL.get(this.element.src);return v(e)&&e.acodec!=="none"||v(this.element.audioTracks)&&this.element.audioTracks.length>0||v(this.element.webkitAudioDecodedByteCount)&&this.element.webkitAudioDecodedByteCount>0||v(this.element.mozHasAudio)&&this.element.mozHasAudio}onDisposing(){super.onDisposing(),this.clear(),re(this.input),re(this.audioSource),this.element.removeEventListener("play",this.onPlay),this.element.removeEventListener("pause",this.onPause),this.element.removeEventListener("ended",this.onPause),this.element.removeEventListener("error",this.onError),this.element.removeEventListener("waiting",this.onWaiting),this.element.removeEventListener("canplay",this.onCanPlay),this.element.removeEventListener("timeupdate",this.onTimeUpdate)}clear(){this.stop(),this.sourcesByURL.clear(),pe(this.sources),pe(this.potatoes),this.element.src="",this._data=null,this._loaded=!1}async load(e,r){this.clear(),this._data=e,ne(e)?(this.setTitle(e),this.potatoes.push(e)):(this.setTitle(e.title),Jn(e.audios,o=>-o.resolution),ad(this.sources,...e.audios));for(let o of this.sources)this.sourcesByURL.set(o.url,o);if(!this.hasSources)throw new Error("No audio sources");if(this.dispatchEvent(this.loadingEvt),await this.loadAudio(r),!this.hasSources)throw new Error("No audio sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}async getMediaCapabilities(e){let r={type:"file",audio:{contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr}};try{return await navigator.mediaCapabilities.decodingInfo(r)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:r}}}get hasSources(){return this.sources.length>0||this.potatoes.length>0}async loadAudio(e){for(v(e)&&e.start(),this.element.removeEventListener("error",this.onError);this.hasSources;){let r=null,o=this.sources.shift();if(v(o)){let i=await this.getMediaCapabilities(o);if(!i.smooth||!i.powerEfficient){this.potatoes.push(o.url);continue}else r=o.url}else r=this.potatoes.shift();if(this.element.src=r,this.element.load(),await As(this.element)){v(o)?this.sources.unshift(o):this.potatoes.unshift(r),this.element.addEventListener("error",this.onError),v(e)&&e.end();return}}}get playbackState(){return B(this.data)?"empty":this.loaded?this.element.error?"errored":this.element.ended||this.element.paused&&this.element.currentTime===0?"stopped":this.element.paused?"paused":"playing":"loading"}async play(){await Ft(this.audioCtx),await this.element.play()}async playThrough(){let e=ke(this,"stopped");await this.play(),await e}pause(){this.element.pause()}stop(){this.pause(),this.element.currentTime=0}restart(){return this.stop(),this.play()}};var pi="HTMLCanvasElement"in globalThis,jT="HTMLImageElement"in globalThis,ju=!1,Ds=!ju&&"OffscreenCanvas"in globalThis,xv=!ju&&"createImageBitmap"in globalThis;function rn(n){return pi&&n instanceof HTMLCanvasElement}function Wu(n){return Ds&&n instanceof OffscreenCanvas}function qu(n){return xv&&n instanceof ImageBitmap}function Qu(n){return n instanceof ImageData}function Ku(n,t){let e=n.getContext("2d");if(B(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function Yu(n,t){let e=n.getContext("2d");if(B(e))throw new Error("Could not create 2d context for canvas");e.putImageData(t,0,0)}function gv(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var fp=Ds&&gv(),ro=fp&&Ns||pi&&ci||null,Fs=pi?ci:ro;function vv(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var WT=Ds&&vv();function Ns(n,t){return new OffscreenCanvas(n,t)}function ci(n,t){return cu(Gd(n),Nd(t))}function Av(n){let t=Ns(n.width,n.height);return Ku(t,n),t}function _v(n){let t=ci(n.width,n.height);return Ku(t,n),t}var Ju=fp&&Av||pi&&_v||null;function bv(n){let t=Ns(n.width,n.height);return Yu(t,n),t}function yv(n){let t=ci(n.width,n.height);return Yu(t,n),t}var $u=fp&&bv||pi&&yv||null;function Zu(n,t,e,r=1){return t=Math.floor(t*r),e=Math.floor(e*r),n.width!=t||n.height!=e?(n.width=t,n.height=e,!0):!1}function wv(n){return v(n.textBaseline)}function Ev(n,t,e,r=1){let o=n.imageSmoothingEnabled,i=n.textBaseline,s=n.textAlign,p=n.font,c=Zu(n.canvas,t,e,r);return c&&(n.imageSmoothingEnabled=o,n.textBaseline=i,n.textAlign=s,n.font=p),c}function xp(n,t,e,r=1){return wv(n)?Ev(n,t,e,r):Zu(n.canvas,t,e,r)}var em=/([^\/]+)\/(.+)/,Tv=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/,lr=class{constructor(t,e,r){this._type=t;this._fullSubType=e;this._primaryExtension=null;this.depMessage=null;let o=new Map;this._parameters=o;let i=this._fullSubType.match(Tv);this._tree=i[1],this._subType=i[2],this._suffix=i[3];let s=i[4];if(this._value=this._fullValue=this._type+"/",v(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,v(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),v(s)){let p=s.split(";").map(c=>c.trim()).filter(c=>c.length>0).map(c=>c.split("="));for(let[c,...u]of p){let h=u.join("=");o.set(c,h);let x=`; ${c}=${h}`;this._fullValue+=x,c!=="q"&&(this._value+=x)}}this._extensions=r||[],this._primaryExtension=this._extensions[0]||null}static parse(t){if(!t)return null;let e=t.match(em);if(!e)return null;let r=e[1],o=e[2];return new lr(r,o)}deprecate(t){return this.depMessage=t,this}check(){v(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(t){if(B(t))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let e=null,r=null;if(ne(t)){let o=t.match(em);if(!o)return!1;e=o[1],r=o[2]}else e=t.typeName,r=t._fullSubType;return this.typeName===e&&(this._fullSubType==="*"||this._fullSubType===r)}withParameter(t,e){let r=`${this._fullSubType}; ${t}=${e}`;return new lr(this.typeName,r,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}addExtension(t){if(!t)throw new Error("File name is not defined");if(this.primaryExtension){let e=t.lastIndexOf(".");if(e>-1){let r=t.substring(e+1);this.extensions.indexOf(r)>-1&&(t=t.substring(0,e))}t=`${t}.${this.primaryExtension}`}return t}};function Sv(n,t,...e){return new lr(n,t,e)}function We(n){return Sv.bind(null,n)}var Mv=We("audio");var oo=Mv("mpeg","mp3","mp2","mp2a","mpga","m2a","m3a");var Pv=We("image");var tm=Pv("png","png");var nm=We("model");var Xs=nm("gltf-binary","glb"),rm=nm("gltf+json","gltf");var Cv=We("video");var om=Cv("vnd.mpeg.dash.mpd","mpd");var gp=class{constructor(t,e){this.path=t;this.type=e;this._result=null;this._error=null;this._started=!1;this._finished=!1;this.resolve=null;this.reject=null;this.promise=new Promise((r,o)=>{this.resolve=i=>{this._result=i,this._finished=!0,r(i)},this.reject=i=>{this._error=i,this._finished=!0,o(i)}})}get result(){if(v(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}async getSize(t){try{let{contentLength:e}=await t.head(this.path).accept(this.type).exec();return[this,e||1]}catch(e){return console.warn(e),[this,1]}}async fetch(t,e){try{let r=await this.getResult(t,e);this.resolve(r)}catch(r){this.reject(r)}}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};function di(n){return v(n)&&Z(n.then)&&Z(n.catch)&&Z(n.finally)&&Z(n.fetch)&&Z(n.getSize)}var io=class extends gp{constructor(e,r,o){let i;et(r)?o=r:i=r;super(e,i);this.useCache=!!o}async getResult(e,r){return(await this.getRequest(e,r)).content}getRequest(e,r){let o=e.get(this.path).useCache(this.useCache).progress(r);return this.getResponse(o)}},kn=class extends io{getResponse(t){return t.audio(!1,!1,this.type)}};var Gs=class extends io{getResponse(t){return t.image(this.type)}};async function so(n,t){let{status:e,path:r,content:o,contentType:i,contentLength:s,fileName:p,headers:c,date:u}=n;return{status:e,path:r,content:await t(o),contentType:i,contentLength:s,fileName:p,headers:c,date:u}}var Bn=class extends Y{constructor(e,r,o){super();this._scale=250;this._visible=!0;this.wasVisible=null;this.redrawnEvt=new W("redrawn");this.element=null;v(o)&&v(o.scale)&&(this._scale=o.scale),this._canvas=Fs(e,r),this._g=this.canvas.getContext("2d"),rn(this._canvas)&&(this.element=this._canvas)}fillRect(e,r,o,i,s,p){this.g.fillStyle=e,this.g.fillRect(r+p,o+p,i-2*p,s-2*p)}drawText(e,r,o,i){this.g.textAlign=i,this.g.strokeText(e,r,o),this.g.fillText(e,r,o)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(e){this.scale!==e&&(this._scale=e,this.redraw())}get visible(){return this._visible}set visible(e){this.visible!==e&&(this.wasVisible=this._visible,this._visible=e,this.redraw())}};var Hs=class extends Bn{constructor(){super(128,128);this._pitch=0;this._heading=0;this.redraw()}get pitch(){return this._pitch}set pitch(e){e!==this.pitch&&(this._pitch=e,this.redraw())}get heading(){return this._heading}set heading(e){e!==this.heading&&(this._heading=e,this.redraw())}setPitchAndHeading(e,r){(e!==this.pitch||r!==this.heading)&&(this._pitch=e,this._heading=r,this.redraw())}onRedraw(){let e=Ke(this.pitch),r=Ke(this.heading-180),o=5,i=this.canvas.width-2*o,s=this.canvas.height-2*o,p=.5*i,c=.5*s,u=Math.sin(e),h=this.g;return h.save(),h.clearRect(0,0,this.canvas.width,this.canvas.height),h.translate(o,o),h.scale(p,c),h.translate(1,1),h.fillStyle="#808080",h.beginPath(),h.arc(0,0,1,0,2*Math.PI),h.fill(),h.fillStyle="#d0d0d0",h.beginPath(),h.arc(0,0,1,0,Math.PI,!0),h.fill(),h.save(),h.scale(1,Math.abs(u)),u<0&&(h.fillStyle="#808080"),h.beginPath(),h.arc(0,0,1,0,Math.PI,u<0),h.fill(),h.restore(),h.save(),h.shadowColor="#404040",h.shadowBlur=4,h.shadowOffsetX=3,h.shadowOffsetY=3,h.rotate(r),h.fillStyle="#ff0000",h.beginPath(),h.moveTo(-.1,0),h.lineTo(0,.667),h.lineTo(.1,0),h.closePath(),h.fill(),h.fillStyle="#ffffff",h.beginPath(),h.moveTo(-.1,0),h.lineTo(0,-.667),h.lineTo(.1,0),h.closePath(),h.fill(),h.restore(),h.beginPath(),h.strokeStyle="#000000",h.lineWidth=.1,h.arc(0,0,1,0,2*Math.PI),h.stroke(),h.restore(),!0}};var W3=Tt("juniper::loadedFonts",()=>[]);function zs(n){let t=[];return n.fontStyle&&n.fontStyle!=="normal"&&t.push(n.fontStyle),n.fontVariant&&n.fontVariant!=="normal"&&t.push(n.fontVariant),n.fontWeight&&n.fontWeight!=="normal"&&t.push(n.fontWeight),t.push(`${n.fontSize}px`),t.push(n.fontFamily),t.join(" ")}function im(n){return"getBattery"in n}var kv=["","N/A","charging"],ao=class extends Bn{constructor(){super(256,128);this.battery=null;this.lastChargeDirection=null;this.lastLevel=null;this.chargeDirection=0;this.level=.5;im(navigator)?this.readBattery(navigator):this.redraw()}onRedraw(){this.battery?(this.chargeDirection=this.battery.charging?1:-1,this.level=this.battery.level):(this.level+=.1,this.level>1&&(this.level=0));let e=this.chargeDirection!==this.lastChargeDirection,r=this.level!==this.lastLevel;if(!e&&!r)return!1;this.lastChargeDirection=this.chargeDirection,this.lastLevel=this.level;let o=this.level<.1?"red":"#ccc",i=7,s=.7,p=(1-s)/2,c=this.canvas.width-2*i,u=c-4*i,h=this.canvas.height-4*i,x=c/2,b=this.canvas.height/2,w=kv[this.chargeDirection+1];return this.g.clearRect(0,0,c,this.canvas.height),this.g.save(),this.g.translate(p*this.canvas.width,p*this.canvas.height),this.g.globalAlpha=.75,this.g.scale(s,s),this.fillRect("#ccc",0,0,c,this.canvas.height,0),this.fillRect("#ccc",c,b-2*i-10,i+10,4*i+20,0),this.g.clearRect(i,i,c-2*i,this.canvas.height-2*i),this.fillRect("black",i,i,c-2*i,this.canvas.height-2*i,0),this.g.clearRect(2*i,2*i,u*this.level,h),this.fillRect(o,2*i,2*i,u*this.level,h,0),this.g.fillStyle="white",this.g.strokeStyle="black",this.g.lineWidth=4,this.g.textBaseline="middle",this.g.font=zs({fontSize:h/2,fontFamily:"Lato"}),this.drawText(w,x,b,"center"),this.g.restore(),!0}async readBattery(e){let r=this.redraw.bind(this);r(),this.battery=await e.getBattery(),this.battery.addEventListener("chargingchange",r),this.battery.addEventListener("levelchange",r),setInterval(r,1e3),r()}};ao.isAvailable=im(navigator);var on=class extends Bn{constructor(e){super(10,10,e);this.trueWidth=null;this.trueHeight=null;this.trueFontSize=null;this.dx=null;this._minWidth=null;this._maxWidth=null;this._minHeight=null;this._maxHeight=null;this._freezeDimensions=!1;this._dimensionsFrozen=!1;this._bgFillColor=null;this._bgStrokeColor=null;this._bgStrokeSize=null;this._textStrokeColor=null;this._textStrokeSize=null;this._textFillColor="black";this._textDirection="horizontal";this._wrapWords=!0;this._fontStyle="normal";this._fontVariant="normal";this._fontWeight="normal";this._fontFamily="sans-serif";this._fontSize=20;this._value=null;v(e)&&(v(e.minWidth)&&(this._minWidth=e.minWidth),v(e.maxWidth)&&(this._maxWidth=e.maxWidth),v(e.minHeight)&&(this._minHeight=e.minHeight),v(e.maxHeight)&&(this._maxHeight=e.maxHeight),v(e.freezeDimensions)&&(this._freezeDimensions=e.freezeDimensions),v(e.textStrokeColor)&&(this._textStrokeColor=e.textStrokeColor),v(e.textStrokeSize)&&(this._textStrokeSize=e.textStrokeSize),v(e.bgFillColor)&&(this._bgFillColor=e.bgFillColor),v(e.bgStrokeColor)&&(this._bgStrokeColor=e.bgStrokeColor),v(e.bgStrokeSize)&&(this._bgStrokeSize=e.bgStrokeSize),v(e.value)&&(this._value=e.value),v(e.textFillColor)&&(this._textFillColor=e.textFillColor),v(e.textDirection)&&(this._textDirection=e.textDirection),v(e.wrapWords)&&(this._wrapWords=e.wrapWords),v(e.fontStyle)&&(this._fontStyle=e.fontStyle),v(e.fontVariant)&&(this._fontVariant=e.fontVariant),v(e.fontWeight)&&(this._fontWeight=e.fontWeight),v(e.fontFamily)&&(this._fontFamily=e.fontFamily),v(e.fontSize)&&(this._fontSize=e.fontSize),v(e.padding)&&(he(e.padding)?this._padding={left:e.padding,right:e.padding,top:e.padding,bottom:e.padding}:this._padding=e.padding)),B(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(e){this.minWidth!==e&&(this._minWidth=e,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(e){this.maxWidth!==e&&(this._maxWidth=e,this.redraw())}get minHeight(){return this._minHeight}set minHeight(e){this.minHeight!==e&&(this._minHeight=e,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(e){this.maxHeight!==e&&(this._maxHeight=e,this.redraw())}get padding(){return this._padding}set padding(e){if(e instanceof Array)throw new Error("Invalid padding");(this.padding.top!==e.top||this.padding.right!=e.right||this.padding.bottom!=e.bottom||this.padding.left!=e.left)&&(this._padding=e,this.redraw())}get wrapWords(){return this._wrapWords}set wrapWords(e){this.wrapWords!==e&&(this._wrapWords=e,this.redraw())}get textDirection(){return this._textDirection}set textDirection(e){this.textDirection!==e&&(this._textDirection=e,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(e){this.fontStyle!==e&&(this._fontStyle=e,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(e){this.fontVariant!==e&&(this._fontVariant=e,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(e){this.fontWeight!==e&&(this._fontWeight=e,this.redraw())}get fontSize(){return this._fontSize}set fontSize(e){this.fontSize!==e&&(this._fontSize=e,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(e){this.textFillColor!==e&&(this._textFillColor=e,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(e){this.textStrokeColor!==e&&(this._textStrokeColor=e,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(e){this.textStrokeSize!==e&&(this._textStrokeSize=e,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(e){this.bgFillColor!==e&&(this._bgFillColor=e,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(e){this.bgStrokeColor!==e&&(this._bgStrokeColor=e,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(e){this.bgStrokeSize!==e&&(this._bgStrokeSize=e,this.redraw())}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.redraw())}split(e){return this.wrapWords?e.split(" ").join(`
`).replace(/\r\n/,`
`).split(`
`):e.replace(/\r\n/,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value){let e=this.split(this.value),r=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let i=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,s=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,p=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,c=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,u=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,h=r?c:s,x=r?u:p,b=r?s:c,w=r?p:u,R=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let C=!1,M=!1,k=1e4,O=0;this.trueFontSize=Zt(this.fontSize*this.scale,O,k);let V=null,X=Number.MAX_VALUE;do{let F=this.fontSize;this._fontSize=this.trueFontSize;let se=zs(this);this._fontSize=F,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=se,this.trueWidth=0,this.trueHeight=0;for(let ae of e){let q=this.g.measureText(ae);this.trueWidth=Math.max(this.trueWidth,q.width),this.trueHeight+=this.trueFontSize,he(q.actualBoundingBoxLeft)&&he(q.actualBoundingBoxRight)&&he(q.actualBoundingBoxAscent)&&he(q.actualBoundingBoxDescent)&&(i||(this.trueWidth=q.actualBoundingBoxLeft+q.actualBoundingBoxRight,this.trueHeight=q.actualBoundingBoxAscent+q.actualBoundingBoxDescent,this.dx=(q.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(i){let ae=this.trueWidth-h,q=this.trueWidth-x,ie=this.trueHeight-b,Te=this.trueHeight-w,Ae=Math.abs(ae),le=Math.abs(q),ot=Math.abs(ie),Or=Math.abs(Te);C=q>1||Te>1,M=ae<-1&&ie<-1;let gn=Math.min(Ae,Math.min(le,Math.min(ot,Or)));gn<X&&(X=gn,V=this.g.font),(C||M)&&R.indexOf(this.g.font)>-1&&V&&(this.g.font=V,C=!1,M=!1),C?(k=this.trueFontSize,this.trueFontSize=(O+this.trueFontSize)/2):M&&(O=this.trueFontSize,this.trueFontSize=(this.trueFontSize+k)/2)}R.push(this.g.font)}while(C||M);i&&(this.trueWidth<h?this.trueWidth=h:this.trueWidth>x&&(this.trueWidth=x),this.trueHeight<b?this.trueHeight=b:this.trueHeight>w&&(this.trueHeight=w));let G=this.trueWidth+this.scale*(this.padding.right+this.padding.left),I=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{xp(this.g,G,I)}catch(F){throw console.error(F),F}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let o=.5*(e.length-1);for(let i=0;i<e.length;++i){let s=e[i],p=(i-o)*this.trueFontSize,c=this.dx+this.trueWidth/2+this.scale*this.padding.left,u=p+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(s,c,u),this.textFillColor&&this.g.fillText(s,c,u)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let i=this.bgStrokeSize/2;this.g.strokeRect(i,i,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(r){let i=ro(this.canvas.height,this.canvas.width),s=i.getContext("2d");s?(s.translate(i.width/2,i.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?s.rotate(Math.PI/2):this.textDirection==="vertical-right"&&s.rotate(-Math.PI/2),s.translate(-this.canvas.width/2,-this.canvas.height/2),s.drawImage(this.canvas,0,0),xp(this.g,i.width,i.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(i,0,0)}return!0}else return!1}};var Us=class extends on{constructor(){super({textFillColor:"#ffffff",textStrokeColor:"rgba(0, 0, 0, 0.5)",textStrokeSize:.025,fontFamily:iu(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,wrapWords:!1,freezeDimensions:!0});this.fps=null;this.drawCalls=null;this.triangles=null;let e=this.update.bind(this);setInterval(e,500),e()}setStats(e,r,o){this.fps=e,this.drawCalls=r,this.triangles=o}update(){let r=new Date().toLocaleTimeString();this.fps!==null&&(r+=` ${Math.round(this.fps).toFixed(0)}hz ${this.drawCalls}c ${this.triangles}t`),(B(this.value)||r.length!==this.value.length)&&this.unfreeze(),this.value=r}};var sm="local-user";function am(n){return!n.started||n.finished}var vp=class extends ft{constructor(){super(!1);this.time=0;this.duration=0;this.onTick=null}begin(e,r,o){this.reset(),this.start(),this.time=-e,this.duration=r,this.onTick=o,this.onTick(0)}update(e){am(this)||(this.time+=e/this.duration,this.time>=1?(this.onTick(1),this.resolve()):this.time>=0&&this.onTick(this.time))}},js=class{constructor(){this.animations=new Array}update(t){t=.001*t;for(let e of this.animations)e.update(t)}clear(){for(let t of this.animations)t.resolve()}start(t,e,r){let o=wt(this.animations,am);return o||this.animations.push(o=new vp),o.begin(t,e,r),o}};function lm(n,t){let e=n*Math.PI;return .5*(1-Math.cos(e))-t*Math.sin(2*e)}function pm(n,t){let e=(n-.5)*Math.PI;return n*n+t*Math.cos(e)}Ot(Q(".dialog, .dialog-container",qr("fixed")),Q(".dialog",or(0),nr(0),tn("100%"),vt("100%"),ii("rgba(0, 0, 0, 0.5)"),fs(100)),Q(".dialog-container",or("50%"),nr("50%"),rr("100%"),Zd("100%"),ru("translateX(-50%) translateY(-50%)"),ii("white"),Ud("rgba(0,0,0,0.5) 0px 5px 30px"),Fe("grid"),en("2em auto 2em"),hs("auto 1fr auto 2em")),Q(".dialog .title-bar",us(1,1,2,-1),kt("0.25em")),Q(".dialog-content",us(2,2,-4,-2),tu("auto")),Q(".dialog-controls",us(-2,2,-3,-2)),Q(".dialog .confirm-button",Kd("right")),Q(".dialog h1, .dialog h2, .dialog h3, .dialog h4, .dialog h5, .dialog h6",Mn("left")),Q(".dialog select",rr("10em")));var lo=class{constructor(t){this.subEventer=new Y;this.element=ye(ge("dialog"),Fd("dialogname",t),gt(Fe("none")),this.container=ye(ge("dialog-container"),this.titleElement=hu(ge("title-bar"),t),this.contentArea=ye(ge("dialog-content")),ye(ge("dialog-controls"),this.confirmButton=Qr("Confirm",Hr("confirm-button")),this.cancelButton=_s("Cancel",Hr("cancel-button"))))),this.confirmButton.addEventListener("click",()=>this.subEventer.dispatchEvent(new W("confirm"))),this.cancelButton.addEventListener("click",()=>this.subEventer.dispatchEvent(new W("cancel"))),fe(document.body,this)}get title(){return this._title}set title(t){gs(this.titleElement,this._title=t)}async onShowing(){}onShown(){}async onConfirm(){}onCancel(){}async onClosing(){}onClosed(){}show(t){Be(this,t)}get isOpen(){return Bt(this)}async showDialog(){await this.onShowing(),this.show(!0),this.onShown();let t=ke(this.subEventer,"confirm","cancel"),e=await Bl(t);return e?await this.onConfirm():this.onCancel(),await this.onClosing(),this.show(!1),this.onClosed(),e}};var{ACESFilmicToneMapping:bP,AddEquation:yP,AddOperation:wP,AdditiveAnimationBlendMode:EP,AdditiveBlending:TP,AlphaFormat:SP,AlwaysDepth:MP,AlwaysStencilFunc:PP,AmbientLight:cm,AmbientLightProbe:CP,AnimationClip:dm,AnimationLoader:RP,AnimationMixer:IP,AnimationObjectGroup:VP,AnimationUtils:LP,ArcCurve:kP,ArrayCamera:BP,ArrowHelper:OP,Audio:DP,AudioAnalyser:FP,AudioContext:NP,AudioListener:XP,AudioLoader:GP,AxesHelper:HP,BackSide:um,BasicDepthPacking:zP,BasicShadowMap:UP,Bone:mm,BooleanKeyframeTrack:jP,Box2:WP,Box3:pr,Box3Helper:qP,BoxBufferGeometry:hm,BoxGeometry:fm,BoxHelper:QP,BufferAttribute:cr,BufferGeometry:Ws,BufferGeometryLoader:KP,ByteType:YP,Cache:JP,Camera:$P,CameraHelper:ZP,CanvasTexture:xm,CapsuleBufferGeometry:eC,CapsuleGeometry:tC,CatmullRomCurve3:nC,CineonToneMapping:rC,CircleBufferGeometry:oC,CircleGeometry:iC,ClampToEdgeWrapping:gm,Clock:sC,Color:we,ColorKeyframeTrack:aC,ColorManagement:lC,CompressedTexture:pC,CompressedTextureLoader:cC,ConeBufferGeometry:dC,ConeGeometry:uC,CubeCamera:vm,CubeReflectionMapping:mC,CubeRefractionMapping:hC,CubeTexture:Am,CubeTextureLoader:fC,CubeUVReflectionMapping:xC,CubicBezierCurve:gC,CubicBezierCurve3:vC,CubicInterpolant:AC,CullFaceBack:_C,CullFaceFront:bC,CullFaceFrontBack:yC,CullFaceNone:wC,Curve:EC,CurvePath:TC,CustomBlending:SC,CustomToneMapping:MC,CylinderBufferGeometry:PC,CylinderGeometry:_m,Cylindrical:CC,Data3DTexture:RC,DataArrayTexture:IC,DataTexture:VC,DataTexture2DArray:LC,DataTexture3D:kC,DataTextureLoader:BC,DataUtils:OC,DecrementStencilOp:DC,DecrementWrapStencilOp:FC,DefaultLoadingManager:NC,DepthFormat:XC,DepthStencilFormat:GC,DepthTexture:HC,DirectionalLight:qs,DirectionalLightHelper:zC,DiscreteInterpolant:UC,DodecahedronBufferGeometry:jC,DodecahedronGeometry:WC,DoubleSide:bm,DstAlphaFactor:qC,DstColorFactor:QC,DynamicCopyUsage:KC,DynamicDrawUsage:ym,DynamicReadUsage:YC,EdgesGeometry:JC,EllipseCurve:$C,EqualDepth:ZC,EqualStencilFunc:eR,EquirectangularReflectionMapping:tR,EquirectangularRefractionMapping:nR,Euler:wm,EventDispatcher:rR,ExtrudeBufferGeometry:oR,ExtrudeGeometry:iR,FileLoader:Ap,FlatShading:sR,Float16BufferAttribute:aR,Float32BufferAttribute:_p,Float64BufferAttribute:lR,FloatType:pR,Fog:cR,FogExp2:dR,Font:uR,FontLoader:mR,FramebufferTexture:hR,FrontSide:Qs,Frustum:fR,GLBufferAttribute:xR,GLSL1:gR,GLSL3:vR,GreaterDepth:AR,GreaterEqualDepth:_R,GreaterEqualStencilFunc:bR,GreaterStencilFunc:yR,GridHelper:Em,Group:Ks,HalfFloatType:wR,HemisphereLight:ER,HemisphereLightHelper:TR,HemisphereLightProbe:SR,IcosahedronBufferGeometry:MR,IcosahedronGeometry:PR,ImageBitmapLoader:Tm,ImageLoader:CR,ImageUtils:RR,ImmediateRenderObject:IR,IncrementStencilOp:VR,IncrementWrapStencilOp:LR,InstancedBufferAttribute:kR,InstancedBufferGeometry:Sm,InstancedInterleavedBuffer:ui,InstancedMesh:Mm,Int16BufferAttribute:BR,Int32BufferAttribute:OR,Int8BufferAttribute:DR,IntType:FR,InterleavedBuffer:Pm,InterleavedBufferAttribute:Ht,Interpolant:Cm,InterpolateDiscrete:Rm,InterpolateLinear:bp,InterpolateSmooth:NR,InvertStencilOp:XR,KeepStencilOp:GR,KeyframeTrack:HR,LOD:zR,LatheBufferGeometry:UR,LatheGeometry:jR,Layers:WR,LessDepth:qR,LessEqualDepth:QR,LessEqualStencilFunc:KR,LessStencilFunc:YR,Light:JR,LightProbe:$R,Line:Im,Line3:Vm,LineBasicMaterial:yp,LineCurve:ZR,LineCurve3:eI,LineDashedMaterial:tI,LineLoop:Lm,LineSegments:km,LinearEncoding:nI,LinearFilter:wp,LinearInterpolant:rI,LinearMipMapLinearFilter:oI,LinearMipMapNearestFilter:iI,LinearMipmapLinearFilter:Ep,LinearMipmapNearestFilter:Bm,LinearSRGBColorSpace:sI,LinearToneMapping:aI,Loader:Om,LoaderUtils:On,LoadingManager:lI,LoopOnce:pI,LoopPingPong:cI,LoopRepeat:dI,LuminanceAlphaFormat:uI,LuminanceFormat:mI,MOUSE:hI,Material:Ys,MaterialLoader:fI,MathUtils:Js,Matrix3:xI,Matrix4:Oe,MaxEquation:gI,Mesh:Pt,MeshBasicMaterial:Ye,MeshDepthMaterial:vI,MeshDistanceMaterial:AI,MeshLambertMaterial:_I,MeshMatcapMaterial:bI,MeshNormalMaterial:yI,MeshPhongMaterial:Dm,MeshPhysicalMaterial:dr,MeshStandardMaterial:po,MeshToonMaterial:wI,MinEquation:EI,MirroredRepeatWrapping:Fm,MixOperation:TI,MultiplyBlending:SI,MultiplyOperation:MI,NearestFilter:Nm,NearestMipMapLinearFilter:PI,NearestMipMapNearestFilter:CI,NearestMipmapLinearFilter:Xm,NearestMipmapNearestFilter:Gm,NeverDepth:RI,NeverStencilFunc:II,NoBlending:VI,NoColorSpace:LI,NoToneMapping:kI,NormalAnimationBlendMode:BI,NormalBlending:OI,NotEqualDepth:DI,NotEqualStencilFunc:FI,NumberKeyframeTrack:Hm,Object3D:qe,ObjectLoader:NI,ObjectSpaceNormalMap:XI,OctahedronBufferGeometry:GI,OctahedronGeometry:HI,OneFactor:zI,OneMinusDstAlphaFactor:UI,OneMinusDstColorFactor:jI,OneMinusSrcAlphaFactor:WI,OneMinusSrcColorFactor:qI,OrthographicCamera:zm,PCFShadowMap:QI,PCFSoftShadowMap:KI,PMREMGenerator:YI,ParametricGeometry:JI,Path:$I,PerspectiveCamera:mi,Plane:ZI,PlaneBufferGeometry:$s,PlaneGeometry:eV,PlaneHelper:tV,PointLight:Um,PointLightHelper:nV,Points:jm,PointsMaterial:Wm,PolarGridHelper:rV,PolyhedronBufferGeometry:oV,PolyhedronGeometry:iV,PositionalAudio:sV,PropertyBinding:qm,PropertyMixer:aV,QuadraticBezierCurve:lV,QuadraticBezierCurve3:pV,Quaternion:de,QuaternionKeyframeTrack:Tp,QuaternionLinearInterpolant:cV,REVISION:dV,RGBADepthPacking:uV,RGBAFormat:mV,RGBAIntegerFormat:hV,RGBA_ASTC_10x10_Format:fV,RGBA_ASTC_10x5_Format:xV,RGBA_ASTC_10x6_Format:gV,RGBA_ASTC_10x8_Format:vV,RGBA_ASTC_12x10_Format:AV,RGBA_ASTC_12x12_Format:_V,RGBA_ASTC_4x4_Format:bV,RGBA_ASTC_5x4_Format:yV,RGBA_ASTC_5x5_Format:wV,RGBA_ASTC_6x5_Format:EV,RGBA_ASTC_6x6_Format:TV,RGBA_ASTC_8x5_Format:SV,RGBA_ASTC_8x6_Format:MV,RGBA_ASTC_8x8_Format:PV,RGBA_BPTC_Format:CV,RGBA_ETC2_EAC_Format:RV,RGBA_PVRTC_2BPPV1_Format:IV,RGBA_PVRTC_4BPPV1_Format:VV,RGBA_S3TC_DXT1_Format:LV,RGBA_S3TC_DXT3_Format:kV,RGBA_S3TC_DXT5_Format:BV,RGBFormat:OV,RGB_ETC1_Format:DV,RGB_ETC2_Format:FV,RGB_PVRTC_2BPPV1_Format:NV,RGB_PVRTC_4BPPV1_Format:XV,RGB_S3TC_DXT1_Format:GV,RGFormat:HV,RGIntegerFormat:zV,RawShaderMaterial:UV,Ray:jV,Raycaster:Qm,RectAreaLight:WV,RedFormat:qV,RedIntegerFormat:QV,ReinhardToneMapping:KV,RepeatWrapping:Zs,ReplaceStencilOp:YV,ReverseSubtractEquation:JV,RingBufferGeometry:$V,RingGeometry:ZV,SRGBColorSpace:eL,Scene:ea,ShaderChunk:tL,ShaderLib:hi,ShaderMaterial:Km,ShadowMaterial:nL,Shape:rL,ShapeBufferGeometry:oL,ShapeGeometry:iL,ShapePath:sL,ShapeUtils:aL,ShortType:lL,Skeleton:Ym,SkeletonHelper:pL,SkinnedMesh:Jm,SmoothShading:cL,Source:dL,Sphere:co,SphereBufferGeometry:uL,SphereGeometry:ta,Spherical:mL,SphericalHarmonics3:hL,SplineCurve:fL,SpotLight:$m,SpotLightHelper:xL,Sprite:gL,SpriteMaterial:Bv,SrcAlphaFactor:vL,SrcAlphaSaturateFactor:AL,SrcColorFactor:_L,StaticCopyUsage:bL,StaticDrawUsage:yL,StaticReadUsage:wL,StereoCamera:EL,StreamCopyUsage:TL,StreamDrawUsage:SL,StreamReadUsage:ML,StringKeyframeTrack:PL,SubtractEquation:CL,SubtractiveBlending:RL,TOUCH:IL,TangentSpaceNormalMap:Zm,TetrahedronBufferGeometry:VL,TetrahedronGeometry:LL,TextGeometry:kL,Texture:fi,TextureLoader:eh,TorusBufferGeometry:BL,TorusGeometry:OL,TorusKnotBufferGeometry:DL,TorusKnotGeometry:FL,Triangle:NL,TriangleFanDrawMode:Sp,TriangleStripDrawMode:th,TrianglesDrawMode:XL,TubeBufferGeometry:GL,TubeGeometry:HL,UVMapping:zL,Uint16BufferAttribute:UL,Uint32BufferAttribute:jL,Uint8BufferAttribute:WL,Uint8ClampedBufferAttribute:qL,Uniform:QL,UniformsGroup:KL,UniformsLib:xi,UniformsUtils:Mp,UnsignedByteType:YL,UnsignedInt248Type:JL,UnsignedIntType:$L,UnsignedShort4444Type:ZL,UnsignedShort5551Type:e4,UnsignedShortType:t4,VSMShadowMap:n4,Vector2:Ie,Vector3:D,Vector4:zt,VectorKeyframeTrack:nh,VideoTexture:rh,WebGL1Renderer:r4,WebGL3DRenderTarget:o4,WebGLArrayRenderTarget:i4,WebGLCubeRenderTarget:oh,WebGLMultipleRenderTargets:s4,WebGLMultisampleRenderTarget:a4,WebGLRenderTarget:l4,WebGLRenderer:ih,WebGLUtils:p4,WireframeGeometry:sh,WrapAroundEnding:c4,ZeroCurvatureEnding:d4,ZeroFactor:u4,ZeroSlopeEnding:m4,ZeroStencilOp:h4,_SRGBAFormat:f4,sRGBEncoding:na}=THREE;function Dn(n){return v(n)&&n.isMesh}function Pp(n){return v(n)&&n.isMaterial}function Ov(n,t){return Pp(t)&&t.type===n}function ah(n){return Ov("MeshBasicMaterial",n)}function lh(n){return v(n)&&n.isObject3D}function ph(n){return v(n)&&n.isQuaternion}function ch(n){return v(n)&&n.isEuler}function dh(n){return v(n)&&lh(n.object)}function Je(n){return dh(n)?n.object:n}function De(n,t){return n=Je(n),n.visible=t,t}function uo(n){return n=Je(n),n.visible}function ra(n){for(n=Je(n);n;){if(!n.visible)return!1;n=n.parent}return!0}function j(n,...t){let e=t.filter(v).map(Je);return e.length>0&&Je(n).add(...e),n}function ue(n,...t){let e=new qe;return e.name=n,j(e,...t),e}function oa(n,t){n=Je(n),si(n)&&(n.disabled=!t)}function ur(n,t,e){let r=new Pt(t,e);return r.name=n,r}var mr=Tt("Juniper:ScaledItems",()=>new Map),uh=1,Dv=1.1,Fv=.005,Cp=class{constructor(t){this.target=t;this.obj=Je(this.target),this.base=this.obj.scale.clone(),this.p=0,this.dir=0,this.running=!1,this.wasDisabled=this.disabled,this.target.addScopedEventListener(this,"enter",()=>this.run(1)),this.target.addScopedEventListener(this,"exit",()=>this.run(-1)),this.obj.traverse(e=>{Dn(e)&&this.target.addMesh(e)})}get disabled(){return this.target.disabled}run(t){(!this.disabled||t===-1||this.p>0)&&(this.dir=t,this.running=!0)}updateScaling(t){if(this.disabled!==this.wasDisabled&&(this.wasDisabled=this.disabled,this.disabled&&this.run(-1)),this.running){this.p+=this.dir*t,(this.dir>0&&this.p>=1||this.dir<0&&this.p<0)&&(this.p=Math.max(0,Math.min(1,this.p)),this.running=!1);let e=lm(this.p,1.1);this.obj.scale.copy(this.base).multiplyScalar(e*(Dv-uh)+uh)}}dispose(){this.target.removeScope(this)}};function mh(n){n*=Fv;for(let t of mr.values())t.updateScaling(n)}function hh(n){let t=mr.get(n);t&&(mr.delete(n),t.dispose())}function ia(n,t){let e=mr.has(n);t!=e&&(t?mr.set(n,new Cp(n)):(mr.get(n).dispose(),mr.delete(n)))}function sn(n){let t=new Array,e=new Set;for(t.push(n);t.length>0;){let r=t.shift();r&&!e.has(r)&&(e.add(r),r.isMesh&&t.push(r.material,r.geometry),r.isMaterial&&t.push(...Object.values(r)),r.isObject3D&&(t.push(...r.children),r.clear(),hh(r)),tt(r)&&t.push(...r),ql(r))}e.clear()}xi.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Ie(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};hi.line={uniforms:Mp.merge([xi.common,xi.fog,xi.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var an=class extends Km{constructor(t){super({type:"LineMaterial",uniforms:Mp.clone(hi.line.uniforms),vertexShader:hi.line.vertexShader,fragmentShader:hi.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(t)}};an.prototype.isLineMaterial=!0;var Rp=Tt("Juniper:Three:Materials",()=>new Map);function Nv(n,t){t in n&&delete n[t]}function sa(n,t,e){let r=`${n}_${Object.keys(e).map(o=>`${o}:${e[o]}`).join(",")}`;return Rp.has(r)||(Nv(e,"name"),Rp.set(r,new t(e))),Rp.get(r)}function Xv(n){return Object.assign(n,{transparent:!0})}function fh(n){return sa("solid",Ye,n)}function mo(n){return sa("solidTransparent",Ye,Xv(n))}function xh(n){return sa("lit",Dm,n)}function gh(n){return sa("line2",an,n)}function vh(n,t){let e=new Set;n.traverse(r=>{if(Dn(r)&&Pp(r.material)){let o=r.material,i=t(o);o!==i&&(e.add(o),r.material=i)}});for(let r of e)r.dispose()}function Ah(n){if(n.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let t={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,dithering:n.dithering,envMap:n.envMap,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.emissiveMap||n.map,name:n.name+"-Standard-To-Basic",opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,shadowSide:n.shadowSide,side:n.side,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[e,r]of Object.entries(t))B(r)&&delete t[e];return new Ye(t)}var Gv=12632256,Ip=16777215;var _h=xh({color:Gv}),bh=xh({color:Ip});var Hv=new Oe,aa=new D;function Vp(n,t,e,r,o){Hv.copy(n.matrixWorld).invert().multiply(t.matrixWorld).decompose(aa,r,o),e.set(aa.x,aa.y,aa.z,1)}var Lp=new $s(1,1,1,1);Lp.name="PlaneGeom";var la=new zt,pa=new de,ho=new D,zv=0,fo=class extends qe{constructor(e,r,o,i=null){super();this.webXRLayerType=o;this.lastMatrixWorld=new Oe;this.layer=null;this.wasUsingLayer=!1;this._imageWidth=0;this._imageHeight=0;this.curImage=null;this.lastImage=null;this.lastWidth=null;this.lastHeight=null;this.env=null;this.mesh=null;this.stereoLayoutName="mono";this.sizeMode="none";if(this.onTick=s=>this.checkWebXRLayer(s.frame),e){this.setEnvAndName(e,r);let s=ah(i)?i:mo(Object.assign({},i,{name:this.name}));j(this,this.mesh=ur(r+"-Mesh",Lp,s))}}copy(e,r=!0){return super.copy(e,r),this.webXRLayerType=e.webXRLayerType,this.setImageSize(e.imageWidth,e.imageHeight),this.setEnvAndName(e.env,e.name+ ++zv),this.mesh=wt(this.children,Dn),B(this.mesh)&&(this.mesh=e.mesh.clone(),j(this,this.mesh)),this.setTextureMap(e.curImage),this}dispose(){this.env.timer.removeTickHandler(this.onTick),this.disposeImage(),sn(this.mesh)}disposeImage(){this.removeWebXRLayer(),sn(this.mesh.material.map),this.curImage=null}setImageSize(e,r){if(e!==this.imageWidth||r!==this.imageHeight){let{objectWidth:o,objectHeight:i}=this;this._imageWidth=e,this._imageHeight=r,this.sizeMode!=="none"&&(this.sizeMode==="fixed-width"?this.objectWidth=o:this.objectHeight=i)}}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get imageAspectRatio(){return this.imageWidth/this.imageHeight}get objectWidth(){return this.scale.x}set objectWidth(e){this.scale.set(e,this.scale.y=e/this.imageAspectRatio,1)}get objectHeight(){return this.scale.y}set objectHeight(e){this.scale.set(this.imageAspectRatio*e,e,1)}get pixelDensity(){let e=Dd(this.objectWidth);return this.imageWidth/e}set pixelDensity(e){let r=this.imageWidth/e,o=Od(r);this.objectWidth=o}setEnvAndName(e,r){this.env=e,this.name=r,this.env.timer.addTickHandler(this.onTick)}get needsLayer(){return!ra(this)||B(this.mesh.material.map)||B(this.curImage)?!1:this.curImage instanceof HTMLVideoElement?!this.curImage.paused||this.curImage.currentTime>0:!0}removeWebXRLayer(){if(v(this.layer)){this.wasUsingLayer=!1,this.env.removeWebXRLayer(this.layer),this.mesh.visible=!0;let e=this.layer;this.layer=null,setTimeout(()=>e.destroy(),100)}}setTextureMap(e){this.curImage&&this.disposeImage(),e&&(qu(e)?e=Ju(e):Qu(e)&&(e=$u(e)),Wu(e)&&(e=e),this.curImage=e,e instanceof HTMLVideoElement?(this.setImageSize(e.videoWidth,e.videoHeight),this.mesh.material.map=new rh(e)):(this.setImageSize(e.width,e.height),this.mesh.material.map=new fi(e),this.mesh.material.map.needsUpdate=!0)),this.mesh.material.needsUpdate=!0}get isVideo(){return this.curImage instanceof HTMLVideoElement}updateTexture(){if(v(this.curImage)){let e=this.curImage,r=this.isVideo?e.videoWidth:this.curImage.width,o=this.isVideo?e.videoHeight:this.curImage.height;if(this.imageWidth!==r||this.imageHeight!==o){let i=this.curImage;this.disposeImage(),this.setTextureMap(i)}}}checkWebXRLayer(e){if(this.mesh.material.map&&this.curImage){let o=this.webXRLayerType!=="none"&&this.env.hasXRCompositionLayers&&this.env.showWebXRLayers&&v(e)&&(this.isVideo&&v(this.env.xrMediaBinding)||!this.isVideo&&v(this.env.xrBinding))&&this.needsLayer,i=o!==this.wasUsingLayer,s=this.curImage!==this.lastImage||this.mesh.material.needsUpdate||this.mesh.material.map.needsUpdate,p=this.imageWidth!==this.lastWidth||this.imageHeight!==this.lastHeight;if(this.wasUsingLayer=o,this.lastImage=this.curImage,this.lastWidth=this.imageWidth,this.lastHeight=this.imageHeight,(i||p)&&((!o||p)&&this.layer&&this.removeWebXRLayer(),o)){let c=this.env.referenceSpace;Vp(this.env.stage,this.mesh,la,pa,ho),this.lastMatrixWorld.copy(this.matrixWorld);let u=new XRRigidTransform(la,pa),h=ho.x/2,x=ho.y/2,b=this.stereoLayoutName==="mono"?"mono":this.stereoLayoutName==="left-right"||this.stereoLayoutName==="right-left"?"stereo-left-right":"stereo-top-bottom";if(this.isVideo){let w=this.stereoLayoutName==="right-left"||this.stereoLayoutName==="bottom-top";this.layer=this.env.xrMediaBinding.createQuadLayer(this.curImage,{space:c,layout:b,invertStereo:w,transform:u,width:h,height:x})}else this.layer=this.env.xrBinding.createQuadLayer({space:c,layout:b,textureType:"texture",isStatic:this.webXRLayerType==="static",viewPixelWidth:this.curImage.width,viewPixelHeight:this.curImage.height,transform:u,width:h,height:x});this.env.addWebXRLayer(this.layer,500),this.mesh.visible=!1}if(this.layer){if(s||this.layer.needsRedraw){let c=this.env.gl,u=this.env.xrBinding.getSubImage(this.layer,e);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!0),c.bindTexture(c.TEXTURE_2D,u.colorTexture),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.curImage),c.generateMipmap(c.TEXTURE_2D),c.bindTexture(c.TEXTURE_2D,null)}Il(this.matrixWorld.elements,this.lastMatrixWorld.elements)>=0&&(Vp(this.env.stage,this.mesh,la,pa,ho),this.lastMatrixWorld.copy(this.matrixWorld),this.layer.transform=new XRRigidTransform(la,pa),this.layer.width=ho.x/2,this.layer.height=ho.y/2)}}}};var Uv={type:"redrawn"},hr=class extends fo{constructor(e,r,o,i,s){super(e,r,o,s);this._image=null;this.image=i}get object(){return this}get element(){return rn(this.image.canvas)?this.image.canvas:null}onRedrawn(){this.updateTexture(),this.dispatchEvent(Uv)}get image(){return this._image}set image(e){this.image&&this.image.removeScope(this),this._image=e,this.image&&(this.image.addScopedEventListener(this,"redrawn",()=>this.onRedrawn()),this.setTextureMap(this.image.canvas),this.onRedrawn())}get imageWidth(){return this.image.width}get imageHeight(){return this.image.height}copy(e,r=!0){return super.copy(e,r),this.image=e.image,this}get isVisible(){return Bt(this)}set isVisible(e){Be(this,e,"inline-block"),De(this,e),De(this.mesh,e),this.image.visible=e}};var xo=class extends hr{constructor(t,e,r,o){let i;r instanceof on?i=r:i=new on(r),super(t,e,"none",i,o)}onRedrawn(){this.objectHeight=this.imageHeight,super.onRedrawn()}};var kp="Juniper:ThreeJS:EventSystem:RayTarget",fr=class extends Y{constructor(e){super();this.object=e;this.meshes=new Array;this._disabled=!1;this._clickable=!1;this._draggable=!1;this._navigable=!1;this.object.userData[kp]=this}addMesh(e){return e.userData[kp]=this,this.meshes.push(e),this}get disabled(){return this._disabled}set disabled(e){this._disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get clickable(){return this._clickable}set clickable(e){this._clickable=e}get draggable(){return this._draggable}set draggable(e){this._draggable=e}get navigable(){return this._navigable}set navigable(e){this._navigable=e}};function jv(n){return n instanceof fr}function go(n){let t=null;return n&&(jv(n)?t=n:(n=Je(n),n&&(t=n.userData[kp])),t&&!ra(t)&&(t=null)),t}var gi=class extends fr{constructor(e,r,o,i){super(ue(r));this.env=e;if(v(o)){i=Object.assign({textFillColor:"#ffffff",fontFamily:"Segoe UI Emoji",fontSize:20,minHeight:.25,maxHeight:.25},i,{value:o}),this.image=new on(i);let s=St(16);this.enabledImage=this.createImage(`${s}-enabled`,1),this.disabledImage=this.createImage(`${s}-disabled`,.5),this.disabledImage.visible=!1,j(this,this.enabledImage,this.disabledImage)}this.addMesh(this.enabledImage.mesh),this.addMesh(this.disabledImage.mesh),this.clickable=!0,v(o)&&ia(this,!0)}createImage(e,r){return new xo(this.env,`text-${e}`,this.image,{side:Qs,opacity:r})}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.enabledImage.visible=!e,this.disabledImage.visible=e}};var yh={bgStrokeColor:"#000000",bgStrokeSize:.04,wrapWords:!1,textFillColor:"#ffffff",scale:150},wh=Object.assign({},yh,{padding:{left:.1,right:.1,top:.025,bottom:.025},fontSize:20,minHeight:.5,maxHeight:.5}),Wv=Object.assign({},wh,{bgFillColor:"#0078d7"}),qv=Object.assign({},wh,{bgFillColor:"#780000"}),Qv=Object.assign({},yh,{bgFillColor:"#ffffff",textFillColor:"#000000",padding:{top:.1,left:.1,bottom:.4,right:.1},fontSize:25,minHeight:1,maxHeight:1}),Kv=.9;function Bp(n,t){return Object.assign({},n,{fontFamily:t})}var ca=class extends lo{constructor(e,r){super("Confirm action");this.env=e;this.object=ue("ConfirmationDialog");this.root=ue("Root");this.animator=new js;this.a=0;this.b=0;this.confirmButton.innerText="Yes",this.cancelButton.innerText="No",this.mesh=new xo(this.env,"confirmationDialogLabel",Bp(Qv,r)),this.confirmButton3D=new gi(this.env,"confirmationDialogConfirmButton","Yes",Bp(Wv,r)),this.confirmButton3D.addEventListener("click",()=>this.confirmButton.click()),this.confirmButton3D.object.position.set(1,-.5,.5),this.cancelButton3D=new gi(this.env,"confirmationDialogCancelButton","No",Bp(qv,r)),this.cancelButton3D.addEventListener("click",()=>this.cancelButton.click()),this.cancelButton3D.object.position.set(2,-.5,.5),fe(this.container,gt(rr("calc(100% - 2em)"),tn("max-content"))),fe(this.contentArea,gt(ds("18pt"),Mn("center"),kt("1em"))),j(this,j(this.root,this.mesh,this.confirmButton3D,this.cancelButton3D)),De(this.root,!1),this.root.scale.setScalar(0),this.onTick=o=>{let i=pm(this.a+this.b*o,Kv);this.root.scale.set(i,i,.01)}}get name(){return this.object.name}get visible(){return Bt(this)}set visible(e){Be(this,e,"inline-block"),this.mesh.visible=e}update(e){this.animator.update(e)}async showHide(e,r){this.a=e,this.b=r,await this.animator.start(0,.25,this.onTick),this.animator.clear()}get use3D(){return this.env.renderer.xr.isPresenting||this.env.testSpaceLayout}async onShowing(){await super.onShowing(),this.use3D&&(this.root.visible=!0,await this.showHide(0,1))}onShown(){this.use3D&&(this.element.style.display="none")}async onClosing(){this.use3D&&(await this.showHide(1,-1),this.root.visible=!1),await super.onClosing()}prompt(e,r){return this.title=e,gs(this.contentArea,r),this.mesh.image.value=r,this.showDialog()}};function Eh(n,t){return n==="click"&&t&&(n="error"),`InteractionAudio-${n}`}var da=class{constructor(t,e){this.audio=t;this.eventSys=e;let r=o=>{if(o.rayTarget&&o.rayTarget.clickable){let i=Eh(o.type,!o.rayTarget.enabled);if(this.audio.hasClip(i)){let{x:s,y:p,z:c}=o.point;this.audio.setClipPosition(i,s,p,c),this.audio.playClip(i)}}};this.eventSys.addEventListener("enter",r),this.eventSys.addEventListener("exit",r),this.eventSys.addEventListener("click",r)}create(t,e,r){return this.audio.createClip(Eh(t,!1),e,!1,!0,!1,r,[])}};var vi=(o=>(o.None="None",o.Fullscreen="Fullscreen",o.VR="VR",o.AR="AR",o))(vi||{});Ot(Q("#controls",qr("absolute"),nr(0),or(0),tn("100%"),vt("100%")),Q("#controls",Fe("grid"),ds("20pt"),hs("auto 1fr auto"),fs(1)),Q("#controls, #controls *",ep("none")),Q("#controls canvas",vt("58px")),Q("#controls > .row",Fe("grid"),Sn("10px","5px"),en("repeat(2, auto)")),Q("#controls > .row.top",ms(1)),Q("#controls > .row.middle",ms(2,-2)),Q("#controls > .row.bottom",ms(-2)),Q("#controls > .row > .cell",Fe("flex")),Q("#controls > .row > .cell.left",tr(1)),Q("#controls > .row > .cell.right",tr(-2),Qd("row-reverse")),Q("#controls > .row > .cell > .btn",zd(0),ii("#1e4388"),vt("58px !important"),tn("58px"),kt("0.25em"),Sn("0","5px"),ep("initial")),Q("#controls .btn img",vt("calc(100% - 0.5em)")),Q("#controls button:disabled img",qd("invert(.5)")));var ua=class{constructor(){this.element=ye(cs("controls"),ye(ge("row top"),this.topRowLeft=ye(ge("cell left")),this.topRowRight=ye(ge("cell right"))),ye(ge("row middle"),this.middleRowLeft=ye(ge("cell left")),this.middleRowRight=ye(ge("cell right"))),ye(ge("row bottom"),this.bottomRowLeft=ye(ge("cell left")),this.bottomRowRight=ye(ge("cell right")))),this.cells=[[this.topRowLeft,this.topRowRight],[this.middleRowLeft,this.middleRowRight],[this.bottomRowLeft,this.bottomRowRight]]}};function Th(n){return"height"in n}function Sh(n){return"width"in n}var Op=1.25,Mh=Ke(30),Yv=Ke(32),Jv=new D(0,0,0),ma=class extends qe{constructor(){super(),this.name="SpaceUI",this.position.y=-.25}addItem(t,e){t=Je(t),j(this,t),t.position.set(Op*Math.sin(e.x*Mh),Op*Math.sin(e.y*Yv),-Op*Math.cos(e.x*Mh)),Th(e)&&Sh(e)?t.scale.set(e.width,e.height,1):Th(e)?t.scale.multiplyScalar(e.height/t.scale.y):Sh(e)?t.scale.multiplyScalar(e.width/t.scale.x):t.scale.setScalar(e.scale),t.scale.z=1;for(let r of this.children)r.lookAt(Jv)}};function Ph(n){return ne(n.vcodec)}var ha=class extends Nt{constructor(e){super("JuniperVideoPlayer",e,je.instance(e));this.onTimeUpdate=null;this.wasUsingAudioElement=!1;this.nextStartTime=null;this._data=null;this._loaded=!1;this.onError=new Map;this.sourcesByURL=new Map;this.sources=new _n;this.potatoes=new _n;this.video=this.createMediaElement(vu,er(!0)),this.audio=this.createMediaElement(sr,er(!1)),this.input=Ne("JuniperVideoPlayer-combiner",e),this.videoSource=ar("JuniperVideoPlayer-VideoNode",e,this.video,this.input),this.audioSource=ar("JuniperVideoPlayer-AudioNode",e,this.audio,this.input),this.loadingEvt=new no(this),this.loadEvt=new Cn(this),this.playEvt=new Rn(this),this.pauseEvt=new In(this),this.stopEvt=new Vn(this),this.progEvt=new Ln(this),this.onSeeked=()=>{this.useAudioElement&&(this.audio.currentTime=this.video.currentTime)},this.onPlay=async()=>{this.connect(),this.onSeeked(),this.useAudioElement&&(await Ft(this.audioCtx),await this.audio.play()),this.dispatchEvent(this.playEvt)},this.onPause=o=>{this.disconnect(),this.useAudioElement&&(this.onSeeked(),this.audio.pause()),this.video.currentTime===0||o.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};let r=!1;this.onWaiting=()=>{this.useAudioElement&&(r=!0,this.audio.pause())},this.onCanPlay=async()=>{this.useAudioElement&&r&&(await Ft(this.audioCtx),await this.audio.play(),r=!1)},this.wasUsingAudioElement=!1,this.onTimeUpdate=async()=>{if(this.video.getVideoPlaybackQuality().totalVideoFrames===0){let i=this.onError.get(this.video);v(i)&&await i()}else if(this.useAudioElement){this.wasUsingAudioElement=!1;let i=this.video.currentTime-this.audio.currentTime;Math.abs(i)>.25&&(this.audio.currentTime=this.video.currentTime)}else this.wasUsingAudioElement||(this.wasUsingAudioElement=!0,this.audio.pause());this.progEvt.value=this.video.currentTime,this.progEvt.total=this.video.duration,this.dispatchEvent(this.progEvt)},this.video.addEventListener("seeked",this.onSeeked),this.video.addEventListener("play",this.onPlay),this.video.addEventListener("pause",this.onPause),this.video.addEventListener("ended",this.onPause),this.video.addEventListener("waiting",this.onWaiting),this.video.addEventListener("canplay",this.onCanPlay),this.video.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{videoPlayer:this})}get data(){return this._data}get loaded(){return this._loaded}get title(){return this.video.title}setTitle(e){this.video.title=e,this.audio.title=e}elementHasAudio(e){let r=this.sourcesByURL.get(e.src);return v(r)&&r.acodec!=="none"||v(e.audioTracks)&&e.audioTracks.length>0||v(e.webkitAudioDecodedByteCount)&&e.webkitAudioDecodedByteCount>0||v(e.mozHasAudio)&&e.mozHasAudio}get useAudioElement(){return!this.elementHasAudio(this.video)&&this.elementHasAudio(this.audio)}onDisposing(){super.onDisposing(),this.clear(),re(this.input),re(this.videoSource),re(this.audioSource),this.video.removeEventListener("seeked",this.onSeeked),this.video.removeEventListener("play",this.onPlay),this.video.removeEventListener("pause",this.onPause),this.video.removeEventListener("ended",this.onPause),this.video.removeEventListener("waiting",this.onWaiting),this.video.removeEventListener("canplay",this.onCanPlay),this.video.removeEventListener("timeupdate",this.onTimeUpdate)}clear(){this.stop();for(let[e,r]of this.onError)e.removeEventListener("error",r);this.onError.clear(),this.sourcesByURL.clear(),this.sources.clear(),this.potatoes.clear(),this.video.src="",this.audio.src="",this.wasUsingAudioElement=!1,this._data=null,this._loaded=!1}async load(e,r){if(this.clear(),this._data=e,ne(e)?(this.setTitle(e),this.potatoes.add(this.video,e)):(this.setTitle(e.title),this.fillSources(this.video,e.videos),this.fillSources(this.audio,e.audios)),!this.hasSources(this.video))throw new Error("No video sources found");if(this.dispatchEvent(this.loadingEvt),await Cd(r,o=>this.loadMediaElement(this.audio,o),o=>this.loadMediaElement(this.video,o)),ne(e)?this.nextStartTime=null:this.nextStartTime=e.startTime,!this.hasSources(this.video))throw new Error("No video playable sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}fillSources(e,r){Jn(r,o=>-o.resolution);for(let o of r)om.matches(o.contentType)||(this.sources.add(e,o),this.sourcesByURL.set(o.url,o))}createMediaElement(e,...r){return e(Tn(!0),En(!1),zr(!1),...r)}async getMediaCapabilities(e){let r={type:"file"};Ph(e)?r.video={contentType:e.contentType,bitrate:e.vbr*1024,framerate:e.fps,width:e.width,height:e.height}:e.acodec!=="none"&&(r.audio={contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr});try{return await navigator.mediaCapabilities.decodingInfo(r)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:r}}}hasSources(e){return this.sources.get(e).length>0||this.potatoes.count(e)>0}async loadMediaElement(e,r){for(v(r)&&r.start(),this.onError.has(e)&&(e.removeEventListener("error",this.onError.get(e)),this.onError.delete(e));this.hasSources(e);){let o=null,i=this.sources.get(e).shift();if(v(i)){let s=await this.getMediaCapabilities(i);if(!s.smooth||!s.powerEfficient){this.potatoes.add(e,i.url);continue}else o=i.url}else o=this.potatoes.get(e).shift();if(e.src=o,e.load(),await As(e)){v(i)?this.sources.get(e).unshift(i):this.potatoes.get(e).unshift(o);let s=()=>this.loadMediaElement(e,r);e.addEventListener("error",s),this.onError.set(e,s),this.wasUsingAudioElement=this.wasUsingAudioElement,v(r)&&r.end();return}}}get width(){return this.video.videoWidth}get height(){return this.video.videoHeight}get playbackState(){return B(this.data)?"empty":this.loaded?this.video.error?"errored":this.video.ended||this.video.paused&&this.video.currentTime===0?"stopped":this.video.paused?"paused":"playing":"loading"}async play(){await Ft(this.audioCtx),v(this.nextStartTime)&&this.nextStartTime>0&&(this.video.pause(),this.video.currentTime=this.nextStartTime,this.nextStartTime=null),await this.video.play()}async playThrough(){let e=ke(this,"stopped");await this.play(),await e}pause(){this.video.pause()}stop(){this.pause(),this.video.currentTime=0}restart(){return this.stop(),this.play()}};function $v(n){return[Rh([n[1],n[0],n[2]]),Rh([n[2],n[0],n[3]])]}function Vh(n){return n.map($v).flat()}var Dp=new D,Ch=new D,fa=new D;function Rh(n){let t=[[n[0][0],n[0][1],n[0][2]],[n[1][0],n[1][1],n[1][2]],[n[2][0],n[2][1],n[2][2]]],e=[[n[0][3],n[0][4]],[n[1][3],n[1][4]],[n[2][3],n[2][4]]];fa.fromArray(t[0]),Dp.fromArray(t[1]).sub(fa),fa.fromArray(t[2]),Ch.fromArray(t[1]).sub(fa),Dp.cross(Ch);let r=Dp.toArray();return{positions:t,uvs:e,normal:r}}function Lh(n){let t=n.map(i=>i.positions).flat(2),e=n.map(i=>i.uvs).flat(2),r=n.flatMap(i=>i.normal),o=new Ws;return o.setAttribute("position",new cr(new Float32Array(t),3,!1)),o.setAttribute("uv",new cr(new Float32Array(e),2,!1)),o.setAttribute("normal",new cr(new Float32Array(r),3,!0)),o}function Ct(...n){let t=Vh(n);return Lh(t)}function vo(n,...t){let e=Zv(t);for(let o=0;o<n;++o)e=tA(e);t=eA(e);let r=Vh(t);return Lh(r)}function Zv(n){return n.map(t=>{let e=Number.MAX_VALUE,r=Number.MIN_VALUE,o=Number.MAX_VALUE,i=Number.MIN_VALUE;for(let c of t){let u=c[3],h=c[4];e=Math.min(e,u),r=Math.max(r,u),o=Math.min(o,h),i=Math.max(i,h)}let s=[e,o],p=[r-e,i-o];return{minUV:s,deltaUV:p,verts:[xa(s,p,t[0]),xa(s,p,t[1]),xa(s,p,t[2]),xa(s,p,t[3])]}})}function xa(n,t,e){return{pos:[e[0],e[1],e[2]],uv:[e[3],e[4]],pUV:[(e[3]-n[0])/t[0],(e[4]-n[1])/t[1]]}}function eA(n){return n.map(t=>[ga(t,0),ga(t,1),ga(t,2),ga(t,3)])}function ga(n,t){let e=n.verts[t];return[e.pos[0],e.pos[1],e.pos[2],e.uv[0],e.uv[1]]}function tA(n){return n.flatMap(t=>{let e=Ai(t,t.verts[0],t.verts[1]),r=Ai(t,t.verts[2],t.verts[3]),o=Ai(t,t.verts[0],t.verts[3]),i=Ai(t,t.verts[1],t.verts[2]),s=Ai(t,e,r);return[{minUV:t.minUV,deltaUV:t.deltaUV,verts:[t.verts[0],e,s,o]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[e,t.verts[1],i,s]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[s,i,t.verts[2],r]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[o,s,r,t.verts[3]]}]})}function Ai(n,t,e){let r=e.pos[0]-t.pos[0],o=e.pos[1]-t.pos[1],i=e.pos[2]-t.pos[2],s=t.pos[0]+.5*r,p=t.pos[1]+.5*o,c=t.pos[2]+.5*i,u=e.pUV[0]-t.pUV[0],h=e.pUV[1]-t.pUV[1],x=t.pUV[0]+.5*u,b=t.pUV[1]+.5*h,w=Ih(x-.5)+.5,R=Ih(b-.5)+.5,C=w*n.deltaUV[0]+n.minUV[0],M=R*n.deltaUV[1]+n.minUV[1];return{pos:[s,p,c],pUV:[x,b],uv:[C,M]}}function Ih(n){return 2*Math.atan(2*n)/Math.PI}var Aa=class extends ha{constructor(e,r){super(r);this.material=mo({name:"videoPlayer-material"}),this.vidMeshes=[];for(let o=0;o<2;++o){let i=new fo(e,`videoPlayer-view${o+1}`,"none",this.material);i.setTextureMap(this.video),i.mesh.renderOrder=4,o>0?i.mesh.layers.disable(0):i.mesh.layers.enable(0),this.vidMeshes.push(i)}this.object=ue("videoPlayer",...this.vidMeshes)}onDisposing(){super.onDisposing(),sn(this.object),pe(this.vidMeshes)}isSupported(e,r){return r.split("-").map(o=>kh.has(e,o)).reduce(cd,!0)}setStereoParameters(e,r){if(!this.isSupported(e,r))throw new Error(`Not supported [encoding: ${e}, layout: ${r}]`);for(let s=0;s<this.vidMeshes.length;++s){let p=this.vidMeshes[s];p.webXRLayerType="none",p.mesh.layers.disable(1),p.mesh.layers.disable(2),r==="left-right"||r==="top-bottom"?p.mesh.layers.enable(this.vidMeshes.length-s):r!=="mono"&&p.mesh.layers.enable(s+1)}let o=this.height/this.width;e!=="N/A"?this.vidMeshes[0].scale.setScalar(100):r==="mono"?this.vidMeshes[0].scale.set(1,o,1):r==="left-right"||r==="right-left"?this.vidMeshes[0].scale.set(1,2*o,1):this.vidMeshes[0].scale.set(1,.5*o,1);for(let s=1;s<this.vidMeshes.length;++s)this.vidMeshes[s].scale.copy(this.vidMeshes[0].scale);let i=r.split("-");for(let s=0;s<i.length;++s){let p=i[s],c=kh.get(e,p),u=this.vidMeshes[s];u.webXRLayerType="dynamic",u.visible=!0,u.mesh.geometry!==c&&(u.mesh.geometry.dispose(),u.mesh.geometry=c)}}},nA=Ct([[-1/2,1/2,0,0,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,0,0]]),Bh=[[-1/2,1/2,0,0,1],[1/2,1/2,0,.5,1],[1/2,-1/2,0,.5,0],[-1/2,-1/2,0,0,0]],Oh=[[-1/2,1/2,0,.5,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,.5,0]],Dh=[[[-1/2,1/2,-1/2,1/3,1],[1/2,1/2,-1/2,2/3,1],[1/2,-1/2,-1/2,2/3,1/2],[-1/2,-1/2,-1/2,1/3,1/2]],[[1/2,1/2,-1/2,2/3,1],[1/2,1/2,1/2,1,1],[1/2,-1/2,1/2,1,1/2],[1/2,-1/2,-1/2,2/3,1/2]],[[-1/2,1/2,1/2,0,1],[-1/2,1/2,-1/2,1/3,1],[-1/2,-1/2,-1/2,1/3,1/2],[-1/2,-1/2,1/2,0,1/2]],[[1/2,1/2,1/2,2/3,1/2],[-1/2,1/2,1/2,2/3,0],[-1/2,-1/2,1/2,1/3,0],[1/2,-1/2,1/2,1/3,1/2]],[[1/2,1/2,-1/2,1,1/2],[-1/2,1/2,-1/2,1,0],[-1/2,1/2,1/2,2/3,0],[1/2,1/2,1/2,2/3,1/2]],[[1/2,-1/2,1/2,1/3,1/2],[-1/2,-1/2,1/2,1/3,0],[-1/2,-1/2,-1/2,0,0],[1/2,-1/2,-1/2,0,1/2]]],Fp=[[[-1/2,1/2,-1/2,0,1/3],[1/2,1/2,-1/2,0,2/3],[1/2,-1/2,-1/2,1/4,2/3],[-1/2,-1/2,-1/2,1/4,1/3]],[[1/2,1/2,-1/2,0,2/3],[1/2,1/2,1/2,0,1],[1/2,-1/2,1/2,1/4,1],[1/2,-1/2,-1/2,1/4,2/3]],[[-1/2,1/2,1/2,0,0],[-1/2,1/2,-1/2,0,1/3],[-1/2,-1/2,-1/2,1/4,1/3],[-1/2,-1/2,1/2,1/4,0]],[[1/2,1/2,1/2,1/4,2/3],[-1/2,1/2,1/2,1/2,2/3],[-1/2,-1/2,1/2,1/2,1/3],[1/2,-1/2,1/2,1/4,1/3]],[[1/2,1/2,-1/2,1/4,1],[-1/2,1/2,-1/2,1/2,1],[-1/2,1/2,1/2,1/2,2/3],[1/2,1/2,1/2,1/4,2/3]],[[1/2,-1/2,1/2,1/4,1/3],[-1/2,-1/2,1/2,1/2,1/3],[-1/2,-1/2,-1/2,1/2,0],[1/2,-1/2,-1/2,1/4,0]]],Np=[[[-1/2,1/2,-1/2,1/2,1/3],[1/2,1/2,-1/2,1/2,2/3],[1/2,-1/2,-1/2,3/4,2/3],[-1/2,-1/2,-1/2,3/4,1/3]],[[1/2,1/2,-1/2,1/2,2/3],[1/2,1/2,1/2,1/2,1],[1/2,-1/2,1/2,3/4,1],[1/2,-1/2,-1/2,3/4,2/3]],[[-1/2,1/2,1/2,1/2,0],[-1/2,1/2,-1/2,1/2,1/3],[-1/2,-1/2,-1/2,3/4,1/3],[-1/2,-1/2,1/2,3/4,0]],[[1/2,1/2,1/2,3/4,2/3],[-1/2,1/2,1/2,1,2/3],[-1/2,-1/2,1/2,1,1/3],[1/2,-1/2,1/2,3/4,1/3]],[[1/2,1/2,-1/2,3/4,1],[-1/2,1/2,-1/2,1,1],[-1/2,1/2,1/2,1,2/3],[1/2,1/2,1/2,3/4,2/3]],[[1/2,-1/2,1/2,3/4,1/3],[-1/2,-1/2,1/2,1,1/3],[-1/2,-1/2,-1/2,1,0],[1/2,-1/2,-1/2,3/4,0]]],rA=Ct(Bh),oA=Ct(Oh),iA=Ct(Xp(Bh)),sA=Ct(Xp(Oh)),Fh=Xh(Fp),Nh=Xh(Np),aA=Ct(...Dh),lA=Ct(...Fp),pA=Ct(...Np),cA=Ct(...Fh),dA=Ct(...Nh),_i=4,uA=vo(_i,...Dh),mA=vo(_i,...Fp),hA=vo(_i,...Np),fA=vo(_i,...Fh),xA=vo(_i,...Nh),kh=new Et([["N/A","mono",nA],["N/A","left",rA],["N/A","right",oA],["N/A","top",iA],["N/A","bottom",sA],["Cubemap Strips","mono",aA],["Cubemap Strips","left",lA],["Cubemap Strips","right",pA],["Cubemap Strips","top",cA],["Cubemap Strips","bottom",dA],["Equi-Angular Cubemap (YouTube)","mono",uA],["Equi-Angular Cubemap (YouTube)","left",mA],["Equi-Angular Cubemap (YouTube)","right",hA],["Equi-Angular Cubemap (YouTube)","top",fA],["Equi-Angular Cubemap (YouTube)","bottom",xA]]);function va(n){return[n[0],n[1],n[2],n[4],1-n[3]]}function Xp(n){return[va(n[0]),va(n[1]),va(n[2]),va(n[3])]}function Xh(n){return n.map(Xp)}var _a=class{constructor(t,e,r){this.imagePaths=t;this.padding=e;this.uvDescrips=new Et;this.geoms=new Et;this.canvas=null;this.texture=null;this.enabledMaterial=null;this.disabledMaterial=null;this.assetSets=new Et(Array.from(this.imagePaths.entries()).map(([o,i,s])=>[o,i,new Gs(s,tm,!r)])),this.assets=Array.from(this.assetSets.values()),this.ready=Promise.all(this.assets).then(()=>this.finish())}finish(){let t=this.assets.map(O=>O.result),e=Math.max(...t.map(O=>O.width)),r=Math.max(...t.map(O=>O.height)),o=e*r*t.length,i=Math.sqrt(o),s=Math.floor(i/e),p=Math.ceil(t.length/s),c=s*e,u=p*r,h=Xl(c),x=Xl(u),b=c/h,w=u/x,R=e/h,C=r/x;this.canvas=Fs(h,x);let M=this.canvas.getContext("2d",{alpha:!1});M.fillStyle="#1e4388",M.fillRect(0,0,h,x);let k=0;for(let[O,V,X]of this.assetSets.entries()){let G=X.result,I=k%s,F=(k-I)/s,se=b*(I*e/c),ae=w*(1-F/p)-C,q=I*e,ie=F*r+x-u,Te=e-2*this.padding,Ae=r-2*this.padding;M.drawImage(G,0,0,G.width,G.height,q+this.padding,ie+this.padding,Te,Ae),this.uvDescrips.add(O,V,{u:se,v:ae,du:R,dv:C}),++k}this.texture=new xm(this.canvas),this.enabledMaterial=new Ye({map:this.texture}),this.enabledMaterial.needsUpdate=!0,this.disabledMaterial=new Ye({map:this.texture,transparent:!0,opacity:.5}),this.disabledMaterial.needsUpdate=!0}getSets(){return Array.from(this.imagePaths.keys())}getIcons(t){if(!this.imagePaths.has(t))throw new Vt(`Button set ${t} does not exist`);return Array.from(this.imagePaths.get(t).keys())}async getMaterial(t){return await this.ready,t?this.enabledMaterial:this.disabledMaterial}async getGeometry(t,e){await this.ready;let r=this.uvDescrips.get(t),o=r&&r.get(e);if(!r||!o)throw new Vt(`Button ${t}/${e} does not exist`,this.uvDescrips);let i=this.geoms.get(t,e);if(!i){i=new $s(1,1,1,1),i.name=`Geometry:${t}/${e}`,this.geoms.add(t,e,i);let s=i.getAttribute("uv");for(let p=0;p<s.count;++p){let c=s.getX(p)*o.du+o.u,u=s.getY(p)*o.dv+o.v;s.setX(p,c),s.setY(p,u)}}return i}async getGeometryAndMaterials(t,e){let[r,o,i]=await Promise.all([this.getGeometry(t,e),this.getMaterial(!0),this.getMaterial(!1)]);return{geometry:r,enabledMaterial:o,disabledMaterial:i}}getImageSrc(t,e){let r=this.imagePaths.get(t),o=r&&r.get(e);if(!r||!o)throw new Vt(`Button ${t}/${e} does not exist`,this.uvDescrips);return o}getImageElement(t,e){return Kr(Ur(t+" "+e),oi(this.getImageSrc(t,e)))}};var xr=class extends fr{constructor(e,r,o,i,s){e=e+St(16);super(ue(e));this.enabledMesh=ur(`Mesh-${e}-enabled`,r,o),this.disabledMesh=ur(`Mesh-${e}-disabled`,r,i),this.disabledMesh.visible=!1,this.size=s,j(this,this.enabledMesh,this.disabledMesh),this.addMesh(this.enabledMesh),this.addMesh(this.disabledMesh),this.clickable=!0,this.disabled=this.disabled,ia(this,!0)}get size(){return this.enabledMesh.scale.x}set size(e){this.enabledMesh.scale.setScalar(e),this.disabledMesh.scale.setScalar(e)}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.enabledMesh.visible=!e,this.disabledMesh.visible=e}};var Ao=class{constructor(t,e,r){this.mesh=null;this.element=Qr(Ur(r),t.getImageElement(e,r)),this.object=ue(`${name}-button`),this.load(t,e,r)}async load(t,e,r){let{geometry:o,enabledMaterial:i,disabledMaterial:s}=await t.getGeometryAndMaterials(e,r);this.mesh=new xr(r,o,i,s,.2),this.mesh.disabled=this.disabled,j(this,this.mesh),this.mesh.object.visible=this.visible,this.mesh.addEventListener("click",()=>{this.element.click()})}get name(){return this.object.name}addEventListener(t,e,r){this.element.addEventListener(t,e,r)}dispatchEvent(t){return this.element.dispatchEvent(t)}removeEventListener(t,e,r){this.element.removeEventListener(t,e,r)}click(){this.element.click()}get visible(){return Bt(this)}set visible(t){Be(this,t,"inline-block"),this.mesh&&(this.mesh.object.visible=t)}get disabled(){return this.element.disabled}set disabled(t){this.element.disabled=t,this.mesh&&(this.mesh.disabled=t)}};var gr=class{constructor(t,e,r,o){this.buttons=t;this.setName=e;this.activeName=r;this.inactiveName=o;this.enterButton=null;this.exitButton=null;this._isAvailable=!0;this._isEnabled=!0;this._isVisible=!0;this._isActive=!1;this.element=Qr(this.btnImage=Kr()),this.object=ue(`${this.setName}-button`),this.load()}get name(){return this.object.name}addEventListener(t,e,r){this.element.addEventListener(t,e,r)}dispatchEvent(t){return this.element.dispatchEvent(t)}removeEventListener(t,e,r){this.element.removeEventListener(t,e,r)}click(){this.element.click()}async load(){let[t,e]=await Promise.all([this.buttons.getGeometryAndMaterials(this.setName,this.activeName),this.buttons.getGeometryAndMaterials(this.setName,this.inactiveName)]);j(this.object,this.enterButton=new xr(`${this.setName}-activate-button`,t.geometry,t.enabledMaterial,t.disabledMaterial,.2),this.exitButton=new xr(`${this.setName}-deactivate-button`,e.geometry,e.enabledMaterial,e.disabledMaterial,.2)),this.enterButton.addEventListener("click",()=>this.element.click()),this.exitButton.addEventListener("click",()=>this.element.click()),this.refreshState()}get mesh(){return this.active?this.enterButton:this.exitButton}get available(){return this._isAvailable}set available(t){this._isAvailable=t,this.refreshState()}get active(){return this._isActive}set active(t){this._isActive=t,this.refreshState()}get enabled(){return this._isEnabled}set enabled(t){this._isEnabled=t,this.refreshState()}get visible(){return this._isVisible}set visible(t){this._isVisible=t,this.refreshState()}refreshState(){let t=this.active?this.inactiveName:this.activeName,e=`${t} ${this.setName}`;if(this.element.title=this.btnImage.title=e,this.btnImage.src=this.buttons.getImageSrc(this.setName,t),this.element.disabled=!this.available||!this.visible||!this.enabled,Be(this,this.available&&this.visible,"inline-block"),this.enterButton&&this.exitButton){oa(this,this.available&&this.visible&&this.enabled);let r=De(this.object,this.available&&this.visible);De(this.enterButton,r&&!this.active),De(this.exitButton,r&&this.active)}}};var _o=class extends gr{constructor(e,r){let o=vi[r];super(e,o.toLowerCase(),"enter","exit");this.mode=r}};function Gp(n,t){n.element instanceof HTMLButtonElement&&(n.element.disabled=!t),oa(n,t)}var bi=class extends W{constructor(e,r){super(e);this.appName=r}},Hp=class extends bi{constructor(e,r){super("apploading",e);this.appLoadParams=r;this.preLoadTask=null}},zp=class extends bi{constructor(e,r){super("apploaded",e);this.app=r}},Up=class extends bi{constructor(e,r){super("appshown",e);this.app=r}},jp=class{constructor(t,e){this.loader=t;this.name=e;this.params=new Map}param(t,e){return this.params.set(t,e),this}load(t){return this.loader(this.name,this.params,t)}},ba=class extends Y{constructor(e){super();this.env=e;this.loadedModules=new Map;this.loadingApps=new Map;this.currentApps=new Map;this.cacheBustString=null}[Symbol.iterator](){return this.currentApps.values()}isLoaded(e){return this.currentApps.has(e)}get(e){return this.currentApps.get(e)}waitFor(e){return this.isLoaded(e)?Promise.resolve(this.get(e)):new Promise(r=>{let o=i=>{i.appName===e&&(this.removeEventListener("apploaded",o),r(i.app))};this.addEventListener("apploaded",o)})}async loadAppConstructor(e,r){if(this.loadedModules.has(e))v(r)&&r.end();else{let i=this.env.DEBUG?".js":".min.js",s=`/js/${e}/index${i}`;if(v(this.cacheBustString)){let c=new ps(s,location.href);c.query("v",this.cacheBustString),s=c.toString()}let p=this.env.fetcher.get(s).progress(r).useCache(!this.env.DEBUG).module();this.loadedModules.set(e,p)}let{default:o}=await this.loadedModules.get(e);return o}app(e){return new jp(this.loadApp.bind(this),e)}loadApp(e,r,o){let i=null;r instanceof Map?i=r:o=r,o=o||this.env.loadingBar;let s=new Hp(e,i);this.dispatchEvent(s);let p=s.preLoadTask||Promise.resolve();if(!this.loadingApps.has(e)){let u=Md(o),h=p.then(()=>this.loadAppInstance(this.env,e,i,u.pop(10)));this.loadingApps.set(e,h),o=u.pop(1)}return this.loadingApps.get(e).then(async u=>(await u.show(o),this.dispatchEvent(new Up(e,u)),u))}async loadAppInstance(e,r,o,i){if(!this.currentApps.has(r)){let[s,p]=ti(i,[1,10]),c=await this.loadAppConstructor(r,s),u=new c(e);u.addEventListener("quit",()=>this.unloadApp(r)),v(o)&&await u.init(o),await u.load(p),this.currentApps.set(r,u),this.dispatchEvent(new zp(r,u))}return v(i)&&i.end(),this.currentApps.get(r)}unloadApp(e){let r=this.currentApps.get(e);r.clearEventListeners(),r.dispose(),this.currentApps.delete(e),this.loadingApps.delete(e)}};var yi=new D;function ya(n){return yi.copy(n),yi.y=0,yi.normalize(),wn(Math.atan2(yi.x,yi.z))}function Gh(n){return wn(Math.asin(n.y))}var bo=new D,Hh=0,gA=new D,wa=new D,Wp=new D,Ea=new de,zh=0,vA=0;function AA(n,t){let e=n-t,r=e+2*Math.PI,o=e-2*Math.PI,i=Math.abs(e),s=Math.abs(r),p=Math.abs(o);return i<s&&i<p?e:s<p?r:o}var Ta=class extends qe{constructor(e,r,o,i,s=1){super();this.minDistance=r;this.heightOffset=i;this.speed=s;this.name=e,this.lerp=this.minAngle>0||this.minDistance>0,this.maxDistance=this.minDistance*5,this.minAngle=Ke(o),this.maxAngle=Math.PI-this.minAngle,Object.seal(this)}copy(e,r=!0){return super.copy(e,r),this.name=e.name+ ++vA,this.lerp=e.lerp,this.maxDistance=e.maxDistance,this.minAngle=e.minAngle,this.maxAngle=e.maxAngle,this}update(e,r,o,i){i*=.001,this.clampTo(this.lerp,e,r,this.minDistance,this.maxDistance,o,this.minAngle,this.maxAngle,i)}reset(e,r,o){this.clampTo(!1,e,r,0,0,o,0,0,0)}clampTo(e,r,o,i,s,p,c,u,h){bo.copy(o),bo.y-=this.heightOffset*r,Hh=p,this.getWorldPosition(wa),this.getWorldDirection(Wp),Wp.negate(),zh=ya(Wp),Ea.identity();let x=!e,b=!e;if(e){let w=gA.copy(bo).sub(wa).length();i<w&&(w<s&&bo.lerpVectors(wa,bo,this.speed*h),x=!0);let R=AA(Hh,zh),C=Math.abs(R);c<C&&(C<u?Ea.setFromAxisAngle(this.up,R*this.speed*h):Ea.setFromAxisAngle(this.up,R),b=!0)}(x||b)&&(x&&this.position.add(bo.sub(wa)),b&&this.quaternion.multiply(Ea))}};var Sa=class extends io{constructor(e,r,o,i){if(!Xs.matches(o)&&!rm.matches(o))throw new Error("Only GLTF model types are currently supported");super(r,o,i);this.env=e}async getResponse(e){let r=await e.file();return so(r,o=>this.env.loadGltf(o))}};function Pa(n){return!(n.shiftKey||n.altKey||n.ctrlKey||n.metaKey)}var Ma=class{constructor(t,e,r){this.name=t;this.callback=e;if(!Z(e))throw new Error("A function instance is required for this parameter");this.opts=r,Object.freeze(this)}applyToElement(t){this.add(t)}add(t){t.addEventListener(this.name,this.callback,this.opts)}remove(t){t.removeEventListener(this.name,this.callback)}};function Uh(n,t){return new Ma("click",n,t)}function yo(n,t){return new Ma("input",n,t)}var Ca=class extends W{constructor(){super("avatarmoved");this.px=0;this.py=0;this.pz=0;this.fx=0;this.fy=0;this.fz=0;this.ux=0;this.uy=0;this.uz=0;this.height=0;this.changed=!1;this.pointerID=0}set(e,r,o,i,s,p,c,u,h,x){this.changed=this.px!==e||this.py!==r||this.pz!==o||this.fx!==i||this.fy!==s||this.fz!==p||this.ux!==c||this.uy!==u||this.uz!==h,this.px=e,this.py=r,this.pz=o,this.fx=i,this.fy=s,this.fz=p,this.ux=c,this.uy=u,this.uz=h,this.height=x}};function vr(n,t){return n.xr.isPresenting?n.xr.getCamera():t}function jh(n,t,e,r,o){let i=n.elements;t.set(i[0],i[1],i[2]),e.set(i[4],i[5],i[6]),r.set(-i[8],-i[9],-i[10]),o.set(i[12],i[13],i[14]),t.normalize(),e.normalize(),r.normalize()}function _A(n){return n===DeviceOrientationEvent&&"requestPermission"in n&&Z(n.requestPermission)}var Ra=class extends Y{constructor(e,r,o){super();this.env=e;this.controlMode="none";this.snapTurnAngle=Ke(30);this.sensitivities=new Map([["mousedrag",100],["mousefirstperson",-100],["touchswipe",50],["gamepad",1]]);this.B=new D(0,0,1);this.R=new D;this.F=new D;this.U=new D;this.P=new D;this.M=new Oe;this.E=new wm;this.Q1=new de;this.Q2=new de;this.Q3=new de(-Math.sqrt(.5),0,0,Math.sqrt(.5));this.Q4=new de;this.motion=new Ie;this.rotStage=new Oe;this.userMovedEvt=new Ca;this.acceleration=new Ie(2,2);this.speed=new Ie(3,2);this.axisControl=new Ie(0,0);this.deviceQ=new de().identity();this.uv=new Ie;this.duv=new Ie;this.move=new D;this.move2=new D;this.followers=new Array;this.dz=0;this._heading=0;this._pitch=0;this._roll=0;this.headX=0;this.headZ=0;this._worldHeading=0;this._worldPitch=0;this.fwrd=!1;this.back=!1;this.left=!1;this.rght=!1;this.fwrd2=!1;this.back2=!1;this.left2=!1;this.rght2=!1;this.up=!1;this.down=!1;this.grow=!1;this.shrk=!1;this._keyboardControlEnabled=!1;this.worldPos=new D;this.worldQuat=new de;this.fovZoomEnabled=!0;this.minFOV=15;this.maxFOV=120;this.minimumX=-85*Math.PI/180;this.maximumX=85*Math.PI/180;this.edgeFactor=1/3;this.deviceOrientation=null;this.screenOrientation=0;this.alphaOffset=0;this.onDeviceOrientationChangeEvent=null;this.onScreenOrientationChangeEvent=null;this.motionEnabled=!1;this.disableHorizontal=!1,this.disableVertical=!1,this.invertHorizontal=!1,this.invertVertical=!0,this._height=o,this.head=ue("Head",r);let i=(s,p)=>{s==="w"&&(this.fwrd=p),s==="s"&&(this.back=p),s==="a"&&(this.left=p),s==="d"&&(this.rght=p),s==="e"&&(this.up=p),s==="q"&&(this.down=p),s==="ArrowUp"&&(this.fwrd2=p),s==="ArrowDown"&&(this.back2=p),s==="ArrowLeft"&&(this.left2=p),s==="ArrowRight"&&(this.rght2=p),s==="r"&&(this.grow=p),s==="f"&&(this.shrk=p)};this.onKeyDown=s=>i(s.key,Pa(s)),this.onKeyUp=s=>i(s.key,!1),this.keyboardControlEnabled=!0,matchMedia("(pointer: coarse)").matches?this.controlMode="touchswipe":matchMedia("(pointer: fine)").matches&&(this.controlMode="mousedrag"),globalThis.isSecureContext&&$o()&&!Jt()&&(this.onDeviceOrientationChangeEvent=s=>{this.deviceOrientation=s},this.onScreenOrientationChangeEvent=()=>{ne(globalThis.orientation)||(this.screenOrientation=globalThis.orientation||0)},this.startMotionControl())}set disableVertical(e){this._disableVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set invertVertical(e){this._invertVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set disableHorizontal(e){this._disableHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}set invertHorizontal(e){this._invertHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}get height(){return this.head.position.y}get object(){return this.head}get worldHeading(){return this._worldHeading}get worldPitch(){return this._worldPitch}get fov(){return this.env.camera.fov}set fov(e){e!==this.fov&&(this.env.camera.fov=e,this.env.camera.updateProjectionMatrix())}get stage(){return this.head.parent}snapTurn(e){this.setHeading(this.heading-this.snapTurnAngle*e)}get keyboardControlEnabled(){return this._keyboardControlEnabled}set keyboardControlEnabled(e){this._keyboardControlEnabled!==e&&(this._keyboardControlEnabled=e,this._keyboardControlEnabled?(globalThis.addEventListener("keydown",this.onKeyDown),globalThis.addEventListener("keyup",this.onKeyUp)):(globalThis.removeEventListener("keydown",this.onKeyDown),globalThis.removeEventListener("keyup",this.onKeyUp)))}addFollower(e){this.followers.push(e)}onMove(e,r,o){this.setMode(e),e.canMoveView&&this.controlMode!=="none"&&this.gestureSatisfied(e)&&(this.uv.copy(r),this.duv.copy(o))}setMode(e){e.type==="remote"||(e.type==="hand"?this.controlMode="none":e.type==="gamepad"?this.controlMode="gamepad":e.rayTarget&&e.rayTarget.draggable&&!this.env.eventSys.mouse.isPointerLocked&&e.isPressed(0)?this.controlMode="mouseedge":e.type==="touch"||e.type==="pen"?this.controlMode="touchswipe":e.type==="mouse"?this.controlMode=this.env.eventSys.mouse.isPointerLocked?"mousefirstperson":"mousedrag":ht(e.type))}gestureSatisfied(e){return this.controlMode==="none"?!1:this.controlMode==="gamepad"||this.controlMode==="mousefirstperson"||this.controlMode==="mouseedge"||e.isPressed(0)}get name(){return this.object.name}set name(e){this.object.name=e}get heading(){return this._heading}setHeading(e){this._heading=wn(e)}get pitch(){return this._pitch}setPitch(e,r,o){this._pitch=wn(e+Math.PI)-Math.PI,this._pitch=Zt(this._pitch,r,o)}get roll(){return this._roll}setRoll(e){this._roll=wn(e)}setHeadingImmediate(e){this.setHeading(e),this.updateOrientation(),this.resetFollowers()}setOrientationImmediate(e,r){this.setHeading(e),this._pitch=wn(r),this.updateOrientation()}zoom(e){this.dz=e}update(e){if(this.fovZoomEnabled&&Math.abs(this.dz)>0){let i=Math.pow(.95,5*e);this.dz=Sd(i*this.dz),this.fov=Zt(this.env.camera.fov-this.dz,this.minFOV,this.maxFOV)}e*=.001;let r=this.deviceOrientation;if(r&&ze(r.alpha)&&ze(r.beta)&&ze(r.gamma)){let i=Ke(r.alpha)+this.alphaOffset,s=Ke(r.beta),p=Ke(r.gamma),c=this.screenOrientation?Ke(this.screenOrientation):0;this.E.set(s,i,-p,"YXZ"),this.Q2.setFromAxisAngle(this.B,-c),this.Q4.setFromEuler(this.E).multiply(this.Q3).multiply(this.Q2),this.deviceQ.slerp(this.Q4,.8)}if(this.controlMode==="mouseedge")this.uv.manhattanLength()>0&&(this.motion.set(this.scaleRadialComponent(-this.uv.x,this.speed.x,this.acceleration.x),this.scaleRadialComponent(this.uv.y,this.speed.y,this.acceleration.y)).multiplyScalar(e),this.setHeading(this.heading+this.motion.x),this.setPitch(this.pitch+this.motion.y,this.minimumX,this.maximumX),this.setRoll(0));else if(this.sensitivities.has(this.controlMode)&&this.duv.manhattanLength()>0){let i=this.sensitivities.get(this.controlMode)||1;this.motion.copy(this.duv).multiplyScalar(i*e).multiply(this.axisControl),this.setHeading(this.heading+this.motion.x),this.setPitch(this.pitch+this.motion.y,this.minimumX,this.maximumX),this.setRoll(0)}if(this.Q1.setFromAxisAngle(this.stage.up,this.worldHeading),this.fwrd||this.back||this.left||this.rght||this.up||this.down){let i=(this.left?1:0)+(this.rght?-1:0),s=(this.down?1:0)+(this.up?-1:0),p=(this.fwrd?1:0)+(this.back?-1:0);this.move.set(i,s,p);let c=this.move.length();c>0&&(this.move.multiplyScalar(e/c).applyQuaternion(this.Q1),this.stage.position.add(this.move))}if(this.fwrd2||this.back2||this.left2||this.rght2){let i=(this.left2?1:0)+(this.rght2?-1:0),s=(this.fwrd2?1:0)+(this.back2?-1:0);this.move2.set(i,0,s);let p=this.move2.length();p>0&&(this.move2.multiplyScalar(e/p).applyQuaternion(this.Q1),this.headX+=this.move2.x,this.headZ+=this.move2.z)}if(this.grow||this.shrk){let i=(this.shrk?-1:0)+(this.grow?1:0);this._height+=i*e,this._height=Zt(this._height,1,2)}this.updateOrientation(),this.userMovedEvt.set(this.P.x,this.P.y,this.P.z,this.F.x,this.F.y,this.F.z,this.U.x,this.U.y,this.U.z,this.height),this.dispatchEvent(this.userMovedEvt);let o=Math.pow(.95,100*e);this.duv.multiplyScalar(o),this.duv.manhattanLength()<=1e-4&&this.duv.setScalar(0)}scaleRadialComponent(e,r,o){let i=Math.abs(e);return Math.sign(e)*Math.pow(Math.max(0,i-this.edgeFactor)/(1-this.edgeFactor),o)*r}updateOrientation(){let e=vr(this.env.renderer,this.env.camera);this.rotStage.makeRotationY(this._heading),this.stage.matrix.makeTranslation(this.stage.position.x,this.stage.position.y,this.stage.position.z).multiply(this.rotStage),this.stage.matrix.decompose(this.stage.position,this.stage.quaternion,this.stage.scale),this.env.renderer.xr.isPresenting?(this.M.copy(this.stage.matrixWorld).invert(),this.head.position.copy(e.position).applyMatrix4(this.M),this.head.quaternion.copy(this.stage.quaternion).invert().multiply(e.quaternion)):(this.head.position.set(this.headX,this._height,this.headZ),this.E.set(this._pitch,0,this._roll,"XYZ"),this.head.quaternion.setFromEuler(this.E).premultiply(this.deviceQ)),this.env.camera.position.copy(this.head.position),this.env.camera.quaternion.copy(this.head.quaternion),this.head.getWorldPosition(this.worldPos),this.head.getWorldQuaternion(this.worldQuat),this.F.set(0,0,-1).applyQuaternion(this.worldQuat),this._worldHeading=ya(this.F),this._worldPitch=Gh(this.F),jh(this.head.matrixWorld,this.R,this.U,this.F,this.P)}reset(){this.stage.position.setScalar(0),this.setHeadingImmediate(0)}resetFollowers(){for(let e of this.followers)e.reset(this.height,this.worldPos,this.worldHeading)}async getPermission(){return"DeviceOrientationEvent"in globalThis?_A(DeviceOrientationEvent)?await DeviceOrientationEvent.requestPermission():"granted":"not-supported"}async startMotionControl(){if(!this.motionEnabled){this.onScreenOrientationChangeEvent();let e=await this.getPermission();this.motionEnabled=e==="granted",this.motionEnabled&&(globalThis.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),globalThis.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}}stopMotionControl(){this.motionEnabled&&(globalThis.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),globalThis.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.motionEnabled=!1)}dispose(){this.stopMotionControl()}};var Ia=0;var wo=3;function Wh(n,t){n=Je(n),n.traverse(e=>e.layers.set(t))}function qh(n,t){n=Je(n),n.traverse(e=>e.layers.enable(t))}var Eo=new D;function Qh(n,t,e,r){Eo.crossVectors(t,n),n.crossVectors(Eo,t),Eo.normalize(),n.normalize(),t.normalize(),r.set(Eo.x,n.x,-t.x,e.x,Eo.y,n.y,-t.y,e.y,Eo.z,n.z,-t.z,e.z,0,0,0,1)}var Ut=class{constructor(t){this.env=t;this._object=null;this._visible=!0;this._style="default";this.T=new D;this.V=new D;this.Q=new de;this._side=-1}get side(){return this._side}set side(t){this._side=t}get object(){return this._object}set object(t){this._object=t}get style(){return this._style}set style(t){this._style=t}get visible(){return this._visible}set visible(t){this._visible=t}update(t,e,r,o,i,s,p,c,u,h,x){r&&r.face?(this.position.copy(r.point),r.object.getWorldQuaternion(this.Q),this.T.copy(r.face.normal).applyQuaternion(this.Q),this.V.copy(this.T).multiplyScalar(.02),this.position.add(this.V),this.V.copy(this.T).multiplyScalar(10).add(this.position)):(s?this.position.copy(h).multiplyScalar(2).add(u).sub(this.env.avatar.worldPos).normalize().multiplyScalar(i).add(this.env.avatar.worldPos):(this.V.copy(u).add(e).sub(t).multiplyScalar(2),this.position.copy(h).multiplyScalar(i).add(this.V).add(this.env.avatar.worldPos)),this.V.copy(this.env.avatar.worldPos)),this.lookAt(this.position,this.V),this.style=!o||o.navigable&&!c?p?x?"grabbing":"grab":"default":o.enabled?o.draggable?x?"grabbing":"move":o.navigable?"cell":o.clickable?"pointer":"default":"not-allowed"}lookAt(t,e){}};var To=class extends Ut{constructor(e,r){super(e);this.cursorSystem=null;this.f=new D;this.up=new D;this.right=new D;this.object=ue("Cursor3D"),this.cursorSystem=r,this.object.matrixAutoUpdate=!1}add(e,r){j(this,r),qh(r,wo),r.visible=e==="default"}get position(){return this.object.position}get style(){for(let e of this.object.children)if(e.visible)return e.name;return null}set style(e){for(let r of this.object.children)r.visible=r.name===e;if(this.style==null&&this.object.children.length>0){let r=wt(this.object.children,o=>o.name==="default",o=>o!=null);r!=null&&(r.visible=!0)}this.cursorSystem&&(this.cursorSystem.style="none")}get visible(){return uo(this)}set visible(e){De(this,e)}lookAt(e,r){this.f.copy(r).sub(e).multiplyScalar(this.side).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat),this.right.crossVectors(this.up,this.f),this.up.crossVectors(this.f,this.right),Qh(this.up,this.f,e,this.object.matrixWorld),this.object.matrix.copy(this.object.parent.matrixWorld).invert().multiply(this.object.matrixWorld),this.object.matrix.decompose(this.object.position,this.object.quaternion,this.object.scale)}clone(){let e=new To(this.env);for(let r of this.object.children)e.add(r.name,r.clone());return e}};var Va=class extends W{constructor(e,r){super(e);this.button=r}},Qp=class extends Va{constructor(t){super("gamepadbuttonup",t)}},Kp=class extends Va{constructor(t){super("gamepadbuttondown",t)}},Yp=class extends W{constructor(e,r,o){super(e);this.axis=r;this.value=o}},Jp=class extends Yp{constructor(t,e){super("gamepadaxismaxed",t,e)}},La=class extends Y{constructor(){super();this.lastAxisValues=new Array;this.btnDownEvts=new Array;this.btnUpEvts=new Array;this.wasPressed=new Array;this.axisMaxEvts=new Array;this.wasAxisMaxed=new Array;this.sticks=new Array;this.axisThresholdMax=.9;this.axisThresholdMin=.1;this._pad=null;Object.seal(this)}get displayId(){if("displayId"in this.pad)return this.pad.displayId}get pad(){return this._pad}set pad(e){if(this._pad=e,this.pad){if(this.btnUpEvts.length===0){for(let r=0;r<e.buttons.length;++r)this.btnDownEvts[r]=new Kp(r),this.btnUpEvts[r]=new Qp(r),this.wasPressed[r]=!1;for(let r=0;r<e.axes.length;++r)this.axisMaxEvts[r]=new Jp(r,0),this.wasAxisMaxed[r]=!1,r%2===0&&r<e.axes.length-1&&(this.sticks[r/2]={x:0,y:0}),this.lastAxisValues[r]=e.axes[r]}for(let r=0;r<this.pad.buttons.length;++r){let o=this.wasPressed[r],i=this.pad.buttons[r].pressed;i!==o&&(this.wasPressed[r]=i,this.dispatchEvent((i?this.btnDownEvts:this.btnUpEvts)[r]))}for(let r=0;r<this.pad.axes.length;++r){let o=this.wasAxisMaxed[r],i=this.pad.axes[r],s=Math.sign(i),p=Math.abs(i),c=p>=this.axisThresholdMax,u=p<=this.axisThresholdMin,h=s*(c?1:u?0:p);c&&!o&&(this.axisMaxEvts[r].value=h,this.dispatchEvent(this.axisMaxEvts[r])),this.wasAxisMaxed[r]=c,this.lastAxisValues[r]=h}for(let r=0;r<this.axes.length-1;r+=2){let o=this.sticks[r/2];o.x=this.axes[r],o.y=this.axes[r+1]}}}get id(){return this.pad?this.pad.id:null}get index(){return this.pad?this.pad.index:null}get connected(){return this.pad&&this.pad.connected}get mapping(){return this.pad?this.pad.mapping:null}get timestamp(){return this.pad?this.pad.timestamp:null}get hand(){return this.pad?this.pad.hand:null}get pose(){return this.pad?this.pad.pose:null}get buttons(){return this.pad?this.pad.buttons:null}get axes(){return this.pad?this.pad.axes:null}get hapticActuators(){return this.pad?this.pad.hapticActuators:null}};var Nn=class extends Om{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new tc(e)}),this.register(function(e){return new ac(e)}),this.register(function(e){return new lc(e)}),this.register(function(e){return new nc(e)}),this.register(function(e){return new rc(e)}),this.register(function(e){return new oc(e)}),this.register(function(e){return new ic(e)}),this.register(function(e){return new sc(e)}),this.register(function(e){return new Zp(e)}),this.register(function(e){return new pc(e)})}load(t,e,r,o){let i=this,s;this.resourcePath!==""?s=this.resourcePath:this.path!==""?s=this.path:s=On.extractUrlBase(t),this.manager.itemStart(t);let p=function(u){o?o(u):console.error(u),i.manager.itemError(t),i.manager.itemEnd(t)},c=new Ap(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,function(u){try{i.parse(u,s,function(h){e(h),i.manager.itemEnd(t)},p)}catch(h){p(h)}},r,p)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,r,o){let i,s={},p={};if(typeof t=="string")i=t;else if(On.decodeText(new Uint8Array(t,0,4))===nf){try{s[$.KHR_BINARY_GLTF]=new cc(t)}catch(x){o&&o(x);return}i=s[$.KHR_BINARY_GLTF].content}else i=On.decodeText(new Uint8Array(t));let c=JSON.parse(i);if(c.asset===void 0||c.asset.version[0]<2){o&&o(new Error("GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let u=new vc(c,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){let x=this.pluginCallbacks[h](u);p[x.name]=x,s[x.name]=!0}if(c.extensionsUsed)for(let h=0;h<c.extensionsUsed.length;++h){let x=c.extensionsUsed[h],b=c.extensionsRequired||[];switch(x){case $.KHR_MATERIALS_UNLIT:s[x]=new ec;break;case $.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[x]=new mc;break;case $.KHR_DRACO_MESH_COMPRESSION:s[x]=new dc(c,this.dracoLoader);break;case $.KHR_TEXTURE_TRANSFORM:s[x]=new uc;break;case $.KHR_MESH_QUANTIZATION:s[x]=new hc;break;default:b.indexOf(x)>=0&&p[x]===void 0&&console.warn('GLTFLoader: Unknown extension "'+x+'".')}}u.setExtensions(s),u.setPlugins(p),u.parse(r,o)}parseAsync(t,e){let r=this;return new Promise(function(o,i){r.parse(t,e,o,i)})}};function bA(){let n={};return{get:function(t){return n[t]},add:function(t,e){n[t]=e},remove:function(t){delete n[t]},removeAll:function(){n={}}}}var $={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},Zp=class{constructor(t){this.parser=t,this.name=$.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let t=this.parser,e=this.parser.json.nodes||[];for(let r=0,o=e.length;r<o;r++){let i=e[r];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){let e=this.parser,r="light:"+t,o=e.cache.get(r);if(o)return o;let i=e.json,c=((i.extensions&&i.extensions[this.name]||{}).lights||[])[t],u,h=new we(16777215);c.color!==void 0&&h.fromArray(c.color);let x=c.range!==void 0?c.range:0;switch(c.type){case"directional":u=new qs(h),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new Um(h),u.distance=x;break;case"spot":u=new $m(h),u.distance=x,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,u.angle=c.spot.outerConeAngle,u.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("GLTFLoader: Unexpected light type: "+c.type)}return u.position.set(0,0,0),u.decay=2,c.intensity!==void 0&&(u.intensity=c.intensity),u.name=e.createUniqueName(c.name||"light_"+t),o=Promise.resolve(u),e.cache.add(r,o),o}createNodeAttachment(t){let e=this,r=this.parser,i=r.json.nodes[t],p=(i.extensions&&i.extensions[this.name]||{}).light;return p===void 0?null:this._loadLight(p).then(function(c){return r._getNodeRef(e.cache,p,c)})}},ec=class{constructor(){this.name=$.KHR_MATERIALS_UNLIT}getMaterialType(){return Ye}extendParams(t,e,r){let o=[];t.color=new we(1,1,1),t.opacity=1;let i=e.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){let s=i.baseColorFactor;t.color.fromArray(s),t.opacity=s[3]}i.baseColorTexture!==void 0&&o.push(r.assignTexture(t,"map",i.baseColorTexture))}return Promise.all(o)}},tc=class{constructor(t){this.parser=t,this.name=$.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:dr}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[],s=o.extensions[this.name];if(s.clearcoatFactor!==void 0&&(e.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&i.push(r.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&i.push(r.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(i.push(r.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){let p=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Ie(p,p)}return Promise.all(i)}},nc=class{constructor(t){this.parser=t,this.name=$.KHR_MATERIALS_SHEEN}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:dr}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[];e.sheenColor=new we(0,0,0),e.sheenRoughness=0,e.sheen=1;let s=o.extensions[this.name];return s.sheenColorFactor!==void 0&&e.sheenColor.fromArray(s.sheenColorFactor),s.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&i.push(r.assignTexture(e,"sheenColorMap",s.sheenColorTexture)),s.sheenRoughnessTexture!==void 0&&i.push(r.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(i)}},rc=class{constructor(t){this.parser=t,this.name=$.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:dr}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[],s=o.extensions[this.name];return s.transmissionFactor!==void 0&&(e.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&i.push(r.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(i)}},oc=class{constructor(t){this.parser=t,this.name=$.KHR_MATERIALS_VOLUME}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:dr}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[],s=o.extensions[this.name];e.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&i.push(r.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||0;let p=s.attenuationColor||[1,1,1];return e.attenuationColor=new we(p[0],p[1],p[2]),Promise.all(i)}},ic=class{constructor(t){this.parser=t,this.name=$.KHR_MATERIALS_IOR}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:dr}extendMaterialParams(t,e){let o=this.parser.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=o.extensions[this.name];return e.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}},sc=class{constructor(t){this.parser=t,this.name=$.KHR_MATERIALS_SPECULAR}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:dr}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[],s=o.extensions[this.name];e.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&i.push(r.assignTexture(e,"specularIntensityMap",s.specularTexture));let p=s.specularColorFactor||[1,1,1];return e.specularColor=new we(p[0],p[1],p[2]),s.specularColorTexture!==void 0&&i.push(r.assignTexture(e,"specularColorMap",s.specularColorTexture).then(function(c){c.encoding=na})),Promise.all(i)}},ac=class{constructor(t){this.parser=t,this.name=$.KHR_TEXTURE_BASISU}loadTexture(t){let e=this.parser,r=e.json,o=r.textures[t];if(!o.extensions||!o.extensions[this.name])return null;let i=o.extensions[this.name],s=r.images[i.source],p=e.options.ktx2Loader;if(!p){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,s,p)}},lc=class{constructor(t){this.parser=t,this.name=$.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){let e=this.name,r=this.parser,o=r.json,i=o.textures[t];if(!i.extensions||!i.extensions[e])return null;let s=i.extensions[e],p=o.images[s.source],c=r.textureLoader;if(p.uri){let u=r.options.manager.getHandler(p.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return r.loadTextureImage(t,p,c);if(o.extensionsRequired&&o.extensionsRequired.indexOf(e)>=0)throw new Error("GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){let e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}},pc=class{constructor(t){this.name=$.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){let e=this.parser.json,r=e.bufferViews[t];if(r.extensions&&r.extensions[this.name]){let o=r.extensions[this.name],i=this.parser.getDependency("buffer",o.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,s.ready]).then(function(p){let c=o.byteOffset||0,u=o.byteLength||0,h=o.count,x=o.byteStride,b=new ArrayBuffer(h*x),w=new Uint8Array(p[0],c,u);return s.decodeGltfBuffer(new Uint8Array(b),h,x,w,o.mode,o.filter),b})}else return null}},nf="glTF",wi=12,Kh={JSON:1313821514,BIN:5130562},cc=class{constructor(t){this.name=$.KHR_BINARY_GLTF,this.content=null,this.body=null;let e=new DataView(t,0,wi);if(this.header={magic:On.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==nf)throw new Error("GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("GLTFLoader: Legacy binary file detected.");let r=this.header.length-wi,o=new DataView(t,wi),i=0;for(;i<r;){let s=o.getUint32(i,!0);i+=4;let p=o.getUint32(i,!0);if(i+=4,p===Kh.JSON){let c=new Uint8Array(t,wi+i,s);this.content=On.decodeText(c)}else if(p===Kh.BIN){let c=wi+i;this.body=t.slice(c,c+s)}i+=s}if(this.content===null)throw new Error("GLTFLoader: JSON content not found.")}},dc=class{constructor(t,e){if(!e)throw new Error("GLTFLoader: No DRACOLoader instance provided.");this.name=$.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){let r=this.json,o=this.dracoLoader,i=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,p={},c={},u={};for(let h in s){let x=xc[h]||h.toLowerCase();p[x]=s[h]}for(let h in t.attributes){let x=xc[h]||h.toLowerCase();if(s[h]!==void 0){let b=r.accessors[t.attributes[h]],w=Si[b.componentType];u[x]=w,c[x]=b.normalized===!0}}return e.getDependency("bufferView",i).then(function(h){return new Promise(function(x){o.decodeDracoFile(h,function(b){for(let w in b.attributes){let R=b.attributes[w],C=c[w];C!==void 0&&(R.normalized=C)}x(b)},p,u)})})}},uc=class{constructor(){this.name=$.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return e.texCoord!==void 0&&console.warn('GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}},Ti=class extends po{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;let e=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),r=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),o=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),p={specular:{value:new we().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=p,this.onBeforeCompile=function(c){for(let u in p)c.uniforms[u]=p[u];c.fragmentShader=c.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",o).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return p.specular.value},set:function(c){p.specular.value=c}},specularMap:{get:function(){return p.specularMap.value},set:function(c){p.specularMap.value=c,c?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return p.glossiness.value},set:function(c){p.glossiness.value=c}},glossinessMap:{get:function(){return p.glossinessMap.value},set:function(c){p.glossinessMap.value=c,c?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}},mc=class{constructor(){this.name=$.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Ti}extendParams(t,e,r){let o=e.extensions[this.name];t.color=new we(1,1,1),t.opacity=1;let i=[];if(Array.isArray(o.diffuseFactor)){let s=o.diffuseFactor;t.color.fromArray(s),t.opacity=s[3]}if(o.diffuseTexture!==void 0&&i.push(r.assignTexture(t,"map",o.diffuseTexture)),t.emissive=new we(0,0,0),t.glossiness=o.glossinessFactor!==void 0?o.glossinessFactor:1,t.specular=new we(1,1,1),Array.isArray(o.specularFactor)&&t.specular.fromArray(o.specularFactor),o.specularGlossinessTexture!==void 0){let s=o.specularGlossinessTexture;i.push(r.assignTexture(t,"glossinessMap",s)),i.push(r.assignTexture(t,"specularMap",s))}return Promise.all(i)}createMaterial(t){let e=new Ti(t);return e.fog=!0,e.color=t.color,e.map=t.map===void 0?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=t.aoMap===void 0?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=t.emissiveMap===void 0?null:t.emissiveMap,e.bumpMap=t.bumpMap===void 0?null:t.bumpMap,e.bumpScale=1,e.normalMap=t.normalMap===void 0?null:t.normalMap,e.normalMapType=Zm,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=t.specularMap===void 0?null:t.specularMap,e.specular=t.specular,e.glossinessMap=t.glossinessMap===void 0?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=t.envMap===void 0?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}},hc=class{constructor(){this.name=$.KHR_MESH_QUANTIZATION}},pn=class extends Cm{constructor(t,e,r,o){super(t,e,r,o)}copySampleValue_(t){let e=this.resultBuffer,r=this.sampleValues,o=this.valueSize,i=t*o*3+o;for(let s=0;s!==o;s++)e[s]=r[i+s];return e}};pn.prototype.beforeStart_=pn.prototype.copySampleValue_;pn.prototype.afterEnd_=pn.prototype.copySampleValue_;pn.prototype.interpolate_=function(n,t,e,r){let o=this.resultBuffer,i=this.sampleValues,s=this.valueSize,p=s*2,c=s*3,u=r-t,h=(e-t)/u,x=h*h,b=x*h,w=n*c,R=w-c,C=-2*b+3*x,M=b-x,k=1-C,O=M-x+h;for(let V=0;V!==s;V++){let X=i[R+V+s],G=i[R+V+p]*u,I=i[w+V+s],F=i[w+V]*u;o[V]=k*X+O*G+C*I+M*F}return o};var yA=new de,fc=class extends pn{interpolate_(t,e,r,o){let i=super.interpolate_(t,e,r,o);return yA.fromArray(i).normalize().toArray(i),i}},ln={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Si={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Yh={9728:Nm,9729:wp,9984:Gm,9985:Bm,9986:Xm,9987:Ep},Jh={33071:gm,33648:Fm,10497:Zs},$h={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xc={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Fn={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},wA={CUBICSPLINE:void 0,LINEAR:bp,STEP:Rm},$p={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function EA(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new po({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Qs})),n.DefaultMaterial}function Ei(n,t,e){for(let r in e.extensions)n[r]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=e.extensions[r])}function Ar(n,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(n.userData,t.extras):console.warn("GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function TA(n,t,e){let r=!1,o=!1;for(let p=0,c=t.length;p<c;p++){let u=t[p];if(u.POSITION!==void 0&&(r=!0),u.NORMAL!==void 0&&(o=!0),r&&o)break}if(!r&&!o)return Promise.resolve(n);let i=[],s=[];for(let p=0,c=t.length;p<c;p++){let u=t[p];if(r){let h=u.POSITION!==void 0?e.getDependency("accessor",u.POSITION):n.attributes.position;i.push(h)}if(o){let h=u.NORMAL!==void 0?e.getDependency("accessor",u.NORMAL):n.attributes.normal;s.push(h)}}return Promise.all([Promise.all(i),Promise.all(s)]).then(function(p){let c=p[0],u=p[1];return r&&(n.morphAttributes.position=c),o&&(n.morphAttributes.normal=u),n.morphTargetsRelative=!0,n})}function SA(n,t){if(n.updateMorphTargets(),t.weights!==void 0)for(let e=0,r=t.weights.length;e<r;e++)n.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){let e=t.extras.targetNames;if(n.morphTargetInfluences.length===e.length){n.morphTargetDictionary={};for(let r=0,o=e.length;r<o;r++)n.morphTargetDictionary[e[r]]=r}else console.warn("GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function MA(n){let t=n.extensions&&n.extensions[$.KHR_DRACO_MESH_COMPRESSION],e;return t?e="draco:"+t.bufferView+":"+t.indices+":"+Zh(t.attributes):e=n.indices+":"+Zh(n.attributes)+":"+n.mode,e}function Zh(n){let t="",e=Object.keys(n).sort();for(let r=0,o=e.length;r<o;r++)t+=e[r]+":"+n[e[r]]+";";return t}function gc(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("GLTFLoader: Unsupported normalized accessor component type.")}}var vc=class{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new bA,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap<"u"&&/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!1?this.textureLoader=new Tm(this.options.manager):this.textureLoader=new eh(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ap(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){let r=this,o=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(s){let p={scene:s[0][o.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:o.asset,parser:r,userData:{}};Ei(i,p,o),Ar(p,o),Promise.all(r._invokeAll(function(c){return c.afterRoot&&c.afterRoot(p)})).then(function(){t(p)})}).catch(e)}_markDefs(){let t=this.json.nodes||[],e=this.json.skins||[],r=this.json.meshes||[];for(let o=0,i=e.length;o<i;o++){let s=e[o].joints;for(let p=0,c=s.length;p<c;p++)t[s[p]].isBone=!0}for(let o=0,i=t.length;o<i;o++){let s=t[o];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(r[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,r){if(t.refs[e]<=1)return r;let o=r.clone(),i=(s,p)=>{let c=this.associations.get(s);c!=null&&this.associations.set(p,c);for(let[u,h]of s.children.entries())i(h,p.children[u])};return i(r,o),o.name+="_instance_"+t.uses[e]++,o}_invokeOne(t){let e=Object.values(this.plugins);e.push(this);for(let r=0;r<e.length;r++){let o=t(e[r]);if(o)return o}return null}_invokeAll(t){let e=Object.values(this.plugins);e.unshift(this);let r=[];for(let o=0;o<e.length;o++){let i=t(e[o]);i&&r.push(i)}return r}getDependency(t,e){let r=t+":"+e,o=this.cache.get(r);if(!o){switch(t){case"scene":o=this.loadScene(e);break;case"node":o=this.loadNode(e);break;case"mesh":o=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(e)});break;case"accessor":o=this.loadAccessor(e);break;case"bufferView":o=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(e)});break;case"buffer":o=this.loadBuffer(e);break;case"material":o=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(e)});break;case"texture":o=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(e)});break;case"skin":o=this.loadSkin(e);break;case"animation":o=this.loadAnimation(e);break;case"camera":o=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(r,o)}return o}getDependencies(t){let e=this.cache.get(t);if(!e){let r=this,o=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(o.map(function(i,s){return r.getDependency(t,s)})),this.cache.add(t,e)}return e}loadBuffer(t){let e=this.json.buffers[t],r=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[$.KHR_BINARY_GLTF].body);let o=this.options;return new Promise(function(i,s){r.load(On.resolveURL(e.uri,o.path),i,void 0,function(){s(new Error('GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){let e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(r){let o=e.byteLength||0,i=e.byteOffset||0;return r.slice(i,i+o)})}loadAccessor(t){let e=this,r=this.json,o=this.json.accessors[t];if(o.bufferView===void 0&&o.sparse===void 0)return Promise.resolve(null);let i=[];return o.bufferView!==void 0?i.push(this.getDependency("bufferView",o.bufferView)):i.push(null),o.sparse!==void 0&&(i.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(i).then(function(s){let p=s[0],c=$h[o.type],u=Si[o.componentType],h=u.BYTES_PER_ELEMENT,x=h*c,b=o.byteOffset||0,w=o.bufferView!==void 0?r.bufferViews[o.bufferView].byteStride:void 0,R=o.normalized===!0,C,M;if(w&&w!==x){let k=Math.floor(b/w),O="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+k+":"+o.count,V=e.cache.get(O);V||(C=new u(p,k*w,o.count*w/h),V=new Pm(C,w/h),e.cache.add(O,V)),M=new Ht(V,c,b%w/h,R)}else p===null?C=new u(o.count*c):C=new u(p,b,o.count*c),M=new cr(C,c,R);if(o.sparse!==void 0){let k=$h.SCALAR,O=Si[o.sparse.indices.componentType],V=o.sparse.indices.byteOffset||0,X=o.sparse.values.byteOffset||0,G=new O(s[1],V,o.sparse.count*k),I=new u(s[2],X,o.sparse.count*c);p!==null&&(M=new cr(M.array.slice(),M.itemSize,M.normalized));for(let F=0,se=G.length;F<se;F++){let ae=G[F];if(M.setX(ae,I[F*c]),c>=2&&M.setY(ae,I[F*c+1]),c>=3&&M.setZ(ae,I[F*c+2]),c>=4&&M.setW(ae,I[F*c+3]),c>=5)throw new Error("GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return M})}loadTexture(t){let e=this.json,r=this.options,o=e.textures[t],i=e.images[o.source],s=this.textureLoader;if(i.uri){let p=r.manager.getHandler(i.uri);p!==null&&(s=p)}return this.loadTextureImage(t,i,s)}loadTextureImage(t,e,r){let o=this,i=this.json,s=this.options,p=i.textures[t],c=(e.uri||e.bufferView)+":"+p.sampler;if(this.textureCache[c])return this.textureCache[c];let u=self.URL||self.webkitURL,h=e.uri||"",x=!1;if(e.bufferView!==void 0)h=o.getDependency("bufferView",e.bufferView).then(function(w){x=!0;let R=new Blob([w],{type:e.mimeType});return h=u.createObjectURL(R),h});else if(e.uri===void 0)throw new Error("GLTFLoader: Image "+t+" is missing URI and bufferView");let b=Promise.resolve(h).then(function(w){return new Promise(function(R,C){let M=R;r.isImageBitmapLoader===!0&&(M=function(k){let O=new fi(k);O.needsUpdate=!0,R(O)}),r.load(On.resolveURL(w,s.path),M,void 0,C)})}).then(function(w){x===!0&&u.revokeObjectURL(h),w.flipY=!1,p.name&&(w.name=p.name);let C=(i.samplers||{})[p.sampler]||{};return w.magFilter=Yh[C.magFilter]||wp,w.minFilter=Yh[C.minFilter]||Ep,w.wrapS=Jh[C.wrapS]||Zs,w.wrapT=Jh[C.wrapT]||Zs,o.associations.set(w,{textures:t}),w}).catch(function(){return console.error("GLTFLoader: Couldn't load texture",h),null});return this.textureCache[c]=b,b}assignTexture(t,e,r){let o=this;return this.getDependency("texture",r.index).then(function(i){if(r.texCoord!==void 0&&r.texCoord!=0&&!(e==="aoMap"&&r.texCoord==1)&&console.warn("GLTFLoader: Custom UV set "+r.texCoord+" for texture "+e+" not yet supported."),o.extensions[$.KHR_TEXTURE_TRANSFORM]){let s=r.extensions!==void 0?r.extensions[$.KHR_TEXTURE_TRANSFORM]:void 0;if(s){let p=o.associations.get(i);i=o.extensions[$.KHR_TEXTURE_TRANSFORM].extendTexture(i,s),o.associations.set(i,p)}}return t[e]=i,i})}assignFinalMaterial(t){let e=t.geometry,r=t.material,o=e.attributes.tangent===void 0,i=e.attributes.color!==void 0,s=e.attributes.normal===void 0;if(t.isPoints){let p="PointsMaterial:"+r.uuid,c=this.cache.get(p);c||(c=new Wm,Ys.prototype.copy.call(c,r),c.color.copy(r.color),c.map=r.map,c.sizeAttenuation=!1,this.cache.add(p,c)),r=c}else if(t.isLine){let p="LineBasicMaterial:"+r.uuid,c=this.cache.get(p);c||(c=new yp,Ys.prototype.copy.call(c,r),c.color.copy(r.color),this.cache.add(p,c)),r=c}if(o||i||s){let p="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(p+="specular-glossiness:"),o&&(p+="derivative-tangents:"),i&&(p+="vertex-colors:"),s&&(p+="flat-shading:");let c=this.cache.get(p);c||(c=r.clone(),i&&(c.vertexColors=!0),s&&(c.flatShading=!0),o&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(p,c),this.associations.set(c,this.associations.get(r))),r=c}r.aoMap&&e.attributes.uv2===void 0&&e.attributes.uv!==void 0&&e.setAttribute("uv2",e.attributes.uv),t.material=r}getMaterialType(){return po}loadMaterial(t){let e=this,r=this.json,o=this.extensions,i=r.materials[t],s,p={},c=i.extensions||{},u=[];if(c[$.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){let x=o[$.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=x.getMaterialType(),u.push(x.extendParams(p,i,e))}else if(c[$.KHR_MATERIALS_UNLIT]){let x=o[$.KHR_MATERIALS_UNLIT];s=x.getMaterialType(),u.push(x.extendParams(p,i,e))}else{let x=i.pbrMetallicRoughness||{};if(p.color=new we(1,1,1),p.opacity=1,Array.isArray(x.baseColorFactor)){let b=x.baseColorFactor;p.color.fromArray(b),p.opacity=b[3]}x.baseColorTexture!==void 0&&u.push(e.assignTexture(p,"map",x.baseColorTexture)),p.metalness=x.metallicFactor!==void 0?x.metallicFactor:1,p.roughness=x.roughnessFactor!==void 0?x.roughnessFactor:1,x.metallicRoughnessTexture!==void 0&&(u.push(e.assignTexture(p,"metalnessMap",x.metallicRoughnessTexture)),u.push(e.assignTexture(p,"roughnessMap",x.metallicRoughnessTexture))),s=this._invokeOne(function(b){return b.getMaterialType&&b.getMaterialType(t)}),u.push(Promise.all(this._invokeAll(function(b){return b.extendMaterialParams&&b.extendMaterialParams(t,p)})))}i.doubleSided===!0&&(p.side=bm);let h=i.alphaMode||$p.OPAQUE;if(h===$p.BLEND?(p.transparent=!0,p.depthWrite=!1):(p.transparent=!1,h===$p.MASK&&(p.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&s!==Ye&&(u.push(e.assignTexture(p,"normalMap",i.normalTexture)),p.normalScale=new Ie(1,1),i.normalTexture.scale!==void 0)){let x=i.normalTexture.scale;p.normalScale.set(x,x)}return i.occlusionTexture!==void 0&&s!==Ye&&(u.push(e.assignTexture(p,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(p.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&s!==Ye&&(p.emissive=new we().fromArray(i.emissiveFactor)),i.emissiveTexture!==void 0&&s!==Ye&&u.push(e.assignTexture(p,"emissiveMap",i.emissiveTexture)),Promise.all(u).then(function(){let x;return s===Ti?x=o[$.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(p):x=new s(p),i.name&&(x.name=i.name),x.map&&(x.map.encoding=na),x.emissiveMap&&(x.emissiveMap.encoding=na),Ar(x,i),e.associations.set(x,{materials:t}),i.extensions&&Ei(o,x,i),x})}createUniqueName(t){let e=qm.sanitizeNodeName(t||""),r=e;for(let o=1;this.nodeNamesUsed[r];++o)r=e+"_"+o;return this.nodeNamesUsed[r]=!0,r}loadGeometries(t){let e=this,r=this.extensions,o=this.primitiveCache;function i(p){return r[$.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(p,e).then(function(c){return ef(c,p,e)})}let s=[];for(let p=0,c=t.length;p<c;p++){let u=t[p],h=MA(u),x=o[h];if(x)s.push(x.promise);else{let b;u.extensions&&u.extensions[$.KHR_DRACO_MESH_COMPRESSION]?b=i(u):b=ef(new Ws,u,e),o[h]={primitive:u,promise:b},s.push(b)}}return Promise.all(s)}loadMesh(t){let e=this,r=this.json,o=this.extensions,i=r.meshes[t],s=i.primitives,p=[];for(let c=0,u=s.length;c<u;c++){let h=s[c].material===void 0?EA(this.cache):this.getDependency("material",s[c].material);p.push(h)}return p.push(e.loadGeometries(s)),Promise.all(p).then(function(c){let u=c.slice(0,c.length-1),h=c[c.length-1],x=[];for(let w=0,R=h.length;w<R;w++){let C=h[w],M=s[w],k,O=u[w];if(M.mode===ln.TRIANGLES||M.mode===ln.TRIANGLE_STRIP||M.mode===ln.TRIANGLE_FAN||M.mode===void 0)k=i.isSkinnedMesh===!0?new Jm(C,O):new Pt(C,O),k.isSkinnedMesh===!0&&!k.geometry.attributes.skinWeight.normalized&&k.normalizeSkinWeights(),M.mode===ln.TRIANGLE_STRIP?k.geometry=tf(k.geometry,th):M.mode===ln.TRIANGLE_FAN&&(k.geometry=tf(k.geometry,Sp));else if(M.mode===ln.LINES)k=new km(C,O);else if(M.mode===ln.LINE_STRIP)k=new Im(C,O);else if(M.mode===ln.LINE_LOOP)k=new Lm(C,O);else if(M.mode===ln.POINTS)k=new jm(C,O);else throw new Error("GLTFLoader: Primitive mode unsupported: "+M.mode);Object.keys(k.geometry.morphAttributes).length>0&&SA(k,i),k.name=e.createUniqueName(i.name||"mesh_"+t),Ar(k,i),M.extensions&&Ei(o,k,M),e.assignFinalMaterial(k),x.push(k)}for(let w=0,R=x.length;w<R;w++)e.associations.set(x[w],{meshes:t,primitives:w});if(x.length===1)return x[0];let b=new Ks;e.associations.set(b,{meshes:t});for(let w=0,R=x.length;w<R;w++)b.add(x[w]);return b})}loadCamera(t){let e,r=this.json.cameras[t],o=r[r.type];if(!o){console.warn("GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?e=new mi(Js.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):r.type==="orthographic"&&(e=new zm(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),r.name&&(e.name=this.createUniqueName(r.name)),Ar(e,r),Promise.resolve(e)}loadSkin(t){let e=this.json.skins[t],r={joints:e.joints};return e.inverseBindMatrices===void 0?Promise.resolve(r):this.getDependency("accessor",e.inverseBindMatrices).then(function(o){return r.inverseBindMatrices=o,r})}loadAnimation(t){let r=this.json.animations[t],o=[],i=[],s=[],p=[],c=[];for(let u=0,h=r.channels.length;u<h;u++){let x=r.channels[u],b=r.samplers[x.sampler],w=x.target,R=w.node!==void 0?w.node:w.id,C=r.parameters!==void 0?r.parameters[b.input]:b.input,M=r.parameters!==void 0?r.parameters[b.output]:b.output;o.push(this.getDependency("node",R)),i.push(this.getDependency("accessor",C)),s.push(this.getDependency("accessor",M)),p.push(b),c.push(w)}return Promise.all([Promise.all(o),Promise.all(i),Promise.all(s),Promise.all(p),Promise.all(c)]).then(function(u){let h=u[0],x=u[1],b=u[2],w=u[3],R=u[4],C=[];for(let k=0,O=h.length;k<O;k++){let V=h[k],X=x[k],G=b[k],I=w[k],F=R[k];if(V===void 0)continue;V.updateMatrix(),V.matrixAutoUpdate=!0;let se;switch(Fn[F.path]){case Fn.weights:se=Hm;break;case Fn.rotation:se=Tp;break;case Fn.position:case Fn.scale:default:se=nh;break}let ae=V.name?V.name:V.uuid,q=I.interpolation!==void 0?wA[I.interpolation]:bp,ie=[];Fn[F.path]===Fn.weights?V.traverse(function(Ae){Ae.morphTargetInfluences&&ie.push(Ae.name?Ae.name:Ae.uuid)}):ie.push(ae);let Te=G.array;if(G.normalized){let Ae=gc(Te.constructor),le=new Float32Array(Te.length);for(let ot=0,Or=Te.length;ot<Or;ot++)le[ot]=Te[ot]*Ae;Te=le}for(let Ae=0,le=ie.length;Ae<le;Ae++){let ot=new se(ie[Ae]+"."+Fn[F.path],X.array,Te,q);I.interpolation==="CUBICSPLINE"&&(ot.createInterpolant=function(gn){let Yt=this instanceof Tp?fc:pn;return new Yt(this.times,this.values,this.getValueSize()/3,gn)},ot.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),C.push(ot)}}let M=r.name?r.name:"animation_"+t;return new dm(M,void 0,C)})}createNodeMesh(t){let e=this.json,r=this,o=e.nodes[t];return o.mesh===void 0?null:r.getDependency("mesh",o.mesh).then(function(i){let s=r._getNodeRef(r.meshCache,o.mesh,i);return o.weights!==void 0&&s.traverse(function(p){if(!!p.isMesh)for(let c=0,u=o.weights.length;c<u;c++)p.morphTargetInfluences[c]=o.weights[c]}),s})}loadNode(t){let e=this.json,r=this.extensions,o=this,i=e.nodes[t],s=i.name?o.createUniqueName(i.name):"";return function(){let p=[],c=o._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(t)});return c&&p.push(c),i.camera!==void 0&&p.push(o.getDependency("camera",i.camera).then(function(u){return o._getNodeRef(o.cameraCache,i.camera,u)})),o._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(t)}).forEach(function(u){p.push(u)}),Promise.all(p)}().then(function(p){let c;if(i.isBone===!0?c=new mm:p.length>1?c=new Ks:p.length===1?c=p[0]:c=new qe,c!==p[0])for(let u=0,h=p.length;u<h;u++)c.add(p[u]);if(i.name&&(c.userData.name=i.name,c.name=s),Ar(c,i),i.extensions&&Ei(r,c,i),i.matrix!==void 0){let u=new Oe;u.fromArray(i.matrix),c.applyMatrix4(u)}else i.translation!==void 0&&c.position.fromArray(i.translation),i.rotation!==void 0&&c.quaternion.fromArray(i.rotation),i.scale!==void 0&&c.scale.fromArray(i.scale);return o.associations.has(c)||o.associations.set(c,{}),o.associations.get(c).nodes=t,c})}loadScene(t){let e=this.json,r=this.extensions,o=this.json.scenes[t],i=this,s=new Ks;o.name&&(s.name=i.createUniqueName(o.name)),Ar(s,o),o.extensions&&Ei(r,s,o);let p=o.nodes||[],c=[];for(let u=0,h=p.length;u<h;u++)c.push(rf(p[u],s,e,i));return Promise.all(c).then(function(){let u=h=>{let x=new Map;for(let[b,w]of i.associations)(b instanceof Ys||b instanceof fi)&&x.set(b,w);return h.traverse(b=>{let w=i.associations.get(b);w!=null&&x.set(b,w)}),x};return i.associations=u(s),s})}};function rf(n,t,e,r){let o=e.nodes[n];return r.getDependency("node",n).then(function(i){if(o.skin===void 0)return i;let s;return r.getDependency("skin",o.skin).then(function(p){s=p;let c=[];for(let u=0,h=s.joints.length;u<h;u++)c.push(r.getDependency("node",s.joints[u]));return Promise.all(c)}).then(function(p){return i.traverse(function(c){if(!c.isMesh)return;let u=[],h=[];for(let x=0,b=p.length;x<b;x++){let w=p[x];if(w){u.push(w);let R=new Oe;s.inverseBindMatrices!==void 0&&R.fromArray(s.inverseBindMatrices.array,x*16),h.push(R)}else console.warn('GLTFLoader: Joint "%s" could not be found.',s.joints[x])}c.bind(new Ym(u,h),c.matrixWorld)}),i})}).then(function(i){t.add(i);let s=[];if(o.children){let p=o.children;for(let c=0,u=p.length;c<u;c++){let h=p[c];s.push(rf(h,i,e,r))}}return Promise.all(s)})}function PA(n,t,e){let r=t.attributes,o=new pr;if(r.POSITION!==void 0){let p=e.json.accessors[r.POSITION],c=p.min,u=p.max;if(c!==void 0&&u!==void 0){if(o.set(new D(c[0],c[1],c[2]),new D(u[0],u[1],u[2])),p.normalized){let h=gc(Si[p.componentType]);o.min.multiplyScalar(h),o.max.multiplyScalar(h)}}else{console.warn("GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let i=t.targets;if(i!==void 0){let p=new D,c=new D;for(let u=0,h=i.length;u<h;u++){let x=i[u];if(x.POSITION!==void 0){let b=e.json.accessors[x.POSITION],w=b.min,R=b.max;if(w!==void 0&&R!==void 0){if(c.setX(Math.max(Math.abs(w[0]),Math.abs(R[0]))),c.setY(Math.max(Math.abs(w[1]),Math.abs(R[1]))),c.setZ(Math.max(Math.abs(w[2]),Math.abs(R[2]))),b.normalized){let C=gc(Si[b.componentType]);c.multiplyScalar(C)}p.max(c)}else console.warn("GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(p)}n.boundingBox=o;let s=new co;o.getCenter(s.center),s.radius=o.min.distanceTo(o.max)/2,n.boundingSphere=s}function ef(n,t,e){let r=t.attributes,o=[];function i(s,p){return e.getDependency("accessor",s).then(function(c){n.setAttribute(p,c)})}for(let s in r){let p=xc[s]||s.toLowerCase();p in n.attributes||o.push(i(r[s],p))}if(t.indices!==void 0&&!n.index){let s=e.getDependency("accessor",t.indices).then(function(p){n.setIndex(p)});o.push(s)}return Ar(n,t),PA(n,t,e),Promise.all(o).then(function(){return t.targets!==void 0?TA(n,t.targets,e):n})}function tf(n,t){let e=n.getIndex();if(e===null){let s=[],p=n.getAttribute("position");if(p!==void 0){for(let c=0;c<p.count;c++)s.push(c);n.setIndex(s),e=n.getIndex()}else return console.error("GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}let r=e.count-2,o=[];if(t===Sp)for(let s=1;s<=r;s++)o.push(e.getX(0)),o.push(e.getX(s)),o.push(e.getX(s+1));else for(let s=0;s<r;s++)s%2===0?(o.push(e.getX(s)),o.push(e.getX(s+1)),o.push(e.getX(s+2))):(o.push(e.getX(s+2)),o.push(e.getX(s+1)),o.push(e.getX(s)));o.length/3!==r&&console.error("GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let i=n.clone();return i.setIndex(o),i}var ve={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function of(n){let t=await fetch(n);if(t.ok)return t.json();throw new Error(t.statusText)}async function CA(n){if(!n)throw new Error("No basePath supplied");return await of(`${n}/profilesList.json`)}async function sf(n,t,e=null,r=!0){if(!n)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");let o=await CA(t),i;if(n.profiles.some(c=>{let u=o[c];return u&&(i={profileId:c,profilePath:`${t}/${u.path}`,deprecated:!!u.deprecated}),!!i}),!i){if(!e)throw new Error("No matching profile name found");let c=o[e];if(!c)throw new Error(`No matching profile name found and default profile "${e}" missing.`);i={profileId:e,profilePath:`${t}/${c.path}`,deprecated:!!c.deprecated}}let s=await of(i.profilePath),p;if(r){let c;if(n.handedness==="any"?c=s.layouts[Object.keys(s.layouts)[0]]:c=s.layouts[n.handedness],!c)throw new Error(`No matching handedness, ${n.handedness}, in profile ${i.profileId}`);c.assetPath&&(p=i.profilePath.replace("profile.json",c.assetPath))}return{profile:s,assetPath:p}}var RA={xAxis:0,yAxis:0,button:0,state:ve.ComponentState.DEFAULT};function IA(n=0,t=0){let e=n,r=t;if(Math.sqrt(n*n+t*t)>1){let s=Math.atan2(t,n);e=Math.cos(s),r=Math.sin(s)}return{normalizedXAxis:e*.5+.5,normalizedYAxis:r*.5+.5}}var Ac=class{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===ve.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(RA)}updateFromComponent({xAxis:t,yAxis:e,button:r,state:o}){let{normalizedXAxis:i,normalizedYAxis:s}=IA(t,e);switch(this.componentProperty){case ve.ComponentProperty.X_AXIS:this.value=this.states.includes(o)?i:.5;break;case ve.ComponentProperty.Y_AXIS:this.value=this.states.includes(o)?s:.5;break;case ve.ComponentProperty.BUTTON:this.value=this.states.includes(o)?r:0;break;case ve.ComponentProperty.STATE:this.valueNodeProperty===ve.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(o):this.value=this.states.includes(o)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},_c=class{constructor(t,e){if(!t||!e||!e.visualResponses||!e.gamepadIndices||Object.keys(e.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach(r=>{let o=new Ac(e.visualResponses[r]);this.visualResponses[r]=o}),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:ve.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(t){if(this.values.state=ve.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&t.buttons.length>this.gamepadIndices.button){let e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||this.values.button===1?this.values.state=ve.ComponentState.PRESSED:(e.touched||this.values.button>ve.ButtonTouchThreshold)&&(this.values.state=ve.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===ve.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>ve.AxisTouchThreshold&&(this.values.state=ve.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===ve.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>ve.AxisTouchThreshold&&(this.values.state=ve.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}},ka=class{constructor(t,e,r){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=r,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(o=>{let i=this.layoutDescription.components[o];this.components[o]=new _c(o,i)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let t=[];return Object.values(this.components).forEach(e=>{t.push(e.data)}),t}updateFromGamepad(){Object.values(this.components).forEach(t=>{t.updateFromGamepad(this.xrInputSource.gamepad)})}};var VA="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",LA="generic-trigger",bc=class extends qe{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(t){return this.envMap==t?this:(this.envMap=t,this.traverse(e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}),this)}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(r=>{let{valueNode:o,minNode:i,maxNode:s,value:p,valueNodeProperty:c}=r;!o||(c===ve.VisualResponseProperty.VISIBILITY?o.visible=p:c===ve.VisualResponseProperty.TRANSFORM&&(o.quaternion.slerpQuaternions(i.quaternion,s.quaternion,p),o.position.lerpVectors(i.position,s.position,p)))})}))}};function kA(n,t){Object.values(n.components).forEach(e=>{let{type:r,touchPointNodeName:o,visualResponses:i}=e;if(r===ve.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(o),e.touchPointNode){let s=new ta(.001),p=new Ye({color:255}),c=new Pt(s,p);e.touchPointNode.add(c)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(i).forEach(s=>{let{valueNodeName:p,minNodeName:c,maxNodeName:u,valueNodeProperty:h}=s;if(h===ve.VisualResponseProperty.TRANSFORM){if(s.minNode=t.getObjectByName(c),s.maxNode=t.getObjectByName(u),!s.minNode){console.warn(`Could not find ${c} in the model`);return}if(!s.maxNode){console.warn(`Could not find ${u} in the model`);return}}s.valueNode=t.getObjectByName(p),s.valueNode||console.warn(`Could not find ${p} in the model`)})})}function af(n,t){kA(n.motionController,t),n.envMap&&t.traverse(e=>{e.isMesh&&(e.material.envMap=n.envMap,e.material.needsUpdate=!0)}),n.add(t)}var Ba=class{constructor(t=null){this.gltfLoader=t,this.path=VA,this._assetCache={},this.gltfLoader||(this.gltfLoader=new Nn)}createControllerModel(t){let e=new bc,r=null;return t.addEventListener("connected",o=>{let i=o.data;i.targetRayMode!=="tracked-pointer"||!i.gamepad||sf(i,this.path,LA).then(({profile:s,assetPath:p})=>{e.motionController=new ka(i,s,p);let c=this._assetCache[e.motionController.assetUrl];if(c)r=c.scene.clone(),af(e,r);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(e.motionController.assetUrl,u=>{this._assetCache[e.motionController.assetUrl]=u,r=u.scene.clone(),af(e,r)},null,()=>{throw new Error(`Asset ${e.motionController.assetUrl} missing or malformed.`)})}}).catch(s=>{console.warn(s)})}),t.addEventListener("disconnected",()=>{e.motionController=null,e.remove(r),r=null}),e}};var yc=new Oe,lf=new D,pf=new Oe().identity(),cf=new Oe().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(pf.makeRotationY(Math.PI/2),cf.makeRotationY(-Math.PI/2));var So=class{constructor(t,e,r,o,i){this.controller=e,this.handModel=t,this.envMap=null,this.oculusBrowserV14Correction=o==="left"?cf:pf;let s;!i||!i.primitive||i.primitive==="sphere"?s=new ta(1,10,10):i.primitive==="box"?s=new fm(1,1,1):i.primitive==="bone"&&(s=new _m(.5,.75,2.25,10,1).rotateX(-Math.PI/2));let p=new po;this.handMesh=new Mm(s,p,30),this.handMesh.instanceMatrix.setUsage(ym),this.handMesh.castShadow=!0,this.handMesh.receiveShadow=!0,this.handModel.add(this.handMesh),this.joints=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]}updateMesh(){let e=this.controller.joints,r=0;for(let o=0;o<this.joints.length;o++){let i=e[this.joints[o]];i.visible&&(lf.setScalar(i.jointRadius||.008),yc.compose(i.position,i.quaternion,lf),yc.multiply(this.oculusBrowserV14Correction),this.handMesh.setMatrixAt(o,yc),r++)}this.handMesh.count=r,this.handMesh.instanceMatrix.needsUpdate=!0}};var wc=new de().identity(),df=new de().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(wc.setFromAxisAngle({x:0,y:1,z:0},Math.PI/2),df.setFromAxisAngle({x:1,y:0,z:0},Math.PI).premultiply(wc));var BA="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/",Oa=class{constructor(t,e,r,o){this.controller=e,this.handModel=t,this.oculusBrowserV14Correction=o==="left"?df:wc,this.bones=[];let i=new Nn;i.setPath(r||BA),i.load(`${o}.glb`,s=>{let p=s.scene.children[0];this.handModel.add(p);let c=p.getObjectByProperty("type","SkinnedMesh");c.frustumCulled=!1,c.castShadow=!0,c.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(h=>{let x=p.getObjectByName(h);x!==void 0?x.jointName=h:console.warn(`Couldn't find ${h} in ${o} hand mesh`),this.bones.push(x)})})}updateMesh(){let t=this.controller.joints;for(let e=0;e<this.bones.length;e++){let r=this.bones[e];if(r){let o=t[r.jointName];if(o.visible){let i=o.position;r&&(r.position.copy(i),r.quaternion.copy(o.quaternion).multiply(this.oculusBrowserV14Correction))}}}}};var Ec=class extends qe{constructor(t){super(),this.controller=t,this.motionController=null,this.envMap=null,this.mesh=null}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&this.motionController.updateMesh()}},Da=class{constructor(){this.path=null}setPath(t){return this.path=t,this}createHandModel(t,e){let r=new Ec(t);return t.addEventListener("connected",o=>{let i=o.data;i.hand&&!r.motionController&&(r.xrInputSource=i,e===void 0||e==="spheres"?r.motionController=new So(r,t,this.path,i.handedness,{primitive:"sphere"}):e==="boxes"?r.motionController=new So(r,t,this.path,i.handedness,{primitive:"box"}):e==="bones"?r.motionController=new So(r,t,this.path,i.handedness,{primitive:"bone"}):e==="mesh"&&(r.motionController=new Oa(r,t,this.path,i.handedness)))}),t.addEventListener("disconnected",()=>{}),r}};function uf(n){let t=n.attributes.position,e=n.attributes.normal,r=n.attributes.uv;for(let o=0;o<e.count;++o){let i=o*e.itemSize,s=o*e.itemSize+1,p=o*e.itemSize+2,c=e.array[i],u=e.array[s],h=e.array[p],x=Math.abs(c),b=Math.abs(u),w=Math.abs(h),R=t.array[i],C=t.array[s],M=t.array[p],k=Math.abs(R),O=Math.abs(C),V=Math.abs(M),X=o*r.itemSize,G=o*r.itemSize+1,I=r.array[X],F=r.array[G],se=0,ae=x,q=k;b>ae&&(se=1,ae=b,q=O),w>ae&&(se=2,ae=w,q=V),se===0?R<0?(I=-M,F=C):(I=M,F=C):se===1?C<0?(I=R,F=-M):(I=R,F=M):M<0?(I=R,F=C):(I=-R,F=C),I=(I/q+1)/8,F=(F/q+1)/6,se===0?R<0?(I+=0,F+=1/3):(I+=.5,F+=1/3):se===1?C<0?(I+=.25,F+=0):(I+=.25,F+=2/3):M<0?(I+=.25,F+=1/3):(I+=.75,F+=1/3);let ie=r.array;ie[X]=I,ie[G]=F}}var Mi=new hm(1,1,1,1,1,1);Mi.name="CubeGeom";var mf=Mi.clone();mf.name="InvertedCubeGeom";uf(mf);var _r=class extends Pt{constructor(t,e,r,o){super(Mi,o),this.scale.set(t,e,r)}};var Mo=class extends Ut{constructor(e){super(e);this.material=fh({name:"CursorMat",color:16776960}),this.object=new _r(.01,.01,.01,this.material)}get position(){return this.object.position}get style(){return this._currentStyle}set style(e){if(this._currentStyle=e,Dn(this.object)&&!tt(this.object.material))switch(this._currentStyle){case"pointer":this.material.color=new we(65280),this.material.needsUpdate=!0;break;case"not-allowed":this.material.color=new we(16711680),this.material.needsUpdate=!0;break;case"move":this.material.color=new we(255),this.material.needsUpdate=!0;break;case"grab":this.material.color=new we(16711935),this.material.needsUpdate=!0;break;case"grabbing":this.material.color=new we(65535),this.material.needsUpdate=!0;break;default:this._currentStyle="default",this.material.color=new we(16776960),this.material.needsUpdate=!0;break}}get visible(){return uo(this)}set visible(e){De(this,e)}};var hf=new pr,Fa=new D,br=class extends Sm{constructor(){super(),this.type="LineSegmentsGeometry";let t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],r=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(r),this.setAttribute("position",new _p(t,3)),this.setAttribute("uv",new _p(e,2))}applyMatrix4(t){let e=this.attributes.instanceStart,r=this.attributes.instanceEnd;return e!==void 0&&(e.applyMatrix4(t),r.applyMatrix4(t),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let r=new ui(e,6,1);return this.setAttribute("instanceStart",new Ht(r,3,0)),this.setAttribute("instanceEnd",new Ht(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let r=new ui(e,6,1);return this.setAttribute("instanceColorStart",new Ht(r,3,0)),this.setAttribute("instanceColorEnd",new Ht(r,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new sh(t.geometry)),this}fromLineSegments(t){let e=t.geometry;if(e.isGeometry){console.error("LineSegmentsGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new pr);let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;t!==void 0&&e!==void 0&&(this.boundingBox.setFromBufferAttribute(t),hf.setFromBufferAttribute(e),this.boundingBox.union(hf))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new co),this.boundingBox===null&&this.computeBoundingBox();let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(t!==void 0&&e!==void 0){let r=this.boundingSphere.center;this.boundingBox.getCenter(r);let o=0;for(let i=0,s=t.count;i<s;i++)Fa.fromBufferAttribute(t,i),o=Math.max(o,r.distanceToSquared(Fa)),Fa.fromBufferAttribute(e,i),o=Math.max(o,r.distanceToSquared(Fa));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(t){return console.warn("LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}};br.prototype.isLineSegmentsGeometry=!0;var ff=new D,xf=new D,Xe=new zt,Ge=new zt,jt=new zt,Tc=new D,Sc=new Oe,At=new Vm,gf=new D,cn=new pr,Na=new co,Wt=new zt;function vf(n,t,e,r){return Wt.set(0,0,-t,1).applyMatrix4(n.projectionMatrix),Wt.multiplyScalar(1/Wt.w),Wt.x=e/r.width,Wt.y=e/r.height,Wt.applyMatrix4(n.projectionMatrixInverse),Wt.multiplyScalar(1/Wt.w),Math.abs(Math.max(Wt.x,Wt.y))}var Pi=class extends Pt{constructor(t=new br,e=new an({color:Math.random()*16777215})){super(t,e),this.type="LineSegments2"}computeLineDistances(){let t=this.geometry,e=t.attributes.instanceStart,r=t.attributes.instanceEnd,o=new Float32Array(2*e.count);for(let s=0,p=0,c=e.count;s<c;s++,p+=2)ff.fromBufferAttribute(e,s),xf.fromBufferAttribute(r,s),o[p]=p===0?0:o[p-1],o[p+1]=o[p]+ff.distanceTo(xf);let i=new ui(o,2,1);return t.setAttribute("instanceDistanceStart",new Ht(i,1,0)),t.setAttribute("instanceDistanceEnd",new Ht(i,1,1)),this}raycast(t,e){t.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');let r=t.params.Line2!==void 0&&t.params.Line2.threshold||0,o=t.ray,i=t.camera,s=i.projectionMatrix,p=this.matrixWorld,c=this.geometry,u=this.material,h=u.resolution,x=u.linewidth+r,b=c.attributes.instanceStart,w=c.attributes.instanceEnd,R=-i.near;c.boundingSphere===null&&c.computeBoundingSphere(),Na.copy(c.boundingSphere).applyMatrix4(p);let C=Math.max(i.near,Na.distanceToPoint(o.origin)),M=vf(i,C,x,h);if(Na.radius+=M,t.ray.intersectsSphere(Na)===!1)return;c.boundingBox===null&&c.computeBoundingBox(),cn.copy(c.boundingBox).applyMatrix4(p);let k=Math.max(i.near,cn.distanceToPoint(o.origin)),O=vf(i,k,x,h);if(cn.max.x+=O,cn.max.y+=O,cn.max.z+=O,cn.min.x-=O,cn.min.y-=O,cn.min.z-=O,t.ray.intersectsBox(cn)!==!1){o.at(1,jt),jt.w=1,jt.applyMatrix4(i.matrixWorldInverse),jt.applyMatrix4(s),jt.multiplyScalar(1/jt.w),jt.x*=h.x/2,jt.y*=h.y/2,jt.z=0,Tc.copy(jt),Sc.multiplyMatrices(i.matrixWorldInverse,p);for(let X=0,G=b.count;X<G;X++){Xe.fromBufferAttribute(b,X),Ge.fromBufferAttribute(w,X),Xe.w=1,Ge.w=1,Xe.applyMatrix4(Sc),Ge.applyMatrix4(Sc);var V=Xe.z>R&&Ge.z>R;if(V)continue;if(Xe.z>R){let q=Xe.z-Ge.z,ie=(Xe.z-R)/q;Xe.lerp(Ge,ie)}else if(Ge.z>R){let q=Ge.z-Xe.z,ie=(Ge.z-R)/q;Ge.lerp(Xe,ie)}Xe.applyMatrix4(s),Ge.applyMatrix4(s),Xe.multiplyScalar(1/Xe.w),Ge.multiplyScalar(1/Ge.w),Xe.x*=h.x/2,Xe.y*=h.y/2,Ge.x*=h.x/2,Ge.y*=h.y/2,At.start.copy(Xe),At.start.z=0,At.end.copy(Ge),At.end.z=0;let I=At.closestPointToPointParameter(Tc,!0);At.at(I,gf);let F=Js.lerp(Xe.z,Ge.z,I),se=F>=-1&&F<=1,ae=Tc.distanceTo(gf)<x*.5;if(se&&ae){At.start.fromBufferAttribute(b,X),At.end.fromBufferAttribute(w,X),At.start.applyMatrix4(p),At.end.applyMatrix4(p);let q=new D,ie=new D;o.distanceSqToSegment(At.start,At.end,ie,q),e.push({point:ie,pointOnLine:q,distance:o.origin.distanceTo(ie),object:this,face:null,faceIndex:X,uv:null,uv2:null})}}}}};Pi.prototype.isLineSegments2=!0;var yr=class extends br{constructor(){super(),this.type="LineGeometry"}setPositions(t){for(var e=t.length-3,r=new Float32Array(2*e),o=0;o<e;o+=3)r[2*o]=t[o],r[2*o+1]=t[o+1],r[2*o+2]=t[o+2],r[2*o+3]=t[o+3],r[2*o+4]=t[o+4],r[2*o+5]=t[o+5];return super.setPositions(r),this}setColors(t){for(var e=t.length-3,r=new Float32Array(2*e),o=0;o<e;o+=3)r[2*o]=t[o],r[2*o+1]=t[o+1],r[2*o+2]=t[o+2],r[2*o+3]=t[o+3],r[2*o+4]=t[o+4],r[2*o+5]=t[o+5];return super.setColors(r),this}fromLine(t){var e=t.geometry;if(e.isGeometry){console.error("LineGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}};yr.prototype.isLineGeometry=!0;var Ci=class extends Pi{constructor(t=new yr,e=new an({color:Math.random()*16777215})){super(t,e),this.type="Line2"}};Ci.prototype.isLine2=!0;var Af=new yr;Af.setPositions([0,0,0,0,0,-1]);var Xa=class extends qe{constructor(e,r=1){super();this._length=1;this.line=new Ci(Af,gh({color:e,linewidth:r})),this.line.computeLineDistances(),j(this,this.line)}get length(){return this._length}set length(e){this._length=e,this.line.scale.set(1,1,e)}};var Ga=class extends Ut{constructor(e,r){super(e);this.element=r;this._hidden=!1;this.visible=!0,this.style="default",document.addEventListener("pointerlockchange",()=>{this._hidden=!!document.pointerLockElement,this.refresh()})}get position(){throw new Error("BaseCursor::get_Position(): Method not implemented.")}get style(){return super.style}set style(e){super.style=e,this.refresh()}get visible(){return super.visible&&!this._hidden}set visible(e){super.visible=e,this.refresh()}refresh(){this.element.style.cursor=this.visible?this.style:"none"}};var Po=class extends Ut{constructor(e){super(e);this.xr=e.cursor3D&&e.cursor3D.clone()||new Mo(this.env),this.system=new Ga(this.env,this.env.renderer.domElement),this.xr.side=this.side,this.visible=!1,Object.seal(this)}get object(){return this.xr.object}get side(){return this.xr.side}set side(e){this.xr.side=e}get cursor(){return this.xr}set cursor(e){this.xr=e,this._refresh()}get position(){return this.object.position}get style(){return this.system.style}get visible(){return super.visible}set visible(e){super.visible=e,this._refresh()}set style(e){this.system.style=e,this.xr.style=e,this._refresh()}_refresh(){let e=this.env.eventSys&&this.env.eventSys.mouse&&this.env.eventSys.mouse.isPointerLocked,r=this.env.renderer.xr.isPresenting||e;De(this.xr,this.visible&&r),this.system.visible=this.visible&&!r}lookAt(e,r){this.xr.lookAt(e,r)}};var Ha=class extends W{constructor(e,r){super(e);this.pointer=r;this._hit=null;this._point=null;this._distance=Number.POSITIVE_INFINITY;this._rayTarget=null;Object.seal(this)}set(e,r){e!==this.hit&&(this._hit=e,e?(this._point=e.point,this._distance=e.distance):(this._point=null,this._distance=Number.POSITIVE_INFINITY)),this._rayTarget=r}get hit(){return this._hit}get rayTarget(){return this._rayTarget}get point(){return this._point}get distance(){return this._distance}};var OA=5,DA=new D,Co=class extends Y{constructor(e,r,o,i){super();this.type=e;this.id=r;this.env=o;this.origin=new D;this.direction=new D;this.up=new D(0,1,0);this.canMoveView=!1;this.mayTeleport=!1;this.buttons=0;this.isActive=!1;this.moveDistance=0;this.hits=new Array;this.pointerEvents=new Map;this.lastButtons=0;this.canClick=!1;this.dragDistance=0;this._enabled=!1;this._cursor=null;this._curHit=null;this._curTarget=null;this._hoveredHit=null;this._hoveredTarget=null;this._cursor=i,this.cursor&&(this.cursor.visible=!1)}get curHit(){return this._curHit}set curHit(e){if(e!==this.curHit){let r=go(e);this._curHit=e,this._curTarget=r}}get curTarget(){return this._curTarget}get hoveredHit(){return this._hoveredHit}set hoveredHit(e){if(e!==this.hoveredHit){let r=go(e);this._hoveredHit=e,this._hoveredTarget=r}}get name(){return yn[this.id]}get rayTarget(){return this._hoveredTarget}get cursor(){return this._cursor}set cursor(e){if(e!==this.cursor){let r=this.cursor,o=this.cursor&&this.cursor.object&&this.cursor.object.name||"cursor",i=r&&r.object&&r.object.parent;i&&i.remove(r.object),e&&(e.object.name=o,r instanceof Po?(r.cursor=e,i&&j(i,r)):(this._cursor=e,r&&(i&&j(i,e),e.style=r.style,e.visible=r.visible)))}}get needsUpdate(){return this.enabled&&this.isActive}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.cursor&&(this.cursor.visible=e)}setButton(e,r){this.lastButtons=this.buttons;let o=1<<e;if(r?this.buttons|=o:this.buttons&=~o,r)this.canClick=!0,this.dragDistance=0,this.env.avatar.setMode(this),this.setEventState("down");else{if(this.canClick){let i=this.buttons;this.buttons=this.lastButtons,this.setEventState("click"),this.buttons=i}this.setEventState("up")}}isPressed(e){let r=1<<e;return(this.buttons&r)!==0}wasPressed(e){let r=1<<e;return(this.lastButtons&r)!==0}fireRay(e,r){pe(this.hits),this.env.eventSys.fireRay(e,r,this.hits);let o=null,i=Number.MAX_VALUE;for(let s of this.hits)go(s)&&s.distance<i&&(o=s,i=s.distance);return this.curHit=o,!!o}getEvent(e){this.pointerEvents.has(e)||this.pointerEvents.set(e,new Ha(e,this));let r=this.pointerEvents.get(e);if(this.hoveredHit?r.set(this.hoveredHit,this.rayTarget):this.curHit?r.set(this.curHit,this.curTarget):r.set(null,null),r.hit){let o=this.curHit||this.hoveredHit;o&&r.hit!==o&&(r.hit.uv=o.uv)}return r}update(){this.needsUpdate&&this.onUpdate()}onUpdate(){this.updatePointerOrientation();let e=this.isPressed(0);(this.moveDistance>0||e)&&(e&&(this.dragDistance+=this.moveDistance,this.dragDistance>OA&&(this.canClick=!1)),this.setEventState("move")),this.moveDistance=0}setEventState(e){if(this.fireRay(this.origin,this.direction),this.curTarget===this.rayTarget)this.hoveredHit=this.curHit;else{let o=this.isPressed(0),i=this.wasPressed(0);if(e==="move"&&!o||e==="down"&&o&&!i||e==="up"&&!o&&i){if(this.rayTarget){let u=this.getEvent("up");this.rayTarget.dispatchEvent(u);let h=this.getEvent("exit");this.dispatchEvent(h),this.rayTarget.dispatchEvent(h)}if(this.hoveredHit=this.curHit,this.rayTarget){let u=this.getEvent("enter");this.dispatchEvent(u),this.rayTarget.dispatchEvent(u)}}this.hoveredHit&&this.hoveredHit.point.copy(this.direction).multiplyScalar(this.hoveredHit.distance).add(this.origin)}let r=this.getEvent(e);this.dispatchEvent(r),r.rayTarget&&(e!=="click"||r.rayTarget.clickable||r.rayTarget.navigable)&&(e==="click"&&r.rayTarget.clickable&&this.vibrate(),r.rayTarget.enabled&&r.rayTarget.dispatchEvent(r)),this.updateCursor(this.env.avatar.worldPos,DA,!0,2)}get canDragView(){return this.canMoveView}get canTeleport(){return this.mayTeleport}updateCursor(e,r,o,i){this.cursor&&this.cursor.update(e,r,this.hoveredHit||this.curHit,this.rayTarget||this.curTarget,i,o,this.canDragView,this.canTeleport,this.origin,this.direction,this.isPressed(0))}};var FA=new Ba,NA=new Da,XA=new Oe().makeRotationX(-7*Math.PI/9),_f=new Map([["none",4],["left",5],["right",6]]);var bf=new Map([[5,2],[4,3]]),za=class extends Co{constructor(e,r){super("hand",4,e,new Mo(e));this.laser=new Xa(Ip,.002);this._isHand=!1;this.inputSource=null;this._gamepad=new La;this.delta=new D;this.newOrigin=new D;this.quaternion=new de;this.newQuat=new de;this.useHaptics=!0;if(this.mayTeleport=!0,this.object=ue("PointerHand"+r),this.quaternion.identity(),j(this,this.controller=this.env.renderer.xr.getController(r),this.grip=this.env.renderer.xr.getControllerGrip(r),this.hand=this.env.renderer.xr.getHand(r)),Fr()&&md()&&!$t){let s=!1;this.controller.traverse(p=>{p.name.toLocaleLowerCase().indexOf("oculus")>=0&&(s=!0)}),s&&this.laser.matrix.copy(XA)}j(this.controller,this.laser),j(this.grip,FA.createControllerModel(this.controller)),j(this.hand,NA.createHandModel(this.hand,"mesh")),this.gamepad.addEventListener("gamepadaxismaxed",s=>{s.axis===2&&this.env.avatar.snapTurn(s.value)});let o=s=>p=>{bf.has(p.button)&&this.setButton(bf.get(p.button),s)};this.gamepad.addEventListener("gamepadbuttondown",o(!0)),this.gamepad.addEventListener("gamepadbuttonup",o(!1));let i=(s,p)=>()=>this.setButton(s,p);this.controller.addEventListener("selectstart",i(0,!0)),this.controller.addEventListener("selectend",i(0,!1)),this.controller.addEventListener("squeezestart",i(1,!0)),this.controller.addEventListener("squeezeend",i(1,!1)),this.controller.addEventListener("connected",s=>{s.target===this.controller&&(this.inputSource=s.data,this.gamepad.pad=this.inputSource.gamepad,this._isHand=v(this.inputSource.hand),this.id=_f.get(this.handedness),this.grip.visible=!this.isHand,this.controller.visible=!this.isHand,this.hand.visible=this.isHand,this.enabled=!0,this.isActive=!0,this.env.eventSys.checkXRMouse(),this.updateCursorSide(),console.log(this.handedness,"connected"))}),this.controller.addEventListener("disconnected",s=>{s.target===this.controller&&(this.inputSource=null,this.gamepad.pad=null,this._isHand=!1,this.id=_f.get(this.handedness),this.grip.visible=!1,this.controller.visible=!1,this.hand.visible=!1,this.enabled=!1,this.isActive=!1,this.env.eventSys.checkXRMouse(),this.updateCursorSide(),console.log(this.handedness,"disconnected"))}),Object.seal(this)}vibrate(){this._vibrate()}async _vibrate(){if(this.useHaptics&&this.gamepad.hapticActuators)try{await Promise.all(this.gamepad.hapticActuators.map(e=>e.pulse(.25,125)))}catch{this.useHaptics=!1}}get gamepad(){return this._gamepad}get handedness(){return B(this.inputSource)?null:this.inputSource.handedness}get isHand(){return this._isHand}get cursor(){return super.cursor}set cursor(e){super.cursor=e,this.updateCursorSide()}updateCursorSide(){this.cursor.side=this.handedness==="left"?1:-1}updatePointerOrientation(){this.laser.getWorldPosition(this.newOrigin),this.laser.getWorldQuaternion(this.newQuat),this.origin.lerp(this.newOrigin,.9),this.quaternion.slerp(this.newQuat,.9),this.delta.copy(this.origin).add(this.direction),this.direction.set(0,0,-1).applyQuaternion(this.quaternion),this.up.set(0,1,0).applyQuaternion(this.quaternion),this.delta.sub(this.direction).sub(this.origin),this.moveDistance+=50*this.delta.length()}onUpdate(){this.gamepad.pad=this.inputSource&&this.inputSource.gamepad||null,super.onUpdate()}};var Ro=class extends Co{constructor(e,r,o,i){super(e,r,o,i);this.position=new Ie;this.motion=new Ie;this.uv=new Ie;this.duv=new Ie;this.uvComp=new Ie(1,-1);this.uvOff=new Ie(-1,1);this.canMoveView=!0;let s=p=>{this.checkEvent(p)&&this.readEvent(p)};this.element=this.env.renderer.domElement,this.element.addEventListener("pointerdown",s),this.element.addEventListener("pointermove",s),this.element.addEventListener("pointerup",s),this.element.addEventListener("pointercancel",s)}checkEvent(e){return this.isActive=this.onCheckEvent(e)}onCheckEvent(e){return e.pointerType===this.type}readEvent(e){this.checkEvent(e)&&this.onReadEvent(e)}onReadEvent(e){this.updatePointerOrientation()}updatePointerOrientation(){this.element.clientWidth>0&&this.element.clientHeight>0&&(this.uv.copy(this.position),this.uv.x/=this.element.clientWidth,this.uv.y/=this.element.clientHeight,this.uv.multiplyScalar(2).multiply(this.uvComp).add(this.uvOff),this.duv.copy(this.motion),this.duv.x/=this.element.clientWidth,this.duv.y/=this.element.clientHeight,this.duv.multiplyScalar(2).multiply(this.uvComp),this.moveDistance=200*this.duv.length());let e=vr(this.env.renderer,this.env.camera);this.origin.setFromMatrixPosition(e.matrixWorld),this.direction.set(this.uv.x,this.uv.y,.5).unproject(e).sub(this.origin).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat)}onUpdate(){this.env.avatar.onMove(this,this.uv,this.duv),super.onUpdate(),this.motion.setScalar(0),this.duv.setScalar(0)}};var Io=class extends Ro{constructor(e,r,o){let i=c=>{c.pointerType===e&&this.pointerID==null&&(this.pointerID=c.pointerId)},s=c=>{c.pointerType===e&&this.pointerID!=null&&(this.pointerID=null)},p=o.renderer.domElement;p.addEventListener("pointerdown",i),p.addEventListener("pointermove",i);super(e,r,o,new Po(o));this.pointerID=null;p.addEventListener("pointerup",s),p.addEventListener("pointercancel",s)}onCheckEvent(e){return super.onCheckEvent(e)&&e.pointerId===this.pointerID}onReadEvent(e){this.position.set(e.offsetX,e.offsetY),this.motion.x+=e.movementX,this.motion.y+=e.movementY,super.onReadEvent(e),(e.type==="pointerdown"||e.type==="pointerup"||e.type==="pointercancel")&&this.setButton(e.button,e.type==="pointerdown")}};var Ua=class extends Io{constructor(e){super("mouse",1,e);this.allowPointerLock=!1;this.dz=0;this.keyMap=new Map([["`",3],["ContextMenu",2]]);this.element.addEventListener("wheel",r=>{r.preventDefault(),this.dz+=-r.deltaY*.1},{passive:!1}),this.element.addEventListener("contextmenu",r=>{r.preventDefault()}),this.element.addEventListener("pointerdown",r=>{this.onCheckEvent(r)&&this.allowPointerLock&&!this.isPointerLocked&&this.lockPointer()}),document.addEventListener("pointerlockchange",()=>{this.cursor.visible=!0}),window.addEventListener("keydown",r=>{this.isActive&&this.keyMap.has(r.key)&&this.setButton(this.keyMap.get(r.key),Pa(r))}),window.addEventListener("keyup",r=>{this.keyMap.has(r.key)&&this.setButton(this.keyMap.get(r.key),!1)}),this.mayTeleport=!0,Object.seal(this)}updatePointerOrientation(){this.isPointerLocked&&this.position.set(this.env.renderer.domElement.clientWidth,this.env.renderer.domElement.clientHeight).multiplyScalar(.5),super.updatePointerOrientation()}onUpdate(){super.onUpdate(),this.env.avatar.zoom(this.dz),this.dz=0}get isPointerLocked(){return document.pointerLockElement!=null}get canDragView(){return super.canDragView&&!this.isPointerLocked}get canTeleport(){return super.canTeleport&&this.isPointerLocked}lockPointer(){this.element.requestPointerLock()}unlockPointer(){document.exitPointerLock()}vibrate(){}};var ja=class extends Io{constructor(t){super("pen",2,t),Object.seal(this)}vibrate(){}};function GA(n){return n.pointerId}var Wa=class extends Ro{constructor(e){super("touch",3,e,null);this.dz=0;this.lastZ=0;this.points=new Array;Object.seal(this)}get enabled(){return super.enabled}set enabled(e){super.enabled=e,pe(this.points)}onCheckEvent(e){return super.onCheckEvent(e)&&e.pointerId>-1}onReadEvent(e){if(sd(this.points,e.pointerId,GA),(e.type==="pointerdown"||e.type==="pointermove")&&this.points.push(e),this.points.length===2){let o=this.points[0],i=this.points[1],s=i.offsetX-o.offsetX,p=i.offsetY-o.offsetY,c=5*Math.sqrt(s*s+p*p),u=c-this.lastZ;e.type==="pointermove"&&(this.dz+=u),this.lastZ=c}let r=1/this.points.length;if(e.type==="pointerdown"||e.type==="pointermove"){this.position.setScalar(0);for(let o of this.points)this.position.x+=r*o.offsetX,this.position.y+=r*o.offsetY,this.motion.x+=r*o.movementX,this.motion.y+=r*o.movementY}if(super.onReadEvent(e),e.type!=="pointermove"){let o=0;for(let i=0;i<this.points.length;++i){let s=this.points[i],p=1<<i;s.buttons!==0?o|=p:o&=~p}for(let i=0;i<10;++i){let s=this.isPressed(i),p=1<<i,c=(o&p)!==0;c!==s&&this.setButton(i,c)}}}onUpdate(){this.env.avatar.zoom(this.dz),super.onUpdate(),this.dz=0}vibrate(){navigator.vibrate(125)}};var qa=class extends Y{constructor(e){super();this.env=e;this.raycaster=new Qm;this.queue=new Array;this.targetsFound=new Set;this.targets=new Array;this.hands=new Array;this.raycaster.camera=this.env.camera,this.raycaster.layers.set(Ia),this.mouse=new Ua(this.env),this.pen=new ja(this.env),this.touches=new Wa(this.env);for(let r=0;r<2;++r)this.hands[r]=new za(this.env,r);this.pointers=[this.mouse,this.pen,this.touches,...this.hands];for(let r of this.pointers)r.addBubbler(this),r.cursor&&j(this.env.stage,r.cursor);this.checkXRMouse(),Object.seal(this)}checkXRMouse(){let e=0;for(let o of this.hands.values())o.enabled&&++e;let r=e===0;this.mouse.enabled=r,this.pen.enabled=r,this.touches.enabled=r}refreshCursors(){for(let e of this.pointers)e.cursor&&(e.cursor=this.env.cursor3D.clone())}fireRay(e,r,o){this.raycaster.ray.origin.copy(e),this.raycaster.ray.direction.copy(r),this.raycaster.intersectObjects(this.targets,!1,o)}update(){for(this.targetsFound.clear(),pe(this.targets),this.queue.push(this.env.scene);this.queue.length>0;){let e=this.queue.shift();e.children.length>0&&this.queue.push(...e.children);let r=go(e);r&&!this.targetsFound.has(r)&&(this.targetsFound.add(r),this.targets.push(...r.meshes))}for(let e of this.pointers)e.needsUpdate&&e.update()}};var HA=new W("fadecomplete"),Qa=class extends Y{constructor(e,r=.15){super();this.opacity=1;this.direction=0;this.material=mo({name:"FaderMaterial",color:0,side:um}),this.object=ur(e,Mi,this.material),this.object.renderOrder=Number.MAX_VALUE,this.speed=1/r,this.object.layers.enableAll()}async fadeOut(){this.direction!=1&&(this.direction=1,await ke(this,"fadecomplete"))}async fadeIn(){this.direction!=-1&&(this.direction=-1,await ke(this,"fadecomplete"))}update(e){if(this.direction!==0){let r=this.direction*this.speed*e/1e3;0<=this.opacity&&this.opacity<=1&&(this.opacity+=r),(this.direction===1&&this.opacity>=1||this.direction===-1&&this.opacity<=0)&&(this.opacity=Zt(this.opacity,0,1),this.direction=0,this.dispatchEvent(HA))}this.material.opacity=this.opacity,this.material.transparent=this.opacity<1,this.material.needsUpdate=!0}};function _t(n,t,e,r,o,i){let s=new _r(r,o,i,bh);return s.position.set(n,t,e),s}var zA=.1,Ka=class extends Lt{constructor(){super();this.value=0;this.targetValue=0;this.object=ue("LoadingBar");this._enabled=!0;this.valueBar=new _r(0,1,1,_h),this.valueBar.scale.set(0,1,1);let e=ue("ValueBarContainer");e.scale.set(1,.1,.1),j(this,j(e,this.valueBar),_t(-.5,0,-.05,.01,.1,.01),_t(-.5,0,.05,.01,.1,.01),_t(.5,0,-.05,.01,.1,.01),_t(.5,0,.05,.01,.1,.01),_t(-.5,-.05,0,.01,.01,.1),_t(.5,-.05,0,.01,.01,.1),_t(-.5,.05,0,.01,.01,.1),_t(.5,.05,0,.01,.01,.1),_t(0,-.05,-.05,1,.01,.01),_t(0,.05,-.05,1,.01,.01),_t(0,-.05,.05,1,.01,.01),_t(0,.05,.05,1,.01,.01)),Wh(this,wo)}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,De(this,uo(this)||this.enabled))}report(e,r,o){super.report(e,r,o),this.targetValue=this.p}update(e){this.object.parent.visible&&(this.value=Math.min(this.targetValue,this.value+zA*e),this.valueBar.scale.set(this.value,1,1),this.valueBar.position.x=this.value/2-.5,De(this,this.enabled&&this.value>0))}};if(!Mc()){let n=Element.prototype,t=Document.prototype;"webkitRequestFullscreen"in n?(n.requestFullscreen=n.webkitRequestFullscreen,t.exitFullscreen=t.webkitRequestFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.webkitFullscreenEnabled}},fullscreenElement:{get:function(){return this.webkitFullscreenElement}}})):"mozRequestFullScreen"in n?(n.requestFullscreen=n.mozRequestFullScreen,t.exitFullscreen=t.mozCancelFullScreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.mozFullScreenEnabled}},fullscreenElement:{get:function(){return this.mozFullScreenElement}}})):"msRequestFullscreen"in n&&(n.requestFullscreen=n.msRequestFullscreen,t.exitFullscreen=t.msExitFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.msFullscreenEnabled}},fullscreenElement:{get:function(){return this.msFullscreenElement}}}))}function Mc(){return"requestFullscreen"in HTMLElement.prototype}var UA=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},Ya=UA;var Ri=Symbol("@@webxr-polyfill/EventTarget"),dn=class{constructor(){this[Ri]={listeners:new Map}}addEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let r=this[Ri].listeners.get(t)||[];r.push(e),this[Ri].listeners.set(t,r)}removeEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let r=this[Ri].listeners.get(t)||[];for(let o=r.length;o>=0;o--)r[o]===e&&r.pop()}dispatchEvent(t,e){let r=this[Ri].listeners.get(t)||[],o=[];for(let i=0;i<r.length;i++)o[i]=r[i];for(let i of o)i(e);typeof this[`on${t}`]=="function"&&this[`on${t}`](e)}};var Ve=typeof Float32Array<"u"?Float32Array:Array;var a6=Math.PI/180;function qt(){let n=new Ve(16);return Ve!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function yf(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function Xn(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function wr(n,t){let e=t[0],r=t[1],o=t[2],i=t[3],s=t[4],p=t[5],c=t[6],u=t[7],h=t[8],x=t[9],b=t[10],w=t[11],R=t[12],C=t[13],M=t[14],k=t[15],O=e*p-r*s,V=e*c-o*s,X=e*u-i*s,G=r*c-o*p,I=r*u-i*p,F=o*u-i*c,se=h*C-x*R,ae=h*M-b*R,q=h*k-w*R,ie=x*M-b*C,Te=x*k-w*C,Ae=b*k-w*M,le=O*Ae-V*Te+X*ie+G*q-I*ae+F*se;return le?(le=1/le,n[0]=(p*Ae-c*Te+u*ie)*le,n[1]=(o*Te-r*Ae-i*ie)*le,n[2]=(C*F-M*I+k*G)*le,n[3]=(b*I-x*F-w*G)*le,n[4]=(c*q-s*Ae-u*ae)*le,n[5]=(e*Ae-o*q+i*ae)*le,n[6]=(M*X-R*F-k*V)*le,n[7]=(h*F-b*X+w*V)*le,n[8]=(s*Te-p*q+u*se)*le,n[9]=(r*q-e*Te-i*se)*le,n[10]=(R*I-C*X+k*O)*le,n[11]=(x*X-h*I-w*O)*le,n[12]=(p*ae-s*ie-c*se)*le,n[13]=(e*ie-r*ae+o*se)*le,n[14]=(C*V-R*G-M*O)*le,n[15]=(h*G-x*V+b*O)*le,n):null}function un(n,t,e){let r=t[0],o=t[1],i=t[2],s=t[3],p=t[4],c=t[5],u=t[6],h=t[7],x=t[8],b=t[9],w=t[10],R=t[11],C=t[12],M=t[13],k=t[14],O=t[15],V=e[0],X=e[1],G=e[2],I=e[3];return n[0]=V*r+X*p+G*x+I*C,n[1]=V*o+X*c+G*b+I*M,n[2]=V*i+X*u+G*w+I*k,n[3]=V*s+X*h+G*R+I*O,V=e[4],X=e[5],G=e[6],I=e[7],n[4]=V*r+X*p+G*x+I*C,n[5]=V*o+X*c+G*b+I*M,n[6]=V*i+X*u+G*w+I*k,n[7]=V*s+X*h+G*R+I*O,V=e[8],X=e[9],G=e[10],I=e[11],n[8]=V*r+X*p+G*x+I*C,n[9]=V*o+X*c+G*b+I*M,n[10]=V*i+X*u+G*w+I*k,n[11]=V*s+X*h+G*R+I*O,V=e[12],X=e[13],G=e[14],I=e[15],n[12]=V*r+X*p+G*x+I*C,n[13]=V*o+X*c+G*b+I*M,n[14]=V*i+X*u+G*w+I*k,n[15]=V*s+X*h+G*R+I*O,n}function Gn(n,t,e){let r=t[0],o=t[1],i=t[2],s=t[3],p=r+r,c=o+o,u=i+i,h=r*p,x=r*c,b=r*u,w=o*c,R=o*u,C=i*u,M=s*p,k=s*c,O=s*u;return n[0]=1-(w+C),n[1]=x+O,n[2]=b-k,n[3]=0,n[4]=x-O,n[5]=1-(h+C),n[6]=R+M,n[7]=0,n[8]=b+k,n[9]=R-M,n[10]=1-(h+w),n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}function Ja(n,t){return n[0]=t[12],n[1]=t[13],n[2]=t[14],n}function $a(n,t){let e=t[0]+t[5]+t[10],r=0;return e>0?(r=Math.sqrt(e+1)*2,n[3]=.25*r,n[0]=(t[6]-t[9])/r,n[1]=(t[8]-t[2])/r,n[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=Math.sqrt(1+t[0]-t[5]-t[10])*2,n[3]=(t[6]-t[9])/r,n[0]=.25*r,n[1]=(t[1]+t[4])/r,n[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=Math.sqrt(1+t[5]-t[0]-t[10])*2,n[3]=(t[8]-t[2])/r,n[0]=(t[1]+t[4])/r,n[1]=.25*r,n[2]=(t[6]+t[9])/r):(r=Math.sqrt(1+t[10]-t[0]-t[5])*2,n[3]=(t[1]-t[4])/r,n[0]=(t[8]+t[2])/r,n[1]=(t[6]+t[9])/r,n[2]=.25*r),n}function Za(n,t,e,r,o){let i=1/Math.tan(t/2),s;return n[0]=i/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,o!=null&&o!==1/0?(s=1/(r-o),n[10]=(o+r)*s,n[14]=2*o*r*s):(n[10]=-1,n[14]=-2*r),n}function pt(){let n=new Ve(3);return Ve!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Pc(n){var t=new Ve(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function jA(n){let t=n[0],e=n[1],r=n[2];return Math.sqrt(t*t+e*e+r*r)}function rt(n,t,e){let r=new Ve(3);return r[0]=n,r[1]=t,r[2]=e,r}function Cc(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function Vo(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function Rc(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function el(n,t){let e=t[0],r=t[1],o=t[2],i=e*e+r*r+o*o;return i>0&&(i=1/Math.sqrt(i),n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i),n}function Li(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function tl(n,t,e){let r=t[0],o=t[1],i=t[2],s=e[0],p=e[1],c=e[2];return n[0]=o*c-i*p,n[1]=i*s-r*c,n[2]=r*p-o*s,n}function Tr(n,t,e){let r=e[0],o=e[1],i=e[2],s=e[3],p=t[0],c=t[1],u=t[2],h=o*u-i*c,x=i*p-r*u,b=r*c-o*p,w=o*b-i*x,R=i*h-r*b,C=r*x-o*h,M=s*2;return h*=M,x*=M,b*=M,w*=2,R*=2,C*=2,n[0]=p+h+w,n[1]=c+x+R,n[2]=u+b+C,n}function Ef(n,t){let e=rt(n[0],n[1],n[2]),r=rt(t[0],t[1],t[2]);el(e,e),el(r,r);let o=Li(e,r);return o>1?0:o<-1?Math.PI:Math.acos(o)}var Tf=jA;var l6=function(){let n=pt();return function(t,e,r,o,i,s){let p,c;for(e||(e=3),r||(r=0),o?c=Math.min(o*e+r,t.length):c=t.length,p=r;p<c;p+=e)n[0]=t[p],n[1]=t[p+1],n[2]=t[p+2],i(n,n,s),t[p]=n[0],t[p+1]=n[1],t[p+2]=n[2];return t}}();function Sf(){let n=new Ve(9);return Ve!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function qA(){let n=new Ve(4);return Ve!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Mf(n){let t=new Ve(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function Pf(n,t,e,r){let o=new Ve(4);return o[0]=n,o[1]=t,o[2]=e,o[3]=r,o}function Cf(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function Rf(n,t){let e=t[0],r=t[1],o=t[2],i=t[3],s=e*e+r*r+o*o+i*i;return s>0&&(s=1/Math.sqrt(s),n[0]=e*s,n[1]=r*s,n[2]=o*s,n[3]=i*s),n}var p6=function(){let n=qA();return function(t,e,r,o,i,s){let p,c;for(e||(e=4),r||(r=0),o?c=Math.min(o*e+r,t.length):c=t.length,p=r;p<c;p+=e)n[0]=t[p],n[1]=t[p+1],n[2]=t[p+2],n[3]=t[p+3],i(n,n,s),t[p]=n[0],t[p+1]=n[1],t[p+2]=n[2],t[p+3]=n[3];return t}}();function ct(){let n=new Ve(4);return Ve!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function KA(n,t,e){e=e*.5;let r=Math.sin(e);return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=Math.cos(e),n}function Ic(n,t,e){let r=t[0],o=t[1],i=t[2],s=t[3],p=e[0],c=e[1],u=e[2],h=e[3];return n[0]=r*h+s*p+o*u-i*c,n[1]=o*h+s*c+i*p-r*u,n[2]=i*h+s*u+r*c-o*p,n[3]=s*h-r*p-o*c-i*u,n}function Lo(n,t,e,r){let o=t[0],i=t[1],s=t[2],p=t[3],c=e[0],u=e[1],h=e[2],x=e[3],b,w,R,C,M;return w=o*c+i*u+s*h+p*x,w<0&&(w=-w,c=-c,u=-u,h=-h,x=-x),1-w>1e-6?(b=Math.acos(w),R=Math.sin(b),C=Math.sin((1-r)*b)/R,M=Math.sin(r*b)/R):(C=1-r,M=r),n[0]=C*o+M*c,n[1]=C*i+M*u,n[2]=C*s+M*h,n[3]=C*p+M*x,n}function Vc(n,t){let e=t[0],r=t[1],o=t[2],i=t[3],s=e*e+r*r+o*o+i*i,p=s?1/s:0;return n[0]=-e*p,n[1]=-r*p,n[2]=-o*p,n[3]=i*p,n}function YA(n,t){let e=t[0]+t[4]+t[8],r;if(e>0)r=Math.sqrt(e+1),n[3]=.5*r,r=.5/r,n[0]=(t[5]-t[7])*r,n[1]=(t[6]-t[2])*r,n[2]=(t[1]-t[3])*r;else{let o=0;t[4]>t[0]&&(o=1),t[8]>t[o*3+o]&&(o=2);let i=(o+1)%3,s=(o+2)%3;r=Math.sqrt(t[o*3+o]-t[i*3+i]-t[s*3+s]+1),n[o]=.5*r,r=.5/r,n[3]=(t[i*3+s]-t[s*3+i])*r,n[i]=(t[i*3+o]+t[o*3+i])*r,n[s]=(t[s*3+o]+t[o*3+s])*r}return n}function If(n,t,e,r){let o=.5*Math.PI/180;t*=o,e*=o,r*=o;let i=Math.sin(t),s=Math.cos(t),p=Math.sin(e),c=Math.cos(e),u=Math.sin(r),h=Math.cos(r);return n[0]=i*c*h-s*p*u,n[1]=s*p*h+i*c*u,n[2]=s*c*u-i*p*h,n[3]=s*c*h+i*p*u,n}var Lc=Mf,Vf=Pf,rl=Cf;var ki=Rf;var A6=function(){let n=pt(),t=rt(1,0,0),e=rt(0,1,0);return function(r,o,i){let s=Li(o,i);return s<-.999999?(tl(n,t,o),Tf(n)<1e-6&&tl(n,e,o),el(n,n),KA(r,n,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(tl(n,o,i),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=1+s,ki(r,r))}}(),_6=function(){let n=ct(),t=ct();return function(e,r,o,i,s,p){return Lo(n,r,s,p),Lo(t,o,i,p),Lo(e,n,t,2*p*(1-p)),e}}(),b6=function(){let n=Sf();return function(t,e,r,o){return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=o[0],n[4]=o[1],n[7]=o[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],ki(t,YA(t,n))}}();var oe=Symbol("@@webxr-polyfill/XRRigidTransform"),mn=class{constructor(){if(this[oe]={matrix:null,position:null,orientation:null,inverse:null},arguments.length===0)this[oe].matrix=Xn(new Float32Array(16));else if(arguments.length===1)arguments[0]instanceof Float32Array?this[oe].matrix=arguments[0]:(this[oe].position=this._getPoint(arguments[0]),this[oe].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(arguments.length===2)this[oe].position=this._getPoint(arguments[0]),this[oe].orientation=this._getPoint(arguments[1]);else throw new Error("Too many arguments!");if(this[oe].matrix){let t=pt();Ja(t,this[oe].matrix),this[oe].position=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2]});let e=ct();$a(e,this[oe].matrix),this[oe].orientation=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2],w:e[3]})}else this[oe].matrix=Xn(new Float32Array(16)),Gn(this[oe].matrix,Vf(this[oe].orientation.x,this[oe].orientation.y,this[oe].orientation.z,this[oe].orientation.w),rt(this[oe].position.x,this[oe].position.y,this[oe].position.z))}_getPoint(t){return t instanceof DOMPointReadOnly?t:DOMPointReadOnly.fromPoint(t)}get matrix(){return this[oe].matrix}get position(){return this[oe].position}get orientation(){return this[oe].orientation}get inverse(){if(this[oe].inverse===null){let t=Xn(new Float32Array(16));wr(t,this[oe].matrix),this[oe].inverse=new mn(t),this[oe].inverse[oe].inverse=this}return this[oe].inverse}};var Ee=Symbol("@@webxr-polyfill/XRSpace");var bt=class{constructor(t=null,e=null){this[Ee]={specialType:t,inputSource:e,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[Ee].specialType}get _inputSource(){return this[Ee].inputSource}_ensurePoseUpdated(t,e){e!=this[Ee].lastFrameId&&(this[Ee].lastFrameId=e,this._onPoseUpdate(t))}_onPoseUpdate(t){this[Ee].specialType=="viewer"&&(this._baseMatrix=t.getBasePoseMatrix())}set _baseMatrix(t){this[Ee].baseMatrix=t,this[Ee].inverseBaseMatrix=null}get _baseMatrix(){return this[Ee].baseMatrix||this[Ee].inverseBaseMatrix&&(this[Ee].baseMatrix=new Float32Array(16),wr(this[Ee].baseMatrix,this[Ee].inverseBaseMatrix)),this[Ee].baseMatrix}set _inverseBaseMatrix(t){this[Ee].inverseBaseMatrix=t,this[Ee].baseMatrix=null}get _inverseBaseMatrix(){return this[Ee].inverseBaseMatrix||this[Ee].baseMatrix&&(this[Ee].inverseBaseMatrix=new Float32Array(16),wr(this[Ee].inverseBaseMatrix,this[Ee].baseMatrix)),this[Ee].inverseBaseMatrix}_getSpaceRelativeTransform(t){if(!this._inverseBaseMatrix||!t._baseMatrix)return null;let e=new Float32Array(16);return un(e,this._inverseBaseMatrix,t._baseMatrix),new mn(e)}};var JA=1.6,Hn=Symbol("@@webxr-polyfill/XRReferenceSpace"),Bi=["viewer","local","local-floor","bounded-floor","unbounded"];function $A(n){return n==="bounded-floor"||n==="local-floor"}var Qt=class extends bt{constructor(t,e=null){if(!Bi.includes(t))throw new Error(`XRReferenceSpaceType must be one of ${Bi}`);if(super(t),t==="bounded-floor"&&!e)throw new Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");$A(t)&&!e&&(e=Xn(new Float32Array(16)),e[13]=JA),this._inverseBaseMatrix=e||Xn(new Float32Array(16)),this[Hn]={type:t,transform:e,originOffset:Xn(new Float32Array(16))}}_transformBasePoseMatrix(t,e){un(t,this._inverseBaseMatrix,e)}_originOffsetMatrix(){return this[Hn].originOffset}_adjustForOriginOffset(t){let e=new Float32Array(16);wr(e,this[Hn].originOffset),un(t,e,t)}_getSpaceRelativeTransform(t){let e=super._getSpaceRelativeTransform(t);return this._adjustForOriginOffset(e.matrix),new XRRigidTransform(e.matrix)}getOffsetReferenceSpace(t){let e=new Qt(this[Hn].type,this[Hn].transform,this[Hn].bounds);return un(e[Hn].originOffset,this[Hn].originOffset,t.matrix),e}};var $e=Symbol("@@webxr-polyfill/XR"),ZA=["inline","immersive-vr","immersive-ar"],e_={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},t_=`Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode
or navigator.xr.requestSession('inline') prior to requesting an immersive
session. This is a limitation specific to the WebXR Polyfill and does not apply
to native implementations of the API.`,Oi=class extends dn{constructor(t){super(),this[$e]={device:null,devicePromise:t,immersiveSession:null,inlineSessions:new Set},t.then(e=>{this[$e].device=e})}async isSessionSupported(t){return this[$e].device||await this[$e].devicePromise,t!="inline"?Promise.resolve(this[$e].device.isSessionSupported(t)):Promise.resolve(!0)}async requestSession(t,e){if(!this[$e].device){if(t!="inline")throw new Error(t_);await this[$e].devicePromise}if(!ZA.includes(t))throw new TypeError(`The provided value '${t}' is not a valid enum value of type XRSessionMode`);let r=e_[t],o=r.requiredFeatures.concat(e&&e.requiredFeatures?e.requiredFeatures:[]),i=r.optionalFeatures.concat(e&&e.optionalFeatures?e.optionalFeatures:[]),s=new Set,p=!1;for(let x of o)this[$e].device.isFeatureSupported(x)?s.add(x):(console.error(`The required feature '${x}' is not supported`),p=!0);if(p)throw new DOMException("Session does not support some required features","NotSupportedError");for(let x of i)this[$e].device.isFeatureSupported(x)?s.add(x):console.log(`The optional feature '${x}' is not supported`);let c=await this[$e].device.requestSession(t,s),u=new XRSession(this[$e].device,t,c);t=="inline"?this[$e].inlineSessions.add(u):this[$e].immersiveSession=u;let h=()=>{t=="inline"?this[$e].inlineSessions.delete(u):this[$e].immersiveSession=null,u.removeEventListener("end",h)};return u.addEventListener("end",h),u}};var Bc;if("performance"in Ya)Bc=()=>performance.now();else{let n=Date.now();Bc=()=>Date.now()-n}var ol=Bc;var Oc=Symbol("@@webxr-polyfill/XRPose"),Sr=class{constructor(t,e){this[Oc]={transform:t,emulatedPosition:e}}get transform(){return this[Oc].transform}get emulatedPosition(){return this[Oc].emulatedPosition}};var Lf=Symbol("@@webxr-polyfill/XRViewerPose"),Mr=class extends Sr{constructor(t,e,r=!1){super(t,r),this[Lf]={views:e}}get views(){return this[Lf].views}};var Di=Symbol("@@webxr-polyfill/XRViewport"),Pr=class{constructor(t){this[Di]={target:t}}get x(){return this[Di].target.x}get y(){return this[Di].target.y}get width(){return this[Di].target.width}get height(){return this[Di].target.height}};var kf=["left","right","none"],zn=Symbol("@@webxr-polyfill/XRView"),Cr=class{constructor(t,e,r,o){if(!kf.includes(r))throw new Error(`XREye must be one of: ${kf}`);let i=Object.create(null),s=new Pr(i);this[zn]={device:t,eye:r,viewport:s,temp:i,sessionId:o,transform:e}}get eye(){return this[zn].eye}get projectionMatrix(){return this[zn].device.getProjectionMatrix(this.eye)}get transform(){return this[zn].transform}_getViewport(t){if(this[zn].device.getViewport(this[zn].sessionId,this.eye,t,this[zn].temp))return this[zn].viewport}};var Me=Symbol("@@webxr-polyfill/XRFrame"),Bf="XRFrame access outside the callback that produced it is invalid.",n_="getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.",r_=0,Un=class{constructor(t,e,r){this[Me]={id:++r_,active:!1,animationFrame:!1,device:t,session:e,sessionId:r}}get session(){return this[Me].session}getViewerPose(t){if(!this[Me].animationFrame)throw new DOMException(n_,"InvalidStateError");if(!this[Me].active)throw new DOMException(Bf,"InvalidStateError");let e=this[Me].device,r=this[Me].session;r[E].viewerSpace._ensurePoseUpdated(e,this[Me].id),t._ensurePoseUpdated(e,this[Me].id);let o=t._getSpaceRelativeTransform(r[E].viewerSpace),i=[];for(let p of r[E].viewSpaces){p._ensurePoseUpdated(e,this[Me].id);let c=t._getSpaceRelativeTransform(p),u=new Cr(e,c,p.eye,this[Me].sessionId);i.push(u)}return new Mr(o,i,!1)}getPose(t,e){if(!this[Me].active)throw new DOMException(Bf,"InvalidStateError");let r=this[Me].device;if(t._specialType==="target-ray"||t._specialType==="grip")return r.getInputPose(t._inputSource,e,t._specialType);{t._ensurePoseUpdated(r,this[Me].id),e._ensurePoseUpdated(r,this[Me].id);let o=e._getSpaceRelativeTransform(t);return o?new XRPose(o,!1):null}return null}};var Fi=Symbol("@@webxr-polyfill/XRRenderState"),o_=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null}),jn=class{constructor(t={}){let e=Object.assign({},o_,t);this[Fi]={config:e}}get depthNear(){return this[Fi].config.depthNear}get depthFar(){return this[Fi].config.depthFar}get inlineVerticalFieldOfView(){return this[Fi].config.inlineVerticalFieldOfView}get baseLayer(){return this[Fi].config.baseLayer}};var il=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),Ni=Symbol("@@webxr-polyfill/xr-compatible");var Rr=Symbol("@@webxr-polyfill/XRWebGLLayer"),i_=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),Xi=class{constructor(t,e,r={}){let o=Object.assign({},i_,r);if(!(t instanceof Ir))throw new Error("session must be a XRSession");if(t.ended)throw new Error("InvalidStateError");if(e[il]&&e[Ni]!==!0)throw new Error("InvalidStateError");let i=e.getParameter(e.FRAMEBUFFER_BINDING);this[Rr]={context:e,config:o,framebuffer:i,session:t}}get context(){return this[Rr].context}get antialias(){return this[Rr].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return this[Rr].framebuffer}get framebufferWidth(){return this[Rr].context.drawingBufferWidth}get framebufferHeight(){return this[Rr].context.drawingBufferHeight}get _session(){return this[Rr].session}getViewport(t){return t._getViewport(this)}static getNativeFramebufferScaleFactor(t){if(!t)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return t[E].ended?0:1}};var Dc=Symbol("@@webxr-polyfill/XRInputSourceEvent"),hn=class extends Event{constructor(t,e){super(t,e),this[Dc]={frame:e.frame,inputSource:e.inputSource},Object.setPrototypeOf(this,hn.prototype)}get frame(){return this[Dc].frame}get inputSource(){return this[Dc].inputSource}};var Of=Symbol("@@webxr-polyfill/XRSessionEvent"),Kt=class extends Event{constructor(t,e){super(t,e),this[Of]={session:e.session},Object.setPrototypeOf(this,Kt.prototype)}get session(){return this[Of].session}};var sl=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),fn=class extends Event{constructor(t,e){super(t,e),this[sl]={session:e.session,added:e.added,removed:e.removed},Object.setPrototypeOf(this,fn.prototype)}get session(){return this[sl].session}get added(){return this[sl].added}get removed(){return this[sl].removed}};var E=Symbol("@@webxr-polyfill/XRSession"),Gi=class extends bt{constructor(t){super(t)}get eye(){return this._specialType}_onPoseUpdate(t){this._inverseBaseMatrix=t.getBaseViewMatrix(this._specialType)}},Ir=class extends dn{constructor(t,e,r){super();let o=e!="inline",i=new jn({inlineVerticalFieldOfView:o?null:Math.PI*.5});this[E]={device:t,mode:e,immersive:o,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:r,activeRenderState:i,pendingRenderState:null,viewerSpace:new Qt("viewer"),viewSpaces:[],currentInputSources:[]},o?this[E].viewSpaces.push(new Gi("left"),new Gi("right")):this[E].viewSpaces.push(new Gi("none")),this[E].onDeviceFrame=()=>{if(this[E].ended||this[E].suspended||(this[E].deviceFrameHandle=null,this[E].startDeviceFrameLoop(),this[E].pendingRenderState!==null&&(this[E].activeRenderState=new jn(this[E].pendingRenderState),this[E].pendingRenderState=null,this[E].activeRenderState.baseLayer&&this[E].device.onBaseLayerSet(this[E].id,this[E].activeRenderState.baseLayer)),this[E].activeRenderState.baseLayer===null))return;let s=new Un(t,this,this[E].id),p=this[E].currentFrameCallbacks=this[E].frameCallbacks;this[E].frameCallbacks=[],s[Me].active=!0,s[Me].animationFrame=!0,this[E].device.onFrameStart(this[E].id,this[E].activeRenderState),this._checkInputSourcesChange();let c=ol();for(let u=0;u<p.length;u++)try{!p[u].cancelled&&typeof p[u].callback=="function"&&p[u].callback(c,s)}catch(h){console.error(h)}this[E].currentFrameCallbacks=null,s[Me].active=!1,this[E].device.onFrameEnd(this[E].id)},this[E].startDeviceFrameLoop=()=>{this[E].deviceFrameHandle===null&&(this[E].deviceFrameHandle=this[E].device.requestAnimationFrame(this[E].onDeviceFrame))},this[E].stopDeviceFrameLoop=()=>{let s=this[E].deviceFrameHandle;s!==null&&(this[E].device.cancelAnimationFrame(s),this[E].deviceFrameHandle=null)},this[E].onPresentationEnd=s=>{if(s!==this[E].id){this[E].suspended=!1,this[E].startDeviceFrameLoop(),this.dispatchEvent("focus",{session:this});return}this[E].ended=!0,this[E].stopDeviceFrameLoop(),t.removeEventListener("@@webxr-polyfill/vr-present-end",this[E].onPresentationEnd),t.removeEventListener("@@webxr-polyfill/vr-present-start",this[E].onPresentationStart),t.removeEventListener("@@webxr-polyfill/input-select-start",this[E].onSelectStart),t.removeEventListener("@@webxr-polyfill/input-select-end",this[E].onSelectEnd),this.dispatchEvent("end",new Kt("end",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-end",this[E].onPresentationEnd),this[E].onPresentationStart=s=>{s!==this[E].id&&(this[E].suspended=!0,this[E].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-start",this[E].onPresentationStart),this[E].onSelectStart=s=>{s.sessionId===this[E].id&&this[E].dispatchInputSourceEvent("selectstart",s.inputSource)},t.addEventListener("@@webxr-polyfill/input-select-start",this[E].onSelectStart),this[E].onSelectEnd=s=>{s.sessionId===this[E].id&&(this[E].dispatchInputSourceEvent("selectend",s.inputSource),this[E].dispatchInputSourceEvent("select",s.inputSource))},t.addEventListener("@@webxr-polyfill/input-select-end",this[E].onSelectEnd),this[E].onSqueezeStart=s=>{s.sessionId===this[E].id&&this[E].dispatchInputSourceEvent("squeezestart",s.inputSource)},t.addEventListener("@@webxr-polyfill/input-squeeze-start",this[E].onSqueezeStart),this[E].onSqueezeEnd=s=>{s.sessionId===this[E].id&&(this[E].dispatchInputSourceEvent("squeezeend",s.inputSource),this[E].dispatchInputSourceEvent("squeeze",s.inputSource))},t.addEventListener("@@webxr-polyfill/input-squeeze-end",this[E].onSqueezeEnd),this[E].dispatchInputSourceEvent=(s,p)=>{let c=new Un(t,this,this[E].id),u=new hn(s,{frame:c,inputSource:p});c[Me].active=!0,this.dispatchEvent(s,u),c[Me].active=!1},this[E].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[E].activeRenderState}get environmentBlendMode(){return this[E].device.environmentBlendMode||"opaque"}async requestReferenceSpace(t){if(this[E].ended)return;if(!Bi.includes(t))throw new TypeError(`XRReferenceSpaceType must be one of ${Bi}`);if(!this[E].device.doesSessionSupportReferenceSpace(this[E].id,t))throw new DOMException(`The ${t} reference space is not supported by this session.`,"NotSupportedError");if(t==="viewer")return this[E].viewerSpace;let e=await this[E].device.requestFrameOfReferenceTransform(t);if(t==="bounded-floor")throw e?this[E].device.requestStageBounds()?new DOMException(`The WebXR polyfill does not support the ${t} reference space yet.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError");return new Qt(t,e)}requestAnimationFrame(t){if(this[E].ended)return;let e=++this[E].frameHandle;return this[E].frameCallbacks.push({handle:e,callback:t,cancelled:!1}),e}cancelAnimationFrame(t){let e=this[E].frameCallbacks,r=e.findIndex(o=>o&&o.handle===t);r>-1&&(e[r].cancelled=!0,e.splice(r,1)),e=this[E].currentFrameCallbacks,e&&(r=e.findIndex(o=>o&&o.handle===t),r>-1&&(e[r].cancelled=!0))}get inputSources(){return this[E].device.getInputSources()}async end(){if(!this[E].ended)return this[E].immersive&&(this[E].ended=!0,this[E].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[E].onPresentationStart),this[E].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[E].onPresentationEnd),this[E].device.removeEventListener("@@webxr-polyfill/input-select-start",this[E].onSelectStart),this[E].device.removeEventListener("@@webxr-polyfill/input-select-end",this[E].onSelectEnd),this.dispatchEvent("end",new Kt("end",{session:this}))),this[E].stopDeviceFrameLoop(),this[E].device.endSession(this[E].id)}updateRenderState(t){if(this[E].ended){let r="Can't call updateRenderState on an XRSession that has already ended.";throw new Error(r)}if(t.baseLayer&&t.baseLayer._session!==this){let r="Called updateRenderState with a base layer that was created by a different session.";throw new Error(r)}if(t.inlineVerticalFieldOfView!==null&&t.inlineVerticalFieldOfView!==void 0)if(this[E].immersive){let r="inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.";throw new Error(r)}else t.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,t.inlineVerticalFieldOfView));if(this[E].pendingRenderState===null){let r=this[E].activeRenderState;this[E].pendingRenderState={depthNear:r.depthNear,depthFar:r.depthFar,inlineVerticalFieldOfView:r.inlineVerticalFieldOfView,baseLayer:r.baseLayer}}Object.assign(this[E].pendingRenderState,t)}_checkInputSourcesChange(){let t=[],e=[],r=this.inputSources,o=this[E].currentInputSources;for(let i of r)o.includes(i)||t.push(i);for(let i of o)r.includes(i)||e.push(i);(t.length>0||e.length>0)&&this.dispatchEvent("inputsourceschange",new fn("inputsourceschange",{session:this,added:t,removed:e})),this[E].currentInputSources.length=0;for(let i of r)this[E].currentInputSources.push(i)}};var Wn=Symbol("@@webxr-polyfill/XRInputSource"),Vr=class{constructor(t){this[Wn]={impl:t,gripSpace:new bt("grip",this),targetRaySpace:new bt("target-ray",this)}}get handedness(){return this[Wn].impl.handedness}get targetRayMode(){return this[Wn].impl.targetRayMode}get gripSpace(){let t=this[Wn].impl.targetRayMode;return t==="gaze"||t==="screen"?null:this[Wn].gripSpace}get targetRaySpace(){return this[Wn].targetRaySpace}get profiles(){return this[Wn].impl.profiles}get gamepad(){return this[Wn].impl.gamepad}};var Fc=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),Lr=class extends Event{constructor(t,e){super(t,e),this[Fc]={referenceSpace:e.referenceSpace,transform:e.transform||null},Object.setPrototypeOf(this,Lr.prototype)}get referenceSpace(){return this[Fc].referenceSpace}get transform(){return this[Fc].transform}};var al={XRSystem:Oi,XRSession:Ir,XRSessionEvent:Kt,XRFrame:Un,XRView:Cr,XRViewport:Pr,XRViewerPose:Mr,XRWebGLLayer:Xi,XRSpace:bt,XRReferenceSpace:Qt,XRReferenceSpaceEvent:Lr,XRInputSource:Vr,XRInputSourceEvent:hn,XRInputSourcesChangeEvent:fn,XRRenderState:jn,XRRigidTransform:mn,XRPose:Sr};var Nc=n=>typeof n.prototype.makeXRCompatible=="function"?!1:(n.prototype.makeXRCompatible=function(){return this[Ni]=!0,Promise.resolve()},!0),Xc=n=>{let t=n.prototype.getContext;n.prototype.getContext=function(e,r){let o=t.call(this,e,r);return o&&(o[il]=!0,r&&"xrCompatible"in r&&(o[Ni]=r.xrCompatible)),o}};var Df=n=>!!(n.ImageBitmapRenderingContext&&n.createImageBitmap),Ff=n=>{var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(n.navigator.userAgent||n.navigator.vendor||n.opera),t},Nf=n=>{n.style.display="block",n.style.position="absolute",n.style.width=n.style.height="1px",n.style.top=n.style.left="0px"};var Yf=Gx(Xf());var kr=class extends dn{constructor(t){super(),this.global=t,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(t,e){throw new Error("Not implemented")}isSessionSupported(t){throw new Error("Not implemented")}isFeatureSupported(t){throw new Error("Not implemented")}async requestSession(t,e){throw new Error("Not implemented")}requestAnimationFrame(t){throw new Error("Not implemented")}onFrameStart(t){throw new Error("Not implemented")}onFrameEnd(t){throw new Error("Not implemented")}doesSessionSupportReferenceSpace(t,e){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(t,e){}cancelAnimationFrame(t){throw new Error("Not implemented")}endSession(t){throw new Error("Not implemented")}getViewport(t,e,r,o){throw new Error("Not implemented")}getProjectionMatrix(t){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(t){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(t,e,r){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}};var s_={mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},a_={mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},l_={mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},Gf={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},p_={mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[Math.PI*-.08,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},c_={mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},d_={mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},zc={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},u_={"Daydream Controller":s_,"Gear VR Controller":c_,"HTC Vive Focus Controller":a_,"Oculus Go Controller":l_,"Oculus Touch (Right)":Gf,"Oculus Touch (Left)":Gf,"OpenVR Gamepad":p_,"Spatial Controller (Spatial Interaction Source) 045E-065A":zc,"Spatial Controller (Spatial Interaction Source) 045E-065D":d_,"Windows Mixed Reality (Right)":zc,"Windows Mixed Reality (Left)":zc},Hf=u_;var zf=rt(.155,-.465,-.15),m_=rt(-.155,-.465,-.15),h_=rt(0,0,-.25),f_=rt(0,0,.05),Uf=rt(-.08,.14,.08),jf=.4,x_=.4,g_=.61,v_=.175,A_=.12,__=.87,Wf=180/Math.PI;function b_(n,t,e){function r(c,u,h){return c<u?u:c>h?h:c}var o=t[0]*t[0],i=t[1]*t[1],s=t[2]*t[2],p=t[3]*t[3];if(e==="XYZ")n[0]=Math.atan2(2*(t[0]*t[3]-t[1]*t[2]),p-o-i+s),n[1]=Math.asin(r(2*(t[0]*t[2]+t[1]*t[3]),-1,1)),n[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),p+o-i-s);else if(e==="YXZ")n[0]=Math.asin(r(2*(t[0]*t[3]-t[1]*t[2]),-1,1)),n[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),p-o-i+s),n[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),p-o+i-s);else if(e==="ZXY")n[0]=Math.asin(r(2*(t[0]*t[3]+t[1]*t[2]),-1,1)),n[1]=Math.atan2(2*(t[1]*t[3]-t[2]*t[0]),p-o-i+s),n[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),p-o+i-s);else if(e==="ZYX")n[0]=Math.atan2(2*(t[0]*t[3]+t[2]*t[1]),p-o-i+s),n[1]=Math.asin(r(2*(t[1]*t[3]-t[0]*t[2]),-1,1)),n[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),p+o-i-s);else if(e==="YZX")n[0]=Math.atan2(2*(t[0]*t[3]-t[2]*t[1]),p-o+i-s),n[1]=Math.atan2(2*(t[1]*t[3]-t[0]*t[2]),p+o-i-s),n[2]=Math.asin(r(2*(t[0]*t[1]+t[2]*t[3]),-1,1));else if(e==="XZY")n[0]=Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),p-o+i-s),n[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),p+o-i-s),n[2]=Math.asin(r(2*(t[2]*t[3]-t[0]*t[1]),-1,1));else{console.log("No order given for quaternion to euler conversion.");return}}var Hi=class{constructor(){this.hand="right",this.headElbowOffset=zf,this.controllerQ=ct(),this.lastControllerQ=ct(),this.headQ=ct(),this.headPos=pt(),this.elbowPos=pt(),this.wristPos=pt(),this.time=null,this.lastTime=null,this.rootQ=ct(),this.position=pt()}setHandedness(t){this.hand!=t&&(this.hand=t,this.hand=="left"?this.headElbowOffset=m_:this.headElbowOffset=zf)}update(t,e){this.time=ol(),t&&(rl(this.lastControllerQ,this.controllerQ),rl(this.controllerQ,t)),e&&(Ja(this.headPos,e),$a(this.headQ,e));let r=this.getHeadYawOrientation_(),o=this.quatAngle_(this.lastControllerQ,this.controllerQ),i=(this.time-this.lastTime)/1e3;o/i>g_?Lo(this.rootQ,this.rootQ,r,Math.min(o/v_,1)):rl(this.rootQ,r);let p=rt(0,0,-1);Tr(p,p,this.controllerQ);let c=Li(p,[0,1,0]),u=this.clamp_((c-A_)/__,0,1),h=Lc(this.rootQ);Vc(h,h),Ic(h,h,this.controllerQ);let x=this.elbowPos;Cc(x,this.headPos),Vo(x,x,this.headElbowOffset);let b=Pc(Uf);Rc(b,b,u),Vo(x,x,b);let R=this.quatAngle_(h,ct())*Wf,C=1-Math.pow(R/180,4);sssss;let M=jf,k=1-jf,O=C*(M+k*u*x_),V=ct();Lo(V,V,h,O);let X=Vc(ct(),V),G=Lc(h);Ic(G,G,X);let I=this.wristPos;Cc(I,f_),Tr(I,I,V),Vo(I,I,h_),Tr(I,I,G),Vo(I,I,x);let F=Pc(Uf);Rc(F,F,u),Vo(this.position,this.wristPos,F),Tr(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let t=pt();return b_(t,this.headQ,"YXZ"),If(ct(),0,t[1]*Wf,0)}clamp_(t,e,r){return Math.min(Math.max(t,e),r)}quatAngle_(t,e){let r=[0,0,-1],o=[0,0,-1];return Tr(r,r,t),Tr(o,o,e),Ef(r,o)}};var Qe=Symbol("@@webxr-polyfill/XRRemappedGamepad"),qf={pressed:!1,touched:!1,value:0};Object.freeze(qf);var Uc=class{constructor(t,e,r){if(r||(r={}),r.userAgentOverrides){for(let u in r.userAgentOverrides)if(navigator.userAgent.includes(u)){let h=r.userAgentOverrides[u];for(let x in h)x in r?Object.assign(r[x],h[x]):r[x]=h[x];break}}let o=new Array(r.axes&&r.axes.length?r.axes.length:t.axes.length),i=new Array(r.buttons&&r.buttons.length?r.buttons.length:t.buttons.length),s=null;if(r.gripTransform){let u=r.gripTransform.orientation||[0,0,0,1];s=qt(),Gn(s,ki(u,u),r.gripTransform.position||[0,0,0])}let p=null;if(r.targetRayTransform){let u=r.targetRayTransform.orientation||[0,0,0,1];p=qt(),Gn(p,ki(u,u),r.targetRayTransform.position||[0,0,0])}let c=r.profiles;r.displayProfiles&&e.displayName in r.displayProfiles&&(c=r.displayProfiles[e.displayName]),this[Qe]={gamepad:t,map:r,profiles:c||[t.id],mapping:r.mapping||t.mapping,axes:o,buttons:i,gripTransform:s,targetRayTransform:p},this._update()}_update(){let t=this[Qe].gamepad,e=this[Qe].map,r=this[Qe].axes;for(let i=0;i<r.length;++i)e.axes&&i in e.axes?e.axes[i]===null?r[i]=0:r[i]=t.axes[e.axes[i]]:r[i]=t.axes[i];if(e.axes&&e.axes.invert)for(let i of e.axes.invert)i<r.length&&(r[i]*=-1);let o=this[Qe].buttons;for(let i=0;i<o.length;++i)e.buttons&&i in e.buttons?e.buttons[i]===null?o[i]=qf:o[i]=t.buttons[e.buttons[i]]:o[i]=t.buttons[i]}get id(){return""}get _profiles(){return this[Qe].profiles}get index(){return-1}get connected(){return this[Qe].gamepad.connected}get timestamp(){return this[Qe].gamepad.timestamp}get mapping(){return this[Qe].mapping}get axes(){return this[Qe].axes}get buttons(){return this[Qe].buttons}get hapticActuators(){return this[Qe].gamepad.hapticActuators}},zi=class{constructor(t,e,r=0,o=-1){this.polyfill=t,this.display=e,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new Vr(this),this.lastPosition=pt(),this.emulatedPosition=!1,this.basePoseMatrix=qt(),this.outputMatrix=qt(),this.primaryButtonIndex=r,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=o,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(t){this.nativeGamepad!==t&&(this.nativeGamepad=t,t?this.gamepad=new Uc(t,this.display,Hf[t.id]):this.gamepad=null),this.handedness=t.hand===""?"none":t.hand,this.gamepad&&this.gamepad._update(),t.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!t.pose.hasPosition):t.hand===""&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let t=this.nativeGamepad.pose,e=t.position,r=t.orientation;if(!e&&!r)return;e?(this.lastPosition[0]=e[0],this.lastPosition[1]=e[1],this.lastPosition[2]=e[2]):t.hasPosition?e=this.lastPosition:(this.armModel||(this.armModel=new Hi),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(r,this.polyfill.getBasePoseMatrix()),e=this.armModel.getPosition()),Gn(this.basePoseMatrix,r,e)}else yf(this.basePoseMatrix,this.polyfill.getBasePoseMatrix());return this.basePoseMatrix}getXRPose(t,e){switch(this.updateBasePoseMatrix(),e){case"target-ray":t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[Qe].targetRayTransform&&un(this.outputMatrix,this.outputMatrix,this.gamepad[Qe].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[Qe].gripTransform&&un(this.outputMatrix,this.outputMatrix,this.gamepad[Qe].gripTransform);break;default:return null}return t._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}};var KN=Symbol("@@webxr-polyfill/WebVRDevice"),Ui=!1,Qf={highRefreshRate:!0},Kf={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},y_=0,jc=class{constructor(t,e,r={}){if(this.mode=t,this.enabledFeatures=e,this.outputContext=null,this.immersive=t=="immersive-vr"||t=="immersive-ar",this.ended=null,this.baseLayer=null,this.id=++y_,this.modifiedCanvasLayer=!1,this.outputContext&&!Ui){let o=r.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(o)}}},Br=class extends kr{constructor(t,e){let{canPresent:r}=e.capabilities;super(t),this.display=e,this.frame=new t.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=r,this.baseModelMatrix=qt(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),t.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=t.navigator&&"getGamepads"in t.navigator,this.HAS_BITMAP_SUPPORT=Df(t)}get depthNear(){return this.display.depthNear}set depthNear(t){this.display.depthNear=t}get depthFar(){return this.display.depthFar}set depthFar(t){this.display.depthFar=t}onBaseLayerSet(t,e){let r=this.sessions.get(t),o=e.context.canvas;if(r.immersive){let i=this.display.getEyeParameters("left"),s=this.display.getEyeParameters("right");o.width=Math.max(i.renderWidth,s.renderWidth)*2,o.height=Math.max(i.renderHeight,s.renderHeight),this.display.requestPresent([{source:o,attributes:Qf}]).then(()=>{!Ui&&!this.global.document.body.contains(o)&&(r.modifiedCanvasLayer=!0,this.global.document.body.appendChild(o),Nf(o)),r.baseLayer=e})}else r.baseLayer=e}isSessionSupported(t){return!(t=="immersive-ar"||t=="immersive-vr"&&this.canPresent===!1)}isFeatureSupported(t){switch(t){case"viewer":return!0;case"local":return!0;case"local-floor":return!0;case"bounded":return!1;case"unbounded":return!1;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let r=t=="immersive-vr";if(r){let i=this.global.document.createElement("canvas");if(!Ui){let s=i.getContext("webgl")}await this.display.requestPresent([{source:i,attributes:Qf}])}let o=new jc(t,e,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(o.id,o),r&&(this.immersiveSession=o,this.dispatchEvent("@@webxr-polyfill/vr-present-start",o.id)),Promise.resolve(o.id)}requestAnimationFrame(t){return this.display.requestAnimationFrame(t)}getPrimaryButtonIndex(t){let e=0,r=t.id.toLowerCase();for(let o in Kf)if(r.includes(o)){e=Kf[o];break}return Math.min(e,t.buttons.length-1)}onFrameStart(t,e){this.display.depthNear=e.depthNear,this.display.depthFar=e.depthFar,this.display.getFrameData(this.frame);let r=this.sessions.get(t);if(r.immersive&&this.CAN_USE_GAMEPAD){let o=this.gamepadInputSources;this.gamepadInputSources={};let i=this.global.navigator.getGamepads();for(let s=0;s<i.length;++s){let p=i[s];if(p&&p.displayId>0){let c=o[s];if(c||(c=new zi(this,this.display,this.getPrimaryButtonIndex(p))),c.updateFromGamepad(p),this.gamepadInputSources[s]=c,c.primaryButtonIndex!=-1){let u=p.buttons[c.primaryButtonIndex].pressed;u&&!c.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:r.id,inputSource:c.inputSource}):!u&&c.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:r.id,inputSource:c.inputSource}),c.primaryActionPressed=u}if(c.primarySqueezeButtonIndex!=-1){let u=p.buttons[c.primarySqueezeButtonIndex].pressed;u&&!c.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:r.id,inputSource:c.inputSource}):!u&&c.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:r.id,inputSource:c.inputSource}),c.primarySqueezeActionPressed=u}}}}if(!Ui&&!r.immersive&&r.baseLayer){let o=r.baseLayer.context.canvas;Za(this.frame.leftProjectionMatrix,e.inlineVerticalFieldOfView,o.width/o.height,e.depthNear,e.depthFar)}}onFrameEnd(t){let e=this.sessions.get(t);if(!(e.ended||!e.baseLayer)){if(e.outputContext&&!(e.immersive&&!this.display.capabilities.hasExternalDisplay)){let r=e.immersive&&this.display.capabilities.hasExternalDisplay,o=e.baseLayer.context.canvas,i=r?o.width/2:o.width,s=o.height;if(!Ui){let p=e.outputContext.canvas,c=p.width,u=p.height,h=e.renderContext;this.HAS_BITMAP_SUPPORT?o.transferToImageBitmap?h.transferFromImageBitmap(o.transferToImageBitmap()):this.global.createImageBitmap(o,0,0,i,s,{resizeWidth:c,resizeHeight:u}).then(x=>h.transferFromImageBitmap(x)):h.drawImage(o,0,0,i,s,0,0,c,u)}}e.immersive&&e.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(t){this.display.cancelAnimationFrame(t)}async endSession(t){let e=this.sessions.get(t);if(!e.ended){if(e.immersive)return this.display.exitPresent();e.ended=!0}}doesSessionSupportReferenceSpace(t,e){let r=this.sessions.get(t);return r.ended?!1:r.enabledFeatures.has(e)}requestStageBounds(){if(this.display.stageParameters){let t=this.display.stageParameters.sizeX,e=this.display.stageParameters.sizeZ,r=[];return r.push(-t/2),r.push(-e/2),r.push(t/2),r.push(-e/2),r.push(t/2),r.push(e/2),r.push(-t/2),r.push(e/2),r}return null}async requestFrameOfReferenceTransform(t,e){return(t==="local-floor"||t==="bounded-floor")&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(t){if(t==="left")return this.frame.leftProjectionMatrix;if(t==="right")return this.frame.rightProjectionMatrix;if(t==="none")return this.frame.leftProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(t,e,r,o){let i=this.sessions.get(t),{width:s,height:p}=r.context.canvas;if(!i.immersive)return o.x=o.y=0,o.width=s,o.height=p,!0;if(e==="left"||e==="none")o.x=0;else if(e==="right")o.x=s/2;else return!1;return o.y=0,o.width=s/2,o.height=p,!0}getBasePoseMatrix(){let{position:t,orientation:e}=this.frame.pose;return!t&&!e?this.baseModelMatrix:(t||(t=this.tempVec3,t[0]=t[1]=t[2]=0),Gn(this.baseModelMatrix,e,t),this.baseModelMatrix)}getBaseViewMatrix(t){if(t==="left"||t==="none")return this.frame.leftViewMatrix;if(t==="right")return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let t=[];for(let e in this.gamepadInputSources)t.push(this.gamepadInputSources[e].inputSource);return t}getInputPose(t,e,r){if(!e)return null;for(let o in this.gamepadInputSources){let i=this.gamepadInputSources[o];if(i.inputSource===t)return i.getXRPose(e,r)}return null}onWindowResize(){}onVRDisplayPresentChange(t){this.display.isPresenting||this.sessions.forEach(e=>{if(e.immersive&&!e.ended){if(e.modifiedCanvasLayer){let r=e.baseLayer.context.canvas;document.body.removeChild(r),r.setAttribute("style","")}this.immersiveSession===e&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",e.id)}})}};var ji=class extends Br{constructor(t,e){let r=new Yf.default(e||{});super(t,r),this.display=r,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}};var w_=!1,E_=0,Wc=class{constructor(t,e){this.mode=t,this.enabledFeatures=e,this.ended=null,this.baseLayer=null,this.id=++E_}},Wi=class extends kr{constructor(t){super(t),this.sessions=new Map,this.projectionMatrix=qt(),this.identityMatrix=qt()}onBaseLayerSet(t,e){let r=this.sessions.get(t);r.baseLayer=e}isSessionSupported(t){return t=="inline"}isFeatureSupported(t){switch(t){case"viewer":return!0;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let r=new Wc(t,e);return this.sessions.set(r.id,r),Promise.resolve(r.id)}requestAnimationFrame(t){return window.requestAnimationFrame(t)}cancelAnimationFrame(t){window.cancelAnimationFrame(t)}onFrameStart(t,e){if(w_)return;let r=this.sessions.get(t);if(r.baseLayer){let o=r.baseLayer.context.canvas;Za(this.projectionMatrix,e.inlineVerticalFieldOfView,o.width/o.height,e.depthNear,e.depthFar)}}onFrameEnd(t){}async endSession(t){let e=this.sessions.get(t);e.ended=!0}doesSessionSupportReferenceSpace(t,e){let r=this.sessions.get(t);return r.ended?!1:r.enabledFeatures.has(e)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(t,e){return null}getProjectionMatrix(t){return this.projectionMatrix}getViewport(t,e,r,o){let i=this.sessions.get(t),{width:s,height:p}=r.context.canvas;return o.x=o.y=0,o.width=s,o.height=p,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(t){return this.identityMatrix}getInputSources(){return[]}getInputPose(t,e,r){return null}onWindowResize(){}};var T_=async function(n){let t=null;if("getVRDisplays"in n.navigator)try{let e=await n.navigator.getVRDisplays();e&&e.length&&(t=new Br(n,e[0]))}catch{}return t},Jf=async function(n,t){if(t.webvr){let r=await T_(n);if(r)return r}let e=Ff(n);return e&&t.cardboard||!e&&t.allowCardboardOnDesktop?(n.VRFrameData||(n.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new ji(n,t.cardboardConfig)):new Wi(n)};var S_={global:Ya,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},ll=["navigator","HTMLCanvasElement","WebGLRenderingContext"],qi=class{constructor(t={}){this.config=Object.freeze(Object.assign({},S_,t)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}_injectPolyfill(t){if(!ll.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${ll}`);for(let e of Object.keys(al))t[e]!==void 0?console.warn(`${e} already defined on global.`):t[e]=al[e];Nc(t.WebGLRenderingContext)&&(Xc(t.HTMLCanvasElement),t.OffscreenCanvas&&Xc(t.OffscreenCanvas),t.WebGL2RenderingContext&&Nc(t.WebGL2RenderingContext),window.isSecureContext||console.warn(`WebXR Polyfill Warning:
This page is not running in a secure context (https:// or localhost)!
This means that although the page may be able to use the WebXR Polyfill it will
not be able to use native WebXR implementations, and as such will not be able to
access dedicated VR or AR hardware, and will not be able to take advantage of
any performance improvements a native WebXR implementation may offer. Please
host this content on a secure origin for the best user experience.
`)),this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let t=Jf(this.global,this.config);this.xr=new al.XRSystem(t),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(t){if(!ll.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${ll}`);if(t.navigator.xr&&"supportsSession"in t.navigator.xr&&!("isSessionSupported"in t.navigator.xr)){let e=t.navigator.xr.supportsSession;t.navigator.xr.isSessionSupported=function(r){return e.call(this,r).then(()=>!0).catch(()=>!1)},t.navigator.xr.supportsSession=function(r){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),e.call(this,r)}}}};navigator.xr||(console.info("Polyfilling WebXR API"),new qi);var cl=class extends W{constructor(e,r,o,i,s){super(e);this.mode=r;this.session=o;this.referenceSpaceType=i;this.sessionMode=s}},dl=class extends cl{constructor(t,e,r,o){super("sessionstarted",t,e,r,o)}},ul=class extends cl{constructor(t,e,r,o){super("sessionstopped",t,e,r,o)}},pl=new Map([["VR",{referenceSpaceType:"local-floor",sessionMode:"immersive-vr"}],["AR",{referenceSpaceType:"local-floor",sessionMode:"immersive-ar"}]]),ml=class extends Y{constructor(e,r,o,i){super();this.renderer=e;this.camera=r;this.fullscreenElement=o;this.enableFullResolution=i;this._currentMode="None";this.buttons=new Map;this.currentSession=null;this.screenUI=null;this.wasVisible=new Map;this.lastWidth=0;this.lastHeight=0;this.addEventListener("sessionstarted",s=>{s.sessionMode==="inline"&&(this.camera.fov=s.session.renderState.inlineVerticalFieldOfView*180/Math.PI)}),this.addEventListener("sessionstopped",s=>{s.sessionMode==="inline"&&(this.camera.fov=50)}),this.renderer.xr.addEventListener("sessionstart",()=>this.onSessionStarted()),this.renderer.xr.addEventListener("sessionend",()=>this.onSessionEnded()),this.refresh()}setUI(e,r,o,i){this.screenUI=e,this.buttons.set(r.mode,r),this.buttons.set(o.mode,o),this.buttons.set(i.mode,i);for(let s of this.buttons.values())this.wasVisible.set(s,s.visible),s.addEventListener("click",this.toggleMode.bind(this,s.mode));r.available=!Jt()&&Mc(),o.available=ns(),i.available=ts()}get visible(){return Bt(this.renderer.domElement)}set visible(e){Be(this.renderer.domElement,e),this.screenUI&&Be(this.screenUI,e,"grid")}get currentMode(){return this._currentMode}resize(){if(!this.renderer.xr.isPresenting){let e=this.renderer.domElement.clientWidth,r=this.renderer.domElement.clientHeight;e>0&&r>0&&(e!==this.lastWidth||r!==this.lastHeight)&&(this.renderer.setPixelRatio(devicePixelRatio),this.renderer.setSize(e,r,!1),this.camera.aspect=e/r,this.camera.updateProjectionMatrix(),this.lastWidth=e,this.lastHeight=r)}}getMetrics(){let e=this.renderer.domElement.clientWidth,r=this.renderer.domElement.clientHeight,o=this.renderer.getPixelRatio(),i=this.camera.fov;return{width:e,height:r,pixelRatio:o,fov:i}}setMetrics(e,r,o,i){this.renderer.setPixelRatio(o),this.renderer.setSize(e,r,!1),this.camera.aspect=e/r,this.camera.fov=i,this.camera.updateProjectionMatrix()}async refresh(){await Promise.all(Array.from(this.buttons.values()).filter(e=>e.available&&e.mode!=="Fullscreen").map(async e=>{let r=pl.get(e.mode);if(e.available=v(r),e.available){let o=navigator.xr&&await navigator.xr.isSessionSupported(r.sessionMode),i=!ts()&&Ol()&&r.sessionMode==="immersive-vr"&&r.referenceSpaceType==="local-floor";e.available=o||i}}))}async toggleMode(e){e==="Fullscreen"?await this.toggleFullscreen():e!=="None"&&await this.toggleXR(e)}async start(e){e!==this.currentMode&&(await this.toggleMode(this.currentMode),await this.toggleMode(e))}async stop(){await this.toggleMode(this.currentMode)}get isFullscreen(){return document.fullscreen}async startFullscreen(){this.isFullscreen||(await this.fullscreenElement.requestFullscreen({navigationUI:"show"}),this.setActive("Fullscreen"),this.dispatchEvent(new dl("Fullscreen",null,null,null)))}async stopFullscreen(){this.isFullscreen&&(await document.exitFullscreen(),this.setActive("None"),this.dispatchEvent(new ul("Fullscreen",null,null,null)))}async toggleFullscreen(){this.isFullscreen?await this.stopFullscreen():await this.startFullscreen()}async toggleXR(e){let r=pl.get(e);if(v(r)){if(this.currentSession)this.currentSession.end();else if(navigator.xr){this.camera.position.setScalar(0),this.camera.quaternion.identity();try{let o=await navigator.xr.requestSession(r.sessionMode,{optionalFeatures:["local-floor","bounded-floor","high-refresh-rate","hand-tracking","layers"]});if(this.setActive(e),this.currentSession=o,this.renderer.xr.setReferenceSpaceType(r.referenceSpaceType),this.enableFullResolution&&"XRWebGLLayer"in window&&"getNativeFramebufferScaleFactor"in XRWebGLLayer){let i=XRWebGLLayer.getNativeFramebufferScaleFactor(o);this.renderer.xr.setFramebufferScaleFactor(i)}this.renderer.xr.setSession(o)}catch(o){console.error(`Couldn't start session type '${r.sessionMode}'. Reason: ${o&&o.message||o||"UNKNOWN"}`)}}}}onSessionStarted(){let e=this.currentMode,r=pl.get(this.currentMode),o=this.currentSession;if(o.supportedFrameRates){let i=Math.max(...o.supportedFrameRates);console.log("Changing framerate to",i),o.updateTargetFrameRate(i)}this.dispatchEvent(new dl(e,o,r.referenceSpaceType,r.sessionMode))}onSessionEnded(){let e=this.currentMode,r=pl.get(this.currentMode),o=this.currentSession;this.currentSession=null,this.renderer.xr.setSession(null),this.setActive("None"),this.dispatchEvent(new ul(e,o,r.referenceSpaceType,r.sessionMode))}setActive(e){for(let r of this.buttons.values())r.active=r.mode===e,r.visible=this.wasVisible.get(r)&&(e==="None"||e==="Fullscreen"||r.mode===e);this._currentMode=e}};var $f=new D(0,1,0),Ze=2048,ko=Ze/2,M_=[1,0,2,3,4,5],xn={rows:3,columns:4,indices:[[-1,2,-1,-1],[0,5,1,4],[-1,3,-1,-1]],rotations:[[0,Math.PI,0,0],[0,0,0,0],[0,Math.PI,0,0]]},qc=new we(0),hl=class{constructor(t){this.env=t;this.rt=new oh(Ze);this.rtScene=new ea;this.rtCamera=new vm(.01,10,this.rt);this._rotation=new de;this.layerRotation=new de().identity();this.stageRotation=new de().identity();this.canvases=new Array(6);this.contexts=new Array(6);this.layerOrientation=null;this.images=null;this.curImagePath=null;this.layer=null;this.wasVisible=!1;this.stageHeading=0;this.rotationNeedsUpdate=!1;this.imageNeedsUpdate=!1;this.useWebXRLayers=!0;this.wasWebXRLayerAvailable=null;this.visible=!0;this.onNeedsRedraw=()=>this.imageNeedsUpdate=!0,this.onTick=e=>this.checkWebXRLayer(e.frame),this.env.scene.background=qc;for(let e=0;e<this.canvases.length;++e){let r=this.canvases[e]=ro(Ze,Ze);this.contexts[e]=r.getContext("2d",{alpha:!1})}for(let e=0;e<xn.rows;++e){let r=xn.indices[e],o=xn.rotations[e];for(let i=0;i<xn.columns;++i){let s=r[i];if(s>-1){let p=this.contexts[s],c=o[i];c>0&&(c%2,p.translate(ko,ko),p.rotate(c),p.translate(-ko,-ko))}}}this.rt.texture.name="SkyboxOutput",this.rtScene.add(this.rtCamera),this.flipped=ro(Ze,Ze),this.flipper=this.flipped.getContext("2d",{alpha:!1}),this.flipper.fillStyle=qc.getHexString(),this.flipper.scale(-1,1),this.flipper.translate(-Ze,0),this.setImages("",this.canvases),this.env.timer.addTickHandler(this.onTick),Object.seal(this)}setImage(t,e){if(t!==this.curImagePath){let r=e.width/xn.columns,o=e.height/xn.rows;for(let i=0;i<xn.rows;++i){let s=xn.indices[i];for(let p=0;p<xn.columns;++p){let c=s[p];c>-1&&this.contexts[c].drawImage(e,p*r,i*o,r,o,0,0,Ze,Ze)}}this.setImages(t,this.canvases)}}setImages(t,e){(t!==this.curImagePath||e!==this.images)&&(this.curImagePath=t,e!==this.images&&(v(this.cube)&&sn(this.cube),this.images=e,this.rtScene.background=this.cube=new Am(this.images),this.cube.name="SkyboxInput")),this.updateImages()}updateImages(){this.cube.needsUpdate=!0,this.imageNeedsUpdate=!0}get rotation(){return this._rotation}set rotation(t){let{x:e,y:r,z:o,w:i}=this._rotation;if(ph(t))this._rotation.copy(t);else if(ch(t))this._rotation.setFromEuler(t);else if(tt(t))if(t.length===4&&he(t[0])&&he(t[1])&&he(t[2])&&he(t[3]))this._rotation.fromArray(t);else throw new Error("Skybox rotation was not a valid array format. Needs an array of 4 numbers.");else ze(t)?this._rotation.setFromAxisAngle($f,t):(v(t)&&console.warn("Skybox rotation must be a THREE.Quaternion, THREE.Euler, number[] (representing a Quaternion), or a number (representing rotation about the Y-axis)."),this._rotation.identity());this.rotationNeedsUpdate=this._rotation.x!==e||this._rotation.y!==r||this._rotation.z!==o||this._rotation.w!==i}checkWebXRLayer(t){if(this.cube){let e=this.useWebXRLayers&&this.env.hasXRCompositionLayers&&v(t)&&v(this.env.xrBinding),r=e!==this.wasWebXRLayerAvailable;if(r){if(e){let o=this.env.renderer.xr.getReferenceSpace();this.layer=this.env.xrBinding.createCubeLayer({space:o,layout:"mono",isStatic:!1,viewPixelWidth:Ze,viewPixelHeight:Ze,orientation:this.layerOrientation}),this.layer.addEventListener("redraw",this.onNeedsRedraw),this.env.addWebXRLayer(this.layer,Number.MAX_VALUE)}else this.layer&&(this.env.removeWebXRLayer(this.layer),this.layer.removeEventListener("redraw",this.onNeedsRedraw),this.layer.destroy(),this.layer=null);this.imageNeedsUpdate=!0}if(!this.layer||!r){let o=this.visible!==this.wasVisible,i=this.env.avatar.heading!==this.stageHeading;if(this.imageNeedsUpdate=this.imageNeedsUpdate||o||this.layer&&this.layer.needsRedraw,this.rotationNeedsUpdate=this.rotationNeedsUpdate||i,this.env.scene.background=this.layer?null:this.visible?this.rt.texture:qc,this.rotationNeedsUpdate&&(this.layerRotation.copy(this.rotation).invert(),this.stageRotation.setFromAxisAngle($f,this.env.avatar.heading).premultiply(this.layerRotation),this.layerOrientation=new DOMPointReadOnly(this.stageRotation.x,this.stageRotation.y,this.stageRotation.z,this.stageRotation.w),this.layer?this.layer.orientation=this.layerOrientation:(this.rtCamera.quaternion.copy(this.layerRotation),this.imageNeedsUpdate=!0)),this.imageNeedsUpdate)if(this.layer){let s=this.env.renderer.getContext(),p=this.env.xrBinding.getSubImage(this.layer,t),c=this.cube.images;this.flipper.fillRect(0,0,Ze,Ze),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.bindTexture(s.TEXTURE_CUBE_MAP,p.colorTexture);for(let u=0;u<c.length;++u){if(this.visible){let h=c[M_[u]];this.flipper.drawImage(h,0,0,h.width,h.height,0,0,Ze,Ze)}s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.flipped)}s.bindTexture(s.TEXTURE_CUBE_MAP,null)}else this.rtCamera.update(this.env.renderer,this.rtScene);this.stageHeading=this.env.avatar.heading,this.imageNeedsUpdate=!1,this.rotationNeedsUpdate=!1,this.wasVisible=this.visible}this.wasWebXRLayerAvailable=e}}};var Qc=class extends ni{constructor(){super();this.frame=null;Object.seal(this)}set(e,r,o){super.set(e,r),this.frame=o}},fl=class{constructor(t){this.renderer=t;this.tickHandlers=new Array;this.lt=-1;this._isRunning=!1;let e=new Qc,r=0;this._onTick=(o,i)=>{this.lt>=0&&(r=o-this.lt,e.set(o,r,i),this.tick(e)),this.lt=o}}get isRunning(){return this._isRunning}restart(){this.stop(),this.start()}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){mt(this.tickHandlers,t)}setAnimationLoop(t){this.renderer.setAnimationLoop(t),this._isRunning=v(t)}start(){this.isRunning||this.setAnimationLoop(this._onTick)}stop(){this.isRunning&&(this.setAnimationLoop(null),this.lt=-1)}tick(t){for(let e of this.tickHandlers)e(t)}};var Zf=15,P_=Bd(Zf);Ot(Q("#frontBuffer",qr("absolute"),nr(0),or(0),tn("100%"),vt("100%"),Sn(0),kt(0),Hd(0),nu("none")));var xl=class extends Y{constructor(e,r,o,i,s){super();this.fetcher=r;this.defaultAvatarHeight=o;this.DEBUG=s;this.layers=new Array;this.layerSortOrder=new Map;this.spectator=new mi;this.lastViewport=new zt;this.curViewport=new zt;this.gltfLoader=new Nn;this.fadeDepth=0;this.camera=new mi(50,1,.01,1e3);this.scene=new ea;this.stage=ue("Stage");this.ambient=new cm(16777215,.5);this.sun=new qs(16777215,.75);this.ground=new Em(P_,Zf,12632256,8421504);this.foreground=ue("Foreground");this.loadingBar=new Ka;this.enableSpectator=!1;this._xrBinding=null;this._xrMediaBinding=null;this._hasXRMediaLayers=null;this._hasXRCompositionLayers=null;if(this.cursor3D=new To(this),rn(e)&&(e.style.backgroundColor="black",B(e.parentElement)))throw new Error("The provided canvas must be included in a parent element before constructing the environment.");this.renderer=new ih({canvas:e,powerPreference:"high-performance",precision:"lowp",antialias:!0,alpha:!0,premultipliedAlpha:!0,depth:!0,logarithmicDepthBuffer:!0,stencil:!1,preserveDrawingBuffer:!1}),this.renderer.domElement.setAttribute("touch-action","none"),this.renderer.domElement.tabIndex=1,rn(e)&&(this.screenControl=new ml(this.renderer,this.camera,this.renderer.domElement.parentElement,i)),this.fader=new Qa("ViewFader"),this.worldUISpace=new Ta("WorldUISpace",.2,20,.125),this.avatar=new Ra(this,this.fader,o),this.eventSys=new qa(this),this.timer=new fl(this.renderer),this.skybox=new hl(this),this.renderer.xr.enabled=!0,this.sun.name="Sun",this.sun.position.set(0,1,1),this.sun.lookAt(0,0,0),this.sun.layers.enableAll();let p=()=>{this.ground.visible=this.renderer.xr.isPresenting};this.screenControl.addEventListener("sessionstarted",p),this.screenControl.addEventListener("sessionstopped",p),p(),this.ambient.name="Fill",this.ambient.layers.enableAll(),this.loadingBar.object.name="MainLoadingBar",this.loadingBar.object.position.set(0,-.25,-2),this.scene.layers.enableAll(),this.avatar.addFollower(this.worldUISpace),j(this.scene,this.sun,this.ambient,j(this.stage,this.ground,this.camera,this.avatar,...this.eventSys.hands),this.foreground,j(this.worldUISpace,this.loadingBar)),this.timer.addTickHandler(c=>this.update(c)),this.timer.start(),globalThis.env=this}get gl(){return this.renderer.getContext()}get referenceSpace(){return this.renderer.xr.getReferenceSpace()}update(e){if(this.screenControl.visible){let r=this.xrSession;this._xrBinding=this.renderer.xr.getBinding(),this.hasXRMediaLayers&&this._xrMediaBinding===null===this.renderer.xr.isPresenting&&(this._xrMediaBinding===null&&v(r)?this._xrMediaBinding=new XRMediaBinding(r):this._xrMediaBinding=null);let o=r&&this.renderer.xr.getBaseLayer();o!==this.baseLayer&&(v(this.baseLayer)&&(this.removeWebXRLayer(this.baseLayer),this.baseLayer=null),v(o)&&(this.baseLayer=o,this.addWebXRLayer(o,0))),this.screenControl.resize(),this.eventSys.update(),this.avatar.update(e.dt),this.worldUISpace.update(this.avatar.height,this.avatar.worldPos,this.avatar.worldHeading,e.dt),this.fader.update(e.dt),mh(e.dt),this.loadingBar.update(e.sdt),this.preRender(e);let i=vr(this.renderer,this.camera);if(i!==this.camera){let s=i;s.layers.mask=this.camera.layers.mask;for(let p=0;p<s.cameras.length;++p){let c=s.cameras[p];c.layers.mask=this.camera.layers.mask,c.layers.enable(p+1),s.layers.enable(p+1)}}this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.enableSpectator&&(this.renderer.xr.isPresenting?Fr()&&!hd()&&this.drawSnapshot():(this.lastViewport.copy(this.curViewport),this.renderer.getViewport(this.curViewport)))}}drawSnapshot(){let e=this.renderer.xr.isPresenting,r=null;if(e){let o=vr(this.renderer,this.camera);this.spectator.projectionMatrix.copy(this.camera.projectionMatrix),this.spectator.position.copy(o.position),this.spectator.quaternion.copy(o.quaternion),r=this.renderer.getRenderTarget(),this.renderer.xr.isPresenting=!1,this.renderer.setRenderTarget(null),this.renderer.setViewport(this.lastViewport)}this.renderer.clear(),this.renderer.render(this.scene,e?this.spectator:this.camera),e&&(this.renderer.setViewport(this.curViewport),this.renderer.setRenderTarget(r),this.renderer.xr.isPresenting=!0)}preRender(e){}async onQuitting(){this.dispatchEvent(new W("quitting")),window.location.href="/"}get hasAlpha(){return this.renderer.getContextAttributes().alpha}get xrSession(){return this.renderer.xr.getSession()}get xrBinding(){return this._xrBinding}get xrMediaBinding(){return this._xrMediaBinding}get isReadyForLayers(){return this.hasAlpha&&(!$t||fd.major>=15)}get hasXRMediaLayers(){return this._hasXRMediaLayers===null&&(this._hasXRMediaLayers=this.isReadyForLayers&&"XRMediaBinding"in globalThis&&Z(XRMediaBinding.prototype.createQuadLayer)),this._hasXRMediaLayers}get hasXRCompositionLayers(){return this._hasXRCompositionLayers===null&&(this._hasXRCompositionLayers=this.isReadyForLayers&&"XRWebGLBinding"in globalThis&&Z(XRWebGLBinding.prototype.createCubeLayer)),this._hasXRCompositionLayers}addWebXRLayer(e,r){this.layers.push(e),this.layerSortOrder.set(e,r),Jn(this.layers,o=>-this.layerSortOrder.get(o)),this.updateLayers()}removeWebXRLayer(e){this.layerSortOrder.delete(e),mt(this.layers,e),this.updateLayers()}updateLayers(){let e=this.xrSession;v(e)&&e.updateRenderState({layers:this.layers})}clearScene(){this.dispatchEvent(new W("sceneclearing")),sn(this.foreground),this.dispatchEvent(new W("scenecleared"))}async fadeOut(){++this.fadeDepth,this.fadeDepth===1&&(await this.fader.fadeOut(),this.skybox.visible=!1,this.camera.layers.set(wo),this.loadingBar.start(),await this.fader.fadeIn())}async fadeIn(){this.fadeDepth===1&&(await this.fader.fadeOut(),this.camera.layers.set(Ia),this.skybox.visible=!0,await this.fader.fadeIn()),--this.fadeDepth}get showWebXRLayers(){return this.fadeDepth===0}set3DCursor(e){let r=e.children.slice(0);for(let o of r)this.cursor3D.add(o.name,o);this.eventSys.refreshCursors(),this.dispatchEvent(new W("newcursorloaded"))}async load(e,...r){let o=null;di(e)?r.push(e):o=e;let i=new Sa(this,"/models/Cursors.glb",Xs,!this.DEBUG);r.push(i),await this.fetcher.assets(o,...r),vh(i.result.scene,Ah),this.set3DCursor(i.result.scene)}loadGltf(e){return this.gltfLoader.loadAsync(e)}};var gl=class{constructor(t,e){this.name=t;this._level=0;this.maxLevel=0;this.analyzer=Iu(this.name,e,{fftSize:32,minDecibels:-70}),this.buffer=new Uint8Array(this.analyzer.frequencyBinCount)}dispose(){re(this.analyzer)}get level(){return this.analyzer.getByteFrequencyData(this.buffer),this._level=Math.max(...this.buffer),isFinite(this._level)&&(this.maxLevel=Math.max(this.maxLevel,this._level),this.maxLevel>0&&(this._level/=this.maxLevel)),this._level}get input(){return this.analyzer}get output(){return this.analyzer}};Ot(Q(".input-range-with-number",Fe("grid"),Yd("column"),Wd("5px"),en("1fr auto")));var Qi=class extends Y{constructor(...e){super();this.element=ye(ge("input-range-with-number"),this.rangeInput=bu(...e),this.numberInput=_u()),this.numberInput.min=this.rangeInput.min,this.numberInput.max=this.rangeInput.max,this.numberInput.step=this.rangeInput.step,this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.numberInput.disabled=this.rangeInput.disabled,this.numberInput.placeholder=this.rangeInput.placeholder,this.numberInput.addEventListener("input",()=>{this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber,this.rangeInput.dispatchEvent(new Event("input"))}),this.rangeInput.addEventListener("input",()=>{this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.dispatchEvent(new W("input"))})}get value(){return this.rangeInput.value}set value(e){this.rangeInput.value=this.numberInput.value=e}get valueAsNumber(){return this.rangeInput.valueAsNumber}set valueAsNumber(e){this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber=e}get disabled(){return this.rangeInput.disabled}set disabled(e){this.rangeInput.disabled=this.numberInput.disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}};Ot(Q("dl.properties",Fe("grid"),en("auto 1fr"),Jd(".25em")),Q("dl.properties.disabled",jd("#ccc")),Q("dl.properties > dt",tr(1,2),Mn("right")),Q("dl.properties > dt > label",Sn(0),kt(0),vt("100%"),ou("sub")),Q("dl.properties > dd",tr(2,-1),Fe("grid"),en("auto")),Q("dl.properties > dd input[type=number]",Mn("right")),Q("dl.properties > dd > img",rr("10em")),Q("dl.properties > dd > select",vt("30px")),Q("dl.properties > .single-item",tr(1,-1),Mn("center")));var vl=class{constructor(t,...e){this.name=t;this.properties=e}};function ex(n,...t){return new vl(n,...t)}var C_="DefaultPropertyGroup"+St(16),Al=class{constructor(...t){this.rowGroups=new Map;this.controls=new Array;this._disabled=!1;this.element=uu(ge("properties"),...this.createElements(t))}append(...t){fe(this.element,...this.createElements(t))}get disabled(){return this._disabled}set disabled(t){if(t!==this.disabled){this._disabled=t,np(this,t,"disabled");for(let e of this.controls)e.disabled=t}}get enabled(){return!this.disabled}set enabled(t){this.disabled=!t}createElements(t){return t.flatMap(e=>this.createGroups(e).flatMap(An))}createGroups(t){let e=C_,r=new Array;return t instanceof vl?(e=t.name,r.push(...t.properties.map(o=>this.createRow(o)))):r.push(this.createRow(t)),this.rowGroups.has(e)||this.rowGroups.set(e,[]),this.rowGroups.get(e).push(...r),r}createRow(t){if(tt(t)){let[e,...r]=t,o=xu(e);for(let i of r)if(si(i)&&this.controls.push(i),i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement){i.id.length===0&&(i.id=St(10)),o.htmlFor=i.id;break}return[mu(o),du(...r)]}else return(ne(t)||he(t)||et(t)||kl(t))&&(t=ye(fu(t))),np(t,!0,"single-item"),si(t)&&this.controls.push(t),[t]}setGroupVisible(t,e){let r=this.rowGroups.get(t);if(r)for(let o of r)for(let i of o)Be(i,e)}};var Kc="micFields"+St(8),_l=class extends lo{constructor(e){super("Configure devices");this.env=e;this.micLookup=null;this.spkrLookup=null;this.spkrVolumeControl=null;this.ready=null;this.speakers=null;this.timer=new ls(30);this.tele=null;this.cancelButton.style.display="none";let r=this.env.audio.loadBasicClip("test-audio","/audio/test-clip.mp3",.5);fe(this.container,gt(eu("max-content"))),fe(this.contentArea,this.properties=new Al(ex(Kc,"Input",["Microphones",this.microphones=op(yo(async()=>{let o=this.env.apps.get("tele"),i=this.microphones.value,s=this.micLookup.get(i);await o.conference.microphones.setAudioInputDevice(s)}))],["Input level",this.micScenario=gu()],["Volume",this.micVolumeControl=new Qi(Kl(0),Ql(100),Jl(1),Wr(0),yo(()=>{e.audio.input.gain.setValueAtTime(this.micVolumeControl.valueAsNumber/100,0)}))],"Output"))),Gt&&(this.properties.append(["Speakers",this.speakers=op(yo(async()=>{let o=this.speakers.value,i=this.spkrLookup.get(o);await this.env.audio.speakers.setAudioOutputDevice(i)}))]),this.env.audio.speakers.addEventListener("audiooutputchanged",o=>{this.speakers.value=o.device&&o.device.deviceId||""})),this.properties.append(["Using headphones",this.useHeadphones=Au(yo(()=>{this.env.audio.useHeadphones=this.useHeadphones.checked,Be(this.headphoneWarning,!this.env.audio.useHeadphones,"inline-block")})),this.testSpkrButton=_s("Test",Ur("Test audio"),gt($d("0.5em")),Uh(async()=>{this.testSpkrButton.disabled=!0,await r,await this.env.audio.playClipThrough("test-audio"),this.testSpkrButton.disabled=!1}))],this.headphoneWarning=ye(ge("alert alert-warning"),"\u{1F3A7}\u{1F399}\uFE0F This site has a voice chat feature. Voice chat is best experienced using headphones."),["Volume",this.spkrVolumeControl=new Qi(Kl(0),Ql(100),Jl(1),Wr(0),yo(()=>e.audio.audioDestination.volume=this.spkrVolumeControl.valueAsNumber/100))]),this.activity=new gl("device-settings-dialog-activity",this.env.audio.audioCtx),this.timer.addTickHandler(()=>{this.micScenario.value=this.activity.level}),this.properties.setGroupVisible(Kc,!1),this.waitForTele(),Object.seal(this)}async waitForTele(){this.tele=await this.env.apps.waitFor("tele"),this.properties.setGroupVisible(Kc,!0),this.tele.conference.microphones.addEventListener("audioinputchanged",e=>{this.microphones.value=e.audio&&e.audio.deviceId||""}),Mt(this.env.audio.input,this.activity)}async load(){await this.env.audio.ready}async onShowing(){if(this.ready===null&&(this.ready=this.load()),await this.ready,this.tele){await this.tele.ready,await this.tele.conference.microphones.ready;let e=await this.tele.conference.microphones.getAudioInputDevices();this.micLookup=Ll(e,o=>o.deviceId),ai(this.microphones),fe(this.microphones,bs(Wr(""),"NONE"),...e.map(o=>bs(Wr(o.deviceId),o.label)));let r=await this.tele.conference.microphones.getAudioInputDevice();this.microphones.value=r&&r.deviceId||"",this.micVolumeControl.valueAsNumber=this.env.audio.input.gain.value*100}if(Gt){await this.env.audio.speakers.ready;let e=await this.env.audio.speakers.getAudioOutputDevices();this.spkrLookup=Ll(e,o=>o.deviceId),ai(this.speakers),fe(this.speakers,...e.map(o=>bs(Wr(o.deviceId),o.label)));let r=await this.env.audio.speakers.getAudioOutputDevice();r||(r=await this.env.audio.speakers.getPreferredAudioOutput(),await this.env.audio.speakers.setAudioOutputDevice(r)),this.speakers.value=r&&r.deviceId||""}this.spkrVolumeControl.valueAsNumber=this.env.audio.audioDestination.volume*100,this.useHeadphones.checked=this.env.audio.useHeadphones,Be(this.headphoneWarning,!this.env.audio.useHeadphones,"inline-block"),this.timer.start(),await super.onShowing()}onClosed(){this.timer.stop(),super.onClosed()}};var Yc=class extends W{constructor(e){super("roomjoined");this.roomName=e}},bl=class extends xl{constructor(e,r,o,i,s,p,c){super(e,r,s,p,c&&c.DEBUG);this.screenUISpace=new ua;this.envAudioToggleEvt=new W("environmentaudiotoggled");this._currentRoom=null;this._testSpaceLayout=!1;this.countTick=0;this.fpses=new Array;this.avgFPS=0;this.compassImage=new Hs,this.clockImage=new hr(this,"Clock","dynamic",new Us),this.clockImage.sizeMode="fixed-height",this.clockImage.mesh.renderOrder=5,c=c||{},this.apps=new ba(this),this.apps.addEventListener("apploading",u=>{u.preLoadTask=this.fadeOut().then(()=>{this.clearScene(),this.avatar.reset()})}),this.apps.addEventListener("apploaded",u=>{u.app.addEventListener("joinroom",h=>{h.roomName!==this._currentRoom&&(this._currentRoom=h.roomName,this.dispatchEvent(new Yc(h.roomName)))})}),this.apps.addEventListener("appshown",async u=>{this.lobbyButton.visible=u.appName!=="menu",await this.fadeIn()}),this.audio=new Bs(sm),this.audio.setAudioProperties(1,4,"exponential"),this.audioPlayer=new Os(this.audio.audioCtx),this.videoPlayer=new Aa(this,this.audio.audioCtx),this.videoPlayer.object.visible=!1,this.interactionAudio=new da(this.audio,this.eventSys),this.confirmationDialog=new ca(this,o),this.devicesDialog=new _l(this),this.uiButtons=new _a(i,20,this.DEBUG),this.settingsButton=new Ao(this.uiButtons,"ui","settings"),this.quitButton=new Ao(this.uiButtons,"ui","quit"),this.lobbyButton=new Ao(this.uiButtons,"ui","lobby"),this.muteMicButton=new gr(this.uiButtons,"microphone","mute","unmute"),this.muteEnvAudioButton=new gr(this.uiButtons,"environment-audio","mute","unmute"),this.muteEnvAudioButton.active=!0,this.audio.ready.then(()=>this.muteEnvAudioButton.active=!1),this.vrButton=new _o(this.uiButtons,"VR"),this.fullscreenButton=new _o(this.uiButtons,"Fullscreen"),this.arButton=new _o(this.uiButtons,"AR"),this.xrUI=new ma,this.xrUI.addItem(this.clockImage,{x:-1,y:1,height:.1}),this.xrUI.addItem(this.quitButton,{x:1,y:1,scale:.5}),this.xrUI.addItem(this.confirmationDialog,{x:0,y:0,scale:.25}),this.xrUI.addItem(this.settingsButton,{x:-1,y:-1,scale:.5}),this.xrUI.addItem(this.muteMicButton,{x:-.84,y:-1,scale:.5}),this.xrUI.addItem(this.muteEnvAudioButton,{x:-.68,y:-1,scale:.5}),this.xrUI.addItem(this.lobbyButton,{x:-.473,y:-1,scale:.5}),this.xrUI.addItem(this.vrButton,{x:1,y:-1,scale:.5}),this.xrUI.addItem(this.fullscreenButton,{x:1,y:-1,scale:.5}),this.xrUI.addItem(this.arButton,{x:1,y:-1,scale:.5}),j(this.worldUISpace,this.xrUI),fe(this.screenUISpace.topRowLeft,this.compassImage,this.clockImage),fe(this.screenUISpace.topRowRight,this.quitButton),fe(this.screenUISpace.bottomRowLeft,this.settingsButton,this.muteMicButton,this.muteEnvAudioButton,this.lobbyButton),fe(this.screenUISpace.bottomRowRight,this.fullscreenButton,this.vrButton,this.arButton),ao.isAvailable&&$o()&&(this.batteryImage=new hr(this,"Battery","dynamic",new ao),this.batteryImage.sizeMode="fixed-height",this.xrUI.addItem(this.batteryImage,{x:.75,y:-1,width:.2,height:.1}),fe(this.screenUISpace.topRowRight,this.batteryImage)),this.vrButton.visible=Fr()&&ns()||Jt(),this.arButton.visible=!1,this.lobbyButton.visible=!1,this.muteMicButton.visible=!1,this.screenControl.setUI(this.screenUISpace,this.fullscreenButton,this.vrButton,this.arButton),this.quitButton.addEventListener("click",()=>this.withConfirmation("Confirm quit","Are you sure you want to quit?",async()=>{this.renderer.xr.isPresenting&&this.screenControl.stop(),await this.onQuitting()})),this.lobbyButton.addEventListener("click",()=>this.withConfirmation("Confirm return to lobby","Are you sure you want to return to the lobby?",()=>this.dispatchEvent(new W("home")))),this.settingsButton.addEventListener("click",async()=>{let u=this.screenControl.currentMode,h=this.renderer.xr.isPresenting;h&&await this.screenControl.stop(),await this.devicesDialog.showDialog(),h&&await this.screenControl.start(u)}),this.muteEnvAudioButton.addEventListener("click",()=>{this.muteEnvAudioButton.active=!this.muteEnvAudioButton.active,this.dispatchEvent(this.envAudioToggleEvt)}),this.avatar.addEventListener("avatarmoved",u=>this.audio.setUserPose(this.audio.localUserID,u.px,u.py,u.pz,u.fx,u.fy,u.fz,u.ux,u.uy,u.uz))}get currentRoom(){return this._currentRoom}get testSpaceLayout(){return this._testSpaceLayout}set testSpaceLayout(e){e!==this.testSpaceLayout&&(this._testSpaceLayout=e)}preRender(e){if(super.preRender(e),this.xrUI.visible=this.renderer.xr.isPresenting||this.testSpaceLayout,this.clockImage.isVisible=this.xrUI.visible||this.DEBUG,this.renderer.xr.isPresenting||this.compassImage.setPitchAndHeading(ss(this.avatar.worldPitch),ss(this.avatar.worldHeading)),this.DEBUG){let r=Math.round(e.fps);if(this.avgFPS+=r/100,this.fpses.push(r),this.fpses.length>100){let o=this.fpses.shift();this.avgFPS-=o/100}++this.countTick%100===0&&this.clockImage.image.setStats(this.avgFPS,this.renderer.info.render.calls,this.renderer.info.render.triangles)}this.audio.update(),this.confirmationDialog.update(e.dt);for(let r of this.apps)r.update(e)}get environmentAudioMuted(){return this.muteEnvAudioButton.active}async withConfirmation(e,r,o){this.onConfirmationShowing(!0),await this.confirmationDialog.prompt(e,r)&&o(),this.onConfirmationShowing(!1)}onConfirmationShowing(e){Gp(this.quitButton,!e),Gp(this.lobbyButton,!e)}async load(e,...r){let o=null;di(e)?(r.push(e),o=this.loadingBar):o=e,rn(this.renderer.domElement)&&fe(this.renderer.domElement.parentElement,this.screenUISpace,this.confirmationDialog,this.devicesDialog,this.renderer.domElement);let i=new kn("/audio/footsteps.mp3",oo,!this.DEBUG),s=new kn("/audio/basic_enter.mp3",oo,!this.DEBUG),p=new kn("/audio/basic_exit.mp3",oo,!this.DEBUG),c=new kn("/audio/basic_error.mp3",oo,!this.DEBUG),u=new kn("/audio/vintage_radio_button_pressed.mp3",oo,!this.DEBUG);r.push(...this.uiButtons.assets,i,s,p,c,u),await super.load(o,...r),this.audio.createBasicClip("footsteps",i.result,.5),this.interactionAudio.create("enter",s.result,.25),this.interactionAudio.create("exit",p.result,.25),this.interactionAudio.create("error",c.result,.25),this.interactionAudio.create("click",u.result,1)}};var P9=bl;export{P9 as default};
