var cx=Object.create;var El=Object.defineProperty;var dx=Object.getOwnPropertyDescriptor;var ux=Object.getOwnPropertyNames;var mx=Object.getPrototypeOf,hx=Object.prototype.hasOwnProperty;var fx=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),xx=(r,t)=>{for(var e in t)El(r,e,{get:t[e],enumerable:!0})},gx=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of ux(t))!hx.call(r,i)&&i!==e&&El(r,i,{get:()=>t[i],enumerable:!(n=dx(t,i))||n.enumerable});return r};var vx=(r,t,e)=>(e=r!=null?cx(mx(r)):{},gx(t||!r||!r.__esModule?El(e,"default",{value:r,enumerable:!0}):e,r));var sf=fx((Uc,Gc)=>{(function(r,t){typeof Uc=="object"&&typeof Gc<"u"?Gc.exports=t():typeof define=="function"&&define.amd?define(t):r.CardboardVRDisplay=t()})(Uc,function(){"use strict";var r=function(){function l(u){this.value=u}function c(u){var m,f;function g(T,b){return new Promise(function(y,C){var F={key:T,arg:b,resolve:y,reject:C,next:null};f?f=f.next=F:(m=f=F,_(T,b))})}function _(T,b){try{var y=u[T](b),C=y.value;C instanceof l?Promise.resolve(C.value).then(function(F){_("next",F)},function(F){_("throw",F)}):M(y.done?"return":"normal",y.value)}catch(F){M("throw",F)}}function M(T,b){switch(T){case"return":m.resolve({value:b,done:!0});break;case"throw":m.reject(b);break;default:m.resolve({value:b,done:!1});break}m=m.next,m?_(m.key,m.arg):f=null}this._invoke=g,typeof u.return!="function"&&(this.return=void 0)}return typeof Symbol=="function"&&Symbol.asyncIterator&&(c.prototype[Symbol.asyncIterator]=function(){return this}),c.prototype.next=function(u){return this._invoke("next",u)},c.prototype.throw=function(u){return this._invoke("throw",u)},c.prototype.return=function(u){return this._invoke("return",u)},{wrap:function(u){return function(){return new c(u.apply(this,arguments))}},await:function(u){return new l(u)}}}(),t=function(l,c){if(!(l instanceof c))throw new TypeError("Cannot call a class as a function")},e=function(){function l(c,u){for(var m=0;m<u.length;m++){var f=u[m];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(c,f.key,f)}}return function(c,u,m){return u&&l(c.prototype,u),m&&l(c,m),c}}(),n=function(){function l(c,u){var m=[],f=!0,g=!1,_=void 0;try{for(var M=c[Symbol.iterator](),T;!(f=(T=M.next()).done)&&(m.push(T.value),!(u&&m.length===u));f=!0);}catch(b){g=!0,_=b}finally{try{!f&&M.return&&M.return()}finally{if(g)throw _}}return m}return function(c,u){if(Array.isArray(c))return c;if(Symbol.iterator in Object(c))return l(c,u);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=.001,o=1,s=function(c,u){return"data:"+c+","+encodeURIComponent(u)},a=function(c,u,m){return c+(u-c)*m},p=function(){var l=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return l}}(),d=function(){var l=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return l}}(),h=function(){var l=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return l}}(),x=function(){var l=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return l}}(),A=function(){var l=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),c=l?parseInt(l[1],10):null;return function(){return c}}(),E=function(){var l=!1;return l=p()&&h()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return l}}(),S=function(){var l=!1;if(A()===65){var c=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(c){var u=c[1].split("."),m=n(u,4),f=m[0],g=m[1],_=m[2],M=m[3];l=parseInt(_,10)===3325&&parseInt(M,10)<148}}return function(){return l}}(),P=function(){var l=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return l}}(),R=function(){var c=window.orientation==90||window.orientation==-90;return P()?!c:c},I=function(c){return!(isNaN(c)||c<=i||c>o)},O=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},L=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},k=function(c){if(d())return!1;if(c.requestFullscreen)c.requestFullscreen();else if(c.webkitRequestFullscreen)c.webkitRequestFullscreen();else if(c.mozRequestFullScreen)c.mozRequestFullScreen();else if(c.msRequestFullscreen)c.msRequestFullscreen();else return!1;return!0},H=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},V=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},D=function(c,u,m,f){var g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,u),c.compileShader(g);var _=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(_,m),c.compileShader(_);var M=c.createProgram();c.attachShader(M,g),c.attachShader(M,_);for(var T in f)c.bindAttribLocation(M,f[T],T);return c.linkProgram(M),c.deleteShader(g),c.deleteShader(_),M},te=function(c,u){for(var m={},f=c.getProgramParameter(u,c.ACTIVE_UNIFORMS),g="",_=0;_<f;_++){var M=c.getActiveUniform(u,_);g=M.name.replace("[0]",""),m[g]=c.getUniformLocation(u,g)}return m},K=function(c,u,m,f,g,_,M){var T=1/(u-m),b=1/(f-g),y=1/(_-M);return c[0]=-2*T,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*b,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*y,c[11]=0,c[12]=(u+m)*T,c[13]=(g+f)*b,c[14]=(M+_)*y,c[15]=1,c},z=function(){var c=!1;return function(u){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(u)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(u.substr(0,4)))&&(c=!0)}(navigator.userAgent||navigator.vendor||window.opera),c},J=function(c,u){for(var m in u)u.hasOwnProperty(m)&&(c[m]=u[m]);return c},ye=function(c){if(p()){var u=c.style.width,m=c.style.height;c.style.width=parseInt(u)+1+"px",c.style.height=parseInt(m)+"px",setTimeout(function(){c.style.width=u,c.style.height=m},100)}window.canvas=c},Ae=function(){var l=Math.PI/180,c=Math.PI*.25;function u(b,y,C,F){var N=Math.tan(y?y.upDegrees*l:c),X=Math.tan(y?y.downDegrees*l:c),$=Math.tan(y?y.leftDegrees*l:c),W=Math.tan(y?y.rightDegrees*l:c),G=2/($+W),me=2/(N+X);return b[0]=G,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=me,b[6]=0,b[7]=0,b[8]=-(($-W)*G*.5),b[9]=(N-X)*me*.5,b[10]=F/(C-F),b[11]=-1,b[12]=0,b[13]=0,b[14]=F*C/(C-F),b[15]=0,b}function m(b,y,C){var F=y[0],N=y[1],X=y[2],$=y[3],W=F+F,G=N+N,me=X+X,Te=F*W,Le=F*G,be=F*me,je=N*G,nt=N*me,rt=X*me,it=$*W,ot=$*G,mn=$*me;return b[0]=1-(je+rt),b[1]=Le+mn,b[2]=be-ot,b[3]=0,b[4]=Le-mn,b[5]=1-(Te+rt),b[6]=nt+it,b[7]=0,b[8]=be+ot,b[9]=nt-it,b[10]=1-(Te+je),b[11]=0,b[12]=C[0],b[13]=C[1],b[14]=C[2],b[15]=1,b}function f(b,y,C){var F=C[0],N=C[1],X=C[2],$,W,G,me,Te,Le,be,je,nt,rt,it,ot;return y===b?(b[12]=y[0]*F+y[4]*N+y[8]*X+y[12],b[13]=y[1]*F+y[5]*N+y[9]*X+y[13],b[14]=y[2]*F+y[6]*N+y[10]*X+y[14],b[15]=y[3]*F+y[7]*N+y[11]*X+y[15]):($=y[0],W=y[1],G=y[2],me=y[3],Te=y[4],Le=y[5],be=y[6],je=y[7],nt=y[8],rt=y[9],it=y[10],ot=y[11],b[0]=$,b[1]=W,b[2]=G,b[3]=me,b[4]=Te,b[5]=Le,b[6]=be,b[7]=je,b[8]=nt,b[9]=rt,b[10]=it,b[11]=ot,b[12]=$*F+Te*N+nt*X+y[12],b[13]=W*F+Le*N+rt*X+y[13],b[14]=G*F+be*N+it*X+y[14],b[15]=me*F+je*N+ot*X+y[15]),b}function g(b,y){var C=y[0],F=y[1],N=y[2],X=y[3],$=y[4],W=y[5],G=y[6],me=y[7],Te=y[8],Le=y[9],be=y[10],je=y[11],nt=y[12],rt=y[13],it=y[14],ot=y[15],mn=C*W-F*$,Ii=C*G-N*$,Vi=C*me-X*$,Li=F*G-N*W,ki=F*me-X*W,Oi=N*me-X*G,Di=Te*rt-Le*nt,Bi=Te*it-be*nt,Fi=Te*ot-je*nt,Hi=Le*it-be*rt,Ni=Le*ot-je*rt,Xi=be*ot-je*it,Ce=mn*Xi-Ii*Ni+Vi*Hi+Li*Fi-ki*Bi+Oi*Di;return Ce?(Ce=1/Ce,b[0]=(W*Xi-G*Ni+me*Hi)*Ce,b[1]=(N*Ni-F*Xi-X*Hi)*Ce,b[2]=(rt*Oi-it*ki+ot*Li)*Ce,b[3]=(be*ki-Le*Oi-je*Li)*Ce,b[4]=(G*Fi-$*Xi-me*Bi)*Ce,b[5]=(C*Xi-N*Fi+X*Bi)*Ce,b[6]=(it*Vi-nt*Oi-ot*Ii)*Ce,b[7]=(Te*Oi-be*Vi+je*Ii)*Ce,b[8]=($*Ni-W*Fi+me*Di)*Ce,b[9]=(F*Fi-C*Ni-X*Di)*Ce,b[10]=(nt*ki-rt*Vi+ot*mn)*Ce,b[11]=(Le*Vi-Te*ki-je*mn)*Ce,b[12]=(W*Bi-$*Hi-G*Di)*Ce,b[13]=(C*Hi-F*Bi+N*Di)*Ce,b[14]=(rt*Ii-nt*Li-it*mn)*Ce,b[15]=(Te*Li-Le*Ii+be*mn)*Ce,b):null}var _=new Float32Array([0,0,0,1]),M=new Float32Array([0,0,0]);function T(b,y,C,F,N,X){u(b,F||null,X.depthNear,X.depthFar);var $=C.orientation||_,W=C.position||M;m(y,$,W),N&&f(y,y,N),g(y,y)}return function(b,y,C){return!b||!y?!1:(b.pose=y,b.timestamp=y.timestamp,T(b.leftProjectionMatrix,b.leftViewMatrix,y,C._getFieldOfView("left"),C._getEyeOffset("left"),C),T(b.rightProjectionMatrix,b.rightViewMatrix,y,C._getFieldOfView("right"),C._getEyeOffset("right"),C),!0)}}(),ae=function(){var c=window.self!==window.top,u=tt(document.referrer),m=tt(window.location.href);return c&&u!==m},tt=function(c){var u,m=c.indexOf("://");m!==-1?u=m+3:u=0;var f=c.indexOf("/",u);return f===-1&&(f=c.length),c.substring(0,f)},Vr=function(c){if(c.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var u=2*Math.acos(c.w);return u},un=function(){var l={};return function(c,u){l[c]===void 0&&(console.warn("webvr-polyfill: "+u),l[c]=!0)}}(),zt=function(c,u){var m=u?"Please use "+u+" instead.":"";un(c,c+" has been deprecated. This may not work on native WebVR displays. "+m)};function Vf(l,c,u){if(!c){u(l);return}for(var m=[],f=null,g=0;g<c.length;++g){var _=c[g];switch(_){case l.TEXTURE_BINDING_2D:case l.TEXTURE_BINDING_CUBE_MAP:var M=c[++g];if(M<l.TEXTURE0||M>l.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),m.push(null,null);break}f||(f=l.getParameter(l.ACTIVE_TEXTURE)),l.activeTexture(M),m.push(l.getParameter(_),null);break;case l.ACTIVE_TEXTURE:f=l.getParameter(l.ACTIVE_TEXTURE),m.push(null);break;default:m.push(l.getParameter(_));break}}u(l);for(var g=0;g<c.length;++g){var _=c[g],T=m[g];switch(_){case l.ACTIVE_TEXTURE:break;case l.ARRAY_BUFFER_BINDING:l.bindBuffer(l.ARRAY_BUFFER,T);break;case l.COLOR_CLEAR_VALUE:l.clearColor(T[0],T[1],T[2],T[3]);break;case l.COLOR_WRITEMASK:l.colorMask(T[0],T[1],T[2],T[3]);break;case l.CURRENT_PROGRAM:l.useProgram(T);break;case l.ELEMENT_ARRAY_BUFFER_BINDING:l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,T);break;case l.FRAMEBUFFER_BINDING:l.bindFramebuffer(l.FRAMEBUFFER,T);break;case l.RENDERBUFFER_BINDING:l.bindRenderbuffer(l.RENDERBUFFER,T);break;case l.TEXTURE_BINDING_2D:var M=c[++g];if(M<l.TEXTURE0||M>l.TEXTURE31)break;l.activeTexture(M),l.bindTexture(l.TEXTURE_2D,T);break;case l.TEXTURE_BINDING_CUBE_MAP:var M=c[++g];if(M<l.TEXTURE0||M>l.TEXTURE31)break;l.activeTexture(M),l.bindTexture(l.TEXTURE_CUBE_MAP,T);break;case l.VIEWPORT:l.viewport(T[0],T[1],T[2],T[3]);break;case l.BLEND:case l.CULL_FACE:case l.DEPTH_TEST:case l.SCISSOR_TEST:case l.STENCIL_TEST:T?l.enable(_):l.disable(_);break;default:console.log("No GL restore behavior for 0x"+_.toString(16));break}f&&l.activeTexture(f)}}var Ri=Vf,Lf=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),kf=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function vt(l,c,u,m){this.gl=l,this.cardboardUI=c,this.bufferScale=u,this.dirtySubmitFrameBindings=m,this.ctxAttribs=l.getContextAttributes(),this.instanceExt=l.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=l.drawingBufferWidth,this.bufferHeight=l.drawingBufferHeight,this.realBindFramebuffer=l.bindFramebuffer,this.realEnable=l.enable,this.realDisable=l.disable,this.realColorMask=l.colorMask,this.realClearColor=l.clearColor,this.realViewport=l.viewport,p()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(l.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(l.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=D(l,Lf,kf,this.attribs),this.uniforms=te(l,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=l.createBuffer(),this.indexBuffer=l.createBuffer(),this.indexCount=0,this.renderTarget=l.createTexture(),this.framebuffer=l.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=l.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=l.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=l.createRenderbuffer()),this.patch(),this.onResize()}vt.prototype.destroy=function(){var l=this.gl;this.unpatch(),l.deleteProgram(this.program),l.deleteBuffer(this.vertexBuffer),l.deleteBuffer(this.indexBuffer),l.deleteTexture(this.renderTarget),l.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&l.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&l.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&l.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},vt.prototype.onResize=function(){var l=this.gl,c=this,u=[l.RENDERBUFFER_BINDING,l.TEXTURE_BINDING_2D,l.TEXTURE0];Ri(l,u,function(m){c.realBindFramebuffer.call(m,m.FRAMEBUFFER,null),c.scissorTest&&c.realDisable.call(m,m.SCISSOR_TEST),c.realColorMask.call(m,!0,!0,!0,!0),c.realViewport.call(m,0,0,m.drawingBufferWidth,m.drawingBufferHeight),c.realClearColor.call(m,0,0,0,1),m.clear(m.COLOR_BUFFER_BIT),c.realBindFramebuffer.call(m,m.FRAMEBUFFER,c.framebuffer),m.bindTexture(m.TEXTURE_2D,c.renderTarget),m.texImage2D(m.TEXTURE_2D,0,c.ctxAttribs.alpha?m.RGBA:m.RGB,c.bufferWidth,c.bufferHeight,0,c.ctxAttribs.alpha?m.RGBA:m.RGB,m.UNSIGNED_BYTE,null),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,c.renderTarget,0),c.ctxAttribs.depth&&c.ctxAttribs.stencil?(m.bindRenderbuffer(m.RENDERBUFFER,c.depthStencilBuffer),m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_STENCIL,c.bufferWidth,c.bufferHeight),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,c.depthStencilBuffer)):c.ctxAttribs.depth?(m.bindRenderbuffer(m.RENDERBUFFER,c.depthBuffer),m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_COMPONENT16,c.bufferWidth,c.bufferHeight),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,c.depthBuffer)):c.ctxAttribs.stencil&&(m.bindRenderbuffer(m.RENDERBUFFER,c.stencilBuffer),m.renderbufferStorage(m.RENDERBUFFER,m.STENCIL_INDEX8,c.bufferWidth,c.bufferHeight),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.STENCIL_ATTACHMENT,m.RENDERBUFFER,c.stencilBuffer)),!m.checkFramebufferStatus(m.FRAMEBUFFER)===m.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),c.realBindFramebuffer.call(m,m.FRAMEBUFFER,c.lastBoundFramebuffer),c.scissorTest&&c.realEnable.call(m,m.SCISSOR_TEST),c.realColorMask.apply(m,c.colorMask),c.realViewport.apply(m,c.viewport),c.realClearColor.apply(m,c.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},vt.prototype.patch=function(){if(!this.isPatched){var l=this,c=this.gl.canvas,u=this.gl;p()||(c.width=O()*this.bufferScale,c.height=L()*this.bufferScale,Object.defineProperty(c,"width",{configurable:!0,enumerable:!0,get:function(){return l.bufferWidth},set:function(f){l.bufferWidth=f,l.realCanvasWidth.set.call(c,f),l.onResize()}}),Object.defineProperty(c,"height",{configurable:!0,enumerable:!0,get:function(){return l.bufferHeight},set:function(f){l.bufferHeight=f,l.realCanvasHeight.set.call(c,f),l.onResize()}})),this.lastBoundFramebuffer=u.getParameter(u.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(u.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(m,f){l.lastBoundFramebuffer=f||l.framebuffer,l.realBindFramebuffer.call(u,m,l.lastBoundFramebuffer)},this.cullFace=u.getParameter(u.CULL_FACE),this.depthTest=u.getParameter(u.DEPTH_TEST),this.blend=u.getParameter(u.BLEND),this.scissorTest=u.getParameter(u.SCISSOR_TEST),this.stencilTest=u.getParameter(u.STENCIL_TEST),u.enable=function(m){switch(m){case u.CULL_FACE:l.cullFace=!0;break;case u.DEPTH_TEST:l.depthTest=!0;break;case u.BLEND:l.blend=!0;break;case u.SCISSOR_TEST:l.scissorTest=!0;break;case u.STENCIL_TEST:l.stencilTest=!0;break}l.realEnable.call(u,m)},u.disable=function(m){switch(m){case u.CULL_FACE:l.cullFace=!1;break;case u.DEPTH_TEST:l.depthTest=!1;break;case u.BLEND:l.blend=!1;break;case u.SCISSOR_TEST:l.scissorTest=!1;break;case u.STENCIL_TEST:l.stencilTest=!1;break}l.realDisable.call(u,m)},this.colorMask=u.getParameter(u.COLOR_WRITEMASK),u.colorMask=function(m,f,g,_){l.colorMask[0]=m,l.colorMask[1]=f,l.colorMask[2]=g,l.colorMask[3]=_,l.realColorMask.call(u,m,f,g,_)},this.clearColor=u.getParameter(u.COLOR_CLEAR_VALUE),u.clearColor=function(m,f,g,_){l.clearColor[0]=m,l.clearColor[1]=f,l.clearColor[2]=g,l.clearColor[3]=_,l.realClearColor.call(u,m,f,g,_)},this.viewport=u.getParameter(u.VIEWPORT),u.viewport=function(m,f,g,_){l.viewport[0]=m,l.viewport[1]=f,l.viewport[2]=g,l.viewport[3]=_,l.realViewport.call(u,m,f,g,_)},this.isPatched=!0,ye(c)}},vt.prototype.unpatch=function(){if(!!this.isPatched){var l=this.gl,c=this.gl.canvas;p()||(Object.defineProperty(c,"width",this.realCanvasWidth),Object.defineProperty(c,"height",this.realCanvasHeight)),c.width=this.bufferWidth,c.height=this.bufferHeight,l.bindFramebuffer=this.realBindFramebuffer,l.enable=this.realEnable,l.disable=this.realDisable,l.colorMask=this.realColorMask,l.clearColor=this.realClearColor,l.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&l.bindFramebuffer(l.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){ye(c)},1)}},vt.prototype.setTextureBounds=function(l,c){l||(l=[0,0,.5,1]),c||(c=[.5,0,.5,1]),this.viewportOffsetScale[0]=l[0],this.viewportOffsetScale[1]=l[1],this.viewportOffsetScale[2]=l[2],this.viewportOffsetScale[3]=l[3],this.viewportOffsetScale[4]=c[0],this.viewportOffsetScale[5]=c[1],this.viewportOffsetScale[6]=c[2],this.viewportOffsetScale[7]=c[3]},vt.prototype.submitFrame=function(){var l=this.gl,c=this,u=[];if(this.dirtySubmitFrameBindings||u.push(l.CURRENT_PROGRAM,l.ARRAY_BUFFER_BINDING,l.ELEMENT_ARRAY_BUFFER_BINDING,l.TEXTURE_BINDING_2D,l.TEXTURE0),Ri(l,u,function(f){c.realBindFramebuffer.call(f,f.FRAMEBUFFER,null);var g=0,_=0;c.instanceExt&&(g=f.getVertexAttrib(c.attribs.position,c.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),_=f.getVertexAttrib(c.attribs.texCoord,c.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),c.cullFace&&c.realDisable.call(f,f.CULL_FACE),c.depthTest&&c.realDisable.call(f,f.DEPTH_TEST),c.blend&&c.realDisable.call(f,f.BLEND),c.scissorTest&&c.realDisable.call(f,f.SCISSOR_TEST),c.stencilTest&&c.realDisable.call(f,f.STENCIL_TEST),c.realColorMask.call(f,!0,!0,!0,!0),c.realViewport.call(f,0,0,f.drawingBufferWidth,f.drawingBufferHeight),(c.ctxAttribs.alpha||p())&&(c.realClearColor.call(f,0,0,0,1),f.clear(f.COLOR_BUFFER_BIT)),f.useProgram(c.program),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c.indexBuffer),f.bindBuffer(f.ARRAY_BUFFER,c.vertexBuffer),f.enableVertexAttribArray(c.attribs.position),f.enableVertexAttribArray(c.attribs.texCoord),f.vertexAttribPointer(c.attribs.position,2,f.FLOAT,!1,20,0),f.vertexAttribPointer(c.attribs.texCoord,3,f.FLOAT,!1,20,8),c.instanceExt&&(g!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.position,0),_!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.texCoord,0)),f.activeTexture(f.TEXTURE0),f.uniform1i(c.uniforms.diffuse,0),f.bindTexture(f.TEXTURE_2D,c.renderTarget),f.uniform4fv(c.uniforms.viewportOffsetScale,c.viewportOffsetScale),f.drawElements(f.TRIANGLES,c.indexCount,f.UNSIGNED_SHORT,0),c.cardboardUI&&c.cardboardUI.renderNoState(),c.realBindFramebuffer.call(c.gl,f.FRAMEBUFFER,c.framebuffer),c.ctxAttribs.preserveDrawingBuffer||(c.realClearColor.call(f,0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c.dirtySubmitFrameBindings||c.realBindFramebuffer.call(f,f.FRAMEBUFFER,c.lastBoundFramebuffer),c.cullFace&&c.realEnable.call(f,f.CULL_FACE),c.depthTest&&c.realEnable.call(f,f.DEPTH_TEST),c.blend&&c.realEnable.call(f,f.BLEND),c.scissorTest&&c.realEnable.call(f,f.SCISSOR_TEST),c.stencilTest&&c.realEnable.call(f,f.STENCIL_TEST),c.realColorMask.apply(f,c.colorMask),c.realViewport.apply(f,c.viewport),(c.ctxAttribs.alpha||!c.ctxAttribs.preserveDrawingBuffer)&&c.realClearColor.apply(f,c.clearColor),c.instanceExt&&(g!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.position,g),_!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.texCoord,_))}),p()){var m=l.canvas;(m.width!=c.bufferWidth||m.height!=c.bufferHeight)&&(c.bufferWidth=m.width,c.bufferHeight=m.height,c.onResize())}},vt.prototype.updateDeviceInfo=function(l){var c=this.gl,u=this,m=[c.ARRAY_BUFFER_BINDING,c.ELEMENT_ARRAY_BUFFER_BINDING];Ri(c,m,function(f){var g=u.computeMeshVertices_(u.meshWidth,u.meshHeight,l);if(f.bindBuffer(f.ARRAY_BUFFER,u.vertexBuffer),f.bufferData(f.ARRAY_BUFFER,g,f.STATIC_DRAW),!u.indexCount){var _=u.computeMeshIndices_(u.meshWidth,u.meshHeight);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,u.indexBuffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,_,f.STATIC_DRAW),u.indexCount=_.length}})},vt.prototype.computeMeshVertices_=function(l,c,u){for(var m=new Float32Array(2*l*c*5),f=u.getLeftEyeVisibleTanAngles(),g=u.getLeftEyeNoLensTanAngles(),_=u.getLeftEyeVisibleScreenRect(g),M=0,T=0;T<2;T++){for(var b=0;b<c;b++)for(var y=0;y<l;y++,M++){var C=y/(l-1),F=b/(c-1),N=C,X=F,$=a(f[0],f[2],C),W=a(f[3],f[1],F),G=Math.sqrt($*$+W*W),me=u.distortion.distortInverse(G),Te=$*me/G,Le=W*me/G;C=(Te-g[0])/(g[2]-g[0]),F=(Le-g[3])/(g[1]-g[3]),C=(_.x+C*_.width-.5)*2,F=(_.y+F*_.height-.5)*2,m[M*5+0]=C,m[M*5+1]=F,m[M*5+2]=N,m[M*5+3]=X,m[M*5+4]=T}var be=f[2]-f[0];f[0]=-(be+f[0]),f[2]=be-f[2],be=g[2]-g[0],g[0]=-(be+g[0]),g[2]=be-g[2],_.x=1-(_.x+_.width)}return m},vt.prototype.computeMeshIndices_=function(l,c){for(var u=new Uint16Array(2*(l-1)*(c-1)*6),m=l/2,f=c/2,g=0,_=0,M=0;M<2;M++)for(var T=0;T<c;T++)for(var b=0;b<l;b++,g++)b==0||T==0||(b<=m==T<=f?(u[_++]=g,u[_++]=g-l-1,u[_++]=g-l,u[_++]=g-l-1,u[_++]=g,u[_++]=g-1):(u[_++]=g-1,u[_++]=g-l,u[_++]=g,u[_++]=g-l,u[_++]=g-1,u[_++]=g-l-1));return u},vt.prototype.getOwnPropertyDescriptor_=function(l,c){var u=Object.getOwnPropertyDescriptor(l,c);return(u.get===void 0||u.set===void 0)&&(u.configurable=!0,u.enumerable=!0,u.get=function(){return this.getAttribute(c)},u.set=function(m){this.setAttribute(c,m)}),u};var Of=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),Df=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),nd=Math.PI/180,fl=60,rd=12,id=20,xl=1,od=.75,sd=.3125,Bf=4,zn=28,gl=1.5;function jn(l){this.gl=l,this.attribs={position:0},this.program=D(l,Of,Df,this.attribs),this.uniforms=te(l,this.program),this.vertexBuffer=l.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}jn.prototype.destroy=function(){var l=this.gl;this.listener&&l.canvas.removeEventListener("click",this.listener,!1),l.deleteProgram(this.program),l.deleteBuffer(this.vertexBuffer)},jn.prototype.listen=function(l,c){var u=this.gl.canvas;this.listener=function(m){var f=u.clientWidth/2,g=zn*gl;m.clientX>f-g&&m.clientX<f+g&&m.clientY>u.clientHeight-g?l(m):m.clientX<g&&m.clientY<g&&c(m)},u.addEventListener("click",this.listener,!1)},jn.prototype.onResize=function(){var l=this.gl,c=this,u=[l.ARRAY_BUFFER_BINDING];Ri(l,u,function(m){var f=[],g=m.drawingBufferWidth/2,_=Math.max(screen.width,screen.height)*window.devicePixelRatio,M=m.drawingBufferWidth/_,T=M*window.devicePixelRatio,b=Bf*T/2,y=zn*gl*T,C=zn*T/2,F=(zn*gl-zn)*T;f.push(g-b,y),f.push(g-b,m.drawingBufferHeight),f.push(g+b,y),f.push(g+b,m.drawingBufferHeight),c.gearOffset=f.length/2;function N(me,Te){var Le=(90-me)*nd,be=Math.cos(Le),je=Math.sin(Le);f.push(sd*be*C+g,sd*je*C+C),f.push(Te*be*C+g,Te*je*C+C)}for(var X=0;X<=6;X++){var $=X*fl;N($,xl),N($+rd,xl),N($+id,od),N($+(fl-id),od),N($+(fl-rd),xl)}c.gearVertexCount=f.length/2-c.gearOffset,c.arrowOffset=f.length/2;function W(me,Te){f.push(F+me,m.drawingBufferHeight-F-Te)}var G=b/Math.sin(45*nd);W(0,C),W(C,0),W(C+G,G),W(G,C+G),W(G,C-G),W(0,C),W(C,C*2),W(C+G,C*2-G),W(G,C-G),W(0,C),W(G,C-b),W(zn*T,C-b),W(G,C+b),W(zn*T,C+b),c.arrowVertexCount=f.length/2-c.arrowOffset,m.bindBuffer(m.ARRAY_BUFFER,c.vertexBuffer),m.bufferData(m.ARRAY_BUFFER,new Float32Array(f),m.STATIC_DRAW)})},jn.prototype.render=function(){var l=this.gl,c=this,u=[l.CULL_FACE,l.DEPTH_TEST,l.BLEND,l.SCISSOR_TEST,l.STENCIL_TEST,l.COLOR_WRITEMASK,l.VIEWPORT,l.CURRENT_PROGRAM,l.ARRAY_BUFFER_BINDING];Ri(l,u,function(m){m.disable(m.CULL_FACE),m.disable(m.DEPTH_TEST),m.disable(m.BLEND),m.disable(m.SCISSOR_TEST),m.disable(m.STENCIL_TEST),m.colorMask(!0,!0,!0,!0),m.viewport(0,0,m.drawingBufferWidth,m.drawingBufferHeight),c.renderNoState()})},jn.prototype.renderNoState=function(){var l=this.gl;l.useProgram(this.program),l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.enableVertexAttribArray(this.attribs.position),l.vertexAttribPointer(this.attribs.position,2,l.FLOAT,!1,8,0),l.uniform4f(this.uniforms.color,1,1,1,1),K(this.projMat,0,l.drawingBufferWidth,0,l.drawingBufferHeight,.1,1024),l.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),l.drawArrays(l.TRIANGLE_STRIP,0,4),l.drawArrays(l.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),l.drawArrays(l.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function Uo(l){this.coefficients=l}Uo.prototype.distortInverse=function(l){for(var c=0,u=1,m=l-this.distort(c);Math.abs(u-c)>1e-4;){var f=l-this.distort(u),g=u-f*((u-c)/(f-m));c=u,u=g,m=f}return u},Uo.prototype.distort=function(l){for(var c=l*l,u=0,m=0;m<this.coefficients.length;m++)u=c*(u+this.coefficients[m]);return(u+1)*l};var St=Math.PI/180,Rt=180/Math.PI,_e=function(c,u,m){this.x=c||0,this.y=u||0,this.z=m||0};_e.prototype={constructor:_e,set:function(c,u,m){return this.x=c,this.y=u,this.z=m,this},copy:function(c){return this.x=c.x,this.y=c.y,this.z=c.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var c=this.length();if(c!==0){var u=1/c;this.multiplyScalar(u)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(c){this.x*=c,this.y*=c,this.z*=c},applyQuaternion:function(c){var u=this.x,m=this.y,f=this.z,g=c.x,_=c.y,M=c.z,T=c.w,b=T*u+_*f-M*m,y=T*m+M*u-g*f,C=T*f+g*m-_*u,F=-g*u-_*m-M*f;return this.x=b*T+F*-g+y*-M-C*-_,this.y=y*T+F*-_+C*-g-b*-M,this.z=C*T+F*-M+b*-_-y*-g,this},dot:function(c){return this.x*c.x+this.y*c.y+this.z*c.z},crossVectors:function(c,u){var m=c.x,f=c.y,g=c.z,_=u.x,M=u.y,T=u.z;return this.x=f*T-g*M,this.y=g*_-m*T,this.z=m*M-f*_,this}};var re=function(c,u,m,f){this.x=c||0,this.y=u||0,this.z=m||0,this.w=f!==void 0?f:1};re.prototype={constructor:re,set:function(c,u,m,f){return this.x=c,this.y=u,this.z=m,this.w=f,this},copy:function(c){return this.x=c.x,this.y=c.y,this.z=c.z,this.w=c.w,this},setFromEulerXYZ:function(c,u,m){var f=Math.cos(c/2),g=Math.cos(u/2),_=Math.cos(m/2),M=Math.sin(c/2),T=Math.sin(u/2),b=Math.sin(m/2);return this.x=M*g*_+f*T*b,this.y=f*T*_-M*g*b,this.z=f*g*b+M*T*_,this.w=f*g*_-M*T*b,this},setFromEulerYXZ:function(c,u,m){var f=Math.cos(c/2),g=Math.cos(u/2),_=Math.cos(m/2),M=Math.sin(c/2),T=Math.sin(u/2),b=Math.sin(m/2);return this.x=M*g*_+f*T*b,this.y=f*T*_-M*g*b,this.z=f*g*b-M*T*_,this.w=f*g*_+M*T*b,this},setFromAxisAngle:function(c,u){var m=u/2,f=Math.sin(m);return this.x=c.x*f,this.y=c.y*f,this.z=c.z*f,this.w=Math.cos(m),this},multiply:function(c){return this.multiplyQuaternions(this,c)},multiplyQuaternions:function(c,u){var m=c.x,f=c.y,g=c.z,_=c.w,M=u.x,T=u.y,b=u.z,y=u.w;return this.x=m*y+_*M+f*b-g*T,this.y=f*y+_*T+g*M-m*b,this.z=g*y+_*b+m*T-f*M,this.w=_*y-m*M-f*T-g*b,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var c=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return c===0?(this.x=0,this.y=0,this.z=0,this.w=1):(c=1/c,this.x=this.x*c,this.y=this.y*c,this.z=this.z*c,this.w=this.w*c),this},slerp:function(c,u){if(u===0)return this;if(u===1)return this.copy(c);var m=this.x,f=this.y,g=this.z,_=this.w,M=_*c.w+m*c.x+f*c.y+g*c.z;if(M<0?(this.w=-c.w,this.x=-c.x,this.y=-c.y,this.z=-c.z,M=-M):this.copy(c),M>=1)return this.w=_,this.x=m,this.y=f,this.z=g,this;var T=Math.acos(M),b=Math.sqrt(1-M*M);if(Math.abs(b)<.001)return this.w=.5*(_+this.w),this.x=.5*(m+this.x),this.y=.5*(f+this.y),this.z=.5*(g+this.z),this;var y=Math.sin((1-u)*T)/b,C=Math.sin(u*T)/b;return this.w=_*y+this.w*C,this.x=m*y+this.x*C,this.y=f*y+this.y*C,this.z=g*y+this.z*C,this},setFromUnitVectors:function(){var l,c,u=1e-6;return function(m,f){return l===void 0&&(l=new _e),c=m.dot(f)+1,c<u?(c=0,Math.abs(m.x)>Math.abs(m.z)?l.set(-m.y,m.x,0):l.set(0,-m.z,m.y)):l.crossVectors(m,f),this.x=l.x,this.y=l.y,this.z=l.z,this.w=c,this.normalize(),this}}()};function vl(l){this.width=l.width||O(),this.height=l.height||L(),this.widthMeters=l.widthMeters,this.heightMeters=l.heightMeters,this.bevelMeters=l.bevelMeters}var Ff=new vl({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),Hf=new vl({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),Al={CardboardV1:new _l({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new _l({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function Re(l,c){this.viewer=Al.CardboardV2,this.updateDeviceParams(l),this.distortion=new Uo(this.viewer.distortionCoefficients);for(var u=0;u<c.length;u++){var m=c[u];Al[m.id]=new _l(m)}}Re.prototype.updateDeviceParams=function(l){this.device=this.determineDevice_(l)||this.device},Re.prototype.getDevice=function(){return this.device},Re.prototype.setViewer=function(l){this.viewer=l,this.distortion=new Uo(this.viewer.distortionCoefficients)},Re.prototype.determineDevice_=function(l){if(!l)return p()?(console.warn("Using fallback iOS device measurements."),Hf):(console.warn("Using fallback Android device measurements."),Ff);var c=.0254,u=c/l.xdpi,m=c/l.ydpi,f=O(),g=L();return new vl({widthMeters:u*f,heightMeters:m*g,bevelMeters:l.bevelMm*.001})},Re.prototype.getDistortedFieldOfViewLeftEye=function(){var l=this.viewer,c=this.device,u=this.distortion,m=l.screenLensDistance,f=(c.widthMeters-l.interLensDistance)/2,g=l.interLensDistance/2,_=l.baselineLensDistance-c.bevelMeters,M=c.heightMeters-_,T=Rt*Math.atan(u.distort(f/m)),b=Rt*Math.atan(u.distort(g/m)),y=Rt*Math.atan(u.distort(_/m)),C=Rt*Math.atan(u.distort(M/m));return{leftDegrees:Math.min(T,l.fov),rightDegrees:Math.min(b,l.fov),downDegrees:Math.min(y,l.fov),upDegrees:Math.min(C,l.fov)}},Re.prototype.getLeftEyeVisibleTanAngles=function(){var l=this.viewer,c=this.device,u=this.distortion,m=Math.tan(-St*l.fov),f=Math.tan(St*l.fov),g=Math.tan(St*l.fov),_=Math.tan(-St*l.fov),M=c.widthMeters/4,T=c.heightMeters/2,b=l.baselineLensDistance-c.bevelMeters-T,y=l.interLensDistance/2-M,C=-b,F=l.screenLensDistance,N=u.distort((y-M)/F),X=u.distort((C+T)/F),$=u.distort((y+M)/F),W=u.distort((C-T)/F),G=new Float32Array(4);return G[0]=Math.max(m,N),G[1]=Math.min(f,X),G[2]=Math.min(g,$),G[3]=Math.max(_,W),G},Re.prototype.getLeftEyeNoLensTanAngles=function(){var l=this.viewer,c=this.device,u=this.distortion,m=new Float32Array(4),f=u.distortInverse(Math.tan(-St*l.fov)),g=u.distortInverse(Math.tan(St*l.fov)),_=u.distortInverse(Math.tan(St*l.fov)),M=u.distortInverse(Math.tan(-St*l.fov)),T=c.widthMeters/4,b=c.heightMeters/2,y=l.baselineLensDistance-c.bevelMeters-b,C=l.interLensDistance/2-T,F=-y,N=l.screenLensDistance,X=(C-T)/N,$=(F+b)/N,W=(C+T)/N,G=(F-b)/N;return m[0]=Math.max(f,X),m[1]=Math.min(g,$),m[2]=Math.min(_,W),m[3]=Math.max(M,G),m},Re.prototype.getLeftEyeVisibleScreenRect=function(l){var c=this.viewer,u=this.device,m=c.screenLensDistance,f=(u.widthMeters-c.interLensDistance)/2,g=c.baselineLensDistance-u.bevelMeters,_=(l[0]*m+f)/u.widthMeters,M=(l[1]*m+g)/u.heightMeters,T=(l[2]*m+f)/u.widthMeters,b=(l[3]*m+g)/u.heightMeters;return{x:_,y:b,width:T-_,height:M-b}},Re.prototype.getFieldOfViewLeftEye=function(l){return l?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},Re.prototype.getFieldOfViewRightEye=function(l){var c=this.getFieldOfViewLeftEye(l);return{leftDegrees:c.rightDegrees,rightDegrees:c.leftDegrees,upDegrees:c.upDegrees,downDegrees:c.downDegrees}},Re.prototype.getUndistortedFieldOfViewLeftEye=function(){var l=this.getUndistortedParams_();return{leftDegrees:Rt*Math.atan(l.outerDist),rightDegrees:Rt*Math.atan(l.innerDist),downDegrees:Rt*Math.atan(l.bottomDist),upDegrees:Rt*Math.atan(l.topDist)}},Re.prototype.getUndistortedViewportLeftEye=function(){var l=this.getUndistortedParams_(),c=this.viewer,u=this.device,m=c.screenLensDistance,f=u.widthMeters/m,g=u.heightMeters/m,_=u.width/f,M=u.height/g,T=Math.round((l.eyePosX-l.outerDist)*_),b=Math.round((l.eyePosY-l.bottomDist)*M);return{x:T,y:b,width:Math.round((l.eyePosX+l.innerDist)*_)-T,height:Math.round((l.eyePosY+l.topDist)*M)-b}},Re.prototype.getUndistortedParams_=function(){var l=this.viewer,c=this.device,u=this.distortion,m=l.screenLensDistance,f=l.interLensDistance/2/m,g=c.widthMeters/m,_=c.heightMeters/m,M=g/2-f,T=(l.baselineLensDistance-c.bevelMeters)/m,b=l.fov,y=u.distortInverse(Math.tan(St*b)),C=Math.min(M,y),F=Math.min(f,y),N=Math.min(T,y),X=Math.min(_-T,y);return{outerDist:C,innerDist:F,topDist:X,bottomDist:N,eyePosX:M,eyePosY:T}};function _l(l){this.id=l.id,this.label=l.label,this.fov=l.fov,this.interLensDistance=l.interLensDistance,this.baselineLensDistance=l.baselineLensDistance,this.screenLensDistance=l.screenLensDistance,this.distortionCoefficients=l.distortionCoefficients,this.inverseCoefficients=l.inverseCoefficients}Re.Viewers=Al;var Nf=1,Xf="2019-11-09T17:36:14Z",zf=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],jf={format:Nf,last_updated:Xf,devices:zf};function Pi(l,c){if(this.dpdb=jf,this.recalculateDeviceParams_(),l){this.onDeviceParamsUpdated=c;var u=new XMLHttpRequest,m=this;u.open("GET",l,!0),u.addEventListener("load",function(){m.loading=!1,u.status>=200&&u.status<=299?(m.dpdb=JSON.parse(u.response),m.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),u.send()}}Pi.prototype.getDeviceParams=function(){return this.deviceParams},Pi.prototype.recalculateDeviceParams_=function(){var l=this.calcDeviceParams_();l?(this.deviceParams=l,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},Pi.prototype.calcDeviceParams_=function(){var l=this.dpdb;if(!l)return console.error("DPDB not available."),null;if(l.format!=1)return console.error("DPDB has unexpected format version."),null;if(!l.devices||!l.devices.length)return console.error("DPDB does not have a devices section."),null;var c=navigator.userAgent||navigator.vendor||window.opera,u=O(),m=L();if(!l.devices)return console.error("DPDB has no devices section."),null;for(var f=0;f<l.devices.length;f++){var g=l.devices[f];if(!g.rules){console.warn("Device["+f+"] has no rules section.");continue}if(g.type!="ios"&&g.type!="android"){console.warn("Device["+f+"] has invalid type.");continue}if(p()==(g.type=="ios")){for(var _=!1,M=0;M<g.rules.length;M++){var T=g.rules[M];if(this.ruleMatches_(T,c,u,m)){_=!0;break}}if(!!_){var b=g.dpi[0]||g.dpi,y=g.dpi[1]||g.dpi;return new Uf({xdpi:b,ydpi:y,bevelMm:g.bw})}}}return console.warn("No DPDB device match."),null},Pi.prototype.ruleMatches_=function(l,c,u,m){if(!l.ua&&!l.res||(l.ua&&l.ua.substring(0,2)==="SM"&&(l.ua=l.ua.substring(0,7)),l.ua&&c.indexOf(l.ua)<0))return!1;if(l.res){if(!l.res[0]||!l.res[1])return!1;var f=l.res[0],g=l.res[1];if(Math.min(u,m)!=Math.min(f,g)||Math.max(u,m)!=Math.max(f,g))return!1}return!0};function Uf(l){this.xdpi=l.xdpi,this.ydpi=l.ydpi,this.bevelMm=l.bevelMm}function Ci(l,c){this.set(l,c)}Ci.prototype.set=function(l,c){this.sample=l,this.timestampS=c},Ci.prototype.copy=function(l){this.set(l.sample,l.timestampS)};function Un(l,c){this.kFilter=l,this.isDebug=c,this.currentAccelMeasurement=new Ci,this.currentGyroMeasurement=new Ci,this.previousGyroMeasurement=new Ci,p()?this.filterQ=new re(-1,0,0,1):this.filterQ=new re(1,0,0,1),this.previousFilterQ=new re,this.previousFilterQ.copy(this.filterQ),this.accelQ=new re,this.isOrientationInitialized=!1,this.estimatedGravity=new _e,this.measuredGravity=new _e,this.gyroIntegralQ=new re}Un.prototype.addAccelMeasurement=function(l,c){this.currentAccelMeasurement.set(l,c)},Un.prototype.addGyroMeasurement=function(l,c){this.currentGyroMeasurement.set(l,c);var u=c-this.previousGyroMeasurement.timestampS;I(u)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},Un.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var l=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,c=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,l);this.gyroIntegralQ.multiply(c),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(c);var u=new re;u.copy(this.filterQ),u.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(u),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var m=new re;m.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),m.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",Rt*Vr(m),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var f=new re;f.copy(this.filterQ),f.multiply(m),this.filterQ.slerp(f,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},Un.prototype.getOrientation=function(){return this.filterQ},Un.prototype.accelToQuaternion_=function(l){var c=new _e;c.copy(l),c.normalize();var u=new re;return u.setFromUnitVectors(new _e(0,0,-1),c),u.inverse(),u},Un.prototype.gyroToQuaternionDelta_=function(l,c){var u=new re,m=new _e;return m.copy(l),m.normalize(),u.setFromAxisAngle(m,l.length()*c),u};function ad(l,c){this.predictionTimeS=l,this.isDebug=c,this.previousQ=new re,this.previousTimestampS=null,this.deltaQ=new re,this.outQ=new re}ad.prototype.getPrediction=function(l,c,u){if(!this.previousTimestampS)return this.previousQ.copy(l),this.previousTimestampS=u,l;var m=new _e;m.copy(c),m.normalize();var f=c.length();if(f<St*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(Rt*f).toFixed(1)),this.outQ.copy(l),this.previousQ.copy(l),this.outQ;var g=f*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(m,g),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(l),this.previousTimestampS=u,this.outQ};function pt(l,c,u,m){this.yawOnly=u,this.accelerometer=new _e,this.gyroscope=new _e,this.filter=new Un(l,m),this.posePredictor=new ad(c,m),this.isFirefoxAndroid=x(),this.isIOS=p();var f=A();this.isDeviceMotionInRadians=!this.isIOS&&f&&f<66,this.isWithoutDeviceMotion=S()||E(),this.filterToWorldQ=new re,p()?this.filterToWorldQ.setFromAxisAngle(new _e(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new _e(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new re,this.worldToScreenQ=new re,this.originalPoseAdjustQ=new re,this.originalPoseAdjustQ.setFromAxisAngle(new _e(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),R()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new re,this.orientationOut_=new Float32Array(4),this.start()}pt.prototype.getPosition=function(){return null},pt.prototype.getOrientation=function(){var l=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var f=new re().setFromAxisAngle(new _e(0,0,-1),0),g=new re;return window.orientation===-90?g.setFromAxisAngle(new _e(0,1,0),Math.PI/-2):g.setFromAxisAngle(new _e(0,1,0),Math.PI/2),f.multiply(g)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var f=new re;return f.setFromAxisAngle(new _e(1,0,0),-Math.PI/2),f}(),l=this._deviceOrientationQ;var u=new re;return u.copy(l),u.multiply(this.deviceOrientationFilterToWorldQ),u.multiply(this.resetQ),u.multiply(this.worldToScreenQ),u.multiplyQuaternions(this.deviceOrientationFixQ,u),this.yawOnly&&(u.x=0,u.z=0,u.normalize()),this.orientationOut_[0]=u.x,this.orientationOut_[1]=u.y,this.orientationOut_[2]=u.z,this.orientationOut_[3]=u.w,this.orientationOut_}else{var c=this.filter.getOrientation();l=this.posePredictor.getPrediction(c,this.gyroscope,this.previousTimestampS)}var u=new re;return u.copy(this.filterToWorldQ),u.multiply(this.resetQ),u.multiply(l),u.multiply(this.worldToScreenQ),this.yawOnly&&(u.x=0,u.z=0,u.normalize()),this.orientationOut_[0]=u.x,this.orientationOut_[1]=u.y,this.orientationOut_[2]=u.z,this.orientationOut_[3]=u.w,this.orientationOut_},pt.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),R()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},pt.prototype.onDeviceOrientation_=function(l){this._deviceOrientationQ=this._deviceOrientationQ||new re;var c=l.alpha,u=l.beta,m=l.gamma;c=(c||0)*Math.PI/180,u=(u||0)*Math.PI/180,m=(m||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(u,c,-m)},pt.prototype.onDeviceMotion_=function(l){this.updateDeviceMotion_(l)},pt.prototype.updateDeviceMotion_=function(l){var c=l.accelerationIncludingGravity,u=l.rotationRate,m=l.timeStamp/1e3,f=m-this.previousTimestampS;if(f<0){un("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=m;return}else if(f<=i||f>o){un("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=m;return}this.accelerometer.set(-c.x,-c.y,-c.z),u&&(P()?this.gyroscope.set(-u.beta,u.alpha,u.gamma):this.gyroscope.set(u.alpha,u.beta,u.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,m)),this.filter.addAccelMeasurement(this.accelerometer,m),this.previousTimestampS=m},pt.prototype.onOrientationChange_=function(l){this.setScreenTransform_()},pt.prototype.onMessage_=function(l){var c=l.data;if(!(!c||!c.type)){var u=c.type.toLowerCase();u==="devicemotion"&&this.updateDeviceMotion_(c.deviceMotionEvent)}},pt.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new _e(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new _e(0,0,1),Math.PI/2);break;case 180:break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},pt.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),p()&&ae()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},pt.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var Gf=60,Wf=new _e(1,0,0),qf=new _e(0,0,1),bl=new re;bl.setFromAxisAngle(Wf,-Math.PI/2),bl.multiply(new re().setFromAxisAngle(qf,Math.PI/2));var Qf=function(){function l(c){t(this,l),this.config=c,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new re,this._outQ=new re,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return e(l,[{key:"init",value:function(){var u=null;try{u=new RelativeOrientationSensor({frequency:Gf,referenceFrame:"screen"}),u.addEventListener("error",this._onSensorError)}catch(m){this.errors.push(m),m.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):m.name==="ReferenceError"?this.useDeviceMotion():console.error(m)}u&&(this.api="sensor",this.sensor=u,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new pt(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var u=this.sensor.quaternion;this._sensorQ.set(u[0],u[1],u[2],u[3]);var m=this._outQ;return m.copy(bl),m.multiply(this._sensorQ),this.config.YAW_ONLY&&(m.x=m.z=0,m.normalize()),this._out[0]=m.x,this._out[1]=m.y,this._out[2]=m.z,this._out[3]=m.w,this._out}},{key:"_onSensorError",value:function(u){this.errors.push(u.error),u.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):u.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(u.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),l}(),Kf="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function Gn(){this.loadIcon_();var l=document.createElement("div"),_=l.style;_.position="fixed",_.top=0,_.right=0,_.bottom=0,_.left=0,_.backgroundColor="gray",_.fontFamily="sans-serif",_.zIndex=1e6;var c=document.createElement("img");c.src=this.icon;var _=c.style;_.marginLeft="25%",_.marginTop="25%",_.width="50%",l.appendChild(c);var u=document.createElement("div"),_=u.style;_.textAlign="center",_.fontSize="16px",_.lineHeight="24px",_.margin="24px 25%",_.width="50%",u.innerHTML="Place your phone into your Cardboard viewer.",l.appendChild(u);var m=document.createElement("div"),_=m.style;_.backgroundColor="#CFD8DC",_.position="fixed",_.bottom=0,_.width="100%",_.height="48px",_.padding="14px 24px",_.boxSizing="border-box",_.color="#656A6B",l.appendChild(m);var f=document.createElement("div");f.style.float="left",f.innerHTML="No Cardboard viewer?";var g=document.createElement("a");g.href="https://www.google.com/get/cardboard/get-cardboard/",g.innerHTML="get one",g.target="_blank";var _=g.style;_.float="right",_.fontWeight=600,_.textTransform="uppercase",_.borderLeft="1px solid gray",_.paddingLeft="24px",_.textDecoration="none",_.color="#656A6B",m.appendChild(f),m.appendChild(g),this.overlay=l,this.text=u,this.hide()}Gn.prototype.show=function(l){!l&&!this.overlay.parentElement?document.body.appendChild(this.overlay):l&&(this.overlay.parentElement&&this.overlay.parentElement!=l&&this.overlay.parentElement.removeChild(this.overlay),l.appendChild(this.overlay)),this.overlay.style.display="block";var c=this.overlay.querySelector("img"),u=c.style;R()?(u.width="20%",u.marginLeft="40%",u.marginTop="3%"):(u.width="50%",u.marginLeft="25%",u.marginTop="25%")},Gn.prototype.hide=function(){this.overlay.style.display="none"},Gn.prototype.showTemporarily=function(l,c){this.show(c),this.timer=setTimeout(this.hide.bind(this),l)},Gn.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},Gn.prototype.update=function(){this.disableShowTemporarily(),!R()&&z()?this.show():this.hide()},Gn.prototype.loadIcon_=function(){this.icon=s("image/svg+xml",Kf)};var Yf="CardboardV1",ld="WEBVR_CARDBOARD_VIEWER",Jf="webvr-polyfill-viewer-selector";function ct(l){try{this.selectedKey=localStorage.getItem(ld)}catch(c){console.error("Failed to load viewer profile: %s",c)}this.selectedKey||(this.selectedKey=l||Yf),this.dialog=this.createDialog_(Re.Viewers),this.root=null,this.onChangeCallbacks_=[]}ct.prototype.show=function(l){this.root=l,l.appendChild(this.dialog);var c=this.dialog.querySelector("#"+this.selectedKey);c.checked=!0,this.dialog.style.display="block"},ct.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},ct.prototype.getCurrentViewer=function(){return Re.Viewers[this.selectedKey]},ct.prototype.getSelectedKey_=function(){var l=this.dialog.querySelector("input[name=field]:checked");return l?l.id:null},ct.prototype.onChange=function(l){this.onChangeCallbacks_.push(l)},ct.prototype.fireOnChange_=function(l){for(var c=0;c<this.onChangeCallbacks_.length;c++)this.onChangeCallbacks_[c](l)},ct.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!Re.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(Re.Viewers[this.selectedKey]);try{localStorage.setItem(ld,this.selectedKey)}catch(l){console.error("Failed to save viewer profile: %s",l)}this.hide()},ct.prototype.createDialog_=function(l){var c=document.createElement("div");c.classList.add(Jf),c.style.display="none";var u=document.createElement("div"),g=u.style;g.position="fixed",g.left=0,g.top=0,g.width="100%",g.height="100%",g.background="rgba(0, 0, 0, 0.3)",u.addEventListener("click",this.hide.bind(this));var m=280,f=document.createElement("div"),g=f.style;g.boxSizing="border-box",g.position="fixed",g.top="24px",g.left="50%",g.marginLeft=-m/2+"px",g.width=m+"px",g.padding="24px",g.overflow="hidden",g.background="#fafafa",g.fontFamily="'Roboto', sans-serif",g.boxShadow="0px 5px 20px #666",f.appendChild(this.createH1_("Select your viewer"));for(var _ in l)f.appendChild(this.createChoice_(_,l[_].label));return f.appendChild(this.createButton_("Save",this.onSave_.bind(this))),c.appendChild(u),c.appendChild(f),c},ct.prototype.createH1_=function(l){var c=document.createElement("h1"),u=c.style;return u.color="black",u.fontSize="20px",u.fontWeight="bold",u.marginTop=0,u.marginBottom="24px",c.innerHTML=l,c},ct.prototype.createChoice_=function(l,c){var u=document.createElement("div");u.style.marginTop="8px",u.style.color="black";var m=document.createElement("input");m.style.fontSize="30px",m.setAttribute("id",l),m.setAttribute("type","radio"),m.setAttribute("value",l),m.setAttribute("name","field");var f=document.createElement("label");return f.style.marginLeft="4px",f.setAttribute("for",l),f.innerHTML=c,u.appendChild(m),u.appendChild(f),u},ct.prototype.createButton_=function(l,c){var u=document.createElement("button");u.innerHTML=l;var m=u.style;return m.float="right",m.textTransform="uppercase",m.color="#1094f7",m.fontSize="14px",m.letterSpacing=0,m.border=0,m.background="none",m.marginTop="16px",u.addEventListener("click",c),u};var $f=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zf(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}function ex(l,c){return c={exports:{}},l(c,c.exports),c.exports}var tx=ex(function(l,c){(function(m,f){l.exports=f()})($f,function(){return function(u){var m={};function f(g){if(m[g])return m[g].exports;var _=m[g]={i:g,l:!1,exports:{}};return u[g].call(_.exports,_,_.exports,f),_.l=!0,_.exports}return f.m=u,f.c=m,f.d=function(g,_,M){f.o(g,_)||Object.defineProperty(g,_,{configurable:!1,enumerable:!0,get:M})},f.n=function(g){var _=g&&g.__esModule?function(){return g.default}:function(){return g};return f.d(_,"a",_),_},f.o=function(g,_){return Object.prototype.hasOwnProperty.call(g,_)},f.p="",f(f.s=0)}([function(u,m,f){"use strict";var g=function(){function y(C,F){for(var N=0;N<F.length;N++){var X=F[N];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(C,X.key,X)}}return function(C,F,N){return F&&y(C.prototype,F),N&&y(C,N),C}}();function _(y,C){if(!(y instanceof C))throw new TypeError("Cannot call a class as a function")}var M=f(1),T=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,b=function(){function y(){_(this,y),T?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",M),this.noSleepVideo.addEventListener("timeupdate",function(C){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return g(y,[{key:"enable",value:function(){T?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){T?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),y}();u.exports=b},function(u,m,f){"use strict";u.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),nx=Zf(tx),rx=1e3,ix=[0,0,.5,1],ox=[.5,0,.5,1],sx=window.requestAnimationFrame,ax=window.cancelAnimationFrame;function lx(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function pd(l){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:l.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:l.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:l.canPresent},maxLayers:{writable:!1,enumerable:!0,value:l.maxLayers},hasOrientation:{enumerable:!0,get:function(){return zt("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),l.hasOrientation}}})}function he(l){l=l||{};var c="wakelock"in l?l.wakelock:!0;this.isPolyfilled=!0,this.displayId=rx++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return zt("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new pd({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,c&&z()&&(this.wakelock_=new nx)}he.prototype.getFrameData=function(l){return Ae(l,this._getPose(),this)},he.prototype.getPose=function(){return zt("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},he.prototype.resetPose=function(){return zt("VRDisplay.prototype.resetPose"),this._resetPose()},he.prototype.getImmediatePose=function(){return zt("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},he.prototype.requestAnimationFrame=function(l){return sx(l)},he.prototype.cancelAnimationFrame=function(l){return ax(l)},he.prototype.wrapForFullscreen=function(l){if(p())return l;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var c=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",c.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==l)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=l,this.originalParent_=l.parentElement,this.originalParent_||document.body.appendChild(l),!this.fullscreenWrapper_.parentElement){var u=this.fullscreenElement_.parentElement;u.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),u.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var m=this;function f(){if(!!m.fullscreenElement_){var g=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];m.fullscreenElement_.setAttribute("style",g.join("; ")+";")}}return f(),this.fullscreenWrapper_},he.prototype.removeFullscreenWrapper=function(){if(!!this.fullscreenElement_){var l=this.fullscreenElement_;this.fullscreenElementCachedStyle_?l.setAttribute("style",this.fullscreenElementCachedStyle_):l.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var c=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(l),this.originalParent_===c?c.insertBefore(l,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(l),c.removeChild(this.fullscreenWrapper_),l}},he.prototype.requestPresent=function(l){var c=this.isPresenting,u=this;return l instanceof Array||(zt("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),l=[l]),new Promise(function(m,f){if(!u.capabilities.canPresent){f(new Error("VRDisplay is not capable of presenting."));return}if(l.length==0||l.length>u.capabilities.maxLayers){f(new Error("Invalid number of layers."));return}var g=l[0];if(!g.source){m();return}var _=g.leftBounds||ix,M=g.rightBounds||ox;if(c){var T=u.layer_;T.source!==g.source&&(T.source=g.source);for(var b=0;b<4;b++)T.leftBounds[b]=_[b],T.rightBounds[b]=M[b];u.wrapForFullscreen(u.layer_.source),u.updatePresent_(),m();return}if(u.layer_={predistorted:g.predistorted,source:g.source,leftBounds:_.slice(0),rightBounds:M.slice(0)},u.waitingForPresent_=!1,u.layer_&&u.layer_.source){var y=u.wrapForFullscreen(u.layer_.source),C=function(){var X=V();u.isPresenting=y===X,u.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function($){console.error("screen.orientation.lock() failed due to",$.message)}),u.waitingForPresent_=!1,u.beginPresent_(),m()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),u.removeFullscreenWrapper(),u.disableWakeLock(),u.endPresent_(),u.removeFullscreenListeners_()),u.fireVRDisplayPresentChange_()},F=function(){!u.waitingForPresent_||(u.removeFullscreenWrapper(),u.removeFullscreenListeners_(),u.disableWakeLock(),u.waitingForPresent_=!1,u.isPresenting=!1,f(new Error("Unable to present.")))};u.addFullscreenListeners_(y,C,F),k(y)?(u.enableWakeLock(),u.waitingForPresent_=!0):(p()||d())&&(u.enableWakeLock(),u.isPresenting=!0,u.beginPresent_(),u.fireVRDisplayPresentChange_(),m())}!u.waitingForPresent_&&!p()&&(H(),f(new Error("Unable to present.")))})},he.prototype.exitPresent=function(){var l=this.isPresenting,c=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(u,m){l?(!H()&&p()&&(c.endPresent_(),c.fireVRDisplayPresentChange_()),d()&&(c.removeFullscreenWrapper(),c.removeFullscreenListeners_(),c.endPresent_(),c.fireVRDisplayPresentChange_()),u()):m(new Error("Was not presenting to VRDisplay."))})},he.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},he.prototype.fireVRDisplayPresentChange_=function(){var l=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(l)},he.prototype.fireVRDisplayConnect_=function(){var l=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(l)},he.prototype.addFullscreenListeners_=function(l,c,u){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=l,this.fullscreenChangeHandler_=c,this.fullscreenErrorHandler_=u,c&&(document.fullscreenEnabled?l.addEventListener("fullscreenchange",c,!1):document.webkitFullscreenEnabled?l.addEventListener("webkitfullscreenchange",c,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",c,!1):document.msFullscreenEnabled&&l.addEventListener("msfullscreenchange",c,!1)),u&&(document.fullscreenEnabled?l.addEventListener("fullscreenerror",u,!1):document.webkitFullscreenEnabled?l.addEventListener("webkitfullscreenerror",u,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",u,!1):document.msFullscreenEnabled&&l.addEventListener("msfullscreenerror",u,!1))},he.prototype.removeFullscreenListeners_=function(){if(!!this.fullscreenEventTarget_){var l=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var c=this.fullscreenChangeHandler_;l.removeEventListener("fullscreenchange",c,!1),l.removeEventListener("webkitfullscreenchange",c,!1),document.removeEventListener("mozfullscreenchange",c,!1),l.removeEventListener("msfullscreenchange",c,!1)}if(this.fullscreenErrorHandler_){var u=this.fullscreenErrorHandler_;l.removeEventListener("fullscreenerror",u,!1),l.removeEventListener("webkitfullscreenerror",u,!1),document.removeEventListener("mozfullscreenerror",u,!1),l.removeEventListener("msfullscreenerror",u,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},he.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},he.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},he.prototype.beginPresent_=function(){},he.prototype.endPresent_=function(){},he.prototype.submitFrame=function(l){},he.prototype.getEyeParameters=function(l){return null};var px={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},Go={LEFT:"left",RIGHT:"right"};function Pe(l){var c=J({},px);l=J(c,l||{}),he.call(this,{wakelock:l.MOBILE_WAKE_LOCK}),this.config=l,this.displayName="Cardboard VRDisplay",this.capabilities=new pd({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new Qf(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new Pi(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new Re(this.dpdb_.getDeviceParams(),l.ADDITIONAL_VIEWERS),this.viewerSelector_=new ct(l.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Gn),p()&&window.addEventListener("resize",this.onResize_.bind(this))}return Pe.prototype=Object.create(he.prototype),Pe.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},Pe.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},Pe.prototype._getFieldOfView=function(l){var c;if(l==Go.LEFT)c=this.deviceInfo_.getFieldOfViewLeftEye();else if(l==Go.RIGHT)c=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",l),null;return c},Pe.prototype._getEyeOffset=function(l){var c;if(l==Go.LEFT)c=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(l==Go.RIGHT)c=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",l),null;return c},Pe.prototype.getEyeParameters=function(l){var c=this._getEyeOffset(l),u=this._getFieldOfView(l),m={offset:c,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(m,"fieldOfView",{enumerable:!0,get:function(){return zt("VRFieldOfView","VRFrameData's projection matrices"),u}}),m},Pe.prototype.onDeviceParamsUpdated_=function(l){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(l),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},Pe.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},Pe.prototype.beginPresent_=function(){var l=this.layer_.source.getContext("webgl");l||(l=this.layer_.source.getContext("experimental-webgl")),l||(l=this.layer_.source.getContext("webgl2")),l&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(l.canvas.width=O()*this.bufferScale_,l.canvas.height=L()*this.bufferScale_,this.cardboardUI_=new jn(l)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new jn(l)),this.distorter_=new vt(l,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(c){this.viewerSelector_.show(this.layer_.source.parentElement),c.stopPropagation(),c.preventDefault()}.bind(this),function(c){this.exitPresent(),c.stopPropagation(),c.preventDefault()}.bind(this)),this.rotateInstructions_&&(R()&&z()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},Pe.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},Pe.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},Pe.prototype.submitFrame=function(l){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var c=this.layer_.source.getContext("webgl");c||(c=this.layer_.source.getContext("experimental-webgl")),c||(c=this.layer_.source.getContext("webgl2"));var u=c.canvas;(u.width!=this.lastWidth||u.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=u.width,this.lastHeight=u.height,this.cardboardUI_.render()}},Pe.prototype.onOrientationChange_=function(l){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},Pe.prototype.onResize_=function(l){if(this.layer_){var c=this.layer_.source.getContext("webgl");c||(c=this.layer_.source.getContext("experimental-webgl")),c||(c=this.layer_.source.getContext("webgl2"));var u=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];c.canvas.setAttribute("style",u.join("; ")+";"),ye(c.canvas)}},Pe.prototype.onViewerChanged_=function(l){this.deviceInfo_.setViewer(l),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},Pe.prototype.fireVRDisplayDeviceParamsChange_=function(){var l=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(l)},Pe.VRFrameData=lx,Pe.VRDisplay=he,Pe})});function Ax(r){return r}function cd(r,t,e){let n=0,i=r.length,o=Math.floor((n+i)/2),s=!1;for(;n<i&&o<r.length;){let a=r[o],p=B(a)?null:e(a);v(p)&&t<p?i=o:(t===p&&(s=!0),n=o+1),o=Math.floor((n+i)/2)}return s||(o+=.5),o}function yl(r,t,e){e=e||Ax;let n=e(t);return cd(r,n,e)}function Lr(r,t){return r.splice(t,1)[0]}function le(r){return r.splice(0)}function Wo(r,t){for(let e=0;e<r.length;++e)if(r[e]!==t[e])return e;return-1}function qo(r,t,e){r.splice(e,0,t)}function dt(r,t){let e=r.indexOf(t);return e>-1?(Lr(r,e),!0):!1}function _x(r,t){for(let e=r.length-1;e>=0;--e)if(t(r[e]))return Lr(r,e);return null}function dd(r,t,e){return _x(r,n=>e(n)===t)}function ud(r,...t){r.splice(0,r.length,...t)}function bx(r,t,e){let n=r?0:t.length-1,i=r?t.length:-1,o=r?1:-1;for(let s of e)for(let a=n;a!=i;a+=o){let p=t[a];if(s(p))return p}return null}function ut(r,...t){return bx(!0,r,t)}function md(r,t,e,n){let i;return pe(e)?i=e:Je(e)&&(n=e),B(n)&&(n=!0),Ex(r,t,i,n)}function Ex(r,t,e,n){let i=yl(r,t,e),o=i%1===0;return i=i|0,(!o||n)&&qo(r,t,i),i}function hd(r,t){let e=Array.from(r);return Wn(e,t),e}function Wn(r,t){r.sort((e,n)=>{let i=t(e),o=t(n);return i<o?-1:i>o?1:0})}var zi=class{constructor(t){this.value=t;this._forward=new Array;this._reverse=new Array}connectSorted(t,e){v(e)?(md(this._forward,t,n=>e(n.value)),t._reverse.push(this)):this.connectTo(t)}connectTo(t){this.connectAt(t,this._forward.length)}connectAt(t,e){qo(this._forward,t,e),t._reverse.push(this)}disconnectFrom(t){dt(this._forward,t),dt(t._reverse,this)}isConnectedTo(t){return this._forward.indexOf(t)>=0||this._reverse.indexOf(t)>=0}flatten(){let t=new Set,e=[this];for(;e.length>0;){let n=e.shift();v(n)&&!t.has(n)&&(t.add(n),e.push(...n._forward))}return Array.from(t)}get _isEntryPoint(){return this._reverse.length===0}get _isExitPoint(){return this._forward.length===0}get isDisconnected(){return this._isEntryPoint&&this._isExitPoint}get isConnected(){return!this._isExitPoint||!this._isEntryPoint}get isTerminus(){return this._isEntryPoint||this._isExitPoint}get isInternal(){return!this._isEntryPoint&&!this._isExitPoint}};var Qo=class extends zi{connectTo(t){super.connectTo(t)}connectAt(t,e){super.connectAt(t,e)}connectSorted(t,e){super.connectSorted(t,e)}disconnectFrom(t){super.disconnectFrom(t)}isConnectedTo(t){return super.isConnectedTo(t)}flatten(){return super.flatten()}get connections(){return this._forward}get isEntryPoint(){return this._isEntryPoint}get isExitPoint(){return this._isExitPoint}};function ji(r,t,e){return new Map(r.map(n=>[t(n),e(n)]))}function wl(r,t){return ji(r,t,jt)}function fd(r,...t){for(let e of t)if(v(e))for(let[n,i]of e)r.set(n,i);return r}var mt=class{constructor(t){this.items=new Map;this.defaultItems=new Array;if(v(t))for(let[e,n]of t)this.add(e,n)}add(t,e){if(B(t))this.defaultItems.push(e);else{let n=this.items.get(t);B(n)&&this.items.set(t,n=[]),n.push(e)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let t of this.defaultItems)yield t;for(let t of this.items.values())for(let e of t)yield e}has(t){return v(t)?this.items.has(t):this.defaultItems.length>0}get(t){return B(t)?this.defaultItems:this.items.get(t)||[]}count(t){if(B(t))return this.defaultItems.length;let e=this.get(t);return v(e)?e.length:0}get size(){let t=this.defaultItems.length;for(let e of this.items.values())t+=e.length;return t}delete(t){return B(t)?le(this.defaultItems).length>0:this.items.delete(t)}remove(t,e){if(B(t))dt(this.defaultItems,e);else{let n=this.items.get(t);v(n)&&(dt(n,e),n.length===0&&this.items.delete(t))}}clear(){this.items.clear(),le(this.defaultItems)}};var $e=class{constructor(t){this.items=new Map;if(v(t))for(let[e,n,i]of t)this.add(e,n,i)}add(t,e,n){let i=this.items.get(t);return B(i)&&this.items.set(t,i=new Map),i.set(e,n),this}*entries(){for(let[t,e]of this.items)for(let[n,i]of e)yield[t,n,i]}keys(t){return B(t)?this.items.keys():this.items.get(t).keys()}*values(){for(let t of this.items.values())for(let e of t.values())yield e}has(t,e){return this.items.has(t)&&(B(e)||this.items.get(t).has(e))}get(t,e){return B(e)?this.items.get(t):this.items.has(t)?this.items.get(t).get(e):null}count(t){return this.items.has(t)?this.items.get(t).size:null}get size(){let t=0;for(let e of this.items.values())t+=e.size;return t}delete(t,e){return B(e)?this.items.delete(t):this.items.has(t)?this.items.get(t).delete(e):!1}clear(){this.items.clear()}};var Ui=class{constructor(){this.listeners=new Map;this.listenerOptions=new Map}addEventListener(t,e,n){if(pe(e)){let i=this.listeners.get(t);i||(i=new Array,this.listeners.set(t,i)),i.find(o=>o===e)||(i.push(e),n&&this.listenerOptions.set(e,n))}}removeEventListener(t,e){if(pe(e)){let n=this.listeners.get(t);n&&this.removeListener(n,e)}}clearEventListeners(t){for(let[e,n]of this.listeners)if(B(t)||t===e){for(let i of n)this.removeEventListener(t,i);le(n),this.listeners.delete(e)}}removeListener(t,e){let n=t.findIndex(i=>i===e);n>=0&&(Lr(t,n),this.listenerOptions.has(e)&&this.listenerOptions.delete(e))}dispatchEvent(t){let e=this.listeners.get(t.type);if(e)for(let n of e){let i=this.listenerOptions.get(n);v(i)&&!Je(i)&&i.once&&this.removeListener(e,n),n.call(this,t)}return!t.defaultPrevented}},j=class extends Event{get type(){return super.type}constructor(t){super(t)}},q=class extends Ui{constructor(){super(...arguments);this.bubblers=new Set;this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addEventListener(e,n,i){super.addEventListener(e,n,i)}removeEventListener(e,n){super.removeEventListener(e,n)}clearEventListeners(e){return super.clearEventListeners(e)}addScopedEventListener(e,n,i,o){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([n,i]),this.addEventListener(n,i,o)}removeScope(e){let n=this.scopes.get(e);if(n){this.scopes.delete(e);for(let[i,o]of n)this.removeEventListener(i,o)}}dispatchEvent(e){if(!super.dispatchEvent(e))return!1;for(let n of this.bubblers)if(!n.dispatchEvent(e))return!1;return!0}};function jt(r){return r}function hn(){return!0}function xd(){return!1}function gd(r,t){return r&&t}function Gi(r,t,e){return typeof r===t||r instanceof e}function pe(r){return Gi(r,"function",Function)}function Q(r){return Gi(r,"string",String)}function Je(r){return Gi(r,"boolean",Boolean)}function ce(r){return Gi(r,"number",Number)}function Ue(r){return ce(r)&&Number.isFinite(r)&&!Number.isNaN(r)}function fn(r){return v(r)&&Gi(r,"object",Object)}function Tl(r){return r instanceof Date}function ke(r){return r instanceof Array}function de(r,t){throw new Error((t||"Unexpected object: ")+r)}function B(r){return r==null}function v(r){return!B(r)}function vd(r){return r instanceof Uint8Array||r instanceof Uint8ClampedArray||r instanceof Int8Array||r instanceof Uint16Array||r instanceof Int16Array||r instanceof Uint32Array||r instanceof Int32Array||r instanceof Float32Array||r instanceof Float64Array||"BigUint64Array"in globalThis&&r instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&r instanceof globalThis.BigInt64Array}function Ad(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}var Be=class{constructor(t,e,n=!0){this.onThens=new Array;this.onCatches=new Array;this._result=void 0;this._error=void 0;this._started=!1;this._errored=!1;this._finished=!1;pe(t)?this.resolveTest=t:this.resolveTest=hn,pe(e)?this.rejectTest=e:this.rejectTest=hn,Je(t)?this.autoStart=t:Je(e)?this.autoStart=e:v(n)?this.autoStart=n:this.autoStart=!1,this.resolve=i=>{if(this.running&&this.resolveTest(i)){this._result=i;for(let o of this.onThens)o(i);this.clear(),this._finished=!0}},this.reject=i=>{if(this.running&&this.rejectTest(i)){this._error=i,this._errored=!0;for(let o of this.onCatches)o(i);this.clear(),this._finished=!0}},this.autoStart&&this.start()}clear(){le(this.onThens),le(this.onCatches)}start(){this._started=!0}get result(){if(v(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}get running(){return this.started&&!this.finished}get errored(){return this._errored}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((t,e)=>{this.finished?this.errored?e(this.error):t(this.result):(this.onThens.push(t),this.onCatches.push(e))})}then(t,e){return this.project().then(t,e)}catch(t){return this.project().catch(t)}finally(t){return this.project().finally(t)}reset(){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._errored=!1,this._finished=!1,this._started=!1,this.autoStart&&this.start()}};function _d(r,t){return"on"+t in r}function ue(r,t,e,...n){B(n)&&(n=[]);let i;if(Q(e)?n.unshift(e):ce(e)&&(i=e),!(r instanceof Ui)){if(!_d(r,t))throw new At(`Target does not have a ${t} rejection event`);for(let d of n)if(!_d(r,d))throw new At(`Target does not have a ${d} rejection event`)}let o=new Be;if(ce(i)){let d=setTimeout(o.reject,i,`'${t}' has timed out.`);o.finally(clearTimeout.bind(globalThis,d))}let s=(d,h)=>{r.addEventListener(d,h),o.finally(()=>r.removeEventListener(d,h))},a=d=>o.resolve(d),p=d=>o.reject(d);s(t,a);for(let d of n)s(d,p);return o}function _t(r){return r.then(hn).catch(xd)}var xn=(p=>(p[p.LocalUser=0]="LocalUser",p[p.Mouse=1]="Mouse",p[p.Pen=2]="Pen",p[p.Touch=3]="Touch",p[p.MotionController=4]="MotionController",p[p.MotionControllerLeft=5]="MotionControllerLeft",p[p.MotionControllerRight=6]="MotionControllerRight",p[p.RemoteUser=7]="RemoteUser",p))(xn||{});var bd=class{constructor(t,e,n){this.callback=null;this.promise=new Promise((i,o)=>{this.callback=(...s)=>{t(...s)?i(e(...s)):o(n(...s))}})}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};function Ed(r){let t=new Be(r),e=setInterval(()=>{r()&&(clearInterval(e),t.resolve())},100);return t}var At=class extends Error{constructor(e,n=null){super(e);this.innerError=n}};function yd(){return"chrome"in globalThis&&!navigator.userAgent.match("CriOS")}function wd(){return"InstallTrigger"in globalThis}function yx(){return/^mac/i.test(navigator.platform)}function wx(){return/iP(ad|hone|od)/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||yx()&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>2}function Ut(){return/Mobile VR/.test(navigator.userAgent)||/Pico Neo 3 Link/.test(navigator.userAgent)||Gt}function Yo(){return"xr"in navigator&&"isSessionSupported"in navigator.xr}function Ml(){return"getVRDisplays"in navigator}function Jo(){return Yo()||Ml()}function Wi(){return/Android/.test(navigator.userAgent)||/BlackBerry/.test(navigator.userAgent)||/(UC Browser |UCWEB)/.test(navigator.userAgent)||wx()||Ut()}function kr(){return!Wi()}var Tx=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,Ko=navigator.userAgent.match(Tx),Gt=!!Ko,Td=Gt&&{major:parseFloat(Ko[1]),minor:parseFloat(Ko[2]),patch:parseFloat(Ko[3])},Eb=Gt&&/pacific/i.test(navigator.userAgent),yb=Gt&&/quest/i.test(navigator.userAgent),wb=Gt&&/quest 2/i.test(navigator.userAgent);var Sl="Worker"in globalThis;var Mx=298.257223563,Sx=6378137;var Rl=1/Mx,Zo=1-Rl,ne=Rl/(2-Rl),Mb=Sx/(1+ne)*(1+ne*ne/4+ne*ne*ne*ne/64),$o=Math.sqrt(1-Zo*Zo),ht=1-Zo*Zo,Sb=$o*$o/(1-$o*$o),Rb=1-ht*(.25+ht*(3/64+5*ht/256)),Pb=ht*(3/8+ht*(3/32+45*ht/1024)),Cb=ht*ht*(15/256+ht*45/1024),Ib=ht*ht*ht*(35/3072),Vb=[ne/2-2*ne*ne/3+37*ne*ne*ne/96,ne*ne/48+ne*ne*ne/15,17*ne*ne*ne/480],Lb=[2*ne-2*ne*ne/3,7*ne*ne/3-8*ne*ne*ne/5,56*ne*ne*ne/15];var es=1e-6,qi=typeof Float32Array<"u"?Float32Array:Array,Pl=Math.random;var Ob=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var Ze={};xx(Ze,{add:()=>Lx,angle:()=>tg,bezier:()=>qx,ceil:()=>kx,clone:()=>Px,copy:()=>Ix,create:()=>Md,cross:()=>Ux,dist:()=>pg,distance:()=>Id,div:()=>lg,divide:()=>Cd,dot:()=>kd,equals:()=>og,exactEquals:()=>ig,floor:()=>Ox,forEach:()=>mg,fromValues:()=>Cx,hermite:()=>Wx,inverse:()=>zx,len:()=>dg,length:()=>Sd,lerp:()=>Gx,max:()=>Bx,min:()=>Dx,mul:()=>ag,multiply:()=>Pd,negate:()=>Xx,normalize:()=>jx,random:()=>Qx,rotateX:()=>$x,rotateY:()=>Zx,rotateZ:()=>eg,round:()=>Fx,scale:()=>Hx,scaleAndAdd:()=>Nx,set:()=>Vx,sqrDist:()=>cg,sqrLen:()=>ug,squaredDistance:()=>Vd,squaredLength:()=>Ld,str:()=>rg,sub:()=>sg,subtract:()=>Rd,transformMat3:()=>Yx,transformMat4:()=>Kx,transformQuat:()=>Jx,zero:()=>ng});function Md(){var r=new qi(3);return qi!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Px(r){var t=new qi(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t}function Sd(r){var t=r[0],e=r[1],n=r[2];return Math.hypot(t,e,n)}function Cx(r,t,e){var n=new qi(3);return n[0]=r,n[1]=t,n[2]=e,n}function Ix(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r}function Vx(r,t,e,n){return r[0]=t,r[1]=e,r[2]=n,r}function Lx(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function Rd(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function Pd(r,t,e){return r[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r}function Cd(r,t,e){return r[0]=t[0]/e[0],r[1]=t[1]/e[1],r[2]=t[2]/e[2],r}function kx(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r[2]=Math.ceil(t[2]),r}function Ox(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r[2]=Math.floor(t[2]),r}function Dx(r,t,e){return r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.min(t[2],e[2]),r}function Bx(r,t,e){return r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r}function Fx(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r[2]=Math.round(t[2]),r}function Hx(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r}function Nx(r,t,e,n){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function Id(r,t){var e=t[0]-r[0],n=t[1]-r[1],i=t[2]-r[2];return Math.hypot(e,n,i)}function Vd(r,t){var e=t[0]-r[0],n=t[1]-r[1],i=t[2]-r[2];return e*e+n*n+i*i}function Ld(r){var t=r[0],e=r[1],n=r[2];return t*t+e*e+n*n}function Xx(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r}function zx(r,t){return r[0]=1/t[0],r[1]=1/t[1],r[2]=1/t[2],r}function jx(r,t){var e=t[0],n=t[1],i=t[2],o=e*e+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r}function kd(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function Ux(r,t,e){var n=t[0],i=t[1],o=t[2],s=e[0],a=e[1],p=e[2];return r[0]=i*p-o*a,r[1]=o*s-n*p,r[2]=n*a-i*s,r}function Gx(r,t,e,n){var i=t[0],o=t[1],s=t[2];return r[0]=i+n*(e[0]-i),r[1]=o+n*(e[1]-o),r[2]=s+n*(e[2]-s),r}function Wx(r,t,e,n,i,o){var s=o*o,a=s*(2*o-3)+1,p=s*(o-2)+o,d=s*(o-1),h=s*(3-2*o);return r[0]=t[0]*a+e[0]*p+n[0]*d+i[0]*h,r[1]=t[1]*a+e[1]*p+n[1]*d+i[1]*h,r[2]=t[2]*a+e[2]*p+n[2]*d+i[2]*h,r}function qx(r,t,e,n,i,o){var s=1-o,a=s*s,p=o*o,d=a*s,h=3*o*a,x=3*p*s,A=p*o;return r[0]=t[0]*d+e[0]*h+n[0]*x+i[0]*A,r[1]=t[1]*d+e[1]*h+n[1]*x+i[1]*A,r[2]=t[2]*d+e[2]*h+n[2]*x+i[2]*A,r}function Qx(r,t){t=t||1;var e=Pl()*2*Math.PI,n=Pl()*2-1,i=Math.sqrt(1-n*n)*t;return r[0]=Math.cos(e)*i,r[1]=Math.sin(e)*i,r[2]=n*t,r}function Kx(r,t,e){var n=t[0],i=t[1],o=t[2],s=e[3]*n+e[7]*i+e[11]*o+e[15];return s=s||1,r[0]=(e[0]*n+e[4]*i+e[8]*o+e[12])/s,r[1]=(e[1]*n+e[5]*i+e[9]*o+e[13])/s,r[2]=(e[2]*n+e[6]*i+e[10]*o+e[14])/s,r}function Yx(r,t,e){var n=t[0],i=t[1],o=t[2];return r[0]=n*e[0]+i*e[3]+o*e[6],r[1]=n*e[1]+i*e[4]+o*e[7],r[2]=n*e[2]+i*e[5]+o*e[8],r}function Jx(r,t,e){var n=e[0],i=e[1],o=e[2],s=e[3],a=t[0],p=t[1],d=t[2],h=i*d-o*p,x=o*a-n*d,A=n*p-i*a,E=i*A-o*x,S=o*h-n*A,P=n*x-i*h,R=s*2;return h*=R,x*=R,A*=R,E*=2,S*=2,P*=2,r[0]=a+h+E,r[1]=p+x+S,r[2]=d+A+P,r}function $x(r,t,e,n){var i=[],o=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=o[0]+e[0],r[1]=o[1]+e[1],r[2]=o[2]+e[2],r}function Zx(r,t,e,n){var i=[],o=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=o[0]+e[0],r[1]=o[1]+e[1],r[2]=o[2]+e[2],r}function eg(r,t,e,n){var i=[],o=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],r[0]=o[0]+e[0],r[1]=o[1]+e[1],r[2]=o[2]+e[2],r}function tg(r,t){var e=r[0],n=r[1],i=r[2],o=t[0],s=t[1],a=t[2],p=Math.sqrt(e*e+n*n+i*i),d=Math.sqrt(o*o+s*s+a*a),h=p*d,x=h&&kd(r,t)/h;return Math.acos(Math.min(Math.max(x,-1),1))}function ng(r){return r[0]=0,r[1]=0,r[2]=0,r}function rg(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"}function ig(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]}function og(r,t){var e=r[0],n=r[1],i=r[2],o=t[0],s=t[1],a=t[2];return Math.abs(e-o)<=es*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(n-s)<=es*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=es*Math.max(1,Math.abs(i),Math.abs(a))}var sg=Rd,ag=Pd,lg=Cd,pg=Id,cg=Vd,dg=Sd,ug=Ld,mg=function(){var r=Md();return function(t,e,n,i,o,s){var a,p;for(e||(e=3),n||(n=0),i?p=Math.min(i*e+n,t.length):p=t.length,a=n;a<p;a+=e)r[0]=t[a],r[1]=t[a+1],r[2]=t[a+2],o(r,r,s),t[a]=r[0],t[a+1]=r[1],t[a+2]=r[2];return t}}();var Cl=2*Math.PI;function gn(r){return(r%Cl+Cl)%Cl}function Wt(r,t,e){return Math.min(e,Math.max(t,r))}function Fe(r){return r*Math.PI/180}function Od(r,t,e){return(1-e)*r+e*t}function Il(r){return Math.pow(2,Math.ceil(Math.log2(r)))}function ts(r){return r*180/Math.PI}function Dd(r){return Math.abs(r)>1e-4?r:0}var qt=class extends q{constructor(){super(...arguments);this.attached=new Array;this.soFar=null;this.total=null;this.msg=null;this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(e,n,i,o){this.soFar=e,this.total=n,this.msg=i,this.est=o;for(let s of this.attached)s.report(e,n,i,o)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(e){this.report(0,1,e||"starting")}end(e){this.report(1,1,e||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,le(this.attached)}};var Qi=class extends qt{constructor(e,n){super();this.i=e;this.prog=n}report(e,n,i,o){super.report(e,n,i,o),this.prog.update(this.i,e,n,i)}};var Or=class{constructor(t){this.prog=t;this.weightTotal=0;this.subProgressCallbacks=new Array;this.subProgressWeights=new Array;this.subProgressValues=new Array;this.start=performance.now();for(let e=0;e<this.subProgressWeights.length;++e)this.subProgressValues[e]=0,this.subProgressCallbacks[e]=new Qi(e,this)}addSubProgress(t){t=t||1,this.weightTotal+=t,this.subProgressWeights.push(t),this.subProgressValues.push(0);let e=new Qi(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(e),e}update(t,e,n,i){if(this.prog){this.subProgressValues[t]=e/n;let o=0;for(let d=0;d<this.subProgressWeights.length;++d)o+=this.subProgressValues[d]*this.subProgressWeights[d];let s=performance.now(),a=s-this.start,p=this.start-s+a*this.weightTotal/o;this.prog.report(o,this.weightTotal,i,p)}}};function Vl(r){return v(r)&&pe(r.report)&&pe(r.attach)&&pe(r.end)}function Dr(r,t){return new Ll(t,r).subProgressCallbacks}function Bd(r,t){let e=new Array(t);for(let n=0;n<t;++n)e[n]=1;return Dr(r,e)}var Ll=class extends Or{constructor(t,e){super(e);for(let n of t)this.addSubProgress(n)}};function Fd(r){return new kl(r)}var kl=class extends Or{pop(t){return this.addSubProgress(t)}};async function Ol(r,t){let e=new Array(t.length),n=new Array(t.length);for(let s=0;s<t.length;++s){let a=t[s];e[s]=a[0],n[s]=a[1]}let i=Dr(r,e),o=new Array(t.length);for(let s=0;s<t.length;++s)o[s]=n[s](i[s]);return await Promise.all(o)}function Hd(r,...t){let e=t.map(n=>[1,n]);return Ol(r,e)}function bt(r,t){let e=globalThis,n=e[r];if(B(n)){if(B(t))throw new Error(`No value ${r} found`);n=t(),e[r]=n}return n}var fg="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function Et(r,t){if(r<0)throw new Error("Length must be greater than 0");B(t)&&(t=fg);let e="";for(let n=0;n<r;++n){let i=Math.floor(Math.random()*t.length);e+=t[i]}return e}function qn(...r){let t=[];for(let e of r)v(e)&&e.length>0&&t.indexOf(e)===-1&&t.push(e);return t.join("-")}var Ki=class{constructor(){this.t=0;this.dt=0;this.sdt=0;this.fps=0}set(t,e){this.t=t,this.dt=e,this.sdt=Od(this.sdt,e,.01),e>0&&(this.fps=1e3/e)}},ns=class extends Ki{constructor(){super(),Object.seal(this)}};var Br=class{constructor(t){this.timer=null;this.lt=-1;this.tickHandlers=new Array;this._targetFPS=null;this.targetFPS=t;let e=new ns,n=0;this.onTick=i=>{this.lt>=0&&(n=i-this.lt,e.set(i,n),this.tick(e)),this.lt=i}}get targetFPS(){return this._targetFPS}set targetFPS(t){this._targetFPS=t}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){dt(this.tickHandlers,t)}tick(t){for(let e of this.tickHandlers)e(t)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};var rs=class extends Br{constructor(t){super(t)}start(){let t=()=>{this.timer=setTimeout(t,this.targetFrameTime),this.onTick(performance.now())};this.timer=setTimeout(t,this.targetFrameTime)}stop(){this.isRunning&&(clearTimeout(this.timer),super.stop())}};function Dl(r){let t=new Map;for(let[e,n]of r)t.set(n,e);return t}function xg(r){return r!=="B"&&r[1]==="i"}function Nd(r){return r!=="B"&&!Nd(r)}var gg=new Map([[1,"KiB"],[2,"MiB"],[3,"GiB"],[4,"TiB"]]),vg=new Map([[1,"KB"],[2,"MB"],[3,"GB"],[4,"TB"]]),Ag=Dl(gg),_g=Dl(vg);function Xd(r,t){if(t==="B")return r;{let e,n;xg(t)?(e=1024,n=Ag.get(t)):Nd(t)?(e=1e3,n=_g.get(t)):de(t);let i=Math.pow(e,n);return r*i}}var zd=304.79999999999995,sy=zd*3,bg=10*100,Eg=zd*16.5,yg=Eg*40,ay=bg*1e3,ly=yg*8,jd=2.54*4,Ud=jd*3,py=Ud*3,wg=Ud*16.5,Tg=wg*40,cy=100*1e3,dy=Tg*8,Bl=4*3,Mg=Bl*3,Yi=100/2.54,Sg=Bl*16.5,Rg=Sg*40,uy=Yi*1e3,my=Rg*8,hy=3*3,Pg=100/jd,Cg=3*16.5,Ig=Cg*40,fy=Pg*1e3,xy=Ig*8,Fl=Yi/Bl,Vg=16.5*40,gy=Fl*1e3,vy=Vg*8,Lg=Yi/Mg,kg=16.5/3,Og=kg*40,Ay=Lg*1e3,_y=Og*8,Gd=16.5/Fl,Wd=Gd*40,by=Wd*8,Ey=1e3/Gd,yy=40*8,Dg=1e3/Wd,wy=8/Dg;function qd(r){return r/Fl}function Qd(r){return r/Yi}function Kd(r){return r*Yi}function Hl(r){return v(r)&&r.length>0?parseFloat(r):null}var is=class{constructor(t,e){this._url=null;this._base=void 0;this._protocol=null;this._host=null;this._hostName=null;this._userName=null;this._password=null;this._port=null;this._pathName=null;this._hash=null;this._query=new Map;t!==void 0&&(this._url=new URL(t,e),this.rehydrate())}rehydrate(){v(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),v(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),v(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),v(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),v(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),v(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),v(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),v(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[t,e]of this._query)this._url.searchParams.set(t,e);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=Hl(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((t,e)=>this._query.set(e,t))}refresh(){if(this._url===null){if(v(this._protocol)&&(v(this._host)||v(this._hostName))){if(v(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=Hl(this._url.port),this.rehydrate(),!1;if(v(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(v(this._pathName)&&v(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return v(this._url)}base(t){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=t,this.refresh(),this}protocol(t){return this._protocol=t,this.refresh()&&(this._url.protocol=t),this}host(t){return this._host=t,this.refresh()&&(this._url.host=t,this._hostName=this._url.hostname,this._port=Hl(this._url.port)),this}hostName(t){return this._hostName=t,this.refresh()&&(this._url.hostname=t,this._host=`${this._url.hostname}:${this._url.port}`),this}port(t){return this._port=t,this.refresh()&&(this._url.port=t.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(t){return this._userName=t,this.refresh()&&(this._url.username=t),this}password(t){return this._password=t,this.refresh()&&(this._url.password=t),this}path(t){return this._pathName=t,this.refresh()&&(this._url.pathname=t),this}pathPop(t){return t=t||/\/[^\/]+\/?$/,this.path(this._pathName.replace(t,""))}pathPush(t){let e=this._pathName;return e.endsWith("/")||(e+="/"),e+=t,this.path(e)}query(t,e){return this._query.set(t,e),this.refresh()&&this._url.searchParams.set(t,e),this}hash(t){return this._hash=t,this.refresh()&&(this._url.hash=t),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};function Nl(r,...t){if(!fn(r))return!1;r=r;for(let e of t){if(!(e in r))return!1;let n=r[e];if(!pe(n))return!1}return!0}function Fr(r){return Nl(r,"dispose")}function Bg(r){return Nl(r,"destroy")}function Fg(r){return Nl(r,"close")}function Hr(r){Fr(r)&&r.dispose(),Fg(r)&&r.close(),Bg(r)&&r.destroy()}function Yd(r,t){try{return t(r)}finally{Hr(r)}}var Jd=/([^\/]+)\/(.+)/,Hg=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/,Qn=class{constructor(t,e,n){this._type=t;this._fullSubType=e;this._primaryExtension=null;this.depMessage=null;let i=new Map;this._parameters=i;let o=this._fullSubType.match(Hg);this._tree=o[1],this._subType=o[2],this._suffix=o[3];let s=o[4];if(this._value=this._fullValue=this._type+"/",v(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,v(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),v(s)){let a=s.split(";").map(p=>p.trim()).filter(p=>p.length>0).map(p=>p.split("="));for(let[p,...d]of a){let h=d.join("=");i.set(p,h);let x=`; ${p}=${h}`;this._fullValue+=x,p!=="q"&&(this._value+=x)}}this._extensions=n||[],this._primaryExtension=this._extensions[0]||null}static parse(t){if(!t)return null;let e=t.match(Jd);if(!e)return null;let n=e[1],i=e[2];return new Qn(n,i)}deprecate(t){return this.depMessage=t,this}check(){v(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(t){if(B(t))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let e=null,n=null;if(Q(t)){let i=t.match(Jd);if(!i)return!1;e=i[1],n=i[2]}else e=t.typeName,n=t._fullSubType;return this.typeName===e&&(this._fullSubType==="*"||this._fullSubType===n)}withParameter(t,e){let n=`${this._fullSubType}; ${t}=${e}`;return new Qn(this.typeName,n,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}addExtension(t){if(!t)throw new Error("File name is not defined");if(this.primaryExtension){let e=t.lastIndexOf(".");if(e>-1){let n=t.substring(e+1);this.extensions.indexOf(n)>-1&&(t=t.substring(0,e))}t=`${t}.${this.primaryExtension}`}return t}};function Ng(r,t,...e){return new Qn(r,t,e)}function Oe(r){return Ng.bind(null,r)}var Xl=Oe("application");var Ji=Xl("javascript","js");var zl=Xl("json","json");var jl=Xl("wasm","wasm");var Xg=Oe("audio");var Nr=Xg("mpeg","mp3","mp2","mp2a","mpga","m2a","m3a");var $d=Oe("image");var os=$d("jpeg","jpeg","jpg","jpe");var Zd=$d("png","png");var eu=Oe("model");var ss=eu("gltf-binary","glb"),tu=eu("gltf+json","gltf");var nu=Oe("text");var ru=nu("plain","txt","text","conf","def","list","log","in");var iu=nu("xml");var zg=Oe("video");var ou=zg("vnd.mpeg.dash.mpd","mpd");var Kn=class{constructor(t,e){this.path=t;this.type=e;this._result=null;this._error=null;this._started=!1;this._finished=!1;this.resolve=null;this.reject=null;this.promise=new Promise((n,i)=>{this.resolve=o=>{this._result=o,this._finished=!0,n(o)},this.reject=o=>{this._error=o,this._finished=!0,i(o)}})}get result(){if(v(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}async getSize(t){try{let{contentLength:e}=await t.head(this.path).accept(this.type).exec();return[this,e||1]}catch(e){return console.warn(e),[this,1]}}async fetch(t,e){try{let n=await this.getResult(t,e);this.resolve(n)}catch(n){this.reject(n)}}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};var Xr=class extends Kn{constructor(e,n,i){let o;Je(n)?i=n:o=n;super(e,o);this.useCache=!!i}async getResult(e,n){return(await this.getRequest(e,n)).content}getRequest(e,n){let i=e.get(this.path).useCache(this.useCache).progress(n);return this.getResponse(i)}},vn=class extends Xr{getResponse(t){return t.audio(!1,!1,this.type)}};var zr=class extends Xr{getResponse(t){return t.image(this.type)}};var ge=class{constructor(t,e,n,...i){this.key=t;this.value=e;this.bySetAttribute=n;this.tags=i.map(o=>o.toLocaleUpperCase()),Object.freeze(this)}applyToElement(t){let e=this.key.startsWith("data-");if(!(this.tags.length===0||this.tags.indexOf(t.tagName)>-1||e))console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`);else if(e){let i=this.key.substring(5);t.dataset[i]=this.value}else this.key==="style"?Object.assign(t.style,this.value):this.key==="classList"?this.value.forEach(i=>t.classList.add(i)):this.bySetAttribute?t.setAttribute(this.key,this.value):this.key in t?t[this.key]=this.value:this.value===!1?t.removeAttribute(this.key):this.value===!0?t.setAttribute(this.key,""):t.setAttribute(this.key,this.value)}};function Qt(r){return new ge("autoplay",r,!1,"audio","video")}function we(r){return new ge("className",r,!1)}function jr(...r){return new ge("classList",r,!1)}function An(r){return new ge("controls",r,!1,"audio","video")}function su(r,t){return new ge("data-"+r,t,!1)}function au(r){return new ge("height",r,!1,"canvas","embed","iframe","img","input","object","video")}function Yn(r){return new ge("id",r,!1)}function Jn(r){return new ge("loop",r,!1,"audio","bgsound","marquee","video")}function Ul(r){return new ge("max",r,!1,"input","meter","progress")}function Gl(r){return new ge("min",r,!1,"input","meter")}function Wl(r){return new ge("muted",r,!1,"audio","video")}function Kt(r){return new ge("playsInline",r,!1,"audio","video")}function jg(r){return r instanceof URL&&(r=r.href),r}function $i(r){return new ge("src",jg(r),!1,"audio","embed","iframe","img","input","script","source","track","video")}function ql(r){return new ge("srcObject",r,!1,"audio","video")}function Ql(r){return new ge("step",r,!1,"input")}function Ur(r){return new ge("title",r,!1)}function $n(r){return Q(r)||(r=r.value),new ge("type",r,!1,"button","input","command","embed","link","object","script","source","style","menu")}function Gr(r){return new ge("value",r,!1,"button","data","input","li","meter","option","progress","param")}function lu(r){return new ge("width",r,!1,"canvas","embed","iframe","img","input","object","video")}var Y=class{constructor(t,e){this.key=t;this.value=e;this.name=t.replace(/[A-Z]/g,n=>`-${n.toLocaleLowerCase()}`)}applyToElement(t){t.style[this.key]=this.value}},Kl=class{constructor(...t){this.rest=t}applyToElement(t){for(let e of this.rest)e.applyToElement(t)}};function st(...r){return new Kl(...r)}function Zi(r){return new Y("backgroundColor",r)}function pu(r){return new Y("border",r)}function cu(r){return new Y("borderRadius",r)}function du(r){return new Y("boxShadow",r)}function uu(r){return new Y("columnGap",r)}function Ge(r){return new Y("display",r)}function mu(r){return new Y("flexFlow",r)}function hu(r){return new Y("float",r)}function as(r){return new Y("fontSize",r)}function ls(r,t,e,n){return Q(r)||(r=[r,t,e,n].filter(v).join("/")),new Y("gridArea",r)}function ps(r){return new Y("gridAutoFlow",r)}function Zn(r,t){return Q(r)||(r=[r,t].filter(v).join("/")),new Y("gridColumn",r)}function cs(r,t){return Q(r)||(r=[r,t].filter(v).join("/")),new Y("gridRow",r)}function _n(r){return new Y("gridTemplateColumns",r)}function ds(r){return new Y("gridTemplateRows",r)}function Yt(r){return new Y("height",r)}function er(r){return new Y("left",r)}function bn(r){return new Y("margin",r)}function fu(r){return new Y("marginInlineStart",r)}function xu(r){return new Y("marginLeft",r)}function gu(r){return new Y("maxHeight",r)}function eo(r){return new Y("maxWidth",r)}function vu(r){return new Y("minWidth",r)}function Au(r){return new Y("overflow",r)}function En(...r){return new Y("padding",r.join(" "))}function _u(r){return new Y("paddingRight",r)}function Jl(r){return new Y("pointerEvents",r)}function Wr(r){return new Y("position",r)}function tr(r){return new Y("textAlign",r)}function nr(r){return new Y("top",r)}function bu(r){return new Y("touchAction",r)}function Eu(r){return new Y("transform",r)}function yt(r){return new Y("width",r)}function us(r){return new Y("zIndex",ce(r)?r.toFixed(0):r)}function yu(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}var Yl=class{constructor(t,e){this.selector=t;this.props=e}apply(t){let e=this.props.map(n=>`${n.name}: ${n.value};`).join("");t.insertRule(`${this.selector} {${e}}`,t.cssRules.length)}};function ee(r,...t){return new Yl(r,t)}function to(r){return fn(r)?r.element instanceof Node:!1}function $l(r){return fn(r)&&"elements"in r&&r.elements instanceof Array}function Jt(r){return to(r)?r.element:r}function Ug(r){return fn(r)&&"applyToElement"in r&&pe(r.applyToElement)}function Ie(r,t,e="block"){r=Jt(r),r.style.display=t?e:"none"}function Pt(r){return r=Jt(r),r.style.display!=="none"}function fe(r,...t){r=Jt(r);for(let e of t)v(e)&&(e instanceof Node?r.append(e):to(e)?r.append(Jt(e)):$l(e)?r.append(...e.elements.map(Jt)):Ug(e)?e.applyToElement(r):r.append(document.createTextNode(e.toLocaleString())));return r}function Gg(r){return document.querySelector(r)}function Tu(r){return Gg(r)}function He(r,...t){let e=null;for(let n of t)if(n instanceof ge&&n.key==="id"){e=document.getElementById(n.value);break}return e==null&&(e=document.createElement(r)),fe(e,...t),e}function Mu(r){return"disabled"in r&&Je(r.disabled)}function no(r){for(r=Jt(r);r.lastChild;)r.lastChild.remove()}function ro(r,t){r=Jt(r),no(r),r.append(Kg(t))}function Wg(r,t){r=Jt(r),r.title=t}function wu(r,t,e){let n=v(e),i=n&&r.classList.contains(e);n&&i!==t&&(t?r.classList.add(e):r.classList.remove(e))}var qg=["danger","dark","info","light","primary","secondary","success","warning"];function rr(r,t,e,n,i){if(r=Jt(r),Q(e))for(let o of qg)wu(r,t&&o===e,`btn-${o}`),wu(r,!t&&o===e,`btn-outline-${o}`);r.disabled=!t,n&&ro(r,n),i&&Wg(r,i)}async function Su(r,t,e){v(e)&&e.start();let n=r==="canplay"?t.HAVE_CURRENT_DATA:t.HAVE_ENOUGH_DATA;if(t.readyState>=n)return!0;try{return await ue(t,r,"error"),!0}catch(i){return console.warn(t.error,i),!1}finally{v(e)&&e.end()}}function ms(r,t){return Su("canplay",r,t)}function hs(r,t){return Su("canplaythrough",r,t)}function ir(...r){return He("audio",...r)}function Qg(...r){return He("button",...r)}function Ru(...r){return Qg(...r,$n("button"))}function qr(...r){return Ru(...r,jr("btn","btn-primary"))}function fs(...r){return Ru(...r,jr("btn","btn-secondary"))}function xs(...r){return He("canvas",...r)}function Pu(...r){return He("dd",...r)}function xe(...r){return He("div",...r)}function Cu(...r){return He("dl",...r)}function Iu(...r){return He("dt",...r)}function Vu(...r){return He("h1",...r)}function Lu(...r){return He("h2",...r)}function or(...r){return He("img",...r)}function Zl(...r){return He("input",...r)}function ku(...r){return He("label",...r)}function Ou(...r){return He("meter",...r)}function gs(...r){return He("option",...r)}function Du(...r){return He("script",...r)}function ep(...r){return He("select",...r)}function tp(...r){return He("video",...r)}function Bu(...r){return Zl($n("checkbox"),...r)}function Fu(...r){return Zl($n("number"),...r)}function Hu(...r){return Zl($n("range"),...r)}function Kg(r){return document.createTextNode(r)}function Ct(...r){let t=document.createElement("style");document.head.append(t);for(let e of r)e.apply(t.sheet);return t}function io(r,t,e,...n){return ir(Kt(!0),An(!1),Wl(t),Qt(r),Jn(e),st(Ge("none")),...n)}function Nu(r,t,e,...n){return tp(Kt(!0),An(!1),Wl(t),Qt(r),Jn(e),st(Ge("none")),...n)}var np="HTMLCanvasElement"in globalThis,nT="HTMLImageElement"in globalThis,Xu=!1,sr=!Xu&&"OffscreenCanvas"in globalThis,Yg=!Xu&&"createImageBitmap"in globalThis;function ar(r){return np&&r instanceof HTMLCanvasElement}function rp(r){return sr&&r instanceof OffscreenCanvas}function zu(r){return Yg&&r instanceof ImageBitmap}function Jg(r,t){let e=r.getContext("2d");if(B(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function $g(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var Zg=sr&&$g(),Qr=Zg&&ip||np&&oo||null,Kr=np?oo:Qr;function ev(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var rT=sr&&ev();function ip(r,t){return new OffscreenCanvas(r,t)}function oo(r,t){return xs(lu(r),au(t))}function ju(r){let t=oo(r.width,r.height);return Jg(t,r),t}function op(r,t){let e=r.getContext("2d");if(B(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function Uu(r,t,e,n=1){return t=Math.floor(t*n),e=Math.floor(e*n),r.width!=t||r.height!=e?(r.width=t,r.height=e,!0):!1}function tv(r){return v(r.textBaseline)}function nv(r,t,e,n=1){let i=r.imageSmoothingEnabled,o=r.textBaseline,s=r.textAlign,a=r.font,p=Uu(r.canvas,t,e,n);return p&&(r.imageSmoothingEnabled=i,r.textBaseline=o,r.textAlign=s,r.font=a),p}function sp(r,t,e,n=1){return tv(r)?nv(r,t,e,n):Uu(r.canvas,t,e,n)}function Gu(r,t,e){if(rp(r))return r.convertToBlob({type:t,quality:e});if(ar(r)){let n=new Be;return r.toBlob(n.resolve,t,e),n}else throw new Error("Cannot save image from canvas")}var ap=null;function Wu(r){return ap===null&&(ap=new Audio),ap.canPlayType(r)!==""}var vs=class{constructor(t,e,n,i){this.fetcher=t;this.useFileBlobsForModules=e;this.method=n;this.prog=null;this.path=i,this.request={method:n,path:this.path.href,body:null,headers:null,timeout:null,withCredentials:!1,useCache:!1}}query(t,e){return this.path.searchParams.set(t,e),this.request.path=this.path.href,this}header(t,e){return this.request.headers===null&&(this.request.headers=new Map),this.request.headers.set(t.toLowerCase(),e),this}timeout(t){return this.request.timeout=t,this}progress(t){return this.prog=t,this}body(t,e){return this.request.body=t,this.content(e),this}withCredentials(){return this.request.withCredentials=!0,this}useCache(t=!0){return this.request.useCache=t,this}media(t,e){v(e)&&(Q(e)||(e=e.value),this.header(t,e))}content(t){this.media("content-type",t)}accept(t){return this.media("accept",t),this}blob(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBlob(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBlob(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}buffer(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBuffer(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBuffer(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}file(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetFile(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetFile(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}text(t){if(this.accept(t||ru),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetText(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetText(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}object(t){if(this.accept(t||zl),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetObject(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetObject(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}xml(t){if(this.accept(t||iu),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetXml(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetXml(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}imageBitmap(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetImageBitmap(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetImageBitmap(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}exec(){if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetNothing(this.request,this.prog);if(this.method==="GET")throw new At("GET requests should expect a response type");if(this.method==="HEAD"||this.method==="OPTIONS")return this.fetcher.sendNothingGetNothing(this.request);de(this.method)}async audioBlob(t){if(v(t)&&(Q(t)||(t=t.value),!Wu(t)))throw new Error(`Probably can't play file of type "${t}" at path: ${this.request.path}`);let e=await this.blob(t);if(Wu(e.contentType))return e;throw new Error(`Cannot play file of type "${e.contentType}" at path: ${this.request.path}`)}async audioBuffer(t,e){return De(await this.audioBlob(e),async n=>await t.decodeAudioData(await n.arrayBuffer()))}async htmlElement(t,e,n){let i=await this.file(n),o=ue(t,e,"error");return t.src=i.content,await o,await De(i,()=>t)}image(t){return this.htmlElement(or(),"load",t)}async htmlCanvas(t){let e=oo(1,1);if(this.method==="GET")if(sr){this.accept(t);let n=await this.fetcher.drawImageToCanvas(this.request,e.transferControlToOffscreen(),this.prog);return await De(n,()=>e)}else{let n=await this.image(t);return await De(n,i=>(e.width=i.width,e.height=i.height,op(e,i),Hr(i),e))}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}}canvas(t){return sr?this.offscreenCanvas(t):this.htmlCanvas(t)}async offscreenCanvas(t){if(!sr)throw new Error("This system does not support OffscreenCanvas");if(this.method==="GET"){let e=await this.image(t);return await De(e,n=>{let i=ip(n.width,n.height);return op(i,n),Hr(n),i})}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);de(this.method)}}audio(t,e,n){return this.htmlElement(io(t,!1,e),"canplay",n)}video(t,e,n){return this.htmlElement(Nu(t,!1,e),"canplay",n)}async getScript(){let t=Du($n(Ji));document.body.append(t),this.useFileBlobsForModules?await this.htmlElement(t,"load",Ji):t.src=this.request.path}async script(t){let e=this.request.path;if(!t)await this.getScript();else if(!t()){let n=Ed(t);await this.getScript(),await n}this.prog&&this.prog.end(e)}async module(){let t=this.request.path,e=t;if(this.useFileBlobsForModules){let{content:i}=await this.file(Ji);e=i}let n=await import(e);return this.prog&&this.prog.end(t),n}async wasm(t){let{content:e,contentType:n}=await this.buffer(jl);if(!jl.matches(n))throw new Error(`Server did not respond with WASM file. Was: ${n}`);let i=await WebAssembly.compile(e);return(await WebAssembly.instantiate(i,t)).exports}async worker(t="module"){let e=this.request.path,n=e;if(this.useFileBlobsForModules){let{content:o}=await this.file(Ji);n=o}this.prog=null,this.request.timeout=null;let i=new Worker(n,{type:t});return this.prog&&this.prog.end(e),i}};var As=class{constructor(t,e=!0){this.service=t;this.useFileBlobsForModules=e;{let n=Tu("input[name=__RequestVerificationToken]");n&&this.service.setRequestVerificationToken(n.value)}}createRequest(t,e,n){return new vs(this.service,this.useFileBlobsForModules,t,new URL(e,n||location.href))}clearCache(){return this.service.clearCache()}head(t,e){return this.createRequest("HEAD",t,e)}options(t,e){return this.createRequest("OPTIONS",t,e)}get(t,e){return this.createRequest("GET",t,e)}post(t,e){return this.createRequest("POST",t,e)}put(t,e){return this.createRequest("PUT",t,e)}patch(t,e){return this.createRequest("PATCH",t,e)}delete(t,e){return this.createRequest("DELETE",t,e)}async assets(t,...e){e=e.filter(v);let n=new Map(await Promise.all(e.map(i=>i.getSize(this))));await Ol(t,e.map(i=>[n.get(i),o=>i.fetch(this,o)]))}};async function De(r,t){let{status:e,path:n,content:i,contentType:o,contentLength:s,fileName:a,headers:p,date:d}=r;return{status:e,path:n,content:await t(i),contentType:o,contentLength:s,fileName:a,headers:p,date:d}}var so=class{constructor(t){this.impl=t;this.defaultPostHeaders=new Map}setRequestVerificationToken(t){this.defaultPostHeaders.set("RequestVerificationToken",t)}clearCache(){return this.impl.clearCache()}sendNothingGetNothing(t){return this.impl.sendNothingGetNothing(t)}sendNothingGetBlob(t,e){return this.impl.sendNothingGetSomething("blob",t,e)}sendObjectGetBlob(t,e){return this.impl.sendSomethingGetSomething("blob",t,this.defaultPostHeaders,e)}sendNothingGetBuffer(t,e){return this.impl.sendNothingGetSomething("arraybuffer",t,e)}sendObjectGetBuffer(t,e){return this.impl.sendSomethingGetSomething("arraybuffer",t,this.defaultPostHeaders,e)}sendNothingGetText(t,e){return this.impl.sendNothingGetSomething("text",t,e)}sendObjectGetText(t,e){return this.impl.sendSomethingGetSomething("text",t,this.defaultPostHeaders,e)}async sendNothingGetObject(t,e){return(await this.impl.sendNothingGetSomething("json",t,e)).content}async sendObjectGetObject(t,e){return(await this.impl.sendSomethingGetSomething("json",t,this.defaultPostHeaders,e)).content}sendObjectGetNothing(t,e){return this.impl.sendSomethingGetSomething("",t,this.defaultPostHeaders,e)}drawImageToCanvas(t,e,n){return this.impl.drawImageToCanvas(t,e,n)}async sendNothingGetFile(t,e){return De(await this.sendNothingGetBlob(t,e),URL.createObjectURL)}async sendObjectGetFile(t,e){return De(await this.sendObjectGetBlob(t,e),URL.createObjectURL)}async sendNothingGetXml(t,e){return De(await this.impl.sendNothingGetSomething("document",t,e),n=>n.documentElement)}async sendObjectGetXml(t,e){return De(await this.impl.sendSomethingGetSomething("document",t,this.defaultPostHeaders,e),n=>n.documentElement)}async sendNothingGetImageBitmap(t,e){return De(await this.sendNothingGetBlob(t,e),createImageBitmap)}async sendObjectGetImageBitmap(t,e){return De(await this.sendObjectGetBlob(t,e),createImageBitmap)}};var _s=class extends q{constructor(e){super();this.worker=e;this.taskCounter=0;this.invocations=new Map;this.tasks=new Array;Sl||console.warn("Workers are not supported on this system."),this.worker.addEventListener("message",n=>{let i=n.data;switch(i.type){case"event":this.propogateEvent(i);break;case"progress":this.progressReport(i);break;case"return":this.methodReturned(i);break;case"error":this.invocationError(i);break;default:de(i)}})}postMessage(e,n){e.type!=="methodCall"&&de(e.type),n?this.worker.postMessage(e,n):this.worker.postMessage(e)}dispose(){this.worker.terminate()}progressReport(e){let n=this.invocations.get(e.taskID);if(n){let{prog:i}=n;i&&i.report(e.soFar,e.total,e.msg,e.est)}}methodReturned(e){let n=this.removeInvocation(e.taskID),{task:i}=n;i.resolve(e.returnValue)}invocationError(e){let n=this.removeInvocation(e.taskID),{task:i,methodName:o}=n;i.reject(new Error(`${o} failed. Reason: ${e.errorMessage}`))}removeInvocation(e){let n=this.invocations.get(e);return this.invocations.delete(e),n}callMethod(e,n,i,o){if(!Sl)return Promise.reject(new Error("Workers are not supported on this system."));let s=null,a=null;Vl(n)&&(o=n,n=null,i=null),Vl(i)&&!o&&(o=i,i=null),ke(n)&&(s=n),ke(i)&&(a=i);let p=this.taskCounter++,d=ut(this.tasks,A=>A.finished);d?d.reset():(d=new Be,this.tasks.push(d));let h={methodName:e,task:d,prog:o};this.invocations.set(p,h);let x=null;return v(n)?x={type:"methodCall",taskID:p,methodName:e,params:s}:x={type:"methodCall",taskID:p,methodName:e},this.postMessage(x,a),d}};var bs=class extends q{constructor(e,n){super();this.scriptPath=e.scriptPath;let i=-1,o=e.workers,s=null;if(ce(o)?i=o:v(o)?(this.taskCounter=o.curTaskCounter,s=o.workers,i=s.length):i=navigator.hardwareConcurrency||4,i<1)throw new Error("Worker pool size must be a postive integer greater than 0");if(this.workers=new Array(i),B(s)){this.taskCounter=0;for(let a=0;a<i;++a)this.workers[a]=new n(new Worker(this.scriptPath,{type:"module"}))}else for(let a=0;a<i;++a)this.workers[a]=new n(s[a]);for(let a of this.workers)a.addBubbler(this)}dispose(){for(let e of this.workers)e.dispose();le(this.workers)}nextWorker(){let e=this.peekWorker();return this.taskCounter++,e}peekWorker(){return this.workers[this.taskCounter%this.workers.length]}};function rv(r){return r==="application/xhtml+xml"||r==="application/xml"||r==="image/svg+xml"||r==="text/html"||r==="text/xml"}function qu(r){let{status:t,path:e,content:n,contentType:i,contentLength:o,fileName:s,headers:a,date:p}=r;if(!rv(i))throw new Error(`Content-Type ${i} is not one supported by the DOM parser.`);let h=new TextDecoder().decode(n),A=new DOMParser().parseFromString(h,i);return{status:t,path:e,content:A.documentElement,contentType:i,contentLength:o,fileName:s,date:p,headers:a}}function Qu(r){let{status:t,path:e,content:n,contentType:i,contentLength:o,fileName:s,headers:a,date:p}=r,d=new Blob([n],{type:i});return{status:t,path:e,content:d,contentType:i,contentLength:o,fileName:s,date:p,headers:a}}function Ku(r){return r={method:r.method,path:r.path,timeout:r.timeout,headers:r.headers,withCredentials:r.withCredentials,useCache:r.useCache},r}function iv(r){return r={method:r.method,path:r.path,body:r.body,timeout:r.timeout,headers:r.headers,withCredentials:r.withCredentials,useCache:r.useCache},r}var Es=class extends _s{setRequestVerificationToken(t){this.callMethod("setRequestVerificationToken",[t])}clearCache(){return this.callMethod("clearCache")}propogateEvent(t){de(t.eventName)}makeRequest(t,e,n){return this.callMethod(t,[Ku(e)],n)}makeRequestWithBody(t,e,n){return this.callMethod(t,[iv(e)],n)}sendNothingGetNothing(t){return this.makeRequest("sendNothingGetNothing",t,null)}sendNothingGetBuffer(t,e){return this.makeRequest("sendNothingGetBuffer",t,e)}sendNothingGetText(t,e){return this.makeRequest("sendNothingGetText",t,e)}sendNothingGetObject(t,e){return this.makeRequest("sendNothingGetObject",t,e)}sendNothingGetFile(t,e){return this.makeRequest("sendNothingGetFile",t,e)}sendNothingGetImageBitmap(t,e){return this.makeRequest("sendNothingGetImageBitmap",t,e)}sendObjectGetNothing(t,e){return this.makeRequestWithBody("sendObjectGetNothing",t,e)}sendObjectGetBuffer(t,e){return this.makeRequestWithBody("sendObjectGetBuffer",t,e)}sendObjectGetText(t,e){return this.makeRequestWithBody("sendObjectGetText",t,e)}sendObjectGetObject(t,e){return this.makeRequestWithBody("sendObjectGetObject",t,e)}sendObjectGetFile(t,e){return this.makeRequestWithBody("sendObjectGetFile",t,e)}sendObjectGetImageBitmap(t,e){return this.makeRequestWithBody("sendObjectGetImageBitmap",t,e)}drawImageToCanvas(t,e,n){return this.callMethod("drawImageToCanvas",[Ku(t),e],[e],n)}async sendNothingGetBlob(t,e){let n=await this.sendNothingGetBuffer(t,e);return Qu(n)}async sendNothingGetXml(t,e){let n=await this.sendNothingGetBuffer(t,e);return qu(n)}async sendObjectGetBlob(t,e){let n=await this.sendObjectGetBuffer(t,e);return Qu(n)}async sendObjectGetXml(t,e){let n=await this.sendObjectGetBuffer(t,e);return qu(n)}};var Yr=class{constructor(t){this.db=t}static async getCurrentVersion(t){if(v(indexedDB.databases)){let e=await indexedDB.databases();for(let{name:n,version:i}of e)if(n===t)return i}return null}static delete(t){let e=indexedDB.deleteDatabase(t),n=ue(e,"success","error","blocked");return _t(n)}static async open(t,...e){let n=ji(e,I=>I.name,jt),i=new $e(e.filter(I=>v(I.indexes)).flatMap(I=>I.indexes.map(O=>[I.name,O.name,O]))),o=new Array,s=new Array,a=new Array,p=new mt,d=new mt,h=await this.getCurrentVersion(t);if(B(h)){o.push(...n.keys());for(let I of e)if(v(I.indexes))for(let O of I.indexes)p.add(I.name,O.name)}else{let I=indexedDB.open(t);if(await _t(ue(I,"success","error","blocked"))){let O=I.result,L=new Array;for(let k of Array.from(O.objectStoreNames))n.has(k)||s.push(k);for(let k of n.keys())O.objectStoreNames.contains(k)?L.push(k):o.push(k);if(L.length>0){let k=O.transaction(L),H=ue(k,"complete","error","abort"),V=_t(H);for(let D of L){let te=k.objectStore(D);for(let K of Array.from(te.indexNames))i.has(D,K)||(a.indexOf(D)===-1&&a.push(D),d.add(D,K));if(i.has(D))for(let K of i.get(D).keys())if(!te.indexNames.contains(K))a.indexOf(D)===-1&&a.push(D),p.add(D,K);else{let z=i.get(D,K),J=te.index(K);(Q(z.keyPath)!==Q(J.keyPath)||Q(z.keyPath)&&Q(J.keyPath)&&z.keyPath!==J.keyPath||ke(z.keyPath)&&ke(J.keyPath)&&Wo(z.keyPath,J.keyPath))&&(a.indexOf(D)===-1&&a.push(D),d.add(D,K),p.add(D,K))}}k.commit(),await V}O.close()}(o.length>0||s.length>0||p.size>0||d.size>0)&&++h}let x=new Be,A=v(h)?indexedDB.open(t,h):indexedDB.open(t),E=ue(A,"success","error","blocked"),S=_t(x),P=_t(E),R=()=>x.resolve(!1);if(A.addEventListener("success",R),A.addEventListener("upgradeneeded",()=>{let I=ue(A.transaction,"complete","error","abort"),O=A.result;for(let k of s)O.deleteObjectStore(k);let L=new Map;for(let k of o){let H=n.get(k),V=O.createObjectStore(k,H.options);L.set(k,V)}for(let k of a){let H=A.transaction.objectStore(k);L.set(k,H)}for(let[k,H]of L){for(let V of d.get(k))H.deleteIndex(V);for(let V of p.get(k)){let D=i.get(k,V);H.createIndex(V,D.keyPath,D.options)}}_t(I).then(x.resolve).catch(x.reject).finally(()=>A.removeEventListener("success",R))}),!await S)throw x.error;if(!await P)throw E.error;return new Yr(A.result)}dispose(){this.db.close()}get name(){return this.db.name}get version(){return this.db.version}get storeNames(){return Array.from(this.db.objectStoreNames)}getStore(t){return new lp(this.db,t)}},lp=class{constructor(t,e){this.db=t;this.storeName=e}async request(t,e){let n=this.db.transaction(this.storeName,e),i=ue(n,"complete","error"),o=n.objectStore(this.storeName),s=t(o),a=ue(s,"success","error");if(!await _t(a))throw n.abort(),a.error;if(n.commit(),!await _t(i))throw i.error;return s.result}add(t,e){return this.request(n=>n.add(t,e),"readwrite")}clear(){return this.request(t=>t.clear(),"readwrite")}getCount(t){return this.request(e=>e.count(t),"readonly")}delete(t){return this.request(e=>e.delete(t),"readwrite")}get(t){return this.request(e=>e.get(t),"readonly")}getAll(){return this.request(t=>t.getAll(),"readonly")}getAllKeys(){return this.request(t=>t.getAllKeys(),"readonly")}getKey(t){return this.request(e=>e.getKey(t),"readonly")}openCursor(t,e){return this.request(n=>n.openCursor(t,e),"readonly")}openKeyCursor(t,e){return this.request(n=>n.openKeyCursor(t,e),"readonly")}put(t,e){return this.request(n=>n.put(t,e),"readwrite")}};function ov(r){return Q(r)||vd(r)||r instanceof Blob||r instanceof FormData||Ad(r)||r instanceof ReadableStream||"Document"in globalThis&&r instanceof Document}function ys(r,t,e,n,i,o){let s=!o;o&&o.then(()=>s=!0);let a=!1,p=i,d=new Be(()=>p&&a,()=>s);e.addEventListener("loadstart",()=>{s&&!a&&n&&n.start(r)}),e.addEventListener("progress",x=>{if(s&&!a){let A=x;n&&n.report(A.loaded,Math.max(A.loaded,A.total),r),A.loaded===A.total&&(p=!0,d.resolve())}}),e.addEventListener("load",()=>{s&&!a&&(n&&n.end(r),a=!0,d.resolve())});let h=x=>()=>d.reject(`${x} (${t.status})`);return e.addEventListener("error",h("error")),e.addEventListener("abort",h("abort")),e.addEventListener("timeout",h("timeout")),d}function pp(r,t,e,n,i,o){if(r.open(t,e),r.responseType="blob",r.timeout=n,i)for(let[s,a]of i)r.setRequestHeader(s,a);v(o)?r.send(o):r.send()}function ws(r,t,e){if(!r.has(t))return null;let n=r.get(t);try{let i=e(n);return r.delete(t),i}catch(i){console.warn(t,i)}return null}var sv=/filename=\"(.+)\"(;|$)/,av="Juniper:Fetcher:Cache",Ts=class{constructor(){this.cache=null;this.store=null;this.tasks=new $e;this.cacheReady=this.openCache()}async drawImageToCanvas(t,e,n){let i=await this.sendNothingGetSomething("blob",t,n),o=i.content;return Yd(await createImageBitmap(o,{imageOrientation:"none"}),s=>(e.width=s.width,e.height=s.height,e.getContext("2d").drawImage(s,0,0),De(i,()=>null)))}async openCache(){this.cache=await Yr.open(av,{name:"files",options:{keyPath:"path"}}),this.store=await this.cache.getStore("files")}async clearCache(){await this.cacheReady,await this.store.clear()}async readResponseHeaders(t,e){let n=e.getAllResponseHeaders().split(/[\r\n]+/).map(A=>A.trim()).filter(A=>A.length>0).map(A=>{let E=A.split(": "),S=E.shift().toLowerCase(),P=E.join(": ");return[S,P]}),i=new mt(n),o=Array.from(i.keys()).map(A=>[A,i.get(A).join(", ")]),s=new Map(o),a=ws(s,"content-type",jt),p=ws(s,"content-length",parseFloat),d=ws(s,"date",A=>new Date(A)),h=ws(s,"content-disposition",A=>{if(v(A)){let E=A.match(sv);if(v(E))return E[1]}return null});return{status:e.status,path:t,content:void 0,contentType:a,contentLength:p,fileName:h,date:d,headers:s}}async readResponse(t,e){let{status:n,contentType:i,contentLength:o,fileName:s,date:a,headers:p}=await this.readResponseHeaders(t,e),d={path:t,status:n,contentType:i,contentLength:o,fileName:s,date:a,headers:p,content:e.response};return v(d.content)&&(d.contentType=d.contentType||d.content.type,d.contentLength=d.contentLength||d.content.size),d}async decodeContent(t,e){return De(e,async n=>{if(t==="")return null;if(B(e.contentType)){let i=Array.from(e.headers.entries()).map(o=>o.join(": ")).join(`
  `);throw new Error(`No content type found in headers: 
  `+i)}else{if(t==="blob")return n;if(t==="arraybuffer")return await n.arrayBuffer();if(t==="json"){let i=await n.text();return i.length>0?JSON.parse(i):null}else if(t==="document"){let i=new DOMParser;if(e.contentType==="application/xhtml+xml"||e.contentType==="text/html"||e.contentType==="application/xml"||e.contentType==="image/svg+xml"||e.contentType==="text/xml")return i.parseFromString(await n.text(),e.contentType);throw new Error("Couldn't parse document")}else{if(t==="text")return await n.text();de(t)}}})}async withCachedTask(t,e){return t.method!=="GET"&&t.method!=="HEAD"&&t.method!=="OPTIONS"?await e():(this.tasks.has(t.method,t.path)||this.tasks.add(t.method,t.path,e().finally(()=>this.tasks.delete(t.method,t.path))),this.tasks.get(t.method,t.path))}sendNothingGetNothing(t){return this.withCachedTask(t,async()=>{let e=new XMLHttpRequest,n=ys(`requesting: ${t.path}`,e,e,null,!0);return pp(e,t.method,t.path,t.timeout,t.headers),await n,await this.readResponseHeaders(t.path,e)})}sendNothingGetSomething(t,e,n){return this.withCachedTask(e,async()=>{let i=null,o=e.useCache&&e.method==="GET";o&&(v(n)&&n.start(),await this.cacheReady,i=await this.store.get(e.path));let s=B(i);if(s){let p=new XMLHttpRequest,d=ys(`requesting: ${e.path}`,p,p,n,!0);pp(p,e.method,e.path,e.timeout,e.headers),await d,i=await this.readResponse(e.path,p),o&&await this.store.add(i)}let a=await this.decodeContent(t,i);return s&&v(n)&&n.end(),a})}async sendSomethingGetSomething(t,e,n,i){let o=null,s=fd(new Map,n,e.headers);if(e.body instanceof FormData&&v(s)){let E=new Array;for(let S of s.keys())S.toLowerCase()==="content-type"&&E.push(S);for(let S of E)s.delete(S)}ov(e.body)&&!Q(e.body)?o=e.body:v(e.body)&&(o=JSON.stringify(e.body));let a=Bd(i,2),p=new XMLHttpRequest,d=v(o)?ys("uploading",p,p.upload,a.shift(),!1):Promise.resolve(),h=a.shift(),x=ys("saving",p,p,h,!0,d);pp(p,e.method,e.path,e.timeout,s,o),await d,await x;let A=await this.readResponse(e.path,p);return await this.decodeContent(t,A)}};var Ms=class extends bs{constructor(e,n){super(e,Es);this.fetcher=n}getFetcher(e){return e instanceof FormData?this.fetcher:this.nextWorker()}setRequestVerificationToken(e){this.fetcher.setRequestVerificationToken(e);for(let n of this.workers)n.setRequestVerificationToken(e)}async clearCache(){await Promise.all(this.workers.map(e=>e.clearCache()))}sendNothingGetNothing(e){return this.nextWorker().sendNothingGetNothing(e)}sendNothingGetBlob(e,n){return this.nextWorker().sendNothingGetBlob(e,n)}sendNothingGetBuffer(e,n){return this.nextWorker().sendNothingGetBuffer(e,n)}sendNothingGetFile(e,n){return this.nextWorker().sendNothingGetFile(e,n)}sendNothingGetText(e,n){return this.nextWorker().sendNothingGetText(e,n)}sendNothingGetObject(e,n){return this.nextWorker().sendNothingGetObject(e,n)}sendNothingGetXml(e,n){return this.nextWorker().sendNothingGetXml(e,n)}sendNothingGetImageBitmap(e,n){return this.nextWorker().sendNothingGetImageBitmap(e,n)}drawImageToCanvas(e,n,i){return this.nextWorker().drawImageToCanvas(e,n,i)}sendObjectGetBlob(e,n){return this.getFetcher(e.body).sendObjectGetBlob(e,n)}sendObjectGetBuffer(e,n){return this.getFetcher(e.body).sendObjectGetBuffer(e,n)}sendObjectGetFile(e,n){return this.getFetcher(e.body).sendObjectGetFile(e,n)}sendObjectGetText(e,n){return this.getFetcher(e.body).sendObjectGetText(e,n)}sendObjectGetNothing(e,n){return this.getFetcher(e.body).sendObjectGetNothing(e,n)}sendObjectGetObject(e,n){return this.getFetcher(e.body).sendObjectGetObject(e,n)}sendObjectGetXml(e,n){return this.getFetcher(e.body).sendObjectGetXml(e,n)}sendObjectGetImageBitmap(e,n){return this.getFetcher(e.body).sendObjectGetImageBitmap(e,n)}};function Ss(r){let t=r.attributes.position,e=r.attributes.normal,n=r.attributes.uv;for(let i=0;i<e.count;++i){let o=i*e.itemSize,s=i*e.itemSize+1,a=i*e.itemSize+2,p=e.array[o],d=e.array[s],h=e.array[a],x=Math.abs(p),A=Math.abs(d),E=Math.abs(h),S=t.array[o],P=t.array[s],R=t.array[a],I=Math.abs(S),O=Math.abs(P),L=Math.abs(R),k=i*n.itemSize,H=i*n.itemSize+1,V=n.array[k],D=n.array[H],te=0,K=x,z=I;A>K&&(te=1,K=A,z=O),E>K&&(te=2,K=E,z=L),te===0?S<0?(V=-R,D=P):(V=R,D=P):te===1?P<0?(V=S,D=-R):(V=S,D=R):R<0?(V=S,D=P):(V=-S,D=P),V=(V/z+1)/8,D=(D/z+1)/6,te===0?S<0?(V+=0,D+=1/3):(V+=.5,D+=1/3):te===1?P<0?(V+=.25,D+=0):(V+=.25,D+=2/3):R<0?(V+=.25,D+=1/3):(V+=.75,D+=1/3);let J=n.array;J[k]=V,J[H]=D}}var ao=new THREE.BoxBufferGeometry(1,1,1,1,1,1);ao.name="CubeGeom";var cp=ao.clone();cp.name="InvertedCubeGeom";Ss(cp);var wt=class extends THREE.Mesh{constructor(t,e,n,i){super(ao,i),this.scale.set(t,e,n)}},Yu=class extends THREE.Mesh{constructor(t,e,n,i){super(cp,i),this.scale.set(t,e,n)}};THREE.UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new THREE.Vector2(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};THREE.ShaderLib.line={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var $t=class extends THREE.ShaderMaterial{constructor(t){super({type:"LineMaterial",uniforms:THREE.UniformsUtils.clone(THREE.ShaderLib.line.uniforms),vertexShader:THREE.ShaderLib.line.vertexShader,fragmentShader:THREE.ShaderLib.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(t)}};$t.prototype.isLineMaterial=!0;function yn(r){return v(r)&&r.isMesh}function dp(r){return v(r)&&r.isMaterial}function lv(r,t){return dp(t)&&t.type===r}function Ju(r){return lv("MeshBasicMaterial",r)}function $u(r){return v(r)&&r.isObject3D}function Zu(r){return v(r)&&r.isQuaternion}function em(r){return v(r)&&r.isEuler}var up=bt("Juniper:Three:Materials",()=>new Map);function pv(r,t){t in r&&delete r[t]}function Rs(r,t,e){let n=`${r}_${Object.keys(e).map(i=>`${i}:${e[i]}`).join(",")}`;return up.has(n)||(pv(e,"name"),up.set(n,new t(e))),up.get(n)}function cv(r){return Object.assign(r,{transparent:!0})}function lo(r){return Rs("solid",THREE.MeshBasicMaterial,r)}function Jr(r){return Rs("solidTransparent",THREE.MeshBasicMaterial,cv(r))}function Ps(r){return Rs("lit",THREE.MeshPhongMaterial,r)}function tm(r){return Rs("line2",$t,r)}function nm(r,t){let e=new Set;r.traverse(n=>{if(yn(n)&&dp(n.material)){let i=n.material,o=t(i);i!==o&&(e.add(i),n.material=o)}});for(let n of e)n.dispose()}function rm(r){if(r.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let t={alphaMap:r.alphaMap,alphaTest:r.alphaTest,alphaToCoverage:r.alphaToCoverage,aoMap:r.aoMap,aoMapIntensity:r.aoMapIntensity,blendDst:r.blendDst,blendDstAlpha:r.blendDstAlpha,blendEquation:r.blendEquation,blendEquationAlpha:r.blendEquationAlpha,blending:r.blending,blendSrc:r.blendSrc,blendSrcAlpha:r.blendSrcAlpha,clipIntersection:r.clipIntersection,clippingPlanes:r.clippingPlanes,clipShadows:r.clipShadows,color:r.color,colorWrite:r.colorWrite,depthFunc:r.depthFunc,depthTest:r.depthTest,depthWrite:r.depthWrite,dithering:r.dithering,envMap:r.envMap,fog:r.fog,lightMap:r.lightMap,lightMapIntensity:r.lightMapIntensity,map:r.emissiveMap||r.map,name:r.name+"-Standard-To-Basic",opacity:r.opacity,polygonOffset:r.polygonOffset,polygonOffsetFactor:r.polygonOffsetFactor,polygonOffsetUnits:r.polygonOffsetUnits,precision:r.precision,premultipliedAlpha:r.premultipliedAlpha,shadowSide:r.shadowSide,side:r.side,stencilFail:r.stencilFail,stencilFunc:r.stencilFunc,stencilFuncMask:r.stencilFuncMask,stencilRef:r.stencilRef,stencilWrite:r.stencilWrite,stencilWriteMask:r.stencilWriteMask,stencilZFail:r.stencilZFail,stencilZPass:r.stencilZPass,toneMapped:r.toneMapped,transparent:r.transparent,userData:r.userData,vertexColors:r.vertexColors,visible:r.visible,wireframe:r.wireframe,wireframeLinecap:r.wireframeLinecap,wireframeLinejoin:r.wireframeLinejoin,wireframeLinewidth:r.wireframeLinewidth};for(let[e,n]of Object.entries(t))B(n)&&delete t[e];return new THREE.MeshBasicMaterial(t)}var dv=255,uv=65280;var mv=16711680;var hv=12632256,mp=16777215;var hp=lo({color:dv}),fp=lo({color:uv});var xp=lo({color:mv});var im=Ps({color:hv}),om=Ps({color:mp});function sm(r){return v(r)&&$u(r.object)}function Qe(r){return sm(r)?r.object:r}function Me(r,t){return r=Qe(r),r.visible=t,t}function wn(r){return r=Qe(r),r.visible}function Cs(r){for(r=Qe(r);r;){if(!r.visible)return!1;r=r.parent}return!0}function U(r,...t){let e=t.filter(v).map(Qe);return e.length>0&&Qe(r).add(...e),r}function se(r,...t){let e=new THREE.Object3D;return e.name=r,U(e,...t),e}function Is(r,t){r=Qe(r),Mu(r)&&(r.disabled=!t)}function lr(r,t,e){let n=new THREE.Mesh(t,e);return n.name=r,n}var gp="Juniper:ThreeJS:EventSystem:RayTarget",Zt=class extends q{constructor(e){super();this.object=e;this.meshes=new Array;this._disabled=!1;this._clickable=!1;this._draggable=!1;this._navigable=!1;this.object.userData[gp]=this}addMesh(e){return e.userData[gp]=this,this.meshes.push(e),this}get disabled(){return this._disabled}set disabled(e){this._disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get clickable(){return this._clickable}set clickable(e){this._clickable=e}get draggable(){return this._draggable}set draggable(e){this._draggable=e}get navigable(){return this._navigable}set navigable(e){this._navigable=e}};function fv(r){return r instanceof Zt}function $r(r){let t=null;return r&&(fv(r)?t=r:(r=Qe(r),r&&(t=r.userData[gp])),t&&!Cs(t)&&(t=null)),t}var vp=new THREE.SphereBufferGeometry(.5);vp.name="SphereGeom";var Ap=vp.clone();Ap.name="InvertedSphereGeom";Ss(Ap);var Vs=class extends THREE.Mesh{constructor(t,e){super(vp,e),this.scale.setScalar(.5*t)}},am=class extends THREE.Mesh{constructor(t,e){super(Ap,e),this.scale.setScalar(.5*t)}};var _p=class extends j{constructor(){super("dragdir");this.delta=new THREE.Vector3}},bp=class extends Zt{constructor(e,n,i,o,s){let a=new wt(1,1,1,s),p=new Vs(1,s);super(se("Translator "+e,a,p));this._size=1;this.bar=a,this.pad=p,this.sel=new THREE.Vector3(n,i,o);let d=new THREE.Vector3,h=new THREE.Vector3,x=new _p,A=!1;this.addMesh(a),this.addMesh(p),this.enabled=!0,this.draggable=!0,this.addEventListener("down",E=>{E.pointer.isPressed(0)&&(A=!0,d.copy(E.point))}),this.addEventListener("move",E=>{A&&E.point&&(h.copy(E.point).sub(d),d.copy(E.point),h.manhattanLength()>0&&(x.delta.copy(this.sel).applyQuaternion(this.object.parent.parent.quaternion).multiplyScalar(h.dot(x.delta)),this.dispatchEvent(x)))}),this.addEventListener("up",E=>{E.pointer.isPressed(0)||(A=!1)}),this.size=1}get size(){return this._size}set size(e){this._size=e,this.pad.scale.setScalar(e/3),this.pad.position.copy(this.sel).multiplyScalar(.5).add(this.sel).multiplyScalar(this.size),this.bar.scale.copy(this.sel).multiplyScalar(.9).add(bp.small).multiplyScalar(this.size),this.bar.position.copy(this.sel).multiplyScalar(this.size)}},po=bp;po.small=new THREE.Vector3(.1,.1,.1);var lm=new THREE.Vector3,Ep=class extends j{constructor(){super("moving")}},yp=class extends j{constructor(){super("moved")}},ks=class extends q{constructor(e,n){super();this._size=1;this.movingEvt=new Ep;this.movedEvt=new yp;this.object=se("Translator",...this.translators=[this.setTranslator("+X",1,0,0,xp,n),this.setTranslator("-X",-1,0,0,xp,n),this.setTranslator("+Y",0,1,0,fp,n),this.setTranslator("-Y",0,-1,0,fp,n),this.setTranslator("+Z",0,0,1,hp,n),this.setTranslator("-Z",0,0,-1,hp,n)]),this.orbit=e}get orbit(){return!this.translators[4].object.visible}set orbit(e){e!==this.orbit&&(this.translators[4].object.visible=this.translators[5].object.visible=!e)}get size(){return this._size}set size(e){this._size=e;for(let n of this.translators)n.size=this.size*.5}setTranslator(e,n,i,o,s,a){let p=new po(e,n,i,o,s);return p.size=this.size*.5,p.addEventListener("dragdir",d=>{this.object.parent.position.y-=a;let h=this.object.parent.position.length();this.object.parent.position.add(d.delta),this.orbit&&(this.object.parent.position.normalize().multiplyScalar(h),this.object.parent.parent.getWorldPosition(lm),this.object.parent.lookAt(lm)),this.object.parent.position.y+=a,this.dispatchEvent(this.movingEvt)}),p.addEventListener("up",()=>this.dispatchEvent(this.movedEvt)),p}get visible(){return wn(this)}set visible(e){Me(this,e)}};var Os=["change","click","contextmenu","dblclick","mouseup","pointerup","reset","submit","touchend"];function pm(r,t){let e=t||hn,n=async i=>{if(i.isTrusted&&await e()){for(let o of Os)window.removeEventListener(o,n);await r()}};for(let i of Os)window.addEventListener(i,n)}function cm(r,t){let e=t||hn;return new Promise(n=>{let i=async o=>{if(o.isTrusted&&await e()){for(let s of Os)window.removeEventListener(s,i);n(await r())}};for(let o of Os)window.addEventListener(o,i)})}var xv="AudioContext"in globalThis,dm=xv&&"AudioListener"in globalThis,um=dm&&"setPosition"in AudioListener.prototype,co=dm&&"positionX"in AudioListener.prototype,AM=pe(HTMLMediaElement.prototype.captureStream)||pe(HTMLMediaElement.prototype.mozCaptureStream);function mm(r){return v(r)&&r.node instanceof AudioNode}function hm(r){return v(r)&&r.input instanceof AudioNode&&r.output instanceof AudioNode}var Tn=bt("Juniper:Audio:connections",()=>new Map),wp=bt("Juniper:Audio:names",()=>new Map);function fm(r){return hm(r)?r.output:mm(r)?r.node:r}function xm(r){if(B(r))return;let t=null;ke(r)?r.length===2?t=r[1]:t=r[2]:t=r;let e=null;return hm(t)?e=t.input:mm(t)?e=t.node:e=t,e}function gm(r){return ke(r)?r.length===2?[r[0]]:[r[0],r[1]]:[]}function gv(r){return v(r)&&v(r.context)}function vm(r,t){wp.set(t,r)}function ie(r){wp.delete(r),gv(r)&&It(r)}function Am(...r){for(let t=1;t<r.length;++t)Tt(r[t-1],r[t])}function Tt(r,t){let e=fm(r),n=xm(t),i=gm(t);if(B(n))throw new Error("Must have a target to connect to");n instanceof AudioParam?e.connect(n,i[0]):n instanceof AudioNode?e.connect(n,i[0],i[1]):de(n),Tn.has(e)||Tn.set(e,new Set);let o=Tn.get(e);return o.has(n)?!1:(o.add(n),!0)}function It(r,t){let e=fm(r),n=xm(t),i=gm(t);if(B(n)?e.disconnect():n instanceof AudioParam?e.disconnect(n,i[0]):n instanceof AudioNode?e.disconnect(n,i[0],i[1]):de(n),!Tn.has(e))return!1;let o=Tn.get(e),s=!1;return B(n)?(s=o.size>0,o.clear()):o.has(n)&&(s=!0,o.delete(n)),o.size===0&&Tn.delete(e),s}function vv(){let r=new Map;function t(e){r.has(e)||r.set(e,new Qo(e))}for(let e of wp.keys())t(e);for(let[e,n]of Tn){t(e);for(let i of n)t(i)}for(let[e,n]of Tn){let i=r.get(e);for(let o of n)r.has(o)&&i.connectTo(r.get(o))}return Array.from(r.values())}globalThis.getAudioGraph=vv;async function Vt(r){if(vm("speakers",r.destination),r.state!=="running")if(r.state==="closed")await r.resume();else if(r.state==="suspended"){let t=ue(r,"statechange");pm(()=>r.resume()),await t}else de(r.state)}function en(r,t,...e){vm(r,t);for(let n of e)v(n)&&Tt(t,n);return t}function _m(r,t,e,...n){return en(r,new AnalyserNode(t,e),...n)}function Zr(r,t,e,...n){return en(r,new BiquadFilterNode(t,e),...n)}function bm(r,t,e,...n){return en(r,new DelayNode(t,e),...n)}function Em(r,t,e,...n){return en(r,new DynamicsCompressorNode(t,e),...n)}function Ne(r,t,e,...n){return en(r,new GainNode(t,e),...n)}function pr(r,t,e,...n){return en(r,t.createMediaElementSource(e),...n)}function Tp(r,t,e,...n){return en(r,new MediaStreamAudioDestinationNode(t,e),...n)}function ym(r,t,e,...n){return en(r,t.createMediaStreamSource(e),...n)}function wm(r,t,e,...n){return en(r,new PannerNode(t,e),...n)}var Ds=class{constructor(){this.t=0;this.p=Ze.create();this.f=Ze.set(Ze.create(),0,0,-1);this.u=Ze.set(Ze.create(),0,1,0);Object.seal(this)}set(t,e,n,i,o,s,a,p,d){this.setPosition(t,e,n),this.setOrientation(i,o,s,a,p,d)}setPosition(t,e,n){Ze.set(this.p,t,e,n)}setOrientation(t,e,n,i,o,s){Ze.set(this.f,t,e,n),Ze.set(this.u,i,o,s)}copy(t){Ze.copy(this.p,t.p),Ze.copy(this.f,t.f),Ze.copy(this.u,t.u)}};var ei=class extends q{constructor(e,n,i){super();this.id=e;this.audioCtx=n;this.spatializer=i;this.pose=new Ds;this.disposed=!1;this.volumeControl=Ne(`volume-control-${this.id}`,n)}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){ie(this.volumeControl),Fr(this.spatializer)&&this.spatializer.dispose()}audioTick(e){this.spatializer.setPose(this.pose,e)}};var ti=class{constructor(t){this.id=t;this.minDistance=1;this.maxDistance=10;this.algorithm="inverse"}setAudioProperties(t,e,n){this.minDistance=t,this.maxDistance=e,this.algorithm=n}};var ni=class extends ti{constructor(){super(...arguments);this.disposed=!1}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){ie(this.input)}};var Mp=bt("Juniper:Audio:Destinations:Spatializers:NoSpatializationNode:nodes",()=>new WeakMap),We=class extends ni{static instance(t){if(!Mp.has(t)){let e=`no-spatialization-hook-${Et(8)}`;Mp.set(t,new We(e,t))}return Mp.get(t)}constructor(t,e){super(t),this.input=this.output=Ne(this.id,e),Object.seal(this)}setPose(t,e){}};var Bs=class extends ei{constructor(e,n,i){super("final",e,i);this._trueDestination=n;this._remoteUserInput=Ne("remote-user-input",this.audioCtx,null,this._spatializedInput=Ne("spatialized-input",this.audioCtx,null,this.volumeControl)),this._nonSpatializedInput=Ne("non-spatialized-input",this.audioCtx,null,this.volumeControl),Tt(this.volumeControl,this._trueDestination),Tt(We.instance(this.audioCtx),this.nonSpatializedInput)}onDisposing(){ie(this._remoteUserInput),ie(this._spatializedInput),ie(this._nonSpatializedInput),super.onDisposing()}get remoteUserInput(){return this._remoteUserInput}get spatializedInput(){return this._spatializedInput}get nonSpatializedInput(){return this._nonSpatializedInput}get trueDestination(){return this._trueDestination}};var ri=class extends ti{constructor(e){super("listener");this.audioCtx=e}get listener(){return this.audioCtx.listener}};var Fs=class extends ri{constructor(t){if(super(t),!co)throw new Error("Latest WebAudio Listener API is not supported");Object.seal(this)}setPose(t,e){let{p:n,f:i,u:o}=t;this.listener.positionX.setValueAtTime(n[0],e),this.listener.positionY.setValueAtTime(n[1],e),this.listener.positionZ.setValueAtTime(n[2],e),this.listener.forwardX.setValueAtTime(i[0],e),this.listener.forwardY.setValueAtTime(i[1],e),this.listener.forwardZ.setValueAtTime(i[2],e),this.listener.upX.setValueAtTime(o[0],e),this.listener.upY.setValueAtTime(o[1],e),this.listener.upZ.setValueAtTime(o[2],e)}};var Hs=class extends ri{constructor(t){if(super(t),!um)throw new Error("WebAudio Listener API is not supported");Object.seal(this)}setPose(t,e){let{p:n,f:i,u:o}=t;this.listener.setPosition(n[0],n[1],n[2]),this.listener.setOrientation(i[0],i[1],i[2],o[0],o[1],o[2])}};function*Av(r,t,e=-1){let n=0;for(;e<0||n<e;){yield r,++n;let i=r+t;r=t,t=i}}function Tm(r,t,e){return new Rp(r,t,3,e)}var Sp=class{constructor(t,e,n,i,o){this.input=Ne(`${t}-input`,e,{gain:n},this.output=bm(`${t}-delay`,e,{maxDelayTime:i,delayTime:i},o))}dispose(){ie(this.input),ie(this.output)}},Rp=class{constructor(t,e,n,i){this.output=Ne(`${t}-output`,e,null,i);let o=Array.from(Av(1,2,n));this.layers=o.map(s=>new Sp(`${t}-echo-layer-${s}`,e,.5/s,s,this.output)),this.input=Ne(`${t}-input`,e,null,...this.layers)}dispose(){ie(this.input);for(let t of this.layers)t.dispose();ie(this.output),le(this.layers)}};function Mm(r,t,e){return new Pp(r,t,e)}var Pp=class{constructor(t,e,n){this.node=Zr(`${t}-biquad-filter`,e,{type:"bandpass",frequency:2500,Q:4.5},n)}dispose(){ie(this.node)}};function Sm(r,t,e){return new Cp(r,t,e)}var Cp=class{constructor(t,e,n){this.node=Zr(`${t}-biquad-filter`,e,{type:"bandpass",frequency:400,Q:4.5},n)}dispose(){ie(this.node)}};var Rm=new Map([["Radio",Mm],["Wall",Sm],["Echo",Tm]]);var Ip=class extends j{constructor(e){super("sourceadded");this.source=e}},Lt=class extends ei{constructor(e,n,i,...o){super(e,n,i);this.source=null;this.effects=new Array;this._connected=!1;this.setEffects(...o)}onDisposing(){for(let e of this.effects)Fr(e)&&e.dispose();le(this.effects),super.onDisposing()}setEffects(...e){It(this.volumeControl);for(let n of this.effects)Fr(n)&&n.dispose();le(this.effects);for(let n of e)if(v(n)){let i=Rm.get(n);v(i)&&this.effects.push(i(`${n}-${this.id}`,this.audioCtx))}Am(this.volumeControl,...this.effects,this.spatializer)}get spatialized(){return!(this.spatializer instanceof We)}get input(){return this.source}get connected(){return this._connected}connect(){this.connected||Tt(this.source,this.volumeControl)}disconnect(){this.connected&&It(this.source,this.volumeControl)}set input(e){e!==this.input&&(this.source&&ie(this.source),e&&(this.source=e,this.connect(),this.dispatchEvent(new Ip(this.source))))}get output(){return this.volumeControl}};var kt=class extends j{constructor(e,n){super(e);this.source=n}},Mn=class extends kt{constructor(t){super("loaded",t)}},Ns=class extends kt{constructor(e,n){super("errored",e);this.error=n}},Sn=class extends kt{constructor(t){super("played",t)}},Rn=class extends kt{constructor(t){super("paused",t)}},Pn=class extends kt{constructor(t){super("stopped",t)}},Cn=class extends kt{constructor(e){super("progress",e);this.value=0;this.total=0}};var Xs=new WeakMap,zs=new WeakMap;function Pm(r,t){let e=(zs.get(r)||0)+t;zs.set(r,e);let n=r.mediaElement,i=(Xs.get(n)||0)+t;return Xs.set(n,i),i}function _v(r){Pm(r,1)}function bv(r){Pm(r,-1),zs.get(r)===0&&(zs.delete(r),ie(r)),Xs.get(r.mediaElement)===0&&(Xs.delete(r.mediaElement),r.mediaElement.isConnected&&r.mediaElement.remove())}var js=class extends Lt{constructor(e,n,i,o,s,...a){super(e,n,s,...a);this.randomize=o;_v(this.input=i),this.audio=i.mediaElement,this.disconnect(),this.loadEvt=new Mn(this),this.playEvt=new Sn(this),this.pauseEvt=new Rn(this),this.stopEvt=new Pn(this),this.progEvt=new Cn(this);let p=d=>{this.disconnect(),this.audio.currentTime===0||d.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};this.audio.addEventListener("ended",p),this.audio.addEventListener("pause",p),this.audio.addEventListener("play",()=>{if(this.connect(),this.randomize&&this.audio.loop&&this.audio.duration>1){let d=this.audio.duration*Math.random();this.audio.currentTime=d}this.dispatchEvent(this.playEvt)}),this.audio.addEventListener("timeupdate",()=>{this.progEvt.value=this.audio.currentTime,this.progEvt.total=this.audio.duration,this.dispatchEvent(this.progEvt)}),ms(this.audio).then(d=>this.dispatchEvent(d?this.loadEvt:new Ns(this,this.audio.error)))}get playbackState(){return this.audio.error?"errored":this.audio.ended||this.audio.paused&&this.audio.currentTime===0?"stopped":this.audio.paused?"paused":"playing"}async play(){await Vt(this.audioCtx),await this.audio.play()}async playThrough(){let e=ue(this,"stopped");await this.play(),await e}pause(){this.audio.pause()}stop(){this.audio.currentTime=0,this.pause()}restart(){return this.stop(),this.play()}onDisposing(){this.disconnect(),bv(this.input),super.onDisposing()}};var Us=class extends Lt{constructor(t,e,n,...i){super(t,e,n,...i)}};var ii=class extends ni{constructor(e,n){super(e);this.lpx=0;this.lpy=0;this.lpz=0;this.lox=0;this.loy=0;this.loz=0;this.input=this.output=this.panner=wm(this.id,n,{panningModel:"HRTF",distanceModel:"inverse",coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:0})}setAudioProperties(e,n,i){super.setAudioProperties(e,n,i),this.panner.refDistance=this.minDistance,this.panner.distanceModel=i,this.maxDistance<=0?this.panner.rolloffFactor=1/0:this.panner.rolloffFactor=1/this.maxDistance}setPose(e,n){let{p:i,f:o}=e,[s,a,p]=i,[d,h,x]=o;(s!==this.lpx||a!==this.lpy||p!==this.lpz)&&(this.lpx=s,this.lpy=a,this.lpz=p,this.setPosition(s,a,p,n)),(d!==this.lox||h!==this.loy||x!==this.loz)&&(this.lox=d,this.loy=h,this.loz=x,this.setOrientation(d,h,x,n))}};var Gs=class extends ii{constructor(t,e){super(t,e),Object.seal(this)}setPosition(t,e,n,i){Ue(t)&&Ue(e)&&Ue(n)&&Ue(i)&&(this.panner.positionX.setValueAtTime(t,i),this.panner.positionY.setValueAtTime(e,i),this.panner.positionZ.setValueAtTime(n,i))}setOrientation(t,e,n,i){Ue(t)&&Ue(e)&&Ue(n)&&Ue(i)&&(this.panner.orientationX.setValueAtTime(-t,i),this.panner.orientationY.setValueAtTime(-e,i),this.panner.orientationZ.setValueAtTime(-n,i))}};var Ws=class extends ii{constructor(t,e){super(t,e),Object.seal(this)}setPosition(t,e,n,i){this.panner.setPosition(t,e,n)}setOrientation(t,e,n,i){this.panner.setOrientation(t,e,n)}};function Cm(r){let t=[];for(let e=0;e<r.length;++e){let n=r[e],i=!1;for(let o=0;o<t.length&&!i;++o){let s=t[o];i=n.kind===s.kind&&s.label.indexOf(n.label)>0}i||t.push(n)}return t}var Ot=pe(HTMLAudioElement.prototype.setSinkId),Vp=class extends j{constructor(e){super("audiooutputchanged");this.device=e}},Im="calla:preferredAudioOutputID",qs=class extends q{constructor(e){super();this.element=e;this._hasAudioPermission=!1;this.ready=this.start(),Object.seal(this)}get hasAudioPermission(){return this._hasAudioPermission}async start(){if(Ot){let e=await navigator.mediaDevices.enumerateDevices(),n=ut(e,i=>i.kind==="audiooutput"&&i.label.length>0);if(v(n)){this._hasAudioPermission=!0;let i=await this.getPreferredAudioOutput();i&&await this.setAudioOutputDevice(i)}}}get preferredAudioOutputID(){return Ot?localStorage.getItem(Im):null}async getAudioOutputDevices(e=!1){return Ot?await this.getAvailableDevices(e)||[]:[]}async getAudioOutputDevice(){if(!Ot)return null;let e=this.element&&this.element.sinkId;if(B(e))return null;let n=await this.getAudioOutputDevices();return ut(n,o=>o.deviceId===e)}async getPreferredAudioOutput(){if(!Ot)return null;let e=await this.getAudioOutputDevices();return ut(e,i=>i.deviceId===this.preferredAudioOutputID,i=>i.deviceId==="default",i=>i.deviceId.length>0)}async setAudioOutputDevice(e){if(Ot){if(v(e)&&e.kind!=="audiooutput")throw new Error(`Device is not an audio output device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(Im,e&&e.deviceId||null);let n=this.element,i=n&&n.sinkId;this.preferredAudioOutputID!==i&&(v(this.preferredAudioOutputID)&&await this.element.setSinkId(this.preferredAudioOutputID),this.dispatchEvent(new Vp(e)))}}async getAvailableDevices(e=!1){let n=null,i=null;for(let o=0;o<3;++o){n=await navigator.mediaDevices.enumerateDevices();for(let s of n)s.deviceId.length>0&&(this.hasAudioPermission||(this._hasAudioPermission=s.kind==="audioinput"&&s.label.length>0));if(this.hasAudioPermission)break;try{i=await this.startStream()}catch(s){console.warn(s)}}if(i)for(let o of i.getTracks())o.stop();return n=hd(n||[],o=>o.label),e&&(n=Cm(n)),Ot?n.filter(o=>o.kind==="audiooutput"):[]}startStream(){return navigator.mediaDevices.getUserMedia({audio:!0})}};!("AudioContext"in globalThis)&&"webkitAudioContext"in globalThis&&(globalThis.AudioContext=globalThis.webkitAudioContext);!("OfflineAudioContext"in globalThis)&&"webkitOfflineAudioContext"in globalThis&&(globalThis.OfflineAudioContext=globalThis.webkitOfflineAudioContext);var Vm="juniper::useHeadphones",Ev=new j("useheadphonestoggled"),yv="createMediaStreamSource"in AudioContext.prototype,Lm=!yv,Qs=class extends q{constructor(e){super();this.users=new Map;this.clips=new Map;this.clipPaths=new Map;this.pathSources=new Map;this.pathCounts=new Map;this._minDistance=1;this._maxDistance=10;this._useHeadphones=!1;this._algorithm="inverse";this.element=null;this.audioDestination=null;this.localUserID=null;this.counter=0;this.audioCtx=new AudioContext;let n=Tp("final-destination",this.audioCtx);this.element=ir(Yn("Audio-Device-Manager"),Kt(!0),Qt(!0),ql(n.stream),st(Ge("none"))),fe(document.body,this),this.speakers=new qs(this.element),this.input=Ne("local-mic-user-gain",this.audioCtx,null,this.localAutoControlledGain=Ne("local-mic-auto-gain",this.audioCtx,null,this.localFilter=Zr("local-mic-filter",this.audioCtx,{type:"bandpass",frequency:1500,Q:.25},this.localCompressor=Em("local-mic-compressor",this.audioCtx,{threshold:-15,knee:40,ratio:17},this.output=Tp("local-mic-destination",this.audioCtx))))),this.audioDestination=new Bs(this.audioCtx,n,co?new Fs(this.audioCtx):new Hs(this.audioCtx)),We.instance(this.audioCtx).setAudioProperties(this._minDistance,this._maxDistance,this.algorithm),this.setLocalUserID(e);let i=localStorage.getItem(Vm);v(i)?this._useHeadphones=i==="true":this._useHeadphones=Ut(),this.ready=this.start(),Object.seal(this)}get algorithm(){return this._algorithm}get useHeadphones(){return this._useHeadphones}set useHeadphones(e){e!==this.useHeadphones&&(this._useHeadphones=e,localStorage.setItem(Vm,this.useHeadphones.toString()),this.dispatchEvent(Ev))}dispose(){for(let e of this.users.keys())this.removeUser(e);for(let e of this.clips.keys())this.removeClip(e);It(this.input),It(this.localAutoControlledGain),It(this.localFilter),It(this.localCompressor),It(this.output),this.audioDestination.dispose(),this.audioCtx.suspend()}async start(){await Promise.all([Vt(this.audioCtx),cm(()=>this.element.play()),this.speakers.ready])}get filter(){return this.localFilter}get filterFrequency(){return this.localFilter.frequency.value}set filterFrequency(e){this.localFilter.frequency.value=e}get compressor(){return this.localCompressor}get currentTime(){return this.audioCtx.currentTime}update(){let e=this.currentTime;this.audioDestination.audioTick(e);for(let n of this.clips.values())n.audioTick(e);for(let n of this.users.values())n.audioTick(e)}newSpatializer(e,n,i){if(n){let o=i?this.audioDestination.remoteUserInput:this.audioDestination.spatializedInput,s=`spatializer-${++this.counter}-${e}`,a=co?new Gs(s+"-new-wa",this.audioCtx):new Ws(e+"-old-wa",this.audioCtx);return Tt(a,o),a}else return We.instance(this.audioCtx)}createSpatializer(e,n,i){let o=this.newSpatializer(e,n,i);return o.setAudioProperties(this._minDistance,this._maxDistance,this._algorithm),o}createUser(e,n){if(!this.users.has(e)){let i=qn(n,e),o=this.createSpatializer(i,!0,!0),s=new Us(i,this.audioCtx,o);this.users.set(e,s)}return this.users.get(e)}setLocalUserID(e){return this.audioDestination&&(this.localUserID=e),this.audioDestination}loadBasicClip(e,n,i,o){return this.loadClip(e,n,!1,!1,!1,!1,i,[],o)}createBasicClip(e,n,i){return this.createClip(e,n,!1,!1,!1,i,[])}async loadClip(e,n,i,o,s,a,p,d,h){if(B(n)||Q(n)&&n.length===0)throw new Error("No clip source path provided");v(h)&&h.start(n);let x=await this.getSourceTask(e,n,n,i,o,h),A=this.makeClip(x,e,n,s,a,o,p,...d);return this.clips.set(e,A),v(h)&&h.end(n),A}createClip(e,n,i,o,s,a,p){if(B(n)||Q(n)&&n.length===0)throw new Error("No clip source path provided");let d=n.currentSrc,h=this.createSourceFromElement(e,n),x=this.makeClip(h,e,d,o,s,i,a,...p);return this.clips.set(e,x),x}getSourceTask(e,n,i,o,s,a){this.clipPaths.set(e,n);let p=this.pathSources.get(n);return v(p)?this.pathCounts.set(n,this.pathCounts.get(n)+1):(p=this.createSourceFromFile(e,i,o,s,a),this.pathSources.set(n,p),this.pathCounts.set(n,1)),p}async createSourceFromFile(e,n,i,o,s){v(s)&&s.start(e);let a=io(o,!1,i,$i(n));if(!await ms(a))throw a.error;return v(s)&&s.end(e),this.createSourceFromElement(e,a)}createSourceFromStream(e,n){let i=io(!0,!Lm,!1,ql(n));return Lm?this.createSourceFromElement(e,i):ym(qn("media-stream-source",e,n.id),this.audioCtx,n)}createSourceFromElement(e,n){return pr(qn("media-element-source",e),this.audioCtx,n)}makeClip(e,n,i,o,s,a,p,...d){let h=qn(n,i),x=this.createSpatializer(h,o,!1),A=new js(qn("audio-clip-element",h),this.audioCtx,e,s,x,...d);return a&&A.play(),A.volume=p,A}hasClip(e){return this.clips.has(e)}async playClip(e){this.hasClip(e)&&await this.clips.get(e).play()}async playClipThrough(e){this.hasClip(e)&&await this.clips.get(e).playThrough()}stopClip(e){this.hasClip(e)&&this.clips.get(e).stop()}getUser(e){return this.users.get(e)}getClip(e){return this.clips.get(e)}removeSource(e,n){let i=e.get(n);return v(i)&&(e.delete(n),i.dispose()),i}removeUser(e){let n=this.removeSource(this.users,e);v(n.input)&&(n.input=null)}removeClip(e){let n=this.clipPaths.get(e);return this.pathCounts.set(n,this.pathCounts.get(n)-1),this.pathCounts.get(n)===0&&(this.pathCounts.delete(n),this.pathSources.delete(n)),this.removeSource(this.clips,e)}setUserStream(e,n,i){if(this.users.has(e)){let o=this.users.get(e);i?o.input=this.createSourceFromStream(qn(n,e),i):v(o.input)&&(o.input=null)}}setAudioProperties(e,n,i){this._minDistance=e,this._maxDistance=n,this._algorithm=i,We.instance(this.audioCtx).setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let o of this.users.values())o.spatializer.setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let o of this.clips.values())o.spatializer.setAudioProperties(o.spatializer.minDistance,o.spatializer.maxDistance,this.algorithm)}withPose(e,n,i){let o=e.get(n),s=null;return o?s=o.pose:n===this.localUserID&&(s=this.audioDestination.pose),s?i(s):null}withUser(e,n){return this.withPose(this.users,e,n)}setUserPose(e,n,i,o,s,a,p,d,h,x){this.withUser(e,A=>{A.set(n,i,o,s,a,p,d,h,x)})}withClip(e,n){return this.withPose(this.clips,e,n)}setClipPosition(e,n,i,o){this.withClip(e,s=>{s.setPosition(n,i,o)})}setClipOrientation(e,n,i,o,s,a,p){this.withClip(e,d=>{d.setOrientation(n,i,o,s,a,p)})}setClipPose(e,n,i,o,s,a,p,d,h,x){this.withClip(e,A=>{A.set(n,i,o,s,a,p,d,h,x)})}};var Lp=class extends kt{constructor(t,e){super(t,e)}},oi=class extends Lp{constructor(t){super("loading",t)}};var Ks=class extends Lt{constructor(e){super("JuniperAudioPlayer",e,We.instance(e));this._data=null;this._loaded=!1;this.sourcesByURL=new Map;this.sources=new Array;this.potatoes=new Array;this.element=ir(Kt(!0),Qt(!1),Jn(!1),An(!0)),this.input=pr("JuniperAudioPlayer-Input",e,this.element),this.loadingEvt=new oi(this),this.loadEvt=new Mn(this),this.playEvt=new Sn(this),this.pauseEvt=new Rn(this),this.stopEvt=new Pn(this),this.progEvt=new Cn(this),this.onPlay=async()=>{this.connect(),this.dispatchEvent(this.playEvt)},this.onPause=n=>{this.disconnect(),this.element.currentTime===0||n.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)},this.onTimeUpdate=async()=>{this.progEvt.value=this.element.currentTime,this.progEvt.total=this.element.duration,this.dispatchEvent(this.progEvt)},this.onError=()=>this.loadAudio(),this.element.addEventListener("play",this.onPlay),this.element.addEventListener("pause",this.onPause),this.element.addEventListener("ended",this.onPause),this.element.addEventListener("error",this.onError),this.element.addEventListener("waiting",this.onWaiting),this.element.addEventListener("canplay",this.onCanPlay),this.element.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{audioPlayer:this})}get data(){return this._data}get loaded(){return this._loaded}get title(){return this.element.title}setTitle(e){this.element.title=e}get hasAudio(){let e=this.sourcesByURL.get(this.element.src);return v(e)&&e.acodec!=="none"||v(this.element.audioTracks)&&this.element.audioTracks.length>0||v(this.element.webkitAudioDecodedByteCount)&&this.element.webkitAudioDecodedByteCount>0||v(this.element.mozHasAudio)&&this.element.mozHasAudio}onDisposing(){super.onDisposing(),this.clear(),ie(this.input),ie(this.audioSource),this.element.removeEventListener("play",this.onPlay),this.element.removeEventListener("pause",this.onPause),this.element.removeEventListener("ended",this.onPause),this.element.removeEventListener("error",this.onError),this.element.removeEventListener("waiting",this.onWaiting),this.element.removeEventListener("canplay",this.onCanPlay),this.element.removeEventListener("timeupdate",this.onTimeUpdate)}clear(){this.stop(),this.sourcesByURL.clear(),le(this.sources),le(this.potatoes),this.element.src="",this._data=null,this._loaded=!1}async load(e,n){this.clear(),this._data=e,Q(e)?(this.setTitle(e),this.potatoes.push(e)):(this.setTitle(e.title),Wn(e.audios,i=>-i.resolution),ud(this.sources,...e.audios));for(let i of this.sources)this.sourcesByURL.set(i.url,i);if(!this.hasSources)throw new Error("No audio sources");if(this.dispatchEvent(this.loadingEvt),await this.loadAudio(n),!this.hasSources)throw new Error("No audio sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}async getMediaCapabilities(e){let n={type:"file",audio:{contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr}};try{return await navigator.mediaCapabilities.decodingInfo(n)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:n}}}get hasSources(){return this.sources.length>0||this.potatoes.length>0}async loadAudio(e){for(v(e)&&e.start(),this.element.removeEventListener("error",this.onError);this.hasSources;){let n=null,i=this.sources.shift();if(v(i)){let o=await this.getMediaCapabilities(i);if(!o.smooth||!o.powerEfficient){this.potatoes.push(i.url);continue}else n=i.url}else n=this.potatoes.shift();if(this.element.src=n,this.element.load(),await hs(this.element)){v(i)?this.sources.unshift(i):this.potatoes.unshift(n),this.element.addEventListener("error",this.onError),v(e)&&e.end();return}}}get playbackState(){return B(this.data)?"empty":this.loaded?this.element.error?"errored":this.element.ended||this.element.paused&&this.element.currentTime===0?"stopped":this.element.paused?"paused":"playing":"loading"}async play(){await Vt(this.audioCtx),await this.element.play()}async playThrough(){let e=ue(this,"stopped");await this.play(),await e}pause(){this.element.pause()}stop(){this.pause(),this.element.currentTime=0}restart(){return this.stop(),this.play()}};var In=class extends q{constructor(e,n,i){super();this._scale=250;this._visible=!0;this.wasVisible=null;this.redrawnEvt=new j("redrawn");this.element=null;v(i)&&v(i.scale)&&(this._scale=i.scale),this._canvas=Kr(e,n),this._g=this.canvas.getContext("2d"),ar(this._canvas)&&(this.element=this._canvas)}fillRect(e,n,i,o,s,a){this.g.fillStyle=e,this.g.fillRect(n+a,i+a,o-2*a,s-2*a)}drawText(e,n,i,o){this.g.textAlign=o,this.g.strokeText(e,n,i),this.g.fillText(e,n,i)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(e){this.scale!==e&&(this._scale=e,this.redraw())}get visible(){return this._visible}set visible(e){this.visible!==e&&(this.wasVisible=this._visible,this._visible=e,this.redraw())}};var Ys=class extends In{constructor(){super(128,128);this._pitch=0;this._heading=0;this.redraw()}get pitch(){return this._pitch}set pitch(e){e!==this.pitch&&(this._pitch=e,this.redraw())}get heading(){return this._heading}set heading(e){e!==this.heading&&(this._heading=e,this.redraw())}setPitchAndHeading(e,n){(e!==this.pitch||n!==this.heading)&&(this._pitch=e,this._heading=n,this.redraw())}onRedraw(){let e=Fe(this.pitch),n=Fe(this.heading-180),i=5,o=this.canvas.width-2*i,s=this.canvas.height-2*i,a=.5*o,p=.5*s,d=Math.sin(e),h=this.g;return h.save(),h.clearRect(0,0,this.canvas.width,this.canvas.height),h.translate(i,i),h.scale(a,p),h.translate(1,1),h.fillStyle="#808080",h.beginPath(),h.arc(0,0,1,0,2*Math.PI),h.fill(),h.fillStyle="#d0d0d0",h.beginPath(),h.arc(0,0,1,0,Math.PI,!0),h.fill(),h.save(),h.scale(1,Math.abs(d)),d<0&&(h.fillStyle="#808080"),h.beginPath(),h.arc(0,0,1,0,Math.PI,d<0),h.fill(),h.restore(),h.save(),h.shadowColor="#404040",h.shadowBlur=4,h.shadowOffsetX=3,h.shadowOffsetY=3,h.rotate(n),h.fillStyle="#ff0000",h.beginPath(),h.moveTo(-.1,0),h.lineTo(0,.667),h.lineTo(.1,0),h.closePath(),h.fill(),h.fillStyle="#ffffff",h.beginPath(),h.moveTo(-.1,0),h.lineTo(0,-.667),h.lineTo(.1,0),h.closePath(),h.fill(),h.restore(),h.beginPath(),h.strokeStyle="#000000",h.lineWidth=.1,h.arc(0,0,1,0,2*Math.PI),h.stroke(),h.restore(),!0}};var wv="The quick brown fox jumps over the lazy dog",km=bt("juniper::loadedFonts",()=>[]);function uo(r){let t=[];return r.fontStyle&&r.fontStyle!=="normal"&&t.push(r.fontStyle),r.fontVariant&&r.fontVariant!=="normal"&&t.push(r.fontVariant),r.fontWeight&&r.fontWeight!=="normal"&&t.push(r.fontWeight),t.push(`${r.fontSize}px`),t.push(r.fontFamily),t.join(" ")}async function Om(r,t=null,e){if(Q(r)||(r=uo(r)),km.indexOf(r)===-1){t=t||wv,e&&e.start(r);let n=await document.fonts.load(r,t);e&&e.end(r),n.length===0?console.warn(`Failed to load font "${r}". If this is a system font, just set the object's \`value\` property, instead of calling \`loadFontAndSetText\`.`):km.push(r)}}function Dm(r){return"getBattery"in r}var Tv=["","N/A","charging"],si=class extends In{constructor(){super(256,128);this.battery=null;this.lastChargeDirection=null;this.lastLevel=null;this.chargeDirection=0;this.level=.5;Dm(navigator)?this.readBattery(navigator):this.redraw()}onRedraw(){this.battery?(this.chargeDirection=this.battery.charging?1:-1,this.level=this.battery.level):(this.level+=.1,this.level>1&&(this.level=0));let e=this.chargeDirection!==this.lastChargeDirection,n=this.level!==this.lastLevel;if(!e&&!n)return!1;this.lastChargeDirection=this.chargeDirection,this.lastLevel=this.level;let i=this.level<.1?"red":"#ccc",o=7,s=.7,a=(1-s)/2,p=this.canvas.width-2*o,d=p-4*o,h=this.canvas.height-4*o,x=p/2,A=this.canvas.height/2,E=Tv[this.chargeDirection+1];return this.g.clearRect(0,0,p,this.canvas.height),this.g.save(),this.g.translate(a*this.canvas.width,a*this.canvas.height),this.g.globalAlpha=.75,this.g.scale(s,s),this.fillRect("#ccc",0,0,p,this.canvas.height,0),this.fillRect("#ccc",p,A-2*o-10,o+10,4*o+20,0),this.g.clearRect(o,o,p-2*o,this.canvas.height-2*o),this.fillRect("black",o,o,p-2*o,this.canvas.height-2*o,0),this.g.clearRect(2*o,2*o,d*this.level,h),this.fillRect(i,2*o,2*o,d*this.level,h,0),this.g.fillStyle="white",this.g.strokeStyle="black",this.g.lineWidth=4,this.g.textBaseline="middle",this.g.font=uo({fontSize:h/2,fontFamily:"Lato"}),this.drawText(E,x,A,"center"),this.g.restore(),!0}async readBattery(e){let n=this.redraw.bind(this);n(),this.battery=await e.getBattery(),this.battery.addEventListener("chargingchange",n),this.battery.addEventListener("levelchange",n),setInterval(n,1e3),n()}};si.isAvailable=Dm(navigator);var tn=class extends In{constructor(e){super(10,10,e);this.trueWidth=null;this.trueHeight=null;this.trueFontSize=null;this.dx=null;this._minWidth=null;this._maxWidth=null;this._minHeight=null;this._maxHeight=null;this._freezeDimensions=!1;this._dimensionsFrozen=!1;this._bgFillColor=null;this._bgStrokeColor=null;this._bgStrokeSize=null;this._textStrokeColor=null;this._textStrokeSize=null;this._textFillColor="black";this._textDirection="horizontal";this._wrapWords=!0;this._fontStyle="normal";this._fontVariant="normal";this._fontWeight="normal";this._fontFamily="sans-serif";this._fontSize=20;this._value=null;v(e)&&(v(e.minWidth)&&(this._minWidth=e.minWidth),v(e.maxWidth)&&(this._maxWidth=e.maxWidth),v(e.minHeight)&&(this._minHeight=e.minHeight),v(e.maxHeight)&&(this._maxHeight=e.maxHeight),v(e.freezeDimensions)&&(this._freezeDimensions=e.freezeDimensions),v(e.textStrokeColor)&&(this._textStrokeColor=e.textStrokeColor),v(e.textStrokeSize)&&(this._textStrokeSize=e.textStrokeSize),v(e.bgFillColor)&&(this._bgFillColor=e.bgFillColor),v(e.bgStrokeColor)&&(this._bgStrokeColor=e.bgStrokeColor),v(e.bgStrokeSize)&&(this._bgStrokeSize=e.bgStrokeSize),v(e.value)&&(this._value=e.value),v(e.textFillColor)&&(this._textFillColor=e.textFillColor),v(e.textDirection)&&(this._textDirection=e.textDirection),v(e.wrapWords)&&(this._wrapWords=e.wrapWords),v(e.fontStyle)&&(this._fontStyle=e.fontStyle),v(e.fontVariant)&&(this._fontVariant=e.fontVariant),v(e.fontWeight)&&(this._fontWeight=e.fontWeight),v(e.fontFamily)&&(this._fontFamily=e.fontFamily),v(e.fontSize)&&(this._fontSize=e.fontSize),v(e.padding)&&(ce(e.padding)?this._padding={left:e.padding,right:e.padding,top:e.padding,bottom:e.padding}:this._padding=e.padding)),B(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(e){this.minWidth!==e&&(this._minWidth=e,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(e){this.maxWidth!==e&&(this._maxWidth=e,this.redraw())}get minHeight(){return this._minHeight}set minHeight(e){this.minHeight!==e&&(this._minHeight=e,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(e){this.maxHeight!==e&&(this._maxHeight=e,this.redraw())}get padding(){return this._padding}set padding(e){if(e instanceof Array)throw new Error("Invalid padding");(this.padding.top!==e.top||this.padding.right!=e.right||this.padding.bottom!=e.bottom||this.padding.left!=e.left)&&(this._padding=e,this.redraw())}get wrapWords(){return this._wrapWords}set wrapWords(e){this.wrapWords!==e&&(this._wrapWords=e,this.redraw())}get textDirection(){return this._textDirection}set textDirection(e){this.textDirection!==e&&(this._textDirection=e,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(e){this.fontStyle!==e&&(this._fontStyle=e,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(e){this.fontVariant!==e&&(this._fontVariant=e,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(e){this.fontWeight!==e&&(this._fontWeight=e,this.redraw())}get fontSize(){return this._fontSize}set fontSize(e){this.fontSize!==e&&(this._fontSize=e,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(e){this.textFillColor!==e&&(this._textFillColor=e,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(e){this.textStrokeColor!==e&&(this._textStrokeColor=e,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(e){this.textStrokeSize!==e&&(this._textStrokeSize=e,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(e){this.bgFillColor!==e&&(this._bgFillColor=e,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(e){this.bgStrokeColor!==e&&(this._bgStrokeColor=e,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(e){this.bgStrokeSize!==e&&(this._bgStrokeSize=e,this.redraw())}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.redraw())}split(e){return this.wrapWords?e.split(" ").join(`
`).replace(/\r\n/,`
`).split(`
`):e.replace(/\r\n/,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value){let e=this.split(this.value),n=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let o=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,s=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,a=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,p=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,d=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,h=n?p:s,x=n?d:a,A=n?s:p,E=n?a:d,S=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let P=!1,R=!1,I=1e4,O=0;this.trueFontSize=Wt(this.fontSize*this.scale,O,I);let L=null,k=Number.MAX_VALUE;do{let D=this.fontSize;this._fontSize=this.trueFontSize;let te=uo(this);this._fontSize=D,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=te,this.trueWidth=0,this.trueHeight=0;for(let K of e){let z=this.g.measureText(K);this.trueWidth=Math.max(this.trueWidth,z.width),this.trueHeight+=this.trueFontSize,ce(z.actualBoundingBoxLeft)&&ce(z.actualBoundingBoxRight)&&ce(z.actualBoundingBoxAscent)&&ce(z.actualBoundingBoxDescent)&&(o||(this.trueWidth=z.actualBoundingBoxLeft+z.actualBoundingBoxRight,this.trueHeight=z.actualBoundingBoxAscent+z.actualBoundingBoxDescent,this.dx=(z.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(o){let K=this.trueWidth-h,z=this.trueWidth-x,J=this.trueHeight-A,ye=this.trueHeight-E,Ae=Math.abs(K),ae=Math.abs(z),tt=Math.abs(J),Vr=Math.abs(ye);P=z>1||ye>1,R=K<-1&&J<-1;let un=Math.min(Ae,Math.min(ae,Math.min(tt,Vr)));un<k&&(k=un,L=this.g.font),(P||R)&&S.indexOf(this.g.font)>-1&&L&&(this.g.font=L,P=!1,R=!1),P?(I=this.trueFontSize,this.trueFontSize=(O+this.trueFontSize)/2):R&&(O=this.trueFontSize,this.trueFontSize=(this.trueFontSize+I)/2)}S.push(this.g.font)}while(P||R);o&&(this.trueWidth<h?this.trueWidth=h:this.trueWidth>x&&(this.trueWidth=x),this.trueHeight<A?this.trueHeight=A:this.trueHeight>E&&(this.trueHeight=E));let H=this.trueWidth+this.scale*(this.padding.right+this.padding.left),V=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{sp(this.g,H,V)}catch(D){throw console.error(D),D}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let i=.5*(e.length-1);for(let o=0;o<e.length;++o){let s=e[o],a=(o-i)*this.trueFontSize,p=this.dx+this.trueWidth/2+this.scale*this.padding.left,d=a+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(s,p,d),this.textFillColor&&this.g.fillText(s,p,d)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let o=this.bgStrokeSize/2;this.g.strokeRect(o,o,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(n){let o=Qr(this.canvas.height,this.canvas.width),s=o.getContext("2d");s?(s.translate(o.width/2,o.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?s.rotate(Math.PI/2):this.textDirection==="vertical-right"&&s.rotate(-Math.PI/2),s.translate(-this.canvas.width/2,-this.canvas.height/2),s.drawImage(this.canvas,0,0),sp(this.g,o.width,o.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(o,0,0)}return!0}else return!1}};var Js=class extends tn{constructor(){super({textFillColor:"#ffffff",textStrokeColor:"rgba(0, 0, 0, 0.5)",textStrokeSize:.025,fontFamily:yu(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,wrapWords:!1,freezeDimensions:!0});this.fps=null;this.drawCalls=null;this.triangles=null;let e=this.update.bind(this);setInterval(e,500),e()}setStats(e,n,i){this.fps=e,this.drawCalls=n,this.triangles=i}update(){let n=new Date().toLocaleTimeString();this.fps!==null&&(n+=` ${Math.round(this.fps).toFixed(0)}hz ${this.drawCalls}c ${this.triangles}t`),(B(this.value)||n.length!==this.value.length)&&this.unfreeze(),this.value=n}};var Bm="local-user";function Fm(r){return!r.started||r.finished}var kp=class extends Be{constructor(){super(!1);this.time=0;this.duration=0;this.onTick=null}begin(e,n,i){this.reset(),this.start(),this.time=-e,this.duration=n,this.onTick=i,this.onTick(0)}update(e){Fm(this)||(this.time+=e/this.duration,this.time>=1?(this.onTick(1),this.resolve()):this.time>=0&&this.onTick(this.time))}},$s=class{constructor(){this.animations=new Array}update(t){t=.001*t;for(let e of this.animations)e.update(t)}clear(){for(let t of this.animations)t.resolve()}start(t,e,n){let i=ut(this.animations,Fm);return i||this.animations.push(i=new kp),i.begin(t,e,n),i}};function Hm(r,t){let e=r*Math.PI;return .5*(1-Math.cos(e))-t*Math.sin(2*e)}function Nm(r,t){let e=(r-.5)*Math.PI;return r*r+t*Math.cos(e)}Ct(ee(".dialog, .dialog-container",Wr("fixed")),ee(".dialog",nr(0),er(0),yt("100%"),Yt("100%"),Zi("rgba(0, 0, 0, 0.5)"),us(100)),ee(".dialog-container",nr("50%"),er("50%"),eo("100%"),gu("100%"),Eu("translateX(-50%) translateY(-50%)"),Zi("white"),du("rgba(0,0,0,0.5) 0px 5px 30px"),Ge("grid"),_n("2em auto 2em"),ds("auto 1fr auto 2em")),ee(".dialog .title-bar",ls(1,1,2,-1),En("0.25em")),ee(".dialog-content",ls(2,2,-4,-2),Au("auto")),ee(".dialog-controls",ls(-2,2,-3,-2)),ee(".dialog .confirm-button",hu("right")),ee(".dialog h1, .dialog h2, .dialog h3, .dialog h4, .dialog h5, .dialog h6",tr("left")),ee(".dialog select",eo("10em")));var ai=class{constructor(t){this.subEventer=new q;this.element=xe(we("dialog"),su("dialogname",t),st(Ge("none")),this.container=xe(we("dialog-container"),this.titleElement=Vu(we("title-bar"),t),this.contentArea=xe(we("dialog-content")),xe(we("dialog-controls"),this.confirmButton=qr("Confirm",jr("confirm-button")),this.cancelButton=fs("Cancel",jr("cancel-button"))))),this.confirmButton.addEventListener("click",()=>this.subEventer.dispatchEvent(new j("confirm"))),this.cancelButton.addEventListener("click",()=>this.subEventer.dispatchEvent(new j("cancel"))),fe(document.body,this)}get title(){return this._title}set title(t){ro(this.titleElement,this._title=t)}async onShowing(){}onShown(){}async onConfirm(){}onCancel(){}async onClosing(){}onClosed(){}show(t){Ie(this,t)}get isOpen(){return Pt(this)}async showDialog(){await this.onShowing(),this.show(!0),this.onShown();let t=ue(this.subEventer,"confirm","cancel"),e=await _t(t);return e?await this.onConfirm():this.onCancel(),await this.onClosing(),this.show(!1),this.onClosed(),e}};var cr=bt("Juniper:ScaledItems",()=>new Map),Xm=1,Mv=1.1,Sv=.005,Op=class{constructor(t){this.target=t;this.obj=Qe(this.target),this.base=this.obj.scale.clone(),this.p=0,this.dir=0,this.running=!1,this.wasDisabled=this.disabled,this.onEnter=()=>this.run(1),this.onExit=()=>this.run(-1),this.target.addEventListener("enter",this.onEnter),this.target.addEventListener("exit",this.onExit),this.obj.traverse(e=>{yn(e)&&this.target.addMesh(e)})}get disabled(){return this.target.disabled}run(t){(!this.disabled||t===-1||this.p>0)&&(this.dir=t,this.running=!0)}updateScaling(t){if(this.disabled!==this.wasDisabled&&(this.wasDisabled=this.disabled,this.disabled&&this.onExit()),this.running){this.p+=this.dir*t,(this.dir>0&&this.p>=1||this.dir<0&&this.p<0)&&(this.p=Math.max(0,Math.min(1,this.p)),this.running=!1);let e=Hm(this.p,1.1);this.obj.scale.copy(this.base).multiplyScalar(e*(Mv-Xm)+Xm)}}dispose(){this.target.removeEventListener("enter",this.onEnter),this.target.removeEventListener("exit",this.onExit)}};function zm(r){r*=Sv;for(let t of cr.values())t.updateScaling(r)}function jm(r){let t=cr.get(r);t&&(cr.delete(r),t.dispose())}function Zs(r,t){let e=cr.has(r);t!=e&&(t?cr.set(r,new Op(r)):(cr.get(r).dispose(),cr.delete(r)))}function Vn(r){let t=new Array,e=new Set;for(t.push(r);t.length>0;){let n=t.shift();n&&!e.has(n)&&(e.add(n),n.isMesh&&t.push(n.material,n.geometry),n.isMaterial&&t.push(...Object.values(n)),n.isObject3D&&(t.push(...n.children),n.clear(),jm(n)),ke(n)&&t.push(...n),Hr(n))}e.clear()}var Rv=new THREE.Matrix4,ea=new THREE.Vector3;function Dp(r,t,e,n,i){Rv.copy(r.matrixWorld).invert().multiply(t.matrixWorld).decompose(ea,n,i),e.set(ea.x,ea.y,ea.z,1)}var ta=new THREE.PlaneBufferGeometry(1,1,1,1);ta.name="PlaneGeom";var Um=class extends THREE.Mesh{constructor(t,e,n){super(ta,n),this.scale.set(t,e,1)}};var na=new THREE.Vector4,ra=new THREE.Quaternion,li=new THREE.Vector3,Pv=0,pi=class extends THREE.Object3D{constructor(e,n,i,o=null){super();this.isStatic=i;this.lastMatrixWorld=new THREE.Matrix4;this.layer=null;this.tryWebXRLayers=!0;this.wasUsingLayer=!1;this._imageWidth=0;this._imageHeight=0;this.lastImage=null;this.lastWidth=null;this.lastHeight=null;this.stereoLayoutName="mono";this.env=null;this.mesh=null;this.webXRLayersEnabled=!0;this.sizeMode="none";if(e){this.setEnvAndName(e,n);let s=Ju(o)?o:Jr(Object.assign({},o,{name:this.name}));U(this,this.mesh=lr(n+"-Mesh",ta,s))}}copy(e,n=!0){return super.copy(e,n),this.setImageSize(e.imageWidth,e.imageHeight),this.setEnvAndName(e.env,e.name+ ++Pv),this.mesh=ut(this.children,yn),B(this.mesh)&&(this.mesh=e.mesh.clone()),U(this,this.mesh),this}dispose(){Vn(this.layer)}setImageSize(e,n){if(e!==this.imageWidth||n!==this.imageHeight){let{objectWidth:i,objectHeight:o}=this;this._imageWidth=e,this._imageHeight=n,this.sizeMode!=="none"&&(this.sizeMode==="fixed-width"?this.objectWidth=i:this.objectHeight=o)}}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get imageAspectRatio(){return this.imageWidth/this.imageHeight}get objectWidth(){return this.scale.x}set objectWidth(e){this.scale.set(e,this.scale.y=e/this.imageAspectRatio,1)}get objectHeight(){return this.scale.y}set objectHeight(e){this.scale.set(this.imageAspectRatio*e,e,1)}get pixelDensity(){let e=Kd(this.objectWidth);return this.imageWidth/e}set pixelDensity(e){let n=this.imageWidth/e,i=Qd(n);this.objectWidth=i}setEnvAndName(e,n){this.env=e,this.name=n,this.tryWebXRLayers&&=this.env&&this.env.hasXRCompositionLayers}get needsLayer(){if(!Cs(this)||B(this.mesh.material.map)||B(this.mesh.material.map.image))return!1;let e=this.mesh.material.map.image;return e instanceof HTMLVideoElement?!e.paused||e.currentTime>0:!0}removeWebXRLayer(){if(v(this.layer)){this.wasUsingLayer=!1,this.env.removeWebXRLayer(this.layer);let e=this.layer;this.layer=null,setTimeout(()=>{e.destroy(),this.mesh.visible=!0},100)}}setTextureMap(e){return zu(e)&&(e=ju(e)),rp(e)&&(e=e),e instanceof HTMLVideoElement?(this.mesh.material.map=new THREE.VideoTexture(e),this.setImageSize(e.videoWidth,e.videoHeight)):(this.mesh.material.map=new THREE.Texture(e),this.setImageSize(e.width,e.height),this.mesh.material.map.needsUpdate=!0),this.mesh.material.needsUpdate=!0,this.mesh.material.map}async loadTextureMap(e,n,i){let{content:o}=await e.get(n).progress(i).image(),s=this.setTextureMap(o);s.name=n}updateTexture(){let e=this.mesh.material.map.image;ce(e.width)&&ce(e.height)&&(this.imageWidth!==e.width||this.imageHeight!==e.height)&&(this.mesh.material.map.dispose(),this.mesh.material.map=new THREE.Texture(e),this.mesh.material.needsUpdate=!0,this.setImageSize(e.width,e.height)),this.mesh.material.map.needsUpdate=!0}update(e,n){if(this.mesh.material.map&&this.mesh.material.map.image){let i=this.mesh.material.map instanceof THREE.VideoTexture,s=this.tryWebXRLayers&&this.webXRLayersEnabled&&v(n)&&(i&&v(this.env.xrMediaBinding)||!i&&v(this.env.xrBinding))&&this.needsLayer,a=s!==this.wasUsingLayer,p=this.mesh.material.map.image!==this.lastImage||this.mesh.material.needsUpdate||this.mesh.material.map.needsUpdate,d=this.imageWidth!==this.lastWidth||this.imageHeight!==this.lastHeight;if(this.wasUsingLayer=s,this.lastImage=this.mesh.material.map.image,this.lastWidth=this.imageWidth,this.lastHeight=this.imageHeight,(a||d)&&((!s||d)&&this.layer&&this.removeWebXRLayer(),s)){let h=this.env.referenceSpace;Dp(this.env.stage,this.mesh,na,ra,li),this.lastMatrixWorld.copy(this.matrixWorld);let x=new XRRigidTransform(na,ra),A=li.x/2,E=li.y/2,S=this.stereoLayoutName==="mono"?"mono":this.stereoLayoutName==="left-right"||this.stereoLayoutName==="right-left"?"stereo-left-right":"stereo-top-bottom";if(i){let P=this.stereoLayoutName==="right-left"||this.stereoLayoutName==="bottom-top";this.layer=this.env.xrMediaBinding.createQuadLayer(this.mesh.material.map.image,{space:h,layout:S,invertStereo:P,transform:x,width:A,height:E})}else this.layer=this.env.xrBinding.createQuadLayer({space:h,layout:S,textureType:"texture",isStatic:this.isStatic,viewPixelWidth:this.imageWidth,viewPixelHeight:this.imageHeight,transform:x,width:A,height:E});this.env.addWebXRLayer(this.layer,500),this.mesh.visible=!1}if(this.layer){if(p||this.layer.needsRedraw){let h=this.env.gl,x=this.env.xrBinding.getSubImage(this.layer,n);h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!0),h.bindTexture(h.TEXTURE_2D,x.colorTexture),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.mesh.material.map.image),h.generateMipmap(h.TEXTURE_2D),h.bindTexture(h.TEXTURE_2D,null)}Wo(this.matrixWorld.elements,this.lastMatrixWorld.elements)>=0&&(Dp(this.env.stage,this.mesh,na,ra,li),this.lastMatrixWorld.copy(this.matrixWorld),this.layer.transform=new XRRigidTransform(na,ra),this.layer.width=li.x/2,this.layer.height=li.y/2)}}}};var Cv={type:"redrawn"},dr=class extends pi{constructor(e,n,i,o){super(e,n,!1,o);this._image=null;this._onRedrawn=this.onRedrawn.bind(this),this.image=i}get object(){return this}get element(){return ar(this.image.canvas)?this.image.canvas:null}onRedrawn(){this.updateTexture(),this.dispatchEvent(Cv)}get image(){return this._image}set image(e){this.image&&this.image.removeEventListener("redrawn",this._onRedrawn),this._image=e,this.image&&(this.image.addEventListener("redrawn",this._onRedrawn),this.setTextureMap(this.image.canvas),this.onRedrawn())}get imageWidth(){return this.image.width}get imageHeight(){return this.image.height}copy(e,n=!0){return super.copy(e,n),this.image=e.image,this}get isVisible(){return Pt(this)}set isVisible(e){Ie(this,e,"inline-block"),Me(this,e),Me(this.mesh,e),this.image.visible=e}};var ci=class extends dr{constructor(t,e,n,i){let o;n instanceof tn?o=n:o=new tn(n),super(t,e,o,i)}onRedrawn(){this.objectHeight=this.imageHeight,super.onRedrawn()}};var mo=class extends Zt{constructor(e,n,i,o,s){super(se(i));this.fetcher=e;this.env=n;if(v(o)){s=Object.assign({textFillColor:"#ffffff",fontFamily:"Segoe UI Emoji",fontSize:20,minHeight:.25,maxHeight:.25},s,{value:o}),this.image=new tn(s);let a=Et(16);this.enabledImage=this.createImage(`${a}-enabled`,1),this.disabledImage=this.createImage(`${a}-disabled`,.5),this.disabledImage.visible=!1,U(this,this.enabledImage,this.disabledImage)}this.addMesh(this.enabledImage.mesh),this.addMesh(this.disabledImage.mesh),this.clickable=!0,v(o)&&Zs(this,!0)}createImage(e,n){return new ci(this.env,`text-${e}`,this.image,{side:THREE.FrontSide,opacity:n})}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.enabledImage.visible=!e,this.disabledImage.visible=e}};var Gm={bgStrokeColor:"#000000",bgStrokeSize:.04,wrapWords:!1,textFillColor:"#ffffff",scale:150},Wm=Object.assign({},Gm,{padding:{left:.1,right:.1,top:.025,bottom:.025},fontSize:20,minHeight:.5,maxHeight:.5}),Iv=Object.assign({},Wm,{bgFillColor:"#0078d7"}),Vv=Object.assign({},Wm,{bgFillColor:"#780000"}),Lv=Object.assign({},Gm,{bgFillColor:"#ffffff",textFillColor:"#000000",padding:{top:.1,left:.1,bottom:.4,right:.1},fontSize:25,minHeight:1,maxHeight:1}),kv=.9;function Bp(r,t){return Object.assign({},r,{fontFamily:t})}var ia=class extends ai{constructor(e,n){super("Confirm action");this.env=e;this.object=se("ConfirmationDialog");this.root=se("Root");this.animator=new $s;this.a=0;this.b=0;this.confirmButton.innerText="Yes",this.cancelButton.innerText="No",this.mesh=new ci(this.env,"confirmationDialogLabel",Bp(Lv,n)),this.confirmButton3D=new mo(this.env.fetcher,this.env,"confirmationDialogConfirmButton","Yes",Bp(Iv,n)),this.confirmButton3D.addEventListener("click",()=>this.confirmButton.click()),this.confirmButton3D.object.position.set(1,-.5,.5),this.cancelButton3D=new mo(this.env.fetcher,this.env,"confirmationDialogCancelButton","No",Bp(Vv,n)),this.cancelButton3D.addEventListener("click",()=>this.cancelButton.click()),this.cancelButton3D.object.position.set(2,-.5,.5),fe(this.container,st(eo("calc(100% - 2em)"),yt("max-content"))),fe(this.contentArea,st(as("18pt"),tr("center"),En("1em"))),U(this,U(this.root,this.mesh,this.confirmButton3D,this.cancelButton3D)),Me(this.root,!1),this.root.scale.setScalar(0),this.onTick=i=>{let o=Nm(this.a+this.b*i,kv);this.root.scale.set(o,o,.01)}}get name(){return this.object.name}get visible(){return Pt(this)}set visible(e){Ie(this,e,"inline-block"),this.mesh.visible=e}update(e){this.animator.update(e)}async showHide(e,n){this.a=e,this.b=n,await this.animator.start(0,.25,this.onTick),this.animator.clear()}get use3D(){return this.env.renderer.xr.isPresenting||this.env.testSpaceLayout}async onShowing(){await super.onShowing(),this.use3D&&(this.root.visible=!0,await this.showHide(0,1))}onShown(){this.use3D&&(this.element.style.display="none")}async onClosing(){this.use3D&&(await this.showHide(1,-1),this.root.visible=!1),await super.onClosing()}prompt(e,n){return this.title=e,ro(this.contentArea,n),this.mesh.image.value=n,this.showDialog()}};function Fp(r,t){return r==="click"&&t&&(r="error"),`InteractionAudio-${r}`}var oa=class{constructor(t,e){this.audio=t,this.pointers=e,this.enabled=!0;let n=i=>{if(this.enabled&&i.rayTarget&&i.rayTarget.clickable){let o=Fp(i.type,!i.rayTarget.enabled);if(this.audio.hasClip(o)){let{x:s,y:a,z:p}=i.point;this.audio.setClipPosition(o,s,a,p),this.audio.playClip(o)}}};this.pointers.addEventListener("enter",n),this.pointers.addEventListener("exit",n),this.pointers.addEventListener("click",n)}async load(t,e,n,i){return await this.audio.loadClip(Fp(t,!1),e,!1,!1,!0,!1,n,[],i)}create(t,e,n){return this.audio.createClip(Fp(t,!1),e,!1,!0,!1,n,[])}};var ho=(i=>(i.None="None",i.Fullscreen="Fullscreen",i.VR="VR",i.AR="AR",i))(ho||{});Ct(ee("#controls",Wr("absolute"),er(0),nr(0),yt("100%"),Yt("100%")),ee("#controls",Ge("grid"),as("20pt"),ds("auto 1fr auto"),us(1)),ee("#controls, #controls *",Jl("none")),ee("#controls canvas",Yt("58px")),ee("#controls > .row",Ge("grid"),bn("10px 5px"),_n("repeat(2, auto)")),ee("#controls > .row.top",cs(1)),ee("#controls > .row.middle",cs(2,-2)),ee("#controls > .row.bottom",cs(-2)),ee("#controls > .row > .cell",Ge("flex")),ee("#controls > .row > .cell.left",Zn(1)),ee("#controls > .row > .cell.right",Zn(-2),mu("row-reverse")),ee("#controls > .row > .cell > .btn",cu(0),Zi("#1e4388"),Yt("58px !important"),yt("58px"),En("0.25em"),bn("0 5px"),Jl("initial")),ee("#controls .btn-primary img",Yt("calc(100% - 0.5em)")));var sa=class{constructor(){this.element=xe(Yn("controls"),xe(we("row top"),this.topRowLeft=xe(we("cell left")),this.topRowRight=xe(we("cell right"))),xe(we("row middle"),this.middleRowLeft=xe(we("cell left")),this.middleRowRight=xe(we("cell right"))),xe(we("row bottom"),this.bottomRowLeft=xe(we("cell left")),this.bottomRowRight=xe(we("cell right")))),this.cells=[[this.topRowLeft,this.topRowRight],[this.middleRowLeft,this.middleRowRight],[this.bottomRowLeft,this.bottomRowRight]]}};function qm(r){return"height"in r}function Qm(r){return"width"in r}var Hp=1.25,Km=Fe(30),Ov=Fe(32),Dv=new THREE.Vector3(0,0,0),aa=class extends THREE.Object3D{constructor(){super(),this.name="SpaceUI",this.position.y=-.25}addItem(t,e){t=Qe(t),U(this,t),t.position.set(Hp*Math.sin(e.x*Km),Hp*Math.sin(e.y*Ov),-Hp*Math.cos(e.x*Km)),qm(e)&&Qm(e)?t.scale.set(e.width,e.height,1):qm(e)?t.scale.multiplyScalar(e.height/t.scale.y):Qm(e)?t.scale.multiplyScalar(e.width/t.scale.x):t.scale.setScalar(e.scale),t.scale.z=1;for(let n of this.children)n.lookAt(Dv)}};function Ym(r){return Q(r.vcodec)}var la=class extends Lt{constructor(e){super("JuniperVideoPlayer",e,We.instance(e));this.onTimeUpdate=null;this.wasUsingAudioElement=!1;this.nextStartTime=null;this._data=null;this._loaded=!1;this.onError=new Map;this.sourcesByURL=new Map;this.sources=new mt;this.potatoes=new mt;this.video=this.createMediaElement(tp,An(!0)),this.audio=this.createMediaElement(ir,An(!1)),this.input=Ne("JuniperVideoPlayer-combiner",e),this.videoSource=pr("JuniperVideoPlayer-VideoNode",e,this.video,this.input),this.audioSource=pr("JuniperVideoPlayer-AudioNode",e,this.audio,this.input),this.loadingEvt=new oi(this),this.loadEvt=new Mn(this),this.playEvt=new Sn(this),this.pauseEvt=new Rn(this),this.stopEvt=new Pn(this),this.progEvt=new Cn(this),this.onSeeked=()=>{this.useAudioElement&&(this.audio.currentTime=this.video.currentTime)},this.onPlay=async()=>{this.connect(),this.onSeeked(),this.useAudioElement&&(await Vt(this.audioCtx),await this.audio.play()),this.dispatchEvent(this.playEvt)},this.onPause=i=>{this.disconnect(),this.useAudioElement&&(this.onSeeked(),this.audio.pause()),this.video.currentTime===0||i.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};let n=!1;this.onWaiting=()=>{this.useAudioElement&&(n=!0,this.audio.pause())},this.onCanPlay=async()=>{this.useAudioElement&&n&&(await Vt(this.audioCtx),await this.audio.play(),n=!1)},this.wasUsingAudioElement=!1,this.onTimeUpdate=async()=>{if(this.video.getVideoPlaybackQuality().totalVideoFrames===0){let o=this.onError.get(this.video);v(o)&&await o()}else if(this.useAudioElement){this.wasUsingAudioElement=!1;let o=this.video.currentTime-this.audio.currentTime;Math.abs(o)>.25&&(this.audio.currentTime=this.video.currentTime)}else this.wasUsingAudioElement||(this.wasUsingAudioElement=!0,this.audio.pause());this.progEvt.value=this.video.currentTime,this.progEvt.total=this.video.duration,this.dispatchEvent(this.progEvt)},this.video.addEventListener("seeked",this.onSeeked),this.video.addEventListener("play",this.onPlay),this.video.addEventListener("pause",this.onPause),this.video.addEventListener("ended",this.onPause),this.video.addEventListener("waiting",this.onWaiting),this.video.addEventListener("canplay",this.onCanPlay),this.video.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{videoPlayer:this})}get data(){return this._data}get loaded(){return this._loaded}get title(){return this.video.title}setTitle(e){this.video.title=e,this.audio.title=e}elementHasAudio(e){let n=this.sourcesByURL.get(e.src);return v(n)&&n.acodec!=="none"||v(e.audioTracks)&&e.audioTracks.length>0||v(e.webkitAudioDecodedByteCount)&&e.webkitAudioDecodedByteCount>0||v(e.mozHasAudio)&&e.mozHasAudio}get useAudioElement(){return!this.elementHasAudio(this.video)&&this.elementHasAudio(this.audio)}onDisposing(){super.onDisposing(),this.clear(),ie(this.input),ie(this.videoSource),ie(this.audioSource),this.video.removeEventListener("seeked",this.onSeeked),this.video.removeEventListener("play",this.onPlay),this.video.removeEventListener("pause",this.onPause),this.video.removeEventListener("ended",this.onPause),this.video.removeEventListener("waiting",this.onWaiting),this.video.removeEventListener("canplay",this.onCanPlay),this.video.removeEventListener("timeupdate",this.onTimeUpdate)}clear(){this.stop();for(let[e,n]of this.onError)e.removeEventListener("error",n);this.onError.clear(),this.sourcesByURL.clear(),this.sources.clear(),this.potatoes.clear(),this.video.src="",this.audio.src="",this.wasUsingAudioElement=!1,this._data=null,this._loaded=!1}async load(e,n){if(this.clear(),this._data=e,Q(e)?(this.setTitle(e),this.potatoes.add(this.video,e)):(this.setTitle(e.title),this.fillSources(this.video,e.videos),this.fillSources(this.audio,e.audios)),!this.hasSources(this.video))throw new Error("No video sources found");if(this.dispatchEvent(this.loadingEvt),await Hd(n,i=>this.loadMediaElement(this.audio,i),i=>this.loadMediaElement(this.video,i)),Q(e)?this.nextStartTime=null:this.nextStartTime=e.startTime,!this.hasSources(this.video))throw new Error("No video playable sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}fillSources(e,n){Wn(n,i=>-i.resolution);for(let i of n)ou.matches(i.contentType)||(this.sources.add(e,i),this.sourcesByURL.set(i.url,i))}createMediaElement(e,...n){return e(Kt(!0),Qt(!1),Jn(!1),...n)}async getMediaCapabilities(e){let n={type:"file"};Ym(e)?n.video={contentType:e.contentType,bitrate:e.vbr*1024,framerate:e.fps,width:e.width,height:e.height}:e.acodec!=="none"&&(n.audio={contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr});try{return await navigator.mediaCapabilities.decodingInfo(n)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:n}}}hasSources(e){return this.sources.get(e).length>0||this.potatoes.count(e)>0}async loadMediaElement(e,n){for(v(n)&&n.start(),this.onError.has(e)&&(e.removeEventListener("error",this.onError.get(e)),this.onError.delete(e));this.hasSources(e);){let i=null,o=this.sources.get(e).shift();if(v(o)){let s=await this.getMediaCapabilities(o);if(!s.smooth||!s.powerEfficient){this.potatoes.add(e,o.url);continue}else i=o.url}else i=this.potatoes.get(e).shift();if(e.src=i,e.load(),await hs(e)){v(o)?this.sources.get(e).unshift(o):this.potatoes.get(e).unshift(i);let s=()=>this.loadMediaElement(e,n);e.addEventListener("error",s),this.onError.set(e,s),this.wasUsingAudioElement=this.wasUsingAudioElement,v(n)&&n.end();return}}}get width(){return this.video.videoWidth}get height(){return this.video.videoHeight}get playbackState(){return B(this.data)?"empty":this.loaded?this.video.error?"errored":this.video.ended||this.video.paused&&this.video.currentTime===0?"stopped":this.video.paused?"paused":"playing":"loading"}async play(){await Vt(this.audioCtx),v(this.nextStartTime)&&this.nextStartTime>0&&(this.video.pause(),this.video.currentTime=this.nextStartTime,this.nextStartTime=null),await this.video.play()}async playThrough(){let e=ue(this,"stopped");await this.play(),await e}pause(){this.video.pause()}stop(){this.pause(),this.video.currentTime=0}restart(){return this.stop(),this.play()}};function Bv(r){return[$m([r[1],r[0],r[2]]),$m([r[2],r[0],r[3]])]}function eh(r){return r.map(Bv).flat()}var Np=new THREE.Vector3,Jm=new THREE.Vector3,pa=new THREE.Vector3;function $m(r){let t=[[r[0][0],r[0][1],r[0][2]],[r[1][0],r[1][1],r[1][2]],[r[2][0],r[2][1],r[2][2]]],e=[[r[0][3],r[0][4]],[r[1][3],r[1][4]],[r[2][3],r[2][4]]];pa.fromArray(t[0]),Np.fromArray(t[1]).sub(pa),pa.fromArray(t[2]),Jm.fromArray(t[1]).sub(pa),Np.cross(Jm);let n=Np.toArray();return{positions:t,uvs:e,normal:n}}function th(r){let t=r.map(o=>o.positions).flat(2),e=r.map(o=>o.uvs).flat(2),n=r.flatMap(o=>o.normal),i=new THREE.BufferGeometry;return i.setAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3,!1)),i.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(e),2,!1)),i.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(n),3,!0)),i}function Mt(...r){let t=eh(r);return th(t)}function di(r,...t){let e=Fv(t);for(let i=0;i<r;++i)e=Nv(e);t=Hv(e);let n=eh(t);return th(n)}function Fv(r){return r.map(t=>{let e=Number.MAX_VALUE,n=Number.MIN_VALUE,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(let p of t){let d=p[3],h=p[4];e=Math.min(e,d),n=Math.max(n,d),i=Math.min(i,h),o=Math.max(o,h)}let s=[e,i],a=[n-e,o-i];return{minUV:s,deltaUV:a,verts:[ca(s,a,t[0]),ca(s,a,t[1]),ca(s,a,t[2]),ca(s,a,t[3])]}})}function ca(r,t,e){return{pos:[e[0],e[1],e[2]],uv:[e[3],e[4]],pUV:[(e[3]-r[0])/t[0],(e[4]-r[1])/t[1]]}}function Hv(r){return r.map(t=>[da(t,0),da(t,1),da(t,2),da(t,3)])}function da(r,t){let e=r.verts[t];return[e.pos[0],e.pos[1],e.pos[2],e.uv[0],e.uv[1]]}function Nv(r){return r.flatMap(t=>{let e=fo(t,t.verts[0],t.verts[1]),n=fo(t,t.verts[2],t.verts[3]),i=fo(t,t.verts[0],t.verts[3]),o=fo(t,t.verts[1],t.verts[2]),s=fo(t,e,n);return[{minUV:t.minUV,deltaUV:t.deltaUV,verts:[t.verts[0],e,s,i]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[e,t.verts[1],o,s]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[s,o,t.verts[2],n]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[i,s,n,t.verts[3]]}]})}function fo(r,t,e){let n=e.pos[0]-t.pos[0],i=e.pos[1]-t.pos[1],o=e.pos[2]-t.pos[2],s=t.pos[0]+.5*n,a=t.pos[1]+.5*i,p=t.pos[2]+.5*o,d=e.pUV[0]-t.pUV[0],h=e.pUV[1]-t.pUV[1],x=t.pUV[0]+.5*d,A=t.pUV[1]+.5*h,E=Zm(x-.5)+.5,S=Zm(A-.5)+.5,P=E*r.deltaUV[0]+r.minUV[0],R=S*r.deltaUV[1]+r.minUV[1];return{pos:[s,a,p],pUV:[x,A],uv:[P,R]}}function Zm(r){return 2*Math.atan(2*r)/Math.PI}var ma=class extends la{constructor(e,n){super(n);this.material=Jr({name:"videoPlayer-material"}),this.vidMeshes=[];for(let i=0;i<2;++i){let o=new pi(e,`videoPlayer-view${i+1}`,!1,this.material);o.setTextureMap(this.video),o.mesh.renderOrder=4,i>0?o.mesh.layers.disable(0):o.mesh.layers.enable(0),this.vidMeshes.push(o)}this.object=se("videoPlayer",...this.vidMeshes)}onDisposing(){super.onDisposing(),Vn(this.object),le(this.vidMeshes)}update(e,n){for(let i of this.vidMeshes)i.update(e,n)}isSupported(e,n){return n.split("-").map(i=>nh.has(e,i)).reduce(gd,!0)}setStereoParameters(e,n){if(!this.isSupported(e,n))throw new Error(`Not supported [encoding: ${e}, layout: ${n}]`);for(let s=0;s<this.vidMeshes.length;++s){let a=this.vidMeshes[s];a.webXRLayersEnabled=!1,a.mesh.layers.disable(1),a.mesh.layers.disable(2),n==="left-right"||n==="top-bottom"?a.mesh.layers.enable(this.vidMeshes.length-s):n!=="mono"&&a.mesh.layers.enable(s+1)}let i=this.height/this.width;e!=="N/A"?this.vidMeshes[0].scale.setScalar(100):n==="mono"?this.vidMeshes[0].scale.set(1,i,1):n==="left-right"||n==="right-left"?this.vidMeshes[0].scale.set(1,2*i,1):this.vidMeshes[0].scale.set(1,.5*i,1);for(let s=1;s<this.vidMeshes.length;++s)this.vidMeshes[s].scale.copy(this.vidMeshes[0].scale);let o=n.split("-");for(let s=0;s<o.length;++s){let a=o[s],p=nh.get(e,a),d=this.vidMeshes[s];d.webXRLayersEnabled=!0,d.visible=!0,d.mesh.geometry!==p&&(d.mesh.geometry.dispose(),d.mesh.geometry=p)}}},Xv=Mt([[-1/2,1/2,0,0,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,0,0]]),rh=[[-1/2,1/2,0,0,1],[1/2,1/2,0,.5,1],[1/2,-1/2,0,.5,0],[-1/2,-1/2,0,0,0]],ih=[[-1/2,1/2,0,.5,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,.5,0]],oh=[[[-1/2,1/2,-1/2,1/3,1],[1/2,1/2,-1/2,2/3,1],[1/2,-1/2,-1/2,2/3,1/2],[-1/2,-1/2,-1/2,1/3,1/2]],[[1/2,1/2,-1/2,2/3,1],[1/2,1/2,1/2,1,1],[1/2,-1/2,1/2,1,1/2],[1/2,-1/2,-1/2,2/3,1/2]],[[-1/2,1/2,1/2,0,1],[-1/2,1/2,-1/2,1/3,1],[-1/2,-1/2,-1/2,1/3,1/2],[-1/2,-1/2,1/2,0,1/2]],[[1/2,1/2,1/2,2/3,1/2],[-1/2,1/2,1/2,2/3,0],[-1/2,-1/2,1/2,1/3,0],[1/2,-1/2,1/2,1/3,1/2]],[[1/2,1/2,-1/2,1,1/2],[-1/2,1/2,-1/2,1,0],[-1/2,1/2,1/2,2/3,0],[1/2,1/2,1/2,2/3,1/2]],[[1/2,-1/2,1/2,1/3,1/2],[-1/2,-1/2,1/2,1/3,0],[-1/2,-1/2,-1/2,0,0],[1/2,-1/2,-1/2,0,1/2]]],Xp=[[[-1/2,1/2,-1/2,0,1/3],[1/2,1/2,-1/2,0,2/3],[1/2,-1/2,-1/2,1/4,2/3],[-1/2,-1/2,-1/2,1/4,1/3]],[[1/2,1/2,-1/2,0,2/3],[1/2,1/2,1/2,0,1],[1/2,-1/2,1/2,1/4,1],[1/2,-1/2,-1/2,1/4,2/3]],[[-1/2,1/2,1/2,0,0],[-1/2,1/2,-1/2,0,1/3],[-1/2,-1/2,-1/2,1/4,1/3],[-1/2,-1/2,1/2,1/4,0]],[[1/2,1/2,1/2,1/4,2/3],[-1/2,1/2,1/2,1/2,2/3],[-1/2,-1/2,1/2,1/2,1/3],[1/2,-1/2,1/2,1/4,1/3]],[[1/2,1/2,-1/2,1/4,1],[-1/2,1/2,-1/2,1/2,1],[-1/2,1/2,1/2,1/2,2/3],[1/2,1/2,1/2,1/4,2/3]],[[1/2,-1/2,1/2,1/4,1/3],[-1/2,-1/2,1/2,1/2,1/3],[-1/2,-1/2,-1/2,1/2,0],[1/2,-1/2,-1/2,1/4,0]]],zp=[[[-1/2,1/2,-1/2,1/2,1/3],[1/2,1/2,-1/2,1/2,2/3],[1/2,-1/2,-1/2,3/4,2/3],[-1/2,-1/2,-1/2,3/4,1/3]],[[1/2,1/2,-1/2,1/2,2/3],[1/2,1/2,1/2,1/2,1],[1/2,-1/2,1/2,3/4,1],[1/2,-1/2,-1/2,3/4,2/3]],[[-1/2,1/2,1/2,1/2,0],[-1/2,1/2,-1/2,1/2,1/3],[-1/2,-1/2,-1/2,3/4,1/3],[-1/2,-1/2,1/2,3/4,0]],[[1/2,1/2,1/2,3/4,2/3],[-1/2,1/2,1/2,1,2/3],[-1/2,-1/2,1/2,1,1/3],[1/2,-1/2,1/2,3/4,1/3]],[[1/2,1/2,-1/2,3/4,1],[-1/2,1/2,-1/2,1,1],[-1/2,1/2,1/2,1,2/3],[1/2,1/2,1/2,3/4,2/3]],[[1/2,-1/2,1/2,3/4,1/3],[-1/2,-1/2,1/2,1,1/3],[-1/2,-1/2,-1/2,1,0],[1/2,-1/2,-1/2,3/4,0]]],zv=Mt(rh),jv=Mt(ih),Uv=Mt(jp(rh)),Gv=Mt(jp(ih)),sh=lh(Xp),ah=lh(zp),Wv=Mt(...oh),qv=Mt(...Xp),Qv=Mt(...zp),Kv=Mt(...sh),Yv=Mt(...ah),xo=4,Jv=di(xo,...oh),$v=di(xo,...Xp),Zv=di(xo,...zp),eA=di(xo,...sh),tA=di(xo,...ah),nh=new $e([["N/A","mono",Xv],["N/A","left",zv],["N/A","right",jv],["N/A","top",Uv],["N/A","bottom",Gv],["Cubemap Strips","mono",Wv],["Cubemap Strips","left",qv],["Cubemap Strips","right",Qv],["Cubemap Strips","top",Kv],["Cubemap Strips","bottom",Yv],["Equi-Angular Cubemap (YouTube)","mono",Jv],["Equi-Angular Cubemap (YouTube)","left",$v],["Equi-Angular Cubemap (YouTube)","right",Zv],["Equi-Angular Cubemap (YouTube)","top",eA],["Equi-Angular Cubemap (YouTube)","bottom",tA]]);function ua(r){return[r[0],r[1],r[2],r[4],1-r[3]]}function jp(r){return[ua(r[0]),ua(r[1]),ua(r[2]),ua(r[3])]}function lh(r){return r.map(jp)}var ha=class{constructor(t,e,n){this.imagePaths=t;this.padding=e;this.uvDescrips=new $e;this.geoms=new $e;this.canvas=null;this.texture=null;this.enabledMaterial=null;this.disabledMaterial=null;this.assetSets=new $e(Array.from(this.imagePaths.entries()).map(([i,o,s])=>[i,o,new zr(s,Zd,!n)])),this.assets=Array.from(this.assetSets.values()),this.ready=Promise.all(this.assets).then(()=>this.finish())}finish(){let t=this.assets.map(O=>O.result),e=Math.max(...t.map(O=>O.width)),n=Math.max(...t.map(O=>O.height)),i=e*n*t.length,o=Math.sqrt(i),s=Math.floor(o/e),a=Math.ceil(t.length/s),p=s*e,d=a*n,h=Il(p),x=Il(d),A=p/h,E=d/x,S=e/h,P=n/x;this.canvas=Kr(h,x);let R=this.canvas.getContext("2d",{alpha:!1});R.fillStyle="#1e4388",R.fillRect(0,0,h,x);let I=0;for(let[O,L,k]of this.assetSets.entries()){let H=k.result,V=I%s,D=(I-V)/s,te=A*(V*e/p),K=E*(1-D/a)-P,z=V*e,J=D*n+x-d,ye=e-2*this.padding,Ae=n-2*this.padding;R.drawImage(H,0,0,H.width,H.height,z+this.padding,J+this.padding,ye,Ae),this.uvDescrips.add(O,L,{u:te,v:K,du:S,dv:P}),++I}this.texture=new THREE.CanvasTexture(this.canvas),this.enabledMaterial=new THREE.MeshBasicMaterial({map:this.texture}),this.enabledMaterial.needsUpdate=!0,this.disabledMaterial=new THREE.MeshBasicMaterial({map:this.texture,transparent:!0,opacity:.5}),this.disabledMaterial.needsUpdate=!0}getSets(){return Array.from(this.imagePaths.keys())}getIcons(t){if(!this.imagePaths.has(t))throw new At(`Button set ${t} does not exist`);return Array.from(this.imagePaths.get(t).keys())}async getMaterial(t){return await this.ready,t?this.enabledMaterial:this.disabledMaterial}async getGeometry(t,e){await this.ready;let n=this.uvDescrips.get(t),i=n&&n.get(e);if(!n||!i)throw new At(`Button ${t}/${e} does not exist`,this.uvDescrips);let o=this.geoms.get(t,e);if(!o){o=new THREE.PlaneBufferGeometry(1,1,1,1),o.name=`Geometry:${t}/${e}`,this.geoms.add(t,e,o);let s=o.getAttribute("uv");for(let a=0;a<s.count;++a){let p=s.getX(a)*i.du+i.u,d=s.getY(a)*i.dv+i.v;s.setX(a,p),s.setY(a,d)}}return o}async getGeometryAndMaterials(t,e){let[n,i,o]=await Promise.all([this.getGeometry(t,e),this.getMaterial(!0),this.getMaterial(!1)]);return{geometry:n,enabledMaterial:i,disabledMaterial:o}}getImageSrc(t,e){let n=this.imagePaths.get(t),i=n&&n.get(e);if(!n||!i)throw new At(`Button ${t}/${e} does not exist`,this.uvDescrips);return i}getImageElement(t,e){return or(Ur(t+" "+e),$i(this.getImageSrc(t,e)))}};var ur=class extends Zt{constructor(e,n,i,o,s){e=e+Et(16);super(se(e));this.enabledMesh=lr(`Mesh-${e}-enabled`,n,i),this.disabledMesh=lr(`Mesh-${e}-disabled`,n,o),this.disabledMesh.visible=!1,this.size=s,U(this,this.enabledMesh,this.disabledMesh),this.addMesh(this.enabledMesh),this.addMesh(this.disabledMesh),this.clickable=!0,this.disabled=this.disabled,Zs(this,!0)}get size(){return this.enabledMesh.scale.x}set size(e){this.enabledMesh.scale.setScalar(e),this.disabledMesh.scale.setScalar(e)}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.enabledMesh.visible=!e,this.disabledMesh.visible=e}};var ui=class{constructor(t,e,n){this.mesh=null;this.element=qr(Ur(n),t.getImageElement(e,n)),this.object=se(`${name}-button`),this.load(t,e,n)}async load(t,e,n){let{geometry:i,enabledMaterial:o,disabledMaterial:s}=await t.getGeometryAndMaterials(e,n);this.mesh=new ur(n,i,o,s,.2),U(this,this.mesh),this.mesh.object.visible=this.visible,this.mesh.addEventListener("click",()=>{this.element.click()})}get name(){return this.object.name}addEventListener(t,e,n){this.element.addEventListener(t,e,n)}dispatchEvent(t){return this.element.dispatchEvent(t)}removeEventListener(t,e,n){this.element.removeEventListener(t,e,n)}click(){this.element.click()}get visible(){return Pt(this)}set visible(t){Ie(this,t,"inline-block"),this.mesh&&(this.mesh.object.visible=t)}};var mr=class{constructor(t,e,n,i){this.buttons=t;this.setName=e;this.activeName=n;this.inactiveName=i;this.enterButton=null;this.exitButton=null;this._isAvailable=!0;this._isEnabled=!0;this._isVisible=!0;this._isActive=!1;this.element=qr(this.btnImage=or()),this.object=se(`${this.setName}-button`),this.load()}get name(){return this.object.name}addEventListener(t,e,n){this.element.addEventListener(t,e,n)}dispatchEvent(t){return this.element.dispatchEvent(t)}removeEventListener(t,e,n){this.element.removeEventListener(t,e,n)}click(){this.element.click()}async load(){let[t,e]=await Promise.all([this.buttons.getGeometryAndMaterials(this.setName,this.activeName),this.buttons.getGeometryAndMaterials(this.setName,this.inactiveName)]);U(this.object,this.enterButton=new ur(`${this.setName}-activate-button`,t.geometry,t.enabledMaterial,t.disabledMaterial,.2),this.exitButton=new ur(`${this.setName}-deactivate-button`,e.geometry,e.enabledMaterial,e.disabledMaterial,.2)),this.enterButton.addEventListener("click",()=>this.element.click()),this.exitButton.addEventListener("click",()=>this.element.click()),this.refreshState()}get mesh(){return this.active?this.enterButton:this.exitButton}get available(){return this._isAvailable}set available(t){this._isAvailable=t,this.refreshState()}get active(){return this._isActive}set active(t){this._isActive=t,this.refreshState()}get enabled(){return this._isEnabled}set enabled(t){this._isEnabled=t,this.refreshState()}get visible(){return this._isVisible}set visible(t){this._isVisible=t,this.refreshState()}refreshState(){let t=this.active?this.inactiveName:this.activeName,e=`${t} ${this.setName}`;if(this.element.title=this.btnImage.title=e,this.btnImage.src=this.buttons.getImageSrc(this.setName,t),rr(this,this.available&&this.visible&&this.enabled,"primary"),Ie(this,this.available&&this.visible,"inline-block"),this.enterButton&&this.exitButton){Is(this,this.available&&this.visible&&this.enabled);let n=Me(this.object,this.available&&this.visible);Me(this.enterButton,n&&!this.active),Me(this.exitButton,n&&this.active)}}};var mi=class extends mr{constructor(e,n){let i=ho[n];super(e,i.toLowerCase(),"enter","exit");this.mode=n}};function Up(r,t,e){r.element instanceof HTMLButtonElement&&rr(r,t,e),Is(r,t)}var go=class extends j{constructor(e,n){super(e);this.appName=n}},Gp=class extends go{constructor(e,n){super("apploading",e);this.appLoadParams=n;this.preLoadTask=null}},Wp=class extends go{constructor(e,n){super("apploaded",e);this.app=n}},qp=class extends go{constructor(e,n){super("appshown",e);this.app=n}},Qp=class{constructor(t,e){this.loader=t;this.name=e;this.params=new Map}param(t,e){return this.params.set(t,e),this}load(t){return this.loader(this.name,this.params,t)}},fa=class extends q{constructor(e){super();this.env=e;this.loadedModules=new Map;this.loadingApps=new Map;this.currentApps=new Map;this.cacheBustString=null}[Symbol.iterator](){return this.currentApps.values()}isLoaded(e){return this.currentApps.has(e)}get(e){return this.currentApps.get(e)}waitFor(e){return this.isLoaded(e)?Promise.resolve(this.get(e)):new Promise(n=>{let i=o=>{o.appName===e&&(this.removeEventListener("apploaded",i),n(o.app))};this.addEventListener("apploaded",i)})}async loadAppConstructor(e,n){if(this.loadedModules.has(e))v(n)&&n.end();else{let o=this.env.DEBUG?".js":".min.js",s=`/js/${e}/index${o}`;if(v(this.cacheBustString)){let p=new is(s,location.href);p.query("v",this.cacheBustString),s=p.toString()}let a=this.env.fetcher.get(s).progress(n).useCache(!this.env.DEBUG).module();this.loadedModules.set(e,a)}let{default:i}=await this.loadedModules.get(e);return i}app(e){return new Qp(this.loadApp.bind(this),e)}loadApp(e,n,i){let o=null;n instanceof Map?o=n:i=n,i=i||this.env.loadingBar;let s=new Gp(e,o);this.dispatchEvent(s);let a=s.preLoadTask||Promise.resolve();if(!this.loadingApps.has(e)){let d=Fd(i),h=a.then(()=>this.loadAppInstance(this.env,e,o,d.pop(10)));this.loadingApps.set(e,h),i=d.pop(1)}return this.loadingApps.get(e).then(async d=>(await d.show(i),this.dispatchEvent(new qp(e,d)),d))}async loadAppInstance(e,n,i,o){if(!this.currentApps.has(n)){let[s,a]=Dr(o,[1,10]),p=await this.loadAppConstructor(n,s),d=new p(e);d.addEventListener("quit",()=>this.unloadApp(n)),v(i)&&await d.init(i),await d.load(a),this.currentApps.set(n,d),this.dispatchEvent(new Wp(n,d))}return v(o)&&o.end(),this.currentApps.get(n)}unloadApp(e){let n=this.currentApps.get(e);n.clearEventListeners(),n.dispose(),this.currentApps.delete(e),this.loadingApps.delete(e)}};var vo=new THREE.Vector3;function xa(r){return vo.copy(r),vo.y=0,vo.normalize(),gn(Math.atan2(vo.x,vo.z))}function ph(r){return gn(Math.asin(r.y))}var hi=new THREE.Vector3,ch=0,nA=new THREE.Vector3,ga=new THREE.Vector3,Kp=new THREE.Vector3,va=new THREE.Quaternion,dh=0,rA=0;function iA(r,t){let e=r-t,n=e+2*Math.PI,i=e-2*Math.PI,o=Math.abs(e),s=Math.abs(n),a=Math.abs(i);return o<s&&o<a?e:s<a?n:i}var Aa=class extends THREE.Object3D{constructor(e,n,i,o,s=1){super();this.minDistance=n;this.heightOffset=o;this.speed=s;this.name=e,this.lerp=this.minAngle>0||this.minDistance>0,this.maxDistance=this.minDistance*5,this.minAngle=Fe(i),this.maxAngle=Math.PI-this.minAngle,Object.seal(this)}copy(e,n=!0){return super.copy(e,n),this.name=e.name+ ++rA,this.lerp=e.lerp,this.maxDistance=e.maxDistance,this.minAngle=e.minAngle,this.maxAngle=e.maxAngle,this}update(e,n,i,o){o*=.001,this.clampTo(this.lerp,e,n,this.minDistance,this.maxDistance,i,this.minAngle,this.maxAngle,o)}reset(e,n,i){this.clampTo(!1,e,n,0,0,i,0,0,0)}clampTo(e,n,i,o,s,a,p,d,h){hi.copy(i),hi.y-=this.heightOffset*n,ch=a,this.getWorldPosition(ga),this.getWorldDirection(Kp),Kp.negate(),dh=xa(Kp),va.identity();let x=!e,A=!e;if(e){let E=nA.copy(hi).sub(ga).length();o<E&&(E<s&&hi.lerpVectors(ga,hi,this.speed*h),x=!0);let S=iA(ch,dh),P=Math.abs(S);p<P&&(P<d?va.setFromAxisAngle(this.up,S*this.speed*h):va.setFromAxisAngle(this.up,S),A=!0)}(x||A)&&(x&&this.position.add(hi.sub(ga)),A&&this.quaternion.multiply(va))}};var kn=class extends THREE.Loader{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new Zp(e)}),this.register(function(e){return new oc(e)}),this.register(function(e){return new sc(e)}),this.register(function(e){return new ec(e)}),this.register(function(e){return new tc(e)}),this.register(function(e){return new nc(e)}),this.register(function(e){return new rc(e)}),this.register(function(e){return new ic(e)}),this.register(function(e){return new Jp(e)}),this.register(function(e){return new ac(e)})}load(t,e,n,i){let o=this,s;this.resourcePath!==""?s=this.resourcePath:this.path!==""?s=this.path:s=THREE.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);let a=function(d){i?i(d):console.error(d),o.manager.itemError(t),o.manager.itemEnd(t)},p=new THREE.FileLoader(this.manager);p.setPath(this.path),p.setResponseType("arraybuffer"),p.setRequestHeader(this.requestHeader),p.setWithCredentials(this.withCredentials),p.load(t,function(d){try{o.parse(d,s,function(h){e(h),o.manager.itemEnd(t)},a)}catch(h){a(h)}},n,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,n,i){let o,s={},a={};if(typeof t=="string")o=t;else if(THREE.LoaderUtils.decodeText(new Uint8Array(t,0,4))===Ah){try{s[Z.KHR_BINARY_GLTF]=new lc(t)}catch(x){i&&i(x);return}o=s[Z.KHR_BINARY_GLTF].content}else o=THREE.LoaderUtils.decodeText(new Uint8Array(t));let p=JSON.parse(o);if(p.asset===void 0||p.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let d=new xc(p,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){let x=this.pluginCallbacks[h](d);a[x.name]=x,s[x.name]=!0}if(p.extensionsUsed)for(let h=0;h<p.extensionsUsed.length;++h){let x=p.extensionsUsed[h],A=p.extensionsRequired||[];switch(x){case Z.KHR_MATERIALS_UNLIT:s[x]=new $p;break;case Z.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[x]=new dc;break;case Z.KHR_DRACO_MESH_COMPRESSION:s[x]=new pc(p,this.dracoLoader);break;case Z.KHR_TEXTURE_TRANSFORM:s[x]=new cc;break;case Z.KHR_MESH_QUANTIZATION:s[x]=new uc;break;default:A.indexOf(x)>=0&&a[x]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+x+'".')}}d.setExtensions(s),d.setPlugins(a),d.parse(n,i)}parseAsync(t,e){let n=this;return new Promise(function(i,o){n.parse(t,e,i,o)})}};function oA(){let r={};return{get:function(t){return r[t]},add:function(t,e){r[t]=e},remove:function(t){delete r[t]},removeAll:function(){r={}}}}var Z={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},Jp=class{constructor(t){this.parser=t,this.name=Z.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let t=this.parser,e=this.parser.json.nodes||[];for(let n=0,i=e.length;n<i;n++){let o=e[n];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(t){let e=this.parser,n="light:"+t,i=e.cache.get(n);if(i)return i;let o=e.json,p=((o.extensions&&o.extensions[this.name]||{}).lights||[])[t],d,h=new THREE.Color(16777215);p.color!==void 0&&h.fromArray(p.color);let x=p.range!==void 0?p.range:0;switch(p.type){case"directional":d=new THREE.DirectionalLight(h),d.target.position.set(0,0,-1),d.add(d.target);break;case"point":d=new THREE.PointLight(h),d.distance=x;break;case"spot":d=new THREE.SpotLight(h),d.distance=x,p.spot=p.spot||{},p.spot.innerConeAngle=p.spot.innerConeAngle!==void 0?p.spot.innerConeAngle:0,p.spot.outerConeAngle=p.spot.outerConeAngle!==void 0?p.spot.outerConeAngle:Math.PI/4,d.angle=p.spot.outerConeAngle,d.penumbra=1-p.spot.innerConeAngle/p.spot.outerConeAngle,d.target.position.set(0,0,-1),d.add(d.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+p.type)}return d.position.set(0,0,0),d.decay=2,p.intensity!==void 0&&(d.intensity=p.intensity),d.name=e.createUniqueName(p.name||"light_"+t),i=Promise.resolve(d),e.cache.add(n,i),i}createNodeAttachment(t){let e=this,n=this.parser,o=n.json.nodes[t],a=(o.extensions&&o.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(p){return n._getNodeRef(e.cache,a,p)})}},$p=class{constructor(){this.name=Z.KHR_MATERIALS_UNLIT}getMaterialType(){return THREE.MeshBasicMaterial}extendParams(t,e,n){let i=[];t.color=new THREE.Color(1,1,1),t.opacity=1;let o=e.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){let s=o.baseColorFactor;t.color.fromArray(s),t.opacity=s[3]}o.baseColorTexture!==void 0&&i.push(n.assignTexture(t,"map",o.baseColorTexture))}return Promise.all(i)}},Zp=class{constructor(t){this.parser=t,this.name=Z.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];if(s.clearcoatFactor!==void 0&&(e.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&o.push(n.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&o.push(n.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(o.push(n.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){let a=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new THREE.Vector2(a,a)}return Promise.all(o)}},ec=class{constructor(t){this.parser=t,this.name=Z.KHR_MATERIALS_SHEEN}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[];e.sheenColor=new THREE.Color(0,0,0),e.sheenRoughness=0,e.sheen=1;let s=i.extensions[this.name];return s.sheenColorFactor!==void 0&&e.sheenColor.fromArray(s.sheenColorFactor),s.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&o.push(n.assignTexture(e,"sheenColorMap",s.sheenColorTexture)),s.sheenRoughnessTexture!==void 0&&o.push(n.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(o)}},tc=class{constructor(t){this.parser=t,this.name=Z.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];return s.transmissionFactor!==void 0&&(e.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&o.push(n.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(o)}},nc=class{constructor(t){this.parser=t,this.name=Z.KHR_MATERIALS_VOLUME}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];e.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&o.push(n.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||0;let a=s.attenuationColor||[1,1,1];return e.attenuationColor=new THREE.Color(a[0],a[1],a[2]),Promise.all(o)}},rc=class{constructor(t){this.parser=t,this.name=Z.KHR_MATERIALS_IOR}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=i.extensions[this.name];return e.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}},ic=class{constructor(t){this.parser=t,this.name=Z.KHR_MATERIALS_SPECULAR}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:THREE.MeshPhysicalMaterial}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];e.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&o.push(n.assignTexture(e,"specularIntensityMap",s.specularTexture));let a=s.specularColorFactor||[1,1,1];return e.specularColor=new THREE.Color(a[0],a[1],a[2]),s.specularColorTexture!==void 0&&o.push(n.assignTexture(e,"specularColorMap",s.specularColorTexture).then(function(p){p.encoding=THREE.sRGBEncoding})),Promise.all(o)}},oc=class{constructor(t){this.parser=t,this.name=Z.KHR_TEXTURE_BASISU}loadTexture(t){let e=this.parser,n=e.json,i=n.textures[t];if(!i.extensions||!i.extensions[this.name])return null;let o=i.extensions[this.name],s=n.images[o.source],a=e.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,s,a)}},sc=class{constructor(t){this.parser=t,this.name=Z.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){let e=this.name,n=this.parser,i=n.json,o=i.textures[t];if(!o.extensions||!o.extensions[e])return null;let s=o.extensions[e],a=i.images[s.source],p=n.textureLoader;if(a.uri){let d=n.options.manager.getHandler(a.uri);d!==null&&(p=d)}return this.detectSupport().then(function(d){if(d)return n.loadTextureImage(t,a,p);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){let e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}},ac=class{constructor(t){this.name=Z.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){let e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){let i=n.extensions[this.name],o=this.parser.getDependency("buffer",i.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([o,s.ready]).then(function(a){let p=i.byteOffset||0,d=i.byteLength||0,h=i.count,x=i.byteStride,A=new ArrayBuffer(h*x),E=new Uint8Array(a[0],p,d);return s.decodeGltfBuffer(new Uint8Array(A),h,x,E,i.mode,i.filter),A})}else return null}},Ah="glTF",Ao=12,uh={JSON:1313821514,BIN:5130562},lc=class{constructor(t){this.name=Z.KHR_BINARY_GLTF,this.content=null,this.body=null;let e=new DataView(t,0,Ao);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Ah)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let n=this.header.length-Ao,i=new DataView(t,Ao),o=0;for(;o<n;){let s=i.getUint32(o,!0);o+=4;let a=i.getUint32(o,!0);if(o+=4,a===uh.JSON){let p=new Uint8Array(t,Ao+o,s);this.content=THREE.LoaderUtils.decodeText(p)}else if(a===uh.BIN){let p=Ao+o;this.body=t.slice(p,p+s)}o+=s}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},pc=class{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Z.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){let n=this.json,i=this.dracoLoader,o=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,a={},p={},d={};for(let h in s){let x=hc[h]||h.toLowerCase();a[x]=s[h]}for(let h in t.attributes){let x=hc[h]||h.toLowerCase();if(s[h]!==void 0){let A=n.accessors[t.attributes[h]],E=Eo[A.componentType];d[x]=E,p[x]=A.normalized===!0}}return e.getDependency("bufferView",o).then(function(h){return new Promise(function(x){i.decodeDracoFile(h,function(A){for(let E in A.attributes){let S=A.attributes[E],P=p[E];P!==void 0&&(S.normalized=P)}x(A)},a,d)})})}},cc=class{constructor(){this.name=Z.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return e.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}},bo=class extends THREE.MeshStandardMaterial{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;let e=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new THREE.Color().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(p){for(let d in a)p.uniforms[d]=a[d];p.fragmentShader=p.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(p){a.specular.value=p}},specularMap:{get:function(){return a.specularMap.value},set:function(p){a.specularMap.value=p,p?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(p){a.glossiness.value=p}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(p){a.glossinessMap.value=p,p?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}},dc=class{constructor(){this.name=Z.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return bo}extendParams(t,e,n){let i=e.extensions[this.name];t.color=new THREE.Color(1,1,1),t.opacity=1;let o=[];if(Array.isArray(i.diffuseFactor)){let s=i.diffuseFactor;t.color.fromArray(s),t.opacity=s[3]}if(i.diffuseTexture!==void 0&&o.push(n.assignTexture(t,"map",i.diffuseTexture)),t.emissive=new THREE.Color(0,0,0),t.glossiness=i.glossinessFactor!==void 0?i.glossinessFactor:1,t.specular=new THREE.Color(1,1,1),Array.isArray(i.specularFactor)&&t.specular.fromArray(i.specularFactor),i.specularGlossinessTexture!==void 0){let s=i.specularGlossinessTexture;o.push(n.assignTexture(t,"glossinessMap",s)),o.push(n.assignTexture(t,"specularMap",s))}return Promise.all(o)}createMaterial(t){let e=new bo(t);return e.fog=!0,e.color=t.color,e.map=t.map===void 0?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=t.aoMap===void 0?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=t.emissiveMap===void 0?null:t.emissiveMap,e.bumpMap=t.bumpMap===void 0?null:t.bumpMap,e.bumpScale=1,e.normalMap=t.normalMap===void 0?null:t.normalMap,e.normalMapType=THREE.TangentSpaceNormalMap,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=t.specularMap===void 0?null:t.specularMap,e.specular=t.specular,e.glossinessMap=t.glossinessMap===void 0?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=t.envMap===void 0?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}},uc=class{constructor(){this.name=Z.KHR_MESH_QUANTIZATION}},rn=class extends THREE.Interpolant{constructor(t,e,n,i){super(t,e,n,i)}copySampleValue_(t){let e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=t*i*3+i;for(let s=0;s!==i;s++)e[s]=n[o+s];return e}};rn.prototype.beforeStart_=rn.prototype.copySampleValue_;rn.prototype.afterEnd_=rn.prototype.copySampleValue_;rn.prototype.interpolate_=function(r,t,e,n){let i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=s*2,p=s*3,d=n-t,h=(e-t)/d,x=h*h,A=x*h,E=r*p,S=E-p,P=-2*A+3*x,R=A-x,I=1-P,O=R-x+h;for(let L=0;L!==s;L++){let k=o[S+L+s],H=o[S+L+a]*d,V=o[E+L+s],D=o[E+L]*d;i[L]=I*k+O*H+P*V+R*D}return i};var sA=new THREE.Quaternion,mc=class extends rn{interpolate_(t,e,n,i){let o=super.interpolate_(t,e,n,i);return sA.fromArray(o).normalize().toArray(o),o}},nn={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Eo={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},mh={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},hh={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},fh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},hc={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ln={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},aA={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},Yp={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function lA(r){return r.DefaultMaterial===void 0&&(r.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),r.DefaultMaterial}function _o(r,t,e){for(let n in e.extensions)r[n]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=e.extensions[n])}function hr(r,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(r.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function pA(r,t,e){let n=!1,i=!1;for(let a=0,p=t.length;a<p;a++){let d=t[a];if(d.POSITION!==void 0&&(n=!0),d.NORMAL!==void 0&&(i=!0),n&&i)break}if(!n&&!i)return Promise.resolve(r);let o=[],s=[];for(let a=0,p=t.length;a<p;a++){let d=t[a];if(n){let h=d.POSITION!==void 0?e.getDependency("accessor",d.POSITION):r.attributes.position;o.push(h)}if(i){let h=d.NORMAL!==void 0?e.getDependency("accessor",d.NORMAL):r.attributes.normal;s.push(h)}}return Promise.all([Promise.all(o),Promise.all(s)]).then(function(a){let p=a[0],d=a[1];return n&&(r.morphAttributes.position=p),i&&(r.morphAttributes.normal=d),r.morphTargetsRelative=!0,r})}function cA(r,t){if(r.updateMorphTargets(),t.weights!==void 0)for(let e=0,n=t.weights.length;e<n;e++)r.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){let e=t.extras.targetNames;if(r.morphTargetInfluences.length===e.length){r.morphTargetDictionary={};for(let n=0,i=e.length;n<i;n++)r.morphTargetDictionary[e[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function dA(r){let t=r.extensions&&r.extensions[Z.KHR_DRACO_MESH_COMPRESSION],e;return t?e="draco:"+t.bufferView+":"+t.indices+":"+xh(t.attributes):e=r.indices+":"+xh(r.attributes)+":"+r.mode,e}function xh(r){let t="",e=Object.keys(r).sort();for(let n=0,i=e.length;n<i;n++)t+=e[n]+":"+r[e[n]]+";";return t}function fc(r){switch(r){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var xc=class{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new oA,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap<"u"&&/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!1?this.textureLoader=new THREE.ImageBitmapLoader(this.options.manager):this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){let n=this,i=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(s){let a={scene:s[0][i.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:i.asset,parser:n,userData:{}};_o(o,a,i),hr(a,i),Promise.all(n._invokeAll(function(p){return p.afterRoot&&p.afterRoot(a)})).then(function(){t(a)})}).catch(e)}_markDefs(){let t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[];for(let i=0,o=e.length;i<o;i++){let s=e[i].joints;for(let a=0,p=s.length;a<p;a++)t[s[a]].isBone=!0}for(let i=0,o=t.length;i<o;i++){let s=t[i];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(n[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,n){if(t.refs[e]<=1)return n;let i=n.clone(),o=(s,a)=>{let p=this.associations.get(s);p!=null&&this.associations.set(a,p);for(let[d,h]of s.children.entries())o(h,a.children[d])};return o(n,i),i.name+="_instance_"+t.uses[e]++,i}_invokeOne(t){let e=Object.values(this.plugins);e.push(this);for(let n=0;n<e.length;n++){let i=t(e[n]);if(i)return i}return null}_invokeAll(t){let e=Object.values(this.plugins);e.unshift(this);let n=[];for(let i=0;i<e.length;i++){let o=t(e[i]);o&&n.push(o)}return n}getDependency(t,e){let n=t+":"+e,i=this.cache.get(n);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this.loadNode(e);break;case"mesh":i=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(e)});break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(e)});break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(e)});break;case"texture":i=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(e)});break;case"skin":i=this.loadSkin(e);break;case"animation":i=this.loadAnimation(e);break;case"camera":i=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(n,i)}return i}getDependencies(t){let e=this.cache.get(t);if(!e){let n=this,i=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(i.map(function(o,s){return n.getDependency(t,s)})),this.cache.add(t,e)}return e}loadBuffer(t){let e=this.json.buffers[t],n=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[Z.KHR_BINARY_GLTF].body);let i=this.options;return new Promise(function(o,s){n.load(THREE.LoaderUtils.resolveURL(e.uri,i.path),o,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){let e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(n){let i=e.byteLength||0,o=e.byteOffset||0;return n.slice(o,o+i)})}loadAccessor(t){let e=this,n=this.json,i=this.json.accessors[t];if(i.bufferView===void 0&&i.sparse===void 0)return Promise.resolve(null);let o=[];return i.bufferView!==void 0?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),i.sparse!==void 0&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then(function(s){let a=s[0],p=fh[i.type],d=Eo[i.componentType],h=d.BYTES_PER_ELEMENT,x=h*p,A=i.byteOffset||0,E=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,S=i.normalized===!0,P,R;if(E&&E!==x){let I=Math.floor(A/E),O="THREE.InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+I+":"+i.count,L=e.cache.get(O);L||(P=new d(a,I*E,i.count*E/h),L=new THREE.InterleavedBuffer(P,E/h),e.cache.add(O,L)),R=new THREE.InterleavedBufferAttribute(L,p,A%E/h,S)}else a===null?P=new d(i.count*p):P=new d(a,A,i.count*p),R=new THREE.BufferAttribute(P,p,S);if(i.sparse!==void 0){let I=fh.SCALAR,O=Eo[i.sparse.indices.componentType],L=i.sparse.indices.byteOffset||0,k=i.sparse.values.byteOffset||0,H=new O(s[1],L,i.sparse.count*I),V=new d(s[2],k,i.sparse.count*p);a!==null&&(R=new THREE.BufferAttribute(R.array.slice(),R.itemSize,R.normalized));for(let D=0,te=H.length;D<te;D++){let K=H[D];if(R.setX(K,V[D*p]),p>=2&&R.setY(K,V[D*p+1]),p>=3&&R.setZ(K,V[D*p+2]),p>=4&&R.setW(K,V[D*p+3]),p>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.")}}return R})}loadTexture(t){let e=this.json,n=this.options,i=e.textures[t],o=e.images[i.source],s=this.textureLoader;if(o.uri){let a=n.manager.getHandler(o.uri);a!==null&&(s=a)}return this.loadTextureImage(t,o,s)}loadTextureImage(t,e,n){let i=this,o=this.json,s=this.options,a=o.textures[t],p=(e.uri||e.bufferView)+":"+a.sampler;if(this.textureCache[p])return this.textureCache[p];let d=self.URL||self.webkitURL,h=e.uri||"",x=!1;if(e.bufferView!==void 0)h=i.getDependency("bufferView",e.bufferView).then(function(E){x=!0;let S=new Blob([E],{type:e.mimeType});return h=d.createObjectURL(S),h});else if(e.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");let A=Promise.resolve(h).then(function(E){return new Promise(function(S,P){let R=S;n.isImageBitmapLoader===!0&&(R=function(I){let O=new THREE.Texture(I);O.needsUpdate=!0,S(O)}),n.load(THREE.LoaderUtils.resolveURL(E,s.path),R,void 0,P)})}).then(function(E){x===!0&&d.revokeObjectURL(h),E.flipY=!1,a.name&&(E.name=a.name);let P=(o.samplers||{})[a.sampler]||{};return E.magFilter=mh[P.magFilter]||THREE.LinearFilter,E.minFilter=mh[P.minFilter]||THREE.LinearMipmapLinearFilter,E.wrapS=hh[P.wrapS]||THREE.RepeatWrapping,E.wrapT=hh[P.wrapT]||THREE.RepeatWrapping,i.associations.set(E,{textures:t}),E}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",h),null});return this.textureCache[p]=A,A}assignTexture(t,e,n){let i=this;return this.getDependency("texture",n.index).then(function(o){if(n.texCoord!==void 0&&n.texCoord!=0&&!(e==="aoMap"&&n.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+e+" not yet supported."),i.extensions[Z.KHR_TEXTURE_TRANSFORM]){let s=n.extensions!==void 0?n.extensions[Z.KHR_TEXTURE_TRANSFORM]:void 0;if(s){let a=i.associations.get(o);o=i.extensions[Z.KHR_TEXTURE_TRANSFORM].extendTexture(o,s),i.associations.set(o,a)}}return t[e]=o,o})}assignFinalMaterial(t){let e=t.geometry,n=t.material,i=e.attributes.tangent===void 0,o=e.attributes.color!==void 0,s=e.attributes.normal===void 0;if(t.isPoints){let a="THREE.PointsMaterial:"+n.uuid,p=this.cache.get(a);p||(p=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(p,n),p.color.copy(n.color),p.map=n.map,p.sizeAttenuation=!1,this.cache.add(a,p)),n=p}else if(t.isLine){let a="THREE.LineBasicMaterial:"+n.uuid,p=this.cache.get(a);p||(p=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(p,n),p.color.copy(n.color),this.cache.add(a,p)),n=p}if(i||o||s){let a="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(a+="specular-glossiness:"),i&&(a+="derivative-tangents:"),o&&(a+="vertex-colors:"),s&&(a+="flat-shading:");let p=this.cache.get(a);p||(p=n.clone(),o&&(p.vertexColors=!0),s&&(p.flatShading=!0),i&&(p.normalScale&&(p.normalScale.y*=-1),p.clearcoatNormalScale&&(p.clearcoatNormalScale.y*=-1)),this.cache.add(a,p),this.associations.set(p,this.associations.get(n))),n=p}n.aoMap&&e.attributes.uv2===void 0&&e.attributes.uv!==void 0&&e.setAttribute("uv2",e.attributes.uv),t.material=n}getMaterialType(){return THREE.MeshStandardMaterial}loadMaterial(t){let e=this,n=this.json,i=this.extensions,o=n.materials[t],s,a={},p=o.extensions||{},d=[];if(p[Z.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){let x=i[Z.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=x.getMaterialType(),d.push(x.extendParams(a,o,e))}else if(p[Z.KHR_MATERIALS_UNLIT]){let x=i[Z.KHR_MATERIALS_UNLIT];s=x.getMaterialType(),d.push(x.extendParams(a,o,e))}else{let x=o.pbrMetallicRoughness||{};if(a.color=new THREE.Color(1,1,1),a.opacity=1,Array.isArray(x.baseColorFactor)){let A=x.baseColorFactor;a.color.fromArray(A),a.opacity=A[3]}x.baseColorTexture!==void 0&&d.push(e.assignTexture(a,"map",x.baseColorTexture)),a.metalness=x.metallicFactor!==void 0?x.metallicFactor:1,a.roughness=x.roughnessFactor!==void 0?x.roughnessFactor:1,x.metallicRoughnessTexture!==void 0&&(d.push(e.assignTexture(a,"metalnessMap",x.metallicRoughnessTexture)),d.push(e.assignTexture(a,"roughnessMap",x.metallicRoughnessTexture))),s=this._invokeOne(function(A){return A.getMaterialType&&A.getMaterialType(t)}),d.push(Promise.all(this._invokeAll(function(A){return A.extendMaterialParams&&A.extendMaterialParams(t,a)})))}o.doubleSided===!0&&(a.side=THREE.DoubleSide);let h=o.alphaMode||Yp.OPAQUE;if(h===Yp.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===Yp.MASK&&(a.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&s!==THREE.MeshBasicMaterial&&(d.push(e.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new THREE.Vector2(1,1),o.normalTexture.scale!==void 0)){let x=o.normalTexture.scale;a.normalScale.set(x,x)}return o.occlusionTexture!==void 0&&s!==THREE.MeshBasicMaterial&&(d.push(e.assignTexture(a,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&s!==THREE.MeshBasicMaterial&&(a.emissive=new THREE.Color().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&s!==THREE.MeshBasicMaterial&&d.push(e.assignTexture(a,"emissiveMap",o.emissiveTexture)),Promise.all(d).then(function(){let x;return s===bo?x=i[Z.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):x=new s(a),o.name&&(x.name=o.name),x.map&&(x.map.encoding=THREE.sRGBEncoding),x.emissiveMap&&(x.emissiveMap.encoding=THREE.sRGBEncoding),hr(x,o),e.associations.set(x,{materials:t}),o.extensions&&_o(i,x,o),x})}createUniqueName(t){let e=THREE.PropertyBinding.sanitizeNodeName(t||""),n=e;for(let i=1;this.nodeNamesUsed[n];++i)n=e+"_"+i;return this.nodeNamesUsed[n]=!0,n}loadGeometries(t){let e=this,n=this.extensions,i=this.primitiveCache;function o(a){return n[Z.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,e).then(function(p){return gh(p,a,e)})}let s=[];for(let a=0,p=t.length;a<p;a++){let d=t[a],h=dA(d),x=i[h];if(x)s.push(x.promise);else{let A;d.extensions&&d.extensions[Z.KHR_DRACO_MESH_COMPRESSION]?A=o(d):A=gh(new THREE.BufferGeometry,d,e),i[h]={primitive:d,promise:A},s.push(A)}}return Promise.all(s)}loadMesh(t){let e=this,n=this.json,i=this.extensions,o=n.meshes[t],s=o.primitives,a=[];for(let p=0,d=s.length;p<d;p++){let h=s[p].material===void 0?lA(this.cache):this.getDependency("material",s[p].material);a.push(h)}return a.push(e.loadGeometries(s)),Promise.all(a).then(function(p){let d=p.slice(0,p.length-1),h=p[p.length-1],x=[];for(let E=0,S=h.length;E<S;E++){let P=h[E],R=s[E],I,O=d[E];if(R.mode===nn.TRIANGLES||R.mode===nn.TRIANGLE_STRIP||R.mode===nn.TRIANGLE_FAN||R.mode===void 0)I=o.isSkinnedMesh===!0?new THREE.SkinnedMesh(P,O):new THREE.Mesh(P,O),I.isSkinnedMesh===!0&&!I.geometry.attributes.skinWeight.normalized&&I.normalizeSkinWeights(),R.mode===nn.TRIANGLE_STRIP?I.geometry=vh(I.geometry,THREE.TriangleStripDrawMode):R.mode===nn.TRIANGLE_FAN&&(I.geometry=vh(I.geometry,THREE.TriangleFanDrawMode));else if(R.mode===nn.LINES)I=new THREE.LineSegments(P,O);else if(R.mode===nn.LINE_STRIP)I=new THREE.Line(P,O);else if(R.mode===nn.LINE_LOOP)I=new THREE.LineLoop(P,O);else if(R.mode===nn.POINTS)I=new THREE.Points(P,O);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+R.mode);Object.keys(I.geometry.morphAttributes).length>0&&cA(I,o),I.name=e.createUniqueName(o.name||"mesh_"+t),hr(I,o),R.extensions&&_o(i,I,R),e.assignFinalMaterial(I),x.push(I)}for(let E=0,S=x.length;E<S;E++)e.associations.set(x[E],{meshes:t,primitives:E});if(x.length===1)return x[0];let A=new THREE.Group;e.associations.set(A,{meshes:t});for(let E=0,S=x.length;E<S;E++)A.add(x[E]);return A})}loadCamera(t){let e,n=this.json.cameras[t],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?e=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(e=new THREE.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),hr(e,n),Promise.resolve(e)}loadSkin(t){let e=this.json.skins[t],n={joints:e.joints};return e.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then(function(i){return n.inverseBindMatrices=i,n})}loadAnimation(t){let n=this.json.animations[t],i=[],o=[],s=[],a=[],p=[];for(let d=0,h=n.channels.length;d<h;d++){let x=n.channels[d],A=n.samplers[x.sampler],E=x.target,S=E.node!==void 0?E.node:E.id,P=n.parameters!==void 0?n.parameters[A.input]:A.input,R=n.parameters!==void 0?n.parameters[A.output]:A.output;i.push(this.getDependency("node",S)),o.push(this.getDependency("accessor",P)),s.push(this.getDependency("accessor",R)),a.push(A),p.push(E)}return Promise.all([Promise.all(i),Promise.all(o),Promise.all(s),Promise.all(a),Promise.all(p)]).then(function(d){let h=d[0],x=d[1],A=d[2],E=d[3],S=d[4],P=[];for(let I=0,O=h.length;I<O;I++){let L=h[I],k=x[I],H=A[I],V=E[I],D=S[I];if(L===void 0)continue;L.updateMatrix(),L.matrixAutoUpdate=!0;let te;switch(Ln[D.path]){case Ln.weights:te=THREE.NumberKeyframeTrack;break;case Ln.rotation:te=THREE.QuaternionKeyframeTrack;break;case Ln.position:case Ln.scale:default:te=THREE.VectorKeyframeTrack;break}let K=L.name?L.name:L.uuid,z=V.interpolation!==void 0?aA[V.interpolation]:THREE.InterpolateLinear,J=[];Ln[D.path]===Ln.weights?L.traverse(function(Ae){Ae.morphTargetInfluences&&J.push(Ae.name?Ae.name:Ae.uuid)}):J.push(K);let ye=H.array;if(H.normalized){let Ae=fc(ye.constructor),ae=new Float32Array(ye.length);for(let tt=0,Vr=ye.length;tt<Vr;tt++)ae[tt]=ye[tt]*Ae;ye=ae}for(let Ae=0,ae=J.length;Ae<ae;Ae++){let tt=new te(J[Ae]+"."+Ln[D.path],k.array,ye,z);V.interpolation==="CUBICSPLINE"&&(tt.createInterpolant=function(un){let zt=this instanceof THREE.QuaternionKeyframeTrack?mc:rn;return new zt(this.times,this.values,this.getValueSize()/3,un)},tt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),P.push(tt)}}let R=n.name?n.name:"animation_"+t;return new THREE.AnimationClip(R,void 0,P)})}createNodeMesh(t){let e=this.json,n=this,i=e.nodes[t];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(o){let s=n._getNodeRef(n.meshCache,i.mesh,o);return i.weights!==void 0&&s.traverse(function(a){if(!!a.isMesh)for(let p=0,d=i.weights.length;p<d;p++)a.morphTargetInfluences[p]=i.weights[p]}),s})}loadNode(t){let e=this.json,n=this.extensions,i=this,o=e.nodes[t],s=o.name?i.createUniqueName(o.name):"";return function(){let a=[],p=i._invokeOne(function(d){return d.createNodeMesh&&d.createNodeMesh(t)});return p&&a.push(p),o.camera!==void 0&&a.push(i.getDependency("camera",o.camera).then(function(d){return i._getNodeRef(i.cameraCache,o.camera,d)})),i._invokeAll(function(d){return d.createNodeAttachment&&d.createNodeAttachment(t)}).forEach(function(d){a.push(d)}),Promise.all(a)}().then(function(a){let p;if(o.isBone===!0?p=new THREE.Bone:a.length>1?p=new THREE.Group:a.length===1?p=a[0]:p=new THREE.Object3D,p!==a[0])for(let d=0,h=a.length;d<h;d++)p.add(a[d]);if(o.name&&(p.userData.name=o.name,p.name=s),hr(p,o),o.extensions&&_o(n,p,o),o.matrix!==void 0){let d=new THREE.Matrix4;d.fromArray(o.matrix),p.applyMatrix4(d)}else o.translation!==void 0&&p.position.fromArray(o.translation),o.rotation!==void 0&&p.quaternion.fromArray(o.rotation),o.scale!==void 0&&p.scale.fromArray(o.scale);return i.associations.has(p)||i.associations.set(p,{}),i.associations.get(p).nodes=t,p})}loadScene(t){let e=this.json,n=this.extensions,i=this.json.scenes[t],o=this,s=new THREE.Group;i.name&&(s.name=o.createUniqueName(i.name)),hr(s,i),i.extensions&&_o(n,s,i);let a=i.nodes||[],p=[];for(let d=0,h=a.length;d<h;d++)p.push(_h(a[d],s,e,o));return Promise.all(p).then(function(){let d=h=>{let x=new Map;for(let[A,E]of o.associations)(A instanceof THREE.Material||A instanceof THREE.Texture)&&x.set(A,E);return h.traverse(A=>{let E=o.associations.get(A);E!=null&&x.set(A,E)}),x};return o.associations=d(s),s})}};function _h(r,t,e,n){let i=e.nodes[r];return n.getDependency("node",r).then(function(o){if(i.skin===void 0)return o;let s;return n.getDependency("skin",i.skin).then(function(a){s=a;let p=[];for(let d=0,h=s.joints.length;d<h;d++)p.push(n.getDependency("node",s.joints[d]));return Promise.all(p)}).then(function(a){return o.traverse(function(p){if(!p.isMesh)return;let d=[],h=[];for(let x=0,A=a.length;x<A;x++){let E=a[x];if(E){d.push(E);let S=new THREE.Matrix4;s.inverseBindMatrices!==void 0&&S.fromArray(s.inverseBindMatrices.array,x*16),h.push(S)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[x])}p.bind(new THREE.Skeleton(d,h),p.matrixWorld)}),o})}).then(function(o){t.add(o);let s=[];if(i.children){let a=i.children;for(let p=0,d=a.length;p<d;p++){let h=a[p];s.push(_h(h,o,e,n))}}return Promise.all(s)})}function uA(r,t,e){let n=t.attributes,i=new THREE.Box3;if(n.POSITION!==void 0){let a=e.json.accessors[n.POSITION],p=a.min,d=a.max;if(p!==void 0&&d!==void 0){if(i.set(new THREE.Vector3(p[0],p[1],p[2]),new THREE.Vector3(d[0],d[1],d[2])),a.normalized){let h=fc(Eo[a.componentType]);i.min.multiplyScalar(h),i.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let o=t.targets;if(o!==void 0){let a=new THREE.Vector3,p=new THREE.Vector3;for(let d=0,h=o.length;d<h;d++){let x=o[d];if(x.POSITION!==void 0){let A=e.json.accessors[x.POSITION],E=A.min,S=A.max;if(E!==void 0&&S!==void 0){if(p.setX(Math.max(Math.abs(E[0]),Math.abs(S[0]))),p.setY(Math.max(Math.abs(E[1]),Math.abs(S[1]))),p.setZ(Math.max(Math.abs(E[2]),Math.abs(S[2]))),A.normalized){let P=fc(Eo[A.componentType]);p.multiplyScalar(P)}a.max(p)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}r.boundingBox=i;let s=new THREE.Sphere;i.getCenter(s.center),s.radius=i.min.distanceTo(i.max)/2,r.boundingSphere=s}function gh(r,t,e){let n=t.attributes,i=[];function o(s,a){return e.getDependency("accessor",s).then(function(p){r.setAttribute(a,p)})}for(let s in n){let a=hc[s]||s.toLowerCase();a in r.attributes||i.push(o(n[s],a))}if(t.indices!==void 0&&!r.index){let s=e.getDependency("accessor",t.indices).then(function(a){r.setIndex(a)});i.push(s)}return hr(r,t),uA(r,t,e),Promise.all(i).then(function(){return t.targets!==void 0?pA(r,t.targets,e):r})}function vh(r,t){let e=r.getIndex();if(e===null){let s=[],a=r.getAttribute("position");if(a!==void 0){for(let p=0;p<a.count;p++)s.push(p);r.setIndex(s),e=r.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),r}let n=e.count-2,i=[];if(t===THREE.TriangleFanDrawMode)for(let s=1;s<=n;s++)i.push(e.getX(0)),i.push(e.getX(s)),i.push(e.getX(s+1));else for(let s=0;s<n;s++)s%2===0?(i.push(e.getX(s)),i.push(e.getX(s+1)),i.push(e.getX(s+2))):(i.push(e.getX(s+2)),i.push(e.getX(s+1)),i.push(e.getX(s)));i.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let o=r.clone();return o.setIndex(i),o}var gc=class extends Xr{constructor(t,e,n){if(!ss.matches(e)&&!tu.matches(e))throw new Error("Only GLTF model types are currently supported");super(t,e,n)}async getResponse(t){let e=await t.file();return De(e,n=>gc.loader.loadAsync(n))}},yo=gc;yo.loader=new kn;function ba(r){return!(r.shiftKey||r.altKey||r.ctrlKey||r.metaKey)}var _a=class{constructor(t,e,n){this.name=t;this.callback=e;if(!pe(e))throw new Error("A function instance is required for this parameter");this.opts=n,Object.freeze(this)}applyToElement(t){this.add(t)}add(t){t.addEventListener(this.name,this.callback,this.opts)}remove(t){t.removeEventListener(this.name,this.callback)}};function bh(r,t){return new _a("click",r,t)}function fi(r,t){return new _a("input",r,t)}var Ea=class extends j{constructor(){super("avatarmoved");this.px=0;this.py=0;this.pz=0;this.fx=0;this.fy=0;this.fz=0;this.ux=0;this.uy=0;this.uz=0;this.height=0;this.changed=!1;this.pointerID=0}set(e,n,i,o,s,a,p,d,h,x){this.changed=this.px!==e||this.py!==n||this.pz!==i||this.fx!==o||this.fy!==s||this.fz!==a||this.ux!==p||this.uy!==d||this.uz!==h,this.px=e,this.py=n,this.pz=i,this.fx=o,this.fy=s,this.fz=a,this.ux=p,this.uy=d,this.uz=h,this.height=x}};function fr(r,t){return r.xr.isPresenting?r.xr.getCamera():t}function Eh(r,t,e,n,i){let o=r.elements;t.set(o[0],o[1],o[2]),e.set(o[4],o[5],o[6]),n.set(-o[8],-o[9],-o[10]),i.set(o[12],o[13],o[14]),t.normalize(),e.normalize(),n.normalize()}function mA(r){return r===DeviceOrientationEvent&&"requestPermission"in r&&pe(r.requestPermission)}var ya=class extends q{constructor(e,n,i){super();this.env=e;this.controlMode="none";this.snapTurnAngle=Fe(30);this.sensitivities=new Map([["mousedrag",100],["mousefirstperson",-100],["touchswipe",50],["gamepad",1]]);this.B=new THREE.Vector3(0,0,1);this.R=new THREE.Vector3;this.F=new THREE.Vector3;this.U=new THREE.Vector3;this.P=new THREE.Vector3;this.M=new THREE.Matrix4;this.E=new THREE.Euler;this.Q1=new THREE.Quaternion;this.Q2=new THREE.Quaternion;this.Q3=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));this.Q4=new THREE.Quaternion;this.motion=new THREE.Vector2;this.rotStage=new THREE.Matrix4;this.userMovedEvt=new Ea;this.acceleration=new THREE.Vector2(2,2);this.speed=new THREE.Vector2(3,2);this.axisControl=new THREE.Vector2(0,0);this.deviceQ=new THREE.Quaternion().identity();this.uv=new THREE.Vector2;this.duv=new THREE.Vector2;this.move=new THREE.Vector3;this.move2=new THREE.Vector3;this.followers=new Array;this.dz=0;this._heading=0;this._pitch=0;this._roll=0;this.headX=0;this.headZ=0;this._worldHeading=0;this._worldPitch=0;this.fwrd=!1;this.back=!1;this.left=!1;this.rght=!1;this.fwrd2=!1;this.back2=!1;this.left2=!1;this.rght2=!1;this.up=!1;this.down=!1;this.grow=!1;this.shrk=!1;this._keyboardControlEnabled=!1;this.worldPos=new THREE.Vector3;this.worldQuat=new THREE.Quaternion;this.fovZoomEnabled=!0;this.minFOV=15;this.maxFOV=120;this.minimumX=-85*Math.PI/180;this.maximumX=85*Math.PI/180;this.edgeFactor=1/3;this.deviceOrientation=null;this.screenOrientation=0;this.alphaOffset=0;this.onDeviceOrientationChangeEvent=null;this.onScreenOrientationChangeEvent=null;this.motionEnabled=!1;this.disableHorizontal=!1,this.disableVertical=!1,this.invertHorizontal=!1,this.invertVertical=!0,this._height=i,this.head=se("Head",n);let o=(s,a)=>{s==="w"&&(this.fwrd=a),s==="s"&&(this.back=a),s==="a"&&(this.left=a),s==="d"&&(this.rght=a),s==="e"&&(this.up=a),s==="q"&&(this.down=a),s==="ArrowUp"&&(this.fwrd2=a),s==="ArrowDown"&&(this.back2=a),s==="ArrowLeft"&&(this.left2=a),s==="ArrowRight"&&(this.rght2=a),s==="r"&&(this.grow=a),s==="f"&&(this.shrk=a)};this.onKeyDown=s=>o(s.key,ba(s)),this.onKeyUp=s=>o(s.key,!1),this.keyboardControlEnabled=!0,matchMedia("(pointer: coarse)").matches?this.controlMode="touchswipe":matchMedia("(pointer: fine)").matches&&(this.controlMode="mousedrag"),globalThis.isSecureContext&&Wi()&&!Ut()&&(this.onDeviceOrientationChangeEvent=s=>{this.deviceOrientation=s},this.onScreenOrientationChangeEvent=()=>{Q(globalThis.orientation)||(this.screenOrientation=globalThis.orientation||0)},this.startMotionControl())}set disableVertical(e){this._disableVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set invertVertical(e){this._invertVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set disableHorizontal(e){this._disableHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}set invertHorizontal(e){this._invertHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}get height(){return this.head.position.y}get object(){return this.head}get worldHeading(){return this._worldHeading}get worldPitch(){return this._worldPitch}get fov(){return this.env.camera.fov}set fov(e){e!==this.fov&&(this.env.camera.fov=e,this.env.camera.updateProjectionMatrix())}get stage(){return this.head.parent}snapTurn(e){this.setHeading(this.heading-this.snapTurnAngle*e)}get keyboardControlEnabled(){return this._keyboardControlEnabled}set keyboardControlEnabled(e){this._keyboardControlEnabled!==e&&(this._keyboardControlEnabled=e,this._keyboardControlEnabled?(globalThis.addEventListener("keydown",this.onKeyDown),globalThis.addEventListener("keyup",this.onKeyUp)):(globalThis.removeEventListener("keydown",this.onKeyDown),globalThis.removeEventListener("keyup",this.onKeyUp)))}addFollower(e){this.followers.push(e)}onMove(e,n,i){this.setMode(e),e.canMoveView&&this.controlMode!=="none"&&this.gestureSatisfied(e)&&(this.uv.copy(n),this.duv.copy(i))}setMode(e){e.type==="remote"||(e.type==="hand"?this.controlMode="none":e.type==="gamepad"?this.controlMode="gamepad":e.rayTarget&&e.rayTarget.draggable&&!this.env.pointers.mouse.isPointerLocked&&e.isPressed(0)?this.controlMode="mouseedge":e.type==="touch"||e.type==="pen"?this.controlMode="touchswipe":e.type==="mouse"?this.controlMode=this.env.pointers.mouse.isPointerLocked?"mousefirstperson":"mousedrag":de(e.type))}gestureSatisfied(e){return this.controlMode==="none"?!1:this.controlMode==="gamepad"||this.controlMode==="mousefirstperson"||this.controlMode==="mouseedge"||e.isPressed(0)}get name(){return this.object.name}set name(e){this.object.name=e}get heading(){return this._heading}setHeading(e){this._heading=gn(e)}get pitch(){return this._pitch}setPitch(e,n,i){this._pitch=gn(e+Math.PI)-Math.PI,this._pitch=Wt(this._pitch,n,i)}get roll(){return this._roll}setRoll(e){this._roll=gn(e)}setHeadingImmediate(e){this.setHeading(e),this.updateOrientation(),this.resetFollowers()}setOrientationImmediate(e,n){this.setHeading(e),this._pitch=gn(n),this.updateOrientation()}zoom(e){this.dz=e}update(e){if(this.fovZoomEnabled&&Math.abs(this.dz)>0){let o=Math.pow(.95,5*e);this.dz=Dd(o*this.dz),this.fov=Wt(this.env.camera.fov-this.dz,this.minFOV,this.maxFOV)}e*=.001;let n=this.deviceOrientation;if(n&&Ue(n.alpha)&&Ue(n.beta)&&Ue(n.gamma)){let o=Fe(n.alpha)+this.alphaOffset,s=Fe(n.beta),a=Fe(n.gamma),p=this.screenOrientation?Fe(this.screenOrientation):0;this.E.set(s,o,-a,"YXZ"),this.Q2.setFromAxisAngle(this.B,-p),this.Q4.setFromEuler(this.E).multiply(this.Q3).multiply(this.Q2),this.deviceQ.slerp(this.Q4,.8)}if(this.controlMode==="mouseedge")this.uv.manhattanLength()>0&&(this.motion.set(this.scaleRadialComponent(-this.uv.x,this.speed.x,this.acceleration.x),this.scaleRadialComponent(this.uv.y,this.speed.y,this.acceleration.y)).multiplyScalar(e),this.setHeading(this.heading+this.motion.x),this.setPitch(this.pitch+this.motion.y,this.minimumX,this.maximumX),this.setRoll(0));else if(this.sensitivities.has(this.controlMode)&&this.duv.manhattanLength()>0){let o=this.sensitivities.get(this.controlMode)||1;this.motion.copy(this.duv).multiplyScalar(o*e).multiply(this.axisControl),this.setHeading(this.heading+this.motion.x),this.setPitch(this.pitch+this.motion.y,this.minimumX,this.maximumX),this.setRoll(0)}if(this.Q1.setFromAxisAngle(this.stage.up,this.worldHeading),this.fwrd||this.back||this.left||this.rght||this.up||this.down){let o=(this.left?1:0)+(this.rght?-1:0),s=(this.down?1:0)+(this.up?-1:0),a=(this.fwrd?1:0)+(this.back?-1:0);this.move.set(o,s,a);let p=this.move.length();p>0&&(this.move.multiplyScalar(e/p).applyQuaternion(this.Q1),this.stage.position.add(this.move))}if(this.fwrd2||this.back2||this.left2||this.rght2){let o=(this.left2?1:0)+(this.rght2?-1:0),s=(this.fwrd2?1:0)+(this.back2?-1:0);this.move2.set(o,0,s);let a=this.move2.length();a>0&&(this.move2.multiplyScalar(e/a).applyQuaternion(this.Q1),this.headX+=this.move2.x,this.headZ+=this.move2.z)}if(this.grow||this.shrk){let o=(this.shrk?-1:0)+(this.grow?1:0);this._height+=o*e,this._height=Wt(this._height,1,2)}this.updateOrientation(),this.userMovedEvt.set(this.P.x,this.P.y,this.P.z,this.F.x,this.F.y,this.F.z,this.U.x,this.U.y,this.U.z,this.height),this.dispatchEvent(this.userMovedEvt);let i=Math.pow(.95,100*e);this.duv.multiplyScalar(i),this.duv.manhattanLength()<=1e-4&&this.duv.setScalar(0)}scaleRadialComponent(e,n,i){let o=Math.abs(e);return Math.sign(e)*Math.pow(Math.max(0,o-this.edgeFactor)/(1-this.edgeFactor),i)*n}updateOrientation(){let e=fr(this.env.renderer,this.env.camera);this.rotStage.makeRotationY(this._heading),this.stage.matrix.makeTranslation(this.stage.position.x,this.stage.position.y,this.stage.position.z).multiply(this.rotStage),this.stage.matrix.decompose(this.stage.position,this.stage.quaternion,this.stage.scale),this.env.renderer.xr.isPresenting?(this.M.copy(this.stage.matrixWorld).invert(),this.head.position.copy(e.position).applyMatrix4(this.M),this.head.quaternion.copy(this.stage.quaternion).invert().multiply(e.quaternion)):(this.head.position.set(this.headX,this._height,this.headZ),this.E.set(this._pitch,0,this._roll,"XYZ"),this.head.quaternion.setFromEuler(this.E).premultiply(this.deviceQ)),this.env.camera.position.copy(this.head.position),this.env.camera.quaternion.copy(this.head.quaternion),this.head.getWorldPosition(this.worldPos),this.head.getWorldQuaternion(this.worldQuat),this.F.set(0,0,-1).applyQuaternion(this.worldQuat),this._worldHeading=xa(this.F),this._worldPitch=ph(this.F),Eh(this.head.matrixWorld,this.R,this.U,this.F,this.P)}reset(){this.stage.position.setScalar(0),this.setHeadingImmediate(0)}resetFollowers(){for(let e of this.followers)e.reset(this.height,this.worldPos,this.worldHeading)}async getPermission(){return"DeviceOrientationEvent"in globalThis?mA(DeviceOrientationEvent)?await DeviceOrientationEvent.requestPermission():"granted":"not-supported"}async startMotionControl(){if(!this.motionEnabled){this.onScreenOrientationChangeEvent();let e=await this.getPermission();this.motionEnabled=e==="granted",this.motionEnabled&&(globalThis.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),globalThis.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}}stopMotionControl(){this.motionEnabled&&(globalThis.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),globalThis.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.motionEnabled=!1)}dispose(){this.stopMotionControl()}};var wa=0;var xi=3;function yh(r,t){r=Qe(r),r.traverse(e=>e.layers.set(t))}function wh(r,t){r=Qe(r),r.traverse(e=>e.layers.enable(t))}var gi=new THREE.Vector3;function Th(r,t,e,n){gi.crossVectors(t,r),r.crossVectors(gi,t),gi.normalize(),r.normalize(),t.normalize(),n.set(gi.x,r.x,-t.x,e.x,gi.y,r.y,-t.y,e.y,gi.z,r.z,-t.z,e.z,0,0,0,1)}var Dt=class{constructor(t){this.env=t;this._object=null;this._visible=!0;this._style="default";this.T=new THREE.Vector3;this.V=new THREE.Vector3;this.Q=new THREE.Quaternion}get object(){return this._object}set object(t){this._object=t}get style(){return this._style}set style(t){this._style=t}get visible(){return this._visible}set visible(t){this._visible=t}update(t,e,n,i,o,s,a,p,d,h,x){n&&n.face?(this.position.copy(n.point),n.object.getWorldQuaternion(this.Q),this.T.copy(n.face.normal).applyQuaternion(this.Q),this.V.copy(this.T).multiplyScalar(.02),this.position.add(this.V),this.V.copy(this.T).multiplyScalar(10).add(this.position)):(s?this.position.copy(h).multiplyScalar(2).add(d).sub(this.env.avatar.worldPos).normalize().multiplyScalar(o).add(this.env.avatar.worldPos):(this.V.copy(d).add(e).sub(t).multiplyScalar(2),this.position.copy(h).multiplyScalar(o).add(this.V).add(this.env.avatar.worldPos)),this.V.copy(this.env.avatar.worldPos)),this.lookAt(this.position,this.V),this.style=!i||i.navigable&&!p?a?x?"grabbing":"grab":"default":i.enabled?i.draggable?x?"grabbing":"move":i.navigable?"cell":i.clickable?"pointer":"default":"not-allowed"}lookAt(t,e){}};var vi=class extends Dt{constructor(e,n){super(e);this.cursorSystem=null;this.f=new THREE.Vector3;this.up=new THREE.Vector3;this.right=new THREE.Vector3;this.object=se("Cursor3D"),this.cursorSystem=n,this.object.matrixAutoUpdate=!1}add(e,n){U(this,n),wh(n,xi),n.visible=e==="default"}get position(){return this.object.position}get style(){for(let e of this.object.children)if(e.visible)return e.name;return null}set style(e){for(let n of this.object.children)n.visible=n.name===e;if(this.style==null&&this.object.children.length>0){let n=ut(this.object.children,i=>i.name==="default",i=>i!=null);n!=null&&(n.visible=!0)}this.cursorSystem&&(this.cursorSystem.style="none")}get visible(){return wn(this)}set visible(e){Me(this,e)}lookAt(e,n){this.f.copy(n).sub(e).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat),this.right.crossVectors(this.up,this.f),this.up.crossVectors(this.f,this.right),Th(this.up,this.f,e,this.object.matrixWorld),this.object.matrix.copy(this.object.parent.matrixWorld).invert().multiply(this.object.matrixWorld).decompose(this.object.position,this.object.quaternion,this.object.scale)}clone(){let e=new vi(this.env);for(let n of this.object.children)e.add(n.name,n.clone());return e}};var Ta=class extends j{constructor(e,n){super(e);this.button=n}},vc=class extends Ta{constructor(t){super("gamepadbuttonup",t)}},Ac=class extends Ta{constructor(t){super("gamepadbuttondown",t)}},_c=class extends j{constructor(e,n,i){super(e);this.axis=n;this.value=i}},bc=class extends _c{constructor(t,e){super("gamepadaxismaxed",t,e)}},Ma=class extends q{constructor(){super();this.lastAxisValues=new Array;this.btnDownEvts=new Array;this.btnUpEvts=new Array;this.wasPressed=new Array;this.axisMaxEvts=new Array;this.wasAxisMaxed=new Array;this.sticks=new Array;this.axisThresholdMax=.9;this.axisThresholdMin=.1;this._pad=null;Object.seal(this)}get displayId(){if("displayId"in this.pad)return this.pad.displayId}get pad(){return this._pad}set pad(e){if(this._pad=e,this.pad){if(this.btnUpEvts.length===0){for(let n=0;n<e.buttons.length;++n)this.btnDownEvts[n]=new Ac(n),this.btnUpEvts[n]=new vc(n),this.wasPressed[n]=!1;for(let n=0;n<e.axes.length;++n)this.axisMaxEvts[n]=new bc(n,0),this.wasAxisMaxed[n]=!1,n%2===0&&n<e.axes.length-1&&(this.sticks[n/2]={x:0,y:0}),this.lastAxisValues[n]=e.axes[n]}for(let n=0;n<this.pad.buttons.length;++n){let i=this.wasPressed[n],o=this.pad.buttons[n].pressed;o!==i&&(this.wasPressed[n]=o,this.dispatchEvent((o?this.btnDownEvts:this.btnUpEvts)[n]))}for(let n=0;n<this.pad.axes.length;++n){let i=this.wasAxisMaxed[n],o=this.pad.axes[n],s=Math.sign(o),a=Math.abs(o),p=a>=this.axisThresholdMax,d=a<=this.axisThresholdMin,h=s*(p?1:d?0:a);p&&!i&&(this.axisMaxEvts[n].value=h,this.dispatchEvent(this.axisMaxEvts[n])),this.wasAxisMaxed[n]=p,this.lastAxisValues[n]=h}for(let n=0;n<this.axes.length-1;n+=2){let i=this.sticks[n/2];i.x=this.axes[n],i.y=this.axes[n+1]}}}get id(){return this.pad?this.pad.id:null}get index(){return this.pad?this.pad.index:null}get connected(){return this.pad&&this.pad.connected}get mapping(){return this.pad?this.pad.mapping:null}get timestamp(){return this.pad?this.pad.timestamp:null}get hand(){return this.pad?this.pad.hand:null}get pose(){return this.pad?this.pad.pose:null}get buttons(){return this.pad?this.pad.buttons:null}get axes(){return this.pad?this.pad.axes:null}get hapticActuators(){return this.pad?this.pad.hapticActuators:null}};var ve={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function Mh(r){let t=await fetch(r);if(t.ok)return t.json();throw new Error(t.statusText)}async function hA(r){if(!r)throw new Error("No basePath supplied");return await Mh(`${r}/profilesList.json`)}async function Sh(r,t,e=null,n=!0){if(!r)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");let i=await hA(t),o;if(r.profiles.some(p=>{let d=i[p];return d&&(o={profileId:p,profilePath:`${t}/${d.path}`,deprecated:!!d.deprecated}),!!o}),!o){if(!e)throw new Error("No matching profile name found");let p=i[e];if(!p)throw new Error(`No matching profile name found and default profile "${e}" missing.`);o={profileId:e,profilePath:`${t}/${p.path}`,deprecated:!!p.deprecated}}let s=await Mh(o.profilePath),a;if(n){let p;if(r.handedness==="any"?p=s.layouts[Object.keys(s.layouts)[0]]:p=s.layouts[r.handedness],!p)throw new Error(`No matching handedness, ${r.handedness}, in profile ${o.profileId}`);p.assetPath&&(a=o.profilePath.replace("profile.json",p.assetPath))}return{profile:s,assetPath:a}}var fA={xAxis:0,yAxis:0,button:0,state:ve.ComponentState.DEFAULT};function xA(r=0,t=0){let e=r,n=t;if(Math.sqrt(r*r+t*t)>1){let s=Math.atan2(t,r);e=Math.cos(s),n=Math.sin(s)}return{normalizedXAxis:e*.5+.5,normalizedYAxis:n*.5+.5}}var Ec=class{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===ve.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(fA)}updateFromComponent({xAxis:t,yAxis:e,button:n,state:i}){let{normalizedXAxis:o,normalizedYAxis:s}=xA(t,e);switch(this.componentProperty){case ve.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?o:.5;break;case ve.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?s:.5;break;case ve.ComponentProperty.BUTTON:this.value=this.states.includes(i)?n:0;break;case ve.ComponentProperty.STATE:this.valueNodeProperty===ve.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},yc=class{constructor(t,e){if(!t||!e||!e.visualResponses||!e.gamepadIndices||Object.keys(e.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach(n=>{let i=new Ec(e.visualResponses[n]);this.visualResponses[n]=i}),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:ve.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(t){if(this.values.state=ve.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&t.buttons.length>this.gamepadIndices.button){let e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||this.values.button===1?this.values.state=ve.ComponentState.PRESSED:(e.touched||this.values.button>ve.ButtonTouchThreshold)&&(this.values.state=ve.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===ve.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>ve.AxisTouchThreshold&&(this.values.state=ve.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===ve.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>ve.AxisTouchThreshold&&(this.values.state=ve.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}},Sa=class{constructor(t,e,n){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=n,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(i=>{let o=this.layoutDescription.components[i];this.components[i]=new yc(i,o)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let t=[];return Object.values(this.components).forEach(e=>{t.push(e.data)}),t}updateFromGamepad(){Object.values(this.components).forEach(t=>{t.updateFromGamepad(this.xrInputSource.gamepad)})}};var gA="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",vA="generic-trigger",wc=class extends THREE.Object3D{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(t){return this.envMap==t?this:(this.envMap=t,this.traverse(e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}),this)}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(n=>{let{valueNode:i,minNode:o,maxNode:s,value:a,valueNodeProperty:p}=n;!i||(p===ve.VisualResponseProperty.VISIBILITY?i.visible=a:p===ve.VisualResponseProperty.TRANSFORM&&(i.quaternion.slerpQuaternions(o.quaternion,s.quaternion,a),i.position.lerpVectors(o.position,s.position,a)))})}))}};function AA(r,t){Object.values(r.components).forEach(e=>{let{type:n,touchPointNodeName:i,visualResponses:o}=e;if(n===ve.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(i),e.touchPointNode){let s=new THREE.SphereGeometry(.001),a=new THREE.MeshBasicMaterial({color:255}),p=new THREE.Mesh(s,a);e.touchPointNode.add(p)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(o).forEach(s=>{let{valueNodeName:a,minNodeName:p,maxNodeName:d,valueNodeProperty:h}=s;if(h===ve.VisualResponseProperty.TRANSFORM){if(s.minNode=t.getObjectByName(p),s.maxNode=t.getObjectByName(d),!s.minNode){console.warn(`Could not find ${p} in the model`);return}if(!s.maxNode){console.warn(`Could not find ${d} in the model`);return}}s.valueNode=t.getObjectByName(a),s.valueNode||console.warn(`Could not find ${a} in the model`)})})}function Rh(r,t){AA(r.motionController,t),r.envMap&&t.traverse(e=>{e.isMesh&&(e.material.envMap=r.envMap,e.material.needsUpdate=!0)}),r.add(t)}var Ra=class{constructor(t=null){this.gltfLoader=t,this.path=gA,this._assetCache={},this.gltfLoader||(this.gltfLoader=new kn)}createControllerModel(t){let e=new wc,n=null;return t.addEventListener("connected",i=>{let o=i.data;o.targetRayMode!=="tracked-pointer"||!o.gamepad||Sh(o,this.path,vA).then(({profile:s,assetPath:a})=>{e.motionController=new Sa(o,s,a);let p=this._assetCache[e.motionController.assetUrl];if(p)n=p.scene.clone(),Rh(e,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(e.motionController.assetUrl,d=>{this._assetCache[e.motionController.assetUrl]=d,n=d.scene.clone(),Rh(e,n)},null,()=>{throw new Error(`Asset ${e.motionController.assetUrl} missing or malformed.`)})}}).catch(s=>{console.warn(s)})}),t.addEventListener("disconnected",()=>{e.motionController=null,e.remove(n),n=null}),e}};var Tc=new THREE.Matrix4,Ph=new THREE.Vector3,Ch=new THREE.Matrix4().identity(),Ih=new THREE.Matrix4().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(Ch.makeRotationY(Math.PI/2),Ih.makeRotationY(-Math.PI/2));var Ai=class{constructor(t,e,n,i,o){this.controller=e,this.handModel=t,this.envMap=null,this.oculusBrowserV14Correction=i==="left"?Ih:Ch;let s;!o||!o.primitive||o.primitive==="sphere"?s=new THREE.SphereGeometry(1,10,10):o.primitive==="box"?s=new THREE.BoxGeometry(1,1,1):o.primitive==="bone"&&(s=new THREE.CylinderGeometry(.5,.75,2.25,10,1).rotateX(-Math.PI/2));let a=new THREE.MeshStandardMaterial;this.handMesh=new THREE.InstancedMesh(s,a,30),this.handMesh.instanceMatrix.setUsage(THREE.DynamicDrawUsage),this.handMesh.castShadow=!0,this.handMesh.receiveShadow=!0,this.handModel.add(this.handMesh),this.joints=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]}updateMesh(){let e=this.controller.joints,n=0;for(let i=0;i<this.joints.length;i++){let o=e[this.joints[i]];o.visible&&(Ph.setScalar(o.jointRadius||.008),Tc.compose(o.position,o.quaternion,Ph),Tc.multiply(this.oculusBrowserV14Correction),this.handMesh.setMatrixAt(i,Tc),n++)}this.handMesh.count=n,this.handMesh.instanceMatrix.needsUpdate=!0}};var Mc=new THREE.Quaternion().identity(),Vh=new THREE.Quaternion().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(Mc.setFromAxisAngle({x:0,y:1,z:0},Math.PI/2),Vh.setFromAxisAngle({x:1,y:0,z:0},Math.PI).premultiply(Mc));var _A="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/",Pa=class{constructor(t,e,n,i){this.controller=e,this.handModel=t,this.oculusBrowserV14Correction=i==="left"?Vh:Mc,this.bones=[];let o=new kn;o.setPath(n||_A),o.load(`${i}.glb`,s=>{let a=s.scene.children[0];this.handModel.add(a);let p=a.getObjectByProperty("type","SkinnedMesh");p.frustumCulled=!1,p.castShadow=!0,p.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(h=>{let x=a.getObjectByName(h);x!==void 0?x.jointName=h:console.warn(`Couldn't find ${h} in ${i} hand mesh`),this.bones.push(x)})})}updateMesh(){let t=this.controller.joints;for(let e=0;e<this.bones.length;e++){let n=this.bones[e];if(n){let i=t[n.jointName];if(i.visible){let o=i.position;n&&(n.position.copy(o),n.quaternion.copy(i.quaternion).multiply(this.oculusBrowserV14Correction))}}}}};var Sc=class extends THREE.Object3D{constructor(t){super(),this.controller=t,this.motionController=null,this.envMap=null,this.mesh=null}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&this.motionController.updateMesh()}},Ca=class{constructor(){this.path=null}setPath(t){return this.path=t,this}createHandModel(t,e){let n=new Sc(t);return t.addEventListener("connected",i=>{let o=i.data;o.hand&&!n.motionController&&(n.xrInputSource=o,e===void 0||e==="spheres"?n.motionController=new Ai(n,t,this.path,o.handedness,{primitive:"sphere"}):e==="boxes"?n.motionController=new Ai(n,t,this.path,o.handedness,{primitive:"box"}):e==="bones"?n.motionController=new Ai(n,t,this.path,o.handedness,{primitive:"bone"}):e==="mesh"&&(n.motionController=new Pa(n,t,this.path,o.handedness)))}),t.addEventListener("disconnected",()=>{}),n}};var _i=class extends Dt{constructor(e){super(e);this.material=lo({name:"CursorMat",color:16776960}),this.object=new wt(.01,.01,.01,this.material)}get position(){return this.object.position}get style(){return this._currentStyle}set style(e){if(this._currentStyle=e,yn(this.object)&&!ke(this.object.material))switch(this._currentStyle){case"pointer":this.material.color=new THREE.Color(65280),this.material.needsUpdate=!0;break;case"not-allowed":this.material.color=new THREE.Color(16711680),this.material.needsUpdate=!0;break;case"move":this.material.color=new THREE.Color(255),this.material.needsUpdate=!0;break;case"grab":this.material.color=new THREE.Color(16711935),this.material.needsUpdate=!0;break;case"grabbing":this.material.color=new THREE.Color(65535),this.material.needsUpdate=!0;break;default:this._currentStyle="default",this.material.color=new THREE.Color(16776960),this.material.needsUpdate=!0;break}}get visible(){return wn(this)}set visible(e){Me(this,e)}};var Ia=class extends Dt{constructor(e,n){super(e);this.element=n;this._hidden=!1;this.visible=!0,this.style="default",document.addEventListener("pointerlockchange",()=>{this._hidden=!!document.pointerLockElement,this.refresh()})}get position(){throw new Error("BaseCursor::get_Position(): Method not implemented.")}get style(){return super.style}set style(e){super.style=e,this.refresh()}get visible(){return super.visible&&!this._hidden}set visible(e){super.visible=e,this.refresh()}refresh(){this.element.style.cursor=this.visible?this.style:"none"}};var bi=class extends Dt{constructor(e){super(e);this.xr=e.cursor3D&&e.cursor3D.clone()||new _i(this.env),this.system=new Ia(this.env,this.env.renderer.domElement),this.visible=!1}get object(){return this.xr.object}get cursor(){return this.xr}set cursor(e){this.xr=e,this._refresh()}get position(){return this.object.position}get style(){return this.system.style}get visible(){return super.visible}set visible(e){super.visible=e,this._refresh()}set style(e){this.system.style=e,this.xr.style=e,this._refresh()}_refresh(){let e=this.env.pointers&&this.env.pointers.mouse&&this.env.pointers.mouse.isPointerLocked,n=this.env.renderer.xr.isPresenting||e;Me(this.xr,this.visible&&n),this.system.visible=this.visible&&!n}lookAt(e,n){this.xr.lookAt(e,n)}};var Va=class extends j{constructor(e,n){super(e);this.pointer=n;this._hit=null;this._point=null;this._distance=Number.POSITIVE_INFINITY;this._rayTarget=null;Object.seal(this)}set(e,n){e!==this.hit&&(this._hit=e,e?(this._point=e.point,this._distance=e.distance):(this._point=null,this._distance=Number.POSITIVE_INFINITY)),this._rayTarget=n}get hit(){return this._hit}get rayTarget(){return this._rayTarget}get point(){return this._point}get distance(){return this._distance}};var bA=5,EA=new THREE.Vector3,Ei=class extends q{constructor(e,n,i,o){super();this.type=e;this.id=n;this.env=i;this.origin=new THREE.Vector3;this.direction=new THREE.Vector3;this.up=new THREE.Vector3(0,1,0);this.canMoveView=!1;this.mayTeleport=!1;this.buttons=0;this.isActive=!1;this.moveDistance=0;this.hits=new Array;this.pointerEvents=new Map;this.lastButtons=0;this.canClick=!1;this.dragDistance=0;this._enabled=!1;this._cursor=null;this._curHit=null;this._curTarget=null;this._hoveredHit=null;this._hoveredTarget=null;this._cursor=o,this.cursor&&(this.cursor.visible=!1)}get curHit(){return this._curHit}set curHit(e){if(e!==this.curHit){let n=$r(e);this._curHit=e,this._curTarget=n}}get curTarget(){return this._curTarget}get hoveredHit(){return this._hoveredHit}set hoveredHit(e){if(e!==this.hoveredHit){let n=$r(e);this._hoveredHit=e,this._hoveredTarget=n}}get name(){return xn[this.id]}get rayTarget(){return this._hoveredTarget}get cursor(){return this._cursor}set cursor(e){if(e!==this.cursor){let n=this.cursor,i=this.cursor&&this.cursor.object&&this.cursor.object.name||"cursor",o=n&&n.object&&n.object.parent;o&&o.remove(n.object),e&&(e.object.name=i,n instanceof bi?(n.cursor=e,o&&U(o,n)):(this._cursor=e,n&&(o&&U(o,e),e.style=n.style,e.visible=n.visible)))}}get needsUpdate(){return this.enabled&&this.isActive}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.cursor&&(this.cursor.visible=e)}setButton(e,n){this.lastButtons=this.buttons;let i=1<<e;if(n?this.buttons|=i:this.buttons&=~i,n)this.canClick=!0,this.dragDistance=0,this.env.avatar.setMode(this),this.setEventState("down");else{if(this.canClick){let o=this.buttons;this.buttons=this.lastButtons,this.setEventState("click"),this.buttons=o}this.setEventState("up")}}isPressed(e){let n=1<<e;return(this.buttons&n)!==0}wasPressed(e){let n=1<<e;return(this.lastButtons&n)!==0}fireRay(e,n){le(this.hits),this.env.pointers.fireRay(e,n,this.hits);let i=null,o=Number.MAX_VALUE;for(let s of this.hits)$r(s)&&s.distance<o&&(i=s,o=s.distance);return this.curHit=i,!!i}getEvent(e){this.pointerEvents.has(e)||this.pointerEvents.set(e,new Va(e,this));let n=this.pointerEvents.get(e);if(this.hoveredHit?n.set(this.hoveredHit,this.rayTarget):this.curHit?n.set(this.curHit,this.curTarget):n.set(null,null),n.hit){let i=this.curHit||this.hoveredHit;i&&n.hit!==i&&(n.hit.uv=i.uv)}return n}update(){this.needsUpdate&&this.onUpdate()}onUpdate(){this.updatePointerOrientation();let e=this.isPressed(0);(this.moveDistance>0||e)&&(e&&(this.dragDistance+=this.moveDistance,this.dragDistance>bA&&(this.canClick=!1)),this.setEventState("move")),this.moveDistance=0}setEventState(e){if(this.fireRay(this.origin,this.direction),this.curTarget===this.rayTarget)this.hoveredHit=this.curHit;else{let i=this.isPressed(0),o=this.wasPressed(0);if(e==="move"&&!i||e==="down"&&i&&!o||e==="up"&&!i&&o){if(this.rayTarget){let d=this.getEvent("up");this.rayTarget.dispatchEvent(d);let h=this.getEvent("exit");this.rayTarget.dispatchEvent(h)}if(this.hoveredHit=this.curHit,this.rayTarget){let d=this.getEvent("enter");this.rayTarget.dispatchEvent(d)}}this.hoveredHit&&this.hoveredHit.point.copy(this.direction).multiplyScalar(this.hoveredHit.distance).add(this.origin)}let n=this.getEvent(e);this.dispatchEvent(n),n.rayTarget&&(e!=="click"||n.rayTarget.clickable||n.rayTarget.navigable)&&(e==="click"&&n.rayTarget.clickable&&this.vibrate(),n.rayTarget.enabled&&n.rayTarget.dispatchEvent(n)),this.updateCursor(this.env.avatar.worldPos,EA,!0,2)}get canDragView(){return this.canMoveView}get canTeleport(){return this.mayTeleport}updateCursor(e,n,i,o){this.cursor&&this.cursor.update(e,n,this.hoveredHit||this.curHit,this.rayTarget||this.curTarget,o,i,this.canDragView,this.canTeleport,this.origin,this.direction,this.isPressed(0))}};var Lh=new THREE.Box3,La=new THREE.Vector3,xr=class extends THREE.InstancedBufferGeometry{constructor(){super(),this.type="LineSegmentsGeometry";let t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n),this.setAttribute("position",new THREE.Float32BufferAttribute(t,3)),this.setAttribute("uv",new THREE.Float32BufferAttribute(e,2))}applyMatrix4(t){let e=this.attributes.instanceStart,n=this.attributes.instanceEnd;return e!==void 0&&(e.applyMatrix4(t),n.applyMatrix4(t),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let n=new THREE.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceStart",new THREE.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceEnd",new THREE.InterleavedBufferAttribute(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let n=new THREE.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceColorStart",new THREE.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceColorEnd",new THREE.InterleavedBufferAttribute(n,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new THREE.WireframeGeometry(t.geometry)),this}fromLineSegments(t){let e=t.geometry;if(e.isGeometry){console.error("THREE.LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new THREE.Box3);let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;t!==void 0&&e!==void 0&&(this.boundingBox.setFromBufferAttribute(t),Lh.setFromBufferAttribute(e),this.boundingBox.union(Lh))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new THREE.Sphere),this.boundingBox===null&&this.computeBoundingBox();let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(t!==void 0&&e!==void 0){let n=this.boundingSphere.center;this.boundingBox.getCenter(n);let i=0;for(let o=0,s=t.count;o<s;o++)La.fromBufferAttribute(t,o),i=Math.max(i,n.distanceToSquared(La)),La.fromBufferAttribute(e,o),i=Math.max(i,n.distanceToSquared(La));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}};xr.prototype.isLineSegmentsGeometry=!0;var kh=new THREE.Vector3,Oh=new THREE.Vector3,Xe=new THREE.Vector4,ze=new THREE.Vector4,Bt=new THREE.Vector4,Rc=new THREE.Vector3,Pc=new THREE.Matrix4,ft=new THREE.Line3,Dh=new THREE.Vector3,on=new THREE.Box3,ka=new THREE.Sphere,Ft=new THREE.Vector4;function Bh(r,t,e,n){return Ft.set(0,0,-t,1).applyMatrix4(r.projectionMatrix),Ft.multiplyScalar(1/Ft.w),Ft.x=e/n.width,Ft.y=e/n.height,Ft.applyMatrix4(r.projectionMatrixInverse),Ft.multiplyScalar(1/Ft.w),Math.abs(Math.max(Ft.x,Ft.y))}var wo=class extends THREE.Mesh{constructor(t=new xr,e=new $t({color:Math.random()*16777215})){super(t,e),this.type="LineSegments2"}computeLineDistances(){let t=this.geometry,e=t.attributes.instanceStart,n=t.attributes.instanceEnd,i=new Float32Array(2*e.count);for(let s=0,a=0,p=e.count;s<p;s++,a+=2)kh.fromBufferAttribute(e,s),Oh.fromBufferAttribute(n,s),i[a]=a===0?0:i[a-1],i[a+1]=i[a]+kh.distanceTo(Oh);let o=new THREE.InstancedInterleavedBuffer(i,2,1);return t.setAttribute("instanceDistanceStart",new THREE.InterleavedBufferAttribute(o,1,0)),t.setAttribute("instanceDistanceEnd",new THREE.InterleavedBufferAttribute(o,1,1)),this}raycast(t,e){t.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');let n=t.params.Line2!==void 0&&t.params.Line2.threshold||0,i=t.ray,o=t.camera,s=o.projectionMatrix,a=this.matrixWorld,p=this.geometry,d=this.material,h=d.resolution,x=d.linewidth+n,A=p.attributes.instanceStart,E=p.attributes.instanceEnd,S=-o.near;p.boundingSphere===null&&p.computeBoundingSphere(),ka.copy(p.boundingSphere).applyMatrix4(a);let P=Math.max(o.near,ka.distanceToPoint(i.origin)),R=Bh(o,P,x,h);if(ka.radius+=R,t.ray.intersectsSphere(ka)===!1)return;p.boundingBox===null&&p.computeBoundingBox(),on.copy(p.boundingBox).applyMatrix4(a);let I=Math.max(o.near,on.distanceToPoint(i.origin)),O=Bh(o,I,x,h);if(on.max.x+=O,on.max.y+=O,on.max.z+=O,on.min.x-=O,on.min.y-=O,on.min.z-=O,t.ray.intersectsBox(on)!==!1){i.at(1,Bt),Bt.w=1,Bt.applyMatrix4(o.matrixWorldInverse),Bt.applyMatrix4(s),Bt.multiplyScalar(1/Bt.w),Bt.x*=h.x/2,Bt.y*=h.y/2,Bt.z=0,Rc.copy(Bt),Pc.multiplyMatrices(o.matrixWorldInverse,a);for(let k=0,H=A.count;k<H;k++){Xe.fromBufferAttribute(A,k),ze.fromBufferAttribute(E,k),Xe.w=1,ze.w=1,Xe.applyMatrix4(Pc),ze.applyMatrix4(Pc);var L=Xe.z>S&&ze.z>S;if(L)continue;if(Xe.z>S){let z=Xe.z-ze.z,J=(Xe.z-S)/z;Xe.lerp(ze,J)}else if(ze.z>S){let z=ze.z-Xe.z,J=(ze.z-S)/z;ze.lerp(Xe,J)}Xe.applyMatrix4(s),ze.applyMatrix4(s),Xe.multiplyScalar(1/Xe.w),ze.multiplyScalar(1/ze.w),Xe.x*=h.x/2,Xe.y*=h.y/2,ze.x*=h.x/2,ze.y*=h.y/2,ft.start.copy(Xe),ft.start.z=0,ft.end.copy(ze),ft.end.z=0;let V=ft.closestPointToPointParameter(Rc,!0);ft.at(V,Dh);let D=THREE.MathUtils.lerp(Xe.z,ze.z,V),te=D>=-1&&D<=1,K=Rc.distanceTo(Dh)<x*.5;if(te&&K){ft.start.fromBufferAttribute(A,k),ft.end.fromBufferAttribute(E,k),ft.start.applyMatrix4(a),ft.end.applyMatrix4(a);let z=new THREE.Vector3,J=new THREE.Vector3;i.distanceSqToSegment(ft.start,ft.end,J,z),e.push({point:J,pointOnLine:z,distance:i.origin.distanceTo(J),object:this,face:null,faceIndex:k,uv:null,uv2:null})}}}}};wo.prototype.isLineSegments2=!0;var gr=class extends xr{constructor(){super(),this.type="LineGeometry"}setPositions(t){for(var e=t.length-3,n=new Float32Array(2*e),i=0;i<e;i+=3)n[2*i]=t[i],n[2*i+1]=t[i+1],n[2*i+2]=t[i+2],n[2*i+3]=t[i+3],n[2*i+4]=t[i+4],n[2*i+5]=t[i+5];return super.setPositions(n),this}setColors(t){for(var e=t.length-3,n=new Float32Array(2*e),i=0;i<e;i+=3)n[2*i]=t[i],n[2*i+1]=t[i+1],n[2*i+2]=t[i+2],n[2*i+3]=t[i+3],n[2*i+4]=t[i+4],n[2*i+5]=t[i+5];return super.setColors(n),this}fromLine(t){var e=t.geometry;if(e.isGeometry){console.error("THREE.LineGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}};gr.prototype.isLineGeometry=!0;var To=class extends wo{constructor(t=new gr,e=new $t({color:Math.random()*16777215})){super(t,e),this.type="Line2"}};To.prototype.isLine2=!0;var Fh=new gr;Fh.setPositions([0,0,0,0,0,-1]);var Oa=class extends THREE.Object3D{constructor(e,n=1){super();this._length=1;this.line=new To(Fh,tm({color:e,linewidth:n})),this.line.computeLineDistances(),U(this,this.line)}get length(){return this._length}set length(e){this._length=e,this.line.scale.set(1,1,e)}};var yA=new Ra,wA=new Ca,TA=new THREE.Matrix4().makeRotationX(-7*Math.PI/9),Hh=new Map([["none",4],["left",5],["right",6]]);var Nh=new Map([[5,2],[4,3]]),Da=class extends Ei{constructor(e,n){super("hand",4,e,new _i(e));this.laser=new Oa(mp,.002);this._isHand=!1;this.inputSource=null;this._gamepad=new Ma;this.delta=new THREE.Vector3;this.newOrigin=new THREE.Vector3;this.quaternion=new THREE.Quaternion;this.newQuat=new THREE.Quaternion;this.useHaptics=!0;if(this.mayTeleport=!0,this.object=se("PointerHand"+n),this.quaternion.identity(),U(this,this.controller=this.env.renderer.xr.getController(n),this.grip=this.env.renderer.xr.getControllerGrip(n),this.hand=this.env.renderer.xr.getHand(n)),kr()&&yd()&&!Gt){let s=!1;this.controller.traverse(a=>{a.name.toLocaleLowerCase().indexOf("oculus")>=0&&(s=!0)}),s&&this.laser.matrix.copy(TA)}U(this.controller,this.laser),U(this.grip,yA.createControllerModel(this.controller)),U(this.hand,wA.createHandModel(this.hand,"mesh")),this.gamepad.addEventListener("gamepadaxismaxed",s=>{s.axis===2&&this.env.avatar.snapTurn(s.value)});let i=s=>a=>{Nh.has(a.button)&&this.setButton(Nh.get(a.button),s)};this.gamepad.addEventListener("gamepadbuttondown",i(!0)),this.gamepad.addEventListener("gamepadbuttonup",i(!1));let o=(s,a)=>()=>this.setButton(s,a);this.controller.addEventListener("selectstart",o(0,!0)),this.controller.addEventListener("selectend",o(0,!1)),this.controller.addEventListener("squeezestart",o(1,!0)),this.controller.addEventListener("squeezeend",o(1,!1)),this.controller.addEventListener("connected",s=>{s.target===this.controller&&(this.inputSource=s.data,this.gamepad.pad=this.inputSource.gamepad,this._isHand=v(this.inputSource.hand),this.id=Hh.get(this.handedness),this.updateCursorSide(),this.grip.visible=!this.isHand,this.controller.visible=!this.isHand,this.hand.visible=this.isHand,this.enabled=!0,this.isActive=!0,this.env.pointers.checkXRMouse(),console.log(this.handedness,"connected"))}),this.controller.addEventListener("disconnected",s=>{s.target===this.controller&&(this.inputSource=null,this.gamepad.pad=null,this._isHand=!1,this.id=Hh.get(this.handedness),this.updateCursorSide(),this.grip.visible=!1,this.controller.visible=!1,this.hand.visible=!1,this.enabled=!1,this.isActive=!1,this.env.pointers.checkXRMouse(),console.log(this.handedness,"disconnected"))}),Object.seal(this)}vibrate(){this._vibrate()}async _vibrate(){if(this.useHaptics&&this.gamepad.hapticActuators)try{await Promise.all(this.gamepad.hapticActuators.map(e=>e.pulse(.25,125)))}catch{this.useHaptics=!1}}get gamepad(){return this._gamepad}get handedness(){return B(this.inputSource)?null:this.inputSource.handedness}get isHand(){return this._isHand}get cursor(){return super.cursor}set cursor(e){super.cursor=e,this.updateCursorSide()}updateCursorSide(){let e=this.cursor.object;if(e){let n=this.handedness==="right"?1:-1;e.scale.set(n,1,1)}}updatePointerOrientation(){this.laser.getWorldPosition(this.newOrigin),this.laser.getWorldQuaternion(this.newQuat),this.origin.lerp(this.newOrigin,.9),this.quaternion.slerp(this.newQuat,.9),this.delta.copy(this.origin).add(this.direction),this.direction.set(0,0,-1).applyQuaternion(this.quaternion),this.up.set(0,1,0).applyQuaternion(this.quaternion),this.delta.sub(this.direction).sub(this.origin),this.moveDistance+=50*this.delta.length()}onUpdate(){this.gamepad.pad=this.inputSource&&this.inputSource.gamepad||null,super.onUpdate()}};var yi=class extends Ei{constructor(e,n,i,o){super(e,n,i,o);this.position=new THREE.Vector2;this.motion=new THREE.Vector2;this.uv=new THREE.Vector2;this.duv=new THREE.Vector2;this.uvComp=new THREE.Vector2(1,-1);this.uvOff=new THREE.Vector2(-1,1);this.canMoveView=!0;let s=a=>{this.checkEvent(a)&&this.readEvent(a)};this.element=this.env.renderer.domElement,this.element.addEventListener("pointerdown",s),this.element.addEventListener("pointermove",s),this.element.addEventListener("pointerup",s),this.element.addEventListener("pointercancel",s)}checkEvent(e){return this.isActive=this.onCheckEvent(e)}onCheckEvent(e){return e.pointerType===this.type}readEvent(e){this.checkEvent(e)&&this.onReadEvent(e)}onReadEvent(e){this.updatePointerOrientation()}updatePointerOrientation(){this.element.clientWidth>0&&this.element.clientHeight>0&&(this.uv.copy(this.position),this.uv.x/=this.element.clientWidth,this.uv.y/=this.element.clientHeight,this.uv.multiplyScalar(2).multiply(this.uvComp).add(this.uvOff),this.duv.copy(this.motion),this.duv.x/=this.element.clientWidth,this.duv.y/=this.element.clientHeight,this.duv.multiplyScalar(2).multiply(this.uvComp),this.moveDistance=200*this.duv.length());let e=fr(this.env.renderer,this.env.camera);this.origin.setFromMatrixPosition(e.matrixWorld),this.direction.set(this.uv.x,this.uv.y,.5).unproject(e).sub(this.origin).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat)}onUpdate(){this.env.avatar.onMove(this,this.uv,this.duv),super.onUpdate(),this.motion.setScalar(0),this.duv.setScalar(0)}};var wi=class extends yi{constructor(e,n,i){let o=p=>{p.pointerType===e&&this.pointerID==null&&(this.pointerID=p.pointerId)},s=p=>{p.pointerType===e&&this.pointerID!=null&&(this.pointerID=null)},a=i.renderer.domElement;a.addEventListener("pointerdown",o),a.addEventListener("pointermove",o);super(e,n,i,new bi(i));this.pointerID=null;a.addEventListener("pointerup",s),a.addEventListener("pointercancel",s)}onCheckEvent(e){return super.onCheckEvent(e)&&e.pointerId===this.pointerID}onReadEvent(e){this.position.set(e.offsetX,e.offsetY),this.motion.x+=e.movementX,this.motion.y+=e.movementY,super.onReadEvent(e),(e.type==="pointerdown"||e.type==="pointerup"||e.type==="pointercancel")&&this.setButton(e.button,e.type==="pointerdown")}};var Ba=class extends wi{constructor(e){super("mouse",1,e);this.allowPointerLock=!1;this.dz=0;this.keyMap=new Map([["`",3],["ContextMenu",2]]);this.element.addEventListener("wheel",n=>{n.preventDefault(),this.dz+=-n.deltaY*.1},{passive:!1}),this.element.addEventListener("contextmenu",n=>{n.preventDefault()}),this.element.addEventListener("pointerdown",n=>{this.onCheckEvent(n)&&this.allowPointerLock&&!this.isPointerLocked&&this.lockPointer()}),document.addEventListener("pointerlockchange",()=>{this.cursor.visible=!0}),window.addEventListener("keydown",n=>{this.isActive&&this.keyMap.has(n.key)&&this.setButton(this.keyMap.get(n.key),ba(n))}),window.addEventListener("keyup",n=>{this.keyMap.has(n.key)&&this.setButton(this.keyMap.get(n.key),!1)}),this.mayTeleport=!0,Object.seal(this)}updatePointerOrientation(){this.isPointerLocked&&this.position.set(this.env.renderer.domElement.clientWidth,this.env.renderer.domElement.clientHeight).multiplyScalar(.5),super.updatePointerOrientation()}onUpdate(){super.onUpdate(),this.env.avatar.zoom(this.dz),this.dz=0}get isPointerLocked(){return document.pointerLockElement!=null}get canDragView(){return super.canDragView&&!this.isPointerLocked}get canTeleport(){return super.canTeleport&&this.isPointerLocked}lockPointer(){this.element.requestPointerLock()}unlockPointer(){document.exitPointerLock()}vibrate(){}};var Fa=class extends wi{constructor(t){super("pen",2,t),Object.seal(this)}vibrate(){}};function MA(r){return r.pointerId}var Ha=class extends yi{constructor(e){super("touch",3,e,null);this.dz=0;this.lastZ=0;this.points=new Array;Object.seal(this)}get enabled(){return super.enabled}set enabled(e){super.enabled=e,le(this.points)}onCheckEvent(e){return super.onCheckEvent(e)&&e.pointerId>-1}onReadEvent(e){if(dd(this.points,e.pointerId,MA),(e.type==="pointerdown"||e.type==="pointermove")&&this.points.push(e),this.points.length===2){let i=this.points[0],o=this.points[1],s=o.offsetX-i.offsetX,a=o.offsetY-i.offsetY,p=5*Math.sqrt(s*s+a*a),d=p-this.lastZ;e.type==="pointermove"&&(this.dz+=d),this.lastZ=p}let n=1/this.points.length;if(e.type==="pointerdown"||e.type==="pointermove"){this.position.setScalar(0);for(let i of this.points)this.position.x+=n*i.offsetX,this.position.y+=n*i.offsetY,this.motion.x+=n*i.movementX,this.motion.y+=n*i.movementY}if(super.onReadEvent(e),e.type!=="pointermove"){let i=0;for(let o=0;o<this.points.length;++o){let s=this.points[o],a=1<<o;s.buttons!==0?i|=a:i&=~a}for(let o=0;o<10;++o){let s=this.isPressed(o),a=1<<o,p=(i&a)!==0;p!==s&&this.setButton(o,p)}}}onUpdate(){this.env.avatar.zoom(this.dz),super.onUpdate(),this.dz=0}vibrate(){navigator.vibrate(125)}};var Na=class extends q{constructor(e){super();this.env=e;this.raycaster=new THREE.Raycaster;this.queue=new Array;this.targetsFound=new Set;this.targets=new Array;this.hands=new Array;this.raycaster.camera=this.env.camera,this.raycaster.layers.set(wa),this.mouse=new Ba(this.env),this.pen=new Fa(this.env),this.touches=new Ha(this.env);for(let n=0;n<2;++n)this.hands[n]=new Da(this.env,n);this.pointers=[this.mouse,this.pen,this.touches,...this.hands];for(let n of this.pointers)n.addBubbler(this),n.cursor&&U(this.env.stage,n.cursor);this.checkXRMouse(),Object.seal(this)}checkXRMouse(){let e=0;for(let i of this.hands.values())i.enabled&&++e;let n=e===0;this.mouse.enabled=n,this.pen.enabled=n,this.touches.enabled=n}refreshCursors(){for(let e of this.pointers)e.cursor&&(e.cursor=this.env.cursor3D.clone())}fireRay(e,n,i){this.raycaster.ray.origin.copy(e),this.raycaster.ray.direction.copy(n),this.raycaster.intersectObjects(this.targets,!1,i)}update(){for(this.targetsFound.clear(),le(this.targets),this.queue.push(this.env.scene);this.queue.length>0;){let e=this.queue.shift();e.children.length>0&&this.queue.push(...e.children);let n=$r(e);n&&!this.targetsFound.has(n)&&(this.targetsFound.add(n),this.targets.push(...n.meshes))}for(let e of this.pointers)e.needsUpdate&&e.update()}};var SA=new j("fadecomplete"),Xa=class extends q{constructor(e,n=.15){super();this.opacity=1;this.direction=0;this.material=Jr({name:"FaderMaterial",color:0,side:THREE.BackSide}),this.object=lr(e,ao,this.material),this.object.renderOrder=Number.MAX_VALUE,this.speed=1/n,this.object.layers.enableAll()}async fadeOut(){this.direction!=1&&(this.direction=1,await ue(this,"fadecomplete"))}async fadeIn(){this.direction!=-1&&(this.direction=-1,await ue(this,"fadecomplete"))}update(e){if(this.direction!==0){let n=this.direction*this.speed*e/1e3;0<=this.opacity&&this.opacity<=1&&(this.opacity+=n),(this.direction===1&&this.opacity>=1||this.direction===-1&&this.opacity<=0)&&(this.opacity=Wt(this.opacity,0,1),this.direction=0,this.dispatchEvent(SA))}this.material.opacity=this.opacity,this.material.transparent=this.opacity<1,this.material.needsUpdate=!0}};function xt(r,t,e,n,i,o){let s=new wt(n,i,o,om);return s.position.set(r,t,e),s}var RA=.1,za=class extends qt{constructor(){super();this.value=0;this.targetValue=0;this.object=se("LoadingBar");this._enabled=!0;this.valueBar=new wt(0,1,1,im),this.valueBar.scale.set(0,1,1);let e=se("ValueBarContainer");e.scale.set(1,.1,.1),U(this,U(e,this.valueBar),xt(-.5,0,-.05,.01,.1,.01),xt(-.5,0,.05,.01,.1,.01),xt(.5,0,-.05,.01,.1,.01),xt(.5,0,.05,.01,.1,.01),xt(-.5,-.05,0,.01,.01,.1),xt(.5,-.05,0,.01,.01,.1),xt(-.5,.05,0,.01,.01,.1),xt(.5,.05,0,.01,.01,.1),xt(0,-.05,-.05,1,.01,.01),xt(0,.05,-.05,1,.01,.01),xt(0,-.05,.05,1,.01,.01),xt(0,.05,.05,1,.01,.01)),yh(this,xi)}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,Me(this,wn(this)||this.enabled))}report(e,n,i){super.report(e,n,i),this.targetValue=this.p}update(e){this.object.parent.visible&&(this.value=Math.min(this.targetValue,this.value+RA*e),this.valueBar.scale.set(this.value,1,1),this.valueBar.position.x=this.value/2-.5,Me(this,this.enabled&&this.value>0))}};if(!Cc()){let r=Element.prototype,t=Document.prototype;"webkitRequestFullscreen"in r?(r.requestFullscreen=r.webkitRequestFullscreen,t.exitFullscreen=t.webkitRequestFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.webkitFullscreenEnabled}},fullscreenElement:{get:function(){return this.webkitFullscreenElement}}})):"mozRequestFullScreen"in r?(r.requestFullscreen=r.mozRequestFullScreen,t.exitFullscreen=t.mozCancelFullScreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.mozFullScreenEnabled}},fullscreenElement:{get:function(){return this.mozFullScreenElement}}})):"msRequestFullscreen"in r&&(r.requestFullscreen=r.msRequestFullscreen,t.exitFullscreen=t.msExitFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.msFullscreenEnabled}},fullscreenElement:{get:function(){return this.msFullscreenElement}}}))}function Cc(){return"requestFullscreen"in HTMLElement.prototype}var PA=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},ja=PA;var Mo=Symbol("@@webxr-polyfill/EventTarget"),sn=class{constructor(){this[Mo]={listeners:new Map}}addEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let n=this[Mo].listeners.get(t)||[];n.push(e),this[Mo].listeners.set(t,n)}removeEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let n=this[Mo].listeners.get(t)||[];for(let i=n.length;i>=0;i--)n[i]===e&&n.pop()}dispatchEvent(t,e){let n=this[Mo].listeners.get(t)||[],i=[];for(let o=0;o<n.length;o++)i[o]=n[o];for(let o of i)o(e);typeof this[`on${t}`]=="function"&&this[`on${t}`](e)}};var Ve=typeof Float32Array<"u"?Float32Array:Array;var f4=Math.PI/180;function Ht(){let r=new Ve(16);return Ve!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Xh(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function On(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function vr(r,t){let e=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],p=t[6],d=t[7],h=t[8],x=t[9],A=t[10],E=t[11],S=t[12],P=t[13],R=t[14],I=t[15],O=e*a-n*s,L=e*p-i*s,k=e*d-o*s,H=n*p-i*a,V=n*d-o*a,D=i*d-o*p,te=h*P-x*S,K=h*R-A*S,z=h*I-E*S,J=x*R-A*P,ye=x*I-E*P,Ae=A*I-E*R,ae=O*Ae-L*ye+k*J+H*z-V*K+D*te;return ae?(ae=1/ae,r[0]=(a*Ae-p*ye+d*J)*ae,r[1]=(i*ye-n*Ae-o*J)*ae,r[2]=(P*D-R*V+I*H)*ae,r[3]=(A*V-x*D-E*H)*ae,r[4]=(p*z-s*Ae-d*K)*ae,r[5]=(e*Ae-i*z+o*K)*ae,r[6]=(R*k-S*D-I*L)*ae,r[7]=(h*D-A*k+E*L)*ae,r[8]=(s*ye-a*z+d*te)*ae,r[9]=(n*z-e*ye-o*te)*ae,r[10]=(S*V-P*k+I*O)*ae,r[11]=(x*k-h*V-E*O)*ae,r[12]=(a*K-s*J-p*te)*ae,r[13]=(e*J-n*K+i*te)*ae,r[14]=(P*L-S*H-R*O)*ae,r[15]=(h*H-x*L+A*O)*ae,r):null}function an(r,t,e){let n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],p=t[5],d=t[6],h=t[7],x=t[8],A=t[9],E=t[10],S=t[11],P=t[12],R=t[13],I=t[14],O=t[15],L=e[0],k=e[1],H=e[2],V=e[3];return r[0]=L*n+k*a+H*x+V*P,r[1]=L*i+k*p+H*A+V*R,r[2]=L*o+k*d+H*E+V*I,r[3]=L*s+k*h+H*S+V*O,L=e[4],k=e[5],H=e[6],V=e[7],r[4]=L*n+k*a+H*x+V*P,r[5]=L*i+k*p+H*A+V*R,r[6]=L*o+k*d+H*E+V*I,r[7]=L*s+k*h+H*S+V*O,L=e[8],k=e[9],H=e[10],V=e[11],r[8]=L*n+k*a+H*x+V*P,r[9]=L*i+k*p+H*A+V*R,r[10]=L*o+k*d+H*E+V*I,r[11]=L*s+k*h+H*S+V*O,L=e[12],k=e[13],H=e[14],V=e[15],r[12]=L*n+k*a+H*x+V*P,r[13]=L*i+k*p+H*A+V*R,r[14]=L*o+k*d+H*E+V*I,r[15]=L*s+k*h+H*S+V*O,r}function Dn(r,t,e){let n=t[0],i=t[1],o=t[2],s=t[3],a=n+n,p=i+i,d=o+o,h=n*a,x=n*p,A=n*d,E=i*p,S=i*d,P=o*d,R=s*a,I=s*p,O=s*d;return r[0]=1-(E+P),r[1]=x+O,r[2]=A-I,r[3]=0,r[4]=x-O,r[5]=1-(h+P),r[6]=S+R,r[7]=0,r[8]=A+I,r[9]=S-R,r[10]=1-(h+E),r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function Ua(r,t){return r[0]=t[12],r[1]=t[13],r[2]=t[14],r}function Ga(r,t){let e=t[0]+t[5]+t[10],n=0;return e>0?(n=Math.sqrt(e+1)*2,r[3]=.25*n,r[0]=(t[6]-t[9])/n,r[1]=(t[8]-t[2])/n,r[2]=(t[1]-t[4])/n):t[0]>t[5]&&t[0]>t[10]?(n=Math.sqrt(1+t[0]-t[5]-t[10])*2,r[3]=(t[6]-t[9])/n,r[0]=.25*n,r[1]=(t[1]+t[4])/n,r[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=Math.sqrt(1+t[5]-t[0]-t[10])*2,r[3]=(t[8]-t[2])/n,r[0]=(t[1]+t[4])/n,r[1]=.25*n,r[2]=(t[6]+t[9])/n):(n=Math.sqrt(1+t[10]-t[0]-t[5])*2,r[3]=(t[1]-t[4])/n,r[0]=(t[8]+t[2])/n,r[1]=(t[6]+t[9])/n,r[2]=.25*n),r}function Wa(r,t,e,n,i){let o=1/Math.tan(t/2),s;return r[0]=o/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(s=1/(n-i),r[10]=(i+n)*s,r[14]=2*i*n*s):(r[10]=-1,r[14]=-2*n),r}function at(){let r=new Ve(3);return Ve!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Ic(r){var t=new Ve(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t}function CA(r){let t=r[0],e=r[1],n=r[2];return Math.sqrt(t*t+e*e+n*n)}function et(r,t,e){let n=new Ve(3);return n[0]=r,n[1]=t,n[2]=e,n}function Vc(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r}function Ti(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function Lc(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r}function qa(r,t){let e=t[0],n=t[1],i=t[2],o=e*e+n*n+i*i;return o>0&&(o=1/Math.sqrt(o),r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o),r}function Po(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function Qa(r,t,e){let n=t[0],i=t[1],o=t[2],s=e[0],a=e[1],p=e[2];return r[0]=i*p-o*a,r[1]=o*s-n*p,r[2]=n*a-i*s,r}function _r(r,t,e){let n=e[0],i=e[1],o=e[2],s=e[3],a=t[0],p=t[1],d=t[2],h=i*d-o*p,x=o*a-n*d,A=n*p-i*a,E=i*A-o*x,S=o*h-n*A,P=n*x-i*h,R=s*2;return h*=R,x*=R,A*=R,E*=2,S*=2,P*=2,r[0]=a+h+E,r[1]=p+x+S,r[2]=d+A+P,r}function jh(r,t){let e=et(r[0],r[1],r[2]),n=et(t[0],t[1],t[2]);qa(e,e),qa(n,n);let i=Po(e,n);return i>1?0:i<-1?Math.PI:Math.acos(i)}var Uh=CA;var x4=function(){let r=at();return function(t,e,n,i,o,s){let a,p;for(e||(e=3),n||(n=0),i?p=Math.min(i*e+n,t.length):p=t.length,a=n;a<p;a+=e)r[0]=t[a],r[1]=t[a+1],r[2]=t[a+2],o(r,r,s),t[a]=r[0],t[a+1]=r[1],t[a+2]=r[2];return t}}();function Gh(){let r=new Ve(9);return Ve!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function VA(){let r=new Ve(4);return Ve!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Wh(r){let t=new Ve(4);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t}function qh(r,t,e,n){let i=new Ve(4);return i[0]=r,i[1]=t,i[2]=e,i[3]=n,i}function Qh(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r}function Kh(r,t){let e=t[0],n=t[1],i=t[2],o=t[3],s=e*e+n*n+i*i+o*o;return s>0&&(s=1/Math.sqrt(s),r[0]=e*s,r[1]=n*s,r[2]=i*s,r[3]=o*s),r}var g4=function(){let r=VA();return function(t,e,n,i,o,s){let a,p;for(e||(e=4),n||(n=0),i?p=Math.min(i*e+n,t.length):p=t.length,a=n;a<p;a+=e)r[0]=t[a],r[1]=t[a+1],r[2]=t[a+2],r[3]=t[a+3],o(r,r,s),t[a]=r[0],t[a+1]=r[1],t[a+2]=r[2],t[a+3]=r[3];return t}}();function lt(){let r=new Ve(4);return Ve!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function kA(r,t,e){e=e*.5;let n=Math.sin(e);return r[0]=n*t[0],r[1]=n*t[1],r[2]=n*t[2],r[3]=Math.cos(e),r}function kc(r,t,e){let n=t[0],i=t[1],o=t[2],s=t[3],a=e[0],p=e[1],d=e[2],h=e[3];return r[0]=n*h+s*a+i*d-o*p,r[1]=i*h+s*p+o*a-n*d,r[2]=o*h+s*d+n*p-i*a,r[3]=s*h-n*a-i*p-o*d,r}function Mi(r,t,e,n){let i=t[0],o=t[1],s=t[2],a=t[3],p=e[0],d=e[1],h=e[2],x=e[3],A,E,S,P,R;return E=i*p+o*d+s*h+a*x,E<0&&(E=-E,p=-p,d=-d,h=-h,x=-x),1-E>1e-6?(A=Math.acos(E),S=Math.sin(A),P=Math.sin((1-n)*A)/S,R=Math.sin(n*A)/S):(P=1-n,R=n),r[0]=P*i+R*p,r[1]=P*o+R*d,r[2]=P*s+R*h,r[3]=P*a+R*x,r}function Oc(r,t){let e=t[0],n=t[1],i=t[2],o=t[3],s=e*e+n*n+i*i+o*o,a=s?1/s:0;return r[0]=-e*a,r[1]=-n*a,r[2]=-i*a,r[3]=o*a,r}function OA(r,t){let e=t[0]+t[4]+t[8],n;if(e>0)n=Math.sqrt(e+1),r[3]=.5*n,n=.5/n,r[0]=(t[5]-t[7])*n,r[1]=(t[6]-t[2])*n,r[2]=(t[1]-t[3])*n;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);let o=(i+1)%3,s=(i+2)%3;n=Math.sqrt(t[i*3+i]-t[o*3+o]-t[s*3+s]+1),r[i]=.5*n,n=.5/n,r[3]=(t[o*3+s]-t[s*3+o])*n,r[o]=(t[o*3+i]+t[i*3+o])*n,r[s]=(t[s*3+i]+t[i*3+s])*n}return r}function Yh(r,t,e,n){let i=.5*Math.PI/180;t*=i,e*=i,n*=i;let o=Math.sin(t),s=Math.cos(t),a=Math.sin(e),p=Math.cos(e),d=Math.sin(n),h=Math.cos(n);return r[0]=o*p*h-s*a*d,r[1]=s*a*h+o*p*d,r[2]=s*p*d-o*a*h,r[3]=s*p*h+o*a*d,r}var Dc=Wh,Jh=qh,Ya=Qh;var Co=Kh;var S4=function(){let r=at(),t=et(1,0,0),e=et(0,1,0);return function(n,i,o){let s=Po(i,o);return s<-.999999?(Qa(r,t,i),Uh(r)<1e-6&&Qa(r,e,i),qa(r,r),kA(n,r,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Qa(r,i,o),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=1+s,Co(n,n))}}(),R4=function(){let r=lt(),t=lt();return function(e,n,i,o,s,a){return Mi(r,n,s,a),Mi(t,i,o,a),Mi(e,r,t,2*a*(1-a)),e}}(),P4=function(){let r=Gh();return function(t,e,n,i){return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-e[0],r[5]=-e[1],r[8]=-e[2],Co(t,OA(t,r))}}();var oe=Symbol("@@webxr-polyfill/XRRigidTransform"),ln=class{constructor(){if(this[oe]={matrix:null,position:null,orientation:null,inverse:null},arguments.length===0)this[oe].matrix=On(new Float32Array(16));else if(arguments.length===1)arguments[0]instanceof Float32Array?this[oe].matrix=arguments[0]:(this[oe].position=this._getPoint(arguments[0]),this[oe].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(arguments.length===2)this[oe].position=this._getPoint(arguments[0]),this[oe].orientation=this._getPoint(arguments[1]);else throw new Error("Too many arguments!");if(this[oe].matrix){let t=at();Ua(t,this[oe].matrix),this[oe].position=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2]});let e=lt();Ga(e,this[oe].matrix),this[oe].orientation=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2],w:e[3]})}else this[oe].matrix=On(new Float32Array(16)),Dn(this[oe].matrix,Jh(this[oe].orientation.x,this[oe].orientation.y,this[oe].orientation.z,this[oe].orientation.w),et(this[oe].position.x,this[oe].position.y,this[oe].position.z))}_getPoint(t){return t instanceof DOMPointReadOnly?t:DOMPointReadOnly.fromPoint(t)}get matrix(){return this[oe].matrix}get position(){return this[oe].position}get orientation(){return this[oe].orientation}get inverse(){if(this[oe].inverse===null){let t=On(new Float32Array(16));vr(t,this[oe].matrix),this[oe].inverse=new ln(t),this[oe].inverse[oe].inverse=this}return this[oe].inverse}};var Ee=Symbol("@@webxr-polyfill/XRSpace");var gt=class{constructor(t=null,e=null){this[Ee]={specialType:t,inputSource:e,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[Ee].specialType}get _inputSource(){return this[Ee].inputSource}_ensurePoseUpdated(t,e){e!=this[Ee].lastFrameId&&(this[Ee].lastFrameId=e,this._onPoseUpdate(t))}_onPoseUpdate(t){this[Ee].specialType=="viewer"&&(this._baseMatrix=t.getBasePoseMatrix())}set _baseMatrix(t){this[Ee].baseMatrix=t,this[Ee].inverseBaseMatrix=null}get _baseMatrix(){return this[Ee].baseMatrix||this[Ee].inverseBaseMatrix&&(this[Ee].baseMatrix=new Float32Array(16),vr(this[Ee].baseMatrix,this[Ee].inverseBaseMatrix)),this[Ee].baseMatrix}set _inverseBaseMatrix(t){this[Ee].inverseBaseMatrix=t,this[Ee].baseMatrix=null}get _inverseBaseMatrix(){return this[Ee].inverseBaseMatrix||this[Ee].baseMatrix&&(this[Ee].inverseBaseMatrix=new Float32Array(16),vr(this[Ee].inverseBaseMatrix,this[Ee].baseMatrix)),this[Ee].inverseBaseMatrix}_getSpaceRelativeTransform(t){if(!this._inverseBaseMatrix||!t._baseMatrix)return null;let e=new Float32Array(16);return an(e,this._inverseBaseMatrix,t._baseMatrix),new ln(e)}};var DA=1.6,Bn=Symbol("@@webxr-polyfill/XRReferenceSpace"),Io=["viewer","local","local-floor","bounded-floor","unbounded"];function BA(r){return r==="bounded-floor"||r==="local-floor"}var Nt=class extends gt{constructor(t,e=null){if(!Io.includes(t))throw new Error(`XRReferenceSpaceType must be one of ${Io}`);if(super(t),t==="bounded-floor"&&!e)throw new Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");BA(t)&&!e&&(e=On(new Float32Array(16)),e[13]=DA),this._inverseBaseMatrix=e||On(new Float32Array(16)),this[Bn]={type:t,transform:e,originOffset:On(new Float32Array(16))}}_transformBasePoseMatrix(t,e){an(t,this._inverseBaseMatrix,e)}_originOffsetMatrix(){return this[Bn].originOffset}_adjustForOriginOffset(t){let e=new Float32Array(16);vr(e,this[Bn].originOffset),an(t,e,t)}_getSpaceRelativeTransform(t){let e=super._getSpaceRelativeTransform(t);return this._adjustForOriginOffset(e.matrix),new XRRigidTransform(e.matrix)}getOffsetReferenceSpace(t){let e=new Nt(this[Bn].type,this[Bn].transform,this[Bn].bounds);return an(e[Bn].originOffset,this[Bn].originOffset,t.matrix),e}};var Ke=Symbol("@@webxr-polyfill/XR"),FA=["inline","immersive-vr","immersive-ar"],HA={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},NA=`Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode
or navigator.xr.requestSession('inline') prior to requesting an immersive
session. This is a limitation specific to the WebXR Polyfill and does not apply
to native implementations of the API.`,Vo=class extends sn{constructor(t){super(),this[Ke]={device:null,devicePromise:t,immersiveSession:null,inlineSessions:new Set},t.then(e=>{this[Ke].device=e})}async isSessionSupported(t){return this[Ke].device||await this[Ke].devicePromise,t!="inline"?Promise.resolve(this[Ke].device.isSessionSupported(t)):Promise.resolve(!0)}async requestSession(t,e){if(!this[Ke].device){if(t!="inline")throw new Error(NA);await this[Ke].devicePromise}if(!FA.includes(t))throw new TypeError(`The provided value '${t}' is not a valid enum value of type XRSessionMode`);let n=HA[t],i=n.requiredFeatures.concat(e&&e.requiredFeatures?e.requiredFeatures:[]),o=n.optionalFeatures.concat(e&&e.optionalFeatures?e.optionalFeatures:[]),s=new Set,a=!1;for(let x of i)this[Ke].device.isFeatureSupported(x)?s.add(x):(console.error(`The required feature '${x}' is not supported`),a=!0);if(a)throw new DOMException("Session does not support some required features","NotSupportedError");for(let x of o)this[Ke].device.isFeatureSupported(x)?s.add(x):console.log(`The optional feature '${x}' is not supported`);let p=await this[Ke].device.requestSession(t,s),d=new XRSession(this[Ke].device,t,p);t=="inline"?this[Ke].inlineSessions.add(d):this[Ke].immersiveSession=d;let h=()=>{t=="inline"?this[Ke].inlineSessions.delete(d):this[Ke].immersiveSession=null,d.removeEventListener("end",h)};return d.addEventListener("end",h),d}};var Fc;if("performance"in ja)Fc=()=>performance.now();else{let r=Date.now();Fc=()=>Date.now()-r}var Ja=Fc;var Hc=Symbol("@@webxr-polyfill/XRPose"),br=class{constructor(t,e){this[Hc]={transform:t,emulatedPosition:e}}get transform(){return this[Hc].transform}get emulatedPosition(){return this[Hc].emulatedPosition}};var $h=Symbol("@@webxr-polyfill/XRViewerPose"),Er=class extends br{constructor(t,e,n=!1){super(t,n),this[$h]={views:e}}get views(){return this[$h].views}};var Lo=Symbol("@@webxr-polyfill/XRViewport"),yr=class{constructor(t){this[Lo]={target:t}}get x(){return this[Lo].target.x}get y(){return this[Lo].target.y}get width(){return this[Lo].target.width}get height(){return this[Lo].target.height}};var Zh=["left","right","none"],Fn=Symbol("@@webxr-polyfill/XRView"),wr=class{constructor(t,e,n,i){if(!Zh.includes(n))throw new Error(`XREye must be one of: ${Zh}`);let o=Object.create(null),s=new yr(o);this[Fn]={device:t,eye:n,viewport:s,temp:o,sessionId:i,transform:e}}get eye(){return this[Fn].eye}get projectionMatrix(){return this[Fn].device.getProjectionMatrix(this.eye)}get transform(){return this[Fn].transform}_getViewport(t){if(this[Fn].device.getViewport(this[Fn].sessionId,this.eye,t,this[Fn].temp))return this[Fn].viewport}};var Se=Symbol("@@webxr-polyfill/XRFrame"),ef="XRFrame access outside the callback that produced it is invalid.",XA="getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.",zA=0,Hn=class{constructor(t,e,n){this[Se]={id:++zA,active:!1,animationFrame:!1,device:t,session:e,sessionId:n}}get session(){return this[Se].session}getViewerPose(t){if(!this[Se].animationFrame)throw new DOMException(XA,"InvalidStateError");if(!this[Se].active)throw new DOMException(ef,"InvalidStateError");let e=this[Se].device,n=this[Se].session;n[w].viewerSpace._ensurePoseUpdated(e,this[Se].id),t._ensurePoseUpdated(e,this[Se].id);let i=t._getSpaceRelativeTransform(n[w].viewerSpace),o=[];for(let a of n[w].viewSpaces){a._ensurePoseUpdated(e,this[Se].id);let p=t._getSpaceRelativeTransform(a),d=new wr(e,p,a.eye,this[Se].sessionId);o.push(d)}return new Er(i,o,!1)}getPose(t,e){if(!this[Se].active)throw new DOMException(ef,"InvalidStateError");let n=this[Se].device;if(t._specialType==="target-ray"||t._specialType==="grip")return n.getInputPose(t._inputSource,e,t._specialType);{t._ensurePoseUpdated(n,this[Se].id),e._ensurePoseUpdated(n,this[Se].id);let i=e._getSpaceRelativeTransform(t);return i?new XRPose(i,!1):null}return null}};var ko=Symbol("@@webxr-polyfill/XRRenderState"),jA=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null}),Nn=class{constructor(t={}){let e=Object.assign({},jA,t);this[ko]={config:e}}get depthNear(){return this[ko].config.depthNear}get depthFar(){return this[ko].config.depthFar}get inlineVerticalFieldOfView(){return this[ko].config.inlineVerticalFieldOfView}get baseLayer(){return this[ko].config.baseLayer}};var $a=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),Oo=Symbol("@@webxr-polyfill/xr-compatible");var Tr=Symbol("@@webxr-polyfill/XRWebGLLayer"),UA=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),Do=class{constructor(t,e,n={}){let i=Object.assign({},UA,n);if(!(t instanceof Mr))throw new Error("session must be a XRSession");if(t.ended)throw new Error("InvalidStateError");if(e[$a]&&e[Oo]!==!0)throw new Error("InvalidStateError");let o=e.getParameter(e.FRAMEBUFFER_BINDING);this[Tr]={context:e,config:i,framebuffer:o,session:t}}get context(){return this[Tr].context}get antialias(){return this[Tr].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return this[Tr].framebuffer}get framebufferWidth(){return this[Tr].context.drawingBufferWidth}get framebufferHeight(){return this[Tr].context.drawingBufferHeight}get _session(){return this[Tr].session}getViewport(t){return t._getViewport(this)}static getNativeFramebufferScaleFactor(t){if(!t)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return t[w].ended?0:1}};var Nc=Symbol("@@webxr-polyfill/XRInputSourceEvent"),pn=class extends Event{constructor(t,e){super(t,e),this[Nc]={frame:e.frame,inputSource:e.inputSource},Object.setPrototypeOf(this,pn.prototype)}get frame(){return this[Nc].frame}get inputSource(){return this[Nc].inputSource}};var tf=Symbol("@@webxr-polyfill/XRSessionEvent"),Xt=class extends Event{constructor(t,e){super(t,e),this[tf]={session:e.session},Object.setPrototypeOf(this,Xt.prototype)}get session(){return this[tf].session}};var Za=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),cn=class extends Event{constructor(t,e){super(t,e),this[Za]={session:e.session,added:e.added,removed:e.removed},Object.setPrototypeOf(this,cn.prototype)}get session(){return this[Za].session}get added(){return this[Za].added}get removed(){return this[Za].removed}};var w=Symbol("@@webxr-polyfill/XRSession"),Bo=class extends gt{constructor(t){super(t)}get eye(){return this._specialType}_onPoseUpdate(t){this._inverseBaseMatrix=t.getBaseViewMatrix(this._specialType)}},Mr=class extends sn{constructor(t,e,n){super();let i=e!="inline",o=new Nn({inlineVerticalFieldOfView:i?null:Math.PI*.5});this[w]={device:t,mode:e,immersive:i,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:n,activeRenderState:o,pendingRenderState:null,viewerSpace:new Nt("viewer"),viewSpaces:[],currentInputSources:[]},i?this[w].viewSpaces.push(new Bo("left"),new Bo("right")):this[w].viewSpaces.push(new Bo("none")),this[w].onDeviceFrame=()=>{if(this[w].ended||this[w].suspended||(this[w].deviceFrameHandle=null,this[w].startDeviceFrameLoop(),this[w].pendingRenderState!==null&&(this[w].activeRenderState=new Nn(this[w].pendingRenderState),this[w].pendingRenderState=null,this[w].activeRenderState.baseLayer&&this[w].device.onBaseLayerSet(this[w].id,this[w].activeRenderState.baseLayer)),this[w].activeRenderState.baseLayer===null))return;let s=new Hn(t,this,this[w].id),a=this[w].currentFrameCallbacks=this[w].frameCallbacks;this[w].frameCallbacks=[],s[Se].active=!0,s[Se].animationFrame=!0,this[w].device.onFrameStart(this[w].id,this[w].activeRenderState),this._checkInputSourcesChange();let p=Ja();for(let d=0;d<a.length;d++)try{!a[d].cancelled&&typeof a[d].callback=="function"&&a[d].callback(p,s)}catch(h){console.error(h)}this[w].currentFrameCallbacks=null,s[Se].active=!1,this[w].device.onFrameEnd(this[w].id)},this[w].startDeviceFrameLoop=()=>{this[w].deviceFrameHandle===null&&(this[w].deviceFrameHandle=this[w].device.requestAnimationFrame(this[w].onDeviceFrame))},this[w].stopDeviceFrameLoop=()=>{let s=this[w].deviceFrameHandle;s!==null&&(this[w].device.cancelAnimationFrame(s),this[w].deviceFrameHandle=null)},this[w].onPresentationEnd=s=>{if(s!==this[w].id){this[w].suspended=!1,this[w].startDeviceFrameLoop(),this.dispatchEvent("focus",{session:this});return}this[w].ended=!0,this[w].stopDeviceFrameLoop(),t.removeEventListener("@@webxr-polyfill/vr-present-end",this[w].onPresentationEnd),t.removeEventListener("@@webxr-polyfill/vr-present-start",this[w].onPresentationStart),t.removeEventListener("@@webxr-polyfill/input-select-start",this[w].onSelectStart),t.removeEventListener("@@webxr-polyfill/input-select-end",this[w].onSelectEnd),this.dispatchEvent("end",new Xt("end",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-end",this[w].onPresentationEnd),this[w].onPresentationStart=s=>{s!==this[w].id&&(this[w].suspended=!0,this[w].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-start",this[w].onPresentationStart),this[w].onSelectStart=s=>{s.sessionId===this[w].id&&this[w].dispatchInputSourceEvent("selectstart",s.inputSource)},t.addEventListener("@@webxr-polyfill/input-select-start",this[w].onSelectStart),this[w].onSelectEnd=s=>{s.sessionId===this[w].id&&(this[w].dispatchInputSourceEvent("selectend",s.inputSource),this[w].dispatchInputSourceEvent("select",s.inputSource))},t.addEventListener("@@webxr-polyfill/input-select-end",this[w].onSelectEnd),this[w].onSqueezeStart=s=>{s.sessionId===this[w].id&&this[w].dispatchInputSourceEvent("squeezestart",s.inputSource)},t.addEventListener("@@webxr-polyfill/input-squeeze-start",this[w].onSqueezeStart),this[w].onSqueezeEnd=s=>{s.sessionId===this[w].id&&(this[w].dispatchInputSourceEvent("squeezeend",s.inputSource),this[w].dispatchInputSourceEvent("squeeze",s.inputSource))},t.addEventListener("@@webxr-polyfill/input-squeeze-end",this[w].onSqueezeEnd),this[w].dispatchInputSourceEvent=(s,a)=>{let p=new Hn(t,this,this[w].id),d=new pn(s,{frame:p,inputSource:a});p[Se].active=!0,this.dispatchEvent(s,d),p[Se].active=!1},this[w].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[w].activeRenderState}get environmentBlendMode(){return this[w].device.environmentBlendMode||"opaque"}async requestReferenceSpace(t){if(this[w].ended)return;if(!Io.includes(t))throw new TypeError(`XRReferenceSpaceType must be one of ${Io}`);if(!this[w].device.doesSessionSupportReferenceSpace(this[w].id,t))throw new DOMException(`The ${t} reference space is not supported by this session.`,"NotSupportedError");if(t==="viewer")return this[w].viewerSpace;let e=await this[w].device.requestFrameOfReferenceTransform(t);if(t==="bounded-floor")throw e?this[w].device.requestStageBounds()?new DOMException(`The WebXR polyfill does not support the ${t} reference space yet.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError");return new Nt(t,e)}requestAnimationFrame(t){if(this[w].ended)return;let e=++this[w].frameHandle;return this[w].frameCallbacks.push({handle:e,callback:t,cancelled:!1}),e}cancelAnimationFrame(t){let e=this[w].frameCallbacks,n=e.findIndex(i=>i&&i.handle===t);n>-1&&(e[n].cancelled=!0,e.splice(n,1)),e=this[w].currentFrameCallbacks,e&&(n=e.findIndex(i=>i&&i.handle===t),n>-1&&(e[n].cancelled=!0))}get inputSources(){return this[w].device.getInputSources()}async end(){if(!this[w].ended)return this[w].immersive&&(this[w].ended=!0,this[w].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[w].onPresentationStart),this[w].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[w].onPresentationEnd),this[w].device.removeEventListener("@@webxr-polyfill/input-select-start",this[w].onSelectStart),this[w].device.removeEventListener("@@webxr-polyfill/input-select-end",this[w].onSelectEnd),this.dispatchEvent("end",new Xt("end",{session:this}))),this[w].stopDeviceFrameLoop(),this[w].device.endSession(this[w].id)}updateRenderState(t){if(this[w].ended){let n="Can't call updateRenderState on an XRSession that has already ended.";throw new Error(n)}if(t.baseLayer&&t.baseLayer._session!==this){let n="Called updateRenderState with a base layer that was created by a different session.";throw new Error(n)}if(t.inlineVerticalFieldOfView!==null&&t.inlineVerticalFieldOfView!==void 0)if(this[w].immersive){let n="inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.";throw new Error(n)}else t.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,t.inlineVerticalFieldOfView));if(this[w].pendingRenderState===null){let n=this[w].activeRenderState;this[w].pendingRenderState={depthNear:n.depthNear,depthFar:n.depthFar,inlineVerticalFieldOfView:n.inlineVerticalFieldOfView,baseLayer:n.baseLayer}}Object.assign(this[w].pendingRenderState,t)}_checkInputSourcesChange(){let t=[],e=[],n=this.inputSources,i=this[w].currentInputSources;for(let o of n)i.includes(o)||t.push(o);for(let o of i)n.includes(o)||e.push(o);(t.length>0||e.length>0)&&this.dispatchEvent("inputsourceschange",new cn("inputsourceschange",{session:this,added:t,removed:e})),this[w].currentInputSources.length=0;for(let o of n)this[w].currentInputSources.push(o)}};var Xn=Symbol("@@webxr-polyfill/XRInputSource"),Sr=class{constructor(t){this[Xn]={impl:t,gripSpace:new gt("grip",this),targetRaySpace:new gt("target-ray",this)}}get handedness(){return this[Xn].impl.handedness}get targetRayMode(){return this[Xn].impl.targetRayMode}get gripSpace(){let t=this[Xn].impl.targetRayMode;return t==="gaze"||t==="screen"?null:this[Xn].gripSpace}get targetRaySpace(){return this[Xn].targetRaySpace}get profiles(){return this[Xn].impl.profiles}get gamepad(){return this[Xn].impl.gamepad}};var Xc=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),Rr=class extends Event{constructor(t,e){super(t,e),this[Xc]={referenceSpace:e.referenceSpace,transform:e.transform||null},Object.setPrototypeOf(this,Rr.prototype)}get referenceSpace(){return this[Xc].referenceSpace}get transform(){return this[Xc].transform}};var el={XRSystem:Vo,XRSession:Mr,XRSessionEvent:Xt,XRFrame:Hn,XRView:wr,XRViewport:yr,XRViewerPose:Er,XRWebGLLayer:Do,XRSpace:gt,XRReferenceSpace:Nt,XRReferenceSpaceEvent:Rr,XRInputSource:Sr,XRInputSourceEvent:pn,XRInputSourcesChangeEvent:cn,XRRenderState:Nn,XRRigidTransform:ln,XRPose:br};var zc=r=>typeof r.prototype.makeXRCompatible=="function"?!1:(r.prototype.makeXRCompatible=function(){return this[Oo]=!0,Promise.resolve()},!0),jc=r=>{let t=r.prototype.getContext;r.prototype.getContext=function(e,n){let i=t.call(this,e,n);return i&&(i[$a]=!0,n&&"xrCompatible"in n&&(i[Oo]=n.xrCompatible)),i}};var nf=r=>!!(r.ImageBitmapRenderingContext&&r.createImageBitmap),rf=r=>{var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(r.navigator.userAgent||r.navigator.vendor||r.opera),t},of=r=>{r.style.display="block",r.style.position="absolute",r.style.width=r.style.height="1px",r.style.top=r.style.left="0px"};var xf=vx(sf());var Pr=class extends sn{constructor(t){super(),this.global=t,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(t,e){throw new Error("Not implemented")}isSessionSupported(t){throw new Error("Not implemented")}isFeatureSupported(t){throw new Error("Not implemented")}async requestSession(t,e){throw new Error("Not implemented")}requestAnimationFrame(t){throw new Error("Not implemented")}onFrameStart(t){throw new Error("Not implemented")}onFrameEnd(t){throw new Error("Not implemented")}doesSessionSupportReferenceSpace(t,e){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(t,e){}cancelAnimationFrame(t){throw new Error("Not implemented")}endSession(t){throw new Error("Not implemented")}getViewport(t,e,n,i){throw new Error("Not implemented")}getProjectionMatrix(t){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(t){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(t,e,n){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}};var GA={mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},WA={mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},qA={mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},af={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},QA={mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[Math.PI*-.08,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},KA={mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},YA={mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},Wc={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},JA={"Daydream Controller":GA,"Gear VR Controller":KA,"HTC Vive Focus Controller":WA,"Oculus Go Controller":qA,"Oculus Touch (Right)":af,"Oculus Touch (Left)":af,"OpenVR Gamepad":QA,"Spatial Controller (Spatial Interaction Source) 045E-065A":Wc,"Spatial Controller (Spatial Interaction Source) 045E-065D":YA,"Windows Mixed Reality (Right)":Wc,"Windows Mixed Reality (Left)":Wc},lf=JA;var pf=et(.155,-.465,-.15),$A=et(-.155,-.465,-.15),ZA=et(0,0,-.25),e_=et(0,0,.05),cf=et(-.08,.14,.08),df=.4,t_=.4,n_=.61,r_=.175,i_=.12,o_=.87,uf=180/Math.PI;function s_(r,t,e){function n(p,d,h){return p<d?d:p>h?h:p}var i=t[0]*t[0],o=t[1]*t[1],s=t[2]*t[2],a=t[3]*t[3];if(e==="XYZ")r[0]=Math.atan2(2*(t[0]*t[3]-t[1]*t[2]),a-i-o+s),r[1]=Math.asin(n(2*(t[0]*t[2]+t[1]*t[3]),-1,1)),r[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),a+i-o-s);else if(e==="YXZ")r[0]=Math.asin(n(2*(t[0]*t[3]-t[1]*t[2]),-1,1)),r[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),a-i-o+s),r[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),a-i+o-s);else if(e==="ZXY")r[0]=Math.asin(n(2*(t[0]*t[3]+t[1]*t[2]),-1,1)),r[1]=Math.atan2(2*(t[1]*t[3]-t[2]*t[0]),a-i-o+s),r[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),a-i+o-s);else if(e==="ZYX")r[0]=Math.atan2(2*(t[0]*t[3]+t[2]*t[1]),a-i-o+s),r[1]=Math.asin(n(2*(t[1]*t[3]-t[0]*t[2]),-1,1)),r[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),a+i-o-s);else if(e==="YZX")r[0]=Math.atan2(2*(t[0]*t[3]-t[2]*t[1]),a-i+o-s),r[1]=Math.atan2(2*(t[1]*t[3]-t[0]*t[2]),a+i-o-s),r[2]=Math.asin(n(2*(t[0]*t[1]+t[2]*t[3]),-1,1));else if(e==="XZY")r[0]=Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),a-i+o-s),r[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),a+i-o-s),r[2]=Math.asin(n(2*(t[2]*t[3]-t[0]*t[1]),-1,1));else{console.log("No order given for quaternion to euler conversion.");return}}var Fo=class{constructor(){this.hand="right",this.headElbowOffset=pf,this.controllerQ=lt(),this.lastControllerQ=lt(),this.headQ=lt(),this.headPos=at(),this.elbowPos=at(),this.wristPos=at(),this.time=null,this.lastTime=null,this.rootQ=lt(),this.position=at()}setHandedness(t){this.hand!=t&&(this.hand=t,this.hand=="left"?this.headElbowOffset=$A:this.headElbowOffset=pf)}update(t,e){this.time=Ja(),t&&(Ya(this.lastControllerQ,this.controllerQ),Ya(this.controllerQ,t)),e&&(Ua(this.headPos,e),Ga(this.headQ,e));let n=this.getHeadYawOrientation_(),i=this.quatAngle_(this.lastControllerQ,this.controllerQ),o=(this.time-this.lastTime)/1e3;i/o>n_?Mi(this.rootQ,this.rootQ,n,Math.min(i/r_,1)):Ya(this.rootQ,n);let a=et(0,0,-1);_r(a,a,this.controllerQ);let p=Po(a,[0,1,0]),d=this.clamp_((p-i_)/o_,0,1),h=Dc(this.rootQ);Oc(h,h),kc(h,h,this.controllerQ);let x=this.elbowPos;Vc(x,this.headPos),Ti(x,x,this.headElbowOffset);let A=Ic(cf);Lc(A,A,d),Ti(x,x,A);let S=this.quatAngle_(h,lt())*uf,P=1-Math.pow(S/180,4);sssss;let R=df,I=1-df,O=P*(R+I*d*t_),L=lt();Mi(L,L,h,O);let k=Oc(lt(),L),H=Dc(h);kc(H,H,k);let V=this.wristPos;Vc(V,e_),_r(V,V,L),Ti(V,V,ZA),_r(V,V,H),Ti(V,V,x);let D=Ic(cf);Lc(D,D,d),Ti(this.position,this.wristPos,D),_r(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let t=at();return s_(t,this.headQ,"YXZ"),Yh(lt(),0,t[1]*uf,0)}clamp_(t,e,n){return Math.min(Math.max(t,e),n)}quatAngle_(t,e){let n=[0,0,-1],i=[0,0,-1];return _r(n,n,t),_r(i,i,e),jh(n,i)}};var qe=Symbol("@@webxr-polyfill/XRRemappedGamepad"),mf={pressed:!1,touched:!1,value:0};Object.freeze(mf);var qc=class{constructor(t,e,n){if(n||(n={}),n.userAgentOverrides){for(let d in n.userAgentOverrides)if(navigator.userAgent.includes(d)){let h=n.userAgentOverrides[d];for(let x in h)x in n?Object.assign(n[x],h[x]):n[x]=h[x];break}}let i=new Array(n.axes&&n.axes.length?n.axes.length:t.axes.length),o=new Array(n.buttons&&n.buttons.length?n.buttons.length:t.buttons.length),s=null;if(n.gripTransform){let d=n.gripTransform.orientation||[0,0,0,1];s=Ht(),Dn(s,Co(d,d),n.gripTransform.position||[0,0,0])}let a=null;if(n.targetRayTransform){let d=n.targetRayTransform.orientation||[0,0,0,1];a=Ht(),Dn(a,Co(d,d),n.targetRayTransform.position||[0,0,0])}let p=n.profiles;n.displayProfiles&&e.displayName in n.displayProfiles&&(p=n.displayProfiles[e.displayName]),this[qe]={gamepad:t,map:n,profiles:p||[t.id],mapping:n.mapping||t.mapping,axes:i,buttons:o,gripTransform:s,targetRayTransform:a},this._update()}_update(){let t=this[qe].gamepad,e=this[qe].map,n=this[qe].axes;for(let o=0;o<n.length;++o)e.axes&&o in e.axes?e.axes[o]===null?n[o]=0:n[o]=t.axes[e.axes[o]]:n[o]=t.axes[o];if(e.axes&&e.axes.invert)for(let o of e.axes.invert)o<n.length&&(n[o]*=-1);let i=this[qe].buttons;for(let o=0;o<i.length;++o)e.buttons&&o in e.buttons?e.buttons[o]===null?i[o]=mf:i[o]=t.buttons[e.buttons[o]]:i[o]=t.buttons[o]}get id(){return""}get _profiles(){return this[qe].profiles}get index(){return-1}get connected(){return this[qe].gamepad.connected}get timestamp(){return this[qe].gamepad.timestamp}get mapping(){return this[qe].mapping}get axes(){return this[qe].axes}get buttons(){return this[qe].buttons}get hapticActuators(){return this[qe].gamepad.hapticActuators}},Ho=class{constructor(t,e,n=0,i=-1){this.polyfill=t,this.display=e,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new Sr(this),this.lastPosition=at(),this.emulatedPosition=!1,this.basePoseMatrix=Ht(),this.outputMatrix=Ht(),this.primaryButtonIndex=n,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=i,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(t){this.nativeGamepad!==t&&(this.nativeGamepad=t,t?this.gamepad=new qc(t,this.display,lf[t.id]):this.gamepad=null),this.handedness=t.hand===""?"none":t.hand,this.gamepad&&this.gamepad._update(),t.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!t.pose.hasPosition):t.hand===""&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let t=this.nativeGamepad.pose,e=t.position,n=t.orientation;if(!e&&!n)return;e?(this.lastPosition[0]=e[0],this.lastPosition[1]=e[1],this.lastPosition[2]=e[2]):t.hasPosition?e=this.lastPosition:(this.armModel||(this.armModel=new Fo),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(n,this.polyfill.getBasePoseMatrix()),e=this.armModel.getPosition()),Dn(this.basePoseMatrix,n,e)}else Xh(this.basePoseMatrix,this.polyfill.getBasePoseMatrix());return this.basePoseMatrix}getXRPose(t,e){switch(this.updateBasePoseMatrix(),e){case"target-ray":t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[qe].targetRayTransform&&an(this.outputMatrix,this.outputMatrix,this.gamepad[qe].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[qe].gripTransform&&an(this.outputMatrix,this.outputMatrix,this.gamepad[qe].gripTransform);break;default:return null}return t._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}};var r5=Symbol("@@webxr-polyfill/WebVRDevice"),No=!1,hf={highRefreshRate:!0},ff={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},a_=0,Qc=class{constructor(t,e,n={}){if(this.mode=t,this.enabledFeatures=e,this.outputContext=null,this.immersive=t=="immersive-vr"||t=="immersive-ar",this.ended=null,this.baseLayer=null,this.id=++a_,this.modifiedCanvasLayer=!1,this.outputContext&&!No){let i=n.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(i)}}},Cr=class extends Pr{constructor(t,e){let{canPresent:n}=e.capabilities;super(t),this.display=e,this.frame=new t.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=n,this.baseModelMatrix=Ht(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),t.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=t.navigator&&"getGamepads"in t.navigator,this.HAS_BITMAP_SUPPORT=nf(t)}get depthNear(){return this.display.depthNear}set depthNear(t){this.display.depthNear=t}get depthFar(){return this.display.depthFar}set depthFar(t){this.display.depthFar=t}onBaseLayerSet(t,e){let n=this.sessions.get(t),i=e.context.canvas;if(n.immersive){let o=this.display.getEyeParameters("left"),s=this.display.getEyeParameters("right");i.width=Math.max(o.renderWidth,s.renderWidth)*2,i.height=Math.max(o.renderHeight,s.renderHeight),this.display.requestPresent([{source:i,attributes:hf}]).then(()=>{!No&&!this.global.document.body.contains(i)&&(n.modifiedCanvasLayer=!0,this.global.document.body.appendChild(i),of(i)),n.baseLayer=e})}else n.baseLayer=e}isSessionSupported(t){return!(t=="immersive-ar"||t=="immersive-vr"&&this.canPresent===!1)}isFeatureSupported(t){switch(t){case"viewer":return!0;case"local":return!0;case"local-floor":return!0;case"bounded":return!1;case"unbounded":return!1;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let n=t=="immersive-vr";if(n){let o=this.global.document.createElement("canvas");if(!No){let s=o.getContext("webgl")}await this.display.requestPresent([{source:o,attributes:hf}])}let i=new Qc(t,e,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(i.id,i),n&&(this.immersiveSession=i,this.dispatchEvent("@@webxr-polyfill/vr-present-start",i.id)),Promise.resolve(i.id)}requestAnimationFrame(t){return this.display.requestAnimationFrame(t)}getPrimaryButtonIndex(t){let e=0,n=t.id.toLowerCase();for(let i in ff)if(n.includes(i)){e=ff[i];break}return Math.min(e,t.buttons.length-1)}onFrameStart(t,e){this.display.depthNear=e.depthNear,this.display.depthFar=e.depthFar,this.display.getFrameData(this.frame);let n=this.sessions.get(t);if(n.immersive&&this.CAN_USE_GAMEPAD){let i=this.gamepadInputSources;this.gamepadInputSources={};let o=this.global.navigator.getGamepads();for(let s=0;s<o.length;++s){let a=o[s];if(a&&a.displayId>0){let p=i[s];if(p||(p=new Ho(this,this.display,this.getPrimaryButtonIndex(a))),p.updateFromGamepad(a),this.gamepadInputSources[s]=p,p.primaryButtonIndex!=-1){let d=a.buttons[p.primaryButtonIndex].pressed;d&&!p.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:n.id,inputSource:p.inputSource}):!d&&p.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:n.id,inputSource:p.inputSource}),p.primaryActionPressed=d}if(p.primarySqueezeButtonIndex!=-1){let d=a.buttons[p.primarySqueezeButtonIndex].pressed;d&&!p.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:n.id,inputSource:p.inputSource}):!d&&p.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:n.id,inputSource:p.inputSource}),p.primarySqueezeActionPressed=d}}}}if(!No&&!n.immersive&&n.baseLayer){let i=n.baseLayer.context.canvas;Wa(this.frame.leftProjectionMatrix,e.inlineVerticalFieldOfView,i.width/i.height,e.depthNear,e.depthFar)}}onFrameEnd(t){let e=this.sessions.get(t);if(!(e.ended||!e.baseLayer)){if(e.outputContext&&!(e.immersive&&!this.display.capabilities.hasExternalDisplay)){let n=e.immersive&&this.display.capabilities.hasExternalDisplay,i=e.baseLayer.context.canvas,o=n?i.width/2:i.width,s=i.height;if(!No){let a=e.outputContext.canvas,p=a.width,d=a.height,h=e.renderContext;this.HAS_BITMAP_SUPPORT?i.transferToImageBitmap?h.transferFromImageBitmap(i.transferToImageBitmap()):this.global.createImageBitmap(i,0,0,o,s,{resizeWidth:p,resizeHeight:d}).then(x=>h.transferFromImageBitmap(x)):h.drawImage(i,0,0,o,s,0,0,p,d)}}e.immersive&&e.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(t){this.display.cancelAnimationFrame(t)}async endSession(t){let e=this.sessions.get(t);if(!e.ended){if(e.immersive)return this.display.exitPresent();e.ended=!0}}doesSessionSupportReferenceSpace(t,e){let n=this.sessions.get(t);return n.ended?!1:n.enabledFeatures.has(e)}requestStageBounds(){if(this.display.stageParameters){let t=this.display.stageParameters.sizeX,e=this.display.stageParameters.sizeZ,n=[];return n.push(-t/2),n.push(-e/2),n.push(t/2),n.push(-e/2),n.push(t/2),n.push(e/2),n.push(-t/2),n.push(e/2),n}return null}async requestFrameOfReferenceTransform(t,e){return(t==="local-floor"||t==="bounded-floor")&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(t){if(t==="left")return this.frame.leftProjectionMatrix;if(t==="right")return this.frame.rightProjectionMatrix;if(t==="none")return this.frame.leftProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(t,e,n,i){let o=this.sessions.get(t),{width:s,height:a}=n.context.canvas;if(!o.immersive)return i.x=i.y=0,i.width=s,i.height=a,!0;if(e==="left"||e==="none")i.x=0;else if(e==="right")i.x=s/2;else return!1;return i.y=0,i.width=s/2,i.height=a,!0}getBasePoseMatrix(){let{position:t,orientation:e}=this.frame.pose;return!t&&!e?this.baseModelMatrix:(t||(t=this.tempVec3,t[0]=t[1]=t[2]=0),Dn(this.baseModelMatrix,e,t),this.baseModelMatrix)}getBaseViewMatrix(t){if(t==="left"||t==="none")return this.frame.leftViewMatrix;if(t==="right")return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let t=[];for(let e in this.gamepadInputSources)t.push(this.gamepadInputSources[e].inputSource);return t}getInputPose(t,e,n){if(!e)return null;for(let i in this.gamepadInputSources){let o=this.gamepadInputSources[i];if(o.inputSource===t)return o.getXRPose(e,n)}return null}onWindowResize(){}onVRDisplayPresentChange(t){this.display.isPresenting||this.sessions.forEach(e=>{if(e.immersive&&!e.ended){if(e.modifiedCanvasLayer){let n=e.baseLayer.context.canvas;document.body.removeChild(n),n.setAttribute("style","")}this.immersiveSession===e&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",e.id)}})}};var Xo=class extends Cr{constructor(t,e){let n=new xf.default(e||{});super(t,n),this.display=n,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}};var l_=!1,p_=0,Kc=class{constructor(t,e){this.mode=t,this.enabledFeatures=e,this.ended=null,this.baseLayer=null,this.id=++p_}},zo=class extends Pr{constructor(t){super(t),this.sessions=new Map,this.projectionMatrix=Ht(),this.identityMatrix=Ht()}onBaseLayerSet(t,e){let n=this.sessions.get(t);n.baseLayer=e}isSessionSupported(t){return t=="inline"}isFeatureSupported(t){switch(t){case"viewer":return!0;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let n=new Kc(t,e);return this.sessions.set(n.id,n),Promise.resolve(n.id)}requestAnimationFrame(t){return window.requestAnimationFrame(t)}cancelAnimationFrame(t){window.cancelAnimationFrame(t)}onFrameStart(t,e){if(l_)return;let n=this.sessions.get(t);if(n.baseLayer){let i=n.baseLayer.context.canvas;Wa(this.projectionMatrix,e.inlineVerticalFieldOfView,i.width/i.height,e.depthNear,e.depthFar)}}onFrameEnd(t){}async endSession(t){let e=this.sessions.get(t);e.ended=!0}doesSessionSupportReferenceSpace(t,e){let n=this.sessions.get(t);return n.ended?!1:n.enabledFeatures.has(e)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(t,e){return null}getProjectionMatrix(t){return this.projectionMatrix}getViewport(t,e,n,i){let o=this.sessions.get(t),{width:s,height:a}=n.context.canvas;return i.x=i.y=0,i.width=s,i.height=a,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(t){return this.identityMatrix}getInputSources(){return[]}getInputPose(t,e,n){return null}onWindowResize(){}};var c_=async function(r){let t=null;if("getVRDisplays"in r.navigator)try{let e=await r.navigator.getVRDisplays();e&&e.length&&(t=new Cr(r,e[0]))}catch{}return t},gf=async function(r,t){if(t.webvr){let n=await c_(r);if(n)return n}let e=rf(r);return e&&t.cardboard||!e&&t.allowCardboardOnDesktop?(r.VRFrameData||(r.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new Xo(r,t.cardboardConfig)):new zo(r)};var d_={global:ja,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},tl=["navigator","HTMLCanvasElement","WebGLRenderingContext"],jo=class{constructor(t={}){this.config=Object.freeze(Object.assign({},d_,t)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}_injectPolyfill(t){if(!tl.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${tl}`);for(let e of Object.keys(el))t[e]!==void 0?console.warn(`${e} already defined on global.`):t[e]=el[e];zc(t.WebGLRenderingContext)&&(jc(t.HTMLCanvasElement),t.OffscreenCanvas&&jc(t.OffscreenCanvas),t.WebGL2RenderingContext&&zc(t.WebGL2RenderingContext),window.isSecureContext||console.warn(`WebXR Polyfill Warning:
This page is not running in a secure context (https:// or localhost)!
This means that although the page may be able to use the WebXR Polyfill it will
not be able to use native WebXR implementations, and as such will not be able to
access dedicated VR or AR hardware, and will not be able to take advantage of
any performance improvements a native WebXR implementation may offer. Please
host this content on a secure origin for the best user experience.
`)),this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let t=gf(this.global,this.config);this.xr=new el.XRSystem(t),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(t){if(!tl.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${tl}`);if(t.navigator.xr&&"supportsSession"in t.navigator.xr&&!("isSessionSupported"in t.navigator.xr)){let e=t.navigator.xr.supportsSession;t.navigator.xr.isSessionSupported=function(n){return e.call(this,n).then(()=>!0).catch(()=>!1)},t.navigator.xr.supportsSession=function(n){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),e.call(this,n)}}}};navigator.xr||(console.info("Polyfilling WebXR API"),new jo);var rl=class extends j{constructor(e,n,i,o,s){super(e);this.mode=n;this.session=i;this.referenceSpaceType=o;this.sessionMode=s}},il=class extends rl{constructor(t,e,n,i){super("sessionstarted",t,e,n,i)}},ol=class extends rl{constructor(t,e,n,i){super("sessionstopped",t,e,n,i)}},nl=new Map([["VR",{referenceSpaceType:"local-floor",sessionMode:"immersive-vr"}],["AR",{referenceSpaceType:"local-floor",sessionMode:"immersive-ar"}]]),sl=class extends q{constructor(e,n,i,o){super();this.renderer=e;this.camera=n;this.fullscreenElement=i;this.enableFullResolution=o;this._currentMode="None";this.buttons=new Map;this.currentSession=null;this.screenUI=null;this.wasVisible=new Map;this.lastWidth=0;this.lastHeight=0;this.addEventListener("sessionstarted",s=>{s.sessionMode==="inline"&&(this.camera.fov=s.session.renderState.inlineVerticalFieldOfView*180/Math.PI)}),this.addEventListener("sessionstopped",s=>{s.sessionMode==="inline"&&(this.camera.fov=50)}),this.renderer.xr.addEventListener("sessionstart",()=>this.onSessionStarted()),this.renderer.xr.addEventListener("sessionend",()=>this.onSessionEnded()),this.refresh()}setUI(e,n,i,o){this.screenUI=e,this.buttons.set(n.mode,n),this.buttons.set(i.mode,i),this.buttons.set(o.mode,o);for(let s of this.buttons.values())this.wasVisible.set(s,s.visible),s.addEventListener("click",this.toggleMode.bind(this,s.mode));n.available=!Ut()&&Cc(),i.available=Jo(),o.available=Yo()}get visible(){return Pt(this.renderer.domElement)}set visible(e){Ie(this.renderer.domElement,e),this.screenUI&&Ie(this.screenUI,e,"grid")}get currentMode(){return this._currentMode}resize(){if(!this.renderer.xr.isPresenting){let e=this.renderer.domElement.clientWidth,n=this.renderer.domElement.clientHeight;e>0&&n>0&&(e!==this.lastWidth||n!==this.lastHeight)&&(this.renderer.setPixelRatio(devicePixelRatio),this.renderer.setSize(e,n,!1),this.camera.aspect=e/n,this.camera.updateProjectionMatrix(),this.lastWidth=e,this.lastHeight=n)}}getMetrics(){let e=this.renderer.domElement.clientWidth,n=this.renderer.domElement.clientHeight,i=this.renderer.getPixelRatio(),o=this.camera.fov;return{width:e,height:n,pixelRatio:i,fov:o}}setMetrics(e,n,i,o){this.renderer.setPixelRatio(i),this.renderer.setSize(e,n,!1),this.camera.aspect=e/n,this.camera.fov=o,this.camera.updateProjectionMatrix()}async refresh(){await Promise.all(Array.from(this.buttons.values()).filter(e=>e.available&&e.mode!=="Fullscreen").map(async e=>{let n=nl.get(e.mode);if(e.available=v(n),e.available){let i=navigator.xr&&await navigator.xr.isSessionSupported(n.sessionMode),o=!Yo()&&Ml()&&n.sessionMode==="immersive-vr"&&n.referenceSpaceType==="local-floor";e.available=i||o}}))}async toggleMode(e){e==="Fullscreen"?await this.toggleFullscreen():e!=="None"&&await this.toggleXR(e)}async start(e){e!==this.currentMode&&(await this.toggleMode(this.currentMode),await this.toggleMode(e))}async stop(){await this.toggleMode(this.currentMode)}get isFullscreen(){return document.fullscreen}async startFullscreen(){this.isFullscreen||(await this.fullscreenElement.requestFullscreen({navigationUI:"show"}),this.setActive("Fullscreen"),this.dispatchEvent(new il("Fullscreen",null,null,null)))}async stopFullscreen(){this.isFullscreen&&(await document.exitFullscreen(),this.setActive("None"),this.dispatchEvent(new ol("Fullscreen",null,null,null)))}async toggleFullscreen(){this.isFullscreen?await this.stopFullscreen():await this.startFullscreen()}async toggleXR(e){let n=nl.get(e);if(v(n)){if(this.currentSession)this.currentSession.end();else if(navigator.xr){this.camera.position.setScalar(0),this.camera.quaternion.identity();try{let i=await navigator.xr.requestSession(n.sessionMode,{optionalFeatures:["local-floor","bounded-floor","high-refresh-rate","hand-tracking","layers"]});if(this.setActive(e),this.currentSession=i,this.renderer.xr.setReferenceSpaceType(n.referenceSpaceType),this.enableFullResolution&&"XRWebGLLayer"in window&&"getNativeFramebufferScaleFactor"in XRWebGLLayer){let o=XRWebGLLayer.getNativeFramebufferScaleFactor(i);this.renderer.xr.setFramebufferScaleFactor(o)}this.renderer.xr.setSession(i)}catch(i){console.error(`Couldn't start session type '${n.sessionMode}'. Reason: ${i&&i.message||i||"UNKNOWN"}`)}}}}onSessionStarted(){let e=this.currentMode,n=nl.get(this.currentMode),i=this.currentSession;if(i.supportedFrameRates){let o=Math.max(...i.supportedFrameRates);console.log("Changing framerate to",o),i.updateTargetFrameRate(o)}this.dispatchEvent(new il(e,i,n.referenceSpaceType,n.sessionMode))}onSessionEnded(){let e=this.currentMode,n=nl.get(this.currentMode),i=this.currentSession;this.currentSession=null,this.renderer.xr.setSession(null),this.setActive("None"),this.dispatchEvent(new ol(e,i,n.referenceSpaceType,n.sessionMode))}setActive(e){for(let n of this.buttons.values())n.active=n.mode===e,n.visible=this.wasVisible.get(n)&&(e==="None"||e==="Fullscreen"||n.mode===e);this._currentMode=e}};var vf=new THREE.Vector3(0,1,0),Ye=2048,Si=Ye/2,u_=[1,0,2,3,4,5],dn={rows:3,columns:4,indices:[[-1,2,-1,-1],[0,5,1,4],[-1,3,-1,-1]],rotations:[[0,Math.PI,0,0],[0,0,0,0],[0,Math.PI,0,0]]},Yc=new THREE.Color(0),al=class{constructor(t){this.env=t;this.rt=new THREE.WebGLCubeRenderTarget(Ye);this.rtScene=new THREE.Scene;this.rtCamera=new THREE.CubeCamera(.01,10,this.rt);this._rotation=new THREE.Quaternion;this.layerRotation=new THREE.Quaternion().identity();this.stageRotation=new THREE.Quaternion().identity();this.canvases=new Array(6);this.contexts=new Array(6);this.onNeedsRedraw=null;this.layerOrientation=null;this.images=null;this.curImagePath=null;this.layer=null;this.wasVisible=!1;this.stageHeading=0;this.rotationNeedsUpdate=!1;this.imageNeedsUpdate=!1;this.wasWebXRLayerAvailable=null;this.visible=!0;this.framecount=0;this.onNeedsRedraw=()=>this.imageNeedsUpdate=!0,this.env.scene.background=Yc;for(let e=0;e<this.canvases.length;++e){let n=this.canvases[e]=Qr(Ye,Ye);this.contexts[e]=n.getContext("2d",{alpha:!1})}for(let e=0;e<dn.rows;++e){let n=dn.indices[e],i=dn.rotations[e];for(let o=0;o<dn.columns;++o){let s=n[o];if(s>-1){let a=this.contexts[s],p=i[o];p>0&&(p%2,a.translate(Si,Si),a.rotate(p),a.translate(-Si,-Si))}}}this.rt.texture.name="SkyboxOutput",this.rtScene.add(this.rtCamera),this.flipped=Qr(Ye,Ye),this.flipper=this.flipped.getContext("2d",{alpha:!1}),this.flipper.fillStyle=Yc.getHexString(),this.flipper.scale(-1,1),this.flipper.translate(-Ye,0),this.setImages("",this.canvases),Object.seal(this)}setImage(t,e){if(t!==this.curImagePath){let n=e.width/dn.columns,i=e.height/dn.rows;for(let o=0;o<dn.rows;++o){let s=dn.indices[o];for(let a=0;a<dn.columns;++a){let p=s[a];p>-1&&this.contexts[p].drawImage(e,a*n,o*i,n,i,0,0,Ye,Ye)}}this.setImages(t,this.canvases)}}setImages(t,e){(t!==this.curImagePath||e!==this.images)&&(this.curImagePath=t,e!==this.images&&(v(this.cube)&&Vn(this.cube),this.images=e,this.rtScene.background=this.cube=new THREE.CubeTexture(this.images),this.cube.name="SkyboxInput")),this.updateImages()}updateImages(){this.cube.needsUpdate=!0,this.imageNeedsUpdate=!0}get rotation(){return this._rotation}set rotation(t){let{x:e,y:n,z:i,w:o}=this._rotation;if(Zu(t))this._rotation.copy(t);else if(em(t))this._rotation.setFromEuler(t);else if(ke(t))if(t.length===4&&ce(t[0])&&ce(t[1])&&ce(t[2])&&ce(t[3]))this._rotation.fromArray(t);else throw new Error("Skybox rotation was not a valid array format. Needs an array of 4 numbers.");else Ue(t)?this._rotation.setFromAxisAngle(vf,t):(v(t)&&console.warn("Skybox rotation must be a THREE.Quaternion, THREE.Euler, number[] (representing a Quaternion), or a number (representing rotation about the Y-axis)."),this._rotation.identity());this.rotationNeedsUpdate=this._rotation.x!==e||this._rotation.y!==n||this._rotation.z!==i||this._rotation.w!==o}update(t){if(this.framecount++,this.cube){let e=this.env.hasXRCompositionLayers&&!!this.env.xrBinding&&!!t,n=e!==this.wasWebXRLayerAvailable;if(n){if(e){console.log("Layer created on frame "+this.framecount);let i=this.env.renderer.xr.getReferenceSpace();this.layer=this.env.xrBinding.createCubeLayer({space:i,layout:"mono",isStatic:!1,viewPixelWidth:Ye,viewPixelHeight:Ye,orientation:this.layerOrientation}),this.layer.addEventListener("redraw",this.onNeedsRedraw),this.env.addWebXRLayer(this.layer,Number.MAX_VALUE)}else this.layer&&(this.env.removeWebXRLayer(this.layer),this.layer.removeEventListener("redraw",this.onNeedsRedraw),this.layer.destroy(),this.layer=null);this.imageNeedsUpdate=!0}if(!this.layer||!n){let i=this.visible!==this.wasVisible,o=this.env.avatar.heading!==this.stageHeading;if(this.imageNeedsUpdate=this.imageNeedsUpdate||i||this.layer&&this.layer.needsRedraw,this.rotationNeedsUpdate=this.rotationNeedsUpdate||o,this.env.scene.background=this.layer?null:this.visible?this.rt.texture:Yc,this.rotationNeedsUpdate&&(this.layerRotation.copy(this.rotation).invert(),this.stageRotation.setFromAxisAngle(vf,this.env.avatar.heading).premultiply(this.layerRotation),this.layerOrientation=new DOMPointReadOnly(this.stageRotation.x,this.stageRotation.y,this.stageRotation.z,this.stageRotation.w),this.layer?this.layer.orientation=this.layerOrientation:(this.rtCamera.quaternion.copy(this.layerRotation),this.imageNeedsUpdate=!0)),this.imageNeedsUpdate)if(this.layer){console.log("layer rendering on frame "+this.framecount);let s=this.env.renderer.getContext(),a=this.env.xrBinding.getSubImage(this.layer,t),p=this.cube.images;this.flipper.fillRect(0,0,Ye,Ye),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.bindTexture(s.TEXTURE_CUBE_MAP,a.colorTexture);for(let d=0;d<p.length;++d){if(this.visible){let h=p[u_[d]];this.flipper.drawImage(h,0,0,h.width,h.height,0,0,Ye,Ye)}s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.flipped)}s.bindTexture(s.TEXTURE_CUBE_MAP,null)}else this.rtCamera.update(this.env.renderer,this.rtScene);this.stageHeading=this.env.avatar.heading,this.imageNeedsUpdate=!1,this.rotationNeedsUpdate=!1,this.wasVisible=this.visible}this.wasWebXRLayerAvailable=e}}};var Jc=class extends Ki{constructor(){super();this.frame=null;Object.seal(this)}set(e,n,i){super.set(e,n),this.frame=i}},ll=class{constructor(t){this.renderer=t;this.tickHandlers=new Array;this.lt=-1;this._isRunning=!1;let e=new Jc,n=0;this._onTick=(i,o)=>{this.lt>=0&&(n=i-this.lt,e.set(i,n,o),this.tick(e)),this.lt=i}}get isRunning(){return this._isRunning}restart(){this.stop(),this.start()}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){dt(this.tickHandlers,t)}setAnimationLoop(t){this.renderer.setAnimationLoop(t),this._isRunning=v(t)}start(){this.isRunning||this.setAnimationLoop(this._onTick)}stop(){this.isRunning&&(this.setAnimationLoop(null),this.lt=-1)}tick(t){for(let e of this.tickHandlers)e(t)}};var Af=15,m_=qd(Af);Ct(ee("#frontBuffer",Wr("absolute"),er(0),nr(0),yt("100%"),Yt("100%"),bn(0),En(0),pu(0),bu("none")));var pl=class extends q{constructor(e,n,i,o,s){super();this.fetcher=n;this.defaultAvatarHeight=i;this.DEBUG=s;this.layers=new Array;this.layerSortOrder=new Map;this.spectator=new THREE.PerspectiveCamera;this.lastViewport=new THREE.Vector4;this.curViewport=new THREE.Vector4;this.fadeDepth=0;this.camera=new THREE.PerspectiveCamera(50,1,.01,1e3);this.scene=new THREE.Scene;this.stage=se("Stage");this.ambient=new THREE.AmbientLight(16777215,.5);this.sun=new THREE.DirectionalLight(16777215,.75);this.ground=new THREE.GridHelper(m_,Af,12632256,8421504);this.foreground=se("Foreground");this.loadingBar=new za;this.enableSpectator=!1;this._xrBinding=null;this._xrMediaBinding=null;this._hasXRMediaLayers=null;this._hasXRCompositionLayers=null;this.cursor3D=new vi(this),ar(e)&&(e.style.backgroundColor="black"),this.renderer=new THREE.WebGLRenderer({canvas:e,powerPreference:"high-performance",precision:"lowp",antialias:!0,alpha:!1,premultipliedAlpha:!0,depth:!0,logarithmicDepthBuffer:!0,stencil:!1,preserveDrawingBuffer:!1}),this.renderer.domElement.setAttribute("touch-action","none"),this.renderer.domElement.tabIndex=1,this.screenControl=new sl(this.renderer,this.camera,this.renderer.domElement.parentElement,o),this.fader=new Xa("ViewFader"),this.worldUISpace=new Aa("WorldUISpace",.2,20,.125),this.avatar=new ya(this,this.fader,i),this.pointers=new Na(this),this.skybox=new al(this),this.timer=new ll(this.renderer),this.renderer.xr.enabled=!0,this.sun.name="Sun",this.sun.position.set(0,1,1),this.sun.lookAt(0,0,0),this.sun.layers.enableAll();let a=()=>{this.ground.visible=this.renderer.xr.isPresenting};this.screenControl.addEventListener("sessionstarted",a),this.screenControl.addEventListener("sessionstopped",a),a(),this.ambient.name="Fill",this.ambient.layers.enableAll(),this.loadingBar.object.name="MainLoadingBar",this.loadingBar.object.position.set(0,-.25,-2),this.scene.layers.enableAll(),this.avatar.addFollower(this.worldUISpace),U(this.scene,this.sun,this.ambient,U(this.stage,this.ground,this.camera,this.avatar,...this.pointers.hands),this.foreground,U(this.worldUISpace,this.loadingBar)),this.timer.addTickHandler(p=>this.update(p)),this.timer.start(),globalThis.env=this}get gl(){return this.renderer.getContext()}get referenceSpace(){return this.renderer.xr.getReferenceSpace()}update(e){if(this.screenControl.visible){let n=this.xrSession;this._xrBinding=this.renderer.xr.getBinding(),this.hasXRMediaLayers&&this._xrMediaBinding===null===this.renderer.xr.isPresenting&&(this._xrMediaBinding===null&&v(n)?this._xrMediaBinding=new XRMediaBinding(n):this._xrMediaBinding=null);let i=n&&this.renderer.xr.getBaseLayer();i!==this.baseLayer&&(v(this.baseLayer)&&(this.removeWebXRLayer(this.baseLayer),this.baseLayer=null),v(i)&&(this.baseLayer=i,this.addWebXRLayer(i,0))),this.screenControl.resize(),this.pointers.update(),this.avatar.update(e.dt),this.worldUISpace.update(this.avatar.height,this.avatar.worldPos,this.avatar.worldHeading,e.dt),this.fader.update(e.dt),zm(e.dt),this.loadingBar.update(e.sdt),this.preRender(e),this.skybox.update(e.frame);let o=fr(this.renderer,this.camera);if(o!==this.camera){let s=o;s.layers.mask=this.camera.layers.mask;for(let a=0;a<s.cameras.length;++a){let p=s.cameras[a];p.layers.mask=this.camera.layers.mask,p.layers.enable(a+1),s.layers.enable(a+1)}}this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.enableSpectator&&(this.renderer.xr.isPresenting?kr()&&!wd()&&this.drawSnapshot():(this.lastViewport.copy(this.curViewport),this.renderer.getViewport(this.curViewport)))}}drawSnapshot(){let e=this.renderer.xr.isPresenting,n=null;if(e){let i=fr(this.renderer,this.camera);this.spectator.projectionMatrix.copy(this.camera.projectionMatrix),this.spectator.position.copy(i.position),this.spectator.quaternion.copy(i.quaternion),n=this.renderer.getRenderTarget(),this.renderer.xr.isPresenting=!1,this.renderer.setRenderTarget(null),this.renderer.setViewport(this.lastViewport)}this.renderer.clear(),this.renderer.render(this.scene,e?this.spectator:this.camera),e&&(this.renderer.setViewport(this.curViewport),this.renderer.setRenderTarget(n),this.renderer.xr.isPresenting=!0)}preRender(e){}async onQuitting(){this.dispatchEvent(new j("quitting")),window.location.href="/"}get hasAlpha(){return this.renderer.getContextAttributes().alpha}get xrSession(){return this.renderer.xr.getSession()}get xrBinding(){return this._xrBinding}get xrMediaBinding(){return this._xrMediaBinding}get isReadyForLayers(){return this.hasAlpha&&(!Gt||Td.major>=15)}get hasXRMediaLayers(){return this._hasXRMediaLayers===null&&(this._hasXRMediaLayers=this.isReadyForLayers&&"XRMediaBinding"in globalThis&&pe(XRMediaBinding.prototype.createQuadLayer)),this._hasXRMediaLayers}get hasXRCompositionLayers(){return this._hasXRCompositionLayers===null&&(this._hasXRCompositionLayers=this.isReadyForLayers&&"XRWebGLBinding"in globalThis&&pe(XRWebGLBinding.prototype.createCubeLayer)),this._hasXRCompositionLayers}addWebXRLayer(e,n){this.layers.push(e),this.layerSortOrder.set(e,n),Wn(this.layers,i=>-this.layerSortOrder.get(i)),this.updateLayers()}removeWebXRLayer(e){this.layerSortOrder.delete(e),dt(this.layers,e),this.updateLayers()}updateLayers(){let e=this.xrSession;v(e)&&e.updateRenderState({layers:this.layers})}clearScene(){this.dispatchEvent(new j("sceneclearing")),Vn(this.foreground),this.dispatchEvent(new j("scenecleared"))}async fadeOut(){++this.fadeDepth,this.fadeDepth===1&&(await this.fader.fadeOut(),this.skybox.visible=!1,this.camera.layers.set(xi),this.loadingBar.start(),await this.fader.fadeIn())}async fadeIn(){--this.fadeDepth,this.fadeDepth===0&&(await this.fader.fadeOut(),this.camera.layers.set(wa),this.skybox.visible=!0,await this.fader.fadeIn())}set3DCursor(e){let n=e.children.slice(0);for(let i of n)this.cursor3D.add(i.name,i);this.pointers.refreshCursors(),this.dispatchEvent(new j("newcursorloaded"))}async load(e,...n){let i=null;e instanceof Kn?n.push(e):i=e;let o=new yo("/models/Cursors.glb",ss,!this.DEBUG);n.push(o),await this.fetcher.assets(i,...n),nm(o.result.scene,rm),this.set3DCursor(o.result.scene)}};var cl=class{constructor(t,e){this.name=t;this._level=0;this.maxLevel=0;this.analyzer=_m(this.name,e,{fftSize:32,minDecibels:-70}),this.buffer=new Uint8Array(this.analyzer.frequencyBinCount)}dispose(){ie(this.analyzer)}get level(){return this.analyzer.getByteFrequencyData(this.buffer),this._level=Math.max(...this.buffer),isFinite(this._level)&&(this.maxLevel=Math.max(this.maxLevel,this._level),this.maxLevel>0&&(this._level/=this.maxLevel)),this._level}get input(){return this.analyzer}get output(){return this.analyzer}};Ct(ee(".input-range-with-number",Ge("grid"),ps("column"),uu("5px"),_n("1fr auto")));var $c=class extends q{constructor(...e){super();this.element=xe(we("input-range-with-number"),this.rangeInput=Hu(...e),this.numberInput=Fu()),this.numberInput.min=this.rangeInput.min,this.numberInput.max=this.rangeInput.max,this.numberInput.step=this.rangeInput.step,this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.numberInput.disabled=this.rangeInput.disabled,this.numberInput.placeholder=this.rangeInput.placeholder,this.numberInput.addEventListener("input",()=>{this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber,this.rangeInput.dispatchEvent(new Event("input"))}),this.rangeInput.addEventListener("input",()=>{this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.dispatchEvent(new j("input"))})}get value(){return this.rangeInput.value}set value(e){this.rangeInput.value=this.numberInput.value=e}get valueAsNumber(){return this.rangeInput.valueAsNumber}set valueAsNumber(e){this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber=e}get disabled(){return this.rangeInput.disabled}set disabled(e){this.rangeInput.disabled=this.numberInput.disabled=e}};function Zc(...r){return new $c(...r)}var dl=class{constructor(t,...e){this.name=t;this.properties=e}};function _f(r,...t){return new dl(r,...t)}Ct(ee("dl",Ge("grid"),ps("row"),_n("auto 1fr"),bn("1em")),ee("dt",Zn(1),tr("right"),_u("1em")),ee("dd",tr("left"),Zn(2),fu("0")),ee("dl > span, dl > div",Zn(1,3)),ee("dl .alert",yt("20em")));var h_="DefaultPropertyGroup"+Et(16),ul=class{constructor(...t){this.rowGroups=new Map;this.element=Cu(...this.createElements(t))}append(...t){fe(this.element,...this.createElements(t))}createElements(t){return t.flatMap(e=>this.createGroups(e).flatMap(jt))}createGroups(t){let e=h_,n=new Array;return t instanceof dl?(e=t.name,n.push(...t.properties.map(i=>this.createRow(i)))):n.push(this.createRow(t)),this.rowGroups.has(e)||this.rowGroups.set(e,[]),this.rowGroups.get(e).push(...n),n}createRow(t){if(ke(t)){let[e,...n]=t,i=ku(e);for(let o of n)if(o instanceof HTMLInputElement||o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement){o.id.length===0&&(o.id=Et(10)),i.htmlFor=o.id;break}return[Iu(i),Pu(...n)]}else return Q(t)||ce(t)||Je(t)||Tl(t)?[xe(Lu(t))]:[t]}setGroupVisible(t,e){let n=this.rowGroups.get(t);if(n)for(let i of n)for(let o of i)if($l(o))for(let s of o.elements)Ie(s,e);else(to(o)||o instanceof HTMLElement)&&Ie(o,e)}};var ed="micFields"+Et(8),ml=class extends ai{constructor(e){super("Configure devices");this.env=e;this.micLookup=null;this.spkrLookup=null;this.spkrVolumeControl=null;this.ready=null;this.speakers=null;this.timer=new rs(30);this.tele=null;this.cancelButton.style.display="none";let n=this.env.audio.loadBasicClip("test-audio","/audio/test-clip.mp3",.5);fe(this.container,st(vu("max-content"))),fe(this.contentArea,this.properties=new ul(_f(ed,"Input",["Microphones",this.microphones=ep(fi(async()=>{let i=this.env.apps.get("tele"),o=this.microphones.value,s=this.micLookup.get(o);await i.conference.microphones.setAudioInputDevice(s)}))],["Input level",this.micScenario=Ou()],["Volume",this.micVolumeControl=Zc(Gl(0),Ul(100),Ql(1),Gr(0),fi(()=>{e.audio.input.gain.setValueAtTime(this.micVolumeControl.valueAsNumber/100,0)}))],"Output"))),Ot&&(this.properties.append(["Speakers",this.speakers=ep(fi(async()=>{let i=this.speakers.value,o=this.spkrLookup.get(i);await this.env.audio.speakers.setAudioOutputDevice(o)}))]),this.env.audio.speakers.addEventListener("audiooutputchanged",i=>{this.speakers.value=i.device&&i.device.deviceId||""})),this.properties.append(["Using headphones",this.useHeadphones=Bu(fi(()=>{this.env.audio.useHeadphones=this.useHeadphones.checked,Ie(this.headphoneWarning,!this.env.audio.useHeadphones,"inline-block")})),this.testSpkrButton=fs("Test",Ur("Test audio"),st(xu("0.5em")),bh(async()=>{rr(this.testSpkrButton,!1,"secondary"),await n,await this.env.audio.playClipThrough("test-audio"),rr(this.testSpkrButton,!0,"secondary")}))],this.headphoneWarning=xe(we("alert alert-warning"),"\u{1F3A7}\u{1F399}\uFE0F This site has a voice chat feature. Voice chat is best experienced using headphones."),["Volume",this.spkrVolumeControl=Zc(Gl(0),Ul(100),Ql(1),Gr(0),fi(()=>e.audio.audioDestination.volume=this.spkrVolumeControl.valueAsNumber/100))]),this.activity=new cl("device-settings-dialog-activity",this.env.audio.audioCtx),this.timer.addTickHandler(()=>{this.micScenario.value=this.activity.level}),this.properties.setGroupVisible(ed,!1),this.waitForTele(),Object.seal(this)}async waitForTele(){this.tele=await this.env.apps.waitFor("tele"),this.properties.setGroupVisible(ed,!0),this.tele.conference.microphones.addEventListener("audioinputchanged",e=>{this.microphones.value=e.audio&&e.audio.deviceId||""}),Tt(this.env.audio.input,this.activity)}async load(){await this.env.audio.ready}async onShowing(){if(this.ready===null&&(this.ready=this.load()),await this.ready,this.tele){await this.tele.ready,await this.tele.conference.microphones.ready;let e=await this.tele.conference.microphones.getAudioInputDevices();this.micLookup=wl(e,i=>i.deviceId),no(this.microphones),fe(this.microphones,gs(Gr(""),"NONE"),...e.map(i=>gs(Gr(i.deviceId),i.label)));let n=await this.tele.conference.microphones.getAudioInputDevice();this.microphones.value=n&&n.deviceId||"",this.micVolumeControl.valueAsNumber=this.env.audio.input.gain.value*100}if(Ot){await this.env.audio.speakers.ready;let e=await this.env.audio.speakers.getAudioOutputDevices();this.spkrLookup=wl(e,i=>i.deviceId),no(this.speakers),fe(this.speakers,...e.map(i=>gs(Gr(i.deviceId),i.label)));let n=await this.env.audio.speakers.getAudioOutputDevice();n||(n=await this.env.audio.speakers.getPreferredAudioOutput(),await this.env.audio.speakers.setAudioOutputDevice(n)),this.speakers.value=n&&n.deviceId||""}this.spkrVolumeControl.valueAsNumber=this.env.audio.audioDestination.volume*100,this.useHeadphones.checked=this.env.audio.useHeadphones,Ie(this.headphoneWarning,!this.env.audio.useHeadphones,"inline-block"),this.timer.start(),await super.onShowing()}onClosed(){this.timer.stop(),super.onClosed()}};var td=class extends j{constructor(e){super("roomjoined");this.roomName=e}},hl=class extends pl{constructor(e,n,i,o,s,a,p){super(e,n,s,a,p&&p.DEBUG);this.screenUISpace=new sa;this.envAudioToggleEvt=new j("environmentaudiotoggled");this._currentRoom=null;this._testSpaceLayout=!1;this.countTick=0;this.fpses=new Array;this.avgFPS=0;this.compassImage=new Ys,this.clockImage=new dr(this,"Clock",new Js),this.clockImage.sizeMode="fixed-height",this.clockImage.mesh.renderOrder=5,p=p||{},this.apps=new fa(this),this.apps.addEventListener("apploading",d=>{d.preLoadTask=this.fadeOut().then(()=>{this.clearScene(),this.avatar.reset()})}),this.apps.addEventListener("apploaded",d=>{d.app.addEventListener("joinroom",h=>{h.roomName!==this._currentRoom&&(this._currentRoom=h.roomName,this.dispatchEvent(new td(h.roomName)))})}),this.apps.addEventListener("appshown",async d=>{this.lobbyButton.visible=d.appName!=="menu",await this.fadeIn()}),this.audio=new Qs(Bm),this.audio.setAudioProperties(1,4,"exponential"),this.audioPlayer=new Ks(this.audio.audioCtx),this.videoPlayer=new ma(this,this.audio.audioCtx),this.videoPlayer.object.visible=!1,this.interactionAudio=new oa(this.audio,this.pointers),this.confirmationDialog=new ia(this,i),this.devicesDialog=new ml(this),fe(this.renderer.domElement.parentElement,this.screenUISpace,this.confirmationDialog,this.devicesDialog,this.renderer.domElement),this.uiButtons=new ha(o,20,this.DEBUG),this.settingsButton=new ui(this.uiButtons,"ui","settings"),this.quitButton=new ui(this.uiButtons,"ui","quit"),this.lobbyButton=new ui(this.uiButtons,"ui","lobby"),this.muteMicButton=new mr(this.uiButtons,"microphone","mute","unmute"),this.muteEnvAudioButton=new mr(this.uiButtons,"environment-audio","mute","unmute"),this.muteEnvAudioButton.active=!0,this.audio.ready.then(()=>this.muteEnvAudioButton.active=!1),this.vrButton=new mi(this.uiButtons,"VR"),this.fullscreenButton=new mi(this.uiButtons,"Fullscreen"),this.arButton=new mi(this.uiButtons,"AR"),this.xrUI=new aa,this.xrUI.addItem(this.clockImage,{x:-1,y:1,height:.1}),this.xrUI.addItem(this.quitButton,{x:1,y:1,scale:.5}),this.xrUI.addItem(this.confirmationDialog,{x:0,y:0,scale:.25}),this.xrUI.addItem(this.settingsButton,{x:-1,y:-1,scale:.5}),this.xrUI.addItem(this.muteMicButton,{x:-.84,y:-1,scale:.5}),this.xrUI.addItem(this.muteEnvAudioButton,{x:-.68,y:-1,scale:.5}),this.xrUI.addItem(this.lobbyButton,{x:-.473,y:-1,scale:.5}),this.xrUI.addItem(this.vrButton,{x:1,y:-1,scale:.5}),this.xrUI.addItem(this.fullscreenButton,{x:1,y:-1,scale:.5}),this.xrUI.addItem(this.arButton,{x:1,y:-1,scale:.5}),U(this.worldUISpace,this.xrUI),fe(this.screenUISpace.topRowLeft,this.compassImage,this.clockImage),fe(this.screenUISpace.topRowRight,this.quitButton),fe(this.screenUISpace.bottomRowLeft,this.settingsButton,this.muteMicButton,this.muteEnvAudioButton,this.lobbyButton),fe(this.screenUISpace.bottomRowRight,this.fullscreenButton,this.vrButton,this.arButton),si.isAvailable&&Wi()&&(this.batteryImage=new dr(this,"Battery",new si),this.batteryImage.sizeMode="fixed-height",this.xrUI.addItem(this.batteryImage,{x:.75,y:-1,width:.2,height:.1}),fe(this.screenUISpace.topRowRight,this.batteryImage)),this.vrButton.visible=kr()&&Jo()||Ut(),this.arButton.visible=!1,this.lobbyButton.visible=!1,this.muteMicButton.visible=!1,this.screenControl.setUI(this.screenUISpace,this.fullscreenButton,this.vrButton,this.arButton),this.quitButton.addEventListener("click",()=>this.withConfirmation("Confirm quit","Are you sure you want to quit?",async()=>{this.renderer.xr.isPresenting&&this.screenControl.stop(),await this.onQuitting()})),this.lobbyButton.addEventListener("click",()=>this.withConfirmation("Confirm return to lobby","Are you sure you want to return to the lobby?",()=>this.dispatchEvent(new j("home")))),this.settingsButton.addEventListener("click",async()=>{let d=this.screenControl.currentMode,h=this.renderer.xr.isPresenting;h&&await this.screenControl.stop(),await this.devicesDialog.showDialog(),h&&await this.screenControl.start(d)}),this.muteEnvAudioButton.addEventListener("click",()=>{this.muteEnvAudioButton.active=!this.muteEnvAudioButton.active,this.dispatchEvent(this.envAudioToggleEvt)}),this.avatar.addEventListener("avatarmoved",d=>this.audio.setUserPose(this.audio.localUserID,d.px,d.py,d.pz,d.fx,d.fy,d.fz,d.ux,d.uy,d.uz))}get currentRoom(){return this._currentRoom}get testSpaceLayout(){return this._testSpaceLayout}set testSpaceLayout(e){e!==this.testSpaceLayout&&(this._testSpaceLayout=e)}preRender(e){if(super.preRender(e),this.audio.update(),this.videoPlayer.update(e.dt,e.frame),this.xrUI.visible=this.renderer.xr.isPresenting||this.testSpaceLayout,this.clockImage.isVisible=this.xrUI.visible||this.DEBUG,this.renderer.xr.isPresenting||this.compassImage.setPitchAndHeading(ts(this.avatar.worldPitch),ts(this.avatar.worldHeading)),this.DEBUG){let n=Math.round(e.fps);if(this.avgFPS+=n/100,this.fpses.push(n),this.fpses.length>100){let i=this.fpses.shift();this.avgFPS-=i/100}++this.countTick%100===0&&this.clockImage.image.setStats(this.avgFPS,this.renderer.info.render.calls,this.renderer.info.render.triangles)}this.confirmationDialog.update(e.dt);for(let n of this.apps)n.update(e)}get environmentAudioMuted(){return this.muteEnvAudioButton.active}async withConfirmation(e,n,i){this.onConfirmationShowing(!0),await this.confirmationDialog.prompt(e,n)&&i(),this.onConfirmationShowing(!1)}onConfirmationShowing(e){Up(this.quitButton,!e,"primary"),Up(this.lobbyButton,!e,"primary")}async load(e,...n){let i=null;e instanceof Kn?(n.push(e),i=this.loadingBar):i=e;let o=new vn("/audio/TransitionFootstepAudio.mp3",Nr,!this.DEBUG),s=new vn("/audio/basic_enter.mp3",Nr,!this.DEBUG),a=new vn("/audio/basic_exit.mp3",Nr,!this.DEBUG),p=new vn("/audio/basic_error.mp3",Nr,!this.DEBUG),d=new vn("/audio/vintage_radio_button_pressed.mp3",Nr,!this.DEBUG);n.push(...this.uiButtons.assets,o,s,a,p,d),await super.load(i,...n),this.audio.createBasicClip("footsteps",o.result,.5),this.interactionAudio.create("enter",s.result,.25),this.interactionAudio.create("exit",a.result,.25),this.interactionAudio.create("error",p.result,.25),this.interactionAudio.create("click",d.result,1)}};var bf=new URL(globalThis.location.href),Ir=bf.searchParams.has("DEBUG")&&!bf.searchParams.has("RELEASE"),Ef=Ir?".js":".min.js";var yf="1.2.0";var wf=yf,Tf=1.75,Mf=!1,Sf={fontFamily:"Segoe UI",fontSize:20},x_={fontFamily:"Segoe UI Emoji",fontSize:20};async function Rf(){await Promise.all([Om(x_)])}function Pf(){let r=new mt([["arrow","arrow-up"],["arrow","arrow-down"],["arrow","arrow-left"],["arrow","arrow-right"],["chat","user"],["chat","chat"],["ui","menu"],["ui","settings"],["ui","quit"],["ui","lobby"],["zoom","zoom-in"],["zoom","zoom-out"],["environment-audio","environment-audio-mute"],["environment-audio","environment-audio-unmute"],["headphones","headphones-unmuted"],["headphones","headphones-muted"],["microphone","microphone-mute"],["microphone","microphone-unmute"],["volume","volume-muted"],["volume","volume-low"],["volume","volume-medium"],["volume","volume-high"],["media","media-pause"],["media","media-play"],["media","media-stop"],["media","media-replay"],["ar","ar-enter"],["ar","ar-exit"],["vr","vr-enter"],["vr","vr-exit"],["fullscreen","fullscreen-enter"],["fullscreen","fullscreen-exit"]]),t=new $e;for(let[e,n]of r.entries())for(let i of n)t.add(e,i.replace(e+"-",""),`/img/ui/${i}.png`);return t}function Cf(r=!0){let t=new so(new Ts);return r&&(t=new Ms({scriptPath:`/js/fetcher-worker/index${Ef}?${wf}`},t)),new As(t,!Ir)}async function If(r=!0){let t=xs(Yn("frontBuffer"));document.body.append(xe(Yn("appContainer"),t)),await Rf();let e=Cf(!r),n=new hl(t,e,Sf.fontFamily,Pf(),Tf,Mf,{DEBUG:r});if(Ir){let i=Xd(200,"KiB");window.addEventListener("keypress",async o=>{if(o.key==="`"){n.drawSnapshot();let s=n.renderer.domElement,a=s.width/s.height,p=640,d=480;a>=1?p=d*a:d=p/a;let h=Kr(p,d);h.getContext("2d",{alpha:!1,desynchronized:!0}).drawImage(s,0,0,s.width,s.height,0,0,h.width,h.height);let A=null;for(let E=1;E>=.05&&(A=await Gu(h,os.value,E),!(A.size<=i));E-=.05);if(B(A))console.error("No image");else{A.size>i&&console.warn("Image was pretty big");let E=new FormData;E.append("File",A,"thumbnail.jpg"),await e.post(location.href).body(E).exec();let S=location.href.replace("/app/","/js/")+"-app/thumbnail.jpg";console.log(S),window.open(S)}}})}return n}(async function(){let r=await If(),t=new zr("/skyboxes/BearfenceMountain.jpeg",os,!Ir);await r.fadeOut(),await r.load(t),r.skybox.setImage(t.path,t.result),r.skybox.rotation=Fe(176);let e=new wt(.25,.25,.25,Ps({color:"yellow"})),n=new ks(!0,1.75);n.size=2,e.position.set(0,1.75,-2),U(r.foreground,U(e,n)),await r.fadeIn()})();
