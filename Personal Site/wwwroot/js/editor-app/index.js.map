{
  "version": 3,
  "sources": ["../../../../TypeScript Code/src/isDebug.ts", "../../../../Juniper/src/Juniper.TypeScript/@juniper-lib/tslib/typeChecks.ts", "../../../../TypeScript Code/src/editor-app/ScriptLoader.ts", "../../../../TypeScript Code/src/editor-app/index.ts"],
  "sourcesContent": ["const url = /*@__PURE__*/ new URL(globalThis.location.href);\r\nexport const isDebug = /*@__PURE__*/\r\n    DEBUG && !url.searchParams.has(\"RELEASE\")\r\n    || !DEBUG && url.searchParams.has(\"DEBUG\");\r\nexport const JS_EXT = isDebug ? \".js\" : \".min.js\";", "function t(o: any, s: string, c: Function) {\r\n    return typeof o === s\r\n        || o instanceof c;\r\n}\r\n\r\nexport function isFunction(obj: any): obj is Function {\r\n    return t(obj, \"function\", Function);\r\n}\r\n\r\nexport function isString(obj: any): obj is string {\r\n    return t(obj, \"string\", String);\r\n}\r\n\r\nexport function isBoolean(obj: any): obj is boolean {\r\n    return t(obj, \"boolean\", Boolean);\r\n}\r\n\r\nexport function isNumber(obj: any): obj is number {\r\n    return t(obj, \"number\", Number);\r\n}\r\n\r\n/**\r\n * Check a value to see if it is of a number type\r\n * and is not the special NaN value.\r\n */\r\nexport function isGoodNumber(obj: any): obj is number {\r\n    return isNumber(obj)\r\n        && Number.isFinite(obj)\r\n        && !Number.isNaN(obj);\r\n}\r\n\r\nexport function isObject(obj: any): obj is object {\r\n    return isDefined(obj)\r\n        && t(obj, \"object\", Object);\r\n}\r\n\r\nexport function isPromise<T>(obj: any): obj is Promise<T> {\r\n    return obj instanceof Promise;\r\n}\r\n\r\nexport function isDate(obj: any): obj is Date {\r\n    return obj instanceof Date;\r\n}\r\n\r\nexport function isArray(obj: any): obj is Array<any> {\r\n    return obj instanceof Array;\r\n}\r\n\r\nexport function assertNever(x: never, msg?: string): never {\r\n    throw new Error((msg || \"Unexpected object: \") + x);\r\n}\r\n\r\nexport function isNullOrUndefined<T>(obj: T | null | undefined): obj is null | undefined {\r\n    return obj === null\r\n        || obj === undefined;\r\n}\r\n\r\nexport function isDefined<T>(obj: T | null | undefined): obj is T {\r\n    return !isNullOrUndefined(obj);\r\n}\r\n\r\nexport function isEventListener(obj: EventListenerOrEventListenerObject): obj is EventListener {\r\n    return isFunction(obj);\r\n}\r\n\r\nexport function isEventListenerObject(obj: EventListenerOrEventListenerObject): obj is EventListenerObject {\r\n    return !isEventListener(obj);\r\n}\r\n\r\nexport function isArrayBufferView(obj: any): obj is ArrayBufferView {\r\n    return obj instanceof Uint8Array\r\n        || obj instanceof Uint8ClampedArray\r\n        || obj instanceof Int8Array\r\n        || obj instanceof Uint16Array\r\n        || obj instanceof Int16Array\r\n        || obj instanceof Uint32Array\r\n        || obj instanceof Int32Array\r\n        || obj instanceof Float32Array\r\n        || obj instanceof Float64Array\r\n        || \"BigUint64Array\" in globalThis && obj instanceof globalThis[\"BigUint64Array\"]\r\n        || \"BigInt64Array\" in globalThis && obj instanceof globalThis[\"BigInt64Array\"];\r\n}\r\n\r\nexport function isArrayBuffer(val: any): val is ArrayBuffer {\r\n    return val && typeof ArrayBuffer !== \"undefined\" &&\r\n        (val instanceof ArrayBuffer ||\r\n            // Sometimes we get an ArrayBuffer that doesn't satisfy instanceof\r\n            (val.constructor && val.constructor.name === \"ArrayBuffer\"));\r\n}", "\uFEFFimport { isArray, isString } from \"@juniper-lib/tslib/typeChecks\";\r\n\r\ntype progressCallback = (soFar: number, total: number, msg?: string) => void;\r\ntype testCallback = () => boolean;\r\ntype ImportExpr = string | [string, testCallback];\r\n\r\ninterface Script {\r\n    prog: progressCallback;\r\n    path: string;\r\n    test: testCallback;\r\n    soFar: number;\r\n    total: number;\r\n    result: any;\r\n}\r\n\r\nexport async function loadScripts(JS_EXT: string, onProgress: progressCallback, ...paths: ImportExpr[]): Promise<any[]>;\r\nexport async function loadScripts(JS_EXT: string, ...paths: ImportExpr[]): Promise<any[]>;\r\nexport async function loadScripts(JS_EXT: string, onProgressOrPath: progressCallback | ImportExpr, ...paths: ImportExpr[]): Promise<any[]> {\r\n    let onProgress: progressCallback = null;\r\n    if (isString(onProgressOrPath) || isArray(onProgressOrPath)) {\r\n        paths.unshift(onProgressOrPath);\r\n    }\r\n    else {\r\n        onProgress = onProgressOrPath;\r\n    }\r\n\r\n    function updateProg(msg?: string) {\r\n        if (onProgress) {\r\n            let soFar = 0;\r\n            let total = 0;\r\n            for (const script of scripts) {\r\n                soFar += script.soFar;\r\n                total += script.total;\r\n            }\r\n            onProgress(soFar, total, msg);\r\n        }\r\n    }\r\n\r\n    const scripts: Script[] = paths.map(expr => {\r\n        let test: testCallback = null;\r\n        let path: string = null;\r\n        if (isString(expr)) {\r\n            path = expr;\r\n        }\r\n        else {\r\n            path = expr[0];\r\n            test = expr[1];\r\n        }\r\n        const isModule = !path.startsWith(\"$\");\r\n        path = isModule ? path : path.substr(1);\r\n        path = `/js/${path}/index${JS_EXT}`;\r\n        return {\r\n            prog: function (soFar, total) {\r\n                this.soFar = soFar;\r\n                this.total = total;\r\n                updateProg(this.path);\r\n            },\r\n            path,\r\n            test,\r\n            soFar: 0,\r\n            total: 0,\r\n            result: null\r\n        };\r\n    });\r\n\r\n    if (JS_EXT === \".min.js\") {\r\n        await Promise.all(scripts.map(loadScript));\r\n    }\r\n\r\n    for (const script of scripts) {\r\n        await applyScript(script);\r\n    }\r\n\r\n    return scripts.map(script => script.result).filter(v => !!v);\r\n}\r\n\r\nasync function loadScript(script: Script): Promise<void> {\r\n    script.path = await preloadFile(script.path, script.prog);\r\n}\r\n\r\nfunction preloadFile(path: string, prog?: progressCallback): Promise<string> {\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.responseType = \"blob\";\r\n    xhr.open(\"GET\", path);\r\n    if (prog) {\r\n        xhr.onloadstart = () => prog(0, 0);\r\n        xhr.onprogress = (evt) => prog(evt.loaded || 1, evt.total || 1);\r\n    }\r\n    return new Promise<string>((resolve, reject) => {\r\n        xhr.onloadend = () => resolve(URL.createObjectURL(xhr.response));\r\n        xhr.onerror = () => reject(`(${xhr.status}) ${path}`);\r\n        xhr.send();\r\n    });\r\n}\r\n\r\nasync function applyScript(script: Script): Promise<void> {\r\n    if (script.test) {\r\n        const elem = document.createElement(\"script\");\r\n        elem.src = script.path;\r\n        document.head.append(elem);\r\n        await new Promise<void>((resolve, reject) => {\r\n            let tries = 0;\r\n            const handle = setInterval(() => {\r\n                ++tries;\r\n                if (script.result = script.test()) {\r\n                    clearInterval(handle);\r\n                    resolve();\r\n                }\r\n                else if (tries > 3) {\r\n                    clearInterval(handle);\r\n                    reject(\"TIMEOUT\");\r\n                }\r\n            }, 100);\r\n        });\r\n    }\r\n    else {\r\n        script.result = (await import(script.path)).default;\r\n    }\r\n}", "\uFEFFimport { JS_EXT } from \"../isDebug\";\r\nimport { loadScripts } from \"./ScriptLoader\";\r\n\r\nfunction onProgress(soFar: number, total: number, msg?: string) {\r\n    console.log(msg, (100 * soFar / (total || 1)).toFixed(1) + \"%\");\r\n}\r\n\r\n(async function () {\r\n    const [_, loadEditor] = await loadScripts(\r\n        JS_EXT,\r\n        onProgress,\r\n        [\"three\", () => (globalThis as any).THREE],\r\n        \"editor\"\r\n    );\r\n\r\n    await loadEditor();\r\n})();"],
  "mappings": "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",
  "names": ["JS_EXT", "onProgress"]
}
