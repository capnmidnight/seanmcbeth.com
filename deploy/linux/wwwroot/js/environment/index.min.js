var Sx=Object.create;var _l=Object.defineProperty;var Mx=Object.getOwnPropertyDescriptor;var Tx=Object.getOwnPropertyNames;var Cx=Object.getPrototypeOf,Px=Object.prototype.hasOwnProperty;var Rx=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),Vx=(n,t)=>{for(var e in t)_l(n,e,{get:t[e],enumerable:!0})},Ix=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Tx(t))!Px.call(n,i)&&i!==e&&_l(n,i,{get:()=>t[i],enumerable:!(r=Mx(t,i))||r.enumerable});return n};var Lx=(n,t,e)=>(e=n!=null?Sx(Cx(n)):{},Ix(t||!n||!n.__esModule?_l(e,"default",{value:n,enumerable:!0}):e,n));var Vf=Rx((Pc,Rc)=>{(function(n,t){typeof Pc=="object"&&typeof Rc<"u"?Rc.exports=t():typeof define=="function"&&define.amd?define(t):n.CardboardVRDisplay=t()})(Pc,function(){"use strict";var n=function(){function a(d){this.value=d}function l(d){var m,f;function v(S,A){return new Promise(function(y,C){var L={key:S,arg:A,resolve:y,reject:C,next:null};f?f=f.next=L:(m=f=L,g(S,A))})}function g(S,A){try{var y=d[S](A),C=y.value;C instanceof a?Promise.resolve(C.value).then(function(L){g("next",L)},function(L){g("throw",L)}):M(y.done?"return":"normal",y.value)}catch(L){M("throw",L)}}function M(S,A){switch(S){case"return":m.resolve({value:A,done:!0});break;case"throw":m.reject(A);break;default:m.resolve({value:A,done:!1});break}m=m.next,m?g(m.key,m.arg):f=null}this._invoke=v,typeof d.return!="function"&&(this.return=void 0)}return typeof Symbol=="function"&&Symbol.asyncIterator&&(l.prototype[Symbol.asyncIterator]=function(){return this}),l.prototype.next=function(d){return this._invoke("next",d)},l.prototype.throw=function(d){return this._invoke("throw",d)},l.prototype.return=function(d){return this._invoke("return",d)},{wrap:function(d){return function(){return new l(d.apply(this,arguments))}},await:function(d){return new a(d)}}}(),t=function(a,l){if(!(a instanceof l))throw new TypeError("Cannot call a class as a function")},e=function(){function a(l,d){for(var m=0;m<d.length;m++){var f=d[m];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(l,f.key,f)}}return function(l,d,m){return d&&a(l.prototype,d),m&&a(l,m),l}}(),r=function(){function a(l,d){var m=[],f=!0,v=!1,g=void 0;try{for(var M=l[Symbol.iterator](),S;!(f=(S=M.next()).done)&&(m.push(S.value),!(d&&m.length===d));f=!0);}catch(A){v=!0,g=A}finally{try{!f&&M.return&&M.return()}finally{if(v)throw g}}return m}return function(l,d){if(Array.isArray(l))return l;if(Symbol.iterator in Object(l))return a(l,d);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=.001,o=1,s=function(l,d){return"data:"+l+","+encodeURIComponent(d)},p=function(l,d,m){return l+(d-l)*m},c=function(){var a=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return a}}(),u=function(){var a=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return a}}(),h=function(){var a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return a}}(),x=function(){var a=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return a}}(),b=function(){var a=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),l=a?parseInt(a[1],10):null;return function(){return l}}(),E=function(){var a=!1;return a=c()&&h()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return a}}(),R=function(){var a=!1;if(b()===65){var l=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(l){var d=l[1].split("."),m=r(d,4),f=m[0],v=m[1],g=m[2],M=m[3];a=parseInt(g,10)===3325&&parseInt(M,10)<148}}return function(){return a}}(),P=function(){var a=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return a}}(),T=function(){var l=window.orientation==90||window.orientation==-90;return P()?!l:l},D=function(l){return!(isNaN(l)||l<=i||l>o)},O=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},I=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},X=function(l){if(u())return!1;if(l.requestFullscreen)l.requestFullscreen();else if(l.webkitRequestFullscreen)l.webkitRequestFullscreen();else if(l.mozRequestFullScreen)l.mozRequestFullScreen();else if(l.msRequestFullscreen)l.msRequestFullscreen();else return!1;return!0},z=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},V=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},F=function(l,d,m,f){var v=l.createShader(l.VERTEX_SHADER);l.shaderSource(v,d),l.compileShader(v);var g=l.createShader(l.FRAGMENT_SHADER);l.shaderSource(g,m),l.compileShader(g);var M=l.createProgram();l.attachShader(M,v),l.attachShader(M,g);for(var S in f)l.bindAttribLocation(M,f[S],S);return l.linkProgram(M),l.deleteShader(v),l.deleteShader(g),M},ie=function(l,d){for(var m={},f=l.getProgramParameter(d,l.ACTIVE_UNIFORMS),v="",g=0;g<f;g++){var M=l.getActiveUniform(d,g);v=M.name.replace("[0]",""),m[v]=l.getUniformLocation(d,v)}return m},oe=function(l,d,m,f,v,g,M){var S=1/(d-m),A=1/(f-v),y=1/(g-M);return l[0]=-2*S,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*A,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*y,l[11]=0,l[12]=(d+m)*S,l[13]=(v+f)*A,l[14]=(M+g)*y,l[15]=1,l},W=function(){var l=!1;return function(d){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(d)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(d.substr(0,4)))&&(l=!0)}(navigator.userAgent||navigator.vendor||window.opera),l},re=function(l,d){for(var m in d)d.hasOwnProperty(m)&&(l[m]=d[m]);return l},Ee=function(l){if(c()){var d=l.style.width,m=l.style.height;l.style.width=parseInt(d)+1+"px",l.style.height=parseInt(m)+"px",setTimeout(function(){l.style.width=d,l.style.height=m},100)}window.canvas=l},ve=function(){var a=Math.PI/180,l=Math.PI*.25;function d(A,y,C,L){var N=Math.tan(y?y.upDegrees*a:l),H=Math.tan(y?y.downDegrees*a:l),Y=Math.tan(y?y.leftDegrees*a:l),U=Math.tan(y?y.rightDegrees*a:l),G=2/(Y+U),pe=2/(N+H);return A[0]=G,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=pe,A[6]=0,A[7]=0,A[8]=-((Y-U)*G*.5),A[9]=(N-H)*pe*.5,A[10]=L/(C-L),A[11]=-1,A[12]=0,A[13]=0,A[14]=L*C/(C-L),A[15]=0,A}function m(A,y,C){var L=y[0],N=y[1],H=y[2],Y=y[3],U=L+L,G=N+N,pe=H+H,Se=L*U,Ie=L*G,Ae=L*pe,ze=N*G,rt=N*pe,it=H*pe,ot=Y*U,st=Y*G,un=Y*pe;return A[0]=1-(ze+it),A[1]=Ie+un,A[2]=Ae-st,A[3]=0,A[4]=Ie-un,A[5]=1-(Se+it),A[6]=rt+ot,A[7]=0,A[8]=Ae+st,A[9]=rt-ot,A[10]=1-(Se+ze),A[11]=0,A[12]=C[0],A[13]=C[1],A[14]=C[2],A[15]=1,A}function f(A,y,C){var L=C[0],N=C[1],H=C[2],Y,U,G,pe,Se,Ie,Ae,ze,rt,it,ot,st;return y===A?(A[12]=y[0]*L+y[4]*N+y[8]*H+y[12],A[13]=y[1]*L+y[5]*N+y[9]*H+y[13],A[14]=y[2]*L+y[6]*N+y[10]*H+y[14],A[15]=y[3]*L+y[7]*N+y[11]*H+y[15]):(Y=y[0],U=y[1],G=y[2],pe=y[3],Se=y[4],Ie=y[5],Ae=y[6],ze=y[7],rt=y[8],it=y[9],ot=y[10],st=y[11],A[0]=Y,A[1]=U,A[2]=G,A[3]=pe,A[4]=Se,A[5]=Ie,A[6]=Ae,A[7]=ze,A[8]=rt,A[9]=it,A[10]=ot,A[11]=st,A[12]=Y*L+Se*N+rt*H+y[12],A[13]=U*L+Ie*N+it*H+y[13],A[14]=G*L+Ae*N+ot*H+y[14],A[15]=pe*L+ze*N+st*H+y[15]),A}function v(A,y){var C=y[0],L=y[1],N=y[2],H=y[3],Y=y[4],U=y[5],G=y[6],pe=y[7],Se=y[8],Ie=y[9],Ae=y[10],ze=y[11],rt=y[12],it=y[13],ot=y[14],st=y[15],un=C*U-L*Y,Ci=C*G-N*Y,Pi=C*pe-H*Y,Ri=L*G-N*U,Vi=L*pe-H*U,Ii=N*pe-H*G,Li=Se*it-Ie*rt,Di=Se*ot-Ae*rt,Oi=Se*st-ze*rt,ki=Ie*ot-Ae*it,Bi=Ie*st-ze*it,Fi=Ae*st-ze*ot,Pe=un*Fi-Ci*Bi+Pi*ki+Ri*Oi-Vi*Di+Ii*Li;return Pe?(Pe=1/Pe,A[0]=(U*Fi-G*Bi+pe*ki)*Pe,A[1]=(N*Bi-L*Fi-H*ki)*Pe,A[2]=(it*Ii-ot*Vi+st*Ri)*Pe,A[3]=(Ae*Vi-Ie*Ii-ze*Ri)*Pe,A[4]=(G*Oi-Y*Fi-pe*Di)*Pe,A[5]=(C*Fi-N*Oi+H*Di)*Pe,A[6]=(ot*Pi-rt*Ii-st*Ci)*Pe,A[7]=(Se*Ii-Ae*Pi+ze*Ci)*Pe,A[8]=(Y*Bi-U*Oi+pe*Li)*Pe,A[9]=(L*Oi-C*Bi-H*Li)*Pe,A[10]=(rt*Vi-it*Pi+st*un)*Pe,A[11]=(Ie*Pi-Se*Vi-ze*un)*Pe,A[12]=(U*Di-Y*ki-G*Li)*Pe,A[13]=(C*ki-L*Di+N*Li)*Pe,A[14]=(it*Ci-rt*Ri-ot*un)*Pe,A[15]=(Se*Ri-Ie*Ci+Ae*un)*Pe,A):null}var g=new Float32Array([0,0,0,1]),M=new Float32Array([0,0,0]);function S(A,y,C,L,N,H){d(A,L||null,H.depthNear,H.depthFar);var Y=C.orientation||g,U=C.position||M;m(y,Y,U),N&&f(y,y,N),v(y,y)}return function(A,y,C){return!A||!y?!1:(A.pose=y,A.timestamp=y.timestamp,S(A.leftProjectionMatrix,A.leftViewMatrix,y,C._getFieldOfView("left"),C._getEyeOffset("left"),C),S(A.rightProjectionMatrix,A.rightViewMatrix,y,C._getFieldOfView("right"),C._getEyeOffset("right"),C),!0)}}(),se=function(){var l=window.self!==window.top,d=nt(document.referrer),m=nt(window.location.href);return l&&d!==m},nt=function(l){var d,m=l.indexOf("://");m!==-1?d=m+3:d=0;var f=l.indexOf("/",d);return f===-1&&(f=l.length),l.substring(0,f)},Vr=function(l){if(l.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var d=2*Math.acos(l.w);return d},dn=function(){var a={};return function(l,d){a[l]===void 0&&(console.warn("webvr-polyfill: "+d),a[l]=!0)}}(),Gt=function(l,d){var m=d?"Please use "+d+" instead.":"";dn(l,l+" has been deprecated. This may not work on native WebVR displays. "+m)};function Qf(a,l,d){if(!l){d(a);return}for(var m=[],f=null,v=0;v<l.length;++v){var g=l[v];switch(g){case a.TEXTURE_BINDING_2D:case a.TEXTURE_BINDING_CUBE_MAP:var M=l[++v];if(M<a.TEXTURE0||M>a.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),m.push(null,null);break}f||(f=a.getParameter(a.ACTIVE_TEXTURE)),a.activeTexture(M),m.push(a.getParameter(g),null);break;case a.ACTIVE_TEXTURE:f=a.getParameter(a.ACTIVE_TEXTURE),m.push(null);break;default:m.push(a.getParameter(g));break}}d(a);for(var v=0;v<l.length;++v){var g=l[v],S=m[v];switch(g){case a.ACTIVE_TEXTURE:break;case a.ARRAY_BUFFER_BINDING:a.bindBuffer(a.ARRAY_BUFFER,S);break;case a.COLOR_CLEAR_VALUE:a.clearColor(S[0],S[1],S[2],S[3]);break;case a.COLOR_WRITEMASK:a.colorMask(S[0],S[1],S[2],S[3]);break;case a.CURRENT_PROGRAM:a.useProgram(S);break;case a.ELEMENT_ARRAY_BUFFER_BINDING:a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,S);break;case a.FRAMEBUFFER_BINDING:a.bindFramebuffer(a.FRAMEBUFFER,S);break;case a.RENDERBUFFER_BINDING:a.bindRenderbuffer(a.RENDERBUFFER,S);break;case a.TEXTURE_BINDING_2D:var M=l[++v];if(M<a.TEXTURE0||M>a.TEXTURE31)break;a.activeTexture(M),a.bindTexture(a.TEXTURE_2D,S);break;case a.TEXTURE_BINDING_CUBE_MAP:var M=l[++v];if(M<a.TEXTURE0||M>a.TEXTURE31)break;a.activeTexture(M),a.bindTexture(a.TEXTURE_CUBE_MAP,S);break;case a.VIEWPORT:a.viewport(S[0],S[1],S[2],S[3]);break;case a.BLEND:case a.CULL_FACE:case a.DEPTH_TEST:case a.SCISSOR_TEST:case a.STENCIL_TEST:S?a.enable(g):a.disable(g);break;default:console.log("No GL restore behavior for 0x"+g.toString(16));break}f&&a.activeTexture(f)}}var Si=Qf,qf=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),Kf=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function vt(a,l,d,m){this.gl=a,this.cardboardUI=l,this.bufferScale=d,this.dirtySubmitFrameBindings=m,this.ctxAttribs=a.getContextAttributes(),this.instanceExt=a.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=a.drawingBufferWidth,this.bufferHeight=a.drawingBufferHeight,this.realBindFramebuffer=a.bindFramebuffer,this.realEnable=a.enable,this.realDisable=a.disable,this.realColorMask=a.colorMask,this.realClearColor=a.clearColor,this.realViewport=a.viewport,c()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(a.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(a.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=F(a,qf,Kf,this.attribs),this.uniforms=ie(a,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.indexCount=0,this.renderTarget=a.createTexture(),this.framebuffer=a.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=a.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=a.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=a.createRenderbuffer()),this.patch(),this.onResize()}vt.prototype.destroy=function(){var a=this.gl;this.unpatch(),a.deleteProgram(this.program),a.deleteBuffer(this.vertexBuffer),a.deleteBuffer(this.indexBuffer),a.deleteTexture(this.renderTarget),a.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&a.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&a.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&a.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},vt.prototype.onResize=function(){var a=this.gl,l=this,d=[a.RENDERBUFFER_BINDING,a.TEXTURE_BINDING_2D,a.TEXTURE0];Si(a,d,function(m){l.realBindFramebuffer.call(m,m.FRAMEBUFFER,null),l.scissorTest&&l.realDisable.call(m,m.SCISSOR_TEST),l.realColorMask.call(m,!0,!0,!0,!0),l.realViewport.call(m,0,0,m.drawingBufferWidth,m.drawingBufferHeight),l.realClearColor.call(m,0,0,0,1),m.clear(m.COLOR_BUFFER_BIT),l.realBindFramebuffer.call(m,m.FRAMEBUFFER,l.framebuffer),m.bindTexture(m.TEXTURE_2D,l.renderTarget),m.texImage2D(m.TEXTURE_2D,0,l.ctxAttribs.alpha?m.RGBA:m.RGB,l.bufferWidth,l.bufferHeight,0,l.ctxAttribs.alpha?m.RGBA:m.RGB,m.UNSIGNED_BYTE,null),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,l.renderTarget,0),l.ctxAttribs.depth&&l.ctxAttribs.stencil?(m.bindRenderbuffer(m.RENDERBUFFER,l.depthStencilBuffer),m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_STENCIL,l.bufferWidth,l.bufferHeight),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,l.depthStencilBuffer)):l.ctxAttribs.depth?(m.bindRenderbuffer(m.RENDERBUFFER,l.depthBuffer),m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_COMPONENT16,l.bufferWidth,l.bufferHeight),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,l.depthBuffer)):l.ctxAttribs.stencil&&(m.bindRenderbuffer(m.RENDERBUFFER,l.stencilBuffer),m.renderbufferStorage(m.RENDERBUFFER,m.STENCIL_INDEX8,l.bufferWidth,l.bufferHeight),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.STENCIL_ATTACHMENT,m.RENDERBUFFER,l.stencilBuffer)),!m.checkFramebufferStatus(m.FRAMEBUFFER)===m.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),l.realBindFramebuffer.call(m,m.FRAMEBUFFER,l.lastBoundFramebuffer),l.scissorTest&&l.realEnable.call(m,m.SCISSOR_TEST),l.realColorMask.apply(m,l.colorMask),l.realViewport.apply(m,l.viewport),l.realClearColor.apply(m,l.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},vt.prototype.patch=function(){if(!this.isPatched){var a=this,l=this.gl.canvas,d=this.gl;c()||(l.width=O()*this.bufferScale,l.height=I()*this.bufferScale,Object.defineProperty(l,"width",{configurable:!0,enumerable:!0,get:function(){return a.bufferWidth},set:function(f){a.bufferWidth=f,a.realCanvasWidth.set.call(l,f),a.onResize()}}),Object.defineProperty(l,"height",{configurable:!0,enumerable:!0,get:function(){return a.bufferHeight},set:function(f){a.bufferHeight=f,a.realCanvasHeight.set.call(l,f),a.onResize()}})),this.lastBoundFramebuffer=d.getParameter(d.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(d.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(m,f){a.lastBoundFramebuffer=f||a.framebuffer,a.realBindFramebuffer.call(d,m,a.lastBoundFramebuffer)},this.cullFace=d.getParameter(d.CULL_FACE),this.depthTest=d.getParameter(d.DEPTH_TEST),this.blend=d.getParameter(d.BLEND),this.scissorTest=d.getParameter(d.SCISSOR_TEST),this.stencilTest=d.getParameter(d.STENCIL_TEST),d.enable=function(m){switch(m){case d.CULL_FACE:a.cullFace=!0;break;case d.DEPTH_TEST:a.depthTest=!0;break;case d.BLEND:a.blend=!0;break;case d.SCISSOR_TEST:a.scissorTest=!0;break;case d.STENCIL_TEST:a.stencilTest=!0;break}a.realEnable.call(d,m)},d.disable=function(m){switch(m){case d.CULL_FACE:a.cullFace=!1;break;case d.DEPTH_TEST:a.depthTest=!1;break;case d.BLEND:a.blend=!1;break;case d.SCISSOR_TEST:a.scissorTest=!1;break;case d.STENCIL_TEST:a.stencilTest=!1;break}a.realDisable.call(d,m)},this.colorMask=d.getParameter(d.COLOR_WRITEMASK),d.colorMask=function(m,f,v,g){a.colorMask[0]=m,a.colorMask[1]=f,a.colorMask[2]=v,a.colorMask[3]=g,a.realColorMask.call(d,m,f,v,g)},this.clearColor=d.getParameter(d.COLOR_CLEAR_VALUE),d.clearColor=function(m,f,v,g){a.clearColor[0]=m,a.clearColor[1]=f,a.clearColor[2]=v,a.clearColor[3]=g,a.realClearColor.call(d,m,f,v,g)},this.viewport=d.getParameter(d.VIEWPORT),d.viewport=function(m,f,v,g){a.viewport[0]=m,a.viewport[1]=f,a.viewport[2]=v,a.viewport[3]=g,a.realViewport.call(d,m,f,v,g)},this.isPatched=!0,Ee(l)}},vt.prototype.unpatch=function(){if(!!this.isPatched){var a=this.gl,l=this.gl.canvas;c()||(Object.defineProperty(l,"width",this.realCanvasWidth),Object.defineProperty(l,"height",this.realCanvasHeight)),l.width=this.bufferWidth,l.height=this.bufferHeight,a.bindFramebuffer=this.realBindFramebuffer,a.enable=this.realEnable,a.disable=this.realDisable,a.colorMask=this.realColorMask,a.clearColor=this.realClearColor,a.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&a.bindFramebuffer(a.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){Ee(l)},1)}},vt.prototype.setTextureBounds=function(a,l){a||(a=[0,0,.5,1]),l||(l=[.5,0,.5,1]),this.viewportOffsetScale[0]=a[0],this.viewportOffsetScale[1]=a[1],this.viewportOffsetScale[2]=a[2],this.viewportOffsetScale[3]=a[3],this.viewportOffsetScale[4]=l[0],this.viewportOffsetScale[5]=l[1],this.viewportOffsetScale[6]=l[2],this.viewportOffsetScale[7]=l[3]},vt.prototype.submitFrame=function(){var a=this.gl,l=this,d=[];if(this.dirtySubmitFrameBindings||d.push(a.CURRENT_PROGRAM,a.ARRAY_BUFFER_BINDING,a.ELEMENT_ARRAY_BUFFER_BINDING,a.TEXTURE_BINDING_2D,a.TEXTURE0),Si(a,d,function(f){l.realBindFramebuffer.call(f,f.FRAMEBUFFER,null);var v=0,g=0;l.instanceExt&&(v=f.getVertexAttrib(l.attribs.position,l.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),g=f.getVertexAttrib(l.attribs.texCoord,l.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),l.cullFace&&l.realDisable.call(f,f.CULL_FACE),l.depthTest&&l.realDisable.call(f,f.DEPTH_TEST),l.blend&&l.realDisable.call(f,f.BLEND),l.scissorTest&&l.realDisable.call(f,f.SCISSOR_TEST),l.stencilTest&&l.realDisable.call(f,f.STENCIL_TEST),l.realColorMask.call(f,!0,!0,!0,!0),l.realViewport.call(f,0,0,f.drawingBufferWidth,f.drawingBufferHeight),(l.ctxAttribs.alpha||c())&&(l.realClearColor.call(f,0,0,0,1),f.clear(f.COLOR_BUFFER_BIT)),f.useProgram(l.program),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l.indexBuffer),f.bindBuffer(f.ARRAY_BUFFER,l.vertexBuffer),f.enableVertexAttribArray(l.attribs.position),f.enableVertexAttribArray(l.attribs.texCoord),f.vertexAttribPointer(l.attribs.position,2,f.FLOAT,!1,20,0),f.vertexAttribPointer(l.attribs.texCoord,3,f.FLOAT,!1,20,8),l.instanceExt&&(v!=0&&l.instanceExt.vertexAttribDivisorANGLE(l.attribs.position,0),g!=0&&l.instanceExt.vertexAttribDivisorANGLE(l.attribs.texCoord,0)),f.activeTexture(f.TEXTURE0),f.uniform1i(l.uniforms.diffuse,0),f.bindTexture(f.TEXTURE_2D,l.renderTarget),f.uniform4fv(l.uniforms.viewportOffsetScale,l.viewportOffsetScale),f.drawElements(f.TRIANGLES,l.indexCount,f.UNSIGNED_SHORT,0),l.cardboardUI&&l.cardboardUI.renderNoState(),l.realBindFramebuffer.call(l.gl,f.FRAMEBUFFER,l.framebuffer),l.ctxAttribs.preserveDrawingBuffer||(l.realClearColor.call(f,0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),l.dirtySubmitFrameBindings||l.realBindFramebuffer.call(f,f.FRAMEBUFFER,l.lastBoundFramebuffer),l.cullFace&&l.realEnable.call(f,f.CULL_FACE),l.depthTest&&l.realEnable.call(f,f.DEPTH_TEST),l.blend&&l.realEnable.call(f,f.BLEND),l.scissorTest&&l.realEnable.call(f,f.SCISSOR_TEST),l.stencilTest&&l.realEnable.call(f,f.STENCIL_TEST),l.realColorMask.apply(f,l.colorMask),l.realViewport.apply(f,l.viewport),(l.ctxAttribs.alpha||!l.ctxAttribs.preserveDrawingBuffer)&&l.realClearColor.apply(f,l.clearColor),l.instanceExt&&(v!=0&&l.instanceExt.vertexAttribDivisorANGLE(l.attribs.position,v),g!=0&&l.instanceExt.vertexAttribDivisorANGLE(l.attribs.texCoord,g))}),c()){var m=a.canvas;(m.width!=l.bufferWidth||m.height!=l.bufferHeight)&&(l.bufferWidth=m.width,l.bufferHeight=m.height,l.onResize())}},vt.prototype.updateDeviceInfo=function(a){var l=this.gl,d=this,m=[l.ARRAY_BUFFER_BINDING,l.ELEMENT_ARRAY_BUFFER_BINDING];Si(l,m,function(f){var v=d.computeMeshVertices_(d.meshWidth,d.meshHeight,a);if(f.bindBuffer(f.ARRAY_BUFFER,d.vertexBuffer),f.bufferData(f.ARRAY_BUFFER,v,f.STATIC_DRAW),!d.indexCount){var g=d.computeMeshIndices_(d.meshWidth,d.meshHeight);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,d.indexBuffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,g,f.STATIC_DRAW),d.indexCount=g.length}})},vt.prototype.computeMeshVertices_=function(a,l,d){for(var m=new Float32Array(2*a*l*5),f=d.getLeftEyeVisibleTanAngles(),v=d.getLeftEyeNoLensTanAngles(),g=d.getLeftEyeVisibleScreenRect(v),M=0,S=0;S<2;S++){for(var A=0;A<l;A++)for(var y=0;y<a;y++,M++){var C=y/(a-1),L=A/(l-1),N=C,H=L,Y=p(f[0],f[2],C),U=p(f[3],f[1],L),G=Math.sqrt(Y*Y+U*U),pe=d.distortion.distortInverse(G),Se=Y*pe/G,Ie=U*pe/G;C=(Se-v[0])/(v[2]-v[0]),L=(Ie-v[3])/(v[1]-v[3]),C=(g.x+C*g.width-.5)*2,L=(g.y+L*g.height-.5)*2,m[M*5+0]=C,m[M*5+1]=L,m[M*5+2]=N,m[M*5+3]=H,m[M*5+4]=S}var Ae=f[2]-f[0];f[0]=-(Ae+f[0]),f[2]=Ae-f[2],Ae=v[2]-v[0],v[0]=-(Ae+v[0]),v[2]=Ae-v[2],g.x=1-(g.x+g.width)}return m},vt.prototype.computeMeshIndices_=function(a,l){for(var d=new Uint16Array(2*(a-1)*(l-1)*6),m=a/2,f=l/2,v=0,g=0,M=0;M<2;M++)for(var S=0;S<l;S++)for(var A=0;A<a;A++,v++)A==0||S==0||(A<=m==S<=f?(d[g++]=v,d[g++]=v-a-1,d[g++]=v-a,d[g++]=v-a-1,d[g++]=v,d[g++]=v-1):(d[g++]=v-1,d[g++]=v-a,d[g++]=v,d[g++]=v-a,d[g++]=v-1,d[g++]=v-a-1));return d},vt.prototype.getOwnPropertyDescriptor_=function(a,l){var d=Object.getOwnPropertyDescriptor(a,l);return(d.get===void 0||d.set===void 0)&&(d.configurable=!0,d.enumerable=!0,d.get=function(){return this.getAttribute(l)},d.set=function(m){this.setAttribute(l,m)}),d};var Yf=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),Jf=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),Xc=Math.PI/180,ml=60,zc=12,Hc=20,hl=1,Gc=.75,Uc=.3125,$f=4,Hn=28,fl=1.5;function Gn(a){this.gl=a,this.attribs={position:0},this.program=F(a,Yf,Jf,this.attribs),this.uniforms=ie(a,this.program),this.vertexBuffer=a.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}Gn.prototype.destroy=function(){var a=this.gl;this.listener&&a.canvas.removeEventListener("click",this.listener,!1),a.deleteProgram(this.program),a.deleteBuffer(this.vertexBuffer)},Gn.prototype.listen=function(a,l){var d=this.gl.canvas;this.listener=function(m){var f=d.clientWidth/2,v=Hn*fl;m.clientX>f-v&&m.clientX<f+v&&m.clientY>d.clientHeight-v?a(m):m.clientX<v&&m.clientY<v&&l(m)},d.addEventListener("click",this.listener,!1)},Gn.prototype.onResize=function(){var a=this.gl,l=this,d=[a.ARRAY_BUFFER_BINDING];Si(a,d,function(m){var f=[],v=m.drawingBufferWidth/2,g=Math.max(screen.width,screen.height)*window.devicePixelRatio,M=m.drawingBufferWidth/g,S=M*window.devicePixelRatio,A=$f*S/2,y=Hn*fl*S,C=Hn*S/2,L=(Hn*fl-Hn)*S;f.push(v-A,y),f.push(v-A,m.drawingBufferHeight),f.push(v+A,y),f.push(v+A,m.drawingBufferHeight),l.gearOffset=f.length/2;function N(pe,Se){var Ie=(90-pe)*Xc,Ae=Math.cos(Ie),ze=Math.sin(Ie);f.push(Uc*Ae*C+v,Uc*ze*C+C),f.push(Se*Ae*C+v,Se*ze*C+C)}for(var H=0;H<=6;H++){var Y=H*ml;N(Y,hl),N(Y+zc,hl),N(Y+Hc,Gc),N(Y+(ml-Hc),Gc),N(Y+(ml-zc),hl)}l.gearVertexCount=f.length/2-l.gearOffset,l.arrowOffset=f.length/2;function U(pe,Se){f.push(L+pe,m.drawingBufferHeight-L-Se)}var G=A/Math.sin(45*Xc);U(0,C),U(C,0),U(C+G,G),U(G,C+G),U(G,C-G),U(0,C),U(C,C*2),U(C+G,C*2-G),U(G,C-G),U(0,C),U(G,C-A),U(Hn*S,C-A),U(G,C+A),U(Hn*S,C+A),l.arrowVertexCount=f.length/2-l.arrowOffset,m.bindBuffer(m.ARRAY_BUFFER,l.vertexBuffer),m.bufferData(m.ARRAY_BUFFER,new Float32Array(f),m.STATIC_DRAW)})},Gn.prototype.render=function(){var a=this.gl,l=this,d=[a.CULL_FACE,a.DEPTH_TEST,a.BLEND,a.SCISSOR_TEST,a.STENCIL_TEST,a.COLOR_WRITEMASK,a.VIEWPORT,a.CURRENT_PROGRAM,a.ARRAY_BUFFER_BINDING];Si(a,d,function(m){m.disable(m.CULL_FACE),m.disable(m.DEPTH_TEST),m.disable(m.BLEND),m.disable(m.SCISSOR_TEST),m.disable(m.STENCIL_TEST),m.colorMask(!0,!0,!0,!0),m.viewport(0,0,m.drawingBufferWidth,m.drawingBufferHeight),l.renderNoState()})},Gn.prototype.renderNoState=function(){var a=this.gl;a.useProgram(this.program),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.enableVertexAttribArray(this.attribs.position),a.vertexAttribPointer(this.attribs.position,2,a.FLOAT,!1,8,0),a.uniform4f(this.uniforms.color,1,1,1,1),oe(this.projMat,0,a.drawingBufferWidth,0,a.drawingBufferHeight,.1,1024),a.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),a.drawArrays(a.TRIANGLE_STRIP,0,4),a.drawArrays(a.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),a.drawArrays(a.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function Ho(a){this.coefficients=a}Ho.prototype.distortInverse=function(a){for(var l=0,d=1,m=a-this.distort(l);Math.abs(d-l)>1e-4;){var f=a-this.distort(d),v=d-f*((d-l)/(f-m));l=d,d=v,m=f}return d},Ho.prototype.distort=function(a){for(var l=a*a,d=0,m=0;m<this.coefficients.length;m++)d=l*(d+this.coefficients[m]);return(d+1)*a};var wt=Math.PI/180,St=180/Math.PI,ge=function(l,d,m){this.x=l||0,this.y=d||0,this.z=m||0};ge.prototype={constructor:ge,set:function(l,d,m){return this.x=l,this.y=d,this.z=m,this},copy:function(l){return this.x=l.x,this.y=l.y,this.z=l.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var l=this.length();if(l!==0){var d=1/l;this.multiplyScalar(d)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(l){this.x*=l,this.y*=l,this.z*=l},applyQuaternion:function(l){var d=this.x,m=this.y,f=this.z,v=l.x,g=l.y,M=l.z,S=l.w,A=S*d+g*f-M*m,y=S*m+M*d-v*f,C=S*f+v*m-g*d,L=-v*d-g*m-M*f;return this.x=A*S+L*-v+y*-M-C*-g,this.y=y*S+L*-g+C*-v-A*-M,this.z=C*S+L*-M+A*-g-y*-v,this},dot:function(l){return this.x*l.x+this.y*l.y+this.z*l.z},crossVectors:function(l,d){var m=l.x,f=l.y,v=l.z,g=d.x,M=d.y,S=d.z;return this.x=f*S-v*M,this.y=v*g-m*S,this.z=m*M-f*g,this}};var ee=function(l,d,m,f){this.x=l||0,this.y=d||0,this.z=m||0,this.w=f!==void 0?f:1};ee.prototype={constructor:ee,set:function(l,d,m,f){return this.x=l,this.y=d,this.z=m,this.w=f,this},copy:function(l){return this.x=l.x,this.y=l.y,this.z=l.z,this.w=l.w,this},setFromEulerXYZ:function(l,d,m){var f=Math.cos(l/2),v=Math.cos(d/2),g=Math.cos(m/2),M=Math.sin(l/2),S=Math.sin(d/2),A=Math.sin(m/2);return this.x=M*v*g+f*S*A,this.y=f*S*g-M*v*A,this.z=f*v*A+M*S*g,this.w=f*v*g-M*S*A,this},setFromEulerYXZ:function(l,d,m){var f=Math.cos(l/2),v=Math.cos(d/2),g=Math.cos(m/2),M=Math.sin(l/2),S=Math.sin(d/2),A=Math.sin(m/2);return this.x=M*v*g+f*S*A,this.y=f*S*g-M*v*A,this.z=f*v*A-M*S*g,this.w=f*v*g+M*S*A,this},setFromAxisAngle:function(l,d){var m=d/2,f=Math.sin(m);return this.x=l.x*f,this.y=l.y*f,this.z=l.z*f,this.w=Math.cos(m),this},multiply:function(l){return this.multiplyQuaternions(this,l)},multiplyQuaternions:function(l,d){var m=l.x,f=l.y,v=l.z,g=l.w,M=d.x,S=d.y,A=d.z,y=d.w;return this.x=m*y+g*M+f*A-v*S,this.y=f*y+g*S+v*M-m*A,this.z=v*y+g*A+m*S-f*M,this.w=g*y-m*M-f*S-v*A,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var l=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return l===0?(this.x=0,this.y=0,this.z=0,this.w=1):(l=1/l,this.x=this.x*l,this.y=this.y*l,this.z=this.z*l,this.w=this.w*l),this},slerp:function(l,d){if(d===0)return this;if(d===1)return this.copy(l);var m=this.x,f=this.y,v=this.z,g=this.w,M=g*l.w+m*l.x+f*l.y+v*l.z;if(M<0?(this.w=-l.w,this.x=-l.x,this.y=-l.y,this.z=-l.z,M=-M):this.copy(l),M>=1)return this.w=g,this.x=m,this.y=f,this.z=v,this;var S=Math.acos(M),A=Math.sqrt(1-M*M);if(Math.abs(A)<.001)return this.w=.5*(g+this.w),this.x=.5*(m+this.x),this.y=.5*(f+this.y),this.z=.5*(v+this.z),this;var y=Math.sin((1-d)*S)/A,C=Math.sin(d*S)/A;return this.w=g*y+this.w*C,this.x=m*y+this.x*C,this.y=f*y+this.y*C,this.z=v*y+this.z*C,this},setFromUnitVectors:function(){var a,l,d=1e-6;return function(m,f){return a===void 0&&(a=new ge),l=m.dot(f)+1,l<d?(l=0,Math.abs(m.x)>Math.abs(m.z)?a.set(-m.y,m.x,0):a.set(0,-m.z,m.y)):a.crossVectors(m,f),this.x=a.x,this.y=a.y,this.z=a.z,this.w=l,this.normalize(),this}}()};function xl(a){this.width=a.width||O(),this.height=a.height||I(),this.widthMeters=a.widthMeters,this.heightMeters=a.heightMeters,this.bevelMeters=a.bevelMeters}var Zf=new xl({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),ex=new xl({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),vl={CardboardV1:new gl({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new gl({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function Te(a,l){this.viewer=vl.CardboardV2,this.updateDeviceParams(a),this.distortion=new Ho(this.viewer.distortionCoefficients);for(var d=0;d<l.length;d++){var m=l[d];vl[m.id]=new gl(m)}}Te.prototype.updateDeviceParams=function(a){this.device=this.determineDevice_(a)||this.device},Te.prototype.getDevice=function(){return this.device},Te.prototype.setViewer=function(a){this.viewer=a,this.distortion=new Ho(this.viewer.distortionCoefficients)},Te.prototype.determineDevice_=function(a){if(!a)return c()?(console.warn("Using fallback iOS device measurements."),ex):(console.warn("Using fallback Android device measurements."),Zf);var l=.0254,d=l/a.xdpi,m=l/a.ydpi,f=O(),v=I();return new xl({widthMeters:d*f,heightMeters:m*v,bevelMeters:a.bevelMm*.001})},Te.prototype.getDistortedFieldOfViewLeftEye=function(){var a=this.viewer,l=this.device,d=this.distortion,m=a.screenLensDistance,f=(l.widthMeters-a.interLensDistance)/2,v=a.interLensDistance/2,g=a.baselineLensDistance-l.bevelMeters,M=l.heightMeters-g,S=St*Math.atan(d.distort(f/m)),A=St*Math.atan(d.distort(v/m)),y=St*Math.atan(d.distort(g/m)),C=St*Math.atan(d.distort(M/m));return{leftDegrees:Math.min(S,a.fov),rightDegrees:Math.min(A,a.fov),downDegrees:Math.min(y,a.fov),upDegrees:Math.min(C,a.fov)}},Te.prototype.getLeftEyeVisibleTanAngles=function(){var a=this.viewer,l=this.device,d=this.distortion,m=Math.tan(-wt*a.fov),f=Math.tan(wt*a.fov),v=Math.tan(wt*a.fov),g=Math.tan(-wt*a.fov),M=l.widthMeters/4,S=l.heightMeters/2,A=a.baselineLensDistance-l.bevelMeters-S,y=a.interLensDistance/2-M,C=-A,L=a.screenLensDistance,N=d.distort((y-M)/L),H=d.distort((C+S)/L),Y=d.distort((y+M)/L),U=d.distort((C-S)/L),G=new Float32Array(4);return G[0]=Math.max(m,N),G[1]=Math.min(f,H),G[2]=Math.min(v,Y),G[3]=Math.max(g,U),G},Te.prototype.getLeftEyeNoLensTanAngles=function(){var a=this.viewer,l=this.device,d=this.distortion,m=new Float32Array(4),f=d.distortInverse(Math.tan(-wt*a.fov)),v=d.distortInverse(Math.tan(wt*a.fov)),g=d.distortInverse(Math.tan(wt*a.fov)),M=d.distortInverse(Math.tan(-wt*a.fov)),S=l.widthMeters/4,A=l.heightMeters/2,y=a.baselineLensDistance-l.bevelMeters-A,C=a.interLensDistance/2-S,L=-y,N=a.screenLensDistance,H=(C-S)/N,Y=(L+A)/N,U=(C+S)/N,G=(L-A)/N;return m[0]=Math.max(f,H),m[1]=Math.min(v,Y),m[2]=Math.min(g,U),m[3]=Math.max(M,G),m},Te.prototype.getLeftEyeVisibleScreenRect=function(a){var l=this.viewer,d=this.device,m=l.screenLensDistance,f=(d.widthMeters-l.interLensDistance)/2,v=l.baselineLensDistance-d.bevelMeters,g=(a[0]*m+f)/d.widthMeters,M=(a[1]*m+v)/d.heightMeters,S=(a[2]*m+f)/d.widthMeters,A=(a[3]*m+v)/d.heightMeters;return{x:g,y:A,width:S-g,height:M-A}},Te.prototype.getFieldOfViewLeftEye=function(a){return a?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},Te.prototype.getFieldOfViewRightEye=function(a){var l=this.getFieldOfViewLeftEye(a);return{leftDegrees:l.rightDegrees,rightDegrees:l.leftDegrees,upDegrees:l.upDegrees,downDegrees:l.downDegrees}},Te.prototype.getUndistortedFieldOfViewLeftEye=function(){var a=this.getUndistortedParams_();return{leftDegrees:St*Math.atan(a.outerDist),rightDegrees:St*Math.atan(a.innerDist),downDegrees:St*Math.atan(a.bottomDist),upDegrees:St*Math.atan(a.topDist)}},Te.prototype.getUndistortedViewportLeftEye=function(){var a=this.getUndistortedParams_(),l=this.viewer,d=this.device,m=l.screenLensDistance,f=d.widthMeters/m,v=d.heightMeters/m,g=d.width/f,M=d.height/v,S=Math.round((a.eyePosX-a.outerDist)*g),A=Math.round((a.eyePosY-a.bottomDist)*M);return{x:S,y:A,width:Math.round((a.eyePosX+a.innerDist)*g)-S,height:Math.round((a.eyePosY+a.topDist)*M)-A}},Te.prototype.getUndistortedParams_=function(){var a=this.viewer,l=this.device,d=this.distortion,m=a.screenLensDistance,f=a.interLensDistance/2/m,v=l.widthMeters/m,g=l.heightMeters/m,M=v/2-f,S=(a.baselineLensDistance-l.bevelMeters)/m,A=a.fov,y=d.distortInverse(Math.tan(wt*A)),C=Math.min(M,y),L=Math.min(f,y),N=Math.min(S,y),H=Math.min(g-S,y);return{outerDist:C,innerDist:L,topDist:H,bottomDist:N,eyePosX:M,eyePosY:S}};function gl(a){this.id=a.id,this.label=a.label,this.fov=a.fov,this.interLensDistance=a.interLensDistance,this.baselineLensDistance=a.baselineLensDistance,this.screenLensDistance=a.screenLensDistance,this.distortionCoefficients=a.distortionCoefficients,this.inverseCoefficients=a.inverseCoefficients}Te.Viewers=vl;var tx=1,nx="2019-11-09T17:36:14Z",rx=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],ix={format:tx,last_updated:nx,devices:rx};function Mi(a,l){if(this.dpdb=ix,this.recalculateDeviceParams_(),a){this.onDeviceParamsUpdated=l;var d=new XMLHttpRequest,m=this;d.open("GET",a,!0),d.addEventListener("load",function(){m.loading=!1,d.status>=200&&d.status<=299?(m.dpdb=JSON.parse(d.response),m.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),d.send()}}Mi.prototype.getDeviceParams=function(){return this.deviceParams},Mi.prototype.recalculateDeviceParams_=function(){var a=this.calcDeviceParams_();a?(this.deviceParams=a,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},Mi.prototype.calcDeviceParams_=function(){var a=this.dpdb;if(!a)return console.error("DPDB not available."),null;if(a.format!=1)return console.error("DPDB has unexpected format version."),null;if(!a.devices||!a.devices.length)return console.error("DPDB does not have a devices section."),null;var l=navigator.userAgent||navigator.vendor||window.opera,d=O(),m=I();if(!a.devices)return console.error("DPDB has no devices section."),null;for(var f=0;f<a.devices.length;f++){var v=a.devices[f];if(!v.rules){console.warn("Device["+f+"] has no rules section.");continue}if(v.type!="ios"&&v.type!="android"){console.warn("Device["+f+"] has invalid type.");continue}if(c()==(v.type=="ios")){for(var g=!1,M=0;M<v.rules.length;M++){var S=v.rules[M];if(this.ruleMatches_(S,l,d,m)){g=!0;break}}if(!!g){var A=v.dpi[0]||v.dpi,y=v.dpi[1]||v.dpi;return new ox({xdpi:A,ydpi:y,bevelMm:v.bw})}}}return console.warn("No DPDB device match."),null},Mi.prototype.ruleMatches_=function(a,l,d,m){if(!a.ua&&!a.res||(a.ua&&a.ua.substring(0,2)==="SM"&&(a.ua=a.ua.substring(0,7)),a.ua&&l.indexOf(a.ua)<0))return!1;if(a.res){if(!a.res[0]||!a.res[1])return!1;var f=a.res[0],v=a.res[1];if(Math.min(d,m)!=Math.min(f,v)||Math.max(d,m)!=Math.max(f,v))return!1}return!0};function ox(a){this.xdpi=a.xdpi,this.ydpi=a.ydpi,this.bevelMm=a.bevelMm}function Ti(a,l){this.set(a,l)}Ti.prototype.set=function(a,l){this.sample=a,this.timestampS=l},Ti.prototype.copy=function(a){this.set(a.sample,a.timestampS)};function Un(a,l){this.kFilter=a,this.isDebug=l,this.currentAccelMeasurement=new Ti,this.currentGyroMeasurement=new Ti,this.previousGyroMeasurement=new Ti,c()?this.filterQ=new ee(-1,0,0,1):this.filterQ=new ee(1,0,0,1),this.previousFilterQ=new ee,this.previousFilterQ.copy(this.filterQ),this.accelQ=new ee,this.isOrientationInitialized=!1,this.estimatedGravity=new ge,this.measuredGravity=new ge,this.gyroIntegralQ=new ee}Un.prototype.addAccelMeasurement=function(a,l){this.currentAccelMeasurement.set(a,l)},Un.prototype.addGyroMeasurement=function(a,l){this.currentGyroMeasurement.set(a,l);var d=l-this.previousGyroMeasurement.timestampS;D(d)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},Un.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var a=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,l=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,a);this.gyroIntegralQ.multiply(l),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(l);var d=new ee;d.copy(this.filterQ),d.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(d),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var m=new ee;m.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),m.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",St*Vr(m),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var f=new ee;f.copy(this.filterQ),f.multiply(m),this.filterQ.slerp(f,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},Un.prototype.getOrientation=function(){return this.filterQ},Un.prototype.accelToQuaternion_=function(a){var l=new ge;l.copy(a),l.normalize();var d=new ee;return d.setFromUnitVectors(new ge(0,0,-1),l),d.inverse(),d},Un.prototype.gyroToQuaternionDelta_=function(a,l){var d=new ee,m=new ge;return m.copy(a),m.normalize(),d.setFromAxisAngle(m,a.length()*l),d};function jc(a,l){this.predictionTimeS=a,this.isDebug=l,this.previousQ=new ee,this.previousTimestampS=null,this.deltaQ=new ee,this.outQ=new ee}jc.prototype.getPrediction=function(a,l,d){if(!this.previousTimestampS)return this.previousQ.copy(a),this.previousTimestampS=d,a;var m=new ge;m.copy(l),m.normalize();var f=l.length();if(f<wt*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(St*f).toFixed(1)),this.outQ.copy(a),this.previousQ.copy(a),this.outQ;var v=f*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(m,v),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(a),this.previousTimestampS=d,this.outQ};function pt(a,l,d,m){this.yawOnly=d,this.accelerometer=new ge,this.gyroscope=new ge,this.filter=new Un(a,m),this.posePredictor=new jc(l,m),this.isFirefoxAndroid=x(),this.isIOS=c();var f=b();this.isDeviceMotionInRadians=!this.isIOS&&f&&f<66,this.isWithoutDeviceMotion=R()||E(),this.filterToWorldQ=new ee,c()?this.filterToWorldQ.setFromAxisAngle(new ge(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new ge(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new ee,this.worldToScreenQ=new ee,this.originalPoseAdjustQ=new ee,this.originalPoseAdjustQ.setFromAxisAngle(new ge(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),T()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new ee,this.orientationOut_=new Float32Array(4),this.start()}pt.prototype.getPosition=function(){return null},pt.prototype.getOrientation=function(){var a=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var f=new ee().setFromAxisAngle(new ge(0,0,-1),0),v=new ee;return window.orientation===-90?v.setFromAxisAngle(new ge(0,1,0),Math.PI/-2):v.setFromAxisAngle(new ge(0,1,0),Math.PI/2),f.multiply(v)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var f=new ee;return f.setFromAxisAngle(new ge(1,0,0),-Math.PI/2),f}(),a=this._deviceOrientationQ;var d=new ee;return d.copy(a),d.multiply(this.deviceOrientationFilterToWorldQ),d.multiply(this.resetQ),d.multiply(this.worldToScreenQ),d.multiplyQuaternions(this.deviceOrientationFixQ,d),this.yawOnly&&(d.x=0,d.z=0,d.normalize()),this.orientationOut_[0]=d.x,this.orientationOut_[1]=d.y,this.orientationOut_[2]=d.z,this.orientationOut_[3]=d.w,this.orientationOut_}else{var l=this.filter.getOrientation();a=this.posePredictor.getPrediction(l,this.gyroscope,this.previousTimestampS)}var d=new ee;return d.copy(this.filterToWorldQ),d.multiply(this.resetQ),d.multiply(a),d.multiply(this.worldToScreenQ),this.yawOnly&&(d.x=0,d.z=0,d.normalize()),this.orientationOut_[0]=d.x,this.orientationOut_[1]=d.y,this.orientationOut_[2]=d.z,this.orientationOut_[3]=d.w,this.orientationOut_},pt.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),T()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},pt.prototype.onDeviceOrientation_=function(a){this._deviceOrientationQ=this._deviceOrientationQ||new ee;var l=a.alpha,d=a.beta,m=a.gamma;l=(l||0)*Math.PI/180,d=(d||0)*Math.PI/180,m=(m||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(d,l,-m)},pt.prototype.onDeviceMotion_=function(a){this.updateDeviceMotion_(a)},pt.prototype.updateDeviceMotion_=function(a){var l=a.accelerationIncludingGravity,d=a.rotationRate,m=a.timeStamp/1e3,f=m-this.previousTimestampS;if(f<0){dn("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=m;return}else if(f<=i||f>o){dn("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=m;return}this.accelerometer.set(-l.x,-l.y,-l.z),d&&(P()?this.gyroscope.set(-d.beta,d.alpha,d.gamma):this.gyroscope.set(d.alpha,d.beta,d.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,m)),this.filter.addAccelMeasurement(this.accelerometer,m),this.previousTimestampS=m},pt.prototype.onOrientationChange_=function(a){this.setScreenTransform_()},pt.prototype.onMessage_=function(a){var l=a.data;if(!(!l||!l.type)){var d=l.type.toLowerCase();d==="devicemotion"&&this.updateDeviceMotion_(l.deviceMotionEvent)}},pt.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new ge(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new ge(0,0,1),Math.PI/2);break;case 180:break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},pt.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),c()&&se()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},pt.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var sx=60,ax=new ge(1,0,0),lx=new ge(0,0,1),Al=new ee;Al.setFromAxisAngle(ax,-Math.PI/2),Al.multiply(new ee().setFromAxisAngle(lx,Math.PI/2));var px=function(){function a(l){t(this,a),this.config=l,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new ee,this._outQ=new ee,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return e(a,[{key:"init",value:function(){var d=null;try{d=new RelativeOrientationSensor({frequency:sx,referenceFrame:"screen"}),d.addEventListener("error",this._onSensorError)}catch(m){this.errors.push(m),m.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):m.name==="ReferenceError"?this.useDeviceMotion():console.error(m)}d&&(this.api="sensor",this.sensor=d,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new pt(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var d=this.sensor.quaternion;this._sensorQ.set(d[0],d[1],d[2],d[3]);var m=this._outQ;return m.copy(Al),m.multiply(this._sensorQ),this.config.YAW_ONLY&&(m.x=m.z=0,m.normalize()),this._out[0]=m.x,this._out[1]=m.y,this._out[2]=m.z,this._out[3]=m.w,this._out}},{key:"_onSensorError",value:function(d){this.errors.push(d.error),d.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):d.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(d.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),a}(),cx="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function jn(){this.loadIcon_();var a=document.createElement("div"),g=a.style;g.position="fixed",g.top=0,g.right=0,g.bottom=0,g.left=0,g.backgroundColor="gray",g.fontFamily="sans-serif",g.zIndex=1e6;var l=document.createElement("img");l.src=this.icon;var g=l.style;g.marginLeft="25%",g.marginTop="25%",g.width="50%",a.appendChild(l);var d=document.createElement("div"),g=d.style;g.textAlign="center",g.fontSize="16px",g.lineHeight="24px",g.margin="24px 25%",g.width="50%",d.innerHTML="Place your phone into your Cardboard viewer.",a.appendChild(d);var m=document.createElement("div"),g=m.style;g.backgroundColor="#CFD8DC",g.position="fixed",g.bottom=0,g.width="100%",g.height="48px",g.padding="14px 24px",g.boxSizing="border-box",g.color="#656A6B",a.appendChild(m);var f=document.createElement("div");f.style.float="left",f.innerHTML="No Cardboard viewer?";var v=document.createElement("a");v.href="https://www.google.com/get/cardboard/get-cardboard/",v.innerHTML="get one",v.target="_blank";var g=v.style;g.float="right",g.fontWeight=600,g.textTransform="uppercase",g.borderLeft="1px solid gray",g.paddingLeft="24px",g.textDecoration="none",g.color="#656A6B",m.appendChild(f),m.appendChild(v),this.overlay=a,this.text=d,this.hide()}jn.prototype.show=function(a){!a&&!this.overlay.parentElement?document.body.appendChild(this.overlay):a&&(this.overlay.parentElement&&this.overlay.parentElement!=a&&this.overlay.parentElement.removeChild(this.overlay),a.appendChild(this.overlay)),this.overlay.style.display="block";var l=this.overlay.querySelector("img"),d=l.style;T()?(d.width="20%",d.marginLeft="40%",d.marginTop="3%"):(d.width="50%",d.marginLeft="25%",d.marginTop="25%")},jn.prototype.hide=function(){this.overlay.style.display="none"},jn.prototype.showTemporarily=function(a,l){this.show(l),this.timer=setTimeout(this.hide.bind(this),a)},jn.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},jn.prototype.update=function(){this.disableShowTemporarily(),!T()&&W()?this.show():this.hide()},jn.prototype.loadIcon_=function(){this.icon=s("image/svg+xml",cx)};var dx="CardboardV1",Wc="WEBVR_CARDBOARD_VIEWER",ux="webvr-polyfill-viewer-selector";function ct(a){try{this.selectedKey=localStorage.getItem(Wc)}catch(l){console.error("Failed to load viewer profile: %s",l)}this.selectedKey||(this.selectedKey=a||dx),this.dialog=this.createDialog_(Te.Viewers),this.root=null,this.onChangeCallbacks_=[]}ct.prototype.show=function(a){this.root=a,a.appendChild(this.dialog);var l=this.dialog.querySelector("#"+this.selectedKey);l.checked=!0,this.dialog.style.display="block"},ct.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},ct.prototype.getCurrentViewer=function(){return Te.Viewers[this.selectedKey]},ct.prototype.getSelectedKey_=function(){var a=this.dialog.querySelector("input[name=field]:checked");return a?a.id:null},ct.prototype.onChange=function(a){this.onChangeCallbacks_.push(a)},ct.prototype.fireOnChange_=function(a){for(var l=0;l<this.onChangeCallbacks_.length;l++)this.onChangeCallbacks_[l](a)},ct.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!Te.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(Te.Viewers[this.selectedKey]);try{localStorage.setItem(Wc,this.selectedKey)}catch(a){console.error("Failed to save viewer profile: %s",a)}this.hide()},ct.prototype.createDialog_=function(a){var l=document.createElement("div");l.classList.add(ux),l.style.display="none";var d=document.createElement("div"),v=d.style;v.position="fixed",v.left=0,v.top=0,v.width="100%",v.height="100%",v.background="rgba(0, 0, 0, 0.3)",d.addEventListener("click",this.hide.bind(this));var m=280,f=document.createElement("div"),v=f.style;v.boxSizing="border-box",v.position="fixed",v.top="24px",v.left="50%",v.marginLeft=-m/2+"px",v.width=m+"px",v.padding="24px",v.overflow="hidden",v.background="#fafafa",v.fontFamily="'Roboto', sans-serif",v.boxShadow="0px 5px 20px #666",f.appendChild(this.createH1_("Select your viewer"));for(var g in a)f.appendChild(this.createChoice_(g,a[g].label));return f.appendChild(this.createButton_("Save",this.onSave_.bind(this))),l.appendChild(d),l.appendChild(f),l},ct.prototype.createH1_=function(a){var l=document.createElement("h1"),d=l.style;return d.color="black",d.fontSize="20px",d.fontWeight="bold",d.marginTop=0,d.marginBottom="24px",l.innerHTML=a,l},ct.prototype.createChoice_=function(a,l){var d=document.createElement("div");d.style.marginTop="8px",d.style.color="black";var m=document.createElement("input");m.style.fontSize="30px",m.setAttribute("id",a),m.setAttribute("type","radio"),m.setAttribute("value",a),m.setAttribute("name","field");var f=document.createElement("label");return f.style.marginLeft="4px",f.setAttribute("for",a),f.innerHTML=l,d.appendChild(m),d.appendChild(f),d},ct.prototype.createButton_=function(a,l){var d=document.createElement("button");d.innerHTML=a;var m=d.style;return m.float="right",m.textTransform="uppercase",m.color="#1094f7",m.fontSize="14px",m.letterSpacing=0,m.border=0,m.background="none",m.marginTop="16px",d.addEventListener("click",l),d};var mx=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hx(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function fx(a,l){return l={exports:{}},a(l,l.exports),l.exports}var xx=fx(function(a,l){(function(m,f){a.exports=f()})(mx,function(){return function(d){var m={};function f(v){if(m[v])return m[v].exports;var g=m[v]={i:v,l:!1,exports:{}};return d[v].call(g.exports,g,g.exports,f),g.l=!0,g.exports}return f.m=d,f.c=m,f.d=function(v,g,M){f.o(v,g)||Object.defineProperty(v,g,{configurable:!1,enumerable:!0,get:M})},f.n=function(v){var g=v&&v.__esModule?function(){return v.default}:function(){return v};return f.d(g,"a",g),g},f.o=function(v,g){return Object.prototype.hasOwnProperty.call(v,g)},f.p="",f(f.s=0)}([function(d,m,f){"use strict";var v=function(){function y(C,L){for(var N=0;N<L.length;N++){var H=L[N];H.enumerable=H.enumerable||!1,H.configurable=!0,"value"in H&&(H.writable=!0),Object.defineProperty(C,H.key,H)}}return function(C,L,N){return L&&y(C.prototype,L),N&&y(C,N),C}}();function g(y,C){if(!(y instanceof C))throw new TypeError("Cannot call a class as a function")}var M=f(1),S=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,A=function(){function y(){g(this,y),S?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",M),this.noSleepVideo.addEventListener("timeupdate",function(C){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return v(y,[{key:"enable",value:function(){S?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){S?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),y}();d.exports=A},function(d,m,f){"use strict";d.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),vx=hx(xx),gx=1e3,Ax=[0,0,.5,1],_x=[.5,0,.5,1],bx=window.requestAnimationFrame,yx=window.cancelAnimationFrame;function Ex(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function Qc(a){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:a.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:a.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:a.canPresent},maxLayers:{writable:!1,enumerable:!0,value:a.maxLayers},hasOrientation:{enumerable:!0,get:function(){return Gt("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),a.hasOrientation}}})}function ue(a){a=a||{};var l="wakelock"in a?a.wakelock:!0;this.isPolyfilled=!0,this.displayId=gx++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return Gt("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new Qc({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,l&&W()&&(this.wakelock_=new vx)}ue.prototype.getFrameData=function(a){return ve(a,this._getPose(),this)},ue.prototype.getPose=function(){return Gt("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},ue.prototype.resetPose=function(){return Gt("VRDisplay.prototype.resetPose"),this._resetPose()},ue.prototype.getImmediatePose=function(){return Gt("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},ue.prototype.requestAnimationFrame=function(a){return bx(a)},ue.prototype.cancelAnimationFrame=function(a){return yx(a)},ue.prototype.wrapForFullscreen=function(a){if(c())return a;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var l=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",l.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==a)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=a,this.originalParent_=a.parentElement,this.originalParent_||document.body.appendChild(a),!this.fullscreenWrapper_.parentElement){var d=this.fullscreenElement_.parentElement;d.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),d.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var m=this;function f(){if(!!m.fullscreenElement_){var v=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];m.fullscreenElement_.setAttribute("style",v.join("; ")+";")}}return f(),this.fullscreenWrapper_},ue.prototype.removeFullscreenWrapper=function(){if(!!this.fullscreenElement_){var a=this.fullscreenElement_;this.fullscreenElementCachedStyle_?a.setAttribute("style",this.fullscreenElementCachedStyle_):a.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var l=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(a),this.originalParent_===l?l.insertBefore(a,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(a),l.removeChild(this.fullscreenWrapper_),a}},ue.prototype.requestPresent=function(a){var l=this.isPresenting,d=this;return a instanceof Array||(Gt("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),a=[a]),new Promise(function(m,f){if(!d.capabilities.canPresent){f(new Error("VRDisplay is not capable of presenting."));return}if(a.length==0||a.length>d.capabilities.maxLayers){f(new Error("Invalid number of layers."));return}var v=a[0];if(!v.source){m();return}var g=v.leftBounds||Ax,M=v.rightBounds||_x;if(l){var S=d.layer_;S.source!==v.source&&(S.source=v.source);for(var A=0;A<4;A++)S.leftBounds[A]=g[A],S.rightBounds[A]=M[A];d.wrapForFullscreen(d.layer_.source),d.updatePresent_(),m();return}if(d.layer_={predistorted:v.predistorted,source:v.source,leftBounds:g.slice(0),rightBounds:M.slice(0)},d.waitingForPresent_=!1,d.layer_&&d.layer_.source){var y=d.wrapForFullscreen(d.layer_.source),C=function(){var H=V();d.isPresenting=y===H,d.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(Y){console.error("screen.orientation.lock() failed due to",Y.message)}),d.waitingForPresent_=!1,d.beginPresent_(),m()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),d.removeFullscreenWrapper(),d.disableWakeLock(),d.endPresent_(),d.removeFullscreenListeners_()),d.fireVRDisplayPresentChange_()},L=function(){!d.waitingForPresent_||(d.removeFullscreenWrapper(),d.removeFullscreenListeners_(),d.disableWakeLock(),d.waitingForPresent_=!1,d.isPresenting=!1,f(new Error("Unable to present.")))};d.addFullscreenListeners_(y,C,L),X(y)?(d.enableWakeLock(),d.waitingForPresent_=!0):(c()||u())&&(d.enableWakeLock(),d.isPresenting=!0,d.beginPresent_(),d.fireVRDisplayPresentChange_(),m())}!d.waitingForPresent_&&!c()&&(z(),f(new Error("Unable to present.")))})},ue.prototype.exitPresent=function(){var a=this.isPresenting,l=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(d,m){a?(!z()&&c()&&(l.endPresent_(),l.fireVRDisplayPresentChange_()),u()&&(l.removeFullscreenWrapper(),l.removeFullscreenListeners_(),l.endPresent_(),l.fireVRDisplayPresentChange_()),d()):m(new Error("Was not presenting to VRDisplay."))})},ue.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},ue.prototype.fireVRDisplayPresentChange_=function(){var a=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(a)},ue.prototype.fireVRDisplayConnect_=function(){var a=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(a)},ue.prototype.addFullscreenListeners_=function(a,l,d){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=a,this.fullscreenChangeHandler_=l,this.fullscreenErrorHandler_=d,l&&(document.fullscreenEnabled?a.addEventListener("fullscreenchange",l,!1):document.webkitFullscreenEnabled?a.addEventListener("webkitfullscreenchange",l,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",l,!1):document.msFullscreenEnabled&&a.addEventListener("msfullscreenchange",l,!1)),d&&(document.fullscreenEnabled?a.addEventListener("fullscreenerror",d,!1):document.webkitFullscreenEnabled?a.addEventListener("webkitfullscreenerror",d,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",d,!1):document.msFullscreenEnabled&&a.addEventListener("msfullscreenerror",d,!1))},ue.prototype.removeFullscreenListeners_=function(){if(!!this.fullscreenEventTarget_){var a=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var l=this.fullscreenChangeHandler_;a.removeEventListener("fullscreenchange",l,!1),a.removeEventListener("webkitfullscreenchange",l,!1),document.removeEventListener("mozfullscreenchange",l,!1),a.removeEventListener("msfullscreenchange",l,!1)}if(this.fullscreenErrorHandler_){var d=this.fullscreenErrorHandler_;a.removeEventListener("fullscreenerror",d,!1),a.removeEventListener("webkitfullscreenerror",d,!1),document.removeEventListener("mozfullscreenerror",d,!1),a.removeEventListener("msfullscreenerror",d,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},ue.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},ue.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},ue.prototype.beginPresent_=function(){},ue.prototype.endPresent_=function(){},ue.prototype.submitFrame=function(a){},ue.prototype.getEyeParameters=function(a){return null};var wx={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},Go={LEFT:"left",RIGHT:"right"};function Ce(a){var l=re({},wx);a=re(l,a||{}),ue.call(this,{wakelock:a.MOBILE_WAKE_LOCK}),this.config=a,this.displayName="Cardboard VRDisplay",this.capabilities=new Qc({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new px(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new Mi(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new Te(this.dpdb_.getDeviceParams(),a.ADDITIONAL_VIEWERS),this.viewerSelector_=new ct(a.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new jn),c()&&window.addEventListener("resize",this.onResize_.bind(this))}return Ce.prototype=Object.create(ue.prototype),Ce.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},Ce.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},Ce.prototype._getFieldOfView=function(a){var l;if(a==Go.LEFT)l=this.deviceInfo_.getFieldOfViewLeftEye();else if(a==Go.RIGHT)l=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",a),null;return l},Ce.prototype._getEyeOffset=function(a){var l;if(a==Go.LEFT)l=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(a==Go.RIGHT)l=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",a),null;return l},Ce.prototype.getEyeParameters=function(a){var l=this._getEyeOffset(a),d=this._getFieldOfView(a),m={offset:l,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(m,"fieldOfView",{enumerable:!0,get:function(){return Gt("VRFieldOfView","VRFrameData's projection matrices"),d}}),m},Ce.prototype.onDeviceParamsUpdated_=function(a){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(a),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},Ce.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},Ce.prototype.beginPresent_=function(){var a=this.layer_.source.getContext("webgl");a||(a=this.layer_.source.getContext("experimental-webgl")),a||(a=this.layer_.source.getContext("webgl2")),a&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(a.canvas.width=O()*this.bufferScale_,a.canvas.height=I()*this.bufferScale_,this.cardboardUI_=new Gn(a)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new Gn(a)),this.distorter_=new vt(a,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(l){this.viewerSelector_.show(this.layer_.source.parentElement),l.stopPropagation(),l.preventDefault()}.bind(this),function(l){this.exitPresent(),l.stopPropagation(),l.preventDefault()}.bind(this)),this.rotateInstructions_&&(T()&&W()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},Ce.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},Ce.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},Ce.prototype.submitFrame=function(a){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var l=this.layer_.source.getContext("webgl");l||(l=this.layer_.source.getContext("experimental-webgl")),l||(l=this.layer_.source.getContext("webgl2"));var d=l.canvas;(d.width!=this.lastWidth||d.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=d.width,this.lastHeight=d.height,this.cardboardUI_.render()}},Ce.prototype.onOrientationChange_=function(a){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},Ce.prototype.onResize_=function(a){if(this.layer_){var l=this.layer_.source.getContext("webgl");l||(l=this.layer_.source.getContext("experimental-webgl")),l||(l=this.layer_.source.getContext("webgl2"));var d=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];l.canvas.setAttribute("style",d.join("; ")+";"),Ee(l.canvas)}},Ce.prototype.onViewerChanged_=function(a){this.deviceInfo_.setViewer(a),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},Ce.prototype.fireVRDisplayDeviceParamsChange_=function(){var a=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(a)},Ce.VRFrameData=Ex,Ce.VRDisplay=ue,Ce})});function Ni(n,t,e){return typeof n===t||n instanceof e}function Z(n){return Ni(n,"function",Function)}function ae(n){return Ni(n,"string",String)}function $e(n){return Ni(n,"boolean",Boolean)}function we(n){return Ni(n,"number",Number)}function He(n){return we(n)&&Number.isFinite(n)&&!Number.isNaN(n)}function Xi(n){return _(n)&&Ni(n,"object",Object)}function bl(n){return n instanceof Date}function gt(n){return n instanceof Array}function Ir(n,t){throw new Error((t||"Unexpected object: ")+n)}function B(n){return n==null}function _(n){return!B(n)}var he=class{constructor(t,e,r,...i){this.key=t;this.value=e;this.bySetAttribute=r;this.tags=i.map(o=>o.toLocaleUpperCase()),Object.freeze(this)}applyToElement(t){let e=this.key.startsWith("data-");if(!(this.tags.length===0||this.tags.indexOf(t.tagName)>-1||e))console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`);else if(e){let i=this.key.substring(5);t.dataset[i]=this.value}else this.key==="style"?Object.assign(t.style,this.value):this.key==="classList"?this.value.forEach(i=>t.classList.add(i)):this.bySetAttribute?t.setAttribute(this.key,this.value):this.key in t?t[this.key]=this.value:this.value===!1?t.removeAttribute(this.key):this.value===!0?t.setAttribute(this.key,""):t.setAttribute(this.key,this.value)}};function mn(n){return new he("autoplay",n,!1,"audio","video")}function fe(n){return new he("className",n,!1)}function Lr(...n){return new he("classList",n,!1)}function Wn(n){return new he("controls",n,!1,"audio","video")}function qc(n,t){return new he("data-"+n,t,!1)}function Kc(n){return new he("height",n,!1,"canvas","embed","iframe","img","input","object","video")}function Uo(n){return new he("id",n,!1)}function Dr(n){return new he("loop",n,!1,"audio","bgsound","marquee","video")}function yl(n){return new he("max",n,!1,"input","meter","progress")}function El(n){return new he("min",n,!1,"input","meter")}function Yc(n){return new he("muted",n,!1,"audio","video")}function hn(n){return new he("playsInline",n,!1,"audio","video")}function Dx(n){return n instanceof URL&&(n=n.href),n}function zi(n){return new he("src",Dx(n),!1,"audio","embed","iframe","img","input","script","source","track","video")}function wl(n){return new he("srcObject",n,!1,"audio","video")}function Sl(n){return new he("step",n,!1,"input")}function Or(n){return new he("title",n,!1)}function Hi(n){return ae(n)||(n=n.value),new he("type",n,!1,"button","input","command","embed","link","object","script","source","style","menu")}function kr(n){return new he("value",n,!1,"button","data","input","li","meter","option","progress","param")}function Jc(n){return new he("width",n,!1,"canvas","embed","iframe","img","input","object","video")}var K=class{constructor(t,e){this.key=t;this.value=e;this.name=t.replace(/[A-Z]/g,r=>`-${r.toLocaleLowerCase()}`)}applyToElement(t){t.style[this.key]=this.value}},Ml=class{constructor(...t){this.rest=t}applyToElement(t){for(let e of this.rest)e.applyToElement(t)}};function dt(...n){return new Ml(...n)}function Gi(n){return new K("backgroundColor",n)}function $c(n){return new K("border",n)}function Zc(n){return new K("borderRadius",n)}function ed(n){return new K("boxShadow",n)}function td(n){return new K("color",n)}function nd(n){return new K("columnGap",n)}function Be(n){return new K("display",n)}function rd(n){return new K("filter",n)}function id(n){return new K("flexFlow",n)}function od(n){return new K("float",n)}function jo(n){return new K("fontSize",n)}function Wo(n,t,e,r){return ae(n)||(n=[n,t,e,r].filter(_).join("/")),new K("gridArea",n)}function sd(n){return new K("gridAutoFlow",n)}function Qn(n,t){return ae(n)||(n=[n,t].filter(_).join("/")),new K("gridColumn",n)}function ad(n){return new K("gridColumnGap",n)}function Qo(n,t){return ae(n)||(n=[n,t].filter(_).join("/")),new K("gridRow",n)}function Ut(n){return new K("gridTemplateColumns",n)}function qo(n){return new K("gridTemplateRows",n)}function ut(n){return new K("height",n)}function qn(n){return new K("left",n)}function fn(...n){return new K("margin",n.join(" "))}function ld(n){return new K("marginLeft",n)}function pd(n){return new K("maxHeight",n)}function Kn(n){return new K("maxWidth",n)}function cd(n){return new K("minWidth",n)}function dd(...n){return new K("overflow",n.join(" "))}function Mt(...n){return new K("padding",n.join(" "))}function Cl(n){return new K("pointerEvents",n)}function Br(n){return new K("position",n)}function xn(n){return new K("textAlign",n)}function Yn(n){return new K("top",n)}function ud(n){return new K("touchAction",n)}function md(n){return new K("transform",n)}function hd(n){return new K("verticalAlign",n)}function jt(n){return new K("width",n)}function Ko(n){return new K("zIndex",we(n)?n.toFixed(0):n)}function fd(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}var Tl=class{constructor(t,e){this.selector=t;this.props=e}apply(t){let e=this.props.map(r=>`${r.name}: ${r.value};`).join("");t.insertRule(`${this.selector} {${e}}`,t.cssRules.length)}};function Q(n,...t){return new Tl(n,t)}function Yo(n){return n}function vn(){return!0}function xd(){return!1}function vd(n,t){return n&&t}var Jo=["change","click","contextmenu","dblclick","mouseup","pointerup","reset","submit","touchend"];function gd(n,t){let e=t||vn,r=async i=>{if(i.isTrusted&&await e()){for(let o of Jo)window.removeEventListener(o,r);await n()}};for(let i of Jo)window.addEventListener(i,r)}function Ad(n,t){let e=t||vn;return new Promise(r=>{let i=async o=>{if(o.isTrusted&&await e()){for(let s of Jo)window.removeEventListener(s,i);r(await n())}};for(let o of Jo)window.addEventListener(o,i)})}var Wt=class extends Error{constructor(e,r=null){super(e);this.innerError=r}};function le(n){return n.splice(0)}function Ui(n,t){return n.splice(t,1)[0]}var ji=class{constructor(){this.listeners=new Map;this.listenerOptions=new Map}addEventListener(t,e,r){if(Z(e)){let i=this.listeners.get(t);i||(i=new Array,this.listeners.set(t,i)),i.find(o=>o===e)||(i.push(e),r&&this.listenerOptions.set(e,r))}}removeEventListener(t,e){if(Z(e)){let r=this.listeners.get(t);r&&this.removeListener(r,e)}}clearEventListeners(t){for(let[e,r]of this.listeners)if(B(t)||t===e){for(let i of r)this.removeEventListener(t,i);le(r),this.listeners.delete(e)}}removeListener(t,e){let r=t.findIndex(i=>i===e);r>=0&&(Ui(t,r),this.listenerOptions.has(e)&&this.listenerOptions.delete(e))}dispatchEvent(t){let e=this.listeners.get(t.type);if(e)for(let r of e){let i=this.listenerOptions.get(r);_(i)&&!$e(i)&&i.once&&this.removeListener(e,r),r.call(this,t)}return!t.defaultPrevented}},q=class extends Event{get type(){return super.type}constructor(t,e){super(t,e)}},$=class extends ji{constructor(){super(...arguments);this.bubblers=new Set;this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addEventListener(e,r,i){super.addEventListener(e,r,i)}removeEventListener(e,r){super.removeEventListener(e,r)}clearEventListeners(e){return super.clearEventListeners(e)}addScopedEventListener(e,r,i,o){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([r,i]),this.addEventListener(r,i,o)}removeScope(e){let r=this.scopes.get(e);if(r){this.scopes.delete(e);for(let[i,o]of r)this.removeEventListener(i,o)}}dispatchEvent(e){if(!super.dispatchEvent(e))return!1;if(!e.cancelBubble){for(let r of this.bubblers)if(!r.dispatchEvent(e))return!1}return!0}};var Qt=class{constructor(t,e,r=!0){this.onThens=new Array;this.onCatches=new Array;this._result=void 0;this._error=void 0;this._started=!1;this._errored=!1;this._finished=!1;Z(t)?this.resolveTest=t:this.resolveTest=vn,Z(e)?this.rejectTest=e:this.rejectTest=vn,$e(t)?this.autoStart=t:$e(e)?this.autoStart=e:_(r)?this.autoStart=r:this.autoStart=!1,this.resolve=i=>{if(this.running&&this.resolveTest(i)){this._result=i;for(let o of this.onThens)o(i);this.clear(),this._finished=!0}},this.reject=i=>{if(this.running&&this.rejectTest(i)){this._error=i,this._errored=!0;for(let o of this.onCatches)o(i);this.clear(),this._finished=!0}},this.autoStart&&this.start()}clear(){le(this.onThens),le(this.onCatches)}start(){this._started=!0}get result(){if(_(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}get running(){return this.started&&!this.finished}get errored(){return this._errored}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((t,e)=>{this.finished?this.errored?e(this.error):t(this.result):(this.onThens.push(t),this.onCatches.push(e))})}then(t,e){return this.project().then(t,e)}catch(t){return this.project().catch(t)}finally(t){return this.project().finally(t)}reset(){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._errored=!1,this._finished=!1,this._started=!1,this.autoStart&&this.start()}};function _d(n,t){return"on"+t in n}function Le(n,t,e,...r){B(r)&&(r=[]);let i;if(ae(e)?r.unshift(e):we(e)&&(i=e),!(n instanceof ji)){if(!_d(n,t))throw new Wt(`Target does not have a ${t} rejection event`);for(let u of r)if(!_d(n,u))throw new Wt(`Target does not have a ${u} rejection event`)}let o=new Qt;if(we(i)){let u=setTimeout(o.reject,i,`'${t}' has timed out.`);o.finally(clearTimeout.bind(globalThis,u))}let s=(u,h)=>{n.addEventListener(u,h),o.finally(()=>n.removeEventListener(u,h))},p=u=>o.resolve(u),c=u=>o.reject(u);s(t,p);for(let u of r)s(u,c);return o}function bd(n){return n.then(vn).catch(xd)}function Pl(n){return Xi(n)?n.element instanceof HTMLElement:!1}function Jn(n){return Pl(n)?n.element:n}function Ox(n){return Xi(n)&&"applyToElement"in n&&Z(n.applyToElement)}function De(n,t,e="block"){n=Jn(n),n.style.display=t?e:"none"}function Tt(n){return n=Jn(n),n.style.display!=="none"}function me(n,...t){n=Jn(n);for(let e of t)_(e)&&(e instanceof Node?n.append(e):Pl(e)?n.append(Jn(e)):Ox(e)?e.applyToElement(n):n.append(document.createTextNode(e.toLocaleString())));return n}function Ge(n,...t){let e=null;for(let r of t)if(r instanceof he&&r.key==="id"){e=document.getElementById(r.value);break}return e==null&&(e=document.createElement(n)),me(e,...t),e}function Wi(n){return"disabled"in n&&$e(n.disabled)}function Qi(n){for(n=Jn(n);n.lastChild;)n.lastChild.remove()}function $o(n,t){n=Jn(n),Qi(n),n.append(Bx(t))}function Rl(n,t,e){n=Jn(n);let r=_(e),i=r&&n.classList.contains(e);r&&i!==t&&n.classList.toggle(e)}async function yd(n,t,e){_(e)&&e.start();let r=n==="canplay"?t.HAVE_CURRENT_DATA:t.HAVE_ENOUGH_DATA;if(t.readyState>=r)return!0;try{return await Le(t,n,"error"),!0}catch(i){return console.warn(t.error,i),!1}finally{_(e)&&e.end()}}function Zo(n,t){return yd("canplay",n,t)}function es(n,t){return yd("canplaythrough",n,t)}function $n(...n){return Ge("audio",...n)}function kx(...n){return Ge("button",...n)}function Ed(...n){return kx(...n,Hi("button"))}function Fr(...n){return Ed(...n,Lr("btn","btn-primary"))}function ts(...n){return Ed(...n,Lr("btn","btn-secondary"))}function wd(...n){return Ge("canvas",...n)}function Sd(...n){return Ge("dd",...n)}function _e(...n){return Ge("div",...n)}function Md(...n){return Ge("dl",...n)}function Td(...n){return Ge("dt",...n)}function Cd(...n){return Ge("h1",...n)}function Pd(...n){return Ge("h2",...n)}function qi(...n){return Ge("img",...n)}function Vl(...n){return Ge("input",...n)}function Rd(...n){return Ge("label",...n)}function Vd(...n){return Ge("meter",...n)}function ns(...n){return Ge("option",...n)}function Il(...n){return Ge("select",...n)}function Id(...n){return Ge("video",...n)}function Ld(...n){return Vl(Hi("checkbox"),...n)}function Dd(...n){return Vl(Hi("number"),...n)}function Od(...n){return Vl(Hi("range"),...n)}function Bx(n){return document.createTextNode(n)}function Ct(...n){let t=document.createElement("style");document.head.append(t);for(let e of n)e.apply(t.sheet);return t}function Ll(n,t,e,...r){return $n(hn(!0),Wn(!1),Yc(t),mn(n),Dr(e),dt(Be("none")),...r)}function kd(){return"chrome"in globalThis&&!navigator.userAgent.match("CriOS")}function Bd(){return"InstallTrigger"in globalThis}function Fx(){return/^mac/i.test(navigator.platform)}function Nx(){return/iP(ad|hone|od)/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||Fx()&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>2}function qt(){return/Mobile VR/.test(navigator.userAgent)||/Pico Neo 3 Link/.test(navigator.userAgent)||Kt}function is(){return"xr"in navigator&&"isSessionSupported"in navigator.xr}function Dl(){return"getVRDisplays"in navigator}function os(){return is()||Dl()}function Ki(){return/Android/.test(navigator.userAgent)||/BlackBerry/.test(navigator.userAgent)||/(UC Browser |UCWEB)/.test(navigator.userAgent)||Nx()||qt()}function Nr(){return!Ki()}var Xx=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,rs=navigator.userAgent.match(Xx),Kt=!!rs,Fd=Kt&&{major:parseFloat(rs[1]),minor:parseFloat(rs[2]),patch:parseFloat(rs[3])},Y_=Kt&&/pacific/i.test(navigator.userAgent),J_=Kt&&/quest/i.test(navigator.userAgent),$_=Kt&&/quest 2/i.test(navigator.userAgent);var Z_="Worker"in globalThis;function Zn(...n){let t=[];for(let e of n)_(e)&&e.length>0&&t.indexOf(e)===-1&&t.push(e);return t.join("-")}function Ol(n,...t){if(!Xi(n))return!1;n=n;for(let e of t){if(!(e in n))return!1;let r=n[e];if(!Z(r))return!1}return!0}function Xr(n){return Ol(n,"dispose")}function zx(n){return Ol(n,"destroy")}function Hx(n){return Ol(n,"close")}function Nd(n){Xr(n)&&n.dispose(),Hx(n)&&n.close(),zx(n)&&n.destroy()}function ss(n,t,e){n.splice(e,0,t)}function mt(n,t){let e=n.indexOf(t);return e>-1?(Ui(n,e),!0):!1}function Gx(n,t){for(let e=n.length-1;e>=0;--e)if(t(n[e]))return Ui(n,e);return null}function Xd(n,t,e){return Gx(n,r=>e(r)===t)}function Ux(n){return n}function jx(n,t,e){let r=0,i=n.length,o=Math.floor((r+i)/2),s=!1;for(;r<i&&o<n.length;){let p=n[o],c=B(p)?null:e(p);_(c)&&t<c?i=o:(t===c&&(s=!0),r=o+1),o=Math.floor((r+i)/2)}return s||(o+=.5),o}function zd(n,t,e){e=e||Ux;let r=e(t);return jx(n,r,e)}function kl(n,t,e,r){let i;return Z(e)?i=e:$e(e)&&(r=e),B(r)&&(r=!0),Wx(n,t,i,r)}function Wx(n,t,e,r){let i=zd(n,t,e),o=i%1===0;return i=i|0,(!o||r)&&ss(n,t,i),i}function Hd(n,t){let e=Array.from(n);return er(e,t),e}function er(n,t){n.sort((e,r)=>{let i=t(e),o=t(r);return i<o?-1:i>o?1:0})}var as=class{constructor(t){this.value=t;this._forward=new Array;this._reverse=new Array}connectSorted(t,e){_(e)?(kl(this._forward,t,r=>e(r.value)),kl(t._reverse,this,r=>e(r.value))):this.connectTo(t)}connectTo(t){this.connectAt(t,this._forward.length)}connectAt(t,e){ss(this._forward,t,e),t._reverse.push(this)}disconnectFrom(t){mt(this._forward,t),mt(t._reverse,this)}isConnectedTo(t){return this._forward.indexOf(t)>=0||this._reverse.indexOf(t)>=0}flatten(){let t=new Set,e=[this];for(;e.length>0;){let r=e.shift();_(r)&&!t.has(r)&&(t.add(r),e.push(...r._forward))}return Array.from(t)}get _isEntryPoint(){return this._reverse.length===0}get _isExitPoint(){return this._forward.length===0}get isDisconnected(){return this._isEntryPoint&&this._isExitPoint}get isConnected(){return!this._isExitPoint||!this._isEntryPoint}get isTerminus(){return this._isEntryPoint||this._isExitPoint}get isInternal(){return!this._isEntryPoint&&!this._isExitPoint}};var ls=class extends as{connectTo(t){super.connectTo(t)}connectAt(t,e){super.connectAt(t,e)}connectSorted(t,e){super.connectSorted(t,e)}disconnectFrom(t){super.disconnectFrom(t)}isConnectedTo(t){return super.isConnectedTo(t)}flatten(){return super.flatten()}get connections(){return this._forward}get isEntryPoint(){return this._isEntryPoint}get isExitPoint(){return this._isExitPoint}};function At(n,t){let e=globalThis,r=e[n];if(B(r)){if(B(t))throw new Error(`No value ${n} found`);r=t(),e[n]=r}return r}var Qx="AudioContext"in globalThis,Gd=Qx&&"AudioListener"in globalThis,Ud=Gd&&"setPosition"in AudioListener.prototype,Yi=Gd&&"positionX"in AudioListener.prototype,C0=Z(HTMLMediaElement.prototype.captureStream)||Z(HTMLMediaElement.prototype.mozCaptureStream);function jd(n){return _(n)&&n.node instanceof AudioNode}function Wd(n){return _(n)&&n.input instanceof AudioNode&&n.output instanceof AudioNode}var gn=At("Juniper:Audio:connections",()=>new Map),Bl=At("Juniper:Audio:names",()=>new Map);function Qd(n){return Wd(n)?n.output:jd(n)?n.node:n}function qd(n){if(B(n))return;let t=null;gt(n)?n.length===2?t=n[1]:t=n[2]:t=n;let e=null;return Wd(t)?e=t.input:jd(t)?e=t.node:e=t,e}function Kd(n){return gt(n)?n.length===2?[n[0]]:[n[0],n[1]]:[]}function qx(n){return _(n)&&_(n.context)}function Yd(n,t){Bl.set(t,n)}function te(n){Bl.delete(n),qx(n)&&Pt(n)}function Jd(...n){for(let t=1;t<n.length;++t)_t(n[t-1],n[t])}function _t(n,t){let e=Qd(n),r=qd(t),i=Kd(t);if(B(r))throw new Error("Must have a target to connect to");r instanceof AudioParam?e.connect(r,i[0]):r instanceof AudioNode?e.connect(r,i[0],i[1]):Ir(r),gn.has(e)||gn.set(e,new Set);let o=gn.get(e);return o.has(r)?!1:(o.add(r),!0)}function Pt(n,t){let e=Qd(n),r=qd(t),i=Kd(t);if(B(r)?e.disconnect():r instanceof AudioParam?e.disconnect(r,i[0]):r instanceof AudioNode?e.disconnect(r,i[0],i[1]):Ir(r),!gn.has(e))return!1;let o=gn.get(e),s=!1;return B(r)?(s=o.size>0,o.clear()):o.has(r)&&(s=!0,o.delete(r)),o.size===0&&gn.delete(e),s}function Kx(){let n=new Map;function t(e){n.has(e)||n.set(e,new ls(e))}for(let e of Bl.keys())t(e);for(let[e,r]of gn){t(e);for(let i of r)t(i)}for(let[e,r]of gn){let i=n.get(e);for(let o of r)n.has(o)&&i.connectTo(n.get(o))}return Array.from(n.values())}globalThis.getAudioGraph=Kx;async function Rt(n){if(Yd("speakers",n.destination),n.state!=="running")if(n.state==="closed")await n.resume();else if(n.state==="suspended"){let t=Le(n,"statechange");gd(()=>n.resume()),await t}else Ir(n.state)}function Yt(n,t,...e){Yd(n,t);for(let r of e)_(r)&&_t(t,r);return t}function $d(n,t,e,...r){return Yt(n,new AnalyserNode(t,e),...r)}function zr(n,t,e,...r){return Yt(n,new BiquadFilterNode(t,e),...r)}function Zd(n,t,e,...r){return Yt(n,new DelayNode(t,e),...r)}function eu(n,t,e,...r){return Yt(n,new DynamicsCompressorNode(t,e),...r)}function Fe(n,t,e,...r){return Yt(n,new GainNode(t,e),...r)}function tr(n,t,e,...r){return Yt(n,t.createMediaElementSource(e),...r)}function Fl(n,t,e,...r){return Yt(n,new MediaStreamAudioDestinationNode(t,e),...r)}function tu(n,t,e,...r){return Yt(n,t.createMediaStreamSource(e),...r)}function nu(n,t,e,...r){return Yt(n,new PannerNode(t,e),...r)}var ps=1e-6,Ji=typeof Float32Array<"u"?Float32Array:Array,Nl=Math.random;var R0=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Ze={};Vx(Ze,{add:()=>tv,angle:()=>Ev,bezier:()=>fv,ceil:()=>nv,clone:()=>Jx,copy:()=>Zx,create:()=>ru,cross:()=>uv,dist:()=>Vv,distance:()=>lu,div:()=>Rv,divide:()=>au,dot:()=>du,equals:()=>Tv,exactEquals:()=>Mv,floor:()=>rv,forEach:()=>Ov,fromValues:()=>$x,hermite:()=>hv,inverse:()=>cv,len:()=>Lv,length:()=>iu,lerp:()=>mv,max:()=>ov,min:()=>iv,mul:()=>Pv,multiply:()=>su,negate:()=>pv,normalize:()=>dv,random:()=>xv,rotateX:()=>_v,rotateY:()=>bv,rotateZ:()=>yv,round:()=>sv,scale:()=>av,scaleAndAdd:()=>lv,set:()=>ev,sqrDist:()=>Iv,sqrLen:()=>Dv,squaredDistance:()=>pu,squaredLength:()=>cu,str:()=>Sv,sub:()=>Cv,subtract:()=>ou,transformMat3:()=>gv,transformMat4:()=>vv,transformQuat:()=>Av,zero:()=>wv});function ru(){var n=new Ji(3);return Ji!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Jx(n){var t=new Ji(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function iu(n){var t=n[0],e=n[1],r=n[2];return Math.hypot(t,e,r)}function $x(n,t,e){var r=new Ji(3);return r[0]=n,r[1]=t,r[2]=e,r}function Zx(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function ev(n,t,e,r){return n[0]=t,n[1]=e,n[2]=r,n}function tv(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function ou(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function su(n,t,e){return n[0]=t[0]*e[0],n[1]=t[1]*e[1],n[2]=t[2]*e[2],n}function au(n,t,e){return n[0]=t[0]/e[0],n[1]=t[1]/e[1],n[2]=t[2]/e[2],n}function nv(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n}function rv(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n}function iv(n,t,e){return n[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n[2]=Math.min(t[2],e[2]),n}function ov(n,t,e){return n[0]=Math.max(t[0],e[0]),n[1]=Math.max(t[1],e[1]),n[2]=Math.max(t[2],e[2]),n}function sv(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n}function av(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function lv(n,t,e,r){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function lu(n,t){var e=t[0]-n[0],r=t[1]-n[1],i=t[2]-n[2];return Math.hypot(e,r,i)}function pu(n,t){var e=t[0]-n[0],r=t[1]-n[1],i=t[2]-n[2];return e*e+r*r+i*i}function cu(n){var t=n[0],e=n[1],r=n[2];return t*t+e*e+r*r}function pv(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n}function cv(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n}function dv(n,t){var e=t[0],r=t[1],i=t[2],o=e*e+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n}function du(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function uv(n,t,e){var r=t[0],i=t[1],o=t[2],s=e[0],p=e[1],c=e[2];return n[0]=i*c-o*p,n[1]=o*s-r*c,n[2]=r*p-i*s,n}function mv(n,t,e,r){var i=t[0],o=t[1],s=t[2];return n[0]=i+r*(e[0]-i),n[1]=o+r*(e[1]-o),n[2]=s+r*(e[2]-s),n}function hv(n,t,e,r,i,o){var s=o*o,p=s*(2*o-3)+1,c=s*(o-2)+o,u=s*(o-1),h=s*(3-2*o);return n[0]=t[0]*p+e[0]*c+r[0]*u+i[0]*h,n[1]=t[1]*p+e[1]*c+r[1]*u+i[1]*h,n[2]=t[2]*p+e[2]*c+r[2]*u+i[2]*h,n}function fv(n,t,e,r,i,o){var s=1-o,p=s*s,c=o*o,u=p*s,h=3*o*p,x=3*c*s,b=c*o;return n[0]=t[0]*u+e[0]*h+r[0]*x+i[0]*b,n[1]=t[1]*u+e[1]*h+r[1]*x+i[1]*b,n[2]=t[2]*u+e[2]*h+r[2]*x+i[2]*b,n}function xv(n,t){t=t||1;var e=Nl()*2*Math.PI,r=Nl()*2-1,i=Math.sqrt(1-r*r)*t;return n[0]=Math.cos(e)*i,n[1]=Math.sin(e)*i,n[2]=r*t,n}function vv(n,t,e){var r=t[0],i=t[1],o=t[2],s=e[3]*r+e[7]*i+e[11]*o+e[15];return s=s||1,n[0]=(e[0]*r+e[4]*i+e[8]*o+e[12])/s,n[1]=(e[1]*r+e[5]*i+e[9]*o+e[13])/s,n[2]=(e[2]*r+e[6]*i+e[10]*o+e[14])/s,n}function gv(n,t,e){var r=t[0],i=t[1],o=t[2];return n[0]=r*e[0]+i*e[3]+o*e[6],n[1]=r*e[1]+i*e[4]+o*e[7],n[2]=r*e[2]+i*e[5]+o*e[8],n}function Av(n,t,e){var r=e[0],i=e[1],o=e[2],s=e[3],p=t[0],c=t[1],u=t[2],h=i*u-o*c,x=o*p-r*u,b=r*c-i*p,E=i*b-o*x,R=o*h-r*b,P=r*x-i*h,T=s*2;return h*=T,x*=T,b*=T,E*=2,R*=2,P*=2,n[0]=p+h+E,n[1]=c+x+R,n[2]=u+b+P,n}function _v(n,t,e,r){var i=[],o=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),n[0]=o[0]+e[0],n[1]=o[1]+e[1],n[2]=o[2]+e[2],n}function bv(n,t,e,r){var i=[],o=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),n[0]=o[0]+e[0],n[1]=o[1]+e[1],n[2]=o[2]+e[2],n}function yv(n,t,e,r){var i=[],o=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],n[0]=o[0]+e[0],n[1]=o[1]+e[1],n[2]=o[2]+e[2],n}function Ev(n,t){var e=n[0],r=n[1],i=n[2],o=t[0],s=t[1],p=t[2],c=Math.sqrt(e*e+r*r+i*i),u=Math.sqrt(o*o+s*s+p*p),h=c*u,x=h&&du(n,t)/h;return Math.acos(Math.min(Math.max(x,-1),1))}function wv(n){return n[0]=0,n[1]=0,n[2]=0,n}function Sv(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function Mv(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]}function Tv(n,t){var e=n[0],r=n[1],i=n[2],o=t[0],s=t[1],p=t[2];return Math.abs(e-o)<=ps*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(r-s)<=ps*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-p)<=ps*Math.max(1,Math.abs(i),Math.abs(p))}var Cv=ou,Pv=su,Rv=au,Vv=lu,Iv=pu,Lv=iu,Dv=cu,Ov=function(){var n=ru();return function(t,e,r,i,o,s){var p,c;for(e||(e=3),r||(r=0),i?c=Math.min(i*e+r,t.length):c=t.length,p=r;p<c;p+=e)n[0]=t[p],n[1]=t[p+1],n[2]=t[p+2],o(n,n,s),t[p]=n[0],t[p+1]=n[1],t[p+2]=n[2];return t}}();var cs=class{constructor(){this.t=0;this.p=Ze.create();this.f=Ze.set(Ze.create(),0,0,-1);this.u=Ze.set(Ze.create(),0,1,0);Object.seal(this)}set(t,e,r,i,o,s,p,c,u){this.setPosition(t,e,r),this.setOrientation(i,o,s,p,c,u)}setPosition(t,e,r){Ze.set(this.p,t,e,r)}setOrientation(t,e,r,i,o,s){Ze.set(this.f,t,e,r),Ze.set(this.u,i,o,s)}copy(t){Ze.copy(this.p,t.p),Ze.copy(this.f,t.f),Ze.copy(this.u,t.u)}};var Hr=class extends ${constructor(e,r,i){super();this.id=e;this.audioCtx=r;this.spatializer=i;this.pose=new cs;this.disposed=!1;this.volumeControl=Fe(`volume-control-${this.id}`,r)}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){te(this.volumeControl),Xr(this.spatializer)&&this.spatializer.dispose()}audioTick(e){this.spatializer.setPose(this.pose,e)}};var kv="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function bt(n,t){if(n<0)throw new Error("Length must be greater than 0");B(t)&&(t=kv);let e="";for(let r=0;r<n;++r){let i=Math.floor(Math.random()*t.length);e+=t[i]}return e}var Gr=class{constructor(t){this.id=t;this.minDistance=1;this.maxDistance=10;this.algorithm="inverse"}setAudioProperties(t,e,r){this.minDistance=t,this.maxDistance=e,this.algorithm=r}};var Ur=class extends Gr{constructor(){super(...arguments);this.disposed=!1}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){te(this.input)}};var Xl=At("Juniper:Audio:Destinations:Spatializers:NoSpatializationNode:nodes",()=>new WeakMap),Ue=class extends Ur{static instance(t){if(!Xl.has(t)){let e=`no-spatialization-hook-${bt(8)}`;Xl.set(t,new Ue(e,t))}return Xl.get(t)}constructor(t,e){super(t),this.input=this.output=Fe(this.id,e),Object.seal(this)}setPose(t,e){}};var ds=class extends Hr{constructor(e,r,i){super("final",e,i);this._trueDestination=r;this._remoteUserInput=Fe("remote-user-input",this.audioCtx,null,this._spatializedInput=Fe("spatialized-input",this.audioCtx,null,this.volumeControl)),this._nonSpatializedInput=Fe("non-spatialized-input",this.audioCtx,null,this.volumeControl),_t(this.volumeControl,this._trueDestination),_t(Ue.instance(this.audioCtx),this.nonSpatializedInput)}onDisposing(){te(this._remoteUserInput),te(this._spatializedInput),te(this._nonSpatializedInput),super.onDisposing()}get remoteUserInput(){return this._remoteUserInput}get spatializedInput(){return this._spatializedInput}get nonSpatializedInput(){return this._nonSpatializedInput}get trueDestination(){return this._trueDestination}};var jr=class extends Gr{constructor(e){super("listener");this.audioCtx=e}get listener(){return this.audioCtx.listener}};var us=class extends jr{constructor(t){if(super(t),!Yi)throw new Error("Latest WebAudio Listener API is not supported");Object.seal(this)}setPose(t,e){let{p:r,f:i,u:o}=t;this.listener.positionX.setValueAtTime(r[0],e),this.listener.positionY.setValueAtTime(r[1],e),this.listener.positionZ.setValueAtTime(r[2],e),this.listener.forwardX.setValueAtTime(i[0],e),this.listener.forwardY.setValueAtTime(i[1],e),this.listener.forwardZ.setValueAtTime(i[2],e),this.listener.upX.setValueAtTime(o[0],e),this.listener.upY.setValueAtTime(o[1],e),this.listener.upZ.setValueAtTime(o[2],e)}};var ms=class extends jr{constructor(t){if(super(t),!Ud)throw new Error("WebAudio Listener API is not supported");Object.seal(this)}setPose(t,e){let{p:r,f:i,u:o}=t;this.listener.setPosition(r[0],r[1],r[2]),this.listener.setOrientation(i[0],i[1],i[2],o[0],o[1],o[2])}};function*Bv(n,t,e=-1){let r=0;for(;e<0||r<e;){yield n,++r;let i=n+t;n=t,t=i}}function uu(n,t,e){return new Hl(n,t,3,e)}var zl=class{constructor(t,e,r,i,o){this.input=Fe(`${t}-input`,e,{gain:r},this.output=Zd(`${t}-delay`,e,{maxDelayTime:i,delayTime:i},o))}dispose(){te(this.input),te(this.output)}},Hl=class{constructor(t,e,r,i){this.output=Fe(`${t}-output`,e,null,i);let o=Array.from(Bv(1,2,r));this.layers=o.map(s=>new zl(`${t}-echo-layer-${s}`,e,.5/s,s,this.output)),this.input=Fe(`${t}-input`,e,null,...this.layers)}dispose(){te(this.input);for(let t of this.layers)t.dispose();te(this.output),le(this.layers)}};function mu(n,t,e){return new Gl(n,t,e)}var Gl=class{constructor(t,e,r){this.node=zr(`${t}-biquad-filter`,e,{type:"bandpass",frequency:2500,Q:4.5},r)}dispose(){te(this.node)}};function hu(n,t,e){return new Ul(n,t,e)}var Ul=class{constructor(t,e,r){this.node=zr(`${t}-biquad-filter`,e,{type:"bandpass",frequency:400,Q:4.5},r)}dispose(){te(this.node)}};var fu=new Map([["Radio",mu],["Wall",hu],["Echo",uu]]);var jl=class extends q{constructor(e){super("sourceadded");this.source=e}},Vt=class extends Hr{constructor(e,r,i,...o){super(e,r,i);this.source=null;this.effects=new Array;this._connected=!1;this.setEffects(...o)}onDisposing(){for(let e of this.effects)Xr(e)&&e.dispose();le(this.effects),super.onDisposing()}setEffects(...e){Pt(this.volumeControl);for(let r of this.effects)Xr(r)&&r.dispose();le(this.effects);for(let r of e)if(_(r)){let i=fu.get(r);_(i)&&this.effects.push(i(`${r}-${this.id}`,this.audioCtx))}Jd(this.volumeControl,...this.effects,this.spatializer)}get spatialized(){return!(this.spatializer instanceof Ue)}get input(){return this.source}get connected(){return this._connected}connect(){this.connected||_t(this.source,this.volumeControl)}disconnect(){this.connected&&Pt(this.source,this.volumeControl)}set input(e){e!==this.input&&(this.source&&te(this.source),e&&(this.source=e,this.connect(),this.dispatchEvent(new jl(this.source))))}get output(){return this.volumeControl}};var It=class extends q{constructor(e,r){super(e);this.source=r}},An=class extends It{constructor(t){super("loaded",t)}},hs=class extends It{constructor(e,r){super("errored",e);this.error=r}},_n=class extends It{constructor(t){super("played",t)}},bn=class extends It{constructor(t){super("paused",t)}},yn=class extends It{constructor(t){super("stopped",t)}},En=class extends It{constructor(e){super("progress",e);this.value=0;this.total=0}};var fs=new WeakMap,xs=new WeakMap;function xu(n,t){let e=(xs.get(n)||0)+t;xs.set(n,e);let r=n.mediaElement,i=(fs.get(r)||0)+t;return fs.set(r,i),i}function Fv(n){xu(n,1)}function Nv(n){xu(n,-1),xs.get(n)===0&&(xs.delete(n),te(n)),fs.get(n.mediaElement)===0&&(fs.delete(n.mediaElement),n.mediaElement.isConnected&&n.mediaElement.remove())}var vs=class extends Vt{constructor(e,r,i,o,s,...p){super(e,r,s,...p);this.randomize=o;Fv(this.input=i),this.audio=i.mediaElement,this.disconnect(),this.loadEvt=new An(this),this.playEvt=new _n(this),this.pauseEvt=new bn(this),this.stopEvt=new yn(this),this.progEvt=new En(this);let c=u=>{this.disconnect(),this.audio.currentTime===0||u.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};this.audio.addEventListener("ended",c),this.audio.addEventListener("pause",c),this.audio.addEventListener("play",()=>{if(this.connect(),this.randomize&&this.audio.loop&&this.audio.duration>1){let u=this.audio.duration*Math.random();this.audio.currentTime=u}this.dispatchEvent(this.playEvt)}),this.audio.addEventListener("timeupdate",()=>{this.progEvt.value=this.audio.currentTime,this.progEvt.total=this.audio.duration,this.dispatchEvent(this.progEvt)}),Zo(this.audio).then(u=>this.dispatchEvent(u?this.loadEvt:new hs(this,this.audio.error)))}get playbackState(){return this.audio.error?"errored":this.audio.ended||this.audio.paused&&this.audio.currentTime===0?"stopped":this.audio.paused?"paused":"playing"}async play(){await Rt(this.audioCtx),await this.audio.play()}async playThrough(){let e=Le(this,"stopped");await this.play(),await e}pause(){this.audio.pause()}stop(){this.audio.currentTime=0,this.pause()}restart(){return this.stop(),this.play()}onDisposing(){this.disconnect(),Nv(this.input),super.onDisposing()}};var gs=class extends Vt{constructor(t,e,r,...i){super(t,e,r,...i)}};var Wr=class extends Ur{constructor(e,r){super(e);this.lpx=0;this.lpy=0;this.lpz=0;this.lox=0;this.loy=0;this.loz=0;this.input=this.output=this.panner=nu(this.id,r,{panningModel:"HRTF",distanceModel:"inverse",coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:0})}setAudioProperties(e,r,i){super.setAudioProperties(e,r,i),this.panner.refDistance=this.minDistance,this.panner.distanceModel=i,this.maxDistance<=0?this.panner.rolloffFactor=1/0:this.panner.rolloffFactor=1/this.maxDistance}setPose(e,r){let{p:i,f:o}=e,[s,p,c]=i,[u,h,x]=o;(s!==this.lpx||p!==this.lpy||c!==this.lpz)&&(this.lpx=s,this.lpy=p,this.lpz=c,this.setPosition(s,p,c,r)),(u!==this.lox||h!==this.loy||x!==this.loz)&&(this.lox=u,this.loy=h,this.loz=x,this.setOrientation(u,h,x,r))}};var As=class extends Wr{constructor(t,e){super(t,e),Object.seal(this)}setPosition(t,e,r,i){He(t)&&He(e)&&He(r)&&He(i)&&(this.panner.positionX.setValueAtTime(t,i),this.panner.positionY.setValueAtTime(e,i),this.panner.positionZ.setValueAtTime(r,i))}setOrientation(t,e,r,i){He(t)&&He(e)&&He(r)&&He(i)&&(this.panner.orientationX.setValueAtTime(-t,i),this.panner.orientationY.setValueAtTime(-e,i),this.panner.orientationZ.setValueAtTime(-r,i))}};var _s=class extends Wr{constructor(t,e){super(t,e),Object.seal(this)}setPosition(t,e,r,i){this.panner.setPosition(t,e,r)}setOrientation(t,e,r,i){this.panner.setOrientation(t,e,r)}};function Xv(n,t,e){let r=n?0:t.length-1,i=n?t.length:-1,o=n?1:-1;for(let s of e)for(let p=r;p!=i;p+=o){let c=t[p];if(s(c))return c}return null}function Lt(n,...t){return Xv(!0,n,t)}function vu(n){let t=[];for(let e=0;e<n.length;++e){let r=n[e],i=!1;for(let o=0;o<t.length&&!i;++o){let s=t[o];i=r.kind===s.kind&&s.label.indexOf(r.label)>0}i||t.push(r)}return t}var Dt=Z(HTMLAudioElement.prototype.setSinkId),Wl=class extends q{constructor(e){super("audiooutputchanged");this.device=e}},gu="calla:preferredAudioOutputID",bs=class extends ${constructor(e){super();this.element=e;this._hasAudioPermission=!1;this.ready=this.start(),Object.seal(this)}get hasAudioPermission(){return this._hasAudioPermission}async start(){if(Dt){let e=await navigator.mediaDevices.enumerateDevices(),r=Lt(e,i=>i.kind==="audiooutput"&&i.label.length>0);if(_(r)){this._hasAudioPermission=!0;let i=await this.getPreferredAudioOutput();i&&await this.setAudioOutputDevice(i)}}}get preferredAudioOutputID(){return Dt?localStorage.getItem(gu):null}async getAudioOutputDevices(e=!1){return Dt?await this.getAvailableDevices(e)||[]:[]}async getAudioOutputDevice(){if(!Dt)return null;let e=this.element&&this.element.sinkId;if(B(e))return null;let r=await this.getAudioOutputDevices();return Lt(r,o=>o.deviceId===e)}async getPreferredAudioOutput(){if(!Dt)return null;let e=await this.getAudioOutputDevices();return Lt(e,i=>i.deviceId===this.preferredAudioOutputID,i=>i.deviceId==="default",i=>i.deviceId.length>0)}async setAudioOutputDevice(e){if(Dt){if(_(e)&&e.kind!=="audiooutput")throw new Error(`Device is not an audio output device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(gu,e&&e.deviceId||null);let r=this.element,i=r&&r.sinkId;this.preferredAudioOutputID!==i&&(_(this.preferredAudioOutputID)&&await this.element.setSinkId(this.preferredAudioOutputID),this.dispatchEvent(new Wl(e)))}}async getAvailableDevices(e=!1){let r=null,i=null;for(let o=0;o<3;++o){r=await navigator.mediaDevices.enumerateDevices();for(let s of r)s.deviceId.length>0&&(this.hasAudioPermission||(this._hasAudioPermission=s.kind==="audioinput"&&s.label.length>0));if(this.hasAudioPermission)break;try{i=await this.startStream()}catch(s){console.warn(s)}}if(i)for(let o of i.getTracks())o.stop();return r=Hd(r||[],o=>o.label),e&&(r=vu(r)),Dt?r.filter(o=>o.kind==="audiooutput"):[]}startStream(){return navigator.mediaDevices.getUserMedia({audio:!0})}};!("AudioContext"in globalThis)&&"webkitAudioContext"in globalThis&&(globalThis.AudioContext=globalThis.webkitAudioContext);!("OfflineAudioContext"in globalThis)&&"webkitOfflineAudioContext"in globalThis&&(globalThis.OfflineAudioContext=globalThis.webkitOfflineAudioContext);var Au="juniper::useHeadphones",zv=new q("useheadphonestoggled"),Hv="createMediaStreamSource"in AudioContext.prototype,_u=!Hv,ys=class extends ${constructor(e){super();this.users=new Map;this.clips=new Map;this.clipPaths=new Map;this.pathSources=new Map;this.pathCounts=new Map;this._minDistance=1;this._maxDistance=10;this._useHeadphones=!1;this._algorithm="inverse";this.element=null;this.audioDestination=null;this.localUserID=null;this.counter=0;this.audioCtx=new AudioContext;let r=Fl("final-destination",this.audioCtx);this.element=$n(Uo("Audio-Device-Manager"),hn(!0),mn(!0),wl(r.stream),dt(Be("none"))),me(document.body,this),this.speakers=new bs(this.element),this.input=Fe("local-mic-user-gain",this.audioCtx,null,this.localAutoControlledGain=Fe("local-mic-auto-gain",this.audioCtx,null,this.localFilter=zr("local-mic-filter",this.audioCtx,{type:"bandpass",frequency:1500,Q:.25},this.localCompressor=eu("local-mic-compressor",this.audioCtx,{threshold:-15,knee:40,ratio:17},this.output=Fl("local-mic-destination",this.audioCtx))))),this.audioDestination=new ds(this.audioCtx,r,Yi?new us(this.audioCtx):new ms(this.audioCtx)),Ue.instance(this.audioCtx).setAudioProperties(this._minDistance,this._maxDistance,this.algorithm),this.setLocalUserID(e);let i=localStorage.getItem(Au);_(i)?this._useHeadphones=i==="true":this._useHeadphones=qt(),this.ready=this.start(),Object.seal(this)}get algorithm(){return this._algorithm}get useHeadphones(){return this._useHeadphones}set useHeadphones(e){e!==this.useHeadphones&&(this._useHeadphones=e,localStorage.setItem(Au,this.useHeadphones.toString()),this.dispatchEvent(zv))}dispose(){for(let e of this.users.keys())this.removeUser(e);for(let e of this.clips.keys())this.removeClip(e);Pt(this.input),Pt(this.localAutoControlledGain),Pt(this.localFilter),Pt(this.localCompressor),Pt(this.output),this.audioDestination.dispose(),this.audioCtx.suspend()}async start(){await Promise.all([Rt(this.audioCtx),Ad(()=>this.element.play()),this.speakers.ready])}get filter(){return this.localFilter}get filterFrequency(){return this.localFilter.frequency.value}set filterFrequency(e){this.localFilter.frequency.value=e}get compressor(){return this.localCompressor}get currentTime(){return this.audioCtx.currentTime}update(){let e=this.currentTime;this.audioDestination.audioTick(e);for(let r of this.clips.values())r.audioTick(e);for(let r of this.users.values())r.audioTick(e)}newSpatializer(e,r,i){if(r){let o=i?this.audioDestination.remoteUserInput:this.audioDestination.spatializedInput,s=`spatializer-${++this.counter}-${e}`,p=Yi?new As(s+"-new-wa",this.audioCtx):new _s(e+"-old-wa",this.audioCtx);return _t(p,o),p}else return Ue.instance(this.audioCtx)}createSpatializer(e,r,i){let o=this.newSpatializer(e,r,i);return o.setAudioProperties(this._minDistance,this._maxDistance,this._algorithm),o}createUser(e,r){if(!this.users.has(e)){let i=Zn(r,e),o=this.createSpatializer(i,!0,!0),s=new gs(i,this.audioCtx,o);this.users.set(e,s)}return this.users.get(e)}setLocalUserID(e){return this.audioDestination&&(this.localUserID=e),this.audioDestination}loadBasicClip(e,r,i,o){return this.loadClip(e,r,!1,!1,!1,!1,i,[],o)}createBasicClip(e,r,i){return this.createClip(e,r,!1,!1,!1,i,[])}async loadClip(e,r,i,o,s,p,c,u,h){if(B(r)||ae(r)&&r.length===0)throw new Error("No clip source path provided");_(h)&&h.start(r);let x=await this.getSourceTask(e,r,r,i,o,h),b=this.makeClip(x,e,r,s,p,o,c,...u);return this.clips.set(e,b),_(h)&&h.end(r),b}createClip(e,r,i,o,s,p,c){if(B(r)||ae(r)&&r.length===0)throw new Error("No clip source path provided");let u=r.currentSrc,h=this.createSourceFromElement(e,r),x=this.makeClip(h,e,u,o,s,i,p,...c);return this.clips.set(e,x),x}getSourceTask(e,r,i,o,s,p){this.clipPaths.set(e,r);let c=this.pathSources.get(r);return _(c)?this.pathCounts.set(r,this.pathCounts.get(r)+1):(c=this.createSourceFromFile(e,i,o,s,p),this.pathSources.set(r,c),this.pathCounts.set(r,1)),c}async createSourceFromFile(e,r,i,o,s){_(s)&&s.start(e);let p=Ll(o,!1,i,zi(r));if(!await Zo(p))throw p.error;return _(s)&&s.end(e),this.createSourceFromElement(e,p)}createSourceFromStream(e,r){let i=Ll(!0,!_u,!1,wl(r));return _u?this.createSourceFromElement(e,i):tu(Zn("media-stream-source",e,r.id),this.audioCtx,r)}createSourceFromElement(e,r){return tr(Zn("media-element-source",e),this.audioCtx,r)}makeClip(e,r,i,o,s,p,c,...u){let h=Zn(r,i),x=this.createSpatializer(h,o,!1),b=new vs(Zn("audio-clip-element",h),this.audioCtx,e,s,x,...u);return p&&b.play(),b.volume=c,b}hasClip(e){return this.clips.has(e)}async playClip(e){this.hasClip(e)&&await this.clips.get(e).play()}async playClipThrough(e){this.hasClip(e)&&await this.clips.get(e).playThrough()}stopClip(e){this.hasClip(e)&&this.clips.get(e).stop()}getUser(e){return this.users.get(e)}getClip(e){return this.clips.get(e)}removeSource(e,r){let i=e.get(r);return _(i)&&(e.delete(r),i.dispose()),i}removeUser(e){let r=this.removeSource(this.users,e);_(r.input)&&(r.input=null)}removeClip(e){let r=this.clipPaths.get(e);return this.pathCounts.set(r,this.pathCounts.get(r)-1),this.pathCounts.get(r)===0&&(this.pathCounts.delete(r),this.pathSources.delete(r)),this.removeSource(this.clips,e)}setUserStream(e,r,i){if(this.users.has(e)){let o=this.users.get(e);i?o.input=this.createSourceFromStream(Zn(r,e),i):_(o.input)&&(o.input=null)}}setAudioProperties(e,r,i){this._minDistance=e,this._maxDistance=r,this._algorithm=i,Ue.instance(this.audioCtx).setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let o of this.users.values())o.spatializer.setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let o of this.clips.values())o.spatializer.setAudioProperties(o.spatializer.minDistance,o.spatializer.maxDistance,this.algorithm)}withPose(e,r,i){let o=e.get(r),s=null;return o?s=o.pose:r===this.localUserID&&(s=this.audioDestination.pose),s?i(s):null}withUser(e,r){return this.withPose(this.users,e,r)}setUserPose(e,r,i,o,s,p,c,u,h,x){this.withUser(e,b=>{b.set(r,i,o,s,p,c,u,h,x)})}withClip(e,r){return this.withPose(this.clips,e,r)}setClipPosition(e,r,i,o){this.withClip(e,s=>{s.setPosition(r,i,o)})}setClipOrientation(e,r,i,o,s,p,c){this.withClip(e,u=>{u.setOrientation(r,i,o,s,p,c)})}setClipPose(e,r,i,o,s,p,c,u,h,x){this.withClip(e,b=>{b.set(r,i,o,s,p,c,u,h,x)})}};function bu(n,...t){n.splice(0,n.length,...t)}var Ql=class extends It{constructor(t,e){super(t,e)}},Qr=class extends Ql{constructor(t){super("loading",t)}};var Es=class extends Vt{constructor(e){super("JuniperAudioPlayer",e,Ue.instance(e));this._data=null;this._loaded=!1;this.sourcesByURL=new Map;this.sources=new Array;this.potatoes=new Array;this.element=$n(hn(!0),mn(!1),Dr(!1),Wn(!0)),this.input=tr("JuniperAudioPlayer-Input",e,this.element),this.loadingEvt=new Qr(this),this.loadEvt=new An(this),this.playEvt=new _n(this),this.pauseEvt=new bn(this),this.stopEvt=new yn(this),this.progEvt=new En(this),this.onPlay=async()=>{this.connect(),this.dispatchEvent(this.playEvt)},this.onPause=r=>{this.disconnect(),this.element.currentTime===0||r.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)},this.onTimeUpdate=async()=>{this.progEvt.value=this.element.currentTime,this.progEvt.total=this.element.duration,this.dispatchEvent(this.progEvt)},this.onError=()=>this.loadAudio(),this.element.addEventListener("play",this.onPlay),this.element.addEventListener("pause",this.onPause),this.element.addEventListener("ended",this.onPause),this.element.addEventListener("error",this.onError),this.element.addEventListener("waiting",this.onWaiting),this.element.addEventListener("canplay",this.onCanPlay),this.element.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{audioPlayer:this})}get data(){return this._data}get loaded(){return this._loaded}get title(){return this.element.title}setTitle(e){this.element.title=e}get hasAudio(){let e=this.sourcesByURL.get(this.element.src);return _(e)&&e.acodec!=="none"||_(this.element.audioTracks)&&this.element.audioTracks.length>0||_(this.element.webkitAudioDecodedByteCount)&&this.element.webkitAudioDecodedByteCount>0||_(this.element.mozHasAudio)&&this.element.mozHasAudio}onDisposing(){super.onDisposing(),this.clear(),te(this.input),te(this.audioSource),this.element.removeEventListener("play",this.onPlay),this.element.removeEventListener("pause",this.onPause),this.element.removeEventListener("ended",this.onPause),this.element.removeEventListener("error",this.onError),this.element.removeEventListener("waiting",this.onWaiting),this.element.removeEventListener("canplay",this.onCanPlay),this.element.removeEventListener("timeupdate",this.onTimeUpdate)}clear(){this.stop(),this.sourcesByURL.clear(),le(this.sources),le(this.potatoes),this.element.src="",this._data=null,this._loaded=!1}async load(e,r){this.clear(),this._data=e,ae(e)?(this.setTitle(e),this.potatoes.push(e)):(this.setTitle(e.title),er(e.audios,i=>-i.resolution),bu(this.sources,...e.audios));for(let i of this.sources)this.sourcesByURL.set(i.url,i);if(!this.hasSources)throw new Error("No audio sources");if(this.dispatchEvent(this.loadingEvt),await this.loadAudio(r),!this.hasSources)throw new Error("No audio sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}async getMediaCapabilities(e){let r={type:"file",audio:{contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr}};try{return await navigator.mediaCapabilities.decodingInfo(r)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:r}}}get hasSources(){return this.sources.length>0||this.potatoes.length>0}async loadAudio(e){for(_(e)&&e.start(),this.element.removeEventListener("error",this.onError);this.hasSources;){let r=null,i=this.sources.shift();if(_(i)){let o=await this.getMediaCapabilities(i);if(!o.smooth||!o.powerEfficient){this.potatoes.push(i.url);continue}else r=i.url}else r=this.potatoes.shift();if(this.element.src=r,this.element.load(),await es(this.element)){_(i)?this.sources.unshift(i):this.potatoes.unshift(r),this.element.addEventListener("error",this.onError),_(e)&&e.end();return}}}get playbackState(){return B(this.data)?"empty":this.loaded?this.element.error?"errored":this.element.ended||this.element.paused&&this.element.currentTime===0?"stopped":this.element.paused?"paused":"playing":"loading"}async play(){await Rt(this.audioCtx),await this.element.play()}async playThrough(){let e=Le(this,"stopped");await this.play(),await e}pause(){this.element.pause()}stop(){this.pause(),this.element.currentTime=0}restart(){return this.stop(),this.play()}};var $i="HTMLCanvasElement"in globalThis,ey="HTMLImageElement"in globalThis,yu=!1,ql=!yu&&"OffscreenCanvas"in globalThis,Gv=!yu&&"createImageBitmap"in globalThis;function Jt(n){return $i&&n instanceof HTMLCanvasElement}function Eu(n){return ql&&n instanceof OffscreenCanvas}function wu(n){return Gv&&n instanceof ImageBitmap}function Su(n){return n instanceof ImageData}function Mu(n,t){let e=n.getContext("2d");if(B(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function Tu(n,t){let e=n.getContext("2d");if(B(e))throw new Error("Could not create 2d context for canvas");e.putImageData(t,0,0)}function Uv(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var Kl=ql&&Uv(),qr=Kl&&Yl||$i&&Ss||null,ws=$i?Ss:qr;function jv(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var ty=ql&&jv();function Yl(n,t){return new OffscreenCanvas(n,t)}function Ss(n,t){return wd(Jc(n),Kc(t))}function Wv(n){let t=Yl(n.width,n.height);return Mu(t,n),t}function Qv(n){let t=Ss(n.width,n.height);return Mu(t,n),t}var Cu=Kl&&Wv||$i&&Qv||null;function qv(n){let t=Yl(n.width,n.height);return Tu(t,n),t}function Kv(n){let t=Ss(n.width,n.height);return Tu(t,n),t}var Pu=Kl&&qv||$i&&Kv||null;function Ru(n,t,e,r=1){return t=Math.floor(t*r),e=Math.floor(e*r),n.width!=t||n.height!=e?(n.width=t,n.height=e,!0):!1}function Yv(n){return _(n.textBaseline)}function Jv(n,t,e,r=1){let i=n.imageSmoothingEnabled,o=n.textBaseline,s=n.textAlign,p=n.font,c=Ru(n.canvas,t,e,r);return c&&(n.imageSmoothingEnabled=i,n.textBaseline=o,n.textAlign=s,n.font=p),c}function Jl(n,t,e,r=1){return Yv(n)?Jv(n,t,e,r):Ru(n.canvas,t,e,r)}var Vu=/([^\/]+)\/(.+)/,$v=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/,nr=class{constructor(t,e,r){this._type=t;this._fullSubType=e;this._primaryExtension=null;this.depMessage=null;let i=new Map;this._parameters=i;let o=this._fullSubType.match($v);this._tree=o[1],this._subType=o[2],this._suffix=o[3];let s=o[4];if(this._value=this._fullValue=this._type+"/",_(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,_(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),_(s)){let p=s.split(";").map(c=>c.trim()).filter(c=>c.length>0).map(c=>c.split("="));for(let[c,...u]of p){let h=u.join("=");i.set(c,h);let x=`; ${c}=${h}`;this._fullValue+=x,c!=="q"&&(this._value+=x)}}this._extensions=r||[],this._primaryExtension=this._extensions[0]||null}static parse(t){if(!t)return null;let e=t.match(Vu);if(!e)return null;let r=e[1],i=e[2];return new nr(r,i)}deprecate(t){return this.depMessage=t,this}check(){_(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(t){if(B(t))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let e=null,r=null;if(ae(t)){let i=t.match(Vu);if(!i)return!1;e=i[1],r=i[2]}else e=t.typeName,r=t._fullSubType;return this.typeName===e&&(this._fullSubType==="*"||this._fullSubType===r)}withParameter(t,e){let r=`${this._fullSubType}; ${t}=${e}`;return new nr(this.typeName,r,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}addExtension(t){if(!t)throw new Error("File name is not defined");if(this.primaryExtension){let e=t.lastIndexOf(".");if(e>-1){let r=t.substring(e+1);this.extensions.indexOf(r)>-1&&(t=t.substring(0,e))}t=`${t}.${this.primaryExtension}`}return t}};function Zv(n,t,...e){return new nr(n,t,e)}function je(n){return Zv.bind(null,n)}var eg=je("audio");var Kr=eg("mpeg","mp3","mp2","mp2a","mpga","m2a","m3a");var tg=je("image");var Iu=tg("png","png");var Lu=je("model");var Ms=Lu("gltf-binary","glb"),Du=Lu("gltf+json","gltf");var ng=je("video");var Ou=ng("vnd.mpeg.dash.mpd","mpd");var $l=class{constructor(t,e){this.path=t;this.type=e;this._result=null;this._error=null;this._started=!1;this._finished=!1;this.resolve=null;this.reject=null;this.promise=new Promise((r,i)=>{this.resolve=o=>{this._result=o,this._finished=!0,r(o)},this.reject=o=>{this._error=o,this._finished=!0,i(o)}})}get result(){if(_(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}async getSize(t){try{let{contentLength:e}=await t.head(this.path).accept(this.type).exec();return[this,e||1]}catch(e){return console.warn(e),[this,1]}}async fetch(t,e){try{let r=await this.getResult(t,e);this.resolve(r)}catch(r){this.reject(r)}}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};function Zi(n){return _(n)&&Z(n.then)&&Z(n.catch)&&Z(n.finally)&&Z(n.fetch)&&Z(n.getSize)}var Yr=class extends $l{constructor(e,r,i){let o;$e(r)?i=r:o=r;super(e,o);this.useCache=!!i}async getResult(e,r){return(await this.getRequest(e,r)).content}getRequest(e,r){let i=e.get(this.path).useCache(this.useCache).progress(r);return this.getResponse(i)}},wn=class extends Yr{getResponse(t){return t.audio(!1,!1,this.type)}};var Ts=class extends Yr{getResponse(t){return t.image(this.type)}};var Sn=2*Math.PI;function Mn(n){return(n%Sn+Sn)%Sn}function Tn(n,t,e){return Math.min(e,Math.max(t,n))}function et(n){return n*Sn/360}function Zl(n){return n*360/Sn}function ku(n,t,e){return(1-e)*n+e*t}function ep(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function Bu(n){return Math.abs(n)>1e-4?n:0}var Cn=class extends ${constructor(e,r,i){super();this._scale=250;this._visible=!0;this.wasVisible=null;this.redrawnEvt=new q("redrawn");this.element=null;_(i)&&_(i.scale)&&(this._scale=i.scale),this._canvas=ws(e,r),this._g=this.canvas.getContext("2d"),Jt(this._canvas)&&(this.element=this._canvas)}fillRect(e,r,i,o,s,p){this.g.fillStyle=e,this.g.fillRect(r+p,i+p,o-2*p,s-2*p)}drawText(e,r,i,o){this.g.textAlign=o,this.g.strokeText(e,r,i),this.g.fillText(e,r,i)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(e){this.scale!==e&&(this._scale=e,this.redraw())}get visible(){return this._visible}set visible(e){this.visible!==e&&(this.wasVisible=this._visible,this._visible=e,this.redraw())}};var Cs=class extends Cn{constructor(){super(128,128);this._pitch=0;this._heading=0;this.redraw()}get pitch(){return this._pitch}set pitch(e){e!==this.pitch&&(this._pitch=e,this.redraw())}get heading(){return this._heading}set heading(e){e!==this.heading&&(this._heading=e,this.redraw())}setPitchAndHeading(e,r){(e!==this.pitch||r!==this.heading)&&(this._pitch=e,this._heading=r,this.redraw())}onRedraw(){let e=et(this.pitch),r=et(this.heading-180),i=5,o=this.canvas.width-2*i,s=this.canvas.height-2*i,p=.5*o,c=.5*s,u=Math.sin(e),h=this.g;return h.save(),h.clearRect(0,0,this.canvas.width,this.canvas.height),h.translate(i,i),h.scale(p,c),h.translate(1,1),h.fillStyle="#808080",h.beginPath(),h.arc(0,0,1,0,2*Math.PI),h.fill(),h.fillStyle="#d0d0d0",h.beginPath(),h.arc(0,0,1,0,Math.PI,!0),h.fill(),h.save(),h.scale(1,Math.abs(u)),u<0&&(h.fillStyle="#808080"),h.beginPath(),h.arc(0,0,1,0,Math.PI,u<0),h.fill(),h.restore(),h.save(),h.shadowColor="#404040",h.shadowBlur=4,h.shadowOffsetX=3,h.shadowOffsetY=3,h.rotate(r),h.fillStyle="#ff0000",h.beginPath(),h.moveTo(-.1,0),h.lineTo(0,.667),h.lineTo(.1,0),h.closePath(),h.fill(),h.fillStyle="#ffffff",h.beginPath(),h.moveTo(-.1,0),h.lineTo(0,-.667),h.lineTo(.1,0),h.closePath(),h.fill(),h.restore(),h.beginPath(),h.strokeStyle="#000000",h.lineWidth=.1,h.arc(0,0,1,0,2*Math.PI),h.stroke(),h.restore(),!0}};var oE=At("juniper::loadedFonts",()=>[]);function Ps(n){let t=[];return n.fontStyle&&n.fontStyle!=="normal"&&t.push(n.fontStyle),n.fontVariant&&n.fontVariant!=="normal"&&t.push(n.fontVariant),n.fontWeight&&n.fontWeight!=="normal"&&t.push(n.fontWeight),t.push(`${n.fontSize}px`),t.push(n.fontFamily),t.join(" ")}function Fu(n){return"getBattery"in n}var rg=["","N/A","charging"],Jr=class extends Cn{constructor(){super(256,128);this.battery=null;this.lastChargeDirection=null;this.lastLevel=null;this.chargeDirection=0;this.level=.5;Fu(navigator)?this.readBattery(navigator):this.redraw()}onRedraw(){this.battery?(this.chargeDirection=this.battery.charging?1:-1,this.level=this.battery.level):(this.level+=.1,this.level>1&&(this.level=0));let e=this.chargeDirection!==this.lastChargeDirection,r=this.level!==this.lastLevel;if(!e&&!r)return!1;this.lastChargeDirection=this.chargeDirection,this.lastLevel=this.level;let i=this.level<.1?"red":"#ccc",o=7,s=.7,p=(1-s)/2,c=this.canvas.width-2*o,u=c-4*o,h=this.canvas.height-4*o,x=c/2,b=this.canvas.height/2,E=rg[this.chargeDirection+1];return this.g.clearRect(0,0,c,this.canvas.height),this.g.save(),this.g.translate(p*this.canvas.width,p*this.canvas.height),this.g.globalAlpha=.75,this.g.scale(s,s),this.fillRect("#ccc",0,0,c,this.canvas.height,0),this.fillRect("#ccc",c,b-2*o-10,o+10,4*o+20,0),this.g.clearRect(o,o,c-2*o,this.canvas.height-2*o),this.fillRect("black",o,o,c-2*o,this.canvas.height-2*o,0),this.g.clearRect(2*o,2*o,u*this.level,h),this.fillRect(i,2*o,2*o,u*this.level,h,0),this.g.fillStyle="white",this.g.strokeStyle="black",this.g.lineWidth=4,this.g.textBaseline="middle",this.g.font=Ps({fontSize:h/2,fontFamily:"Lato"}),this.drawText(E,x,b,"center"),this.g.restore(),!0}async readBattery(e){let r=this.redraw.bind(this);r(),this.battery=await e.getBattery(),this.battery.addEventListener("chargingchange",r),this.battery.addEventListener("levelchange",r),setInterval(r,1e3),r()}};Jr.isAvailable=Fu(navigator);var $t=class extends Cn{constructor(e){super(10,10,e);this.trueWidth=null;this.trueHeight=null;this.trueFontSize=null;this.dx=null;this._minWidth=null;this._maxWidth=null;this._minHeight=null;this._maxHeight=null;this._freezeDimensions=!1;this._dimensionsFrozen=!1;this._bgFillColor=null;this._bgStrokeColor=null;this._bgStrokeSize=null;this._textStrokeColor=null;this._textStrokeSize=null;this._textFillColor="black";this._textDirection="horizontal";this._wrapWords=!0;this._fontStyle="normal";this._fontVariant="normal";this._fontWeight="normal";this._fontFamily="sans-serif";this._fontSize=20;this._value=null;_(e)&&(_(e.minWidth)&&(this._minWidth=e.minWidth),_(e.maxWidth)&&(this._maxWidth=e.maxWidth),_(e.minHeight)&&(this._minHeight=e.minHeight),_(e.maxHeight)&&(this._maxHeight=e.maxHeight),_(e.freezeDimensions)&&(this._freezeDimensions=e.freezeDimensions),_(e.textStrokeColor)&&(this._textStrokeColor=e.textStrokeColor),_(e.textStrokeSize)&&(this._textStrokeSize=e.textStrokeSize),_(e.bgFillColor)&&(this._bgFillColor=e.bgFillColor),_(e.bgStrokeColor)&&(this._bgStrokeColor=e.bgStrokeColor),_(e.bgStrokeSize)&&(this._bgStrokeSize=e.bgStrokeSize),_(e.value)&&(this._value=e.value),_(e.textFillColor)&&(this._textFillColor=e.textFillColor),_(e.textDirection)&&(this._textDirection=e.textDirection),_(e.wrapWords)&&(this._wrapWords=e.wrapWords),_(e.fontStyle)&&(this._fontStyle=e.fontStyle),_(e.fontVariant)&&(this._fontVariant=e.fontVariant),_(e.fontWeight)&&(this._fontWeight=e.fontWeight),_(e.fontFamily)&&(this._fontFamily=e.fontFamily),_(e.fontSize)&&(this._fontSize=e.fontSize),_(e.padding)&&(we(e.padding)?this._padding={left:e.padding,right:e.padding,top:e.padding,bottom:e.padding}:this._padding=e.padding)),B(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(e){this.minWidth!==e&&(this._minWidth=e,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(e){this.maxWidth!==e&&(this._maxWidth=e,this.redraw())}get minHeight(){return this._minHeight}set minHeight(e){this.minHeight!==e&&(this._minHeight=e,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(e){this.maxHeight!==e&&(this._maxHeight=e,this.redraw())}get padding(){return this._padding}set padding(e){if(e instanceof Array)throw new Error("Invalid padding");(this.padding.top!==e.top||this.padding.right!=e.right||this.padding.bottom!=e.bottom||this.padding.left!=e.left)&&(this._padding=e,this.redraw())}get wrapWords(){return this._wrapWords}set wrapWords(e){this.wrapWords!==e&&(this._wrapWords=e,this.redraw())}get textDirection(){return this._textDirection}set textDirection(e){this.textDirection!==e&&(this._textDirection=e,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(e){this.fontStyle!==e&&(this._fontStyle=e,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(e){this.fontVariant!==e&&(this._fontVariant=e,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(e){this.fontWeight!==e&&(this._fontWeight=e,this.redraw())}get fontSize(){return this._fontSize}set fontSize(e){this.fontSize!==e&&(this._fontSize=e,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(e){this.textFillColor!==e&&(this._textFillColor=e,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(e){this.textStrokeColor!==e&&(this._textStrokeColor=e,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(e){this.textStrokeSize!==e&&(this._textStrokeSize=e,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(e){this.bgFillColor!==e&&(this._bgFillColor=e,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(e){this.bgStrokeColor!==e&&(this._bgStrokeColor=e,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(e){this.bgStrokeSize!==e&&(this._bgStrokeSize=e,this.redraw())}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.redraw())}split(e){return this.wrapWords?e.split(" ").join(`
`).replace(/\r\n/,`
`).split(`
`):e.replace(/\r\n/,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value){let e=this.split(this.value),r=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let o=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,s=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,p=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,c=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,u=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,h=r?c:s,x=r?u:p,b=r?s:c,E=r?p:u,R=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let P=!1,T=!1,D=1e4,O=0;this.trueFontSize=Tn(this.fontSize*this.scale,O,D);let I=null,X=Number.MAX_VALUE;do{let F=this.fontSize;this._fontSize=this.trueFontSize;let ie=Ps(this);this._fontSize=F,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=ie,this.trueWidth=0,this.trueHeight=0;for(let oe of e){let W=this.g.measureText(oe);this.trueWidth=Math.max(this.trueWidth,W.width),this.trueHeight+=this.trueFontSize,we(W.actualBoundingBoxLeft)&&we(W.actualBoundingBoxRight)&&we(W.actualBoundingBoxAscent)&&we(W.actualBoundingBoxDescent)&&(o||(this.trueWidth=W.actualBoundingBoxLeft+W.actualBoundingBoxRight,this.trueHeight=W.actualBoundingBoxAscent+W.actualBoundingBoxDescent,this.dx=(W.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(o){let oe=this.trueWidth-h,W=this.trueWidth-x,re=this.trueHeight-b,Ee=this.trueHeight-E,ve=Math.abs(oe),se=Math.abs(W),nt=Math.abs(re),Vr=Math.abs(Ee);P=W>1||Ee>1,T=oe<-1&&re<-1;let dn=Math.min(ve,Math.min(se,Math.min(nt,Vr)));dn<X&&(X=dn,I=this.g.font),(P||T)&&R.indexOf(this.g.font)>-1&&I&&(this.g.font=I,P=!1,T=!1),P?(D=this.trueFontSize,this.trueFontSize=(O+this.trueFontSize)/2):T&&(O=this.trueFontSize,this.trueFontSize=(this.trueFontSize+D)/2)}R.push(this.g.font)}while(P||T);o&&(this.trueWidth<h?this.trueWidth=h:this.trueWidth>x&&(this.trueWidth=x),this.trueHeight<b?this.trueHeight=b:this.trueHeight>E&&(this.trueHeight=E));let z=this.trueWidth+this.scale*(this.padding.right+this.padding.left),V=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{Jl(this.g,z,V)}catch(F){throw console.error(F),F}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let i=.5*(e.length-1);for(let o=0;o<e.length;++o){let s=e[o],p=(o-i)*this.trueFontSize,c=this.dx+this.trueWidth/2+this.scale*this.padding.left,u=p+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(s,c,u),this.textFillColor&&this.g.fillText(s,c,u)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let o=this.bgStrokeSize/2;this.g.strokeRect(o,o,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(r){let o=qr(this.canvas.height,this.canvas.width),s=o.getContext("2d");s?(s.translate(o.width/2,o.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?s.rotate(Math.PI/2):this.textDirection==="vertical-right"&&s.rotate(-Math.PI/2),s.translate(-this.canvas.width/2,-this.canvas.height/2),s.drawImage(this.canvas,0,0),Jl(this.g,o.width,o.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(o,0,0)}return!0}else return!1}};var Rs=class extends $t{constructor(){super({textFillColor:"#ffffff",textStrokeColor:"rgba(0, 0, 0, 0.5)",textStrokeSize:.025,fontFamily:fd(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,wrapWords:!1,freezeDimensions:!0});this.fps=null;this.drawCalls=null;this.triangles=null;let e=this.update.bind(this);setInterval(e,500),e()}setStats(e,r,i){this.fps=e,this.drawCalls=r,this.triangles=i}update(){let r=new Date().toLocaleTimeString();this.fps!==null&&(r+=` ${Math.round(this.fps).toFixed(0)}hz ${this.drawCalls}c ${this.triangles}t`),(B(this.value)||r.length!==this.value.length)&&this.unfreeze(),this.value=r}};var Nu="local-user";function Xu(n,t){return n==="click"&&t&&(n="error"),`InteractionAudio-${n}`}var Vs=class{constructor(t,e){this.audio=t;this.eventSys=e;let r=i=>{if(i.rayTarget&&i.rayTarget.clickable){let o=Xu(i.type,!i.rayTarget.enabled);if(this.audio.hasClip(o)){let{x:s,y:p,z:c}=i.point;this.audio.setClipPosition(o,s,p,c),this.audio.playClip(o)}}};this.eventSys.addEventListener("enter",r),this.eventSys.addEventListener("exit",r),this.eventSys.addEventListener("click",r)}create(t,e,r){return this.audio.createClip(Xu(t,!1),e,!1,!0,!1,r,[])}};var{ACESFilmicToneMapping:wE,AddEquation:SE,AddOperation:ME,AdditiveAnimationBlendMode:TE,AdditiveBlending:CE,AlphaFormat:PE,AlwaysDepth:RE,AlwaysStencilFunc:VE,AmbientLight:zu,AmbientLightProbe:IE,AnimationClip:Hu,AnimationLoader:LE,AnimationMixer:DE,AnimationObjectGroup:OE,AnimationUtils:kE,ArcCurve:BE,ArrayCamera:FE,ArrowHelper:NE,Audio:XE,AudioAnalyser:zE,AudioContext:HE,AudioListener:GE,AudioLoader:UE,AxesHelper:jE,BackSide:Gu,BasicDepthPacking:WE,BasicShadowMap:QE,Bone:Uu,BooleanKeyframeTrack:qE,Box2:KE,Box3:rr,Box3Helper:YE,BoxBufferGeometry:ju,BoxGeometry:Wu,BoxHelper:JE,BufferAttribute:ir,BufferGeometry:Is,BufferGeometryLoader:$E,ByteType:ZE,Cache:e2,Camera:t2,CameraHelper:n2,CanvasTexture:Qu,CapsuleBufferGeometry:r2,CapsuleGeometry:i2,CatmullRomCurve3:o2,CineonToneMapping:s2,CircleBufferGeometry:a2,CircleGeometry:l2,ClampToEdgeWrapping:qu,Clock:p2,Color:be,ColorKeyframeTrack:c2,ColorManagement:d2,CompressedTexture:u2,CompressedTextureLoader:m2,ConeBufferGeometry:h2,ConeGeometry:f2,CubeCamera:Ku,CubeReflectionMapping:x2,CubeRefractionMapping:v2,CubeTexture:Yu,CubeTextureLoader:g2,CubeUVReflectionMapping:A2,CubicBezierCurve:_2,CubicBezierCurve3:b2,CubicInterpolant:y2,CullFaceBack:E2,CullFaceFront:w2,CullFaceFrontBack:S2,CullFaceNone:M2,Curve:T2,CurvePath:C2,CustomBlending:P2,CustomToneMapping:R2,CylinderBufferGeometry:V2,CylinderGeometry:Ju,Cylindrical:I2,Data3DTexture:L2,DataArrayTexture:D2,DataTexture:O2,DataTexture2DArray:k2,DataTexture3D:B2,DataTextureLoader:F2,DataUtils:N2,DecrementStencilOp:X2,DecrementWrapStencilOp:z2,DefaultLoadingManager:H2,DepthFormat:G2,DepthStencilFormat:U2,DepthTexture:j2,DirectionalLight:Ls,DirectionalLightHelper:W2,DiscreteInterpolant:Q2,DodecahedronBufferGeometry:q2,DodecahedronGeometry:K2,DoubleSide:$u,DstAlphaFactor:Y2,DstColorFactor:J2,DynamicCopyUsage:$2,DynamicDrawUsage:Zu,DynamicReadUsage:Z2,EdgesGeometry:ew,EllipseCurve:tw,EqualDepth:nw,EqualStencilFunc:rw,EquirectangularReflectionMapping:iw,EquirectangularRefractionMapping:ow,Euler:em,EventDispatcher:sw,ExtrudeBufferGeometry:aw,ExtrudeGeometry:lw,FileLoader:tp,FlatShading:pw,Float16BufferAttribute:cw,Float32BufferAttribute:np,Float64BufferAttribute:dw,FloatType:uw,Fog:mw,FogExp2:hw,Font:fw,FontLoader:xw,FramebufferTexture:vw,FrontSide:Ds,Frustum:gw,GLBufferAttribute:Aw,GLSL1:_w,GLSL3:bw,GreaterDepth:yw,GreaterEqualDepth:Ew,GreaterEqualStencilFunc:ww,GreaterStencilFunc:Sw,GridHelper:tm,Group:Os,HalfFloatType:Mw,HemisphereLight:Tw,HemisphereLightHelper:Cw,HemisphereLightProbe:Pw,IcosahedronBufferGeometry:Rw,IcosahedronGeometry:Vw,ImageBitmapLoader:nm,ImageLoader:Iw,ImageUtils:Lw,ImmediateRenderObject:Dw,IncrementStencilOp:Ow,IncrementWrapStencilOp:kw,InstancedBufferAttribute:Bw,InstancedBufferGeometry:rm,InstancedInterleavedBuffer:eo,InstancedMesh:im,Int16BufferAttribute:Fw,Int32BufferAttribute:Nw,Int8BufferAttribute:Xw,IntType:zw,InterleavedBuffer:om,InterleavedBufferAttribute:Ot,Interpolant:sm,InterpolateDiscrete:am,InterpolateLinear:rp,InterpolateSmooth:Hw,InvertStencilOp:Gw,KeepStencilOp:Uw,KeyframeTrack:jw,LOD:Ww,LatheBufferGeometry:Qw,LatheGeometry:qw,Layers:Kw,LessDepth:Yw,LessEqualDepth:Jw,LessEqualStencilFunc:$w,LessStencilFunc:Zw,Light:eS,LightProbe:tS,Line:lm,Line3:pm,LineBasicMaterial:ip,LineCurve:nS,LineCurve3:rS,LineDashedMaterial:iS,LineLoop:cm,LineSegments:dm,LinearEncoding:oS,LinearFilter:op,LinearInterpolant:sS,LinearMipMapLinearFilter:aS,LinearMipMapNearestFilter:lS,LinearMipmapLinearFilter:sp,LinearMipmapNearestFilter:um,LinearSRGBColorSpace:pS,LinearToneMapping:cS,Loader:mm,LoaderUtils:Pn,LoadingManager:dS,LoopOnce:uS,LoopPingPong:mS,LoopRepeat:hS,LuminanceAlphaFormat:fS,LuminanceFormat:xS,MOUSE:vS,Material:ks,MaterialLoader:gS,MathUtils:Bs,Matrix3:AS,Matrix4:Oe,MaxEquation:_S,Mesh:yt,MeshBasicMaterial:qe,MeshDepthMaterial:bS,MeshDistanceMaterial:yS,MeshLambertMaterial:ES,MeshMatcapMaterial:wS,MeshNormalMaterial:SS,MeshPhongMaterial:hm,MeshPhysicalMaterial:or,MeshStandardMaterial:$r,MeshToonMaterial:MS,MinEquation:TS,MirroredRepeatWrapping:fm,MixOperation:CS,MultiplyBlending:PS,MultiplyOperation:RS,NearestFilter:xm,NearestMipMapLinearFilter:VS,NearestMipMapNearestFilter:IS,NearestMipmapLinearFilter:vm,NearestMipmapNearestFilter:gm,NeverDepth:LS,NeverStencilFunc:DS,NoBlending:OS,NoColorSpace:kS,NoToneMapping:BS,NormalAnimationBlendMode:FS,NormalBlending:NS,NotEqualDepth:XS,NotEqualStencilFunc:zS,NumberKeyframeTrack:Am,Object3D:We,ObjectLoader:HS,ObjectSpaceNormalMap:GS,OctahedronBufferGeometry:US,OctahedronGeometry:jS,OneFactor:WS,OneMinusDstAlphaFactor:QS,OneMinusDstColorFactor:qS,OneMinusSrcAlphaFactor:KS,OneMinusSrcColorFactor:YS,OrthographicCamera:_m,PCFShadowMap:JS,PCFSoftShadowMap:$S,PMREMGenerator:ZS,ParametricGeometry:eM,Path:tM,PerspectiveCamera:to,Plane:nM,PlaneBufferGeometry:Fs,PlaneGeometry:rM,PlaneHelper:iM,PointLight:bm,PointLightHelper:oM,Points:ym,PointsMaterial:Em,PolarGridHelper:sM,PolyhedronBufferGeometry:aM,PolyhedronGeometry:lM,PositionalAudio:pM,PropertyBinding:wm,PropertyMixer:cM,QuadraticBezierCurve:dM,QuadraticBezierCurve3:uM,Quaternion:ce,QuaternionKeyframeTrack:ap,QuaternionLinearInterpolant:mM,REVISION:hM,RGBADepthPacking:fM,RGBAFormat:xM,RGBAIntegerFormat:vM,RGBA_ASTC_10x10_Format:gM,RGBA_ASTC_10x5_Format:AM,RGBA_ASTC_10x6_Format:_M,RGBA_ASTC_10x8_Format:bM,RGBA_ASTC_12x10_Format:yM,RGBA_ASTC_12x12_Format:EM,RGBA_ASTC_4x4_Format:wM,RGBA_ASTC_5x4_Format:SM,RGBA_ASTC_5x5_Format:MM,RGBA_ASTC_6x5_Format:TM,RGBA_ASTC_6x6_Format:CM,RGBA_ASTC_8x5_Format:PM,RGBA_ASTC_8x6_Format:RM,RGBA_ASTC_8x8_Format:VM,RGBA_BPTC_Format:IM,RGBA_ETC2_EAC_Format:LM,RGBA_PVRTC_2BPPV1_Format:DM,RGBA_PVRTC_4BPPV1_Format:OM,RGBA_S3TC_DXT1_Format:kM,RGBA_S3TC_DXT3_Format:BM,RGBA_S3TC_DXT5_Format:FM,RGBFormat:NM,RGB_ETC1_Format:XM,RGB_ETC2_Format:zM,RGB_PVRTC_2BPPV1_Format:HM,RGB_PVRTC_4BPPV1_Format:GM,RGB_S3TC_DXT1_Format:UM,RGFormat:jM,RGIntegerFormat:WM,RawShaderMaterial:QM,Ray:qM,Raycaster:Sm,RectAreaLight:KM,RedFormat:YM,RedIntegerFormat:JM,ReinhardToneMapping:$M,RepeatWrapping:Ns,ReplaceStencilOp:ZM,ReverseSubtractEquation:eT,RingBufferGeometry:tT,RingGeometry:nT,SRGBColorSpace:rT,Scene:Xs,ShaderChunk:iT,ShaderLib:no,ShaderMaterial:Mm,ShadowMaterial:oT,Shape:sT,ShapeBufferGeometry:aT,ShapeGeometry:lT,ShapePath:pT,ShapeUtils:cT,ShortType:dT,Skeleton:Tm,SkeletonHelper:uT,SkinnedMesh:Cm,SmoothShading:mT,Source:hT,Sphere:Zr,SphereBufferGeometry:fT,SphereGeometry:zs,Spherical:xT,SphericalHarmonics3:vT,SplineCurve:gT,SpotLight:Pm,SpotLightHelper:AT,Sprite:_T,SpriteMaterial:ig,SrcAlphaFactor:bT,SrcAlphaSaturateFactor:yT,SrcColorFactor:ET,StaticCopyUsage:wT,StaticDrawUsage:ST,StaticReadUsage:MT,StereoCamera:TT,StreamCopyUsage:CT,StreamDrawUsage:PT,StreamReadUsage:RT,StringKeyframeTrack:VT,SubtractEquation:IT,SubtractiveBlending:LT,TOUCH:DT,TangentSpaceNormalMap:Rm,TetrahedronBufferGeometry:OT,TetrahedronGeometry:kT,TextGeometry:BT,Texture:ro,TextureLoader:Vm,TorusBufferGeometry:FT,TorusGeometry:NT,TorusKnotBufferGeometry:XT,TorusKnotGeometry:zT,Triangle:HT,TriangleFanDrawMode:lp,TriangleStripDrawMode:Im,TrianglesDrawMode:GT,TubeBufferGeometry:UT,TubeGeometry:jT,UVMapping:WT,Uint16BufferAttribute:QT,Uint32BufferAttribute:qT,Uint8BufferAttribute:KT,Uint8ClampedBufferAttribute:YT,Uniform:JT,UniformsGroup:$T,UniformsLib:io,UniformsUtils:pp,UnsignedByteType:ZT,UnsignedInt248Type:e3,UnsignedIntType:t3,UnsignedShort4444Type:n3,UnsignedShort5551Type:r3,UnsignedShortType:i3,VSMShadowMap:o3,Vector2:Re,Vector3:k,Vector4:kt,VectorKeyframeTrack:Lm,VideoTexture:Dm,WebGL1Renderer:s3,WebGL3DRenderTarget:a3,WebGLArrayRenderTarget:l3,WebGLCubeRenderTarget:Om,WebGLMultipleRenderTargets:p3,WebGLMultisampleRenderTarget:c3,WebGLRenderTarget:d3,WebGLRenderer:km,WebGLUtils:u3,WireframeGeometry:Bm,WrapAroundEnding:m3,ZeroCurvatureEnding:h3,ZeroFactor:f3,ZeroSlopeEnding:x3,ZeroStencilOp:v3,_SRGBAFormat:g3,sRGBEncoding:Hs}=THREE;function Rn(n){return _(n)&&n.isMesh}function cp(n){return _(n)&&n.isMaterial}function og(n,t){return cp(t)&&t.type===n}function Fm(n){return og("MeshBasicMaterial",n)}function Nm(n){return _(n)&&n.isObject3D}function Xm(n){return _(n)&&n.isQuaternion}function zm(n){return _(n)&&n.isEuler}function Hm(n){return _(n)&&Nm(n.object)}function Ke(n){return Hm(n)?n.object:n}function ke(n,t){return n=Ke(n),n.visible=t,t}function ei(n){return n=Ke(n),n.visible}function Gs(n){for(n=Ke(n);n;){if(!n.visible)return!1;n=n.parent}return!0}function j(n,...t){let e=t.filter(_).map(Ke);return e.length>0&&Ke(n).add(...e),n}function de(n,...t){let e=new We;return e.name=n,j(e,...t),e}function Us(n,t){n=Ke(n),Wi(n)&&(n.disabled=!t)}function sr(n,t,e){let r=new yt(t,e);return r.name=n,r}var oo=(i=>(i.None="None",i.Fullscreen="Fullscreen",i.VR="VR",i.AR="AR",i))(oo||{});Ct(Q("#controls",Br("absolute"),qn(0),Yn(0),jt("100%"),ut("100%")),Q("#controls",Be("grid"),jo("20pt"),qo("auto 1fr auto"),Ko(1)),Q("#controls, #controls *",Cl("none")),Q("#controls canvas",ut("58px")),Q("#controls > .row",Be("grid"),fn("10px","5px"),Ut("repeat(2, auto)")),Q("#controls > .row.top",Qo(1)),Q("#controls > .row.middle",Qo(2,-2)),Q("#controls > .row.bottom",Qo(-2)),Q("#controls > .row > .cell",Be("flex")),Q("#controls > .row > .cell.left",Qn(1)),Q("#controls > .row > .cell.right",Qn(-2),id("row-reverse")),Q("#controls > .row > .cell > .btn",Zc(0),Gi("#1e4388"),ut("58px !important"),jt("58px"),Mt("0.25em"),fn("0","5px"),Cl("initial")),Q("#controls .btn img",ut("calc(100% - 0.5em)")),Q("#controls button:disabled img",rd("invert(.5)")));var js=class{constructor(){this.element=_e(Uo("controls"),_e(fe("row top"),this.topRowLeft=_e(fe("cell left")),this.topRowRight=_e(fe("cell right"))),_e(fe("row middle"),this.middleRowLeft=_e(fe("cell left")),this.middleRowRight=_e(fe("cell right"))),_e(fe("row bottom"),this.bottomRowLeft=_e(fe("cell left")),this.bottomRowRight=_e(fe("cell right")))),this.cells=[[this.topRowLeft,this.topRowRight],[this.middleRowLeft,this.middleRowRight],[this.bottomRowLeft,this.bottomRowRight]]}};function Gm(n){return"height"in n}function Um(n){return"width"in n}var dp=1.25,jm=et(30),sg=et(32),ag=new k(0,0,0),Ws=class extends We{constructor(){super(),this.name="SpaceUI",this.position.y=-.25}addItem(t,e){t=Ke(t),j(this,t),t.position.set(dp*Math.sin(e.x*jm),dp*Math.sin(e.y*sg),-dp*Math.cos(e.x*jm)),Gm(e)&&Um(e)?t.scale.set(e.width,e.height,1):Gm(e)?t.scale.multiplyScalar(e.height/t.scale.y):Um(e)?t.scale.multiplyScalar(e.width/t.scale.x):t.scale.setScalar(e.scale),t.scale.z=1;for(let r of this.children)r.lookAt(ag)}};var Vn=class{constructor(t){this.items=new Map;if(_(t))for(let[e,r,i]of t)this.add(e,r,i)}add(t,e,r){let i=this.items.get(t);return B(i)&&this.items.set(t,i=new Map),i.set(e,r),this}*entries(){for(let[t,e]of this.items)for(let[r,i]of e)yield[t,r,i]}keys(t){return B(t)?this.items.keys():this.items.get(t).keys()}*values(){for(let t of this.items.values())for(let e of t.values())yield e}has(t,e){return this.items.has(t)&&(B(e)||this.items.get(t).has(e))}get(t,e){return B(e)?this.items.get(t):this.items.has(t)?this.items.get(t).get(e):null}count(t){return this.items.has(t)?this.items.get(t).size:null}get size(){let t=0;for(let e of this.items.values())t+=e.size;return t}delete(t,e){return B(e)?this.items.delete(t):this.items.has(t)?this.items.get(t).delete(e):!1}clear(){this.items.clear()}};var so=class{constructor(t){this.items=new Map;this.defaultItems=new Array;if(_(t))for(let[e,r]of t)this.add(e,r)}add(t,e){if(B(t))this.defaultItems.push(e);else{let r=this.items.get(t);B(r)&&this.items.set(t,r=[]),r.push(e)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let t of this.defaultItems)yield t;for(let t of this.items.values())for(let e of t)yield e}has(t){return _(t)?this.items.has(t):this.defaultItems.length>0}get(t){return B(t)?this.defaultItems:this.items.get(t)||[]}count(t){if(B(t))return this.defaultItems.length;let e=this.get(t);return _(e)?e.length:0}get size(){let t=this.defaultItems.length;for(let e of this.items.values())t+=e.length;return t}delete(t){return B(t)?le(this.defaultItems).length>0:this.items.delete(t)}remove(t,e){if(B(t))mt(this.defaultItems,e);else{let r=this.items.get(t);_(r)&&(mt(r,e),r.length===0&&this.items.delete(t))}}clear(){this.items.clear(),le(this.defaultItems)}};var ar=class extends ${constructor(){super(...arguments);this.attached=new Array;this.soFar=null;this.total=null;this.msg=null;this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(e,r,i,o){this.soFar=e,this.total=r,this.msg=i,this.est=o;for(let s of this.attached)s.report(e,r,i,o)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(e){this.report(0,1,e||"starting")}end(e){this.report(1,1,e||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,le(this.attached)}};var ao=class extends ar{constructor(e,r){super();this.i=e;this.prog=r}report(e,r,i,o){super.report(e,r,i,o),this.prog.update(this.i,e,r,i)}};var ti=class{constructor(t){this.prog=t;this.weightTotal=0;this.subProgressCallbacks=new Array;this.subProgressWeights=new Array;this.subProgressValues=new Array;this.start=performance.now();for(let e=0;e<this.subProgressWeights.length;++e)this.subProgressValues[e]=0,this.subProgressCallbacks[e]=new ao(e,this)}addSubProgress(t){t=t||1,this.weightTotal+=t,this.subProgressWeights.push(t),this.subProgressValues.push(0);let e=new ao(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(e),e}update(t,e,r,i){if(this.prog){this.subProgressValues[t]=e/r;let o=0;for(let u=0;u<this.subProgressWeights.length;++u)o+=this.subProgressValues[u]*this.subProgressWeights[u];let s=performance.now(),p=s-this.start,c=this.start-s+p*this.weightTotal/o;this.prog.report(o,this.weightTotal,i,c)}}};function Qs(n,t){return new up(t,n).subProgressCallbacks}var up=class extends ti{constructor(t,e){super(e);for(let r of t)this.addSubProgress(r)}};async function lg(n,t){let e=new Array(t.length),r=new Array(t.length);for(let s=0;s<t.length;++s){let p=t[s];e[s]=p[0],r[s]=p[1]}let i=Qs(n,e),o=new Array(t.length);for(let s=0;s<t.length;++s)o[s]=r[s](i[s]);return await Promise.all(o)}function Wm(n,...t){let e=t.map(r=>[1,r]);return lg(n,e)}function Qm(n){return ae(n.vcodec)}var qs=class extends Vt{constructor(e){super("JuniperVideoPlayer",e,Ue.instance(e));this.onTimeUpdate=null;this.wasUsingAudioElement=!1;this.nextStartTime=null;this._data=null;this._loaded=!1;this.onError=new Map;this.sourcesByURL=new Map;this.sources=new so;this.potatoes=new so;this.video=this.createMediaElement(Id,Wn(!0)),this.audio=this.createMediaElement($n,Wn(!1)),this.input=Fe("JuniperVideoPlayer-combiner",e),this.videoSource=tr("JuniperVideoPlayer-VideoNode",e,this.video,this.input),this.audioSource=tr("JuniperVideoPlayer-AudioNode",e,this.audio,this.input),this.loadingEvt=new Qr(this),this.loadEvt=new An(this),this.playEvt=new _n(this),this.pauseEvt=new bn(this),this.stopEvt=new yn(this),this.progEvt=new En(this),this.onSeeked=()=>{this.useAudioElement&&(this.audio.currentTime=this.video.currentTime)},this.onPlay=async()=>{this.connect(),this.onSeeked(),this.useAudioElement&&(await Rt(this.audioCtx),await this.audio.play()),this.dispatchEvent(this.playEvt)},this.onPause=i=>{this.disconnect(),this.useAudioElement&&(this.onSeeked(),this.audio.pause()),this.video.currentTime===0||i.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};let r=!1;this.onWaiting=()=>{this.useAudioElement&&(r=!0,this.audio.pause())},this.onCanPlay=async()=>{this.useAudioElement&&r&&(await Rt(this.audioCtx),await this.audio.play(),r=!1)},this.wasUsingAudioElement=!1,this.onTimeUpdate=async()=>{if(this.video.getVideoPlaybackQuality().totalVideoFrames===0){let o=this.onError.get(this.video);_(o)&&await o()}else if(this.useAudioElement){this.wasUsingAudioElement=!1;let o=this.video.currentTime-this.audio.currentTime;Math.abs(o)>.25&&(this.audio.currentTime=this.video.currentTime)}else this.wasUsingAudioElement||(this.wasUsingAudioElement=!0,this.audio.pause());this.progEvt.value=this.video.currentTime,this.progEvt.total=this.video.duration,this.dispatchEvent(this.progEvt)},this.video.addEventListener("seeked",this.onSeeked),this.video.addEventListener("play",this.onPlay),this.video.addEventListener("pause",this.onPause),this.video.addEventListener("ended",this.onPause),this.video.addEventListener("waiting",this.onWaiting),this.video.addEventListener("canplay",this.onCanPlay),this.video.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{videoPlayer:this})}get data(){return this._data}get loaded(){return this._loaded}get title(){return this.video.title}setTitle(e){this.video.title=e,this.audio.title=e}elementHasAudio(e){let r=this.sourcesByURL.get(e.src);return _(r)&&r.acodec!=="none"||_(e.audioTracks)&&e.audioTracks.length>0||_(e.webkitAudioDecodedByteCount)&&e.webkitAudioDecodedByteCount>0||_(e.mozHasAudio)&&e.mozHasAudio}get useAudioElement(){return!this.elementHasAudio(this.video)&&this.elementHasAudio(this.audio)}onDisposing(){super.onDisposing(),this.clear(),te(this.input),te(this.videoSource),te(this.audioSource),this.video.removeEventListener("seeked",this.onSeeked),this.video.removeEventListener("play",this.onPlay),this.video.removeEventListener("pause",this.onPause),this.video.removeEventListener("ended",this.onPause),this.video.removeEventListener("waiting",this.onWaiting),this.video.removeEventListener("canplay",this.onCanPlay),this.video.removeEventListener("timeupdate",this.onTimeUpdate)}clear(){this.stop();for(let[e,r]of this.onError)e.removeEventListener("error",r);this.onError.clear(),this.sourcesByURL.clear(),this.sources.clear(),this.potatoes.clear(),this.video.src="",this.audio.src="",this.wasUsingAudioElement=!1,this._data=null,this._loaded=!1}async load(e,r){if(this.clear(),this._data=e,ae(e)?(this.setTitle(e),this.potatoes.add(this.video,e)):(this.setTitle(e.title),this.fillSources(this.video,e.videos),this.fillSources(this.audio,e.audios)),!this.hasSources(this.video))throw new Error("No video sources found");if(this.dispatchEvent(this.loadingEvt),await Wm(r,i=>this.loadMediaElement(this.audio,i),i=>this.loadMediaElement(this.video,i)),ae(e)?this.nextStartTime=null:this.nextStartTime=e.startTime,!this.hasSources(this.video))throw new Error("No video playable sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}fillSources(e,r){er(r,i=>-i.resolution);for(let i of r)Ou.matches(i.contentType)||(this.sources.add(e,i),this.sourcesByURL.set(i.url,i))}createMediaElement(e,...r){return e(hn(!0),mn(!1),Dr(!1),...r)}async getMediaCapabilities(e){let r={type:"file"};Qm(e)?r.video={contentType:e.contentType,bitrate:e.vbr*1024,framerate:e.fps,width:e.width,height:e.height}:e.acodec!=="none"&&(r.audio={contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr});try{return await navigator.mediaCapabilities.decodingInfo(r)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:r}}}hasSources(e){return this.sources.get(e).length>0||this.potatoes.count(e)>0}async loadMediaElement(e,r){for(_(r)&&r.start(),this.onError.has(e)&&(e.removeEventListener("error",this.onError.get(e)),this.onError.delete(e));this.hasSources(e);){let i=null,o=this.sources.get(e).shift();if(_(o)){let s=await this.getMediaCapabilities(o);if(!s.smooth||!s.powerEfficient){this.potatoes.add(e,o.url);continue}else i=o.url}else i=this.potatoes.get(e).shift();if(e.src=i,e.load(),await es(e)){_(o)?this.sources.get(e).unshift(o):this.potatoes.get(e).unshift(i);let s=()=>this.loadMediaElement(e,r);e.addEventListener("error",s),this.onError.set(e,s),this.wasUsingAudioElement=this.wasUsingAudioElement,_(r)&&r.end();return}}}get width(){return this.video.videoWidth}get height(){return this.video.videoHeight}get playbackState(){return B(this.data)?"empty":this.loaded?this.video.error?"errored":this.video.ended||this.video.paused&&this.video.currentTime===0?"stopped":this.video.paused?"paused":"playing":"loading"}async play(){await Rt(this.audioCtx),_(this.nextStartTime)&&this.nextStartTime>0&&(this.video.pause(),this.video.currentTime=this.nextStartTime,this.nextStartTime=null),await this.video.play()}async playThrough(){let e=Le(this,"stopped");await this.play(),await e}pause(){this.video.pause()}stop(){this.pause(),this.video.currentTime=0}restart(){return this.stop(),this.play()}};function qm(n,t){let e=n*Math.PI;return .5*(1-Math.cos(e))-t*Math.sin(2*e)}function Km(n,t){let e=(n-.5)*Math.PI;return n*n+t*Math.cos(e)}var lr=At("Juniper:ScaledItems",()=>new Map),Ym=1,pg=1.1,cg=.005,mp=class{constructor(t){this.target=t;this.obj=Ke(this.target),this.base=this.obj.scale.clone(),this.p=0,this.dir=0,this.running=!1,this.wasDisabled=this.disabled,this.target.addScopedEventListener(this,"enter",()=>this.run(1)),this.target.addScopedEventListener(this,"exit",()=>this.run(-1)),this.obj.traverse(e=>{Rn(e)&&this.target.addMesh(e)})}get disabled(){return this.target.disabled}run(t){(!this.disabled||t===-1||this.p>0)&&(this.dir=t,this.running=!0)}updateScaling(t){if(this.disabled!==this.wasDisabled&&(this.wasDisabled=this.disabled,this.disabled&&this.run(-1)),this.running){this.p+=this.dir*t,(this.dir>0&&this.p>=1||this.dir<0&&this.p<0)&&(this.p=Math.max(0,Math.min(1,this.p)),this.running=!1);let e=qm(this.p,1.1);this.obj.scale.copy(this.base).multiplyScalar(e*(pg-Ym)+Ym)}}dispose(){this.target.removeScope(this)}};function Jm(n){n*=cg;for(let t of lr.values())t.updateScaling(n)}function $m(n){let t=lr.get(n);t&&(lr.delete(n),t.dispose())}function Ks(n,t){let e=lr.has(n);t!=e&&(t?lr.set(n,new mp(n)):(lr.get(n).dispose(),lr.delete(n)))}function Zt(n){let t=new Array,e=new Set;for(t.push(n);t.length>0;){let r=t.shift();r&&!e.has(r)&&(e.add(r),r.isMesh&&t.push(r.material,r.geometry),r.isMaterial&&t.push(...Object.values(r)),r.isObject3D&&(t.push(...r.children),r.clear(),$m(r)),gt(r)&&t.push(...r),Nd(r))}e.clear()}function dg(n){return[eh([n[1],n[0],n[2]]),eh([n[2],n[0],n[3]])]}function nh(n){return n.map(dg).flat()}var hp=new k,Zm=new k,Ys=new k;function eh(n){let t=[[n[0][0],n[0][1],n[0][2]],[n[1][0],n[1][1],n[1][2]],[n[2][0],n[2][1],n[2][2]]],e=[[n[0][3],n[0][4]],[n[1][3],n[1][4]],[n[2][3],n[2][4]]];Ys.fromArray(t[0]),hp.fromArray(t[1]).sub(Ys),Ys.fromArray(t[2]),Zm.fromArray(t[1]).sub(Ys),hp.cross(Zm);let r=hp.toArray();return{positions:t,uvs:e,normal:r}}function rh(n){let t=n.map(o=>o.positions).flat(2),e=n.map(o=>o.uvs).flat(2),r=n.flatMap(o=>o.normal),i=new Is;return i.setAttribute("position",new ir(new Float32Array(t),3,!1)),i.setAttribute("uv",new ir(new Float32Array(e),2,!1)),i.setAttribute("normal",new ir(new Float32Array(r),3,!0)),i}function Et(...n){let t=nh(n);return rh(t)}function ni(n,...t){let e=ug(t);for(let i=0;i<n;++i)e=hg(e);t=mg(e);let r=nh(t);return rh(r)}function ug(n){return n.map(t=>{let e=Number.MAX_VALUE,r=Number.MIN_VALUE,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(let c of t){let u=c[3],h=c[4];e=Math.min(e,u),r=Math.max(r,u),i=Math.min(i,h),o=Math.max(o,h)}let s=[e,i],p=[r-e,o-i];return{minUV:s,deltaUV:p,verts:[Js(s,p,t[0]),Js(s,p,t[1]),Js(s,p,t[2]),Js(s,p,t[3])]}})}function Js(n,t,e){return{pos:[e[0],e[1],e[2]],uv:[e[3],e[4]],pUV:[(e[3]-n[0])/t[0],(e[4]-n[1])/t[1]]}}function mg(n){return n.map(t=>[$s(t,0),$s(t,1),$s(t,2),$s(t,3)])}function $s(n,t){let e=n.verts[t];return[e.pos[0],e.pos[1],e.pos[2],e.uv[0],e.uv[1]]}function hg(n){return n.flatMap(t=>{let e=lo(t,t.verts[0],t.verts[1]),r=lo(t,t.verts[2],t.verts[3]),i=lo(t,t.verts[0],t.verts[3]),o=lo(t,t.verts[1],t.verts[2]),s=lo(t,e,r);return[{minUV:t.minUV,deltaUV:t.deltaUV,verts:[t.verts[0],e,s,i]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[e,t.verts[1],o,s]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[s,o,t.verts[2],r]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[i,s,r,t.verts[3]]}]})}function lo(n,t,e){let r=e.pos[0]-t.pos[0],i=e.pos[1]-t.pos[1],o=e.pos[2]-t.pos[2],s=t.pos[0]+.5*r,p=t.pos[1]+.5*i,c=t.pos[2]+.5*o,u=e.pUV[0]-t.pUV[0],h=e.pUV[1]-t.pUV[1],x=t.pUV[0]+.5*u,b=t.pUV[1]+.5*h,E=th(x-.5)+.5,R=th(b-.5)+.5,P=E*n.deltaUV[0]+n.minUV[0],T=R*n.deltaUV[1]+n.minUV[1];return{pos:[s,p,c],pUV:[x,b],uv:[P,T]}}function th(n){return 2*Math.atan(2*n)/Math.PI}io.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Re(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};no.line={uniforms:pp.merge([io.common,io.fog,io.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var en=class extends Mm{constructor(t){super({type:"LineMaterial",uniforms:pp.clone(no.line.uniforms),vertexShader:no.line.vertexShader,fragmentShader:no.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(t)}};en.prototype.isLineMaterial=!0;var fp=At("Juniper:Three:Materials",()=>new Map);function fg(n,t){t in n&&delete n[t]}function Zs(n,t,e){let r=`${n}_${Object.keys(e).map(i=>`${i}:${e[i]}`).join(",")}`;return fp.has(r)||(fg(e,"name"),fp.set(r,new t(e))),fp.get(r)}function xg(n){return Object.assign(n,{transparent:!0})}function ih(n){return Zs("solid",qe,n)}function ri(n){return Zs("solidTransparent",qe,xg(n))}function oh(n){return Zs("lit",hm,n)}function sh(n){return Zs("line2",en,n)}function ah(n,t){let e=new Set;n.traverse(r=>{if(Rn(r)&&cp(r.material)){let i=r.material,o=t(i);i!==o&&(e.add(i),r.material=o)}});for(let r of e)r.dispose()}function lh(n){if(n.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let t={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,dithering:n.dithering,envMap:n.envMap,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.emissiveMap||n.map,name:n.name+"-Standard-To-Basic",opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,shadowSide:n.shadowSide,side:n.side,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[e,r]of Object.entries(t))B(r)&&delete t[e];return new qe(t)}var vg=12632256,xp=16777215;var ph=oh({color:vg}),ch=oh({color:xp});function dh(n,t){for(let e=0;e<n.length;++e)if(n[e]!==t[e])return e;return-1}var uh=304.79999999999995,nP=uh*3,gg=10*100,Ag=uh*16.5,_g=Ag*40,rP=gg*1e3,iP=_g*8,mh=2.54*4,hh=mh*3,oP=hh*3,bg=hh*16.5,yg=bg*40,sP=100*1e3,aP=yg*8,vp=4*3,Eg=vp*3,po=100/2.54,wg=vp*16.5,Sg=wg*40,lP=po*1e3,pP=Sg*8,cP=3*3,Mg=100/mh,Tg=3*16.5,Cg=Tg*40,dP=Mg*1e3,uP=Cg*8,gp=po/vp,Pg=16.5*40,mP=gp*1e3,hP=Pg*8,Rg=po/Eg,Vg=16.5/3,Ig=Vg*40,fP=Rg*1e3,xP=Ig*8,fh=16.5/gp,xh=fh*40,vP=xh*8,gP=1e3/fh,AP=40*8,Lg=1e3/xh,_P=8/Lg;function vh(n){return n/gp}function gh(n){return n/po}function Ah(n){return n*po}var Dg=new Oe,ea=new k;function Ap(n,t,e,r,i){Dg.copy(n.matrixWorld).invert().multiply(t.matrixWorld).decompose(ea,r,i),e.set(ea.x,ea.y,ea.z,1)}var _p=new Fs(1,1,1,1);_p.name="PlaneGeom";var ta=new kt,na=new ce,ii=new k,Og=0,oi=class extends We{constructor(e,r,i,o=null){super();this.webXRLayerType=i;this.lastMatrixWorld=new Oe;this.layer=null;this.wasUsingLayer=!1;this._imageWidth=0;this._imageHeight=0;this.curImage=null;this.lastImage=null;this.lastWidth=null;this.lastHeight=null;this.env=null;this.mesh=null;this.stereoLayoutName="mono";this.sizeMode="none";if(this.onTick=s=>this.checkWebXRLayer(s.frame),e){this.setEnvAndName(e,r);let s=Fm(o)?o:ri(Object.assign({},o,{name:this.name}));j(this,this.mesh=sr(r+"-Mesh",_p,s))}}copy(e,r=!0){return super.copy(e,r),this.webXRLayerType=e.webXRLayerType,this.setImageSize(e.imageWidth,e.imageHeight),this.setEnvAndName(e.env,e.name+ ++Og),this.mesh=Lt(this.children,Rn),B(this.mesh)&&(this.mesh=e.mesh.clone(),j(this,this.mesh)),this.setTextureMap(e.curImage),this}dispose(){this.env.timer.removeTickHandler(this.onTick),this.disposeImage(),Zt(this.mesh)}disposeImage(){this.removeWebXRLayer(),Zt(this.mesh.material.map),this.curImage=null}setImageSize(e,r){if(e!==this.imageWidth||r!==this.imageHeight){let{objectWidth:i,objectHeight:o}=this;this._imageWidth=e,this._imageHeight=r,this.sizeMode!=="none"&&(this.sizeMode==="fixed-width"?this.objectWidth=i:this.objectHeight=o)}}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get imageAspectRatio(){return this.imageWidth/this.imageHeight}get objectWidth(){return this.scale.x}set objectWidth(e){this.scale.set(e,this.scale.y=e/this.imageAspectRatio,1)}get objectHeight(){return this.scale.y}set objectHeight(e){this.scale.set(this.imageAspectRatio*e,e,1)}get pixelDensity(){let e=Ah(this.objectWidth);return this.imageWidth/e}set pixelDensity(e){let r=this.imageWidth/e,i=gh(r);this.objectWidth=i}setEnvAndName(e,r){this.env=e,this.name=r,this.env.timer.addTickHandler(this.onTick)}get needsLayer(){return!Gs(this)||B(this.mesh.material.map)||B(this.curImage)?!1:this.curImage instanceof HTMLVideoElement?!this.curImage.paused||this.curImage.currentTime>0:!0}removeWebXRLayer(){if(_(this.layer)){this.wasUsingLayer=!1,this.env.removeWebXRLayer(this.layer),this.mesh.visible=!0;let e=this.layer;this.layer=null,setTimeout(()=>e.destroy(),100)}}setTextureMap(e){this.curImage&&this.disposeImage(),e&&(wu(e)?e=Cu(e):Su(e)&&(e=Pu(e)),Eu(e)&&(e=e),this.curImage=e,e instanceof HTMLVideoElement?(this.setImageSize(e.videoWidth,e.videoHeight),this.mesh.material.map=new Dm(e)):(this.setImageSize(e.width,e.height),this.mesh.material.map=new ro(e),this.mesh.material.map.needsUpdate=!0)),this.mesh.material.needsUpdate=!0}get isVideo(){return this.curImage instanceof HTMLVideoElement}updateTexture(){if(_(this.curImage)){let e=this.curImage,r=this.isVideo?e.videoWidth:this.curImage.width,i=this.isVideo?e.videoHeight:this.curImage.height;if(this.imageWidth!==r||this.imageHeight!==i){let o=this.curImage;this.disposeImage(),this.setTextureMap(o)}}}checkWebXRLayer(e){if(this.mesh.material.map&&this.curImage){let i=this.webXRLayerType!=="none"&&this.env.hasXRCompositionLayers&&this.env.showWebXRLayers&&_(e)&&(this.isVideo&&_(this.env.xrMediaBinding)||!this.isVideo&&_(this.env.xrBinding))&&this.needsLayer,o=i!==this.wasUsingLayer,s=this.curImage!==this.lastImage||this.mesh.material.needsUpdate||this.mesh.material.map.needsUpdate,p=this.imageWidth!==this.lastWidth||this.imageHeight!==this.lastHeight;if(this.wasUsingLayer=i,this.lastImage=this.curImage,this.lastWidth=this.imageWidth,this.lastHeight=this.imageHeight,(o||p)&&((!i||p)&&this.layer&&this.removeWebXRLayer(),i)){let c=this.env.referenceSpace;Ap(this.env.stage,this.mesh,ta,na,ii),this.lastMatrixWorld.copy(this.matrixWorld);let u=new XRRigidTransform(ta,na),h=ii.x/2,x=ii.y/2,b=this.stereoLayoutName==="mono"?"mono":this.stereoLayoutName==="left-right"||this.stereoLayoutName==="right-left"?"stereo-left-right":"stereo-top-bottom";if(this.isVideo){let E=this.stereoLayoutName==="right-left"||this.stereoLayoutName==="bottom-top";this.layer=this.env.xrMediaBinding.createQuadLayer(this.curImage,{space:c,layout:b,invertStereo:E,transform:u,width:h,height:x})}else this.layer=this.env.xrBinding.createQuadLayer({space:c,layout:b,textureType:"texture",isStatic:this.webXRLayerType==="static",viewPixelWidth:this.curImage.width,viewPixelHeight:this.curImage.height,transform:u,width:h,height:x});this.env.addWebXRLayer(this.layer,500),this.mesh.visible=!1}if(this.layer){if(s||this.layer.needsRedraw){let c=this.env.gl,u=this.env.xrBinding.getSubImage(this.layer,e);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!0),c.bindTexture(c.TEXTURE_2D,u.colorTexture),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.curImage),c.generateMipmap(c.TEXTURE_2D),c.bindTexture(c.TEXTURE_2D,null)}dh(this.matrixWorld.elements,this.lastMatrixWorld.elements)>=0&&(Ap(this.env.stage,this.mesh,ta,na,ii),this.lastMatrixWorld.copy(this.matrixWorld),this.layer.transform=new XRRigidTransform(ta,na),this.layer.width=ii.x/2,this.layer.height=ii.y/2)}}}};var ia=class extends qs{constructor(e,r){super(r);this.material=ri({name:"videoPlayer-material"}),this.vidMeshes=[];for(let i=0;i<2;++i){let o=new oi(e,`videoPlayer-view${i+1}`,"none",this.material);o.setTextureMap(this.video),o.mesh.renderOrder=4,i>0?o.mesh.layers.disable(0):o.mesh.layers.enable(0),this.vidMeshes.push(o)}this.object=de("videoPlayer",...this.vidMeshes)}onDisposing(){super.onDisposing(),Zt(this.object),le(this.vidMeshes)}isSupported(e,r){return r.split("-").map(i=>_h.has(e,i)).reduce(vd,!0)}setStereoParameters(e,r){if(!this.isSupported(e,r))throw new Error(`Not supported [encoding: ${e}, layout: ${r}]`);for(let s=0;s<this.vidMeshes.length;++s){let p=this.vidMeshes[s];p.webXRLayerType="none",p.mesh.layers.disable(1),p.mesh.layers.disable(2),r==="left-right"||r==="top-bottom"?p.mesh.layers.enable(this.vidMeshes.length-s):r!=="mono"&&p.mesh.layers.enable(s+1)}let i=this.height/this.width;e!=="N/A"?this.vidMeshes[0].scale.setScalar(100):r==="mono"?this.vidMeshes[0].scale.set(1,i,1):r==="left-right"||r==="right-left"?this.vidMeshes[0].scale.set(1,2*i,1):this.vidMeshes[0].scale.set(1,.5*i,1);for(let s=1;s<this.vidMeshes.length;++s)this.vidMeshes[s].scale.copy(this.vidMeshes[0].scale);let o=r.split("-");for(let s=0;s<o.length;++s){let p=o[s],c=_h.get(e,p),u=this.vidMeshes[s];u.webXRLayerType="dynamic",u.visible=!0,u.mesh.geometry!==c&&(u.mesh.geometry.dispose(),u.mesh.geometry=c)}}},kg=Et([[-1/2,1/2,0,0,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,0,0]]),bh=[[-1/2,1/2,0,0,1],[1/2,1/2,0,.5,1],[1/2,-1/2,0,.5,0],[-1/2,-1/2,0,0,0]],yh=[[-1/2,1/2,0,.5,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,.5,0]],Eh=[[[-1/2,1/2,-1/2,1/3,1],[1/2,1/2,-1/2,2/3,1],[1/2,-1/2,-1/2,2/3,1/2],[-1/2,-1/2,-1/2,1/3,1/2]],[[1/2,1/2,-1/2,2/3,1],[1/2,1/2,1/2,1,1],[1/2,-1/2,1/2,1,1/2],[1/2,-1/2,-1/2,2/3,1/2]],[[-1/2,1/2,1/2,0,1],[-1/2,1/2,-1/2,1/3,1],[-1/2,-1/2,-1/2,1/3,1/2],[-1/2,-1/2,1/2,0,1/2]],[[1/2,1/2,1/2,2/3,1/2],[-1/2,1/2,1/2,2/3,0],[-1/2,-1/2,1/2,1/3,0],[1/2,-1/2,1/2,1/3,1/2]],[[1/2,1/2,-1/2,1,1/2],[-1/2,1/2,-1/2,1,0],[-1/2,1/2,1/2,2/3,0],[1/2,1/2,1/2,2/3,1/2]],[[1/2,-1/2,1/2,1/3,1/2],[-1/2,-1/2,1/2,1/3,0],[-1/2,-1/2,-1/2,0,0],[1/2,-1/2,-1/2,0,1/2]]],bp=[[[-1/2,1/2,-1/2,0,1/3],[1/2,1/2,-1/2,0,2/3],[1/2,-1/2,-1/2,1/4,2/3],[-1/2,-1/2,-1/2,1/4,1/3]],[[1/2,1/2,-1/2,0,2/3],[1/2,1/2,1/2,0,1],[1/2,-1/2,1/2,1/4,1],[1/2,-1/2,-1/2,1/4,2/3]],[[-1/2,1/2,1/2,0,0],[-1/2,1/2,-1/2,0,1/3],[-1/2,-1/2,-1/2,1/4,1/3],[-1/2,-1/2,1/2,1/4,0]],[[1/2,1/2,1/2,1/4,2/3],[-1/2,1/2,1/2,1/2,2/3],[-1/2,-1/2,1/2,1/2,1/3],[1/2,-1/2,1/2,1/4,1/3]],[[1/2,1/2,-1/2,1/4,1],[-1/2,1/2,-1/2,1/2,1],[-1/2,1/2,1/2,1/2,2/3],[1/2,1/2,1/2,1/4,2/3]],[[1/2,-1/2,1/2,1/4,1/3],[-1/2,-1/2,1/2,1/2,1/3],[-1/2,-1/2,-1/2,1/2,0],[1/2,-1/2,-1/2,1/4,0]]],yp=[[[-1/2,1/2,-1/2,1/2,1/3],[1/2,1/2,-1/2,1/2,2/3],[1/2,-1/2,-1/2,3/4,2/3],[-1/2,-1/2,-1/2,3/4,1/3]],[[1/2,1/2,-1/2,1/2,2/3],[1/2,1/2,1/2,1/2,1],[1/2,-1/2,1/2,3/4,1],[1/2,-1/2,-1/2,3/4,2/3]],[[-1/2,1/2,1/2,1/2,0],[-1/2,1/2,-1/2,1/2,1/3],[-1/2,-1/2,-1/2,3/4,1/3],[-1/2,-1/2,1/2,3/4,0]],[[1/2,1/2,1/2,3/4,2/3],[-1/2,1/2,1/2,1,2/3],[-1/2,-1/2,1/2,1,1/3],[1/2,-1/2,1/2,3/4,1/3]],[[1/2,1/2,-1/2,3/4,1],[-1/2,1/2,-1/2,1,1],[-1/2,1/2,1/2,1,2/3],[1/2,1/2,1/2,3/4,2/3]],[[1/2,-1/2,1/2,3/4,1/3],[-1/2,-1/2,1/2,1,1/3],[-1/2,-1/2,-1/2,1,0],[1/2,-1/2,-1/2,3/4,0]]],Bg=Et(bh),Fg=Et(yh),Ng=Et(Ep(bh)),Xg=Et(Ep(yh)),wh=Mh(bp),Sh=Mh(yp),zg=Et(...Eh),Hg=Et(...bp),Gg=Et(...yp),Ug=Et(...wh),jg=Et(...Sh),co=4,Wg=ni(co,...Eh),Qg=ni(co,...bp),qg=ni(co,...yp),Kg=ni(co,...wh),Yg=ni(co,...Sh),_h=new Vn([["N/A","mono",kg],["N/A","left",Bg],["N/A","right",Fg],["N/A","top",Ng],["N/A","bottom",Xg],["Cubemap Strips","mono",zg],["Cubemap Strips","left",Hg],["Cubemap Strips","right",Gg],["Cubemap Strips","top",Ug],["Cubemap Strips","bottom",jg],["Equi-Angular Cubemap (YouTube)","mono",Wg],["Equi-Angular Cubemap (YouTube)","left",Qg],["Equi-Angular Cubemap (YouTube)","right",qg],["Equi-Angular Cubemap (YouTube)","top",Kg],["Equi-Angular Cubemap (YouTube)","bottom",Yg]]);function ra(n){return[n[0],n[1],n[2],n[4],1-n[3]]}function Ep(n){return[ra(n[0]),ra(n[1]),ra(n[2]),ra(n[3])]}function Mh(n){return n.map(Ep)}var oa=class{constructor(t,e,r){this.imagePaths=t;this.padding=e;this.uvDescrips=new Vn;this.geoms=new Vn;this.canvas=null;this.texture=null;this.enabledMaterial=null;this.disabledMaterial=null;this.assetSets=new Vn(Array.from(this.imagePaths.entries()).map(([i,o,s])=>[i,o,new Ts(s,Iu,!r)])),this.assets=Array.from(this.assetSets.values()),this.ready=Promise.all(this.assets).then(()=>this.finish())}finish(){let t=this.assets.map(O=>O.result),e=Math.max(...t.map(O=>O.width)),r=Math.max(...t.map(O=>O.height)),i=e*r*t.length,o=Math.sqrt(i),s=Math.floor(o/e),p=Math.ceil(t.length/s),c=s*e,u=p*r,h=ep(c),x=ep(u),b=c/h,E=u/x,R=e/h,P=r/x;this.canvas=ws(h,x);let T=this.canvas.getContext("2d",{alpha:!1});T.fillStyle="#1e4388",T.fillRect(0,0,h,x);let D=0;for(let[O,I,X]of this.assetSets.entries()){let z=X.result,V=D%s,F=(D-V)/s,ie=b*(V*e/c),oe=E*(1-F/p)-P,W=V*e,re=F*r+x-u,Ee=e-2*this.padding,ve=r-2*this.padding;T.drawImage(z,0,0,z.width,z.height,W+this.padding,re+this.padding,Ee,ve),this.uvDescrips.add(O,I,{u:ie,v:oe,du:R,dv:P}),++D}this.texture=new Qu(this.canvas),this.enabledMaterial=new qe({map:this.texture}),this.enabledMaterial.needsUpdate=!0,this.disabledMaterial=new qe({map:this.texture,transparent:!0,opacity:.5}),this.disabledMaterial.needsUpdate=!0}getSets(){return Array.from(this.imagePaths.keys())}getIcons(t){if(!this.imagePaths.has(t))throw new Wt(`Button set ${t} does not exist`);return Array.from(this.imagePaths.get(t).keys())}async getMaterial(t){return await this.ready,t?this.enabledMaterial:this.disabledMaterial}async getGeometry(t,e){await this.ready;let r=this.uvDescrips.get(t),i=r&&r.get(e);if(!r||!i)throw new Wt(`Button ${t}/${e} does not exist`,this.uvDescrips);let o=this.geoms.get(t,e);if(!o){o=new Fs(1,1,1,1),o.name=`Geometry:${t}/${e}`,this.geoms.add(t,e,o);let s=o.getAttribute("uv");for(let p=0;p<s.count;++p){let c=s.getX(p)*i.du+i.u,u=s.getY(p)*i.dv+i.v;s.setX(p,c),s.setY(p,u)}}return o}async getGeometryAndMaterials(t,e){let[r,i,o]=await Promise.all([this.getGeometry(t,e),this.getMaterial(!0),this.getMaterial(!1)]);return{geometry:r,enabledMaterial:i,disabledMaterial:o}}getImageSrc(t,e){let r=this.imagePaths.get(t),i=r&&r.get(e);if(!r||!i)throw new Wt(`Button ${t}/${e} does not exist`,this.uvDescrips);return i}getImageElement(t,e){return qi(Or(t+" "+e),zi(this.getImageSrc(t,e)))}};var wp="Juniper:ThreeJS:EventSystem:RayTarget",pr=class extends ${constructor(e){super();this.object=e;this.meshes=new Array;this._disabled=!1;this._clickable=!1;this._draggable=!1;this._navigable=!1;this.object.userData[wp]=this}addMesh(e){return e.userData[wp]=this,this.meshes.push(e),this}get disabled(){return this._disabled}set disabled(e){this._disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get clickable(){return this._clickable}set clickable(e){this._clickable=e}get draggable(){return this._draggable}set draggable(e){this._draggable=e}get navigable(){return this._navigable}set navigable(e){this._navigable=e}};function Jg(n){return n instanceof pr}function si(n){let t=null;return n&&(Jg(n)?t=n:(n=Ke(n),n&&(t=n.userData[wp])),t&&!Gs(t)&&(t=null)),t}var cr=class extends pr{constructor(e,r,i,o,s){e=e+bt(16);super(de(e));this.enabledMesh=sr(`Mesh-${e}-enabled`,r,i),this.disabledMesh=sr(`Mesh-${e}-disabled`,r,o),this.disabledMesh.visible=!1,this.size=s,j(this,this.enabledMesh,this.disabledMesh),this.addMesh(this.enabledMesh),this.addMesh(this.disabledMesh),this.clickable=!0,this.disabled=this.disabled,Ks(this,!0)}get size(){return this.enabledMesh.scale.x}set size(e){this.enabledMesh.scale.setScalar(e),this.disabledMesh.scale.setScalar(e)}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.enabledMesh.visible=!e,this.disabledMesh.visible=e}};var ai=class{constructor(t,e,r){this.mesh=null;this.element=Fr(Or(r),t.getImageElement(e,r)),this.object=de(`${name}-button`),this.load(t,e,r)}async load(t,e,r){let{geometry:i,enabledMaterial:o,disabledMaterial:s}=await t.getGeometryAndMaterials(e,r);this.mesh=new cr(r,i,o,s,.2),this.mesh.disabled=this.disabled,j(this,this.mesh),this.mesh.object.visible=this.visible,this.mesh.addEventListener("click",()=>{this.element.click()})}get name(){return this.object.name}addEventListener(t,e,r){this.element.addEventListener(t,e,r)}dispatchEvent(t){return this.element.dispatchEvent(t)}removeEventListener(t,e,r){this.element.removeEventListener(t,e,r)}click(){this.element.click()}get visible(){return Tt(this)}set visible(t){De(this,t,"inline-block"),this.mesh&&(this.mesh.object.visible=t)}get disabled(){return this.element.disabled}set disabled(t){this.element.disabled=t,this.mesh&&(this.mesh.disabled=t)}};var $g={type:"redrawn"},dr=class extends oi{constructor(e,r,i,o,s){super(e,r,i,s);this._image=null;this.image=o}get object(){return this}get element(){return Jt(this.image.canvas)?this.image.canvas:null}onRedrawn(){this.updateTexture(),this.dispatchEvent($g)}get image(){return this._image}set image(e){this.image&&this.image.removeScope(this),this._image=e,this.image&&(this.image.addScopedEventListener(this,"redrawn",()=>this.onRedrawn()),this.setTextureMap(this.image.canvas),this.onRedrawn())}get imageWidth(){return this.image.width}get imageHeight(){return this.image.height}copy(e,r=!0){return super.copy(e,r),this.image=e.image,this}get isVisible(){return Tt(this)}set isVisible(e){De(this,e,"inline-block"),ke(this,e),ke(this.mesh,e),this.image.visible=e}};function Th(n){return!n.started||n.finished}var Sp=class extends Qt{constructor(){super(!1);this.time=0;this.duration=0;this.onTick=null}begin(e,r,i){this.reset(),this.start(),this.time=-e,this.duration=r,this.onTick=i,this.onTick(0)}update(e){Th(this)||(this.time+=e/this.duration,this.time>=1?(this.onTick(1),this.resolve()):this.time>=0&&this.onTick(this.time))}},sa=class{constructor(){this.animations=new Array}update(t){t=.001*t;for(let e of this.animations)e.update(t)}clear(){for(let t of this.animations)t.resolve()}start(t,e,r){let i=Lt(this.animations,Th);return i||this.animations.push(i=new Sp),i.begin(t,e,r),i}};Ct(Q(".dialog, .dialog-container",Br("fixed")),Q(".dialog",Yn(0),qn(0),jt("100%"),ut("100%"),Gi("rgba(0, 0, 0, 0.5)"),Ko(100)),Q(".dialog-container",Yn("50%"),qn("50%"),Kn("100%"),pd("100%"),md("translateX(-50%) translateY(-50%)"),Gi("white"),ed("rgba(0,0,0,0.5) 0px 5px 30px"),Be("grid"),Ut("2em auto 2em"),qo("auto 1fr auto 2em")),Q(".dialog .title-bar",Wo(1,1,2,-1),Mt("0.25em")),Q(".dialog-content",Wo(2,2,-4,-2),dd("auto")),Q(".dialog-controls",Wo(-2,2,-3,-2)),Q(".dialog .confirm-button",od("right")),Q(".dialog h1, .dialog h2, .dialog h3, .dialog h4, .dialog h5, .dialog h6",xn("left")),Q(".dialog select",Kn("10em")));var li=class{constructor(t){this.subEventer=new $;this.element=_e(fe("dialog"),qc("dialogname",t),dt(Be("none")),this.container=_e(fe("dialog-container"),this.titleElement=Cd(fe("title-bar"),t),this.contentArea=_e(fe("dialog-content")),_e(fe("dialog-controls"),this.confirmButton=Fr("Confirm",Lr("confirm-button")),this.cancelButton=ts("Cancel",Lr("cancel-button"))))),this.confirmButton.addEventListener("click",()=>this.subEventer.dispatchEvent(new q("confirm"))),this.cancelButton.addEventListener("click",()=>this.subEventer.dispatchEvent(new q("cancel"))),me(document.body,this)}get title(){return this._title}set title(t){$o(this.titleElement,this._title=t)}async onShowing(){}onShown(){}async onConfirm(){}onCancel(){}async onClosing(){}onClosed(){}show(t){De(this,t)}get isOpen(){return Tt(this)}async showDialog(){await this.onShowing(),this.show(!0),this.onShown();let t=Le(this.subEventer,"confirm","cancel"),e=await bd(t);return e?await this.onConfirm():this.onCancel(),await this.onClosing(),this.show(!1),this.onClosed(),e}};var pi=class extends dr{constructor(t,e,r,i){let o;r instanceof $t?o=r:o=new $t(r),super(t,e,"none",o,i)}onRedrawn(){this.objectHeight=this.imageHeight,super.onRedrawn()}};var uo=class extends pr{constructor(e,r,i,o){super(de(r));this.env=e;if(_(i)){o=Object.assign({textFillColor:"#ffffff",fontFamily:"Segoe UI Emoji",fontSize:20,minHeight:.25,maxHeight:.25},o,{value:i}),this.image=new $t(o);let s=bt(16);this.enabledImage=this.createImage(`${s}-enabled`,1),this.disabledImage=this.createImage(`${s}-disabled`,.5),this.disabledImage.visible=!1,j(this,this.enabledImage,this.disabledImage)}this.addMesh(this.enabledImage.mesh),this.addMesh(this.disabledImage.mesh),this.clickable=!0,_(i)&&Ks(this,!0)}createImage(e,r){return new pi(this.env,`text-${e}`,this.image,{side:Ds,opacity:r})}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.enabledImage.visible=!e,this.disabledImage.visible=e}};var Ch={bgStrokeColor:"#000000",bgStrokeSize:.04,wrapWords:!1,textFillColor:"#ffffff",scale:150},Ph=Object.assign({},Ch,{padding:{left:.1,right:.1,top:.025,bottom:.025},fontSize:20,minHeight:.5,maxHeight:.5}),Zg=Object.assign({},Ph,{bgFillColor:"#0078d7"}),eA=Object.assign({},Ph,{bgFillColor:"#780000"}),tA=Object.assign({},Ch,{bgFillColor:"#ffffff",textFillColor:"#000000",padding:{top:.1,left:.1,bottom:.4,right:.1},fontSize:25,minHeight:1,maxHeight:1}),nA=.9;function Mp(n,t){return Object.assign({},n,{fontFamily:t})}var aa=class extends li{constructor(e,r){super("Confirm action");this.env=e;this.object=de("ConfirmationDialog");this.root=de("Root");this.animator=new sa;this.a=0;this.b=0;this.confirmButton.innerText="Yes",this.cancelButton.innerText="No",this.mesh=new pi(this.env,"confirmationDialogLabel",Mp(tA,r)),this.confirmButton3D=new uo(this.env,"confirmationDialogConfirmButton","Yes",Mp(Zg,r)),this.confirmButton3D.addEventListener("click",()=>this.confirmButton.click()),this.confirmButton3D.object.position.set(1,-.5,.5),this.cancelButton3D=new uo(this.env,"confirmationDialogCancelButton","No",Mp(eA,r)),this.cancelButton3D.addEventListener("click",()=>this.cancelButton.click()),this.cancelButton3D.object.position.set(2,-.5,.5),me(this.container,dt(Kn("calc(100% - 2em)"),jt("max-content"))),me(this.contentArea,dt(jo("18pt"),xn("center"),Mt("1em"))),j(this,j(this.root,this.mesh,this.confirmButton3D,this.cancelButton3D)),ke(this.root,!1),this.root.scale.setScalar(0),this.onTick=i=>{let o=Km(this.a+this.b*i,nA);this.root.scale.set(o,o,.01)}}get name(){return this.object.name}get visible(){return Tt(this)}set visible(e){De(this,e,"inline-block"),this.mesh.visible=e}update(e){this.animator.update(e)}async showHide(e,r){this.a=e,this.b=r,await this.animator.start(0,.25,this.onTick),this.animator.clear()}get use3D(){return this.env.renderer.xr.isPresenting||this.env.testSpaceLayout}async onShowing(){await super.onShowing(),this.use3D&&(this.root.visible=!0,await this.showHide(0,1))}onShown(){this.use3D&&(this.element.style.display="none")}async onClosing(){this.use3D&&(await this.showHide(1,-1),this.root.visible=!1),await super.onClosing()}prompt(e,r){return this.title=e,$o(this.contentArea,r),this.mesh.image.value=r,this.showDialog()}};var ur=class{constructor(t,e,r,i){this.buttons=t;this.setName=e;this.activeName=r;this.inactiveName=i;this.enterButton=null;this.exitButton=null;this._isAvailable=!0;this._isEnabled=!0;this._isVisible=!0;this._isActive=!1;this.element=Fr(this.btnImage=qi()),this.object=de(`${this.setName}-button`),this.load()}get name(){return this.object.name}addEventListener(t,e,r){this.element.addEventListener(t,e,r)}dispatchEvent(t){return this.element.dispatchEvent(t)}removeEventListener(t,e,r){this.element.removeEventListener(t,e,r)}click(){this.element.click()}async load(){let[t,e]=await Promise.all([this.buttons.getGeometryAndMaterials(this.setName,this.activeName),this.buttons.getGeometryAndMaterials(this.setName,this.inactiveName)]);j(this.object,this.enterButton=new cr(`${this.setName}-activate-button`,t.geometry,t.enabledMaterial,t.disabledMaterial,.2),this.exitButton=new cr(`${this.setName}-deactivate-button`,e.geometry,e.enabledMaterial,e.disabledMaterial,.2)),this.enterButton.addEventListener("click",()=>this.element.click()),this.exitButton.addEventListener("click",()=>this.element.click()),this.refreshState()}get mesh(){return this.active?this.enterButton:this.exitButton}get available(){return this._isAvailable}set available(t){this._isAvailable=t,this.refreshState()}get active(){return this._isActive}set active(t){this._isActive=t,this.refreshState()}get enabled(){return this._isEnabled}set enabled(t){this._isEnabled=t,this.refreshState()}get visible(){return this._isVisible}set visible(t){this._isVisible=t,this.refreshState()}refreshState(){let t=this.active?this.inactiveName:this.activeName,e=`${t} ${this.setName}`;if(this.element.title=this.btnImage.title=e,this.btnImage.src=this.buttons.getImageSrc(this.setName,t),this.element.disabled=!this.available||!this.visible||!this.enabled,De(this,this.available&&this.visible,"inline-block"),this.enterButton&&this.exitButton){Us(this,this.available&&this.visible&&this.enabled);let r=ke(this.object,this.available&&this.visible);ke(this.enterButton,r&&!this.active),ke(this.exitButton,r&&this.active)}}};var ci=class extends ur{constructor(e,r){let i=oo[r];super(e,i.toLowerCase(),"enter","exit");this.mode=r}};function Tp(n,t){n.element instanceof HTMLButtonElement&&(n.element.disabled=!t),Us(n,t)}function Rh(n){return new Cp(n)}var Cp=class extends ti{pop(t){return this.addSubProgress(t)}};function Pp(n){return _(n)&&n.length>0?parseFloat(n):null}var la=class{constructor(t,e){this._url=null;this._base=void 0;this._protocol=null;this._host=null;this._hostName=null;this._userName=null;this._password=null;this._port=null;this._pathName=null;this._hash=null;this._query=new Map;t!==void 0&&(this._url=new URL(t,e),this.rehydrate())}rehydrate(){_(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),_(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),_(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),_(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),_(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),_(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),_(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),_(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[t,e]of this._query)this._url.searchParams.set(t,e);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=Pp(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((t,e)=>this._query.set(e,t))}refresh(){if(this._url===null){if(_(this._protocol)&&(_(this._host)||_(this._hostName))){if(_(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=Pp(this._url.port),this.rehydrate(),!1;if(_(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(_(this._pathName)&&_(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return _(this._url)}base(t){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=t,this.refresh(),this}protocol(t){return this._protocol=t,this.refresh()&&(this._url.protocol=t),this}host(t){return this._host=t,this.refresh()&&(this._url.host=t,this._hostName=this._url.hostname,this._port=Pp(this._url.port)),this}hostName(t){return this._hostName=t,this.refresh()&&(this._url.hostname=t,this._host=`${this._url.hostname}:${this._url.port}`),this}port(t){return this._port=t,this.refresh()&&(this._url.port=t.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(t){return this._userName=t,this.refresh()&&(this._url.username=t),this}password(t){return this._password=t,this.refresh()&&(this._url.password=t),this}path(t){return this._pathName=t,this.refresh()&&(this._url.pathname=t),this}pathPop(t){return t=t||/\/[^\/]+\/?$/,this.path(this._pathName.replace(t,""))}pathPush(t){let e=this._pathName;return e.endsWith("/")||(e+="/"),e+=t,this.path(e)}query(t,e){return this._query.set(t,e),this.refresh()&&this._url.searchParams.set(t,e),this}hash(t){return this._hash=t,this.refresh()&&(this._url.hash=t),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};var mo=class extends q{constructor(e,r){super(e);this.appName=r}},Rp=class extends mo{constructor(e,r){super("apploading",e);this.appLoadParams=r;this.preLoadTask=null}},Vp=class extends mo{constructor(e,r){super("apploaded",e);this.app=r}},Ip=class extends mo{constructor(e,r){super("appshown",e);this.app=r}},Lp=class{constructor(t,e){this.loader=t;this.name=e;this.params=new Map}param(t,e){return this.params.set(t,e),this}load(t){return this.loader(this.name,this.params,t)}},pa=class extends ${constructor(e){super();this.env=e;this.loadedModules=new Map;this.loadingApps=new Map;this.currentApps=new Map;this.cacheBustString=null}[Symbol.iterator](){return this.currentApps.values()}isLoaded(e){return this.currentApps.has(e)}get(e){return this.currentApps.get(e)}waitFor(e){if(this.isLoaded(e))return Promise.resolve(this.get(e));let r=new Qt,i=o=>{o.appName===e&&(this.removeEventListener("apploaded",i),r.resolve(o.app))};return Le(this,"apploaded").then(o=>o.app),this.addEventListener("apploaded",i),r}async loadAppConstructor(e,r){if(this.loadedModules.has(e))_(r)&&r.end();else{let o=this.env.DEBUG?".js":".min.js",s=`/js/${e}/index${o}`;if(_(this.cacheBustString)){let c=new la(s,location.href);c.query("v",this.cacheBustString),s=c.toString()}let p=this.env.fetcher.get(s).progress(r).useCache(!this.env.DEBUG).module();this.loadedModules.set(e,p)}let{default:i}=await this.loadedModules.get(e);return i}app(e){return new Lp(this.loadApp.bind(this),e)}loadApp(e,r,i){let o=null;r instanceof Map?o=r:i=r,i=i||this.env.loadingBar;let s=new Rp(e,o);this.dispatchEvent(s);let p=s.preLoadTask||Promise.resolve();if(!this.loadingApps.has(e)){let u=Rh(i),h=p.then(()=>this.loadAppInstance(this.env,e,o,u.pop(10)));this.loadingApps.set(e,h),i=u.pop(1)}return this.loadingApps.get(e).then(async u=>(await u.show(i),this.dispatchEvent(new Ip(e,u)),u))}async loadAppInstance(e,r,i,o){if(!this.currentApps.has(r)){let[s,p]=Qs(o,[1,10]),c=await this.loadAppConstructor(r,s),u=new c(e);u.addEventListener("quit",()=>this.unloadApp(r)),_(i)&&await u.init(i),await u.load(p),this.currentApps.set(r,u),this.dispatchEvent(new Vp(r,u))}return _(o)&&o.end(),this.currentApps.get(r)}unloadApp(e){let r=this.currentApps.get(e);r.clearEventListeners(),r.dispose(),this.currentApps.delete(e),this.loadingApps.delete(e)}};var ho=new k;function ca(n){return ho.copy(n),ho.y=0,ho.normalize(),Mn(Math.atan2(ho.x,ho.z))}function Vh(n){return Mn(Math.asin(n.y))}var di=new k,Ih=0,rA=new k,da=new k,Dp=new k,ua=new ce,Lh=0,iA=0;function oA(n,t){let e=n-t,r=e+Sn,i=e-Sn,o=Math.abs(e),s=Math.abs(r),p=Math.abs(i);return o<s&&o<p?e:s<p?r:i}var ma=class extends We{constructor(e,r,i,o,s=1){super();this.minDistance=r;this.heightOffset=o;this.speed=s;this.name=e,this.lerp=this.minAngle>0||this.minDistance>0,this.maxDistance=this.minDistance*5,this.minAngle=et(i),this.maxAngle=Math.PI-this.minAngle,Object.seal(this)}copy(e,r=!0){return super.copy(e,r),this.name=e.name+ ++iA,this.lerp=e.lerp,this.maxDistance=e.maxDistance,this.minAngle=e.minAngle,this.maxAngle=e.maxAngle,this}update(e,r,i,o){o*=.001,this.clampTo(this.lerp,e,r,this.minDistance,this.maxDistance,i,this.minAngle,this.maxAngle,o)}reset(e,r,i){this.clampTo(!1,e,r,0,0,i,0,0,0)}clampTo(e,r,i,o,s,p,c,u,h){di.copy(i),di.y-=this.heightOffset*r,Ih=p,this.getWorldPosition(da),this.getWorldDirection(Dp),Dp.negate(),Lh=ca(Dp),ua.identity();let x=!e,b=!e;if(e){let E=rA.copy(di).sub(da).length();o<E&&(E<s&&di.lerpVectors(da,di,this.speed*h),x=!0);let R=oA(Ih,Lh),P=Math.abs(R);c<P&&(P<u?ua.setFromAxisAngle(this.up,R*this.speed*h):ua.setFromAxisAngle(this.up,R),b=!0)}(x||b)&&(x&&this.position.add(di.sub(da)),b&&this.quaternion.multiply(ua))}};async function Dh(n,t){let{status:e,path:r,content:i,contentType:o,contentLength:s,fileName:p,headers:c,date:u}=n;return{status:e,path:r,content:await t(i),contentType:o,contentLength:s,fileName:p,headers:c,date:u}}var ha=class extends Yr{constructor(e,r,i,o){if(!Ms.matches(i)&&!Du.matches(i))throw new Error("Only GLTF model types are currently supported");super(r,i,o);this.env=e}async getResponse(e){let r=await e.file();return Dh(r,i=>this.env.loadGltf(i))}};function xa(n){return!(n.shiftKey||n.altKey||n.ctrlKey||n.metaKey)}var fa=class{constructor(t,e,r){this.name=t;this.callback=e;if(!Z(e))throw new Error("A function instance is required for this parameter");this.opts=r,Object.freeze(this)}applyToElement(t){this.add(t)}add(t){t.addEventListener(this.name,this.callback,this.opts)}remove(t){t.removeEventListener(this.name,this.callback)}};function Oh(n,t){return new fa("click",n,t)}function ui(n,t){return new fa("input",n,t)}var In=(c=>(c[c.LocalUser=0]="LocalUser",c[c.Mouse=1]="Mouse",c[c.Pen=2]="Pen",c[c.Touch=3]="Touch",c[c.MotionController=4]="MotionController",c[c.MotionControllerLeft=5]="MotionControllerLeft",c[c.MotionControllerRight=6]="MotionControllerRight",c[c.RemoteUser=7]="RemoteUser",c))(In||{});var va=class extends q{constructor(){super("avatarmoved");this.px=0;this.py=0;this.pz=0;this.fx=0;this.fy=0;this.fz=0;this.ux=0;this.uy=0;this.uz=0;this.height=0;this.changed=!1;this.pointerID=0}set(e,r,i,o,s,p,c,u,h,x){this.changed=this.px!==e||this.py!==r||this.pz!==i||this.fx!==o||this.fy!==s||this.fz!==p||this.ux!==c||this.uy!==u||this.uz!==h,this.px=e,this.py=r,this.pz=i,this.fx=o,this.fy=s,this.fz=p,this.ux=c,this.uy=u,this.uz=h,this.height=x}};function mr(n,t){return n.xr.isPresenting?n.xr.getCamera():t}function kh(n,t,e,r,i){let o=n.elements;t.set(o[0],o[1],o[2]),e.set(o[4],o[5],o[6]),r.set(-o[8],-o[9],-o[10]),i.set(o[12],o[13],o[14]),t.normalize(),e.normalize(),r.normalize()}function sA(n){return n===DeviceOrientationEvent&&"requestPermission"in n&&Z(n.requestPermission)}var ga=class extends ${constructor(e,r,i){super();this.env=e;this.controlMode="none";this.snapTurnAngle=et(30);this.sensitivities=new Map([["mousedrag",100],["mousefirstperson",-100],["touchswipe",50],["gamepad",1]]);this.B=new k(0,0,1);this.R=new k;this.F=new k;this.U=new k;this.P=new k;this.M=new Oe;this.E=new em;this.Q1=new ce;this.Q2=new ce;this.Q3=new ce(-Math.sqrt(.5),0,0,Math.sqrt(.5));this.Q4=new ce;this.motion=new Re;this.rotStage=new Oe;this.userMovedEvt=new va;this.acceleration=new Re(2,2);this.speed=new Re(3,2);this.axisControl=new Re(0,0);this.deviceQ=new ce().identity();this.uv=new Re;this.duv=new Re;this.move=new k;this.move2=new k;this.followers=new Array;this.dz=0;this._heading=0;this._pitch=0;this._roll=0;this.headX=0;this.headZ=0;this._worldHeading=0;this._worldPitch=0;this.fwrd=!1;this.back=!1;this.left=!1;this.rght=!1;this.fwrd2=!1;this.back2=!1;this.left2=!1;this.rght2=!1;this.up=!1;this.down=!1;this.grow=!1;this.shrk=!1;this._keyboardControlEnabled=!1;this.worldPos=new k;this.worldQuat=new ce;this.fovZoomEnabled=!0;this.minFOV=15;this.maxFOV=120;this.minimumX=-85*Math.PI/180;this.maximumX=85*Math.PI/180;this.edgeFactor=1/3;this.deviceOrientation=null;this.screenOrientation=0;this.alphaOffset=0;this.onDeviceOrientationChangeEvent=null;this.onScreenOrientationChangeEvent=null;this.motionEnabled=!1;this.disableHorizontal=!1,this.disableVertical=!1,this.invertHorizontal=!1,this.invertVertical=!0,this._height=i,this.head=de("Head",r);let o=(s,p)=>{s==="w"&&(this.fwrd=p),s==="s"&&(this.back=p),s==="a"&&(this.left=p),s==="d"&&(this.rght=p),s==="e"&&(this.up=p),s==="q"&&(this.down=p),s==="ArrowUp"&&(this.fwrd2=p),s==="ArrowDown"&&(this.back2=p),s==="ArrowLeft"&&(this.left2=p),s==="ArrowRight"&&(this.rght2=p),s==="r"&&(this.grow=p),s==="f"&&(this.shrk=p)};this.onKeyDown=s=>o(s.key,xa(s)),this.onKeyUp=s=>o(s.key,!1),this.keyboardControlEnabled=!0,matchMedia("(pointer: coarse)").matches?this.controlMode="touchswipe":matchMedia("(pointer: fine)").matches&&(this.controlMode="mousedrag"),globalThis.isSecureContext&&Ki()&&!qt()&&(this.onDeviceOrientationChangeEvent=s=>{this.deviceOrientation=s},this.onScreenOrientationChangeEvent=()=>{ae(globalThis.orientation)||(this.screenOrientation=globalThis.orientation||0)},this.startMotionControl())}set disableVertical(e){this._disableVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set invertVertical(e){this._invertVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set disableHorizontal(e){this._disableHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}set invertHorizontal(e){this._invertHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}get height(){return this.head.position.y}get object(){return this.head}get worldHeading(){return this._worldHeading}get worldPitch(){return this._worldPitch}get fov(){return this.env.camera.fov}set fov(e){e!==this.fov&&(this.env.camera.fov=e,this.env.camera.updateProjectionMatrix())}get stage(){return this.head.parent}snapTurn(e){this.setHeading(this.heading-this.snapTurnAngle*e)}get keyboardControlEnabled(){return this._keyboardControlEnabled}set keyboardControlEnabled(e){this._keyboardControlEnabled!==e&&(this._keyboardControlEnabled=e,this._keyboardControlEnabled?(this.env.renderer.domElement.addEventListener("keydown",this.onKeyDown),this.env.renderer.domElement.addEventListener("keyup",this.onKeyUp)):(this.env.renderer.domElement.removeEventListener("keydown",this.onKeyDown),this.env.renderer.domElement.removeEventListener("keyup",this.onKeyUp)))}addFollower(e){this.followers.push(e)}onMove(e,r,i){this.setMode(e),e.canMoveView&&this.controlMode!=="none"&&this.gestureSatisfied(e)&&(this.uv.copy(r),this.duv.copy(i))}setMode(e){e.type==="remote"||(e.type==="hand"?this.controlMode="none":e.type==="gamepad"?this.controlMode="gamepad":e.rayTarget&&e.rayTarget.draggable&&!this.env.eventSys.mouse.isPointerLocked&&e.isPressed(0)?this.controlMode="mouseedge":e.type==="touch"||e.type==="pen"?this.controlMode="touchswipe":e.type==="mouse"?this.controlMode=this.env.eventSys.mouse.isPointerLocked?"mousefirstperson":"mousedrag":Ir(e.type))}gestureSatisfied(e){return this.controlMode==="none"?!1:this.controlMode==="gamepad"||this.controlMode==="mousefirstperson"||this.controlMode==="mouseedge"||e.isPressed(0)}get name(){return this.object.name}set name(e){this.object.name=e}get heading(){return this._heading}setHeading(e){this._heading=Mn(e)}get pitch(){return this._pitch}setPitch(e,r,i){this._pitch=Mn(e+Math.PI)-Math.PI,this._pitch=Tn(this._pitch,r,i)}get roll(){return this._roll}setRoll(e){this._roll=Mn(e)}setHeadingImmediate(e){this.setHeading(e),this.updateOrientation(),this.resetFollowers()}setOrientationImmediate(e,r){this.setHeading(e),this._pitch=Mn(r),this.updateOrientation()}zoom(e){this.dz=e}update(e){if(this.fovZoomEnabled&&Math.abs(this.dz)>0){let o=Math.pow(.95,5*e);this.dz=Bu(o*this.dz),this.fov=Tn(this.env.camera.fov-this.dz,this.minFOV,this.maxFOV)}e*=.001;let r=this.deviceOrientation;if(r&&He(r.alpha)&&He(r.beta)&&He(r.gamma)){let o=et(r.alpha)+this.alphaOffset,s=et(r.beta),p=et(r.gamma),c=this.screenOrientation?et(this.screenOrientation):0;this.E.set(s,o,-p,"YXZ"),this.Q2.setFromAxisAngle(this.B,-c),this.Q4.setFromEuler(this.E).multiply(this.Q3).multiply(this.Q2),this.deviceQ.slerp(this.Q4,.8)}if(this.controlMode==="mouseedge")this.uv.manhattanLength()>0&&(this.motion.set(this.scaleRadialComponent(-this.uv.x,this.speed.x,this.acceleration.x),this.scaleRadialComponent(this.uv.y,this.speed.y,this.acceleration.y)).multiplyScalar(e),this.setHeading(this.heading+this.motion.x),this.setPitch(this.pitch+this.motion.y,this.minimumX,this.maximumX),this.setRoll(0));else if(this.sensitivities.has(this.controlMode)&&this.duv.manhattanLength()>0){let o=this.sensitivities.get(this.controlMode)||1;this.motion.copy(this.duv).multiplyScalar(o*e).multiply(this.axisControl),this.setHeading(this.heading+this.motion.x),this.setPitch(this.pitch+this.motion.y,this.minimumX,this.maximumX),this.setRoll(0)}if(this.Q1.setFromAxisAngle(this.stage.up,this.worldHeading),this.fwrd||this.back||this.left||this.rght||this.up||this.down){let o=(this.left?1:0)+(this.rght?-1:0),s=(this.down?1:0)+(this.up?-1:0),p=(this.fwrd?1:0)+(this.back?-1:0);this.move.set(o,s,p);let c=this.move.length();c>0&&(this.move.multiplyScalar(e/c).applyQuaternion(this.Q1),this.stage.position.add(this.move))}if(this.fwrd2||this.back2||this.left2||this.rght2){let o=(this.left2?1:0)+(this.rght2?-1:0),s=(this.fwrd2?1:0)+(this.back2?-1:0);this.move2.set(o,0,s);let p=this.move2.length();p>0&&(this.move2.multiplyScalar(e/p).applyQuaternion(this.Q1),this.headX+=this.move2.x,this.headZ+=this.move2.z)}if(this.grow||this.shrk){let o=(this.shrk?-1:0)+(this.grow?1:0);this._height+=o*e,this._height=Tn(this._height,1,2)}this.updateOrientation(),this.userMovedEvt.set(this.P.x,this.P.y,this.P.z,this.F.x,this.F.y,this.F.z,this.U.x,this.U.y,this.U.z,this.height),this.dispatchEvent(this.userMovedEvt);let i=Math.pow(.95,100*e);this.duv.multiplyScalar(i),this.duv.manhattanLength()<=1e-4&&this.duv.setScalar(0)}scaleRadialComponent(e,r,i){let o=Math.abs(e);return Math.sign(e)*Math.pow(Math.max(0,o-this.edgeFactor)/(1-this.edgeFactor),i)*r}updateOrientation(){let e=mr(this.env.renderer,this.env.camera);this.rotStage.makeRotationY(this._heading),this.stage.matrix.makeTranslation(this.stage.position.x,this.stage.position.y,this.stage.position.z).multiply(this.rotStage),this.stage.matrix.decompose(this.stage.position,this.stage.quaternion,this.stage.scale),this.env.renderer.xr.isPresenting?(this.M.copy(this.stage.matrixWorld).invert(),this.head.position.copy(e.position).applyMatrix4(this.M),this.head.quaternion.copy(this.stage.quaternion).invert().multiply(e.quaternion)):(this.head.position.set(this.headX,this._height,this.headZ),this.E.set(this._pitch,0,this._roll,"XYZ"),this.head.quaternion.setFromEuler(this.E).premultiply(this.deviceQ)),this.env.camera.position.copy(this.head.position),this.env.camera.quaternion.copy(this.head.quaternion),this.head.getWorldPosition(this.worldPos),this.head.getWorldQuaternion(this.worldQuat),this.F.set(0,0,-1).applyQuaternion(this.worldQuat),this._worldHeading=ca(this.F),this._worldPitch=Vh(this.F),kh(this.head.matrixWorld,this.R,this.U,this.F,this.P)}reset(){this.stage.position.setScalar(0),this.setHeadingImmediate(0)}resetFollowers(){for(let e of this.followers)e.reset(this.height,this.worldPos,this.worldHeading)}async getPermission(){return"DeviceOrientationEvent"in globalThis?sA(DeviceOrientationEvent)?await DeviceOrientationEvent.requestPermission():"granted":"not-supported"}async startMotionControl(){if(!this.motionEnabled){this.onScreenOrientationChangeEvent();let e=await this.getPermission();this.motionEnabled=e==="granted",this.motionEnabled&&(globalThis.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),globalThis.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}}stopMotionControl(){this.motionEnabled&&(globalThis.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),globalThis.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.motionEnabled=!1)}dispose(){this.stopMotionControl()}};var Aa=0;var mi=3;function Bh(n,t){n=Ke(n),n.traverse(e=>e.layers.set(t))}function Fh(n,t){n=Ke(n),n.traverse(e=>e.layers.enable(t))}var hi=new k;function Nh(n,t,e,r){hi.crossVectors(t,n),n.crossVectors(hi,t),hi.normalize(),n.normalize(),t.normalize(),r.set(hi.x,n.x,-t.x,e.x,hi.y,n.y,-t.y,e.y,hi.z,n.z,-t.z,e.z,0,0,0,1)}var Bt=class{constructor(t){this.env=t;this._object=null;this._visible=!0;this._style="default";this.T=new k;this.V=new k;this.Q=new ce;this._side=-1}get side(){return this._side}set side(t){this._side=t}get object(){return this._object}set object(t){this._object=t}get style(){return this._style}set style(t){this._style=t}get visible(){return this._visible}set visible(t){this._visible=t}update(t,e,r,i,o,s,p,c,u,h,x){r&&r.face?(this.position.copy(r.point),r.object.getWorldQuaternion(this.Q),this.T.copy(r.face.normal).applyQuaternion(this.Q),this.V.copy(this.T).multiplyScalar(.02),this.position.add(this.V),this.V.copy(this.T).multiplyScalar(10).add(this.position)):(s?this.position.copy(h).multiplyScalar(2).add(u).sub(this.env.avatar.worldPos).normalize().multiplyScalar(o).add(this.env.avatar.worldPos):(this.V.copy(u).add(e).sub(t).multiplyScalar(2),this.position.copy(h).multiplyScalar(o).add(this.V).add(this.env.avatar.worldPos)),this.V.copy(this.env.avatar.worldPos)),this.lookAt(this.position,this.V),this.style=!i||i.navigable&&!c?p?x?"grabbing":"grab":"default":i.enabled?i.draggable?x?"grabbing":"move":i.navigable?"cell":i.clickable?"pointer":"default":"not-allowed"}lookAt(t,e){}};var fi=class extends Bt{constructor(e,r){super(e);this.cursorSystem=null;this.f=new k;this.up=new k;this.right=new k;this.object=de("Cursor3D"),this.cursorSystem=r,this.object.matrixAutoUpdate=!1}add(e,r){j(this,r),Fh(r,mi),r.visible=e==="default"}get position(){return this.object.position}get style(){for(let e of this.object.children)if(e.visible)return e.name;return null}set style(e){for(let r of this.object.children)r.visible=r.name===e;if(this.style==null&&this.object.children.length>0){let r=Lt(this.object.children,i=>i.name==="default",i=>i!=null);r!=null&&(r.visible=!0)}this.cursorSystem&&(this.cursorSystem.style="none")}get visible(){return ei(this)}set visible(e){ke(this,e)}lookAt(e,r){this.f.copy(r).sub(e).multiplyScalar(this.side).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat),this.right.crossVectors(this.up,this.f),this.up.crossVectors(this.f,this.right),Nh(this.up,this.f,e,this.object.matrixWorld),this.object.matrix.copy(this.object.parent.matrixWorld).invert().multiply(this.object.matrixWorld),this.object.matrix.decompose(this.object.position,this.object.quaternion,this.object.scale)}clone(){let e=new fi(this.env);for(let r of this.object.children)e.add(r.name,r.clone());return e}};var _a=class extends q{constructor(e,r){super(e);this.button=r}},kp=class extends _a{constructor(t){super("gamepadbuttonup",t)}},Bp=class extends _a{constructor(t){super("gamepadbuttondown",t)}},Fp=class extends q{constructor(e,r,i){super(e);this.axis=r;this.value=i}},Np=class extends Fp{constructor(t,e){super("gamepadaxismaxed",t,e)}},ba=class extends ${constructor(){super();this.lastAxisValues=new Array;this.btnDownEvts=new Array;this.btnUpEvts=new Array;this.wasPressed=new Array;this.axisMaxEvts=new Array;this.wasAxisMaxed=new Array;this.sticks=new Array;this.axisThresholdMax=.9;this.axisThresholdMin=.1;this._pad=null;Object.seal(this)}get displayId(){if("displayId"in this.pad)return this.pad.displayId}get pad(){return this._pad}set pad(e){if(this._pad=e,this.pad){if(this.btnUpEvts.length===0){for(let r=0;r<e.buttons.length;++r)this.btnDownEvts[r]=new Bp(r),this.btnUpEvts[r]=new kp(r),this.wasPressed[r]=!1;for(let r=0;r<e.axes.length;++r)this.axisMaxEvts[r]=new Np(r,0),this.wasAxisMaxed[r]=!1,r%2===0&&r<e.axes.length-1&&(this.sticks[r/2]={x:0,y:0}),this.lastAxisValues[r]=e.axes[r]}for(let r=0;r<this.pad.buttons.length;++r){let i=this.wasPressed[r],o=this.pad.buttons[r].pressed;o!==i&&(this.wasPressed[r]=o,this.dispatchEvent((o?this.btnDownEvts:this.btnUpEvts)[r]))}for(let r=0;r<this.pad.axes.length;++r){let i=this.wasAxisMaxed[r],o=this.pad.axes[r],s=Math.sign(o),p=Math.abs(o),c=p>=this.axisThresholdMax,u=p<=this.axisThresholdMin,h=s*(c?1:u?0:p);c&&!i&&(this.axisMaxEvts[r].value=h,this.dispatchEvent(this.axisMaxEvts[r])),this.wasAxisMaxed[r]=c,this.lastAxisValues[r]=h}for(let r=0;r<this.axes.length-1;r+=2){let i=this.sticks[r/2];i.x=this.axes[r],i.y=this.axes[r+1]}}}get id(){return this.pad?this.pad.id:null}get index(){return this.pad?this.pad.index:null}get connected(){return this.pad&&this.pad.connected}get mapping(){return this.pad?this.pad.mapping:null}get timestamp(){return this.pad?this.pad.timestamp:null}get hand(){return this.pad?this.pad.hand:null}get pose(){return this.pad?this.pad.pose:null}get buttons(){return this.pad?this.pad.buttons:null}get axes(){return this.pad?this.pad.axes:null}get hapticActuators(){return this.pad?this.pad.hapticActuators:null}};var Dn=class extends mm{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new Gp(e)}),this.register(function(e){return new Kp(e)}),this.register(function(e){return new Yp(e)}),this.register(function(e){return new Up(e)}),this.register(function(e){return new jp(e)}),this.register(function(e){return new Wp(e)}),this.register(function(e){return new Qp(e)}),this.register(function(e){return new qp(e)}),this.register(function(e){return new zp(e)}),this.register(function(e){return new Jp(e)})}load(t,e,r,i){let o=this,s;this.resourcePath!==""?s=this.resourcePath:this.path!==""?s=this.path:s=Pn.extractUrlBase(t),this.manager.itemStart(t);let p=function(u){i?i(u):console.error(u),o.manager.itemError(t),o.manager.itemEnd(t)},c=new tp(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,function(u){try{o.parse(u,s,function(h){e(h),o.manager.itemEnd(t)},p)}catch(h){p(h)}},r,p)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,r,i){let o,s={},p={};if(typeof t=="string")o=t;else if(Pn.decodeText(new Uint8Array(t,0,4))===Qh){try{s[J.KHR_BINARY_GLTF]=new $p(t)}catch(x){i&&i(x);return}o=s[J.KHR_BINARY_GLTF].content}else o=Pn.decodeText(new Uint8Array(t));let c=JSON.parse(o);if(c.asset===void 0||c.asset.version[0]<2){i&&i(new Error("GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let u=new sc(c,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){let x=this.pluginCallbacks[h](u);p[x.name]=x,s[x.name]=!0}if(c.extensionsUsed)for(let h=0;h<c.extensionsUsed.length;++h){let x=c.extensionsUsed[h],b=c.extensionsRequired||[];switch(x){case J.KHR_MATERIALS_UNLIT:s[x]=new Hp;break;case J.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[x]=new tc;break;case J.KHR_DRACO_MESH_COMPRESSION:s[x]=new Zp(c,this.dracoLoader);break;case J.KHR_TEXTURE_TRANSFORM:s[x]=new ec;break;case J.KHR_MESH_QUANTIZATION:s[x]=new nc;break;default:b.indexOf(x)>=0&&p[x]===void 0&&console.warn('GLTFLoader: Unknown extension "'+x+'".')}}u.setExtensions(s),u.setPlugins(p),u.parse(r,i)}parseAsync(t,e){let r=this;return new Promise(function(i,o){r.parse(t,e,i,o)})}};function aA(){let n={};return{get:function(t){return n[t]},add:function(t,e){n[t]=e},remove:function(t){delete n[t]},removeAll:function(){n={}}}}var J={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},zp=class{constructor(t){this.parser=t,this.name=J.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let t=this.parser,e=this.parser.json.nodes||[];for(let r=0,i=e.length;r<i;r++){let o=e[r];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(t){let e=this.parser,r="light:"+t,i=e.cache.get(r);if(i)return i;let o=e.json,c=((o.extensions&&o.extensions[this.name]||{}).lights||[])[t],u,h=new be(16777215);c.color!==void 0&&h.fromArray(c.color);let x=c.range!==void 0?c.range:0;switch(c.type){case"directional":u=new Ls(h),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new bm(h),u.distance=x;break;case"spot":u=new Pm(h),u.distance=x,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,u.angle=c.spot.outerConeAngle,u.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("GLTFLoader: Unexpected light type: "+c.type)}return u.position.set(0,0,0),u.decay=2,c.intensity!==void 0&&(u.intensity=c.intensity),u.name=e.createUniqueName(c.name||"light_"+t),i=Promise.resolve(u),e.cache.add(r,i),i}createNodeAttachment(t){let e=this,r=this.parser,o=r.json.nodes[t],p=(o.extensions&&o.extensions[this.name]||{}).light;return p===void 0?null:this._loadLight(p).then(function(c){return r._getNodeRef(e.cache,p,c)})}},Hp=class{constructor(){this.name=J.KHR_MATERIALS_UNLIT}getMaterialType(){return qe}extendParams(t,e,r){let i=[];t.color=new be(1,1,1),t.opacity=1;let o=e.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){let s=o.baseColorFactor;t.color.fromArray(s),t.opacity=s[3]}o.baseColorTexture!==void 0&&i.push(r.assignTexture(t,"map",o.baseColorTexture))}return Promise.all(i)}},Gp=class{constructor(t){this.parser=t,this.name=J.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:or}extendMaterialParams(t,e){let r=this.parser,i=r.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];if(s.clearcoatFactor!==void 0&&(e.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&o.push(r.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&o.push(r.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(o.push(r.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){let p=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Re(p,p)}return Promise.all(o)}},Up=class{constructor(t){this.parser=t,this.name=J.KHR_MATERIALS_SHEEN}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:or}extendMaterialParams(t,e){let r=this.parser,i=r.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[];e.sheenColor=new be(0,0,0),e.sheenRoughness=0,e.sheen=1;let s=i.extensions[this.name];return s.sheenColorFactor!==void 0&&e.sheenColor.fromArray(s.sheenColorFactor),s.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&o.push(r.assignTexture(e,"sheenColorMap",s.sheenColorTexture)),s.sheenRoughnessTexture!==void 0&&o.push(r.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(o)}},jp=class{constructor(t){this.parser=t,this.name=J.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:or}extendMaterialParams(t,e){let r=this.parser,i=r.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];return s.transmissionFactor!==void 0&&(e.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&o.push(r.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(o)}},Wp=class{constructor(t){this.parser=t,this.name=J.KHR_MATERIALS_VOLUME}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:or}extendMaterialParams(t,e){let r=this.parser,i=r.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];e.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&o.push(r.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||0;let p=s.attenuationColor||[1,1,1];return e.attenuationColor=new be(p[0],p[1],p[2]),Promise.all(o)}},Qp=class{constructor(t){this.parser=t,this.name=J.KHR_MATERIALS_IOR}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:or}extendMaterialParams(t,e){let i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=i.extensions[this.name];return e.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}},qp=class{constructor(t){this.parser=t,this.name=J.KHR_MATERIALS_SPECULAR}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:or}extendMaterialParams(t,e){let r=this.parser,i=r.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];e.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&o.push(r.assignTexture(e,"specularIntensityMap",s.specularTexture));let p=s.specularColorFactor||[1,1,1];return e.specularColor=new be(p[0],p[1],p[2]),s.specularColorTexture!==void 0&&o.push(r.assignTexture(e,"specularColorMap",s.specularColorTexture).then(function(c){c.encoding=Hs})),Promise.all(o)}},Kp=class{constructor(t){this.parser=t,this.name=J.KHR_TEXTURE_BASISU}loadTexture(t){let e=this.parser,r=e.json,i=r.textures[t];if(!i.extensions||!i.extensions[this.name])return null;let o=i.extensions[this.name],s=r.images[o.source],p=e.options.ktx2Loader;if(!p){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,s,p)}},Yp=class{constructor(t){this.parser=t,this.name=J.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){let e=this.name,r=this.parser,i=r.json,o=i.textures[t];if(!o.extensions||!o.extensions[e])return null;let s=o.extensions[e],p=i.images[s.source],c=r.textureLoader;if(p.uri){let u=r.options.manager.getHandler(p.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return r.loadTextureImage(t,p,c);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){let e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}},Jp=class{constructor(t){this.name=J.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){let e=this.parser.json,r=e.bufferViews[t];if(r.extensions&&r.extensions[this.name]){let i=r.extensions[this.name],o=this.parser.getDependency("buffer",i.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([o,s.ready]).then(function(p){let c=i.byteOffset||0,u=i.byteLength||0,h=i.count,x=i.byteStride,b=new ArrayBuffer(h*x),E=new Uint8Array(p[0],c,u);return s.decodeGltfBuffer(new Uint8Array(b),h,x,E,i.mode,i.filter),b})}else return null}},Qh="glTF",fo=12,Xh={JSON:1313821514,BIN:5130562},$p=class{constructor(t){this.name=J.KHR_BINARY_GLTF,this.content=null,this.body=null;let e=new DataView(t,0,fo);if(this.header={magic:Pn.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Qh)throw new Error("GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("GLTFLoader: Legacy binary file detected.");let r=this.header.length-fo,i=new DataView(t,fo),o=0;for(;o<r;){let s=i.getUint32(o,!0);o+=4;let p=i.getUint32(o,!0);if(o+=4,p===Xh.JSON){let c=new Uint8Array(t,fo+o,s);this.content=Pn.decodeText(c)}else if(p===Xh.BIN){let c=fo+o;this.body=t.slice(c,c+s)}o+=s}if(this.content===null)throw new Error("GLTFLoader: JSON content not found.")}},Zp=class{constructor(t,e){if(!e)throw new Error("GLTFLoader: No DRACOLoader instance provided.");this.name=J.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){let r=this.json,i=this.dracoLoader,o=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,p={},c={},u={};for(let h in s){let x=ic[h]||h.toLowerCase();p[x]=s[h]}for(let h in t.attributes){let x=ic[h]||h.toLowerCase();if(s[h]!==void 0){let b=r.accessors[t.attributes[h]],E=go[b.componentType];u[x]=E,c[x]=b.normalized===!0}}return e.getDependency("bufferView",o).then(function(h){return new Promise(function(x){i.decodeDracoFile(h,function(b){for(let E in b.attributes){let R=b.attributes[E],P=c[E];P!==void 0&&(R.normalized=P)}x(b)},p,u)})})}},ec=class{constructor(){this.name=J.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return e.texCoord!==void 0&&console.warn('GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}},vo=class extends $r{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;let e=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),r=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),p={specular:{value:new be().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=p,this.onBeforeCompile=function(c){for(let u in p)c.uniforms[u]=p[u];c.fragmentShader=c.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return p.specular.value},set:function(c){p.specular.value=c}},specularMap:{get:function(){return p.specularMap.value},set:function(c){p.specularMap.value=c,c?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return p.glossiness.value},set:function(c){p.glossiness.value=c}},glossinessMap:{get:function(){return p.glossinessMap.value},set:function(c){p.glossinessMap.value=c,c?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}},tc=class{constructor(){this.name=J.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return vo}extendParams(t,e,r){let i=e.extensions[this.name];t.color=new be(1,1,1),t.opacity=1;let o=[];if(Array.isArray(i.diffuseFactor)){let s=i.diffuseFactor;t.color.fromArray(s),t.opacity=s[3]}if(i.diffuseTexture!==void 0&&o.push(r.assignTexture(t,"map",i.diffuseTexture)),t.emissive=new be(0,0,0),t.glossiness=i.glossinessFactor!==void 0?i.glossinessFactor:1,t.specular=new be(1,1,1),Array.isArray(i.specularFactor)&&t.specular.fromArray(i.specularFactor),i.specularGlossinessTexture!==void 0){let s=i.specularGlossinessTexture;o.push(r.assignTexture(t,"glossinessMap",s)),o.push(r.assignTexture(t,"specularMap",s))}return Promise.all(o)}createMaterial(t){let e=new vo(t);return e.fog=!0,e.color=t.color,e.map=t.map===void 0?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=t.aoMap===void 0?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=t.emissiveMap===void 0?null:t.emissiveMap,e.bumpMap=t.bumpMap===void 0?null:t.bumpMap,e.bumpScale=1,e.normalMap=t.normalMap===void 0?null:t.normalMap,e.normalMapType=Rm,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=t.specularMap===void 0?null:t.specularMap,e.specular=t.specular,e.glossinessMap=t.glossinessMap===void 0?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=t.envMap===void 0?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}},nc=class{constructor(){this.name=J.KHR_MESH_QUANTIZATION}},nn=class extends sm{constructor(t,e,r,i){super(t,e,r,i)}copySampleValue_(t){let e=this.resultBuffer,r=this.sampleValues,i=this.valueSize,o=t*i*3+i;for(let s=0;s!==i;s++)e[s]=r[o+s];return e}};nn.prototype.beforeStart_=nn.prototype.copySampleValue_;nn.prototype.afterEnd_=nn.prototype.copySampleValue_;nn.prototype.interpolate_=function(n,t,e,r){let i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,p=s*2,c=s*3,u=r-t,h=(e-t)/u,x=h*h,b=x*h,E=n*c,R=E-c,P=-2*b+3*x,T=b-x,D=1-P,O=T-x+h;for(let I=0;I!==s;I++){let X=o[R+I+s],z=o[R+I+p]*u,V=o[E+I+s],F=o[E+I]*u;i[I]=D*X+O*z+P*V+T*F}return i};var lA=new ce,rc=class extends nn{interpolate_(t,e,r,i){let o=super.interpolate_(t,e,r,i);return lA.fromArray(o).normalize().toArray(o),o}},tn={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},go={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},zh={9728:xm,9729:op,9984:gm,9985:um,9986:vm,9987:sp},Hh={33071:qu,33648:fm,10497:Ns},Gh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ic={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ln={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},pA={CUBICSPLINE:void 0,LINEAR:rp,STEP:am},Xp={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function cA(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new $r({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ds})),n.DefaultMaterial}function xo(n,t,e){for(let r in e.extensions)n[r]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=e.extensions[r])}function hr(n,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(n.userData,t.extras):console.warn("GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function dA(n,t,e){let r=!1,i=!1;for(let p=0,c=t.length;p<c;p++){let u=t[p];if(u.POSITION!==void 0&&(r=!0),u.NORMAL!==void 0&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(n);let o=[],s=[];for(let p=0,c=t.length;p<c;p++){let u=t[p];if(r){let h=u.POSITION!==void 0?e.getDependency("accessor",u.POSITION):n.attributes.position;o.push(h)}if(i){let h=u.NORMAL!==void 0?e.getDependency("accessor",u.NORMAL):n.attributes.normal;s.push(h)}}return Promise.all([Promise.all(o),Promise.all(s)]).then(function(p){let c=p[0],u=p[1];return r&&(n.morphAttributes.position=c),i&&(n.morphAttributes.normal=u),n.morphTargetsRelative=!0,n})}function uA(n,t){if(n.updateMorphTargets(),t.weights!==void 0)for(let e=0,r=t.weights.length;e<r;e++)n.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){let e=t.extras.targetNames;if(n.morphTargetInfluences.length===e.length){n.morphTargetDictionary={};for(let r=0,i=e.length;r<i;r++)n.morphTargetDictionary[e[r]]=r}else console.warn("GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function mA(n){let t=n.extensions&&n.extensions[J.KHR_DRACO_MESH_COMPRESSION],e;return t?e="draco:"+t.bufferView+":"+t.indices+":"+Uh(t.attributes):e=n.indices+":"+Uh(n.attributes)+":"+n.mode,e}function Uh(n){let t="",e=Object.keys(n).sort();for(let r=0,i=e.length;r<i;r++)t+=e[r]+":"+n[e[r]]+";";return t}function oc(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("GLTFLoader: Unsupported normalized accessor component type.")}}var sc=class{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new aA,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap<"u"&&/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!1?this.textureLoader=new nm(this.options.manager):this.textureLoader=new Vm(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new tp(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){let r=this,i=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(s){let p={scene:s[0][i.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:i.asset,parser:r,userData:{}};xo(o,p,i),hr(p,i),Promise.all(r._invokeAll(function(c){return c.afterRoot&&c.afterRoot(p)})).then(function(){t(p)})}).catch(e)}_markDefs(){let t=this.json.nodes||[],e=this.json.skins||[],r=this.json.meshes||[];for(let i=0,o=e.length;i<o;i++){let s=e[i].joints;for(let p=0,c=s.length;p<c;p++)t[s[p]].isBone=!0}for(let i=0,o=t.length;i<o;i++){let s=t[i];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(r[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,r){if(t.refs[e]<=1)return r;let i=r.clone(),o=(s,p)=>{let c=this.associations.get(s);c!=null&&this.associations.set(p,c);for(let[u,h]of s.children.entries())o(h,p.children[u])};return o(r,i),i.name+="_instance_"+t.uses[e]++,i}_invokeOne(t){let e=Object.values(this.plugins);e.push(this);for(let r=0;r<e.length;r++){let i=t(e[r]);if(i)return i}return null}_invokeAll(t){let e=Object.values(this.plugins);e.unshift(this);let r=[];for(let i=0;i<e.length;i++){let o=t(e[i]);o&&r.push(o)}return r}getDependency(t,e){let r=t+":"+e,i=this.cache.get(r);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this.loadNode(e);break;case"mesh":i=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(e)});break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(e)});break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(e)});break;case"texture":i=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(e)});break;case"skin":i=this.loadSkin(e);break;case"animation":i=this.loadAnimation(e);break;case"camera":i=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(r,i)}return i}getDependencies(t){let e=this.cache.get(t);if(!e){let r=this,i=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(i.map(function(o,s){return r.getDependency(t,s)})),this.cache.add(t,e)}return e}loadBuffer(t){let e=this.json.buffers[t],r=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[J.KHR_BINARY_GLTF].body);let i=this.options;return new Promise(function(o,s){r.load(Pn.resolveURL(e.uri,i.path),o,void 0,function(){s(new Error('GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){let e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(r){let i=e.byteLength||0,o=e.byteOffset||0;return r.slice(o,o+i)})}loadAccessor(t){let e=this,r=this.json,i=this.json.accessors[t];if(i.bufferView===void 0&&i.sparse===void 0)return Promise.resolve(null);let o=[];return i.bufferView!==void 0?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),i.sparse!==void 0&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then(function(s){let p=s[0],c=Gh[i.type],u=go[i.componentType],h=u.BYTES_PER_ELEMENT,x=h*c,b=i.byteOffset||0,E=i.bufferView!==void 0?r.bufferViews[i.bufferView].byteStride:void 0,R=i.normalized===!0,P,T;if(E&&E!==x){let D=Math.floor(b/E),O="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+D+":"+i.count,I=e.cache.get(O);I||(P=new u(p,D*E,i.count*E/h),I=new om(P,E/h),e.cache.add(O,I)),T=new Ot(I,c,b%E/h,R)}else p===null?P=new u(i.count*c):P=new u(p,b,i.count*c),T=new ir(P,c,R);if(i.sparse!==void 0){let D=Gh.SCALAR,O=go[i.sparse.indices.componentType],I=i.sparse.indices.byteOffset||0,X=i.sparse.values.byteOffset||0,z=new O(s[1],I,i.sparse.count*D),V=new u(s[2],X,i.sparse.count*c);p!==null&&(T=new ir(T.array.slice(),T.itemSize,T.normalized));for(let F=0,ie=z.length;F<ie;F++){let oe=z[F];if(T.setX(oe,V[F*c]),c>=2&&T.setY(oe,V[F*c+1]),c>=3&&T.setZ(oe,V[F*c+2]),c>=4&&T.setW(oe,V[F*c+3]),c>=5)throw new Error("GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return T})}loadTexture(t){let e=this.json,r=this.options,i=e.textures[t],o=e.images[i.source],s=this.textureLoader;if(o.uri){let p=r.manager.getHandler(o.uri);p!==null&&(s=p)}return this.loadTextureImage(t,o,s)}loadTextureImage(t,e,r){let i=this,o=this.json,s=this.options,p=o.textures[t],c=(e.uri||e.bufferView)+":"+p.sampler;if(this.textureCache[c])return this.textureCache[c];let u=self.URL||self.webkitURL,h=e.uri||"",x=!1;if(e.bufferView!==void 0)h=i.getDependency("bufferView",e.bufferView).then(function(E){x=!0;let R=new Blob([E],{type:e.mimeType});return h=u.createObjectURL(R),h});else if(e.uri===void 0)throw new Error("GLTFLoader: Image "+t+" is missing URI and bufferView");let b=Promise.resolve(h).then(function(E){return new Promise(function(R,P){let T=R;r.isImageBitmapLoader===!0&&(T=function(D){let O=new ro(D);O.needsUpdate=!0,R(O)}),r.load(Pn.resolveURL(E,s.path),T,void 0,P)})}).then(function(E){x===!0&&u.revokeObjectURL(h),E.flipY=!1,p.name&&(E.name=p.name);let P=(o.samplers||{})[p.sampler]||{};return E.magFilter=zh[P.magFilter]||op,E.minFilter=zh[P.minFilter]||sp,E.wrapS=Hh[P.wrapS]||Ns,E.wrapT=Hh[P.wrapT]||Ns,i.associations.set(E,{textures:t}),E}).catch(function(){return console.error("GLTFLoader: Couldn't load texture",h),null});return this.textureCache[c]=b,b}assignTexture(t,e,r){let i=this;return this.getDependency("texture",r.index).then(function(o){if(r.texCoord!==void 0&&r.texCoord!=0&&!(e==="aoMap"&&r.texCoord==1)&&console.warn("GLTFLoader: Custom UV set "+r.texCoord+" for texture "+e+" not yet supported."),i.extensions[J.KHR_TEXTURE_TRANSFORM]){let s=r.extensions!==void 0?r.extensions[J.KHR_TEXTURE_TRANSFORM]:void 0;if(s){let p=i.associations.get(o);o=i.extensions[J.KHR_TEXTURE_TRANSFORM].extendTexture(o,s),i.associations.set(o,p)}}return t[e]=o,o})}assignFinalMaterial(t){let e=t.geometry,r=t.material,i=e.attributes.tangent===void 0,o=e.attributes.color!==void 0,s=e.attributes.normal===void 0;if(t.isPoints){let p="PointsMaterial:"+r.uuid,c=this.cache.get(p);c||(c=new Em,ks.prototype.copy.call(c,r),c.color.copy(r.color),c.map=r.map,c.sizeAttenuation=!1,this.cache.add(p,c)),r=c}else if(t.isLine){let p="LineBasicMaterial:"+r.uuid,c=this.cache.get(p);c||(c=new ip,ks.prototype.copy.call(c,r),c.color.copy(r.color),this.cache.add(p,c)),r=c}if(i||o||s){let p="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(p+="specular-glossiness:"),i&&(p+="derivative-tangents:"),o&&(p+="vertex-colors:"),s&&(p+="flat-shading:");let c=this.cache.get(p);c||(c=r.clone(),o&&(c.vertexColors=!0),s&&(c.flatShading=!0),i&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(p,c),this.associations.set(c,this.associations.get(r))),r=c}r.aoMap&&e.attributes.uv2===void 0&&e.attributes.uv!==void 0&&e.setAttribute("uv2",e.attributes.uv),t.material=r}getMaterialType(){return $r}loadMaterial(t){let e=this,r=this.json,i=this.extensions,o=r.materials[t],s,p={},c=o.extensions||{},u=[];if(c[J.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){let x=i[J.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=x.getMaterialType(),u.push(x.extendParams(p,o,e))}else if(c[J.KHR_MATERIALS_UNLIT]){let x=i[J.KHR_MATERIALS_UNLIT];s=x.getMaterialType(),u.push(x.extendParams(p,o,e))}else{let x=o.pbrMetallicRoughness||{};if(p.color=new be(1,1,1),p.opacity=1,Array.isArray(x.baseColorFactor)){let b=x.baseColorFactor;p.color.fromArray(b),p.opacity=b[3]}x.baseColorTexture!==void 0&&u.push(e.assignTexture(p,"map",x.baseColorTexture)),p.metalness=x.metallicFactor!==void 0?x.metallicFactor:1,p.roughness=x.roughnessFactor!==void 0?x.roughnessFactor:1,x.metallicRoughnessTexture!==void 0&&(u.push(e.assignTexture(p,"metalnessMap",x.metallicRoughnessTexture)),u.push(e.assignTexture(p,"roughnessMap",x.metallicRoughnessTexture))),s=this._invokeOne(function(b){return b.getMaterialType&&b.getMaterialType(t)}),u.push(Promise.all(this._invokeAll(function(b){return b.extendMaterialParams&&b.extendMaterialParams(t,p)})))}o.doubleSided===!0&&(p.side=$u);let h=o.alphaMode||Xp.OPAQUE;if(h===Xp.BLEND?(p.transparent=!0,p.depthWrite=!1):(p.transparent=!1,h===Xp.MASK&&(p.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&s!==qe&&(u.push(e.assignTexture(p,"normalMap",o.normalTexture)),p.normalScale=new Re(1,1),o.normalTexture.scale!==void 0)){let x=o.normalTexture.scale;p.normalScale.set(x,x)}return o.occlusionTexture!==void 0&&s!==qe&&(u.push(e.assignTexture(p,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(p.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&s!==qe&&(p.emissive=new be().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&s!==qe&&u.push(e.assignTexture(p,"emissiveMap",o.emissiveTexture)),Promise.all(u).then(function(){let x;return s===vo?x=i[J.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(p):x=new s(p),o.name&&(x.name=o.name),x.map&&(x.map.encoding=Hs),x.emissiveMap&&(x.emissiveMap.encoding=Hs),hr(x,o),e.associations.set(x,{materials:t}),o.extensions&&xo(i,x,o),x})}createUniqueName(t){let e=wm.sanitizeNodeName(t||""),r=e;for(let i=1;this.nodeNamesUsed[r];++i)r=e+"_"+i;return this.nodeNamesUsed[r]=!0,r}loadGeometries(t){let e=this,r=this.extensions,i=this.primitiveCache;function o(p){return r[J.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(p,e).then(function(c){return jh(c,p,e)})}let s=[];for(let p=0,c=t.length;p<c;p++){let u=t[p],h=mA(u),x=i[h];if(x)s.push(x.promise);else{let b;u.extensions&&u.extensions[J.KHR_DRACO_MESH_COMPRESSION]?b=o(u):b=jh(new Is,u,e),i[h]={primitive:u,promise:b},s.push(b)}}return Promise.all(s)}loadMesh(t){let e=this,r=this.json,i=this.extensions,o=r.meshes[t],s=o.primitives,p=[];for(let c=0,u=s.length;c<u;c++){let h=s[c].material===void 0?cA(this.cache):this.getDependency("material",s[c].material);p.push(h)}return p.push(e.loadGeometries(s)),Promise.all(p).then(function(c){let u=c.slice(0,c.length-1),h=c[c.length-1],x=[];for(let E=0,R=h.length;E<R;E++){let P=h[E],T=s[E],D,O=u[E];if(T.mode===tn.TRIANGLES||T.mode===tn.TRIANGLE_STRIP||T.mode===tn.TRIANGLE_FAN||T.mode===void 0)D=o.isSkinnedMesh===!0?new Cm(P,O):new yt(P,O),D.isSkinnedMesh===!0&&!D.geometry.attributes.skinWeight.normalized&&D.normalizeSkinWeights(),T.mode===tn.TRIANGLE_STRIP?D.geometry=Wh(D.geometry,Im):T.mode===tn.TRIANGLE_FAN&&(D.geometry=Wh(D.geometry,lp));else if(T.mode===tn.LINES)D=new dm(P,O);else if(T.mode===tn.LINE_STRIP)D=new lm(P,O);else if(T.mode===tn.LINE_LOOP)D=new cm(P,O);else if(T.mode===tn.POINTS)D=new ym(P,O);else throw new Error("GLTFLoader: Primitive mode unsupported: "+T.mode);Object.keys(D.geometry.morphAttributes).length>0&&uA(D,o),D.name=e.createUniqueName(o.name||"mesh_"+t),hr(D,o),T.extensions&&xo(i,D,T),e.assignFinalMaterial(D),x.push(D)}for(let E=0,R=x.length;E<R;E++)e.associations.set(x[E],{meshes:t,primitives:E});if(x.length===1)return x[0];let b=new Os;e.associations.set(b,{meshes:t});for(let E=0,R=x.length;E<R;E++)b.add(x[E]);return b})}loadCamera(t){let e,r=this.json.cameras[t],i=r[r.type];if(!i){console.warn("GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?e=new to(Bs.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):r.type==="orthographic"&&(e=new _m(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(e.name=this.createUniqueName(r.name)),hr(e,r),Promise.resolve(e)}loadSkin(t){let e=this.json.skins[t],r={joints:e.joints};return e.inverseBindMatrices===void 0?Promise.resolve(r):this.getDependency("accessor",e.inverseBindMatrices).then(function(i){return r.inverseBindMatrices=i,r})}loadAnimation(t){let r=this.json.animations[t],i=[],o=[],s=[],p=[],c=[];for(let u=0,h=r.channels.length;u<h;u++){let x=r.channels[u],b=r.samplers[x.sampler],E=x.target,R=E.node!==void 0?E.node:E.id,P=r.parameters!==void 0?r.parameters[b.input]:b.input,T=r.parameters!==void 0?r.parameters[b.output]:b.output;i.push(this.getDependency("node",R)),o.push(this.getDependency("accessor",P)),s.push(this.getDependency("accessor",T)),p.push(b),c.push(E)}return Promise.all([Promise.all(i),Promise.all(o),Promise.all(s),Promise.all(p),Promise.all(c)]).then(function(u){let h=u[0],x=u[1],b=u[2],E=u[3],R=u[4],P=[];for(let D=0,O=h.length;D<O;D++){let I=h[D],X=x[D],z=b[D],V=E[D],F=R[D];if(I===void 0)continue;I.updateMatrix(),I.matrixAutoUpdate=!0;let ie;switch(Ln[F.path]){case Ln.weights:ie=Am;break;case Ln.rotation:ie=ap;break;case Ln.position:case Ln.scale:default:ie=Lm;break}let oe=I.name?I.name:I.uuid,W=V.interpolation!==void 0?pA[V.interpolation]:rp,re=[];Ln[F.path]===Ln.weights?I.traverse(function(ve){ve.morphTargetInfluences&&re.push(ve.name?ve.name:ve.uuid)}):re.push(oe);let Ee=z.array;if(z.normalized){let ve=oc(Ee.constructor),se=new Float32Array(Ee.length);for(let nt=0,Vr=Ee.length;nt<Vr;nt++)se[nt]=Ee[nt]*ve;Ee=se}for(let ve=0,se=re.length;ve<se;ve++){let nt=new ie(re[ve]+"."+Ln[F.path],X.array,Ee,W);V.interpolation==="CUBICSPLINE"&&(nt.createInterpolant=function(dn){let Gt=this instanceof ap?rc:nn;return new Gt(this.times,this.values,this.getValueSize()/3,dn)},nt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),P.push(nt)}}let T=r.name?r.name:"animation_"+t;return new Hu(T,void 0,P)})}createNodeMesh(t){let e=this.json,r=this,i=e.nodes[t];return i.mesh===void 0?null:r.getDependency("mesh",i.mesh).then(function(o){let s=r._getNodeRef(r.meshCache,i.mesh,o);return i.weights!==void 0&&s.traverse(function(p){if(!!p.isMesh)for(let c=0,u=i.weights.length;c<u;c++)p.morphTargetInfluences[c]=i.weights[c]}),s})}loadNode(t){let e=this.json,r=this.extensions,i=this,o=e.nodes[t],s=o.name?i.createUniqueName(o.name):"";return function(){let p=[],c=i._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(t)});return c&&p.push(c),o.camera!==void 0&&p.push(i.getDependency("camera",o.camera).then(function(u){return i._getNodeRef(i.cameraCache,o.camera,u)})),i._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(t)}).forEach(function(u){p.push(u)}),Promise.all(p)}().then(function(p){let c;if(o.isBone===!0?c=new Uu:p.length>1?c=new Os:p.length===1?c=p[0]:c=new We,c!==p[0])for(let u=0,h=p.length;u<h;u++)c.add(p[u]);if(o.name&&(c.userData.name=o.name,c.name=s),hr(c,o),o.extensions&&xo(r,c,o),o.matrix!==void 0){let u=new Oe;u.fromArray(o.matrix),c.applyMatrix4(u)}else o.translation!==void 0&&c.position.fromArray(o.translation),o.rotation!==void 0&&c.quaternion.fromArray(o.rotation),o.scale!==void 0&&c.scale.fromArray(o.scale);return i.associations.has(c)||i.associations.set(c,{}),i.associations.get(c).nodes=t,c})}loadScene(t){let e=this.json,r=this.extensions,i=this.json.scenes[t],o=this,s=new Os;i.name&&(s.name=o.createUniqueName(i.name)),hr(s,i),i.extensions&&xo(r,s,i);let p=i.nodes||[],c=[];for(let u=0,h=p.length;u<h;u++)c.push(qh(p[u],s,e,o));return Promise.all(c).then(function(){let u=h=>{let x=new Map;for(let[b,E]of o.associations)(b instanceof ks||b instanceof ro)&&x.set(b,E);return h.traverse(b=>{let E=o.associations.get(b);E!=null&&x.set(b,E)}),x};return o.associations=u(s),s})}};function qh(n,t,e,r){let i=e.nodes[n];return r.getDependency("node",n).then(function(o){if(i.skin===void 0)return o;let s;return r.getDependency("skin",i.skin).then(function(p){s=p;let c=[];for(let u=0,h=s.joints.length;u<h;u++)c.push(r.getDependency("node",s.joints[u]));return Promise.all(c)}).then(function(p){return o.traverse(function(c){if(!c.isMesh)return;let u=[],h=[];for(let x=0,b=p.length;x<b;x++){let E=p[x];if(E){u.push(E);let R=new Oe;s.inverseBindMatrices!==void 0&&R.fromArray(s.inverseBindMatrices.array,x*16),h.push(R)}else console.warn('GLTFLoader: Joint "%s" could not be found.',s.joints[x])}c.bind(new Tm(u,h),c.matrixWorld)}),o})}).then(function(o){t.add(o);let s=[];if(i.children){let p=i.children;for(let c=0,u=p.length;c<u;c++){let h=p[c];s.push(qh(h,o,e,r))}}return Promise.all(s)})}function hA(n,t,e){let r=t.attributes,i=new rr;if(r.POSITION!==void 0){let p=e.json.accessors[r.POSITION],c=p.min,u=p.max;if(c!==void 0&&u!==void 0){if(i.set(new k(c[0],c[1],c[2]),new k(u[0],u[1],u[2])),p.normalized){let h=oc(go[p.componentType]);i.min.multiplyScalar(h),i.max.multiplyScalar(h)}}else{console.warn("GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let o=t.targets;if(o!==void 0){let p=new k,c=new k;for(let u=0,h=o.length;u<h;u++){let x=o[u];if(x.POSITION!==void 0){let b=e.json.accessors[x.POSITION],E=b.min,R=b.max;if(E!==void 0&&R!==void 0){if(c.setX(Math.max(Math.abs(E[0]),Math.abs(R[0]))),c.setY(Math.max(Math.abs(E[1]),Math.abs(R[1]))),c.setZ(Math.max(Math.abs(E[2]),Math.abs(R[2]))),b.normalized){let P=oc(go[b.componentType]);c.multiplyScalar(P)}p.max(c)}else console.warn("GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(p)}n.boundingBox=i;let s=new Zr;i.getCenter(s.center),s.radius=i.min.distanceTo(i.max)/2,n.boundingSphere=s}function jh(n,t,e){let r=t.attributes,i=[];function o(s,p){return e.getDependency("accessor",s).then(function(c){n.setAttribute(p,c)})}for(let s in r){let p=ic[s]||s.toLowerCase();p in n.attributes||i.push(o(r[s],p))}if(t.indices!==void 0&&!n.index){let s=e.getDependency("accessor",t.indices).then(function(p){n.setIndex(p)});i.push(s)}return hr(n,t),hA(n,t,e),Promise.all(i).then(function(){return t.targets!==void 0?dA(n,t.targets,e):n})}function Wh(n,t){let e=n.getIndex();if(e===null){let s=[],p=n.getAttribute("position");if(p!==void 0){for(let c=0;c<p.count;c++)s.push(c);n.setIndex(s),e=n.getIndex()}else return console.error("GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}let r=e.count-2,i=[];if(t===lp)for(let s=1;s<=r;s++)i.push(e.getX(0)),i.push(e.getX(s)),i.push(e.getX(s+1));else for(let s=0;s<r;s++)s%2===0?(i.push(e.getX(s)),i.push(e.getX(s+1)),i.push(e.getX(s+2))):(i.push(e.getX(s+2)),i.push(e.getX(s+1)),i.push(e.getX(s)));i.length/3!==r&&console.error("GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let o=n.clone();return o.setIndex(i),o}var xe={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function Kh(n){let t=await fetch(n);if(t.ok)return t.json();throw new Error(t.statusText)}async function fA(n){if(!n)throw new Error("No basePath supplied");return await Kh(`${n}/profilesList.json`)}async function Yh(n,t,e=null,r=!0){if(!n)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");let i=await fA(t),o;if(n.profiles.some(c=>{let u=i[c];return u&&(o={profileId:c,profilePath:`${t}/${u.path}`,deprecated:!!u.deprecated}),!!o}),!o){if(!e)throw new Error("No matching profile name found");let c=i[e];if(!c)throw new Error(`No matching profile name found and default profile "${e}" missing.`);o={profileId:e,profilePath:`${t}/${c.path}`,deprecated:!!c.deprecated}}let s=await Kh(o.profilePath),p;if(r){let c;if(n.handedness==="any"?c=s.layouts[Object.keys(s.layouts)[0]]:c=s.layouts[n.handedness],!c)throw new Error(`No matching handedness, ${n.handedness}, in profile ${o.profileId}`);c.assetPath&&(p=o.profilePath.replace("profile.json",c.assetPath))}return{profile:s,assetPath:p}}var xA={xAxis:0,yAxis:0,button:0,state:xe.ComponentState.DEFAULT};function vA(n=0,t=0){let e=n,r=t;if(Math.sqrt(n*n+t*t)>1){let s=Math.atan2(t,n);e=Math.cos(s),r=Math.sin(s)}return{normalizedXAxis:e*.5+.5,normalizedYAxis:r*.5+.5}}var ac=class{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===xe.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(xA)}updateFromComponent({xAxis:t,yAxis:e,button:r,state:i}){let{normalizedXAxis:o,normalizedYAxis:s}=vA(t,e);switch(this.componentProperty){case xe.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?o:.5;break;case xe.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?s:.5;break;case xe.ComponentProperty.BUTTON:this.value=this.states.includes(i)?r:0;break;case xe.ComponentProperty.STATE:this.valueNodeProperty===xe.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},lc=class{constructor(t,e){if(!t||!e||!e.visualResponses||!e.gamepadIndices||Object.keys(e.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach(r=>{let i=new ac(e.visualResponses[r]);this.visualResponses[r]=i}),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:xe.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(t){if(this.values.state=xe.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&t.buttons.length>this.gamepadIndices.button){let e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||this.values.button===1?this.values.state=xe.ComponentState.PRESSED:(e.touched||this.values.button>xe.ButtonTouchThreshold)&&(this.values.state=xe.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===xe.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>xe.AxisTouchThreshold&&(this.values.state=xe.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===xe.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>xe.AxisTouchThreshold&&(this.values.state=xe.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}},ya=class{constructor(t,e,r){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=r,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(i=>{let o=this.layoutDescription.components[i];this.components[i]=new lc(i,o)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let t=[];return Object.values(this.components).forEach(e=>{t.push(e.data)}),t}updateFromGamepad(){Object.values(this.components).forEach(t=>{t.updateFromGamepad(this.xrInputSource.gamepad)})}};var gA="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",AA="generic-trigger",pc=class extends We{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(t){return this.envMap==t?this:(this.envMap=t,this.traverse(e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}),this)}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(r=>{let{valueNode:i,minNode:o,maxNode:s,value:p,valueNodeProperty:c}=r;!i||(c===xe.VisualResponseProperty.VISIBILITY?i.visible=p:c===xe.VisualResponseProperty.TRANSFORM&&(i.quaternion.slerpQuaternions(o.quaternion,s.quaternion,p),i.position.lerpVectors(o.position,s.position,p)))})}))}};function _A(n,t){Object.values(n.components).forEach(e=>{let{type:r,touchPointNodeName:i,visualResponses:o}=e;if(r===xe.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(i),e.touchPointNode){let s=new zs(.001),p=new qe({color:255}),c=new yt(s,p);e.touchPointNode.add(c)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(o).forEach(s=>{let{valueNodeName:p,minNodeName:c,maxNodeName:u,valueNodeProperty:h}=s;if(h===xe.VisualResponseProperty.TRANSFORM){if(s.minNode=t.getObjectByName(c),s.maxNode=t.getObjectByName(u),!s.minNode){console.warn(`Could not find ${c} in the model`);return}if(!s.maxNode){console.warn(`Could not find ${u} in the model`);return}}s.valueNode=t.getObjectByName(p),s.valueNode||console.warn(`Could not find ${p} in the model`)})})}function Jh(n,t){_A(n.motionController,t),n.envMap&&t.traverse(e=>{e.isMesh&&(e.material.envMap=n.envMap,e.material.needsUpdate=!0)}),n.add(t)}var Ea=class{constructor(t=null){this.gltfLoader=t,this.path=gA,this._assetCache={},this.gltfLoader||(this.gltfLoader=new Dn)}createControllerModel(t){let e=new pc,r=null;return t.addEventListener("connected",i=>{let o=i.data;o.targetRayMode!=="tracked-pointer"||!o.gamepad||Yh(o,this.path,AA).then(({profile:s,assetPath:p})=>{e.motionController=new ya(o,s,p);let c=this._assetCache[e.motionController.assetUrl];if(c)r=c.scene.clone(),Jh(e,r);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(e.motionController.assetUrl,u=>{this._assetCache[e.motionController.assetUrl]=u,r=u.scene.clone(),Jh(e,r)},null,()=>{throw new Error(`Asset ${e.motionController.assetUrl} missing or malformed.`)})}}).catch(s=>{console.warn(s)})}),t.addEventListener("disconnected",()=>{e.motionController=null,e.remove(r),r=null}),e}};var cc=new Oe,$h=new k,Zh=new Oe().identity(),ef=new Oe().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(Zh.makeRotationY(Math.PI/2),ef.makeRotationY(-Math.PI/2));var xi=class{constructor(t,e,r,i,o){this.controller=e,this.handModel=t,this.envMap=null,this.oculusBrowserV14Correction=i==="left"?ef:Zh;let s;!o||!o.primitive||o.primitive==="sphere"?s=new zs(1,10,10):o.primitive==="box"?s=new Wu(1,1,1):o.primitive==="bone"&&(s=new Ju(.5,.75,2.25,10,1).rotateX(-Math.PI/2));let p=new $r;this.handMesh=new im(s,p,30),this.handMesh.instanceMatrix.setUsage(Zu),this.handMesh.castShadow=!0,this.handMesh.receiveShadow=!0,this.handModel.add(this.handMesh),this.joints=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]}updateMesh(){let e=this.controller.joints,r=0;for(let i=0;i<this.joints.length;i++){let o=e[this.joints[i]];o.visible&&($h.setScalar(o.jointRadius||.008),cc.compose(o.position,o.quaternion,$h),cc.multiply(this.oculusBrowserV14Correction),this.handMesh.setMatrixAt(i,cc),r++)}this.handMesh.count=r,this.handMesh.instanceMatrix.needsUpdate=!0}};var dc=new ce().identity(),tf=new ce().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(dc.setFromAxisAngle({x:0,y:1,z:0},Math.PI/2),tf.setFromAxisAngle({x:1,y:0,z:0},Math.PI).premultiply(dc));var bA="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/",wa=class{constructor(t,e,r,i){this.controller=e,this.handModel=t,this.oculusBrowserV14Correction=i==="left"?tf:dc,this.bones=[];let o=new Dn;o.setPath(r||bA),o.load(`${i}.glb`,s=>{let p=s.scene.children[0];this.handModel.add(p);let c=p.getObjectByProperty("type","SkinnedMesh");c.frustumCulled=!1,c.castShadow=!0,c.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(h=>{let x=p.getObjectByName(h);x!==void 0?x.jointName=h:console.warn(`Couldn't find ${h} in ${i} hand mesh`),this.bones.push(x)})})}updateMesh(){let t=this.controller.joints;for(let e=0;e<this.bones.length;e++){let r=this.bones[e];if(r){let i=t[r.jointName];if(i.visible){let o=i.position;r&&(r.position.copy(o),r.quaternion.copy(i.quaternion).multiply(this.oculusBrowserV14Correction))}}}}};var uc=class extends We{constructor(t){super(),this.controller=t,this.motionController=null,this.envMap=null,this.mesh=null}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&this.motionController.updateMesh()}},Sa=class{constructor(){this.path=null}setPath(t){return this.path=t,this}createHandModel(t,e){let r=new uc(t);return t.addEventListener("connected",i=>{let o=i.data;o.hand&&!r.motionController&&(r.xrInputSource=o,e===void 0||e==="spheres"?r.motionController=new xi(r,t,this.path,o.handedness,{primitive:"sphere"}):e==="boxes"?r.motionController=new xi(r,t,this.path,o.handedness,{primitive:"box"}):e==="bones"?r.motionController=new xi(r,t,this.path,o.handedness,{primitive:"bone"}):e==="mesh"&&(r.motionController=new wa(r,t,this.path,o.handedness)))}),t.addEventListener("disconnected",()=>{}),r}};function nf(n){let t=n.attributes.position,e=n.attributes.normal,r=n.attributes.uv;for(let i=0;i<e.count;++i){let o=i*e.itemSize,s=i*e.itemSize+1,p=i*e.itemSize+2,c=e.array[o],u=e.array[s],h=e.array[p],x=Math.abs(c),b=Math.abs(u),E=Math.abs(h),R=t.array[o],P=t.array[s],T=t.array[p],D=Math.abs(R),O=Math.abs(P),I=Math.abs(T),X=i*r.itemSize,z=i*r.itemSize+1,V=r.array[X],F=r.array[z],ie=0,oe=x,W=D;b>oe&&(ie=1,oe=b,W=O),E>oe&&(ie=2,oe=E,W=I),ie===0?R<0?(V=-T,F=P):(V=T,F=P):ie===1?P<0?(V=R,F=-T):(V=R,F=T):T<0?(V=R,F=P):(V=-R,F=P),V=(V/W+1)/8,F=(F/W+1)/6,ie===0?R<0?(V+=0,F+=1/3):(V+=.5,F+=1/3):ie===1?P<0?(V+=.25,F+=0):(V+=.25,F+=2/3):T<0?(V+=.25,F+=1/3):(V+=.75,F+=1/3);let re=r.array;re[X]=V,re[z]=F}}var Ao=new ju(1,1,1,1,1,1);Ao.name="CubeGeom";var rf=Ao.clone();rf.name="InvertedCubeGeom";nf(rf);var fr=class extends yt{constructor(t,e,r,i){super(Ao,i),this.scale.set(t,e,r)}};var vi=class extends Bt{constructor(e){super(e);this.material=ih({name:"CursorMat",color:16776960}),this.object=new fr(.01,.01,.01,this.material)}get position(){return this.object.position}get style(){return this._currentStyle}set style(e){if(this._currentStyle=e,Rn(this.object)&&!gt(this.object.material))switch(this._currentStyle){case"pointer":this.material.color=new be(65280),this.material.needsUpdate=!0;break;case"not-allowed":this.material.color=new be(16711680),this.material.needsUpdate=!0;break;case"move":this.material.color=new be(255),this.material.needsUpdate=!0;break;case"grab":this.material.color=new be(16711935),this.material.needsUpdate=!0;break;case"grabbing":this.material.color=new be(65535),this.material.needsUpdate=!0;break;default:this._currentStyle="default",this.material.color=new be(16776960),this.material.needsUpdate=!0;break}}get visible(){return ei(this)}set visible(e){ke(this,e)}};var of=new rr,Ma=new k,xr=class extends rm{constructor(){super(),this.type="LineSegmentsGeometry";let t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],r=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(r),this.setAttribute("position",new np(t,3)),this.setAttribute("uv",new np(e,2))}applyMatrix4(t){let e=this.attributes.instanceStart,r=this.attributes.instanceEnd;return e!==void 0&&(e.applyMatrix4(t),r.applyMatrix4(t),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let r=new eo(e,6,1);return this.setAttribute("instanceStart",new Ot(r,3,0)),this.setAttribute("instanceEnd",new Ot(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let r=new eo(e,6,1);return this.setAttribute("instanceColorStart",new Ot(r,3,0)),this.setAttribute("instanceColorEnd",new Ot(r,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new Bm(t.geometry)),this}fromLineSegments(t){let e=t.geometry;if(e.isGeometry){console.error("LineSegmentsGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new rr);let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;t!==void 0&&e!==void 0&&(this.boundingBox.setFromBufferAttribute(t),of.setFromBufferAttribute(e),this.boundingBox.union(of))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Zr),this.boundingBox===null&&this.computeBoundingBox();let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(t!==void 0&&e!==void 0){let r=this.boundingSphere.center;this.boundingBox.getCenter(r);let i=0;for(let o=0,s=t.count;o<s;o++)Ma.fromBufferAttribute(t,o),i=Math.max(i,r.distanceToSquared(Ma)),Ma.fromBufferAttribute(e,o),i=Math.max(i,r.distanceToSquared(Ma));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(t){return console.warn("LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}};xr.prototype.isLineSegmentsGeometry=!0;var sf=new k,af=new k,Ne=new kt,Xe=new kt,Ft=new kt,mc=new k,hc=new Oe,ht=new pm,lf=new k,rn=new rr,Ta=new Zr,Nt=new kt;function pf(n,t,e,r){return Nt.set(0,0,-t,1).applyMatrix4(n.projectionMatrix),Nt.multiplyScalar(1/Nt.w),Nt.x=e/r.width,Nt.y=e/r.height,Nt.applyMatrix4(n.projectionMatrixInverse),Nt.multiplyScalar(1/Nt.w),Math.abs(Math.max(Nt.x,Nt.y))}var _o=class extends yt{constructor(t=new xr,e=new en({color:Math.random()*16777215})){super(t,e),this.type="LineSegments2"}computeLineDistances(){let t=this.geometry,e=t.attributes.instanceStart,r=t.attributes.instanceEnd,i=new Float32Array(2*e.count);for(let s=0,p=0,c=e.count;s<c;s++,p+=2)sf.fromBufferAttribute(e,s),af.fromBufferAttribute(r,s),i[p]=p===0?0:i[p-1],i[p+1]=i[p]+sf.distanceTo(af);let o=new eo(i,2,1);return t.setAttribute("instanceDistanceStart",new Ot(o,1,0)),t.setAttribute("instanceDistanceEnd",new Ot(o,1,1)),this}raycast(t,e){t.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');let r=t.params.Line2!==void 0&&t.params.Line2.threshold||0,i=t.ray,o=t.camera,s=o.projectionMatrix,p=this.matrixWorld,c=this.geometry,u=this.material,h=u.resolution,x=u.linewidth+r,b=c.attributes.instanceStart,E=c.attributes.instanceEnd,R=-o.near;c.boundingSphere===null&&c.computeBoundingSphere(),Ta.copy(c.boundingSphere).applyMatrix4(p);let P=Math.max(o.near,Ta.distanceToPoint(i.origin)),T=pf(o,P,x,h);if(Ta.radius+=T,t.ray.intersectsSphere(Ta)===!1)return;c.boundingBox===null&&c.computeBoundingBox(),rn.copy(c.boundingBox).applyMatrix4(p);let D=Math.max(o.near,rn.distanceToPoint(i.origin)),O=pf(o,D,x,h);if(rn.max.x+=O,rn.max.y+=O,rn.max.z+=O,rn.min.x-=O,rn.min.y-=O,rn.min.z-=O,t.ray.intersectsBox(rn)!==!1){i.at(1,Ft),Ft.w=1,Ft.applyMatrix4(o.matrixWorldInverse),Ft.applyMatrix4(s),Ft.multiplyScalar(1/Ft.w),Ft.x*=h.x/2,Ft.y*=h.y/2,Ft.z=0,mc.copy(Ft),hc.multiplyMatrices(o.matrixWorldInverse,p);for(let X=0,z=b.count;X<z;X++){Ne.fromBufferAttribute(b,X),Xe.fromBufferAttribute(E,X),Ne.w=1,Xe.w=1,Ne.applyMatrix4(hc),Xe.applyMatrix4(hc);var I=Ne.z>R&&Xe.z>R;if(I)continue;if(Ne.z>R){let W=Ne.z-Xe.z,re=(Ne.z-R)/W;Ne.lerp(Xe,re)}else if(Xe.z>R){let W=Xe.z-Ne.z,re=(Xe.z-R)/W;Xe.lerp(Ne,re)}Ne.applyMatrix4(s),Xe.applyMatrix4(s),Ne.multiplyScalar(1/Ne.w),Xe.multiplyScalar(1/Xe.w),Ne.x*=h.x/2,Ne.y*=h.y/2,Xe.x*=h.x/2,Xe.y*=h.y/2,ht.start.copy(Ne),ht.start.z=0,ht.end.copy(Xe),ht.end.z=0;let V=ht.closestPointToPointParameter(mc,!0);ht.at(V,lf);let F=Bs.lerp(Ne.z,Xe.z,V),ie=F>=-1&&F<=1,oe=mc.distanceTo(lf)<x*.5;if(ie&&oe){ht.start.fromBufferAttribute(b,X),ht.end.fromBufferAttribute(E,X),ht.start.applyMatrix4(p),ht.end.applyMatrix4(p);let W=new k,re=new k;i.distanceSqToSegment(ht.start,ht.end,re,W),e.push({point:re,pointOnLine:W,distance:i.origin.distanceTo(re),object:this,face:null,faceIndex:X,uv:null,uv2:null})}}}}};_o.prototype.isLineSegments2=!0;var vr=class extends xr{constructor(){super(),this.type="LineGeometry"}setPositions(t){for(var e=t.length-3,r=new Float32Array(2*e),i=0;i<e;i+=3)r[2*i]=t[i],r[2*i+1]=t[i+1],r[2*i+2]=t[i+2],r[2*i+3]=t[i+3],r[2*i+4]=t[i+4],r[2*i+5]=t[i+5];return super.setPositions(r),this}setColors(t){for(var e=t.length-3,r=new Float32Array(2*e),i=0;i<e;i+=3)r[2*i]=t[i],r[2*i+1]=t[i+1],r[2*i+2]=t[i+2],r[2*i+3]=t[i+3],r[2*i+4]=t[i+4],r[2*i+5]=t[i+5];return super.setColors(r),this}fromLine(t){var e=t.geometry;if(e.isGeometry){console.error("LineGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}};vr.prototype.isLineGeometry=!0;var bo=class extends _o{constructor(t=new vr,e=new en({color:Math.random()*16777215})){super(t,e),this.type="Line2"}};bo.prototype.isLine2=!0;var cf=new vr;cf.setPositions([0,0,0,0,0,-1]);var Ca=class extends We{constructor(e,r=1){super();this._length=1;this.line=new bo(cf,sh({color:e,linewidth:r})),this.line.computeLineDistances(),j(this,this.line)}get length(){return this._length}set length(e){this._length=e,this.line.scale.set(1,1,e)}};var Pa=class extends Bt{constructor(e,r){super(e);this.element=r;this._hidden=!1;this.visible=!0,this.style="default",document.addEventListener("pointerlockchange",()=>{this._hidden=!!document.pointerLockElement,this.refresh()})}get position(){throw new Error("BaseCursor::get_Position(): Method not implemented.")}get style(){return super.style}set style(e){super.style=e,this.refresh()}get visible(){return super.visible&&!this._hidden}set visible(e){super.visible=e,this.refresh()}refresh(){this.element.style.cursor=this.visible?this.style:"none"}};var gi=class extends Bt{constructor(e){super(e);this.xr=e.cursor3D&&e.cursor3D.clone()||new vi(this.env),this.system=new Pa(this.env,this.env.renderer.domElement),this.xr.side=this.side,this.visible=!1,Object.seal(this)}get object(){return this.xr.object}get side(){return this.xr.side}set side(e){this.xr.side=e}get cursor(){return this.xr}set cursor(e){this.xr=e,this._refresh()}get position(){return this.object.position}get style(){return this.system.style}get visible(){return super.visible}set visible(e){super.visible=e,this._refresh()}set style(e){this.system.style=e,this.xr.style=e,this._refresh()}_refresh(){let e=this.env.eventSys&&this.env.eventSys.mouse&&this.env.eventSys.mouse.isPointerLocked,r=this.env.renderer.xr.isPresenting||e;ke(this.xr,this.visible&&r),this.system.visible=this.visible&&!r}lookAt(e,r){this.xr.lookAt(e,r)}};var Ra=class extends q{constructor(e,r){super(e);this.pointer=r;this._hit=null;this._point=null;this._distance=Number.POSITIVE_INFINITY;this._rayTarget=null;Object.seal(this)}set(e,r){e!==this.hit&&(this._hit=e,e?(this._point=e.point,this._distance=e.distance):(this._point=null,this._distance=Number.POSITIVE_INFINITY)),this._rayTarget=r}get hit(){return this._hit}get rayTarget(){return this._rayTarget}get point(){return this._point}get distance(){return this._distance}};var yA=5,EA=new k,Ai=class extends ${constructor(e,r,i,o){super();this.type=e;this.id=r;this.env=i;this.origin=new k;this.direction=new k;this.up=new k(0,1,0);this.canMoveView=!1;this.mayTeleport=!1;this.buttons=0;this.isActive=!1;this.moveDistance=0;this.hits=new Array;this.pointerEvents=new Map;this.lastButtons=0;this.canClick=!1;this.dragDistance=0;this._enabled=!1;this._cursor=null;this._curHit=null;this._curTarget=null;this._hoveredHit=null;this._hoveredTarget=null;this._cursor=o,this.cursor&&(this.cursor.visible=!1)}get curHit(){return this._curHit}set curHit(e){if(e!==this.curHit){let r=si(e);this._curHit=e,this._curTarget=r}}get curTarget(){return this._curTarget}get hoveredHit(){return this._hoveredHit}set hoveredHit(e){if(e!==this.hoveredHit){let r=si(e);this._hoveredHit=e,this._hoveredTarget=r}}get name(){return In[this.id]}get rayTarget(){return this._hoveredTarget}get cursor(){return this._cursor}set cursor(e){if(e!==this.cursor){let r=this.cursor,i=this.cursor&&this.cursor.object&&this.cursor.object.name||"cursor",o=r&&r.object&&r.object.parent;o&&o.remove(r.object),e&&(e.object.name=i,r instanceof gi?(r.cursor=e,o&&j(o,r)):(this._cursor=e,r&&(o&&j(o,e),e.style=r.style,e.visible=r.visible)))}}get needsUpdate(){return this.enabled&&this.isActive}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.cursor&&(this.cursor.visible=e)}setButton(e,r){this.lastButtons=this.buttons;let i=1<<e;if(r?this.buttons|=i:this.buttons&=~i,r)this.canClick=!0,this.dragDistance=0,this.env.avatar.setMode(this),this.setEventState("down");else{if(this.canClick){let o=this.buttons;this.buttons=this.lastButtons,this.setEventState("click"),this.buttons=o}this.setEventState("up")}}isPressed(e){let r=1<<e;return(this.buttons&r)!==0}wasPressed(e){let r=1<<e;return(this.lastButtons&r)!==0}fireRay(e,r){le(this.hits),this.env.eventSys.fireRay(e,r,this.hits);let i=null,o=Number.MAX_VALUE;for(let s of this.hits)si(s)&&s.distance<o&&(i=s,o=s.distance);return this.curHit=i,!!i}getEvent(e){this.pointerEvents.has(e)||this.pointerEvents.set(e,new Ra(e,this));let r=this.pointerEvents.get(e);if(this.hoveredHit?r.set(this.hoveredHit,this.rayTarget):this.curHit?r.set(this.curHit,this.curTarget):r.set(null,null),r.hit){let i=this.curHit||this.hoveredHit;i&&r.hit!==i&&(r.hit.uv=i.uv)}return r}update(){this.needsUpdate&&this.onUpdate()}onUpdate(){this.updatePointerOrientation();let e=this.isPressed(0);(this.moveDistance>0||e)&&(e&&(this.dragDistance+=this.moveDistance,this.dragDistance>yA&&(this.canClick=!1)),this.setEventState("move")),this.moveDistance=0}setEventState(e){if(this.fireRay(this.origin,this.direction),this.curTarget===this.rayTarget)this.hoveredHit=this.curHit;else{let i=this.isPressed(0),o=this.wasPressed(0);if(e==="move"&&!i||e==="down"&&i&&!o||e==="up"&&!i&&o){if(this.rayTarget){let u=this.getEvent("up");this.rayTarget.dispatchEvent(u);let h=this.getEvent("exit");this.dispatchEvent(h),this.rayTarget.dispatchEvent(h)}if(this.hoveredHit=this.curHit,this.rayTarget){let u=this.getEvent("enter");this.dispatchEvent(u),this.rayTarget.dispatchEvent(u)}}this.hoveredHit&&this.hoveredHit.point.copy(this.direction).multiplyScalar(this.hoveredHit.distance).add(this.origin)}let r=this.getEvent(e);this.dispatchEvent(r),r.rayTarget&&(e!=="click"||r.rayTarget.clickable||r.rayTarget.navigable)&&(e==="click"&&r.rayTarget.clickable&&this.vibrate(),r.rayTarget.enabled&&r.rayTarget.dispatchEvent(r)),this.updateCursor(this.env.avatar.worldPos,EA,!0,2)}get canDragView(){return this.canMoveView}get canTeleport(){return this.mayTeleport}updateCursor(e,r,i,o){this.cursor&&this.cursor.update(e,r,this.hoveredHit||this.curHit,this.rayTarget||this.curTarget,o,i,this.canDragView,this.canTeleport,this.origin,this.direction,this.isPressed(0))}};var wA=new Ea,SA=new Sa,MA=new Oe().makeRotationX(-7*Math.PI/9),df=new Map([["none",4],["left",5],["right",6]]);var uf=new Map([[5,2],[4,3]]),Va=class extends Ai{constructor(e,r){super("hand",4,e,new vi(e));this.laser=new Ca(xp,.002);this._isHand=!1;this.inputSource=null;this._gamepad=new ba;this.delta=new k;this.newOrigin=new k;this.quaternion=new ce;this.newQuat=new ce;this.useHaptics=!0;if(this.mayTeleport=!0,this.object=de("PointerHand"+r),this.quaternion.identity(),j(this,this.controller=this.env.renderer.xr.getController(r),this.grip=this.env.renderer.xr.getControllerGrip(r),this.hand=this.env.renderer.xr.getHand(r)),Nr()&&kd()&&!Kt){let s=!1;this.controller.traverse(p=>{p.name.toLocaleLowerCase().indexOf("oculus")>=0&&(s=!0)}),s&&this.laser.matrix.copy(MA)}j(this.controller,this.laser),j(this.grip,wA.createControllerModel(this.controller)),j(this.hand,SA.createHandModel(this.hand,"mesh")),this.gamepad.addEventListener("gamepadaxismaxed",s=>{s.axis===2&&this.env.avatar.snapTurn(s.value)});let i=s=>p=>{uf.has(p.button)&&this.setButton(uf.get(p.button),s)};this.gamepad.addEventListener("gamepadbuttondown",i(!0)),this.gamepad.addEventListener("gamepadbuttonup",i(!1));let o=(s,p)=>()=>this.setButton(s,p);this.controller.addEventListener("selectstart",o(0,!0)),this.controller.addEventListener("selectend",o(0,!1)),this.controller.addEventListener("squeezestart",o(1,!0)),this.controller.addEventListener("squeezeend",o(1,!1)),this.controller.addEventListener("connected",s=>{s.target===this.controller&&(this.inputSource=s.data,this.gamepad.pad=this.inputSource.gamepad,this._isHand=_(this.inputSource.hand),this.id=df.get(this.handedness),this.grip.visible=!this.isHand,this.controller.visible=!this.isHand,this.hand.visible=this.isHand,this.enabled=!0,this.isActive=!0,this.env.eventSys.checkXRMouse(),this.updateCursorSide(),console.log(this.handedness,"connected"))}),this.controller.addEventListener("disconnected",s=>{s.target===this.controller&&(this.inputSource=null,this.gamepad.pad=null,this._isHand=!1,this.id=df.get(this.handedness),this.grip.visible=!1,this.controller.visible=!1,this.hand.visible=!1,this.enabled=!1,this.isActive=!1,this.env.eventSys.checkXRMouse(),this.updateCursorSide(),console.log(this.handedness,"disconnected"))}),Object.seal(this)}vibrate(){this._vibrate()}async _vibrate(){if(this.useHaptics&&this.gamepad.hapticActuators)try{await Promise.all(this.gamepad.hapticActuators.map(e=>e.pulse(.25,125)))}catch{this.useHaptics=!1}}get gamepad(){return this._gamepad}get handedness(){return B(this.inputSource)?null:this.inputSource.handedness}get isHand(){return this._isHand}get cursor(){return super.cursor}set cursor(e){super.cursor=e,this.updateCursorSide()}updateCursorSide(){this.cursor.side=this.handedness==="left"?1:-1}updatePointerOrientation(){this.laser.getWorldPosition(this.newOrigin),this.laser.getWorldQuaternion(this.newQuat),this.origin.lerp(this.newOrigin,.9),this.quaternion.slerp(this.newQuat,.9),this.delta.copy(this.origin).add(this.direction),this.direction.set(0,0,-1).applyQuaternion(this.quaternion),this.up.set(0,1,0).applyQuaternion(this.quaternion),this.delta.sub(this.direction).sub(this.origin),this.moveDistance+=50*this.delta.length()}onUpdate(){this.gamepad.pad=this.inputSource&&this.inputSource.gamepad||null,super.onUpdate()}};var _i=class extends Ai{constructor(e,r,i,o){super(e,r,i,o);this.position=new Re;this.motion=new Re;this.uv=new Re;this.duv=new Re;this.uvComp=new Re(1,-1);this.uvOff=new Re(-1,1);this.canMoveView=!0;let s=p=>{this.checkEvent(p)&&this.readEvent(p)};this.element=this.env.renderer.domElement,this.element.addEventListener("pointerdown",s),this.element.addEventListener("pointermove",s),this.element.addEventListener("pointerup",s),this.element.addEventListener("pointercancel",s)}checkEvent(e){return this.isActive=this.onCheckEvent(e)}onCheckEvent(e){return e.pointerType===this.type}readEvent(e){this.checkEvent(e)&&this.onReadEvent(e)}onReadEvent(e){this.updatePointerOrientation()}updatePointerOrientation(){this.element.clientWidth>0&&this.element.clientHeight>0&&(this.uv.copy(this.position),this.uv.x/=this.element.clientWidth,this.uv.y/=this.element.clientHeight,this.uv.multiplyScalar(2).multiply(this.uvComp).add(this.uvOff),this.duv.copy(this.motion),this.duv.x/=this.element.clientWidth,this.duv.y/=this.element.clientHeight,this.duv.multiplyScalar(2).multiply(this.uvComp),this.moveDistance=200*this.duv.length());let e=mr(this.env.renderer,this.env.camera);this.origin.setFromMatrixPosition(e.matrixWorld),this.direction.set(this.uv.x,this.uv.y,.5).unproject(e).sub(this.origin).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat)}onUpdate(){this.env.avatar.onMove(this,this.uv,this.duv),super.onUpdate(),this.motion.setScalar(0),this.duv.setScalar(0)}};var bi=class extends _i{constructor(e,r,i){let o=c=>{c.pointerType===e&&this.pointerID==null&&(this.pointerID=c.pointerId)},s=c=>{c.pointerType===e&&this.pointerID!=null&&(this.pointerID=null)},p=i.renderer.domElement;p.addEventListener("pointerdown",o),p.addEventListener("pointermove",o);super(e,r,i,new gi(i));this.pointerID=null;p.addEventListener("pointerup",s),p.addEventListener("pointercancel",s)}onCheckEvent(e){return super.onCheckEvent(e)&&e.pointerId===this.pointerID}onReadEvent(e){this.position.set(e.offsetX,e.offsetY),this.motion.x+=e.movementX,this.motion.y+=e.movementY,super.onReadEvent(e),(e.type==="pointerdown"||e.type==="pointerup"||e.type==="pointercancel")&&this.setButton(e.button,e.type==="pointerdown")}};var Ia=class extends bi{constructor(e){super("mouse",1,e);this.allowPointerLock=!1;this.dz=0;this.keyMap=new Map([["`",3],["ContextMenu",2]]);this.element.addEventListener("wheel",r=>{r.preventDefault(),this.dz+=-r.deltaY*.1},{passive:!1}),this.element.addEventListener("contextmenu",r=>{r.preventDefault()}),this.element.addEventListener("pointerdown",r=>{this.onCheckEvent(r)&&this.allowPointerLock&&!this.isPointerLocked&&this.lockPointer()}),document.addEventListener("pointerlockchange",()=>{this.cursor.visible=!0}),window.addEventListener("keydown",r=>{this.isActive&&this.keyMap.has(r.key)&&this.setButton(this.keyMap.get(r.key),xa(r))}),window.addEventListener("keyup",r=>{this.keyMap.has(r.key)&&this.setButton(this.keyMap.get(r.key),!1)}),this.mayTeleport=!0,Object.seal(this)}updatePointerOrientation(){this.isPointerLocked&&this.position.set(this.env.renderer.domElement.clientWidth,this.env.renderer.domElement.clientHeight).multiplyScalar(.5),super.updatePointerOrientation()}onUpdate(){super.onUpdate(),this.env.avatar.zoom(this.dz),this.dz=0}get isPointerLocked(){return document.pointerLockElement!=null}get canDragView(){return super.canDragView&&!this.isPointerLocked}get canTeleport(){return super.canTeleport&&this.isPointerLocked}lockPointer(){this.element.requestPointerLock()}unlockPointer(){document.exitPointerLock()}vibrate(){}};var La=class extends bi{constructor(t){super("pen",2,t),Object.seal(this)}vibrate(){}};function TA(n){return n.pointerId}var Da=class extends _i{constructor(e){super("touch",3,e,null);this.dz=0;this.lastZ=0;this.points=new Array;Object.seal(this)}get enabled(){return super.enabled}set enabled(e){super.enabled=e,le(this.points)}onCheckEvent(e){return super.onCheckEvent(e)&&e.pointerId>-1}onReadEvent(e){if(Xd(this.points,e.pointerId,TA),(e.type==="pointerdown"||e.type==="pointermove")&&this.points.push(e),this.points.length===2){let i=this.points[0],o=this.points[1],s=o.offsetX-i.offsetX,p=o.offsetY-i.offsetY,c=5*Math.sqrt(s*s+p*p),u=c-this.lastZ;e.type==="pointermove"&&(this.dz+=u),this.lastZ=c}let r=1/this.points.length;if(e.type==="pointerdown"||e.type==="pointermove"){this.position.setScalar(0);for(let i of this.points)this.position.x+=r*i.offsetX,this.position.y+=r*i.offsetY,this.motion.x+=r*i.movementX,this.motion.y+=r*i.movementY}if(super.onReadEvent(e),e.type!=="pointermove"){let i=0;for(let o=0;o<this.points.length;++o){let s=this.points[o],p=1<<o;s.buttons!==0?i|=p:i&=~p}for(let o=0;o<10;++o){let s=this.isPressed(o),p=1<<o,c=(i&p)!==0;c!==s&&this.setButton(o,c)}}}onUpdate(){this.env.avatar.zoom(this.dz),super.onUpdate(),this.dz=0}vibrate(){navigator.vibrate(125)}};var Oa=class extends ${constructor(e){super();this.env=e;this.raycaster=new Sm;this.queue=new Array;this.targetsFound=new Set;this.targets=new Array;this.hands=new Array;this.raycaster.camera=this.env.camera,this.raycaster.layers.set(Aa),this.mouse=new Ia(this.env),this.pen=new La(this.env),this.touches=new Da(this.env);for(let r=0;r<2;++r)this.hands[r]=new Va(this.env,r);this.pointers=[this.mouse,this.pen,this.touches,...this.hands];for(let r of this.pointers)r.addBubbler(this),r.cursor&&j(this.env.stage,r.cursor);this.checkXRMouse(),Object.seal(this)}checkXRMouse(){let e=0;for(let i of this.hands.values())i.enabled&&++e;let r=e===0;this.mouse.enabled=r,this.pen.enabled=r,this.touches.enabled=r}refreshCursors(){for(let e of this.pointers)e.cursor&&(e.cursor=this.env.cursor3D.clone())}fireRay(e,r,i){this.raycaster.ray.origin.copy(e),this.raycaster.ray.direction.copy(r),this.raycaster.intersectObjects(this.targets,!1,i)}update(){for(this.targetsFound.clear(),le(this.targets),this.queue.push(this.env.scene);this.queue.length>0;){let e=this.queue.shift();e.children.length>0&&this.queue.push(...e.children);let r=si(e);r&&!this.targetsFound.has(r)&&(this.targetsFound.add(r),this.targets.push(...r.meshes))}for(let e of this.pointers)e.needsUpdate&&e.update()}};var CA=new q("fadecomplete"),ka=class extends ${constructor(e,r=.15){super();this.opacity=1;this.direction=0;this.material=ri({name:"FaderMaterial",color:0,side:Gu}),this.object=sr(e,Ao,this.material),this.object.renderOrder=Number.MAX_VALUE,this.speed=1/r,this.object.layers.enableAll()}async fadeOut(){this.direction!=1&&(this.direction=1,await Le(this,"fadecomplete"))}async fadeIn(){this.direction!=-1&&(this.direction=-1,await Le(this,"fadecomplete"))}update(e){if(this.direction!==0){let r=this.direction*this.speed*e/1e3;0<=this.opacity&&this.opacity<=1&&(this.opacity+=r),(this.direction===1&&this.opacity>=1||this.direction===-1&&this.opacity<=0)&&(this.opacity=Tn(this.opacity,0,1),this.direction=0,this.dispatchEvent(CA))}this.material.opacity=this.opacity,this.material.transparent=this.opacity<1,this.material.needsUpdate=!0}};function ft(n,t,e,r,i,o){let s=new fr(r,i,o,ch);return s.position.set(n,t,e),s}var PA=.1,Ba=class extends ar{constructor(){super();this.value=0;this.targetValue=0;this.object=de("LoadingBar");this._enabled=!0;this.valueBar=new fr(0,1,1,ph),this.valueBar.scale.set(0,1,1);let e=de("ValueBarContainer");e.scale.set(1,.1,.1),j(this,j(e,this.valueBar),ft(-.5,0,-.05,.01,.1,.01),ft(-.5,0,.05,.01,.1,.01),ft(.5,0,-.05,.01,.1,.01),ft(.5,0,.05,.01,.1,.01),ft(-.5,-.05,0,.01,.01,.1),ft(.5,-.05,0,.01,.01,.1),ft(-.5,.05,0,.01,.01,.1),ft(.5,.05,0,.01,.01,.1),ft(0,-.05,-.05,1,.01,.01),ft(0,.05,-.05,1,.01,.01),ft(0,-.05,.05,1,.01,.01),ft(0,.05,.05,1,.01,.01)),Bh(this,mi)}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,ke(this,ei(this)||this.enabled))}report(e,r,i){super.report(e,r,i),this.targetValue=this.p}update(e){this.object.parent.visible&&(this.value=Math.min(this.targetValue,this.value+PA*e),this.valueBar.scale.set(this.value,1,1),this.valueBar.position.x=this.value/2-.5,ke(this,this.enabled&&this.value>0))}};if(!fc()){let n=Element.prototype,t=Document.prototype;"webkitRequestFullscreen"in n?(n.requestFullscreen=n.webkitRequestFullscreen,t.exitFullscreen=t.webkitRequestFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.webkitFullscreenEnabled}},fullscreenElement:{get:function(){return this.webkitFullscreenElement}}})):"mozRequestFullScreen"in n?(n.requestFullscreen=n.mozRequestFullScreen,t.exitFullscreen=t.mozCancelFullScreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.mozFullScreenEnabled}},fullscreenElement:{get:function(){return this.mozFullScreenElement}}})):"msRequestFullscreen"in n&&(n.requestFullscreen=n.msRequestFullscreen,t.exitFullscreen=t.msExitFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.msFullscreenEnabled}},fullscreenElement:{get:function(){return this.msFullscreenElement}}}))}function fc(){return"requestFullscreen"in HTMLElement.prototype}var RA=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},Fa=RA;var yo=Symbol("@@webxr-polyfill/EventTarget"),on=class{constructor(){this[yo]={listeners:new Map}}addEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let r=this[yo].listeners.get(t)||[];r.push(e),this[yo].listeners.set(t,r)}removeEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let r=this[yo].listeners.get(t)||[];for(let i=r.length;i>=0;i--)r[i]===e&&r.pop()}dispatchEvent(t,e){let r=this[yo].listeners.get(t)||[],i=[];for(let o=0;o<r.length;o++)i[o]=r[o];for(let o of i)o(e);typeof this[`on${t}`]=="function"&&this[`on${t}`](e)}};var Ve=typeof Float32Array<"u"?Float32Array:Array;var F5=Math.PI/180;function Xt(){let n=new Ve(16);return Ve!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function mf(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function On(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function gr(n,t){let e=t[0],r=t[1],i=t[2],o=t[3],s=t[4],p=t[5],c=t[6],u=t[7],h=t[8],x=t[9],b=t[10],E=t[11],R=t[12],P=t[13],T=t[14],D=t[15],O=e*p-r*s,I=e*c-i*s,X=e*u-o*s,z=r*c-i*p,V=r*u-o*p,F=i*u-o*c,ie=h*P-x*R,oe=h*T-b*R,W=h*D-E*R,re=x*T-b*P,Ee=x*D-E*P,ve=b*D-E*T,se=O*ve-I*Ee+X*re+z*W-V*oe+F*ie;return se?(se=1/se,n[0]=(p*ve-c*Ee+u*re)*se,n[1]=(i*Ee-r*ve-o*re)*se,n[2]=(P*F-T*V+D*z)*se,n[3]=(b*V-x*F-E*z)*se,n[4]=(c*W-s*ve-u*oe)*se,n[5]=(e*ve-i*W+o*oe)*se,n[6]=(T*X-R*F-D*I)*se,n[7]=(h*F-b*X+E*I)*se,n[8]=(s*Ee-p*W+u*ie)*se,n[9]=(r*W-e*Ee-o*ie)*se,n[10]=(R*V-P*X+D*O)*se,n[11]=(x*X-h*V-E*O)*se,n[12]=(p*oe-s*re-c*ie)*se,n[13]=(e*re-r*oe+i*ie)*se,n[14]=(P*I-R*z-T*O)*se,n[15]=(h*z-x*I+b*O)*se,n):null}function sn(n,t,e){let r=t[0],i=t[1],o=t[2],s=t[3],p=t[4],c=t[5],u=t[6],h=t[7],x=t[8],b=t[9],E=t[10],R=t[11],P=t[12],T=t[13],D=t[14],O=t[15],I=e[0],X=e[1],z=e[2],V=e[3];return n[0]=I*r+X*p+z*x+V*P,n[1]=I*i+X*c+z*b+V*T,n[2]=I*o+X*u+z*E+V*D,n[3]=I*s+X*h+z*R+V*O,I=e[4],X=e[5],z=e[6],V=e[7],n[4]=I*r+X*p+z*x+V*P,n[5]=I*i+X*c+z*b+V*T,n[6]=I*o+X*u+z*E+V*D,n[7]=I*s+X*h+z*R+V*O,I=e[8],X=e[9],z=e[10],V=e[11],n[8]=I*r+X*p+z*x+V*P,n[9]=I*i+X*c+z*b+V*T,n[10]=I*o+X*u+z*E+V*D,n[11]=I*s+X*h+z*R+V*O,I=e[12],X=e[13],z=e[14],V=e[15],n[12]=I*r+X*p+z*x+V*P,n[13]=I*i+X*c+z*b+V*T,n[14]=I*o+X*u+z*E+V*D,n[15]=I*s+X*h+z*R+V*O,n}function kn(n,t,e){let r=t[0],i=t[1],o=t[2],s=t[3],p=r+r,c=i+i,u=o+o,h=r*p,x=r*c,b=r*u,E=i*c,R=i*u,P=o*u,T=s*p,D=s*c,O=s*u;return n[0]=1-(E+P),n[1]=x+O,n[2]=b-D,n[3]=0,n[4]=x-O,n[5]=1-(h+P),n[6]=R+T,n[7]=0,n[8]=b+D,n[9]=R-T,n[10]=1-(h+E),n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}function Na(n,t){return n[0]=t[12],n[1]=t[13],n[2]=t[14],n}function Xa(n,t){let e=t[0]+t[5]+t[10],r=0;return e>0?(r=Math.sqrt(e+1)*2,n[3]=.25*r,n[0]=(t[6]-t[9])/r,n[1]=(t[8]-t[2])/r,n[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=Math.sqrt(1+t[0]-t[5]-t[10])*2,n[3]=(t[6]-t[9])/r,n[0]=.25*r,n[1]=(t[1]+t[4])/r,n[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=Math.sqrt(1+t[5]-t[0]-t[10])*2,n[3]=(t[8]-t[2])/r,n[0]=(t[1]+t[4])/r,n[1]=.25*r,n[2]=(t[6]+t[9])/r):(r=Math.sqrt(1+t[10]-t[0]-t[5])*2,n[3]=(t[1]-t[4])/r,n[0]=(t[8]+t[2])/r,n[1]=(t[6]+t[9])/r,n[2]=.25*r),n}function za(n,t,e,r,i){let o=1/Math.tan(t/2),s;return n[0]=o/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,i!=null&&i!==1/0?(s=1/(r-i),n[10]=(i+r)*s,n[14]=2*i*r*s):(n[10]=-1,n[14]=-2*r),n}function at(){let n=new Ve(3);return Ve!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function xc(n){var t=new Ve(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function VA(n){let t=n[0],e=n[1],r=n[2];return Math.sqrt(t*t+e*e+r*r)}function tt(n,t,e){let r=new Ve(3);return r[0]=n,r[1]=t,r[2]=e,r}function vc(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function yi(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function gc(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function Ha(n,t){let e=t[0],r=t[1],i=t[2],o=e*e+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o),n}function So(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Ga(n,t,e){let r=t[0],i=t[1],o=t[2],s=e[0],p=e[1],c=e[2];return n[0]=i*c-o*p,n[1]=o*s-r*c,n[2]=r*p-i*s,n}function _r(n,t,e){let r=e[0],i=e[1],o=e[2],s=e[3],p=t[0],c=t[1],u=t[2],h=i*u-o*c,x=o*p-r*u,b=r*c-i*p,E=i*b-o*x,R=o*h-r*b,P=r*x-i*h,T=s*2;return h*=T,x*=T,b*=T,E*=2,R*=2,P*=2,n[0]=p+h+E,n[1]=c+x+R,n[2]=u+b+P,n}function ff(n,t){let e=tt(n[0],n[1],n[2]),r=tt(t[0],t[1],t[2]);Ha(e,e),Ha(r,r);let i=So(e,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}var xf=VA;var N5=function(){let n=at();return function(t,e,r,i,o,s){let p,c;for(e||(e=3),r||(r=0),i?c=Math.min(i*e+r,t.length):c=t.length,p=r;p<c;p+=e)n[0]=t[p],n[1]=t[p+1],n[2]=t[p+2],o(n,n,s),t[p]=n[0],t[p+1]=n[1],t[p+2]=n[2];return t}}();function vf(){let n=new Ve(9);return Ve!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function LA(){let n=new Ve(4);return Ve!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function gf(n){let t=new Ve(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function Af(n,t,e,r){let i=new Ve(4);return i[0]=n,i[1]=t,i[2]=e,i[3]=r,i}function _f(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function bf(n,t){let e=t[0],r=t[1],i=t[2],o=t[3],s=e*e+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s),n[0]=e*s,n[1]=r*s,n[2]=i*s,n[3]=o*s),n}var X5=function(){let n=LA();return function(t,e,r,i,o,s){let p,c;for(e||(e=4),r||(r=0),i?c=Math.min(i*e+r,t.length):c=t.length,p=r;p<c;p+=e)n[0]=t[p],n[1]=t[p+1],n[2]=t[p+2],n[3]=t[p+3],o(n,n,s),t[p]=n[0],t[p+1]=n[1],t[p+2]=n[2],t[p+3]=n[3];return t}}();function lt(){let n=new Ve(4);return Ve!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function OA(n,t,e){e=e*.5;let r=Math.sin(e);return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=Math.cos(e),n}function Ac(n,t,e){let r=t[0],i=t[1],o=t[2],s=t[3],p=e[0],c=e[1],u=e[2],h=e[3];return n[0]=r*h+s*p+i*u-o*c,n[1]=i*h+s*c+o*p-r*u,n[2]=o*h+s*u+r*c-i*p,n[3]=s*h-r*p-i*c-o*u,n}function Ei(n,t,e,r){let i=t[0],o=t[1],s=t[2],p=t[3],c=e[0],u=e[1],h=e[2],x=e[3],b,E,R,P,T;return E=i*c+o*u+s*h+p*x,E<0&&(E=-E,c=-c,u=-u,h=-h,x=-x),1-E>1e-6?(b=Math.acos(E),R=Math.sin(b),P=Math.sin((1-r)*b)/R,T=Math.sin(r*b)/R):(P=1-r,T=r),n[0]=P*i+T*c,n[1]=P*o+T*u,n[2]=P*s+T*h,n[3]=P*p+T*x,n}function _c(n,t){let e=t[0],r=t[1],i=t[2],o=t[3],s=e*e+r*r+i*i+o*o,p=s?1/s:0;return n[0]=-e*p,n[1]=-r*p,n[2]=-i*p,n[3]=o*p,n}function kA(n,t){let e=t[0]+t[4]+t[8],r;if(e>0)r=Math.sqrt(e+1),n[3]=.5*r,r=.5/r,n[0]=(t[5]-t[7])*r,n[1]=(t[6]-t[2])*r,n[2]=(t[1]-t[3])*r;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);let o=(i+1)%3,s=(i+2)%3;r=Math.sqrt(t[i*3+i]-t[o*3+o]-t[s*3+s]+1),n[i]=.5*r,r=.5/r,n[3]=(t[o*3+s]-t[s*3+o])*r,n[o]=(t[o*3+i]+t[i*3+o])*r,n[s]=(t[s*3+i]+t[i*3+s])*r}return n}function yf(n,t,e,r){let i=.5*Math.PI/180;t*=i,e*=i,r*=i;let o=Math.sin(t),s=Math.cos(t),p=Math.sin(e),c=Math.cos(e),u=Math.sin(r),h=Math.cos(r);return n[0]=o*c*h-s*p*u,n[1]=s*p*h+o*c*u,n[2]=s*c*u-o*p*h,n[3]=s*c*h+o*p*u,n}var bc=gf,Ef=Af,ja=_f;var Mo=bf;var Y5=function(){let n=at(),t=tt(1,0,0),e=tt(0,1,0);return function(r,i,o){let s=So(i,o);return s<-.999999?(Ga(n,t,i),xf(n)<1e-6&&Ga(n,e,i),Ha(n,n),OA(r,n,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Ga(n,i,o),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=1+s,Mo(r,r))}}(),J5=function(){let n=lt(),t=lt();return function(e,r,i,o,s,p){return Ei(n,r,s,p),Ei(t,i,o,p),Ei(e,n,t,2*p*(1-p)),e}}(),$5=function(){let n=vf();return function(t,e,r,i){return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],Mo(t,kA(t,n))}}();var ne=Symbol("@@webxr-polyfill/XRRigidTransform"),an=class{constructor(){if(this[ne]={matrix:null,position:null,orientation:null,inverse:null},arguments.length===0)this[ne].matrix=On(new Float32Array(16));else if(arguments.length===1)arguments[0]instanceof Float32Array?this[ne].matrix=arguments[0]:(this[ne].position=this._getPoint(arguments[0]),this[ne].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(arguments.length===2)this[ne].position=this._getPoint(arguments[0]),this[ne].orientation=this._getPoint(arguments[1]);else throw new Error("Too many arguments!");if(this[ne].matrix){let t=at();Na(t,this[ne].matrix),this[ne].position=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2]});let e=lt();Xa(e,this[ne].matrix),this[ne].orientation=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2],w:e[3]})}else this[ne].matrix=On(new Float32Array(16)),kn(this[ne].matrix,Ef(this[ne].orientation.x,this[ne].orientation.y,this[ne].orientation.z,this[ne].orientation.w),tt(this[ne].position.x,this[ne].position.y,this[ne].position.z))}_getPoint(t){return t instanceof DOMPointReadOnly?t:DOMPointReadOnly.fromPoint(t)}get matrix(){return this[ne].matrix}get position(){return this[ne].position}get orientation(){return this[ne].orientation}get inverse(){if(this[ne].inverse===null){let t=On(new Float32Array(16));gr(t,this[ne].matrix),this[ne].inverse=new an(t),this[ne].inverse[ne].inverse=this}return this[ne].inverse}};var ye=Symbol("@@webxr-polyfill/XRSpace");var xt=class{constructor(t=null,e=null){this[ye]={specialType:t,inputSource:e,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[ye].specialType}get _inputSource(){return this[ye].inputSource}_ensurePoseUpdated(t,e){e!=this[ye].lastFrameId&&(this[ye].lastFrameId=e,this._onPoseUpdate(t))}_onPoseUpdate(t){this[ye].specialType=="viewer"&&(this._baseMatrix=t.getBasePoseMatrix())}set _baseMatrix(t){this[ye].baseMatrix=t,this[ye].inverseBaseMatrix=null}get _baseMatrix(){return this[ye].baseMatrix||this[ye].inverseBaseMatrix&&(this[ye].baseMatrix=new Float32Array(16),gr(this[ye].baseMatrix,this[ye].inverseBaseMatrix)),this[ye].baseMatrix}set _inverseBaseMatrix(t){this[ye].inverseBaseMatrix=t,this[ye].baseMatrix=null}get _inverseBaseMatrix(){return this[ye].inverseBaseMatrix||this[ye].baseMatrix&&(this[ye].inverseBaseMatrix=new Float32Array(16),gr(this[ye].inverseBaseMatrix,this[ye].baseMatrix)),this[ye].inverseBaseMatrix}_getSpaceRelativeTransform(t){if(!this._inverseBaseMatrix||!t._baseMatrix)return null;let e=new Float32Array(16);return sn(e,this._inverseBaseMatrix,t._baseMatrix),new an(e)}};var BA=1.6,Bn=Symbol("@@webxr-polyfill/XRReferenceSpace"),To=["viewer","local","local-floor","bounded-floor","unbounded"];function FA(n){return n==="bounded-floor"||n==="local-floor"}var zt=class extends xt{constructor(t,e=null){if(!To.includes(t))throw new Error(`XRReferenceSpaceType must be one of ${To}`);if(super(t),t==="bounded-floor"&&!e)throw new Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");FA(t)&&!e&&(e=On(new Float32Array(16)),e[13]=BA),this._inverseBaseMatrix=e||On(new Float32Array(16)),this[Bn]={type:t,transform:e,originOffset:On(new Float32Array(16))}}_transformBasePoseMatrix(t,e){sn(t,this._inverseBaseMatrix,e)}_originOffsetMatrix(){return this[Bn].originOffset}_adjustForOriginOffset(t){let e=new Float32Array(16);gr(e,this[Bn].originOffset),sn(t,e,t)}_getSpaceRelativeTransform(t){let e=super._getSpaceRelativeTransform(t);return this._adjustForOriginOffset(e.matrix),new XRRigidTransform(e.matrix)}getOffsetReferenceSpace(t){let e=new zt(this[Bn].type,this[Bn].transform,this[Bn].bounds);return sn(e[Bn].originOffset,this[Bn].originOffset,t.matrix),e}};var Ye=Symbol("@@webxr-polyfill/XR"),NA=["inline","immersive-vr","immersive-ar"],XA={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},zA=`Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode
or navigator.xr.requestSession('inline') prior to requesting an immersive
session. This is a limitation specific to the WebXR Polyfill and does not apply
to native implementations of the API.`,Co=class extends on{constructor(t){super(),this[Ye]={device:null,devicePromise:t,immersiveSession:null,inlineSessions:new Set},t.then(e=>{this[Ye].device=e})}async isSessionSupported(t){return this[Ye].device||await this[Ye].devicePromise,t!="inline"?Promise.resolve(this[Ye].device.isSessionSupported(t)):Promise.resolve(!0)}async requestSession(t,e){if(!this[Ye].device){if(t!="inline")throw new Error(zA);await this[Ye].devicePromise}if(!NA.includes(t))throw new TypeError(`The provided value '${t}' is not a valid enum value of type XRSessionMode`);let r=XA[t],i=r.requiredFeatures.concat(e&&e.requiredFeatures?e.requiredFeatures:[]),o=r.optionalFeatures.concat(e&&e.optionalFeatures?e.optionalFeatures:[]),s=new Set,p=!1;for(let x of i)this[Ye].device.isFeatureSupported(x)?s.add(x):(console.error(`The required feature '${x}' is not supported`),p=!0);if(p)throw new DOMException("Session does not support some required features","NotSupportedError");for(let x of o)this[Ye].device.isFeatureSupported(x)?s.add(x):console.log(`The optional feature '${x}' is not supported`);let c=await this[Ye].device.requestSession(t,s),u=new XRSession(this[Ye].device,t,c);t=="inline"?this[Ye].inlineSessions.add(u):this[Ye].immersiveSession=u;let h=()=>{t=="inline"?this[Ye].inlineSessions.delete(u):this[Ye].immersiveSession=null,u.removeEventListener("end",h)};return u.addEventListener("end",h),u}};var Ec;if("performance"in Fa)Ec=()=>performance.now();else{let n=Date.now();Ec=()=>Date.now()-n}var Wa=Ec;var wc=Symbol("@@webxr-polyfill/XRPose"),br=class{constructor(t,e){this[wc]={transform:t,emulatedPosition:e}}get transform(){return this[wc].transform}get emulatedPosition(){return this[wc].emulatedPosition}};var wf=Symbol("@@webxr-polyfill/XRViewerPose"),yr=class extends br{constructor(t,e,r=!1){super(t,r),this[wf]={views:e}}get views(){return this[wf].views}};var Po=Symbol("@@webxr-polyfill/XRViewport"),Er=class{constructor(t){this[Po]={target:t}}get x(){return this[Po].target.x}get y(){return this[Po].target.y}get width(){return this[Po].target.width}get height(){return this[Po].target.height}};var Sf=["left","right","none"],Fn=Symbol("@@webxr-polyfill/XRView"),wr=class{constructor(t,e,r,i){if(!Sf.includes(r))throw new Error(`XREye must be one of: ${Sf}`);let o=Object.create(null),s=new Er(o);this[Fn]={device:t,eye:r,viewport:s,temp:o,sessionId:i,transform:e}}get eye(){return this[Fn].eye}get projectionMatrix(){return this[Fn].device.getProjectionMatrix(this.eye)}get transform(){return this[Fn].transform}_getViewport(t){if(this[Fn].device.getViewport(this[Fn].sessionId,this.eye,t,this[Fn].temp))return this[Fn].viewport}};var Me=Symbol("@@webxr-polyfill/XRFrame"),Mf="XRFrame access outside the callback that produced it is invalid.",HA="getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.",GA=0,Nn=class{constructor(t,e,r){this[Me]={id:++GA,active:!1,animationFrame:!1,device:t,session:e,sessionId:r}}get session(){return this[Me].session}getViewerPose(t){if(!this[Me].animationFrame)throw new DOMException(HA,"InvalidStateError");if(!this[Me].active)throw new DOMException(Mf,"InvalidStateError");let e=this[Me].device,r=this[Me].session;r[w].viewerSpace._ensurePoseUpdated(e,this[Me].id),t._ensurePoseUpdated(e,this[Me].id);let i=t._getSpaceRelativeTransform(r[w].viewerSpace),o=[];for(let p of r[w].viewSpaces){p._ensurePoseUpdated(e,this[Me].id);let c=t._getSpaceRelativeTransform(p),u=new wr(e,c,p.eye,this[Me].sessionId);o.push(u)}return new yr(i,o,!1)}getPose(t,e){if(!this[Me].active)throw new DOMException(Mf,"InvalidStateError");let r=this[Me].device;if(t._specialType==="target-ray"||t._specialType==="grip")return r.getInputPose(t._inputSource,e,t._specialType);{t._ensurePoseUpdated(r,this[Me].id),e._ensurePoseUpdated(r,this[Me].id);let i=e._getSpaceRelativeTransform(t);return i?new XRPose(i,!1):null}return null}};var Ro=Symbol("@@webxr-polyfill/XRRenderState"),UA=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null}),Xn=class{constructor(t={}){let e=Object.assign({},UA,t);this[Ro]={config:e}}get depthNear(){return this[Ro].config.depthNear}get depthFar(){return this[Ro].config.depthFar}get inlineVerticalFieldOfView(){return this[Ro].config.inlineVerticalFieldOfView}get baseLayer(){return this[Ro].config.baseLayer}};var Qa=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),Vo=Symbol("@@webxr-polyfill/xr-compatible");var Sr=Symbol("@@webxr-polyfill/XRWebGLLayer"),jA=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),Io=class{constructor(t,e,r={}){let i=Object.assign({},jA,r);if(!(t instanceof Mr))throw new Error("session must be a XRSession");if(t.ended)throw new Error("InvalidStateError");if(e[Qa]&&e[Vo]!==!0)throw new Error("InvalidStateError");let o=e.getParameter(e.FRAMEBUFFER_BINDING);this[Sr]={context:e,config:i,framebuffer:o,session:t}}get context(){return this[Sr].context}get antialias(){return this[Sr].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return this[Sr].framebuffer}get framebufferWidth(){return this[Sr].context.drawingBufferWidth}get framebufferHeight(){return this[Sr].context.drawingBufferHeight}get _session(){return this[Sr].session}getViewport(t){return t._getViewport(this)}static getNativeFramebufferScaleFactor(t){if(!t)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return t[w].ended?0:1}};var Sc=Symbol("@@webxr-polyfill/XRInputSourceEvent"),ln=class extends Event{constructor(t,e){super(t,e),this[Sc]={frame:e.frame,inputSource:e.inputSource},Object.setPrototypeOf(this,ln.prototype)}get frame(){return this[Sc].frame}get inputSource(){return this[Sc].inputSource}};var Tf=Symbol("@@webxr-polyfill/XRSessionEvent"),Ht=class extends Event{constructor(t,e){super(t,e),this[Tf]={session:e.session},Object.setPrototypeOf(this,Ht.prototype)}get session(){return this[Tf].session}};var qa=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),pn=class extends Event{constructor(t,e){super(t,e),this[qa]={session:e.session,added:e.added,removed:e.removed},Object.setPrototypeOf(this,pn.prototype)}get session(){return this[qa].session}get added(){return this[qa].added}get removed(){return this[qa].removed}};var w=Symbol("@@webxr-polyfill/XRSession"),Lo=class extends xt{constructor(t){super(t)}get eye(){return this._specialType}_onPoseUpdate(t){this._inverseBaseMatrix=t.getBaseViewMatrix(this._specialType)}},Mr=class extends on{constructor(t,e,r){super();let i=e!="inline",o=new Xn({inlineVerticalFieldOfView:i?null:Math.PI*.5});this[w]={device:t,mode:e,immersive:i,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:r,activeRenderState:o,pendingRenderState:null,viewerSpace:new zt("viewer"),viewSpaces:[],currentInputSources:[]},i?this[w].viewSpaces.push(new Lo("left"),new Lo("right")):this[w].viewSpaces.push(new Lo("none")),this[w].onDeviceFrame=()=>{if(this[w].ended||this[w].suspended||(this[w].deviceFrameHandle=null,this[w].startDeviceFrameLoop(),this[w].pendingRenderState!==null&&(this[w].activeRenderState=new Xn(this[w].pendingRenderState),this[w].pendingRenderState=null,this[w].activeRenderState.baseLayer&&this[w].device.onBaseLayerSet(this[w].id,this[w].activeRenderState.baseLayer)),this[w].activeRenderState.baseLayer===null))return;let s=new Nn(t,this,this[w].id),p=this[w].currentFrameCallbacks=this[w].frameCallbacks;this[w].frameCallbacks=[],s[Me].active=!0,s[Me].animationFrame=!0,this[w].device.onFrameStart(this[w].id,this[w].activeRenderState),this._checkInputSourcesChange();let c=Wa();for(let u=0;u<p.length;u++)try{!p[u].cancelled&&typeof p[u].callback=="function"&&p[u].callback(c,s)}catch(h){console.error(h)}this[w].currentFrameCallbacks=null,s[Me].active=!1,this[w].device.onFrameEnd(this[w].id)},this[w].startDeviceFrameLoop=()=>{this[w].deviceFrameHandle===null&&(this[w].deviceFrameHandle=this[w].device.requestAnimationFrame(this[w].onDeviceFrame))},this[w].stopDeviceFrameLoop=()=>{let s=this[w].deviceFrameHandle;s!==null&&(this[w].device.cancelAnimationFrame(s),this[w].deviceFrameHandle=null)},this[w].onPresentationEnd=s=>{if(s!==this[w].id){this[w].suspended=!1,this[w].startDeviceFrameLoop(),this.dispatchEvent("focus",{session:this});return}this[w].ended=!0,this[w].stopDeviceFrameLoop(),t.removeEventListener("@@webxr-polyfill/vr-present-end",this[w].onPresentationEnd),t.removeEventListener("@@webxr-polyfill/vr-present-start",this[w].onPresentationStart),t.removeEventListener("@@webxr-polyfill/input-select-start",this[w].onSelectStart),t.removeEventListener("@@webxr-polyfill/input-select-end",this[w].onSelectEnd),this.dispatchEvent("end",new Ht("end",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-end",this[w].onPresentationEnd),this[w].onPresentationStart=s=>{s!==this[w].id&&(this[w].suspended=!0,this[w].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-start",this[w].onPresentationStart),this[w].onSelectStart=s=>{s.sessionId===this[w].id&&this[w].dispatchInputSourceEvent("selectstart",s.inputSource)},t.addEventListener("@@webxr-polyfill/input-select-start",this[w].onSelectStart),this[w].onSelectEnd=s=>{s.sessionId===this[w].id&&(this[w].dispatchInputSourceEvent("selectend",s.inputSource),this[w].dispatchInputSourceEvent("select",s.inputSource))},t.addEventListener("@@webxr-polyfill/input-select-end",this[w].onSelectEnd),this[w].onSqueezeStart=s=>{s.sessionId===this[w].id&&this[w].dispatchInputSourceEvent("squeezestart",s.inputSource)},t.addEventListener("@@webxr-polyfill/input-squeeze-start",this[w].onSqueezeStart),this[w].onSqueezeEnd=s=>{s.sessionId===this[w].id&&(this[w].dispatchInputSourceEvent("squeezeend",s.inputSource),this[w].dispatchInputSourceEvent("squeeze",s.inputSource))},t.addEventListener("@@webxr-polyfill/input-squeeze-end",this[w].onSqueezeEnd),this[w].dispatchInputSourceEvent=(s,p)=>{let c=new Nn(t,this,this[w].id),u=new ln(s,{frame:c,inputSource:p});c[Me].active=!0,this.dispatchEvent(s,u),c[Me].active=!1},this[w].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[w].activeRenderState}get environmentBlendMode(){return this[w].device.environmentBlendMode||"opaque"}async requestReferenceSpace(t){if(this[w].ended)return;if(!To.includes(t))throw new TypeError(`XRReferenceSpaceType must be one of ${To}`);if(!this[w].device.doesSessionSupportReferenceSpace(this[w].id,t))throw new DOMException(`The ${t} reference space is not supported by this session.`,"NotSupportedError");if(t==="viewer")return this[w].viewerSpace;let e=await this[w].device.requestFrameOfReferenceTransform(t);if(t==="bounded-floor")throw e?this[w].device.requestStageBounds()?new DOMException(`The WebXR polyfill does not support the ${t} reference space yet.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError");return new zt(t,e)}requestAnimationFrame(t){if(this[w].ended)return;let e=++this[w].frameHandle;return this[w].frameCallbacks.push({handle:e,callback:t,cancelled:!1}),e}cancelAnimationFrame(t){let e=this[w].frameCallbacks,r=e.findIndex(i=>i&&i.handle===t);r>-1&&(e[r].cancelled=!0,e.splice(r,1)),e=this[w].currentFrameCallbacks,e&&(r=e.findIndex(i=>i&&i.handle===t),r>-1&&(e[r].cancelled=!0))}get inputSources(){return this[w].device.getInputSources()}async end(){if(!this[w].ended)return this[w].immersive&&(this[w].ended=!0,this[w].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[w].onPresentationStart),this[w].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[w].onPresentationEnd),this[w].device.removeEventListener("@@webxr-polyfill/input-select-start",this[w].onSelectStart),this[w].device.removeEventListener("@@webxr-polyfill/input-select-end",this[w].onSelectEnd),this.dispatchEvent("end",new Ht("end",{session:this}))),this[w].stopDeviceFrameLoop(),this[w].device.endSession(this[w].id)}updateRenderState(t){if(this[w].ended){let r="Can't call updateRenderState on an XRSession that has already ended.";throw new Error(r)}if(t.baseLayer&&t.baseLayer._session!==this){let r="Called updateRenderState with a base layer that was created by a different session.";throw new Error(r)}if(t.inlineVerticalFieldOfView!==null&&t.inlineVerticalFieldOfView!==void 0)if(this[w].immersive){let r="inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.";throw new Error(r)}else t.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,t.inlineVerticalFieldOfView));if(this[w].pendingRenderState===null){let r=this[w].activeRenderState;this[w].pendingRenderState={depthNear:r.depthNear,depthFar:r.depthFar,inlineVerticalFieldOfView:r.inlineVerticalFieldOfView,baseLayer:r.baseLayer}}Object.assign(this[w].pendingRenderState,t)}_checkInputSourcesChange(){let t=[],e=[],r=this.inputSources,i=this[w].currentInputSources;for(let o of r)i.includes(o)||t.push(o);for(let o of i)r.includes(o)||e.push(o);(t.length>0||e.length>0)&&this.dispatchEvent("inputsourceschange",new pn("inputsourceschange",{session:this,added:t,removed:e})),this[w].currentInputSources.length=0;for(let o of r)this[w].currentInputSources.push(o)}};var zn=Symbol("@@webxr-polyfill/XRInputSource"),Tr=class{constructor(t){this[zn]={impl:t,gripSpace:new xt("grip",this),targetRaySpace:new xt("target-ray",this)}}get handedness(){return this[zn].impl.handedness}get targetRayMode(){return this[zn].impl.targetRayMode}get gripSpace(){let t=this[zn].impl.targetRayMode;return t==="gaze"||t==="screen"?null:this[zn].gripSpace}get targetRaySpace(){return this[zn].targetRaySpace}get profiles(){return this[zn].impl.profiles}get gamepad(){return this[zn].impl.gamepad}};var Mc=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),Cr=class extends Event{constructor(t,e){super(t,e),this[Mc]={referenceSpace:e.referenceSpace,transform:e.transform||null},Object.setPrototypeOf(this,Cr.prototype)}get referenceSpace(){return this[Mc].referenceSpace}get transform(){return this[Mc].transform}};var Ka={XRSystem:Co,XRSession:Mr,XRSessionEvent:Ht,XRFrame:Nn,XRView:wr,XRViewport:Er,XRViewerPose:yr,XRWebGLLayer:Io,XRSpace:xt,XRReferenceSpace:zt,XRReferenceSpaceEvent:Cr,XRInputSource:Tr,XRInputSourceEvent:ln,XRInputSourcesChangeEvent:pn,XRRenderState:Xn,XRRigidTransform:an,XRPose:br};var Tc=n=>typeof n.prototype.makeXRCompatible=="function"?!1:(n.prototype.makeXRCompatible=function(){return this[Vo]=!0,Promise.resolve()},!0),Cc=n=>{let t=n.prototype.getContext;n.prototype.getContext=function(e,r){let i=t.call(this,e,r);return i&&(i[Qa]=!0,r&&"xrCompatible"in r&&(i[Vo]=r.xrCompatible)),i}};var Cf=n=>!!(n.ImageBitmapRenderingContext&&n.createImageBitmap),Pf=n=>{var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(n.navigator.userAgent||n.navigator.vendor||n.opera),t},Rf=n=>{n.style.display="block",n.style.position="absolute",n.style.width=n.style.height="1px",n.style.top=n.style.left="0px"};var zf=Lx(Vf());var Pr=class extends on{constructor(t){super(),this.global=t,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(t,e){throw new Error("Not implemented")}isSessionSupported(t){throw new Error("Not implemented")}isFeatureSupported(t){throw new Error("Not implemented")}async requestSession(t,e){throw new Error("Not implemented")}requestAnimationFrame(t){throw new Error("Not implemented")}onFrameStart(t){throw new Error("Not implemented")}onFrameEnd(t){throw new Error("Not implemented")}doesSessionSupportReferenceSpace(t,e){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(t,e){}cancelAnimationFrame(t){throw new Error("Not implemented")}endSession(t){throw new Error("Not implemented")}getViewport(t,e,r,i){throw new Error("Not implemented")}getProjectionMatrix(t){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(t){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(t,e,r){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}};var WA={mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},QA={mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},qA={mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},If={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},KA={mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[Math.PI*-.08,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},YA={mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},JA={mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},Vc={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},$A={"Daydream Controller":WA,"Gear VR Controller":YA,"HTC Vive Focus Controller":QA,"Oculus Go Controller":qA,"Oculus Touch (Right)":If,"Oculus Touch (Left)":If,"OpenVR Gamepad":KA,"Spatial Controller (Spatial Interaction Source) 045E-065A":Vc,"Spatial Controller (Spatial Interaction Source) 045E-065D":JA,"Windows Mixed Reality (Right)":Vc,"Windows Mixed Reality (Left)":Vc},Lf=$A;var Df=tt(.155,-.465,-.15),ZA=tt(-.155,-.465,-.15),e_=tt(0,0,-.25),t_=tt(0,0,.05),Of=tt(-.08,.14,.08),kf=.4,n_=.4,r_=.61,i_=.175,o_=.12,s_=.87,Bf=180/Math.PI;function a_(n,t,e){function r(c,u,h){return c<u?u:c>h?h:c}var i=t[0]*t[0],o=t[1]*t[1],s=t[2]*t[2],p=t[3]*t[3];if(e==="XYZ")n[0]=Math.atan2(2*(t[0]*t[3]-t[1]*t[2]),p-i-o+s),n[1]=Math.asin(r(2*(t[0]*t[2]+t[1]*t[3]),-1,1)),n[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),p+i-o-s);else if(e==="YXZ")n[0]=Math.asin(r(2*(t[0]*t[3]-t[1]*t[2]),-1,1)),n[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),p-i-o+s),n[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),p-i+o-s);else if(e==="ZXY")n[0]=Math.asin(r(2*(t[0]*t[3]+t[1]*t[2]),-1,1)),n[1]=Math.atan2(2*(t[1]*t[3]-t[2]*t[0]),p-i-o+s),n[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),p-i+o-s);else if(e==="ZYX")n[0]=Math.atan2(2*(t[0]*t[3]+t[2]*t[1]),p-i-o+s),n[1]=Math.asin(r(2*(t[1]*t[3]-t[0]*t[2]),-1,1)),n[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),p+i-o-s);else if(e==="YZX")n[0]=Math.atan2(2*(t[0]*t[3]-t[2]*t[1]),p-i+o-s),n[1]=Math.atan2(2*(t[1]*t[3]-t[0]*t[2]),p+i-o-s),n[2]=Math.asin(r(2*(t[0]*t[1]+t[2]*t[3]),-1,1));else if(e==="XZY")n[0]=Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),p-i+o-s),n[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),p+i-o-s),n[2]=Math.asin(r(2*(t[2]*t[3]-t[0]*t[1]),-1,1));else{console.log("No order given for quaternion to euler conversion.");return}}var Do=class{constructor(){this.hand="right",this.headElbowOffset=Df,this.controllerQ=lt(),this.lastControllerQ=lt(),this.headQ=lt(),this.headPos=at(),this.elbowPos=at(),this.wristPos=at(),this.time=null,this.lastTime=null,this.rootQ=lt(),this.position=at()}setHandedness(t){this.hand!=t&&(this.hand=t,this.hand=="left"?this.headElbowOffset=ZA:this.headElbowOffset=Df)}update(t,e){this.time=Wa(),t&&(ja(this.lastControllerQ,this.controllerQ),ja(this.controllerQ,t)),e&&(Na(this.headPos,e),Xa(this.headQ,e));let r=this.getHeadYawOrientation_(),i=this.quatAngle_(this.lastControllerQ,this.controllerQ),o=(this.time-this.lastTime)/1e3;i/o>r_?Ei(this.rootQ,this.rootQ,r,Math.min(i/i_,1)):ja(this.rootQ,r);let p=tt(0,0,-1);_r(p,p,this.controllerQ);let c=So(p,[0,1,0]),u=this.clamp_((c-o_)/s_,0,1),h=bc(this.rootQ);_c(h,h),Ac(h,h,this.controllerQ);let x=this.elbowPos;vc(x,this.headPos),yi(x,x,this.headElbowOffset);let b=xc(Of);gc(b,b,u),yi(x,x,b);let R=this.quatAngle_(h,lt())*Bf,P=1-Math.pow(R/180,4);sssss;let T=kf,D=1-kf,O=P*(T+D*u*n_),I=lt();Ei(I,I,h,O);let X=_c(lt(),I),z=bc(h);Ac(z,z,X);let V=this.wristPos;vc(V,t_),_r(V,V,I),yi(V,V,e_),_r(V,V,z),yi(V,V,x);let F=xc(Of);gc(F,F,u),yi(this.position,this.wristPos,F),_r(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let t=at();return a_(t,this.headQ,"YXZ"),yf(lt(),0,t[1]*Bf,0)}clamp_(t,e,r){return Math.min(Math.max(t,e),r)}quatAngle_(t,e){let r=[0,0,-1],i=[0,0,-1];return _r(r,r,t),_r(i,i,e),ff(r,i)}};var Qe=Symbol("@@webxr-polyfill/XRRemappedGamepad"),Ff={pressed:!1,touched:!1,value:0};Object.freeze(Ff);var Ic=class{constructor(t,e,r){if(r||(r={}),r.userAgentOverrides){for(let u in r.userAgentOverrides)if(navigator.userAgent.includes(u)){let h=r.userAgentOverrides[u];for(let x in h)x in r?Object.assign(r[x],h[x]):r[x]=h[x];break}}let i=new Array(r.axes&&r.axes.length?r.axes.length:t.axes.length),o=new Array(r.buttons&&r.buttons.length?r.buttons.length:t.buttons.length),s=null;if(r.gripTransform){let u=r.gripTransform.orientation||[0,0,0,1];s=Xt(),kn(s,Mo(u,u),r.gripTransform.position||[0,0,0])}let p=null;if(r.targetRayTransform){let u=r.targetRayTransform.orientation||[0,0,0,1];p=Xt(),kn(p,Mo(u,u),r.targetRayTransform.position||[0,0,0])}let c=r.profiles;r.displayProfiles&&e.displayName in r.displayProfiles&&(c=r.displayProfiles[e.displayName]),this[Qe]={gamepad:t,map:r,profiles:c||[t.id],mapping:r.mapping||t.mapping,axes:i,buttons:o,gripTransform:s,targetRayTransform:p},this._update()}_update(){let t=this[Qe].gamepad,e=this[Qe].map,r=this[Qe].axes;for(let o=0;o<r.length;++o)e.axes&&o in e.axes?e.axes[o]===null?r[o]=0:r[o]=t.axes[e.axes[o]]:r[o]=t.axes[o];if(e.axes&&e.axes.invert)for(let o of e.axes.invert)o<r.length&&(r[o]*=-1);let i=this[Qe].buttons;for(let o=0;o<i.length;++o)e.buttons&&o in e.buttons?e.buttons[o]===null?i[o]=Ff:i[o]=t.buttons[e.buttons[o]]:i[o]=t.buttons[o]}get id(){return""}get _profiles(){return this[Qe].profiles}get index(){return-1}get connected(){return this[Qe].gamepad.connected}get timestamp(){return this[Qe].gamepad.timestamp}get mapping(){return this[Qe].mapping}get axes(){return this[Qe].axes}get buttons(){return this[Qe].buttons}get hapticActuators(){return this[Qe].gamepad.hapticActuators}},Oo=class{constructor(t,e,r=0,i=-1){this.polyfill=t,this.display=e,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new Tr(this),this.lastPosition=at(),this.emulatedPosition=!1,this.basePoseMatrix=Xt(),this.outputMatrix=Xt(),this.primaryButtonIndex=r,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=i,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(t){this.nativeGamepad!==t&&(this.nativeGamepad=t,t?this.gamepad=new Ic(t,this.display,Lf[t.id]):this.gamepad=null),this.handedness=t.hand===""?"none":t.hand,this.gamepad&&this.gamepad._update(),t.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!t.pose.hasPosition):t.hand===""&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let t=this.nativeGamepad.pose,e=t.position,r=t.orientation;if(!e&&!r)return;e?(this.lastPosition[0]=e[0],this.lastPosition[1]=e[1],this.lastPosition[2]=e[2]):t.hasPosition?e=this.lastPosition:(this.armModel||(this.armModel=new Do),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(r,this.polyfill.getBasePoseMatrix()),e=this.armModel.getPosition()),kn(this.basePoseMatrix,r,e)}else mf(this.basePoseMatrix,this.polyfill.getBasePoseMatrix());return this.basePoseMatrix}getXRPose(t,e){switch(this.updateBasePoseMatrix(),e){case"target-ray":t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[Qe].targetRayTransform&&sn(this.outputMatrix,this.outputMatrix,this.gamepad[Qe].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[Qe].gripTransform&&sn(this.outputMatrix,this.outputMatrix,this.gamepad[Qe].gripTransform);break;default:return null}return t._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}};var MO=Symbol("@@webxr-polyfill/WebVRDevice"),ko=!1,Nf={highRefreshRate:!0},Xf={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},l_=0,Lc=class{constructor(t,e,r={}){if(this.mode=t,this.enabledFeatures=e,this.outputContext=null,this.immersive=t=="immersive-vr"||t=="immersive-ar",this.ended=null,this.baseLayer=null,this.id=++l_,this.modifiedCanvasLayer=!1,this.outputContext&&!ko){let i=r.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(i)}}},Rr=class extends Pr{constructor(t,e){let{canPresent:r}=e.capabilities;super(t),this.display=e,this.frame=new t.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=r,this.baseModelMatrix=Xt(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),t.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=t.navigator&&"getGamepads"in t.navigator,this.HAS_BITMAP_SUPPORT=Cf(t)}get depthNear(){return this.display.depthNear}set depthNear(t){this.display.depthNear=t}get depthFar(){return this.display.depthFar}set depthFar(t){this.display.depthFar=t}onBaseLayerSet(t,e){let r=this.sessions.get(t),i=e.context.canvas;if(r.immersive){let o=this.display.getEyeParameters("left"),s=this.display.getEyeParameters("right");i.width=Math.max(o.renderWidth,s.renderWidth)*2,i.height=Math.max(o.renderHeight,s.renderHeight),this.display.requestPresent([{source:i,attributes:Nf}]).then(()=>{!ko&&!this.global.document.body.contains(i)&&(r.modifiedCanvasLayer=!0,this.global.document.body.appendChild(i),Rf(i)),r.baseLayer=e})}else r.baseLayer=e}isSessionSupported(t){return!(t=="immersive-ar"||t=="immersive-vr"&&this.canPresent===!1)}isFeatureSupported(t){switch(t){case"viewer":return!0;case"local":return!0;case"local-floor":return!0;case"bounded":return!1;case"unbounded":return!1;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let r=t=="immersive-vr";if(r){let o=this.global.document.createElement("canvas");if(!ko){let s=o.getContext("webgl")}await this.display.requestPresent([{source:o,attributes:Nf}])}let i=new Lc(t,e,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(i.id,i),r&&(this.immersiveSession=i,this.dispatchEvent("@@webxr-polyfill/vr-present-start",i.id)),Promise.resolve(i.id)}requestAnimationFrame(t){return this.display.requestAnimationFrame(t)}getPrimaryButtonIndex(t){let e=0,r=t.id.toLowerCase();for(let i in Xf)if(r.includes(i)){e=Xf[i];break}return Math.min(e,t.buttons.length-1)}onFrameStart(t,e){this.display.depthNear=e.depthNear,this.display.depthFar=e.depthFar,this.display.getFrameData(this.frame);let r=this.sessions.get(t);if(r.immersive&&this.CAN_USE_GAMEPAD){let i=this.gamepadInputSources;this.gamepadInputSources={};let o=this.global.navigator.getGamepads();for(let s=0;s<o.length;++s){let p=o[s];if(p&&p.displayId>0){let c=i[s];if(c||(c=new Oo(this,this.display,this.getPrimaryButtonIndex(p))),c.updateFromGamepad(p),this.gamepadInputSources[s]=c,c.primaryButtonIndex!=-1){let u=p.buttons[c.primaryButtonIndex].pressed;u&&!c.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:r.id,inputSource:c.inputSource}):!u&&c.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:r.id,inputSource:c.inputSource}),c.primaryActionPressed=u}if(c.primarySqueezeButtonIndex!=-1){let u=p.buttons[c.primarySqueezeButtonIndex].pressed;u&&!c.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:r.id,inputSource:c.inputSource}):!u&&c.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:r.id,inputSource:c.inputSource}),c.primarySqueezeActionPressed=u}}}}if(!ko&&!r.immersive&&r.baseLayer){let i=r.baseLayer.context.canvas;za(this.frame.leftProjectionMatrix,e.inlineVerticalFieldOfView,i.width/i.height,e.depthNear,e.depthFar)}}onFrameEnd(t){let e=this.sessions.get(t);if(!(e.ended||!e.baseLayer)){if(e.outputContext&&!(e.immersive&&!this.display.capabilities.hasExternalDisplay)){let r=e.immersive&&this.display.capabilities.hasExternalDisplay,i=e.baseLayer.context.canvas,o=r?i.width/2:i.width,s=i.height;if(!ko){let p=e.outputContext.canvas,c=p.width,u=p.height,h=e.renderContext;this.HAS_BITMAP_SUPPORT?i.transferToImageBitmap?h.transferFromImageBitmap(i.transferToImageBitmap()):this.global.createImageBitmap(i,0,0,o,s,{resizeWidth:c,resizeHeight:u}).then(x=>h.transferFromImageBitmap(x)):h.drawImage(i,0,0,o,s,0,0,c,u)}}e.immersive&&e.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(t){this.display.cancelAnimationFrame(t)}async endSession(t){let e=this.sessions.get(t);if(!e.ended){if(e.immersive)return this.display.exitPresent();e.ended=!0}}doesSessionSupportReferenceSpace(t,e){let r=this.sessions.get(t);return r.ended?!1:r.enabledFeatures.has(e)}requestStageBounds(){if(this.display.stageParameters){let t=this.display.stageParameters.sizeX,e=this.display.stageParameters.sizeZ,r=[];return r.push(-t/2),r.push(-e/2),r.push(t/2),r.push(-e/2),r.push(t/2),r.push(e/2),r.push(-t/2),r.push(e/2),r}return null}async requestFrameOfReferenceTransform(t,e){return(t==="local-floor"||t==="bounded-floor")&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(t){if(t==="left")return this.frame.leftProjectionMatrix;if(t==="right")return this.frame.rightProjectionMatrix;if(t==="none")return this.frame.leftProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(t,e,r,i){let o=this.sessions.get(t),{width:s,height:p}=r.context.canvas;if(!o.immersive)return i.x=i.y=0,i.width=s,i.height=p,!0;if(e==="left"||e==="none")i.x=0;else if(e==="right")i.x=s/2;else return!1;return i.y=0,i.width=s/2,i.height=p,!0}getBasePoseMatrix(){let{position:t,orientation:e}=this.frame.pose;return!t&&!e?this.baseModelMatrix:(t||(t=this.tempVec3,t[0]=t[1]=t[2]=0),kn(this.baseModelMatrix,e,t),this.baseModelMatrix)}getBaseViewMatrix(t){if(t==="left"||t==="none")return this.frame.leftViewMatrix;if(t==="right")return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let t=[];for(let e in this.gamepadInputSources)t.push(this.gamepadInputSources[e].inputSource);return t}getInputPose(t,e,r){if(!e)return null;for(let i in this.gamepadInputSources){let o=this.gamepadInputSources[i];if(o.inputSource===t)return o.getXRPose(e,r)}return null}onWindowResize(){}onVRDisplayPresentChange(t){this.display.isPresenting||this.sessions.forEach(e=>{if(e.immersive&&!e.ended){if(e.modifiedCanvasLayer){let r=e.baseLayer.context.canvas;document.body.removeChild(r),r.setAttribute("style","")}this.immersiveSession===e&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",e.id)}})}};var Bo=class extends Rr{constructor(t,e){let r=new zf.default(e||{});super(t,r),this.display=r,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}};var p_=!1,c_=0,Dc=class{constructor(t,e){this.mode=t,this.enabledFeatures=e,this.ended=null,this.baseLayer=null,this.id=++c_}},Fo=class extends Pr{constructor(t){super(t),this.sessions=new Map,this.projectionMatrix=Xt(),this.identityMatrix=Xt()}onBaseLayerSet(t,e){let r=this.sessions.get(t);r.baseLayer=e}isSessionSupported(t){return t=="inline"}isFeatureSupported(t){switch(t){case"viewer":return!0;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let r=new Dc(t,e);return this.sessions.set(r.id,r),Promise.resolve(r.id)}requestAnimationFrame(t){return window.requestAnimationFrame(t)}cancelAnimationFrame(t){window.cancelAnimationFrame(t)}onFrameStart(t,e){if(p_)return;let r=this.sessions.get(t);if(r.baseLayer){let i=r.baseLayer.context.canvas;za(this.projectionMatrix,e.inlineVerticalFieldOfView,i.width/i.height,e.depthNear,e.depthFar)}}onFrameEnd(t){}async endSession(t){let e=this.sessions.get(t);e.ended=!0}doesSessionSupportReferenceSpace(t,e){let r=this.sessions.get(t);return r.ended?!1:r.enabledFeatures.has(e)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(t,e){return null}getProjectionMatrix(t){return this.projectionMatrix}getViewport(t,e,r,i){let o=this.sessions.get(t),{width:s,height:p}=r.context.canvas;return i.x=i.y=0,i.width=s,i.height=p,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(t){return this.identityMatrix}getInputSources(){return[]}getInputPose(t,e,r){return null}onWindowResize(){}};var d_=async function(n){let t=null;if("getVRDisplays"in n.navigator)try{let e=await n.navigator.getVRDisplays();e&&e.length&&(t=new Rr(n,e[0]))}catch{}return t},Hf=async function(n,t){if(t.webvr){let r=await d_(n);if(r)return r}let e=Pf(n);return e&&t.cardboard||!e&&t.allowCardboardOnDesktop?(n.VRFrameData||(n.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new Bo(n,t.cardboardConfig)):new Fo(n)};var u_={global:Fa,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},Ya=["navigator","HTMLCanvasElement","WebGLRenderingContext"],No=class{constructor(t={}){this.config=Object.freeze(Object.assign({},u_,t)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}_injectPolyfill(t){if(!Ya.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${Ya}`);for(let e of Object.keys(Ka))t[e]!==void 0?console.warn(`${e} already defined on global.`):t[e]=Ka[e];Tc(t.WebGLRenderingContext)&&(Cc(t.HTMLCanvasElement),t.OffscreenCanvas&&Cc(t.OffscreenCanvas),t.WebGL2RenderingContext&&Tc(t.WebGL2RenderingContext),window.isSecureContext||console.warn(`WebXR Polyfill Warning:
This page is not running in a secure context (https:// or localhost)!
This means that although the page may be able to use the WebXR Polyfill it will
not be able to use native WebXR implementations, and as such will not be able to
access dedicated VR or AR hardware, and will not be able to take advantage of
any performance improvements a native WebXR implementation may offer. Please
host this content on a secure origin for the best user experience.
`)),this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let t=Hf(this.global,this.config);this.xr=new Ka.XRSystem(t),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(t){if(!Ya.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${Ya}`);if(t.navigator.xr&&"supportsSession"in t.navigator.xr&&!("isSessionSupported"in t.navigator.xr)){let e=t.navigator.xr.supportsSession;t.navigator.xr.isSessionSupported=function(r){return e.call(this,r).then(()=>!0).catch(()=>!1)},t.navigator.xr.supportsSession=function(r){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),e.call(this,r)}}}};navigator.xr||(console.info("Polyfilling WebXR API"),new No);var $a=class extends q{constructor(e,r,i,o,s){super(e);this.mode=r;this.session=i;this.referenceSpaceType=o;this.sessionMode=s}},Za=class extends $a{constructor(t,e,r,i){super("sessionstarted",t,e,r,i)}},el=class extends $a{constructor(t,e,r,i){super("sessionstopped",t,e,r,i)}},Ja=new Map([["VR",{referenceSpaceType:"local-floor",sessionMode:"immersive-vr"}],["AR",{referenceSpaceType:"local-floor",sessionMode:"immersive-ar"}]]),tl=class extends ${constructor(e,r,i,o){super();this.renderer=e;this.camera=r;this.fullscreenElement=i;this.enableFullResolution=o;this._currentMode="None";this.buttons=new Map;this.currentSession=null;this.screenUI=null;this.wasVisible=new Map;this.lastWidth=0;this.lastHeight=0;this.addEventListener("sessionstarted",s=>{s.sessionMode==="inline"&&(this.camera.fov=s.session.renderState.inlineVerticalFieldOfView*180/Math.PI)}),this.addEventListener("sessionstopped",s=>{s.sessionMode==="inline"&&(this.camera.fov=50)}),this.renderer.xr.addEventListener("sessionstart",()=>this.onSessionStarted()),this.renderer.xr.addEventListener("sessionend",()=>this.onSessionEnded()),this.refresh()}setUI(e,r,i,o){this.screenUI=e,this.buttons.set(r.mode,r),this.buttons.set(i.mode,i),this.buttons.set(o.mode,o);for(let s of this.buttons.values())this.wasVisible.set(s,s.visible),s.addEventListener("click",this.toggleMode.bind(this,s.mode));r.available=!qt()&&fc(),i.available=os(),o.available=is()}get visible(){return Tt(this.renderer.domElement)}set visible(e){De(this.renderer.domElement,e),this.screenUI&&De(this.screenUI,e,"grid")}get currentMode(){return this._currentMode}resize(){if(!this.renderer.xr.isPresenting){let e=this.renderer.domElement.clientWidth,r=this.renderer.domElement.clientHeight;e>0&&r>0&&(e!==this.lastWidth||r!==this.lastHeight)&&(this.renderer.setPixelRatio(devicePixelRatio),this.renderer.setSize(e,r,!1),this.camera.aspect=e/r,this.camera.updateProjectionMatrix(),this.lastWidth=e,this.lastHeight=r)}}getMetrics(){let e=this.renderer.domElement.clientWidth,r=this.renderer.domElement.clientHeight,i=this.renderer.getPixelRatio(),o=this.camera.fov;return{width:e,height:r,pixelRatio:i,fov:o}}setMetrics(e,r,i,o){this.renderer.setPixelRatio(i),this.renderer.setSize(e,r,!1),this.camera.aspect=e/r,this.camera.fov=o,this.camera.updateProjectionMatrix()}async refresh(){await Promise.all(Array.from(this.buttons.values()).filter(e=>e.available&&e.mode!=="Fullscreen").map(async e=>{let r=Ja.get(e.mode);if(e.available=_(r),e.available){let i=navigator.xr&&await navigator.xr.isSessionSupported(r.sessionMode),o=!is()&&Dl()&&r.sessionMode==="immersive-vr"&&r.referenceSpaceType==="local-floor";e.available=i||o}}))}async toggleMode(e){e==="Fullscreen"?await this.toggleFullscreen():e!=="None"&&await this.toggleXR(e)}async start(e){e!==this.currentMode&&(await this.toggleMode(this.currentMode),await this.toggleMode(e))}async stop(){await this.toggleMode(this.currentMode)}get isFullscreen(){return document.fullscreen}async startFullscreen(){this.isFullscreen||(await this.fullscreenElement.requestFullscreen({navigationUI:"show"}),this.setActive("Fullscreen"),this.dispatchEvent(new Za("Fullscreen",null,null,null)))}async stopFullscreen(){this.isFullscreen&&(await document.exitFullscreen(),this.setActive("None"),this.dispatchEvent(new el("Fullscreen",null,null,null)))}async toggleFullscreen(){this.isFullscreen?await this.stopFullscreen():await this.startFullscreen()}async toggleXR(e){let r=Ja.get(e);if(_(r)){if(this.currentSession)this.currentSession.end();else if(navigator.xr){this.camera.position.setScalar(0),this.camera.quaternion.identity();try{let i=await navigator.xr.requestSession(r.sessionMode,{optionalFeatures:["local-floor","bounded-floor","high-refresh-rate","hand-tracking","layers"]});if(this.setActive(e),this.currentSession=i,this.renderer.xr.setReferenceSpaceType(r.referenceSpaceType),this.enableFullResolution&&"XRWebGLLayer"in window&&"getNativeFramebufferScaleFactor"in XRWebGLLayer){let o=XRWebGLLayer.getNativeFramebufferScaleFactor(i);this.renderer.xr.setFramebufferScaleFactor(o)}this.renderer.xr.setSession(i)}catch(i){console.error(`Couldn't start session type '${r.sessionMode}'. Reason: ${i&&i.message||i||"UNKNOWN"}`)}}}}onSessionStarted(){let e=this.currentMode,r=Ja.get(this.currentMode),i=this.currentSession;if(i.supportedFrameRates){let o=Math.max(...i.supportedFrameRates);console.log("Changing framerate to",o),i.updateTargetFrameRate(o)}this.dispatchEvent(new Za(e,i,r.referenceSpaceType,r.sessionMode))}onSessionEnded(){let e=this.currentMode,r=Ja.get(this.currentMode),i=this.currentSession;this.currentSession=null,this.renderer.xr.setSession(null),this.setActive("None"),this.dispatchEvent(new el(e,i,r.referenceSpaceType,r.sessionMode))}setActive(e){for(let r of this.buttons.values())r.active=r.mode===e,r.visible=this.wasVisible.get(r)&&(e==="None"||e==="Fullscreen"||r.mode===e);this._currentMode=e}};var Gf=new k(0,1,0),Je=2048,wi=Je/2,m_=[1,0,2,3,4,5],cn={rows:3,columns:4,indices:[[-1,2,-1,-1],[0,5,1,4],[-1,3,-1,-1]],rotations:[[0,Math.PI,0,0],[0,0,0,0],[0,Math.PI,0,0]]},Oc=new be(0),nl=class{constructor(t){this.env=t;this.rt=new Om(Je);this.rtScene=new Xs;this.rtCamera=new Ku(.01,10,this.rt);this._rotation=new ce;this.layerRotation=new ce().identity();this.stageRotation=new ce().identity();this.canvases=new Array(6);this.contexts=new Array(6);this.layerOrientation=null;this.images=null;this.curImagePath=null;this.layer=null;this.wasVisible=!1;this.stageHeading=0;this.rotationNeedsUpdate=!1;this.imageNeedsUpdate=!1;this.useWebXRLayers=!0;this.wasWebXRLayerAvailable=null;this.visible=!0;this.onNeedsRedraw=()=>this.imageNeedsUpdate=!0,this.onTick=e=>this.checkWebXRLayer(e.frame),this.env.scene.background=Oc;for(let e=0;e<this.canvases.length;++e){let r=this.canvases[e]=qr(Je,Je);this.contexts[e]=r.getContext("2d",{alpha:!1})}for(let e=0;e<cn.rows;++e){let r=cn.indices[e],i=cn.rotations[e];for(let o=0;o<cn.columns;++o){let s=r[o];if(s>-1){let p=this.contexts[s],c=i[o];c>0&&(c%2,p.translate(wi,wi),p.rotate(c),p.translate(-wi,-wi))}}}this.rt.texture.name="SkyboxOutput",this.rtScene.add(this.rtCamera),this.flipped=qr(Je,Je),this.flipper=this.flipped.getContext("2d",{alpha:!1}),this.flipper.fillStyle=Oc.getHexString(),this.flipper.scale(-1,1),this.flipper.translate(-Je,0),this.setImages("",this.canvases),this.env.timer.addTickHandler(this.onTick),Object.seal(this)}setImage(t,e){if(t!==this.curImagePath){let r=e.width/cn.columns,i=e.height/cn.rows;for(let o=0;o<cn.rows;++o){let s=cn.indices[o];for(let p=0;p<cn.columns;++p){let c=s[p];c>-1&&this.contexts[c].drawImage(e,p*r,o*i,r,i,0,0,Je,Je)}}this.setImages(t,this.canvases)}}setImages(t,e){(t!==this.curImagePath||e!==this.images)&&(this.curImagePath=t,e!==this.images&&(_(this.cube)&&Zt(this.cube),this.images=e,this.rtScene.background=this.cube=new Yu(this.images),this.cube.name="SkyboxInput")),this.updateImages()}updateImages(){this.cube.needsUpdate=!0,this.imageNeedsUpdate=!0}get rotation(){return this._rotation}set rotation(t){let{x:e,y:r,z:i,w:o}=this._rotation;if(Xm(t))this._rotation.copy(t);else if(zm(t))this._rotation.setFromEuler(t);else if(gt(t))if(t.length===4&&we(t[0])&&we(t[1])&&we(t[2])&&we(t[3]))this._rotation.fromArray(t);else throw new Error("Skybox rotation was not a valid array format. Needs an array of 4 numbers.");else He(t)?this._rotation.setFromAxisAngle(Gf,t):(_(t)&&console.warn("Skybox rotation must be a THREE.Quaternion, THREE.Euler, number[] (representing a Quaternion), or a number (representing rotation about the Y-axis)."),this._rotation.identity());this.rotationNeedsUpdate=this._rotation.x!==e||this._rotation.y!==r||this._rotation.z!==i||this._rotation.w!==o}checkWebXRLayer(t){if(this.cube){let e=this.useWebXRLayers&&this.env.hasXRCompositionLayers&&_(t)&&_(this.env.xrBinding),r=e!==this.wasWebXRLayerAvailable;if(r){if(e){let i=this.env.renderer.xr.getReferenceSpace();this.layer=this.env.xrBinding.createCubeLayer({space:i,layout:"mono",isStatic:!1,viewPixelWidth:Je,viewPixelHeight:Je,orientation:this.layerOrientation}),this.layer.addEventListener("redraw",this.onNeedsRedraw),this.env.addWebXRLayer(this.layer,Number.MAX_VALUE)}else this.layer&&(this.env.removeWebXRLayer(this.layer),this.layer.removeEventListener("redraw",this.onNeedsRedraw),this.layer.destroy(),this.layer=null);this.imageNeedsUpdate=!0}if(!this.layer||!r){let i=this.visible!==this.wasVisible,o=this.env.avatar.heading!==this.stageHeading;if(this.imageNeedsUpdate=this.imageNeedsUpdate||i||this.layer&&this.layer.needsRedraw,this.rotationNeedsUpdate=this.rotationNeedsUpdate||o,this.env.scene.background=this.layer?null:this.visible?this.rt.texture:Oc,this.rotationNeedsUpdate&&(this.layerRotation.copy(this.rotation).invert(),this.stageRotation.setFromAxisAngle(Gf,this.env.avatar.heading).premultiply(this.layerRotation),this.layerOrientation=new DOMPointReadOnly(this.stageRotation.x,this.stageRotation.y,this.stageRotation.z,this.stageRotation.w),this.layer?this.layer.orientation=this.layerOrientation:(this.rtCamera.quaternion.copy(this.layerRotation),this.imageNeedsUpdate=!0)),this.imageNeedsUpdate)if(this.layer){let s=this.env.renderer.getContext(),p=this.env.xrBinding.getSubImage(this.layer,t),c=this.cube.images;this.flipper.fillRect(0,0,Je,Je),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.bindTexture(s.TEXTURE_CUBE_MAP,p.colorTexture);for(let u=0;u<c.length;++u){if(this.visible){let h=c[m_[u]];this.flipper.drawImage(h,0,0,h.width,h.height,0,0,Je,Je)}s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.flipped)}s.bindTexture(s.TEXTURE_CUBE_MAP,null)}else this.rtCamera.update(this.env.renderer,this.rtScene);this.stageHeading=this.env.avatar.heading,this.imageNeedsUpdate=!1,this.rotationNeedsUpdate=!1,this.wasVisible=this.visible}this.wasWebXRLayerAvailable=e}}};var Xo=class{constructor(){this.t=0;this.dt=0;this.sdt=0;this.fps=0}set(t,e){this.t=t,this.dt=e,this.sdt=ku(this.sdt,e,.01),e>0&&(this.fps=1e3/e)}},rl=class extends Xo{constructor(){super(),Object.seal(this)}};var kc=class extends Xo{constructor(){super();this.frame=null;Object.seal(this)}set(e,r,i){super.set(e,r),this.frame=i}},il=class{constructor(t){this.renderer=t;this.tickHandlers=new Array;this.lt=-1;this._isRunning=!1;let e=new kc,r=0;this._onTick=(i,o)=>{this.lt>=0&&(r=i-this.lt,e.set(i,r,o),this.tick(e)),this.lt=i}}get isRunning(){return this._isRunning}restart(){this.stop(),this.start()}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){mt(this.tickHandlers,t)}setAnimationLoop(t){this.renderer.setAnimationLoop(t),this._isRunning=_(t)}start(){this.isRunning||this.setAnimationLoop(this._onTick)}stop(){this.isRunning&&(this.setAnimationLoop(null),this.lt=-1)}tick(t){for(let e of this.tickHandlers)e(t)}};var Uf=15,h_=vh(Uf);Ct(Q("#frontBuffer",Br("absolute"),qn(0),Yn(0),jt("100%"),ut("100%"),fn(0),Mt(0),$c(0),ud("none")));var ol=class extends ${constructor(e,r,i,o,s){super();this.fetcher=r;this.defaultAvatarHeight=i;this.DEBUG=s;this.layers=new Array;this.layerSortOrder=new Map;this.spectator=new to;this.lastViewport=new kt;this.curViewport=new kt;this.gltfLoader=new Dn;this.fadeDepth=0;this.camera=new to(50,1,.01,1e3);this.scene=new Xs;this.stage=de("Stage");this.ambient=new zu(16777215,.5);this.sun=new Ls(16777215,.75);this.ground=new tm(h_,Uf,12632256,8421504);this.foreground=de("Foreground");this.loadingBar=new Ba;this.enableSpectator=!1;this._xrBinding=null;this._xrMediaBinding=null;this._hasXRMediaLayers=null;this._hasXRCompositionLayers=null;if(this.cursor3D=new fi(this),Jt(e)&&(e.style.backgroundColor="black",B(e.parentElement)))throw new Error("The provided canvas must be included in a parent element before constructing the environment.");this.renderer=new km({canvas:e,powerPreference:"high-performance",precision:"lowp",antialias:!0,alpha:!0,premultipliedAlpha:!0,depth:!0,logarithmicDepthBuffer:!0,stencil:!1,preserveDrawingBuffer:!1}),this.renderer.domElement.setAttribute("touch-action","none"),this.renderer.domElement.tabIndex=1,Jt(e)&&(this.screenControl=new tl(this.renderer,this.camera,this.renderer.domElement.parentElement,o)),this.fader=new ka("ViewFader"),this.worldUISpace=new ma("WorldUISpace",.2,20,.125),this.avatar=new ga(this,this.fader,i),this.eventSys=new Oa(this),this.timer=new il(this.renderer),this.skybox=new nl(this),this.renderer.xr.enabled=!0,this.sun.name="Sun",this.sun.position.set(0,1,1),this.sun.lookAt(0,0,0),this.sun.layers.enableAll();let p=()=>{this.ground.visible=this.renderer.xr.isPresenting};this.screenControl.addEventListener("sessionstarted",p),this.screenControl.addEventListener("sessionstopped",p),p(),this.ambient.name="Fill",this.ambient.layers.enableAll(),this.loadingBar.object.name="MainLoadingBar",this.loadingBar.object.position.set(0,-.25,-2),this.scene.layers.enableAll(),this.avatar.addFollower(this.worldUISpace),j(this.scene,this.sun,this.ambient,j(this.stage,this.ground,this.camera,this.avatar,...this.eventSys.hands),this.foreground,j(this.worldUISpace,this.loadingBar)),this.timer.addTickHandler(c=>this.update(c)),this.timer.start(),globalThis.env=this}get gl(){return this.renderer.getContext()}get referenceSpace(){return this.renderer.xr.getReferenceSpace()}update(e){if(this.screenControl.visible){let r=this.xrSession;this._xrBinding=this.renderer.xr.getBinding(),this.hasXRMediaLayers&&this._xrMediaBinding===null===this.renderer.xr.isPresenting&&(this._xrMediaBinding===null&&_(r)?this._xrMediaBinding=new XRMediaBinding(r):this._xrMediaBinding=null);let i=r&&this.renderer.xr.getBaseLayer();i!==this.baseLayer&&(_(this.baseLayer)&&(this.removeWebXRLayer(this.baseLayer),this.baseLayer=null),_(i)&&(this.baseLayer=i,this.addWebXRLayer(i,0))),this.screenControl.resize(),this.eventSys.update(),this.avatar.update(e.dt),this.worldUISpace.update(this.avatar.height,this.avatar.worldPos,this.avatar.worldHeading,e.dt),this.fader.update(e.dt),Jm(e.dt),this.loadingBar.update(e.sdt),this.preRender(e);let o=mr(this.renderer,this.camera);if(o!==this.camera){let s=o;s.layers.mask=this.camera.layers.mask;for(let p=0;p<s.cameras.length;++p){let c=s.cameras[p];c.layers.mask=this.camera.layers.mask,c.layers.enable(p+1),s.layers.enable(p+1)}}this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.enableSpectator&&(this.renderer.xr.isPresenting?Nr()&&!Bd()&&this.drawSnapshot():(this.lastViewport.copy(this.curViewport),this.renderer.getViewport(this.curViewport)))}}drawSnapshot(){let e=this.renderer.xr.isPresenting,r=null;if(e){let i=mr(this.renderer,this.camera);this.spectator.projectionMatrix.copy(this.camera.projectionMatrix),this.spectator.position.copy(i.position),this.spectator.quaternion.copy(i.quaternion),r=this.renderer.getRenderTarget(),this.renderer.xr.isPresenting=!1,this.renderer.setRenderTarget(null),this.renderer.setViewport(this.lastViewport)}this.renderer.clear(),this.renderer.render(this.scene,e?this.spectator:this.camera),e&&(this.renderer.setViewport(this.curViewport),this.renderer.setRenderTarget(r),this.renderer.xr.isPresenting=!0)}preRender(e){}async onQuitting(){this.dispatchEvent(new q("quitting")),window.location.href="/"}get hasAlpha(){return this.renderer.getContextAttributes().alpha}get xrSession(){return this.renderer.xr.getSession()}get xrBinding(){return this._xrBinding}get xrMediaBinding(){return this._xrMediaBinding}get isReadyForLayers(){return this.hasAlpha&&(!Kt||Fd.major>=15)}get hasXRMediaLayers(){return this._hasXRMediaLayers===null&&(this._hasXRMediaLayers=this.isReadyForLayers&&"XRMediaBinding"in globalThis&&Z(XRMediaBinding.prototype.createQuadLayer)),this._hasXRMediaLayers}get hasXRCompositionLayers(){return this._hasXRCompositionLayers===null&&(this._hasXRCompositionLayers=this.isReadyForLayers&&"XRWebGLBinding"in globalThis&&Z(XRWebGLBinding.prototype.createCubeLayer)),this._hasXRCompositionLayers}addWebXRLayer(e,r){this.layers.push(e),this.layerSortOrder.set(e,r),er(this.layers,i=>-this.layerSortOrder.get(i)),this.updateLayers()}removeWebXRLayer(e){this.layerSortOrder.delete(e),mt(this.layers,e),this.updateLayers()}updateLayers(){let e=this.xrSession;_(e)&&e.updateRenderState({layers:this.layers})}clearScene(){this.dispatchEvent(new q("sceneclearing")),Zt(this.foreground),this.dispatchEvent(new q("scenecleared"))}async fadeOut(){++this.fadeDepth,this.fadeDepth===1&&(await this.fader.fadeOut(),this.skybox.visible=!1,this.camera.layers.set(mi),this.loadingBar.start(),await this.fader.fadeIn())}async fadeIn(){this.fadeDepth===1&&(await this.fader.fadeOut(),this.camera.layers.set(Aa),this.skybox.visible=!0,await this.fader.fadeIn()),--this.fadeDepth}get showWebXRLayers(){return this.fadeDepth===0}set3DCursor(e){let r=e.children.slice(0);for(let i of r)this.cursor3D.add(i.name,i);this.eventSys.refreshCursors(),this.dispatchEvent(new q("newcursorloaded"))}async load(e,...r){let i=null;Zi(e)?r.push(e):i=e;let o=new ha(this,"/models/Cursors.glb",Ms,!this.DEBUG);r.push(o),await this.fetcher.assets(i,...r),ah(o.result.scene,lh),this.set3DCursor(o.result.scene)}loadGltf(e){return this.gltfLoader.loadAsync(e)}};function jf(n,t,e){return new Map(n.map(r=>[t(r),e(r)]))}function Bc(n,t){return jf(n,t,Yo)}var sl=class{constructor(t){this.timer=null;this.lt=-1;this.tickHandlers=new Array;this._targetFPS=null;this.targetFPS=t;let e=new rl,r=0;this.onTick=i=>{this.lt>=0&&(r=i-this.lt,e.set(i,r),this.tick(e)),this.lt=i}}get targetFPS(){return this._targetFPS}set targetFPS(t){this._targetFPS=t}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){mt(this.tickHandlers,t)}tick(t){for(let e of this.tickHandlers)e(t)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};var al=class extends sl{constructor(t){super(t)}start(){let t=()=>{this.timer=setTimeout(t,this.targetFrameTime),this.onTick(performance.now())};this.timer=setTimeout(t,this.targetFrameTime)}stop(){this.isRunning&&(clearTimeout(this.timer),super.stop())}};var ll=class{constructor(t,e){this.name=t;this._level=0;this.maxLevel=0;this.analyzer=$d(this.name,e,{fftSize:32,minDecibels:-70}),this.buffer=new Uint8Array(this.analyzer.frequencyBinCount)}dispose(){te(this.analyzer)}get level(){return this.analyzer.getByteFrequencyData(this.buffer),this._level=Math.max(...this.buffer),isFinite(this._level)&&(this.maxLevel=Math.max(this.maxLevel,this._level),this.maxLevel>0&&(this._level/=this.maxLevel)),this._level}get input(){return this.analyzer}get output(){return this.analyzer}};Ct(Q(".input-range-with-number",Be("grid"),sd("column"),nd("5px"),Ut("1fr auto")));var zo=class extends ${constructor(...e){super();this.element=_e(fe("input-range-with-number"),this.rangeInput=Od(...e),this.numberInput=Dd()),this.numberInput.min=this.rangeInput.min,this.numberInput.max=this.rangeInput.max,this.numberInput.step=this.rangeInput.step,this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.numberInput.disabled=this.rangeInput.disabled,this.numberInput.placeholder=this.rangeInput.placeholder,this.numberInput.addEventListener("input",()=>{this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber,this.rangeInput.dispatchEvent(new Event("input"))}),this.rangeInput.addEventListener("input",()=>{this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.dispatchEvent(new q("input"))})}get value(){return this.rangeInput.value}set value(e){this.rangeInput.value=this.numberInput.value=e}get valueAsNumber(){return this.rangeInput.valueAsNumber}set valueAsNumber(e){this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber=e}get disabled(){return this.rangeInput.disabled}set disabled(e){this.rangeInput.disabled=this.numberInput.disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}};Ct(Q("dl.properties",Be("grid"),Ut("auto 1fr"),ad(".25em")),Q("dl.properties.disabled",td("#ccc")),Q("dl.properties > dt",Qn(1,2),xn("right")),Q("dl.properties > dt > label",fn(0),Mt(0),ut("100%"),hd("sub")),Q("dl.properties > dd",Qn(2,-1),Be("grid"),Ut("auto")),Q("dl.properties > dd input[type=number]",xn("right")),Q("dl.properties > dd > img",Kn("10em")),Q("dl.properties > dd > select",ut("30px")),Q("dl.properties > .single-item",Qn(1,-1),xn("center")));var pl=class{constructor(t,...e){this.name=t;this.properties=e}};function Wf(n,...t){return new pl(n,...t)}var f_="DefaultPropertyGroup"+bt(16),cl=class{constructor(...t){this.rowGroups=new Map;this.controls=new Array;this._disabled=!1;this.element=Md(fe("properties"),...this.createElements(t))}append(...t){me(this.element,...this.createElements(t))}get disabled(){return this._disabled}set disabled(t){if(t!==this.disabled){this._disabled=t,Rl(this,t,"disabled");for(let e of this.controls)e.disabled=t}}get enabled(){return!this.disabled}set enabled(t){this.disabled=!t}createElements(t){return t.flatMap(e=>this.createGroups(e).flatMap(Yo))}createGroups(t){let e=f_,r=new Array;return t instanceof pl?(e=t.name,r.push(...t.properties.map(i=>this.createRow(i)))):r.push(this.createRow(t)),this.rowGroups.has(e)||this.rowGroups.set(e,[]),this.rowGroups.get(e).push(...r),r}createRow(t){if(gt(t)){let[e,...r]=t,i=Rd(e);for(let o of r)if(Wi(o)&&this.controls.push(o),o instanceof HTMLInputElement||o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement){o.id.length===0&&(o.id=bt(10)),i.htmlFor=o.id;break}return[Td(i),Sd(...r)]}else return(ae(t)||we(t)||$e(t)||bl(t))&&(t=_e(Pd(t))),Rl(t,!0,"single-item"),Wi(t)&&this.controls.push(t),[t]}setGroupVisible(t,e){let r=this.rowGroups.get(t);if(r)for(let i of r)for(let o of i)De(o,e)}};var Fc="micFields"+bt(8),dl=class extends li{constructor(e){super("Configure devices");this.env=e;this.micLookup=null;this.spkrLookup=null;this.spkrVolumeControl=null;this.ready=null;this.speakers=null;this.timer=new al(30);this.tele=null;this.cancelButton.style.display="none";let r=this.env.audio.loadBasicClip("test-audio","/audio/test-clip.mp3",.5);me(this.container,dt(cd("max-content"))),me(this.contentArea,this.properties=new cl(Wf(Fc,"Input",["Microphones",this.microphones=Il(ui(async()=>{let i=this.env.apps.get("tele"),o=this.microphones.value,s=this.micLookup.get(o);await i.conference.microphones.setAudioInputDevice(s)}))],["Input level",this.micScenario=Vd()],["Volume",this.micVolumeControl=new zo(El(0),yl(100),Sl(1),kr(0),ui(()=>{e.audio.input.gain.setValueAtTime(this.micVolumeControl.valueAsNumber/100,0)}))],"Output"))),Dt&&(this.properties.append(["Speakers",this.speakers=Il(ui(async()=>{let i=this.speakers.value,o=this.spkrLookup.get(i);await this.env.audio.speakers.setAudioOutputDevice(o)}))]),this.env.audio.speakers.addEventListener("audiooutputchanged",i=>{this.speakers.value=i.device&&i.device.deviceId||""})),this.properties.append(["Using headphones",this.useHeadphones=Ld(ui(()=>{this.env.audio.useHeadphones=this.useHeadphones.checked,De(this.headphoneWarning,!this.env.audio.useHeadphones,"inline-block")})),this.testSpkrButton=ts("Test",Or("Test audio"),dt(ld("0.5em")),Oh(async()=>{this.testSpkrButton.disabled=!0,await r,await this.env.audio.playClipThrough("test-audio"),this.testSpkrButton.disabled=!1}))],this.headphoneWarning=_e(fe("alert alert-warning"),"\u{1F3A7}\u{1F399}\uFE0F This site has a voice chat feature. Voice chat is best experienced using headphones."),["Volume",this.spkrVolumeControl=new zo(El(0),yl(100),Sl(1),kr(0),ui(()=>e.audio.audioDestination.volume=this.spkrVolumeControl.valueAsNumber/100))]),this.activity=new ll("device-settings-dialog-activity",this.env.audio.audioCtx),this.timer.addTickHandler(()=>{this.micScenario.value=this.activity.level}),this.properties.setGroupVisible(Fc,!1),this.waitForTele(),Object.seal(this)}async waitForTele(){this.tele=await this.env.apps.waitFor("tele"),this.properties.setGroupVisible(Fc,!0),this.tele.conference.microphones.addEventListener("audioinputchanged",e=>{this.microphones.value=e.audio&&e.audio.deviceId||""}),_t(this.env.audio.input,this.activity)}async load(){await this.env.audio.ready}async onShowing(){if(this.ready===null&&(this.ready=this.load()),await this.ready,this.tele){await this.tele.ready,await this.tele.conference.microphones.ready;let e=await this.tele.conference.microphones.getAudioInputDevices();this.micLookup=Bc(e,i=>i.deviceId),Qi(this.microphones),me(this.microphones,ns(kr(""),"NONE"),...e.map(i=>ns(kr(i.deviceId),i.label)));let r=await this.tele.conference.microphones.getAudioInputDevice();this.microphones.value=r&&r.deviceId||"",this.micVolumeControl.valueAsNumber=this.env.audio.input.gain.value*100}if(Dt){await this.env.audio.speakers.ready;let e=await this.env.audio.speakers.getAudioOutputDevices();this.spkrLookup=Bc(e,i=>i.deviceId),Qi(this.speakers),me(this.speakers,...e.map(i=>ns(kr(i.deviceId),i.label)));let r=await this.env.audio.speakers.getAudioOutputDevice();r||(r=await this.env.audio.speakers.getPreferredAudioOutput(),await this.env.audio.speakers.setAudioOutputDevice(r)),this.speakers.value=r&&r.deviceId||""}this.spkrVolumeControl.valueAsNumber=this.env.audio.audioDestination.volume*100,this.useHeadphones.checked=this.env.audio.useHeadphones,De(this.headphoneWarning,!this.env.audio.useHeadphones,"inline-block"),this.timer.start(),await super.onShowing()}onClosed(){this.timer.stop(),super.onClosed()}};var Nc=class extends q{constructor(e){super("roomjoined");this.roomName=e}},ul=class extends ol{constructor(e,r,i,o,s,p,c){super(e,r,s,p,c&&c.DEBUG);this.screenUISpace=new js;this.envAudioToggleEvt=new q("environmentaudiotoggled");this._currentRoom=null;this._testSpaceLayout=!1;this.countTick=0;this.fpses=new Array;this.avgFPS=0;this.compassImage=new Cs,this.clockImage=new dr(this,"Clock","dynamic",new Rs),this.clockImage.sizeMode="fixed-height",this.clockImage.mesh.renderOrder=5,c=c||{},this.apps=new pa(this),this.apps.addEventListener("apploading",u=>{u.preLoadTask=this.fadeOut().then(()=>{this.clearScene(),this.avatar.reset()})}),this.apps.addEventListener("apploaded",u=>{u.app.addEventListener("joinroom",h=>{h.roomName!==this._currentRoom&&(this._currentRoom=h.roomName,this.dispatchEvent(new Nc(h.roomName)))})}),this.apps.addEventListener("appshown",async u=>{this.lobbyButton.visible=u.appName!=="menu",await this.fadeIn()}),this.audio=new ys(Nu),this.audio.setAudioProperties(1,4,"exponential"),this.audioPlayer=new Es(this.audio.audioCtx),this.videoPlayer=new ia(this,this.audio.audioCtx),this.videoPlayer.object.visible=!1,this.interactionAudio=new Vs(this.audio,this.eventSys),this.confirmationDialog=new aa(this,i),this.devicesDialog=new dl(this),this.uiButtons=new oa(o,20,this.DEBUG),this.settingsButton=new ai(this.uiButtons,"ui","settings"),this.quitButton=new ai(this.uiButtons,"ui","quit"),this.lobbyButton=new ai(this.uiButtons,"ui","lobby"),this.muteMicButton=new ur(this.uiButtons,"microphone","mute","unmute"),this.muteEnvAudioButton=new ur(this.uiButtons,"environment-audio","mute","unmute"),this.muteEnvAudioButton.active=!0,this.audio.ready.then(()=>this.muteEnvAudioButton.active=!1),this.vrButton=new ci(this.uiButtons,"VR"),this.fullscreenButton=new ci(this.uiButtons,"Fullscreen"),this.arButton=new ci(this.uiButtons,"AR"),this.xrUI=new Ws,this.xrUI.addItem(this.clockImage,{x:-1,y:1,height:.1}),this.xrUI.addItem(this.quitButton,{x:1,y:1,scale:.5}),this.xrUI.addItem(this.confirmationDialog,{x:0,y:0,scale:.25}),this.xrUI.addItem(this.settingsButton,{x:-1,y:-1,scale:.5}),this.xrUI.addItem(this.muteMicButton,{x:-.84,y:-1,scale:.5}),this.xrUI.addItem(this.muteEnvAudioButton,{x:-.68,y:-1,scale:.5}),this.xrUI.addItem(this.lobbyButton,{x:-.473,y:-1,scale:.5}),this.xrUI.addItem(this.vrButton,{x:1,y:-1,scale:.5}),this.xrUI.addItem(this.fullscreenButton,{x:1,y:-1,scale:.5}),this.xrUI.addItem(this.arButton,{x:1,y:-1,scale:.5}),j(this.worldUISpace,this.xrUI),me(this.screenUISpace.topRowLeft,this.compassImage,this.clockImage),me(this.screenUISpace.topRowRight,this.quitButton),me(this.screenUISpace.bottomRowLeft,this.settingsButton,this.muteMicButton,this.muteEnvAudioButton,this.lobbyButton),me(this.screenUISpace.bottomRowRight,this.fullscreenButton,this.vrButton,this.arButton),Jr.isAvailable&&Ki()&&(this.batteryImage=new dr(this,"Battery","dynamic",new Jr),this.batteryImage.sizeMode="fixed-height",this.xrUI.addItem(this.batteryImage,{x:.75,y:-1,width:.2,height:.1}),me(this.screenUISpace.topRowRight,this.batteryImage)),this.vrButton.visible=Nr()&&os()||qt(),this.arButton.visible=!1,this.lobbyButton.visible=!1,this.muteMicButton.visible=!1,this.screenControl.setUI(this.screenUISpace,this.fullscreenButton,this.vrButton,this.arButton),this.quitButton.addEventListener("click",()=>this.withConfirmation("Confirm quit","Are you sure you want to quit?",async()=>{this.renderer.xr.isPresenting&&this.screenControl.stop(),await this.onQuitting()})),this.lobbyButton.addEventListener("click",()=>this.withConfirmation("Confirm return to lobby","Are you sure you want to return to the lobby?",()=>this.dispatchEvent(new q("home")))),this.settingsButton.addEventListener("click",async()=>{let u=this.screenControl.currentMode,h=this.renderer.xr.isPresenting;h&&await this.screenControl.stop(),await this.devicesDialog.showDialog(),h&&await this.screenControl.start(u)}),this.muteEnvAudioButton.addEventListener("click",()=>{this.muteEnvAudioButton.active=!this.muteEnvAudioButton.active,this.dispatchEvent(this.envAudioToggleEvt)}),this.avatar.addEventListener("avatarmoved",u=>this.audio.setUserPose(this.audio.localUserID,u.px,u.py,u.pz,u.fx,u.fy,u.fz,u.ux,u.uy,u.uz))}get currentRoom(){return this._currentRoom}get testSpaceLayout(){return this._testSpaceLayout}set testSpaceLayout(e){e!==this.testSpaceLayout&&(this._testSpaceLayout=e)}preRender(e){if(super.preRender(e),this.xrUI.visible=this.renderer.xr.isPresenting||this.testSpaceLayout,this.clockImage.isVisible=this.xrUI.visible||this.DEBUG,this.renderer.xr.isPresenting||this.compassImage.setPitchAndHeading(Zl(this.avatar.worldPitch),Zl(this.avatar.worldHeading)),this.DEBUG){let r=Math.round(e.fps);if(this.avgFPS+=r/100,this.fpses.push(r),this.fpses.length>100){let i=this.fpses.shift();this.avgFPS-=i/100}++this.countTick%100===0&&this.clockImage.image.setStats(this.avgFPS,this.renderer.info.render.calls,this.renderer.info.render.triangles)}this.audio.update(),this.confirmationDialog.update(e.dt);for(let r of this.apps)r.update(e)}get environmentAudioMuted(){return this.muteEnvAudioButton.active}async withConfirmation(e,r,i){this.onConfirmationShowing(!0),await this.confirmationDialog.prompt(e,r)&&i(),this.onConfirmationShowing(!1)}onConfirmationShowing(e){Tp(this.quitButton,!e),Tp(this.lobbyButton,!e)}async load(e,...r){let i=null;Zi(e)?(r.push(e),i=this.loadingBar):i=e,Jt(this.renderer.domElement)&&me(this.renderer.domElement.parentElement,this.screenUISpace,this.confirmationDialog,this.devicesDialog,this.renderer.domElement);let o=new wn("/audio/footsteps.mp3",Kr,!this.DEBUG),s=new wn("/audio/basic_enter.mp3",Kr,!this.DEBUG),p=new wn("/audio/basic_exit.mp3",Kr,!this.DEBUG),c=new wn("/audio/basic_error.mp3",Kr,!this.DEBUG),u=new wn("/audio/vintage_radio_button_pressed.mp3",Kr,!this.DEBUG);r.push(...this.uiButtons.assets,o,s,p,c,u),await super.load(i,...r),this.audio.createBasicClip("footsteps",o.result,.5),this.interactionAudio.create("enter",s.result,.25),this.interactionAudio.create("exit",p.result,.25),this.interactionAudio.create("error",c.result,.25),this.interactionAudio.create("click",u.result,1)}};var SF=ul;export{SF as default};
