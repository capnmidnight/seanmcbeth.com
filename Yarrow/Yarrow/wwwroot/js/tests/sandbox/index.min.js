function Q(e){return e}function A(e,n,t){return typeof e===n||e instanceof t}function u(e){return A(e,"function",Function)}function _(e){return A(e,"string",String)}function b(e){return A(e,"boolean",Boolean)}function m(e){return A(e,"number",Number)}function w(e){return i(e)&&A(e,"object",Object)}function a(e){return e==null}function i(e){return!a(e)}function V(e){return e.splice(0)}function tt(e,n){return e.splice(n,1)[0]}var T=class{constructor(){this.listeners=new Map;this.listenerOptions=new Map}addEventListener(n,t,o){if(u(t)){let r=this.listeners.get(n);r||(r=new Array,this.listeners.set(n,r)),r.find(p=>p===t)||(r.push(t),o&&this.listenerOptions.set(t,o))}}removeEventListener(n,t){if(u(t)){let o=this.listeners.get(n);o&&this.removeListener(o,t)}}clearEventListeners(n){for(let[t,o]of this.listeners)if(a(n)||n===t){for(let r of o)this.removeEventListener(n,r);V(o),this.listeners.delete(t)}}removeListener(n,t){let o=n.findIndex(r=>r===t);o>=0&&(tt(n,o),this.listenerOptions.has(t)&&this.listenerOptions.delete(t))}dispatchEvent(n){let t=this.listeners.get(n.type);if(t)for(let o of t){let r=this.listenerOptions.get(o);i(r)&&!b(r)&&r.once&&this.removeListener(t,o),o.call(this,n)}return!n.defaultPrevented}},E=class extends Event{get type(){return super.type}constructor(n,t){super(n,t)}},k=class extends T{constructor(){super(...arguments);this.bubblers=new Set;this.scopes=new WeakMap}addBubbler(t){this.bubblers.add(t)}removeBubbler(t){this.bubblers.delete(t)}addEventListener(t,o,r){super.addEventListener(t,o,r)}removeEventListener(t,o){super.removeEventListener(t,o)}clearEventListeners(t){return super.clearEventListeners(t)}addScopedEventListener(t,o,r,p){this.scopes.has(t)||this.scopes.set(t,[]),this.scopes.get(t).push([o,r]),this.addEventListener(o,r,p)}removeScope(t){let o=this.scopes.get(t);if(o){this.scopes.delete(t);for(let[r,p]of o)this.removeEventListener(r,p)}}dispatchEvent(t){if(!super.dispatchEvent(t))return!1;if(!t.cancelBubble){for(let o of this.bubblers)if(!o.dispatchEvent(t))return!1}return!0}};var P=class{constructor(n=!0){this.autoStart=n;this.onThens=new Array;this.onCatches=new Array;this._result=void 0;this._error=void 0;this._executionState="waiting";this._resultState="none";this.resolve=t=>{if(this.running){this._result=t,this._resultState="resolved";for(let o of this.onThens)o(t);this.clear(),this._executionState="finished"}},this.reject=t=>{if(this.running){this._error=t,this._resultState="errored";for(let o of this.onCatches)o(t);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){V(this.onThens),V(this.onCatches)}start(){this._executionState="running"}resolver(n){return()=>this.resolve(n)}resolveOn(n,t,o){let r=this.resolver(o);n.addEventListener(t,r),this.finally(()=>n.removeEventListener(t,r))}get result(){if(i(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((n,t)=>{this.finished?this.errored?t(this.error):n(this.result):(this.onThens.push(n),this.onCatches.push(t))})}then(n,t){return this.project().then(n,t)}catch(n){return this.project().catch(n)}finally(n){return this.project().finally(n)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(n){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",n&&this.start()}};var f=class{constructor(n,t,o,...r){this.key=n;this.value=t;this.bySetAttribute=o;this.tags=r.map(p=>p.toLocaleUpperCase()),Object.freeze(this)}applyToElement(n){let t=this.key.startsWith("data-");if(!(this.tags.length===0||this.tags.indexOf(n.tagName)>-1||t))console.warn(`Element ${n.tagName} does not support Attribute ${this.key}`);else if(t){let r=this.key.substring(5);n.dataset[r]=this.value}else if(this.key==="style")Object.assign(n.style,this.value);else if(this.key==="classList"){let r=this.value.filter(Q);r.length>0&&r.forEach(p=>n.classList.add(p))}else this.bySetAttribute?n.setAttribute(this.key,this.value):this.key in n?n[this.key]=this.value:this.value===!1?n.removeAttribute(this.key):this.value===!0?n.setAttribute(this.key,""):n.setAttribute(this.key,this.value)}};function et(e){return new f("height",e,!1,"canvas","embed","iframe","img","input","object","video")}function nt(e){return new f("width",e,!1,"canvas","embed","iframe","img","input","object","video")}function ot(e){return`${e}px`}function M(...e){return`rgb(${e.join(", ")})`}function X(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}function it(e){return w(e)?e.element instanceof Element:!1}function rt(e){return it(e)?e.element:_(e)?Tt(e):e}function wt(e){return w(e)&&"applyToElement"in e&&u(e.applyToElement)}function W(e,...n){e=rt(e);for(let t of n)i(t)&&(t instanceof Node?e.append(t):it(t)?e.append(rt(t)):wt(t)?t.applyToElement(e):e.append(document.createTextNode(t.toLocaleString())));return e}function Tt(e){return document.querySelector(e)}function Et(e,...n){let t=null;for(let o of n)if(o instanceof f&&o.key==="id"){t=document.getElementById(o.value);break}return t==null&&(t=document.createElement(e)),W(t,...n),t}function pt(...e){return Et("canvas",...e)}var G="HTMLCanvasElement"in globalThis,yn="HTMLImageElement"in globalThis,st=!1,at=!st&&"OffscreenCanvas"in globalThis,wn=!st&&"createImageBitmap"in globalThis;function lt(e){return G&&e instanceof HTMLCanvasElement}function Pt(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var Mt=at&&Pt(),N=Mt&&It||G&&dt||null,ct=G?dt:N;function Xt(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var Tn=at&&Xt();function It(e,n){return new OffscreenCanvas(e,n)}function dt(e,n){return pt(nt(e),et(n))}function mt(e,n,t,o=1){return n=Math.floor(n*o),t=Math.floor(t*o),e.width!=n||e.height!=t?(e.width=n,e.height=t,!0):!1}function Lt(e){return i(e.textBaseline)}function jt(e,n,t,o=1){let r=e.imageSmoothingEnabled,p=e.textBaseline,s=e.textAlign,c=e.font,x=mt(e.canvas,n,t,o);return x&&(e.imageSmoothingEnabled=r,e.textBaseline=p,e.textAlign=s,e.font=c),x}function J(e,n,t,o=1){return Lt(e)?jt(e,n,t,o):mt(e.canvas,n,t,o)}function xt(e,n){let t=globalThis,o=t[e];if(a(o)){if(a(n))throw new Error(`No value ${e} found`);o=n(),t[e]=o}return o}var Ln=xt("juniper::loadedFonts",()=>[]);function ut(e){let n=[];return e.fontStyle&&e.fontStyle!=="normal"&&n.push(e.fontStyle),e.fontVariant&&e.fontVariant!=="normal"&&n.push(e.fontVariant),e.fontWeight&&e.fontWeight!=="normal"&&n.push(e.fontWeight),n.push(ot(e.fontSize)),n.push(e.fontFamily),n.join(" ")}var _t=Math.PI,q=.5*_t,On=2*_t;var Rt=864e13,Bn=-Rt;function ft(e,n,t){return Math.min(t,Math.max(n,e))}var I=class extends k{constructor(t,o,r){super();this._scale=250;this._visible=!0;this.wasVisible=null;this.redrawnEvt=new E("redrawn");this.element=null;i(r)&&i(r.scale)&&(this._scale=r.scale),this._canvas=ct(t,o),this._g=this.canvas.getContext("2d"),lt(this._canvas)&&(this.element=this._canvas)}fillRect(t,o,r,p,s,c){this.g.fillStyle=t,this.g.fillRect(o+c,r+c,p-2*c,s-2*c)}drawText(t,o,r,p){this.g.textAlign=p,this.g.strokeText(t,o,r),this.g.fillText(t,o,r)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}onClear(){this.g.clearRect(0,0,this.canvas.width,this.canvas.height)}clear(){this.onClear(),this.dispatchEvent(this.redrawnEvt)}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(t){this.scale!==t&&(this._scale=t,this.redraw())}get visible(){return this._visible}set visible(t){this.visible!==t&&(this.wasVisible=this._visible,this._visible=t,this.redraw())}};var g=class extends I{constructor(t){super(10,10,t);this.trueWidth=null;this.trueHeight=null;this.trueFontSize=null;this.dx=null;this._minWidth=null;this._maxWidth=null;this._minHeight=null;this._maxHeight=null;this._freezeDimensions=!1;this._dimensionsFrozen=!1;this._bgFillColor=null;this._bgStrokeColor=null;this._bgStrokeSize=null;this._textStrokeColor=null;this._textStrokeSize=null;this._textFillColor="black";this._textDirection="horizontal";this._fontStyle="normal";this._fontVariant="normal";this._fontWeight="normal";this._fontFamily="sans-serif";this._fontSize=20;this._value=null;this.lastValue=null;i(t)&&(i(t.minWidth)&&(this._minWidth=t.minWidth),i(t.maxWidth)&&(this._maxWidth=t.maxWidth),i(t.minHeight)&&(this._minHeight=t.minHeight),i(t.maxHeight)&&(this._maxHeight=t.maxHeight),i(t.freezeDimensions)&&(this._freezeDimensions=t.freezeDimensions),i(t.textStrokeColor)&&(this._textStrokeColor=t.textStrokeColor),i(t.textStrokeSize)&&(this._textStrokeSize=t.textStrokeSize),i(t.bgFillColor)&&(this._bgFillColor=t.bgFillColor),i(t.bgStrokeColor)&&(this._bgStrokeColor=t.bgStrokeColor),i(t.bgStrokeSize)&&(this._bgStrokeSize=t.bgStrokeSize),i(t.value)&&(this._value=t.value),i(t.textFillColor)&&(this._textFillColor=t.textFillColor),i(t.textDirection)&&(this._textDirection=t.textDirection),i(t.fontStyle)&&(this._fontStyle=t.fontStyle),i(t.fontVariant)&&(this._fontVariant=t.fontVariant),i(t.fontWeight)&&(this._fontWeight=t.fontWeight),i(t.fontFamily)&&(this._fontFamily=t.fontFamily),i(t.fontSize)&&(this._fontSize=t.fontSize),i(t.padding)&&(m(t.padding)?this._padding={left:t.padding,right:t.padding,top:t.padding,bottom:t.padding}:this._padding=t.padding)),a(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(t){this.minWidth!==t&&(this._minWidth=t,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(t){this.maxWidth!==t&&(this._maxWidth=t,this.redraw())}get minHeight(){return this._minHeight}set minHeight(t){this.minHeight!==t&&(this._minHeight=t,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(t){this.maxHeight!==t&&(this._maxHeight=t,this.redraw())}get padding(){return this._padding}set padding(t){if(t instanceof Array)throw new Error("Invalid padding");(this.padding.top!==t.top||this.padding.right!=t.right||this.padding.bottom!=t.bottom||this.padding.left!=t.left)&&(this._padding=t,this.redraw())}get textDirection(){return this._textDirection}set textDirection(t){this.textDirection!==t&&(this._textDirection=t,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(t){this.fontStyle!==t&&(this._fontStyle=t,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(t){this.fontVariant!==t&&(this._fontVariant=t,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(t){this.fontWeight!==t&&(this._fontWeight=t,this.redraw())}get fontSize(){return this._fontSize}set fontSize(t){this.fontSize!==t&&(this._fontSize=t,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(t){this.textFillColor!==t&&(this._textFillColor=t,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(t){this.textStrokeColor!==t&&(this._textStrokeColor=t,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(t){this.textStrokeSize!==t&&(this._textStrokeSize=t,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(t){this.bgFillColor!==t&&(this._bgFillColor=t,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(t){this.bgStrokeColor!==t&&(this._bgStrokeColor=t,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(t){this.bgStrokeSize!==t&&(this._bgStrokeSize=t,this.redraw())}get value(){return this._value}set value(t){this.value!==t&&(this._value=t,this.redraw())}split(t){return t.replace(/\r\n/g,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.onClear(),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value&&this.value!==this.lastValue){let t=this.split(this.value),o=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let p=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,s=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,c=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,x=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,v=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,R=o?x:s,D=o?v:c,O=o?s:x,B=o?c:v,U=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let h=!1,S=!1,z=1e4,F=0;this.trueFontSize=ft(this.fontSize*this.scale,F,z);let H=null,K=Number.MAX_VALUE;do{let C=this.fontSize;this._fontSize=this.trueFontSize;let St=ut(this);this._fontSize=C,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=St,this.trueWidth=0,this.trueHeight=0;for(let y of t){let l=this.g.measureText(y);this.trueWidth=Math.max(this.trueWidth,l.width),this.trueHeight+=this.trueFontSize,m(l.actualBoundingBoxLeft)&&m(l.actualBoundingBoxRight)&&m(l.actualBoundingBoxAscent)&&m(l.actualBoundingBoxDescent)&&(p||(this.trueWidth=l.actualBoundingBoxLeft+l.actualBoundingBoxRight,this.trueHeight=l.actualBoundingBoxAscent+l.actualBoundingBoxDescent,this.dx=(l.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(p){let y=this.trueWidth-R,l=this.trueWidth-D,$=this.trueHeight-O,Y=this.trueHeight-B,At=Math.abs(y),bt=Math.abs(l),Vt=Math.abs($),Ct=Math.abs(Y);h=l>1||Y>1,S=y<-1&&$<-1;let Z=Math.min(At,Math.min(bt,Math.min(Vt,Ct)));Z<K&&(K=Z,H=this.g.font),(h||S)&&U.indexOf(this.g.font)>-1&&H&&(this.g.font=H,h=!1,S=!1),h?(z=this.trueFontSize,this.trueFontSize=(F+this.trueFontSize)/2):S&&(F=this.trueFontSize,this.trueFontSize=(this.trueFontSize+z)/2)}U.push(this.g.font)}while(h||S);p&&(this.trueWidth<R?this.trueWidth=R:this.trueWidth>D&&(this.trueWidth=D),this.trueHeight<O?this.trueHeight=O:this.trueHeight>B&&(this.trueHeight=B));let vt=this.trueWidth+this.scale*(this.padding.right+this.padding.left),ht=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{J(this.g,vt,ht)}catch(C){throw console.error(C),C}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let r=.5*(t.length-1);for(let p=0;p<t.length;++p){let s=t[p],c=(p-r)*this.trueFontSize,x=this.dx+this.trueWidth/2+this.scale*this.padding.left,v=c+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(s,x,v),this.textFillColor&&this.g.fillText(s,x,v)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let p=this.bgStrokeSize/2;this.g.strokeRect(p,p,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(o){let p=N(this.canvas.height,this.canvas.width),s=p.getContext("2d");s?(s.translate(p.width/2,p.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?s.rotate(q):this.textDirection==="vertical-right"&&s.rotate(-q),s.translate(-this.canvas.width/2,-this.canvas.height/2),s.drawImage(this.canvas,0,0),J(this.g,p.width,p.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(p,0,0)}return this.lastValue=this.value,!0}else{let t=this.value!==this.lastValue;return this.lastValue=this.value,t}}};var L=class extends g{constructor(){super({textFillColor:"white",textStrokeColor:M(0,0,0,.5),textStrokeSize:.025,fontFamily:X(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,freezeDimensions:!0});let n=this.update.bind(this);setInterval(n,500),n()}update(){let t=new Date().toLocaleTimeString();(a(this.value)||t.length!==this.value.length)&&this.unfreeze(),this.value=t}};var j=class extends g{constructor(){super({textFillColor:"white",textStrokeColor:M(0,0,0,.5),textStrokeSize:.025,fontFamily:X(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,freezeDimensions:!0});this.fps=null;this.drawCalls=null;this.triangles=null}setStats(t,o,r){this.fps=t,this.drawCalls=o,this.triangles=r;let p=` ${Math.round(this.fps).toFixed(0)}hz ${this.drawCalls}c ${this.triangles}t`;(a(this.value)||p.length!==this.value.length)&&this.unfreeze(),this.value=p}};var Dt=new L,gt=new j;W("main",Dt,gt);setTimeout(()=>gt.setStats(50,25,1337),2e3);
