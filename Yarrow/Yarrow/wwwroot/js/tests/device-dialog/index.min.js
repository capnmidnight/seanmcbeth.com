var Ni=Object.defineProperty;var Oo=(n,t)=>{for(var e in t)Ni(n,e,{get:t[e],enumerable:!0})};function et(n,t,e){return typeof n===t||n instanceof e}function S(n){return et(n,"function",Function)}function g(n){return et(n,"string",String)}function U(n){return et(n,"boolean",Boolean)}function J(n){return et(n,"number",Number)}function ft(n){return x(n)||!Number.isFinite(n)||Number.isNaN(n)}function ae(n){return J(n)&&!ft(n)}function ye(n){return c(n)&&et(n,"object",Object)}function Dn(n){return n instanceof Date}function pe(n){return n instanceof Array}function C(n,t){throw new Error((t||"Unexpected object: ")+n)}function x(n){return n==null}function c(n){return!x(n)}function Xo(n){return n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Int8Array||n instanceof Uint16Array||n instanceof Int16Array||n instanceof Uint32Array||n instanceof Int32Array||n instanceof Float32Array||n instanceof Float64Array||"BigUint64Array"in globalThis&&n instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&n instanceof globalThis.BigInt64Array}function Bo(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function ji(n){return n}function Fi(n,t,e){let o=0,r=n.length,i=Math.floor((o+r)/2),s=!1;for(;o<r&&i<n.length;){let a=n[i],p=x(a)?null:e(a);c(p)&&t<p?r=i:(t===p&&(s=!0),o=i+1),i=Math.floor((o+r)/2)}return s||(i+=.5),i}function Gi(n,t,e){e=e||ji;let o=e(t);return Fi(n,o,e)}function k(n){return n.splice(0)}function No(n,t){for(let e=0;e<n.length;++e)if(n[e]!==t[e])return e;return-1}function On(n,t,e){n.splice(e,0,t)}function F(n,t){let e=n.indexOf(t);return e>-1?(Xn(n,e),!0):!1}function Xn(n,t){return n.splice(t,1)[0]}function zi(n,t,e){let o=n?0:t.length-1,r=n?t.length:-1,i=n?1:-1;for(let s of e)for(let a=o;a!=r;a+=i){let p=t[a];if(s(p))return p}return null}function K(n,...t){return zi(!0,n,t)}function Bn(n,t,e,o){let r;return S(e)?r=e:U(e)&&(o=e),x(o)&&(o=!0),Hi(n,t,r,o)}function Hi(n,t,e,o){let r=Gi(n,t,e),i=r%1===0;return r=r|0,(!i||o)&&On(n,t,r),r}function _t(n,t){let e=Array.from(n);return Wi(e,t),e}function Wi(n,t){n.sort((e,o)=>{let r=t(e),i=t(o);return r<i?-1:r>i?1:0})}function le(n){return n}function jo(){return!0}function Fo(){return!1}var b=class{constructor(t,e,o,...r){this.key=t;this.value=e;this.bySetAttribute=o;this.tags=r.map(i=>i.toLocaleUpperCase()),Object.freeze(this)}applyToElement(t){let e=this.key.startsWith("data-");if(!(this.tags.length===0||this.tags.indexOf(t.tagName)>-1||e))console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`);else if(e){let r=this.key.substring(5);t.dataset[r]=this.value}else if(this.key==="style")Object.assign(t.style,this.value);else if(this.key==="classList"){let r=this.value.filter(le);r.length>0&&r.forEach(i=>t.classList.add(i))}else this.bySetAttribute?t.setAttribute(this.key,this.value):this.key in t?t[this.key]=this.value:this.value===!1?t.removeAttribute(this.key):this.value===!0?t.setAttribute(this.key,""):t.setAttribute(this.key,this.value)}};function Nn(n){return n instanceof b}function Go(n,...t){let e=[...t],o=K(n,i=>i instanceof b&&i.key==="classList");c(o)&&(F(n,o),e.push(...o.value));let r=K(n,i=>i instanceof b&&i.key==="className");return c(r)&&(F(n,r),e.push(...r.value.split(" "))),e}function ht(n){return new b("autoplay",n,!1,"audio","video")}function zo(n){return new b("checked",n,!1,"command","input")}function G(n){return new b("className",n,!1)}function ce(...n){return new b("classList",n,!1)}function Ve(n){return new b("controls",n,!1,"audio","video")}function gt(n,t){return new b("data-"+n.toLowerCase(),t,!1)}function Ho(n){return new b("height",n,!1,"canvas","embed","iframe","img","input","object","video")}function Wo(n){return new b("id",n,!1)}function vt(n){return new b("loop",n,!1,"audio","bgsound","marquee","video")}function jn(n){return new b("max",n,!1,"input","meter","progress")}function Fn(n){return new b("min",n,!1,"input","meter")}function bt(n){return new b("muted",n,!1,"audio","video")}function Jo(n){return new b("rel",n,!1,"a","area","link")}function qo(n){return new b("selected",n,!1,"option")}function Ji(n){return n instanceof URL&&(n=n.href),n}function At(n){return new b("src",Ji(n),!1,"audio","embed","iframe","img","input","script","source","track","video")}function St(n){return new b("srcObject",n,!1,"audio","video")}function Gn(n){return new b("step",n,!1,"input")}function Uo(n){return new b("title",n,!1)}function de(n){return g(n)||(n=n.value),new b("type",n,!1,"button","input","command","embed","link","object","script","source","style","menu")}function Ce(n){return new b("value",n,!1,"button","data","input","li","meter","option","progress","param")}function Ko(n){return new b("width",n,!1,"canvas","embed","iframe","img","input","object","video")}var tt=class{constructor(){this.listeners=new Map;this.listenerOptions=new Map}addEventListener(t,e,o){if(S(e)){let r=this.listeners.get(t);r||(r=new Array,this.listeners.set(t,r)),r.find(i=>i===e)||(r.push(e),o&&this.listenerOptions.set(e,o))}}removeEventListener(t,e){if(S(e)){let o=this.listeners.get(t);o&&this.removeListener(o,e)}}clearEventListeners(t){for(let[e,o]of this.listeners)if(x(t)||t===e){for(let r of o)this.removeEventListener(t,r);k(o),this.listeners.delete(e)}}removeListener(t,e){let o=t.findIndex(r=>r===e);o>=0&&(Xn(t,o),this.listenerOptions.has(e)&&this.listenerOptions.delete(e))}dispatchEvent(t){let e=this.listeners.get(t.type);if(e)for(let o of e){let r=this.listenerOptions.get(o);c(r)&&!U(r)&&r.once&&this.removeListener(e,o),o.call(this,t)}return!t.defaultPrevented}},v=class extends Event{get type(){return super.type}constructor(t,e){super(t,e)}},j=class extends tt{constructor(){super(...arguments);this.bubblers=new Set;this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addEventListener(e,o,r){super.addEventListener(e,o,r)}removeEventListener(e,o){super.removeEventListener(e,o)}clearEventListeners(e){return super.clearEventListeners(e)}addScopedEventListener(e,o,r,i){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([o,r]),this.addEventListener(o,r,i)}removeScope(e){let o=this.scopes.get(e);if(o){this.scopes.delete(e);for(let[r,i]of o)this.removeEventListener(r,i)}}dispatchEvent(e){if(!super.dispatchEvent(e))return!1;if(!e.cancelBubble){for(let o of this.bubblers)if(!o.dispatchEvent(e))return!1}return!0}};var nt=class extends j{constructor(){super(...arguments);this.attached=new Array;this.soFar=null;this.total=null;this.msg=null;this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(e,o,r,i){this.soFar=e,this.total=o,this.msg=r,this.est=i;for(let s of this.attached)s.report(e,o,r,i)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(e){this.report(0,1,e||"starting")}end(e){this.report(1,1,e||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,k(this.attached)}};var te=class extends Error{constructor(e,o=null){super(e);this.innerError=o}};var y=class{constructor(t=!0){this.autoStart=t;this.onThens=new Array;this.onCatches=new Array;this._result=void 0;this._error=void 0;this._executionState="waiting";this._resultState="none";this.resolve=e=>{if(this.running){this._result=e,this._resultState="resolved";for(let o of this.onThens)o(e);this.clear(),this._executionState="finished"}},this.reject=e=>{if(this.running){this._error=e,this._resultState="errored";for(let o of this.onCatches)o(e);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){k(this.onThens),k(this.onCatches)}start(){this._executionState="running"}resolver(t){return()=>this.resolve(t)}resolveOn(t,e,o){let r=this.resolver(o);t.addEventListener(e,r),this.finally(()=>t.removeEventListener(e,r))}get result(){if(c(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((t,e)=>{this.finished?this.errored?e(this.error):t(this.result):(this.onThens.push(t),this.onCatches.push(e))})}then(t,e){return this.project().then(t,e)}catch(t){return this.project().catch(t)}finally(t){return this.project().finally(t)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(t){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",t&&this.start()}};function $o(n,t){return"on"+t in n}function O(n,t,e,...o){x(o)&&(o=[]);let r;if(g(e)?o.unshift(e):J(e)&&(r=e),!(n instanceof tt)){if(!$o(n,t))throw new te(`Target does not have a ${t} rejection event`);for(let p of o)if(!$o(n,p))throw new te(`Target does not have a ${p} rejection event`)}let i=new y;if(J(r)){let p=setTimeout(i.reject,r,`'${t}' has timed out.`);i.finally(clearTimeout.bind(globalThis,p))}let s=(p,l)=>{n.addEventListener(p,l),i.finally(()=>n.removeEventListener(p,l))};s(t,p=>i.resolve(p));let a=p=>i.reject(p);for(let p of o)s(p,a);return i}function ne(n){return n.then(jo).catch(Fo)}function Yo(n){return`${n}em`}function yt(...n){return`rgb(${n.join(", ")})`}var zn=class{constructor(t){this._value=t}get value(){return this._value}toString(){return this.value}};var Hn=class extends zn{constructor(e,o,r){super(r);this._name=e;this.sep=o}get name(){return this._name}toString(){return this.name+this.sep+this.value+";"}};var Wn=class extends Hn{constructor(t,e){super(t,": ",e)}},we=class extends Wn{constructor(e,o){super(e.replace(/[A-Z]/g,r=>`-${r.toLocaleLowerCase()}`),o.toString());this.key=e;this.priority=""}applyToElement(e){e.style[this.key]=this.value+this.priority}important(){return this.priority=" !important",this}get value(){return super.value+this.priority}};function Jn(n){return n instanceof we}function oe(n){return new we("display",n)}function qn(...n){return new we("margin",n.join(" "))}function Qo(n){return new we("paddingRight",n)}function Zo(n){return ye(n)?n.element instanceof Element:!1}function re(n){return Zo(n)?n.element:g(n)?er(n):n}function qi(n){return ye(n)&&"applyToElement"in n&&S(n.applyToElement)}function Ae(n,t,e=""){n=re(n),n.style.display=t?e:"none"}function Vt(n){return n=re(n),n.style.display!=="none"}function R(n,...t){n=re(n);for(let e of t)c(e)&&(e instanceof Node?n.append(e):Zo(e)?n.append(re(e)):qi(e)?e.applyToElement(n):n.append(document.createTextNode(e.toLocaleString())));return n}function er(n){return document.querySelector(n)}function tr(n){return Array.from(document.querySelectorAll(n))}function nr(n){return er(n)}function P(n,...t){let e=null;for(let o of t)if(o instanceof b&&o.key==="id"){e=document.getElementById(o.value);break}return e==null&&(e=document.createElement(n)),R(e,...t),e}function Un(n){return ye(n)&&"disabled"in n&&U(n.disabled)}function Ct(n){for(n=re(n);n.lastChild;)n.lastChild.remove()}function or(n,t){n=re(n),Ct(n),n.append($i(t))}function rr(n,t,e){n=re(n);let o=c(e),r=o&&n.classList.contains(e);o&&r!==t&&n.classList.toggle(e)}async function Ui(n,t,e){c(e)&&e.start();let o=n==="canplay"?t.HAVE_CURRENT_DATA:t.HAVE_ENOUGH_DATA;if(t.readyState>=o)return!0;try{return await O(t,n,"error"),!0}catch(r){return console.warn(t.error,r),!1}finally{c(e)&&e.end()}}function ir(n,t){return Ui("canplay",n,t)}function Te(...n){return P("audio",...n)}function Ki(...n){return P("button",...n)}function sr(...n){return Ki(...n,de("button"))}function Ee(...n){return sr(...n,ce("btn","btn-primary"))}function wt(...n){return sr(...n,ce("btn","btn-secondary"))}function ar(...n){return P("canvas",...n)}function Kn(...n){return P("dd",...n)}function ie(...n){return P("div",...n)}function pr(...n){return P("dl",...n)}function lr(...n){return P("dt",...n)}function cr(...n){return P("h1",...n)}function dr(...n){return P("h2",...n)}function $n(...n){return P("img",...n)}function Yn(...n){return P("input",...n)}function mr(...n){return P("label",...n)}function ur(...n){return P("link",...n)}function xr(...n){return P("meter",...n)}function Tt(...n){return P("option",...n)}function fr(...n){return P("script",...n)}function Et(...n){return P("select",...n)}function _r(...n){return P("video",...n)}function hr(...n){return Yn(de("checkbox"),...n)}function gr(...n){return Yn(de("number"),...n)}function vr(...n){return Yn(de("range"),...n)}function $i(n){return document.createTextNode(n)}var Qn=class{constructor(t,e,o){this.name=t;this.callback=e;if(!S(e))throw new Error("A function instance is required for this parameter");this.opts=o,Object.freeze(this)}applyToElement(t){this.add(t)}add(t){t.addEventListener(this.name,this.callback,this.opts)}remove(t){t.removeEventListener(this.name,this.callback)}};function ot(n,t,e){return new Qn(n,t,e)}function Pe(n,t){return ot("click",n,t)}function $(n,t){return ot("input",n,t)}function br(n,t){return ot("play",n,t)}var Ar=["change","click","contextmenu","dblclick","mouseup","pointerup","reset","submit","touchend"];function me(n,t=!1){let e=async o=>{if(o.isTrusted){if(!t)for(let r of Ar)window.removeEventListener(r,e);n()}};for(let o of Ar)window.addEventListener(o,e)}function Sr(n){if(n.status>=400)throw new Error("Resource could not be retrieved: "+n.requestPath);return n}function rt(n){let{content:t}=Sr(n);return t}function Zn(...n){return Promise.all(n)}function Yi(){return/^mac/i.test(navigator.platform)}function it(){return/iP(ad|hone|od)/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||Yi()&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>2}function yr(){return/Mobile VR/.test(navigator.userAgent)||/Pico Neo 3 Link/.test(navigator.userAgent)||st}var Qi=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,Pt=navigator.userAgent.match(Qi),st=!!Pt,Ip=st&&{major:parseFloat(Pt[1]),minor:parseFloat(Pt[2]),patch:parseFloat(Pt[3])},Mp=st&&/pacific/i.test(navigator.userAgent),kp=st&&/quest/i.test(navigator.userAgent),Rp=st&&/quest 2/i.test(navigator.userAgent);var Zi="Worker"in globalThis;function Ie(...n){let t=[];for(let e of n)c(e)&&e.length>0&&t.indexOf(e)===-1&&t.push(e);return t.join("-")}function eo(n,...t){if(!ye(n))return!1;n=n;for(let e of t){if(!(e in n))return!1;let o=n[e];if(!S(o))return!1}return!0}function es(n){return eo(n,"dispose")}function ts(n){return eo(n,"destroy")}function ns(n){return eo(n,"close")}function w(n){es(n)&&n.dispose(),ns(n)&&n.close(),ts(n)&&n.destroy()}function Vr(n,t){try{return t(n)}finally{w(n)}}function at(n){return c(n)&&"_resolveInput"in n}function pt(n){return at(n)&&"_resolveOutput"in n}var Me=class extends j{constructor(e,o){super();this.nodeType=e;this.context=o;this._name=null;this.disposed=!1}get name(){return this._name}set name(e){this._name=e,this.context._name(this,e)}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){}isConnected(e,o,r){return this.context._isConnected(this,e,o,r)}resolveOutput(e){let o={source:this,output:e};for(;pt(o.source);)o=o.source._resolveOutput(o.output);return o}resolveInput(e){let o={destination:this,input:e};for(;at(o.destination);)o=o.destination._resolveInput(o.input);return o}toggle(e,o,r){this._toggle(e,o,r)}_toggle(e,o,r){if(this.isConnected(e,o,r))this._disconnect(e,o,r);else return this._connect(e,o,r)}connect(e,o,r){return this._connect(e,o,r)}_connect(e,o,r){return this.context._connect(this,e,o,r)}disconnect(e,o,r){this._disconnect(e,o,r)}_disconnect(e,o,r){this.context._disconnect(this,e,o,r)}};var M=class extends Me{constructor(e,o,r,i,s){super(e,o);r=r||[],s=s||[];let a=i||r;this.inputs=r;let p=r.filter(pt).map(l=>l);this.outputs=a.filter(pt).map(l=>l),this.allNodes=Array.from(new Set([...p,...this.outputs,...s]))}get exemplar(){return this.allNodes[0]}add(e){this.allNodes.push(e),this.context._parent(this,e)}remove(e){F(this.allNodes,e),this.context._unparent(this,e)}onDisposing(){this.allNodes.forEach(w),super.onDisposing()}get channelCount(){return this.exemplar.channelCount}set channelCount(e){this.allNodes.forEach(o=>o.channelCount=e)}get channelCountMode(){return this.exemplar.channelCountMode}set channelCountMode(e){this.allNodes.forEach(o=>o.channelCountMode=e)}get channelInterpretation(){return this.exemplar.channelInterpretation}set channelInterpretation(e){this.allNodes.forEach(o=>o.channelInterpretation=e)}get numberOfInputs(){return this.inputs.length}get numberOfOutputs(){return this.outputs.length}static resolve(e,o){return o=o||0,o<0||e.length<=o?null:e[o]}_resolveInput(e){return{destination:M.resolve(this.inputs,e)}}_resolveOutput(e){return{source:M.resolve(this.outputs,e)}}};function os(n){return n[0]}function rs(n){return n.shift()}function is(n){return n[n.length-1]}function ss(n){return n.pop()}var It=class{constructor(t){this.value=t;this._forward=new Array;this._reverse=new Array}connectSorted(t,e){c(e)?(Bn(this._forward,t,o=>e(o.value)),Bn(t._reverse,this,o=>e(o.value))):this.connectTo(t)}connectTo(t){this.connectAt(t,this._forward.length)}connectAt(t,e){On(this._forward,t,e),t._reverse.push(this)}disconnectFrom(t){F(this._forward,t),F(t._reverse,this)}isConnectedTo(t){return this._forward.indexOf(t)>=0||this._reverse.indexOf(t)>=0}flatten(){let t=new Set,e=[this];for(;e.length>0;){let o=e.shift();c(o)&&!t.has(o)&&(t.add(o),e.push(...o._forward))}return Array.from(t)}*traverse(t){let e=new Set,o=[this],r=t?os:is,i=t?rs:ss;for(;o.length>0;){let s=r(o);e.has(s)?t||(i(o),yield s):(e.add(s),t&&(i(o),yield s),s._forward.length>0&&o.push(...s._forward))}}breadthFirst(){return this.traverse(!0)}depthFirst(){return this.traverse(!1)}search(t,e=!0){for(let o of this.traverse(e))if(t(o))return o;return null}*searchAll(t,e=!0){for(let o of this.traverse(e))t(o)&&(yield o)}find(t,e=!0){return this.search(o=>o.value===t,e)}findAll(t,e=!0){return this.searchAll(o=>o.value===t,e)}contains(t,e=!0){for(let o of this.traverse(e))if(o===t)return!0;return!1}containsValue(t,e=!0){for(let o of this.traverse(e))if(o.value===t)return!0;return!1}get _isEntryPoint(){return this._reverse.length===0}get _isExitPoint(){return this._forward.length===0}get isDisconnected(){return this._isEntryPoint&&this._isExitPoint}get isConnected(){return!this._isExitPoint||!this._isEntryPoint}get isTerminus(){return this._isEntryPoint||this._isExitPoint}get isInternal(){return!this._isEntryPoint&&!this._isExitPoint}};var Mt=class extends It{get connections(){return this._forward}get isEntryPoint(){return this._isEntryPoint}get isExitPoint(){return this._isExitPoint}};var f=class extends Me{constructor(e,o,r){super(e,o);this._node=r;this.context._init(this._node,this.nodeType)}onDisposing(){this.disconnect(),this.context._dispose(this._node),super.onDisposing()}parent(e){this.context._parent(this,e)}get channelCount(){return this._node.channelCount}set channelCount(e){this._node.channelCount=e}get channelCountMode(){return this._node.channelCountMode}set channelCountMode(e){this._node.channelCountMode=e}get channelInterpretation(){return this._node.channelInterpretation}set channelInterpretation(e){this._node.channelInterpretation=e}get numberOfInputs(){return this._node.numberOfInputs}get numberOfOutputs(){return this._node.numberOfOutputs}_resolveInput(e){return{destination:this._node,input:e}}_resolveOutput(e){return{source:this._node,output:e}}};var ke=class extends f{constructor(t,e){super("analyser",t,new AnalyserNode(t,e))}get fftSize(){return this._node.fftSize}set fftSize(t){this._node.fftSize=t}get frequencyBinCount(){return this._node.frequencyBinCount}get maxDecibels(){return this._node.maxDecibels}set maxDecibels(t){this._node.maxDecibels=t}get minDecibels(){return this._node.minDecibels}set minDecibels(t){this._node.minDecibels=t}get smoothingTimeConstant(){return this._node.smoothingTimeConstant}set smoothingTimeConstant(t){this._node.smoothingTimeConstant=t}getByteFrequencyData(t){this._node.getByteFrequencyData(t)}getByteTimeDomainData(t){this._node.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._node.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._node.getFloatTimeDomainData(t)}};var h=class{constructor(t,e,o){this.nodeType=t;this.context=e;this.param=o;this._name=null;this.disposed=!1;this.context._init(this.param,this.nodeType)}get name(){return this._name}set name(t){this._name=t,this.context._name(this,t)}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){this.context._dispose(this.param)}get automationRate(){return this.param.automationRate}set automationRate(t){this.param.automationRate=t}get defaultValue(){return this.param.defaultValue}get maxValue(){return this.param.maxValue}get minValue(){return this.param.minValue}get value(){return this.param.value}set value(t){this.param.value=t}cancelAndHoldAtTime(t){return this.param.cancelAndHoldAtTime(t),this}cancelScheduledValues(t){return this.param.cancelScheduledValues(t),this}exponentialRampToValueAtTime(t,e){return this.param.exponentialRampToValueAtTime(t,e),this}linearRampToValueAtTime(t,e){return this.param.linearRampToValueAtTime(t,e),this}setTargetAtTime(t,e,o){return this.param.setTargetAtTime(t,e,o),this}setValueAtTime(t,e){return this.param.setValueAtTime(t,e),this}setValueCurveAtTime(t,e,o){return this.param.setValueCurveAtTime(t,e,o),this}_resolveInput(){return{destination:this.param}}resolveInput(){return this._resolveInput()}};var kt=class extends f{constructor(e,o){super("audio-buffer-source",e,new AudioBufferSourceNode(e,o));this._node.addEventListener("ended",()=>this.dispatchEvent(new v("ended"))),this.parent(this.playbackRate=new h("playbackRate",e,this._node.playbackRate)),this.parent(this.detune=new h("detune",e,this._node.detune))}get buffer(){return this._node.buffer}set buffer(e){this._node.buffer=e}get loop(){return this._node.loop}set loop(e){this._node.loop=e}get loopEnd(){return this._node.loopEnd}set loopEnd(e){this._node.loopEnd=e}get loopStart(){return this._node.loopStart}set loopStart(e){this._node.loopStart=e}get onended(){return this._node.onended}set onended(e){this._node.onended=e}start(e,o,r){this._node.start(e,o,r)}stop(e){this._node.stop(e)}};var Rt=class extends f{constructor(t,e){super("destination",t,e)}get maxChannelCount(){return this._node.maxChannelCount}};var Y=class extends f{constructor(e,o){super("biquad-filter",e,new BiquadFilterNode(e,o));this.parent(this.Q=new h("Q",this.context,this._node.Q)),this.parent(this.detune=new h("detune",this.context,this._node.detune)),this.parent(this.frequency=new h("frequency",this.context,this._node.frequency)),this.parent(this.gain=new h("gain",this.context,this._node.gain))}get type(){return this._node.type}set type(e){this._node.type=e}getFrequencyResponse(e,o,r){this._node.getFrequencyResponse(e,o,r)}};var Lt=class extends f{constructor(t,e){super("channel-merger",t,new ChannelMergerNode(t,e))}};var Dt=class extends f{constructor(t,e){super("channel-splitter",t,new ChannelSplitterNode(t,e))}};var Ot=class extends f{constructor(e,o){super("constant-source",e,new ConstantSourceNode(e,o));this._node.addEventListener("ended",()=>this.dispatchEvent(new v("ended"))),this.parent(this.offset=new h("offset",this.context,this._node.offset))}get onended(){return this._node.onended}set onended(e){this._node.onended=e}start(e){this._node.start(e)}stop(e){this._node.stop(e)}};var Xt=class extends f{constructor(t,e){super("convolver",t,new ConvolverNode(t,e))}get buffer(){return this._node.buffer}set buffer(t){this._node.buffer=t}get normalize(){return this._node.normalize}set normalize(t){this._node.normalize=t}};var Bt=class extends f{constructor(e,o){super("delay",e,new DelayNode(e,o));this.parent(this.delayTime=new h("delay",this.context,this._node.delayTime))}};var Re=class extends f{constructor(e,o){super("dynamics-compressor",e,new DynamicsCompressorNode(e,o));this.parent(this.attack=new h("attack",this.context,this._node.attack)),this.parent(this.knee=new h("knee",this.context,this._node.knee)),this.parent(this.ratio=new h("ratio",this.context,this._node.ratio)),this.parent(this.release=new h("release",this.context,this._node.release)),this.parent(this.threshold=new h("threshold",this.context,this._node.threshold))}get reduction(){return this._node.reduction}};var q=class extends f{constructor(e,o){super("gain",e,new GainNode(e,o));this.parent(this.gain=new h("gain",this.context,this._node.gain))}};var Nt=class extends f{constructor(t,e){super("iir-filter",t,new IIRFilterNode(t,e))}getFrequencyResponse(t,e,o){this._node.getFrequencyResponse(t,e,o)}};var Le=class extends f{constructor(t,e){super("media-element-audio-source",t,new MediaElementAudioSourceNode(t,e))}get mediaElement(){return this._node.mediaElement}};var ue=class extends f{constructor(t,e){super("media-stream-audio-destination",t,new MediaStreamAudioDestinationNode(t,e))}get stream(){return this._node.stream}};var as="AudioContext"in globalThis,Cr=as&&"AudioListener"in globalThis,wr=Cr&&"setPosition"in AudioListener.prototype,lt=Cr&&"positionX"in AudioListener.prototype,to="createMediaStreamSource"in AudioContext.prototype,Hl=S(HTMLMediaElement.prototype.captureStream)||S(HTMLMediaElement.prototype.mozCaptureStream);var xe=class extends f{constructor(e,o){let r=Te(Ve(!1),bt(to),ht(!0),vt(!1),oe("none"),St(o.mediaStream)),i;to?i=new MediaStreamAudioSourceNode(e,o):i=new MediaElementAudioSourceNode(e,{mediaElement:r});super("media-stream-audio-source",e,i);this._stream=o.mediaStream,this._element=r}onDisposing(){this._element.pause(),super.onDisposing()}get mediaStream(){return this._stream}};var jt=class extends f{constructor(e,o){super("oscillator",e,new OscillatorNode(e,o));this._node.addEventListener("ended",()=>this.dispatchEvent(new v("ended"))),this.parent(this.detune=new h("detune",this.context,this._node.detune)),this.parent(this.frequency=new h("frequency",this.context,this._node.frequency))}get type(){return this._node.type}set type(e){this._node.type=e}get onended(){return this._node.onended}set onended(e){this._node.onended=e}setPeriodicWave(e){this._node.setPeriodicWave(e)}start(e){this._node.start(e)}stop(e){this._node.stop(e)}};var De=class extends f{constructor(e,o){super("panner",e,new PannerNode(e,o));this.parent(this.positionX=new h("positionX",this.context,this._node.positionX)),this.parent(this.positionY=new h("positionY",this.context,this._node.positionY)),this.parent(this.positionZ=new h("positionZ",this.context,this._node.positionZ)),this.parent(this.orientationX=new h("orientationX",this.context,this._node.orientationX)),this.parent(this.orientationY=new h("orientationY",this.context,this._node.orientationY)),this.parent(this.orientationZ=new h("orientationZ",this.context,this._node.orientationZ))}get coneInnerAngle(){return this._node.coneInnerAngle}set coneInnerAngle(e){this._node.coneInnerAngle=e}get coneOuterAngle(){return this._node.coneOuterAngle}set coneOuterAngle(e){this._node.coneOuterAngle=e}get coneOuterGain(){return this._node.coneOuterGain}set coneOuterGain(e){this._node.coneOuterGain=e}get distanceModel(){return this._node.distanceModel}set distanceModel(e){this._node.distanceModel=e}get maxDistance(){return this._node.maxDistance}set maxDistance(e){this._node.maxDistance=e}get panningModel(){return this._node.panningModel}set panningModel(e){this._node.panningModel=e}get refDistance(){return this._node.refDistance}set refDistance(e){this._node.refDistance=e}get rolloffFactor(){return this._node.rolloffFactor}set rolloffFactor(e){this._node.rolloffFactor=e}setOrientation(e,o,r){this._node.setOrientation(e,o,r)}setPosition(e,o,r){this._node.setPosition(e,o,r)}};var Ft=class extends f{constructor(e,o){super("stereo-panner",e,new StereoPannerNode(e,o));this.parent(this.pan=new h("pan",this.context,this._node.pan))}};var Gt=class extends f{constructor(t,e){super("wave-shaper",t,new WaveShaperNode(t,e))}get curve(){return this._node.curve}set curve(t){this._node.curve=t}get oversample(){return this._node.oversample}set oversample(t){this._node.oversample=t}};!("AudioContext"in globalThis)&&"webkitAudioContext"in globalThis&&(globalThis.AudioContext=globalThis.webkitAudioContext);!("OfflineAudioContext"in globalThis)&&"webkitOfflineAudioContext"in globalThis&&(globalThis.OfflineAudioContext=globalThis.webkitOfflineAudioContext);var no=class{constructor(t,e){this.type=t;this.name=e;this.connections=new Set}};function zt(n,t,e,o,r){return n.type===t&&(x(e)||e===n.destination)&&(x(o)||o===n.output)&&(x(r)||r===n.input)}function Oe(n,t){let e=null,o=null;return c(n)&&({destination:e,input:o}=n.resolveInput(t)),{destination:e,input:o}}var Ht=class extends AudioContext{constructor(e){super(e);this.counters=new Map;this.nodes=new Map;this._ready=new y;this._destination=new Rt(this,super.destination),this.state==="running"?this._ready.resolve():this.state==="closed"?this.resume().then(()=>this._ready.resolve()):me(()=>this.resume().then(()=>this._ready.resolve())),this.ready.then(()=>console.log("Audio is now ready"))}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}_init(e,o){if(!this.nodes.has(e)){this.counters.has(o)||this.counters.set(o,0);let r=this.counters.get(o),i=`${o}-${r}`;this.nodes.set(e,new no(o,i)),at(e)&&(e.name=i),this.counters.set(o,r+1)}}_name(e,o){let{destination:r}=Oe(e);if(this.nodes.has(r)){let i=this.nodes.get(r);i.name=`${o}-${i.type}`}}_dispose(e){this.nodes.delete(e)}_isConnected(e,o,r,i){let{source:s,output:a}=e.resolveOutput(r),{destination:p,input:l}=Oe(o,i);if(x(s)||!this.nodes.has(s))return null;{let d=this.nodes.get(s);for(let u of d.connections)if(zt(u,"conn",p,a,l))return!0;return!1}}_parent(e,o){let{source:r}=e.resolveOutput(),{destination:i}=Oe(o);this.nodes.has(r)&&this.nodes.get(r).connections.add({type:"parent",src:e,dest:o,destination:i,source:r})}_unparent(e,o){let{source:r}=e.resolveOutput(),{destination:i}=Oe(o);if(this.nodes.has(r)){let s=this.nodes.get(r).connections,a=new Set;for(let p of s)zt(p,"parent",i)&&a.add(p);for(let p of a)s.delete(p)}}_getConnections(e){return this.nodes.has(e)?this.nodes.get(e).connections:null}_connect(e,o,r,i){let{source:s,output:a}=e.resolveOutput(r),{destination:p,input:l}=Oe(o,i);if(this.nodes.has(s)){let d=this.nodes.get(s).connections,u=!1;for(let m of d)zt(m,"conn",p,a,l)&&(u=!0);u||d.add({type:"conn",src:e,dest:o,outp:r,inp:i,source:s,destination:p,output:a,input:l})}if(p instanceof AudioNode)return o=o,c(l)?(s.connect(p,a,l),o):c(a)?(s.connect(p,a),o):(s.connect(p),o);p instanceof AudioParam?c(a)?s.connect(p,a):c(p)?s.connect(p):C(p):C(p)}_disconnect(e,o,r,i){let s;J(o)?(s=void 0,r=o):s=o;let{source:a,output:p}=e.resolveOutput(r),{destination:l,input:d}=Oe(s,i);if(this.nodes.has(a)){let u=this.nodes.get(a).connections,m=new Set;for(let _ of u)zt(_,"conn",l,p,d)&&m.add(_);for(let _ of m)u.delete(_)}l instanceof AudioNode?c(i)?a.disconnect(l,r,i):c(r)?a.disconnect(l,r):c(l)?a.disconnect(l):a.disconnect():c(r)?a.disconnect(l,r):c(l)?a.disconnect(l):a.disconnect()}getAudioGraph(e){let o=new Map;for(let[r,i]of this.nodes){let s=r instanceof AudioNode?"node":r instanceof AudioParam?"param":"unknown";(e||s!=="param")&&o.set(r,new Mt({name:i.name,type:i.type,nodeClass:s}))}for(let[r,i]of this.nodes){let s=o.get(r);for(let a of i.connections){let p=a.destination;if(o.has(p)){let l=o.get(p);s.connectTo(l),l.connectTo(s)}}}return Array.from(o.values())}get destination(){return this._destination}createAnalyser(){return new ke(this)}createBiquadFilter(){return new Y(this)}createBufferSource(){return new kt(this)}createChannelMerger(e){return new Lt(this,{numberOfInputs:e})}createChannelSplitter(e){return new Dt(this,{numberOfOutputs:e})}createConstantSource(){return new Ot(this)}createConvolver(){return new Xt(this)}createDelay(e){return new Bt(this,{maxDelayTime:e})}createDynamicsCompressor(){return new Re(this)}createGain(){return new q(this)}createIIRFilter(e,o){return new Nt(this,{feedforward:e,feedback:o})}createMediaElementSource(e){return new Le(this,{mediaElement:e})}createMediaStreamDestination(){return new ue(this)}createMediaStreamSource(e){return new xe(this,{mediaStream:e})}createOscillator(){return new jt(this)}createPanner(){return new De(this)}createStereoPanner(){return new Ft(this)}createWaveShaper(){return new Gt(this)}createScriptProcessor(){throw new Error("Script processor nodes are deprecated")}};var z=1e-6,L=typeof Float32Array<"u"?Float32Array:Array,fe=Math.random;var Xc=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});function Tr(){var n=new L(9);return L!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}var Xe={};Oo(Xe,{add:()=>la,calculateW:()=>Qs,clone:()=>ia,conjugate:()=>na,copy:()=>aa,create:()=>io,dot:()=>ei,equals:()=>fa,exactEquals:()=>xa,exp:()=>$r,fromEuler:()=>oa,fromMat3:()=>Qr,fromValues:()=>sa,getAngle:()=>Us,getAxisAngle:()=>qs,identity:()=>Js,invert:()=>ta,len:()=>ma,length:()=>ti,lerp:()=>da,ln:()=>Yr,mul:()=>ca,multiply:()=>Kr,normalize:()=>so,pow:()=>Zs,random:()=>ea,rotateX:()=>Ks,rotateY:()=>$s,rotateZ:()=>Ys,rotationTo:()=>_a,scale:()=>Zr,set:()=>pa,setAxes:()=>ga,setAxisAngle:()=>Ur,slerp:()=>Kt,sqlerp:()=>ha,sqrLen:()=>ua,squaredLength:()=>ni,str:()=>ra});var I={};Oo(I,{add:()=>ms,angle:()=>ks,bezier:()=>Vs,ceil:()=>us,clone:()=>ls,copy:()=>cs,create:()=>Jt,cross:()=>ct,dist:()=>js,distance:()=>kr,div:()=>Ns,divide:()=>Mr,dot:()=>Ut,equals:()=>Os,exactEquals:()=>Ds,floor:()=>xs,forEach:()=>zs,fromValues:()=>qt,hermite:()=>ys,inverse:()=>As,len:()=>ro,length:()=>Er,lerp:()=>Ss,max:()=>_s,min:()=>fs,mul:()=>Bs,multiply:()=>Ir,negate:()=>bs,normalize:()=>oo,random:()=>Cs,rotateX:()=>Ps,rotateY:()=>Is,rotateZ:()=>Ms,round:()=>hs,scale:()=>gs,scaleAndAdd:()=>vs,set:()=>ds,sqrDist:()=>Fs,sqrLen:()=>Gs,squaredDistance:()=>Rr,squaredLength:()=>Lr,str:()=>Ls,sub:()=>Xs,subtract:()=>Pr,transformMat3:()=>Ts,transformMat4:()=>ws,transformQuat:()=>Es,zero:()=>Rs});function Jt(){var n=new L(3);return L!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function ls(n){var t=new L(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function Er(n){var t=n[0],e=n[1],o=n[2];return Math.hypot(t,e,o)}function qt(n,t,e){var o=new L(3);return o[0]=n,o[1]=t,o[2]=e,o}function cs(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function ds(n,t,e,o){return n[0]=t,n[1]=e,n[2]=o,n}function ms(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function Pr(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function Ir(n,t,e){return n[0]=t[0]*e[0],n[1]=t[1]*e[1],n[2]=t[2]*e[2],n}function Mr(n,t,e){return n[0]=t[0]/e[0],n[1]=t[1]/e[1],n[2]=t[2]/e[2],n}function us(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n}function xs(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n}function fs(n,t,e){return n[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n[2]=Math.min(t[2],e[2]),n}function _s(n,t,e){return n[0]=Math.max(t[0],e[0]),n[1]=Math.max(t[1],e[1]),n[2]=Math.max(t[2],e[2]),n}function hs(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n}function gs(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function vs(n,t,e,o){return n[0]=t[0]+e[0]*o,n[1]=t[1]+e[1]*o,n[2]=t[2]+e[2]*o,n}function kr(n,t){var e=t[0]-n[0],o=t[1]-n[1],r=t[2]-n[2];return Math.hypot(e,o,r)}function Rr(n,t){var e=t[0]-n[0],o=t[1]-n[1],r=t[2]-n[2];return e*e+o*o+r*r}function Lr(n){var t=n[0],e=n[1],o=n[2];return t*t+e*e+o*o}function bs(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n}function As(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n}function oo(n,t){var e=t[0],o=t[1],r=t[2],i=e*e+o*o+r*r;return i>0&&(i=1/Math.sqrt(i)),n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n}function Ut(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function ct(n,t,e){var o=t[0],r=t[1],i=t[2],s=e[0],a=e[1],p=e[2];return n[0]=r*p-i*a,n[1]=i*s-o*p,n[2]=o*a-r*s,n}function Ss(n,t,e,o){var r=t[0],i=t[1],s=t[2];return n[0]=r+o*(e[0]-r),n[1]=i+o*(e[1]-i),n[2]=s+o*(e[2]-s),n}function ys(n,t,e,o,r,i){var s=i*i,a=s*(2*i-3)+1,p=s*(i-2)+i,l=s*(i-1),d=s*(3-2*i);return n[0]=t[0]*a+e[0]*p+o[0]*l+r[0]*d,n[1]=t[1]*a+e[1]*p+o[1]*l+r[1]*d,n[2]=t[2]*a+e[2]*p+o[2]*l+r[2]*d,n}function Vs(n,t,e,o,r,i){var s=1-i,a=s*s,p=i*i,l=a*s,d=3*i*a,u=3*p*s,m=p*i;return n[0]=t[0]*l+e[0]*d+o[0]*u+r[0]*m,n[1]=t[1]*l+e[1]*d+o[1]*u+r[1]*m,n[2]=t[2]*l+e[2]*d+o[2]*u+r[2]*m,n}function Cs(n,t){t=t||1;var e=fe()*2*Math.PI,o=fe()*2-1,r=Math.sqrt(1-o*o)*t;return n[0]=Math.cos(e)*r,n[1]=Math.sin(e)*r,n[2]=o*t,n}function ws(n,t,e){var o=t[0],r=t[1],i=t[2],s=e[3]*o+e[7]*r+e[11]*i+e[15];return s=s||1,n[0]=(e[0]*o+e[4]*r+e[8]*i+e[12])/s,n[1]=(e[1]*o+e[5]*r+e[9]*i+e[13])/s,n[2]=(e[2]*o+e[6]*r+e[10]*i+e[14])/s,n}function Ts(n,t,e){var o=t[0],r=t[1],i=t[2];return n[0]=o*e[0]+r*e[3]+i*e[6],n[1]=o*e[1]+r*e[4]+i*e[7],n[2]=o*e[2]+r*e[5]+i*e[8],n}function Es(n,t,e){var o=e[0],r=e[1],i=e[2],s=e[3],a=t[0],p=t[1],l=t[2],d=r*l-i*p,u=i*a-o*l,m=o*p-r*a,_=r*m-i*u,T=i*d-o*m,D=o*u-r*d,H=s*2;return d*=H,u*=H,m*=H,_*=2,T*=2,D*=2,n[0]=a+d+_,n[1]=p+u+T,n[2]=l+m+D,n}function Ps(n,t,e,o){var r=[],i=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],i[0]=r[0],i[1]=r[1]*Math.cos(o)-r[2]*Math.sin(o),i[2]=r[1]*Math.sin(o)+r[2]*Math.cos(o),n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function Is(n,t,e,o){var r=[],i=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],i[0]=r[2]*Math.sin(o)+r[0]*Math.cos(o),i[1]=r[1],i[2]=r[2]*Math.cos(o)-r[0]*Math.sin(o),n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function Ms(n,t,e,o){var r=[],i=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],i[0]=r[0]*Math.cos(o)-r[1]*Math.sin(o),i[1]=r[0]*Math.sin(o)+r[1]*Math.cos(o),i[2]=r[2],n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function ks(n,t){var e=n[0],o=n[1],r=n[2],i=t[0],s=t[1],a=t[2],p=Math.sqrt(e*e+o*o+r*r),l=Math.sqrt(i*i+s*s+a*a),d=p*l,u=d&&Ut(n,t)/d;return Math.acos(Math.min(Math.max(u,-1),1))}function Rs(n){return n[0]=0,n[1]=0,n[2]=0,n}function Ls(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function Ds(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]}function Os(n,t){var e=n[0],o=n[1],r=n[2],i=t[0],s=t[1],a=t[2];return Math.abs(e-i)<=z*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(o-s)<=z*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(r-a)<=z*Math.max(1,Math.abs(r),Math.abs(a))}var Xs=Pr,Bs=Ir,Ns=Mr,js=kr,Fs=Rr,ro=Er,Gs=Lr,zs=function(){var n=Jt();return function(t,e,o,r,i,s){var a,p;for(e||(e=3),o||(o=0),r?p=Math.min(r*e+o,t.length):p=t.length,a=o;a<p;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],i(n,n,s),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2];return t}}();function Hs(){var n=new L(4);return L!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Dr(n){var t=new L(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function Or(n,t,e,o){var r=new L(4);return r[0]=n,r[1]=t,r[2]=e,r[3]=o,r}function Xr(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function Br(n,t,e,o,r){return n[0]=t,n[1]=e,n[2]=o,n[3]=r,n}function Nr(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n[3]=t[3]+e[3],n}function jr(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n}function Fr(n){var t=n[0],e=n[1],o=n[2],r=n[3];return Math.hypot(t,e,o,r)}function Gr(n){var t=n[0],e=n[1],o=n[2],r=n[3];return t*t+e*e+o*o+r*r}function zr(n,t){var e=t[0],o=t[1],r=t[2],i=t[3],s=e*e+o*o+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),n[0]=e*s,n[1]=o*s,n[2]=r*s,n[3]=i*s,n}function Hr(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function Wr(n,t,e,o){var r=t[0],i=t[1],s=t[2],a=t[3];return n[0]=r+o*(e[0]-r),n[1]=i+o*(e[1]-i),n[2]=s+o*(e[2]-s),n[3]=a+o*(e[3]-a),n}function Jr(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]}function qr(n,t){var e=n[0],o=n[1],r=n[2],i=n[3],s=t[0],a=t[1],p=t[2],l=t[3];return Math.abs(e-s)<=z*Math.max(1,Math.abs(e),Math.abs(s))&&Math.abs(o-a)<=z*Math.max(1,Math.abs(o),Math.abs(a))&&Math.abs(r-p)<=z*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(i-l)<=z*Math.max(1,Math.abs(i),Math.abs(l))}var Bc=function(){var n=Hs();return function(t,e,o,r,i,s){var a,p;for(e||(e=4),o||(o=0),r?p=Math.min(r*e+o,t.length):p=t.length,a=o;a<p;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],n[3]=t[a+3],i(n,n,s),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2],t[a+3]=n[3];return t}}();function io(){var n=new L(4);return L!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Js(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Ur(n,t,e){e=e*.5;var o=Math.sin(e);return n[0]=o*t[0],n[1]=o*t[1],n[2]=o*t[2],n[3]=Math.cos(e),n}function qs(n,t){var e=Math.acos(t[3])*2,o=Math.sin(e/2);return o>z?(n[0]=t[0]/o,n[1]=t[1]/o,n[2]=t[2]/o):(n[0]=1,n[1]=0,n[2]=0),e}function Us(n,t){var e=ei(n,t);return Math.acos(2*e*e-1)}function Kr(n,t,e){var o=t[0],r=t[1],i=t[2],s=t[3],a=e[0],p=e[1],l=e[2],d=e[3];return n[0]=o*d+s*a+r*l-i*p,n[1]=r*d+s*p+i*a-o*l,n[2]=i*d+s*l+o*p-r*a,n[3]=s*d-o*a-r*p-i*l,n}function Ks(n,t,e){e*=.5;var o=t[0],r=t[1],i=t[2],s=t[3],a=Math.sin(e),p=Math.cos(e);return n[0]=o*p+s*a,n[1]=r*p+i*a,n[2]=i*p-r*a,n[3]=s*p-o*a,n}function $s(n,t,e){e*=.5;var o=t[0],r=t[1],i=t[2],s=t[3],a=Math.sin(e),p=Math.cos(e);return n[0]=o*p-i*a,n[1]=r*p+s*a,n[2]=i*p+o*a,n[3]=s*p-r*a,n}function Ys(n,t,e){e*=.5;var o=t[0],r=t[1],i=t[2],s=t[3],a=Math.sin(e),p=Math.cos(e);return n[0]=o*p+r*a,n[1]=r*p-o*a,n[2]=i*p+s*a,n[3]=s*p-i*a,n}function Qs(n,t){var e=t[0],o=t[1],r=t[2];return n[0]=e,n[1]=o,n[2]=r,n[3]=Math.sqrt(Math.abs(1-e*e-o*o-r*r)),n}function $r(n,t){var e=t[0],o=t[1],r=t[2],i=t[3],s=Math.sqrt(e*e+o*o+r*r),a=Math.exp(i),p=s>0?a*Math.sin(s)/s:0;return n[0]=e*p,n[1]=o*p,n[2]=r*p,n[3]=a*Math.cos(s),n}function Yr(n,t){var e=t[0],o=t[1],r=t[2],i=t[3],s=Math.sqrt(e*e+o*o+r*r),a=s>0?Math.atan2(s,i)/s:0;return n[0]=e*a,n[1]=o*a,n[2]=r*a,n[3]=.5*Math.log(e*e+o*o+r*r+i*i),n}function Zs(n,t,e){return Yr(n,t),Zr(n,n,e),$r(n,n),n}function Kt(n,t,e,o){var r=t[0],i=t[1],s=t[2],a=t[3],p=e[0],l=e[1],d=e[2],u=e[3],m,_,T,D,H;return _=r*p+i*l+s*d+a*u,_<0&&(_=-_,p=-p,l=-l,d=-d,u=-u),1-_>z?(m=Math.acos(_),T=Math.sin(m),D=Math.sin((1-o)*m)/T,H=Math.sin(o*m)/T):(D=1-o,H=o),n[0]=D*r+H*p,n[1]=D*i+H*l,n[2]=D*s+H*d,n[3]=D*a+H*u,n}function ea(n){var t=fe(),e=fe(),o=fe(),r=Math.sqrt(1-t),i=Math.sqrt(t);return n[0]=r*Math.sin(2*Math.PI*e),n[1]=r*Math.cos(2*Math.PI*e),n[2]=i*Math.sin(2*Math.PI*o),n[3]=i*Math.cos(2*Math.PI*o),n}function ta(n,t){var e=t[0],o=t[1],r=t[2],i=t[3],s=e*e+o*o+r*r+i*i,a=s?1/s:0;return n[0]=-e*a,n[1]=-o*a,n[2]=-r*a,n[3]=i*a,n}function na(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n}function Qr(n,t){var e=t[0]+t[4]+t[8],o;if(e>0)o=Math.sqrt(e+1),n[3]=.5*o,o=.5/o,n[0]=(t[5]-t[7])*o,n[1]=(t[6]-t[2])*o,n[2]=(t[1]-t[3])*o;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[r*3+r]&&(r=2);var i=(r+1)%3,s=(r+2)%3;o=Math.sqrt(t[r*3+r]-t[i*3+i]-t[s*3+s]+1),n[r]=.5*o,o=.5/o,n[3]=(t[i*3+s]-t[s*3+i])*o,n[i]=(t[i*3+r]+t[r*3+i])*o,n[s]=(t[s*3+r]+t[r*3+s])*o}return n}function oa(n,t,e,o){var r=.5*Math.PI/180;t*=r,e*=r,o*=r;var i=Math.sin(t),s=Math.cos(t),a=Math.sin(e),p=Math.cos(e),l=Math.sin(o),d=Math.cos(o);return n[0]=i*p*d-s*a*l,n[1]=s*a*d+i*p*l,n[2]=s*p*l-i*a*d,n[3]=s*p*d+i*a*l,n}function ra(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"}var ia=Dr,sa=Or,aa=Xr,pa=Br,la=Nr,ca=Kr,Zr=jr,ei=Hr,da=Wr,ti=Fr,ma=ti,ni=Gr,ua=ni,so=zr,xa=Jr,fa=qr,_a=function(){var n=Jt(),t=qt(1,0,0),e=qt(0,1,0);return function(o,r,i){var s=Ut(r,i);return s<-.999999?(ct(n,t,r),ro(n)<1e-6&&ct(n,e,r),oo(n,n),Ur(o,n,Math.PI),o):s>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(ct(n,r,i),o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=1+s,so(o,o))}}(),ha=function(){var n=io(),t=io();return function(e,o,r,i,s,a){return Kt(n,o,s,a),Kt(t,r,i,a),Kt(e,n,t,2*a*(1-a)),e}}(),ga=function(){var n=Tr();return function(t,e,o,r){return n[0]=o[0],n[3]=o[1],n[6]=o[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],so(t,Qr(t,n))}}();var $t=class{constructor(t,e){this.type=t;this.context=e}};var Be=I.create(),Ne=I.create(),je=class extends $t{get listener(){return this.context.listener}readPose(t){let{p:e,q:o}=t;I.set(Be,0,0,-1),I.transformQuat(Be,Be,o),I.set(Ne,0,1,0),I.transformQuat(Ne,Ne,o),this.setPosition(e[0],e[1],e[2]),this.setOrientation(Be[0],Be[1],Be[2],Ne[0],Ne[1],Ne[2])}};var Yt=class extends je{constructor(t){if(!lt)throw new Error("Latest WebAudio Listener API is not supported");super("web-audio-listener-new",t),Object.seal(this)}setPosition(t,e,o){let r=this.context.currentTime;this.listener.positionX.setValueAtTime(t,r),this.listener.positionY.setValueAtTime(e,r),this.listener.positionZ.setValueAtTime(o,r)}setOrientation(t,e,o,r,i,s){let a=this.context.currentTime;this.listener.forwardX.setValueAtTime(t,a),this.listener.forwardY.setValueAtTime(e,a),this.listener.forwardZ.setValueAtTime(o,a),this.listener.upX.setValueAtTime(r,a),this.listener.upY.setValueAtTime(i,a),this.listener.upZ.setValueAtTime(s,a)}};var Qt=class extends je{constructor(t){if(!wr)throw new Error("WebAudio Listener API is not supported");super("web-audio-listener-old",t),Object.seal(this)}setPosition(t,e,o){this.listener.setPosition(t,e,o)}setOrientation(t,e,o,r,i,s){this.listener.setOrientation(t,e,o,r,i,s)}};var Fe=class{constructor(){this.p=I.create();this.q=Xe.create();Object.seal(this)}set(t,e,o,r,i,s,a){this.setPosition(t,e,o),this.setOrientation(r,i,s,a)}setPosition(t,e,o){I.set(this.p,t,e,o)}setOrientation(t,e,o,r){Xe.set(this.q,t,e,o,r)}copy(t){I.copy(this.p,t.p),Xe.copy(this.q,t.q)}};var Ge=class extends M{constructor(e,o,r,i,s,a){super(e,o,i,s,a);this.spatialized=r;this._minDistance=1;this._maxDistance=10;this._algorithm="inverse"}get minDistance(){return this._minDistance}get maxDistance(){return this._maxDistance}get algorithm(){return this._algorithm}setAudioProperties(e,o,r){this._minDistance=e,this._maxDistance=o,this._algorithm=r}};var dt=I.create(),ze=class extends Ge{constructor(e,o){let r=new De(o,{panningModel:"HRTF",distanceModel:"inverse",coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:0});super(e,o,!0,[r]);this.lpx=0;this.lpy=0;this.lpz=0;this.lqx=0;this.lqy=0;this.lqz=0;this.lqw=0;this.panner=r}setAudioProperties(e,o,r){super.setAudioProperties(e,o,r),this.panner.refDistance=this.minDistance,this.panner.distanceModel=r,r==="linear"?this.panner.rolloffFactor=1:this.maxDistance<=0?this.panner.rolloffFactor=1/0:r==="inverse"?this.panner.rolloffFactor=1/this.maxDistance:this.panner.rolloffFactor=Math.pow(this.maxDistance,-.2)}readPose(e){let{p:o,q:r}=e,[i,s,a]=o,[p,l,d,u]=r;(i!==this.lpx||s!==this.lpy||a!==this.lpz)&&(this.lpx=i,this.lpy=s,this.lpz=a,this.setPosition(i,s,a,this.context.currentTime)),(p!==this.lqx||l!==this.lqy||d!==this.lqz||u!==this.lqw)&&(this.lqx=p,this.lqy=l,this.lqz=d,this.lqw=u,I.transformQuat(dt,I.set(dt,0,0,-1),r),this.setOrientation(dt[0],dt[1],dt[2],this.context.currentTime))}getGainAtDistance(e){let{rolloffFactor:o,refDistance:r,maxDistance:i,distanceModel:s}=this.panner;if(e<=r)return 1;{let a=e-r,p=i-r;if(s==="linear")return 1-o*a/p;if(s==="inverse")return r/(r+o*a);if(s==="exponential")return Math.pow(e/r,-o);C(s)}}};var Zt=class extends ze{constructor(t){super("web-audio-panner-new",t),Object.seal(this)}setPosition(t,e,o,r){ae(t)&&ae(e)&&ae(o)&&(ft(r)&&(r=0),this.panner.positionX.setValueAtTime(t,r),this.panner.positionY.setValueAtTime(e,r),this.panner.positionZ.setValueAtTime(o,r))}setOrientation(t,e,o,r){ae(t)&&ae(e)&&ae(o)&&(ft(r)&&(r=0),this.panner.orientationX.setValueAtTime(-t,r),this.panner.orientationY.setValueAtTime(-e,r),this.panner.orientationZ.setValueAtTime(-o,r))}};var en=class extends ze{constructor(t){super("web-audio-panner-old",t),Object.seal(this)}setPosition(t,e,o){this.panner.setPosition(t,e,o)}setOrientation(t,e,o){this.panner.setOrientation(t,e,o)}};var tn=class extends M{constructor(e){let o=lt?new Yt(e):new Qt(e),r=new q(e);r.name="remote-user-input";let i=new q(e);i.name="spatialized-input";let s=new q(e);s.name="non-spatialized-input";let a=new ue(e),p=new y,l=Te(Wo("Audio-Device-Manager"),oe("none"),ht(!0),Ve(!0),St(a.stream),br(()=>p.resolve()));me(()=>l.play());super("web-audio-destination",e,[s,i,r],[],[a]);this.pose=new Fe;this._ready=p,this.listener=o,this.remoteUserInput=r,this.spatializedInput=i,this.nonSpatializedInput=s,this.volumeControl=s,this.destination=a,this.element=l,r.connect(i).connect(this.volumeControl).connect(a)}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}createSpatializer(e){let o=e?this.remoteUserInput:this.spatializedInput,r=lt?new Zt(this.context):new en(this.context);return r.connect(o),r}setPosition(e,o,r){this.pose.setPosition(e,o,r),this.listener.readPose(this.pose)}setOrientation(e,o,r,i){this.pose.setOrientation(e,o,r,i),this.listener.readPose(this.pose)}set(e,o,r,i,s,a,p){this.pose.set(e,o,r,i,s,a,p),this.listener.readPose(this.pose)}get stream(){return this.destination.stream}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}};var ao=class extends M{constructor(t){let e=new Y(t,{type:"bandpass",frequency:2500,Q:4.5}),o=new q(t,{gain:10});e.connect(o),super("radio-effect",t,[e],[o])}};function oi(n,t){let e=new ao(t);return e.name=`${n}-radio-effect`,e}function ri(n,t){let e=new Y(t,{type:"bandpass",frequency:400,Q:4.5});return e.name=`${n}-wall-effect`,e}var ii=new Map([["Radio",oi],["Wall",ri]]);var He=class extends M{constructor(e,o,r,i,s){let a=new q(o);a.name="volume-control",s=s||[];super(e,o,[],[r],s);this.spatializer=r;this.effects=new Array;this.pose=new Fe;this.volumeControl=a,this.setEffects(...i)}onDisposing(){k(this.effects),super.onDisposing()}setEffects(...e){this.disable();for(let r of this.effects)this.remove(r),w(r);k(this.effects);let o=this.volumeControl;for(let r of e)if(c(r)){let i=ii.get(r);if(c(i)){let s=i(r,this.context);this.add(s),this.effects.push(s),o=o.connect(s)}}this.enable()}get spatialized(){return this.spatializer.spatialized}get lastInternal(){return this.effects[this.effects.length-1]||this.volumeControl}enable(){this.lastInternal.isConnected()||this.lastInternal.connect(this.spatializer)}disable(){this.lastInternal.isConnected()&&this.lastInternal.disconnect()}tog(){this.lastInternal.isConnected()?this.disable():this.enable()}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}get minDistance(){return c(this.spatializer)?this.spatializer.minDistance:null}get maxDistance(){return c(this.spatializer)?this.spatializer.maxDistance:null}get algorithm(){return c(this.spatializer)?this.spatializer.algorithm:null}setPosition(e,o,r){c(this.spatializer)&&(this.pose.setPosition(e,o,r),this.spatializer.readPose(this.pose))}setOrientation(e,o,r,i){c(this.spatializer)&&(this.pose.setOrientation(e,o,r,i),this.spatializer.readPose(this.pose))}set(e,o,r,i,s,a,p){c(this.spatializer)&&(this.pose.set(e,o,r,i,s,a,p),this.spatializer.readPose(this.pose))}setAudioProperties(e,o,r){c(this.spatializer)&&this.spatializer.setAudioProperties(e,o,r)}};var _e=class extends v{constructor(e,o){super(e);this.source=o}},nn=class extends _e{constructor(t){super("loaded",t)}},on=class extends _e{constructor(e,o){super("errored",e);this.error=o}},rn=class extends _e{constructor(t){super("played",t)}},sn=class extends _e{constructor(t){super("paused",t)}},an=class extends _e{constructor(t){super("stopped",t)}},pn=class extends _e{constructor(e){super("progress",e);this.value=0;this.total=0}};var va=new v("disposing"),ln=class extends He{constructor(e,o,r,i,s,...a){super("audio-element-source",e,s,a);o.connect(this.volumeControl),this.audio=o.mediaElement,this.disable(),this.loadEvt=new nn(this),this.playEvt=new rn(this),this.pauseEvt=new sn(this),this.stopEvt=new an(this),this.progEvt=new pn(this);let p=l=>{this.audio.currentTime===0||l.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};this.audio.addEventListener("ended",p),this.audio.addEventListener("pause",p),r&&this.audio.addEventListener("play",()=>{if(this.audio.loop&&this.audio.duration>1){let l=this.audio.duration*Math.random();this.audio.currentTime=l}}),i&&(o.mediaElement.preservesPitch=!1,this.audio.addEventListener("play",()=>{o.mediaElement.playbackRate=1+.1*(2*Math.random()-1)})),this.audio.addEventListener("play",()=>{this.dispatchEvent(this.playEvt)}),this.audio.addEventListener("timeupdate",()=>{this.progEvt.value=this.audio.currentTime,this.progEvt.total=this.audio.duration,this.dispatchEvent(this.progEvt)}),this.audio.autoplay&&this.play().catch(()=>me(()=>this.play())),ir(this.audio).then(l=>this.dispatchEvent(l?this.loadEvt:new on(this,this.audio.error)))}onDisposing(){this.dispatchEvent(va),super.onDisposing()}get playbackState(){return this.audio.error?"errored":this.audio.ended||this.audio.paused&&this.audio.currentTime===0?"stopped":this.audio.paused?"paused":"playing"}async play(){this.enable(),await this.context.ready,await this.audio.play()}async playThrough(){let e=O(this,"stopped");await this.play(),await e}pause(){this.disable(),this.audio.pause()}stop(){this.audio.currentTime=0,this.pause()}restart(){return this.stop(),this.play()}};var po=class extends v{constructor(e){super("sourceadded");this.source=e}},cn=class extends He{constructor(e,o,...r){super("audio-stream-source",e,o,r);this._stream=null;this._node=null}get stream(){return this._stream}set stream(e){e!==this.stream&&(c(this.stream)&&(this.remove(this._node),w(this._node),this._node=null),c(e)&&(this._node=new xe(this.context,{mediaStream:e}),this._node.name=Ie("media-stream-source",e.id),this._node.connect(this.volumeControl),this.add(this._node),this.dispatchEvent(new po(this))))}};var dn=class extends Ge{constructor(t){super("no-spatializer",t.context,!1,[t],[t])}readPose(t){}getGainAtDistance(t){return 1}};function mn(n){let t=[];for(let e=0;e<n.length;++e){let o=n[e],r=!1;for(let i=0;i<t.length&&!r;++i){let s=t[i];r=o.kind===s.kind&&s.label.indexOf(o.label)>0}r||t.push(o)}return t}var Q=S(HTMLAudioElement.prototype.setSinkId),lo=class extends v{constructor(e){super("audiooutputchanged");this.device=e}},si="calla:preferredAudioOutputID",un=class extends j{constructor(e){super();this.element=e;this._hasAudioPermission=!1;this._ready=new y;this.start(),Object.seal(this)}get hasAudioPermission(){return this._hasAudioPermission}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}async start(){if(Q){let e=await navigator.mediaDevices.enumerateDevices(),o=K(e,r=>r.kind==="audiooutput"&&r.label.length>0);if(c(o)){this._hasAudioPermission=!0;let r=await this.getPreferredAudioOutput();r&&await this.setAudioOutputDevice(r)}}this._ready.resolve()}get preferredAudioOutputID(){return Q?localStorage.getItem(si):null}async getAudioOutputDevices(e=!1){return Q?await this.getAvailableDevices(e)||[]:[]}async getAudioOutputDevice(){if(!Q)return null;let e=this.element&&this.element.sinkId;if(x(e))return null;let o=await this.getAudioOutputDevices();return K(o,i=>i.deviceId===e)}async getPreferredAudioOutput(){if(!Q)return null;let e=await this.getAudioOutputDevices();return K(e,r=>r.deviceId===this.preferredAudioOutputID,r=>r.deviceId==="default",r=>r.deviceId.length>0)}async setAudioOutputDevice(e){if(Q){if(c(e)&&e.kind!=="audiooutput")throw new Error(`Device is not an audio output device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(si,e&&e.deviceId||null);let o=this.element,r=o&&o.sinkId;this.preferredAudioOutputID!==r&&(c(this.preferredAudioOutputID)&&await this.element.setSinkId(this.preferredAudioOutputID),this.dispatchEvent(new lo(e)))}}async getAvailableDevices(e=!1){let o=null,r=null;for(let i=0;i<3;++i){o=await navigator.mediaDevices.enumerateDevices();for(let s of o)s.deviceId.length>0&&(this.hasAudioPermission||(this._hasAudioPermission=s.kind==="audioinput"&&s.label.length>0));if(this.hasAudioPermission)break;try{r=await this.startStream()}catch(s){console.warn(s)}}if(r)for(let i of r.getTracks())i.stop();return o=_t(o||[],i=>i.label),e&&(o=mn(o)),Q?o.filter(i=>i.kind==="audiooutput"):[]}startStream(){return navigator.mediaDevices.getUserMedia({audio:!0})}};var ai="juniper::useHeadphones",ba=new v("useheadphonestoggled"),pi=10,Aa=new v("released"),li="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",xn=class extends M{constructor(e,o){let r=new Ht;"THREE"in globalThis&&globalThis.THREE.AudioContext.setContext(r);let i=new tn(r),s=new dn(i.nonSpatializedInput),a=new un(i.element);super("audio-manager",r,null,null,[s,i]);this.fetcher=e;this.users=new Map;this.clips=new Map;this.pendingAudio=new Array;this.audioPool=new Array;this.elements=new Map;this.elementCounts=new Map;this._minDistance=.25;this._maxDistance=100;this._algorithm="inverse";this._useHeadphones=!1;this.destination=null;this._ready=new y;this.localUserID=null;this.destination=i,this.noSpatializer=s,this.speakers=a,Zn(this.context.ready,this.destination.ready,this.speakers.ready).then(()=>this._ready.resolve()),this.setLocalUserID(o);let p=localStorage.getItem(ai);c(p)?this._useHeadphones=p==="true":this._useHeadphones=yr(),this.enpool(),it()&&me(()=>{let l=[...this.pendingAudio];k(this.pendingAudio);for(let d of l)d()},!0),Object.seal(this)}get algorithm(){return this._algorithm}get element(){return this.destination.element}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}enpool(){for(let e=0;e<pi;++e){let o=new y,r=Te(At(li),Ve(!1),ot("released",()=>{r.pause(),r.src=li}));this.audioPool.push(o),it()?this.pendingAudio.push(()=>{r.play(),o.resolve(r)}):o.resolve(r)}}preparePool(e){for(;this.audioPool.length<e;)this.enpool()}async getPooledAudio(...e){if(this.audioPool.length===0)throw new te("Audio pool exhausted!");let o=this.audioPool.shift();this.audioPool.length<=pi/2&&this.enpool();let r=await o;return r.pause(),R(r,...e),r}async getPooledSource(e,o,r){if(!this.elements.has(e)){let s=await this.getPooledAudio(At(o),vt(r&&!it()));it()&&r&&s.addEventListener("ended",()=>s.play());let a=new Le(this.context,{mediaElement:s});a.name=Ie("media-element-source",e),this.elements.set(e,a),this.elementCounts.set(e,0)}let i=this.elements.get(e);return this.elementCounts.set(e,this.elementCounts.get(e)+1),i}releasePooledSource(e){let o=this.elements.get(e);this.elementCounts.set(e,this.elementCounts.get(e)-1),this.elementCounts.get(e)===0&&(o.mediaElement.dispatchEvent(Aa),this.elementCounts.delete(e),this.elements.delete(e))}get useHeadphones(){return this._useHeadphones}set useHeadphones(e){e!==this.useHeadphones&&(this._useHeadphones=e,localStorage.setItem(ai,this.useHeadphones.toString()),this.dispatchEvent(ba))}onDisposing(){this.context.suspend();for(let e of this.users.keys())this.removeUser(e);for(let e of this.clips.keys())this.removeClip(e);super.onDisposing()}get currentTime(){return this.context.currentTime}createSpatializer(e,o){if(e){let r=this.destination.createSpatializer(o);return r.setAudioProperties(this._minDistance,this._maxDistance,this._algorithm),r}else return this.noSpatializer}createUser(e,o){if(!this.users.has(e)){let r=new cn(this.context,this.createSpatializer(!0,!0));r.name=Ie(o,e),this.users.set(e,r)}return this.users.get(e)}setLocalUserID(e){return this.destination&&(this.localUserID=e),this.destination}createBasicClip(e,o,r){return this.createClip(e,o,!1,!1,!1,!0,r,[])}hasClip(e){return this.clips.has(e)}async createClip(e,o,r,i,s,a,p,l,d){await this.ready;let u,m;g(o)?(u=o,m=await this.fetcher.get(o).progress(d).file().then(rt)):(u=o.path,m=o.result);let _=await this.getPooledSource(u,m,r),T=new ln(this.context,_,s,a,this.createSpatializer(i,!1),...l);return T.addEventListener("disposing",()=>this.releasePooledSource(u)),T.name=Ie("audio-clip-element",e),T.volume=p,this.clips.set(e,T),T}async playClip(e){this.hasClip(e)&&await this.clips.get(e).play()}async playClipThrough(e){this.hasClip(e)&&await this.clips.get(e).playThrough()}stopClip(e){this.hasClip(e)&&this.clips.get(e).stop()}getUser(e){return this.users.get(e)}getClip(e){return this.clips.get(e)}removeSource(e,o){let r=e.get(o);return c(r)&&(e.delete(o),w(r)),r}removeUser(e){let o=this.removeSource(this.users,e);c(o.stream)&&(o.stream=null)}removeClip(e){let o=this.removeSource(this.clips,e);return w(o),o}setUserStream(e,o){if(this.users.has(e)){let r=this.users.get(e);r.stream=o}}setAudioProperties(e,o,r){this._minDistance=e,this._maxDistance=o,this._algorithm=r;for(let i of this.users.values())i.setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let i of this.clips.values())i.setAudioProperties(i.minDistance,i.maxDistance,this.algorithm)}withPoser(e,o,r){let s=e.get(o)||this.destination;return r(s)}withUser(e,o){return this.withPoser(this.users,e,o)}withClip(e,o){return this.withPoser(this.clips,e,o)}setUserPose(e,o,r,i,s,a,p,l){this.withUser(e,d=>{d.set(o,r,i,s,a,p,l)})}setUserPosition(e,o,r,i){this.withUser(e,s=>{s.setPosition(o,r,i)})}setUserOrientation(e,o,r,i,s){this.withUser(e,a=>{a.setOrientation(o,r,i,s)})}setClipPose(e,o,r,i,s,a,p,l){this.withClip(e,d=>{d.set(o,r,i,s,a,p,l)})}setClipPosition(e,o,r,i){this.withClip(e,s=>{s.setPosition(o,r,i)})}setClipOrientation(e,o,r,i,s){this.withClip(e,a=>{a.setOrientation(o,r,i,s)})}};var We=class extends v{constructor(){super("devicesettingschanged")}},fn=class{constructor(...t){this.permissed=new Set;this.managers=t}get hasPermissions(){for(let t of this.managers)if(!this.permissed.has(t))return!1;return!0}async init(){if(!this.hasPermissions){let t=await this.getDevices();await Promise.all(this.managers.map(e=>e.setDevice(K(t,o=>o.kind===e.deviceKind&&o.deviceId===e.preferredDeviceID,o=>o.kind===e.deviceKind&&o.deviceId==="default",o=>o.kind===e.deviceKind&&o.deviceId.length>0))))}}async getDevices(t=!1){let e=null,o=null;for(let r=0;r<3;++r)if(e=await navigator.mediaDevices.enumerateDevices(),!this.hasPermissions){let i={};for(let s of this.managers)if(!this.permissed.has(s)){for(let a of e)if(a.kind===s.deviceKind&&a.deviceId.length>0&&a.label.length>0){this.permissed.add(s);break}this.permissed.has(s)||(i[s.mediaType]=!0)}if(!this.hasPermissions)try{o=await navigator.mediaDevices.getUserMedia(i)}catch(s){console.warn(s)}}if(o)for(let r of o.getTracks())r.stop();return e=_t(e||[],r=>r.label),t&&(e=mn(e)),e}get outStreams(){return this.managers.map(t=>t.outStream)}};var Je=class extends v{constructor(e,o){super("streamchanged");this.oldStream=e;this.newStream=o}};var ci="calla:preferredAudioInputID",_n=class extends M{constructor(e){let o=e.createGain();o.name="local-mic-user-gain";let r=e.createGain();r.name="local-mic-auto-gain";let i=new Y(e,{type:"bandpass",frequency:1500,Q:.25});i.name="local-mic-filter";let s=new Re(e,{threshold:-15,knee:40,ratio:17});s.name="local-mic-compressor";let a=new ue(e);a.name="local-mic-destination";super("local-user-microphone",e,[],[s],[o,i,a]);this.localStreamNode=null;this._hasPermission=!1;this._usingHeadphones=!1;this._device=null;this._enabled=!1;this.volume=o,this.autoGainNode=r,this.compressor=s,this.output=a,o.connect(r).connect(i).connect(s).connect(a),Object.seal(this)}get mediaType(){return"audio"}get deviceKind(){return`${this.mediaType}input`}get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.onChange())}get hasPermission(){return this._hasPermission}get preferredDeviceID(){return localStorage.getItem(ci)}get device(){return this._device}async setDevice(e){if(c(e)&&e.kind!==this.deviceKind)throw new Error(`Device is not an audio input device. Was: ${e.kind}. Label: ${e.label}`);let o=this.device&&this.device.deviceId||null,r=e&&e.deviceId||null;r!==o&&(this._device=e,localStorage.setItem(ci,r),this.onChange())}get inStream(){return this.localStreamNode&&this.localStreamNode.mediaStream||null}set inStream(e){e!==this.inStream&&(this.localStreamNode&&(this.remove(this.localStreamNode),w(this.localStreamNode),this.localStreamNode=null),e&&(this.localStreamNode=new xe(this.context,{mediaStream:e}),this.add(this.localStreamNode),this.localStreamNode.connect(this.volume)))}get outStream(){return this.output.stream}get gain(){return this.volume.gain}get muted(){return this.compressor.isConnected(this.output)}set muted(e){e!==this.muted&&(e?this.compressor.connect(this.output):this.compressor.disconnect(this.output))}get usingHeadphones(){return this._usingHeadphones}set usingHeadphones(e){e!==this.usingHeadphones&&(this._usingHeadphones=e,this.onChange())}async onChange(){this.dispatchEvent(new We);let e=this.inStream;this.device&&this.enabled?this.inStream=await navigator.mediaDevices.getUserMedia({audio:{deviceId:this.device.deviceId,echoCancellation:!this.usingHeadphones,autoGainControl:!0,noiseSuppression:!0}}):this.inStream=null,this.inStream!==e&&this.dispatchEvent(new Je(e,this.outStream))}};async function di(n,t){if(!t.isReady){let e=Ee("Start",Pe(()=>e.disabled=!0,!0));R(n,e),await t.ready,e.remove()}}var mi=Math.PI,mu=.5*mi,uu=2*mi;var Sa=864e13,xu=-Sa;function ui(n,t,e){return(1-e)*n+e*t}var co=class extends v{constructor(){super("update");this.t=0;this.dt=0;this.sdt=0;this.fps=0}set(e,o){this.t=e,this.dt=o,this.sdt=ui(this.sdt,o,.01),o>0&&(this.fps=1e3/o)}},hn=class extends co{constructor(){super(),Object.seal(this)}};var gn=class{constructor(t){this.timer=null;this.lt=-1;this.tickHandlers=new Array;this._targetFPS=null;this.targetFPS=t;let e=new hn,o=0;this.onTick=r=>{this.lt>=0&&(o=r-this.lt,e.set(r,o),this.tick(e)),this.lt=r}}get targetFPS(){return this._targetFPS}set targetFPS(t){this._targetFPS=t}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){F(this.tickHandlers,t)}tick(t){for(let e of this.tickHandlers)e(t)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};var vn=class extends gn{constructor(t){super(t)}start(){this.timer=setInterval(()=>this.onTick(performance.now()),this.targetFrameTime)}stop(){this.timer&&(clearInterval(this.timer),super.stop())}get targetFPS(){return super.targetFPS}set targetFPS(t){super.targetFPS=t,this.isRunning&&this.restart()}};var mo=class extends v{constructor(){super("activity");this.level=0}},bn=class extends ke{constructor(e){super(e,{fftSize:32,minDecibels:-70});this._level=0;this.maxLevel=0;this.activityEvt=new mo;this.timer=new vn(30);let o=new Uint8Array(this.frequencyBinCount);this.timer.addTickHandler(()=>{this.getByteFrequencyData(o),this._level=Math.max(...o),isFinite(this._level)&&(this.maxLevel=Math.max(this.maxLevel,this._level),this.maxLevel>0&&(this._level/=this.maxLevel)),this.activityEvt.level=this.level,this.dispatchEvent(this.activityEvt)})}get level(){return this._level}start(){this.timer.start()}stop(){this.timer.stop()}};var xi=/([^\/]+)\/(.+)/,ya=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/;var he=class{constructor(t,e,o){this._type=t;this._fullSubType=e;this._primaryExtension=null;this.depMessage=null;let r=new Map;this._parameters=r;let i=this._fullSubType.match(ya);this._tree=i[1],this._subType=i[2],this._suffix=i[3];let s=i[4];if(this._value=this._fullValue=this._type+"/",c(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,c(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),c(s)){let a=s.split(";").map(p=>p.trim()).filter(p=>p.length>0).map(p=>p.split("="));for(let[p,...l]of a){let d=l.join("=");r.set(p,d);let u=`; ${p}=${d}`;this._fullValue+=u,p!=="q"&&(this._value+=u)}}this._extensions=o||[],this._primaryExtension=this._extensions[0]||null}static parse(t){if(!t)return null;let e=t.match(xi);if(!e)return null;let o=e[1],r=e[2];return new he(o,r)}deprecate(t){return this.depMessage=t,this}check(){c(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(t){if(x(t))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let e=null,o=null;if(g(t)){let r=t.match(xi);if(!r)return!1;e=r[1],o=r[2]}else e=t.typeName,o=t._fullSubType;return this.typeName===e&&(this._fullSubType==="*"||this._fullSubType===o)}withParameter(t,e){let o=`${this._fullSubType}; ${t}=${e}`;return new he(this.typeName,o,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}addExtension(t){if(!t)throw new Error("File name is not defined");if(this.primaryExtension){let e=t.lastIndexOf(".");if(e>-1){let o=t.substring(e+1);this.extensions.indexOf(o)>-1&&(t=t.substring(0,e))}t=`${t}.${this.primaryExtension}`}return t}};function Va(n,t,...e){return new he(n,t,e)}function X(n){return Va.bind(null,n)}var uo=X("application");var qe=uo("javascript","js");var xo=uo("json","json");var fo=uo("wasm","wasm");var Ca=X("audio");var fi=Ca("mpeg","mp3","mp2","mp2a","mpga","m2a","m3a");var _o=X("text");var An=_o("css","css");var _i=_o("plain","txt","text","conf","def","list","log","in");var hi=_o("xml");function gi(n){return c(n)&&S(n.then)&&S(n.catch)&&S(n.finally)&&S(n.fetch)&&S(n.getSize)}var ho=class{constructor(t,e){this.path=t;this.type=e;this._result=null;this._error=null;this._started=!1;this._finished=!1;this.resolve=null;this.reject=null;this.promise=new Promise((o,r)=>{this.resolve=i=>{this._result=i,this._finished=!0,o(i)},this.reject=i=>{this._error=i,this._finished=!0,r(i)}})}get result(){if(c(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}async getSize(t){try{let{contentLength:e}=await t.head(this.path).accept(this.type).exec();return[this,e||1]}catch(e){return console.warn(e),[this,1]}}async fetch(t,e){try{let o=await this.getResult(t,e);this.resolve(o)}catch(o){this.reject(o)}}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};var go=class extends ho{constructor(e,o,r){let i;U(o)?r=o:i=o;super(e,i);this.useCache=!!r}getResult(e,o){return this.getRequest(e,o).then(rt)}getRequest(e,o){let r=e.get(this.path).useCache(this.useCache).progress(o);return this.getResponse(r)}};var Sn=class extends go{getResponse(t){return t.file(this.type)}};function vi(n,t,e){return new Map(n.map(o=>[t(o),e(o)]))}function Ue(n,t){return vi(n,t,le)}var wa="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function ge(n,t){if(n<0)throw new Error("Length must be greater than 0");x(t)&&(t=wa);let e="";for(let o=0;o<n;++o){let r=Math.floor(Math.random()*t.length);e+=t[r]}return e}var yn=class{constructor(t){this.task=new y(!1);this.element=ie(G("dialog"),oe("none"),gt("dialogname",t),this.container=ie(G("dialog-container"),this.titleElement=cr(G("title-bar"),t),this.contentArea=ie(G("dialog-content")),ie(G("dialog-controls"),this.confirmButton=Ee("Confirm",ce("confirm-button")),this.cancelButton=wt("Cancel",ce("cancel-button"))))),this.confirmButton.addEventListener("click",this.task.resolver(!0)),this.cancelButton.addEventListener("click",this.task.resolver(!1)),R(document.body,this)}get title(){return this._title}set title(t){or(this.titleElement,this._title=t)}async onShowing(){}onShown(){}async onConfirm(){}onCancel(){}async onClosing(){}onClosed(){}show(t){Ae(this,t)}get isOpen(){return Vt(this)}hide(){this.show(!1)}async toggle(){this.isOpen?this.hide():this.showDialog()}async showDialog(){return await this.onShowing(),this.show(!0),this.onShown(),this.task.restart(),await this.task?await this.onConfirm():this.onCancel(),await this.onClosing(),this.show(!1),this.onClosed(),this.task.result}};var mt=class extends j{constructor(...e){super();this.element=ie(G("input-range-with-number"),this.rangeInput=vr($(()=>{this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.dispatchEvent(new v("input"))}),...e),this.numberInput=gr($(()=>{this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber,this.rangeInput.dispatchEvent(new Event("input"))}))),this.numberInput.min=this.rangeInput.min,this.numberInput.max=this.rangeInput.max,this.numberInput.step=this.rangeInput.step,this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.numberInput.disabled=this.rangeInput.disabled,this.numberInput.placeholder=this.rangeInput.placeholder}get value(){return this.rangeInput.value}set value(e){this.rangeInput.value=this.numberInput.value=e}get valueAsNumber(){return this.rangeInput.valueAsNumber}set valueAsNumber(e){this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber=e}get disabled(){return this.rangeInput.disabled}set disabled(e){this.rangeInput.disabled=this.numberInput.disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}};var Z=class{constructor(t){this.items=new Map;this.defaultItems=new Array;if(c(t))for(let[e,o]of t)this.add(e,o)}add(t,...e){for(let o of e)if(x(t))this.defaultItems.push(o);else{let r=this.items.get(t);x(r)&&this.items.set(t,r=[]),r.push(o)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let t of this.defaultItems)yield t;for(let t of this.items.values())for(let e of t)yield e}has(t){return c(t)?this.items.has(t):this.defaultItems.length>0}get(t){return x(t)?this.defaultItems:this.items.get(t)||[]}count(t){if(x(t))return this.defaultItems.length;let e=this.get(t);return c(e)?e.length:0}get size(){let t=this.defaultItems.length;for(let e of this.items.values())t+=e.length;return t}delete(t){return x(t)?k(this.defaultItems).length>0:this.items.delete(t)}remove(t,e){if(x(t))F(this.defaultItems,e);else{let o=this.items.get(t);c(o)&&(F(o,e),o.length===0&&this.items.delete(t))}}clear(){this.items.clear(),k(this.defaultItems)}};var ut=class{constructor(t,...e){this.name=t;this.properties=e}};function vo(n,...t){return new ut(n,...t)}var bo="DefaultPropertyGroup"+ge(16),Ta=G("single-item");function bi(n){return n.flatMap(t=>Ea(t).flatMap(le))}function Ea(n){let t=bo,e=new Array;return n instanceof ut?(t=n.name,e.push(...n.properties.map(o=>Ai(t,o)))):e.push(Ai(t,n)),e}function Ai(n,t){let e=n===bo?null:gt("groupname",n);if(pe(t)){let[o,...r]=t,i=mr(o);for(let s of r)if(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement||s instanceof HTMLSelectElement){s.id.length===0&&(s.id=ge(10)),i.htmlFor=s.id;break}return[lr(e,i),Kn(e,...r)]}else return(g(t)||J(t)||U(t)||Dn(t))&&(t=dr(t)),[Kn(e,t)]}function Pa(n){return c(n)&&!Jn(n)&&!Nn(n)}var ve=class{constructor(t){this.element=t;this.groups=new Z;this.controls=new Array;this._disabled=!1;let e=[...t.children];for(;e.length>0;){let o=e.shift();Un(o)&&this.controls.push(o),o instanceof HTMLElement&&(this.checkGroup(o),e.push(...o.children))}}static find(){return Array.from(ve._find())}static*_find(){for(let t of tr(".properties"))yield new ve(t)}static create(...t){let e=t.filter(Pa),o=t.filter(Jn),r=t.filter(Nn),i=Go(r,"properties"),s=bi(e);return new ve(pr(ce(...i),...o,...r,...s))}append(...t){let e=bi(t);R(this.element,...e);for(let o of t){let r=o instanceof ut?o.properties:[o];for(let i of r)if(!g(i)){let[s,...a]=pe(i)?i:[null,i];for(let p of a)Un(p)&&this.controls.push(p)}}for(let o of e)this.checkGroup(o)}checkGroup(t){let e=re(t),o=e.dataset.groupname;o!==bo&&this.groups.add(o,t),e.parentElement===this.element&&e.tagName==="DD"&&(!e.previousElementSibling||e.previousElementSibling.tagName!=="DT")&&Ta.applyToElement(e)}get disabled(){return this._disabled}set disabled(t){if(t!==this.disabled){this._disabled=t,rr(this,t,"disabled");for(let e of this.controls)e.disabled=t}}get enabled(){return!this.disabled}set enabled(t){this.disabled=!t}setGroupVisible(t,e){let o=this.groups.get(t);if(o)for(let r of o)Ae(r,e)}getGroupVisible(t){let e=this.groups.get(t);if(e)for(let o of e)return Vt(o);return!1}};var Vn="micFields"+ge(8),Ao="camFields"+ge(8);function Si(n,t,e){Ct(n),R(n,Tt(Ce(""),"NONE"),...t.map(o=>Tt(qo(e&&o.deviceId===e.deviceId),Ce(o.deviceId),o.label)))}var Cn=class extends yn{constructor(e,o,r,i,s,a=!1){super("Configure devices");this.devices=o;this.audio=r;this.microphones=i;this.webcams=s;this.micLookup=null;this.camLookup=null;this.spkrLookup=null;this.spkrVolumeControl=null;this.speakers=null;this.cancelButton.style.display="none";let p=new Sn("/audio/test-clip.mp3",fi,!a),l=e.assets(p).then(()=>this.audio.createBasicClip("test-audio",p,.5));R(this.contentArea,Qo("2em"),this.properties=ve.create(vo(Ao,["Webcams",this.webcamSelector=Et($(async()=>{let d=this.webcamSelector.value,u=this.camLookup.get(d);await this.webcams.setDevice(u)}))]),vo(Vn,["Microphones",this.microphoneSelector=Et(oe("inline-block"),$(async()=>{let d=this.microphoneSelector.value,u=this.micLookup.get(d);await this.microphones.setDevice(u)}))],["Volume",this.micVolumeControl=new mt(Fn(0),jn(100),Gn(1),Ce(0),$(()=>{this.microphones.gain.setValueAtTime(this.micVolumeControl.valueAsNumber/100,0)}))],["Levels",this.micLevels=xr(oe("inline-block"))]))),Q&&(this.properties.append(["Speakers",this.speakers=Et($(async()=>{let d=this.speakers.value,u=this.spkrLookup.get(d);await this.audio.speakers.setAudioOutputDevice(u)}))]),this.audio.speakers.addEventListener("audiooutputchanged",d=>{this.speakers.value=d.device&&d.device.deviceId||""})),this.properties.append(["Volume",this.spkrVolumeControl=new mt(Fn(0),jn(100),Gn(1),Ce(0),$(()=>this.audio.destination.volume=this.spkrVolumeControl.valueAsNumber/100))],["",this.testSpkrButton=wt("Test",Uo("Test audio"),qn(Yo(.5)),Pe(async()=>{this.testSpkrButton.disabled=!0,await l,await this.audio.playClipThrough("test-audio"),this.testSpkrButton.disabled=!1}))],["Using headphones",this.useHeadphones=hr(zo(this.audio.useHeadphones),$(()=>{this.audio.useHeadphones=this.useHeadphones.checked,Ae(this.headphoneWarning,!this.audio.useHeadphones,"inline-block")}))],this.headphoneWarning=ie(G("alert alert-warning"),"\u{1F3A7}\u{1F399}\uFE0F This site has a voice chat feature. Voice chat is best experienced using headphones.")),this.activity=new bn(this.audio.context),this.activity.name="device-settings-dialog-activity",this.activity.addEventListener("activity",d=>{this.isOpen&&(this.micLevels.value=d.level)}),this.microphones.connect(this.activity),this.activity.start(),this.properties.setGroupVisible(Vn,!1),Object.seal(this)}get showWebcams(){return this.properties.getGroupVisible(Ao)}set showWebcams(e){this.properties.setGroupVisible(Ao,e)}get showMicrophones(){return this.properties.getGroupVisible(Vn)}set showMicrophones(e){this.properties.setGroupVisible(Vn,e)}async onShowing(){if(this.showWebcams||this.showMicrophones){await this.devices.init();let e=await this.devices.getDevices();if(this.showWebcams){let o=e.filter(r=>r.kind==="videoinput");this.camLookup=Ue(o,r=>r.deviceId),Si(this.webcamSelector,o,this.webcams.device)}if(this.showMicrophones){let o=e.filter(r=>r.kind==="audioinput");this.micLookup=Ue(o,r=>r.deviceId),Si(this.microphoneSelector,o,this.microphones.device),this.microphones.usingHeadphones=this.useHeadphones.checked,this.microphones.enabled=!0,this.micVolumeControl.valueAsNumber=this.microphones.gain.value*100}}if(Q){await this.audio.speakers.ready;let e=await this.audio.speakers.getAudioOutputDevices();this.spkrLookup=Ue(e,r=>r.deviceId),Ct(this.speakers),R(this.speakers,...e.map(r=>Tt(Ce(r.deviceId),r.label)));let o=await this.audio.speakers.getAudioOutputDevice();o||(o=await this.audio.speakers.getPreferredAudioOutput(),await this.audio.speakers.setAudioOutputDevice(o)),this.speakers.value=o&&o.deviceId||""}this.spkrVolumeControl.valueAsNumber=this.audio.destination.volume*100,this.useHeadphones.checked=this.audio.useHeadphones,Ae(this.headphoneWarning,!this.audio.useHeadphones,"inline-block"),await super.onShowing()}};var yi="calla:preferredVideoInputID",wn=class extends j{constructor(){super();this.element=_r(bt(!0));this._hasPermission=!1;this._device=null;this._enabled=!1;Object.seal(this)}get mediaType(){return"video"}get deviceKind(){return`${this.mediaType}input`}get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.onChange())}get hasPermission(){return this._hasPermission}get preferredDeviceID(){return localStorage.getItem(yi)}get device(){return this._device}checkDevices(e){if(!this.hasPermission){for(let o of e)if(o.kind===this.deviceKind&&o.deviceId.length>0&&o.label.length>0){this._hasPermission=!0;break}}}async setDevice(e){if(c(e)&&e.kind!==this.deviceKind)throw new Error(`Device is not an vide input device. Was: ${e.kind}. Label: ${e.label}`);let o=this.device&&this.device.deviceId||null,r=e&&e.deviceId||null;r!==o&&(this._device=e,localStorage.setItem(yi,r),await this.onChange())}async onChange(){this.dispatchEvent(new We);let e=this.inStream;this.device&&this.enabled?this.inStream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.device.deviceId,autoGainControl:!0,height:640,noiseSuppression:!0}}):this.inStream=null,this.inStream!==e&&this.dispatchEvent(new Je(e,this.outStream))}get inStream(){return this.element.srcObject}set inStream(e){e!==this.inStream&&(this.inStream&&this.element.pause(),this.element.srcObject=e,this.inStream&&this.element.play())}get outStream(){return this.inStream}stop(){this.inStream=null}};var xt=class extends nt{constructor(e,o){super();this.i=e;this.prog=o}report(e,o,r,i){super.report(e,o,r,i),this.prog.update(this.i,e,o,r)}};var Tn=class{constructor(t){this.prog=t;this.weightTotal=0;this.subProgressCallbacks=new Array;this.subProgressWeights=new Array;this.subProgressValues=new Array;this.start=performance.now();for(let e=0;e<this.subProgressWeights.length;++e)this.subProgressValues[e]=0,this.subProgressCallbacks[e]=new xt(e,this)}addSubProgress(t){t=t||1,this.weightTotal+=t,this.subProgressWeights.push(t),this.subProgressValues.push(0);let e=new xt(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(e),e}update(t,e,o,r){if(this.prog){this.subProgressValues[t]=e/o;let i=0;for(let l=0;l<this.subProgressWeights.length;++l)i+=this.subProgressValues[l]*this.subProgressWeights[l];let s=performance.now(),a=s-this.start,p=this.start-s+a*this.weightTotal/i;this.prog.report(i,this.weightTotal,r,p)}}};function yo(n,t){return new So(t,n).subProgressCallbacks}function Vi(n,t){let e=new Array(t);for(let o=0;o<t;++o)e[o]=1;return yo(n,e)}var So=class extends Tn{constructor(t,e){super(e);for(let o of t)this.addSubProgress(o)}};async function Ci(n,t){let e=new Array(t.length),o=new Array(t.length);for(let s=0;s<t.length;++s){let a=t[s];e[s]=a[0],o[s]=a[1]}let r=yo(n,e),i=new Array(t.length);for(let s=0;s<t.length;++s)i[s]=o[s](r[s]);return await Promise.all(i)}var Yf="HTMLCanvasElement"in globalThis,Qf="HTMLImageElement"in globalThis,Vo=!1,Ke=!Vo&&"OffscreenCanvas"in globalThis,Zf=!Vo&&"createImageBitmap"in globalThis;function Ia(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var e_=Ke&&Ia();function Ma(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var t_=Ke&&Ma();function wi(n,t){return new OffscreenCanvas(n,t)}function Ti(n,t){return ar(Ko(n),Ho(t))}function Co(n,t){let e=n.getContext("2d");if(x(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function Ei(n){let t=new y,e=setInterval(()=>{n()&&(clearInterval(e),t.resolve())},100);return t}async function V(n,t){let{status:e,requestPath:o,responsePath:r,content:i,contentType:s,contentLength:a,fileName:p,headers:l,date:d}=n;return{status:e,requestPath:o,responsePath:r,content:c(t)?await t(i):void 0,contentType:s,contentLength:a,fileName:p,headers:l,date:d}}var wo=null;function Pi(n){return wo===null&&(wo=new Audio),wo.canPlayType(n)!==""}var En=class{constructor(t,e,o,r=!1){this.fetcher=t;this.method=e;this.path=o;this.useBLOBs=r;this.prog=null;this.request={method:e,path:this.path.href,body:null,headers:null,timeout:null,withCredentials:!1,useCache:!1,retryCount:3}}retries(t){return this.request.retryCount=t,this}query(t,e){return this.path.searchParams.set(t,e),this.request.path=this.path.href,this}header(t,e){return this.request.headers===null&&(this.request.headers=new Map),this.request.headers.set(t.toLowerCase(),e),this}headers(t){for(let[e,o]of t.entries())this.header(e,o);return this}timeout(t){return this.request.timeout=t,this}progress(t){return this.prog=t,this}body(t,e){if(c(t)){let o=new Set,r=new Array;r.push(t);let i=!1;for(;!i&&r.length>0;){let s=r.shift();if(s&&!o.has(s))if(o.add(s),s instanceof Blob){i=!0;break}else g(s)||r.push(...Object.values(s))}if(i){let s=new FormData,a=new Map,p=new Set;for(let[l,d]of Object.entries(t))if(d instanceof Blob){let u=l+".name",m=t[u];g(m)&&(a.set(d,m),p.add(u))}for(let[l,d]of Object.entries(t))p.has(l)||(d instanceof Blob?s.append(l,d,a.get(d)):g(d)?s.append(l,d):c(d)&&S(d.toString)?s.append(l,d.toString()):console.warn("Can't serialize value to formdata",l,d));t=s,e=void 0}this.request.body=t,this.content(e)}return this}withCredentials(){return this.request.withCredentials=!0,this}useCache(t=!0){return this.request.useCache=t,this}media(t,e){c(e)&&(g(e)||(e=e.value),this.header(t,e))}content(t){this.media("content-type",t)}accept(t){return this.media("accept",t),this}blob(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBlob(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBlob(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);C(this.method)}buffer(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBuffer(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBuffer(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);C(this.method)}async file(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return await this.fetcher.sendObjectGetFile(this.request,this.prog);if(this.method==="GET"){if(this.useBLOBs)return await this.fetcher.sendNothingGetFile(this.request,this.prog);{let e=await this.fetcher.sendNothingGetNothing(this.request);return V(e,()=>this.request.path)}}else{if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);C(this.method)}}text(t){if(this.accept(t||_i),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetText(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetText(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);C(this.method)}object(t){if(this.accept(t||xo),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetObject(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetObject(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);C(this.method)}xml(t){if(this.accept(t||hi),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetXml(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetXml(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);C(this.method)}imageBitmap(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetImageBitmap(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetImageBitmap(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);C(this.method)}exec(){if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetNothing(this.request,this.prog);if(this.method==="GET")throw new te("GET requests should expect a response type");if(this.method==="HEAD"||this.method==="OPTIONS")return this.fetcher.sendNothingGetNothing(this.request);C(this.method)}async audioBlob(t){if(c(t)&&(g(t)||(t=t.value),!Pi(t)))throw new Error(`Probably can't play file of type "${t}" at path: ${this.request.path}`);let e=await this.blob(t);if(Pi(e.contentType))return e;throw new Error(`Cannot play file of type "${e.contentType}" at path: ${this.request.path}`)}async audioBuffer(t,e){return V(await this.audioBlob(e),async o=>await t.decodeAudioData(await o.arrayBuffer()))}async htmlElement(t,e,o){let r=await this.file(o),i=O(t,e,"error");return t instanceof HTMLLinkElement?t.href=r.content:t.src=r.content,await i,await V(r,()=>t)}image(t){return this.htmlElement($n(),"load",t)}async htmlCanvas(t){let e=Ti(1,1);if(this.method==="GET")if(Ke){this.accept(t);let o=await this.fetcher.drawImageToCanvas(this.request,e.transferControlToOffscreen(),this.prog);return await V(o,()=>e)}else{let o=await this.image(t);return await V(o,r=>(e.width=r.width,e.height=r.height,Co(e,r),w(r),e))}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);C(this.method)}}canvas(t){return Ke?this.offscreenCanvas(t):this.htmlCanvas(t)}async offscreenCanvas(t){if(!Ke)throw new Error("This system does not support OffscreenCanvas");if(this.method==="GET"){let e=await this.image(t);return await V(e,o=>{let r=wi(o.width,o.height);return Co(r,o),w(o),r})}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);C(this.method)}}async style(){let t=ur(de(An),Jo("stylesheet"));document.head.append(t);let e=await this.htmlElement(t,"load",An);return V(e)}async getScript(){let t=fr(de(qe));document.head.append(t);let e=await this.htmlElement(t,"load",qe);return V(e)}async script(t){let e=null,o=this.request.path;if(!t)e=await this.getScript();else if(!t()){let r=Ei(t);e=await this.getScript(),await r}return this.prog&&this.prog.end(o),e}async module(){let t=this.request.path,e=await this.file(qe),o=await import(e.content);return this.prog&&this.prog.end(t),V(e,()=>o)}async wasm(t){let e=await this.buffer(fo);if(!fo.matches(e.contentType))throw new Error(`Server did not respond with WASM file. Was: ${e.contentType}`);let o=await WebAssembly.compile(e.content),r=await WebAssembly.instantiate(o,t);return V(e,()=>r.exports)}async worker(t="module"){let e=this.request.path,o=await this.file(qe);this.prog=null,this.request.timeout=null;let r=new Worker(o.content,{type:t});return this.prog&&this.prog.end(e),V(o,()=>r)}};var Pn=class{constructor(t,e=!1){this.service=t;this.useBLOBs=e;{let o=nr("input[name=__RequestVerificationToken]");o&&this.service.setRequestVerificationToken(o.value)}}clearCache(){return this.service.clearCache()}evict(t,e){return this.service.evict(new URL(t,e||location.href).href)}request(t,e,o){return new En(this.service,t,new URL(e,o||location.href),this.useBLOBs)}head(t,e){return this.request("HEAD",t,e)}options(t,e){return this.request("OPTIONS",t,e)}get(t,e){return this.request("GET",t,e)}post(t,e){return this.request("POST",t,e)}put(t,e){return this.request("PUT",t,e)}patch(t,e){return this.request("PATCH",t,e)}delete(t,e){return this.request("DELETE",t,e)}async assets(t,e,...o){x(o)&&(o=[]),o.unshift(e);let r;gi(t)?o.unshift(t):c(t)&&(r=t),o=o.filter(c);let i=await Promise.all(o.map(a=>a.getSize(this))),s=new Map(i);await Ci(r,o.map(a=>[s.get(a),p=>a.fetch(this,p)]))}};var In=class{constructor(t){this.impl=t;this.defaultPostHeaders=new Map}setRequestVerificationToken(t){this.defaultPostHeaders.set("RequestVerificationToken",t)}clearCache(){return this.impl.clearCache()}evict(t){return this.impl.evict(t)}sendNothingGetNothing(t){return this.impl.sendNothingGetNothing(t)}sendNothingGetBlob(t,e){return this.impl.sendNothingGetSomething("blob",t,e)}sendObjectGetBlob(t,e){return this.impl.sendSomethingGetSomething("blob",t,this.defaultPostHeaders,e)}sendNothingGetBuffer(t,e){return this.impl.sendNothingGetSomething("arraybuffer",t,e)}sendObjectGetBuffer(t,e){return this.impl.sendSomethingGetSomething("arraybuffer",t,this.defaultPostHeaders,e)}sendNothingGetText(t,e){return this.impl.sendNothingGetSomething("text",t,e)}sendObjectGetText(t,e){return this.impl.sendSomethingGetSomething("text",t,this.defaultPostHeaders,e)}sendNothingGetObject(t,e){return this.impl.sendNothingGetSomething("json",t,e)}sendObjectGetObject(t,e){return this.impl.sendSomethingGetSomething("json",t,this.defaultPostHeaders,e)}sendObjectGetNothing(t,e){return this.impl.sendSomethingGetSomething("",t,this.defaultPostHeaders,e)}drawImageToCanvas(t,e,o){return this.impl.drawImageToCanvas(t,e,o)}async sendNothingGetFile(t,e){return V(await this.sendNothingGetBlob(t,e),URL.createObjectURL)}async sendObjectGetFile(t,e){return V(await this.sendObjectGetBlob(t,e),URL.createObjectURL)}async sendNothingGetXml(t,e){return V(await this.impl.sendNothingGetSomething("document",t,e),o=>o.documentElement)}async sendObjectGetXml(t,e){return V(await this.impl.sendSomethingGetSomething("document",t,this.defaultPostHeaders,e),o=>o.documentElement)}async sendNothingGetImageBitmap(t,e){return V(await this.sendNothingGetBlob(t,e),createImageBitmap)}async sendObjectGetImageBitmap(t,e){return V(await this.sendObjectGetBlob(t,e),createImageBitmap)}};var Se=class{constructor(t){this.items=new Map;if(c(t))for(let[e,o,r]of t)this.add(e,o,r)}add(t,e,o){let r=this.items.get(t);return x(r)&&this.items.set(t,r=new Map),r.set(e,o),this}*entries(){for(let[t,e]of this.items)for(let[o,r]of e)yield[t,o,r]}keys(t){return x(t)?this.items.keys():this.items.get(t).keys()}*values(){for(let t of this.items.values())for(let e of t.values())yield e}has(t,e){return this.items.has(t)&&(x(e)||this.items.get(t).has(e))}get(t,e){return x(e)?this.items.get(t):this.items.has(t)?this.items.get(t).get(e):null}count(t){return this.items.has(t)?this.items.get(t).size:null}get size(){let t=0;for(let e of this.items.values())t+=e.size;return t}delete(t,e){if(x(e))return this.items.delete(t);if(this.items.has(t)){let o=this.items.get(t),r=o.delete(e);return o.size===0&&this.items.delete(t),r}else return!1}clear(){this.items.clear()}};var $e=class{constructor(t){this.db=t}static delete(t){let e=indexedDB.deleteDatabase(t),o=O(e,"success","error","blocked");return ne(o)}static async open(t,...e){let o=Ue(e,E=>E.name),r=new Se(e.filter(E=>c(E.indexes)).flatMap(E=>E.indexes.map(W=>[E.name,W.name,W]))),i=new Array,s=new Array,a=new Array,p=new Z,l=new Z,d=null,u=indexedDB.open(t);if(await ne(O(u,"success","error","blocked"))){let E=u.result;d=E.version;let W=new Array;for(let B of E.objectStoreNames)o.has(B)||s.push(B);for(let B of o.keys())E.objectStoreNames.contains(B)?W.push(B):i.push(B);if(W.length>0){let B=E.transaction(W),N=O(B,"complete","error","abort"),se=ne(N);for(let A of W){let be=B.objectStore(A),Do=o.get(A);c(Do.options)&&be.keyPath!==Do.options.keyPath&&(s.push(A),i.push(A));for(let ee of be.indexNames)r.has(A,ee)||(a.indexOf(A)===-1&&a.push(A),l.add(A,ee));if(r.has(A))for(let ee of r.get(A).keys())if(!be.indexNames.contains(ee))a.indexOf(A)===-1&&a.push(A),p.add(A,ee);else{let Qe=r.get(A,ee),Ze=be.index(ee);(g(Qe.keyPath)!==g(Ze.keyPath)||g(Qe.keyPath)&&g(Ze.keyPath)&&Qe.keyPath!==Ze.keyPath||pe(Qe.keyPath)&&pe(Ze.keyPath)&&No(Qe.keyPath,Ze.keyPath))&&(a.indexOf(A)===-1&&a.push(A),l.add(A,ee),p.add(A,ee))}}B.commit(),await se}w(E)}else{d=0,i.push(...o.keys());for(let E of e)if(c(E.indexes))for(let W of E.indexes)p.add(E.name,W.name)}(i.length>0||s.length>0||p.size>0||l.size>0)&&++d;let m=new y,_=c(d)?indexedDB.open(t,d):indexedDB.open(t),T=O(_,"success","error","blocked"),D=ne(m),H=ne(T),Lo=m.resolver(!1);if(_.addEventListener("success",Lo),_.addEventListener("upgradeneeded",()=>{let E=O(_.transaction,"complete","error","abort"),W=_.result;for(let N of s)W.deleteObjectStore(N);let B=new Map;for(let N of i){let se=o.get(N),A=W.createObjectStore(N,se.options);B.set(N,A)}for(let N of a){let se=_.transaction.objectStore(N);B.set(N,se)}for(let[N,se]of B){for(let A of l.get(N))se.deleteIndex(A);for(let A of p.get(N)){let be=r.get(N,A);se.createIndex(A,be.keyPath,be.options)}}ne(E).then(m.resolve).catch(m.reject).finally(()=>_.removeEventListener("success",Lo))}),!await D)throw m.error;if(!await H)throw T.error;return new $e(_.result)}dispose(){w(this.db)}get name(){return this.db.name}get version(){return this.db.version}get storeNames(){return Array.from(this.db.objectStoreNames)}getStore(t){return new To(this.db,t)}},To=class{constructor(t,e){this.db=t;this.storeName=e}async request(t,e){let o=this.db.transaction(this.storeName,e),r=O(o,"complete","error"),i=o.objectStore(this.storeName),s=t(i),a=O(s,"success","error");if(!await ne(a))throw o.abort(),a.error;if(o.commit(),!await ne(r))throw r.error;return s.result}add(t,e){return this.request(o=>o.add(t,e),"readwrite")}clear(){return this.request(t=>t.clear(),"readwrite")}getCount(t){return this.request(e=>e.count(t),"readonly")}async has(t){return await this.getCount(t)>0}delete(t){return this.request(e=>e.delete(t),"readwrite")}get(t){return this.request(e=>e.get(t),"readonly")}getAll(){return this.request(t=>t.getAll(),"readonly")}getAllKeys(){return this.request(t=>t.getAllKeys(),"readonly")}getKey(t){return this.request(e=>e.getKey(t),"readonly")}openCursor(t,e){return this.request(o=>o.openCursor(t,e),"readonly")}openKeyCursor(t,e){return this.request(o=>o.openKeyCursor(t,e),"readonly")}put(t,e){return this.request(o=>o.put(t,e),"readwrite")}};function Ii(n,...t){for(let e of t)if(c(e))for(let[o,r]of e)n.set(o,r);return n}var Eo=class extends y{constructor(e){super(!1);this.milliseconds=e;this._timer=null}start(){super.start(),this._timer=setTimeout(()=>{this._timer=null,this.resolve()},this.milliseconds)}reset(){super.reset(),c(this._timer)&&(clearTimeout(this._timer),this._timer=null)}};function Mi(n){let t=new Eo(n);return t.start(),t}function Mn(n,t){return async()=>{let e=null,o=500;for(let r=0;r<=n;++r)try{return r>0&&(await Mi(o),o*=2),await t()}catch(i){e=i}throw e}}function ka(n){return g(n)||Xo(n)||n instanceof Blob||n instanceof FormData||Bo(n)||"Document"in globalThis&&n instanceof Document}function kn(n,t,e,o,r,i){let s=!i;i&&i.then(()=>s=!0);let a=!1,p=r,l=new y;e.addEventListener("loadstart",()=>{s&&!a&&o&&o.start(n)}),e.addEventListener("progress",u=>{if(s&&!a){let m=u;o&&o.report(m.loaded,Math.max(m.loaded,m.total),n),m.loaded===m.total&&(p=!0,a&&l.resolve())}}),e.addEventListener("load",()=>{s&&!a&&(o&&o.end(n),a=!0,p&&l.resolve())});let d=u=>()=>{s&&l.reject(`${u} (${t.status})`)};return e.addEventListener("error",d("error")),e.addEventListener("abort",d("abort")),e.addEventListener("timeout",d("timeout")),l}function Po(n,t,e,o,r,i){if(n.open(t,e),n.responseType="blob",n.timeout=o,r)for(let[s,a]of r)n.setRequestHeader(s,a);c(i)?n.send(i):n.send()}function Rn(n,t,e){if(!n.has(t))return null;let o=n.get(t);try{let r=e(o);return n.delete(t),r}catch(r){console.warn(t,r)}return null}var Ra=/filename=\"(.+)\"(;|$)/,La="Juniper:Fetcher:Cache",Ln=class{constructor(){this.cache=null;this.store=null;this.tasks=new Se;this.cacheReady=this.openCache()}async drawImageToCanvas(t,e,o){let r=await this.sendNothingGetSomething("blob",t,o),i=r.content;return Vr(await createImageBitmap(i,{imageOrientation:"from-image"}),s=>(e.width=s.width,e.height=s.height,e.getContext("2d").drawImage(s,0,0),V(r)))}async openCache(){let t={keyPath:"requestPath"};this.cache=await $e.open(La,{name:"files",options:t}),this.store=await this.cache.getStore("files")}async clearCache(){await this.cacheReady,await this.store.clear()}async evict(t){await this.cacheReady,this.store.has(t)&&await this.store.delete(t)}async readResponseHeaders(t,e){let o=e.getAllResponseHeaders().split(/[\r\n]+/).map(m=>m.trim()).filter(m=>m.length>0).map(m=>{let _=m.split(": "),T=_.shift().toLowerCase(),D=_.join(": ");return[T,D]}),r=new Z(o),i=Array.from(r.keys()).map(m=>[m,r.get(m).join(", ")]),s=new Map(i),a=Rn(s,"content-type",le),p=Rn(s,"content-length",parseFloat),l=Rn(s,"date",m=>new Date(m)),d=Rn(s,"content-disposition",m=>{if(c(m)){let _=m.match(Ra);if(c(_))return _[1]}return null});return{status:e.status,requestPath:t,responsePath:e.responseURL,content:void 0,contentType:a,contentLength:p,fileName:d,date:l,headers:s}}async readResponse(t,e){let{responsePath:o,status:r,contentType:i,contentLength:s,fileName:a,date:p,headers:l}=await this.readResponseHeaders(t,e),d={requestPath:t,responsePath:o,status:r,contentType:i,contentLength:s,fileName:a,date:p,headers:l,content:e.response};return c(d.content)&&(d.contentType=d.contentType||d.content.type,d.contentLength=d.contentLength||d.content.size),d}async decodeContent(t,e){return V(e,async o=>{if(t==="")return null;if(x(e.contentType)){let r=Array.from(e.headers.entries()).map(i=>i.join(": ")).join(`
  `);throw new Error(`No content type found in headers: 
  `+r)}else{if(t==="blob")return o;if(t==="arraybuffer")return await o.arrayBuffer();if(t==="json"){let r=await o.text();return r.length>0?JSON.parse(r):null}else if(t==="document"){let r=new DOMParser;if(e.contentType==="application/xhtml+xml"||e.contentType==="text/html"||e.contentType==="application/xml"||e.contentType==="image/svg+xml"||e.contentType==="text/xml")return r.parseFromString(await o.text(),e.contentType);throw new Error("Couldn't parse document")}else{if(t==="text")return await o.text();C(t)}}})}async withCachedTask(t,e){return t.method!=="GET"&&t.method!=="HEAD"&&t.method!=="OPTIONS"?await e():(this.tasks.has(t.method,t.path)||this.tasks.add(t.method,t.path,e().finally(()=>this.tasks.delete(t.method,t.path))),this.tasks.get(t.method,t.path))}sendNothingGetNothing(t){return this.withCachedTask(t,Mn(t.retryCount,async()=>{let e=new XMLHttpRequest,o=kn(`requesting: ${t.path}`,e,e,null,!0);return Po(e,t.method,t.path,t.timeout,t.headers),await o,await this.readResponseHeaders(t.path,e)}))}sendNothingGetSomething(t,e,o){return this.withCachedTask(e,Mn(e.retryCount,async()=>{let r=null,i=e.useCache&&e.method==="GET";i&&(c(o)&&o.start(),await this.cacheReady,r=await this.store.get(e.path));let s=x(r);if(s){let p=new XMLHttpRequest,l=kn(`requesting: ${e.path}`,p,p,o,!0);Po(p,e.method,e.path,e.timeout,e.headers),await l,r=await this.readResponse(e.path,p),i&&await this.store.add(r)}let a=await this.decodeContent(t,r);return s&&c(o)&&o.end(),a}))}sendSomethingGetSomething(t,e,o,r){let i=null,s=Ii(new Map,o,e.headers);if(e.body instanceof FormData&&c(s)){let m=new Array;for(let _ of s.keys())_.toLowerCase()==="content-type"&&m.push(_);for(let _ of m)s.delete(_)}ka(e.body)&&!g(e.body)?i=e.body:c(e.body)&&(i=JSON.stringify(e.body));let a=c(i),p=Vi(r,a?2:1),[l,d]=p,u=async()=>{let m=new XMLHttpRequest,_=a?kn("uploading",m,m.upload,l,!1):Promise.resolve(),T=kn("saving",m,m,d,!0,_);Po(m,e.method,e.path,e.timeout,s,i),await _,await T;let D=await this.readResponse(e.path,m);return await this.decodeContent(t,D)};return Mn(e.retryCount,u)()}};var ki=new URL(globalThis.location.href),Ye=ki.searchParams.has("DEBUG")&&!ki.searchParams.has("RELEASE");function Ri(n,t){let e=globalThis,o=e[n];if(x(o)){if(x(t))throw new Error(`No value ${n} found`);o=t(),e[n]=o}return o}var Fh=Ri("juniper::loadedFonts",()=>[]);var Li="3.7.24";var ag=Ye?ge(10):Li;var Oa=50,Xa=12,pg=Oa*Xa;var Di={fontFamily:"Lato",fontSize:20};var lg=yt(30,67,136),cg=yt(78,77,77),Oi={fontFamily:Di.fontFamily,fontSize:Di.fontSize,textFillColor:"white"},dg=Object.assign({},Oi,{bgFillColor:yt(0,120,215),bgStrokeColor:"black",bgStrokeSize:.02,padding:{top:.025,left:.05,bottom:.025,right:.05},minHeight:.2,maxHeight:.2,scale:300}),mg=Object.assign({},Oi,{textStrokeColor:"black",textStrokeSize:.01,minHeight:.25,maxHeight:.25});function Xi(n=!0){let t=new In(new Ln);return new Pn(t,!Ye)}var Bi=Xi(!0),Mo=new xn(Bi,"none"),ko=new _n(Mo.context),Ro=new wn,Ba=new fn(ko,Ro),Io=new Cn(Bi,Ba,Mo,ko,Ro,Ye);Io.showMicrophones=ko.enabled=Io.showWebcams=Ro.enabled=!0;di("main",Mo).then(async()=>{R("main",Ee("Show dialog",Pe(()=>Io.showDialog())))});
