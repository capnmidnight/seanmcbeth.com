var Z1=Object.create;var Pu=Object.defineProperty;var eF=Object.getOwnPropertyDescriptor;var tF=Object.getOwnPropertyNames;var nF=Object.getPrototypeOf,oF=Object.prototype.hasOwnProperty;var rF=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Vu=(n,e)=>{for(var t in e)Pu(n,t,{get:e[t],enumerable:!0})},iF=(n,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of tF(e))!oF.call(n,r)&&r!==t&&Pu(n,r,{get:()=>e[r],enumerable:!(o=eF(e,r))||o.enumerable});return n};var sF=(n,e,t)=>(t=n!=null?Z1(nF(n)):{},iF(e||!n||!n.__esModule?Pu(t,"default",{value:n,enumerable:!0}):t,n));var gw=rF((Fd,Ad)=>{(function(n,e){typeof Fd=="object"&&typeof Ad<"u"?Ad.exports=e():typeof define=="function"&&define.amd?define(e):n.CardboardVRDisplay=e()})(Fd,function(){"use strict";var n=function(){function l(d){this.value=d}function u(d){var h,f;function F(M,v){return new Promise(function(S,D){var O={key:M,arg:v,resolve:S,reject:D,next:null};f?f=f.next=O:(h=f=O,A(M,v))})}function A(M,v){try{var S=d[M](v),D=S.value;D instanceof l?Promise.resolve(D.value).then(function(O){A("next",O)},function(O){A("throw",O)}):E(S.done?"return":"normal",S.value)}catch(O){E("throw",O)}}function E(M,v){switch(M){case"return":h.resolve({value:v,done:!0});break;case"throw":h.reject(v);break;default:h.resolve({value:v,done:!1});break}h=h.next,h?A(h.key,h.arg):f=null}this._invoke=F,typeof d.return!="function"&&(this.return=void 0)}return typeof Symbol=="function"&&Symbol.asyncIterator&&(u.prototype[Symbol.asyncIterator]=function(){return this}),u.prototype.next=function(d){return this._invoke("next",d)},u.prototype.throw=function(d){return this._invoke("throw",d)},u.prototype.return=function(d){return this._invoke("return",d)},{wrap:function(d){return function(){return new u(d.apply(this,arguments))}},await:function(d){return new l(d)}}}(),e=function(l,u){if(!(l instanceof u))throw new TypeError("Cannot call a class as a function")},t=function(){function l(u,d){for(var h=0;h<d.length;h++){var f=d[h];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(u,f.key,f)}}return function(u,d,h){return d&&l(u.prototype,d),h&&l(u,h),u}}(),o=function(){function l(u,d){var h=[],f=!0,F=!1,A=void 0;try{for(var E=u[Symbol.iterator](),M;!(f=(M=E.next()).done)&&(h.push(M.value),!(d&&h.length===d));f=!0);}catch(v){F=!0,A=v}finally{try{!f&&E.return&&E.return()}finally{if(F)throw A}}return h}return function(u,d){if(Array.isArray(u))return u;if(Symbol.iterator in Object(u))return l(u,d);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=.001,i=1,s=function(u,d){return"data:"+u+","+encodeURIComponent(d)},a=function(u,d,h){return u+(d-u)*h},c=function(){var l=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return l}}(),p=function(){var l=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return l}}(),m=function(){var l=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return l}}(),x=function(){var l=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return l}}(),w=function(){var l=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),u=l?parseInt(l[1],10):null;return function(){return u}}(),_=function(){var l=!1;return l=c()&&m()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return l}}(),T=function(){var l=!1;if(w()===65){var u=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(u){var d=u[1].split("."),h=o(d,4),f=h[0],F=h[1],A=h[2],E=h[3];l=parseInt(A,10)===3325&&parseInt(E,10)<148}}return function(){return l}}(),y=function(){var l=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return l}}(),b=function(){var u=window.orientation==90||window.orientation==-90;return y()?!u:u},I=function(u){return!(isNaN(u)||u<=r||u>i)},V=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},P=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},C=function(u){if(p())return!1;if(u.requestFullscreen)u.requestFullscreen();else if(u.webkitRequestFullscreen)u.webkitRequestFullscreen();else if(u.mozRequestFullScreen)u.mozRequestFullScreen();else if(u.msRequestFullscreen)u.msRequestFullscreen();else return!1;return!0},H=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},B=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},R=function(u,d,h,f){var F=u.createShader(u.VERTEX_SHADER);u.shaderSource(F,d),u.compileShader(F);var A=u.createShader(u.FRAGMENT_SHADER);u.shaderSource(A,h),u.compileShader(A);var E=u.createProgram();u.attachShader(E,F),u.attachShader(E,A);for(var M in f)u.bindAttribLocation(E,f[M],M);return u.linkProgram(E),u.deleteShader(F),u.deleteShader(A),E},q=function(u,d){for(var h={},f=u.getProgramParameter(d,u.ACTIVE_UNIFORMS),F="",A=0;A<f;A++){var E=u.getActiveUniform(d,A);F=E.name.replace("[0]",""),h[F]=u.getUniformLocation(d,F)}return h},Y=function(u,d,h,f,F,A,E){var M=1/(d-h),v=1/(f-F),S=1/(A-E);return u[0]=-2*M,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*v,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*S,u[11]=0,u[12]=(d+h)*M,u[13]=(F+f)*v,u[14]=(E+A)*S,u[15]=1,u},K=function(){var u=!1;return function(d){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(d)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(d.substr(0,4)))&&(u=!0)}(navigator.userAgent||navigator.vendor||window.opera),u},ee=function(u,d){for(var h in d)d.hasOwnProperty(h)&&(u[h]=d[h]);return u},me=function(u){if(c()){var d=u.style.width,h=u.style.height;u.style.width=parseInt(d)+1+"px",u.style.height=parseInt(h)+"px",setTimeout(function(){u.style.width=d,u.style.height=h},100)}window.canvas=u},Me=function(){var l=Math.PI/180,u=Math.PI*.25;function d(v,S,D,O){var U=Math.tan(S?S.upDegrees*l:u),z=Math.tan(S?S.downDegrees*l:u),ne=Math.tan(S?S.leftDegrees*l:u),Q=Math.tan(S?S.rightDegrees*l:u),j=2/(ne+Q),Fe=2/(U+z);return v[0]=j,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=Fe,v[6]=0,v[7]=0,v[8]=-((ne-Q)*j*.5),v[9]=(U-z)*Fe*.5,v[10]=O/(D-O),v[11]=-1,v[12]=0,v[13]=0,v[14]=O*D/(D-O),v[15]=0,v}function h(v,S,D){var O=S[0],U=S[1],z=S[2],ne=S[3],Q=O+O,j=U+U,Fe=z+z,Ie=O*Q,Ye=O*j,Ee=O*Fe,st=U*j,kt=U*Fe,Mt=z*Fe,bt=ne*Q,Et=ne*j,In=ne*Fe;return v[0]=1-(st+Mt),v[1]=Ye+In,v[2]=Ee-Et,v[3]=0,v[4]=Ye-In,v[5]=1-(Ie+Mt),v[6]=kt+bt,v[7]=0,v[8]=Ee+Et,v[9]=kt-bt,v[10]=1-(Ie+st),v[11]=0,v[12]=D[0],v[13]=D[1],v[14]=D[2],v[15]=1,v}function f(v,S,D){var O=D[0],U=D[1],z=D[2],ne,Q,j,Fe,Ie,Ye,Ee,st,kt,Mt,bt,Et;return S===v?(v[12]=S[0]*O+S[4]*U+S[8]*z+S[12],v[13]=S[1]*O+S[5]*U+S[9]*z+S[13],v[14]=S[2]*O+S[6]*U+S[10]*z+S[14],v[15]=S[3]*O+S[7]*U+S[11]*z+S[15]):(ne=S[0],Q=S[1],j=S[2],Fe=S[3],Ie=S[4],Ye=S[5],Ee=S[6],st=S[7],kt=S[8],Mt=S[9],bt=S[10],Et=S[11],v[0]=ne,v[1]=Q,v[2]=j,v[3]=Fe,v[4]=Ie,v[5]=Ye,v[6]=Ee,v[7]=st,v[8]=kt,v[9]=Mt,v[10]=bt,v[11]=Et,v[12]=ne*O+Ie*U+kt*z+S[12],v[13]=Q*O+Ye*U+Mt*z+S[13],v[14]=j*O+Ee*U+bt*z+S[14],v[15]=Fe*O+st*U+Et*z+S[15]),v}function F(v,S){var D=S[0],O=S[1],U=S[2],z=S[3],ne=S[4],Q=S[5],j=S[6],Fe=S[7],Ie=S[8],Ye=S[9],Ee=S[10],st=S[11],kt=S[12],Mt=S[13],bt=S[14],Et=S[15],In=D*Q-O*ne,Si=D*j-U*ne,Ti=D*Fe-z*ne,ki=O*j-U*Q,Mi=O*Fe-z*Q,bi=U*Fe-z*j,Ei=Ie*Mt-Ye*kt,yi=Ie*bt-Ee*kt,Di=Ie*Et-st*kt,Ci=Ye*bt-Ee*Mt,Bi=Ye*Et-st*Mt,Li=Ee*Et-st*bt,Xe=In*Li-Si*Bi+Ti*Ci+ki*Di-Mi*yi+bi*Ei;return Xe?(Xe=1/Xe,v[0]=(Q*Li-j*Bi+Fe*Ci)*Xe,v[1]=(U*Bi-O*Li-z*Ci)*Xe,v[2]=(Mt*bi-bt*Mi+Et*ki)*Xe,v[3]=(Ee*Mi-Ye*bi-st*ki)*Xe,v[4]=(j*Di-ne*Li-Fe*yi)*Xe,v[5]=(D*Li-U*Di+z*yi)*Xe,v[6]=(bt*Ti-kt*bi-Et*Si)*Xe,v[7]=(Ie*bi-Ee*Ti+st*Si)*Xe,v[8]=(ne*Bi-Q*Di+Fe*Ei)*Xe,v[9]=(O*Di-D*Bi-z*Ei)*Xe,v[10]=(kt*Mi-Mt*Ti+Et*In)*Xe,v[11]=(Ye*Ti-Ie*Mi-st*In)*Xe,v[12]=(Q*yi-ne*Ci-j*Ei)*Xe,v[13]=(D*Ci-O*yi+U*Ei)*Xe,v[14]=(Mt*Si-kt*ki-bt*In)*Xe,v[15]=(Ie*ki-Ye*Si+Ee*In)*Xe,v):null}var A=new Float32Array([0,0,0,1]),E=new Float32Array([0,0,0]);function M(v,S,D,O,U,z){d(v,O||null,z.depthNear,z.depthFar);var ne=D.orientation||A,Q=D.position||E;h(S,ne,Q),U&&f(S,S,U),F(S,S)}return function(v,S,D){return!v||!S?!1:(v.pose=S,v.timestamp=S.timestamp,M(v.leftProjectionMatrix,v.leftViewMatrix,S,D._getFieldOfView("left"),D._getEyeOffset("left"),D),M(v.rightProjectionMatrix,v.rightViewMatrix,S,D._getFieldOfView("right"),D._getEyeOffset("right"),D),!0)}}(),ce=function(){var u=window.self!==window.top,d=ut(document.referrer),h=ut(window.location.href);return u&&d!==h},ut=function(u){var d,h=u.indexOf("://");h!==-1?d=h+3:d=0;var f=u.indexOf("/",d);return f===-1&&(f=u.length),u.substring(0,f)},_n=function(u){if(u.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var d=2*Math.acos(u.w);return d},bo=function(){var l={};return function(u,d){l[u]===void 0&&(console.warn("webvr-polyfill: "+d),l[u]=!0)}}(),Xt=function(u,d){var h=d?"Please use "+d+" instead.":"";bo(u,u+" has been deprecated. This may not work on native WebVR displays. "+h)};function _1(l,u,d){if(!u){d(l);return}for(var h=[],f=null,F=0;F<u.length;++F){var A=u[F];switch(A){case l.TEXTURE_BINDING_2D:case l.TEXTURE_BINDING_CUBE_MAP:var E=u[++F];if(E<l.TEXTURE0||E>l.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),h.push(null,null);break}f||(f=l.getParameter(l.ACTIVE_TEXTURE)),l.activeTexture(E),h.push(l.getParameter(A),null);break;case l.ACTIVE_TEXTURE:f=l.getParameter(l.ACTIVE_TEXTURE),h.push(null);break;default:h.push(l.getParameter(A));break}}d(l);for(var F=0;F<u.length;++F){var A=u[F],M=h[F];switch(A){case l.ACTIVE_TEXTURE:break;case l.ARRAY_BUFFER_BINDING:l.bindBuffer(l.ARRAY_BUFFER,M);break;case l.COLOR_CLEAR_VALUE:l.clearColor(M[0],M[1],M[2],M[3]);break;case l.COLOR_WRITEMASK:l.colorMask(M[0],M[1],M[2],M[3]);break;case l.CURRENT_PROGRAM:l.useProgram(M);break;case l.ELEMENT_ARRAY_BUFFER_BINDING:l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,M);break;case l.FRAMEBUFFER_BINDING:l.bindFramebuffer(l.FRAMEBUFFER,M);break;case l.RENDERBUFFER_BINDING:l.bindRenderbuffer(l.RENDERBUFFER,M);break;case l.TEXTURE_BINDING_2D:var E=u[++F];if(E<l.TEXTURE0||E>l.TEXTURE31)break;l.activeTexture(E),l.bindTexture(l.TEXTURE_2D,M);break;case l.TEXTURE_BINDING_CUBE_MAP:var E=u[++F];if(E<l.TEXTURE0||E>l.TEXTURE31)break;l.activeTexture(E),l.bindTexture(l.TEXTURE_CUBE_MAP,M);break;case l.VIEWPORT:l.viewport(M[0],M[1],M[2],M[3]);break;case l.BLEND:case l.CULL_FACE:case l.DEPTH_TEST:case l.SCISSOR_TEST:case l.STENCIL_TEST:M?l.enable(A):l.disable(A);break;default:console.log("No GL restore behavior for 0x"+A.toString(16));break}f&&l.activeTexture(f)}}var Ai=_1,v1=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),S1=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function jt(l,u,d,h){this.gl=l,this.cardboardUI=u,this.bufferScale=d,this.dirtySubmitFrameBindings=h,this.ctxAttribs=l.getContextAttributes(),this.instanceExt=l.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=l.drawingBufferWidth,this.bufferHeight=l.drawingBufferHeight,this.realBindFramebuffer=l.bindFramebuffer,this.realEnable=l.enable,this.realDisable=l.disable,this.realColorMask=l.colorMask,this.realClearColor=l.clearColor,this.realViewport=l.viewport,c()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(l.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(l.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=R(l,v1,S1,this.attribs),this.uniforms=q(l,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=l.createBuffer(),this.indexBuffer=l.createBuffer(),this.indexCount=0,this.renderTarget=l.createTexture(),this.framebuffer=l.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=l.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=l.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=l.createRenderbuffer()),this.patch(),this.onResize()}jt.prototype.destroy=function(){var l=this.gl;this.unpatch(),l.deleteProgram(this.program),l.deleteBuffer(this.vertexBuffer),l.deleteBuffer(this.indexBuffer),l.deleteTexture(this.renderTarget),l.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&l.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&l.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&l.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},jt.prototype.onResize=function(){var l=this.gl,u=this,d=[l.RENDERBUFFER_BINDING,l.TEXTURE_BINDING_2D,l.TEXTURE0];Ai(l,d,function(h){u.realBindFramebuffer.call(h,h.FRAMEBUFFER,null),u.scissorTest&&u.realDisable.call(h,h.SCISSOR_TEST),u.realColorMask.call(h,!0,!0,!0,!0),u.realViewport.call(h,0,0,h.drawingBufferWidth,h.drawingBufferHeight),u.realClearColor.call(h,0,0,0,1),h.clear(h.COLOR_BUFFER_BIT),u.realBindFramebuffer.call(h,h.FRAMEBUFFER,u.framebuffer),h.bindTexture(h.TEXTURE_2D,u.renderTarget),h.texImage2D(h.TEXTURE_2D,0,u.ctxAttribs.alpha?h.RGBA:h.RGB,u.bufferWidth,u.bufferHeight,0,u.ctxAttribs.alpha?h.RGBA:h.RGB,h.UNSIGNED_BYTE,null),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,u.renderTarget,0),u.ctxAttribs.depth&&u.ctxAttribs.stencil?(h.bindRenderbuffer(h.RENDERBUFFER,u.depthStencilBuffer),h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_STENCIL,u.bufferWidth,u.bufferHeight),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,u.depthStencilBuffer)):u.ctxAttribs.depth?(h.bindRenderbuffer(h.RENDERBUFFER,u.depthBuffer),h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_COMPONENT16,u.bufferWidth,u.bufferHeight),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,u.depthBuffer)):u.ctxAttribs.stencil&&(h.bindRenderbuffer(h.RENDERBUFFER,u.stencilBuffer),h.renderbufferStorage(h.RENDERBUFFER,h.STENCIL_INDEX8,u.bufferWidth,u.bufferHeight),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.STENCIL_ATTACHMENT,h.RENDERBUFFER,u.stencilBuffer)),!h.checkFramebufferStatus(h.FRAMEBUFFER)===h.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),u.realBindFramebuffer.call(h,h.FRAMEBUFFER,u.lastBoundFramebuffer),u.scissorTest&&u.realEnable.call(h,h.SCISSOR_TEST),u.realColorMask.apply(h,u.colorMask),u.realViewport.apply(h,u.viewport),u.realClearColor.apply(h,u.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},jt.prototype.patch=function(){if(!this.isPatched){var l=this,u=this.gl.canvas,d=this.gl;c()||(u.width=V()*this.bufferScale,u.height=P()*this.bufferScale,Object.defineProperty(u,"width",{configurable:!0,enumerable:!0,get:function(){return l.bufferWidth},set:function(f){l.bufferWidth=f,l.realCanvasWidth.set.call(u,f),l.onResize()}}),Object.defineProperty(u,"height",{configurable:!0,enumerable:!0,get:function(){return l.bufferHeight},set:function(f){l.bufferHeight=f,l.realCanvasHeight.set.call(u,f),l.onResize()}})),this.lastBoundFramebuffer=d.getParameter(d.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(d.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(h,f){l.lastBoundFramebuffer=f||l.framebuffer,l.realBindFramebuffer.call(d,h,l.lastBoundFramebuffer)},this.cullFace=d.getParameter(d.CULL_FACE),this.depthTest=d.getParameter(d.DEPTH_TEST),this.blend=d.getParameter(d.BLEND),this.scissorTest=d.getParameter(d.SCISSOR_TEST),this.stencilTest=d.getParameter(d.STENCIL_TEST),d.enable=function(h){switch(h){case d.CULL_FACE:l.cullFace=!0;break;case d.DEPTH_TEST:l.depthTest=!0;break;case d.BLEND:l.blend=!0;break;case d.SCISSOR_TEST:l.scissorTest=!0;break;case d.STENCIL_TEST:l.stencilTest=!0;break}l.realEnable.call(d,h)},d.disable=function(h){switch(h){case d.CULL_FACE:l.cullFace=!1;break;case d.DEPTH_TEST:l.depthTest=!1;break;case d.BLEND:l.blend=!1;break;case d.SCISSOR_TEST:l.scissorTest=!1;break;case d.STENCIL_TEST:l.stencilTest=!1;break}l.realDisable.call(d,h)},this.colorMask=d.getParameter(d.COLOR_WRITEMASK),d.colorMask=function(h,f,F,A){l.colorMask[0]=h,l.colorMask[1]=f,l.colorMask[2]=F,l.colorMask[3]=A,l.realColorMask.call(d,h,f,F,A)},this.clearColor=d.getParameter(d.COLOR_CLEAR_VALUE),d.clearColor=function(h,f,F,A){l.clearColor[0]=h,l.clearColor[1]=f,l.clearColor[2]=F,l.clearColor[3]=A,l.realClearColor.call(d,h,f,F,A)},this.viewport=d.getParameter(d.VIEWPORT),d.viewport=function(h,f,F,A){l.viewport[0]=h,l.viewport[1]=f,l.viewport[2]=F,l.viewport[3]=A,l.realViewport.call(d,h,f,F,A)},this.isPatched=!0,me(u)}},jt.prototype.unpatch=function(){if(this.isPatched){var l=this.gl,u=this.gl.canvas;c()||(Object.defineProperty(u,"width",this.realCanvasWidth),Object.defineProperty(u,"height",this.realCanvasHeight)),u.width=this.bufferWidth,u.height=this.bufferHeight,l.bindFramebuffer=this.realBindFramebuffer,l.enable=this.realEnable,l.disable=this.realDisable,l.colorMask=this.realColorMask,l.clearColor=this.realClearColor,l.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&l.bindFramebuffer(l.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){me(u)},1)}},jt.prototype.setTextureBounds=function(l,u){l||(l=[0,0,.5,1]),u||(u=[.5,0,.5,1]),this.viewportOffsetScale[0]=l[0],this.viewportOffsetScale[1]=l[1],this.viewportOffsetScale[2]=l[2],this.viewportOffsetScale[3]=l[3],this.viewportOffsetScale[4]=u[0],this.viewportOffsetScale[5]=u[1],this.viewportOffsetScale[6]=u[2],this.viewportOffsetScale[7]=u[3]},jt.prototype.submitFrame=function(){var l=this.gl,u=this,d=[];if(this.dirtySubmitFrameBindings||d.push(l.CURRENT_PROGRAM,l.ARRAY_BUFFER_BINDING,l.ELEMENT_ARRAY_BUFFER_BINDING,l.TEXTURE_BINDING_2D,l.TEXTURE0),Ai(l,d,function(f){u.realBindFramebuffer.call(f,f.FRAMEBUFFER,null);var F=0,A=0;u.instanceExt&&(F=f.getVertexAttrib(u.attribs.position,u.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),A=f.getVertexAttrib(u.attribs.texCoord,u.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),u.cullFace&&u.realDisable.call(f,f.CULL_FACE),u.depthTest&&u.realDisable.call(f,f.DEPTH_TEST),u.blend&&u.realDisable.call(f,f.BLEND),u.scissorTest&&u.realDisable.call(f,f.SCISSOR_TEST),u.stencilTest&&u.realDisable.call(f,f.STENCIL_TEST),u.realColorMask.call(f,!0,!0,!0,!0),u.realViewport.call(f,0,0,f.drawingBufferWidth,f.drawingBufferHeight),(u.ctxAttribs.alpha||c())&&(u.realClearColor.call(f,0,0,0,1),f.clear(f.COLOR_BUFFER_BIT)),f.useProgram(u.program),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,u.indexBuffer),f.bindBuffer(f.ARRAY_BUFFER,u.vertexBuffer),f.enableVertexAttribArray(u.attribs.position),f.enableVertexAttribArray(u.attribs.texCoord),f.vertexAttribPointer(u.attribs.position,2,f.FLOAT,!1,20,0),f.vertexAttribPointer(u.attribs.texCoord,3,f.FLOAT,!1,20,8),u.instanceExt&&(F!=0&&u.instanceExt.vertexAttribDivisorANGLE(u.attribs.position,0),A!=0&&u.instanceExt.vertexAttribDivisorANGLE(u.attribs.texCoord,0)),f.activeTexture(f.TEXTURE0),f.uniform1i(u.uniforms.diffuse,0),f.bindTexture(f.TEXTURE_2D,u.renderTarget),f.uniform4fv(u.uniforms.viewportOffsetScale,u.viewportOffsetScale),f.drawElements(f.TRIANGLES,u.indexCount,f.UNSIGNED_SHORT,0),u.cardboardUI&&u.cardboardUI.renderNoState(),u.realBindFramebuffer.call(u.gl,f.FRAMEBUFFER,u.framebuffer),u.ctxAttribs.preserveDrawingBuffer||(u.realClearColor.call(f,0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),u.dirtySubmitFrameBindings||u.realBindFramebuffer.call(f,f.FRAMEBUFFER,u.lastBoundFramebuffer),u.cullFace&&u.realEnable.call(f,f.CULL_FACE),u.depthTest&&u.realEnable.call(f,f.DEPTH_TEST),u.blend&&u.realEnable.call(f,f.BLEND),u.scissorTest&&u.realEnable.call(f,f.SCISSOR_TEST),u.stencilTest&&u.realEnable.call(f,f.STENCIL_TEST),u.realColorMask.apply(f,u.colorMask),u.realViewport.apply(f,u.viewport),(u.ctxAttribs.alpha||!u.ctxAttribs.preserveDrawingBuffer)&&u.realClearColor.apply(f,u.clearColor),u.instanceExt&&(F!=0&&u.instanceExt.vertexAttribDivisorANGLE(u.attribs.position,F),A!=0&&u.instanceExt.vertexAttribDivisorANGLE(u.attribs.texCoord,A))}),c()){var h=l.canvas;(h.width!=u.bufferWidth||h.height!=u.bufferHeight)&&(u.bufferWidth=h.width,u.bufferHeight=h.height,u.onResize())}},jt.prototype.updateDeviceInfo=function(l){var u=this.gl,d=this,h=[u.ARRAY_BUFFER_BINDING,u.ELEMENT_ARRAY_BUFFER_BINDING];Ai(u,h,function(f){var F=d.computeMeshVertices_(d.meshWidth,d.meshHeight,l);if(f.bindBuffer(f.ARRAY_BUFFER,d.vertexBuffer),f.bufferData(f.ARRAY_BUFFER,F,f.STATIC_DRAW),!d.indexCount){var A=d.computeMeshIndices_(d.meshWidth,d.meshHeight);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,d.indexBuffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,A,f.STATIC_DRAW),d.indexCount=A.length}})},jt.prototype.computeMeshVertices_=function(l,u,d){for(var h=new Float32Array(2*l*u*5),f=d.getLeftEyeVisibleTanAngles(),F=d.getLeftEyeNoLensTanAngles(),A=d.getLeftEyeVisibleScreenRect(F),E=0,M=0;M<2;M++){for(var v=0;v<u;v++)for(var S=0;S<l;S++,E++){var D=S/(l-1),O=v/(u-1),U=D,z=O,ne=a(f[0],f[2],D),Q=a(f[3],f[1],O),j=Math.sqrt(ne*ne+Q*Q),Fe=d.distortion.distortInverse(j),Ie=ne*Fe/j,Ye=Q*Fe/j;D=(Ie-F[0])/(F[2]-F[0]),O=(Ye-F[3])/(F[1]-F[3]),D=(A.x+D*A.width-.5)*2,O=(A.y+O*A.height-.5)*2,h[E*5+0]=D,h[E*5+1]=O,h[E*5+2]=U,h[E*5+3]=z,h[E*5+4]=M}var Ee=f[2]-f[0];f[0]=-(Ee+f[0]),f[2]=Ee-f[2],Ee=F[2]-F[0],F[0]=-(Ee+F[0]),F[2]=Ee-F[2],A.x=1-(A.x+A.width)}return h},jt.prototype.computeMeshIndices_=function(l,u){for(var d=new Uint16Array(2*(l-1)*(u-1)*6),h=l/2,f=u/2,F=0,A=0,E=0;E<2;E++)for(var M=0;M<u;M++)for(var v=0;v<l;v++,F++)v==0||M==0||(v<=h==M<=f?(d[A++]=F,d[A++]=F-l-1,d[A++]=F-l,d[A++]=F-l-1,d[A++]=F,d[A++]=F-1):(d[A++]=F-1,d[A++]=F-l,d[A++]=F,d[A++]=F-l,d[A++]=F-1,d[A++]=F-l-1));return d},jt.prototype.getOwnPropertyDescriptor_=function(l,u){var d=Object.getOwnPropertyDescriptor(l,u);return(d.get===void 0||d.set===void 0)&&(d.configurable=!0,d.enumerable=!0,d.get=function(){return this.getAttribute(u)},d.set=function(h){this.setAttribute(u,h)}),d};var T1=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),k1=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),bh=Math.PI/180,Eu=60,Eh=12,yh=20,yu=1,Dh=.75,Ch=.3125,M1=4,Eo=28,Du=1.5;function yo(l){this.gl=l,this.attribs={position:0},this.program=R(l,T1,k1,this.attribs),this.uniforms=q(l,this.program),this.vertexBuffer=l.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}yo.prototype.destroy=function(){var l=this.gl;this.listener&&l.canvas.removeEventListener("click",this.listener,!1),l.deleteProgram(this.program),l.deleteBuffer(this.vertexBuffer)},yo.prototype.listen=function(l,u){var d=this.gl.canvas;this.listener=function(h){var f=d.clientWidth/2,F=Eo*Du;h.clientX>f-F&&h.clientX<f+F&&h.clientY>d.clientHeight-F?l(h):h.clientX<F&&h.clientY<F&&u(h)},d.addEventListener("click",this.listener,!1)},yo.prototype.onResize=function(){var l=this.gl,u=this,d=[l.ARRAY_BUFFER_BINDING];Ai(l,d,function(h){var f=[],F=h.drawingBufferWidth/2,A=Math.max(screen.width,screen.height)*window.devicePixelRatio,E=h.drawingBufferWidth/A,M=E*window.devicePixelRatio,v=M1*M/2,S=Eo*Du*M,D=Eo*M/2,O=(Eo*Du-Eo)*M;f.push(F-v,S),f.push(F-v,h.drawingBufferHeight),f.push(F+v,S),f.push(F+v,h.drawingBufferHeight),u.gearOffset=f.length/2;function U(Fe,Ie){var Ye=(90-Fe)*bh,Ee=Math.cos(Ye),st=Math.sin(Ye);f.push(Ch*Ee*D+F,Ch*st*D+D),f.push(Ie*Ee*D+F,Ie*st*D+D)}for(var z=0;z<=6;z++){var ne=z*Eu;U(ne,yu),U(ne+Eh,yu),U(ne+yh,Dh),U(ne+(Eu-yh),Dh),U(ne+(Eu-Eh),yu)}u.gearVertexCount=f.length/2-u.gearOffset,u.arrowOffset=f.length/2;function Q(Fe,Ie){f.push(O+Fe,h.drawingBufferHeight-O-Ie)}var j=v/Math.sin(45*bh);Q(0,D),Q(D,0),Q(D+j,j),Q(j,D+j),Q(j,D-j),Q(0,D),Q(D,D*2),Q(D+j,D*2-j),Q(j,D-j),Q(0,D),Q(j,D-v),Q(Eo*M,D-v),Q(j,D+v),Q(Eo*M,D+v),u.arrowVertexCount=f.length/2-u.arrowOffset,h.bindBuffer(h.ARRAY_BUFFER,u.vertexBuffer),h.bufferData(h.ARRAY_BUFFER,new Float32Array(f),h.STATIC_DRAW)})},yo.prototype.render=function(){var l=this.gl,u=this,d=[l.CULL_FACE,l.DEPTH_TEST,l.BLEND,l.SCISSOR_TEST,l.STENCIL_TEST,l.COLOR_WRITEMASK,l.VIEWPORT,l.CURRENT_PROGRAM,l.ARRAY_BUFFER_BINDING];Ai(l,d,function(h){h.disable(h.CULL_FACE),h.disable(h.DEPTH_TEST),h.disable(h.BLEND),h.disable(h.SCISSOR_TEST),h.disable(h.STENCIL_TEST),h.colorMask(!0,!0,!0,!0),h.viewport(0,0,h.drawingBufferWidth,h.drawingBufferHeight),u.renderNoState()})},yo.prototype.renderNoState=function(){var l=this.gl;l.useProgram(this.program),l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.enableVertexAttribArray(this.attribs.position),l.vertexAttribPointer(this.attribs.position,2,l.FLOAT,!1,8,0),l.uniform4f(this.uniforms.color,1,1,1,1),Y(this.projMat,0,l.drawingBufferWidth,0,l.drawingBufferHeight,.1,1024),l.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),l.drawArrays(l.TRIANGLE_STRIP,0,4),l.drawArrays(l.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),l.drawArrays(l.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function ra(l){this.coefficients=l}ra.prototype.distortInverse=function(l){for(var u=0,d=1,h=l-this.distort(u);Math.abs(d-u)>1e-4;){var f=l-this.distort(d),F=d-f*((d-u)/(f-h));u=d,d=F,h=f}return d},ra.prototype.distort=function(l){for(var u=l*l,d=0,h=0;h<this.coefficients.length;h++)d=u*(d+this.coefficients[h]);return(d+1)*l};var tn=Math.PI/180,nn=180/Math.PI,be=function(u,d,h){this.x=u||0,this.y=d||0,this.z=h||0};be.prototype={constructor:be,set:function(u,d,h){return this.x=u,this.y=d,this.z=h,this},copy:function(u){return this.x=u.x,this.y=u.y,this.z=u.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var u=this.length();if(u!==0){var d=1/u;this.multiplyScalar(d)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(u){this.x*=u,this.y*=u,this.z*=u},applyQuaternion:function(u){var d=this.x,h=this.y,f=this.z,F=u.x,A=u.y,E=u.z,M=u.w,v=M*d+A*f-E*h,S=M*h+E*d-F*f,D=M*f+F*h-A*d,O=-F*d-A*h-E*f;return this.x=v*M+O*-F+S*-E-D*-A,this.y=S*M+O*-A+D*-F-v*-E,this.z=D*M+O*-E+v*-A-S*-F,this},dot:function(u){return this.x*u.x+this.y*u.y+this.z*u.z},crossVectors:function(u,d){var h=u.x,f=u.y,F=u.z,A=d.x,E=d.y,M=d.z;return this.x=f*M-F*E,this.y=F*A-h*M,this.z=h*E-f*A,this}};var le=function(u,d,h,f){this.x=u||0,this.y=d||0,this.z=h||0,this.w=f!==void 0?f:1};le.prototype={constructor:le,set:function(u,d,h,f){return this.x=u,this.y=d,this.z=h,this.w=f,this},copy:function(u){return this.x=u.x,this.y=u.y,this.z=u.z,this.w=u.w,this},setFromEulerXYZ:function(u,d,h){var f=Math.cos(u/2),F=Math.cos(d/2),A=Math.cos(h/2),E=Math.sin(u/2),M=Math.sin(d/2),v=Math.sin(h/2);return this.x=E*F*A+f*M*v,this.y=f*M*A-E*F*v,this.z=f*F*v+E*M*A,this.w=f*F*A-E*M*v,this},setFromEulerYXZ:function(u,d,h){var f=Math.cos(u/2),F=Math.cos(d/2),A=Math.cos(h/2),E=Math.sin(u/2),M=Math.sin(d/2),v=Math.sin(h/2);return this.x=E*F*A+f*M*v,this.y=f*M*A-E*F*v,this.z=f*F*v-E*M*A,this.w=f*F*A+E*M*v,this},setFromAxisAngle:function(u,d){var h=d/2,f=Math.sin(h);return this.x=u.x*f,this.y=u.y*f,this.z=u.z*f,this.w=Math.cos(h),this},multiply:function(u){return this.multiplyQuaternions(this,u)},multiplyQuaternions:function(u,d){var h=u.x,f=u.y,F=u.z,A=u.w,E=d.x,M=d.y,v=d.z,S=d.w;return this.x=h*S+A*E+f*v-F*M,this.y=f*S+A*M+F*E-h*v,this.z=F*S+A*v+h*M-f*E,this.w=A*S-h*E-f*M-F*v,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var u=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return u===0?(this.x=0,this.y=0,this.z=0,this.w=1):(u=1/u,this.x=this.x*u,this.y=this.y*u,this.z=this.z*u,this.w=this.w*u),this},slerp:function(u,d){if(d===0)return this;if(d===1)return this.copy(u);var h=this.x,f=this.y,F=this.z,A=this.w,E=A*u.w+h*u.x+f*u.y+F*u.z;if(E<0?(this.w=-u.w,this.x=-u.x,this.y=-u.y,this.z=-u.z,E=-E):this.copy(u),E>=1)return this.w=A,this.x=h,this.y=f,this.z=F,this;var M=Math.acos(E),v=Math.sqrt(1-E*E);if(Math.abs(v)<.001)return this.w=.5*(A+this.w),this.x=.5*(h+this.x),this.y=.5*(f+this.y),this.z=.5*(F+this.z),this;var S=Math.sin((1-d)*M)/v,D=Math.sin(d*M)/v;return this.w=A*S+this.w*D,this.x=h*S+this.x*D,this.y=f*S+this.y*D,this.z=F*S+this.z*D,this},setFromUnitVectors:function(){var l,u,d=1e-6;return function(h,f){return l===void 0&&(l=new be),u=h.dot(f)+1,u<d?(u=0,Math.abs(h.x)>Math.abs(h.z)?l.set(-h.y,h.x,0):l.set(0,-h.z,h.y)):l.crossVectors(h,f),this.x=l.x,this.y=l.y,this.z=l.z,this.w=u,this.normalize(),this}}()};function Cu(l){this.width=l.width||V(),this.height=l.height||P(),this.widthMeters=l.widthMeters,this.heightMeters=l.heightMeters,this.bevelMeters=l.bevelMeters}var b1=new Cu({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),E1=new Cu({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),Bu={CardboardV1:new Lu({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new Lu({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function Ge(l,u){this.viewer=Bu.CardboardV2,this.updateDeviceParams(l),this.distortion=new ra(this.viewer.distortionCoefficients);for(var d=0;d<u.length;d++){var h=u[d];Bu[h.id]=new Lu(h)}}Ge.prototype.updateDeviceParams=function(l){this.device=this.determineDevice_(l)||this.device},Ge.prototype.getDevice=function(){return this.device},Ge.prototype.setViewer=function(l){this.viewer=l,this.distortion=new ra(this.viewer.distortionCoefficients)},Ge.prototype.determineDevice_=function(l){if(!l)return c()?(console.warn("Using fallback iOS device measurements."),E1):(console.warn("Using fallback Android device measurements."),b1);var u=.0254,d=u/l.xdpi,h=u/l.ydpi,f=V(),F=P();return new Cu({widthMeters:d*f,heightMeters:h*F,bevelMeters:l.bevelMm*.001})},Ge.prototype.getDistortedFieldOfViewLeftEye=function(){var l=this.viewer,u=this.device,d=this.distortion,h=l.screenLensDistance,f=(u.widthMeters-l.interLensDistance)/2,F=l.interLensDistance/2,A=l.baselineLensDistance-u.bevelMeters,E=u.heightMeters-A,M=nn*Math.atan(d.distort(f/h)),v=nn*Math.atan(d.distort(F/h)),S=nn*Math.atan(d.distort(A/h)),D=nn*Math.atan(d.distort(E/h));return{leftDegrees:Math.min(M,l.fov),rightDegrees:Math.min(v,l.fov),downDegrees:Math.min(S,l.fov),upDegrees:Math.min(D,l.fov)}},Ge.prototype.getLeftEyeVisibleTanAngles=function(){var l=this.viewer,u=this.device,d=this.distortion,h=Math.tan(-tn*l.fov),f=Math.tan(tn*l.fov),F=Math.tan(tn*l.fov),A=Math.tan(-tn*l.fov),E=u.widthMeters/4,M=u.heightMeters/2,v=l.baselineLensDistance-u.bevelMeters-M,S=l.interLensDistance/2-E,D=-v,O=l.screenLensDistance,U=d.distort((S-E)/O),z=d.distort((D+M)/O),ne=d.distort((S+E)/O),Q=d.distort((D-M)/O),j=new Float32Array(4);return j[0]=Math.max(h,U),j[1]=Math.min(f,z),j[2]=Math.min(F,ne),j[3]=Math.max(A,Q),j},Ge.prototype.getLeftEyeNoLensTanAngles=function(){var l=this.viewer,u=this.device,d=this.distortion,h=new Float32Array(4),f=d.distortInverse(Math.tan(-tn*l.fov)),F=d.distortInverse(Math.tan(tn*l.fov)),A=d.distortInverse(Math.tan(tn*l.fov)),E=d.distortInverse(Math.tan(-tn*l.fov)),M=u.widthMeters/4,v=u.heightMeters/2,S=l.baselineLensDistance-u.bevelMeters-v,D=l.interLensDistance/2-M,O=-S,U=l.screenLensDistance,z=(D-M)/U,ne=(O+v)/U,Q=(D+M)/U,j=(O-v)/U;return h[0]=Math.max(f,z),h[1]=Math.min(F,ne),h[2]=Math.min(A,Q),h[3]=Math.max(E,j),h},Ge.prototype.getLeftEyeVisibleScreenRect=function(l){var u=this.viewer,d=this.device,h=u.screenLensDistance,f=(d.widthMeters-u.interLensDistance)/2,F=u.baselineLensDistance-d.bevelMeters,A=(l[0]*h+f)/d.widthMeters,E=(l[1]*h+F)/d.heightMeters,M=(l[2]*h+f)/d.widthMeters,v=(l[3]*h+F)/d.heightMeters;return{x:A,y:v,width:M-A,height:E-v}},Ge.prototype.getFieldOfViewLeftEye=function(l){return l?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},Ge.prototype.getFieldOfViewRightEye=function(l){var u=this.getFieldOfViewLeftEye(l);return{leftDegrees:u.rightDegrees,rightDegrees:u.leftDegrees,upDegrees:u.upDegrees,downDegrees:u.downDegrees}},Ge.prototype.getUndistortedFieldOfViewLeftEye=function(){var l=this.getUndistortedParams_();return{leftDegrees:nn*Math.atan(l.outerDist),rightDegrees:nn*Math.atan(l.innerDist),downDegrees:nn*Math.atan(l.bottomDist),upDegrees:nn*Math.atan(l.topDist)}},Ge.prototype.getUndistortedViewportLeftEye=function(){var l=this.getUndistortedParams_(),u=this.viewer,d=this.device,h=u.screenLensDistance,f=d.widthMeters/h,F=d.heightMeters/h,A=d.width/f,E=d.height/F,M=Math.round((l.eyePosX-l.outerDist)*A),v=Math.round((l.eyePosY-l.bottomDist)*E);return{x:M,y:v,width:Math.round((l.eyePosX+l.innerDist)*A)-M,height:Math.round((l.eyePosY+l.topDist)*E)-v}},Ge.prototype.getUndistortedParams_=function(){var l=this.viewer,u=this.device,d=this.distortion,h=l.screenLensDistance,f=l.interLensDistance/2/h,F=u.widthMeters/h,A=u.heightMeters/h,E=F/2-f,M=(l.baselineLensDistance-u.bevelMeters)/h,v=l.fov,S=d.distortInverse(Math.tan(tn*v)),D=Math.min(E,S),O=Math.min(f,S),U=Math.min(M,S),z=Math.min(A-M,S);return{outerDist:D,innerDist:O,topDist:z,bottomDist:U,eyePosX:E,eyePosY:M}};function Lu(l){this.id=l.id,this.label=l.label,this.fov=l.fov,this.interLensDistance=l.interLensDistance,this.baselineLensDistance=l.baselineLensDistance,this.screenLensDistance=l.screenLensDistance,this.distortionCoefficients=l.distortionCoefficients,this.inverseCoefficients=l.inverseCoefficients}Ge.Viewers=Bu;var y1=1,D1="2019-11-09T17:36:14Z",C1=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],B1={format:y1,last_updated:D1,devices:C1};function _i(l,u){if(this.dpdb=B1,this.recalculateDeviceParams_(),l){this.onDeviceParamsUpdated=u;var d=new XMLHttpRequest,h=this;d.open("GET",l,!0),d.addEventListener("load",function(){h.loading=!1,d.status>=200&&d.status<=299?(h.dpdb=JSON.parse(d.response),h.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),d.send()}}_i.prototype.getDeviceParams=function(){return this.deviceParams},_i.prototype.recalculateDeviceParams_=function(){var l=this.calcDeviceParams_();l?(this.deviceParams=l,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},_i.prototype.calcDeviceParams_=function(){var l=this.dpdb;if(!l)return console.error("DPDB not available."),null;if(l.format!=1)return console.error("DPDB has unexpected format version."),null;if(!l.devices||!l.devices.length)return console.error("DPDB does not have a devices section."),null;var u=navigator.userAgent||navigator.vendor||window.opera,d=V(),h=P();if(!l.devices)return console.error("DPDB has no devices section."),null;for(var f=0;f<l.devices.length;f++){var F=l.devices[f];if(!F.rules){console.warn("Device["+f+"] has no rules section.");continue}if(F.type!="ios"&&F.type!="android"){console.warn("Device["+f+"] has invalid type.");continue}if(c()==(F.type=="ios")){for(var A=!1,E=0;E<F.rules.length;E++){var M=F.rules[E];if(this.ruleMatches_(M,u,d,h)){A=!0;break}}if(A){var v=F.dpi[0]||F.dpi,S=F.dpi[1]||F.dpi;return new L1({xdpi:v,ydpi:S,bevelMm:F.bw})}}}return console.warn("No DPDB device match."),null},_i.prototype.ruleMatches_=function(l,u,d,h){if(!l.ua&&!l.res||(l.ua&&l.ua.substring(0,2)==="SM"&&(l.ua=l.ua.substring(0,7)),l.ua&&u.indexOf(l.ua)<0))return!1;if(l.res){if(!l.res[0]||!l.res[1])return!1;var f=l.res[0],F=l.res[1];if(Math.min(d,h)!=Math.min(f,F)||Math.max(d,h)!=Math.max(f,F))return!1}return!0};function L1(l){this.xdpi=l.xdpi,this.ydpi=l.ydpi,this.bevelMm=l.bevelMm}function vi(l,u){this.set(l,u)}vi.prototype.set=function(l,u){this.sample=l,this.timestampS=u},vi.prototype.copy=function(l){this.set(l.sample,l.timestampS)};function Do(l,u){this.kFilter=l,this.isDebug=u,this.currentAccelMeasurement=new vi,this.currentGyroMeasurement=new vi,this.previousGyroMeasurement=new vi,c()?this.filterQ=new le(-1,0,0,1):this.filterQ=new le(1,0,0,1),this.previousFilterQ=new le,this.previousFilterQ.copy(this.filterQ),this.accelQ=new le,this.isOrientationInitialized=!1,this.estimatedGravity=new be,this.measuredGravity=new be,this.gyroIntegralQ=new le}Do.prototype.addAccelMeasurement=function(l,u){this.currentAccelMeasurement.set(l,u)},Do.prototype.addGyroMeasurement=function(l,u){this.currentGyroMeasurement.set(l,u);var d=u-this.previousGyroMeasurement.timestampS;I(d)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},Do.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var l=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,u=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,l);this.gyroIntegralQ.multiply(u),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(u);var d=new le;d.copy(this.filterQ),d.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(d),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var h=new le;h.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),h.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",nn*_n(h),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var f=new le;f.copy(this.filterQ),f.multiply(h),this.filterQ.slerp(f,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},Do.prototype.getOrientation=function(){return this.filterQ},Do.prototype.accelToQuaternion_=function(l){var u=new be;u.copy(l),u.normalize();var d=new le;return d.setFromUnitVectors(new be(0,0,-1),u),d.inverse(),d},Do.prototype.gyroToQuaternionDelta_=function(l,u){var d=new le,h=new be;return h.copy(l),h.normalize(),d.setFromAxisAngle(h,l.length()*u),d};function Bh(l,u){this.predictionTimeS=l,this.isDebug=u,this.previousQ=new le,this.previousTimestampS=null,this.deltaQ=new le,this.outQ=new le}Bh.prototype.getPrediction=function(l,u,d){if(!this.previousTimestampS)return this.previousQ.copy(l),this.previousTimestampS=d,l;var h=new be;h.copy(u),h.normalize();var f=u.length();if(f<tn*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(nn*f).toFixed(1)),this.outQ.copy(l),this.previousQ.copy(l),this.outQ;var F=f*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(h,F),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(l),this.previousTimestampS=d,this.outQ};function Lt(l,u,d,h){this.yawOnly=d,this.accelerometer=new be,this.gyroscope=new be,this.filter=new Do(l,h),this.posePredictor=new Bh(u,h),this.isFirefoxAndroid=x(),this.isIOS=c();var f=w();this.isDeviceMotionInRadians=!this.isIOS&&f&&f<66,this.isWithoutDeviceMotion=T()||_(),this.filterToWorldQ=new le,c()?this.filterToWorldQ.setFromAxisAngle(new be(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new be(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new le,this.worldToScreenQ=new le,this.originalPoseAdjustQ=new le,this.originalPoseAdjustQ.setFromAxisAngle(new be(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),b()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new le,this.orientationOut_=new Float32Array(4),this.start()}Lt.prototype.getPosition=function(){return null},Lt.prototype.getOrientation=function(){var l=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var f=new le().setFromAxisAngle(new be(0,0,-1),0),F=new le;return window.orientation===-90?F.setFromAxisAngle(new be(0,1,0),Math.PI/-2):F.setFromAxisAngle(new be(0,1,0),Math.PI/2),f.multiply(F)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var f=new le;return f.setFromAxisAngle(new be(1,0,0),-Math.PI/2),f}(),l=this._deviceOrientationQ;var d=new le;return d.copy(l),d.multiply(this.deviceOrientationFilterToWorldQ),d.multiply(this.resetQ),d.multiply(this.worldToScreenQ),d.multiplyQuaternions(this.deviceOrientationFixQ,d),this.yawOnly&&(d.x=0,d.z=0,d.normalize()),this.orientationOut_[0]=d.x,this.orientationOut_[1]=d.y,this.orientationOut_[2]=d.z,this.orientationOut_[3]=d.w,this.orientationOut_}else{var u=this.filter.getOrientation();l=this.posePredictor.getPrediction(u,this.gyroscope,this.previousTimestampS)}var d=new le;return d.copy(this.filterToWorldQ),d.multiply(this.resetQ),d.multiply(l),d.multiply(this.worldToScreenQ),this.yawOnly&&(d.x=0,d.z=0,d.normalize()),this.orientationOut_[0]=d.x,this.orientationOut_[1]=d.y,this.orientationOut_[2]=d.z,this.orientationOut_[3]=d.w,this.orientationOut_},Lt.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),b()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},Lt.prototype.onDeviceOrientation_=function(l){this._deviceOrientationQ=this._deviceOrientationQ||new le;var u=l.alpha,d=l.beta,h=l.gamma;u=(u||0)*Math.PI/180,d=(d||0)*Math.PI/180,h=(h||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(d,u,-h)},Lt.prototype.onDeviceMotion_=function(l){this.updateDeviceMotion_(l)},Lt.prototype.updateDeviceMotion_=function(l){var u=l.accelerationIncludingGravity,d=l.rotationRate,h=l.timeStamp/1e3,f=h-this.previousTimestampS;if(f<0){bo("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=h;return}else if(f<=r||f>i){bo("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=h;return}this.accelerometer.set(-u.x,-u.y,-u.z),d&&(y()?this.gyroscope.set(-d.beta,d.alpha,d.gamma):this.gyroscope.set(d.alpha,d.beta,d.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,h)),this.filter.addAccelMeasurement(this.accelerometer,h),this.previousTimestampS=h},Lt.prototype.onOrientationChange_=function(l){this.setScreenTransform_()},Lt.prototype.onMessage_=function(l){var u=l.data;if(!(!u||!u.type)){var d=u.type.toLowerCase();d==="devicemotion"&&this.updateDeviceMotion_(u.deviceMotionEvent)}},Lt.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new be(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new be(0,0,1),Math.PI/2);break;case 180:break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},Lt.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),c()&&ce()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},Lt.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var R1=60,P1=new be(1,0,0),V1=new be(0,0,1),Ru=new le;Ru.setFromAxisAngle(P1,-Math.PI/2),Ru.multiply(new le().setFromAxisAngle(V1,Math.PI/2));var I1=function(){function l(u){e(this,l),this.config=u,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new le,this._outQ=new le,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return t(l,[{key:"init",value:function(){var d=null;try{d=new RelativeOrientationSensor({frequency:R1,referenceFrame:"screen"}),d.addEventListener("error",this._onSensorError)}catch(h){this.errors.push(h),h.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):h.name==="ReferenceError"?this.useDeviceMotion():console.error(h)}d&&(this.api="sensor",this.sensor=d,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new Lt(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var d=this.sensor.quaternion;this._sensorQ.set(d[0],d[1],d[2],d[3]);var h=this._outQ;return h.copy(Ru),h.multiply(this._sensorQ),this.config.YAW_ONLY&&(h.x=h.z=0,h.normalize()),this._out[0]=h.x,this._out[1]=h.y,this._out[2]=h.z,this._out[3]=h.w,this._out}},{key:"_onSensorError",value:function(d){this.errors.push(d.error),d.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):d.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(d.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),l}(),O1="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function Co(){this.loadIcon_();var l=document.createElement("div"),A=l.style;A.position="fixed",A.top=0,A.right=0,A.bottom=0,A.left=0,A.backgroundColor="gray",A.fontFamily="sans-serif",A.zIndex=1e6;var u=document.createElement("img");u.src=this.icon;var A=u.style;A.marginLeft="25%",A.marginTop="25%",A.width="50%",l.appendChild(u);var d=document.createElement("div"),A=d.style;A.textAlign="center",A.fontSize="16px",A.lineHeight="24px",A.margin="24px 25%",A.width="50%",d.innerHTML="Place your phone into your Cardboard viewer.",l.appendChild(d);var h=document.createElement("div"),A=h.style;A.backgroundColor="#CFD8DC",A.position="fixed",A.bottom=0,A.width="100%",A.height="48px",A.padding="14px 24px",A.boxSizing="border-box",A.color="#656A6B",l.appendChild(h);var f=document.createElement("div");f.style.float="left",f.innerHTML="No Cardboard viewer?";var F=document.createElement("a");F.href="https://www.google.com/get/cardboard/get-cardboard/",F.innerHTML="get one",F.target="_blank";var A=F.style;A.float="right",A.fontWeight=600,A.textTransform="uppercase",A.borderLeft="1px solid gray",A.paddingLeft="24px",A.textDecoration="none",A.color="#656A6B",h.appendChild(f),h.appendChild(F),this.overlay=l,this.text=d,this.hide()}Co.prototype.show=function(l){!l&&!this.overlay.parentElement?document.body.appendChild(this.overlay):l&&(this.overlay.parentElement&&this.overlay.parentElement!=l&&this.overlay.parentElement.removeChild(this.overlay),l.appendChild(this.overlay)),this.overlay.style.display="block";var u=this.overlay.querySelector("img"),d=u.style;b()?(d.width="20%",d.marginLeft="40%",d.marginTop="3%"):(d.width="50%",d.marginLeft="25%",d.marginTop="25%")},Co.prototype.hide=function(){this.overlay.style.display="none"},Co.prototype.showTemporarily=function(l,u){this.show(u),this.timer=setTimeout(this.hide.bind(this),l)},Co.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},Co.prototype.update=function(){this.disableShowTemporarily(),!b()&&K()?this.show():this.hide()},Co.prototype.loadIcon_=function(){this.icon=s("image/svg+xml",O1)};var W1="CardboardV1",Lh="WEBVR_CARDBOARD_VIEWER",H1="webvr-polyfill-viewer-selector";function Rt(l){try{this.selectedKey=localStorage.getItem(Lh)}catch(u){console.error("Failed to load viewer profile: %s",u)}this.selectedKey||(this.selectedKey=l||W1),this.dialog=this.createDialog_(Ge.Viewers),this.root=null,this.onChangeCallbacks_=[]}Rt.prototype.show=function(l){this.root=l,l.appendChild(this.dialog);var u=this.dialog.querySelector("#"+this.selectedKey);u.checked=!0,this.dialog.style.display="block"},Rt.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},Rt.prototype.getCurrentViewer=function(){return Ge.Viewers[this.selectedKey]},Rt.prototype.getSelectedKey_=function(){var l=this.dialog.querySelector("input[name=field]:checked");return l?l.id:null},Rt.prototype.onChange=function(l){this.onChangeCallbacks_.push(l)},Rt.prototype.fireOnChange_=function(l){for(var u=0;u<this.onChangeCallbacks_.length;u++)this.onChangeCallbacks_[u](l)},Rt.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!Ge.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(Ge.Viewers[this.selectedKey]);try{localStorage.setItem(Lh,this.selectedKey)}catch(l){console.error("Failed to save viewer profile: %s",l)}this.hide()},Rt.prototype.createDialog_=function(l){var u=document.createElement("div");u.classList.add(H1),u.style.display="none";var d=document.createElement("div"),F=d.style;F.position="fixed",F.left=0,F.top=0,F.width="100%",F.height="100%",F.background="rgba(0, 0, 0, 0.3)",d.addEventListener("click",this.hide.bind(this));var h=280,f=document.createElement("div"),F=f.style;F.boxSizing="border-box",F.position="fixed",F.top="24px",F.left="50%",F.marginLeft=-h/2+"px",F.width=h+"px",F.padding="24px",F.overflow="hidden",F.background="#fafafa",F.fontFamily="'Roboto', sans-serif",F.boxShadow="0px 5px 20px #666",f.appendChild(this.createH1_("Select your viewer"));for(var A in l)f.appendChild(this.createChoice_(A,l[A].label));return f.appendChild(this.createButton_("Save",this.onSave_.bind(this))),u.appendChild(d),u.appendChild(f),u},Rt.prototype.createH1_=function(l){var u=document.createElement("h1"),d=u.style;return d.color="black",d.fontSize="20px",d.fontWeight="bold",d.marginTop=0,d.marginBottom="24px",u.innerHTML=l,u},Rt.prototype.createChoice_=function(l,u){var d=document.createElement("div");d.style.marginTop="8px",d.style.color="black";var h=document.createElement("input");h.style.fontSize="30px",h.setAttribute("id",l),h.setAttribute("type","radio"),h.setAttribute("value",l),h.setAttribute("name","field");var f=document.createElement("label");return f.style.marginLeft="4px",f.setAttribute("for",l),f.innerHTML=u,d.appendChild(h),d.appendChild(f),d},Rt.prototype.createButton_=function(l,u){var d=document.createElement("button");d.innerHTML=l;var h=d.style;return h.float="right",h.textTransform="uppercase",h.color="#1094f7",h.fontSize="14px",h.letterSpacing=0,h.border=0,h.background="none",h.marginTop="16px",d.addEventListener("click",u),d};var N1=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function U1(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}function G1(l,u){return u={exports:{}},l(u,u.exports),u.exports}var z1=G1(function(l,u){(function(h,f){l.exports=f()})(N1,function(){return function(d){var h={};function f(F){if(h[F])return h[F].exports;var A=h[F]={i:F,l:!1,exports:{}};return d[F].call(A.exports,A,A.exports,f),A.l=!0,A.exports}return f.m=d,f.c=h,f.d=function(F,A,E){f.o(F,A)||Object.defineProperty(F,A,{configurable:!1,enumerable:!0,get:E})},f.n=function(F){var A=F&&F.__esModule?function(){return F.default}:function(){return F};return f.d(A,"a",A),A},f.o=function(F,A){return Object.prototype.hasOwnProperty.call(F,A)},f.p="",f(f.s=0)}([function(d,h,f){"use strict";var F=function(){function S(D,O){for(var U=0;U<O.length;U++){var z=O[U];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(D,z.key,z)}}return function(D,O,U){return O&&S(D.prototype,O),U&&S(D,U),D}}();function A(S,D){if(!(S instanceof D))throw new TypeError("Cannot call a class as a function")}var E=f(1),M=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,v=function(){function S(){A(this,S),M?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",E),this.noSleepVideo.addEventListener("timeupdate",function(D){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return F(S,[{key:"enable",value:function(){M?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){M?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),S}();d.exports=v},function(d,h,f){"use strict";d.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),X1=U1(z1),j1=1e3,q1=[0,0,.5,1],Q1=[.5,0,.5,1],J1=window.requestAnimationFrame,Y1=window.cancelAnimationFrame;function K1(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function Rh(l){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:l.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:l.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:l.canPresent},maxLayers:{writable:!1,enumerable:!0,value:l.maxLayers},hasOrientation:{enumerable:!0,get:function(){return Xt("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),l.hasOrientation}}})}function _e(l){l=l||{};var u="wakelock"in l?l.wakelock:!0;this.isPolyfilled=!0,this.displayId=j1++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return Xt("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new Rh({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,u&&K()&&(this.wakelock_=new X1)}_e.prototype.getFrameData=function(l){return Me(l,this._getPose(),this)},_e.prototype.getPose=function(){return Xt("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},_e.prototype.resetPose=function(){return Xt("VRDisplay.prototype.resetPose"),this._resetPose()},_e.prototype.getImmediatePose=function(){return Xt("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},_e.prototype.requestAnimationFrame=function(l){return J1(l)},_e.prototype.cancelAnimationFrame=function(l){return Y1(l)},_e.prototype.wrapForFullscreen=function(l){if(c())return l;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var u=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",u.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==l)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=l,this.originalParent_=l.parentElement,this.originalParent_||document.body.appendChild(l),!this.fullscreenWrapper_.parentElement){var d=this.fullscreenElement_.parentElement;d.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),d.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var h=this;function f(){if(h.fullscreenElement_){var F=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];h.fullscreenElement_.setAttribute("style",F.join("; ")+";")}}return f(),this.fullscreenWrapper_},_e.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var l=this.fullscreenElement_;this.fullscreenElementCachedStyle_?l.setAttribute("style",this.fullscreenElementCachedStyle_):l.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var u=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(l),this.originalParent_===u?u.insertBefore(l,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(l),u.removeChild(this.fullscreenWrapper_),l}},_e.prototype.requestPresent=function(l){var u=this.isPresenting,d=this;return l instanceof Array||(Xt("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),l=[l]),new Promise(function(h,f){if(!d.capabilities.canPresent){f(new Error("VRDisplay is not capable of presenting."));return}if(l.length==0||l.length>d.capabilities.maxLayers){f(new Error("Invalid number of layers."));return}var F=l[0];if(!F.source){h();return}var A=F.leftBounds||q1,E=F.rightBounds||Q1;if(u){var M=d.layer_;M.source!==F.source&&(M.source=F.source);for(var v=0;v<4;v++)M.leftBounds[v]=A[v],M.rightBounds[v]=E[v];d.wrapForFullscreen(d.layer_.source),d.updatePresent_(),h();return}if(d.layer_={predistorted:F.predistorted,source:F.source,leftBounds:A.slice(0),rightBounds:E.slice(0)},d.waitingForPresent_=!1,d.layer_&&d.layer_.source){var S=d.wrapForFullscreen(d.layer_.source),D=function(){var z=B();d.isPresenting=S===z,d.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(ne){console.error("screen.orientation.lock() failed due to",ne.message)}),d.waitingForPresent_=!1,d.beginPresent_(),h()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),d.removeFullscreenWrapper(),d.disableWakeLock(),d.endPresent_(),d.removeFullscreenListeners_()),d.fireVRDisplayPresentChange_()},O=function(){d.waitingForPresent_&&(d.removeFullscreenWrapper(),d.removeFullscreenListeners_(),d.disableWakeLock(),d.waitingForPresent_=!1,d.isPresenting=!1,f(new Error("Unable to present.")))};d.addFullscreenListeners_(S,D,O),C(S)?(d.enableWakeLock(),d.waitingForPresent_=!0):(c()||p())&&(d.enableWakeLock(),d.isPresenting=!0,d.beginPresent_(),d.fireVRDisplayPresentChange_(),h())}!d.waitingForPresent_&&!c()&&(H(),f(new Error("Unable to present.")))})},_e.prototype.exitPresent=function(){var l=this.isPresenting,u=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(d,h){l?(!H()&&c()&&(u.endPresent_(),u.fireVRDisplayPresentChange_()),p()&&(u.removeFullscreenWrapper(),u.removeFullscreenListeners_(),u.endPresent_(),u.fireVRDisplayPresentChange_()),d()):h(new Error("Was not presenting to VRDisplay."))})},_e.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},_e.prototype.fireVRDisplayPresentChange_=function(){var l=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(l)},_e.prototype.fireVRDisplayConnect_=function(){var l=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(l)},_e.prototype.addFullscreenListeners_=function(l,u,d){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=l,this.fullscreenChangeHandler_=u,this.fullscreenErrorHandler_=d,u&&(document.fullscreenEnabled?l.addEventListener("fullscreenchange",u,!1):document.webkitFullscreenEnabled?l.addEventListener("webkitfullscreenchange",u,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",u,!1):document.msFullscreenEnabled&&l.addEventListener("msfullscreenchange",u,!1)),d&&(document.fullscreenEnabled?l.addEventListener("fullscreenerror",d,!1):document.webkitFullscreenEnabled?l.addEventListener("webkitfullscreenerror",d,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",d,!1):document.msFullscreenEnabled&&l.addEventListener("msfullscreenerror",d,!1))},_e.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var l=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var u=this.fullscreenChangeHandler_;l.removeEventListener("fullscreenchange",u,!1),l.removeEventListener("webkitfullscreenchange",u,!1),document.removeEventListener("mozfullscreenchange",u,!1),l.removeEventListener("msfullscreenchange",u,!1)}if(this.fullscreenErrorHandler_){var d=this.fullscreenErrorHandler_;l.removeEventListener("fullscreenerror",d,!1),l.removeEventListener("webkitfullscreenerror",d,!1),document.removeEventListener("mozfullscreenerror",d,!1),l.removeEventListener("msfullscreenerror",d,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},_e.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},_e.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},_e.prototype.beginPresent_=function(){},_e.prototype.endPresent_=function(){},_e.prototype.submitFrame=function(l){},_e.prototype.getEyeParameters=function(l){return null};var $1={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},ia={LEFT:"left",RIGHT:"right"};function ze(l){var u=ee({},$1);l=ee(u,l||{}),_e.call(this,{wakelock:l.MOBILE_WAKE_LOCK}),this.config=l,this.displayName="Cardboard VRDisplay",this.capabilities=new Rh({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new I1(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new _i(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new Ge(this.dpdb_.getDeviceParams(),l.ADDITIONAL_VIEWERS),this.viewerSelector_=new Rt(l.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Co),c()&&window.addEventListener("resize",this.onResize_.bind(this))}return ze.prototype=Object.create(_e.prototype),ze.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},ze.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},ze.prototype._getFieldOfView=function(l){var u;if(l==ia.LEFT)u=this.deviceInfo_.getFieldOfViewLeftEye();else if(l==ia.RIGHT)u=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",l),null;return u},ze.prototype._getEyeOffset=function(l){var u;if(l==ia.LEFT)u=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(l==ia.RIGHT)u=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",l),null;return u},ze.prototype.getEyeParameters=function(l){var u=this._getEyeOffset(l),d=this._getFieldOfView(l),h={offset:u,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(h,"fieldOfView",{enumerable:!0,get:function(){return Xt("VRFieldOfView","VRFrameData's projection matrices"),d}}),h},ze.prototype.onDeviceParamsUpdated_=function(l){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(l),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},ze.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},ze.prototype.beginPresent_=function(){var l=this.layer_.source.getContext("webgl");l||(l=this.layer_.source.getContext("experimental-webgl")),l||(l=this.layer_.source.getContext("webgl2")),l&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(l.canvas.width=V()*this.bufferScale_,l.canvas.height=P()*this.bufferScale_,this.cardboardUI_=new yo(l)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new yo(l)),this.distorter_=new jt(l,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(u){this.viewerSelector_.show(this.layer_.source.parentElement),u.stopPropagation(),u.preventDefault()}.bind(this),function(u){this.exitPresent(),u.stopPropagation(),u.preventDefault()}.bind(this)),this.rotateInstructions_&&(b()&&K()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},ze.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},ze.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},ze.prototype.submitFrame=function(l){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var u=this.layer_.source.getContext("webgl");u||(u=this.layer_.source.getContext("experimental-webgl")),u||(u=this.layer_.source.getContext("webgl2"));var d=u.canvas;(d.width!=this.lastWidth||d.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=d.width,this.lastHeight=d.height,this.cardboardUI_.render()}},ze.prototype.onOrientationChange_=function(l){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},ze.prototype.onResize_=function(l){if(this.layer_){var u=this.layer_.source.getContext("webgl");u||(u=this.layer_.source.getContext("experimental-webgl")),u||(u=this.layer_.source.getContext("webgl2"));var d=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];u.canvas.setAttribute("style",d.join("; ")+";"),me(u.canvas)}},ze.prototype.onViewerChanged_=function(l){this.deviceInfo_.setViewer(l),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},ze.prototype.fireVRDisplayDeviceParamsChange_=function(){var l=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(l)},ze.VRFrameData=K1,ze.VRDisplay=_e,ze})});function Ri(n,e,t){return typeof n===e||n instanceof t}function Z(n){return Ri(n,"function",Function)}function X(n){return Ri(n,"string",String)}function Pt(n){return Ri(n,"boolean",Boolean)}function fe(n){return Ri(n,"number",Number)}function sa(n){return L(n)||!Number.isFinite(n)||Number.isNaN(n)}function At(n){return fe(n)&&!sa(n)}function On(n){return g(n)&&Ri(n,"object",Object)}function aa(n){return n instanceof Date}function nt(n){return n instanceof Array}function xe(n,e){throw new Error((e||"Unexpected object: ")+n)}function L(n){return n==null}function g(n){return!L(n)}function Ph(n){return n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Int8Array||n instanceof Uint16Array||n instanceof Int16Array||n instanceof Uint32Array||n instanceof Int32Array||n instanceof Float32Array||n instanceof Float64Array||"BigUint64Array"in globalThis&&n instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&n instanceof globalThis.BigInt64Array}function Vh(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Ih(n){return On(n)&&"compareTo"in n&&Z(n.compareTo)}function on(n,...e){let t=null;X(n)?t=n:(t="ascending",e.unshift(n));let o=t==="ascending"?1:-1;return Object.assign((i,s)=>{if(i===s)return 0;for(let a of e){let c=L(i)?null:a(i),p=L(s)?null:a(s),m=c===p?0:X(c)&&X(p)?o*c.localeCompare(p):Ih(c)&&Ih(p)?o*c.compareTo(p):t==="ascending"&&c>p||t==="descending"&&c<p?1:-1;if(m!==0)return m}return 0},{direction:t})}function Oh(n,e,t,o="search"){let r=0,i=n.length-1;for(;r<=i;){let s=r+i>>1,a=t(n[s],e);if(a===0){if(o!=="search"){let c=o==="append"?1:-1;for(c>0&&(s+=c);0<=s&&s<n.length&&(a=t(n[s],e))===0;)s+=c;c<0&&(s-=c)}return s}else a<0?r=s-a:i=s-a}return-r-1}function wr(n,e,t,o="search"){let r=o!=="set";o==="set"&&(o="search");let i=null;if(fe(t)?i=t:i=Oh(n,e,t,o),i<0)i=-i-1;else if(!r)return-1;return Iu(n,e,i),i}function Wh(n,e,t){let o=Oh(n,e,t);return o>=0?(Pi(n,o),o):-1}function de(n){return n.splice(0)}function ca(n,e){for(let t=0;t<n.length;++t)if(n[t]!==e[t])return t;return-1}function Iu(n,e,t){n.splice(t,0,e)}function Hh(n,e){let t=e!=null?1:0,o=Math.floor(Math.random()*(n.length+t))-t;return o<0?e:n[o]}function Ke(n,e){let t=n.indexOf(e);return t>-1?(Pi(n,t),!0):!1}function aF(n,e){for(let t=n.length-1;t>=0;--t)if(e(n[t]))return Pi(n,t);return null}function Nh(n,e,t){return aF(n,o=>t(o)===e)}function Pi(n,e){return n.splice(e,1)[0]}function Uh(n,...e){n.splice(0,n.length,...e)}function cF(n,e,t){let o=n?0:e.length-1,r=n?e.length:-1,i=n?1:-1;for(let s of t)for(let a=o;a!=r;a+=i){let c=e[a];if(s(c))return c}return null}function pt(n,...e){return cF(!0,n,e)}function Gh(n){if(n.status>=400)throw new Error("Resource could not be retrieved: "+n.requestPath);return n}function dt(n){let{content:e}=Gh(n);return e}var Fr=class{constructor(){this.listeners=new Map,this.listenerOptions=new Map,this.bubblers=new Set,this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addScopedEventListener(e,t,o,r){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([t,o]),this.addEventListener(t,o,r)}removeScope(e){let t=this.scopes.get(e);if(t){this.scopes.delete(e);for(let[o,r]of t)this.removeEventListener(o,r)}}addEventListener(e,t,o){let r=this.listeners.get(e);r||(r=new Array,this.listeners.set(e,r)),r.find(i=>i===t)||(r.push(t),o&&this.listenerOptions.set(t,o))}removeEventListener(e,t){let o=this.listeners.get(e);o&&this.removeListener(o,t)}clearEventListeners(e){for(let[t,o]of this.listeners)if(L(e)||e===t){for(let r of o)this.removeEventListener(e,r);de(o),this.listeners.delete(t)}}removeListener(e,t){let o=e.findIndex(r=>r===t);o>=0&&(Pi(e,o),this.listenerOptions.has(t)&&this.listenerOptions.delete(t))}dispatchEvent(e){let t=this.listeners.get(e.type);if(t)for(let o of t){let r=this.listenerOptions.get(o);g(r)&&!Pt(r)&&r.once&&this.removeListener(t,o),Z(o)?o.call(this,e):o.handleEvent(e)}if(e.defaultPrevented)return!1;for(let o of this.bubblers)if(!o.dispatchEvent(e))return!1;return!0}};var G=class extends Event{get type(){return super.type}constructor(e,t){super(e,t)}},oe=class extends Fr{addBubbler(e){super.addBubbler(e)}removeBubbler(e){super.removeBubbler(e)}addScopedEventListener(e,t,o,r){super.addScopedEventListener(e,t,o,r)}addEventListener(e,t,o){super.addEventListener(e,t,o)}removeEventListener(e,t){super.removeEventListener(e,t)}clearEventListeners(e){return super.clearEventListeners(e)}};var Wn=class extends oe{constructor(){super(...arguments),this.attached=new Array,this.soFar=null,this.total=null,this.msg=null,this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(e,t,o,r){this.soFar=e,this.total=t,this.msg=o,this.est=r;for(let i of this.attached)i.report(e,t,o,r)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(e){this.report(0,1,e||"starting")}end(e){this.report(1,1,e||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,de(this.attached)}};var Vi=class extends Wn{constructor(e,t){super(),this.i=e,this.prog=t}report(e,t,o,r){super.report(e,t,o,r),this.prog.update(this.i,e,t,o)}};var Ar=class{constructor(e){this.prog=e,this.weightTotal=0,this.subProgressCallbacks=new Array,this.subProgressWeights=new Array,this.subProgressValues=new Array,this.start=performance.now();for(let t=0;t<this.subProgressWeights.length;++t)this.subProgressValues[t]=0,this.subProgressCallbacks[t]=new Vi(t,this)}addSubProgress(e){e=e||1,this.weightTotal+=e,this.subProgressWeights.push(e),this.subProgressValues.push(0);let t=new Vi(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(t),t}update(e,t,o,r){if(this.prog){this.subProgressValues[e]=t/o;let i=0;for(let p=0;p<this.subProgressWeights.length;++p)i+=this.subProgressValues[p]*this.subProgressWeights[p];let s=performance.now(),a=s-this.start,c=this.start-s+a*this.weightTotal/i;this.prog.report(i,this.weightTotal,r,c)}}};function Hn(n,e){return new Ou(e,n).subProgressCallbacks}function zh(n,e){let t=new Array(e);for(let o=0;o<e;++o)t[o]=1;return Hn(n,t)}var Ou=class extends Ar{constructor(e,t){super(t);for(let o of e)this.addSubProgress(o)}};async function Wu(n,e){let t=new Array(e.length),o=new Array(e.length);for(let s=0;s<e.length;++s){let a=e[s];t[s]=a[0],o[s]=a[1]}let r=Hn(n,t),i=new Array(e.length);for(let s=0;s<e.length;++s)i[s]=o[s](r[s]);return await Promise.all(i)}function la(n,...e){let t=e.map(o=>[1,o]);return Wu(n,t)}var se=class{constructor(e=!0){this.autoStart=e,this.onThens=new Array,this.onCatches=new Array,this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",this.resolve=t=>{if(this.running){this._result=t,this._resultState="resolved";for(let o of this.onThens)o(t);this.clear(),this._executionState="finished"}},this.reject=t=>{if(this.running){this._error=t,this._resultState="errored";for(let o of this.onCatches)o(t);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){de(this.onThens),de(this.onCatches)}start(){this._executionState="running"}resolver(e){return()=>this.resolve(e)}resolveOn(e,t,o){let r=this.resolver(o);e.addEventListener(t,r),this.finally(()=>e.removeEventListener(t,r))}get result(){if(g(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((e,t)=>{this.finished?this.errored?t(this.error):e(this.result):(this.onThens.push(e),this.onCatches.push(t))})}then(e,t){return this.project().then(e,t)}catch(e){return this.project().catch(e)}finally(e){return this.project().finally(e)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(e){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",e&&this.start()}};function Vt(n){return n}function Xh(){return!0}function jh(){return!1}function qh(n,e){return n&&e}function Qh(n,e){return"on"+e in n}function Ce(n,e,t,...o){L(o)&&(o=[]);let r;if(X(t)?o.unshift(t):fe(t)&&(r=t),!(n instanceof Fr)){if(!Qh(n,e))throw new Error(`Target does not have a ${e} rejection event`);for(let c of o)if(!Qh(n,c))throw new Error(`Target does not have a ${c} rejection event`)}let i=new se;if(fe(r)){let c=setTimeout(i.reject,r,`'${e}' has timed out.`);i.finally(clearTimeout.bind(globalThis,c))}let s=(c,p)=>{n.addEventListener(c,p),i.finally(()=>n.removeEventListener(c,p))};s(e,c=>i.resolve(c));let a=c=>i.reject(c);for(let c of o)s(c,a);return i}function rn(n){return n.then(Xh).catch(jh)}var Jh=/([^\/]+)\/(.+)/,lF=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/;var _r=class n{constructor(e,t,o){this._type=e,this._fullSubType=t,this._primaryExtension=null,this.depMessage=null;let r=new Map;this._parameters=r;let i=this._fullSubType.match(lF);this._tree=i[1],this._subType=i[2],this._suffix=i[3];let s=i[4];if(this._value=this._fullValue=this._type+"/",g(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,g(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),g(s)){let a=s.split(";").map(c=>c.trim()).filter(c=>c.length>0).map(c=>c.split("="));for(let[c,...p]of a){let m=p.join("=");r.set(c,m);let x=`; ${c}=${m}`;this._fullValue+=x,c!=="q"&&(this._value+=x)}}this._extensions=o||[],this._primaryExtension=this._extensions[0]||null}static parse(e){if(!e)return null;let t=e.match(Jh);if(!t)return null;let o=t[1],r=t[2];return new n(o,r)}deprecate(e){return this.depMessage=e,this}check(){g(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(e){if(L(e))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let t=null,o=null;if(X(e)){let r=e.match(Jh);if(!r)return!1;t=r[1],o=r[2]}else t=e.typeName,o=e._fullSubType;return this.typeName===t&&(this._fullSubType==="*"||this._fullSubType===o)}withParameter(e,t){let o=`${this._fullSubType}; ${e}=${t}`;return new n(this.typeName,o,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}toFileSystemAPIAccepts(){return{[this.value]:this.extensions.map(e=>"."+e)}}addExtension(e){if(!e)throw new Error("File name is not defined");return this.primaryExtension&&(e=n.removeExtension(e),e=`${e}.${this.primaryExtension}`),e}static removeExtension(e){let t=e.lastIndexOf(".");return t>-1&&(e=e.substring(0,t)),e}};function uF(n,e,...t){return new _r(n,e,t)}function $e(n){return uF.bind(null,n)}var Hu=$e("application");var Nn=Hu("javascript","js");var Nu=Hu("json","json");var Uu=Hu("wasm","wasm");var pF=$e("audio");var vn=pF("mpeg","mp3","mp2","mp2a","mpga","m2a","m3a");var Yh=$e("image");var Gu=Yh("jpeg","jpeg","jpg","jpe");var Kh=Yh("png","png");var $h=$e("model");var Bo=$h("gltf-binary","glb"),Zh=$h("gltf+json","gltf");var zu=$e("text");var Ii=zu("css","css");var ua=zu("plain","txt","text","conf","def","list","log","in");var em=zu("xml");var dF=$e("video");var tm=dF("vnd.mpeg.dash.mpd","mpd");function Xu(n,...e){if(!On(n))return!1;n=n;for(let t of e){if(!(t in n))return!1;let o=n[t];if(!Z(o))return!1}return!0}function hF(n){return Xu(n,"dispose")}function mF(n){return Xu(n,"destroy")}function fF(n){return Xu(n,"close")}function ae(n){hF(n)&&n.dispose(),fF(n)&&n.close(),mF(n)&&n.destroy()}function nm(n,e){try{return e(n)}finally{ae(n)}}var xF="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function ht(n,e){if(n<0)throw new Error("Length must be greater than 0");L(e)&&(e=xF);let t="";for(let o=0;o<n;++o){let r=Math.floor(Math.random()*e.length);t+=e[r]}return t}var om=new Map,pa=class{constructor(e,t,o,...r){this.key=e,this.value=t,this.bySetAttribute=o,this.tags=r.map(i=>i.toLocaleUpperCase()),Object.freeze(this)}applyToElement(e){if(this.tags.length>0&&this.tags.indexOf(e.tagName)===-1){let t=om.get(e.tagName);t||om.set(e.tagName,t=new Set),t.has(this.key)||(t.add(this.key),console.warn(`Element ${e.tagName} does not support Attribute ${this.key}`))}this.bySetAttribute?e.setAttribute(this.key,this.value.toString()):this.key in e?e[this.key]=this.value:this.value===!1?e.removeAttribute(this.key):this.value===!0?e.setAttribute(this.key,""):Z(this.value)?this.value(e):e.setAttribute(this.key,this.value.toString())}};function Be(n,e,t,...o){return new pa(n,e,t,...o)}function Oi(n){return n instanceof pa}function Sn(n){return Be("autoplay",n,!1,"audio","video")}function da(n){return Be("checked",n,!1,"command","input")}function he(...n){return n=n.filter(Vt),Be("CLASS_LIST",e=>e.classList.add(...n),!1)}function qt(n){return Be("controls",n,!1,"audio","video")}function ha(n,e){return Be("data-"+n.toLowerCase(),e,!0)}function rm(n){return Be("htmlFor",n,!1,"label","output")}function im(n){return Be("height",n,!1,"canvas","embed","iframe","img","input","object","video")}function Lo(n){return Be("id",n,!1)}function Un(n){return Be("loop",n,!1,"audio","bgsound","marquee","video")}function Ro(n){return Be("max",n,!1,"input","meter","progress")}function Po(n){return Be("min",n,!1,"input","meter")}function ma(n){return Be("muted",n,!1,"audio","video")}function ju(n){return Be("rel",n,!1,"a","area","link")}function sm(n){return Be("selected",n,!1,"option")}function gF(n){return n instanceof URL&&(n=n.href),n}function Gn(n){return Be("src",gF(n),!1,"audio","embed","iframe","img","input","script","source","track","video")}function Wi(n){return Be("srcObject",n,!1,"audio","video")}function Vo(n){return Be("step",n,!1,"input")}function fa(n){return Be("title",n,!1)}function zn(n){return X(n)||(n=n.value),Be("type",n,!1,"button","input","command","embed","link","object","script","source","style","menu")}function sn(n){return Be("value",n,!1,"button","data","input","li","meter","option","progress","param")}function am(n){return Be("width",n,!1,"canvas","embed","iframe","img","input","object","video")}function Xn(n){return`${n}%`}function Io(n){return`${n}em`}function xa(n){return`${n}px`}function cm(n){return`${n}pt`}function lm(n){return`${n}fr`}function mt(...n){return`rgb(${n.join(", ")})`}function vr(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}var qu=class{constructor(e){this._value=e}get value(){return this._value}toString(){return this.value}},Qu=class{constructor(e,t,o){this.pre=e,this.props=t,this.post=o}get value(){return this.pre+this.props.map(e=>e.toString()).join(`
`)+this.post}toString(){return this.value}applyToSheet(e){e.insertRule(this.toString(),e.cssRules.length)}},Ju=class extends qu{constructor(e,t,o){super(o),this._name=e,this.sep=t}get name(){return this._name}toString(){return this.name+this.sep+this.value+";"}},Yu=class extends Qu{constructor(e,t){super(e+` {
`,t,`
}
`)}},Ku=class extends Ju{constructor(e,t){super(e,": ",t)}},ye=class extends Ku{constructor(e,t){super(e.replace(/[A-Z]/g,o=>`-${o.toLocaleLowerCase()}`),t.toString()),this.key=e,this.priority=""}applyToElement(e){e.style[this.key]=this.value+this.priority}important(){return this.priority=" !important",this}get value(){return super.value+this.priority}};function Zu(n){return n instanceof ye}var $u=class extends Yu{constructor(e,t){super(e,t)}};function ga(n,...e){return new $u(n,e)}function um(n){return new ye("alignItems",n)}function pm(n){return new ye("backgroundColor",n)}function dm(n){return new ye("columnGap",n)}function at(n){return new ye("display",n)}function hm(n){return new ye("flexDirection",n)}function mm(n){return new ye("fontSize",n)}function fm(...n){return new ye("gap",n.join(" "))}function xm(...n){return new ye("gridTemplateColumns",n.join(" "))}function gm(n){return new ye("height",n)}function ep(...n){return new ye("margin",n.join(" "))}function wm(n){return new ye("maxWidth",n)}function Fm(n){return new ye("minHeight",n)}function Am(...n){return new ye("padding",n.join(" "))}function _m(n){return new ye("paddingRight",n)}function vm(n){return new ye("pointerEvents",n)}function Sm(n){return new ye("position",n)}function Tm(n){return new ye("textAlign",n)}function km(...n){return new ye("transform",n.join(" "))}function Oo(n){return new ye("width",n)}function wa(n){return On(n)?n.element instanceof Element:!1}function Tn(n){return wa(n)?n.element:X(n)?Em(n):n}function Mm(n){return On(n)&&"applyToElement"in n&&Z(n.applyToElement)}function bm(n){return n instanceof Element||wa(n)||Mm(n)||X(n)||fe(n)||Pt(n)||aa(n)}function Ze(n,e,t=""){n=Tn(n),e?(n.style.removeProperty("display"),getComputedStyle(n).display==="none"&&(n.style.display=t||"block")):n.style.display="none"}function It(n){return n=Tn(n),n.style.display!=="none"}function te(n,...e){let t=n instanceof Element||n instanceof ShadowRoot?n:X(n)?document.querySelector(n):n.element,o=t instanceof HTMLTemplateElement?t.content:t;for(let r of e)g(r)&&(r instanceof Node?o.appendChild(r):wa(r)?o.appendChild(Tn(r)):Mm(r)?t instanceof ShadowRoot||r.applyToElement(t):o.appendChild(document.createTextNode(r.toLocaleString())));return t}function Em(n){return document.querySelector(n)}function ym(n){return Array.from(document.querySelectorAll(n))}function Dm(n){return Em(n)}function et(n,...e){let t=null,o=e.filter(Oi).filter(r=>r.key==="id"||r.key==="query");for(let r of o)r.key==="query"?(t=r.value,Ke(e,r)):r.key==="id"&&(t=document.getElementById(r.value),t&&Ke(e,r));return t&&t.tagName!==n.toUpperCase()&&console.warn(`Expected a "${n.toUpperCase()}" element but found a "${t.tagName}".`),t||(t=document.createElement(n)),te(t,...e),t}function Hi(n){return On(n)&&"disabled"in n&&Pt(n.disabled)}function Ni(n){for(n=Tn(n);n.lastChild;)n.lastChild.remove()}function Fa(n,e){n=Tn(n),Ni(n),n.append(FF(e))}function Cm(n,e,t){n=Tn(n);let o=g(t),r=o&&n.classList.contains(t);o&&r!==e&&n.classList.toggle(t)}async function Bm(n,e,t){g(t)&&t.start();let o=n==="canplay"?e.HAVE_CURRENT_DATA:e.HAVE_ENOUGH_DATA;if(e.readyState>=o)return!0;try{return await Ce(e,n,"error"),!0}catch(r){return console.warn(e.error,r),!1}finally{g(t)&&t.end()}}function Lm(n,e){return Bm("canplay",n,e)}function Aa(n,e){return Bm("canplaythrough",n,e)}function an(...n){return et("audio",...n)}function wF(...n){return et("button",...n)}function Rm(...n){return wF(...n,zn("button"))}function jn(...n){return Rm(...n,he("btn","btn-primary"))}function _a(...n){return Rm(...n,he("btn","btn-secondary"))}function Sr(...n){return et("canvas",...n)}function tp(...n){return et("dd",...n)}function ge(...n){return et("div",...n)}function Pm(...n){return et("dl",...n)}function Vm(...n){return et("dt",...n)}function Im(...n){return et("h1",...n)}function Om(...n){return et("h2",...n)}function kn(...n){return et("img",...n)}function np(...n){return et("input",...n)}function op(...n){return et("label",...n)}function Tr(n,e,t){return Tn(t).id=n,[op(rm(n),e),t]}function Wm(...n){return et("link",...n)}function Hm(...n){return et("meter",...n)}function va(...n){return et("option",...n)}function Nm(...n){return et("script",...n)}function Sa(...n){return et("select",...n)}function Ui(...n){return et("video",...n)}function Gi(...n){return np(zn("checkbox"),...n)}function kr(...n){return np(zn("number"),...n)}function Um(...n){return np(zn("range"),...n)}function FF(n){return document.createTextNode(n)}function Ta(...n){let e=document.createElement("style");document.head.append(e);for(let t of n)t.applyToSheet(e.sheet);return e}var zi="HTMLCanvasElement"in globalThis,aT="HTMLImageElement"in globalThis,rp=!1,Wo=!rp&&"OffscreenCanvas"in globalThis,AF=!rp&&"createImageBitmap"in globalThis;function Qt(n){return zi&&n instanceof HTMLCanvasElement}function ka(n){return Wo&&n instanceof OffscreenCanvas}function Gm(n){return AF&&n instanceof ImageBitmap}function zm(n){return n instanceof ImageData}function _F(n){return Qt(n)||ka(n)}function Xm(n,e){let t=n.getContext("2d");if(L(t))throw new Error("Could not create 2d context for canvas");t.drawImage(e,0,0)}function jm(n,e){let t=n.getContext("2d");if(L(t))throw new Error("Could not create 2d context for canvas");t.putImageData(e,0,0)}function vF(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var ip=Wo&&vF(),Mn=ip&&Xi||zi&&Ho||null,Ma=zi?Ho:Mn;function SF(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var cT=Wo&&SF();function Xi(n,e){return new OffscreenCanvas(n,e)}function Ho(n,e){return Sr(am(n),im(e))}function TF(n){let e=Xi(n.width,n.height);return Xm(e,n),e}function kF(n){let e=Ho(n.width,n.height);return Xm(e,n),e}var qm=ip&&TF||zi&&kF||null;function MF(n){let e=Xi(n.width,n.height);return jm(e,n),e}function bF(n){let e=Ho(n.width,n.height);return jm(e,n),e}var Qm=ip&&MF||zi&&bF||null;function ba(n,e){let t=n.getContext("2d");if(L(t))throw new Error("Could not create 2d context for canvas");t.drawImage(e,0,0)}function Ea(n){let e=Ho(n.width,n.height);return ba(e,n),e}async function Mr(n){let e=kn(Gn(n));return await Ce(e,"load","error"),e}function Jm(n,e,t,o=1){return e=Math.floor(e*o),t=Math.floor(t*o),n.width!=e||n.height!=t?(n.width=e,n.height=t,!0):!1}function EF(n){return g(n.textBaseline)}function yF(n,e,t,o=1){let r=n.imageSmoothingEnabled,i=n.textBaseline,s=n.textAlign,a=n.font,c=Jm(n.canvas,e,t,o);return c&&(n.imageSmoothingEnabled=r,n.textBaseline=i,n.textAlign=s,n.font=a),c}function ya(n,e,t,o=1){return EF(n)?yF(n,e,t,o):Jm(n.canvas,e,t,o)}function Ym(n,e=1){return ya(n,n.canvas.clientWidth,n.canvas.clientHeight,e)}function sp(n,e,t){if(e instanceof _r&&(e=e.value),ka(n))return n.convertToBlob({type:e,quality:t});if(Qt(n)){let o=new se;return n.toBlob(o.resolve,e,t),o}else throw new Error("Cannot save image from canvas")}function qn(n){_F(n)?n.width=n.height=0:ae(n)}var ct=1e-6,Le=typeof Float32Array<"u"?Float32Array:Array,cn=Math.random;var uT=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});function Km(){var n=new Le(9);return Le!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}var br={};Vu(br,{add:()=>C0,calculateW:()=>A0,clone:()=>b0,conjugate:()=>T0,copy:()=>y0,create:()=>lp,dot:()=>kf,equals:()=>I0,exactEquals:()=>V0,exp:()=>_f,fromEuler:()=>k0,fromMat3:()=>Sf,fromValues:()=>E0,getAngle:()=>x0,getAxisAngle:()=>f0,identity:()=>m0,invert:()=>S0,len:()=>R0,length:()=>Mf,lerp:()=>L0,ln:()=>vf,mul:()=>B0,multiply:()=>Af,normalize:()=>up,pow:()=>_0,random:()=>v0,rotateX:()=>g0,rotateY:()=>w0,rotateZ:()=>F0,rotationTo:()=>O0,scale:()=>Tf,set:()=>D0,setAxes:()=>H0,setAxisAngle:()=>Ff,slerp:()=>La,sqlerp:()=>W0,sqrLen:()=>P0,squaredLength:()=>bf,str:()=>M0});var tt={};Vu(tt,{add:()=>RF,angle:()=>e0,bezier:()=>jF,ceil:()=>PF,clone:()=>CF,copy:()=>BF,create:()=>Da,cross:()=>qi,dist:()=>c0,distance:()=>nf,div:()=>a0,divide:()=>tf,dot:()=>Ba,equals:()=>r0,exactEquals:()=>o0,floor:()=>VF,forEach:()=>p0,fromValues:()=>Ca,hermite:()=>XF,inverse:()=>GF,len:()=>cp,length:()=>$m,lerp:()=>zF,max:()=>OF,min:()=>IF,mul:()=>s0,multiply:()=>ef,negate:()=>UF,normalize:()=>ap,random:()=>qF,rotateX:()=>KF,rotateY:()=>$F,rotateZ:()=>ZF,round:()=>WF,scale:()=>HF,scaleAndAdd:()=>NF,set:()=>LF,sqrDist:()=>l0,sqrLen:()=>u0,squaredDistance:()=>of,squaredLength:()=>rf,str:()=>n0,sub:()=>i0,subtract:()=>Zm,transformMat3:()=>JF,transformMat4:()=>QF,transformQuat:()=>YF,zero:()=>t0});function Da(){var n=new Le(3);return Le!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function CF(n){var e=new Le(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function $m(n){var e=n[0],t=n[1],o=n[2];return Math.hypot(e,t,o)}function Ca(n,e,t){var o=new Le(3);return o[0]=n,o[1]=e,o[2]=t,o}function BF(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function LF(n,e,t,o){return n[0]=e,n[1]=t,n[2]=o,n}function RF(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function Zm(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function ef(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n}function tf(n,e,t){return n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n}function PF(n,e){return n[0]=Math.ceil(e[0]),n[1]=Math.ceil(e[1]),n[2]=Math.ceil(e[2]),n}function VF(n,e){return n[0]=Math.floor(e[0]),n[1]=Math.floor(e[1]),n[2]=Math.floor(e[2]),n}function IF(n,e,t){return n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.min(e[2],t[2]),n}function OF(n,e,t){return n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n}function WF(n,e){return n[0]=Math.round(e[0]),n[1]=Math.round(e[1]),n[2]=Math.round(e[2]),n}function HF(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function NF(n,e,t,o){return n[0]=e[0]+t[0]*o,n[1]=e[1]+t[1]*o,n[2]=e[2]+t[2]*o,n}function nf(n,e){var t=e[0]-n[0],o=e[1]-n[1],r=e[2]-n[2];return Math.hypot(t,o,r)}function of(n,e){var t=e[0]-n[0],o=e[1]-n[1],r=e[2]-n[2];return t*t+o*o+r*r}function rf(n){var e=n[0],t=n[1],o=n[2];return e*e+t*t+o*o}function UF(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function GF(n,e){return n[0]=1/e[0],n[1]=1/e[1],n[2]=1/e[2],n}function ap(n,e){var t=e[0],o=e[1],r=e[2],i=t*t+o*o+r*r;return i>0&&(i=1/Math.sqrt(i)),n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Ba(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function qi(n,e,t){var o=e[0],r=e[1],i=e[2],s=t[0],a=t[1],c=t[2];return n[0]=r*c-i*a,n[1]=i*s-o*c,n[2]=o*a-r*s,n}function zF(n,e,t,o){var r=e[0],i=e[1],s=e[2];return n[0]=r+o*(t[0]-r),n[1]=i+o*(t[1]-i),n[2]=s+o*(t[2]-s),n}function XF(n,e,t,o,r,i){var s=i*i,a=s*(2*i-3)+1,c=s*(i-2)+i,p=s*(i-1),m=s*(3-2*i);return n[0]=e[0]*a+t[0]*c+o[0]*p+r[0]*m,n[1]=e[1]*a+t[1]*c+o[1]*p+r[1]*m,n[2]=e[2]*a+t[2]*c+o[2]*p+r[2]*m,n}function jF(n,e,t,o,r,i){var s=1-i,a=s*s,c=i*i,p=a*s,m=3*i*a,x=3*c*s,w=c*i;return n[0]=e[0]*p+t[0]*m+o[0]*x+r[0]*w,n[1]=e[1]*p+t[1]*m+o[1]*x+r[1]*w,n[2]=e[2]*p+t[2]*m+o[2]*x+r[2]*w,n}function qF(n,e){e=e||1;var t=cn()*2*Math.PI,o=cn()*2-1,r=Math.sqrt(1-o*o)*e;return n[0]=Math.cos(t)*r,n[1]=Math.sin(t)*r,n[2]=o*e,n}function QF(n,e,t){var o=e[0],r=e[1],i=e[2],s=t[3]*o+t[7]*r+t[11]*i+t[15];return s=s||1,n[0]=(t[0]*o+t[4]*r+t[8]*i+t[12])/s,n[1]=(t[1]*o+t[5]*r+t[9]*i+t[13])/s,n[2]=(t[2]*o+t[6]*r+t[10]*i+t[14])/s,n}function JF(n,e,t){var o=e[0],r=e[1],i=e[2];return n[0]=o*t[0]+r*t[3]+i*t[6],n[1]=o*t[1]+r*t[4]+i*t[7],n[2]=o*t[2]+r*t[5]+i*t[8],n}function YF(n,e,t){var o=t[0],r=t[1],i=t[2],s=t[3],a=e[0],c=e[1],p=e[2],m=r*p-i*c,x=i*a-o*p,w=o*c-r*a,_=r*w-i*x,T=i*m-o*w,y=o*x-r*m,b=s*2;return m*=b,x*=b,w*=b,_*=2,T*=2,y*=2,n[0]=a+m+_,n[1]=c+x+T,n[2]=p+w+y,n}function KF(n,e,t,o){var r=[],i=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],i[0]=r[0],i[1]=r[1]*Math.cos(o)-r[2]*Math.sin(o),i[2]=r[1]*Math.sin(o)+r[2]*Math.cos(o),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function $F(n,e,t,o){var r=[],i=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],i[0]=r[2]*Math.sin(o)+r[0]*Math.cos(o),i[1]=r[1],i[2]=r[2]*Math.cos(o)-r[0]*Math.sin(o),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function ZF(n,e,t,o){var r=[],i=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],i[0]=r[0]*Math.cos(o)-r[1]*Math.sin(o),i[1]=r[0]*Math.sin(o)+r[1]*Math.cos(o),i[2]=r[2],n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function e0(n,e){var t=n[0],o=n[1],r=n[2],i=e[0],s=e[1],a=e[2],c=Math.sqrt(t*t+o*o+r*r),p=Math.sqrt(i*i+s*s+a*a),m=c*p,x=m&&Ba(n,e)/m;return Math.acos(Math.min(Math.max(x,-1),1))}function t0(n){return n[0]=0,n[1]=0,n[2]=0,n}function n0(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function o0(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}function r0(n,e){var t=n[0],o=n[1],r=n[2],i=e[0],s=e[1],a=e[2];return Math.abs(t-i)<=ct*Math.max(1,Math.abs(t),Math.abs(i))&&Math.abs(o-s)<=ct*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(r-a)<=ct*Math.max(1,Math.abs(r),Math.abs(a))}var i0=Zm,s0=ef,a0=tf,c0=nf,l0=of,cp=$m,u0=rf,p0=function(){var n=Da();return function(e,t,o,r,i,s){var a,c;for(t||(t=3),o||(o=0),r?c=Math.min(r*t+o,e.length):c=e.length,a=o;a<c;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],i(n,n,s),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2];return e}}();function d0(){var n=new Le(4);return Le!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function sf(n){var e=new Le(4);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function af(n,e,t,o){var r=new Le(4);return r[0]=n,r[1]=e,r[2]=t,r[3]=o,r}function cf(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function lf(n,e,t,o,r){return n[0]=e,n[1]=t,n[2]=o,n[3]=r,n}function uf(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n}function pf(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function df(n){var e=n[0],t=n[1],o=n[2],r=n[3];return Math.hypot(e,t,o,r)}function hf(n){var e=n[0],t=n[1],o=n[2],r=n[3];return e*e+t*t+o*o+r*r}function mf(n,e){var t=e[0],o=e[1],r=e[2],i=e[3],s=t*t+o*o+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),n[0]=t*s,n[1]=o*s,n[2]=r*s,n[3]=i*s,n}function ff(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function xf(n,e,t,o){var r=e[0],i=e[1],s=e[2],a=e[3];return n[0]=r+o*(t[0]-r),n[1]=i+o*(t[1]-i),n[2]=s+o*(t[2]-s),n[3]=a+o*(t[3]-a),n}function gf(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]}function wf(n,e){var t=n[0],o=n[1],r=n[2],i=n[3],s=e[0],a=e[1],c=e[2],p=e[3];return Math.abs(t-s)<=ct*Math.max(1,Math.abs(t),Math.abs(s))&&Math.abs(o-a)<=ct*Math.max(1,Math.abs(o),Math.abs(a))&&Math.abs(r-c)<=ct*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-p)<=ct*Math.max(1,Math.abs(i),Math.abs(p))}var pT=function(){var n=d0();return function(e,t,o,r,i,s){var a,c;for(t||(t=4),o||(o=0),r?c=Math.min(r*t+o,e.length):c=e.length,a=o;a<c;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],n[3]=e[a+3],i(n,n,s),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2],e[a+3]=n[3];return e}}();function lp(){var n=new Le(4);return Le!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function m0(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Ff(n,e,t){t=t*.5;var o=Math.sin(t);return n[0]=o*e[0],n[1]=o*e[1],n[2]=o*e[2],n[3]=Math.cos(t),n}function f0(n,e){var t=Math.acos(e[3])*2,o=Math.sin(t/2);return o>ct?(n[0]=e[0]/o,n[1]=e[1]/o,n[2]=e[2]/o):(n[0]=1,n[1]=0,n[2]=0),t}function x0(n,e){var t=kf(n,e);return Math.acos(2*t*t-1)}function Af(n,e,t){var o=e[0],r=e[1],i=e[2],s=e[3],a=t[0],c=t[1],p=t[2],m=t[3];return n[0]=o*m+s*a+r*p-i*c,n[1]=r*m+s*c+i*a-o*p,n[2]=i*m+s*p+o*c-r*a,n[3]=s*m-o*a-r*c-i*p,n}function g0(n,e,t){t*=.5;var o=e[0],r=e[1],i=e[2],s=e[3],a=Math.sin(t),c=Math.cos(t);return n[0]=o*c+s*a,n[1]=r*c+i*a,n[2]=i*c-r*a,n[3]=s*c-o*a,n}function w0(n,e,t){t*=.5;var o=e[0],r=e[1],i=e[2],s=e[3],a=Math.sin(t),c=Math.cos(t);return n[0]=o*c-i*a,n[1]=r*c+s*a,n[2]=i*c+o*a,n[3]=s*c-r*a,n}function F0(n,e,t){t*=.5;var o=e[0],r=e[1],i=e[2],s=e[3],a=Math.sin(t),c=Math.cos(t);return n[0]=o*c+r*a,n[1]=r*c-o*a,n[2]=i*c+s*a,n[3]=s*c-i*a,n}function A0(n,e){var t=e[0],o=e[1],r=e[2];return n[0]=t,n[1]=o,n[2]=r,n[3]=Math.sqrt(Math.abs(1-t*t-o*o-r*r)),n}function _f(n,e){var t=e[0],o=e[1],r=e[2],i=e[3],s=Math.sqrt(t*t+o*o+r*r),a=Math.exp(i),c=s>0?a*Math.sin(s)/s:0;return n[0]=t*c,n[1]=o*c,n[2]=r*c,n[3]=a*Math.cos(s),n}function vf(n,e){var t=e[0],o=e[1],r=e[2],i=e[3],s=Math.sqrt(t*t+o*o+r*r),a=s>0?Math.atan2(s,i)/s:0;return n[0]=t*a,n[1]=o*a,n[2]=r*a,n[3]=.5*Math.log(t*t+o*o+r*r+i*i),n}function _0(n,e,t){return vf(n,e),Tf(n,n,t),_f(n,n),n}function La(n,e,t,o){var r=e[0],i=e[1],s=e[2],a=e[3],c=t[0],p=t[1],m=t[2],x=t[3],w,_,T,y,b;return _=r*c+i*p+s*m+a*x,_<0&&(_=-_,c=-c,p=-p,m=-m,x=-x),1-_>ct?(w=Math.acos(_),T=Math.sin(w),y=Math.sin((1-o)*w)/T,b=Math.sin(o*w)/T):(y=1-o,b=o),n[0]=y*r+b*c,n[1]=y*i+b*p,n[2]=y*s+b*m,n[3]=y*a+b*x,n}function v0(n){var e=cn(),t=cn(),o=cn(),r=Math.sqrt(1-e),i=Math.sqrt(e);return n[0]=r*Math.sin(2*Math.PI*t),n[1]=r*Math.cos(2*Math.PI*t),n[2]=i*Math.sin(2*Math.PI*o),n[3]=i*Math.cos(2*Math.PI*o),n}function S0(n,e){var t=e[0],o=e[1],r=e[2],i=e[3],s=t*t+o*o+r*r+i*i,a=s?1/s:0;return n[0]=-t*a,n[1]=-o*a,n[2]=-r*a,n[3]=i*a,n}function T0(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function Sf(n,e){var t=e[0]+e[4]+e[8],o;if(t>0)o=Math.sqrt(t+1),n[3]=.5*o,o=.5/o,n[0]=(e[5]-e[7])*o,n[1]=(e[6]-e[2])*o,n[2]=(e[1]-e[3])*o;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);var i=(r+1)%3,s=(r+2)%3;o=Math.sqrt(e[r*3+r]-e[i*3+i]-e[s*3+s]+1),n[r]=.5*o,o=.5/o,n[3]=(e[i*3+s]-e[s*3+i])*o,n[i]=(e[i*3+r]+e[r*3+i])*o,n[s]=(e[s*3+r]+e[r*3+s])*o}return n}function k0(n,e,t,o){var r=.5*Math.PI/180;e*=r,t*=r,o*=r;var i=Math.sin(e),s=Math.cos(e),a=Math.sin(t),c=Math.cos(t),p=Math.sin(o),m=Math.cos(o);return n[0]=i*c*m-s*a*p,n[1]=s*a*m+i*c*p,n[2]=s*c*p-i*a*m,n[3]=s*c*m+i*a*p,n}function M0(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"}var b0=sf,E0=af,y0=cf,D0=lf,C0=uf,B0=Af,Tf=pf,kf=ff,L0=xf,Mf=df,R0=Mf,bf=hf,P0=bf,up=mf,V0=gf,I0=wf,O0=function(){var n=Da(),e=Ca(1,0,0),t=Ca(0,1,0);return function(o,r,i){var s=Ba(r,i);return s<-.999999?(qi(n,e,r),cp(n)<1e-6&&qi(n,t,r),ap(n,n),Ff(o,n,Math.PI),o):s>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(qi(n,r,i),o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=1+s,up(o,o))}}(),W0=function(){var n=lp(),e=lp();return function(t,o,r,i,s,a){return La(n,o,s,a),La(e,r,i,a),La(t,n,e,2*a*(1-a)),t}}(),H0=function(){var n=Km();return function(e,t,o,r){return n[0]=o[0],n[3]=o[1],n[6]=o[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],up(e,Sf(e,n))}}();var Ae={};Vu(Ae,{add:()=>X0,angle:()=>pA,ceil:()=>j0,clone:()=>N0,copy:()=>G0,create:()=>Ef,cross:()=>oA,dist:()=>AA,distance:()=>Bf,div:()=>FA,divide:()=>Cf,dot:()=>nA,equals:()=>fA,exactEquals:()=>mA,floor:()=>q0,forEach:()=>SA,fromValues:()=>U0,inverse:()=>eA,len:()=>xA,length:()=>Rf,lerp:()=>rA,max:()=>J0,min:()=>Q0,mul:()=>wA,multiply:()=>Df,negate:()=>Z0,normalize:()=>tA,random:()=>iA,rotate:()=>uA,round:()=>Y0,scale:()=>K0,scaleAndAdd:()=>$0,set:()=>z0,sqrDist:()=>_A,sqrLen:()=>vA,squaredDistance:()=>Lf,squaredLength:()=>Pf,str:()=>hA,sub:()=>gA,subtract:()=>yf,transformMat2:()=>sA,transformMat2d:()=>aA,transformMat3:()=>cA,transformMat4:()=>lA,zero:()=>dA});function Ef(){var n=new Le(2);return Le!=Float32Array&&(n[0]=0,n[1]=0),n}function N0(n){var e=new Le(2);return e[0]=n[0],e[1]=n[1],e}function U0(n,e){var t=new Le(2);return t[0]=n,t[1]=e,t}function G0(n,e){return n[0]=e[0],n[1]=e[1],n}function z0(n,e,t){return n[0]=e,n[1]=t,n}function X0(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function yf(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}function Df(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n}function Cf(n,e,t){return n[0]=e[0]/t[0],n[1]=e[1]/t[1],n}function j0(n,e){return n[0]=Math.ceil(e[0]),n[1]=Math.ceil(e[1]),n}function q0(n,e){return n[0]=Math.floor(e[0]),n[1]=Math.floor(e[1]),n}function Q0(n,e,t){return n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n}function J0(n,e,t){return n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n}function Y0(n,e){return n[0]=Math.round(e[0]),n[1]=Math.round(e[1]),n}function K0(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n}function $0(n,e,t,o){return n[0]=e[0]+t[0]*o,n[1]=e[1]+t[1]*o,n}function Bf(n,e){var t=e[0]-n[0],o=e[1]-n[1];return Math.hypot(t,o)}function Lf(n,e){var t=e[0]-n[0],o=e[1]-n[1];return t*t+o*o}function Rf(n){var e=n[0],t=n[1];return Math.hypot(e,t)}function Pf(n){var e=n[0],t=n[1];return e*e+t*t}function Z0(n,e){return n[0]=-e[0],n[1]=-e[1],n}function eA(n,e){return n[0]=1/e[0],n[1]=1/e[1],n}function tA(n,e){var t=e[0],o=e[1],r=t*t+o*o;return r>0&&(r=1/Math.sqrt(r)),n[0]=e[0]*r,n[1]=e[1]*r,n}function nA(n,e){return n[0]*e[0]+n[1]*e[1]}function oA(n,e,t){var o=e[0]*t[1]-e[1]*t[0];return n[0]=n[1]=0,n[2]=o,n}function rA(n,e,t,o){var r=e[0],i=e[1];return n[0]=r+o*(t[0]-r),n[1]=i+o*(t[1]-i),n}function iA(n,e){e=e||1;var t=cn()*2*Math.PI;return n[0]=Math.cos(t)*e,n[1]=Math.sin(t)*e,n}function sA(n,e,t){var o=e[0],r=e[1];return n[0]=t[0]*o+t[2]*r,n[1]=t[1]*o+t[3]*r,n}function aA(n,e,t){var o=e[0],r=e[1];return n[0]=t[0]*o+t[2]*r+t[4],n[1]=t[1]*o+t[3]*r+t[5],n}function cA(n,e,t){var o=e[0],r=e[1];return n[0]=t[0]*o+t[3]*r+t[6],n[1]=t[1]*o+t[4]*r+t[7],n}function lA(n,e,t){var o=e[0],r=e[1];return n[0]=t[0]*o+t[4]*r+t[12],n[1]=t[1]*o+t[5]*r+t[13],n}function uA(n,e,t,o){var r=e[0]-t[0],i=e[1]-t[1],s=Math.sin(o),a=Math.cos(o);return n[0]=r*a-i*s+t[0],n[1]=r*s+i*a+t[1],n}function pA(n,e){var t=n[0],o=n[1],r=e[0],i=e[1],s=Math.sqrt(t*t+o*o)*Math.sqrt(r*r+i*i),a=s&&(t*r+o*i)/s;return Math.acos(Math.min(Math.max(a,-1),1))}function dA(n){return n[0]=0,n[1]=0,n}function hA(n){return"vec2("+n[0]+", "+n[1]+")"}function mA(n,e){return n[0]===e[0]&&n[1]===e[1]}function fA(n,e){var t=n[0],o=n[1],r=e[0],i=e[1];return Math.abs(t-r)<=ct*Math.max(1,Math.abs(t),Math.abs(r))&&Math.abs(o-i)<=ct*Math.max(1,Math.abs(o),Math.abs(i))}var xA=Rf,gA=yf,wA=Df,FA=Cf,AA=Bf,_A=Lf,vA=Pf,SA=function(){var n=Ef();return function(e,t,o,r,i,s){var a,c;for(t||(t=2),o||(o=0),r?c=Math.min(r*t+o,e.length):c=e.length,a=o;a<c;a+=t)n[0]=e[a],n[1]=e[a+1],i(n,n,s),e[a]=n[0],e[a+1]=n[1];return e}}();var Te=Math.PI,je=.5*Te,_t=2*Te;var TA=864e13,mT=-TA;function Qn(n){return(n%_t+_t)%_t}function Jn(n,e,t){return Math.min(t,Math.max(e,n))}function Oe(n){return n*_t/360}function Qi(n){return n*360/_t}function Vf(...n){let e=Number.MAX_VALUE;for(let t of n)Math.abs(t)<e&&(e=t);return e}function If(n,e,t){return(1-t)*n+t*e}function pp(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function Of(n){return Math.abs(n)>1e-4?n:0}function Wf(n,e,t){let o=e.map(()=>1),r=Hn(n,o);return Promise.all(e.map(async(i,s)=>{let a=r[s];a.start();let c=await t(i,a,s);return a.end(),c}))}var{ACESFilmicToneMapping:wT,AddEquation:FT,AddOperation:AT,AdditiveAnimationBlendMode:_T,AdditiveBlending:vT,AlphaFormat:ST,AlwaysDepth:TT,AlwaysStencilFunc:kT,AmbientLight:Ra,AmbientLightProbe:MT,AnimationClip:Hf,AnimationLoader:bT,AnimationMixer:ET,AnimationObjectGroup:yT,AnimationUtils:DT,ArcCurve:CT,ArrayCamera:BT,ArrowHelper:LT,Audio:RT,AudioAnalyser:PT,AudioContext:VT,AudioListener:IT,AudioLoader:OT,AxesHelper:WT,BackSide:Nf,BasicDepthPacking:HT,BasicShadowMap:NT,Bone:Uf,BooleanKeyframeTrack:UT,Box2:GT,Box3:No,Box3Helper:zT,BoxBufferGeometry:XT,BoxGeometry:Pa,BoxHelper:jT,BufferAttribute:bn,BufferGeometry:Ji,BufferGeometryLoader:qT,ByteType:QT,Cache:JT,Camera:YT,CameraHelper:KT,CanvasTexture:Gf,CapsuleBufferGeometry:$T,CapsuleGeometry:ZT,CatmullRomCurve3:ek,CineonToneMapping:tk,CircleBufferGeometry:nk,CircleGeometry:ok,ClampToEdgeWrapping:zf,Clock:rk,Color:We,ColorKeyframeTrack:ik,ColorManagement:dp,CompressedArrayTexture:sk,CompressedTexture:ak,CompressedTextureLoader:ck,ConeBufferGeometry:lk,ConeGeometry:uk,CubeCamera:Xf,CubeReflectionMapping:pk,CubeRefractionMapping:dk,CubeTexture:jf,CubeTextureLoader:hk,CubeUVReflectionMapping:mk,CubicBezierCurve:fk,CubicBezierCurve3:xk,CubicInterpolant:gk,CullFaceBack:wk,CullFaceFront:Fk,CullFaceFrontBack:Ak,CullFaceNone:_k,Curve:vk,CurvePath:Sk,CustomBlending:Tk,CustomToneMapping:kk,CylinderBufferGeometry:Mk,CylinderGeometry:qf,Cylindrical:bk,Data3DTexture:Ek,DataArrayTexture:yk,DataTexture:Dk,DataTextureLoader:Ck,DataUtils:Bk,DecrementStencilOp:Lk,DecrementWrapStencilOp:Rk,DefaultLoadingManager:Pk,DepthFormat:Vk,DepthStencilFormat:Ik,DepthTexture:Ok,DirectionalLight:Va,DirectionalLightHelper:Wk,DiscreteInterpolant:Hk,DisplayP3ColorSpace:Nk,DodecahedronBufferGeometry:Uk,DodecahedronGeometry:Gk,DoubleSide:Ia,DstAlphaFactor:zk,DstColorFactor:Xk,DynamicCopyUsage:jk,DynamicDrawUsage:Qf,DynamicReadUsage:qk,EdgesGeometry:Qk,EllipseCurve:Jk,EqualDepth:Yk,EqualStencilFunc:Kk,EquirectangularReflectionMapping:$k,EquirectangularRefractionMapping:Zk,Euler:Oa,EventDispatcher:eM,ExtrudeBufferGeometry:tM,ExtrudeGeometry:nM,FileLoader:hp,Float16BufferAttribute:oM,Float32BufferAttribute:Wa,Float64BufferAttribute:rM,FloatType:iM,Fog:sM,FogExp2:aM,FramebufferTexture:cM,FrontSide:Yi,Frustum:lM,GLBufferAttribute:uM,GLSL1:pM,GLSL3:dM,GreaterDepth:hM,GreaterEqualDepth:mM,GreaterEqualStencilFunc:fM,GreaterStencilFunc:xM,GridHelper:Jf,Group:Er,HalfFloatType:gM,HemisphereLight:wM,HemisphereLightHelper:FM,HemisphereLightProbe:AM,IcosahedronBufferGeometry:_M,IcosahedronGeometry:vM,ImageBitmapLoader:Yf,ImageLoader:SM,ImageUtils:TM,IncrementStencilOp:kM,IncrementWrapStencilOp:MM,InstancedBufferAttribute:kA,InstancedBufferGeometry:Kf,InstancedInterleavedBuffer:Ki,InstancedMesh:Ha,Int16BufferAttribute:bM,Int32BufferAttribute:EM,Int8BufferAttribute:yM,IntType:DM,InterleavedBuffer:mp,InterleavedBufferAttribute:Jt,Interpolant:$f,InterpolateDiscrete:Zf,InterpolateLinear:fp,InterpolateSmooth:CM,InvertStencilOp:BM,KeepStencilOp:LM,KeyframeTrack:RM,LOD:PM,LatheBufferGeometry:VM,LatheGeometry:IM,Layers:OM,LessDepth:WM,LessEqualDepth:HM,LessEqualStencilFunc:NM,LessStencilFunc:UM,Light:GM,LightProbe:zM,Line:ex,Line3:tx,LineBasicMaterial:xp,LineCurve:XM,LineCurve3:jM,LineDashedMaterial:qM,LineLoop:nx,LineSegments:ox,LinearEncoding:rx,LinearFilter:$i,LinearInterpolant:QM,LinearMipMapLinearFilter:JM,LinearMipMapNearestFilter:YM,LinearMipmapLinearFilter:gp,LinearMipmapNearestFilter:ix,LinearSRGBColorSpace:KM,LinearToneMapping:$M,Loader:sx,LoaderUtils:Na,LoadingManager:ZM,LoopOnce:eb,LoopPingPong:tb,LoopRepeat:nb,LuminanceAlphaFormat:ob,LuminanceFormat:rb,MOUSE:ib,Material:Ua,MaterialLoader:sb,MathUtils:Ga,Matrix3:wp,Matrix4:ke,MaxEquation:ab,Mesh:yt,MeshBasicMaterial:ot,MeshDepthMaterial:cb,MeshDistanceMaterial:lb,MeshLambertMaterial:ub,MeshMatcapMaterial:pb,MeshNormalMaterial:db,MeshPhongMaterial:yr,MeshPhysicalMaterial:Yn,MeshStandardMaterial:Fp,MeshToonMaterial:hb,MinEquation:mb,MirroredRepeatWrapping:ax,MixOperation:fb,MultiplyBlending:xb,MultiplyOperation:gb,NearestFilter:za,NearestMipMapLinearFilter:wb,NearestMipMapNearestFilter:Fb,NearestMipmapLinearFilter:cx,NearestMipmapNearestFilter:lx,NeverDepth:Ab,NeverStencilFunc:_b,NoBlending:vb,NoColorSpace:Sb,NoToneMapping:Tb,NormalAnimationBlendMode:kb,NormalBlending:Mb,NotEqualDepth:bb,NotEqualStencilFunc:Eb,NumberKeyframeTrack:ux,Object3D:Re,ObjectLoader:yb,ObjectSpaceNormalMap:Db,OctahedronBufferGeometry:Cb,OctahedronGeometry:Bb,OneFactor:Lb,OneMinusDstAlphaFactor:Rb,OneMinusDstColorFactor:Pb,OneMinusSrcAlphaFactor:Vb,OneMinusSrcColorFactor:Ib,OrthographicCamera:Xa,PCFShadowMap:Ob,PCFSoftShadowMap:Wb,PMREMGenerator:Hb,Path:Nb,PerspectiveCamera:Uo,Plane:Ub,PlaneBufferGeometry:Gb,PlaneGeometry:Kn,PlaneHelper:zb,PointLight:px,PointLightHelper:Xb,Points:dx,PointsMaterial:hx,PolarGridHelper:jb,PolyhedronBufferGeometry:qb,PolyhedronGeometry:Qb,PositionalAudio:Jb,PropertyBinding:mx,PropertyMixer:Yb,QuadraticBezierCurve:Kb,QuadraticBezierCurve3:$b,Quaternion:we,QuaternionKeyframeTrack:Ap,QuaternionLinearInterpolant:Zb,RED_GREEN_RGTC2_Format:eE,RED_RGTC1_Format:tE,REVISION:nE,RGBADepthPacking:oE,RGBAFormat:fx,RGBAIntegerFormat:rE,RGBA_ASTC_10x10_Format:iE,RGBA_ASTC_10x5_Format:sE,RGBA_ASTC_10x6_Format:aE,RGBA_ASTC_10x8_Format:cE,RGBA_ASTC_12x10_Format:lE,RGBA_ASTC_12x12_Format:uE,RGBA_ASTC_4x4_Format:pE,RGBA_ASTC_5x4_Format:dE,RGBA_ASTC_5x5_Format:hE,RGBA_ASTC_6x5_Format:mE,RGBA_ASTC_6x6_Format:fE,RGBA_ASTC_8x5_Format:xE,RGBA_ASTC_8x6_Format:gE,RGBA_ASTC_8x8_Format:wE,RGBA_BPTC_Format:FE,RGBA_ETC2_EAC_Format:AE,RGBA_PVRTC_2BPPV1_Format:_E,RGBA_PVRTC_4BPPV1_Format:vE,RGBA_S3TC_DXT1_Format:SE,RGBA_S3TC_DXT3_Format:TE,RGBA_S3TC_DXT5_Format:kE,RGB_ETC1_Format:ME,RGB_ETC2_Format:bE,RGB_PVRTC_2BPPV1_Format:EE,RGB_PVRTC_4BPPV1_Format:yE,RGB_S3TC_DXT1_Format:DE,RGFormat:CE,RGIntegerFormat:BE,RawShaderMaterial:LE,Ray:RE,Raycaster:xx,RectAreaLight:PE,RedFormat:VE,RedIntegerFormat:IE,ReinhardToneMapping:OE,RepeatWrapping:ja,ReplaceStencilOp:WE,ReverseSubtractEquation:HE,RingBufferGeometry:NE,RingGeometry:UE,SIGNED_RED_GREEN_RGTC2_Format:GE,SIGNED_RED_RGTC1_Format:zE,SRGBColorSpace:Dr,Scene:$n,ShaderChunk:XE,ShaderLib:Zi,ShaderMaterial:qa,ShadowMaterial:jE,Shape:qE,ShapeBufferGeometry:QE,ShapeGeometry:JE,ShapePath:YE,ShapeUtils:KE,ShortType:$E,Skeleton:gx,SkeletonHelper:ZE,SkinnedMesh:wx,Source:ey,Sphere:Cr,SphereBufferGeometry:ty,SphereGeometry:Qa,Spherical:ny,SphericalHarmonics3:oy,SplineCurve:ry,SpotLight:Fx,SpotLightHelper:iy,Sprite:sy,SpriteMaterial:MA,SrcAlphaFactor:ay,SrcAlphaSaturateFactor:cy,SrcColorFactor:ly,StaticCopyUsage:uy,StaticDrawUsage:py,StaticReadUsage:dy,StereoCamera:Ax,StreamCopyUsage:hy,StreamDrawUsage:my,StreamReadUsage:fy,StringKeyframeTrack:xy,SubtractEquation:gy,SubtractiveBlending:wy,TOUCH:Fy,TangentSpaceNormalMap:Ay,TetrahedronBufferGeometry:_y,TetrahedronGeometry:vy,Texture:Go,TextureLoader:_x,TorusBufferGeometry:Sy,TorusGeometry:Ty,TorusKnotBufferGeometry:ky,TorusKnotGeometry:My,Triangle:by,TriangleFanDrawMode:es,TriangleStripDrawMode:Ja,TrianglesDrawMode:vx,TubeBufferGeometry:Ey,TubeGeometry:yy,TwoPassDoubleSide:Dy,UVMapping:Cy,Uint16BufferAttribute:By,Uint32BufferAttribute:Ly,Uint8BufferAttribute:Ry,Uint8ClampedBufferAttribute:Py,Uniform:Vy,UniformsGroup:Iy,UniformsLib:ts,UniformsUtils:_p,UnsignedByteType:Oy,UnsignedInt248Type:Wy,UnsignedIntType:Hy,UnsignedShort4444Type:Ny,UnsignedShort5551Type:Uy,UnsignedShortType:Gy,VSMShadowMap:zy,Vector2:qe,Vector3:W,Vector4:ln,VectorKeyframeTrack:Sx,VideoTexture:Tx,WebGL1Renderer:Xy,WebGL3DRenderTarget:jy,WebGLArrayRenderTarget:qy,WebGLCubeRenderTarget:kx,WebGLMultipleRenderTargets:Qy,WebGLRenderTarget:vp,WebGLRenderer:Ya,WebGLUtils:Jy,WireframeGeometry:Mx,WrapAroundEnding:Yy,ZeroCurvatureEnding:Ky,ZeroFactor:$y,ZeroSlopeEnding:Zy,ZeroStencilOp:e3,_SRGBAFormat:t3,sRGBEncoding:bx}=THREE;function Ex(n,e){let t=n*Te;return .5*(1-Math.cos(t))-e*Math.sin(2*t)}function yx(n,e){let t=(n-.5)*Te;return n*n+e*Math.cos(t)}function Zn(n,e){let t=globalThis,o=t[n];if(L(o)){if(L(e))throw new Error(`No value ${n} found`);o=e(),t[n]=o}return o}function Dt(n){return g(n)&&n.isMesh}function Sp(n){return g(n)&&n.isMaterial}function Ka(n,e){return Sp(e)&&e.type===n}function Dx(n){return Ka("MeshBasicMaterial",n)}function ns(n){return Ka("MeshStandardMaterial",n)}function os(n){return Ka("MeshPhongMaterial",n)}function rs(n){return Ka("MeshPhysicalMaterial",n)}function Tp(n){return g(n)&&n.isObject3D}function Cx(n){return g(n)&&n.isQuaternion}function Bx(n){return g(n)&&n.isEuler}function kp(n){return g(n)&&Tp(n.object)}function Lx(n){return kp(n)||Tp(n)}function ft(n){return kp(n)?n.object:n}function He(n,e){return n=ft(n),n.visible=e,e}function Br(n){return n=ft(n),n.visible}function $a(n){if(!n)return!1;for(n=ft(n);n;){if(!n.visible)return!1;n=n.parent}return!0}function N(n,...e){let t=e.filter(g).map(ft);return t.length>0&&ft(n).add(...t),n}function ue(n,...e){let t=new Re;return t.name=n,N(t,...e),t}function Za(n,e){n=ft(n),Hi(n)&&(n.disabled=!e)}function Lr(n,e,t){let o=new yt(e,t);return o.name=n,o}var zo=Zn("Juniper:ScaledItems",()=>new Map),Rx=1,bA=1.1,EA=.005,Mp=class{constructor(e){this.target=e,this.obj=ft(this.target),this.base=this.obj.scale.clone(),this.p=0,this.dir=0,this.running=!1,this.wasDisabled=this.disabled,this.target.addScopedEventListener(this,"enter",t=>{t.pointer.type!=="nose"&&this.run(1)}),this.target.addScopedEventListener(this,"exit",t=>{t.pointer.type!=="nose"&&this.run(-1)}),this.obj.traverse(t=>{Dt(t)&&this.target.addMesh(t)})}get disabled(){return this.target.disabled}run(e){(!this.disabled||e===-1||this.p>0)&&(this.dir=e,this.running=!0)}updateScaling(e){if(this.disabled!==this.wasDisabled&&(this.wasDisabled=this.disabled,this.disabled&&this.run(-1)),this.running){this.p+=this.dir*e,(this.dir>0&&this.p>=1||this.dir<0&&this.p<0)&&(this.p=Math.max(0,Math.min(1,this.p)),this.running=!1);let t=Ex(this.p,1.1);this.obj.scale.copy(this.base).multiplyScalar(t*(bA-Rx)+Rx)}}dispose(){this.target.removeScope(this)}};function Px(n){n*=EA;for(let e of zo.values())e.updateScaling(n)}function Vx(n){let e=zo.get(n);e&&(zo.delete(n),ae(e))}function ec(n,e){let t=zo.has(n);if(e!=t)if(e)zo.set(n,new Mp(n));else{let o=zo.get(n);ae(o),zo.delete(n)}}function ve(n){let e=new Array,t=new Set;for(e.push(n);e.length>0;){let o=e.shift();o&&!t.has(o)&&(t.add(o),o.isMesh&&e.push(o.material,o.geometry),o.isMaterial&&e.push(...Object.values(o)),o.isObject3D&&(e.push(...o.children),o.clear(),Vx(o)),nt(o)&&e.push(...o),qn(o))}t.clear()}var xt;(function(n){n[n.None=-1]="None",n[n.Left=0]="Left",n[n.Right=1]="Right",n[n.Up=2]="Up",n[n.Down=3]="Down",n[n.Back=4]="Back",n[n.Front=5]="Front"})(xt||(xt={}));var Ix=new W(0,1,0),gt=2048,Rr=gt/2,yA=[1,0,2,3,4,5],Yt={rows:3,columns:4,indices:[[xt.None,xt.Up,xt.None,xt.None],[xt.Left,xt.Front,xt.Right,xt.Back],[xt.None,xt.Down,xt.None,xt.None]],rotations:[[0,Te,0,0],[0,0,0,0],[0,Te,0,0]]},tc=new We(0),nc=class{get envMap(){return this._cube}constructor(e){this.env=e,this.rt=new kx(gt),this.rtScene=new $n,this.rtCamera=new Xf(.01,10,this.rt),this._rotation=new we,this.layerRotation=new we().identity(),this.stageRotation=new we().identity(),this.canvases=new Array(6),this.contexts=new Array(6),this.layerOrientation=null,this.images=null,this.curImagePath=null,this.layer=null,this.wasVisible=!1,this.stageHeading=0,this.rotationNeedsUpdate=!1,this.imageNeedsUpdate=!1,this.useWebXRLayers=!0,this.wasWebXRLayerAvailable=null,this.visible=!0,this.onNeedsRedraw=()=>this.imageNeedsUpdate=!0,this.env.scene.background=tc;for(let t=0;t<this.canvases.length;++t){let o=this.canvases[t]=Mn(gt,gt);this.contexts[t]=o.getContext("2d",{alpha:!1})}for(let t=0;t<Yt.rows;++t){let o=Yt.indices[t],r=Yt.rotations[t];for(let i=0;i<Yt.columns;++i){let s=o[i];if(s>-1){let a=this.contexts[s],c=r[i];c>0&&(c%2,a.translate(Rr,Rr),a.rotate(c),a.translate(-Rr,-Rr))}}}this.rt.texture.name="SkyboxOutput",this.rtScene.add(this.rtCamera),this.flipped=Mn(gt,gt),this.flipper=this.flipped.getContext("2d",{alpha:!1}),this.flipper.fillStyle=tc.getHexString(),this.flipper.scale(-1,1),this.flipper.translate(-gt,0),this.setImages("",this.canvases),this.env.addScopedEventListener(this,"update",t=>this.checkWebXRLayer(t.frame)),Object.seal(this)}clear(){this.setImage(null,null)}setImage(e,t){return e!==this.curImagePath?g(t)?(this.sliceImage(t),this.setImages(e,this.canvases)):this.setImages(e,null):null}sliceImage(e){let t=e.width/Yt.columns,o=e.height/Yt.rows;for(let r=0;r<Yt.rows;++r){let i=Yt.indices[r];for(let s=0;s<Yt.columns;++s){let a=i[s];a>-1&&this.contexts[a].drawImage(e,s*t,r*o,t,o,0,0,gt,gt)}}return this.canvases}setImages(e,t){if((e!==this.curImagePath||t!==this.images)&&(this.curImagePath=e,t!==this.images)){if(g(this._cube)&&(ve(this._cube),this._cube=null),g(this.images))for(let o of this.images)ve(o);this.images=t,g(this.images)?(this.rtScene.background=this._cube=new jf(this.images),this._cube.name="SkyboxInput"):this.rtScene.background=tc}return this.updateImages(),this._cube}updateImages(){this._cube.needsUpdate=!0,this.imageNeedsUpdate=!0}get rotation(){return this._rotation}set rotation(e){let{x:t,y:o,z:r,w:i}=this._rotation;if(Cx(e))this._rotation.copy(e);else if(Bx(e))this._rotation.setFromEuler(e);else if(nt(e))if(e.length===4&&fe(e[0])&&fe(e[1])&&fe(e[2])&&fe(e[3]))this._rotation.fromArray(e);else throw new Error("Skybox rotation was not a valid array format. Needs an array of 4 numbers.");else At(e)?this._rotation.setFromAxisAngle(Ix,e):(g(e)&&console.warn("Skybox rotation must be a THREE.Quaternion, THREE.Euler, number[] (representing a Quaternion), or a number (representing rotation about the Y-axis)."),this._rotation.identity());this.rotationNeedsUpdate=this._rotation.x!==t||this._rotation.y!==o||this._rotation.z!==r||this._rotation.w!==i}checkWebXRLayer(e){if(this._cube){let t=this.useWebXRLayers&&this.env.hasXRCompositionLayers&&g(e)&&g(this.env.xrBinding),o=t!==this.wasWebXRLayerAvailable;if(o){if(t){let r=this.env.renderer.xr.getReferenceSpace();this.layer=this.env.xrBinding.createCubeLayer({space:r,layout:"mono",isStatic:!1,viewPixelWidth:gt,viewPixelHeight:gt,orientation:this.layerOrientation}),this.layer.addEventListener("redraw",this.onNeedsRedraw),this.env.addWebXRLayer(this.layer,Number.MAX_VALUE)}else this.layer&&(this.env.removeWebXRLayer(this.layer),this.layer.removeEventListener("redraw",this.onNeedsRedraw),qn(this.layer),this.layer=null);this.imageNeedsUpdate=!0}if(!this.layer||!o){let r=this.visible!==this.wasVisible,i=this.env.avatar.headingRadians!==this.stageHeading;if(this.imageNeedsUpdate=this.imageNeedsUpdate||r||this.layer&&this.layer.needsRedraw,this.rotationNeedsUpdate=this.rotationNeedsUpdate||i,this.env.scene.background=this.layer?null:this.visible?this.rt.texture:tc,this.rotationNeedsUpdate&&(this.layerRotation.copy(this.rotation).invert(),this.stageRotation.setFromAxisAngle(Ix,this.env.avatar.headingRadians).premultiply(this.layerRotation),this.layerOrientation=new DOMPointReadOnly(this.stageRotation.x,this.stageRotation.y,this.stageRotation.z,this.stageRotation.w),this.layer?this.layer.orientation=this.layerOrientation:(this.rtCamera.quaternion.copy(this.layerRotation),this.imageNeedsUpdate=!0)),this.imageNeedsUpdate)if(this.layer){let s=this.env.renderer.getContext(),a=this.env.xrBinding.getSubImage(this.layer,e),c=this._cube.images;this.flipper.fillRect(0,0,gt,gt),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.bindTexture(s.TEXTURE_CUBE_MAP,a.colorTexture);for(let p=0;p<c.length;++p){if(this.visible){let m=c[yA[p]];this.flipper.drawImage(m,0,0,m.width,m.height,0,0,gt,gt)}s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.flipped)}s.bindTexture(s.TEXTURE_CUBE_MAP,null)}else this.rtCamera.update(this.env.renderer,this.rtScene);this.stageHeading=this.env.avatar.headingRadians,this.imageNeedsUpdate=!1,this.rotationNeedsUpdate=!1,this.wasVisible=this.visible}this.wasWebXRLayerAvailable=t}}};var is=2,Pr=2048,Vr=new Oa,En;(function(n){n[n.Low=90]="Low",n[n.Medium=60]="Medium",n[n.High=45]="High",n[n.Fine=30]="Fine"})(En||(En={}));var DA=new Map([[En.Low,4],[En.Medium,8],[En.High,3],[En.Fine,2]]),Ox=[[je,0,0,1],[-je,0,2,1],[0,je,1,0],[0,-je,1,2],[Te,0,3,1],[0,0,1,1]],oc=class{constructor(e,t){this.fetcher=e,this.fixWatermarks=t,this.baseURL=null,this.isDebug=!1,this.disposed=!1,this.canvas=Mn(Pr,Pr),this.renderer=new Ya({canvas:this.canvas,alpha:!1,antialias:!1,depth:!0,logarithmicDepthBuffer:!1,powerPreference:"low-power",precision:"lowp",stencil:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1}),this.camera=new Uo(90),this.photosphere=new Er,this.scene=N(new $n,new Ra(16777215,1),this.camera,this.photosphere),this.geometry=new Kn(1,1,1,1)}init(e,t){this.baseURL=e,this.isDebug=t}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){for(let e of this.scene.children)ve(e);ae(this.renderer)}async renderFaces(e,t,o){this.clear(),await this.loadFrames(t,o,e);let r=await Promise.all(Ox.map(async([i,s,a,c])=>{let p=Yt.rotations[c][a];Vr.set(s,i,p,"YXZ"),this.camera.setRotationFromEuler(Vr),this.renderer.render(this.scene,this.camera);let m=await sp(this.renderer.domElement,Gu.value,1);return URL.createObjectURL(m)}));return this.clear(),r}async renderCubeMap(e,t,o){this.clear();let r=Mn(Pr*4,Pr*3),i=r.getContext("2d",{alpha:!1});await this.loadFrames(t,o,e);for(let[c,p,m,x]of Ox)Vr.set(p,c,0,"YXZ"),this.camera.setRotationFromEuler(Vr),this.renderer.render(this.scene,this.camera),i.drawImage(this.renderer.domElement,m*Pr,x*Pr);let s=await sp(r,Gu.value,1),a=URL.createObjectURL(s);return this.clear(),a}getImageAngles(e){let t=new Array,o=e,r=this.fixWatermarks?DA.get(o):0;for(let i=-90+o;i<90;i+=o)for(let s=-180;s<180;s+=o)t.push([s,i,o+r,is]);return t.push([0,-90,o+r,is]),t.push([0,90,o+r,is]),this.fixWatermarks&&(t.push([0,-90,o,.5*is]),t.push([0,90,o,.5*is])),t}async loadFrames(e,t,o){let r=this.getImageAngles(e);await Wf(t,r,(i,s)=>this.loadFrame(o,...i,s))}async loadFrame(e,t,o,r,i,s){let a=.5*Oe(r),c=Math.tan(a),p=.5*i/c,m=e(r,t,o),x=await this.fetcher.get(m,this.baseURL).progress(s).useCache(!this.isDebug).canvas().then(dt),w=new Go(x),_=new ot({map:w,side:Ia}),T=Lr(`frame-${r}-${t}-${o}`,this.geometry,_);w.needsUpdate=!0,_.needsUpdate=!0,Vr.set(Oe(o),-Oe(t),0,"YXZ"),T.scale.setScalar(i),T.quaternion.setFromEuler(Vr),T.position.set(0,0,-p).applyQuaternion(T.quaternion),N(this.photosphere,T)}clear(){for(let e of this.photosphere.children)ve(e);this.photosphere.clear()}};function Ir(n){return!(n.shiftKey||n.altKey||n.ctrlKey||n.metaKey)}var bp=class{constructor(e,t,o){if(this.name=e,this.callback=t,!Z(t))throw new Error("A function instance is required for this parameter");this.opts=o,Object.freeze(this)}applyToElement(e){this.add(e)}add(e){e.addEventListener(this.name,this.callback,this.opts)}remove(e){e.removeEventListener(this.name,this.callback)}};function rc(n,e,t){return new bp(n,e,t)}function ic(n,e){return rc("click",n,e)}function un(n,e){return rc("input",n,e)}function Wx(n,e){return rc("play",n,e)}function Hx(n,e){return rc("released",n,e)}async function Nx(n,e){if(!e.isReady){let t=jn("Start",ic(()=>t.disabled=!0,!0));te(n,t),await e.ready,t.remove()}}var Ux=["change","click","contextmenu","dblclick","mouseup","pointerup","reset","submit","touchend"];function pn(n,e=!1){let t=async o=>{if(o.isTrusted){if(!e)for(let r of Ux)window.removeEventListener(r,t);n()}};for(let o of Ux)window.addEventListener(o,t)}function dn(...n){return Promise.all(n)}function Gx(){return"chrome"in globalThis&&!navigator.userAgent.match("CriOS")}function ac(){return"InstallTrigger"in globalThis}function zx(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function CA(){return/^mac/i.test(navigator.platform)}function Or(){return/iP(ad|hone|od)/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||CA()&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>2}function yn(){return/Mobile VR/.test(navigator.userAgent)||/Pico Neo 3 Link/.test(navigator.userAgent)||Dn}function cc(){return"xr"in navigator&&"isSessionSupported"in navigator.xr}function Ep(){return"getVRDisplays"in navigator}function lc(){return cc()||Ep()}function ss(){return/Android/.test(navigator.userAgent)||/BlackBerry/.test(navigator.userAgent)||/(UC Browser |UCWEB)/.test(navigator.userAgent)||Or()||yn()}function Wr(){return!ss()}var BA=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,sc=navigator.userAgent.match(BA),Dn=!!sc,Xx=Dn&&{major:parseFloat(sc[1]),minor:parseFloat(sc[2]),patch:parseFloat(sc[3])},eD=Dn&&/pacific/i.test(navigator.userAgent),tD=Dn&&/quest/i.test(navigator.userAgent),nD=Dn&&/quest 2/i.test(navigator.userAgent);var yp="Worker"in globalThis;function Hr(...n){let e=[];for(let t of n)g(t)&&t.length>0&&e.indexOf(t)===-1&&e.push(t);return e.join("-")}function as(n){return g(n)&&"_resolveInput"in n}function cs(n){return as(n)&&"_resolveOutput"in n}var Nr=class extends oe{get name(){return this._name}set name(e){this._name=e,this.context._name(this,e)}constructor(e,t){super(),this.nodeType=e,this.context=t,this._name=null,this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){}isConnected(e,t,o){return this.context._isConnected(this,e,t,o)}resolveOutput(e){let t={source:this,output:e};for(;cs(t.source);)t=t.source._resolveOutput(t.output);return t}resolveInput(e){let t={destination:this,input:e};for(;as(t.destination);)t=t.destination._resolveInput(t.input);return t}toggle(e,t,o){this._toggle(e,t,o)}_toggle(e,t,o){if(this.isConnected(e,t,o))this._disconnect(e,t,o);else return this._connect(e,t,o)}connect(e,t,o){return this._connect(e,t,o)}_connect(e,t,o){return this.context._connect(this,e,t,o)}disconnect(e,t,o){this._disconnect(e,t,o)}_disconnect(e,t,o){this.context._disconnect(this,e,t,o)}};var vt=class n extends Nr{get exemplar(){return this.allNodes[0]}constructor(e,t,o,r,i){super(e,t),o=o||[],i=i||[];let s=r||o;this.inputs=o;let a=o.filter(cs).map(c=>c);this.outputs=s.filter(cs).map(c=>c),this.allNodes=Array.from(new Set([...a,...this.outputs,...i]))}add(e){this.allNodes.push(e),this.context._parent(this,e)}remove(e){Ke(this.allNodes,e),this.context._unparent(this,e)}onDisposing(){this.allNodes.forEach(ae),super.onDisposing()}get channelCount(){return this.exemplar.channelCount}set channelCount(e){this.allNodes.forEach(t=>t.channelCount=e)}get channelCountMode(){return this.exemplar.channelCountMode}set channelCountMode(e){this.allNodes.forEach(t=>t.channelCountMode=e)}get channelInterpretation(){return this.exemplar.channelInterpretation}set channelInterpretation(e){this.allNodes.forEach(t=>t.channelInterpretation=e)}get numberOfInputs(){return this.inputs.length}get numberOfOutputs(){return this.outputs.length}static resolve(e,t){return t=t||0,t<0||e.length<=t?null:e[t]}_resolveInput(e){return{destination:n.resolve(this.inputs,e)}}_resolveOutput(e){return{source:n.resolve(this.outputs,e)}}};function uc(n){let e=[];for(let t=0;t<n.length;++t){let o=n[t],r=!1;for(let i=0;i<e.length&&!r;++i){let s=e[i];r=o.kind===s.kind&&s.label.indexOf(o.label)>0}r||e.push(o)}return e}var Ur=class extends G{constructor(){super("devicesettingschanged")}},pc=class{constructor(...e){this.permissed=new Set,this.managers=e}get hasPermissions(){for(let e of this.managers)if(!this.permissed.has(e))return!1;return!0}async init(){if(!this.hasPermissions){let e=await this.getDevices();await Promise.all(this.managers.map(t=>t.setDevice(pt(e,o=>o.kind===t.deviceKind&&o.deviceId===t.preferredDeviceID,o=>o.kind===t.deviceKind&&o.deviceId==="default",o=>o.kind===t.deviceKind&&o.deviceId.length>0))))}}async getDevices(e=!1){let t=null,o=null;for(let r=0;r<3;++r)if(t=await navigator.mediaDevices.enumerateDevices(),!this.hasPermissions){let i={};for(let s of this.managers)if(!this.permissed.has(s)){for(let a of t)if(a.kind===s.deviceKind&&a.deviceId.length>0&&a.label.length>0){this.permissed.add(s);break}this.permissed.has(s)||(i[s.mediaType]=!0)}if(!this.hasPermissions)try{o=await navigator.mediaDevices.getUserMedia(i)}catch(s){console.warn(s)}}if(o)for(let r of o.getTracks())r.stop();return t=(t||[]).sort(Dp),e&&(t=uc(t)),t}get outStreams(){return this.managers.map(e=>e.outStream)}},Dp=on(n=>n.label);var hn=Z(HTMLAudioElement.prototype.setSinkId),Cp=class extends G{constructor(e){super("audiooutputchanged"),this.device=e}},jx="calla:preferredAudioOutputID",dc=class extends oe{get hasAudioPermission(){return this._hasAudioPermission}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}constructor(e){super(),this.element=e,this._hasAudioPermission=!1,this._ready=new se,this.start(),Object.seal(this)}async start(){if(hn){let e=await navigator.mediaDevices.enumerateDevices(),t=pt(e,o=>o.kind==="audiooutput"&&o.label.length>0);if(g(t)){this._hasAudioPermission=!0;let o=await this.getPreferredAudioOutput();o&&await this.setAudioOutputDevice(o)}}this._ready.resolve()}get preferredAudioOutputID(){return hn?localStorage.getItem(jx):null}async getAudioOutputDevices(e=!1){return hn?await this.getAvailableDevices(e)||[]:[]}async getAudioOutputDevice(){if(!hn)return null;let e=this.element&&this.element.sinkId;if(L(e))return null;let t=await this.getAudioOutputDevices();return pt(t,r=>r.deviceId===e)}async getPreferredAudioOutput(){if(!hn)return null;let e=await this.getAudioOutputDevices();return pt(e,o=>o.deviceId===this.preferredAudioOutputID,o=>o.deviceId==="default",o=>o.deviceId.length>0)}async setAudioOutputDevice(e){if(hn){if(g(e)&&e.kind!=="audiooutput")throw new Error(`Device is not an audio output device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(jx,e&&e.deviceId||null);let t=this.element,o=t&&t.sinkId;this.preferredAudioOutputID!==o&&(g(this.preferredAudioOutputID)&&await this.element.setSinkId(this.preferredAudioOutputID),this.dispatchEvent(new Cp(e)))}}async getAvailableDevices(e=!1){let t=null,o=null;for(let r=0;r<3;++r){t=await navigator.mediaDevices.enumerateDevices();for(let i of t)i.deviceId.length>0&&(this.hasAudioPermission||(this._hasAudioPermission=i.kind==="audioinput"&&i.label.length>0));if(this.hasAudioPermission)break;try{o=await this.startStream()}catch(i){console.warn(i)}}if(o)for(let r of o.getTracks())r.stop();return t=(t||[]).sort(Dp),e&&(t=uc(t)),hn?t.filter(r=>r.kind==="audiooutput"):[]}startStream(){return navigator.mediaDevices.getUserMedia({audio:!0})}};function LA(n){return n[0]}function RA(n){return n.shift()}function PA(n){return n[n.length-1]}function VA(n){return n.pop()}var hc=class{constructor(e){this.value=e,this._forward=new Array,this._reverse=new Array}connectSorted(e,t){if(g(t)){let o=on(r=>t(r.value));wr(this._forward,e,o),wr(e._reverse,this,o)}else this.connectTo(e)}connectTo(e){this.connectAt(e,this._forward.length)}connectAt(e,t){Iu(this._forward,e,t),e._reverse.push(this)}disconnectFrom(e){Ke(this._forward,e),Ke(e._reverse,this)}isConnectedTo(e){return this._forward.indexOf(e)>=0||this._reverse.indexOf(e)>=0}flatten(){let e=new Set,t=[this];for(;t.length>0;){let o=t.shift();g(o)&&!e.has(o)&&(e.add(o),t.push(...o._forward))}return Array.from(e)}*traverse(e){let t=new Set,o=[this],r=e?LA:PA,i=e?RA:VA;for(;o.length>0;){let s=r(o);t.has(s)?e||(i(o),yield s):(t.add(s),e&&(i(o),yield s),s._forward.length>0&&o.push(...s._forward))}}breadthFirst(){return this.traverse(!0)}depthFirst(){return this.traverse(!1)}search(e,t=!0){for(let o of this.traverse(t))if(e(o))return o;return null}*searchAll(e,t=!0){for(let o of this.traverse(t))e(o)&&(yield o)}find(e,t=!0){return this.search(o=>o.value===e,t)}findAll(e,t=!0){return this.searchAll(o=>o.value===e,t)}contains(e,t=!0){for(let o of this.traverse(t))if(o===e)return!0;return!1}containsValue(e,t=!0){for(let o of this.traverse(t))if(o.value===e)return!0;return!1}get _isEntryPoint(){return this._reverse.length===0}get _isExitPoint(){return this._forward.length===0}get isDisconnected(){return this._isEntryPoint&&this._isExitPoint}get isConnected(){return!this._isExitPoint||!this._isEntryPoint}get isTerminus(){return this._isEntryPoint||this._isExitPoint}get isInternal(){return!this._isEntryPoint&&!this._isExitPoint}};var mc=class extends hc{get connections(){return this._forward}get isEntryPoint(){return this._isEntryPoint}get isExitPoint(){return this._isExitPoint}};var $=class extends Nr{constructor(e,t,o){super(e,t),this._node=o,this.context._init(this._node,this.nodeType)}onDisposing(){this.disconnect(),this.context._dispose(this._node),super.onDisposing()}parent(e){this.context._parent(this,e)}get channelCount(){return this._node.channelCount}set channelCount(e){this._node.channelCount=e}get channelCountMode(){return this._node.channelCountMode}set channelCountMode(e){this._node.channelCountMode=e}get channelInterpretation(){return this._node.channelInterpretation}set channelInterpretation(e){this._node.channelInterpretation=e}get numberOfInputs(){return this._node.numberOfInputs}get numberOfOutputs(){return this._node.numberOfOutputs}_resolveInput(e){return{destination:this._node,input:e}}_resolveOutput(e){return{source:this._node,output:e}}};var Gr=class extends ${constructor(e,t){super("analyser",e,new AnalyserNode(e,t))}get fftSize(){return this._node.fftSize}set fftSize(e){this._node.fftSize=e}get frequencyBinCount(){return this._node.frequencyBinCount}get maxDecibels(){return this._node.maxDecibels}set maxDecibels(e){this._node.maxDecibels=e}get minDecibels(){return this._node.minDecibels}set minDecibels(e){this._node.minDecibels=e}get smoothingTimeConstant(){return this._node.smoothingTimeConstant}set smoothingTimeConstant(e){this._node.smoothingTimeConstant=e}getByteFrequencyData(e){this._node.getByteFrequencyData(e)}getByteTimeDomainData(e){this._node.getByteTimeDomainData(e)}getFloatFrequencyData(e){this._node.getFloatFrequencyData(e)}getFloatTimeDomainData(e){this._node.getFloatTimeDomainData(e)}};var re=class{get name(){return this._name}set name(e){this._name=e,this.context._name(this,e)}constructor(e,t,o){this.nodeType=e,this.context=t,this.param=o,this._name=null,this.disposed=!1,this.context._init(this.param,this.nodeType)}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){this.context._dispose(this.param)}get automationRate(){return this.param.automationRate}set automationRate(e){this.param.automationRate=e}get defaultValue(){return this.param.defaultValue}get maxValue(){return this.param.maxValue}get minValue(){return this.param.minValue}get value(){return this.param.value}set value(e){this.param.value=e}cancelAndHoldAtTime(e){return this.param.cancelAndHoldAtTime(e),this}cancelScheduledValues(e){return this.param.cancelScheduledValues(e),this}exponentialRampToValueAtTime(e,t){return this.param.exponentialRampToValueAtTime(e,t),this}linearRampToValueAtTime(e,t){return this.param.linearRampToValueAtTime(e,t),this}setTargetAtTime(e,t,o){return this.param.setTargetAtTime(e,t,o),this}setValueAtTime(e,t){return this.param.setValueAtTime(e,t),this}setValueCurveAtTime(e,t,o){return this.param.setValueCurveAtTime(e,t,o),this}_resolveInput(){return{destination:this.param}}resolveInput(){return this._resolveInput()}};var fc=class extends ${constructor(e,t){super("audio-buffer-source",e,new AudioBufferSourceNode(e,t)),this._node.addEventListener("ended",()=>this.dispatchEvent(new G("ended"))),this.parent(this.playbackRate=new re("playbackRate",e,this._node.playbackRate)),this.parent(this.detune=new re("detune",e,this._node.detune))}get buffer(){return this._node.buffer}set buffer(e){this._node.buffer=e}get loop(){return this._node.loop}set loop(e){this._node.loop=e}get loopEnd(){return this._node.loopEnd}set loopEnd(e){this._node.loopEnd=e}get loopStart(){return this._node.loopStart}set loopStart(e){this._node.loopStart=e}get onended(){return this._node.onended}set onended(e){this._node.onended=e}start(e,t,o){this._node.start(e,t,o)}stop(e){this._node.stop(e)}};var xc=class extends ${constructor(e,t){super("destination",e,t)}get maxChannelCount(){return this._node.maxChannelCount}};var mn=class extends ${constructor(e,t){super("biquad-filter",e,new BiquadFilterNode(e,t)),this.parent(this.Q=new re("Q",this.context,this._node.Q)),this.parent(this.detune=new re("detune",this.context,this._node.detune)),this.parent(this.frequency=new re("frequency",this.context,this._node.frequency)),this.parent(this.gain=new re("gain",this.context,this._node.gain))}get type(){return this._node.type}set type(e){this._node.type=e}getFrequencyResponse(e,t,o){this._node.getFrequencyResponse(e,t,o)}};var gc=class extends ${constructor(e,t){super("channel-merger",e,new ChannelMergerNode(e,t))}};var wc=class extends ${constructor(e,t){super("channel-splitter",e,new ChannelSplitterNode(e,t))}};var Fc=class extends ${constructor(e,t){super("constant-source",e,new ConstantSourceNode(e,t)),this._node.addEventListener("ended",()=>this.dispatchEvent(new G("ended"))),this.parent(this.offset=new re("offset",this.context,this._node.offset))}get onended(){return this._node.onended}set onended(e){this._node.onended=e}start(e){this._node.start(e)}stop(e){this._node.stop(e)}};var Ac=class extends ${constructor(e,t){super("convolver",e,new ConvolverNode(e,t))}get buffer(){return this._node.buffer}set buffer(e){this._node.buffer=e}get normalize(){return this._node.normalize}set normalize(e){this._node.normalize=e}};var _c=class extends ${constructor(e,t){super("delay",e,new DelayNode(e,t)),this.parent(this.delayTime=new re("delay",this.context,this._node.delayTime))}};var zr=class extends ${constructor(e,t){super("dynamics-compressor",e,new DynamicsCompressorNode(e,t)),this.parent(this.attack=new re("attack",this.context,this._node.attack)),this.parent(this.knee=new re("knee",this.context,this._node.knee)),this.parent(this.ratio=new re("ratio",this.context,this._node.ratio)),this.parent(this.release=new re("release",this.context,this._node.release)),this.parent(this.threshold=new re("threshold",this.context,this._node.threshold))}get reduction(){return this._node.reduction}};var Ot=class extends ${constructor(e,t){super("gain",e,new GainNode(e,t)),this.parent(this.gain=new re("gain",this.context,this._node.gain))}};var vc=class extends ${constructor(e,t){super("iir-filter",e,new IIRFilterNode(e,t))}getFrequencyResponse(e,t,o){this._node.getFrequencyResponse(e,t,o)}};var Kt=class extends ${constructor(e,t){super("media-element-audio-source",e,new MediaElementAudioSourceNode(e,t))}get mediaElement(){return this._node.mediaElement}};var eo=class extends ${constructor(e,t){super("media-stream-audio-destination",e,new MediaStreamAudioDestinationNode(e,t))}get stream(){return this._node.stream}};var IA="AudioContext"in globalThis,qx=IA&&"AudioListener"in globalThis,Qx=qx&&"setPosition"in AudioListener.prototype,ls=qx&&"positionX"in AudioListener.prototype,Bp="createMediaStreamSource"in AudioContext.prototype,F4=Z(HTMLMediaElement.prototype.captureStream)||Z(HTMLMediaElement.prototype.mozCaptureStream);var to=class extends ${constructor(e,t){let o=an(qt(!1),ma(Bp),Sn(!0),Un(!1),at("none"),Wi(t.mediaStream)),r;Bp?r=new MediaStreamAudioSourceNode(e,t):r=new MediaElementAudioSourceNode(e,{mediaElement:o}),super("media-stream-audio-source",e,r),this._stream=t.mediaStream,this._element=o}onDisposing(){this._element.pause(),super.onDisposing()}get mediaStream(){return this._stream}};var Sc=class extends ${constructor(e,t){super("oscillator",e,new OscillatorNode(e,t)),this._node.addEventListener("ended",()=>this.dispatchEvent(new G("ended"))),this.parent(this.detune=new re("detune",this.context,this._node.detune)),this.parent(this.frequency=new re("frequency",this.context,this._node.frequency))}get type(){return this._node.type}set type(e){this._node.type=e}get onended(){return this._node.onended}set onended(e){this._node.onended=e}setPeriodicWave(e){this._node.setPeriodicWave(e)}start(e){this._node.start(e)}stop(e){this._node.stop(e)}};var Xr=class extends ${constructor(e,t){super("panner",e,new PannerNode(e,t)),this.parent(this.positionX=new re("positionX",this.context,this._node.positionX)),this.parent(this.positionY=new re("positionY",this.context,this._node.positionY)),this.parent(this.positionZ=new re("positionZ",this.context,this._node.positionZ)),this.parent(this.orientationX=new re("orientationX",this.context,this._node.orientationX)),this.parent(this.orientationY=new re("orientationY",this.context,this._node.orientationY)),this.parent(this.orientationZ=new re("orientationZ",this.context,this._node.orientationZ))}get coneInnerAngle(){return this._node.coneInnerAngle}set coneInnerAngle(e){this._node.coneInnerAngle=e}get coneOuterAngle(){return this._node.coneOuterAngle}set coneOuterAngle(e){this._node.coneOuterAngle=e}get coneOuterGain(){return this._node.coneOuterGain}set coneOuterGain(e){this._node.coneOuterGain=e}get distanceModel(){return this._node.distanceModel}set distanceModel(e){this._node.distanceModel=e}get maxDistance(){return this._node.maxDistance}set maxDistance(e){this._node.maxDistance=e}get panningModel(){return this._node.panningModel}set panningModel(e){this._node.panningModel=e}get refDistance(){return this._node.refDistance}set refDistance(e){this._node.refDistance=e}get rolloffFactor(){return this._node.rolloffFactor}set rolloffFactor(e){this._node.rolloffFactor=e}setOrientation(e,t,o){this._node.setOrientation(e,t,o)}setPosition(e,t,o){this._node.setPosition(e,t,o)}};var Tc=class extends ${constructor(e,t){super("stereo-panner",e,new StereoPannerNode(e,t)),this.parent(this.pan=new re("pan",this.context,this._node.pan))}};var kc=class extends ${constructor(e,t){super("wave-shaper",e,new WaveShaperNode(e,t))}get curve(){return this._node.curve}set curve(e){this._node.curve=e}get oversample(){return this._node.oversample}set oversample(e){this._node.oversample=e}};!("AudioContext"in globalThis)&&"webkitAudioContext"in globalThis&&(globalThis.AudioContext=globalThis.webkitAudioContext);!("OfflineAudioContext"in globalThis)&&"webkitOfflineAudioContext"in globalThis&&(globalThis.OfflineAudioContext=globalThis.webkitOfflineAudioContext);var Lp=class{constructor(e,t){this.type=e,this.name=t,this.connections=new Set}};function Mc(n,e,t,o,r){return n.type===e&&(L(t)||t===n.destination)&&(L(o)||o===n.output)&&(L(r)||r===n.input)}function jr(n,e){let t=null,o=null;return g(n)&&({destination:t,input:o}=n.resolveInput(e)),{destination:t,input:o}}var bc=class extends AudioContext{get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}constructor(e){super(e),this.counters=new Map,this.nodes=new Map,this._ready=new se,this._destination=new xc(this,super.destination),this.state==="running"?this._ready.resolve():this.state==="closed"?this.resume().then(()=>this._ready.resolve()):pn(()=>this.resume().then(()=>this._ready.resolve())),this.ready.then(()=>console.log("Audio is now ready"))}_init(e,t){if(!this.nodes.has(e)){this.counters.has(t)||this.counters.set(t,0);let o=this.counters.get(t),r=`${t}-${o}`;this.nodes.set(e,new Lp(t,r)),as(e)&&(e.name=r),this.counters.set(t,o+1)}}_name(e,t){let{destination:o}=jr(e);if(this.nodes.has(o)){let r=this.nodes.get(o);r.name=`${t}-${r.type}`}}_dispose(e){this.nodes.delete(e)}_isConnected(e,t,o,r){let{source:i,output:s}=e.resolveOutput(o),{destination:a,input:c}=jr(t,r);if(L(i)||!this.nodes.has(i))return null;{let p=this.nodes.get(i);for(let m of p.connections)if(Mc(m,"conn",a,s,c))return!0;return!1}}_parent(e,t){let{source:o}=e.resolveOutput(),{destination:r}=jr(t);this.nodes.has(o)&&this.nodes.get(o).connections.add({type:"parent",src:e,dest:t,destination:r,source:o})}_unparent(e,t){let{source:o}=e.resolveOutput(),{destination:r}=jr(t);if(this.nodes.has(o)){let i=this.nodes.get(o).connections,s=new Set;for(let a of i)Mc(a,"parent",r)&&s.add(a);for(let a of s)i.delete(a)}}_getConnections(e){return this.nodes.has(e)?this.nodes.get(e).connections:null}_connect(e,t,o,r){let{source:i,output:s}=e.resolveOutput(o),{destination:a,input:c}=jr(t,r);if(this.nodes.has(i)){let p=this.nodes.get(i).connections,m=!1;for(let x of p)Mc(x,"conn",a,s,c)&&(m=!0);m||p.add({type:"conn",src:e,dest:t,outp:o,inp:r,source:i,destination:a,output:s,input:c})}if(a instanceof AudioNode)return t=t,g(c)?(i.connect(a,s,c),t):g(s)?(i.connect(a,s),t):(i.connect(a),t);a instanceof AudioParam?g(s)?i.connect(a,s):g(a)?i.connect(a):xe(a):xe(a)}_disconnect(e,t,o,r){let i;fe(t)?(i=void 0,o=t):i=t;let{source:s,output:a}=e.resolveOutput(o),{destination:c,input:p}=jr(i,r);if(this.nodes.has(s)){let m=this.nodes.get(s).connections,x=new Set;for(let w of m)Mc(w,"conn",c,a,p)&&x.add(w);for(let w of x)m.delete(w)}c instanceof AudioNode?g(r)?s.disconnect(c,o,r):g(o)?s.disconnect(c,o):g(c)?s.disconnect(c):s.disconnect():g(o)?s.disconnect(c,o):g(c)?s.disconnect(c):s.disconnect()}getAudioGraph(e){let t=new Map;for(let[o,r]of this.nodes){let i=o instanceof AudioNode?"node":o instanceof AudioParam?"param":"unknown";(e||i!=="param")&&t.set(o,new mc({name:r.name,type:r.type,nodeClass:i}))}for(let[o,r]of this.nodes){let i=t.get(o);for(let s of r.connections){let a=s.destination;if(t.has(a)){let c=t.get(a);i.connectTo(c),c.connectTo(i)}}}return Array.from(t.values())}get destination(){return this._destination}createAnalyser(){return new Gr(this)}createBiquadFilter(){return new mn(this)}createBufferSource(){return new fc(this)}createChannelMerger(e){return new gc(this,{numberOfInputs:e})}createChannelSplitter(e){return new wc(this,{numberOfOutputs:e})}createConstantSource(){return new Fc(this)}createConvolver(){return new Ac(this)}createDelay(e){return new _c(this,{maxDelayTime:e})}createDynamicsCompressor(){return new zr(this)}createGain(){return new Ot(this)}createIIRFilter(e,t){return new vc(this,{feedforward:e,feedback:t})}createMediaElementSource(e){return new Kt(this,{mediaElement:e})}createMediaStreamDestination(){return new eo(this)}createMediaStreamSource(e){return new to(this,{mediaStream:e})}createOscillator(){return new Sc(this)}createPanner(){return new Xr(this)}createStereoPanner(){return new Tc(this)}createWaveShaper(){return new kc(this)}createScriptProcessor(){throw new Error("Script processor nodes are deprecated")}};var qr=class{constructor(){this.p=tt.create(),this.q=br.create(),Object.seal(this)}set(e,t,o,r,i,s,a){this.setPosition(e,t,o),this.setOrientation(r,i,s,a)}setPosition(e,t,o){tt.set(this.p,e,t,o)}setOrientation(e,t,o,r){br.set(this.q,e,t,o,r)}copy(e){tt.copy(this.p,e.p),br.copy(this.q,e.q)}};var Ec=class{constructor(e,t){this.type=e,this.context=t}};var Qr=tt.create(),Jr=tt.create(),Yr=class extends Ec{get listener(){return this.context.listener}readPose(e){let{p:t,q:o}=e;tt.set(Qr,0,0,-1),tt.transformQuat(Qr,Qr,o),tt.set(Jr,0,1,0),tt.transformQuat(Jr,Jr,o),this.setPosition(t[0],t[1],t[2]),this.setOrientation(Qr[0],Qr[1],Qr[2],Jr[0],Jr[1],Jr[2])}};var yc=class extends Yr{constructor(e){if(!ls)throw new Error("Latest WebAudio Listener API is not supported");super("web-audio-listener-new",e),Object.seal(this)}setPosition(e,t,o){let r=this.context.currentTime;this.listener.positionX.setValueAtTime(e,r),this.listener.positionY.setValueAtTime(t,r),this.listener.positionZ.setValueAtTime(o,r)}setOrientation(e,t,o,r,i,s){let a=this.context.currentTime;this.listener.forwardX.setValueAtTime(e,a),this.listener.forwardY.setValueAtTime(t,a),this.listener.forwardZ.setValueAtTime(o,a),this.listener.upX.setValueAtTime(r,a),this.listener.upY.setValueAtTime(i,a),this.listener.upZ.setValueAtTime(s,a)}};var Dc=class extends Yr{constructor(e){if(!Qx)throw new Error("WebAudio Listener API is not supported");super("web-audio-listener-old",e),Object.seal(this)}setPosition(e,t,o){this.listener.setPosition(e,t,o)}setOrientation(e,t,o,r,i,s){this.listener.setOrientation(e,t,o,r,i,s)}};var Kr=class extends vt{constructor(e,t,o,r,i,s){super(e,t,r,i,s),this.spatialized=o,this._minDistance=1,this._maxDistance=10,this._algorithm="inverse"}get minDistance(){return this._minDistance}get maxDistance(){return this._maxDistance}get algorithm(){return this._algorithm}setAudioProperties(e,t,o){this._minDistance=e,this._maxDistance=t,this._algorithm=o}};var us=tt.create(),$r=class extends Kr{constructor(e,t){let o=new Xr(t,{panningModel:"HRTF",distanceModel:"inverse",coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:0});super(e,t,!0,[o]),this.lpx=0,this.lpy=0,this.lpz=0,this.lqx=0,this.lqy=0,this.lqz=0,this.lqw=0,this.panner=o}setAudioProperties(e,t,o){super.setAudioProperties(e,t,o),this.panner.refDistance=this.minDistance,this.panner.distanceModel=o,o==="linear"?this.panner.rolloffFactor=1:this.maxDistance<=0?this.panner.rolloffFactor=1/0:o==="inverse"?this.panner.rolloffFactor=1/this.maxDistance:this.panner.rolloffFactor=Math.pow(this.maxDistance,-.2)}readPose(e){let{p:t,q:o}=e,[r,i,s]=t,[a,c,p,m]=o;(r!==this.lpx||i!==this.lpy||s!==this.lpz)&&(this.lpx=r,this.lpy=i,this.lpz=s,this.setPosition(r,i,s,this.context.currentTime)),(a!==this.lqx||c!==this.lqy||p!==this.lqz||m!==this.lqw)&&(this.lqx=a,this.lqy=c,this.lqz=p,this.lqw=m,tt.transformQuat(us,tt.set(us,0,0,-1),o),this.setOrientation(us[0],us[1],us[2],this.context.currentTime))}getGainAtDistance(e){let{rolloffFactor:t,refDistance:o,maxDistance:r,distanceModel:i}=this.panner;if(e<=o)return 1;{let s=e-o,a=r-o;if(i==="linear")return 1-t*s/a;if(i==="inverse")return o/(o+t*s);if(i==="exponential")return Math.pow(e/o,-t);xe(i)}}};var Cc=class extends $r{constructor(e){super("web-audio-panner-new",e),Object.seal(this)}setPosition(e,t,o,r){At(e)&&At(t)&&At(o)&&(sa(r)&&(r=0),this.panner.positionX.setValueAtTime(e,r),this.panner.positionY.setValueAtTime(t,r),this.panner.positionZ.setValueAtTime(o,r))}setOrientation(e,t,o,r){At(e)&&At(t)&&At(o)&&(sa(r)&&(r=0),this.panner.orientationX.setValueAtTime(-e,r),this.panner.orientationY.setValueAtTime(-t,r),this.panner.orientationZ.setValueAtTime(-o,r))}};var Bc=class extends $r{constructor(e){super("web-audio-panner-old",e),Object.seal(this)}setPosition(e,t,o){this.panner.setPosition(e,t,o)}setOrientation(e,t,o){this.panner.setOrientation(e,t,o)}};var Lc=class extends vt{get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}constructor(e){let t=ls?new yc(e):new Dc(e),o=new Ot(e);o.name="remote-user-input";let r=new Ot(e);r.name="spatialized-input";let i=new Ot(e);i.name="non-spatialized-input";let s=new eo(e),a=new se,c=an(Lo("Audio-Device-Manager"),at("none"),Sn(!0),qt(!0),Wi(s.stream),Wx(()=>a.resolve()));pn(()=>c.play()),super("web-audio-destination",e,[i,r,o],[],[s]),this.pose=new qr,this._ready=a,this.listener=t,this.remoteUserInput=o,this.spatializedInput=r,this.nonSpatializedInput=i,this.volumeControl=i,this.destination=s,this.audioElement=c,o.connect(r).connect(this.volumeControl).connect(s)}createSpatializer(e){let t=e?this.remoteUserInput:this.spatializedInput,o=ls?new Cc(this.context):new Bc(this.context);return o.connect(t),o}setPosition(e,t,o){this.pose.setPosition(e,t,o),this.listener.readPose(this.pose)}setOrientation(e,t,o,r){this.pose.setOrientation(e,t,o,r),this.listener.readPose(this.pose)}set(e,t,o,r,i,s,a){this.pose.set(e,t,o,r,i,s,a),this.listener.readPose(this.pose)}get stream(){return this.destination.stream}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}};var Rp=class extends vt{constructor(e){let t=new mn(e,{type:"bandpass",frequency:2500,Q:4.5}),o=new Ot(e,{gain:10});t.connect(o),super("radio-effect",e,[t],[o])}};function Jx(n,e){let t=new Rp(e);return t.name=`${n}-radio-effect`,t}function Yx(n,e){let t=new mn(e,{type:"bandpass",frequency:400,Q:4.5});return t.name=`${n}-wall-effect`,t}var Kx=new Map([["Radio",Jx],["Wall",Yx]]);var fn=class extends vt{constructor(e,t,o,r,i){let s=new Ot(t);s.name="volume-control",i=i||[],super(e,t,[],[o],i),this.spatializer=o,this.effects=new Array,this.pose=new qr,this.volumeControl=s,this.setEffects(...r)}onDisposing(){de(this.effects),super.onDisposing()}setEffects(...e){this.disable();for(let o of this.effects)this.remove(o),ae(o);de(this.effects);let t=this.volumeControl;for(let o of e)if(g(o)){let r=Kx.get(o);if(g(r)){let i=r(o,this.context);this.add(i),this.effects.push(i),t=t.connect(i)}}this.enable()}get spatialized(){return this.spatializer.spatialized}get lastInternal(){return this.effects[this.effects.length-1]||this.volumeControl}enable(){this.lastInternal.isConnected()||this.lastInternal.connect(this.spatializer)}disable(){this.lastInternal.isConnected()&&this.lastInternal.disconnect()}tog(){this.lastInternal.isConnected()?this.disable():this.enable()}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}get minDistance(){return g(this.spatializer)?this.spatializer.minDistance:null}get maxDistance(){return g(this.spatializer)?this.spatializer.maxDistance:null}get algorithm(){return g(this.spatializer)?this.spatializer.algorithm:null}setPosition(e,t,o){g(this.spatializer)&&(this.pose.setPosition(e,t,o),this.spatializer.readPose(this.pose))}setOrientation(e,t,o,r){g(this.spatializer)&&(this.pose.setOrientation(e,t,o,r),this.spatializer.readPose(this.pose))}set(e,t,o,r,i,s,a){g(this.spatializer)&&(this.pose.set(e,t,o,r,i,s,a),this.spatializer.readPose(this.pose))}setAudioProperties(e,t,o){g(this.spatializer)&&this.spatializer.setAudioProperties(e,t,o)}};var xn=class extends G{constructor(e,t){super(e),this.source=t}},no=class extends xn{constructor(e){super("loaded",e)}},Rc=class extends xn{constructor(e,t){super("errored",e),this.error=t}},oo=class extends xn{constructor(e){super("played",e)}},ro=class extends xn{constructor(e){super("paused",e)}},io=class extends xn{constructor(e){super("stopped",e)}},so=class extends xn{constructor(e){super("progress",e),this.value=0,this.total=0}};var OA=new G("disposing"),Pc=class extends fn{constructor(e,t,o,r,i,...s){super("audio-element-source",e,i,s),t.connect(this.volumeControl),this.audio=t.mediaElement,this.disable(),this.loadEvt=new no(this),this.playEvt=new oo(this),this.pauseEvt=new ro(this),this.stopEvt=new io(this),this.progEvt=new so(this);let a=c=>{this.audio.currentTime===0||c.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};this.audio.addEventListener("ended",a),this.audio.addEventListener("pause",a),o&&this.audio.addEventListener("play",()=>{if(this.audio.loop&&this.audio.duration>1){let c=this.audio.duration*Math.random();this.audio.currentTime=c}}),r&&(t.mediaElement.preservesPitch=!1,this.audio.addEventListener("play",()=>{t.mediaElement.playbackRate=1+.1*(2*Math.random()-1)})),this.audio.addEventListener("play",()=>{this.dispatchEvent(this.playEvt)}),this.audio.addEventListener("timeupdate",()=>{this.progEvt.value=this.audio.currentTime,this.progEvt.total=this.audio.duration,this.dispatchEvent(this.progEvt)}),this.audio.autoplay&&this.play().catch(()=>pn(()=>this.play())),Lm(this.audio).then(c=>this.dispatchEvent(c?this.loadEvt:new Rc(this,this.audio.error)))}onDisposing(){this.dispatchEvent(OA),super.onDisposing()}get playbackState(){return this.audio.error?"errored":this.audio.ended||this.audio.paused&&this.audio.currentTime===0?"stopped":this.audio.paused?"paused":"playing"}async play(){this.enable(),await this.context.ready,await this.audio.play()}async playThrough(){let e=Ce(this,"stopped");await this.play(),await e}pause(){this.disable(),this.audio.pause()}stop(){this.audio.currentTime=0,this.pause()}restart(){return this.stop(),this.play()}};var Pp=class extends G{constructor(e){super("sourceadded"),this.source=e}},Vc=class extends fn{constructor(e,t,...o){super("audio-stream-source",e,t,o),this._stream=null,this._node=null}get stream(){return this._stream}set stream(e){e!==this.stream&&(g(this.stream)&&(this.remove(this._node),ae(this._node),this._node=null),g(e)&&(this._node=new to(this.context,{mediaStream:e}),this._node.name=Hr("media-stream-source",e.id),this._node.connect(this.volumeControl),this.add(this._node),this.dispatchEvent(new Pp(this))))}};var Ic=class extends Kr{constructor(e){super("no-spatializer",e.context,!1,[e],[e])}readPose(e){}getGainAtDistance(e){return 1}};var $x="juniper::useHeadphones",WA=new G("useheadphonestoggled"),Zx=10,Zr=new G("released"),eg="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",Oc=class extends vt{get algorithm(){return this._algorithm}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}constructor(e,t){let o=new bc;"THREE"in globalThis&&globalThis.THREE.AudioContext.setContext(o);let r=new Lc(o),i=new Ic(r.nonSpatializedInput),s=new dc(r.audioElement);super("audio-manager",o,null,null,[i,r]),this.fetcher=e,this.users=new Map,this.clips=new Map,this.pendingAudio=new Array,this.audioPool=new Array,this.elements=new Map,this.elementCounts=new Map,this._minDistance=.25,this._maxDistance=100,this._algorithm="inverse",this._useHeadphones=!1,this.destination=null,this._ready=new se,this.localUserID=null,this.destination=r,this.noSpatializer=i,this.speakers=s,dn(this.context.ready,this.destination.ready,this.speakers.ready).then(()=>this._ready.resolve()),this.setLocalUserID(t);let a=localStorage.getItem($x);g(a)?this._useHeadphones=a==="true":this._useHeadphones=yn(),this.enpool(),Or()&&pn(()=>{let c=[...this.pendingAudio];de(this.pendingAudio);for(let p of c)p()},!0),Object.seal(this)}enpool(){for(let e=0;e<Zx;++e){let t=new se,o=an(Gn(eg),qt(!1),Hx(()=>{o.pause(),o.src=eg}));this.audioPool.push(t),Or()?this.pendingAudio.push(()=>{o.play(),t.resolve(o)}):t.resolve(o)}}preparePool(e){for(;this.audioPool.length<e;)this.enpool()}async getPooledAudio(...e){if(this.audioPool.length===0)throw new Error("Audio pool exhausted!");let t=this.audioPool.shift();this.audioPool.length<=Zx/2&&this.enpool();let o=await t;return o.pause(),te(o,...e),o}async getPooledSource(e,t,o){if(!this.elements.has(e)){let i=await this.getPooledAudio(Gn(t),Un(o&&!Or()));Or()&&o&&i.addEventListener("ended",()=>i.play());let s=new Kt(this.context,{mediaElement:i});s.name=Hr("media-element-source",e),this.elements.set(e,s),this.elementCounts.set(e,0)}let r=this.elements.get(e);return this.elementCounts.set(e,this.elementCounts.get(e)+1),r}releasePooledSource(e){let t=this.elements.get(e);this.elementCounts.set(e,this.elementCounts.get(e)-1),this.elementCounts.get(e)===0&&(t.mediaElement.dispatchEvent(Zr),this.elementCounts.delete(e),this.elements.delete(e))}get useHeadphones(){return this._useHeadphones}set useHeadphones(e){e!==this.useHeadphones&&(this._useHeadphones=e,localStorage.setItem($x,this.useHeadphones.toString()),this.dispatchEvent(WA))}onDisposing(){this.context.suspend();for(let e of this.users.keys())this.removeUser(e);for(let e of this.clips.keys())this.removeClip(e);super.onDisposing()}get currentTime(){return this.context.currentTime}createSpatializer(e,t){if(e){let o=this.destination.createSpatializer(t);return o.setAudioProperties(this._minDistance,this._maxDistance,this._algorithm),o}else return this.noSpatializer}createUser(e,t){if(!this.users.has(e)){let o=new Vc(this.context,this.createSpatializer(!0,!0));o.name=Hr(t,e),this.users.set(e,o)}return this.users.get(e)}setLocalUserID(e){return this.destination&&(this.localUserID=e),this.destination}createBasicClip(e,t,o){return this.createClip(e,t,!1,!1,!1,!0,o,[])}hasClip(e){return this.clips.has(e)}async createClip(e,t,o,r,i,s,a,c,p){await this.ready;let m,x;X(t)?(m=t,x=await this.fetcher.get(t).progress(p).file().then(dt)):(m=t.path,x=t.result);let w=await this.getPooledSource(m,x,o),_=new Pc(this.context,w,i,s,this.createSpatializer(r,!1),...c);return _.addEventListener("disposing",()=>this.releasePooledSource(m)),_.name=Hr("audio-clip-element",e),_.volume=a,this.clips.set(e,_),_}async playClip(e){this.hasClip(e)&&await this.clips.get(e).play()}async playClipThrough(e){this.hasClip(e)&&await this.clips.get(e).playThrough()}stopClip(e){this.hasClip(e)&&this.clips.get(e).stop()}getUser(e){return this.users.get(e)}getClip(e){return this.clips.get(e)}removeSource(e,t){let o=e.get(t);return g(o)&&(e.delete(t),ae(o)),o}removeUser(e){let t=this.removeSource(this.users,e);g(t.stream)&&(t.stream=null)}removeClip(e){let t=this.removeSource(this.clips,e);return ae(t),t}setUserStream(e,t){if(this.users.has(e)){let o=this.users.get(e);o.stream=t}}setAudioProperties(e,t,o){this._minDistance=e,this._maxDistance=t,this._algorithm=o;for(let r of this.users.values())r.setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let r of this.clips.values())r.setAudioProperties(r.minDistance,r.maxDistance,this.algorithm)}withPoser(e,t,o){let i=e.get(t)||this.destination;return o(i)}withUser(e,t){return this.withPoser(this.users,e,t)}withClip(e,t){return this.withPoser(this.clips,e,t)}setUserPose(e,t,o,r,i,s,a,c){this.withUser(e,p=>{p.set(t,o,r,i,s,a,c)})}setUserPosition(e,t,o,r){this.withUser(e,i=>{i.setPosition(t,o,r)})}setUserOrientation(e,t,o,r,i){this.withUser(e,s=>{s.setOrientation(t,o,r,i)})}setClipPose(e,t,o,r,i,s,a,c){this.withClip(e,p=>{p.set(t,o,r,i,s,a,c)})}setClipPosition(e,t,o,r){this.withClip(e,i=>{i.setPosition(t,o,r)})}setClipOrientation(e,t,o,r,i){this.withClip(e,s=>{s.setOrientation(t,o,r,i)})}};var ei=class extends G{constructor(e,t){super("streamchanged"),this.oldStream=e,this.newStream=t}};var tg="calla:preferredAudioInputID",Wc=class extends vt{constructor(e){let t=e.createGain();t.name="local-mic-user-gain";let o=e.createGain();o.name="local-mic-auto-gain";let r=new mn(e,{type:"bandpass",frequency:1500,Q:.25});r.name="local-mic-filter";let i=new zr(e,{threshold:-15,knee:40,ratio:17});i.name="local-mic-compressor";let s=new eo(e);s.name="local-mic-destination",super("local-user-microphone",e,[],[i],[t,r,s]),this.localStreamNode=null,this._hasPermission=!1,this._usingHeadphones=!1,this._device=null,this._enabled=!1,this.volume=t,this.autoGainNode=o,this.compressor=i,this.output=s,t.connect(o).connect(r).connect(i).connect(s),Object.seal(this)}get mediaType(){return"audio"}get deviceKind(){return`${this.mediaType}input`}get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.onChange())}get hasPermission(){return this._hasPermission}get preferredDeviceID(){return localStorage.getItem(tg)}get device(){return this._device}async setDevice(e){if(g(e)&&e.kind!==this.deviceKind)throw new Error(`Device is not an audio input device. Was: ${e.kind}. Label: ${e.label}`);let t=this.device&&this.device.deviceId||null,o=e&&e.deviceId||null;o!==t&&(this._device=e,localStorage.setItem(tg,o),this.onChange())}get inStream(){return this.localStreamNode&&this.localStreamNode.mediaStream||null}set inStream(e){e!==this.inStream&&(this.localStreamNode&&(this.remove(this.localStreamNode),ae(this.localStreamNode),this.localStreamNode=null),e&&(this.localStreamNode=new to(this.context,{mediaStream:e}),this.add(this.localStreamNode),this.localStreamNode.connect(this.volume)))}get outStream(){return this.output.stream}get gain(){return this.volume.gain}get muted(){return this.compressor.isConnected(this.output)}set muted(e){e!==this.muted&&(e?this.compressor.connect(this.output):this.compressor.disconnect(this.output))}get usingHeadphones(){return this._usingHeadphones}set usingHeadphones(e){e!==this.usingHeadphones&&(this._usingHeadphones=e,this.onChange())}async onChange(){this.dispatchEvent(new Ur);let e=this.inStream;this.device&&this.enabled?this.inStream=await navigator.mediaDevices.getUserMedia({audio:{deviceId:this.device.deviceId,echoCancellation:!this.usingHeadphones,autoGainControl:!0,noiseSuppression:!0}}):this.inStream=null,this.inStream!==e&&this.dispatchEvent(new ei(e,this.outStream))}};function Vp(n){return g(n)&&n.length>0?parseFloat(n):null}var ti=class{constructor(e,t){this._url=null,this._base=void 0,this._protocol=null,this._host=null,this._hostName=null,this._userName=null,this._password=null,this._port=null,this._pathName=null,this._hash=null,this._query=new Map,e!==void 0&&(this._url=new URL(e,t),this.rehydrate())}rehydrate(){g(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),g(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),g(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),g(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),g(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),g(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),g(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),g(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[e,t]of this._query)this._url.searchParams.set(e,t);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=Vp(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((e,t)=>this._query.set(t,e))}refresh(){if(this._url===null){if(g(this._protocol)&&(g(this._host)||g(this._hostName))){if(g(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=Vp(this._url.port),this.rehydrate(),!1;if(g(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(g(this._pathName)&&g(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return g(this._url)}base(e){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=e,this.refresh(),this}protocol(e){return this._protocol=e,this.refresh()&&(this._url.protocol=e),this}host(e){return this._host=e,this.refresh()&&(this._url.host=e,this._hostName=this._url.hostname,this._port=Vp(this._url.port)),this}hostName(e){return this._hostName=e,this.refresh()&&(this._url.hostname=e,this._host=`${this._url.hostname}:${this._url.port}`),this}port(e){return this._port=e,this.refresh()&&(this._url.port=e.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(e){return this._userName=e,this.refresh()&&(this._url.username=e),this}password(e){return this._password=e,this.refresh()&&(this._url.password=e),this}path(e){return this._pathName=e,this.refresh()&&(this._url.pathname=e),this}pathPop(e){return e=e||/\/[^/]+\/?$/,this.path(this._pathName.replace(e,""))}pathPush(e){let t=this._pathName;return t.endsWith("/")||(t+="/"),t+=e,this.path(t)}query(e,t){return this._query.set(e,t),this.refresh()&&this._url.searchParams.set(e,t),this}hash(e){return this._hash=e,this.refresh()&&(this._url.hash=e),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};var Hc=on("descending",n=>n.resolution);var Ip=class extends xn{constructor(e,t){super(e,t)}},ni=class extends Ip{constructor(e){super("loading",e)}};var Nc=class extends fn{get data(){return this._data}get loaded(){return this._loaded}get title(){return this.audioElement.title}setTitle(e){this.audioElement.title=e}constructor(e,t){let o=an(Sn(!1),Un(!1),qt(!0)),r=new Kt(e,{mediaElement:o});r.name="JuniperAudioPlayer-Input",super("audio-player",e,t,[],[r]),this.cacheBustSources=new Map,this._data=null,this._loaded=!1,this.sourcesByURL=new Map,this.sources=new Array,this.potatoes=new Array,r.connect(this.volumeControl),this.audioElement=o,this.loadingEvt=new ni(this),this.loadEvt=new no(this),this.playEvt=new oo(this),this.pauseEvt=new ro(this),this.stopEvt=new io(this),this.progEvt=new so(this),this.onPlay=async()=>{this.enable(),this.dispatchEvent(this.playEvt)},this.onPause=i=>{this.disable(),this.audioElement.currentTime===0||i.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)},this.onTimeUpdate=async()=>{this.progEvt.value=this.audioElement.currentTime,this.progEvt.total=this.audioElement.duration,this.dispatchEvent(this.progEvt)},this.onError=()=>this.loadAudio(),this.audioElement.addEventListener("play",this.onPlay),this.audioElement.addEventListener("pause",this.onPause),this.audioElement.addEventListener("ended",this.onPause),this.audioElement.addEventListener("error",this.onError),this.audioElement.addEventListener("waiting",this.onWaiting),this.audioElement.addEventListener("canplay",this.onCanPlay),this.audioElement.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{audioPlayer:this})}get hasAudio(){let e=this.sourcesByURL.get(this.audioElement.src);return g(e)&&e.acodec!=="none"||g(this.audioElement.audioTracks)&&this.audioElement.audioTracks.length>0||g(this.audioElement.webkitAudioDecodedByteCount)&&this.audioElement.webkitAudioDecodedByteCount>0||g(this.audioElement.mozHasAudio)&&this.audioElement.mozHasAudio}onDisposing(){super.onDisposing(),this.clear(),this.audioElement.removeEventListener("play",this.onPlay),this.audioElement.removeEventListener("pause",this.onPause),this.audioElement.removeEventListener("ended",this.onPause),this.audioElement.removeEventListener("error",this.onError),this.audioElement.removeEventListener("waiting",this.onWaiting),this.audioElement.removeEventListener("canplay",this.onCanPlay),this.audioElement.removeEventListener("timeupdate",this.onTimeUpdate),this.audioElement.dispatchEvent(Zr)}clear(){this.stop(),this.sourcesByURL.clear(),de(this.sources),de(this.potatoes),this.audioElement.src="",this._data=null,this._loaded=!1}cacheBust(e){let t=this.cacheBustSources.get(e)||0;this.cacheBustSources.set(e,t+1)}async load(e,t){this.clear(),this._data=e,X(e)?(this.setTitle(e),this.potatoes.push(e)):(this.setTitle(e.title),e.audios.sort(Hc),Uh(this.sources,...e.audios));for(let o of this.sources)this.sourcesByURL.set(o.url,o);if(!this.hasSources)throw new Error("No audio sources");if(this.dispatchEvent(this.loadingEvt),await this.loadAudio(t),!this.hasSources)throw new Error("No audio sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}async getMediaCapabilities(e){let t={type:"file",audio:{contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr}};try{return await navigator.mediaCapabilities.decodingInfo(t)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:t}}}get hasSources(){return this.sources.length>0||this.potatoes.length>0}async loadAudio(e){for(g(e)&&e.start(),this.audioElement.removeEventListener("error",this.onError);this.hasSources;){let t=null,o=this.sources.shift();if(g(o)){let i=await this.getMediaCapabilities(o);if(!i.smooth||!i.powerEfficient){this.potatoes.push(o.url);continue}else t=o.url}else t=this.potatoes.shift();let r=this.cacheBustSources.get(this.data);if(g(r)){let i=new ti(t,location.href);i.query("v",r.toString()),t=i.toString()}if(this.audioElement.src=t,this.audioElement.load(),await Aa(this.audioElement)){g(o)?this.sources.unshift(o):this.potatoes.unshift(t),this.audioElement.addEventListener("error",this.onError),g(e)&&e.end();return}}}get playbackState(){return L(this.data)?"empty":this.loaded?this.audioElement.error?"errored":this.audioElement.ended||this.audioElement.paused&&this.audioElement.currentTime===0?"stopped":this.audioElement.paused?"paused":"playing":"loading"}async play(){await this.context.ready,await this.audioElement.play()}async playThrough(){let e=Ce(this,"stopped");await this.play(),await e}pause(){this.audioElement.pause()}stop(){this.pause(),this.audioElement.currentTime=0}restart(){return this.stop(),this.play()}get element(){return this.audioElement}};function Xo(n){return g(n)&&Z(n.then)&&Z(n.catch)&&Z(n.finally)&&Z(n.fetch)&&Z(n.getSize)}var Op=class{get result(){if(g(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}constructor(e,t){this.path=e,this.type=t,this._result=null,this._error=null,this._started=!1,this._finished=!1,this.resolve=null,this.reject=null,this.promise=new Promise((o,r)=>{this.resolve=i=>{this._result=i,this._finished=!0,o(i)},this.reject=i=>{this._error=i,this._finished=!0,r(i)}})}async getSize(e){try{let{contentLength:t}=await e.head(this.path).accept(this.type).exec();return[this,t||1]}catch(t){return console.warn(t),[this,1]}}async fetch(e,t){try{let o=await this.getResult(e,t);this.resolve(o)}catch(o){this.reject(o)}}get[Symbol.toStringTag](){return this.promise.toString()}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}};var oi=class extends Op{constructor(e,t,o){let r;Pt(t)?o=t:r=t,super(e,r),this.useCache=!!o}getResult(e,t){return this.getRequest(e,t).then(dt)}getRequest(e,t){let o=e.get(this.path).useCache(this.useCache).progress(t);return this.getResponse(o)}};var $t=class extends oi{getResponse(e){return e.file(this.type)}},Uc=class extends oi{getResponse(e){return e.image(this.type)}};var ao=class extends oe{constructor(e,t,o){super(),this._scale=250,this._visible=!0,this.wasVisible=null,this.redrawnEvt=new G("redrawn"),g(o)&&g(o.scale)&&(this._scale=o.scale),this._canvas=Ma(e,t),this._g=this.canvas.getContext("2d")}fillRect(e,t,o,r,i,s){this.g.fillStyle=e,this.g.fillRect(t+s,o+s,r-2*s,i-2*s)}drawText(e,t,o,r){this.g.textAlign=r,this.g.strokeText(e,t,o),this.g.fillText(e,t,o)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}onClear(){this.g.clearRect(0,0,this.canvas.width,this.canvas.height)}clear(){this.onClear(),this.dispatchEvent(this.redrawnEvt)}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(e){this.scale!==e&&(this._scale=e,this.redraw())}get visible(){return this._visible}set visible(e){this.visible!==e&&(this.wasVisible=this._visible,this._visible=e,this.redraw())}};var Gc=class extends ao{constructor(){super(128,128),this._pitchDegrees=0,this._headingDegrees=0,this.redraw()}get pitchDegrees(){return this._pitchDegrees}set pitchDegrees(e){e!==this.pitchDegrees&&(this._pitchDegrees=e,this.redraw())}get headingDegrees(){return this._headingDegrees}set headingDegrees(e){e!==this.headingDegrees&&(this._headingDegrees=e,this.redraw())}setPitchAndHeading(e,t){(e!==this.pitchDegrees||t!==this.headingDegrees)&&(this._pitchDegrees=e,this._headingDegrees=t,this.redraw())}onRedraw(){let e=Oe(this.pitchDegrees),t=Oe(this.headingDegrees-180),o=5,r=this.canvas.width-2*o,i=this.canvas.height-2*o,s=.5*r,a=.5*i,c=Math.sin(e),p=this.g;return p.save(),p.clearRect(0,0,this.canvas.width,this.canvas.height),p.translate(o,o),p.scale(s,a),p.translate(1,1),p.fillStyle="gray",p.beginPath(),p.arc(0,0,1,0,_t),p.fill(),p.fillStyle="lightgrey",p.beginPath(),p.arc(0,0,1,0,Te,!0),p.fill(),p.save(),p.scale(1,Math.abs(c)),c<0&&(p.fillStyle="gray"),p.beginPath(),p.arc(0,0,1,0,Te,c<0),p.fill(),p.restore(),p.save(),p.shadowColor=mt(64,64,64),p.shadowBlur=4,p.shadowOffsetX=3,p.shadowOffsetY=3,p.rotate(t),p.fillStyle="red",p.beginPath(),p.moveTo(-.1,0),p.lineTo(0,-.667),p.lineTo(.1,0),p.closePath(),p.fill(),p.fillStyle="white",p.beginPath(),p.moveTo(-.1,0),p.lineTo(0,.667),p.lineTo(.1,0),p.closePath(),p.fill(),p.restore(),p.beginPath(),p.strokeStyle="black",p.lineWidth=.1,p.arc(0,0,1,0,_t),p.stroke(),p.restore(),!0}};function zc(n,e,t){return new Map(n.map(o=>[e(o),t(o)]))}function ng(n,e){return zc(n,Vt,e)}var ps=class extends G{constructor(){super("update"),this.t=0,this.dt=0,this.sdt=0,this.fps=0}set(e,t){this.t=e,this.dt=t,this.sdt=If(this.sdt,t,.01),t>0&&(this.fps=1e3/t)}},Xc=class extends ps{constructor(){super(),Object.seal(this)}};var ri=class{constructor(e){this.timer=null,this.lt=-1,this.tickHandlers=new Array,this._targetFPS=null,this.targetFPS=e;let t=new Xc,o=0;this.onTick=r=>{this.lt>=0&&(o=r-this.lt,t.set(r,o),this.tick(t)),this.lt=r}}get targetFPS(){return this._targetFPS}set targetFPS(e){this._targetFPS=e}addTickHandler(e){this.tickHandlers.push(e)}removeTickHandler(e){Ke(this.tickHandlers,e)}tick(e){for(let t of this.tickHandlers)t(e)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};var jc=class extends ri{constructor(){super()}start(){if(!this.isRunning){let e=t=>{this.timer=requestAnimationFrame(e),this.onTick(t)};this.timer=requestAnimationFrame(e)}}stop(){this.isRunning&&(cancelAnimationFrame(this.timer),super.stop())}};var co=class{constructor(e){this.task=new se(!1),this.element=ge(he("dialog"),at("none"),ha("dialogname",e),this.container=ge(he("dialog-container"),this.titleElement=Im(he("title-bar"),e),this.contentArea=ge(he("dialog-content")),ge(he("dialog-controls"),this.confirmButton=jn("Confirm",he("confirm-button")),this.cancelButton=_a("Cancel",he("cancel-button"))))),this.confirmButton.addEventListener("click",this.task.resolver(!0)),this.cancelButton.addEventListener("click",this.task.resolver(!1)),te(document.body,this)}get title(){return this._title}set title(e){Fa(this.titleElement,this._title=e)}async onShowing(){}onShown(){}async onConfirm(){}onCancel(){}async onClosing(){}onClosed(){}show(e){Ze(this,e)}get isOpen(){return It(this)}hide(){this.show(!1)}async toggle(){this.isOpen?this.hide():this.showDialog()}async showDialog(){return await this.onShowing(),this.show(!0),this.onShown(),this.task.restart(),await this.task?await this.onConfirm():this.onCancel(),await this.onClosing(),this.show(!1),this.onClosed(),this.task.result}};var Ht=20,qc=Ht/2,Wt=Ae.create();function og(n,e){return n<0?0:n>e?e:Number.isFinite(n)?n:(console.trace("To infinity... and beyond!"),e)}var Qc=class extends co{get w(){return this.canvas.width-2*Ht-200}get h(){return this.canvas.height-2*Ht}constructor(e,t,o,r){super(e),this.getNodeName=t,this.getNodeColor=o,this.getWeightMod=r,this.timer=new jc,this.positions=new Map,this.forces=new Map,this.wasGrabbed=new Set,this.mousePoint=Ae.create(),this.grabbed=null,this.graph=null,this.cancelButton.style.display="none";let i=ht(5);te(this.container,Oo(Xn(100)),gm(Xn(100))),te(this.contentArea,ge(at("grid"),xm("repeat(11, auto)",lm(1)),dm(xa(5)),um("center"),...Tr("limit"+i,"Limit",this.t=kr(Po(0),Ro(1e3),Vo(.1),sn(5))),...Tr("cooling"+i,"Cooling",this.cooling=Gi()),...Tr("attract"+i,"Attract",this.attract=kr(Po(-100),Ro(100),Vo(.1),sn(1))),...Tr("repel"+i,"Repel",this.repel=kr(Po(-100),Ro(100),Vo(.1),sn(1))),...Tr("hideBare"+i,"Hide bare nodes",this.hideBare=Gi(da(!0)))),this.canvas=Sr(at("block"),Oo(Xn(100)),Fm("calc(100% - 2em)"))),this.g=this.canvas.getContext("2d"),this.g.textAlign="center",this.g.textBaseline="middle",this.timer.addTickHandler(()=>{this.fr91(),this.draw()}),new ResizeObserver(()=>{Ym(this.g)}).observe(this.canvas);let a=Ae.create();this.canvas.addEventListener("mousedown",c=>{this.setMouse(c),this.grabbed=null;let p=.7071067811865475*Ht;for(let m of this.graph){let x=this.positions.get(m);Ae.sub(a,x,this.mousePoint);let w=Ae.length(a);w<p&&(this.grabbed=m,this.wasGrabbed.has(m)?this.wasGrabbed.delete(m):this.wasGrabbed.add(m),p=w)}}),this.canvas.addEventListener("mousemove",c=>{this.setMouse(c)}),this.canvas.addEventListener("mouseup",()=>{this.grabbed=null})}setMouse(e){let t=e.offsetX*this.canvas.width/this.canvas.clientWidth-Ht,o=e.offsetY*this.canvas.height/this.canvas.clientHeight-Ht;Ae.set(this.mousePoint,t,o)}draw(){this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.g.fillStyle="black",this.g.strokeStyle="black",this.g.save(),this.g.translate(Ht,Ht);for(let e of this.graph){let t=this.positions.get(e);for(let o of e.connections){let r=this.positions.get(o);this.g.beginPath(),this.g.moveTo(t[0],t[1]),this.g.lineTo(r[0],r[1]),this.g.stroke()}}this.g.strokeStyle="lightgrey",this.g.save(),this.g.translate(-qc,-qc);for(let e of this.graph)if(e.isConnected||!this.hideBare.checked){this.g.fillStyle=mt(243,243,243);let t=this.positions.get(e);this.g.fillStyle=this.getNodeColor(e.value),this.g.fillRect(t[0],t[1],Ht,Ht),this.g.strokeRect(t[0],t[1],Ht,Ht),this.g.fillStyle="black",this.g.fillText(this.getNodeName(e.value),t[0]+qc,t[1]+qc)}this.g.restore(),this.g.restore()}applyForces(e,t){let o=ng(this.graph,()=>Ae.create());for(let r of this.graph){let i=this.positions.get(r);if(r===this.grabbed)Ae.copy(i,this.mousePoint);else if(!this.wasGrabbed.has(r)){let s=o.get(r),a=this.forces.get(r);a&&Ae.add(s,s,a),Ae.set(Wt,this.w,this.h),Ae.scaleAndAdd(Wt,i,Wt,-.5);let c=Ae.length(Wt);if(c>0){Ae.normalize(Wt,Wt);let p=-1e4*c;p=Math.sign(p)*Math.pow(Math.abs(p),.2),Ae.scaleAndAdd(s,s,Wt,p)}for(let p of this.graph)if(r!==p){let m=this.positions.get(p);Ae.sub(Wt,m,i);let x=Ae.length(Wt);if(x>0){Ae.normalize(Wt,Wt);let w=r.isConnectedTo(p),_=this.getWeightMod(r.value,p.value,w),T=2-_,y=_*this.attract.valueAsNumber*e(w,x)-T*this.repel.valueAsNumber*t(w,x);Ae.scaleAndAdd(s,s,Wt,y)}}}}for(let r of this.graph){let i=o.get(r);i[1]*=this.h/this.w;let s=Ae.length(i);if(s>0){Ae.scale(i,i,Math.min(this.t.valueAsNumber,s)/s);let a=this.positions.get(r);Ae.add(a,a,i),a[0]=og(a[0],this.w),a[1]=og(a[1],this.h)}}this.cooling.checked&&(this.t.valueAsNumber*=.975)}fr91(){let e=this.w*this.h*.1,t=1,o=1.5,r=.1,i=t*Math.sqrt(e/this.graph.length);for(let s=0;s<2;++s)this.applyForces((a,c)=>a?o*Math.sqrt(c)*c/i:0,(a,c)=>r*i*i/c)}onShown(){super.onShown(),this.refreshData(),this.t.valueAsNumber=5,this.timer.isRunning||this.timer.start()}refreshData(){this.positions.clear(),this.forces.clear(),this.wasGrabbed.clear();let e=Math.min(this.w,this.h)/2;for(let t=0;t<this.graph.length;++t){let o=this.graph[t],r=_t*t/this.graph.length,i=e,s=i*Math.cos(r)+this.w/2,a=i*Math.sin(r)+this.h/2;this.positions.set(o,Ae.fromValues(s,a))}}setGraph(e){this.graph=e}onClosed(){this.timer.stop(),super.onClosed()}};function HA(n){return n.name}function NA(n){if(n.nodeClass==="node")return"lightgreen";if(n.nodeClass==="param")return"lightyellow";if(n.nodeClass==="unknown")return"pink";xe(n.nodeClass)}function UA(n,e,t){return!t||n.nodeClass===e.nodeClass?1:1.8}var Jc=class extends Qc{constructor(e){super("Audio graph",HA,NA,UA),this.context=e}refreshData(){let e=this.context.getAudioGraph(!1);this.setGraph(e),super.refreshData()}};var GA="The quick brown fox jumps over the lazy dog",rg=Zn("juniper::loadedFonts",()=>[]);function ds(n){let e=[];return n.fontStyle&&n.fontStyle!=="normal"&&e.push(n.fontStyle),n.fontVariant&&n.fontVariant!=="normal"&&e.push(n.fontVariant),n.fontWeight&&n.fontWeight!=="normal"&&e.push(n.fontWeight),e.push(xa(n.fontSize)),e.push(n.fontFamily),e.join(" ")}async function Yc(n,e=null,t){if(X(n)||(n=ds(n)),rg.indexOf(n)===-1){e=e||GA,t&&t.start(n);let o=await document.fonts.load(n,e);t&&t.end(n),o.length===0?console.warn(`Failed to load font "${n}". If this is a system font, just set the object's \`value\` property, instead of calling \`loadFontAndSetText\`.`):rg.push(n)}}function ig(n){return"getBattery"in n}var zA=["","N/A","charging"],hs=class extends ao{static{this.isAvailable=ig(navigator)}constructor(){super(256,128),this.battery=null,this.lastChargeDirection=null,this.lastLevel=null,this.chargeDirection=0,this.level=.5,ig(navigator)?this.readBattery(navigator):this.redraw()}onRedraw(){this.battery?(this.chargeDirection=this.battery.charging?1:-1,this.level=this.battery.level):(this.level+=.1,this.level>1&&(this.level=0));let e=this.chargeDirection!==this.lastChargeDirection,t=this.level!==this.lastLevel;if(!e&&!t)return!1;this.lastChargeDirection=this.chargeDirection,this.lastLevel=this.level;let o=this.level<.1?"red":"silver",r=7,i=.7,s=(1-i)/2,a=this.canvas.width-2*r,c=a-4*r,p=this.canvas.height-4*r,m=a/2,x=this.canvas.height/2,w=zA[this.chargeDirection+1];return this.g.clearRect(0,0,a,this.canvas.height),this.g.save(),this.g.translate(s*this.canvas.width,s*this.canvas.height),this.g.globalAlpha=.75,this.g.scale(i,i),this.fillRect("silver",0,0,a,this.canvas.height,0),this.fillRect("silver",a,x-2*r-10,r+10,4*r+20,0),this.g.clearRect(r,r,a-2*r,this.canvas.height-2*r),this.fillRect("black",r,r,a-2*r,this.canvas.height-2*r,0),this.g.clearRect(2*r,2*r,c*this.level,p),this.fillRect(o,2*r,2*r,c*this.level,p,0),this.g.fillStyle="white",this.g.strokeStyle="black",this.g.lineWidth=4,this.g.textBaseline="middle",this.g.font=ds({fontSize:p/2,fontFamily:"Lato"}),this.drawText(w,m,x,"center"),this.g.restore(),!0}async readBattery(e){let t=this.redraw.bind(this);t(),this.battery=await e.getBattery(),this.battery.addEventListener("chargingchange",t),this.battery.addEventListener("levelchange",t),setInterval(t,1e3),t()}};var Zt=class extends ao{constructor(e){super(10,10,e),this.trueWidth=null,this.trueHeight=null,this.trueFontSize=null,this.dx=null,this._minWidth=null,this._maxWidth=null,this._minHeight=null,this._maxHeight=null,this._freezeDimensions=!1,this._dimensionsFrozen=!1,this._bgFillColor=null,this._bgStrokeColor=null,this._bgStrokeSize=null,this._textStrokeColor=null,this._textStrokeSize=null,this._textFillColor="black",this._textDirection="horizontal",this._fontStyle="normal",this._fontVariant="normal",this._fontWeight="normal",this._fontFamily="sans-serif",this._fontSize=20,this._value=null,this.lastValue=null,g(e)&&(g(e.minWidth)&&(this._minWidth=e.minWidth),g(e.maxWidth)&&(this._maxWidth=e.maxWidth),g(e.minHeight)&&(this._minHeight=e.minHeight),g(e.maxHeight)&&(this._maxHeight=e.maxHeight),g(e.freezeDimensions)&&(this._freezeDimensions=e.freezeDimensions),g(e.textStrokeColor)&&(this._textStrokeColor=e.textStrokeColor),g(e.textStrokeSize)&&(this._textStrokeSize=e.textStrokeSize),g(e.bgFillColor)&&(this._bgFillColor=e.bgFillColor),g(e.bgStrokeColor)&&(this._bgStrokeColor=e.bgStrokeColor),g(e.bgStrokeSize)&&(this._bgStrokeSize=e.bgStrokeSize),g(e.value)&&(this._value=e.value),g(e.textFillColor)&&(this._textFillColor=e.textFillColor),g(e.textDirection)&&(this._textDirection=e.textDirection),g(e.fontStyle)&&(this._fontStyle=e.fontStyle),g(e.fontVariant)&&(this._fontVariant=e.fontVariant),g(e.fontWeight)&&(this._fontWeight=e.fontWeight),g(e.fontFamily)&&(this._fontFamily=e.fontFamily),g(e.fontSize)&&(this._fontSize=e.fontSize),g(e.padding)&&(fe(e.padding)?this._padding={left:e.padding,right:e.padding,top:e.padding,bottom:e.padding}:this._padding=e.padding)),L(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(e){this.minWidth!==e&&(this._minWidth=e,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(e){this.maxWidth!==e&&(this._maxWidth=e,this.redraw())}get minHeight(){return this._minHeight}set minHeight(e){this.minHeight!==e&&(this._minHeight=e,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(e){this.maxHeight!==e&&(this._maxHeight=e,this.redraw())}get padding(){return this._padding}set padding(e){if(e instanceof Array)throw new Error("Invalid padding");(this.padding.top!==e.top||this.padding.right!=e.right||this.padding.bottom!=e.bottom||this.padding.left!=e.left)&&(this._padding=e,this.redraw())}get textDirection(){return this._textDirection}set textDirection(e){this.textDirection!==e&&(this._textDirection=e,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(e){this.fontStyle!==e&&(this._fontStyle=e,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(e){this.fontVariant!==e&&(this._fontVariant=e,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(e){this.fontWeight!==e&&(this._fontWeight=e,this.redraw())}get fontSize(){return this._fontSize}set fontSize(e){this.fontSize!==e&&(this._fontSize=e,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(e){this.textFillColor!==e&&(this._textFillColor=e,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(e){this.textStrokeColor!==e&&(this._textStrokeColor=e,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(e){this.textStrokeSize!==e&&(this._textStrokeSize=e,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(e){this.bgFillColor!==e&&(this._bgFillColor=e,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(e){this.bgStrokeColor!==e&&(this._bgStrokeColor=e,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(e){this.bgStrokeSize!==e&&(this._bgStrokeSize=e,this.redraw())}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.redraw())}split(e){return e.replace(/\r\n/g,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.onClear(),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value&&this.value!==this.lastValue){let e=this.split(this.value),t=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let r=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,i=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,s=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,a=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,c=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,p=t?a:i,m=t?c:s,x=t?i:a,w=t?s:c,_=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let T=!1,y=!1,b=1e4,I=0;this.trueFontSize=Jn(this.fontSize*this.scale,I,b);let V=null,P=Number.MAX_VALUE;do{let B=this.fontSize;this._fontSize=this.trueFontSize;let R=ds(this);this._fontSize=B,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=R,this.trueWidth=0,this.trueHeight=0;for(let q of e){let Y=this.g.measureText(q);this.trueWidth=Math.max(this.trueWidth,Y.width),this.trueHeight+=this.trueFontSize,fe(Y.actualBoundingBoxLeft)&&fe(Y.actualBoundingBoxRight)&&fe(Y.actualBoundingBoxAscent)&&fe(Y.actualBoundingBoxDescent)&&(r||(this.trueWidth=Y.actualBoundingBoxLeft+Y.actualBoundingBoxRight,this.trueHeight=Y.actualBoundingBoxAscent+Y.actualBoundingBoxDescent,this.dx=(Y.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(r){let q=this.trueWidth-p,Y=this.trueWidth-m,K=this.trueHeight-x,ee=this.trueHeight-w,me=Math.abs(q),Me=Math.abs(Y),ce=Math.abs(K),ut=Math.abs(ee);T=Y>1||ee>1,y=q<-1&&K<-1;let _n=Math.min(me,Math.min(Me,Math.min(ce,ut)));_n<P&&(P=_n,V=this.g.font),(T||y)&&_.indexOf(this.g.font)>-1&&V&&(this.g.font=V,T=!1,y=!1),T?(b=this.trueFontSize,this.trueFontSize=(I+this.trueFontSize)/2):y&&(I=this.trueFontSize,this.trueFontSize=(this.trueFontSize+b)/2)}_.push(this.g.font)}while(T||y);r&&(this.trueWidth<p?this.trueWidth=p:this.trueWidth>m&&(this.trueWidth=m),this.trueHeight<x?this.trueHeight=x:this.trueHeight>w&&(this.trueHeight=w));let C=this.trueWidth+this.scale*(this.padding.right+this.padding.left),H=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{ya(this.g,C,H)}catch(B){throw console.error(B),B}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let o=.5*(e.length-1);for(let r=0;r<e.length;++r){let i=e[r],s=(r-o)*this.trueFontSize,a=this.dx+this.trueWidth/2+this.scale*this.padding.left,c=s+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(i,a,c),this.textFillColor&&this.g.fillText(i,a,c)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let r=this.bgStrokeSize/2;this.g.strokeRect(r,r,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(t){let r=Mn(this.canvas.height,this.canvas.width),i=r.getContext("2d");i?(i.translate(r.width/2,r.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?i.rotate(je):this.textDirection==="vertical-right"&&i.rotate(-je),i.translate(-this.canvas.width/2,-this.canvas.height/2),i.drawImage(this.canvas,0,0),ya(this.g,r.width,r.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(r,0,0)}return this.lastValue=this.value,!0}else{let e=this.value!==this.lastValue;return this.lastValue=this.value,e}}};var Kc=class extends Zt{constructor(){super({textFillColor:"white",textStrokeColor:mt(0,0,0,.5),textStrokeSize:.025,fontFamily:vr(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,freezeDimensions:!0});let e=this.update.bind(this);setInterval(e,500),e()}update(){let t=new Date().toLocaleTimeString();(L(this.value)||t.length!==this.value.length)&&this.unfreeze(),this.value=t}};var $c=class extends Zt{constructor(){super({textFillColor:"white",textStrokeColor:mt(0,0,0,.5),textStrokeSize:.025,fontFamily:vr(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,freezeDimensions:!0}),this.fps=null,this.drawCalls=null,this.triangles=null}setStats(e,t,o){this.fps=e,this.drawCalls=t,this.triangles=o;let r=` ${Math.round(this.fps).toFixed(0)}hz ${this.drawCalls}c ${this.triangles}t`;(L(this.value)||r.length!==this.value.length)&&this.unfreeze(),this.value=r}};var wt=class{constructor(e){if(this.items=new Map,this.defaultItems=new Array,g(e))for(let[t,o]of e)this.add(t,o)}add(e,...t){for(let o of t)if(L(e))this.defaultItems.push(o);else{let r=this.items.get(e);L(r)&&this.items.set(e,r=[]),r.push(o)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let e of this.defaultItems)yield e;for(let e of this.items.values())for(let t of e)yield t}has(e){return g(e)?this.items.has(e):this.defaultItems.length>0}get(e){return L(e)?this.defaultItems:this.items.get(e)||[]}count(e){if(L(e))return this.defaultItems.length;let t=this.get(e);return g(t)?t.length:0}get size(){let e=this.defaultItems.length;for(let t of this.items.values())e+=t.length;return e}delete(e){return L(e)?de(this.defaultItems).length>0:this.items.delete(e)}remove(e,t){if(L(e))Ke(this.defaultItems,t);else{let o=this.items.get(e);g(o)&&(Ke(o,t),o.length===0&&this.items.delete(e))}}clear(){this.items.clear(),de(this.defaultItems)}};function sg(n){return X(n.vcodec)}var ms=class n extends fn{get data(){return this._data}get loaded(){return this._loaded}get title(){return this.video.title}setTitle(e){this.video.title=e,this.audio.title=e}constructor(e,t,o){let r=n.createMediaElement(Ui,qt(!0)),i=n.createMediaElement(an,qt(!1)),s=new Kt(t,{mediaElement:r});s.name=`${e}-video`;let a=new Kt(t,{mediaElement:i});a.name=`${e}-audio`,super(e,t,o,[],[s,a]),this.onTimeUpdate=null,this.wasUsingAudioElement=!1,this.nextStartTime=null,this._data=null,this._loaded=!1,this.onError=new Map,this.sourcesByURL=new Map,this.sources=new wt,this.potatoes=new wt,s.connect(this.volumeControl),a.connect(this.volumeControl),this.video=r,this.audio=i,this.loadingEvt=new ni(this),this.loadEvt=new no(this),this.playEvt=new oo(this),this.pauseEvt=new ro(this),this.stopEvt=new io(this),this.progEvt=new so(this),this.onSeeked=()=>{this.useAudioElement&&(this.audio.currentTime=this.video.currentTime)},this.onPlay=async()=>{this.onSeeked(),this.useAudioElement&&(await this.context.ready,await this.audio.play()),this.dispatchEvent(this.playEvt)},this.onPause=p=>{this.useAudioElement&&(this.onSeeked(),this.audio.pause()),this.video.currentTime===0||p.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};let c=!1;this.onWaiting=()=>{this.useAudioElement&&(c=!0,this.audio.pause())},this.onCanPlay=async()=>{this.useAudioElement&&c&&(await this.context.ready,await this.audio.play(),c=!1)},this.wasUsingAudioElement=!1,this.onTimeUpdate=async()=>{if(this.video.getVideoPlaybackQuality().totalVideoFrames===0){let m=this.onError.get(this.video);g(m)&&await m()}else if(this.useAudioElement){this.wasUsingAudioElement=!1;let m=this.video.currentTime-this.audio.currentTime;Math.abs(m)>.25&&(this.audio.currentTime=this.video.currentTime)}else this.wasUsingAudioElement||(this.wasUsingAudioElement=!0,this.audio.pause());this.progEvt.value=this.video.currentTime,this.progEvt.total=this.video.duration,this.dispatchEvent(this.progEvt)},this.video.addEventListener("seeked",this.onSeeked),this.video.addEventListener("play",this.onPlay),this.video.addEventListener("pause",this.onPause),this.video.addEventListener("ended",this.onPause),this.video.addEventListener("waiting",this.onWaiting),this.video.addEventListener("canplay",this.onCanPlay),this.video.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{videoPlayer:this})}elementHasAudio(e){let t=this.sourcesByURL.get(e.src);return g(t)&&t.acodec!=="none"||g(e.audioTracks)&&e.audioTracks.length>0||g(e.webkitAudioDecodedByteCount)&&e.webkitAudioDecodedByteCount>0||g(e.mozHasAudio)&&e.mozHasAudio}get useAudioElement(){return!this.elementHasAudio(this.video)&&this.elementHasAudio(this.audio)}onDisposing(){this.clear(),this.video.removeEventListener("seeked",this.onSeeked),this.video.removeEventListener("play",this.onPlay),this.video.removeEventListener("pause",this.onPause),this.video.removeEventListener("ended",this.onPause),this.video.removeEventListener("waiting",this.onWaiting),this.video.removeEventListener("canplay",this.onCanPlay),this.video.removeEventListener("timeupdate",this.onTimeUpdate),super.onDisposing(),this.audio.dispatchEvent(Zr),this.video.dispatchEvent(Zr)}clear(){this.stop();for(let[e,t]of this.onError)e.removeEventListener("error",t);this.onError.clear(),this.sourcesByURL.clear(),this.sources.clear(),this.potatoes.clear(),this.video.src="",this.audio.src="",this.wasUsingAudioElement=!1,this._data=null,this._loaded=!1}async load(e,t){if(this.clear(),this._data=e,X(e)?(this.setTitle(e),this.potatoes.add(this.video,e)):(this.setTitle(e.title),this.fillSources(this.video,e.videos),this.fillSources(this.audio,e.audios)),!this.hasSources(this.video))throw new Error("No video sources found");if(this.dispatchEvent(this.loadingEvt),await la(t,o=>this.loadMediaElement(this.audio,o),o=>this.loadMediaElement(this.video,o)),X(e)?this.nextStartTime=null:this.nextStartTime=e.startTime,!this.hasSources(this.video))throw new Error("No video playable sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}fillSources(e,t){t.sort(Hc);for(let o of t)tm.matches(o.contentType)||(this.sources.add(e,o),this.sourcesByURL.set(o.url,o))}static createMediaElement(e,...t){return e(Sn(!1),Un(!1),...t)}async getMediaCapabilities(e){let t={type:"file"};sg(e)?t.video={contentType:e.contentType,bitrate:e.vbr*1024,framerate:e.fps,width:e.width,height:e.height}:e.acodec!=="none"&&(t.audio={contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr});try{return await navigator.mediaCapabilities.decodingInfo(t)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:t}}}hasSources(e){return this.sources.get(e).length>0||this.potatoes.count(e)>0}async loadMediaElement(e,t){for(g(t)&&t.start(),this.onError.has(e)&&(e.removeEventListener("error",this.onError.get(e)),this.onError.delete(e));this.hasSources(e);){let o=null,r=this.sources.get(e).shift();if(g(r)){let i=await this.getMediaCapabilities(r);if(!i.smooth||!i.powerEfficient){this.potatoes.add(e,r.url);continue}else o=r.url}else o=this.potatoes.get(e).shift();if(e.src=o,e.load(),await Aa(e)){g(r)?this.sources.get(e).unshift(r):this.potatoes.get(e).unshift(o);let i=()=>this.loadMediaElement(e,t);e.addEventListener("error",i),this.onError.set(e,i),this.wasUsingAudioElement=this.wasUsingAudioElement,g(t)&&t.end();return}}}get width(){return this.video.videoWidth}get height(){return this.video.videoHeight}get playbackState(){return L(this.data)?"empty":this.loaded?this.video.error?"errored":this.video.ended||this.video.paused&&this.video.currentTime===0?"stopped":this.video.paused?"paused":"playing":"loading"}async play(){await this.context.ready,g(this.nextStartTime)&&this.nextStartTime>0&&(this.video.pause(),this.video.currentTime=this.nextStartTime,this.nextStartTime=null),await this.video.play()}async playThrough(){let e=Ce(this,"stopped");await this.play(),await e}pause(){this.video.pause()}stop(){this.pause(),this.video.currentTime=0}restart(){return this.stop(),this.play()}};var ag="calla:preferredVideoInputID",Zc=class extends oe{constructor(){super(),this.element=Ui(ma(!0)),this._hasPermission=!1,this._device=null,this._enabled=!1,Object.seal(this)}get mediaType(){return"video"}get deviceKind(){return`${this.mediaType}input`}get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.onChange())}get hasPermission(){return this._hasPermission}get preferredDeviceID(){return localStorage.getItem(ag)}get device(){return this._device}checkDevices(e){if(!this.hasPermission){for(let t of e)if(t.kind===this.deviceKind&&t.deviceId.length>0&&t.label.length>0){this._hasPermission=!0;break}}}async setDevice(e){if(g(e)&&e.kind!==this.deviceKind)throw new Error(`Device is not an vide input device. Was: ${e.kind}. Label: ${e.label}`);let t=this.device&&this.device.deviceId||null,o=e&&e.deviceId||null;o!==t&&(this._device=e,localStorage.setItem(ag,o),await this.onChange())}async onChange(){this.dispatchEvent(new Ur);let e=this.inStream;this.device&&this.enabled?this.inStream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.device.deviceId,autoGainControl:!0,height:640,noiseSuppression:!0}}):this.inStream=null,this.inStream!==e&&this.dispatchEvent(new ei(e,this.outStream))}get inStream(){return this.element.srcObject}set inStream(e){e!==this.inStream&&(this.inStream&&this.element.pause(),this.element.srcObject=e,this.inStream&&this.element.play())}get outStream(){return this.inStream}stop(){this.inStream=null}};var cg="local-user";var J;(function(n){n.None="None",n.Fullscreen="Fullscreen",n.VR="VR",n.AR="AR",n.Anaglyph="Anaglyph",n.FullscreenAnaglyph="FullscreenAnaglyph"})(J||(J={}));var el=class{constructor(e){Zn("Juniper.ThreeJS.ScreenUI.ButtonFillColor",()=>Ta(ga("#appContainer > .row > .cell > .btn",pm(e)))),this.elements=[this.topLeft=ge(he("cell","top","left")),this.topCenter=ge(he("cell","top","center")),this.topRight=ge(he("cell","top","right")),this.middleLeft=ge(he("cell","middle","left")),this.middleCenter=ge(he("cell","middle","center")),this.middleRight=ge(he("cell","middle","right")),this.bottomLeft=ge(he("cell","bottom","left")),this.bottomCenter=ge(he("cell","bottom","center")),this.bottomRight=ge(he("cell","bottom","right"))],this.cells=[[this.topLeft,this.topCenter,this.topRight],[this.middleLeft,this.middleCenter,this.middleRight],[this.bottomLeft,this.bottomCenter,this.bottomRight]],this.hide()}show(){this.elements.forEach(e=>e.style.removeProperty("display"))}hide(){this.elements.forEach(e=>e.style.display="none")}};function lg(n){return"height"in n}function ug(n){return"width"in n}var XA=1.25,jA=Oe(30),qA=Oe(32),tl=class extends Re{constructor(){super(),this.name="SpaceUI",this.position.y=-.25}addItem(e,t){e=ft(e),N(this,e),e.rotation.set(t.y*qA,-t.x*jA,0,"YXZ"),e.position.set(0,0,-XA).applyEuler(e.rotation),lg(t)&&ug(t)?e.scale.set(t.width,t.height,1):lg(t)?e.scale.multiplyScalar(t.height/e.scale.y):ug(t)?e.scale.multiplyScalar(t.width/e.scale.x):e.scale.setScalar(t.scale),e.scale.z=1}};var St=class{constructor(e){if(this.items=new Map,g(e))for(let[t,o,r]of e)this.add(t,o,r)}add(e,t,o){let r=this.items.get(e);return L(r)&&this.items.set(e,r=new Map),r.set(t,o),this}*entries(){for(let[e,t]of this.items)for(let[o,r]of t)yield[e,o,r]}keys(e){return L(e)?this.items.keys():this.items.get(e).keys()}*values(){for(let e of this.items.values())for(let t of e.values())yield t}has(e,t){return this.items.has(e)&&(L(t)||this.items.get(e).has(t))}get(e,t){return L(t)?this.items.get(e):this.items.has(e)?this.items.get(e).get(t):null}count(e){return this.items.has(e)?this.items.get(e).size:null}get size(){let e=0;for(let t of this.items.values())e+=t.size;return e}delete(e,t){if(L(t))return this.items.delete(e);if(this.items.has(e)){let o=this.items.get(e),r=o.delete(t);return o.size===0&&this.items.delete(e),r}else return!1}clear(){this.items.clear()}};function QA(n){return[dg([n[1],n[0],n[2]]),dg([n[2],n[0],n[3]])]}function mg(n){return n.map(QA).flat()}var Wp=new W,pg=new W,nl=new W;function dg(n){let e=[[n[0][0],n[0][1],n[0][2]],[n[1][0],n[1][1],n[1][2]],[n[2][0],n[2][1],n[2][2]]],t=[[n[0][3],n[0][4]],[n[1][3],n[1][4]],[n[2][3],n[2][4]]];nl.fromArray(e[0]),Wp.fromArray(e[1]).sub(nl),nl.fromArray(e[2]),pg.fromArray(e[1]).sub(nl),Wp.cross(pg);let o=Wp.toArray();return{positions:e,uvs:t,normal:o}}function fg(n){let e=n.map(i=>i.positions).flat(2),t=n.map(i=>i.uvs).flat(2),o=n.flatMap(i=>i.normal),r=new Ji;return r.setAttribute("position",new bn(new Float32Array(e),3,!1)),r.setAttribute("uv",new bn(new Float32Array(t),2,!1)),r.setAttribute("normal",new bn(new Float32Array(o),3,!0)),r}function en(...n){let e=mg(n);return fg(e)}function ii(n,...e){let t=JA(e);for(let r=0;r<n;++r)t=KA(t);e=YA(t);let o=mg(e);return fg(o)}function JA(n){return n.map(e=>{let t=Number.MAX_VALUE,o=Number.MIN_VALUE,r=Number.MAX_VALUE,i=Number.MIN_VALUE;for(let c of e){let p=c[3],m=c[4];t=Math.min(t,p),o=Math.max(o,p),r=Math.min(r,m),i=Math.max(i,m)}let s=[t,r],a=[o-t,i-r];return{minUV:s,deltaUV:a,verts:[ol(s,a,e[0]),ol(s,a,e[1]),ol(s,a,e[2]),ol(s,a,e[3])]}})}function ol(n,e,t){return{pos:[t[0],t[1],t[2]],uv:[t[3],t[4]],pUV:[(t[3]-n[0])/e[0],(t[4]-n[1])/e[1]]}}function YA(n){return n.map(e=>[rl(e,0),rl(e,1),rl(e,2),rl(e,3)])}function rl(n,e){let t=n.verts[e];return[t.pos[0],t.pos[1],t.pos[2],t.uv[0],t.uv[1]]}function KA(n){return n.flatMap(e=>{let t=fs(e,e.verts[0],e.verts[1]),o=fs(e,e.verts[2],e.verts[3]),r=fs(e,e.verts[0],e.verts[3]),i=fs(e,e.verts[1],e.verts[2]),s=fs(e,t,o);return[{minUV:e.minUV,deltaUV:e.deltaUV,verts:[e.verts[0],t,s,r]},{minUV:e.minUV,deltaUV:e.deltaUV,verts:[t,e.verts[1],i,s]},{minUV:e.minUV,deltaUV:e.deltaUV,verts:[s,i,e.verts[2],o]},{minUV:e.minUV,deltaUV:e.deltaUV,verts:[r,s,o,e.verts[3]]}]})}function fs(n,e,t){let o=t.pos[0]-e.pos[0],r=t.pos[1]-e.pos[1],i=t.pos[2]-e.pos[2],s=e.pos[0]+.5*o,a=e.pos[1]+.5*r,c=e.pos[2]+.5*i,p=t.pUV[0]-e.pUV[0],m=t.pUV[1]-e.pUV[1],x=e.pUV[0]+.5*p,w=e.pUV[1]+.5*m,_=hg(x-.5)+.5,T=hg(w-.5)+.5,y=_*n.deltaUV[0]+n.minUV[0],b=T*n.deltaUV[1]+n.minUV[1];return{pos:[s,a,c],pUV:[x,w],uv:[y,b]}}function hg(n){return Math.atan(2*n)/je}ts.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new qe(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};Zi.line={uniforms:_p.merge([ts.common,ts.fog,ts.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var Cn=class extends qa{constructor(e){super({type:"LineMaterial",uniforms:_p.clone(Zi.line.uniforms),vertexShader:Zi.line.vertexShader,fragmentShader:Zi.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}};Cn.prototype.isLineMaterial=!0;var Hp=Zn("Juniper:Three:Materials",()=>new Map);function $A(n,e){e in n&&delete n[e]}function il(n,e,t){let o=`${n}_${Object.keys(t).map(r=>`${r}:${t[r]}`).join(",")}`;return Hp.has(o)||($A(t,"name"),Hp.set(o,new e(t))),Hp.get(o)}function ZA(n){return Object.assign(n,{transparent:!0})}function xg(n){return il("solid",ot,n)}function si(n){return il("solidTransparent",ot,ZA(n))}function Np(n){return il("lit",yr,n)}function gg(n){return il("line2",Cn,n)}function xs(n,e){let t=new Set;n.traverse(o=>{if(Dt(o)&&Sp(o.material)){let r=o.material,i=e(r);r!==i&&(t.add(r),o.material=i)}});for(let o of t)qn(o)}function wg(n){if(n.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let e={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,dithering:n.dithering,envMap:n.envMap,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.emissiveMap||n.map,name:n.name+"-Standard-To-Basic",opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,shadowSide:n.shadowSide,side:n.side,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[t,o]of Object.entries(e))L(o)&&delete e[t];return new ot(e)}function gs(n){if(n.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let e={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,bumpMap:n.bumpMap,bumpScale:n.bumpScale,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,displacementBias:n.displacementBias,displacementMap:n.displacementMap,displacementScale:n.displacementScale,dithering:n.dithering,emissive:n.emissive,emissiveIntensity:n.emissiveIntensity,emissiveMap:n.emissiveMap,envMap:n.envMap,flatShading:n.flatShading,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.map,name:n.name+"-Standard-To-Phong",normalMap:n.normalMap,normalMapType:n.normalMapType,normalScale:n.normalScale,opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,shadowSide:n.shadowSide,side:n.side,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[t,o]of Object.entries(e))L(o)&&delete e[t];return new yr(e)}function Fg(n){if(n.type!=="MeshPhysicalMaterial")throw new Error("Input material is not MeshPhysicalMaterial");let e={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,bumpMap:n.bumpMap,bumpScale:n.bumpScale,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,displacementBias:n.displacementBias,displacementMap:n.displacementMap,displacementScale:n.displacementScale,dithering:n.dithering,emissive:n.emissive,emissiveIntensity:n.emissiveIntensity,emissiveMap:n.emissiveMap,envMap:n.envMap,flatShading:n.flatShading,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.map,name:n.name+"-Standard-To-Phong",normalMap:n.normalMap,normalMapType:n.normalMapType,normalScale:n.normalScale,opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,reflectivity:n.reflectivity,shadowSide:n.shadowSide,shininess:n.sheen,side:n.side,specular:n.specularColor,specularMap:n.specularColorMap,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[t,o]of Object.entries(e))L(o)&&delete e[t];return new yr(e)}var e2=12632256,Up=16777215;var Gp=Np({color:e2}),Ag=Np({color:Up});function sl(n){return n instanceof HTMLVideoElement?n.videoWidth:n instanceof VideoFrame?n.displayWidth:n.width}function al(n){return n instanceof HTMLVideoElement?n.videoHeight:n instanceof VideoFrame?n.displayHeight:n.height}var _g=304.79999999999995,mP=_g*3,t2=10*100,n2=_g*16.5,o2=n2*40,fP=t2*1e3,xP=o2*8,vg=2.54*4,Sg=vg*3,gP=Sg*3,r2=Sg*16.5,i2=r2*40,wP=100*1e3,FP=i2*8,zp=4*3,s2=zp*3,ws=100/2.54,a2=zp*16.5,c2=a2*40,AP=ws*1e3,_P=c2*8,vP=3*3,l2=100/vg,u2=3*16.5,p2=u2*40,SP=l2*1e3,TP=p2*8,Xp=ws/zp,d2=16.5*40,kP=Xp*1e3,MP=d2*8,h2=ws/s2,m2=16.5/3,f2=m2*40,bP=h2*1e3,EP=f2*8,Tg=16.5/Xp,kg=Tg*40,yP=kg*8,DP=1e3/Tg,CP=40*8,x2=1e3/kg,BP=8/x2;function Mg(n){return n/Xp}function bg(n){return n/ws}function Eg(n){return n*ws}var jp=new Kn(1,1,1,1);jp.name="PlaneGeom";var g2=new ke,cl=new W,yg=new ln,Dg=new we;function qp(n,e,t){return g2.copy(n.matrixWorld).invert().multiply(e.matrixWorld).decompose(cl,Dg,t),yg.set(cl.x,cl.y,cl.z,1),new XRRigidTransform(yg,Dg)}var ai=new W,w2=0,jo=class extends Re{constructor(e,t,o,r=null){if(super(),this.webXRLayerType=o,this.lastMatrixWorld=new ke,this._imageWidth=0,this._imageHeight=0,this.forceUpdate=!1,this.wasUsingLayer=!1,this.layer=null,this.curImage=null,this.lastImage=null,this.lastWidth=null,this.lastHeight=null,this.env=null,this.mesh=null,this.stereoLayoutName="mono",this.sizeMode="none",e){this.setEnvAndName(e,t);let i=Dx(r)?r:si(Object.assign({},r,{name:this.name}));N(this,this.mesh=Lr(t+"-Mesh",jp,i))}}copy(e,t=!0){return super.copy(e,t),this.webXRLayerType=e.webXRLayerType,this.setImageSize(e.imageWidth,e.imageHeight),this.setEnvAndName(e.env,e.name+ ++w2),this.mesh=pt(this.children,Dt),L(this.mesh)&&(this.mesh=e.mesh.clone(),N(this,this.mesh)),this.setTextureMap(e.curImage),this}dispose(){this.env.removeScope(this),this.disposeImage(),ve(this.mesh)}disposeImage(){this.removeWebXRLayer(),ve(this.mesh.material.map),this.curImage=null}setImageSize(e,t){if(e!==this.imageWidth||t!==this.imageHeight){let{objectWidth:o,objectHeight:r}=this;this._imageWidth=e,this._imageHeight=t,this.sizeMode!=="none"&&(this.sizeMode==="fixed-width"?this.objectWidth=o:this.objectHeight=r)}}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get imageAspectRatio(){return this.imageWidth/this.imageHeight}get objectWidth(){return this.scale.x}set objectWidth(e){this.scale.set(e,this.scale.y=e/this.imageAspectRatio,1)}get objectHeight(){return this.scale.y}set objectHeight(e){this.scale.set(this.imageAspectRatio*e,e,1)}get pixelDensity(){let e=Eg(this.objectWidth);return this.imageWidth/e}set pixelDensity(e){let t=this.imageWidth/e,o=bg(t);this.objectWidth=o}setEnvAndName(e,t){this.env=e,this.name=t,this.env.addScopedEventListener(this,"update",o=>this.checkWebXRLayer(o.frame))}get needsLayer(){return!$a(this)||L(this.mesh.material.map)||L(this.curImage)?!1:this.curImage instanceof HTMLVideoElement?!this.curImage.paused||this.curImage.currentTime>0:!0}removeWebXRLayer(){if(g(this.layer)){this.wasUsingLayer=!1,this.env.removeWebXRLayer(this.layer),this.mesh.visible=!0;let e=this.layer;this.layer=null,setTimeout(()=>qn(e),100)}}setTextureMap(e){this.curImage&&this.disposeImage(),e&&(Gm(e)?e=qm(e):zm(e)&&(e=Qm(e)),ka(e)&&(e=e),this.curImage=e,this.setImageSize(sl(e),al(e)),e instanceof HTMLVideoElement?this.mesh.material.map=new Tx(e):(this.mesh.material.map=new Go(e),this.mesh.material.map.needsUpdate=!0)),this.mesh.material.needsUpdate=!0}get isVideo(){return this.curImage instanceof HTMLVideoElement}updateTexture(){if(g(this.curImage)){let e=sl(this.curImage),t=al(this.curImage);if(this.imageWidth!==e||this.imageHeight!==t){let o=this.curImage;this.disposeImage(),this.setTextureMap(o)}else this.mesh.material.map.needsUpdate=this.forceUpdate=!0}}checkWebXRLayer(e){if(this.mesh.material.map&&this.curImage){let o=this.webXRLayerType!=="none"&&this.env.hasXRCompositionLayers&&this.env.showWebXRLayers&&g(e)&&(this.isVideo&&g(this.env.xrMediaBinding)||!this.isVideo&&g(this.env.xrBinding))&&this.needsLayer,r=o!==this.wasUsingLayer,i=this.curImage!==this.lastImage||this.mesh.material.needsUpdate||this.mesh.material.map.needsUpdate||this.forceUpdate,s=this.imageWidth!==this.lastWidth||this.imageHeight!==this.lastHeight;if(this.wasUsingLayer=o,this.lastImage=this.curImage,this.lastWidth=this.imageWidth,this.lastHeight=this.imageHeight,(r||s)&&((!o||s)&&this.layer&&this.removeWebXRLayer(),o)){let a=this.env.referenceSpace,c=qp(this.env.stage,this.mesh,ai);this.lastMatrixWorld.copy(this.matrixWorld);let p=ai.x/2,m=ai.y/2,x=this.stereoLayoutName==="mono"?"mono":this.stereoLayoutName==="left-right"||this.stereoLayoutName==="right-left"?"stereo-left-right":"stereo-top-bottom";if(this.isVideo){let w=this.stereoLayoutName==="right-left"||this.stereoLayoutName==="bottom-top";this.layer=this.env.xrMediaBinding.createQuadLayer(this.curImage,{space:a,layout:x,invertStereo:w,transform:c,width:p,height:m})}else this.layer=this.env.xrBinding.createQuadLayer({space:a,layout:x,textureType:"texture",isStatic:this.webXRLayerType==="static",viewPixelWidth:sl(this.curImage),viewPixelHeight:al(this.curImage),transform:c,width:p,height:m});this.env.addWebXRLayer(this.layer,500),this.mesh.visible=!1}if(this.layer){if(i||this.layer.needsRedraw){let a=this.env.gl,c=this.env.xrBinding.getSubImage(this.layer,e);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.bindTexture(a.TEXTURE_2D,c.colorTexture),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.curImage),a.generateMipmap(a.TEXTURE_2D),a.bindTexture(a.TEXTURE_2D,null),this.forceUpdate=!1}ca(this.matrixWorld.elements,this.lastMatrixWorld.elements)>=0&&(this.layer.transform=qp(this.env.stage,this.mesh,ai),this.lastMatrixWorld.copy(this.matrixWorld),this.layer.width=ai.x/2,this.layer.height=ai.y/2)}else this.forceUpdate=!1}}};var ul=class extends ms{constructor(e,t,o){super("video-player-3d",t,o),this.material=si({name:"videoPlayer-material"}),this.vidMeshes=[];for(let r=0;r<2;++r){let i=new jo(e,`videoPlayer-view${r+1}`,"none",this.material);i.setTextureMap(this.video),i.mesh.renderOrder=4,r>0?i.mesh.layers.disable(0):i.mesh.layers.enable(0),this.vidMeshes.push(i)}this.object=ue("videoPlayer",...this.vidMeshes)}get meshes(){return this.vidMeshes.map(e=>e.mesh)}onDisposing(){super.onDisposing(),ve(this.object),de(this.vidMeshes)}isSupported(e,t){return t.split("-").map(o=>Cg.has(e,o)).reduce(qh,!0)}setStereoParameters(e,t){if(!this.isSupported(e,t))throw new Error(`Not supported [encoding: ${e}, layout: ${t}]`);for(let i=0;i<this.vidMeshes.length;++i){let s=this.vidMeshes[i];s.webXRLayerType="none",s.mesh.layers.disable(1),s.mesh.layers.disable(2),t==="left-right"||t==="top-bottom"?s.mesh.layers.enable(this.vidMeshes.length-i):t!=="mono"&&s.mesh.layers.enable(i+1)}let o=this.height/this.width;e!=="N/A"?this.vidMeshes[0].scale.setScalar(100):t==="mono"?this.vidMeshes[0].scale.set(1,o,1):t==="left-right"||t==="right-left"?this.vidMeshes[0].scale.set(1,2*o,1):this.vidMeshes[0].scale.set(1,.5*o,1);for(let i=1;i<this.vidMeshes.length;++i)this.vidMeshes[i].scale.copy(this.vidMeshes[0].scale);let r=t.split("-");for(let i=0;i<r.length;++i){let s=r[i],a=Cg.get(e,s),c=this.vidMeshes[i];c.webXRLayerType="dynamic",c.visible=!0,c.mesh.geometry!==a&&(ve(c.mesh.geometry),c.mesh.geometry=a)}}},F2=en([[-1/2,1/2,0,0,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,0,0]]),Bg=[[-1/2,1/2,0,0,1],[1/2,1/2,0,.5,1],[1/2,-1/2,0,.5,0],[-1/2,-1/2,0,0,0]],Lg=[[-1/2,1/2,0,.5,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,.5,0]],Rg=[[[-1/2,1/2,-1/2,1/3,1],[1/2,1/2,-1/2,2/3,1],[1/2,-1/2,-1/2,2/3,1/2],[-1/2,-1/2,-1/2,1/3,1/2]],[[1/2,1/2,-1/2,2/3,1],[1/2,1/2,1/2,1,1],[1/2,-1/2,1/2,1,1/2],[1/2,-1/2,-1/2,2/3,1/2]],[[-1/2,1/2,1/2,0,1],[-1/2,1/2,-1/2,1/3,1],[-1/2,-1/2,-1/2,1/3,1/2],[-1/2,-1/2,1/2,0,1/2]],[[1/2,1/2,1/2,2/3,1/2],[-1/2,1/2,1/2,2/3,0],[-1/2,-1/2,1/2,1/3,0],[1/2,-1/2,1/2,1/3,1/2]],[[1/2,1/2,-1/2,1,1/2],[-1/2,1/2,-1/2,1,0],[-1/2,1/2,1/2,2/3,0],[1/2,1/2,1/2,2/3,1/2]],[[1/2,-1/2,1/2,1/3,1/2],[-1/2,-1/2,1/2,1/3,0],[-1/2,-1/2,-1/2,0,0],[1/2,-1/2,-1/2,0,1/2]]],Qp=[[[-1/2,1/2,-1/2,0,1/3],[1/2,1/2,-1/2,0,2/3],[1/2,-1/2,-1/2,1/4,2/3],[-1/2,-1/2,-1/2,1/4,1/3]],[[1/2,1/2,-1/2,0,2/3],[1/2,1/2,1/2,0,1],[1/2,-1/2,1/2,1/4,1],[1/2,-1/2,-1/2,1/4,2/3]],[[-1/2,1/2,1/2,0,0],[-1/2,1/2,-1/2,0,1/3],[-1/2,-1/2,-1/2,1/4,1/3],[-1/2,-1/2,1/2,1/4,0]],[[1/2,1/2,1/2,1/4,2/3],[-1/2,1/2,1/2,1/2,2/3],[-1/2,-1/2,1/2,1/2,1/3],[1/2,-1/2,1/2,1/4,1/3]],[[1/2,1/2,-1/2,1/4,1],[-1/2,1/2,-1/2,1/2,1],[-1/2,1/2,1/2,1/2,2/3],[1/2,1/2,1/2,1/4,2/3]],[[1/2,-1/2,1/2,1/4,1/3],[-1/2,-1/2,1/2,1/2,1/3],[-1/2,-1/2,-1/2,1/2,0],[1/2,-1/2,-1/2,1/4,0]]],Jp=[[[-1/2,1/2,-1/2,1/2,1/3],[1/2,1/2,-1/2,1/2,2/3],[1/2,-1/2,-1/2,3/4,2/3],[-1/2,-1/2,-1/2,3/4,1/3]],[[1/2,1/2,-1/2,1/2,2/3],[1/2,1/2,1/2,1/2,1],[1/2,-1/2,1/2,3/4,1],[1/2,-1/2,-1/2,3/4,2/3]],[[-1/2,1/2,1/2,1/2,0],[-1/2,1/2,-1/2,1/2,1/3],[-1/2,-1/2,-1/2,3/4,1/3],[-1/2,-1/2,1/2,3/4,0]],[[1/2,1/2,1/2,3/4,2/3],[-1/2,1/2,1/2,1,2/3],[-1/2,-1/2,1/2,1,1/3],[1/2,-1/2,1/2,3/4,1/3]],[[1/2,1/2,-1/2,3/4,1],[-1/2,1/2,-1/2,1,1],[-1/2,1/2,1/2,1,2/3],[1/2,1/2,1/2,3/4,2/3]],[[1/2,-1/2,1/2,3/4,1/3],[-1/2,-1/2,1/2,1,1/3],[-1/2,-1/2,-1/2,1,0],[1/2,-1/2,-1/2,3/4,0]]],A2=en(Bg),_2=en(Lg),v2=en(Yp(Bg)),S2=en(Yp(Lg)),Pg=Ig(Qp),Vg=Ig(Jp),T2=en(...Rg),k2=en(...Qp),M2=en(...Jp),b2=en(...Pg),E2=en(...Vg),Fs=4,y2=ii(Fs,...Rg),D2=ii(Fs,...Qp),C2=ii(Fs,...Jp),B2=ii(Fs,...Pg),L2=ii(Fs,...Vg),Cg=new St([["N/A","mono",F2],["N/A","left",A2],["N/A","right",_2],["N/A","top",v2],["N/A","bottom",S2],["Cubemap Strips","mono",T2],["Cubemap Strips","left",k2],["Cubemap Strips","right",M2],["Cubemap Strips","top",b2],["Cubemap Strips","bottom",E2],["Equi-Angular Cubemap (YouTube)","mono",y2],["Equi-Angular Cubemap (YouTube)","left",D2],["Equi-Angular Cubemap (YouTube)","right",C2],["Equi-Angular Cubemap (YouTube)","top",B2],["Equi-Angular Cubemap (YouTube)","bottom",L2]]);function ll(n){return[n[0],n[1],n[2],n[4],1-n[3]]}function Yp(n){return[ll(n[0]),ll(n[1]),ll(n[2]),ll(n[3])]}function Ig(n){return n.map(Yp)}async function Se(n,e){let{status:t,requestPath:o,responsePath:r,content:i,contentType:s,contentLength:a,fileName:c,headers:p,date:m}=n;return{status:t,requestPath:o,responsePath:r,content:g(e)?await e(i):void 0,contentType:s,contentLength:a,fileName:c,headers:p,date:m}}var qo=class extends oi{constructor(e,t,o,r){if(!Bo.matches(o)&&!Zh.matches(o))throw new Error("Only GLTF model types are currently supported");super(t,o,r),this.env=e}async getResponse(e){let t=await e.file();return Se(t,o=>this.env.loadGltf(o))}};function Og(n,e){let t=[n];for(;t.length>0;){let o=t.shift();if(e(o))return o;o.children.length>0&&t.push(...o.children)}return null}var pl=class{get object(){return this._model}constructor(e,t){this.disposed=!1,this.asset=new qo(e,t,Bo,!e.DEBUG),this.asset.then(()=>{this._model=Og(this.asset.result.scene,Dt);let c=this._model.material.roughnessMap;xs(this._model,gs),this._model.material.specularMap=c,e.timer.addTickHandler(a)});function o(c){return c.enabled&&(c.grip.visible||c.hand.visible&&c.hand.joints.wrist&&c.hand.joints.wrist.visible)}let r=e.DEBUG,i=e.xrUI.visible,s=0,a=()=>{let c=e.xrUI.visible,p=0;for(let m of e.eventSys.hands)o(m)&&++p;if(c!==i||p!==s||r!==e.DEBUG){if(e.clockImage.isVisible=c||e.DEBUG,c&&p>0){let m=null;for(let w of e.eventSys.hands)o(w)&&(L(m)||w.handedness==="left")&&(m=w);let x=m.grip.visible?m.grip:m.hand.joints.wrist;if(x!==e.clockImage.object.parent){N(x,N(this,e.clockImage,e.batteryImage));let w=m.handedness==="left"?1:0;x===m.grip?(this.object.rotation.set(0,w*Te,-je,"XYZ"),this.object.position.set(0,0,.07)):(this.object.rotation.set(0,w*Te,0,"XYZ"),this.object.position.set(0,0,0)),e.clockImage.scale.setScalar(.0175),e.clockImage.position.set(0,.029,0),e.clockImage.rotation.set(-je,0,-je),g(e.batteryImage)&&(e.batteryImage.scale.set(2,1,1).multiplyScalar(.008),e.batteryImage.position.set(.0075,.029,0),e.batteryImage.rotation.set(-je,0,-je))}}else e.xrUI.addItem(e.clockImage,{x:-1,y:1,height:.1}),g(e.batteryImage)&&e.xrUI.addItem(e.batteryImage,{x:.75,y:-1,width:.2,height:.1});i=c,s=p,r=e.DEBUG}}}dispose(){this.disposed||(g(this.object)&&(this.object.removeFromParent(),ve(this.object),this._model=null),this.disposed=!0)}};function Wg(n,e){return n==="click"&&e&&(n="error"),`InteractionAudio-${n}`}var dl=class{constructor(e,t){this.audio=e,this.eventSys=t;let o=r=>{if(r.pointer.type!=="nose"&&r.rayTarget&&r.rayTarget.clickable){let i=Wg(r.type,!r.rayTarget.enabled);if(this.audio.hasClip(i)){let{x:s,y:a,z:c}=r.point;this.audio.setClipPosition(i,s,a,c),this.audio.playClip(i)}}};this.eventSys.addEventListener("enter",o),this.eventSys.addEventListener("exit",o),this.eventSys.addEventListener("click",o)}create(e,t,o){return this.audio.createClip(Wg(e,!1),t,!1,!0,!1,!0,o,[])}};var Qo=class extends Error{constructor(e,t=null){super(e),this.innerError=t}};var hl="Juniper:ThreeJS:EventSystem:RayTarget",Jo=class extends oe{constructor(e){super(),this.object=e,this.meshes=new Array,this._disabled=!1,this._clickable=!1,this._draggable=!1,this._navigable=!1,this.object.userData[hl]=this}addMesh(e){return e.userData[hl]=this,this.meshes.push(e),this}removeMesh(e){return Ke(this.meshes,e)&&delete e.userData[hl],this}addMeshes(...e){for(let t of e)this.addMesh(t);return this}removeMeshes(...e){for(let t of e)this.removeMesh(t);return this}get disabled(){return this._disabled}set disabled(e){this._disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get clickable(){return this._clickable}set clickable(e){this._clickable=e}get draggable(){return this._draggable}set draggable(e){this._draggable=e}get navigable(){return this._navigable}set navigable(e){this._navigable=e}};function R2(n){return n instanceof Jo}function As(n){let e=null;return n&&(R2(n)?e=n:(n=ft(n),n&&(e=n.userData[hl])),e&&!$a(e)&&(e=null)),e}var ml=class extends Jo{constructor(e,t,o,r,i){e=e+ht(16),super(ue(e)),this.enabledMaterial=o,this.disabledMaterial=r,this.mesh=Lr(`Mesh-${e}-enabled`,t,o),this.size=i,N(this,this.mesh),this.addMesh(this.mesh),this.clickable=!0,this.disabled=this.disabled,ec(this,!0)}get size(){return this.mesh.scale.x}set size(e){this.mesh.scale.setScalar(e)}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.mesh.material=e?this.disabledMaterial:this.enabledMaterial}};var fl=class{constructor(e,t,o,r,i){this.imagePaths=e,this.padding=t,this.buttonFillColor=o,this.labelFillColor=r,this.uvDescrips=new St,this.geoms=new St,this.canvas=null,this.texture=null,this.enabledMaterial=null,this.disabledMaterial=null,this.assetSets=new St(Array.from(this.imagePaths.entries()).map(([s,a,c])=>[s,a,new Uc(c,Kh,!i)])),this.assets=Array.from(this.assetSets.values()),this.ready=Promise.all(this.assets).then(()=>{let s=this.assets.map(R=>R.result),a=Math.max(...s.map(R=>R.width)),c=Math.max(...s.map(R=>R.height)),p=a*c*s.length,m=Math.sqrt(p),x=Math.floor(m/a),w=Math.ceil(s.length/x),_=x*a,T=w*c,y=pp(_),b=pp(T),I=_/y,V=T/b,P=a/y,C=c/b;this.canvas=Ma(y,b);let H=this.canvas.getContext("2d",{alpha:!1});H.fillStyle=this.buttonFillColor,H.fillRect(0,0,y,b);let B=0;for(let[R,q,Y]of this.assetSets.entries()){let K=Y.result,ee=B%x,me=(B-ee)/x,Me=I*(ee*a/_),ce=V*(1-me/w)-C,ut=ee*a,_n=me*c+b-T,bo=a-2*this.padding,Xt=c-2*this.padding;H.drawImage(K,0,0,K.width,K.height,ut+this.padding,_n+this.padding,bo,Xt),this.uvDescrips.add(R,q,{u:Me,v:ce,du:P,dv:C}),++B}this.texture=new Gf(this.canvas),this.enabledMaterial=new ot({map:this.texture}),this.enabledMaterial.needsUpdate=!0,this.disabledMaterial=new ot({map:this.texture,transparent:!0,opacity:.5}),this.disabledMaterial.needsUpdate=!0})}getImageSrc(e,t){let o=this.imagePaths.get(e),r=o&&o.get(t);if(!r)throw new Qo(`Button ${e}/${t} does not exist`,this.uvDescrips);return r}async getMeshButton(e,t,o){await this.ready;let r=this.uvDescrips.get(e),i=r&&r.get(t);if(!r||!i)throw new Qo(`Button ${e}/${t} does not exist`,this.uvDescrips);let s=this.geoms.get(e,t);if(!s){s=new Kn(1,1,1,1),s.name=`Geometry:${e}/${t}`,this.geoms.add(e,t,s);let c=s.getAttribute("uv");for(let p=0;p<c.count;++p){let m=c.getX(p)*i.du+i.u,x=c.getY(p)*i.dv+i.v;c.setX(p,m),c.setY(p,x)}}return new ml(t,s,this.enabledMaterial,this.disabledMaterial,o)}};function Hg(n,e){n.element instanceof HTMLButtonElement&&(n.element.disabled=!e),Za(n,e)}function Ng(n,...e){te(n,...e.filter(bm)),N(n,...e.filter(Lx))}var lo=class{constructor(e,t,o){this.element=e,this.object=t,this.displayType=o}get name(){return this.object.name}addEventListener(e,t,o){this.element.addEventListener(e,t,o)}dispatchEvent(e){return this.element.dispatchEvent(e)}removeEventListener(e,t,o){this.element.removeEventListener(e,t,o)}click(){this.element.click()}get visible(){return It(this)}set visible(e){Ze(this,e,this.displayType),this.object.visible=e}};var ci=class extends lo{constructor(e,t,o){let r=fa(`${t} ${o}`);super(jn(r,kn(r,Gn(e.getImageSrc(t,o)))),ue(`${name}-button`),"inline-block"),this.mesh=null,this.load(e,t,o)}async load(e,t,o){this.mesh=await e.getMeshButton(t,o,.2),this.mesh.disabled=this.disabled,N(this,this.mesh),this.mesh.object.visible=this.visible,this.mesh.addEventListener("click",()=>{this.element.click()})}get disabled(){return this.element.disabled}set disabled(e){this.element.disabled=e,this.mesh&&(this.mesh.disabled=e)}get visible(){return super.visible}set visible(e){super.visible=e,this.mesh&&He(this.mesh,e)}};var P2={type:"redrawn"},uo=class extends jo{get object(){return this}get element(){return Qt(this.image.canvas)?this.image.canvas:null}get canvas(){return this._image.canvas}constructor(e,t,o,r,i){super(e,t,o,i),this._image=null,this.image=r}onRedrawn(){this.updateTexture(),this.dispatchEvent(P2)}get image(){return this._image}set image(e){this.image&&this.image.removeScope(this),this._image=e,this.image&&(this.image.addScopedEventListener(this,"redrawn",()=>this.onRedrawn()),this.setTextureMap(this.image.canvas),this.onRedrawn())}get imageWidth(){return this.image.width}get imageHeight(){return this.image.height}copy(e,t=!0){return super.copy(e,t),this.image=e.image,this}get isVisible(){return It(this)}set isVisible(e){Ze(this,e,"inline-block"),He(this,e),He(this.mesh,e),this.image.visible=e}};function Ug(n){return!n.started||n.finished}var Kp=class extends se{constructor(){super(!1),this.time=0,this.duration=0,this.onTick=null}begin(e,t,o){this.restart(),this.time=-e,this.duration=t,this.onTick=o,this.onTick(0)}update(e){Ug(this)||(this.time+=e/this.duration,this.time>=1?(this.onTick(1),this.resolve()):this.time>=0&&this.onTick(this.time))}},xl=class{constructor(){this.animations=new Array}update(e){e=.001*e;for(let t of this.animations)t.update(e)}clear(){for(let e of this.animations)e.resolve()}start(e,t,o){let r=pt(this.animations,Ug);return r||this.animations.push(r=new Kp),r.begin(e,t,o),r}};var Bn=class extends uo{constructor(e,t,o,r,i){let s;r instanceof Zt?s=r:s=new Zt(r),super(e,t,o,s,i)}onRedrawn(){this.objectHeight=this.imageHeight,super.onRedrawn()}};var _s=class extends Jo{constructor(e,t,o,r){if(super(ue(t)),this.env=e,g(o)){r=Object.assign({textFillColor:"white",fontFamily:"Segoe UI Emoji",fontSize:20,minHeight:.25,maxHeight:.25},r,{value:o}),this.image=new Zt(r);let i=ht(16);this.enabledImage=this.createImage(`${i}-enabled`,1),this.disabledImage=this.createImage(`${i}-disabled`,.5),this.disabledImage.visible=!1,N(this,this.enabledImage,this.disabledImage)}this.addMesh(this.enabledImage.mesh),this.addMesh(this.disabledImage.mesh),this.clickable=!0,g(o)&&ec(this,!0)}createImage(e,t){return new Bn(this.env,`text-${e}`,"none",this.image,{side:Yi,opacity:t})}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.enabledImage.visible=!e,this.disabledImage.visible=e}};var Gg={bgStrokeColor:"black",bgStrokeSize:.04,textFillColor:"white",scale:150},zg=Object.assign({},Gg,{padding:{left:.1,right:.1,top:.025,bottom:.025},fontSize:20,minHeight:.5,maxHeight:.5}),V2=Object.assign({},zg,{bgFillColor:mt(0,117,215)}),I2=Object.assign({},zg,{bgFillColor:mt(117,0,0)}),O2=Object.assign({},Gg,{bgFillColor:"white",textFillColor:"black",padding:{top:.1,left:.1,bottom:.4,right:.1},fontSize:25,minHeight:1,maxHeight:1}),W2=.9;function $p(n,e){return Object.assign({},n,{fontFamily:e})}var gl=class extends co{constructor(e,t){super("Confirm action"),this.env=e,this.object=ue("ConfirmationDialog"),this.root=ue("Root"),this.animator=new xl,this.a=0,this.b=0,this.confirmButton.innerText="Yes",this.cancelButton.innerText="No",this.mesh=new Bn(this.env,"confirmationDialogLabel","none",$p(O2,t)),this.confirmButton3D=new _s(this.env,"confirmationDialogConfirmButton","Yes",$p(V2,t)),this.confirmButton3D.addEventListener("click",()=>this.confirmButton.click()),this.confirmButton3D.object.position.set(1,-.5,.5),this.cancelButton3D=new _s(this.env,"confirmationDialogCancelButton","No",$p(I2,t)),this.cancelButton3D.addEventListener("click",()=>this.cancelButton.click()),this.cancelButton3D.object.position.set(2,-.5,.5),te(this.container,wm(`calc(${Xn(100)} - ${Io(2)})`),Oo("max-content")),te(this.contentArea,mm(cm(18)),Tm("center"),Am(Io(1))),N(this,N(this.root,this.mesh,this.confirmButton3D,this.cancelButton3D)),He(this.root,!1),this.root.scale.setScalar(0),this.onTick=o=>{let r=yx(this.a+this.b*o,W2);this.root.scale.set(r,r,.01)}}get name(){return this.object.name}get visible(){return It(this)}set visible(e){Ze(this,e,"inline-block"),this.mesh.visible=e}update(e){this.animator.update(e)}async showHide(e,t){this.a=e,this.b=t,await this.animator.start(0,.25,this.onTick),this.animator.clear()}get use3D(){return this.env.renderer.xr.isPresenting||this.env.testSpaceLayout}async onShowing(){await super.onShowing(),this.use3D&&(this.root.visible=!0,await this.showHide(0,1))}onShown(){this.use3D&&(this.element.style.display="none")}async onClosing(){this.use3D&&(await this.showHide(1,-1),this.root.visible=!1),await super.onClosing()}prompt(e,t){return this.title=e,Fa(this.contentArea,t),this.mesh.image.value=t,this.showDialog()}};var po=class extends lo{constructor(e,t,o,r){super(jn(),ue(`${t}-button`),"inline-block"),this.buttons=e,this.setName=t,this.activeName=o,this.inactiveName=r,this.enterButton=null,this.exitButton=null,this._isAvailable=!0,this._isEnabled=!0,this._isActive=!1,te(this,this.btnImage=kn()),this.load()}async load(){let[e,t]=await dn(this.buttons.getMeshButton(this.setName,this.activeName,.2),this.buttons.getMeshButton(this.setName,this.inactiveName,.2));N(this.object,this.enterButton=e,this.exitButton=t),this.enterButton.addEventListener("click",()=>this.element.click()),this.exitButton.addEventListener("click",()=>this.element.click()),this.refreshState()}get mesh(){return this.active?this.enterButton:this.exitButton}get available(){return this._isAvailable}set available(e){this._isAvailable=e,this.refreshState()}get active(){return this._isActive}set active(e){this._isActive=e,this.refreshState()}get enabled(){return this._isEnabled}set enabled(e){this._isEnabled=e,this.refreshState()}get visible(){return super.visible}set visible(e){super.visible=e,this.refreshState()}refreshState(){let e=this.active?this.inactiveName:this.activeName,t=`${e} ${this.setName}`;if(this.element.title=this.btnImage.title=t,this.btnImage.src=this.buttons.getImageSrc(this.setName,e),this.element.disabled=!this.available||!this.visible||!this.enabled,Ze(this,this.available&&this.visible,"inline-block"),this.enterButton&&this.exitButton){Za(this,this.available&&this.visible&&this.enabled);let o=He(this.object,this.available&&this.visible);He(this.enterButton,o&&!this.active),He(this.exitButton,o&&this.active)}}};var Yo=class extends po{constructor(e,t){let o=J[t];super(e,o.toLowerCase(),"enter","exit"),this.mode=t}};function Xg(n){return new Zp(n)}var Zp=class extends Ar{pop(e){return this.addSubProgress(e)}};var vs=class extends G{constructor(e,t){super(e),this.appName=t}},ed=class extends vs{constructor(e,t){super("apploading",e),this.appLoadParams=t}},td=class extends vs{constructor(e,t){super("apploaded",e),this.app=t}},nd=class extends vs{constructor(e,t){super("appshown",e),this.app=t}},od=class{constructor(e,t){this.loader=e,this.name=t,this.params=new Map}param(e,t){return this.params.set(e,t),this}load(e){return this.loader(this.name,this.params,e)}},wl=class extends oe{constructor(e,t){super(),this.env=e,this.getAppUrl=t,this.loadedModules=new Map,this.loadingApps=new Map,this.currentApps=new Map,this.cacheBustString=null}[Symbol.iterator](){return this.currentApps.values()}isLoaded(e){return this.currentApps.has(e)}get(e){return this.currentApps.get(e)}waitFor(e){if(this.isLoaded(e))return Promise.resolve(this.get(e));let t=new se;return this.addScopedEventListener(this,"apploaded",o=>{o.appName===e&&(this.removeScope(this),t.resolve(o.app))}),t}async loadAppConstructor(e,t){if(this.loadedModules.has(e))g(t)&&t.end();else{let r=this.getAppUrl(e);if(g(this.cacheBustString)){let s=new ti(r,location.href);s.query("v",this.cacheBustString),r=s.toString()}let i=this.env.fetcher.get(r).progress(t).useCache(!this.env.DEBUG).module().then(dt);this.loadedModules.set(e,i)}let{default:o}=await this.loadedModules.get(e);return o}app(e){return new od(this.loadApp.bind(this),e)}loadApp(e,t,o){let r=null;t instanceof Map?r=t:o=t,o=o||this.env.loadingBar;let i=new ed(e,r);if(this.dispatchEvent(i),!this.loadingApps.has(e)){let s=Xg(o),a=this.loadAppInstance(this.env,e,r,s.pop(10));this.loadingApps.set(e,a),o=s.pop(1)}return this.loadingApps.get(e)}async loadAppInstance(e,t,o,r){if(!this.currentApps.has(t)){let[i,s]=Hn(r,[1,10]),a=await this.loadAppConstructor(t,i),c=new a(e);c.addEventListener("quit",()=>this.unloadApp(t)),c.addEventListener("shown",()=>this.dispatchEvent(new nd(t,c))),g(o)&&await c.init(o),await c.load(s),this.currentApps.set(t,c),this.dispatchEvent(new td(t,c))}return g(r)&&r.end(),this.currentApps.get(t)}unloadApp(e){let t=this.currentApps.get(e);setTimeout(()=>t.clearEventListeners(),100),ae(t),this.currentApps.delete(e),this.loadingApps.delete(e)}};var Ss=new W;function Ts(n){return Ss.copy(n),Ss.y=0,Ss.normalize(),Qn(Math.atan2(Ss.x,Ss.z))}function jg(n){return Qn(Math.asin(n.y))}var Ne;(function(n){n[n.Primary=0]="Primary",n[n.Secondary=1]="Secondary",n[n.Menu=2]="Menu",n[n.Info=3]="Info"})(Ne||(Ne={}));function Ko(n,e){return n.xr.isPresenting?n.xr.getCamera():e}function qg(n,e,t,o){let r=n.elements;e.set(r[4],r[5],r[6]),t.set(-r[8],-r[9],-r[10]),o.set(r[12],r[13],r[14]),e.normalize(),t.normalize()}function H2(n){return n===DeviceOrientationEvent&&"requestPermission"in n&&Z(n.requestPermission)}var Pe;(function(n){n.None="none",n.MouseFPS="mousefirstperson",n.MouseDrag="mousedrag",n.ScreenEdge="mouseedge",n.Touch="touchswipe",n.Gamepad="gamepad"})(Pe||(Pe={}));var rd=class extends G{constructor(){super("avatarreset")}},Fl=class extends oe{set disableVertical(e){this._disableVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set invertVertical(e){this._invertVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set disableHorizontal(e){this._disableHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}set invertHorizontal(e){this._invertHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}get height(){return this.head.position.y}get object(){return this.head}get worldHeadingRadians(){return this._worldHeadingRadians}get worldPitchRadians(){return this._worldPitchRadians}get fov(){return this.env.camera.fov}set fov(e){e!==this.fov&&(this.env.camera.fov=e,this.env.camera.updateProjectionMatrix())}get stage(){return this.head.parent}constructor(e,t){super(),this.env=e,this.avatarResetEvt=new rd,this.controlMode=Pe.None,this.snapTurnRadians=Oe(30),this.sensitivities=new Map([[Pe.MouseDrag,100],[Pe.MouseFPS,-100],[Pe.Touch,50],[Pe.Gamepad,1]]),this.B=new W(0,0,1),this.F=new W,this.U=new W,this.P=new W,this.M=new ke,this.E=new Oa,this.Q1=new we,this.Q2=new we,this.Q3=new we(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this.Q4=new we,this.motion=new qe,this.rotStage=new ke,this.axisControl=new qe(0,0),this.deviceQ=new we().identity(),this.uv=new qe,this.duv=new qe,this.move=new W,this.move2=new W,this.radialAcceleration=new qe(1.5,1.5),this.radialSpeed=new qe(1,1),this.radialEdgeFactor=3/4,this.minFOVDegrees=15,this.maxFOVDegrees=120,this.minPitchRadians=Oe(-85),this.maxPitchRadians=Oe(85),this.followers=new Array,this.dz=0,this._headingRadians=0,this._pitchRadians=0,this._rollRadians=0,this.headX=0,this.headZ=0,this._worldHeadingRadians=0,this._worldPitchRadians=0,this.fwrd=!1,this.back=!1,this.left=!1,this.rght=!1,this.fwrd2=!1,this.back2=!1,this.left2=!1,this.rght2=!1,this.up=!1,this.down=!1,this.grow=!1,this.shrk=!1,this._keyboardControlEnabled=!1,this.worldPos=new W,this.worldQuat=new we,this.lockMovement=!1,this.fovZoomEnabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.onDeviceOrientationChangeEvent=null,this.onScreenOrientationChangeEvent=null,this.motionEnabled=!1,this.pointersToSend=new Array,this.disableHorizontal=!1,this.disableVertical=!1,this.invertHorizontal=!1,this.invertVertical=!0,this._height=this.env.defaultAvatarHeight,this.head=ue("Head",t);let o=!1,r=(i,s)=>{if(i==="w"&&(this.fwrd=s),i==="s"&&(this.back=s),i==="a"&&(this.left=s),i==="d"&&(this.rght=s),i==="e"&&(this.up=s),i==="q"&&(this.down=s),i==="ArrowUp"&&(this.fwrd2=s),i==="ArrowDown"&&(this.back2=s),i==="ArrowLeft"&&(this.left2=s),i==="ArrowRight"&&(this.rght2=s),i==="r"&&(this.grow=s),i==="f"&&(this.shrk=s),i==="Home"){let a=o;o=s,a&&!o&&(this.reset(),this.dispatchEvent(this.avatarResetEvt))}};this.onKeyDown=i=>r(i.key,Ir(i)),this.onKeyUp=i=>r(i.key,!1),this.keyboardControlEnabled=!0,matchMedia("(pointer: coarse)").matches?this.controlMode=Pe.Touch:matchMedia("(pointer: fine)").matches&&(this.controlMode=Pe.MouseDrag),globalThis.isSecureContext&&ss()&&!yn()&&(this.onDeviceOrientationChangeEvent=i=>{this.deviceOrientation=i},this.onScreenOrientationChangeEvent=()=>{"screen"in globalThis&&"orientation"in screen?this.screenOrientation=screen.orientation.angle:"window"in globalThis&&"orientation"in globalThis.window&&(this.screenOrientation=globalThis.window.orientation||0)},zx?pn(()=>this.startMotionControl()):this.startMotionControl())}snapTurn(e){this.setHeading(this.headingRadians-this.snapTurnRadians*e)}get keyboardControlEnabled(){return this._keyboardControlEnabled}set keyboardControlEnabled(e){this._keyboardControlEnabled!==e&&(this._keyboardControlEnabled=e,this._keyboardControlEnabled?(this.env.renderer.domElement.addEventListener("keydown",this.onKeyDown),this.env.renderer.domElement.addEventListener("keyup",this.onKeyUp)):(this.env.renderer.domElement.removeEventListener("keydown",this.onKeyDown),this.env.renderer.domElement.removeEventListener("keyup",this.onKeyUp)))}addFollower(e){this.followers.push(e)}onMove(e,t,o){this.setMode(e),e.canMoveView&&this.controlMode!==Pe.None&&this.gestureSatisfied(e)&&(this.uv.copy(t),this.duv.copy(o))}setMode(e){e.type==="remote"||e.type==="nose"||(e.type==="hand"?this.controlMode=Pe.None:e.type==="gamepad"?this.controlMode=Pe.Gamepad:e.rayTarget&&e.rayTarget.draggable&&!this.env.eventSys.mouse.isPointerLocked&&e.isPressed(Ne.Primary)?this.controlMode=Pe.ScreenEdge:e.type==="touch"||e.type==="pen"?this.controlMode=Pe.Touch:e.type==="mouse"?this.controlMode=this.env.eventSys.mouse.isPointerLocked?Pe.MouseFPS:Pe.MouseDrag:xe(e.type))}gestureSatisfied(e){return this.controlMode===Pe.None?!1:this.controlMode===Pe.Gamepad||this.controlMode===Pe.MouseFPS||this.controlMode===Pe.ScreenEdge||e.isPressed(Ne.Primary)}get name(){return this.object.name}set name(e){this.object.name=e}get headingRadians(){return this._headingRadians}setHeading(e){this._headingRadians=Qn(e)}get pitchRadians(){return this._pitchRadians}setPitch(e,t,o){this._pitchRadians=Qn(e+Te)-Te,this._pitchRadians=Jn(this._pitchRadians,t,o)}get rollRadians(){return this._rollRadians}setRoll(e){this._rollRadians=Qn(e)}setHeadingImmediate(e){this.setHeading(e),this.updateOrientation(),this.resetFollowers()}setOrientationImmediate(e,t){this.setHeading(e),this._pitchRadians=Qn(t),this.updateOrientation()}zoom(e){this.dz=e}update(e){e*=.001;let t=this.deviceOrientation;if(t&&At(t.alpha)&&At(t.beta)&&At(t.gamma)){let o=Oe(t.alpha)+this.alphaOffset,r=Oe(t.beta),i=Oe(t.gamma),s=this.screenOrientation?Oe(this.screenOrientation):0;this.E.set(r,o,-i,"YXZ"),this.Q2.setFromAxisAngle(this.B,-s),this.Q4.setFromEuler(this.E).multiply(this.Q3).multiply(this.Q2),this.deviceQ.slerp(this.Q4,.8)}if(!this.lockMovement){if(this.fovZoomEnabled&&Math.abs(this.dz)>0){let r=Math.pow(.95,5e3*e);this.dz=Of(r*this.dz),this.fov=Jn(this.env.camera.fov-this.dz,this.minFOVDegrees,this.maxFOVDegrees)}if(this.controlMode===Pe.ScreenEdge)this.uv.manhattanLength()>0&&(this.motion.set(this.scaleRadialComponent(-this.uv.x,this.radialSpeed.x,this.radialAcceleration.x),this.scaleRadialComponent(this.uv.y,this.radialSpeed.y,this.radialAcceleration.y)).multiplyScalar(e),this.setHeading(this.headingRadians+this.motion.x),this.setPitch(this.pitchRadians+this.motion.y,this.minPitchRadians,this.maxPitchRadians),this.setRoll(0));else if(this.sensitivities.has(this.controlMode)&&this.duv.manhattanLength()>0){let r=this.sensitivities.get(this.controlMode)||1;this.motion.copy(this.duv).multiplyScalar(r*e).multiply(this.axisControl),this.setHeading(this.headingRadians+this.motion.x),this.setPitch(this.pitchRadians+this.motion.y,this.minPitchRadians,this.maxPitchRadians),this.setRoll(0)}if(this.Q1.setFromAxisAngle(this.stage.up,this.worldHeadingRadians),this.fwrd||this.back||this.left||this.rght||this.up||this.down){let r=(this.left?1:0)+(this.rght?-1:0),i=(this.down?1:0)+(this.up?-1:0),s=(this.fwrd?1:0)+(this.back?-1:0);this.move.set(r,i,s);let a=this.move.length();a>0&&(this.move.multiplyScalar(e/a).applyQuaternion(this.Q1),this.stage.position.add(this.move))}if(this.fwrd2||this.back2||this.left2||this.rght2){let r=(this.left2?1:0)+(this.rght2?-1:0),i=(this.fwrd2?1:0)+(this.back2?-1:0);this.move2.set(r,0,i);let s=this.move2.length();s>0&&(this.move2.multiplyScalar(e/s).applyQuaternion(this.Q1),this.headX+=this.move2.x,this.headZ+=this.move2.z)}if(this.grow||this.shrk){let r=(this.shrk?-1:0)+(this.grow?1:0);this._height+=r*e,this._height=Jn(this._height,1,2)}this.updateOrientation();let o=Math.pow(.95,100*e);this.duv.multiplyScalar(o),this.duv.manhattanLength()<=1e-4&&this.duv.setScalar(0)}}scaleRadialComponent(e,t,o){let r=Math.abs(e);return Math.sign(e)*Math.pow(Math.max(0,r-this.radialEdgeFactor)/(1-this.radialEdgeFactor),o)*t}lookAt(e){e.getWorldPosition(this.P),this.P.sub(this.worldPos);let t=3*je-Math.atan2(this.P.z,this.P.x),o=Math.atan2(this.P.y,this.P.length());this.setOrientationImmediate(t,o)}updateOrientation(){let e=Ko(this.env.renderer,this.env.camera);this.rotStage.makeRotationY(this._headingRadians),this.stage.matrix.makeTranslation(this.stage.position.x,this.stage.position.y,this.stage.position.z).multiply(this.rotStage),this.stage.matrix.decompose(this.stage.position,this.stage.quaternion,this.stage.scale),this.env.renderer.xr.isPresenting?(this.M.copy(this.stage.matrixWorld).invert(),this.head.position.copy(e.position).applyMatrix4(this.M),this.head.quaternion.copy(this.stage.quaternion).invert().multiply(e.quaternion)):(this.head.position.set(this.headX,this._height,this.headZ),this.E.set(this._pitchRadians,0,this._rollRadians,"XYZ"),this.head.quaternion.setFromEuler(this.E).premultiply(this.deviceQ)),this.env.camera.position.copy(this.head.position),this.env.camera.quaternion.copy(this.head.quaternion),this.head.getWorldPosition(this.worldPos),this.head.getWorldQuaternion(this.worldQuat),this.F.set(0,0,-1).applyQuaternion(this.worldQuat),this._worldHeadingRadians=Ts(this.F),this._worldPitchRadians=jg(this.F),qg(this.head.matrixWorld,this.U,this.F,this.P)}reset(){this.stage.position.setScalar(0),this.setHeadingImmediate(0)}resetFollowers(){for(let e of this.followers)e.reset(this.height,this.worldPos,this.worldHeadingRadians)}async getPermission(){return"DeviceOrientationEvent"in window?H2(DeviceOrientationEvent)?await DeviceOrientationEvent.requestPermission():"granted":"not-supported"}async startMotionControl(){if(!this.motionEnabled){this.onScreenOrientationChangeEvent();let e=await this.getPermission();this.motionEnabled=e==="granted",this.motionEnabled&&("ScreenOrientation"in window?screen.orientation.addEventListener("change",this.onScreenOrientationChangeEvent):window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}}stopMotionControl(){this.motionEnabled&&("ScreenOrientation"in window?screen.orientation.removeEventListener("change",this.onScreenOrientationChangeEvent):window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.motionEnabled=!1)}dispose(){this.stopMotionControl()}get bufferSize(){return 133}writeState(e){de(this.pointersToSend);let t=this.env.avatar.bufferSize;for(let o of this.env.eventSys.pointers)o.canSend&&(t+=o.bufferSize,this.pointersToSend.push(o));e.length=t,e.position=0,e.writeFloat32(this.height),e.writeMatrix512(this.stage.matrix),e.writeMatrix512(this.head.matrixWorld),e.writeUint8(this.pointersToSend.length);for(let o of this.pointersToSend)o.writeState(e)}};function Qg(n){let e=n.attributes.position,t=n.attributes.normal,o=n.attributes.uv;for(let r=0;r<t.count;++r){let i=r*t.itemSize,s=r*t.itemSize+1,a=r*t.itemSize+2,c=t.array[i],p=t.array[s],m=t.array[a],x=Math.abs(c),w=Math.abs(p),_=Math.abs(m),T=e.array[i],y=e.array[s],b=e.array[a],I=Math.abs(T),V=Math.abs(y),P=Math.abs(b),C=r*o.itemSize,H=r*o.itemSize+1,B=o.array[C],R=o.array[H],q=0,Y=x,K=I;w>Y&&(q=1,Y=w,K=V),_>Y&&(q=2,Y=_,K=P),q===0?T<0?(B=-b,R=y):(B=b,R=y):q===1?y<0?(B=T,R=-b):(B=T,R=b):b<0?(B=T,R=y):(B=-T,R=y),B=(B/K+1)/8,R=(R/K+1)/6,q===0?T<0?(B+=0,R+=1/3):(B+=.5,R+=1/3):q===1?y<0?(B+=.25,R+=0):(B+=.25,R+=2/3):b<0?(B+=.25,R+=1/3):(B+=.75,R+=1/3);let ee=o.array;ee[C]=B,ee[H]=R}}var ks=new Pa(1,1,1,1,1,1);ks.name="CubeGeom";ks.computeBoundingBox();ks.computeBoundingSphere();var Jg=ks.clone();Jg.name="InvertedCubeGeom";Qg(Jg);var gn=class extends yt{constructor(e,t,o,r){super(ks,r),this.scale.set(e,t,o)}};function Yg(n,e,t,o,r){let i=new gn(e,t,o,r);return i.name=n,i}var Al=class{constructor(e,t=.15){this.opacity=1,this.direction=0,this.task=new se(!1),this.material=si({name:"FaderMaterial",color:0,side:Nf}),this.object=Yg(e,1,1,1,this.material),this.object.renderOrder=Number.MAX_SAFE_INTEGER,this.speed=1/t,this.object.layers.enableAll()}async start(e){this.direction=e,this.task.restart(),await this.task}async fadeOut(){this.direction!=1&&await this.start(1)}async fadeIn(){this.direction!=-1&&await this.start(-1)}update(e){if(this.direction!==0){let t=this.direction*this.speed*e/1e3;0<=this.opacity&&this.opacity<=1&&(this.opacity+=t),(this.direction===1&&this.opacity>=1||this.direction===-1&&this.opacity<=0)&&(this.opacity=Jn(this.opacity,0,1),this.direction=0,this.task.resolve())}this.material.opacity=this.opacity,this.material.transparent=this.opacity<1,this.material.needsUpdate=!0}};var _l=0;var li=3;function Kg(n,e){n=ft(n),n.traverse(t=>t.layers.set(e))}function $g(n,e){n=ft(n),n.traverse(t=>t.layers.enable(e))}function Nt(n,e,t,o,r,i){let s=new gn(o,r,i,Ag);return s.position.set(n,e,t),s}var N2=.1,vl=class extends Wn{constructor(){super(),this.value=0,this.targetValue=0,this.object=ue("LoadingBar"),this._enabled=!0,this.valueBar=new gn(0,1,1,Gp),this.valueBar.scale.set(0,1,1);let e=ue("ValueBarContainer");e.scale.set(1,.1,.1),N(this,N(e,this.valueBar),Nt(-.5,0,-.05,.01,.1,.01),Nt(-.5,0,.05,.01,.1,.01),Nt(.5,0,-.05,.01,.1,.01),Nt(.5,0,.05,.01,.1,.01),Nt(-.5,-.05,0,.01,.01,.1),Nt(.5,-.05,0,.01,.01,.1),Nt(-.5,.05,0,.01,.01,.1),Nt(.5,.05,0,.01,.01,.1),Nt(0,-.05,-.05,1,.01,.01),Nt(0,.05,-.05,1,.01,.01),Nt(0,-.05,.05,1,.01,.01),Nt(0,.05,.05,1,.01,.01)),Kg(this,li)}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,He(this,Br(this)||this.enabled))}report(e,t,o){super.report(e,t,o),this.targetValue=this.p}update(e){this.object.parent.visible&&(this.value=Math.min(this.targetValue,this.value+N2*e),this.valueBar.scale.set(this.value,1,1),this.valueBar.position.x=this.value/2-.5,He(this,this.enabled&&this.value>0))}};if(!id()){let n=Element.prototype,e=Document.prototype;"webkitRequestFullscreen"in n?(n.requestFullscreen=n.webkitRequestFullscreen,e.exitFullscreen=e.webkitRequestFullscreen,Object.defineProperties(e,{fullscreenEnabled:{get:function(){return this.webkitFullscreenEnabled}},fullscreenElement:{get:function(){return this.webkitFullscreenElement}}})):"mozRequestFullScreen"in n?(n.requestFullscreen=n.mozRequestFullScreen,e.exitFullscreen=e.mozCancelFullScreen,Object.defineProperties(e,{fullscreenEnabled:{get:function(){return this.mozFullScreenEnabled}},fullscreenElement:{get:function(){return this.mozFullScreenElement}}})):"msRequestFullscreen"in n&&(n.requestFullscreen=n.msRequestFullscreen,e.exitFullscreen=e.msExitFullscreen,Object.defineProperties(e,{fullscreenEnabled:{get:function(){return this.msFullscreenEnabled}},fullscreenElement:{get:function(){return this.msFullscreenElement}}}))}function id(){return"requestFullscreen"in HTMLElement.prototype}var U2=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},Sl=U2;var Ms=Symbol("@@webxr-polyfill/EventTarget"),Ln=class{constructor(){this[Ms]={listeners:new Map}}addEventListener(e,t){if(typeof e!="string")throw new Error("`type` must be a string");if(typeof t!="function")throw new Error("`listener` must be a function");let o=this[Ms].listeners.get(e)||[];o.push(t),this[Ms].listeners.set(e,o)}removeEventListener(e,t){if(typeof e!="string")throw new Error("`type` must be a string");if(typeof t!="function")throw new Error("`listener` must be a function");let o=this[Ms].listeners.get(e)||[];for(let r=o.length;r>=0;r--)o[r]===t&&o.pop()}dispatchEvent(e,t){let o=this[Ms].listeners.get(e)||[],r=[];for(let i=0;i<o.length;i++)r[i]=o[i];for(let i of r)i(t);typeof this[`on${e}`]=="function"&&this[`on${e}`](t)}};var Qe=typeof Float32Array<"u"?Float32Array:Array;var WV=Math.PI/180;function wn(){let n=new Qe(16);return Qe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function Zg(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function ho(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function $o(n,e){let t=e[0],o=e[1],r=e[2],i=e[3],s=e[4],a=e[5],c=e[6],p=e[7],m=e[8],x=e[9],w=e[10],_=e[11],T=e[12],y=e[13],b=e[14],I=e[15],V=t*a-o*s,P=t*c-r*s,C=t*p-i*s,H=o*c-r*a,B=o*p-i*a,R=r*p-i*c,q=m*y-x*T,Y=m*b-w*T,K=m*I-_*T,ee=x*b-w*y,me=x*I-_*y,Me=w*I-_*b,ce=V*Me-P*me+C*ee+H*K-B*Y+R*q;return ce?(ce=1/ce,n[0]=(a*Me-c*me+p*ee)*ce,n[1]=(r*me-o*Me-i*ee)*ce,n[2]=(y*R-b*B+I*H)*ce,n[3]=(w*B-x*R-_*H)*ce,n[4]=(c*K-s*Me-p*Y)*ce,n[5]=(t*Me-r*K+i*Y)*ce,n[6]=(b*C-T*R-I*P)*ce,n[7]=(m*R-w*C+_*P)*ce,n[8]=(s*me-a*K+p*q)*ce,n[9]=(o*K-t*me-i*q)*ce,n[10]=(T*B-y*C+I*V)*ce,n[11]=(x*C-m*B-_*V)*ce,n[12]=(a*Y-s*ee-c*q)*ce,n[13]=(t*ee-o*Y+r*q)*ce,n[14]=(y*P-T*H-b*V)*ce,n[15]=(m*H-x*P+w*V)*ce,n):null}function Rn(n,e,t){let o=e[0],r=e[1],i=e[2],s=e[3],a=e[4],c=e[5],p=e[6],m=e[7],x=e[8],w=e[9],_=e[10],T=e[11],y=e[12],b=e[13],I=e[14],V=e[15],P=t[0],C=t[1],H=t[2],B=t[3];return n[0]=P*o+C*a+H*x+B*y,n[1]=P*r+C*c+H*w+B*b,n[2]=P*i+C*p+H*_+B*I,n[3]=P*s+C*m+H*T+B*V,P=t[4],C=t[5],H=t[6],B=t[7],n[4]=P*o+C*a+H*x+B*y,n[5]=P*r+C*c+H*w+B*b,n[6]=P*i+C*p+H*_+B*I,n[7]=P*s+C*m+H*T+B*V,P=t[8],C=t[9],H=t[10],B=t[11],n[8]=P*o+C*a+H*x+B*y,n[9]=P*r+C*c+H*w+B*b,n[10]=P*i+C*p+H*_+B*I,n[11]=P*s+C*m+H*T+B*V,P=t[12],C=t[13],H=t[14],B=t[15],n[12]=P*o+C*a+H*x+B*y,n[13]=P*r+C*c+H*w+B*b,n[14]=P*i+C*p+H*_+B*I,n[15]=P*s+C*m+H*T+B*V,n}function mo(n,e,t){let o=e[0],r=e[1],i=e[2],s=e[3],a=o+o,c=r+r,p=i+i,m=o*a,x=o*c,w=o*p,_=r*c,T=r*p,y=i*p,b=s*a,I=s*c,V=s*p;return n[0]=1-(_+y),n[1]=x+V,n[2]=w-I,n[3]=0,n[4]=x-V,n[5]=1-(m+y),n[6]=T+b,n[7]=0,n[8]=w+I,n[9]=T-b,n[10]=1-(m+_),n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n}function Tl(n,e){return n[0]=e[12],n[1]=e[13],n[2]=e[14],n}function kl(n,e){let t=e[0]+e[5]+e[10],o=0;return t>0?(o=Math.sqrt(t+1)*2,n[3]=.25*o,n[0]=(e[6]-e[9])/o,n[1]=(e[8]-e[2])/o,n[2]=(e[1]-e[4])/o):e[0]>e[5]&&e[0]>e[10]?(o=Math.sqrt(1+e[0]-e[5]-e[10])*2,n[3]=(e[6]-e[9])/o,n[0]=.25*o,n[1]=(e[1]+e[4])/o,n[2]=(e[8]+e[2])/o):e[5]>e[10]?(o=Math.sqrt(1+e[5]-e[0]-e[10])*2,n[3]=(e[8]-e[2])/o,n[0]=(e[1]+e[4])/o,n[1]=.25*o,n[2]=(e[6]+e[9])/o):(o=Math.sqrt(1+e[10]-e[0]-e[5])*2,n[3]=(e[1]-e[4])/o,n[0]=(e[8]+e[2])/o,n[1]=(e[6]+e[9])/o,n[2]=.25*o),n}function Ml(n,e,t,o,r){let i=1/Math.tan(e/2),s;return n[0]=i/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,r!=null&&r!==1/0?(s=1/(o-r),n[10]=(r+o)*s,n[14]=2*r*o*s):(n[10]=-1,n[14]=-2*o),n}function Ct(){let n=new Qe(3);return Qe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function sd(n){var e=new Qe(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function G2(n){let e=n[0],t=n[1],o=n[2];return Math.sqrt(e*e+t*t+o*o)}function Tt(n,e,t){let o=new Qe(3);return o[0]=n,o[1]=e,o[2]=t,o}function ad(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function ui(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function cd(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function bl(n,e){let t=e[0],o=e[1],r=e[2],i=t*t+o*o+r*r;return i>0&&(i=1/Math.sqrt(i),n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i),n}function ys(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function El(n,e,t){let o=e[0],r=e[1],i=e[2],s=t[0],a=t[1],c=t[2];return n[0]=r*c-i*a,n[1]=i*s-o*c,n[2]=o*a-r*s,n}function er(n,e,t){let o=t[0],r=t[1],i=t[2],s=t[3],a=e[0],c=e[1],p=e[2],m=r*p-i*c,x=i*a-o*p,w=o*c-r*a,_=r*w-i*x,T=i*m-o*w,y=o*x-r*m,b=s*2;return m*=b,x*=b,w*=b,_*=2,T*=2,y*=2,n[0]=a+m+_,n[1]=c+x+T,n[2]=p+w+y,n}function tw(n,e){let t=Tt(n[0],n[1],n[2]),o=Tt(e[0],e[1],e[2]);bl(t,t),bl(o,o);let r=ys(t,o);return r>1?0:r<-1?Math.PI:Math.acos(r)}var nw=G2;var HV=function(){let n=Ct();return function(e,t,o,r,i,s){let a,c;for(t||(t=3),o||(o=0),r?c=Math.min(r*t+o,e.length):c=e.length,a=o;a<c;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],i(n,n,s),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2];return e}}();function ow(){let n=new Qe(9);return Qe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function X2(){let n=new Qe(4);return Qe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function rw(n){let e=new Qe(4);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function iw(n,e,t,o){let r=new Qe(4);return r[0]=n,r[1]=e,r[2]=t,r[3]=o,r}function sw(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function aw(n,e){let t=e[0],o=e[1],r=e[2],i=e[3],s=t*t+o*o+r*r+i*i;return s>0&&(s=1/Math.sqrt(s),n[0]=t*s,n[1]=o*s,n[2]=r*s,n[3]=i*s),n}var NV=function(){let n=X2();return function(e,t,o,r,i,s){let a,c;for(t||(t=4),o||(o=0),r?c=Math.min(r*t+o,e.length):c=e.length,a=o;a<c;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],n[3]=e[a+3],i(n,n,s),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2],e[a+3]=n[3];return e}}();function Bt(){let n=new Qe(4);return Qe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function q2(n,e,t){t=t*.5;let o=Math.sin(t);return n[0]=o*e[0],n[1]=o*e[1],n[2]=o*e[2],n[3]=Math.cos(t),n}function ld(n,e,t){let o=e[0],r=e[1],i=e[2],s=e[3],a=t[0],c=t[1],p=t[2],m=t[3];return n[0]=o*m+s*a+r*p-i*c,n[1]=r*m+s*c+i*a-o*p,n[2]=i*m+s*p+o*c-r*a,n[3]=s*m-o*a-r*c-i*p,n}function pi(n,e,t,o){let r=e[0],i=e[1],s=e[2],a=e[3],c=t[0],p=t[1],m=t[2],x=t[3],w,_,T,y,b;return _=r*c+i*p+s*m+a*x,_<0&&(_=-_,c=-c,p=-p,m=-m,x=-x),1-_>1e-6?(w=Math.acos(_),T=Math.sin(w),y=Math.sin((1-o)*w)/T,b=Math.sin(o*w)/T):(y=1-o,b=o),n[0]=y*r+b*c,n[1]=y*i+b*p,n[2]=y*s+b*m,n[3]=y*a+b*x,n}function ud(n,e){let t=e[0],o=e[1],r=e[2],i=e[3],s=t*t+o*o+r*r+i*i,a=s?1/s:0;return n[0]=-t*a,n[1]=-o*a,n[2]=-r*a,n[3]=i*a,n}function Q2(n,e){let t=e[0]+e[4]+e[8],o;if(t>0)o=Math.sqrt(t+1),n[3]=.5*o,o=.5/o,n[0]=(e[5]-e[7])*o,n[1]=(e[6]-e[2])*o,n[2]=(e[1]-e[3])*o;else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);let i=(r+1)%3,s=(r+2)%3;o=Math.sqrt(e[r*3+r]-e[i*3+i]-e[s*3+s]+1),n[r]=.5*o,o=.5/o,n[3]=(e[i*3+s]-e[s*3+i])*o,n[i]=(e[i*3+r]+e[r*3+i])*o,n[s]=(e[s*3+r]+e[r*3+s])*o}return n}function cw(n,e,t,o){let r=.5*Math.PI/180;e*=r,t*=r,o*=r;let i=Math.sin(e),s=Math.cos(e),a=Math.sin(t),c=Math.cos(t),p=Math.sin(o),m=Math.cos(o);return n[0]=i*c*m-s*a*p,n[1]=s*a*m+i*c*p,n[2]=s*c*p-i*a*m,n[3]=s*c*m+i*a*p,n}var pd=rw,lw=iw,Dl=sw;var Ds=aw;var KV=function(){let n=Ct(),e=Tt(1,0,0),t=Tt(0,1,0);return function(o,r,i){let s=ys(r,i);return s<-.999999?(El(n,e,r),nw(n)<1e-6&&El(n,t,r),bl(n,n),q2(o,n,Math.PI),o):s>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(El(n,r,i),o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=1+s,Ds(o,o))}}(),$V=function(){let n=Bt(),e=Bt();return function(t,o,r,i,s,a){return pi(n,o,s,a),pi(e,r,i,a),pi(t,n,e,2*a*(1-a)),t}}(),ZV=function(){let n=ow();return function(e,t,o,r){return n[0]=o[0],n[3]=o[1],n[6]=o[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],Ds(e,Q2(e,n))}}();var pe=Symbol("@@webxr-polyfill/XRRigidTransform"),tr=class n{constructor(){if(this[pe]={matrix:null,position:null,orientation:null,inverse:null},arguments.length===0)this[pe].matrix=ho(new Float32Array(16));else if(arguments.length===1)arguments[0]instanceof Float32Array?this[pe].matrix=arguments[0]:(this[pe].position=this._getPoint(arguments[0]),this[pe].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(arguments.length===2)this[pe].position=this._getPoint(arguments[0]),this[pe].orientation=this._getPoint(arguments[1]);else throw new Error("Too many arguments!");if(this[pe].matrix){let e=Ct();Tl(e,this[pe].matrix),this[pe].position=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2]});let t=Bt();kl(t,this[pe].matrix),this[pe].orientation=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2],w:t[3]})}else this[pe].matrix=ho(new Float32Array(16)),mo(this[pe].matrix,lw(this[pe].orientation.x,this[pe].orientation.y,this[pe].orientation.z,this[pe].orientation.w),Tt(this[pe].position.x,this[pe].position.y,this[pe].position.z))}_getPoint(e){return e instanceof DOMPointReadOnly?e:DOMPointReadOnly.fromPoint(e)}get matrix(){return this[pe].matrix}get position(){return this[pe].position}get orientation(){return this[pe].orientation}get inverse(){if(this[pe].inverse===null){let e=ho(new Float32Array(16));$o(e,this[pe].matrix),this[pe].inverse=new n(e),this[pe].inverse[pe].inverse=this}return this[pe].inverse}};var De=Symbol("@@webxr-polyfill/XRSpace");var Ut=class{constructor(e=null,t=null){this[De]={specialType:e,inputSource:t,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[De].specialType}get _inputSource(){return this[De].inputSource}_ensurePoseUpdated(e,t){t!=this[De].lastFrameId&&(this[De].lastFrameId=t,this._onPoseUpdate(e))}_onPoseUpdate(e){this[De].specialType=="viewer"&&(this._baseMatrix=e.getBasePoseMatrix())}set _baseMatrix(e){this[De].baseMatrix=e,this[De].inverseBaseMatrix=null}get _baseMatrix(){return this[De].baseMatrix||this[De].inverseBaseMatrix&&(this[De].baseMatrix=new Float32Array(16),$o(this[De].baseMatrix,this[De].inverseBaseMatrix)),this[De].baseMatrix}set _inverseBaseMatrix(e){this[De].inverseBaseMatrix=e,this[De].baseMatrix=null}get _inverseBaseMatrix(){return this[De].inverseBaseMatrix||this[De].baseMatrix&&(this[De].inverseBaseMatrix=new Float32Array(16),$o(this[De].inverseBaseMatrix,this[De].baseMatrix)),this[De].inverseBaseMatrix}_getSpaceRelativeTransform(e){if(!this._inverseBaseMatrix||!e._baseMatrix)return null;let t=new Float32Array(16);return Rn(t,this._inverseBaseMatrix,e._baseMatrix),new tr(t)}};var J2=1.6,fo=Symbol("@@webxr-polyfill/XRReferenceSpace"),Cs=["viewer","local","local-floor","bounded-floor","unbounded"];function Y2(n){return n==="bounded-floor"||n==="local-floor"}var xo=class n extends Ut{constructor(e,t=null){if(!Cs.includes(e))throw new Error(`XRReferenceSpaceType must be one of ${Cs}`);if(super(e),e==="bounded-floor"&&!t)throw new Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");Y2(e)&&!t&&(t=ho(new Float32Array(16)),t[13]=J2),this._inverseBaseMatrix=t||ho(new Float32Array(16)),this[fo]={type:e,transform:t,originOffset:ho(new Float32Array(16))}}_transformBasePoseMatrix(e,t){Rn(e,this._inverseBaseMatrix,t)}_originOffsetMatrix(){return this[fo].originOffset}_adjustForOriginOffset(e){let t=new Float32Array(16);$o(t,this[fo].originOffset),Rn(e,t,e)}_getSpaceRelativeTransform(e){let t=super._getSpaceRelativeTransform(e);return this._adjustForOriginOffset(t.matrix),new XRRigidTransform(t.matrix)}getOffsetReferenceSpace(e){let t=new n(this[fo].type,this[fo].transform,this[fo].bounds);return Rn(t[fo].originOffset,this[fo].originOffset,e.matrix),t}};var Ft=Symbol("@@webxr-polyfill/XR"),K2=["inline","immersive-vr","immersive-ar"],$2={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},Z2=`Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode
or navigator.xr.requestSession('inline') prior to requesting an immersive
session. This is a limitation specific to the WebXR Polyfill and does not apply
to native implementations of the API.`,Bs=class extends Ln{constructor(e){super(),this[Ft]={device:null,devicePromise:e,immersiveSession:null,inlineSessions:new Set},e.then(t=>{this[Ft].device=t})}async isSessionSupported(e){return this[Ft].device||await this[Ft].devicePromise,e!="inline"?Promise.resolve(this[Ft].device.isSessionSupported(e)):Promise.resolve(!0)}async requestSession(e,t){if(!this[Ft].device){if(e!="inline")throw new Error(Z2);await this[Ft].devicePromise}if(!K2.includes(e))throw new TypeError(`The provided value '${e}' is not a valid enum value of type XRSessionMode`);let o=$2[e],r=o.requiredFeatures.concat(t&&t.requiredFeatures?t.requiredFeatures:[]),i=o.optionalFeatures.concat(t&&t.optionalFeatures?t.optionalFeatures:[]),s=new Set,a=!1;for(let x of r)this[Ft].device.isFeatureSupported(x)?s.add(x):(console.error(`The required feature '${x}' is not supported`),a=!0);if(a)throw new DOMException("Session does not support some required features","NotSupportedError");for(let x of i)this[Ft].device.isFeatureSupported(x)?s.add(x):console.log(`The optional feature '${x}' is not supported`);let c=await this[Ft].device.requestSession(e,s),p=new XRSession(this[Ft].device,e,c);e=="inline"?this[Ft].inlineSessions.add(p):this[Ft].immersiveSession=p;let m=()=>{e=="inline"?this[Ft].inlineSessions.delete(p):this[Ft].immersiveSession=null,p.removeEventListener("end",m)};return p.addEventListener("end",m),p}};var hd;if("performance"in Sl)hd=()=>performance.now();else{let n=Date.now();hd=()=>Date.now()-n}var Cl=hd;var md=Symbol("@@webxr-polyfill/XRPose"),nr=class{constructor(e,t){this[md]={transform:e,emulatedPosition:t}}get transform(){return this[md].transform}get emulatedPosition(){return this[md].emulatedPosition}};var uw=Symbol("@@webxr-polyfill/XRViewerPose"),or=class extends nr{constructor(e,t,o=!1){super(e,o),this[uw]={views:t}}get views(){return this[uw].views}};var Ls=Symbol("@@webxr-polyfill/XRViewport"),rr=class{constructor(e){this[Ls]={target:e}}get x(){return this[Ls].target.x}get y(){return this[Ls].target.y}get width(){return this[Ls].target.width}get height(){return this[Ls].target.height}};var pw=["left","right","none"],go=Symbol("@@webxr-polyfill/XRView"),ir=class{constructor(e,t,o,r){if(!pw.includes(o))throw new Error(`XREye must be one of: ${pw}`);let i=Object.create(null),s=new rr(i);this[go]={device:e,eye:o,viewport:s,temp:i,sessionId:r,transform:t}}get eye(){return this[go].eye}get projectionMatrix(){return this[go].device.getProjectionMatrix(this.eye)}get transform(){return this[go].transform}_getViewport(e){if(this[go].device.getViewport(this[go].sessionId,this.eye,e,this[go].temp))return this[go].viewport}};var Ue=Symbol("@@webxr-polyfill/XRFrame"),dw="XRFrame access outside the callback that produced it is invalid.",e_="getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.",t_=0,wo=class{constructor(e,t,o){this[Ue]={id:++t_,active:!1,animationFrame:!1,device:e,session:t,sessionId:o}}get session(){return this[Ue].session}getViewerPose(e){if(!this[Ue].animationFrame)throw new DOMException(e_,"InvalidStateError");if(!this[Ue].active)throw new DOMException(dw,"InvalidStateError");let t=this[Ue].device,o=this[Ue].session;o[k].viewerSpace._ensurePoseUpdated(t,this[Ue].id),e._ensurePoseUpdated(t,this[Ue].id);let r=e._getSpaceRelativeTransform(o[k].viewerSpace),i=[];for(let a of o[k].viewSpaces){a._ensurePoseUpdated(t,this[Ue].id);let c=e._getSpaceRelativeTransform(a),p=new ir(t,c,a.eye,this[Ue].sessionId);i.push(p)}return new or(r,i,!1)}getPose(e,t){if(!this[Ue].active)throw new DOMException(dw,"InvalidStateError");let o=this[Ue].device;if(e._specialType==="target-ray"||e._specialType==="grip")return o.getInputPose(e._inputSource,t,e._specialType);{e._ensurePoseUpdated(o,this[Ue].id),t._ensurePoseUpdated(o,this[Ue].id);let r=t._getSpaceRelativeTransform(e);return r?new XRPose(r,!1):null}return null}};var Rs=Symbol("@@webxr-polyfill/XRRenderState"),n_=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null}),Fo=class{constructor(e={}){let t=Object.assign({},n_,e);this[Rs]={config:t}}get depthNear(){return this[Rs].config.depthNear}get depthFar(){return this[Rs].config.depthFar}get inlineVerticalFieldOfView(){return this[Rs].config.inlineVerticalFieldOfView}get baseLayer(){return this[Rs].config.baseLayer}};var Bl=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),Ps=Symbol("@@webxr-polyfill/xr-compatible");var sr=Symbol("@@webxr-polyfill/XRWebGLLayer"),o_=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),Vs=class{constructor(e,t,o={}){let r=Object.assign({},o_,o);if(!(e instanceof ar))throw new Error("session must be a XRSession");if(e.ended)throw new Error("InvalidStateError");if(t[Bl]&&t[Ps]!==!0)throw new Error("InvalidStateError");let i=t.getParameter(t.FRAMEBUFFER_BINDING);this[sr]={context:t,config:r,framebuffer:i,session:e}}get context(){return this[sr].context}get antialias(){return this[sr].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return this[sr].framebuffer}get framebufferWidth(){return this[sr].context.drawingBufferWidth}get framebufferHeight(){return this[sr].context.drawingBufferHeight}get _session(){return this[sr].session}getViewport(e){return e._getViewport(this)}static getNativeFramebufferScaleFactor(e){if(!e)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return e[k].ended?0:1}};var fd=Symbol("@@webxr-polyfill/XRInputSourceEvent"),cr=class n extends Event{constructor(e,t){super(e,t),this[fd]={frame:t.frame,inputSource:t.inputSource},Object.setPrototypeOf(this,n.prototype)}get frame(){return this[fd].frame}get inputSource(){return this[fd].inputSource}};var hw=Symbol("@@webxr-polyfill/XRSessionEvent"),Ao=class n extends Event{constructor(e,t){super(e,t),this[hw]={session:t.session},Object.setPrototypeOf(this,n.prototype)}get session(){return this[hw].session}};var Ll=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),lr=class n extends Event{constructor(e,t){super(e,t),this[Ll]={session:t.session,added:t.added,removed:t.removed},Object.setPrototypeOf(this,n.prototype)}get session(){return this[Ll].session}get added(){return this[Ll].added}get removed(){return this[Ll].removed}};var k=Symbol("@@webxr-polyfill/XRSession"),Is=class extends Ut{constructor(e){super(e)}get eye(){return this._specialType}_onPoseUpdate(e){this._inverseBaseMatrix=e.getBaseViewMatrix(this._specialType)}},ar=class extends Ln{constructor(e,t,o){super();let r=t!="inline",i=new Fo({inlineVerticalFieldOfView:r?null:Math.PI*.5});this[k]={device:e,mode:t,immersive:r,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:o,activeRenderState:i,pendingRenderState:null,viewerSpace:new xo("viewer"),viewSpaces:[],currentInputSources:[]},r?this[k].viewSpaces.push(new Is("left"),new Is("right")):this[k].viewSpaces.push(new Is("none")),this[k].onDeviceFrame=()=>{if(this[k].ended||this[k].suspended||(this[k].deviceFrameHandle=null,this[k].startDeviceFrameLoop(),this[k].pendingRenderState!==null&&(this[k].activeRenderState=new Fo(this[k].pendingRenderState),this[k].pendingRenderState=null,this[k].activeRenderState.baseLayer&&this[k].device.onBaseLayerSet(this[k].id,this[k].activeRenderState.baseLayer)),this[k].activeRenderState.baseLayer===null))return;let s=new wo(e,this,this[k].id),a=this[k].currentFrameCallbacks=this[k].frameCallbacks;this[k].frameCallbacks=[],s[Ue].active=!0,s[Ue].animationFrame=!0,this[k].device.onFrameStart(this[k].id,this[k].activeRenderState),this._checkInputSourcesChange();let c=Cl();for(let p=0;p<a.length;p++)try{!a[p].cancelled&&typeof a[p].callback=="function"&&a[p].callback(c,s)}catch(m){console.error(m)}this[k].currentFrameCallbacks=null,s[Ue].active=!1,this[k].device.onFrameEnd(this[k].id)},this[k].startDeviceFrameLoop=()=>{this[k].deviceFrameHandle===null&&(this[k].deviceFrameHandle=this[k].device.requestAnimationFrame(this[k].onDeviceFrame))},this[k].stopDeviceFrameLoop=()=>{let s=this[k].deviceFrameHandle;s!==null&&(this[k].device.cancelAnimationFrame(s),this[k].deviceFrameHandle=null)},this[k].onPresentationEnd=s=>{if(s!==this[k].id){this[k].suspended=!1,this[k].startDeviceFrameLoop(),this.dispatchEvent("focus",{session:this});return}this[k].ended=!0,this[k].stopDeviceFrameLoop(),e.removeEventListener("@@webxr-polyfill/vr-present-end",this[k].onPresentationEnd),e.removeEventListener("@@webxr-polyfill/vr-present-start",this[k].onPresentationStart),e.removeEventListener("@@webxr-polyfill/input-select-start",this[k].onSelectStart),e.removeEventListener("@@webxr-polyfill/input-select-end",this[k].onSelectEnd),this.dispatchEvent("end",new Ao("end",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-end",this[k].onPresentationEnd),this[k].onPresentationStart=s=>{s!==this[k].id&&(this[k].suspended=!0,this[k].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-start",this[k].onPresentationStart),this[k].onSelectStart=s=>{s.sessionId===this[k].id&&this[k].dispatchInputSourceEvent("selectstart",s.inputSource)},e.addEventListener("@@webxr-polyfill/input-select-start",this[k].onSelectStart),this[k].onSelectEnd=s=>{s.sessionId===this[k].id&&(this[k].dispatchInputSourceEvent("selectend",s.inputSource),this[k].dispatchInputSourceEvent("select",s.inputSource))},e.addEventListener("@@webxr-polyfill/input-select-end",this[k].onSelectEnd),this[k].onSqueezeStart=s=>{s.sessionId===this[k].id&&this[k].dispatchInputSourceEvent("squeezestart",s.inputSource)},e.addEventListener("@@webxr-polyfill/input-squeeze-start",this[k].onSqueezeStart),this[k].onSqueezeEnd=s=>{s.sessionId===this[k].id&&(this[k].dispatchInputSourceEvent("squeezeend",s.inputSource),this[k].dispatchInputSourceEvent("squeeze",s.inputSource))},e.addEventListener("@@webxr-polyfill/input-squeeze-end",this[k].onSqueezeEnd),this[k].dispatchInputSourceEvent=(s,a)=>{let c=new wo(e,this,this[k].id),p=new cr(s,{frame:c,inputSource:a});c[Ue].active=!0,this.dispatchEvent(s,p),c[Ue].active=!1},this[k].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[k].activeRenderState}get environmentBlendMode(){return this[k].device.environmentBlendMode||"opaque"}async requestReferenceSpace(e){if(this[k].ended)return;if(!Cs.includes(e))throw new TypeError(`XRReferenceSpaceType must be one of ${Cs}`);if(!this[k].device.doesSessionSupportReferenceSpace(this[k].id,e))throw new DOMException(`The ${e} reference space is not supported by this session.`,"NotSupportedError");if(e==="viewer")return this[k].viewerSpace;let t=await this[k].device.requestFrameOfReferenceTransform(e);if(e==="bounded-floor")throw t?this[k].device.requestStageBounds()?new DOMException(`The WebXR polyfill does not support the ${e} reference space yet.`,"NotSupportedError"):new DOMException(`${e} XRReferenceSpace not supported by this device.`,"NotSupportedError"):new DOMException(`${e} XRReferenceSpace not supported by this device.`,"NotSupportedError");return new xo(e,t)}requestAnimationFrame(e){if(this[k].ended)return;let t=++this[k].frameHandle;return this[k].frameCallbacks.push({handle:t,callback:e,cancelled:!1}),t}cancelAnimationFrame(e){let t=this[k].frameCallbacks,o=t.findIndex(r=>r&&r.handle===e);o>-1&&(t[o].cancelled=!0,t.splice(o,1)),t=this[k].currentFrameCallbacks,t&&(o=t.findIndex(r=>r&&r.handle===e),o>-1&&(t[o].cancelled=!0))}get inputSources(){return this[k].device.getInputSources()}async end(){if(!this[k].ended)return this[k].immersive&&(this[k].ended=!0,this[k].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[k].onPresentationStart),this[k].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[k].onPresentationEnd),this[k].device.removeEventListener("@@webxr-polyfill/input-select-start",this[k].onSelectStart),this[k].device.removeEventListener("@@webxr-polyfill/input-select-end",this[k].onSelectEnd),this.dispatchEvent("end",new Ao("end",{session:this}))),this[k].stopDeviceFrameLoop(),this[k].device.endSession(this[k].id)}updateRenderState(e){if(this[k].ended){let o="Can't call updateRenderState on an XRSession that has already ended.";throw new Error(o)}if(e.baseLayer&&e.baseLayer._session!==this){let o="Called updateRenderState with a base layer that was created by a different session.";throw new Error(o)}if(e.inlineVerticalFieldOfView!==null&&e.inlineVerticalFieldOfView!==void 0)if(this[k].immersive){let o="inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.";throw new Error(o)}else e.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,e.inlineVerticalFieldOfView));if(this[k].pendingRenderState===null){let o=this[k].activeRenderState;this[k].pendingRenderState={depthNear:o.depthNear,depthFar:o.depthFar,inlineVerticalFieldOfView:o.inlineVerticalFieldOfView,baseLayer:o.baseLayer}}Object.assign(this[k].pendingRenderState,e)}_checkInputSourcesChange(){let e=[],t=[],o=this.inputSources,r=this[k].currentInputSources;for(let i of o)r.includes(i)||e.push(i);for(let i of r)o.includes(i)||t.push(i);(e.length>0||t.length>0)&&this.dispatchEvent("inputsourceschange",new lr("inputsourceschange",{session:this,added:e,removed:t})),this[k].currentInputSources.length=0;for(let i of o)this[k].currentInputSources.push(i)}};var _o=Symbol("@@webxr-polyfill/XRInputSource"),ur=class{constructor(e){this[_o]={impl:e,gripSpace:new Ut("grip",this),targetRaySpace:new Ut("target-ray",this)}}get handedness(){return this[_o].impl.handedness}get targetRayMode(){return this[_o].impl.targetRayMode}get gripSpace(){let e=this[_o].impl.targetRayMode;return e==="gaze"||e==="screen"?null:this[_o].gripSpace}get targetRaySpace(){return this[_o].targetRaySpace}get profiles(){return this[_o].impl.profiles}get gamepad(){return this[_o].impl.gamepad}};var xd=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),Os=class n extends Event{constructor(e,t){super(e,t),this[xd]={referenceSpace:t.referenceSpace,transform:t.transform||null},Object.setPrototypeOf(this,n.prototype)}get referenceSpace(){return this[xd].referenceSpace}get transform(){return this[xd].transform}};var Rl={XRSystem:Bs,XRSession:ar,XRSessionEvent:Ao,XRFrame:wo,XRView:ir,XRViewport:rr,XRViewerPose:or,XRWebGLLayer:Vs,XRSpace:Ut,XRReferenceSpace:xo,XRReferenceSpaceEvent:Os,XRInputSource:ur,XRInputSourceEvent:cr,XRInputSourcesChangeEvent:lr,XRRenderState:Fo,XRRigidTransform:tr,XRPose:nr};var gd=n=>typeof n.prototype.makeXRCompatible=="function"?!1:(n.prototype.makeXRCompatible=function(){return this[Ps]=!0,Promise.resolve()},!0),wd=n=>{let e=n.prototype.getContext;n.prototype.getContext=function(t,o){let r=e.call(this,t,o);return r&&(r[Bl]=!0,o&&"xrCompatible"in o&&(r[Ps]=o.xrCompatible)),r}};var mw=n=>!!(n.ImageBitmapRenderingContext&&n.createImageBitmap),fw=n=>{var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(n.navigator.userAgent||n.navigator.vendor||n.opera),e},xw=n=>{n.style.display="block",n.style.position="absolute",n.style.width=n.style.height="1px",n.style.top=n.style.left="0px"};var bw=sF(gw());var pr=class extends Ln{constructor(e){super(),this.global=e,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(e,t){throw new Error("Not implemented")}isSessionSupported(e){throw new Error("Not implemented")}isFeatureSupported(e){throw new Error("Not implemented")}async requestSession(e,t){throw new Error("Not implemented")}requestAnimationFrame(e){throw new Error("Not implemented")}onFrameStart(e){throw new Error("Not implemented")}onFrameEnd(e){throw new Error("Not implemented")}doesSessionSupportReferenceSpace(e,t){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(e,t){}cancelAnimationFrame(e){throw new Error("Not implemented")}endSession(e){throw new Error("Not implemented")}getViewport(e,t,o,r){throw new Error("Not implemented")}getProjectionMatrix(e){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(e){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(e,t,o){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}};var r_={mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},i_={mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},s_={mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},ww={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},a_={mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[Math.PI*-.08,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},c_={mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},l_={mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},_d={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},u_={"Daydream Controller":r_,"Gear VR Controller":c_,"HTC Vive Focus Controller":i_,"Oculus Go Controller":s_,"Oculus Touch (Right)":ww,"Oculus Touch (Left)":ww,"OpenVR Gamepad":a_,"Spatial Controller (Spatial Interaction Source) 045E-065A":_d,"Spatial Controller (Spatial Interaction Source) 045E-065D":l_,"Windows Mixed Reality (Right)":_d,"Windows Mixed Reality (Left)":_d},Fw=u_;var Aw=Tt(.155,-.465,-.15),p_=Tt(-.155,-.465,-.15),d_=Tt(0,0,-.25),h_=Tt(0,0,.05),_w=Tt(-.08,.14,.08),vw=.4,m_=.4,f_=.61,x_=.175,g_=.12,w_=.87,Sw=180/Math.PI;function F_(n,e,t){function o(c,p,m){return c<p?p:c>m?m:c}var r=e[0]*e[0],i=e[1]*e[1],s=e[2]*e[2],a=e[3]*e[3];if(t==="XYZ")n[0]=Math.atan2(2*(e[0]*e[3]-e[1]*e[2]),a-r-i+s),n[1]=Math.asin(o(2*(e[0]*e[2]+e[1]*e[3]),-1,1)),n[2]=Math.atan2(2*(e[2]*e[3]-e[0]*e[1]),a+r-i-s);else if(t==="YXZ")n[0]=Math.asin(o(2*(e[0]*e[3]-e[1]*e[2]),-1,1)),n[1]=Math.atan2(2*(e[0]*e[2]+e[1]*e[3]),a-r-i+s),n[2]=Math.atan2(2*(e[0]*e[1]+e[2]*e[3]),a-r+i-s);else if(t==="ZXY")n[0]=Math.asin(o(2*(e[0]*e[3]+e[1]*e[2]),-1,1)),n[1]=Math.atan2(2*(e[1]*e[3]-e[2]*e[0]),a-r-i+s),n[2]=Math.atan2(2*(e[2]*e[3]-e[0]*e[1]),a-r+i-s);else if(t==="ZYX")n[0]=Math.atan2(2*(e[0]*e[3]+e[2]*e[1]),a-r-i+s),n[1]=Math.asin(o(2*(e[1]*e[3]-e[0]*e[2]),-1,1)),n[2]=Math.atan2(2*(e[0]*e[1]+e[2]*e[3]),a+r-i-s);else if(t==="YZX")n[0]=Math.atan2(2*(e[0]*e[3]-e[2]*e[1]),a-r+i-s),n[1]=Math.atan2(2*(e[1]*e[3]-e[0]*e[2]),a+r-i-s),n[2]=Math.asin(o(2*(e[0]*e[1]+e[2]*e[3]),-1,1));else if(t==="XZY")n[0]=Math.atan2(2*(e[0]*e[3]+e[1]*e[2]),a-r+i-s),n[1]=Math.atan2(2*(e[0]*e[2]+e[1]*e[3]),a+r-i-s),n[2]=Math.asin(o(2*(e[2]*e[3]-e[0]*e[1]),-1,1));else{console.log("No order given for quaternion to euler conversion.");return}}var Ws=class{constructor(){this.hand="right",this.headElbowOffset=Aw,this.controllerQ=Bt(),this.lastControllerQ=Bt(),this.headQ=Bt(),this.headPos=Ct(),this.elbowPos=Ct(),this.wristPos=Ct(),this.time=null,this.lastTime=null,this.rootQ=Bt(),this.position=Ct()}setHandedness(e){this.hand!=e&&(this.hand=e,this.hand=="left"?this.headElbowOffset=p_:this.headElbowOffset=Aw)}update(e,t){this.time=Cl(),e&&(Dl(this.lastControllerQ,this.controllerQ),Dl(this.controllerQ,e)),t&&(Tl(this.headPos,t),kl(this.headQ,t));let o=this.getHeadYawOrientation_(),r=this.quatAngle_(this.lastControllerQ,this.controllerQ),i=(this.time-this.lastTime)/1e3;r/i>f_?pi(this.rootQ,this.rootQ,o,Math.min(r/x_,1)):Dl(this.rootQ,o);let a=Tt(0,0,-1);er(a,a,this.controllerQ);let c=ys(a,[0,1,0]),p=this.clamp_((c-g_)/w_,0,1),m=pd(this.rootQ);ud(m,m),ld(m,m,this.controllerQ);let x=this.elbowPos;ad(x,this.headPos),ui(x,x,this.headElbowOffset);let w=sd(_w);cd(w,w,p),ui(x,x,w);let T=this.quatAngle_(m,Bt())*Sw,y=1-Math.pow(T/180,4);sssss;let b=vw,I=1-vw,V=y*(b+I*p*m_),P=Bt();pi(P,P,m,V);let C=ud(Bt(),P),H=pd(m);ld(H,H,C);let B=this.wristPos;ad(B,h_),er(B,B,P),ui(B,B,d_),er(B,B,H),ui(B,B,x);let R=sd(_w);cd(R,R,p),ui(this.position,this.wristPos,R),er(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let e=Ct();return F_(e,this.headQ,"YXZ"),cw(Bt(),0,e[1]*Sw,0)}clamp_(e,t,o){return Math.min(Math.max(e,t),o)}quatAngle_(e,t){let o=[0,0,-1],r=[0,0,-1];return er(o,o,e),er(r,r,t),tw(o,r)}};var lt=Symbol("@@webxr-polyfill/XRRemappedGamepad"),Tw={pressed:!1,touched:!1,value:0};Object.freeze(Tw);var vd=class{constructor(e,t,o){if(o||(o={}),o.userAgentOverrides){for(let p in o.userAgentOverrides)if(navigator.userAgent.includes(p)){let m=o.userAgentOverrides[p];for(let x in m)x in o?Object.assign(o[x],m[x]):o[x]=m[x];break}}let r=new Array(o.axes&&o.axes.length?o.axes.length:e.axes.length),i=new Array(o.buttons&&o.buttons.length?o.buttons.length:e.buttons.length),s=null;if(o.gripTransform){let p=o.gripTransform.orientation||[0,0,0,1];s=wn(),mo(s,Ds(p,p),o.gripTransform.position||[0,0,0])}let a=null;if(o.targetRayTransform){let p=o.targetRayTransform.orientation||[0,0,0,1];a=wn(),mo(a,Ds(p,p),o.targetRayTransform.position||[0,0,0])}let c=o.profiles;o.displayProfiles&&t.displayName in o.displayProfiles&&(c=o.displayProfiles[t.displayName]),this[lt]={gamepad:e,map:o,profiles:c||[e.id],mapping:o.mapping||e.mapping,axes:r,buttons:i,gripTransform:s,targetRayTransform:a},this._update()}_update(){let e=this[lt].gamepad,t=this[lt].map,o=this[lt].axes;for(let i=0;i<o.length;++i)t.axes&&i in t.axes?t.axes[i]===null?o[i]=0:o[i]=e.axes[t.axes[i]]:o[i]=e.axes[i];if(t.axes&&t.axes.invert)for(let i of t.axes.invert)i<o.length&&(o[i]*=-1);let r=this[lt].buttons;for(let i=0;i<r.length;++i)t.buttons&&i in t.buttons?t.buttons[i]===null?r[i]=Tw:r[i]=e.buttons[t.buttons[i]]:r[i]=e.buttons[i]}get id(){return""}get _profiles(){return this[lt].profiles}get index(){return-1}get connected(){return this[lt].gamepad.connected}get timestamp(){return this[lt].gamepad.timestamp}get mapping(){return this[lt].mapping}get axes(){return this[lt].axes}get buttons(){return this[lt].buttons}get hapticActuators(){return this[lt].gamepad.hapticActuators}},Hs=class{constructor(e,t,o=0,r=-1){this.polyfill=e,this.display=t,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new ur(this),this.lastPosition=Ct(),this.emulatedPosition=!1,this.basePoseMatrix=wn(),this.outputMatrix=wn(),this.primaryButtonIndex=o,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=r,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(e){this.nativeGamepad!==e&&(this.nativeGamepad=e,e?this.gamepad=new vd(e,this.display,Fw[e.id]):this.gamepad=null),this.handedness=e.hand===""?"none":e.hand,this.gamepad&&this.gamepad._update(),e.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!e.pose.hasPosition):e.hand===""&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let e=this.nativeGamepad.pose,t=e.position,o=e.orientation;if(!t&&!o)return;t?(this.lastPosition[0]=t[0],this.lastPosition[1]=t[1],this.lastPosition[2]=t[2]):e.hasPosition?t=this.lastPosition:(this.armModel||(this.armModel=new Ws),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(o,this.polyfill.getBasePoseMatrix()),t=this.armModel.getPosition()),mo(this.basePoseMatrix,o,t)}else Zg(this.basePoseMatrix,this.polyfill.getBasePoseMatrix());return this.basePoseMatrix}getXRPose(e,t){switch(this.updateBasePoseMatrix(),t){case"target-ray":e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[lt].targetRayTransform&&Rn(this.outputMatrix,this.outputMatrix,this.gamepad[lt].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[lt].gripTransform&&Rn(this.outputMatrix,this.outputMatrix,this.gamepad[lt].gripTransform);break;default:return null}return e._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}};var b8=Symbol("@@webxr-polyfill/WebVRDevice"),Ns=!1,kw={highRefreshRate:!0},Mw={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},A_=0,Sd=class{constructor(e,t,o={}){if(this.mode=e,this.enabledFeatures=t,this.outputContext=null,this.immersive=e=="immersive-vr"||e=="immersive-ar",this.ended=null,this.baseLayer=null,this.id=++A_,this.modifiedCanvasLayer=!1,this.outputContext&&!Ns){let r=o.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(r)}}},dr=class extends pr{constructor(e,t){let{canPresent:o}=t.capabilities;super(e),this.display=t,this.frame=new e.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=o,this.baseModelMatrix=wn(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),e.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=e.navigator&&"getGamepads"in e.navigator,this.HAS_BITMAP_SUPPORT=mw(e)}get depthNear(){return this.display.depthNear}set depthNear(e){this.display.depthNear=e}get depthFar(){return this.display.depthFar}set depthFar(e){this.display.depthFar=e}onBaseLayerSet(e,t){let o=this.sessions.get(e),r=t.context.canvas;if(o.immersive){let i=this.display.getEyeParameters("left"),s=this.display.getEyeParameters("right");r.width=Math.max(i.renderWidth,s.renderWidth)*2,r.height=Math.max(i.renderHeight,s.renderHeight),this.display.requestPresent([{source:r,attributes:kw}]).then(()=>{!Ns&&!this.global.document.body.contains(r)&&(o.modifiedCanvasLayer=!0,this.global.document.body.appendChild(r),xw(r)),o.baseLayer=t})}else o.baseLayer=t}isSessionSupported(e){return!(e=="immersive-ar"||e=="immersive-vr"&&this.canPresent===!1)}isFeatureSupported(e){switch(e){case"viewer":return!0;case"local":return!0;case"local-floor":return!0;case"bounded":return!1;case"unbounded":return!1;default:return!1}}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();let o=e=="immersive-vr";if(o){let i=this.global.document.createElement("canvas");if(!Ns){let s=i.getContext("webgl")}await this.display.requestPresent([{source:i,attributes:kw}])}let r=new Sd(e,t,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(r.id,r),o&&(this.immersiveSession=r,this.dispatchEvent("@@webxr-polyfill/vr-present-start",r.id)),Promise.resolve(r.id)}requestAnimationFrame(e){return this.display.requestAnimationFrame(e)}getPrimaryButtonIndex(e){let t=0,o=e.id.toLowerCase();for(let r in Mw)if(o.includes(r)){t=Mw[r];break}return Math.min(t,e.buttons.length-1)}onFrameStart(e,t){this.display.depthNear=t.depthNear,this.display.depthFar=t.depthFar,this.display.getFrameData(this.frame);let o=this.sessions.get(e);if(o.immersive&&this.CAN_USE_GAMEPAD){let r=this.gamepadInputSources;this.gamepadInputSources={};let i=this.global.navigator.getGamepads();for(let s=0;s<i.length;++s){let a=i[s];if(a&&a.displayId>0){let c=r[s];if(c||(c=new Hs(this,this.display,this.getPrimaryButtonIndex(a))),c.updateFromGamepad(a),this.gamepadInputSources[s]=c,c.primaryButtonIndex!=-1){let p=a.buttons[c.primaryButtonIndex].pressed;p&&!c.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:o.id,inputSource:c.inputSource}):!p&&c.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:o.id,inputSource:c.inputSource}),c.primaryActionPressed=p}if(c.primarySqueezeButtonIndex!=-1){let p=a.buttons[c.primarySqueezeButtonIndex].pressed;p&&!c.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:o.id,inputSource:c.inputSource}):!p&&c.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:o.id,inputSource:c.inputSource}),c.primarySqueezeActionPressed=p}}}}if(!Ns&&!o.immersive&&o.baseLayer){let r=o.baseLayer.context.canvas;Ml(this.frame.leftProjectionMatrix,t.inlineVerticalFieldOfView,r.width/r.height,t.depthNear,t.depthFar)}}onFrameEnd(e){let t=this.sessions.get(e);if(!(t.ended||!t.baseLayer)){if(t.outputContext&&!(t.immersive&&!this.display.capabilities.hasExternalDisplay)){let o=t.immersive&&this.display.capabilities.hasExternalDisplay,r=t.baseLayer.context.canvas,i=o?r.width/2:r.width,s=r.height;if(!Ns){let a=t.outputContext.canvas,c=a.width,p=a.height,m=t.renderContext;this.HAS_BITMAP_SUPPORT?r.transferToImageBitmap?m.transferFromImageBitmap(r.transferToImageBitmap()):this.global.createImageBitmap(r,0,0,i,s,{resizeWidth:c,resizeHeight:p}).then(x=>m.transferFromImageBitmap(x)):m.drawImage(r,0,0,i,s,0,0,c,p)}}t.immersive&&t.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(e){this.display.cancelAnimationFrame(e)}async endSession(e){let t=this.sessions.get(e);if(!t.ended){if(t.immersive)return this.display.exitPresent();t.ended=!0}}doesSessionSupportReferenceSpace(e,t){let o=this.sessions.get(e);return o.ended?!1:o.enabledFeatures.has(t)}requestStageBounds(){if(this.display.stageParameters){let e=this.display.stageParameters.sizeX,t=this.display.stageParameters.sizeZ,o=[];return o.push(-e/2),o.push(-t/2),o.push(e/2),o.push(-t/2),o.push(e/2),o.push(t/2),o.push(-e/2),o.push(t/2),o}return null}async requestFrameOfReferenceTransform(e,t){return(e==="local-floor"||e==="bounded-floor")&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(e){if(e==="left")return this.frame.leftProjectionMatrix;if(e==="right")return this.frame.rightProjectionMatrix;if(e==="none")return this.frame.leftProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(e,t,o,r){let i=this.sessions.get(e),{width:s,height:a}=o.context.canvas;if(!i.immersive)return r.x=r.y=0,r.width=s,r.height=a,!0;if(t==="left"||t==="none")r.x=0;else if(t==="right")r.x=s/2;else return!1;return r.y=0,r.width=s/2,r.height=a,!0}getBasePoseMatrix(){let{position:e,orientation:t}=this.frame.pose;return!e&&!t?this.baseModelMatrix:(e||(e=this.tempVec3,e[0]=e[1]=e[2]=0),mo(this.baseModelMatrix,t,e),this.baseModelMatrix)}getBaseViewMatrix(e){if(e==="left"||e==="none")return this.frame.leftViewMatrix;if(e==="right")return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let e=[];for(let t in this.gamepadInputSources)e.push(this.gamepadInputSources[t].inputSource);return e}getInputPose(e,t,o){if(!t)return null;for(let r in this.gamepadInputSources){let i=this.gamepadInputSources[r];if(i.inputSource===e)return i.getXRPose(t,o)}return null}onWindowResize(){}onVRDisplayPresentChange(e){this.display.isPresenting||this.sessions.forEach(t=>{if(t.immersive&&!t.ended){if(t.modifiedCanvasLayer){let o=t.baseLayer.context.canvas;document.body.removeChild(o),o.setAttribute("style","")}this.immersiveSession===t&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",t.id)}})}};var Us=class extends dr{constructor(e,t){let o=new bw.default(t||{});super(e,o),this.display=o,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}};var __=!1,v_=0,Td=class{constructor(e,t){this.mode=e,this.enabledFeatures=t,this.ended=null,this.baseLayer=null,this.id=++v_}},Gs=class extends pr{constructor(e){super(e),this.sessions=new Map,this.projectionMatrix=wn(),this.identityMatrix=wn()}onBaseLayerSet(e,t){let o=this.sessions.get(e);o.baseLayer=t}isSessionSupported(e){return e=="inline"}isFeatureSupported(e){switch(e){case"viewer":return!0;default:return!1}}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();let o=new Td(e,t);return this.sessions.set(o.id,o),Promise.resolve(o.id)}requestAnimationFrame(e){return window.requestAnimationFrame(e)}cancelAnimationFrame(e){window.cancelAnimationFrame(e)}onFrameStart(e,t){if(__)return;let o=this.sessions.get(e);if(o.baseLayer){let r=o.baseLayer.context.canvas;Ml(this.projectionMatrix,t.inlineVerticalFieldOfView,r.width/r.height,t.depthNear,t.depthFar)}}onFrameEnd(e){}async endSession(e){let t=this.sessions.get(e);t.ended=!0}doesSessionSupportReferenceSpace(e,t){let o=this.sessions.get(e);return o.ended?!1:o.enabledFeatures.has(t)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(e,t){return null}getProjectionMatrix(e){return this.projectionMatrix}getViewport(e,t,o,r){let i=this.sessions.get(e),{width:s,height:a}=o.context.canvas;return r.x=r.y=0,r.width=s,r.height=a,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(e){return this.identityMatrix}getInputSources(){return[]}getInputPose(e,t,o){return null}onWindowResize(){}};var S_=async function(n){let e=null;if("getVRDisplays"in n.navigator)try{let t=await n.navigator.getVRDisplays();t&&t.length&&(e=new dr(n,t[0]))}catch{}return e},Ew=async function(n,e){if(e.webvr){let o=await S_(n);if(o)return o}let t=fw(n);return t&&e.cardboard||!t&&e.allowCardboardOnDesktop?(n.VRFrameData||(n.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new Us(n,e.cardboardConfig)):new Gs(n)};var T_={global:Sl,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},Pl=["navigator","HTMLCanvasElement","WebGLRenderingContext"],zs=class{constructor(e={}){this.config=Object.freeze(Object.assign({},T_,e)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}_injectPolyfill(e){if(!Pl.every(t=>!!e[t]))throw new Error(`Global must have the following attributes : ${Pl}`);for(let t of Object.keys(Rl))e[t]!==void 0?console.warn(`${t} already defined on global.`):e[t]=Rl[t];gd(e.WebGLRenderingContext)&&(wd(e.HTMLCanvasElement),e.OffscreenCanvas&&wd(e.OffscreenCanvas),e.WebGL2RenderingContext&&gd(e.WebGL2RenderingContext),window.isSecureContext||console.warn(`WebXR Polyfill Warning:
This page is not running in a secure context (https:// or localhost)!
This means that although the page may be able to use the WebXR Polyfill it will
not be able to use native WebXR implementations, and as such will not be able to
access dedicated VR or AR hardware, and will not be able to take advantage of
any performance improvements a native WebXR implementation may offer. Please
host this content on a secure origin for the best user experience.
`)),this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let e=Ew(this.global,this.config);this.xr=new Rl.XRSystem(e),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(e){if(!Pl.every(t=>!!e[t]))throw new Error(`Global must have the following attributes : ${Pl}`);if(e.navigator.xr&&"supportsSession"in e.navigator.xr&&!("isSessionSupported"in e.navigator.xr)){let t=e.navigator.xr.supportsSession;e.navigator.xr.isSessionSupported=function(o){return t.call(this,o).then(()=>!0).catch(()=>!1)},e.navigator.xr.supportsSession=function(o){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),t.call(this,o)}}}};var Vl=class{constructor(e,t=512,o=512){this.colorMatrixLeft=new wp().fromArray([.4561,-.0400822,-.0152161,.500484,-.0378246,-.0205971,.176381,-.0157589,-.00546856]),this.colorMatrixRight=new wp().fromArray([-.0434706,.378476,-.0721527,-.0879388,.73364,-.112961,-.00155529,-.0184503,1.2264]);let r=new Xa(-1,1,1,-1,0,1),i=new $n,s=new Ax;s.eyeSep=.07;let a={minFilter:$i,magFilter:za,format:fx},c=new vp(t,o,a),p=new vp(t,o,a),m=new qa({uniforms:{mapLeft:{value:c.texture},mapRight:{value:p.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = vec2( uv.x, uv.y );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;","float lin( float c ) {","	return c <= 0.04045 ? c * 0.0773993808 :","			pow( c * 0.9478672986 + 0.0521327014, 2.4 );","}","vec4 lin( vec4 c ) {","	return vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );","}","float dev( float c ) {","	return c <= 0.0031308 ? c * 12.92","			: pow( c, 0.41666 ) * 1.055 - 0.055;","}","void main() {","	vec2 uv = vUv;","	vec4 colorL = lin( texture2D( mapLeft, uv ) );","	vec4 colorR = lin( texture2D( mapRight, uv ) );","	vec3 color = clamp(","			colorMatrixLeft * colorL.rgb +","			colorMatrixRight * colorR.rgb, 0., 1. );","	gl_FragColor = vec4(","			dev( color.r ), dev( color.g ), dev( color.b ),","			max( colorL.a, colorR.a ) );","}"].join(`
`)}),x=new yt(new Kn(2,2),m);i.add(x),this.setSize=function(w,_){e.setSize(w,_);let T=e.getPixelRatio();c.setSize(w*T,_*T),p.setSize(w*T,_*T)},this.render=function(w,_){let T=e.getRenderTarget();w.matrixWorldAutoUpdate===!0&&w.updateMatrixWorld(),_.parent===null&&_.matrixWorldAutoUpdate===!0&&_.updateMatrixWorld(),s.update(_),e.setRenderTarget(c),e.clear(),e.render(w,s.cameraL),e.setRenderTarget(p),e.clear(),e.render(w,s.cameraR),e.setRenderTarget(null),e.render(i,r),e.setRenderTarget(T)},this.dispose=function(){c.dispose(),p.dispose(),x.geometry.dispose(),x.material.dispose()}}};navigator.xr||(console.info("Polyfilling WebXR API"),new zs);var Ol=class extends G{constructor(e,t,o,r,i){super(e),this.mode=t,this.session=o,this.referenceSpaceType=r,this.sessionMode=i}},Xs=class extends Ol{constructor(e,t,o,r){super("sessionstarted",e,t,o,r)}},js=class extends Ol{constructor(e,t,o,r){super("sessionstopped",e,t,o,r)}},Il=new Map([[J.VR,{referenceSpaceType:"local-floor",sessionMode:"immersive-vr"}],[J.AR,{referenceSpaceType:"local-floor",sessionMode:"immersive-ar"}]]),Wl=class extends oe{constructor(e,t,o,r,i){super(),this.renderer=e,this.camera=t,this.fullscreenElement=o,this.enableFullResolution=r,this.enableAnaglyph=i,this._currentMode=J.None,this.buttons=new Map,this.currentSession=null,this.screenUI=null,this.wasVisible=new Map,this.lastFOV=50,this.addEventListener("sessionstarted",s=>{s.sessionMode==="inline"&&(this.lastFOV=this.camera.fov,this.camera.fov=Qi(s.session.renderState.inlineVerticalFieldOfView))}),this.addEventListener("sessionstopped",s=>{s.sessionMode==="inline"&&(this.camera.fov=this.lastFOV)}),this.renderer.xr.addEventListener("sessionstart",()=>this.onSessionStarted()),this.renderer.xr.addEventListener("sessionend",()=>this.onSessionEnded()),this.anaglyph=new Vl(this.renderer),this.refresh()}setUI(e,t,o,r,i){this.screenUI=e;for(let s of[t,o,r,i])s&&this.buttons.set(s.mode,s);for(let s of this.buttons.values())this.wasVisible.set(s,s.visible),s.addEventListener("click",this.toggleMode.bind(this,s.mode));t.available=this.enableAnaglyph,o.available=!yn()&&id(),r.available=lc(),i.available=cc(),this.refresh()}get visible(){return It(this.renderer.domElement)}set visible(e){Ze(this.renderer.domElement,e),this.screenUI&&(e?this.screenUI.show():this.screenUI.hide())}get currentMode(){return this._currentMode}resize(){if(!this.renderer.xr.isPresenting){this.renderer.domElement.style.width="",this.renderer.domElement.style.height="";let{clientWidth:e,clientHeight:t,width:o,height:r}=this.renderer.domElement,i=Math.floor(e*devicePixelRatio),s=Math.floor(t*devicePixelRatio);e>0&&t>0&&(o!==i||r!==s)&&(this.renderer.setPixelRatio(devicePixelRatio),this.renderer.setSize(e,t,!1),this.anaglyph.setSize(e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix())}}getMetrics(){let e=this.renderer.domElement.clientWidth,t=this.renderer.domElement.clientHeight,o=this.renderer.getPixelRatio(),r=this.camera.fov;return{width:e,height:t,pixelRatio:o,fov:r}}setMetrics(e,t,o,r){this.renderer.setPixelRatio(o),this.renderer.setSize(e,t,!1),this.camera.aspect=e/t,this.camera.fov=r,this.camera.updateProjectionMatrix()}async refresh(){let e=Array.from(this.buttons.values()).filter(t=>t.available&&t.mode!==J.Fullscreen&&t.mode!==J.Anaglyph);await Promise.all(e.map(async t=>{let o=Il.get(t.mode);if(t.available=g(o),t.available){let r=navigator.xr&&await navigator.xr.isSessionSupported(o.sessionMode),i=!cc()&&Ep()&&o.sessionMode==="immersive-vr"&&o.referenceSpaceType==="local-floor";t.available=r||i}}))}async toggleMode(e){if(e===J.None)throw new Error("Cannot toggle 'None' Screen Mode");if(e===J.VR||e===J.AR)await this.toggleXR(e);else{let t=e.indexOf("Fullscreen")>=0,o=e.indexOf("Anaglyph")>=0,r=this.currentMode.indexOf("Fullscreen")>=0,i=this.currentMode.indexOf("Anaglyph")>=0;t?await this.toggleFullscreen(i):this.setActive(o!==i?r?J.FullscreenAnaglyph:J.Anaglyph:r?J.Fullscreen:J.None)}}async start(e){let t=e;(e===J.Anaglyph&&this.currentMode===J.Fullscreen||e===J.Fullscreen&&this.currentMode===J.Anaglyph)&&(t=J.FullscreenAnaglyph),t!==this.currentMode&&(await this.toggleMode(this.currentMode),await this.toggleMode(e))}async stop(){await this.toggleMode(this.currentMode)}get isFullscreen(){return"fullscreenElement"in document&&g(document.fullscreenElement)||"fullscreen"in document&&document.fullscreen}async startFullscreen(e){this.isFullscreen||(await this.fullscreenElement.requestFullscreen({navigationUI:"show"}),e?(this.setActive(J.FullscreenAnaglyph),this.dispatchEvent(new Xs(J.FullscreenAnaglyph,null,null,null))):(this.setActive(J.Fullscreen),this.dispatchEvent(new Xs(J.Fullscreen,null,null,null))))}async stopFullscreen(e){this.isFullscreen&&(await document.exitFullscreen(),e?(this.setActive(J.Anaglyph),this.dispatchEvent(new js(J.FullscreenAnaglyph,null,null,null))):(this.setActive(J.None),this.dispatchEvent(new js(J.Fullscreen,null,null,null))))}async toggleFullscreen(e){this.isFullscreen?await this.stopFullscreen(e):await this.startFullscreen(e)}async toggleXR(e){let t=Il.get(e);if(g(t)){if(this.currentSession)this.currentSession.end();else if(navigator.xr){this.camera.position.setScalar(0),this.camera.quaternion.identity();try{let o=await navigator.xr.requestSession(t.sessionMode,{optionalFeatures:["local-floor","bounded-floor","high-refresh-rate","hand-tracking","layers"]});if(this.setActive(e),this.currentSession=o,this.renderer.xr.setReferenceSpaceType(t.referenceSpaceType),this.enableFullResolution&&"XRWebGLLayer"in window&&"getNativeFramebufferScaleFactor"in XRWebGLLayer){let r=XRWebGLLayer.getNativeFramebufferScaleFactor(o);this.renderer.xr.setFramebufferScaleFactor(r)}this.renderer.xr.setSession(o)}catch(o){console.error(`Couldn't start session type '${t.sessionMode}'. Reason: ${o&&o.message||o||"UNKNOWN"}`)}}}}onSessionStarted(){let e=this.currentMode,t=Il.get(this.currentMode),o=this.currentSession;if(o.supportedFrameRates){let r=Math.max(...o.supportedFrameRates);console.log("Changing framerate to",r),o.updateTargetFrameRate(r)}this.dispatchEvent(new Xs(e,o,t.referenceSpaceType,t.sessionMode))}onSessionEnded(){let e=this.currentMode,t=Il.get(this.currentMode),o=this.currentSession;this.currentSession=null,this.renderer.xr.setSession(null),this.setActive(J.None),this.dispatchEvent(new js(e,o,t.referenceSpaceType,t.sessionMode))}setActive(e){for(let t of this.buttons.values())t.active=t.mode===e,t.visible=this.wasVisible.get(t)&&(e!==J.VR&&e!==J.AR||t.mode===e);this._currentMode=e}render(e,t){this.renderer.clear(),this.currentMode===J.Anaglyph||this.currentMode===J.FullscreenAnaglyph?this.anaglyph.render(e,t):this.renderer.render(e,t)}};var di=new W,yw=0,k_=new W,Hl=new W,kd=new W,Nl=new we,Dw=0,M_=0;function b_(n,e){let t=n-e,o=t+_t,r=t-_t;return Vf(t,o,r)}var qs=class extends Re{constructor(e,t,o,r,i=1){super(),this.minDistance=t,this.heightOffset=r,this.speed=i,this.name=e,this.lerp=this.minHeadingRadians>0||this.minDistance>0,this.maxDistance=this.minDistance*5,this.minHeadingRadians=Oe(o),this.maxHeadingRadians=Te-this.minHeadingRadians,Object.seal(this)}copy(e,t=!0){return super.copy(e,t),this.name=e.name+ ++M_,this.lerp=e.lerp,this.maxDistance=e.maxDistance,this.minHeadingRadians=e.minHeadingRadians,this.maxHeadingRadians=e.maxHeadingRadians,this}update(e,t,o,r){r*=.001,this.clampTo(this.lerp,e,t,this.minDistance,this.maxDistance,o,this.minHeadingRadians,this.maxHeadingRadians,r)}reset(e,t,o){this.clampTo(!1,e,t,0,0,o,0,0,0)}clampTo(e,t,o,r,i,s,a,c,p){di.copy(o),di.y-=this.heightOffset*t,yw=s,this.getWorldPosition(Hl),this.getWorldDirection(kd),kd.negate(),Dw=Ts(kd),Nl.identity();let m=!e,x=!e;if(e){let w=k_.copy(di).sub(Hl).length();r<w&&(w<i&&di.lerpVectors(Hl,di,this.speed*p),m=!0);let _=b_(yw,Dw),T=Math.abs(_);a<T&&(T<c?Nl.setFromAxisAngle(this.up,_*this.speed*p):Nl.setFromAxisAngle(this.up,_),x=!0)}(m||x)&&(m&&this.position.add(di.sub(Hl)),x&&this.quaternion.multiply(Nl))}};var Ul=class extends G{constructor(e,t){super(e),this.button=t}},Md=class extends Ul{constructor(e){super("gamepadbuttonup",e)}},bd=class extends Ul{constructor(e){super("gamepadbuttondown",e)}},Ed=class extends G{constructor(e,t,o){super(e),this.axis=t,this.value=o}},yd=class extends Ed{constructor(e,t){super("gamepadaxismaxed",e,t)}},Gl=class extends oe{constructor(){super(),this.lastAxisValues=new Array,this.btnDownEvts=new Array,this.btnUpEvts=new Array,this.wasPressed=new Array,this.axisMaxEvts=new Array,this.wasAxisMaxed=new Array,this.sticks=new Array,this.axisThresholdMax=.9,this.axisThresholdMin=.1,this._pad=null,Object.seal(this)}get displayId(){if("displayId"in this.pad)return this.pad.displayId}get pad(){return this._pad}set pad(e){if(this._pad=e,this.pad){if(this.btnUpEvts.length===0){for(let t=0;t<e.buttons.length;++t)this.btnDownEvts[t]=new bd(t),this.btnUpEvts[t]=new Md(t),this.wasPressed[t]=!1;for(let t=0;t<e.axes.length;++t)this.axisMaxEvts[t]=new yd(t,0),this.wasAxisMaxed[t]=!1,t%2===0&&t<e.axes.length-1&&(this.sticks[t/2]={x:0,y:0}),this.lastAxisValues[t]=e.axes[t]}for(let t=0;t<this.pad.buttons.length;++t){let o=this.wasPressed[t],r=this.pad.buttons[t].pressed;r!==o&&(this.wasPressed[t]=r,this.dispatchEvent((r?this.btnDownEvts:this.btnUpEvts)[t]))}for(let t=0;t<this.pad.axes.length;++t){let o=this.wasAxisMaxed[t],r=this.pad.axes[t],i=Math.sign(r),s=Math.abs(r),a=s>=this.axisThresholdMax,c=s<=this.axisThresholdMin,p=i*(a?1:c?0:s);a&&!o&&(this.axisMaxEvts[t].value=p,this.dispatchEvent(this.axisMaxEvts[t])),this.wasAxisMaxed[t]=a,this.lastAxisValues[t]=p}for(let t=0;t<this.axes.length-1;t+=2){let o=this.sticks[t/2];o.x=this.axes[t],o.y=this.axes[t+1]}}}get id(){return this.pad?this.pad.id:null}get index(){return this.pad?this.pad.index:null}get connected(){return this.pad&&this.pad.connected}get mapping(){return this.pad?this.pad.mapping:null}get timestamp(){return this.pad?this.pad.timestamp:null}get hand(){return this.pad?this.pad.hand:null}get pose(){return this.pad?this.pad.pose:null}get buttons(){return this.pad?this.pad.buttons:null}get axes(){return this.pad?this.pad.axes:null}get hapticActuators(){return this.pad?this.pad.hapticActuators:null}get vibrationActuator(){return this.pad?this.pad.vibrationActuator:null}};var zl=class extends ri{constructor(e){super(e)}start(){this.timer=setInterval(()=>this.onTick(performance.now()),this.targetFrameTime)}stop(){this.timer&&(clearInterval(this.timer),super.stop())}get targetFPS(){return super.targetFPS}set targetFPS(e){super.targetFPS=e,this.isRunning&&this.restart()}};var Dd=class extends G{constructor(){super("activity"),this.level=0}},Qs=class extends Gr{constructor(e){super(e,{fftSize:32,minDecibels:-70}),this._level=0,this.maxLevel=0,this.activityEvt=new Dd,this.timer=new zl(30);let t=new Uint8Array(this.frequencyBinCount);this.timer.addTickHandler(()=>{this.getByteFrequencyData(t),this._level=Math.max(...t),isFinite(this._level)&&(this.maxLevel=Math.max(this.maxLevel,this._level),this.maxLevel>0&&(this._level/=this.maxLevel)),this.activityEvt.level=this.level,this.dispatchEvent(this.activityEvt)})}get level(){return this._level}start(){this.timer.start()}stop(){this.timer.stop()}};var Je;(function(n){n[n.LocalUser=0]="LocalUser",n[n.Mouse=1]="Mouse",n[n.Pen=2]="Pen",n[n.Touch=3]="Touch",n[n.Gamepad=4]="Gamepad",n[n.MotionController=5]="MotionController",n[n.MotionControllerLeft=6]="MotionControllerLeft",n[n.MotionControllerRight=7]="MotionControllerRight",n[n.Nose=8]="Nose",n[n.RemoteUser=9]="RemoteUser"})(Je||(Je={}));var hi=new W;function Cd(n,e,t,o){hi.crossVectors(e,n),n.crossVectors(hi,e),hi.normalize(),n.normalize(),e.normalize(),o.set(hi.x,n.x,-e.x,t.x,hi.y,n.y,-e.y,t.y,hi.z,n.z,-e.z,t.z,0,0,0,1)}var mi=class{constructor(){this._visible=!0,this._style="default"}get style(){return this._style}set style(e){this._style=e}get visible(){return this._visible}set visible(e){this._visible=e}};var vo=class extends mi{get side(){return this._side}set side(e){this._side=e}get object(){return this._object}set object(e){this._object=e}constructor(e){super(),this.env=e,this._object=null,this.T=new W,this.V=new W,this.Q=new we,this._side=-1,this.f=new W,this.up=new W,this.right=new W}get position(){return this.object.position}update(e,t,o,r,i,s,a,c,p,m,x){o&&o.face?(this.position.copy(o.point),o.object.getWorldQuaternion(this.Q),this.T.copy(o.face.normal).applyQuaternion(this.Q),this.V.copy(this.T).multiplyScalar(.02),this.position.add(this.V),this.V.copy(this.T).multiplyScalar(10).add(this.position)):(s?this.position.copy(m).multiplyScalar(2).add(p).sub(this.env.avatar.worldPos).normalize().multiplyScalar(i).add(this.env.avatar.worldPos):(this.V.copy(p).add(t).sub(e).multiplyScalar(2),this.position.copy(m).multiplyScalar(i).add(this.V).add(this.env.avatar.worldPos)),this.V.copy(this.env.avatar.worldPos)),this.lookAt(this.position,this.V),this.style=!r||r.navigable&&!c?a?x?"grabbing":"grab":"default":r.enabled?r.draggable?x?"grabbing":"move":r.navigable?"cell":r.clickable?"pointer":"default":"not-allowed"}lookAt(e,t){this.f.copy(t).sub(e).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat),this.right.crossVectors(this.up,this.f),this.up.crossVectors(this.f,this.right),Cd(this.up,this.f,e,this.object.matrixWorld),this.object.matrix.copy(this.object.parent.matrixWorld).invert().multiply(this.object.matrixWorld),this.object.matrix.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.scale.x*=this.side,this.object.matrix.compose(this.object.position,this.object.quaternion,this.object.scale)}};var hr=class extends vo{constructor(e){super(e),this.material=xg({name:"CursorMat",color:16776960}),this.object=new gn(.01,.01,.01,this.material)}get style(){return this._currentStyle}set style(e){if(this._currentStyle=e,Dt(this.object)&&!nt(this.object.material))switch(this._currentStyle){case"pointer":this.material.color=new We(65280),this.material.needsUpdate=!0;break;case"not-allowed":this.material.color=new We(16711680),this.material.needsUpdate=!0;break;case"move":this.material.color=new We(255),this.material.needsUpdate=!0;break;case"grab":this.material.color=new We(16711935),this.material.needsUpdate=!0;break;case"grabbing":this.material.color=new We(65535),this.material.needsUpdate=!0;break;default:this._currentStyle="default",this.material.color=new We(16776960),this.material.needsUpdate=!0;break}}get visible(){return Br(this)}set visible(e){He(this,e)}};var Cw=new No,Xl=new W,mr=class extends Kf{constructor(){super(),this.type="LineSegmentsGeometry";let e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],o=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(o),this.setAttribute("position",new Wa(e,3)),this.setAttribute("uv",new Wa(t,2))}applyMatrix4(e){let t=this.attributes.instanceStart,o=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),o.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let o=new Ki(t,6,1);return this.setAttribute("instanceStart",new Jt(o,3,0)),this.setAttribute("instanceEnd",new Jt(o,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let o=new Ki(t,6,1);return this.setAttribute("instanceColorStart",new Jt(o,3,0)),this.setAttribute("instanceColorEnd",new Jt(o,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new Mx(e.geometry)),this}fromLineSegments(e){let t=e.geometry;if(t.isGeometry){console.error("LineSegmentsGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else t.isBufferGeometry&&this.setPositions(t.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new No);let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),Cw.setFromBufferAttribute(t),this.boundingBox.union(Cw))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Cr),this.boundingBox===null&&this.computeBoundingBox();let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){let o=this.boundingSphere.center;this.boundingBox.getCenter(o);let r=0;for(let i=0,s=e.count;i<s;i++)Xl.fromBufferAttribute(e,i),r=Math.max(r,o.distanceToSquared(Xl)),Xl.fromBufferAttribute(t,i),r=Math.max(r,o.distanceToSquared(Xl));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}};mr.prototype.isLineSegmentsGeometry=!0;var Bw=new W,Lw=new W,rt=new ln,it=new ln,Fn=new ln,Bd=new W,Ld=new ke,Gt=new tx,Rw=new W,Pn=new No,jl=new Cr,An=new ln;function Pw(n,e,t,o){return An.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),An.multiplyScalar(1/An.w),An.x=t/o.width,An.y=t/o.height,An.applyMatrix4(n.projectionMatrixInverse),An.multiplyScalar(1/An.w),Math.abs(Math.max(An.x,An.y))}var Js=class extends yt{constructor(e=new mr,t=new Cn({color:Math.random()*16777215})){super(e,t),this.type="LineSegments2"}computeLineDistances(){let e=this.geometry,t=e.attributes.instanceStart,o=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let s=0,a=0,c=t.count;s<c;s++,a+=2)Bw.fromBufferAttribute(t,s),Lw.fromBufferAttribute(o,s),r[a]=a===0?0:r[a-1],r[a+1]=r[a]+Bw.distanceTo(Lw);let i=new Ki(r,2,1);return e.setAttribute("instanceDistanceStart",new Jt(i,1,0)),e.setAttribute("instanceDistanceEnd",new Jt(i,1,1)),this}raycast(e,t){e.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');let o=e.params.Line2!==void 0&&e.params.Line2.threshold||0,r=e.ray,i=e.camera,s=i.projectionMatrix,a=this.matrixWorld,c=this.geometry,p=this.material,m=p.resolution,x=p.linewidth+o,w=c.attributes.instanceStart,_=c.attributes.instanceEnd,T=-i.near;c.boundingSphere===null&&c.computeBoundingSphere(),jl.copy(c.boundingSphere).applyMatrix4(a);let y=Math.max(i.near,jl.distanceToPoint(r.origin)),b=Pw(i,y,x,m);if(jl.radius+=b,e.ray.intersectsSphere(jl)===!1)return;c.boundingBox===null&&c.computeBoundingBox(),Pn.copy(c.boundingBox).applyMatrix4(a);let I=Math.max(i.near,Pn.distanceToPoint(r.origin)),V=Pw(i,I,x,m);if(Pn.max.x+=V,Pn.max.y+=V,Pn.max.z+=V,Pn.min.x-=V,Pn.min.y-=V,Pn.min.z-=V,e.ray.intersectsBox(Pn)!==!1){r.at(1,Fn),Fn.w=1,Fn.applyMatrix4(i.matrixWorldInverse),Fn.applyMatrix4(s),Fn.multiplyScalar(1/Fn.w),Fn.x*=m.x/2,Fn.y*=m.y/2,Fn.z=0,Bd.copy(Fn),Ld.multiplyMatrices(i.matrixWorldInverse,a);for(let C=0,H=w.count;C<H;C++){rt.fromBufferAttribute(w,C),it.fromBufferAttribute(_,C),rt.w=1,it.w=1,rt.applyMatrix4(Ld),it.applyMatrix4(Ld);var P=rt.z>T&&it.z>T;if(P)continue;if(rt.z>T){let K=rt.z-it.z,ee=(rt.z-T)/K;rt.lerp(it,ee)}else if(it.z>T){let K=it.z-rt.z,ee=(it.z-T)/K;it.lerp(rt,ee)}rt.applyMatrix4(s),it.applyMatrix4(s),rt.multiplyScalar(1/rt.w),it.multiplyScalar(1/it.w),rt.x*=m.x/2,rt.y*=m.y/2,it.x*=m.x/2,it.y*=m.y/2,Gt.start.copy(rt),Gt.start.z=0,Gt.end.copy(it),Gt.end.z=0;let B=Gt.closestPointToPointParameter(Bd,!0);Gt.at(B,Rw);let R=Ga.lerp(rt.z,it.z,B),q=R>=-1&&R<=1,Y=Bd.distanceTo(Rw)<x*.5;if(q&&Y){Gt.start.fromBufferAttribute(w,C),Gt.end.fromBufferAttribute(_,C),Gt.start.applyMatrix4(a),Gt.end.applyMatrix4(a);let K=new W,ee=new W;r.distanceSqToSegment(Gt.start,Gt.end,ee,K),t.push({point:ee,pointOnLine:K,distance:r.origin.distanceTo(ee),object:this,face:null,faceIndex:C,uv:null,uv2:null})}}}}};Js.prototype.isLineSegments2=!0;var fr=class extends mr{constructor(){super(),this.type="LineGeometry"}setPositions(e){for(var t=e.length-3,o=new Float32Array(2*t),r=0;r<t;r+=3)o[2*r]=e[r],o[2*r+1]=e[r+1],o[2*r+2]=e[r+2],o[2*r+3]=e[r+3],o[2*r+4]=e[r+4],o[2*r+5]=e[r+5];return super.setPositions(o),this}setColors(e){for(var t=e.length-3,o=new Float32Array(2*t),r=0;r<t;r+=3)o[2*r]=e[r],o[2*r+1]=e[r+1],o[2*r+2]=e[r+2],o[2*r+3]=e[r+3],o[2*r+4]=e[r+4],o[2*r+5]=e[r+5];return super.setColors(o),this}fromLine(e){var t=e.geometry;if(t.isGeometry){console.error("LineGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else t.isBufferGeometry&&this.setPositions(t.attributes.position.array);return this}};fr.prototype.isLineGeometry=!0;var Ys=class extends Js{constructor(e=new fr,t=new Cn({color:Math.random()*16777215})){super(e,t),this.type="Line2"}};Ys.prototype.isLine2=!0;var Vw=new fr;Vw.setPositions([0,0,0,0,0,-1]);var Ks=class extends Re{constructor(e,t,o){super(),this._length=1,this.line=new Ys(Vw,gg({color:e,transparent:t<1,opacity:t,linewidth:o})),this.line.computeLineDistances(),N(this,this.line)}get length(){return this._length}set length(e){this._length=e,this.line.scale.set(1,1,e)}};var ql=class extends mi{constructor(e){super(),this.element=e,this._hidden=!1,this.visible=!0,this.style="default",document.addEventListener("pointerlockchange",()=>{this._hidden=!!document.pointerLockElement,this.refresh()})}get style(){return super.style}set style(e){super.style=e,this.refresh()}get visible(){return super.visible&&!this._hidden}set visible(e){super.visible=e,this.refresh()}refresh(){this.element.style.cursor=this.visible?this.style:"none"}};var fi=class extends vo{constructor(e){super(e),this.xr=e.cursor3D&&e.cursor3D.clone()||new hr(this.env),this.system=new ql(this.env.renderer.domElement),this.xr.side=this.side,this.visible=!1,Object.seal(this)}get object(){return this.xr.object}get side(){return this.xr.side}set side(e){this.xr.side=e}get cursor(){return this.xr}set cursor(e){this.xr=e,this._refresh()}get style(){return this.system.style}get visible(){return super.visible}set visible(e){super.visible=e,this._refresh()}set style(e){this.system.style=e,this.xr.style=e,this._refresh()}_refresh(){let e=this.env.eventSys&&this.env.eventSys.mouse&&this.env.eventSys.mouse.isPointerLocked,t=this.env.renderer.xr.isPresenting||e;He(this.xr,this.visible&&t),this.system.visible=this.visible&&!t}lookAt(e,t){this.xr.lookAt(e,t)}};var Ql=class extends G{constructor(e,t){super(e),this.pointer=t,this._hit=null,this._point=null,this._distance=Number.POSITIVE_INFINITY,this._rayTarget=null,Object.seal(this)}set(e,t){e!==this.hit&&(this._hit=e,e?(this._point=e.point,this._distance=e.distance):(this._point=null,this._distance=Number.POSITIVE_INFINITY)),this._rayTarget=t}get hit(){return this._hit}get rayTarget(){return this._rayTarget}get point(){return this._point}get distance(){return this._distance}};var E_=5,y_=new W,Vn=class extends oe{constructor(e,t,o,r){super(),this.type=e,this.id=t,this.env=o,this.origin=new W,this.direction=new W,this.up=new W(0,1,0),this.canMoveView=!1,this.mayTeleport=!1,this.buttons=0,this._isActive=!1,this.moveDistance=0,this.pointerEvents=new Map,this.lastButtons=0,this.canClick=!1,this.dragDistance=0,this._enabled=!1,this._cursor=null,this._curHit=null,this._curTarget=null,this._hoveredHit=null,this._hoveredTarget=null,this._cursor=r,this.cursor&&(this.cursor.visible=!1)}get isActive(){return this._isActive}get canSend(){return this.enabled&&this.isActive}get curHit(){return this._curHit}get curTarget(){return this._curTarget}get hoveredHit(){return this._hoveredHit}set hoveredHit(e){if(e!==this.hoveredHit){let t=As(e);this._hoveredHit=e,this._hoveredTarget=t}}get name(){return Je[this.id]}get rayTarget(){return this._hoveredTarget}get cursor(){return this._cursor}set cursor(e){if(e!==this.cursor){let t=this.cursor,o=this.cursor&&this.cursor.object&&this.cursor.object.name||"cursor",r=t&&t.object&&t.object.parent;r&&t.object.removeFromParent(),e&&(e.object.name=o,t instanceof fi?(t.cursor=e,r&&N(r,t)):(this._cursor=e,t&&(r&&N(r,e),e.style=t.style,e.visible=t.visible)))}}get needsUpdate(){return this.enabled&&this._isActive}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.cursor&&(this.cursor.visible=e)}setButton(e,t){this.lastButtons=this.buttons;let o=1<<e;if(t?this.buttons|=o:this.buttons&=~o,t)this.canClick=!0,this.dragDistance=0,this.env.avatar.setMode(this),this.setEventState("down");else{if(this.canClick){let r=this.buttons;this.buttons=this.lastButtons,this.setEventState("click"),this.buttons=r}this.setEventState("up")}}isPressed(e){let t=1<<e;return(this.buttons&t)!==0}wasPressed(e){let t=1<<e;return(this.lastButtons&t)!==0}fireRay(e,t){let o=this.env.eventSys.fireRay(e,t);if(o!==this.curHit){let r=As(o);this._curHit=o,this._curTarget=r}}getEvent(e){this.pointerEvents.has(e)||this.pointerEvents.set(e,new Ql(e,this));let t=this.pointerEvents.get(e);if(this.hoveredHit?t.set(this.hoveredHit,this.rayTarget):this.curHit?t.set(this.curHit,this.curTarget):t.set(null,null),t.hit){let o=this.curHit||this.hoveredHit;o&&t.hit!==o&&(t.hit.uv=o.uv)}return t}update(){this.needsUpdate&&this.onUpdate()}onUpdate(){this.updatePointerOrientation();let e=this.isPressed(Ne.Primary);(this.moveDistance>0||e)&&(e&&(this.dragDistance+=this.moveDistance,this.dragDistance>E_&&(this.canClick=!1)),this.setEventState("move")),this.moveDistance=0}setEventState(e){if(this.fireRay(this.origin,this.direction),this.curTarget===this.rayTarget)this.hoveredHit=this.curHit;else{let o=this.isPressed(Ne.Primary),r=this.wasPressed(Ne.Primary);if(e==="move"&&!o||e==="down"&&o&&!r||e==="up"&&!o&&r){if(this.rayTarget){let c=this.getEvent("up");this.rayTarget.dispatchEvent(c);let p=this.getEvent("exit");this.dispatchEvent(p),this.rayTarget.dispatchEvent(p)}if(this.hoveredHit=this.curHit,this.rayTarget){let c=this.getEvent("enter");this.dispatchEvent(c),this.rayTarget.dispatchEvent(c)}}this.hoveredHit&&this.hoveredHit.point.copy(this.direction).multiplyScalar(this.hoveredHit.distance).add(this.origin)}let t=this.getEvent(e);this.dispatchEvent(t),t.rayTarget&&(e!=="click"||t.rayTarget.clickable||t.rayTarget.navigable)&&(e==="click"&&t.rayTarget.clickable&&this.vibrate(),t.rayTarget.enabled&&t.rayTarget.dispatchEvent(t)),this.updateCursor(this.env.avatar.worldPos,y_,!0,2)}get canDragView(){return this.canMoveView}get canTeleport(){return this.mayTeleport}updateCursor(e,t,o,r){this.cursor&&this.cursor.update(e,t,this.hoveredHit||this.curHit,this.rayTarget||this.curTarget,r,o,this.canDragView,this.canTeleport,this.origin,this.direction,this.isPressed(Ne.Primary))}get bufferSize(){return 37}writeState(e){e.writeUint8(this.id),e.writeVector48(this.origin),e.writeVector48(this.direction),e.writeVector48(this.up)}};var D_=.2,VO=.5*D_-.025;var iW={fontFamily:vr(),fontSize:20,fontWeight:"bold",textFillColor:"white",textStrokeColor:"black",textStrokeSize:.01,padding:{top:.025,right:.05,bottom:.025,left:.05},maxHeight:.2};var Rd=["none","right","left"],OW=on(Vt);function Pd(n,e){if(e===vx)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===es||e===Ja){let t=n.getIndex();if(t===null){let s=[],a=n.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)s.push(c);n.setIndex(s),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}let o=t.count-2,r=[];if(e===es)for(let s=1;s<=o;s++)r.push(t.getX(0)),r.push(t.getX(s)),r.push(t.getX(s+1));else for(let s=0;s<o;s++)s%2===0?(r.push(t.getX(s)),r.push(t.getX(s+1)),r.push(t.getX(s+2))):(r.push(t.getX(s+2)),r.push(t.getX(s+1)),r.push(t.getX(s)));r.length/3!==o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let i=n.clone();return i.setIndex(r),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}var ko=class extends sx{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Ud(t)}),this.register(function(t){return new Jd(t)}),this.register(function(t){return new Yd(t)}),this.register(function(t){return new Kd(t)}),this.register(function(t){return new zd(t)}),this.register(function(t){return new Xd(t)}),this.register(function(t){return new jd(t)}),this.register(function(t){return new qd(t)}),this.register(function(t){return new Nd(t)}),this.register(function(t){return new Qd(t)}),this.register(function(t){return new Gd(t)}),this.register(function(t){return new Wd(t)}),this.register(function(t){return new $d(t)}),this.register(function(t){return new Zd(t)})}load(e,t,o,r){let i=this,s;this.resourcePath!==""?s=this.resourcePath:this.path!==""?s=this.path:s=Na.extractUrlBase(e),this.manager.itemStart(e);let a=function(p){r?r(p):console.error(p),i.manager.itemError(e),i.manager.itemEnd(e)},c=new hp(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(p){try{i.parse(p,s,function(m){t(m),i.manager.itemEnd(e)},a)}catch(m){a(m)}},o,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,o,r){let i,s={},a={},c=new TextDecoder;if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===Nw){try{s[ie.KHR_BINARY_GLTF]=new eh(e)}catch(x){r&&r(x);return}i=JSON.parse(s[ie.KHR_BINARY_GLTF].content)}else i=JSON.parse(c.decode(e));else i=e;if(i.asset===void 0||i.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let p=new ah(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});p.fileLoader.setRequestHeader(this.requestHeader);for(let m=0;m<this.pluginCallbacks.length;m++){let x=this.pluginCallbacks[m](p);a[x.name]=x,s[x.name]=!0}if(i.extensionsUsed)for(let m=0;m<i.extensionsUsed.length;++m){let x=i.extensionsUsed[m],w=i.extensionsRequired||[];switch(x){case ie.KHR_MATERIALS_UNLIT:s[x]=new Hd;break;case ie.KHR_DRACO_MESH_COMPRESSION:s[x]=new th(i,this.dracoLoader);break;case ie.KHR_TEXTURE_TRANSFORM:s[x]=new nh;break;case ie.KHR_MESH_QUANTIZATION:s[x]=new oh;break;default:w.indexOf(x)>=0&&a[x]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+x+'".')}}p.setExtensions(s),p.setPlugins(a),p.parse(o,r)}parseAsync(e,t){let o=this;return new Promise(function(r,i){o.parse(e,t,r,i)})}};function B_(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}var ie={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"},Wd=class{constructor(e){this.parser=e,this.name=ie.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let o=0,r=t.length;o<r;o++){let i=t[o];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){let t=this.parser,o="light:"+e,r=t.cache.get(o);if(r)return r;let i=t.json,c=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e],p,m=new We(16777215);c.color!==void 0&&m.fromArray(c.color);let x=c.range!==void 0?c.range:0;switch(c.type){case"directional":p=new Va(m),p.target.position.set(0,0,-1),p.add(p.target);break;case"point":p=new px(m),p.distance=x;break;case"spot":p=new Fx(m),p.distance=x,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,p.angle=c.spot.outerConeAngle,p.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,p.target.position.set(0,0,-1),p.add(p.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return p.position.set(0,0,0),p.decay=2,To(p,c),c.intensity!==void 0&&(p.intensity=c.intensity),p.name=t.createUniqueName(c.name||"light_"+e),r=Promise.resolve(p),t.cache.add(o,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){let t=this,o=this.parser,i=o.json.nodes[e],a=(i.extensions&&i.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return o._getNodeRef(t.cache,a,c)})}},Hd=class{constructor(){this.name=ie.KHR_MATERIALS_UNLIT}getMaterialType(){return ot}extendParams(e,t,o){let r=[];e.color=new We(1,1,1),e.opacity=1;let i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){let s=i.baseColorFactor;e.color.fromArray(s),e.opacity=s[3]}i.baseColorTexture!==void 0&&r.push(o.assignTexture(e,"map",i.baseColorTexture,Dr))}return Promise.all(r)}},Nd=class{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}},Ud=class{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Yn}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];if(s.clearcoatFactor!==void 0&&(t.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&i.push(o.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&i.push(o.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(i.push(o.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){let a=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new qe(a,a)}return Promise.all(i)}},Gd=class{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Yn}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];return s.iridescenceFactor!==void 0&&(t.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&i.push(o.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(t.iridescenceIOR=s.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&i.push(o.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(i)}},zd=class{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_SHEEN}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Yn}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[];t.sheenColor=new We(0,0,0),t.sheenRoughness=0,t.sheen=1;let s=r.extensions[this.name];return s.sheenColorFactor!==void 0&&t.sheenColor.fromArray(s.sheenColorFactor),s.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&i.push(o.assignTexture(t,"sheenColorMap",s.sheenColorTexture,Dr)),s.sheenRoughnessTexture!==void 0&&i.push(o.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(i)}},Xd=class{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Yn}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];return s.transmissionFactor!==void 0&&(t.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&i.push(o.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(i)}},jd=class{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_VOLUME}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Yn}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];t.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&i.push(o.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;let a=s.attenuationColor||[1,1,1];return t.attenuationColor=new We(a[0],a[1],a[2]),Promise.all(i)}},qd=class{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_IOR}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Yn}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}},Qd=class{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_SPECULAR}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Yn}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];t.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&i.push(o.assignTexture(t,"specularIntensityMap",s.specularTexture));let a=s.specularColorFactor||[1,1,1];return t.specularColor=new We(a[0],a[1],a[2]),s.specularColorTexture!==void 0&&i.push(o.assignTexture(t,"specularColorMap",s.specularColorTexture,Dr)),Promise.all(i)}},Jd=class{constructor(e){this.parser=e,this.name=ie.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,o=t.json,r=o.textures[e];if(!r.extensions||!r.extensions[this.name])return null;let i=r.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(o.extensionsRequired&&o.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,s)}},Yd=class{constructor(e){this.parser=e,this.name=ie.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,o=this.parser,r=o.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;let s=i.extensions[t],a=r.images[s.source],c=o.textureLoader;if(a.uri){let p=o.options.manager.getHandler(a.uri);p!==null&&(c=p)}return this.detectSupport().then(function(p){if(p)return o.loadTextureImage(e,s.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return o.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},Kd=class{constructor(e){this.parser=e,this.name=ie.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let t=this.name,o=this.parser,r=o.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;let s=i.extensions[t],a=r.images[s.source],c=o.textureLoader;if(a.uri){let p=o.options.manager.getHandler(a.uri);p!==null&&(c=p)}return this.detectSupport().then(function(p){if(p)return o.loadTextureImage(e,s.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return o.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},$d=class{constructor(e){this.name=ie.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,o=t.bufferViews[e];if(o.extensions&&o.extensions[this.name]){let r=o.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(a){let c=r.byteOffset||0,p=r.byteLength||0,m=r.count,x=r.byteStride,w=new Uint8Array(a,c,p);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(m,x,w,r.mode,r.filter).then(function(_){return _.buffer}):s.ready.then(function(){let _=new ArrayBuffer(m*x);return s.decodeGltfBuffer(new Uint8Array(_),m,x,w,r.mode,r.filter),_})})}else return null}},Zd=class{constructor(e){this.name=ie.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){let t=this.parser.json,o=t.nodes[e];if(!o.extensions||!o.extensions[this.name]||o.mesh===void 0)return null;let r=t.meshes[o.mesh];for(let p of r.primitives)if(p.mode!==zt.TRIANGLES&&p.mode!==zt.TRIANGLE_STRIP&&p.mode!==zt.TRIANGLE_FAN&&p.mode!==void 0)return null;let s=o.extensions[this.name].attributes,a=[],c={};for(let p in s)a.push(this.parser.getDependency("accessor",s[p]).then(m=>(c[p]=m,c[p])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(p=>{let m=p.pop(),x=m.isGroup?m.children:[m],w=p[0].count,_=[];for(let T of x){let y=new ke,b=new W,I=new we,V=new W(1,1,1),P=new Ha(T.geometry,T.material,w);for(let C=0;C<w;C++)c.TRANSLATION&&b.fromBufferAttribute(c.TRANSLATION,C),c.ROTATION&&I.fromBufferAttribute(c.ROTATION,C),c.SCALE&&V.fromBufferAttribute(c.SCALE,C),P.setMatrixAt(C,y.compose(b,I,V));for(let C in c)C!=="TRANSLATION"&&C!=="ROTATION"&&C!=="SCALE"&&T.geometry.setAttribute(C,c[C]);Re.prototype.copy.call(P,T),this.parser.assignFinalMaterial(P),_.push(P)}return m.isGroup?(m.clear(),m.add(..._),m):_[0]}))}},Nw="glTF",$s=12,Iw={JSON:1313821514,BIN:5130562},eh=class{constructor(e){this.name=ie.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,$s),o=new TextDecoder;if(this.header={magic:o.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Nw)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-$s,i=new DataView(e,$s),s=0;for(;s<r;){let a=i.getUint32(s,!0);s+=4;let c=i.getUint32(s,!0);if(s+=4,c===Iw.JSON){let p=new Uint8Array(e,$s+s,a);this.content=o.decode(p)}else if(c===Iw.BIN){let p=$s+s;this.body=e.slice(p,p+a)}s+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},th=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ie.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let o=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,a={},c={},p={};for(let m in s){let x=ih[m]||m.toLowerCase();a[x]=s[m]}for(let m in e.attributes){let x=ih[m]||m.toLowerCase();if(s[m]!==void 0){let w=o.accessors[e.attributes[m]],_=xi[w.componentType];p[x]=_.name,c[x]=w.normalized===!0}}return t.getDependency("bufferView",i).then(function(m){return new Promise(function(x){r.decodeDracoFile(m,function(w){for(let _ in w.attributes){let T=w.attributes[_],y=c[_];y!==void 0&&(T.normalized=y)}x(w)},a,p)})})}},nh=class{constructor(){this.name=ie.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},oh=class{constructor(){this.name=ie.KHR_MESH_QUANTIZATION}},Jl=class extends $f{constructor(e,t,o,r){super(e,t,o,r)}copySampleValue_(e){let t=this.resultBuffer,o=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let s=0;s!==r;s++)t[s]=o[i+s];return t}interpolate_(e,t,o,r){let i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,c=a*2,p=a*3,m=r-t,x=(o-t)/m,w=x*x,_=w*x,T=e*p,y=T-p,b=-2*_+3*w,I=_-w,V=1-b,P=I-w+x;for(let C=0;C!==a;C++){let H=s[y+C+a],B=s[y+C+c]*m,R=s[T+C+a],q=s[T+C]*m;i[C]=V*H+P*B+b*R+I*q}return i}},L_=new we,rh=class extends Jl{interpolate_(e,t,o,r){let i=super.interpolate_(e,t,o,r);return L_.fromArray(i).normalize().toArray(i),i}},zt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},xi={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ow={9728:za,9729:$i,9984:lx,9985:ix,9986:cx,9987:gp},Ww={33071:zf,33648:ax,10497:ja},Vd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ih={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},So={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},R_={CUBICSPLINE:void 0,LINEAR:fp,STEP:Zf},Id={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function P_(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new Fp({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Yi})),n.DefaultMaterial}function xr(n,e,t){for(let o in t.extensions)n[o]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[o]=t.extensions[o])}function To(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function V_(n,e,t){let o=!1,r=!1,i=!1;for(let p=0,m=e.length;p<m;p++){let x=e[p];if(x.POSITION!==void 0&&(o=!0),x.NORMAL!==void 0&&(r=!0),x.COLOR_0!==void 0&&(i=!0),o&&r&&i)break}if(!o&&!r&&!i)return Promise.resolve(n);let s=[],a=[],c=[];for(let p=0,m=e.length;p<m;p++){let x=e[p];if(o){let w=x.POSITION!==void 0?t.getDependency("accessor",x.POSITION):n.attributes.position;s.push(w)}if(r){let w=x.NORMAL!==void 0?t.getDependency("accessor",x.NORMAL):n.attributes.normal;a.push(w)}if(i){let w=x.COLOR_0!==void 0?t.getDependency("accessor",x.COLOR_0):n.attributes.color;c.push(w)}}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(c)]).then(function(p){let m=p[0],x=p[1],w=p[2];return o&&(n.morphAttributes.position=m),r&&(n.morphAttributes.normal=x),i&&(n.morphAttributes.color=w),n.morphTargetsRelative=!0,n})}function I_(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,o=e.weights.length;t<o;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){let t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let o=0,r=t.length;o<r;o++)n.morphTargetDictionary[t[o]]=o}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function O_(n){let e,t=n.extensions&&n.extensions[ie.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Od(t.attributes):e=n.indices+":"+Od(n.attributes)+":"+n.mode,n.targets!==void 0)for(let o=0,r=n.targets.length;o<r;o++)e+=":"+Od(n.targets[o]);return e}function Od(n){let e="",t=Object.keys(n).sort();for(let o=0,r=t.length;o<r;o++)e+=t[o]+":"+n[t[o]]+";";return e}function sh(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function W_(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}var H_=new ke,ah=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new B_,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let o=!1,r=!1,i=-1;typeof navigator<"u"&&(o=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,i=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||o||r&&i<98?this.textureLoader=new _x(this.options.manager):this.textureLoader=new Yf(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new hp(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let o=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([o.getDependencies("scene"),o.getDependencies("animation"),o.getDependencies("camera")])}).then(function(s){let a={scene:s[0][r.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:r.asset,parser:o,userData:{}};xr(i,a,r),To(a,r),Promise.all(o._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],o=this.json.meshes||[];for(let r=0,i=t.length;r<i;r++){let s=t[r].joints;for(let a=0,c=s.length;a<c;a++)e[s[a]].isBone=!0}for(let r=0,i=e.length;r<i;r++){let s=e[r];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(o[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,o){if(e.refs[t]<=1)return o;let r=o.clone(),i=(s,a)=>{let c=this.associations.get(s);c!=null&&this.associations.set(a,c);for(let[p,m]of s.children.entries())i(m,a.children[p])};return i(o,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let o=0;o<t.length;o++){let r=e(t[o]);if(r)return r}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let o=[];for(let r=0;r<t.length;r++){let i=e(t[r]);i&&o.push(i)}return o}getDependency(e,t){let o=e+":"+t,r=this.cache.get(o);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(i){return i.loadNode&&i.loadNode(t)});break;case"mesh":r=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(o,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){let o=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(i,s){return o.getDependency(e,s)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],o=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[ie.KHR_BINARY_GLTF].body);let r=this.options;return new Promise(function(i,s){o.load(Na.resolveURL(t.uri,r.path),i,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(o){let r=t.byteLength||0,i=t.byteOffset||0;return o.slice(i,i+r)})}loadAccessor(e){let t=this,o=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){let s=Vd[r.type],a=xi[r.componentType],c=r.normalized===!0,p=new a(r.count*s);return Promise.resolve(new bn(p,s,c))}let i=[];return r.bufferView!==void 0?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),r.sparse!==void 0&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then(function(s){let a=s[0],c=Vd[r.type],p=xi[r.componentType],m=p.BYTES_PER_ELEMENT,x=m*c,w=r.byteOffset||0,_=r.bufferView!==void 0?o.bufferViews[r.bufferView].byteStride:void 0,T=r.normalized===!0,y,b;if(_&&_!==x){let I=Math.floor(w/_),V="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+I+":"+r.count,P=t.cache.get(V);P||(y=new p(a,I*_,r.count*_/m),P=new mp(y,_/m),t.cache.add(V,P)),b=new Jt(P,c,w%_/m,T)}else a===null?y=new p(r.count*c):y=new p(a,w,r.count*c),b=new bn(y,c,T);if(r.sparse!==void 0){let I=Vd.SCALAR,V=xi[r.sparse.indices.componentType],P=r.sparse.indices.byteOffset||0,C=r.sparse.values.byteOffset||0,H=new V(s[1],P,r.sparse.count*I),B=new p(s[2],C,r.sparse.count*c);a!==null&&(b=new bn(b.array.slice(),b.itemSize,b.normalized));for(let R=0,q=H.length;R<q;R++){let Y=H[R];if(b.setX(Y,B[R*c]),c>=2&&b.setY(Y,B[R*c+1]),c>=3&&b.setZ(Y,B[R*c+2]),c>=4&&b.setW(Y,B[R*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return b})}loadTexture(e){let t=this.json,o=this.options,i=t.textures[e].source,s=t.images[i],a=this.textureLoader;if(s.uri){let c=o.manager.getHandler(s.uri);c!==null&&(a=c)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,o){let r=this,i=this.json,s=i.textures[e],a=i.images[t],c=(a.uri||a.bufferView)+":"+s.sampler;if(this.textureCache[c])return this.textureCache[c];let p=this.loadImageSource(t,o).then(function(m){m.flipY=!1,m.name=s.name||a.name||"",m.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(m.name=a.uri);let w=(i.samplers||{})[s.sampler]||{};return m.magFilter=Ow[w.magFilter]||$i,m.minFilter=Ow[w.minFilter]||gp,m.wrapS=Ww[w.wrapS]||ja,m.wrapT=Ww[w.wrapT]||ja,r.associations.set(m,{textures:e}),m}).catch(function(){return null});return this.textureCache[c]=p,p}loadImageSource(e,t){let o=this,r=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(x=>x.clone());let s=r.images[e],a=self.URL||self.webkitURL,c=s.uri||"",p=!1;if(s.bufferView!==void 0)c=o.getDependency("bufferView",s.bufferView).then(function(x){p=!0;let w=new Blob([x],{type:s.mimeType});return c=a.createObjectURL(w),c});else if(s.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let m=Promise.resolve(c).then(function(x){return new Promise(function(w,_){let T=w;t.isImageBitmapLoader===!0&&(T=function(y){let b=new Go(y);b.needsUpdate=!0,w(b)}),t.load(Na.resolveURL(x,i.path),T,void 0,_)})}).then(function(x){return p===!0&&a.revokeObjectURL(c),x.userData.mimeType=s.mimeType||W_(s.uri),x}).catch(function(x){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),x});return this.sourceCache[e]=m,m}assignTexture(e,t,o,r){let i=this;return this.getDependency("texture",o.index).then(function(s){if(!s)return null;if(o.texCoord!==void 0&&o.texCoord>0&&(s=s.clone(),s.channel=o.texCoord),i.extensions[ie.KHR_TEXTURE_TRANSFORM]){let a=o.extensions!==void 0?o.extensions[ie.KHR_TEXTURE_TRANSFORM]:void 0;if(a){let c=i.associations.get(s);s=i.extensions[ie.KHR_TEXTURE_TRANSFORM].extendTexture(s,a),i.associations.set(s,c)}}return r!==void 0&&(s.colorSpace=r),e[t]=s,s})}assignFinalMaterial(e){let t=e.geometry,o=e.material,r=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,s=t.attributes.normal===void 0;if(e.isPoints){let a="PointsMaterial:"+o.uuid,c=this.cache.get(a);c||(c=new hx,Ua.prototype.copy.call(c,o),c.color.copy(o.color),c.map=o.map,c.sizeAttenuation=!1,this.cache.add(a,c)),o=c}else if(e.isLine){let a="LineBasicMaterial:"+o.uuid,c=this.cache.get(a);c||(c=new xp,Ua.prototype.copy.call(c,o),c.color.copy(o.color),c.map=o.map,this.cache.add(a,c)),o=c}if(r||i||s){let a="ClonedMaterial:"+o.uuid+":";r&&(a+="derivative-tangents:"),i&&(a+="vertex-colors:"),s&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=o.clone(),i&&(c.vertexColors=!0),s&&(c.flatShading=!0),r&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(o))),o=c}e.material=o}getMaterialType(){return Fp}loadMaterial(e){let t=this,o=this.json,r=this.extensions,i=o.materials[e],s,a={},c=i.extensions||{},p=[];if(c[ie.KHR_MATERIALS_UNLIT]){let x=r[ie.KHR_MATERIALS_UNLIT];s=x.getMaterialType(),p.push(x.extendParams(a,i,t))}else{let x=i.pbrMetallicRoughness||{};if(a.color=new We(1,1,1),a.opacity=1,Array.isArray(x.baseColorFactor)){let w=x.baseColorFactor;a.color.fromArray(w),a.opacity=w[3]}x.baseColorTexture!==void 0&&p.push(t.assignTexture(a,"map",x.baseColorTexture,Dr)),a.metalness=x.metallicFactor!==void 0?x.metallicFactor:1,a.roughness=x.roughnessFactor!==void 0?x.roughnessFactor:1,x.metallicRoughnessTexture!==void 0&&(p.push(t.assignTexture(a,"metalnessMap",x.metallicRoughnessTexture)),p.push(t.assignTexture(a,"roughnessMap",x.metallicRoughnessTexture))),s=this._invokeOne(function(w){return w.getMaterialType&&w.getMaterialType(e)}),p.push(Promise.all(this._invokeAll(function(w){return w.extendMaterialParams&&w.extendMaterialParams(e,a)})))}i.doubleSided===!0&&(a.side=Ia);let m=i.alphaMode||Id.OPAQUE;if(m===Id.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,m===Id.MASK&&(a.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&s!==ot&&(p.push(t.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new qe(1,1),i.normalTexture.scale!==void 0)){let x=i.normalTexture.scale;a.normalScale.set(x,x)}return i.occlusionTexture!==void 0&&s!==ot&&(p.push(t.assignTexture(a,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&s!==ot&&(a.emissive=new We().fromArray(i.emissiveFactor)),i.emissiveTexture!==void 0&&s!==ot&&p.push(t.assignTexture(a,"emissiveMap",i.emissiveTexture,Dr)),Promise.all(p).then(function(){let x=new s(a);return i.name&&(x.name=i.name),To(x,i),t.associations.set(x,{materials:e}),i.extensions&&xr(r,x,i),x})}createUniqueName(e){let t=mx.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){let t=this,o=this.extensions,r=this.primitiveCache;function i(a){return o[ie.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return Hw(c,a,t)})}let s=[];for(let a=0,c=e.length;a<c;a++){let p=e[a],m=O_(p),x=r[m];if(x)s.push(x.promise);else{let w;p.extensions&&p.extensions[ie.KHR_DRACO_MESH_COMPRESSION]?w=i(p):w=Hw(new Ji,p,t),r[m]={primitive:p,promise:w},s.push(w)}}return Promise.all(s)}loadMesh(e){let t=this,o=this.json,r=this.extensions,i=o.meshes[e],s=i.primitives,a=[];for(let c=0,p=s.length;c<p;c++){let m=s[c].material===void 0?P_(this.cache):this.getDependency("material",s[c].material);a.push(m)}return a.push(t.loadGeometries(s)),Promise.all(a).then(function(c){let p=c.slice(0,c.length-1),m=c[c.length-1],x=[];for(let _=0,T=m.length;_<T;_++){let y=m[_],b=s[_],I,V=p[_];if(b.mode===zt.TRIANGLES||b.mode===zt.TRIANGLE_STRIP||b.mode===zt.TRIANGLE_FAN||b.mode===void 0)I=i.isSkinnedMesh===!0?new wx(y,V):new yt(y,V),I.isSkinnedMesh===!0&&I.normalizeSkinWeights(),b.mode===zt.TRIANGLE_STRIP?I.geometry=Pd(I.geometry,Ja):b.mode===zt.TRIANGLE_FAN&&(I.geometry=Pd(I.geometry,es));else if(b.mode===zt.LINES)I=new ox(y,V);else if(b.mode===zt.LINE_STRIP)I=new ex(y,V);else if(b.mode===zt.LINE_LOOP)I=new nx(y,V);else if(b.mode===zt.POINTS)I=new dx(y,V);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+b.mode);Object.keys(I.geometry.morphAttributes).length>0&&I_(I,i),I.name=t.createUniqueName(i.name||"mesh_"+e),To(I,i),b.extensions&&xr(r,I,b),t.assignFinalMaterial(I),x.push(I)}for(let _=0,T=x.length;_<T;_++)t.associations.set(x[_],{meshes:e,primitives:_});if(x.length===1)return i.extensions&&xr(r,x[0],i),x[0];let w=new Er;i.extensions&&xr(r,w,i),t.associations.set(w,{meshes:e});for(let _=0,T=x.length;_<T;_++)w.add(x[_]);return w})}loadCamera(e){let t,o=this.json.cameras[e],r=o[o.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return o.type==="perspective"?t=new Uo(Ga.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):o.type==="orthographic"&&(t=new Xa(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),o.name&&(t.name=this.createUniqueName(o.name)),To(t,o),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],o=[];for(let r=0,i=t.joints.length;r<i;r++)o.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?o.push(this.getDependency("accessor",t.inverseBindMatrices)):o.push(null),Promise.all(o).then(function(r){let i=r.pop(),s=r,a=[],c=[];for(let p=0,m=s.length;p<m;p++){let x=s[p];if(x){a.push(x);let w=new ke;i!==null&&w.fromArray(i.array,p*16),c.push(w)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[p])}return new gx(a,c)})}loadAnimation(e){let o=this.json.animations[e],r=o.name?o.name:"animation_"+e,i=[],s=[],a=[],c=[],p=[];for(let m=0,x=o.channels.length;m<x;m++){let w=o.channels[m],_=o.samplers[w.sampler],T=w.target,y=T.node,b=o.parameters!==void 0?o.parameters[_.input]:_.input,I=o.parameters!==void 0?o.parameters[_.output]:_.output;T.node!==void 0&&(i.push(this.getDependency("node",y)),s.push(this.getDependency("accessor",b)),a.push(this.getDependency("accessor",I)),c.push(_),p.push(T))}return Promise.all([Promise.all(i),Promise.all(s),Promise.all(a),Promise.all(c),Promise.all(p)]).then(function(m){let x=m[0],w=m[1],_=m[2],T=m[3],y=m[4],b=[];for(let I=0,V=x.length;I<V;I++){let P=x[I],C=w[I],H=_[I],B=T[I],R=y[I];if(P===void 0)continue;P.updateMatrix();let q;switch(So[R.path]){case So.weights:q=ux;break;case So.rotation:q=Ap;break;case So.position:case So.scale:default:q=Sx;break}let Y=P.name?P.name:P.uuid,K=B.interpolation!==void 0?R_[B.interpolation]:fp,ee=[];So[R.path]===So.weights?P.traverse(function(Me){Me.morphTargetInfluences&&ee.push(Me.name?Me.name:Me.uuid)}):ee.push(Y);let me=H.array;if(H.normalized){let Me=sh(me.constructor),ce=new Float32Array(me.length);for(let ut=0,_n=me.length;ut<_n;ut++)ce[ut]=me[ut]*Me;me=ce}for(let Me=0,ce=ee.length;Me<ce;Me++){let ut=new q(ee[Me]+"."+So[R.path],C.array,me,K);B.interpolation==="CUBICSPLINE"&&(ut.createInterpolant=function(bo){let Xt=this instanceof Ap?rh:Jl;return new Xt(this.times,this.values,this.getValueSize()/3,bo)},ut.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),b.push(ut)}}return new Hf(r,void 0,b)})}createNodeMesh(e){let t=this.json,o=this,r=t.nodes[e];return r.mesh===void 0?null:o.getDependency("mesh",r.mesh).then(function(i){let s=o._getNodeRef(o.meshCache,r.mesh,i);return r.weights!==void 0&&s.traverse(function(a){if(a.isMesh)for(let c=0,p=r.weights.length;c<p;c++)a.morphTargetInfluences[c]=r.weights[c]}),s})}loadNode(e){let t=this.json,o=this,r=t.nodes[e],i=o._loadNodeShallow(e),s=[],a=r.children||[];for(let p=0,m=a.length;p<m;p++)s.push(o.getDependency("node",a[p]));let c=r.skin===void 0?Promise.resolve(null):o.getDependency("skin",r.skin);return Promise.all([i,Promise.all(s),c]).then(function(p){let m=p[0],x=p[1],w=p[2];w!==null&&m.traverse(function(_){_.isSkinnedMesh&&_.bind(w,H_)});for(let _=0,T=x.length;_<T;_++)m.add(x[_]);return m})}_loadNodeShallow(e){let t=this.json,o=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];let i=t.nodes[e],s=i.name?r.createUniqueName(i.name):"",a=[],c=r._invokeOne(function(p){return p.createNodeMesh&&p.createNodeMesh(e)});return c&&a.push(c),i.camera!==void 0&&a.push(r.getDependency("camera",i.camera).then(function(p){return r._getNodeRef(r.cameraCache,i.camera,p)})),r._invokeAll(function(p){return p.createNodeAttachment&&p.createNodeAttachment(e)}).forEach(function(p){a.push(p)}),this.nodeCache[e]=Promise.all(a).then(function(p){let m;if(i.isBone===!0?m=new Uf:p.length>1?m=new Er:p.length===1?m=p[0]:m=new Re,m!==p[0])for(let x=0,w=p.length;x<w;x++)m.add(p[x]);if(i.name&&(m.userData.name=i.name,m.name=s),To(m,i),i.extensions&&xr(o,m,i),i.matrix!==void 0){let x=new ke;x.fromArray(i.matrix),m.applyMatrix4(x)}else i.translation!==void 0&&m.position.fromArray(i.translation),i.rotation!==void 0&&m.quaternion.fromArray(i.rotation),i.scale!==void 0&&m.scale.fromArray(i.scale);return r.associations.has(m)||r.associations.set(m,{}),r.associations.get(m).nodes=e,m}),this.nodeCache[e]}loadScene(e){let t=this.extensions,o=this.json.scenes[e],r=this,i=new Er;o.name&&(i.name=r.createUniqueName(o.name)),To(i,o),o.extensions&&xr(t,i,o);let s=o.nodes||[],a=[];for(let c=0,p=s.length;c<p;c++)a.push(r.getDependency("node",s[c]));return Promise.all(a).then(function(c){for(let m=0,x=c.length;m<x;m++)i.add(c[m]);let p=m=>{let x=new Map;for(let[w,_]of r.associations)(w instanceof Ua||w instanceof Go)&&x.set(w,_);return m.traverse(w=>{let _=r.associations.get(w);_!=null&&x.set(w,_)}),x};return r.associations=p(i),i})}};function N_(n,e,t){let o=e.attributes,r=new No;if(o.POSITION!==void 0){let a=t.json.accessors[o.POSITION],c=a.min,p=a.max;if(c!==void 0&&p!==void 0){if(r.set(new W(c[0],c[1],c[2]),new W(p[0],p[1],p[2])),a.normalized){let m=sh(xi[a.componentType]);r.min.multiplyScalar(m),r.max.multiplyScalar(m)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let i=e.targets;if(i!==void 0){let a=new W,c=new W;for(let p=0,m=i.length;p<m;p++){let x=i[p];if(x.POSITION!==void 0){let w=t.json.accessors[x.POSITION],_=w.min,T=w.max;if(_!==void 0&&T!==void 0){if(c.setX(Math.max(Math.abs(_[0]),Math.abs(T[0]))),c.setY(Math.max(Math.abs(_[1]),Math.abs(T[1]))),c.setZ(Math.max(Math.abs(_[2]),Math.abs(T[2]))),w.normalized){let y=sh(xi[w.componentType]);c.multiplyScalar(y)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}n.boundingBox=r;let s=new Cr;r.getCenter(s.center),s.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=s}function Hw(n,e,t){let o=e.attributes,r=[];function i(s,a){return t.getDependency("accessor",s).then(function(c){n.setAttribute(a,c)})}for(let s in o){let a=ih[s]||s.toLowerCase();a in n.attributes||r.push(i(o[s],a))}if(e.indices!==void 0&&!n.index){let s=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});r.push(s)}return To(n,e),N_(n,e,t),Promise.all(r).then(function(){return e.targets!==void 0?V_(n,e.targets,t):n})}var Ve={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function Uw(n){let e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function U_(n){if(!n)throw new Error("No basePath supplied");return await Uw(`${n}/profilesList.json`)}async function Gw(n,e,t=null,o=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");let r=await U_(e),i;if(n.profiles.some(c=>{let p=r[c];return p&&(i={profileId:c,profilePath:`${e}/${p.path}`,deprecated:!!p.deprecated}),!!i}),!i){if(!t)throw new Error("No matching profile name found");let c=r[t];if(!c)throw new Error(`No matching profile name found and default profile "${t}" missing.`);i={profileId:t,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}}let s=await Uw(i.profilePath),a;if(o){let c;if(n.handedness==="any"?c=s.layouts[Object.keys(s.layouts)[0]]:c=s.layouts[n.handedness],!c)throw new Error(`No matching handedness, ${n.handedness}, in profile ${i.profileId}`);c.assetPath&&(a=i.profilePath.replace("profile.json",c.assetPath))}return{profile:s,assetPath:a}}var G_={xAxis:0,yAxis:0,button:0,state:Ve.ComponentState.DEFAULT};function z_(n=0,e=0){let t=n,o=e;if(Math.sqrt(n*n+e*e)>1){let s=Math.atan2(e,n);t=Math.cos(s),o=Math.sin(s)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:o*.5+.5}}var ch=class{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Ve.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(G_)}updateFromComponent({xAxis:e,yAxis:t,button:o,state:r}){let{normalizedXAxis:i,normalizedYAxis:s}=z_(e,t);switch(this.componentProperty){case Ve.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?i:.5;break;case Ve.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?s:.5;break;case Ve.ComponentProperty.BUTTON:this.value=this.states.includes(r)?o:0;break;case Ve.ComponentProperty.STATE:this.valueNodeProperty===Ve.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},lh=class{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(o=>{let r=new ch(t.visualResponses[o]);this.visualResponses[o]=r}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:Ve.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Ve.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){let t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=Ve.ComponentState.PRESSED:(t.touched||this.values.button>Ve.ButtonTouchThreshold)&&(this.values.state=Ve.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Ve.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Ve.AxisTouchThreshold&&(this.values.state=Ve.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Ve.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Ve.AxisTouchThreshold&&(this.values.state=Ve.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}},Yl=class{constructor(e,t,o){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=o,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(r=>{let i=this.layoutDescription.components[r];this.components[r]=new lh(r,i)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}};var X_="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",j_="generic-trigger",uh=class extends Re{constructor(){super(...arguments),this.envMap=null,this.motionController=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{Dt(t)&&(ns(t.material)||os(t.material)||rs(t.material))&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(o=>{let{valueNode:r,minNode:i,maxNode:s}=o;r&&(q_(o)?r.visible=o.value:Q_(o)&&(r.quaternion.slerpQuaternions(i.quaternion,s.quaternion,o.value),r.position.lerpVectors(i.position,s.position,o.value)))})}))}};function Xw(n,e){return n&&n.valueNodeProperty===e}function q_(n){return Xw(n,"visibility")}function Q_(n){return Xw(n,"transform")}function J_(n,e){Object.values(n.components).forEach(t=>{let{type:o,touchPointNodeName:r,visualResponses:i}=t;if(o===Ve.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(r),t.touchPointNode){let s=new Qa(.001),a=new ot({color:255}),c=new yt(s,a);t.touchPointNode.add(c)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(i).forEach(s=>{let{valueNodeName:a,minNodeName:c,maxNodeName:p,valueNodeProperty:m}=s;if(m===Ve.VisualResponseProperty.TRANSFORM){if(s.minNode=e.getObjectByName(c),s.maxNode=e.getObjectByName(p),!s.minNode){console.warn(`Could not find ${c} in the model`);return}if(!s.maxNode){console.warn(`Could not find ${p} in the model`);return}}s.valueNode=e.getObjectByName(a),s.valueNode||console.warn(`Could not find ${a} in the model`)})})}function zw(n,e){J_(n.motionController,e),n.envMap&&e.traverse(t=>{Dt(t)&&(ns(t.material)||os(t.material)||rs(t.material))&&(t.material.envMap=n.envMap,t.material.needsUpdate=!0)}),n.add(e)}var Kl=class{constructor(e=null){this.gltfLoader=e||new ko,this.path=X_,this._assetCache={}}createControllerModel(e,t=null){let o=new uh,r=null;return e.addEventListener("connected",async i=>{let s=i.data;if(!(s.targetRayMode!=="tracked-pointer"||!s.gamepad))try{let{profile:a,assetPath:c}=await Gw(s,this.path,t||j_);o.motionController=new Yl(s,a,c);let p=this._assetCache[o.motionController.assetUrl];if(p)r=p.scene.clone(),zw(o,r);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(o.motionController.assetUrl,m=>{this._assetCache[o.motionController.assetUrl]=m,r=m.scene.clone(),zw(o,r)},null,()=>{throw new Error(`Asset ${o.motionController.assetUrl} missing or malformed.`)})}}catch(a){console.warn(a)}}),e.addEventListener("disconnected",()=>{ve(o.motionController),o.motionController=null,ve(r),r=null}),o}};var Y_=new Kl,K_=new ke().makeRotationX(-7*Te/9),jw=new ke,qw=new Map([["none",Je.MotionController],["left",Je.MotionControllerLeft],["right",Je.MotionControllerRight]]),$l;(function(n){n[n.Trigger=0]="Trigger",n[n.Grip=1]="Grip",n[n.Stick=3]="Stick",n[n.X_A=4]="X_A",n[n.Y_B=5]="Y_B"})($l||($l={}));var Qw=new Map([[$l.Y_B,Ne.Menu],[$l.X_A,Ne.Info]]),Zl=class extends Vn{constructor(e,t){if(super("hand",Je.MotionController,e,new hr(e)),this.laser=new Ks(Up,.75,.002),this._isHand=!1,this.inputSource=null,this._gamepad=new Gl,this.delta=new W,this.newOrigin=new W,this.quaternion=new we,this.newQuat=new we,this.useHaptics=!0,this.mayTeleport=!0,this.object=ue("PointerHand"+t),this.quaternion.identity(),N(this,N(this.controller=this.env.renderer.xr.getController(t),this.laser),N(this.grip=this.env.renderer.xr.getControllerGrip(t),this.gripModel=Y_.createControllerModel(this.controller)),N(this.hand=this.env.renderer.xr.getHand(t),this.handModel=this.env.handModelFactory.createHandModel(this.hand))),Wr()&&Gx()&&!Dn){let i=!1;this.controller.traverse(s=>{s.name.toLocaleLowerCase().indexOf("oculus")>=0&&(i=!0)}),i&&this.laser.matrix.copy(K_)}this.gamepad.addEventListener("gamepadaxismaxed",i=>{i.axis===2&&this.env.avatar.snapTurn(i.value)});let o=i=>s=>{Qw.has(s.button)&&this.setButton(Qw.get(s.button),i)};this.gamepad.addEventListener("gamepadbuttondown",o(!0)),this.gamepad.addEventListener("gamepadbuttonup",o(!1));let r=(i,s)=>()=>this.setButton(i,s);this.controller.addEventListener("selectstart",r(Ne.Primary,!0)),this.controller.addEventListener("selectend",r(Ne.Primary,!1)),this.controller.addEventListener("squeezestart",r(Ne.Secondary,!0)),this.controller.addEventListener("squeezeend",r(Ne.Secondary,!1)),this.controller.addEventListener("connected",i=>{i.target===this.controller&&(this.inputSource=i.data,this.gamepad.pad=this.inputSource.gamepad,this._isHand=g(this.inputSource.hand),this.id=qw.get(this.handedness),this.grip.visible=!this.isHand,this.controller.visible=!this.isHand,this.hand.visible=this.isHand,this.enabled=!0,this._isActive=!0,this.env.eventSys.checkXRMouse(),this.updateCursorSide())}),this.controller.addEventListener("disconnected",i=>{i.target===this.controller&&(this.inputSource=null,this.gamepad.pad=null,this._isHand=!1,this.id=qw.get(this.handedness),this.grip.visible=!1,this.controller.visible=!1,this.hand.visible=!1,this.enabled=!1,this._isActive=!1,this.env.eventSys.checkXRMouse(),this.updateCursorSide())}),Object.seal(this)}vibrate(){this._vibrate()}async _vibrate(){if(this.useHaptics&&this.gamepad.hapticActuators)try{await Promise.all(this.gamepad.hapticActuators.map(e=>e.pulse(.25,125)))}catch{this.useHaptics=!1}}get gamepad(){return this._gamepad}get handedness(){return L(this.inputSource)?null:this.inputSource.handedness}get isHand(){return this._isHand}get cursor(){return super.cursor}set cursor(e){super.cursor=e,this.updateCursorSide()}updateCursorSide(){this.cursor.side=this.handedness==="left"?1:-1}updatePointerOrientation(){this.laser.getWorldPosition(this.newOrigin),this.laser.getWorldQuaternion(this.newQuat),this.origin.lerp(this.newOrigin,.9),this.quaternion.slerp(this.newQuat,.9),this.delta.copy(this.origin).add(this.direction),this.direction.set(0,0,-1).applyQuaternion(this.quaternion),this.up.set(0,1,0).applyQuaternion(this.quaternion),this.delta.sub(this.direction).sub(this.origin),this.moveDistance+=50*this.delta.length()}onUpdate(){this.gamepad.pad=this.inputSource&&this.inputSource.gamepad||null,super.onUpdate()}get bufferSize(){return super.bufferSize+2+this.handModel.count*64}writeState(e){if(super.writeState(e),e.writeEnum8(this.handedness,Rd),e.writeUint8(this.handModel.count),this.handModel.isTracking)for(let t=0;t<this.handModel.count;++t)this.handModel.getMatrixAt(t,jw),e.writeMatrix512(jw)}};var gi=class extends Vn{constructor(e,t,o,r){super(e,t,o,r),this.position=new qe,this.motion=new qe,this.uv=new qe,this.duv=new qe,this.uvComp=new qe(1,-1),this.uvOff=new qe(-1,1),this.canMoveView=!0;let i=s=>{this._isActive=this.onCheckEvent(s),this._isActive&&this.onReadEvent(s)};this.element=this.env.renderer.domElement,this.element.addEventListener("pointerdown",i),this.element.addEventListener("pointermove",i),this.element.addEventListener("pointerup",i),this.element.addEventListener("pointercancel",i)}onCheckEvent(e){return e.pointerType===this.type}onReadEvent(e){this.updatePointerOrientation()}updatePointerOrientation(){this.element.clientWidth>0&&this.element.clientHeight>0&&(this.uv.copy(this.position),this.uv.x/=this.element.clientWidth,this.uv.y/=this.element.clientHeight,this.uv.multiplyScalar(2).multiply(this.uvComp).add(this.uvOff),this.duv.copy(this.motion),this.duv.x/=this.element.clientWidth,this.duv.y/=this.element.clientHeight,this.duv.multiplyScalar(2).multiply(this.uvComp),this.moveDistance=200*this.duv.length());let e=Ko(this.env.renderer,this.env.camera);this.origin.setFromMatrixPosition(e.matrixWorld),this.direction.set(this.uv.x,this.uv.y,.5).unproject(e).sub(this.origin).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat)}onUpdate(){this.env.avatar.onMove(this,this.uv,this.duv),super.onUpdate(),this.motion.setScalar(0),this.duv.setScalar(0)}};var wi=class extends gi{constructor(e,t,o){let r=a=>{a.pointerType===e&&this.pointerID==null&&(this.pointerID=a.pointerId)},i=a=>{a.pointerType===e&&this.pointerID!=null&&(this.pointerID=null)},s=o.renderer.domElement;s.addEventListener("pointerdown",r),s.addEventListener("pointermove",r),super(e,t,o,new fi(o)),this.pointerID=null,this.lastX=null,this.lastY=null,s.addEventListener("pointerup",i),s.addEventListener("pointercancel",i)}onCheckEvent(e){return super.onCheckEvent(e)&&e.pointerId===this.pointerID}onReadEvent(e){this.position.set(e.offsetX,e.offsetY),e.type==="pointerdown"?this.motion.setScalar(0):(this.motion.x+=e.offsetX-this.lastX,this.motion.y+=e.offsetY-this.lastY),this.lastX=e.offsetX,this.lastY=e.offsetY,super.onReadEvent(e),(e.type==="pointerdown"||e.type==="pointerup"||e.type==="pointercancel")&&this.setButton(e.button,e.type==="pointerdown")}};var eu=class extends wi{constructor(e){super("mouse",Je.Mouse,e),this.allowPointerLock=!1,this.dz=0,this.keyMap=new Map([["`",Ne.Info],["ContextMenu",Ne.Menu]]),this.element.addEventListener("wheel",t=>{t.preventDefault(),this.dz+=-t.deltaY*.1},{passive:!1}),this.element.addEventListener("contextmenu",t=>{t.preventDefault()}),this.element.addEventListener("pointerdown",t=>{this.onCheckEvent(t)&&(this.allowPointerLock&&!this.isPointerLocked?this.lockPointer():!this.allowPointerLock&&!this.isPointerCaptured&&this.capturePointer())}),this.element.addEventListener("pointerup",t=>{this.onCheckEvent(t)&&(this.allowPointerLock&&this.isPointerLocked?this.unlockPointer():!this.allowPointerLock&&this.isPointerCaptured&&this.releaseCapture())},!0),document.addEventListener("pointerlockchange",()=>{this.cursor.visible=!0}),window.addEventListener("keydown",t=>{this._isActive&&this.keyMap.has(t.key)&&this.setButton(this.keyMap.get(t.key),Ir(t))}),window.addEventListener("keyup",t=>{this.keyMap.has(t.key)&&this.setButton(this.keyMap.get(t.key),!1)}),this.mayTeleport=!0,Object.seal(this)}updatePointerOrientation(){this.isPointerLocked&&this.position.set(this.env.renderer.domElement.clientWidth,this.env.renderer.domElement.clientHeight).multiplyScalar(.5),super.updatePointerOrientation()}onUpdate(){super.onUpdate(),this.env.avatar.zoom(this.dz),this.dz=0}get isPointerLocked(){return document.pointerLockElement!=null}get isPointerCaptured(){return this.element.hasPointerCapture(this.pointerID)}get canDragView(){return super.canDragView&&!this.isPointerLocked}get canTeleport(){return super.canTeleport&&this.isPointerLocked}lockPointer(){this.element.requestPointerLock()}unlockPointer(){document.exitPointerLock()}capturePointer(){this.element.setPointerCapture(this.pointerID)}releaseCapture(){this.element.releasePointerCapture(this.pointerID)}vibrate(){}};var tu=class extends Vn{constructor(e){super("nose",Je.Nose,e,null),this.point=new W,this.lastPoint=new W,this.mayTeleport=!1,this.enabled=!0,this._isActive=!0,this.updatePointerOrientation(),this.moveDistance=0,Object.seal(this)}vibrate(){}get canSend(){return!1}updatePointerOrientation(){let e=this.env.camera;e.getWorldPosition(this.origin),e.getWorldDirection(this.direction),this.up.copy(e.up),this.point.copy(this.direction).add(this.origin),this.moveDistance=this.point.distanceTo(this.lastPoint),this.lastPoint.copy(this.point)}};var nu=class extends wi{constructor(e){super("pen",Je.Pen,e),Object.seal(this)}vibrate(){}};function $_(n){return n.pointerId}var ou=class extends gi{constructor(e){super("touch",Je.Touch,e,null),this.dz=0,this.lastZ=0,this.points=new Array,this.lastXs=new Map,this.lastYs=new Map,this._canVibrate=null,Object.seal(this)}get enabled(){return super.enabled}set enabled(e){super.enabled=e,de(this.points)}onReadEvent(e){Nh(this.points,e.pointerId,$_);let t=e.type==="pointerdown"||e.type==="pointermove";if(t&&this.points.push(e),this.points.length===2){let r=this.points[0],i=this.points[1],s=i.offsetX-r.offsetX,a=i.offsetY-r.offsetY,c=5*Math.sqrt(s*s+a*a),p=c-this.lastZ;e.type==="pointermove"&&(this.dz+=p),this.lastZ=c}let o=1/this.points.length;if(t){this.position.setScalar(0);for(let r of this.points)if(this.position.x+=o*r.offsetX,this.position.y+=o*r.offsetY,this.lastXs.has(r.pointerId)){let i=this.lastXs.get(r.pointerId),s=this.lastYs.get(r.pointerId),a=r.offsetX-i,c=r.offsetY-s;this.motion.x+=o*a,this.motion.y+=o*c}}if(t?(this.lastXs.set(e.pointerId,e.offsetX),this.lastYs.set(e.pointerId,e.offsetY)):(this.lastXs.delete(e.pointerId),this.lastYs.delete(e.pointerId)),super.onReadEvent(e),e.type!=="pointermove"){let r=0;for(let i=0;i<this.points.length;++i){let s=this.points[i],a=1<<i;s.buttons!==0?r|=a:r&=~a}for(let i=0;i<10;++i){let s=this.isPressed(i),a=1<<i,c=(r&a)!==0;c!==s&&this.setButton(i,c)}e.type==="pointerup"&&setTimeout(()=>this._isActive=!1,10)}}onUpdate(){this.env.avatar.zoom(this.dz),super.onUpdate(),this.dz=0}get canVibrate(){return this._canVibrate===null&&(this._canVibrate="vibrate"in navigator&&Z(navigator.vibrate)),this._canVibrate}vibrate(){this.canVibrate&&navigator.vibrate(125)}};var Z_=(n,e)=>n.distance-e.distance,ru=class extends oe{set sortFunction(e){this.customSortFunction=e}get sortFunction(){return this.customSortFunction||Z_}constructor(e){super(),this.env=e,this.raycaster=new xx,this.hands=new Array,this.hits=new Array,this.queue=new Array,this.targetsFound=new Set,this.targets=new Array,this.customSortFunction=null,this.raycaster.camera=this.env.camera,this.raycaster.layers.set(_l),this.mouse=new eu(this.env),this.pen=new nu(this.env),this.touches=new ou(this.env),this.nose=new tu(this.env);for(let t=0;t<2;++t)this.hands[t]=new Zl(this.env,t);this.pointers=[this.mouse,this.pen,this.touches,this.nose,...this.hands];for(let t of this.pointers)t.addBubbler(this),t.cursor&&N(this.env.stage,t.cursor);this.checkXRMouse(),Object.seal(this)}checkXRMouse(){let e=0;for(let o of this.hands.values())o.enabled&&++e;let t=e===0;this.mouse.enabled=t,this.pen.enabled=t,this.touches.enabled=t}refreshCursors(){for(let e of this.pointers)e.cursor&&(e.cursor=this.env.cursor3D.clone())}fireRay(e,t){return de(this.hits),this.raycaster.ray.origin.copy(e),this.raycaster.ray.direction.copy(t),this.raycaster.intersectObjects(this.targets,!1,this.hits),this.hits.sort(this.sortFunction),this.hits[0]||null}update(){for(this.targetsFound.clear(),de(this.targets),this.queue.push(this.env.scene);this.queue.length>0;){let e=this.queue.shift();e.children.length>0&&this.queue.push(...e.children);let t=As(e);t&&!this.targetsFound.has(t)&&(this.targetsFound.add(t),this.targets.push(...t.meshes))}for(let e of this.pointers)e.update()}};var iu=class n extends vo{constructor(e,t){super(e),this.cursorSystem=null,this.object=ue("Cursor3D"),this.cursorSystem=t,this.object.matrixAutoUpdate=!1}add(e,t){N(this,t),$g(t,li),t.visible=e==="default"}get style(){for(let e of this.object.children)if(e.visible)return e.name;return null}set style(e){for(let t of this.object.children)t.visible=t.name===e;if(this.style==null&&this.object.children.length>0){let t=pt(this.object.children,o=>o.name==="default",o=>o!=null);t!=null&&(t.visible=!0)}this.cursorSystem&&(this.cursorSystem.style="none")}get visible(){return Br(this)}set visible(e){He(this,e)}clone(){let e=new n(this.env);for(let t of this.object.children)e.add(t.name,t.clone());return e}};var ph=new we().identity(),Jw=new we().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(ph.setFromAxisAngle(new W(0,1,0),Math.PI/2),Jw.setFromAxisAngle(new W(1,0,0),Math.PI).premultiply(ph));var ev="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/",su=class extends Re{constructor(e,t,o){super(),this.controller=e,this.handedness=t,this.bones=new Map,this.root=null,this.instanceMatrix={needsUpdate:!1},this.oculusBrowserV14Correction=this.handedness==="left"?Jw:ph;let r=new ko;r.setPath(ev),r.load(`${this.handedness}.glb`,i=>{this.root=i.scene.children[0],this.add(this.root);let s=this.root.getObjectByProperty("type","SkinnedMesh");s.frustumCulled=!1,s.castShadow=!0,s.receiveShadow=!0,rs(s.material)?s.material=Fg(s.material):ns(s.material)&&(s.material=gs(s.material)),os(s.material)&&(s.material.color=o,s.material.shininess=.1),Mo.forEach(a=>this.addBone(a))})}addBone(e){if(this.root){let t=this.root.getObjectByName(e);t&&this.bones.set(e,t)}}get count(){return this.bones.size}set count(e){}getMatrixAt(e,t){if(0<=e&&e<Mo.length){let o=Mo[e];this.bones.has(o)&&t.copy(this.bones.get(o).matrix)}}setMatrixAt(e,t){if(0<=e&&e<Mo.length){let o=Mo[e];if(this.bones.has(o)){let r=this.bones.get(o);r.matrix.copy(t),r.matrix.decompose(r.position,r.quaternion,r.scale)}}}updateMesh(){if(this.controller)for(let[e,t]of this.bones){let o=this.controller.joints[e];o&&o.visible&&(t.position.copy(o.position),t.quaternion.copy(o.quaternion).multiply(this.oculusBrowserV14Correction))}}};var tv=.008,dh=new ke,Yw=new W,Kw=new ke().identity(),$w=new ke().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(Kw.makeRotationY(Math.PI/2),$w.makeRotationY(-Math.PI/2));var au=class extends Ha{constructor(e,t,o,r){let i;r==="boxes"?i=new Pa(1,1,1):r==="bones"?i=new qf(.5,.75,2.25,10,1).rotateX(-Math.PI/2):i=new Qa(1,10,10);let s=new yr({color:o,shininess:.1});super(i,s,30),this.controller=e,this.instanceMatrix.setUsage(Qf),this.castShadow=!0,this.receiveShadow=!0,this.oculusBrowserV14Correction=t==="left"?$w:Kw}updateMesh(){if(this.controller){let e=0;for(let t of Mo){let o=this.controller.joints[t];o&&o.visible&&(Yw.setScalar(o.jointRadius||tv),dh.compose(o.position,o.quaternion,Yw),dh.multiply(this.oculusBrowserV14Correction),this.setMatrixAt(e,dh),e++)}this.count=e}this.instanceMatrix.needsUpdate=!0}};var Mo=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],hh=class extends Re{get isTracking(){return!!this.impl}constructor(e,t,o){super(),this.controllerOrHandedness=e,this.color=t,this.profile=o,this.impl=null;let r=null,i=null;X(e)?i=e:r=e;let s=()=>this.add(this.impl=this.createModel(r,i));r?(r.addEventListener("connected",a=>{let c=a.data;c.hand&&!this.impl&&(i=c.handedness,s())}),r.addEventListener("disconnected",()=>{let a=this.impl;this.impl=null,i=null,a.removeFromParent(),ve(a)})):i&&s()}createModel(e,t){return this.profile==="mesh"?new su(e,t,this.color):new au(e,t,this.color,this.profile)}get count(){return this.impl?this.impl.count:0}set count(e){this.impl&&(this.impl.count=e)}getMatrixAt(e,t){this.impl&&this.impl.getMatrixAt(e,t)}setMatrixAt(e,t){this.impl&&this.impl.setMatrixAt(e,t)}updateMesh(){this.impl&&this.impl.updateMesh()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.impl&&this.impl.updateMesh()}},cu=class{constructor(e,t){this.color=e,this.profile=t}createHandModel(e){return new hh(e,this.color,this.profile)}};var mh=class extends ps{constructor(){super(),this.frame=null,Object.seal(this)}set(e,t,o){super.set(e,t),this.frame=o}},lu=class{constructor(e){this.renderer=e,this.tickHandlers=new Array,this.lt=-1,this._isRunning=!1;let t=new mh,o=0;this._onTick=(r,i)=>{this.lt>=0&&(o=r-this.lt,t.set(r,o,i),this.tick(t)),this.lt=r}}get isRunning(){return this._isRunning}restart(){this.stop(),this.start()}addTickHandler(e){this.tickHandlers.push(e)}removeTickHandler(e){Ke(this.tickHandlers,e)}setAnimationLoop(e){this.renderer.setAnimationLoop(e),this._isRunning=g(e)}start(){this.isRunning||this.setAnimationLoop(this._onTick)}stop(){this.isRunning&&(this.setAnimationLoop(null),this.lt=-1)}tick(e){for(let t of this.tickHandlers)t(e)}};var Zw=15,nv=Mg(Zw),uu=class extends oe{constructor(e,t,o,r,i,s=null,a=null,c=null){if(super(),this.styleSheetPath=t,this.fetcher=o,this.layers=new Array,this.layerSortOrder=new Map,this.spectator=new Uo,this.lastViewport=new ln,this.curViewport=new ln,this.gltfLoader=new ko,this.fadeDepth=0,this.scene=new $n,this.stage=ue("Stage"),this.ambient=new Ra(16777215,.5),this.sun=new Va(16777215,.75),this.ground=new Jf(nv,Zw,12632256,8421504),this.foreground=ue("Foreground"),this.loadingBar=new vl,this.handModelFactory=new cu(new We(12044521),"mesh"),this.screenControl=null,this.enableSpectator=!1,this._xrBinding=null,this._xrMediaBinding=null,this._hasXRMediaLayers=null,this._hasXRCompositionLayers=null,this.layerSorter=on("descending",m=>this.layerSortOrder.get(m)),this.DEBUG=s||!1,this.defaultAvatarHeight=a||1.75,c=c||60,this.camera=new Uo(c,1,.01,1e3),this.cursor3D=new iu(this),Qt(e)&&(e.style.backgroundColor="black",L(e.parentElement)))throw new Error("The provided canvas must be included in a parent element before constructing the environment.");this.renderer=new Ya({canvas:e,powerPreference:"high-performance",precision:"lowp",antialias:!0,alpha:!0,premultipliedAlpha:!0,depth:!0,logarithmicDepthBuffer:!0,stencil:!1,preserveDrawingBuffer:!1}),this.renderer.domElement.setAttribute("touch-action","none"),this.renderer.domElement.tabIndex=1,this.useNewColorModel=!1,Qt(e)&&(this.screenControl=new Wl(this.renderer,this.camera,this.renderer.domElement.parentElement,r,i)),this.fader=new Al("ViewFader"),this.worldUISpace=new qs("WorldUISpace",.2,20,.125),this.avatar=new Fl(this,this.fader),this.eventSys=new ru(this),this.timer=new lu(this.renderer),this.skybox=new nc(this),this.renderer.xr.enabled=!0,this.sun.name="Sun",this.sun.position.set(0,1,1),this.sun.lookAt(0,0,0),this.sun.layers.enableAll();let p=()=>{this.ground.visible=this.renderer.xr.isPresenting};this.screenControl.addEventListener("sessionstarted",p),this.screenControl.addEventListener("sessionstopped",p),p(),this.ambient.name="Fill",this.ambient.layers.enableAll(),this.loadingBar.object.name="MainLoadingBar",this.loadingBar.object.position.set(0,-.25,-2),this.scene.layers.enableAll(),this.avatar.addFollower(this.worldUISpace),N(this.scene,this.sun,this.ambient,N(this.stage,this.ground,this.camera,this.avatar,...this.eventSys.hands),this.foreground,N(this.worldUISpace,this.loadingBar)),this.timer.addTickHandler(m=>this.update(m)),this._start(),globalThis.env=this}get useNewColorModel(){return dp.enabled}set useNewColorModel(e){dp.enabled=e,this.renderer.outputEncoding=e?bx:rx}async _start(){g(this.styleSheetPath)&&await this.fetcher.get(this.styleSheetPath).style(),this.timer.start()}get gl(){return this.renderer.getContext()}get referenceSpace(){return this.renderer.xr.getReferenceSpace()}update(e){if(this.dispatchEvent(e),this.screenControl.visible){let t=this.xrSession;this._xrBinding=this.renderer.xr.getBinding(),this.hasXRMediaLayers&&this._xrMediaBinding===null===this.renderer.xr.isPresenting&&(this._xrMediaBinding===null&&g(t)?this._xrMediaBinding=new XRMediaBinding(t):this._xrMediaBinding=null);let o=t&&this.renderer.xr.getBaseLayer();o!==this.baseLayer&&(g(this.baseLayer)&&(this.removeWebXRLayer(this.baseLayer),this.baseLayer=null),g(o)&&(this.baseLayer=o,this.addWebXRLayer(o,0))),this.screenControl.resize(),this.eventSys.update(),this.avatar.update(e.dt),this.worldUISpace.update(this.avatar.height,this.avatar.worldPos,this.avatar.worldHeadingRadians,e.dt),this.fader.update(e.dt),Px(e.dt),this.loadingBar.update(e.sdt),this.preRender(e);let r=Ko(this.renderer,this.camera);if(r!==this.camera){let i=r;i.layers.mask=this.camera.layers.mask;for(let s=0;s<i.cameras.length;++s){let a=i.cameras[s];a.layers.mask=this.camera.layers.mask,a.layers.enable(s+1),i.layers.enable(s+1)}}this.screenControl.render(this.scene,this.camera),this.enableSpectator&&(this.renderer.xr.isPresenting?Wr()&&!ac()&&this.drawSnapshot():(this.lastViewport.copy(this.curViewport),this.renderer.getViewport(this.curViewport)))}}drawSnapshot(){let e=this.renderer.xr.isPresenting,t=null;if(e){let o=Ko(this.renderer,this.camera);this.spectator.projectionMatrix.copy(this.camera.projectionMatrix),this.spectator.position.copy(o.position),this.spectator.quaternion.copy(o.quaternion),t=this.renderer.getRenderTarget(),this.renderer.xr.isPresenting=!1,this.renderer.setRenderTarget(null),this.renderer.setViewport(this.lastViewport)}this.screenControl.render(this.scene,e?this.spectator:this.camera),e&&(this.renderer.setViewport(this.curViewport),this.renderer.setRenderTarget(t),this.renderer.xr.isPresenting=!0)}preRender(e){}async onQuitting(){this.dispatchEvent(new G("quitting")),window.location.href="/"}get hasAlpha(){return this.renderer.getContextAttributes().alpha}get xrSession(){return this.renderer.xr.getSession()}get xrBinding(){return this._xrBinding}get xrMediaBinding(){return this._xrMediaBinding}get isReadyForLayers(){return this.hasAlpha&&(!Dn||Xx.major>=15)}get hasXRMediaLayers(){return this._hasXRMediaLayers===null&&(this._hasXRMediaLayers=this.isReadyForLayers&&"XRMediaBinding"in globalThis&&Z(XRMediaBinding.prototype.createQuadLayer)),this._hasXRMediaLayers}get hasXRCompositionLayers(){return this._hasXRCompositionLayers===null&&(this._hasXRCompositionLayers=this.isReadyForLayers&&"XRWebGLBinding"in globalThis&&Z(XRWebGLBinding.prototype.createCubeLayer)),this._hasXRCompositionLayers}addWebXRLayer(e,t){this.layerSortOrder.set(e,t),wr(this.layers,e,this.layerSorter),this.updateLayers()}removeWebXRLayer(e){Wh(this.layers,e,this.layerSorter),this.layerSortOrder.delete(e),this.updateLayers()}updateLayers(){let e=this.xrSession;g(e)&&e.updateRenderState({layers:this.layers})}clearScene(){this.dispatchEvent(new G("sceneclearing")),ve(this.foreground),this.dispatchEvent(new G("scenecleared"))}async fadeOut(){++this.fadeDepth,this.fadeDepth===1&&(await this.fader.fadeOut(),this.skybox.visible=!1,this.camera.layers.set(li),this.loadingBar.start(),await this.fader.fadeIn())}async fadeIn(){this.fadeDepth===1&&(await this.fader.fadeOut(),this.camera.layers.set(_l),this.skybox.visible=!0,await this.fader.fadeIn()),--this.fadeDepth}async withFade(e){try{return await this.fadeOut(),await e()}finally{await this.fadeIn()}}get showWebXRLayers(){return this.fadeDepth===0}set3DCursor(e){let t=e.children.slice(0);for(let o of t)this.cursor3D.add(o.name,o);this.eventSys.refreshCursors(),this.dispatchEvent(new G("newcursorloaded"))}async load(e,...t){let o=null;Xo(e)?t.push(e):o=e;let r=new qo(this,"/models/Cursors.glb",Bo,!this.DEBUG);t.push(r),await this.fetcher.assets(o,...t),xs(r.result.scene,wg),this.set3DCursor(r.result.scene)}loadGltf(e){return this.gltfLoader.loadAsync(e)}};function Fi(n,e){return zc(n,e,Vt)}var Zs=class extends oe{constructor(...e){super(),this.element=ge(he("input-range-with-number"),this.rangeInput=Um(un(()=>{this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.dispatchEvent(new G("input"))}),...e),this.numberInput=kr(un(()=>{this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber,this.rangeInput.dispatchEvent(new Event("input"))}))),this.numberInput.min=this.rangeInput.min,this.numberInput.max=this.rangeInput.max,this.numberInput.step=this.rangeInput.step,this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.numberInput.disabled=this.rangeInput.disabled,this.numberInput.placeholder=this.rangeInput.placeholder}get value(){return this.rangeInput.value}set value(e){this.rangeInput.value=this.numberInput.value=e}get valueAsNumber(){return this.rangeInput.valueAsNumber}set valueAsNumber(e){this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber=e}get disabled(){return this.rangeInput.disabled}set disabled(e){this.rangeInput.disabled=this.numberInput.disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}};var ea=class{constructor(e,...t){this.name=e,this.properties=t}};function fh(n,...e){return new ea(n,...e)}var xh="DefaultPropertyGroup"+ht(16),ov=he("single-item");function e1(n){return n.flatMap(e=>rv(e).flatMap(Vt))}function rv(n){let e=xh,t=new Array;return n instanceof ea?(e=n.name,t.push(...n.properties.map(o=>t1(e,o)))):t.push(t1(e,n)),t}function t1(n,e){let t=n===xh?null:ha("groupname",n);if(nt(e)){let[o,...r]=e,i=op(o);for(let s of r)if(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement||s instanceof HTMLSelectElement){s.id.length===0&&(s.id=ht(10)),i.htmlFor=s.id;break}return[Vm(t,i),tp(t,...r)]}else return(X(e)||fe(e)||Pt(e)||aa(e))&&(e=Om(e)),[tp(t,e)]}function iv(n){return g(n)&&!Zu(n)&&!Oi(n)}var pu=class n{static find(){return Array.from(n._find())}static*_find(){for(let e of ym(".properties"))yield new n(e)}static create(...e){let t=e.filter(iv),o=e.filter(Zu),r=e.filter(Oi),i=e1(t);return new n(Pm(he("properties"),...o,...r,...i))}constructor(e){this.element=e,this.groups=new wt,this.controls=new Array,this._disabled=!1;let t=[...e.children];for(;t.length>0;){let o=t.shift();Hi(o)&&this.controls.push(o),o instanceof HTMLElement&&(this.checkGroup(o),t.push(...o.children))}}append(...e){let t=e1(e);te(this.element,...t);for(let o of e){let r=o instanceof ea?o.properties:[o];for(let i of r)if(!X(i)){let[s,...a]=nt(i)?i:[null,i];for(let c of a)Hi(c)&&this.controls.push(c)}}for(let o of t)this.checkGroup(o)}checkGroup(e){let t=Tn(e),o=t.dataset.groupname;o!==xh&&this.groups.add(o,e),t.parentElement===this.element&&t.tagName==="DD"&&(!t.previousElementSibling||t.previousElementSibling.tagName!=="DT")&&ov.applyToElement(t)}get disabled(){return this._disabled}set disabled(e){if(e!==this.disabled){this._disabled=e,Cm(this,e,"disabled");for(let t of this.controls)t.disabled=e}}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}setGroupVisible(e,t){let o=this.groups.get(e);if(o)for(let r of o)Ze(r,t)}getGroupVisible(e){let t=this.groups.get(e);if(t)for(let o of t)return It(o);return!1}};var du="micFields"+ht(8),gh="camFields"+ht(8);function n1(n,e,t){Ni(n),te(n,va(sn(""),"NONE"),...e.map(o=>va(sm(t&&o.deviceId===t.deviceId),sn(o.deviceId),o.label)))}var hu=class extends co{constructor(e,t,o,r,i,s=!1){super("Configure devices"),this.devices=t,this.audio=o,this.microphones=r,this.webcams=i,this.micLookup=null,this.camLookup=null,this.spkrLookup=null,this.spkrVolumeControl=null,this.speakers=null,this.cancelButton.style.display="none";let a=new $t("/audio/test-clip.mp3",vn,!s),c=e.assets(a).then(()=>this.audio.createBasicClip("test-audio",a,.5));te(this.contentArea,_m("2em"),this.properties=pu.create(fh(gh,["Webcams",this.webcamSelector=Sa(un(async()=>{let p=this.webcamSelector.value,m=this.camLookup.get(p);await this.webcams.setDevice(m)}))]),fh(du,["Microphones",this.microphoneSelector=Sa(at("inline-block"),un(async()=>{let p=this.microphoneSelector.value,m=this.micLookup.get(p);await this.microphones.setDevice(m)}))],["Volume",this.micVolumeControl=new Zs(Po(0),Ro(100),Vo(1),sn(0),un(()=>{this.microphones.gain.setValueAtTime(this.micVolumeControl.valueAsNumber/100,0)}))],["Levels",this.micLevels=Hm(at("inline-block"))]))),hn&&(this.properties.append(["Speakers",this.speakers=Sa(un(async()=>{let p=this.speakers.value,m=this.spkrLookup.get(p);await this.audio.speakers.setAudioOutputDevice(m)}))]),this.audio.speakers.addEventListener("audiooutputchanged",p=>{this.speakers.value=p.device&&p.device.deviceId||""})),this.properties.append(["Volume",this.spkrVolumeControl=new Zs(Po(0),Ro(100),Vo(1),sn(0),un(()=>this.audio.destination.volume=this.spkrVolumeControl.valueAsNumber/100))],["",this.testSpkrButton=_a("Test",fa("Test audio"),ep(Io(.5)),ic(async()=>{this.testSpkrButton.disabled=!0,await c,await this.audio.playClipThrough("test-audio"),this.testSpkrButton.disabled=!1}))],["Using headphones",this.useHeadphones=Gi(da(this.audio.useHeadphones),un(()=>{this.audio.useHeadphones=this.useHeadphones.checked,Ze(this.headphoneWarning,!this.audio.useHeadphones,"inline-block")}))],this.headphoneWarning=ge(he("alert","alert-warning"),"\u{1F3A7}\u{1F399}\uFE0F This site has a voice chat feature. Voice chat is best experienced using headphones.")),this.activity=new Qs(this.audio.context),this.activity.name="device-settings-dialog-activity",this.activity.addEventListener("activity",p=>{this.isOpen&&(this.micLevels.value=p.level)}),this.microphones.connect(this.activity),this.activity.start(),this.properties.setGroupVisible(du,!1),Object.seal(this)}get showWebcams(){return this.properties.getGroupVisible(gh)}set showWebcams(e){this.properties.setGroupVisible(gh,e)}get showMicrophones(){return this.properties.getGroupVisible(du)}set showMicrophones(e){this.properties.setGroupVisible(du,e)}async onShowing(){if(this.showWebcams||this.showMicrophones){await this.devices.init();let e=await this.devices.getDevices();if(this.showWebcams){let t=e.filter(o=>o.kind==="videoinput");this.camLookup=Fi(t,o=>o.deviceId),n1(this.webcamSelector,t,this.webcams.device)}if(this.showMicrophones){let t=e.filter(o=>o.kind==="audioinput");this.micLookup=Fi(t,o=>o.deviceId),n1(this.microphoneSelector,t,this.microphones.device),this.microphones.usingHeadphones=this.useHeadphones.checked,this.microphones.enabled=!0,this.micVolumeControl.valueAsNumber=this.microphones.gain.value*100}}if(hn){await this.audio.speakers.ready;let e=await this.audio.speakers.getAudioOutputDevices();this.spkrLookup=Fi(e,o=>o.deviceId),Ni(this.speakers),te(this.speakers,...e.map(o=>va(sn(o.deviceId),o.label)));let t=await this.audio.speakers.getAudioOutputDevice();t||(t=await this.audio.speakers.getPreferredAudioOutput(),await this.audio.speakers.setAudioOutputDevice(t)),this.speakers.value=t&&t.deviceId||""}this.spkrVolumeControl.valueAsNumber=this.audio.destination.volume*100,this.useHeadphones.checked=this.audio.useHeadphones,Ze(this.headphoneWarning,!this.audio.useHeadphones,"inline-block"),await super.onShowing()}};var wh=class extends G{constructor(e){super("roomjoined"),this.roomName=e}},Fh=class extends G{constructor(e){super("dialogshowing"),this.showing=e}},mu=class extends uu{get currentRoom(){return this._currentRoom}constructor(e){if(L(e))throw new Error("Options are now required");if(L(e.canvas))throw new Error("options.canvas is required");if(L(e.fetcher))throw new Error("options.fetcher is required");if(L(e.dialogFontFamily))throw new Error("options.dialogFontFamily is required");if(L(e.getAppUrl))throw new Error("options.getAppUrl is required");if(L(e.uiImagePaths))throw new Error("options.uiImagePaths is required");if(L(e.buttonFillColor))throw new Error("options.buttonFillColor is required");if(L(e.labelFillColor))throw new Error("options.labelFillColor is required");super(e.canvas,e.styleSheetPath,e.fetcher,e.enableFullResolution,e.enableAnaglyph,e.DEBUG,e.defaultAvatarHeight,e.defaultFOV),this.envAudioToggleEvt=new G("environmentaudiotoggled"),this._currentRoom=null,this._testSpaceLayout=!1,this.countTick=0,this.fpses=new Array,this.avgFPS=0,this.screenUISpace=new el(e.buttonFillColor),this.compassImage=new Gc,this.clockImage=new uo(this,"Clock","none",new Kc),this.clockImage.sizeMode="fixed-height",this.clockImage.mesh.renderOrder=5,this.statsImage=new uo(this,"Stats","none",new $c),this.statsImage.sizeMode="fixed-height",this.statsImage.mesh.renderOrder=5,this.infoLabel=new Bn(this,"InfoLabel","none",{minHeight:.1,maxHeight:.1,padding:.02,scale:1e3,bgFillColor:e.labelFillColor,textFillColor:"white"}),this.apps=new wl(this,e.getAppUrl),this.apps.addEventListener("apploaded",t=>{t.app.addEventListener("joinroom",o=>{o.roomName!==this._currentRoom&&(this._currentRoom=o.roomName,this.dispatchEvent(new wh(o.roomName)))})}),this.audio=new Oc(e.fetcher,cg),this.graph=new Jc(this.audio.context),Qt(e.canvas)&&e.canvas.addEventListener("keypress",t=>{Ir(t)&&t.key==="`"&&this.graph.showDialog()}),this.audioPlayer=new Nc(this.audio.context,this.audio.createSpatializer(!1,!1)),this.videoPlayer=new ul(this,this.audio.context,this.audio.createSpatializer(!1,!1)),this.videoPlayer.object.visible=!1,this.interactionAudio=new dl(this.audio,this.eventSys),this.microphones=new Wc(this.audio.context),this.webcams=new Zc,this.devices=new pc(this.microphones,this.webcams),this.confirmationDialog=new gl(this,e.dialogFontFamily),this.devicesDialog=new hu(this.fetcher,this.devices,this.audio,this.microphones,this.webcams,this.DEBUG),this.uiButtons=new fl(e.uiImagePaths,20,e.buttonFillColor,e.labelFillColor,this.DEBUG),this.menuButton=new ci(this.uiButtons,"ui","menu"),this.settingsButton=new ci(this.uiButtons,"ui","settings"),this.quitButton=new ci(this.uiButtons,"ui","quit"),this.muteMicButton=new po(this.uiButtons,"microphone","mute","unmute"),this.muteCamButton=new po(this.uiButtons,"media","play","pause"),this.muteEnvAudioButton=new po(this.uiButtons,"environment-audio","mute","unmute"),this.muteEnvAudioButton.active=!0,this.audio.ready.then(()=>this.muteEnvAudioButton.active=!1),this.fullscreenButton=new Yo(this.uiButtons,J.Fullscreen),this.anaglyphButton=new Yo(this.uiButtons,J.Anaglyph),this.vrButton=new Yo(this.uiButtons,J.VR),this.arButton=new Yo(this.uiButtons,J.AR),hs.isAvailable&&ss()&&(this.batteryImage=new uo(this,"Battery","none",new hs),this.batteryImage.sizeMode="fixed-height"),this.xrUI=new tl,this.subMenu=new lo(ge(Lo("juniperSubMenu")),ue("sub-menu"),"flex"),this.createMenu(),this.screenControl.setUI(this.screenUISpace,this.anaglyphButton,this.fullscreenButton,this.vrButton,this.arButton),g(this.screenControl)&&this.screenControl.addEventListener("sessionstarted",t=>{t.mode===J.Fullscreen&&this.confirmationDialog.element.parentElement!==this.screenControl.fullscreenElement&&te(this.screenControl.fullscreenElement,this.devicesDialog,this.confirmationDialog)}),g(e.watchModelPath)&&(this.watch=new pl(this,e.watchModelPath)),this.microphones.addEventListener("devicesettingschanged",()=>{this.muteMicButton.active=this.microphones.enabled&&!this.microphones.muted}),this.webcams.addEventListener("devicesettingschanged",()=>{this.muteCamButton.active=this.webcams.enabled}),this.muteMicButton.addEventListener("click",()=>{this.microphones.muted=this.microphones.enabled&&!this.microphones.muted,this.muteMicButton.active=!this.microphones.muted}),this.muteCamButton.addEventListener("click",()=>{this.webcams.enabled=!this.webcams.enabled,this.muteCamButton.active=this.webcams.enabled}),this.muteMicButton.active=this.microphones.enabled&&!this.microphones.muted,this.muteCamButton.active=this.webcams.enabled,Z(e.createSpeechRecognizer)&&(this.speech=e.createSpeechRecognizer(this.fetcher,this.devicesDialog.activity,this.microphones),this.speech.continuous=!0)}get canvas(){return this.statsImage.image.canvas}get testSpaceLayout(){return this._testSpaceLayout}set testSpaceLayout(e){e!==this.testSpaceLayout&&(this._testSpaceLayout=e)}createMenu(){g(this.batteryImage)&&(this.xrUI.addItem(this.batteryImage,{x:.75,y:-1,width:.2,height:.1}),te(this.screenUISpace.topRight,this.batteryImage)),this.xrUI.addItem(this.clockImage,{x:-1,y:1,height:.1}),this.xrUI.addItem(this.statsImage,{x:-1,y:.95,height:.1}),this.xrUI.addItem(this.confirmationDialog,{x:0,y:0,scale:.25}),this.xrUI.addItem(this.menuButton,{x:-1,y:-1,scale:.5}),this.xrUI.addItem(this.infoLabel,{x:0,y:-1.125,scale:.5}),this.xrUI.addItem(this.vrButton,{x:1,y:-1,scale:.5}),this.xrUI.addItem(this.arButton,{x:1,y:-1,scale:.5}),N(this.menuButton,this.subMenu),N(this.worldUISpace,this.xrUI),te(this.screenUISpace.topLeft,vm("none"),te(this.webcams,at("inline-block"),Oo(Xn(50)),km("scaleX(-1)"))),this.screenUISpace.topRight.append(...[this.compassImage,this.statsImage].map(e=>e.canvas).filter(Qt).map(e=>e)),te(this.screenUISpace.bottomCenter,this.infoLabel),te(this.screenUISpace.bottomRight,this.vrButton,this.arButton,this.fullscreenButton,this.anaglyphButton),te(this.screenUISpace.bottomLeft,ge(this.menuButton,at("flex"),hm("column-reverse"),fm(Io(.25)),this.subMenu)),Ng(this.subMenu,this.settingsButton,this.muteCamButton,this.muteMicButton,this.muteEnvAudioButton,this.quitButton),this.settingsButton.addEventListener("click",async()=>{let e=this.screenControl.currentMode,t=this.renderer.xr.isPresenting;t&&await this.screenControl.stop(),await this.devicesDialog.showDialog(),t&&await this.screenControl.start(e)}),this.muteEnvAudioButton.addEventListener("click",()=>{this.muteEnvAudioButton.active=!this.muteEnvAudioButton.active,this.dispatchEvent(this.envAudioToggleEvt)}),this.quitButton.addEventListener("click",()=>this.withConfirmation("Confirm quit","Are you sure you want to quit?",async()=>{this.renderer.xr.isPresenting&&this.screenControl.stop(),await this.onQuitting()})),this.menuButton.addEventListener("click",()=>this.subMenu.visible=!this.subMenu.visible),[this.settingsButton,this.muteCamButton,this.muteMicButton,this.muteEnvAudioButton,this.quitButton].forEach(e=>e.addEventListener("click",()=>this.subMenu.visible=!1)),this.subMenu.visible=!1,this.vrButton.visible=Wr()&&lc()||yn(),this.arButton.visible=!1,this.muteCamButton.visible=!1,this.muteMicButton.visible=!1}layoutMenu(){let e=0;for(let t of this.subMenu.object.children)t.visible&&t.position.set(0,++e*.25,0)}preRender(e){super.preRender(e);let{worldPos:t,worldQuat:o}=this.avatar;if(this.audio.setUserPose(this.audio.localUserID,t.x,t.y,t.z,o.x,o.y,o.z,o.w),this.xrUI.visible=this.renderer.xr.isPresenting||this.testSpaceLayout,this.statsImage.isVisible=this.xrUI.visible&&this.DEBUG,this.renderer.xr.isPresenting||this.compassImage.setPitchAndHeading(Qi(this.avatar.worldPitchRadians),Qi(this.avatar.worldHeadingRadians)),this.layoutMenu(),this.DEBUG){let r=Math.round(e.fps);if(this.avgFPS+=r/100,this.fpses.push(r),this.fpses.length>100){let i=this.fpses.shift();this.avgFPS-=i/100}++this.countTick%100===0&&this.statsImage.image.setStats(this.avgFPS,this.renderer.info.render.calls,this.renderer.info.render.triangles)}this.confirmationDialog.update(e.dt)}get environmentAudioMuted(){return this.muteEnvAudioButton.active}async withConfirmation(e,t,o){this.onConfirmationShowing(!0),await this.confirmationDialog.prompt(e,t)&&o(),this.onConfirmationShowing(!1)}onConfirmationShowing(e){Hg(this.quitButton,!e),this.dispatchEvent(new Fh(e))}async load(e,...t){let o=null;Xo(e)?(t.push(e),o=this.loadingBar):o=e,Qt(this.renderer.domElement)&&te(this.renderer.domElement.parentElement,this.renderer.domElement,...this.screenUISpace.elements);let r=new $t("/audio/footsteps.mp3",vn,!this.DEBUG),i=new $t("/audio/basic_enter.mp3",vn,!this.DEBUG),s=new $t("/audio/basic_exit.mp3",vn,!this.DEBUG),a=new $t("/audio/basic_error.mp3",vn,!this.DEBUG),c=new $t("/audio/vintage_radio_button_pressed.mp3",vn,!this.DEBUG);t.push(...this.uiButtons.assets,r,i,s,a,c),g(this.watch)&&t.push(this.watch.asset),await super.load(o,...t),await dn(this.audio.createBasicClip("footsteps",r,.5),this.interactionAudio.create("enter",i,.25),this.interactionAudio.create("exit",s,.25),this.interactionAudio.create("error",a,.25),this.interactionAudio.create("click",c,1)),this.screenUISpace.show()}};function o1(n){let e=new se,t=setInterval(()=>{n()&&(clearInterval(t),e.resolve())},100);return e}var Ah=null;function r1(n){return Ah===null&&(Ah=new Audio),Ah.canPlayType(n)!==""}var fu=class{constructor(e,t,o,r=!1){this.fetcher=e,this.method=t,this.path=o,this.useBLOBs=r,this.prog=null,this.request={method:t,path:this.path.href,body:null,headers:null,timeout:null,withCredentials:!1,useCache:!1,retryCount:3}}retries(e){return this.request.retryCount=e,this}query(e,t){return this.path.searchParams.set(e,t),this.request.path=this.path.href,this}header(e,t){return this.request.headers===null&&(this.request.headers=new Map),this.request.headers.set(e.toLowerCase(),t),this}headers(e){for(let[t,o]of e.entries())this.header(t,o);return this}timeout(e){return this.request.timeout=e,this}progress(e){return this.prog=e,this}body(e,t){if(g(e)){let o=new Set,r=new Array;r.push(e);let i=!1;for(;!i&&r.length>0;){let s=r.shift();if(s&&!o.has(s))if(o.add(s),s instanceof Blob){i=!0;break}else X(s)||r.push(...Object.values(s))}if(i){let s=new FormData,a=new Map,c=new Set;for(let[p,m]of Object.entries(e))if(m instanceof Blob){let x=p+".name",w=e[x];X(w)&&(a.set(m,w),c.add(x))}for(let[p,m]of Object.entries(e))c.has(p)||(m instanceof Blob?s.append(p,m,a.get(m)):X(m)?s.append(p,m):g(m)&&Z(m.toString)?s.append(p,m.toString()):console.warn("Can't serialize value to formdata",p,m));e=s,t=void 0}this.request.body=e,this.content(t)}return this}withCredentials(){return this.request.withCredentials=!0,this}useCache(e=!0){return this.request.useCache=e,this}media(e,t){g(t)&&(X(t)||(t=t.value),this.header(e,t))}content(e){this.media("content-type",e)}accept(e){return this.media("accept",e),this}blob(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBlob(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBlob(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);xe(this.method)}buffer(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBuffer(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBuffer(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);xe(this.method)}async file(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return await this.fetcher.sendObjectGetFile(this.request,this.prog);if(this.method==="GET"){if(this.useBLOBs)return await this.fetcher.sendNothingGetFile(this.request,this.prog);{let t=await this.fetcher.sendNothingGetNothing(this.request);return Se(t,()=>this.request.path)}}else{if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);xe(this.method)}}text(e){if(this.accept(e||ua),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetText(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetText(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);xe(this.method)}object(e){if(this.accept(e||Nu),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetObject(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetObject(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);xe(this.method)}xml(e){if(this.accept(e||em),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetXml(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetXml(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);xe(this.method)}imageBitmap(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetImageBitmap(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetImageBitmap(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);xe(this.method)}exec(){if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetNothing(this.request,this.prog);if(this.method==="GET")throw new Error("GET requests should expect a response type");if(this.method==="HEAD"||this.method==="OPTIONS")return this.fetcher.sendNothingGetNothing(this.request);xe(this.method)}async audioBlob(e){if(g(e)&&(X(e)||(e=e.value),!r1(e)))throw new Error(`Probably can't play file of type "${e}" at path: ${this.request.path}`);let t=await this.blob(e);if(r1(t.contentType))return t;throw new Error(`Cannot play file of type "${t.contentType}" at path: ${this.request.path}`)}async audioBuffer(e,t){return Se(await this.audioBlob(t),async o=>await e.decodeAudioData(await o.arrayBuffer()))}async htmlElement(e,t,o){let r=await this.file(o),i=Ce(e,t,"error");return e instanceof HTMLLinkElement?e.href=r.content:e.src=r.content,await i,await Se(r,()=>e)}image(e){return this.htmlElement(kn(),"load",e)}async htmlCanvas(e){let t=Ho(1,1);if(this.method==="GET")if(Wo){this.accept(e);let o=await this.fetcher.drawImageToCanvas(this.request,t.transferControlToOffscreen(),this.prog);return await Se(o,()=>t)}else{let o=await this.image(e);return await Se(o,r=>(t.width=r.width,t.height=r.height,ba(t,r),ae(r),t))}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);xe(this.method)}}canvas(e){return Wo?this.offscreenCanvas(e):this.htmlCanvas(e)}async offscreenCanvas(e){if(!Wo)throw new Error("This system does not support OffscreenCanvas");if(this.method==="GET"){let t=await this.image(e);return await Se(t,o=>{let r=Xi(o.width,o.height);return ba(r,o),ae(o),r})}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);xe(this.method)}}async style(){let e=Wm(zn(Ii),ju("stylesheet"));document.head.append(e);let t=await this.htmlElement(e,"load",Ii);return Se(t)}async getScript(){let e=Nm(zn(Nn));document.head.append(e);let t=await this.htmlElement(e,"load",Nn);return Se(t)}async script(e){let t=null,o=this.request.path;if(!e)t=await this.getScript();else if(!e()){let r=o1(e);t=await this.getScript(),await r}return this.prog&&this.prog.end(o),t}async module(){let e=this.request.path,t=await this.file(Nn),o=await import(t.content);return this.prog&&this.prog.end(e),Se(t,()=>o)}async wasm(e){let t=await this.buffer(Uu);if(!Uu.matches(t.contentType))throw new Error(`Server did not respond with WASM file. Was: ${t.contentType}`);let o=await WebAssembly.compile(t.content),r=await WebAssembly.instantiate(o,e);return Se(t,()=>r.exports)}async worker(e="module"){let t=this.request.path,o=await this.file(Nn);this.prog=null,this.request.timeout=null;let r=new Worker(o.content,{type:e});return this.prog&&this.prog.end(t),Se(o,()=>r)}};var xu=class{constructor(e,t=!1){this.service=e,this.useBLOBs=t;{let o=Dm("input[name=__RequestVerificationToken]");o&&this.service.setRequestVerificationToken(o.value)}}clearCache(){return this.service.clearCache()}evict(e,t){return this.service.evict(new URL(e,t||location.href).href)}request(e,t,o){return new fu(this.service,e,new URL(t,o||location.href),this.useBLOBs)}head(e,t){return this.request("HEAD",e,t)}options(e,t){return this.request("OPTIONS",e,t)}get(e,t){return this.request("GET",e,t)}post(e,t){return this.request("POST",e,t)}put(e,t){return this.request("PUT",e,t)}patch(e,t){return this.request("PATCH",e,t)}delete(e,t){return this.request("DELETE",e,t)}async assets(e,t,...o){L(o)&&(o=[]),o.unshift(t);let r;Xo(e)?o.unshift(e):g(e)&&(r=e),o=o.filter(g);let i=await Promise.all(o.map(a=>a.getSize(this))),s=new Map(i);await Wu(r,o.map(a=>[s.get(a),c=>a.fetch(this,c)]))}};var gu=class{constructor(e){this.impl=e,this.defaultPostHeaders=new Map}setRequestVerificationToken(e){this.defaultPostHeaders.set("RequestVerificationToken",e)}clearCache(){return this.impl.clearCache()}evict(e){return this.impl.evict(e)}sendNothingGetNothing(e){return this.impl.sendNothingGetNothing(e)}sendNothingGetBlob(e,t){return this.impl.sendNothingGetSomething("blob",e,t)}sendObjectGetBlob(e,t){return this.impl.sendSomethingGetSomething("blob",e,this.defaultPostHeaders,t)}sendNothingGetBuffer(e,t){return this.impl.sendNothingGetSomething("arraybuffer",e,t)}sendObjectGetBuffer(e,t){return this.impl.sendSomethingGetSomething("arraybuffer",e,this.defaultPostHeaders,t)}sendNothingGetText(e,t){return this.impl.sendNothingGetSomething("text",e,t)}sendObjectGetText(e,t){return this.impl.sendSomethingGetSomething("text",e,this.defaultPostHeaders,t)}sendNothingGetObject(e,t){return this.impl.sendNothingGetSomething("json",e,t)}sendObjectGetObject(e,t){return this.impl.sendSomethingGetSomething("json",e,this.defaultPostHeaders,t)}sendObjectGetNothing(e,t){return this.impl.sendSomethingGetSomething("",e,this.defaultPostHeaders,t)}drawImageToCanvas(e,t,o){return this.impl.drawImageToCanvas(e,t,o)}async sendNothingGetFile(e,t){return Se(await this.sendNothingGetBlob(e,t),URL.createObjectURL)}async sendObjectGetFile(e,t){return Se(await this.sendObjectGetBlob(e,t),URL.createObjectURL)}async sendNothingGetXml(e,t){return Se(await this.impl.sendNothingGetSomething("document",e,t),o=>o.documentElement)}async sendObjectGetXml(e,t){return Se(await this.impl.sendSomethingGetSomething("document",e,this.defaultPostHeaders,t),o=>o.documentElement)}async sendNothingGetImageBitmap(e,t){return Se(await this.sendNothingGetBlob(e,t),createImageBitmap)}async sendObjectGetImageBitmap(e,t){return Se(await this.sendObjectGetBlob(e,t),createImageBitmap)}};var wu=class n{static delete(e){let t=indexedDB.deleteDatabase(e),o=Ce(t,"success","error","blocked");return rn(o)}static async open(e,...t){let o=Fi(t,V=>V.name),r=new St(t.filter(V=>g(V.indexes)).flatMap(V=>V.indexes.map(P=>[V.name,P.name,P]))),i=new Array,s=new Array,a=new Array,c=new wt,p=new wt,m=null,x=indexedDB.open(e);if(await rn(Ce(x,"success","error","blocked"))){let V=x.result;m=V.version;let P=new Array;for(let C of V.objectStoreNames)o.has(C)||s.push(C);for(let C of o.keys())V.objectStoreNames.contains(C)?P.push(C):i.push(C);if(P.length>0){let C=V.transaction(P),H=Ce(C,"complete","error","abort"),B=rn(H);for(let R of P){let q=C.objectStore(R),Y=o.get(R);g(Y.options)&&q.keyPath!==Y.options.keyPath&&(s.push(R),i.push(R));for(let K of q.indexNames)r.has(R,K)||(a.indexOf(R)===-1&&a.push(R),p.add(R,K));if(r.has(R))for(let K of r.get(R).keys())if(!q.indexNames.contains(K))a.indexOf(R)===-1&&a.push(R),c.add(R,K);else{let ee=r.get(R,K),me=q.index(K);(X(ee.keyPath)!==X(me.keyPath)||X(ee.keyPath)&&X(me.keyPath)&&ee.keyPath!==me.keyPath||nt(ee.keyPath)&&nt(me.keyPath)&&ca(ee.keyPath,me.keyPath))&&(a.indexOf(R)===-1&&a.push(R),p.add(R,K),c.add(R,K))}}C.commit(),await B}ae(V)}else{m=0,i.push(...o.keys());for(let V of t)if(g(V.indexes))for(let P of V.indexes)c.add(V.name,P.name)}(i.length>0||s.length>0||c.size>0||p.size>0)&&++m;let w=new se,_=g(m)?indexedDB.open(e,m):indexedDB.open(e),T=Ce(_,"success","error","blocked"),y=rn(w),b=rn(T),I=w.resolver(!1);if(_.addEventListener("success",I),_.addEventListener("upgradeneeded",()=>{let V=Ce(_.transaction,"complete","error","abort"),P=_.result;for(let H of s)P.deleteObjectStore(H);let C=new Map;for(let H of i){let B=o.get(H),R=P.createObjectStore(H,B.options);C.set(H,R)}for(let H of a){let B=_.transaction.objectStore(H);C.set(H,B)}for(let[H,B]of C){for(let R of p.get(H))B.deleteIndex(R);for(let R of c.get(H)){let q=r.get(H,R);B.createIndex(R,q.keyPath,q.options)}}rn(V).then(w.resolve).catch(w.reject).finally(()=>_.removeEventListener("success",I))}),!await y)throw w.error;if(!await b)throw T.error;return new n(_.result)}constructor(e){this.db=e}dispose(){ae(this.db)}get name(){return this.db.name}get version(){return this.db.version}get storeNames(){return Array.from(this.db.objectStoreNames)}getStore(e){return new _h(this.db,e)}},_h=class{constructor(e,t){this.db=e,this.storeName=t}async request(e,t){let o=this.db.transaction(this.storeName,t),r=Ce(o,"complete","error"),i=o.objectStore(this.storeName),s=e(i),a=Ce(s,"success","error");if(!await rn(a))throw o.abort(),a.error;if(o.commit(),!await rn(r))throw r.error;return s.result}add(e,t){return this.request(o=>o.add(e,t),"readwrite")}clear(){return this.request(e=>e.clear(),"readwrite")}getCount(e){return this.request(t=>t.count(e),"readonly")}async has(e){return await this.getCount(e)>0}delete(e){return this.request(t=>t.delete(e),"readwrite")}get(e){return this.request(t=>t.get(e),"readonly")}getAll(){return this.request(e=>e.getAll(),"readonly")}getAllKeys(){return this.request(e=>e.getAllKeys(),"readonly")}getKey(e){return this.request(t=>t.getKey(e),"readonly")}openCursor(e,t){return this.request(o=>o.openCursor(e,t),"readonly")}openKeyCursor(e,t){return this.request(o=>o.openKeyCursor(e,t),"readonly")}put(e,t){return this.request(o=>o.put(e,t),"readwrite")}};function i1(n,...e){for(let t of e)if(g(t))for(let[o,r]of t)n.set(o,r);return n}var vh=class extends se{constructor(e){super(!1),this.milliseconds=e,this._timer=null}start(){super.start(),this._timer=setTimeout(()=>{this._timer=null,this.resolve()},this.milliseconds)}reset(){super.reset(),g(this._timer)&&(clearTimeout(this._timer),this._timer=null)}};function s1(n){let e=new vh(n);return e.start(),e}function Fu(n,e){return async()=>{let t=null,o=500;for(let r=0;r<=n;++r)try{return r>0&&(await s1(o),o*=2),await e()}catch(i){t=i}throw t}}function sv(n){return X(n)||Ph(n)||n instanceof Blob||n instanceof FormData||Vh(n)||"Document"in globalThis&&n instanceof Document}function Au(n,e,t,o,r,i){let s=!i;i&&i.then(()=>s=!0);let a=!1,c=r,p=new se;t.addEventListener("loadstart",()=>{s&&!a&&o&&o.start(n)}),t.addEventListener("progress",x=>{if(s&&!a){let w=x;o&&o.report(w.loaded,Math.max(w.loaded,w.total),n),w.loaded===w.total&&(c=!0,a&&p.resolve())}}),t.addEventListener("load",()=>{s&&!a&&(o&&o.end(n),a=!0,c&&p.resolve())});let m=x=>()=>{s&&p.reject(`${x} (${e.status})`)};return t.addEventListener("error",m("error")),t.addEventListener("abort",m("abort")),t.addEventListener("timeout",m("timeout")),p}function Sh(n,e,t,o,r,i){if(n.open(e,t),n.responseType="blob",n.timeout=o,r)for(let[s,a]of r)n.setRequestHeader(s,a);g(i)?n.send(i):n.send()}function _u(n,e,t){if(!n.has(e))return null;let o=n.get(e);try{let r=t(o);return n.delete(e),r}catch(r){console.warn(e,r)}return null}var av=/filename=\"(.+)\"(;|$)/,cv="Juniper:Fetcher:Cache",vu=class{constructor(){this.cache=null,this.store=null,this.tasks=new St,this.cacheReady=this.openCache()}async drawImageToCanvas(e,t,o){let r=await this.sendNothingGetSomething("blob",e,o),i=r.content;return nm(await createImageBitmap(i,{imageOrientation:"from-image"}),s=>(t.width=s.width,t.height=s.height,t.getContext("2d").drawImage(s,0,0),Se(r)))}async openCache(){let e={keyPath:"requestPath"};this.cache=await wu.open(cv,{name:"files",options:e}),this.store=await this.cache.getStore("files")}async clearCache(){await this.cacheReady,await this.store.clear()}async evict(e){await this.cacheReady,this.store.has(e)&&await this.store.delete(e)}async readResponseHeaders(e,t){let o=t.getAllResponseHeaders().split(/[\r\n]+/).map(w=>w.trim()).filter(w=>w.length>0).map(w=>{let _=w.split(": "),T=_.shift().toLowerCase(),y=_.join(": ");return[T,y]}),r=new wt(o),i=Array.from(r.keys()).map(w=>[w,r.get(w).join(", ")]),s=new Map(i),a=_u(s,"content-type",Vt),c=_u(s,"content-length",parseFloat),p=_u(s,"date",w=>new Date(w)),m=_u(s,"content-disposition",w=>{if(g(w)){let _=w.match(av);if(g(_))return _[1]}return null});return{status:t.status,requestPath:e,responsePath:t.responseURL,content:void 0,contentType:a,contentLength:c,fileName:m,date:p,headers:s}}async readResponse(e,t){let{responsePath:o,status:r,contentType:i,contentLength:s,fileName:a,date:c,headers:p}=await this.readResponseHeaders(e,t),m={requestPath:e,responsePath:o,status:r,contentType:i,contentLength:s,fileName:a,date:c,headers:p,content:t.response};return g(m.content)&&(m.contentType=m.contentType||m.content.type,m.contentLength=m.contentLength||m.content.size),m}async decodeContent(e,t){return Se(t,async o=>{if(e==="")return null;if(L(t.contentType)){let r=Array.from(t.headers.entries()).map(i=>i.join(": ")).join(`
  `);throw new Error(`No content type found in headers: 
  `+r)}else{if(e==="blob")return o;if(e==="arraybuffer")return await o.arrayBuffer();if(e==="json"){let r=await o.text();return r.length>0?JSON.parse(r):null}else if(e==="document"){let r=new DOMParser;if(t.contentType==="application/xhtml+xml"||t.contentType==="text/html"||t.contentType==="application/xml"||t.contentType==="image/svg+xml"||t.contentType==="text/xml")return r.parseFromString(await o.text(),t.contentType);throw new Error("Couldn't parse document")}else{if(e==="text")return await o.text();xe(e)}}})}async withCachedTask(e,t){return e.method!=="GET"&&e.method!=="HEAD"&&e.method!=="OPTIONS"?await t():(this.tasks.has(e.method,e.path)||this.tasks.add(e.method,e.path,t().finally(()=>this.tasks.delete(e.method,e.path))),this.tasks.get(e.method,e.path))}sendNothingGetNothing(e){return this.withCachedTask(e,Fu(e.retryCount,async()=>{let t=new XMLHttpRequest,o=Au(`requesting: ${e.path}`,t,t,null,!0);return Sh(t,e.method,e.path,e.timeout,e.headers),await o,await this.readResponseHeaders(e.path,t)}))}sendNothingGetSomething(e,t,o){return this.withCachedTask(t,Fu(t.retryCount,async()=>{let r=null,i=t.useCache&&t.method==="GET";i&&(g(o)&&o.start(),await this.cacheReady,r=await this.store.get(t.path));let s=L(r);if(s){let c=new XMLHttpRequest,p=Au(`requesting: ${t.path}`,c,c,o,!0);Sh(c,t.method,t.path,t.timeout,t.headers),await p,r=await this.readResponse(t.path,c),i&&await this.store.add(r)}let a=await this.decodeContent(e,r);return s&&g(o)&&o.end(),a}))}sendSomethingGetSomething(e,t,o,r){let i=null,s=i1(new Map,o,t.headers),a=null;if(g(s)){let _=new Array;for(let T of s.keys())T.toLowerCase()==="content-type"&&_.push(T);if(_.length>0){t.body instanceof FormData||(a=s.get(_[0]),_.shift());for(let T of _)s.delete(T)}}sv(t.body)&&!X(t.body)||X(t.body)&&ua.matches(a)?i=t.body:g(t.body)&&(i=JSON.stringify(t.body));let c=g(i),p=zh(r,c?2:1),[m,x]=p,w=async()=>{let _=new XMLHttpRequest,T=c?Au("uploading",_,_.upload,m,!1):Promise.resolve(),y=Au("saving",_,_,x,!0,T);Sh(_,t.method,t.path,t.timeout,s,i),await T,await y;let b=await this.readResponse(t.path,_);return await this.decodeContent(e,b)};return Fu(t.retryCount,w)()}};function Th(n){return g(n)&&Z(n.report)&&Z(n.attach)&&Z(n.end)}var ta=class extends oe{constructor(e){super(),this.worker=e,this.invocations=new Map,this.tasks=new Array,this.taskCounter=0,yp||console.warn("Workers are not supported on this system."),this.worker.addEventListener("message",t=>{let o=t.data;switch(o.type){case"event":this.propogateEvent(o);break;case"progress":this.progressReport(o);break;case"return":this.methodReturned(o);break;case"error":this.invocationError(o);break;default:xe(o)}})}postMessage(e,t){e.type!=="methodCall"&&xe(e.type),t?this.worker.postMessage(e,t):this.worker.postMessage(e)}dispose(){this.worker.terminate()}progressReport(e){let t=this.invocations.get(e.taskID);if(t){let{prog:o}=t;o&&o.report(e.soFar,e.total,e.msg,e.est)}}methodReturned(e){let t=this.removeInvocation(e.taskID),{task:o}=t;o.resolve(e.returnValue)}invocationError(e){let t=this.removeInvocation(e.taskID),{task:o,methodName:r}=t;o.reject(new Error(`${r} failed. Reason: ${e.errorMessage}`))}removeInvocation(e){let t=this.invocations.get(e);return this.invocations.delete(e),t}callMethod(e,t,o,r){if(!yp)return Promise.reject(new Error("Workers are not supported on this system."));let i=null,s=null;Th(t)&&(r=t,t=null,o=null),Th(o)&&!r&&(r=o,o=null),nt(t)&&(i=t),nt(o)&&(s=o);let a=this.taskCounter++,c=pt(this.tasks,x=>x.finished);c?c.reset():(c=new se,this.tasks.push(c));let p={methodName:e,task:c,prog:r};this.invocations.set(a,p);let m=null;return g(t)?m={type:"methodCall",taskID:a,methodName:e,params:i}:m={type:"methodCall",taskID:a,methodName:e},this.postMessage(m,s),c}};var na=class extends oe{constructor(e,t){super(),this.scriptPath=e.scriptPath;let o=-1,r=e.workers,i=null;if(fe(r)?o=r:g(r)?(this.taskCounter=r.curTaskCounter,i=r.workers,o=i.length):o=navigator.hardwareConcurrency||4,o<1)throw new Error("Worker pool size must be a postive integer greater than 0");if(this.workers=new Array(o),L(i)){this.taskCounter=0;for(let s=0;s<o;++s)this.workers[s]=new t(new Worker(this.scriptPath,{type:"module"}))}else for(let s=0;s<o;++s)this.workers[s]=new t(i[s]);for(let s of this.workers)s.addBubbler(this)}dispose(){this.workers.forEach(ae),de(this.workers)}nextWorker(){let e=this.peekWorker();return this.taskCounter++,e}peekWorker(){return this.workers[this.taskCounter%this.workers.length]}};var a1=new URL(globalThis.location.href),gr=a1.searchParams.has("DEBUG")&&!a1.searchParams.has("RELEASE");var c1="3.7.24";var uv=gr?ht(10):c1;var l1=!1;var pv=50,dv=12,pX=pv*dv;var hv={images:{backButton:"/images/back-button.jpg",defaultButton:"/images/back-button.jpg",title:"/images/menu-title.jpg",logo:{back:"/images/main-logo.png"}},font:{fontFamily:"Lato",fontSize:20,fontWeight:"bold"}},oa={fontFamily:"Lato",fontSize:20},mv={fontFamily:"Segoe UI Emoji",fontSize:20};async function u1(){await dn(Yc(oa),Yc(mv),Yc(hv.font))}var p1=mt(30,67,136),d1=mt(78,77,77),h1={fontFamily:oa.fontFamily,fontSize:oa.fontSize,textFillColor:"white"},dX=Object.assign({},h1,{bgFillColor:mt(0,120,215),bgStrokeColor:"black",bgStrokeSize:.02,padding:{top:.025,left:.05,bottom:.025,right:.05},minHeight:.2,maxHeight:.2,scale:300}),hX=Object.assign({},h1,{textStrokeColor:"black",textStrokeSize:.01,minHeight:.25,maxHeight:.25});function m1(){let n=new wt([["arrow","arrow-up"],["arrow","arrow-down"],["arrow","arrow-left"],["arrow","arrow-right"],["chat","user"],["chat","chat"],["ui","menu"],["ui","settings"],["ui","quit"],["ui","lobby"],["zoom","zoom-in"],["zoom","zoom-out"],["zoom","zoom-info"],["environment-audio","environment-audio-mute"],["environment-audio","environment-audio-unmute"],["headphones","headphones-unmuted"],["headphones","headphones-muted"],["microphone","microphone-mute"],["microphone","microphone-unmute"],["volume","volume-muted"],["volume","volume-low"],["volume","volume-medium"],["volume","volume-high"],["media","media-pause"],["media","media-play"],["media","media-stop"],["media","media-replay"],["ar","ar-enter"],["ar","ar-exit"],["vr","vr-enter"],["vr","vr-exit"],["fullscreen","fullscreen-enter"],["fullscreen","fullscreen-exit"]]),e=new St;for(let[t,o]of n.entries())for(let r of o)e.add(t,r.replace(t+"-",""),`/images/ui/${r}.png`);return e}var fv=gr?".js":".min.js";function xv(n,e){return`/js/${e}/index${n}?v=${uv}`}function kh(n){return xv(fv,n)}function f1(n){return kh("vr-apps/"+n)}function x1(n){return kh("workers/"+n)}function g1(n){return kh("libs/"+n)}function Su(n=!0){let e=new gu(new vu);return new xu(e,!gr)}Ta(ga("#appContainer, #frontBuffer",Sm("relative")));async function w1(){let n=Sr(Lo("frontBuffer")),e=ge(Lo("appContainer"),n);te("main",e),await u1();let t=Su(!1),o=new mu({canvas:n,fetcher:t,dialogFontFamily:oa.fontFamily,getAppUrl:f1,uiImagePaths:m1(),buttonFillColor:p1,labelFillColor:d1,enableFullResolution:l1,DEBUG:gr,watchModelPath:"/models/watch1.glb"});return e.style.display="none",await Nx("main",o.audio),e.style.display="",o}var Mh=class extends Qo{constructor(){super("Cancellation!")}},Tu=class{constructor(){this._cancelled=!1}get cancelled(){return this._cancelled}check(){if(this.cancelled)throw new Mh}cancel(){this._cancelled=!0}};function F1(n,e,t,o){return`/Editor/Google/StreetView/Image/${n}/${e}/${t}/${o}/`}var ku=class extends oc{constructor(e){super(e,!0)}loadFiles(e,t,o){return this.renderFaces(F1.bind(null,e),t,o)}loadFile(e,t,o){return this.renderCubeMap(F1.bind(null,e),t,o)}async loadImages(e,t,o){let r=await this.loadFiles(e,t,o);return await Promise.all(r.map(Mr))}async loadCanvas(e,t,o){let r=await this.loadFile(e,t,o),i=await Mr(r);return Ea(i)}};var Mu=class extends ta{canvases;init(e,t){this.callMethod("init",[e,t])}propogateEvent(e){xe(e.eventName)}loadFiles(e,t,o){return this.callMethod("loadFiles",[e,t],o)}loadFile(e,t,o){return this.callMethod("loadFile",[e,t],o)}async loadImages(e,t,o){let r=await this.loadFiles(e,t,o);return await Promise.all(r.map(Mr))}async loadCanvas(e,t,o){let r=await this.loadFile(e,t,o),i=await Mr(r);return Ea(i)}};var bu=class extends na{constructor(e,t){e.workers!==1&&(e.workers=1),super(e,t)}get canvases(){return this.peekWorker().canvases}init(e,t){for(let o of this.workers)o.init(e,t)}loadImages(e,t,o){return this.nextWorker().loadImages(e,t,o)}loadCanvas(e,t,o){return this.nextWorker().loadCanvas(e,t,o)}};async function A1(n,e,t){let o=null;if(Pt(e)?t=e:o=e,o=o||new Tu,!ac()&&t){let r=await n.get(g1("three")).text().then(dt);o.check();let i=await n.get(x1("photosphere-capture")).text().then(dt);o.check();let s=r+i,a=new Blob([s],{type:Nn.value}),c=URL.createObjectURL(a);return new bu({scriptPath:c},Mu)}else return n=n||Su(!1),new ku(n)}(async function(){let n=await w1();await n.fadeOut();let e=await A1(n.fetcher);e.init(location.href,!0);async function t(o){let i=(await n.fetcher.get("/editor/photospheres").object().then(dt)).map(c=>c.pano_id),s=Hh(i),a=await e.loadImages(s,En.Low,o);n.skybox.setImages(s+"_low",a),n.fadeIn(),a=await e.loadImages(s,En.High,o),n.skybox.setImages(s,a)}await la(n.loadingBar,o=>n.load(o),t)})();
