var yl=Object.create;var oo=Object.defineProperty;var El=Object.getOwnPropertyDescriptor;var Cl=Object.getOwnPropertyNames;var Ml=Object.getPrototypeOf,Dl=Object.prototype.hasOwnProperty;var Pl=(o,t,e)=>t in o?oo(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var hr=(o=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(o,{get:(t,e)=>(typeof require<"u"?require:t)[e]}):o)(function(o){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+o+'" is not supported')});var Qt=(o,t)=>()=>(t||o((t={exports:{}}).exports,t),t.exports),yi=(o,t)=>{for(var e in t)oo(o,e,{get:t[e],enumerable:!0})},Ll=(o,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Cl(t))!Dl.call(o,r)&&r!==e&&oo(o,r,{get:()=>t[r],enumerable:!(n=El(t,r))||n.enumerable});return o};var Bl=(o,t,e)=>(e=o!=null?yl(Ml(o)):{},Ll(t||!o||!o.__esModule?oo(e,"default",{value:o,enumerable:!0}):e,o));var We=(o,t,e)=>(Pl(o,typeof t!="symbol"?t+"":t,e),e),mr=(o,t,e)=>{if(!t.has(o))throw TypeError("Cannot "+e)};var B=(o,t,e)=>(mr(o,t,"read from private field"),e?e.call(o):t.get(o)),le=(o,t,e)=>{if(t.has(o))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(o):t.set(o,e)},xe=(o,t,e,n)=>(mr(o,t,"write to private field"),n?n.call(o,e):t.set(o,e),e),gr=(o,t,e,n)=>({set _(r){xe(o,t,r,e)},get _(){return B(o,t,n)}}),ue=(o,t,e)=>(mr(o,t,"access private method"),e);var Lr=Qt(()=>{});var Es=Qt(()=>{});var Cs=Qt(()=>{});var Ms=Qt(()=>{});var Ds=Qt(()=>{});var Ps=Qt(()=>{});var Zs=Qt((exports,module)=>{(function(t,e){typeof exports=="object"&&typeof module=="object"?module.exports=e():typeof define=="function"&&define.amd?define("pdfjs-dist/build/pdf",[],e):typeof exports=="object"?exports["pdfjs-dist/build/pdf"]=e():t["pdfjs-dist/build/pdf"]=t.pdfjsLib=e()})(globalThis,()=>(()=>{"use strict";var __webpack_modules__=[,(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VerbosityLevel=t.Util=t.UnknownErrorException=t.UnexpectedResponseException=t.UNSUPPORTED_FEATURES=t.TextRenderingMode=t.StreamType=t.RenderingIntentFlag=t.PermissionFlag=t.PasswordResponses=t.PasswordException=t.PageActionEventType=t.OPS=t.MissingPDFException=t.LINE_FACTOR=t.LINE_DESCENT_FACTOR=t.InvalidPDFException=t.ImageKind=t.IDENTITY_MATRIX=t.FormatError=t.FontType=t.FeatureTest=t.FONT_IDENTITY_MATRIX=t.DocumentActionEventType=t.CMapCompressionType=t.BaseException=t.AnnotationType=t.AnnotationStateModelType=t.AnnotationReviewState=t.AnnotationReplyType=t.AnnotationMode=t.AnnotationMarkedState=t.AnnotationFlag=t.AnnotationFieldFlag=t.AnnotationEditorType=t.AnnotationEditorPrefix=t.AnnotationEditorParamsType=t.AnnotationBorderStyleType=t.AnnotationActionEventType=t.AbortException=void 0,t.arrayByteLength=ee,t.arraysToBytes=ge,t.assert=x,t.bytesToString=O,t.createPromiseCapability=he,t.createValidAbsoluteUrl=L,t.escapeString=Me,t.getModificationDate=ae,t.getVerbosityLevel=re,t.info=pe,t.isArrayBuffer=je,t.isArrayEqual=no,t.isAscii=nt,t.objectFromMap=se,t.objectSize=oe,t.setVerbosityLevel=q,t.shadow=I,t.string32=te,t.stringToBytes=X,t.stringToPDFString=ke,t.stringToUTF16BEString=Ie,t.stringToUTF8String=Nt,t.unreachable=H,t.utf8StringToString=Ee,t.warn=we,e(2);let n=[1,0,0,1,0,0];t.IDENTITY_MATRIX=n;let r=[.001,0,0,.001,0,0];t.FONT_IDENTITY_MATRIX=r;let a=1.35;t.LINE_FACTOR=a;let d=.35;t.LINE_DESCENT_FACTOR=d;let S={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};t.RenderingIntentFlag=S;let b={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};t.AnnotationMode=b;let m="pdfjs_internal_editor_";t.AnnotationEditorPrefix=m;let A={DISABLE:-1,NONE:0,FREETEXT:3,INK:15};t.AnnotationEditorType=A;let C={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13};t.AnnotationEditorParamsType=C;let _={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};t.PermissionFlag=_;let F={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};t.TextRenderingMode=F;let i={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};t.ImageKind=i;let l={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};t.AnnotationType=l;let s={MARKED:"Marked",REVIEW:"Review"};t.AnnotationStateModelType=s;let v={MARKED:"Marked",UNMARKED:"Unmarked"};t.AnnotationMarkedState=v;let k={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"};t.AnnotationReviewState=k;let y={GROUP:"Group",REPLY:"R"};t.AnnotationReplyType=y;let h={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};t.AnnotationFlag=h;let c={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};t.AnnotationFieldFlag=c;let u={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};t.AnnotationBorderStyleType=u;let f={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};t.AnnotationActionEventType=f;let M={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};t.DocumentActionEventType=M;let E={O:"PageOpen",C:"PageClose"};t.PageActionEventType=E;let w={UNKNOWN:"UNKNOWN",FLATE:"FLATE",LZW:"LZW",DCT:"DCT",JPX:"JPX",JBIG:"JBIG",A85:"A85",AHX:"AHX",CCF:"CCF",RLX:"RLX"};t.StreamType=w;let P={UNKNOWN:"UNKNOWN",TYPE1:"TYPE1",TYPE1STANDARD:"TYPE1STANDARD",TYPE1C:"TYPE1C",CIDFONTTYPE0:"CIDFONTTYPE0",CIDFONTTYPE0C:"CIDFONTTYPE0C",TRUETYPE:"TRUETYPE",CIDFONTTYPE2:"CIDFONTTYPE2",TYPE3:"TYPE3",OPENTYPE:"OPENTYPE",TYPE0:"TYPE0",MMTYPE1:"MMTYPE1"};t.FontType=P;let ne={ERRORS:0,WARNINGS:1,INFOS:5};t.VerbosityLevel=ne;let ie={NONE:0,BINARY:1,STREAM:2};t.CMapCompressionType=ie;let Z={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};t.OPS=Z;let Y={unknown:"unknown",forms:"forms",javaScript:"javaScript",signatures:"signatures",smask:"smask",shadingPattern:"shadingPattern",font:"font",errorTilingPattern:"errorTilingPattern",errorExtGState:"errorExtGState",errorXObject:"errorXObject",errorFontLoadType3:"errorFontLoadType3",errorFontState:"errorFontState",errorFontMissing:"errorFontMissing",errorFontTranslate:"errorFontTranslate",errorColorSpace:"errorColorSpace",errorOperatorList:"errorOperatorList",errorFontToUnicode:"errorFontToUnicode",errorFontLoadNative:"errorFontLoadNative",errorFontBuildPath:"errorFontBuildPath",errorFontGetPath:"errorFontGetPath",errorMarkedContent:"errorMarkedContent",errorContentSubStream:"errorContentSubStream"};t.UNSUPPORTED_FEATURES=Y;let j={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};t.PasswordResponses=j;let U=ne.WARNINGS;function q(Q){Number.isInteger(Q)&&(U=Q)}function re(){return U}function pe(Q){U>=ne.INFOS&&console.log(`Info: ${Q}`)}function we(Q){U>=ne.WARNINGS&&console.log(`Warning: ${Q}`)}function H(Q){throw new Error(Q)}function x(Q,G){Q||H(G)}function g(Q){if(!Q)return!1;switch(Q.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function L(Q,G=null,z=null){if(!Q)return null;try{if(z&&typeof Q=="string"){if(z.addDefaultProtocol&&Q.startsWith("www.")){let Fe=Q.match(/\./g);Fe&&Fe.length>=2&&(Q=`http://${Q}`)}if(z.tryConvertEncoding)try{Q=Nt(Q)}catch{}}let me=G?new URL(Q,G):new URL(Q);if(g(me))return me}catch{}return null}function I(Q,G,z){return Object.defineProperty(Q,G,{value:z,enumerable:!0,configurable:!0,writable:!1}),z}let V=function(){function G(z,me){this.constructor===G&&H("Cannot initialize BaseException."),this.message=z,this.name=me}return G.prototype=new Error,G.constructor=G,G}();t.BaseException=V;class N extends V{constructor(G,z){super(G,"PasswordException"),this.code=z}}t.PasswordException=N;class K extends V{constructor(G,z){super(G,"UnknownErrorException"),this.details=z}}t.UnknownErrorException=K;class J extends V{constructor(G){super(G,"InvalidPDFException")}}t.InvalidPDFException=J;class p extends V{constructor(G){super(G,"MissingPDFException")}}t.MissingPDFException=p;class T extends V{constructor(G,z){super(G,"UnexpectedResponseException"),this.status=z}}t.UnexpectedResponseException=T;class D extends V{constructor(G){super(G,"FormatError")}}t.FormatError=D;class R extends V{constructor(G){super(G,"AbortException")}}t.AbortException=R;function O(Q){(typeof Q!="object"||Q===null||Q.length===void 0)&&H("Invalid argument for bytesToString");let G=Q.length,z=8192;if(G<z)return String.fromCharCode.apply(null,Q);let me=[];for(let Fe=0;Fe<G;Fe+=z){let _e=Math.min(Fe+z,G),Ae=Q.subarray(Fe,_e);me.push(String.fromCharCode.apply(null,Ae))}return me.join("")}function X(Q){typeof Q!="string"&&H("Invalid argument for stringToBytes");let G=Q.length,z=new Uint8Array(G);for(let me=0;me<G;++me)z[me]=Q.charCodeAt(me)&255;return z}function ee(Q){if(Q.length!==void 0)return Q.length;if(Q.byteLength!==void 0)return Q.byteLength;H("Invalid argument for arrayByteLength")}function ge(Q){let G=Q.length;if(G===1&&Q[0]instanceof Uint8Array)return Q[0];let z=0;for(let _e=0;_e<G;_e++)z+=ee(Q[_e]);let me=0,Fe=new Uint8Array(z);for(let _e=0;_e<G;_e++){let Ae=Q[_e];Ae instanceof Uint8Array||(typeof Ae=="string"?Ae=X(Ae):Ae=new Uint8Array(Ae));let Ce=Ae.byteLength;Fe.set(Ae,me),me+=Ce}return Fe}function te(Q){return String.fromCharCode(Q>>24&255,Q>>16&255,Q>>8&255,Q&255)}function oe(Q){return Object.keys(Q).length}function se(Q){let G=Object.create(null);for(let[z,me]of Q)G[z]=me;return G}function ce(){let Q=new Uint8Array(4);return Q[0]=1,new Uint32Array(Q.buffer,0,1)[0]===1}function fe(){try{return new Function(""),!0}catch{return!1}}class W{static get isLittleEndian(){return I(this,"isLittleEndian",ce())}static get isEvalSupported(){return I(this,"isEvalSupported",fe())}static get isOffscreenCanvasSupported(){return I(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}}t.FeatureTest=W;let de=[...Array(256).keys()].map(Q=>Q.toString(16).padStart(2,"0"));class be{static makeHexColor(G,z,me){return`#${de[G]}${de[z]}${de[me]}`}static scaleMinMax(G,z){let me;G[0]?(G[0]<0&&(me=z[0],z[0]=z[1],z[1]=me),z[0]*=G[0],z[1]*=G[0],G[3]<0&&(me=z[2],z[2]=z[3],z[3]=me),z[2]*=G[3],z[3]*=G[3]):(me=z[0],z[0]=z[2],z[2]=me,me=z[1],z[1]=z[3],z[3]=me,G[1]<0&&(me=z[2],z[2]=z[3],z[3]=me),z[2]*=G[1],z[3]*=G[1],G[2]<0&&(me=z[0],z[0]=z[1],z[1]=me),z[0]*=G[2],z[1]*=G[2]),z[0]+=G[4],z[1]+=G[4],z[2]+=G[5],z[3]+=G[5]}static transform(G,z){return[G[0]*z[0]+G[2]*z[1],G[1]*z[0]+G[3]*z[1],G[0]*z[2]+G[2]*z[3],G[1]*z[2]+G[3]*z[3],G[0]*z[4]+G[2]*z[5]+G[4],G[1]*z[4]+G[3]*z[5]+G[5]]}static applyTransform(G,z){let me=G[0]*z[0]+G[1]*z[2]+z[4],Fe=G[0]*z[1]+G[1]*z[3]+z[5];return[me,Fe]}static applyInverseTransform(G,z){let me=z[0]*z[3]-z[1]*z[2],Fe=(G[0]*z[3]-G[1]*z[2]+z[2]*z[5]-z[4]*z[3])/me,_e=(-G[0]*z[1]+G[1]*z[0]+z[4]*z[1]-z[5]*z[0])/me;return[Fe,_e]}static getAxialAlignedBoundingBox(G,z){let me=be.applyTransform(G,z),Fe=be.applyTransform(G.slice(2,4),z),_e=be.applyTransform([G[0],G[3]],z),Ae=be.applyTransform([G[2],G[1]],z);return[Math.min(me[0],Fe[0],_e[0],Ae[0]),Math.min(me[1],Fe[1],_e[1],Ae[1]),Math.max(me[0],Fe[0],_e[0],Ae[0]),Math.max(me[1],Fe[1],_e[1],Ae[1])]}static inverseTransform(G){let z=G[0]*G[3]-G[1]*G[2];return[G[3]/z,-G[1]/z,-G[2]/z,G[0]/z,(G[2]*G[5]-G[4]*G[3])/z,(G[4]*G[1]-G[5]*G[0])/z]}static apply3dTransform(G,z){return[G[0]*z[0]+G[1]*z[1]+G[2]*z[2],G[3]*z[0]+G[4]*z[1]+G[5]*z[2],G[6]*z[0]+G[7]*z[1]+G[8]*z[2]]}static singularValueDecompose2dScale(G){let z=[G[0],G[2],G[1],G[3]],me=G[0]*z[0]+G[1]*z[2],Fe=G[0]*z[1]+G[1]*z[3],_e=G[2]*z[0]+G[3]*z[2],Ae=G[2]*z[1]+G[3]*z[3],Ce=(me+Ae)/2,Ge=Math.sqrt((me+Ae)**2-4*(me*Ae-_e*Fe))/2,Be=Ce+Ge||1,ve=Ce-Ge||1;return[Math.sqrt(Be),Math.sqrt(ve)]}static normalizeRect(G){let z=G.slice(0);return G[0]>G[2]&&(z[0]=G[2],z[2]=G[0]),G[1]>G[3]&&(z[1]=G[3],z[3]=G[1]),z}static intersect(G,z){let me=Math.max(Math.min(G[0],G[2]),Math.min(z[0],z[2])),Fe=Math.min(Math.max(G[0],G[2]),Math.max(z[0],z[2]));if(me>Fe)return null;let _e=Math.max(Math.min(G[1],G[3]),Math.min(z[1],z[3])),Ae=Math.min(Math.max(G[1],G[3]),Math.max(z[1],z[3]));return _e>Ae?null:[me,_e,Fe,Ae]}static bezierBoundingBox(G,z,me,Fe,_e,Ae,Ce,Ge){let Be=[],ve=[[],[]],ze,Ue,ut,Le,qe,Ft,jt,Gt;for(let cn=0;cn<2;++cn){if(cn===0?(Ue=6*G-12*me+6*_e,ze=-3*G+9*me-9*_e+3*Ce,ut=3*me-3*G):(Ue=6*z-12*Fe+6*Ae,ze=-3*z+9*Fe-9*Ae+3*Ge,ut=3*Fe-3*z),Math.abs(ze)<1e-12){if(Math.abs(Ue)<1e-12)continue;Le=-ut/Ue,0<Le&&Le<1&&Be.push(Le);continue}jt=Ue*Ue-4*ut*ze,Gt=Math.sqrt(jt),!(jt<0)&&(qe=(-Ue+Gt)/(2*ze),0<qe&&qe<1&&Be.push(qe),Ft=(-Ue-Gt)/(2*ze),0<Ft&&Ft<1&&Be.push(Ft))}let _t=Be.length,Ze,wt=_t;for(;_t--;)Le=Be[_t],Ze=1-Le,ve[0][_t]=Ze*Ze*Ze*G+3*Ze*Ze*Le*me+3*Ze*Le*Le*_e+Le*Le*Le*Ce,ve[1][_t]=Ze*Ze*Ze*z+3*Ze*Ze*Le*Fe+3*Ze*Le*Le*Ae+Le*Le*Le*Ge;return ve[0][wt]=G,ve[1][wt]=z,ve[0][wt+1]=Ce,ve[1][wt+1]=Ge,ve[0].length=ve[1].length=wt+2,[Math.min(...ve[0]),Math.min(...ve[1]),Math.max(...ve[0]),Math.max(...ve[1])]}}t.Util=be;let Te=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function ke(Q){if(Q[0]>="\xEF"){let z;if(Q[0]==="\xFE"&&Q[1]==="\xFF"?z="utf-16be":Q[0]==="\xFF"&&Q[1]==="\xFE"?z="utf-16le":Q[0]==="\xEF"&&Q[1]==="\xBB"&&Q[2]==="\xBF"&&(z="utf-8"),z)try{let me=new TextDecoder(z,{fatal:!0}),Fe=X(Q);return me.decode(Fe)}catch(me){we(`stringToPDFString: "${me}".`)}}let G=[];for(let z=0,me=Q.length;z<me;z++){let Fe=Te[Q.charCodeAt(z)];G.push(Fe?String.fromCharCode(Fe):Q.charAt(z))}return G.join("")}function Me(Q){return Q.replace(/([()\\\n\r])/g,G=>G===`
`?"\\n":G==="\r"?"\\r":`\\${G}`)}function nt(Q){return/^[\x00-\x7F]*$/.test(Q)}function Ie(Q){let G=["\xFE\xFF"];for(let z=0,me=Q.length;z<me;z++){let Fe=Q.charCodeAt(z);G.push(String.fromCharCode(Fe>>8&255),String.fromCharCode(Fe&255))}return G.join("")}function Nt(Q){return decodeURIComponent(escape(Q))}function Ee(Q){return unescape(encodeURIComponent(Q))}function je(Q){return typeof Q=="object"&&Q!==null&&Q.byteLength!==void 0}function no(Q,G){if(Q.length!==G.length)return!1;for(let z=0,me=Q.length;z<me;z++)if(Q[z]!==G[z])return!1;return!0}function ae(Q=new Date){return[Q.getUTCFullYear().toString(),(Q.getUTCMonth()+1).toString().padStart(2,"0"),Q.getUTCDate().toString().padStart(2,"0"),Q.getUTCHours().toString().padStart(2,"0"),Q.getUTCMinutes().toString().padStart(2,"0"),Q.getUTCSeconds().toString().padStart(2,"0")].join("")}function he(){let Q=Object.create(null),G=!1;return Object.defineProperty(Q,"settled",{get(){return G}}),Q.promise=new Promise(function(z,me){Q.resolve=function(Fe){G=!0,z(Fe)},Q.reject=function(Fe){G=!0,me(Fe)}}),Q}},(o,t,e)=>{var n=e(3)},(o,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNodeJS=void 0;let e=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");t.isNodeJS=e},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var o,e,n,r,a,d,S,b,Br,A,C;Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.setPDFNetworkStreamFactory=setPDFNetworkStreamFactory,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(5),_display_utils=__w_pdfjs_require__(8),_font_loader=__w_pdfjs_require__(11),_canvas=__w_pdfjs_require__(12),_worker_options=__w_pdfjs_require__(15),_is_node=__w_pdfjs_require__(3),_message_handler=__w_pdfjs_require__(16),_metadata=__w_pdfjs_require__(17),_optional_content_config=__w_pdfjs_require__(18),_transport_stream=__w_pdfjs_require__(19),_xfa_text=__w_pdfjs_require__(20);let DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DefaultCanvasFactory=_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultStandardFontDataFactory=_display_utils.DOMStandardFontDataFactory;if(exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){let{NodeCanvasFactory:F,NodeCMapReaderFactory:i,NodeStandardFontDataFactory:l}=__w_pdfjs_require__(21);exports.DefaultCanvasFactory=DefaultCanvasFactory=F,exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory=i,exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory=l}let createPDFNetworkStream;function setPDFNetworkStreamFactory(F){createPDFNetworkStream=F}function getDocument(F){let i=new PDFDocumentLoadingTask,l;if(typeof F=="string"||F instanceof URL)l={url:F};else if((0,_util.isArrayBuffer)(F))l={data:F};else if(F instanceof PDFDataRangeTransport)l={range:F};else{if(typeof F!="object")throw new Error("Invalid parameter in getDocument, need either string, URL, TypedArray, or parameter object.");if(!F.url&&!F.data&&!F.range)throw new Error("Invalid parameter object: need either .data, .range or .url");l=F}let s=Object.create(null),v=null,k=null;for(let h in l){let c=l[h];switch(h){case"url":if(typeof window<"u")try{s[h]=new URL(c,window.location).href;continue}catch(u){(0,_util.warn)(`Cannot create valid URL: "${u}".`)}else if(typeof c=="string"||c instanceof URL){s[h]=c.toString();continue}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.");case"range":v=c;continue;case"worker":k=c;continue;case"data":if(_is_node.isNodeJS&&typeof Buffer<"u"&&c instanceof Buffer)s[h]=new Uint8Array(c);else{if(c instanceof Uint8Array)break;if(typeof c=="string")s[h]=(0,_util.stringToBytes)(c);else if(typeof c=="object"&&c!==null&&!isNaN(c.length))s[h]=new Uint8Array(c);else if((0,_util.isArrayBuffer)(c))s[h]=new Uint8Array(c);else throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}continue}s[h]=c}if(s.CMapReaderFactory=s.CMapReaderFactory||DefaultCMapReaderFactory,s.StandardFontDataFactory=s.StandardFontDataFactory||DefaultStandardFontDataFactory,s.ignoreErrors=s.stopAtErrors!==!0,s.fontExtraProperties=s.fontExtraProperties===!0,s.pdfBug=s.pdfBug===!0,s.enableXfa=s.enableXfa===!0,(!Number.isInteger(s.rangeChunkSize)||s.rangeChunkSize<1)&&(s.rangeChunkSize=DEFAULT_RANGE_CHUNK_SIZE),(typeof s.docBaseUrl!="string"||(0,_display_utils.isDataScheme)(s.docBaseUrl))&&(s.docBaseUrl=null),(!Number.isInteger(s.maxImageSize)||s.maxImageSize<-1)&&(s.maxImageSize=-1),typeof s.cMapUrl!="string"&&(s.cMapUrl=null),typeof s.standardFontDataUrl!="string"&&(s.standardFontDataUrl=null),typeof s.useWorkerFetch!="boolean"&&(s.useWorkerFetch=s.CMapReaderFactory===_display_utils.DOMCMapReaderFactory&&s.StandardFontDataFactory===_display_utils.DOMStandardFontDataFactory),typeof s.isEvalSupported!="boolean"&&(s.isEvalSupported=!0),typeof s.disableFontFace!="boolean"&&(s.disableFontFace=_is_node.isNodeJS),typeof s.useSystemFonts!="boolean"&&(s.useSystemFonts=!_is_node.isNodeJS&&!s.disableFontFace),(typeof s.ownerDocument!="object"||s.ownerDocument===null)&&(s.ownerDocument=globalThis.document),typeof s.disableRange!="boolean"&&(s.disableRange=!1),typeof s.disableStream!="boolean"&&(s.disableStream=!1),typeof s.disableAutoFetch!="boolean"&&(s.disableAutoFetch=!1),(0,_util.setVerbosityLevel)(s.verbosity),!k){let h={verbosity:s.verbosity,port:_worker_options.GlobalWorkerOptions.workerPort};k=h.port?PDFWorker.fromPort(h):new PDFWorker(h),i._worker=k}let y=i.docId;return k.promise.then(function(){if(i.destroyed)throw new Error("Loading aborted");let h=_fetchDocument(k,s,v,y),c=new Promise(function(u){let f;v?f=new _transport_stream.PDFDataTransportStream({length:s.length,initialData:s.initialData,progressiveDone:s.progressiveDone,contentDispositionFilename:s.contentDispositionFilename,disableRange:s.disableRange,disableStream:s.disableStream},v):s.data||(f=createPDFNetworkStream({url:s.url,length:s.length,httpHeaders:s.httpHeaders,withCredentials:s.withCredentials,rangeChunkSize:s.rangeChunkSize,disableRange:s.disableRange,disableStream:s.disableStream})),u(f)});return Promise.all([h,c]).then(function([u,f]){if(i.destroyed)throw new Error("Loading aborted");let M=new _message_handler.MessageHandler(y,u,k.port),E=new WorkerTransport(M,i,f,s);i._transport=E,M.send("Ready",null)})}).catch(i._capability.reject),i}async function _fetchDocument(F,i,l,s){if(F.destroyed)throw new Error("Worker was destroyed");l&&(i.length=l.length,i.initialData=l.initialData,i.progressiveDone=l.progressiveDone,i.contentDispositionFilename=l.contentDispositionFilename);let v=await F.messageHandler.sendWithPromise("GetDocRequest",{docId:s,apiVersion:"2.16.105",source:{data:i.data,url:i.url,password:i.password,disableAutoFetch:i.disableAutoFetch,rangeChunkSize:i.rangeChunkSize,length:i.length},maxImageSize:i.maxImageSize,disableFontFace:i.disableFontFace,docBaseUrl:i.docBaseUrl,ignoreErrors:i.ignoreErrors,isEvalSupported:i.isEvalSupported,fontExtraProperties:i.fontExtraProperties,enableXfa:i.enableXfa,useSystemFonts:i.useSystemFonts,cMapUrl:i.useWorkerFetch?i.cMapUrl:null,standardFontDataUrl:i.useWorkerFetch?i.standardFontDataUrl:null});if(i.data&&(i.data=null),F.destroyed)throw new Error("Worker was destroyed");return v}let t=class{constructor(){this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId=`d${gr(t,o)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null,this.onUnsupportedFeature=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0,await this._transport?.destroy(),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}},PDFDocumentLoadingTask=t;o=new WeakMap,le(PDFDocumentLoadingTask,o,0),exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(i,l,s=!1,v=null){this.length=i,this.initialData=l,this.progressiveDone=s,this.contentDispositionFilename=v,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(i){this._rangeListeners.push(i)}addProgressListener(i){this._progressListeners.push(i)}addProgressiveReadListener(i){this._progressiveReadListeners.push(i)}addProgressiveDoneListener(i){this._progressiveDoneListeners.push(i)}onDataRange(i,l){for(let s of this._rangeListeners)s(i,l)}onDataProgress(i,l){this._readyCapability.promise.then(()=>{for(let s of this._progressListeners)s(i,l)})}onDataProgressiveRead(i){this._readyCapability.promise.then(()=>{for(let l of this._progressiveReadListeners)l(i)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let i of this._progressiveDoneListeners)i()})}transportReady(){this._readyCapability.resolve()}requestDataRange(i,l){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(i,l){this._pdfInfo=i,this._transport=l,Object.defineProperty(this,"fingerprint",{get(){return(0,_display_utils.deprecated)("`PDFDocumentProxy.fingerprint`, please use `PDFDocumentProxy.fingerprints` instead."),this.fingerprints[0]}}),Object.defineProperty(this,"getStats",{value:async()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getStats`, please use the `PDFDocumentProxy.stats`-getter instead."),this.stats||{streamTypes:{},fontTypes:{}})})}get annotationStorage(){return this._transport.annotationStorage}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get stats(){return this._transport.stats}get isPureXfa(){return!!this._transport._htmlForXfa}get allXfaHtml(){return this._transport._htmlForXfa}getPage(i){return this._transport.getPage(i)}getPageIndex(i){return this._transport.getPageIndex(i)}getDestinations(){return this._transport.getDestinations()}getDestination(i){return this._transport.getDestination(i)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(i=!1){return this._transport.startCleanup(i||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}saveDocument(){return this._transport.annotationStorage.size<=0&&(0,_display_utils.deprecated)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead."),this._transport.saveDocument()}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(i,l,s,v,k=!1){this._pageIndex=i,this._pageInfo=l,this._ownerDocument=v,this._transport=s,this._stats=k?new _display_utils.StatTimer:null,this._pdfBug=k,this.commonObjs=s.commonObjs,this.objs=new PDFObjects,this._bitmaps=new Set,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this._annotationPromises=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:i,rotation:l=this.rotate,offsetX:s=0,offsetY:v=0,dontFlip:k=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:i,rotation:l,offsetX:s,offsetY:v,dontFlip:k})}getAnnotations({intent:i="display"}={}){let l=this._transport.getRenderingIntent(i),s=this._annotationPromises.get(l.cacheKey);return s||(s=this._transport.getAnnotations(this._pageIndex,l.renderingIntent),this._annotationPromises.set(l.cacheKey,s),s=s.then(v=>{for(let k of v)k.titleObj!==void 0&&Object.defineProperty(k,"title",{get(){return(0,_display_utils.deprecated)("`title`-property on annotation, please use `titleObj` instead."),k.titleObj.str}}),k.contentsObj!==void 0&&Object.defineProperty(k,"contents",{get(){return(0,_display_utils.deprecated)("`contents`-property on annotation, please use `contentsObj` instead."),k.contentsObj.str}});return v})),s}getJSActions(){return this._jsActionsPromise||=this._transport.getPageJSActions(this._pageIndex)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:i,viewport:l,intent:s="display",annotationMode:v=_util.AnnotationMode.ENABLE,transform:k=null,imageLayer:y=null,canvasFactory:h=null,background:c=null,optionalContentConfigPromise:u=null,annotationCanvasMap:f=null,pageColors:M=null,printAnnotationStorage:E=null}){arguments[0]?.renderInteractiveForms!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `renderInteractiveForms`-option, please use the `annotationMode`-option instead."),arguments[0].renderInteractiveForms===!0&&v===_util.AnnotationMode.ENABLE&&(v=_util.AnnotationMode.ENABLE_FORMS)),arguments[0]?.includeAnnotationStorage!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `includeAnnotationStorage`-option, please use the `annotationMode`-option instead."),arguments[0].includeAnnotationStorage===!0&&v===_util.AnnotationMode.ENABLE&&(v=_util.AnnotationMode.ENABLE_STORAGE)),this._stats&&this._stats.time("Overall");let w=this._transport.getRenderingIntent(s,v,E);this.pendingCleanup=!1,u||(u=this._transport.getOptionalContentConfig());let P=this._intentStates.get(w.cacheKey);P||(P=Object.create(null),this._intentStates.set(w.cacheKey,P)),P.streamReaderCancelTimeout&&(clearTimeout(P.streamReaderCancelTimeout),P.streamReaderCancelTimeout=null);let ne=h||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),ie=!!(w.renderingIntent&_util.RenderingIntentFlag.PRINT);P.displayReadyCapability||(P.displayReadyCapability=(0,_util.createPromiseCapability)(),P.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(w));let Z=U=>{P.renderTasks.delete(Y),(this.cleanupAfterRender||ie)&&(this.pendingCleanup=!0),this._tryCleanup(),U?(Y.capability.reject(U),this._abortOperatorList({intentState:P,reason:U instanceof Error?U:new Error(U)})):Y.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"))},Y=new InternalRenderTask({callback:Z,params:{canvasContext:i,viewport:l,transform:k,imageLayer:y,background:c},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:f,operatorList:P.operatorList,pageIndex:this._pageIndex,canvasFactory:ne,useRequestAnimationFrame:!ie,pdfBug:this._pdfBug,pageColors:M});(P.renderTasks||=new Set).add(Y);let j=Y.task;return Promise.all([P.displayReadyCapability.promise,u]).then(([U,q])=>{if(this.pendingCleanup){Z();return}this._stats&&this._stats.time("Rendering"),Y.initializeGraphics({transparency:U,optionalContentConfig:q}),Y.operatorListChanged()}).catch(Z),j}getOperatorList({intent:i="display",annotationMode:l=_util.AnnotationMode.ENABLE,printAnnotationStorage:s=null}={}){function v(){y.operatorList.lastChunk&&(y.opListReadCapability.resolve(y.operatorList),y.renderTasks.delete(h))}let k=this._transport.getRenderingIntent(i,l,s,!0),y=this._intentStates.get(k.cacheKey);y||(y=Object.create(null),this._intentStates.set(k.cacheKey,y));let h;return y.opListReadCapability||(h=Object.create(null),h.operatorListChanged=v,y.opListReadCapability=(0,_util.createPromiseCapability)(),(y.renderTasks||=new Set).add(h),y.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(k)),y.opListReadCapability.promise}streamTextContent({disableCombineTextItems:i=!1,includeMarkedContent:l=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,combineTextItems:i!==!0,includeMarkedContent:l===!0},{highWaterMark:100,size(v){return v.items.length}})}getTextContent(i={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>_xfa_text.XfaText.textContent(s));let l=this.streamTextContent(i);return new Promise(function(s,v){function k(){y.read().then(function({value:c,done:u}){if(u){s(h);return}Object.assign(h.styles,c.styles),h.items.push(...c.items),k()},v)}let y=l.getReader(),h={items:[],styles:Object.create(null)};k()})}getStructTree(){return this._structTreePromise||=this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let i=[];for(let l of this._intentStates.values())if(this._abortOperatorList({intentState:l,reason:new Error("Page was destroyed."),force:!0}),!l.opListReadCapability)for(let s of l.renderTasks)i.push(s.completed),s.cancel();this.objs.clear();for(let l of this._bitmaps)l.close();return this._bitmaps.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,this.pendingCleanup=!1,Promise.all(i)}cleanup(i=!1){return this.pendingCleanup=!0,this._tryCleanup(i)}_tryCleanup(i=!1){if(!this.pendingCleanup)return!1;for(let{renderTasks:l,operatorList:s}of this._intentStates.values())if(l.size>0||!s.lastChunk)return!1;this._intentStates.clear(),this.objs.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,i&&this._stats&&(this._stats=new _display_utils.StatTimer);for(let l of this._bitmaps)l.close();return this._bitmaps.clear(),this.pendingCleanup=!1,!0}_startRenderPage(i,l){let s=this._intentStates.get(l);s&&(this._stats&&this._stats.timeEnd("Page Request"),s.displayReadyCapability&&s.displayReadyCapability.resolve(i))}_renderPageChunk(i,l){for(let s=0,v=i.length;s<v;s++)l.operatorList.fnArray.push(i.fnArray[s]),l.operatorList.argsArray.push(i.argsArray[s]);l.operatorList.lastChunk=i.lastChunk,l.operatorList.separateAnnots=i.separateAnnots;for(let s of l.renderTasks)s.operatorListChanged();i.lastChunk&&this._tryCleanup()}_pumpOperatorList({renderingIntent:i,cacheKey:l,annotationStorageMap:s}){let k=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:i,cacheKey:l,annotationStorage:s}).getReader(),y=this._intentStates.get(l);y.streamReader=k;let h=()=>{k.read().then(({value:c,done:u})=>{if(u){y.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(c,y),h())},c=>{if(y.streamReader=null,!this._transport.destroyed){if(y.operatorList){y.operatorList.lastChunk=!0;for(let u of y.renderTasks)u.operatorListChanged();this._tryCleanup()}if(y.displayReadyCapability)y.displayReadyCapability.reject(c);else if(y.opListReadCapability)y.opListReadCapability.reject(c);else throw c}})};h()}_abortOperatorList({intentState:i,reason:l,force:s=!1}){if(i.streamReader){if(!s){if(i.renderTasks.size>0)return;if(l instanceof _display_utils.RenderingCancelledException){i.streamReaderCancelTimeout=setTimeout(()=>{this._abortOperatorList({intentState:i,reason:l,force:!0}),i.streamReaderCancelTimeout=null},RENDERING_CANCELLED_TIMEOUT);return}}if(i.streamReader.cancel(new _util.AbortException(l.message)).catch(()=>{}),i.streamReader=null,!this._transport.destroyed){for(let[v,k]of this._intentStates)if(k===i){this._intentStates.delete(v);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){this._listeners=[],this._deferred=Promise.resolve()}postMessage(i,l){let s={data:structuredClone(i,l)};this._deferred.then(()=>{for(let v of this._listeners)v.call(this,s)})}addEventListener(i,l){this._listeners.push(l)}removeEventListener(i,l){let s=this._listeners.indexOf(l);this._listeners.splice(s,1)}terminate(){this._listeners.length=0}}exports.LoopbackPort=LoopbackPort;let PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_is_node.isNodeJS&&typeof hr=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){let F=document?.currentScript?.src;F&&(PDFWorkerUtil.fallbackWorkerSrc=F.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(F,i){let l;try{if(l=new URL(F),!l.origin||l.origin==="null")return!1}catch{return!1}let s=new URL(i,l);return l.origin===s.origin},PDFWorkerUtil.createCDNWrapper=function(F){let i=`importScripts("${F}");`;return URL.createObjectURL(new Blob([i]))}}let _PDFWorker=class{constructor({name:F=null,port:i=null,verbosity:l=(0,_util.getVerbosityLevel)()}={}){if(i&&B(_PDFWorker,e).has(i))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=F,this.destroyed=!1,this.verbosity=l,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,i){B(_PDFWorker,e).set(i,this),this._initializeFromPort(i);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(F){this._port=F,this._messageHandler=new _message_handler.MessageHandler("main","worker",F),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve()}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:F}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,F)||(F=PDFWorkerUtil.createCDNWrapper(new URL(F,window.location).href));let i=new Worker(F),l=new _message_handler.MessageHandler("main","worker",i),s=()=>{i.removeEventListener("error",v),l.destroy(),i.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},v=()=>{this._webWorker||s()};i.addEventListener("error",v),l.on("test",y=>{if(i.removeEventListener("error",v),this.destroyed){s();return}y?(this._messageHandler=l,this._port=i,this._webWorker=i,this._readyCapability.resolve(),l.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),l.destroy(),i.terminate())}),l.on("ready",y=>{if(i.removeEventListener("error",v),this.destroyed){s();return}try{k()}catch{this._setupFakeWorker()}});let k=()=>{let y=new Uint8Array;l.send("test",y,[y.buffer])};k();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(F=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let i=new LoopbackPort;this._port=i;let l=`fake${PDFWorkerUtil.fakeWorkerId++}`,s=new _message_handler.MessageHandler(l+"_worker",l,i);F.setup(s,i);let v=new _message_handler.MessageHandler(l,l+"_worker",i);this._messageHandler=v,this._readyCapability.resolve(),v.send("configure",{verbosity:this.verbosity})}).catch(F=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${F.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),B(_PDFWorker,e).delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(F){if(!F?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return B(this,e).has(F.port)?B(this,e).get(F.port):new _PDFWorker(F)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){let loader=async()=>{let mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&typeof hr=="function"){let worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}},PDFWorker=_PDFWorker;e=new WeakMap,le(PDFWorker,e,new WeakMap),exports.PDFWorker=PDFWorker,PDFWorker.getWorkerSrc=function(){return(0,_display_utils.deprecated)("`PDFWorker.getWorkerSrc()`, please use `PDFWorker.workerSrc` instead."),this.workerSrc};class WorkerTransport{constructor(i,l,s,v){le(this,n,null);le(this,r,new Map);le(this,a,new Map);le(this,d,null);this.messageHandler=i,this.loadingTask=l,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({docId:l.docId,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:v.ownerDocument,styleElement:v.styleElement}),this._params=v,v.useWorkerFetch||(this.CMapReaderFactory=new v.CMapReaderFactory({baseUrl:v.cMapUrl,isCompressed:v.cMapPacked}),this.StandardFontDataFactory=new v.StandardFontDataFactory({baseUrl:v.standardFontDataUrl})),this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}get stats(){return B(this,n)}getRenderingIntent(i,l=_util.AnnotationMode.ENABLE,s=null,v=!1){let k=_util.RenderingIntentFlag.DISPLAY,y=null;switch(i){case"any":k=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":k=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${i}`)}switch(l){case _util.AnnotationMode.DISABLE:k+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:k+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:k+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,y=(k&_util.RenderingIntentFlag.PRINT&&s instanceof _annotation_storage.PrintAnnotationStorage?s:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${l}`)}return v&&(k+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:k,cacheKey:`${k}_${_annotation_storage.AnnotationStorage.getHash(y)}`,annotationStorageMap:y}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));let i=[];for(let s of B(this,r).values())i.push(s._destroy());B(this,r).clear(),B(this,a).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let l=this.messageHandler.sendWithPromise("Terminate",null);return i.push(l),Promise.all(i).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),xe(this,d,null),this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null,this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:i,loadingTask:l}=this;i.on("GetReader",(s,v)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=k=>{this._lastProgress={loaded:k.loaded,total:k.total}},v.onPull=()=>{this._fullReader.read().then(function({value:k,done:y}){if(y){v.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(k),"GetReader - expected an ArrayBuffer."),v.enqueue(new Uint8Array(k),1,[k])}).catch(k=>{v.error(k)})},v.onCancel=k=>{this._fullReader.cancel(k),v.ready.catch(y=>{if(!this.destroyed)throw y})}}),i.on("ReaderHeadersReady",s=>{let v=(0,_util.createPromiseCapability)(),k=this._fullReader;return k.headersReady.then(()=>{(!k.isStreamingSupported||!k.isRangeSupported)&&(this._lastProgress&&l.onProgress?.(this._lastProgress),k.onProgress=y=>{l.onProgress?.({loaded:y.loaded,total:y.total})}),v.resolve({isStreamingSupported:k.isStreamingSupported,isRangeSupported:k.isRangeSupported,contentLength:k.contentLength})},v.reject),v.promise}),i.on("GetRangeReader",(s,v)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let k=this._networkStream.getRangeReader(s.begin,s.end);if(!k){v.close();return}v.onPull=()=>{k.read().then(function({value:y,done:h}){if(h){v.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(y),"GetRangeReader - expected an ArrayBuffer."),v.enqueue(new Uint8Array(y),1,[y])}).catch(y=>{v.error(y)})},v.onCancel=y=>{k.cancel(y),v.ready.catch(h=>{if(!this.destroyed)throw h})}}),i.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,l._capability.resolve(new PDFDocumentProxy(s,this))}),i.on("DocException",function(s){let v;switch(s.name){case"PasswordException":v=new _util.PasswordException(s.message,s.code);break;case"InvalidPDFException":v=new _util.InvalidPDFException(s.message);break;case"MissingPDFException":v=new _util.MissingPDFException(s.message);break;case"UnexpectedResponseException":v=new _util.UnexpectedResponseException(s.message,s.status);break;case"UnknownErrorException":v=new _util.UnknownErrorException(s.message,s.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}l._capability.reject(v)}),i.on("PasswordRequest",s=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),l.onPassword){let v=k=>{k instanceof Error?this._passwordCapability.reject(k):this._passwordCapability.resolve({password:k})};try{l.onPassword(v,s.code)}catch(k){this._passwordCapability.reject(k)}}else this._passwordCapability.reject(new _util.PasswordException(s.message,s.code));return this._passwordCapability.promise}),i.on("DataLoaded",s=>{l.onProgress?.({loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),i.on("StartRenderPage",s=>{if(this.destroyed)return;B(this,r).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),i.on("commonobj",([s,v,k])=>{if(!this.destroyed&&!this.commonObjs.has(s))switch(v){case"Font":let y=this._params;if("error"in k){let u=k.error;(0,_util.warn)(`Error during font loading: ${u}`),this.commonObjs.resolve(s,u);break}let h=null;y.pdfBug&&globalThis.FontInspector?.enabled&&(h={registerFont(u,f){globalThis.FontInspector.fontAdded(u,f)}});let c=new _font_loader.FontFaceObject(k,{isEvalSupported:y.isEvalSupported,disableFontFace:y.disableFontFace,ignoreErrors:y.ignoreErrors,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),fontRegistry:h});this.fontLoader.bind(c).catch(u=>i.sendWithPromise("FontFallback",{id:s})).finally(()=>{!y.fontExtraProperties&&c.data&&(c.data=null),this.commonObjs.resolve(s,c)});break;case"FontPath":case"Image":this.commonObjs.resolve(s,k);break;default:throw new Error(`Got unknown common object type ${v}`)}}),i.on("obj",([s,v,k,y])=>{if(this.destroyed)return;let h=B(this,r).get(v);if(!h.objs.has(s))switch(k){case"Image":h.objs.resolve(s,y);let c=8e6;if(y){let u;if(y.bitmap){let{bitmap:f,width:M,height:E}=y;u=M*E*4,h._bitmaps.add(f)}else u=y.data?.length||0;u>c&&(h.cleanupAfterRender=!0)}break;case"Pattern":h.objs.resolve(s,y);break;default:throw new Error(`Got unknown object type ${k}`)}}),i.on("DocProgress",s=>{this.destroyed||l.onProgress?.({loaded:s.loaded,total:s.total})}),i.on("DocStats",s=>{this.destroyed||xe(this,n,Object.freeze({streamTypes:Object.freeze(s.streamTypes),fontTypes:Object.freeze(s.fontTypes)}))}),i.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),i.on("FetchBuiltInCMap",s=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.CMapReaderFactory?this.CMapReaderFactory.fetch(s):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),i.on("FetchStandardFontData",s=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.StandardFontDataFactory?this.StandardFontDataFactory.fetch(s):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}_onUnsupportedFeature({featureId:i}){this.destroyed||this.loadingTask.onUnsupportedFeature?.(i)}getData(){return this.messageHandler.sendWithPromise("GetData",null)}getPage(i){if(!Number.isInteger(i)||i<=0||i>this._numPages)return Promise.reject(new Error("Invalid page request."));let l=i-1,s=B(this,a).get(l);if(s)return s;let v=this.messageHandler.sendWithPromise("GetPage",{pageIndex:l}).then(k=>{if(this.destroyed)throw new Error("Transport destroyed");let y=new PDFPageProxy(l,k,this,this._params.ownerDocument,this._params.pdfBug);return B(this,r).set(l,y),y});return B(this,a).set(l,v),v}getPageIndex(i){return typeof i!="object"||i===null||!Number.isInteger(i.num)||i.num<0||!Number.isInteger(i.gen)||i.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:i.num,gen:i.gen})}getAnnotations(i,l){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:i,intent:l})}saveDocument(){return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:this.annotationStorage.serializable,filename:this._fullReader?.filename??null}).finally(()=>{this.annotationStorage.resetModified()})}getFieldObjects(){return this._getFieldObjectsPromise||=this.messageHandler.sendWithPromise("GetFieldObjects",null)}hasJSActions(){return this._hasJSActionsPromise||=this.messageHandler.sendWithPromise("HasJSActions",null)}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(i){return typeof i!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:i})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(i){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:i})}getStructTree(i){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:i})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(i=>new _optional_content_config.OptionalContentConfig(i))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){return B(this,d)||xe(this,d,this.messageHandler.sendWithPromise("GetMetadata",null).then(i=>({info:i[0],metadata:i[1]?new _metadata.Metadata(i[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null})))}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(i=!1){if(await this.messageHandler.sendWithPromise("Cleanup",null),!this.destroyed){for(let l of B(this,r).values())if(!l.cleanup())throw new Error(`startCleanup: Page ${l.pageNumber} is currently rendering.`);this.commonObjs.clear(),i||this.fontLoader.clear(),xe(this,d,null),this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null}}get loadingParams(){let i=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:i.disableAutoFetch,enableXfa:i.enableXfa})}}n=new WeakMap,r=new WeakMap,a=new WeakMap,d=new WeakMap;class PDFObjects{constructor(){le(this,b);le(this,S,Object.create(null))}get(i,l=null){if(l){let v=ue(this,b,Br).call(this,i);return v.capability.promise.then(()=>l(v.data)),null}let s=B(this,S)[i];if(!s?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${i}.`);return s.data}has(i){return B(this,S)[i]?.capability.settled||!1}resolve(i,l=null){let s=ue(this,b,Br).call(this,i);s.data=l,s.capability.resolve()}clear(){xe(this,S,Object.create(null))}}S=new WeakMap,b=new WeakSet,Br=function(i){let l=B(this,S)[i];return l||(B(this,S)[i]={capability:(0,_util.createPromiseCapability)(),data:null})};class RenderTask{constructor(i){le(this,A,null);xe(this,A,i),this.onContinue=null}get promise(){return B(this,A).capability.promise}cancel(){B(this,A).cancel()}get separateAnnots(){let{separateAnnots:i}=B(this,A).operatorList;if(!i)return!1;let{annotationCanvasMap:l}=B(this,A);return i.form||i.canvas&&l?.size>0}}A=new WeakMap,exports.RenderTask=RenderTask;let _=class{constructor({callback:i,params:l,objs:s,commonObjs:v,annotationCanvasMap:k,operatorList:y,pageIndex:h,canvasFactory:c,useRequestAnimationFrame:u=!1,pdfBug:f=!1,pageColors:M=null}){this.callback=i,this.params=l,this.objs=s,this.commonObjs=v,this.annotationCanvasMap=k,this.operatorListIdx=null,this.operatorList=y,this._pageIndex=h,this.canvasFactory=c,this._pdfBug=f,this.pageColors=M,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=u===!0&&typeof window<"u",this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=l.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:i=!1,optionalContentConfig:l}){if(this.cancelled)return;if(this._canvas){if(B(_,C).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");B(_,C).add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:s,viewport:v,transform:k,imageLayer:y,background:h}=this.params;this.gfx=new _canvas.CanvasGraphics(s,this.commonObjs,this.objs,this.canvasFactory,y,l,this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:k,viewport:v,transparency:i,background:h}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}cancel(i=null){this.running=!1,this.cancelled=!0,this.gfx&&this.gfx.endDrawing(),this._canvas&&B(_,C).delete(this._canvas),this.callback(i||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas"))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}this.stepper&&this.stepper.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&B(_,C).delete(this._canvas),this.callback())))}},InternalRenderTask=_;C=new WeakMap,le(InternalRenderTask,C,new WeakSet);let version="2.16.105";exports.version=version;let build="172ccdbe5";exports.build=build},(o,t,e)=>{var b,Ls,A;Object.defineProperty(t,"__esModule",{value:!0}),t.PrintAnnotationStorage=t.AnnotationStorage=void 0;var n=e(1),r=e(6),a=e(10);class d{constructor(){le(this,b);this._storage=new Map,this._modified=!1,this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(_,F){let i=this._storage.get(_);return i===void 0?F:Object.assign(F,i)}getRawValue(_){return this._storage.get(_)}remove(_){if(this._storage.delete(_),this._storage.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let F of this._storage.values())if(F instanceof r.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(_,F){let i=this._storage.get(_),l=!1;if(i!==void 0)for(let[s,v]of Object.entries(F))i[s]!==v&&(l=!0,i[s]=v);else l=!0,this._storage.set(_,F);l&&ue(this,b,Ls).call(this),F instanceof r.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(F.constructor._type)}has(_){return this._storage.has(_)}getAll(){return this._storage.size>0?(0,n.objectFromMap)(this._storage):null}get size(){return this._storage.size}resetModified(){this._modified&&(this._modified=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new S(this)}get serializable(){if(this._storage.size===0)return null;let _=new Map;for(let[F,i]of this._storage){let l=i instanceof r.AnnotationEditor?i.serialize():i;l&&_.set(F,l)}return _}static getHash(_){if(!_)return"";let F=new a.MurmurHash3_64;for(let[i,l]of _)F.update(`${i}:${JSON.stringify(l)}`);return F.hexdigest()}}b=new WeakSet,Ls=function(){this._modified||(this._modified=!0,typeof this.onSetModified=="function"&&this.onSetModified())},t.AnnotationStorage=d;class S extends d{constructor(F){super();le(this,A,null);xe(this,A,structuredClone(F.serializable))}get print(){(0,n.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return B(this,A)}}A=new WeakMap,t.PrintAnnotationStorage=S},(o,t,e)=>{var d,S,b,m,A,C;Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationEditor=void 0;var n=e(7),r=e(1);let _=class{constructor(i){le(this,d,this.focusin.bind(this));le(this,S,this.focusout.bind(this));le(this,b,!1);le(this,m,!1);le(this,A,!1);le(this,C,_._zIndex++);this.constructor===_&&(0,r.unreachable)("Cannot initialize AnnotationEditor."),this.parent=i.parent,this.id=i.id,this.width=this.height=null,this.pageIndex=i.parent.pageIndex,this.name=i.name,this.div=null;let[l,s]=this.parent.viewportBaseDimensions;this.x=i.x/l,this.y=i.y/s,this.rotation=this.parent.viewport.rotation,this.isAttachedToDOM=!1}static get _defaultLineColor(){return(0,r.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=B(this,C)}focusin(i){B(this,b)?xe(this,b,!1):this.parent.setSelected(this)}focusout(i){!this.isAttachedToDOM||i.relatedTarget?.closest(`#${this.id}`)||(i.preventDefault(),this.parent.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.parent.addToAnnotationStorage(this)}dragstart(i){let l=this.parent.div.getBoundingClientRect();this.startX=i.clientX-l.x,this.startY=i.clientY-l.y,i.dataTransfer.setData("text/plain",this.id),i.dataTransfer.effectAllowed="move"}setAt(i,l,s,v){let[k,y]=this.parent.viewportBaseDimensions;[s,v]=this.screenToPageTranslation(s,v),this.x=(i+s)/k,this.y=(l+v)/y,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}translate(i,l){let[s,v]=this.parent.viewportBaseDimensions;[i,l]=this.screenToPageTranslation(i,l),this.x+=i/s,this.y+=l/v,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}screenToPageTranslation(i,l){let{rotation:s}=this.parent.viewport;switch(s){case 90:return[l,-i];case 180:return[-i,-l];case 270:return[-l,i];default:return[i,l]}}setDims(i,l){let[s,v]=this.parent.viewportBaseDimensions;this.div.style.width=`${100*i/s}%`,this.div.style.height=`${100*l/v}%`}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",B(this,d)),this.div.addEventListener("focusout",B(this,S));let[i,l]=this.getInitialTranslation();return this.translate(i,l),(0,n.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(i){let l=n.KeyboardManager.platform.isMac;if(i.button!==0||i.ctrlKey&&l){i.preventDefault();return}i.ctrlKey&&!l||i.shiftKey||i.metaKey&&l?this.parent.toggleSelected(this):this.parent.setSelected(this),xe(this,b,!0)}getRect(i,l){let[s,v]=this.parent.viewportBaseDimensions,[k,y]=this.parent.pageDimensions,h=k*i/s,c=y*l/v,u=this.x*k,f=this.y*y,M=this.width*k,E=this.height*y;switch(this.rotation){case 0:return[u+h,y-f-c-E,u+h+M,y-f-c];case 90:return[u+c,y-f+h,u+c+E,y-f+h+M];case 180:return[u-h-M,y-f+c,u-h,y-f+c+E];case 270:return[u-c-E,y-f-h-M,u-c,y-f-h];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(i,l){let[s,v,k,y]=i,h=k-s,c=y-v;switch(this.rotation){case 0:return[s,l-y,h,c];case 90:return[s,l-v,c,h];case 180:return[k,l-v,h,c];case 270:return[k,l-y,c,h];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){xe(this,A,!0)}disableEditMode(){xe(this,A,!1)}isInEditMode(){return B(this,A)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",B(this,d))}serialize(){(0,r.unreachable)("An editor must be serializable")}static deserialize(i,l){let s=new this.prototype.constructor({parent:l,id:l.getNextId()});s.rotation=i.rotation;let[v,k]=l.pageDimensions,[y,h,c,u]=s.getRectInCurrentCoords(i.rect,k);return s.x=y/v,s.y=h/k,s.width=c/v,s.height=u/k,s}remove(){this.div.removeEventListener("focusin",B(this,d)),this.div.removeEventListener("focusout",B(this,S)),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){this.div?.classList.add("selectedEditor")}unselect(){this.div?.classList.remove("selectedEditor")}updateParams(i,l){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return B(this,m)}set isEditing(i){xe(this,m,i),i?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}},a=_;d=new WeakMap,S=new WeakMap,b=new WeakMap,m=new WeakMap,A=new WeakMap,C=new WeakMap,We(a,"_colorManager",new n.ColorManager),We(a,"_zIndex",1),t.AnnotationEditor=a},(o,t,e)=>{var F,i,l,s,v,k,Bs,c,f,M,E,w,P,ne,ie,Z,Y,j,U,q,re,pe,we,H,x,g,Rs,I,Rr,N,dt,J,Vn,T,Is,R,Vs,X,Ir,ge,On,oe,So;Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardManager=t.CommandManager=t.ColorManager=t.AnnotationEditorUIManager=void 0,t.bindEvents=a,t.opacityToHex=d;var n=e(1),r=e(8);function a(fe,W,de){for(let be of de)W.addEventListener(be,fe[be].bind(fe))}function d(fe){return Math.round(Math.min(255,Math.max(1,255*fe))).toString(16).padStart(2,"0")}class S{constructor(){le(this,F,0)}getId(){return`${n.AnnotationEditorPrefix}${gr(this,F)._++}`}}F=new WeakMap;class b{constructor(W=128){le(this,i,[]);le(this,l,!1);le(this,s,void 0);le(this,v,-1);xe(this,s,W)}add({cmd:W,undo:de,mustExec:be,type:Te=NaN,overwriteIfSameType:ke=!1,keepUndo:Me=!1}){if(be&&W(),B(this,l))return;let nt={cmd:W,undo:de,type:Te};if(B(this,v)===-1){B(this,i).length>0&&(B(this,i).length=0),xe(this,v,0),B(this,i).push(nt);return}if(ke&&B(this,i)[B(this,v)].type===Te){Me&&(nt.undo=B(this,i)[B(this,v)].undo),B(this,i)[B(this,v)]=nt;return}let Ie=B(this,v)+1;Ie===B(this,s)?B(this,i).splice(0,1):(xe(this,v,Ie),Ie<B(this,i).length&&B(this,i).splice(Ie)),B(this,i).push(nt)}undo(){B(this,v)!==-1&&(xe(this,l,!0),B(this,i)[B(this,v)].undo(),xe(this,l,!1),xe(this,v,B(this,v)-1))}redo(){B(this,v)<B(this,i).length-1&&(xe(this,v,B(this,v)+1),xe(this,l,!0),B(this,i)[B(this,v)].cmd(),xe(this,l,!1))}hasSomethingToUndo(){return B(this,v)!==-1}hasSomethingToRedo(){return B(this,v)<B(this,i).length-1}destroy(){xe(this,i,null)}}i=new WeakMap,l=new WeakMap,s=new WeakMap,v=new WeakMap,t.CommandManager=b;let h=class{constructor(W){le(this,k);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let de=h.platform.isMac;for(let[be,Te]of W)for(let ke of be){let Me=ke.startsWith("mac+");de&&Me?(this.callbacks.set(ke.slice(4),Te),this.allKeys.add(ke.split("+").at(-1))):!de&&!Me&&(this.callbacks.set(ke,Te),this.allKeys.add(ke.split("+").at(-1)))}}static get platform(){let W=typeof navigator<"u"?navigator.platform:"";return(0,n.shadow)(this,"platform",{isWin:W.includes("Win"),isMac:W.includes("Mac")})}exec(W,de){if(!this.allKeys.has(de.key))return;let be=this.callbacks.get(ue(this,k,Bs).call(this,de));be&&(be.bind(W)(),de.stopPropagation(),de.preventDefault())}},m=h;k=new WeakSet,Bs=function(W){W.altKey&&this.buffer.push("alt"),W.ctrlKey&&this.buffer.push("ctrl"),W.metaKey&&this.buffer.push("meta"),W.shiftKey&&this.buffer.push("shift"),this.buffer.push(W.key);let de=this.buffer.join("+");return this.buffer.length=0,de},t.KeyboardManager=m;class A{constructor(){le(this,c,null)}copy(W){W&&(Array.isArray(W)?xe(this,c,W.map(de=>de.serialize())):xe(this,c,[W.serialize()]),xe(this,c,B(this,c).filter(de=>!!de)),B(this,c).length===0&&xe(this,c,null))}paste(){return B(this,c)}isEmpty(){return B(this,c)===null}destroy(){xe(this,c,null)}}c=new WeakMap;let u=class{get _colors(){let W=new Map([["CanvasText",null],["Canvas",null]]);return(0,r.getColorValues)(W),(0,n.shadow)(this,"_colors",W)}convert(W){let de=(0,r.getRGB)(W);if(!window.matchMedia("(forced-colors: active)").matches)return de;for(let[be,Te]of this._colors)if(Te.every((ke,Me)=>ke===de[Me]))return u._colorsMapping.get(be);return de}getHexCode(W){let de=this._colors.get(W);return de?n.Util.makeHexColor(...de):W}},C=u;We(C,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]])),t.ColorManager=C;let ce=class{constructor(W,de){le(this,g);le(this,I);le(this,N);le(this,J);le(this,T);le(this,R);le(this,X);le(this,ge);le(this,oe);le(this,f,null);le(this,M,new Map);le(this,E,new Map);le(this,w,new A);le(this,P,new b);le(this,ne,0);le(this,ie,null);le(this,Z,null);le(this,Y,new S);le(this,j,!1);le(this,U,n.AnnotationEditorType.NONE);le(this,q,new Set);le(this,re,this.keydown.bind(this));le(this,pe,this.onEditingAction.bind(this));le(this,we,this.onPageChanging.bind(this));le(this,H,{isEditing:!1,isEmpty:!0,hasEmptyClipboard:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});le(this,x,null);xe(this,x,W),xe(this,Z,de),B(this,Z)._on("editingaction",B(this,pe)),B(this,Z)._on("pagechanging",B(this,we))}destroy(){ue(this,I,Rr).call(this),B(this,Z)._off("editingaction",B(this,pe)),B(this,Z)._off("pagechanging",B(this,we));for(let W of B(this,E).values())W.destroy();B(this,E).clear(),B(this,M).clear(),xe(this,f,null),B(this,q).clear(),B(this,w).destroy(),B(this,P).destroy()}onPageChanging({pageNumber:W}){xe(this,ne,W-1)}focusMainContainer(){B(this,x).focus()}keydown(W){this.getActive()?.shouldGetKeyboardEvents()||ce._keyboardManager.exec(this,W)}onEditingAction(W){["undo","redo","cut","copy","paste","delete","selectAll"].includes(W.name)&&this[W.name]()}setEditingState(W){W?(ue(this,g,Rs).call(this),ue(this,N,dt).call(this,{isEditing:B(this,U)!==n.AnnotationEditorType.NONE,isEmpty:ue(this,ge,On).call(this),hasSomethingToUndo:B(this,P).hasSomethingToUndo(),hasSomethingToRedo:B(this,P).hasSomethingToRedo(),hasSelectedEditor:!1,hasEmptyClipboard:B(this,w).isEmpty()})):(ue(this,I,Rr).call(this),ue(this,N,dt).call(this,{isEditing:!1}))}registerEditorTypes(W){xe(this,ie,W);for(let de of B(this,ie))ue(this,J,Vn).call(this,de.defaultPropertiesToUpdate)}getId(){return B(this,Y).getId()}addLayer(W){B(this,E).set(W.pageIndex,W),B(this,j)?W.enable():W.disable()}removeLayer(W){B(this,E).delete(W.pageIndex)}updateMode(W){if(xe(this,U,W),W===n.AnnotationEditorType.NONE)this.setEditingState(!1),ue(this,R,Vs).call(this);else{this.setEditingState(!0),ue(this,T,Is).call(this);for(let de of B(this,E).values())de.updateMode(W)}}updateToolbar(W){W!==B(this,U)&&B(this,Z).dispatch("switchannotationeditormode",{source:this,mode:W})}updateParams(W,de){for(let be of B(this,q))be.updateParams(W,de);for(let be of B(this,ie))be.updateDefaultParams(W,de)}getEditors(W){let de=[];for(let be of B(this,M).values())be.pageIndex===W&&de.push(be);return de}getEditor(W){return B(this,M).get(W)}addEditor(W){B(this,M).set(W.id,W)}removeEditor(W){B(this,M).delete(W.id),this.unselect(W)}setActiveEditor(W){B(this,f)!==W&&(xe(this,f,W),W&&ue(this,J,Vn).call(this,W.propertiesToUpdate))}toggleSelected(W){if(B(this,q).has(W)){B(this,q).delete(W),W.unselect(),ue(this,N,dt).call(this,{hasSelectedEditor:this.hasSelection});return}B(this,q).add(W),W.select(),ue(this,J,Vn).call(this,W.propertiesToUpdate),ue(this,N,dt).call(this,{hasSelectedEditor:!0})}setSelected(W){for(let de of B(this,q))de!==W&&de.unselect();B(this,q).clear(),B(this,q).add(W),W.select(),ue(this,J,Vn).call(this,W.propertiesToUpdate),ue(this,N,dt).call(this,{hasSelectedEditor:!0})}isSelected(W){return B(this,q).has(W)}unselect(W){W.unselect(),B(this,q).delete(W),ue(this,N,dt).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return B(this,q).size!==0}undo(){B(this,P).undo(),ue(this,N,dt).call(this,{hasSomethingToUndo:B(this,P).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:ue(this,ge,On).call(this)})}redo(){B(this,P).redo(),ue(this,N,dt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:B(this,P).hasSomethingToRedo(),isEmpty:ue(this,ge,On).call(this)})}addCommands(W){B(this,P).add(W),ue(this,N,dt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:ue(this,ge,On).call(this)})}delete(){if(B(this,f)&&B(this,f).commitOrRemove(),!this.hasSelection)return;let W=[...B(this,q)],de=()=>{for(let Te of W)Te.remove()},be=()=>{for(let Te of W)ue(this,X,Ir).call(this,Te)};this.addCommands({cmd:de,undo:be,mustExec:!0})}copy(){if(B(this,f)&&B(this,f).commitOrRemove(),this.hasSelection){let W=[];for(let de of B(this,q))de.isEmpty()||W.push(de);if(W.length===0)return;B(this,w).copy(W),ue(this,N,dt).call(this,{hasEmptyClipboard:!1})}}cut(){this.copy(),this.delete()}paste(){if(B(this,w).isEmpty())return;this.unselectAll();let W=B(this,E).get(B(this,ne)),de=B(this,w).paste().map(ke=>W.deserialize(ke)),be=()=>{for(let ke of de)ue(this,X,Ir).call(this,ke);ue(this,oe,So).call(this,de)},Te=()=>{for(let ke of de)ke.remove()};this.addCommands({cmd:be,undo:Te,mustExec:!0})}selectAll(){for(let W of B(this,q))W.commit();ue(this,oe,So).call(this,B(this,M).values())}unselectAll(){if(B(this,f)){B(this,f).commitOrRemove();return}if(ue(this,oe,So).size!==0){for(let W of B(this,q))W.unselect();B(this,q).clear(),ue(this,N,dt).call(this,{hasSelectedEditor:!1})}}isActive(W){return B(this,f)===W}getActive(){return B(this,f)}getMode(){return B(this,U)}},_=ce;f=new WeakMap,M=new WeakMap,E=new WeakMap,w=new WeakMap,P=new WeakMap,ne=new WeakMap,ie=new WeakMap,Z=new WeakMap,Y=new WeakMap,j=new WeakMap,U=new WeakMap,q=new WeakMap,re=new WeakMap,pe=new WeakMap,we=new WeakMap,H=new WeakMap,x=new WeakMap,g=new WeakSet,Rs=function(){B(this,x).addEventListener("keydown",B(this,re))},I=new WeakSet,Rr=function(){B(this,x).removeEventListener("keydown",B(this,re))},N=new WeakSet,dt=function(W){Object.entries(W).some(([be,Te])=>B(this,H)[be]!==Te)&&B(this,Z).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(B(this,H),W)})},J=new WeakSet,Vn=function(W){B(this,Z).dispatch("annotationeditorparamschanged",{source:this,details:W})},T=new WeakSet,Is=function(){if(!B(this,j)){xe(this,j,!0);for(let W of B(this,E).values())W.enable()}},R=new WeakSet,Vs=function(){if(this.unselectAll(),B(this,j)){xe(this,j,!1);for(let W of B(this,E).values())W.disable()}},X=new WeakSet,Ir=function(W){let de=B(this,E).get(W.pageIndex);de?de.addOrRebuild(W):this.addEditor(W)},ge=new WeakSet,On=function(){if(B(this,M).size===0)return!0;if(B(this,M).size===1)for(let W of B(this,M).values())return W.isEmpty();return!1},oe=new WeakSet,So=function(W){B(this,q).clear();for(let de of W)de.isEmpty()||(B(this,q).add(de),de.select());ue(this,N,dt).call(this,{hasSelectedEditor:!0})},We(_,"_keyboardManager",new m([[["ctrl+a","mac+meta+a"],ce.prototype.selectAll],[["ctrl+c","mac+meta+c"],ce.prototype.copy],[["ctrl+v","mac+meta+v"],ce.prototype.paste],[["ctrl+x","mac+meta+x"],ce.prototype.cut],[["ctrl+z","mac+meta+z"],ce.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],ce.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],ce.prototype.delete],[["Escape","mac+Escape"],ce.prototype.unselectAll]])),t.AnnotationEditorUIManager=_},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StatTimer=t.RenderingCancelledException=t.PixelsPerInch=t.PageViewport=t.PDFDateString=t.DOMStandardFontDataFactory=t.DOMSVGFactory=t.DOMCanvasFactory=t.DOMCMapReaderFactory=t.AnnotationPrefix=void 0,t.deprecated=u,t.getColorValues=P,t.getCurrentTransform=ne,t.getCurrentTransformInverse=ie,t.getFilenameFromUrl=v,t.getPdfFilenameFromUrl=k,t.getRGB=w,t.getXfaPageViewport=E,t.isDataScheme=l,t.isPdfFile=s,t.isValidFetchUrl=h,t.loadScript=c;var n=e(9),r=e(1);let a="http://www.w3.org/2000/svg",d="pdfjs_internal_id_";t.AnnotationPrefix=d;let Z=class{},S=Z;We(S,"CSS",96),We(S,"PDF",72),We(S,"PDF_TO_CSS_UNITS",Z.CSS/Z.PDF),t.PixelsPerInch=S;class b extends n.BaseCanvasFactory{constructor({ownerDocument:j=globalThis.document}={}){super(),this._document=j}_createCanvas(j,U){let q=this._document.createElement("canvas");return q.width=j,q.height=U,q}}t.DOMCanvasFactory=b;async function m(Y,j=!1){if(h(Y,document.baseURI)){let U=await fetch(Y);if(!U.ok)throw new Error(U.statusText);return j?new Uint8Array(await U.arrayBuffer()):(0,r.stringToBytes)(await U.text())}return new Promise((U,q)=>{let re=new XMLHttpRequest;re.open("GET",Y,!0),j&&(re.responseType="arraybuffer"),re.onreadystatechange=()=>{if(re.readyState===XMLHttpRequest.DONE){if(re.status===200||re.status===0){let pe;if(j&&re.response?pe=new Uint8Array(re.response):!j&&re.responseText&&(pe=(0,r.stringToBytes)(re.responseText)),pe){U(pe);return}}q(new Error(re.statusText))}},re.send(null)})}class A extends n.BaseCMapReaderFactory{_fetchData(j,U){return m(j,this.isCompressed).then(q=>({cMapData:q,compressionType:U}))}}t.DOMCMapReaderFactory=A;class C extends n.BaseStandardFontDataFactory{_fetchData(j){return m(j,!0)}}t.DOMStandardFontDataFactory=C;class _ extends n.BaseSVGFactory{_createSVG(j){return document.createElementNS(a,j)}}t.DOMSVGFactory=_;class F{constructor({viewBox:j,scale:U,rotation:q,offsetX:re=0,offsetY:pe=0,dontFlip:we=!1}){this.viewBox=j,this.scale=U,this.rotation=q,this.offsetX=re,this.offsetY=pe;let H=(j[2]+j[0])/2,x=(j[3]+j[1])/2,g,L,I,V;switch(q%=360,q<0&&(q+=360),q){case 180:g=-1,L=0,I=0,V=1;break;case 90:g=0,L=1,I=1,V=0;break;case 270:g=0,L=-1,I=-1,V=0;break;case 0:g=1,L=0,I=0,V=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}we&&(I=-I,V=-V);let N,K,J,p;g===0?(N=Math.abs(x-j[1])*U+re,K=Math.abs(H-j[0])*U+pe,J=Math.abs(j[3]-j[1])*U,p=Math.abs(j[2]-j[0])*U):(N=Math.abs(H-j[0])*U+re,K=Math.abs(x-j[1])*U+pe,J=Math.abs(j[2]-j[0])*U,p=Math.abs(j[3]-j[1])*U),this.transform=[g*U,L*U,I*U,V*U,N-g*U*H-I*U*x,K-L*U*H-V*U*x],this.width=J,this.height=p}clone({scale:j=this.scale,rotation:U=this.rotation,offsetX:q=this.offsetX,offsetY:re=this.offsetY,dontFlip:pe=!1}={}){return new F({viewBox:this.viewBox.slice(),scale:j,rotation:U,offsetX:q,offsetY:re,dontFlip:pe})}convertToViewportPoint(j,U){return r.Util.applyTransform([j,U],this.transform)}convertToViewportRectangle(j){let U=r.Util.applyTransform([j[0],j[1]],this.transform),q=r.Util.applyTransform([j[2],j[3]],this.transform);return[U[0],U[1],q[0],q[1]]}convertToPdfPoint(j,U){return r.Util.applyInverseTransform([j,U],this.transform)}}t.PageViewport=F;class i extends r.BaseException{constructor(j,U){super(j,"RenderingCancelledException"),this.type=U}}t.RenderingCancelledException=i;function l(Y){let j=Y.length,U=0;for(;U<j&&Y[U].trim()==="";)U++;return Y.substring(U,U+5).toLowerCase()==="data:"}function s(Y){return typeof Y=="string"&&/\.pdf$/i.test(Y)}function v(Y){let j=Y.indexOf("#"),U=Y.indexOf("?"),q=Math.min(j>0?j:Y.length,U>0?U:Y.length);return Y.substring(Y.lastIndexOf("/",q)+1,q)}function k(Y,j="document.pdf"){if(typeof Y!="string")return j;if(l(Y))return(0,r.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),j;let U=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,q=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,re=U.exec(Y),pe=q.exec(re[1])||q.exec(re[2])||q.exec(re[3]);if(pe&&(pe=pe[0],pe.includes("%")))try{pe=q.exec(decodeURIComponent(pe))[0]}catch{}return pe||j}class y{constructor(){this.started=Object.create(null),this.times=[]}time(j){j in this.started&&(0,r.warn)(`Timer is already running for ${j}`),this.started[j]=Date.now()}timeEnd(j){j in this.started||(0,r.warn)(`Timer has not been started for ${j}`),this.times.push({name:j,start:this.started[j],end:Date.now()}),delete this.started[j]}toString(){let j=[],U=0;for(let q of this.times){let re=q.name;re.length>U&&(U=re.length)}for(let q of this.times){let re=q.end-q.start;j.push(`${q.name.padEnd(U)} ${re}ms
`)}return j.join("")}}t.StatTimer=y;function h(Y,j){try{let{protocol:U}=j?new URL(Y,j):new URL(Y);return U==="http:"||U==="https:"}catch{return!1}}function c(Y,j=!1){return new Promise((U,q)=>{let re=document.createElement("script");re.src=Y,re.onload=function(pe){j&&re.remove(),U(pe)},re.onerror=function(){q(new Error(`Cannot load script at: ${re.src}`))},(document.head||document.documentElement).append(re)})}function u(Y){console.log("Deprecated API usage: "+Y)}let f;class M{static toDateObject(j){if(!j||typeof j!="string")return null;f||(f=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));let U=f.exec(j);if(!U)return null;let q=parseInt(U[1],10),re=parseInt(U[2],10);re=re>=1&&re<=12?re-1:0;let pe=parseInt(U[3],10);pe=pe>=1&&pe<=31?pe:1;let we=parseInt(U[4],10);we=we>=0&&we<=23?we:0;let H=parseInt(U[5],10);H=H>=0&&H<=59?H:0;let x=parseInt(U[6],10);x=x>=0&&x<=59?x:0;let g=U[7]||"Z",L=parseInt(U[8],10);L=L>=0&&L<=23?L:0;let I=parseInt(U[9],10)||0;return I=I>=0&&I<=59?I:0,g==="-"?(we+=L,H+=I):g==="+"&&(we-=L,H-=I),new Date(Date.UTC(q,re,pe,we,H,x))}}t.PDFDateString=M;function E(Y,{scale:j=1,rotation:U=0}){let{width:q,height:re}=Y.attributes.style,pe=[0,0,parseInt(q),parseInt(re)];return new F({viewBox:pe,scale:j,rotation:U})}function w(Y){if(Y.startsWith("#")){let j=parseInt(Y.slice(1),16);return[(j&16711680)>>16,(j&65280)>>8,j&255]}return Y.startsWith("rgb(")?Y.slice(4,-1).split(",").map(j=>parseInt(j)):Y.startsWith("rgba(")?Y.slice(5,-1).split(",").map(j=>parseInt(j)).slice(0,3):((0,r.warn)(`Not a valid color format: "${Y}"`),[0,0,0])}function P(Y){let j=document.createElement("span");j.style.visibility="hidden",document.body.append(j);for(let U of Y.keys()){j.style.color=U;let q=window.getComputedStyle(j).color;Y.set(U,w(q))}j.remove()}function ne(Y){let{a:j,b:U,c:q,d:re,e:pe,f:we}=Y.getTransform();return[j,U,q,re,pe,we]}function ie(Y){let{a:j,b:U,c:q,d:re,e:pe,f:we}=Y.getTransform().invertSelf();return[j,U,q,re,pe,we]}},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseStandardFontDataFactory=t.BaseSVGFactory=t.BaseCanvasFactory=t.BaseCMapReaderFactory=void 0;var n=e(1);class r{constructor(){this.constructor===r&&(0,n.unreachable)("Cannot initialize BaseCanvasFactory.")}create(m,A){if(m<=0||A<=0)throw new Error("Invalid canvas size");let C=this._createCanvas(m,A);return{canvas:C,context:C.getContext("2d")}}reset(m,A,C){if(!m.canvas)throw new Error("Canvas is not specified");if(A<=0||C<=0)throw new Error("Invalid canvas size");m.canvas.width=A,m.canvas.height=C}destroy(m){if(!m.canvas)throw new Error("Canvas is not specified");m.canvas.width=0,m.canvas.height=0,m.canvas=null,m.context=null}_createCanvas(m,A){(0,n.unreachable)("Abstract method `_createCanvas` called.")}}t.BaseCanvasFactory=r;class a{constructor({baseUrl:m=null,isCompressed:A=!1}){this.constructor===a&&(0,n.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=m,this.isCompressed=A}async fetch({name:m}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!m)throw new Error("CMap name must be specified.");let A=this.baseUrl+m+(this.isCompressed?".bcmap":""),C=this.isCompressed?n.CMapCompressionType.BINARY:n.CMapCompressionType.NONE;return this._fetchData(A,C).catch(_=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${A}`)})}_fetchData(m,A){(0,n.unreachable)("Abstract method `_fetchData` called.")}}t.BaseCMapReaderFactory=a;class d{constructor({baseUrl:m=null}){this.constructor===d&&(0,n.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=m}async fetch({filename:m}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!m)throw new Error("Font filename must be specified.");let A=`${this.baseUrl}${m}`;return this._fetchData(A).catch(C=>{throw new Error(`Unable to load font data at: ${A}`)})}_fetchData(m){(0,n.unreachable)("Abstract method `_fetchData` called.")}}t.BaseStandardFontDataFactory=d;class S{constructor(){this.constructor===S&&(0,n.unreachable)("Cannot initialize BaseSVGFactory.")}create(m,A,C=!1){if(m<=0||A<=0)throw new Error("Invalid SVG dimensions");let _=this._createSVG("svg:svg");return _.setAttribute("version","1.1"),C||(_.setAttribute("width",`${m}px`),_.setAttribute("height",`${A}px`)),_.setAttribute("preserveAspectRatio","none"),_.setAttribute("viewBox",`0 0 ${m} ${A}`),_}createElement(m){if(typeof m!="string")throw new Error("Invalid SVG element type");return this._createSVG(m)}_createSVG(m){(0,n.unreachable)("Abstract method `_createSVG` called.")}}t.BaseSVGFactory=S},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MurmurHash3_64=void 0;var n=e(1);let r=3285377520,a=4294901760,d=65535;class S{constructor(m){this.h1=m?m&4294967295:r,this.h2=m?m&4294967295:r}update(m){let A,C;if(typeof m=="string"){A=new Uint8Array(m.length*2),C=0;for(let f=0,M=m.length;f<M;f++){let E=m.charCodeAt(f);E<=255?A[C++]=E:(A[C++]=E>>>8,A[C++]=E&255)}}else if((0,n.isArrayBuffer)(m))A=m.slice(),C=A.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");let _=C>>2,F=C-_*4,i=new Uint32Array(A.buffer,0,_),l=0,s=0,v=this.h1,k=this.h2,y=3432918353,h=461845907,c=y&d,u=h&d;for(let f=0;f<_;f++)f&1?(l=i[f],l=l*y&a|l*c&d,l=l<<15|l>>>17,l=l*h&a|l*u&d,v^=l,v=v<<13|v>>>19,v=v*5+3864292196):(s=i[f],s=s*y&a|s*c&d,s=s<<15|s>>>17,s=s*h&a|s*u&d,k^=s,k=k<<13|k>>>19,k=k*5+3864292196);switch(l=0,F){case 3:l^=A[_*4+2]<<16;case 2:l^=A[_*4+1]<<8;case 1:l^=A[_*4],l=l*y&a|l*c&d,l=l<<15|l>>>17,l=l*h&a|l*u&d,_&1?v^=l:k^=l}this.h1=v,this.h2=k}hexdigest(){let m=this.h1,A=this.h2;m^=A>>>1,m=m*3981806797&a|m*36045&d,A=A*4283543511&a|((A<<16|m>>>16)*2950163797&a)>>>16,m^=A>>>1,m=m*444984403&a|m*60499&d,A=A*3301882366&a|((A<<16|m>>>16)*3120437893&a)>>>16,m^=A>>>1;let C=(m>>>0).toString(16),_=(A>>>0).toString(16);return C.padStart(8,"0")+_.padStart(8,"0")}}t.MurmurHash3_64=S},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FontLoader=t.FontFaceObject=void 0;var n=e(1);class r{constructor({docId:b,onUnsupportedFeature:m,ownerDocument:A=globalThis.document,styleElement:C=null}){this.constructor===r&&(0,n.unreachable)("Cannot initialize BaseFontLoader."),this.docId=b,this._onUnsupportedFeature=m,this._document=A,this.nativeFontFaces=[],this.styleElement=null}addNativeFontFace(b){this.nativeFontFaces.push(b),this._document.fonts.add(b)}insertRule(b){let m=this.styleElement;m||(m=this.styleElement=this._document.createElement("style"),m.id=`PDFJS_FONT_STYLE_TAG_${this.docId}`,this._document.documentElement.getElementsByTagName("head")[0].append(m));let A=m.sheet;A.insertRule(b,A.cssRules.length)}clear(){for(let b of this.nativeFontFaces)this._document.fonts.delete(b);this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(b){if(b.attached||b.missingFile)return;if(b.attached=!0,this.isFontLoadingAPISupported){let A=b.createNativeFontFace();if(A){this.addNativeFontFace(A);try{await A.loaded}catch(C){throw this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontLoadNative}),(0,n.warn)(`Failed to load font '${A.family}': '${C}'.`),b.disableFontFace=!0,C}}return}let m=b.createFontFaceRule();if(m){if(this.insertRule(m),this.isSyncFontLoadingSupported)return;await new Promise(A=>{let C=this._queueLoadingCallback(A);this._prepareFontLoadEvent([m],[b],C)})}}_queueLoadingCallback(b){(0,n.unreachable)("Abstract method `_queueLoadingCallback`.")}get isFontLoadingAPISupported(){let b=!!this._document?.fonts;return(0,n.shadow)(this,"isFontLoadingAPISupported",b)}get isSyncFontLoadingSupported(){(0,n.unreachable)("Abstract method `isSyncFontLoadingSupported`.")}get _loadTestFont(){(0,n.unreachable)("Abstract method `_loadTestFont`.")}_prepareFontLoadEvent(b,m,A){(0,n.unreachable)("Abstract method `_prepareFontLoadEvent`.")}}let a;t.FontLoader=a,t.FontLoader=a=class extends r{constructor(b){super(b),this.loadingContext={requests:[],nextRequestId:0},this.loadTestFontId=0}get isSyncFontLoadingSupported(){let b=!1;return(typeof navigator>"u"||/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(navigator.userAgent)?.[1]>=14)&&(b=!0),(0,n.shadow)(this,"isSyncFontLoadingSupported",b)}_queueLoadingCallback(b){function m(){for((0,n.assert)(!C.done,"completeRequest() cannot be called twice."),C.done=!0;A.requests.length>0&&A.requests[0].done;){let _=A.requests.shift();setTimeout(_.callback,0)}}let A=this.loadingContext,C={id:`pdfjs-font-loading-${A.nextRequestId++}`,done:!1,complete:m,callback:b};return A.requests.push(C),C}get _loadTestFont(){let b=function(){return atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==")};return(0,n.shadow)(this,"_loadTestFont",b())}_prepareFontLoadEvent(b,m,A){function C(ie,Z){return ie.charCodeAt(Z)<<24|ie.charCodeAt(Z+1)<<16|ie.charCodeAt(Z+2)<<8|ie.charCodeAt(Z+3)&255}function _(ie,Z,Y,j){let U=ie.substring(0,Z),q=ie.substring(Z+Y);return U+j+q}let F,i,l=this._document.createElement("canvas");l.width=1,l.height=1;let s=l.getContext("2d"),v=0;function k(ie,Z){if(v++,v>30){(0,n.warn)("Load test font never loaded."),Z();return}if(s.font="30px "+ie,s.fillText(".",0,20),s.getImageData(0,0,1,1).data[3]>0){Z();return}setTimeout(k.bind(null,ie,Z))}let y=`lt${Date.now()}${this.loadTestFontId++}`,h=this._loadTestFont;h=_(h,976,y.length,y);let u=16,f=1482184792,M=C(h,u);for(F=0,i=y.length-3;F<i;F+=4)M=M-f+C(y,F)|0;F<y.length&&(M=M-f+C(y+"XXX",F)|0),h=_(h,u,4,(0,n.string32)(M));let E=`url(data:font/opentype;base64,${btoa(h)});`,w=`@font-face {font-family:"${y}";src:${E}}`;this.insertRule(w);let P=[];for(let ie of m)P.push(ie.loadedName);P.push(y);let ne=this._document.createElement("div");ne.style.visibility="hidden",ne.style.width=ne.style.height="10px",ne.style.position="absolute",ne.style.top=ne.style.left="0px";for(let ie of P){let Z=this._document.createElement("span");Z.textContent="Hi",Z.style.fontFamily=ie,ne.append(Z)}this._document.body.append(ne),k(y,()=>{ne.remove(),A.complete()})}};class d{constructor(b,{isEvalSupported:m=!0,disableFontFace:A=!1,ignoreErrors:C=!1,onUnsupportedFeature:_,fontRegistry:F=null}){this.compiledGlyphs=Object.create(null);for(let i in b)this[i]=b[i];this.isEvalSupported=m!==!1,this.disableFontFace=A===!0,this.ignoreErrors=C===!0,this._onUnsupportedFeature=_,this.fontRegistry=F}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let b;if(!this.cssFontInfo)b=new FontFace(this.loadedName,this.data,{});else{let m={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(m.style=`oblique ${this.cssFontInfo.italicAngle}deg`),b=new FontFace(this.cssFontInfo.fontFamily,this.data,m)}return this.fontRegistry&&this.fontRegistry.registerFont(this),b}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;let b=(0,n.bytesToString)(this.data),m=`url(data:${this.mimetype};base64,${btoa(b)});`,A;if(!this.cssFontInfo)A=`@font-face {font-family:"${this.loadedName}";src:${m}}`;else{let C=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(C+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),A=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${C}src:${m}}`}return this.fontRegistry&&this.fontRegistry.registerFont(this,m),A}getPathGenerator(b,m){if(this.compiledGlyphs[m]!==void 0)return this.compiledGlyphs[m];let A;try{A=b.get(this.loadedName+"_path_"+m)}catch(C){if(!this.ignoreErrors)throw C;return this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontGetPath}),(0,n.warn)(`getPathGenerator - ignoring character: "${C}".`),this.compiledGlyphs[m]=function(_,F){}}if(this.isEvalSupported&&n.FeatureTest.isEvalSupported){let C=[];for(let _ of A){let F=_.args!==void 0?_.args.join(","):"";C.push("c.",_.cmd,"(",F,`);
`)}return this.compiledGlyphs[m]=new Function("c","size",C.join(""))}return this.compiledGlyphs[m]=function(C,_){for(let F of A)F.cmd==="scale"&&(F.args=[_,-_]),C[F.cmd].apply(C,F.args)}}}t.FontFaceObject=d},(o,t,e)=>{var re,Vr;Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasGraphics=void 0;var n=e(8),r=e(1),a=e(13),d=e(14),S=e(3);let b=16,m=100,A=4096,C=15,_=10,F=S.isNodeJS&&typeof Path2D>"u"?-1:1e3,i=16;function l(H,x){if(H._removeMirroring)throw new Error("Context is already forwarding operations.");H.__originalSave=H.save,H.__originalRestore=H.restore,H.__originalRotate=H.rotate,H.__originalScale=H.scale,H.__originalTranslate=H.translate,H.__originalTransform=H.transform,H.__originalSetTransform=H.setTransform,H.__originalResetTransform=H.resetTransform,H.__originalClip=H.clip,H.__originalMoveTo=H.moveTo,H.__originalLineTo=H.lineTo,H.__originalBezierCurveTo=H.bezierCurveTo,H.__originalRect=H.rect,H.__originalClosePath=H.closePath,H.__originalBeginPath=H.beginPath,H._removeMirroring=()=>{H.save=H.__originalSave,H.restore=H.__originalRestore,H.rotate=H.__originalRotate,H.scale=H.__originalScale,H.translate=H.__originalTranslate,H.transform=H.__originalTransform,H.setTransform=H.__originalSetTransform,H.resetTransform=H.__originalResetTransform,H.clip=H.__originalClip,H.moveTo=H.__originalMoveTo,H.lineTo=H.__originalLineTo,H.bezierCurveTo=H.__originalBezierCurveTo,H.rect=H.__originalRect,H.closePath=H.__originalClosePath,H.beginPath=H.__originalBeginPath,delete H._removeMirroring},H.save=function(){x.save(),this.__originalSave()},H.restore=function(){x.restore(),this.__originalRestore()},H.translate=function(L,I){x.translate(L,I),this.__originalTranslate(L,I)},H.scale=function(L,I){x.scale(L,I),this.__originalScale(L,I)},H.transform=function(L,I,V,N,K,J){x.transform(L,I,V,N,K,J),this.__originalTransform(L,I,V,N,K,J)},H.setTransform=function(L,I,V,N,K,J){x.setTransform(L,I,V,N,K,J),this.__originalSetTransform(L,I,V,N,K,J)},H.resetTransform=function(){x.resetTransform(),this.__originalResetTransform()},H.rotate=function(L){x.rotate(L),this.__originalRotate(L)},H.clip=function(L){x.clip(L),this.__originalClip(L)},H.moveTo=function(g,L){x.moveTo(g,L),this.__originalMoveTo(g,L)},H.lineTo=function(g,L){x.lineTo(g,L),this.__originalLineTo(g,L)},H.bezierCurveTo=function(g,L,I,V,N,K){x.bezierCurveTo(g,L,I,V,N,K),this.__originalBezierCurveTo(g,L,I,V,N,K)},H.rect=function(g,L,I,V){x.rect(g,L,I,V),this.__originalRect(g,L,I,V)},H.closePath=function(){x.closePath(),this.__originalClosePath()},H.beginPath=function(){x.beginPath(),this.__originalBeginPath()}}class s{constructor(x){this.canvasFactory=x,this.cache=Object.create(null)}getCanvas(x,g,L){let I;return this.cache[x]!==void 0?(I=this.cache[x],this.canvasFactory.reset(I,g,L)):(I=this.canvasFactory.create(g,L),this.cache[x]=I),I}delete(x){delete this.cache[x]}clear(){for(let x in this.cache){let g=this.cache[x];this.canvasFactory.destroy(g),delete this.cache[x]}}}function v(H,x,g,L,I,V,N,K,J,p){let[T,D,R,O,X,ee]=(0,n.getCurrentTransform)(H);if(D===0&&R===0){let oe=N*T+X,se=Math.round(oe),ce=K*O+ee,fe=Math.round(ce),W=(N+J)*T+X,de=Math.abs(Math.round(W)-se)||1,be=(K+p)*O+ee,Te=Math.abs(Math.round(be)-fe)||1;return H.setTransform(Math.sign(T),0,0,Math.sign(O),se,fe),H.drawImage(x,g,L,I,V,0,0,de,Te),H.setTransform(T,D,R,O,X,ee),[de,Te]}if(T===0&&O===0){let oe=K*R+X,se=Math.round(oe),ce=N*D+ee,fe=Math.round(ce),W=(K+p)*R+X,de=Math.abs(Math.round(W)-se)||1,be=(N+J)*D+ee,Te=Math.abs(Math.round(be)-fe)||1;return H.setTransform(0,Math.sign(D),Math.sign(R),0,se,fe),H.drawImage(x,g,L,I,V,0,0,Te,de),H.setTransform(T,D,R,O,X,ee),[Te,de]}H.drawImage(x,g,L,I,V,N,K,J,p);let ge=Math.hypot(T,D),te=Math.hypot(R,O);return[ge*J,te*p]}function k(H){let{width:x,height:g}=H;if(x>F||g>F)return null;let L=1e3,I=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),V=x+1,N=new Uint8Array(V*(g+1)),K,J,p,T=x+7&-8,D=new Uint8Array(T*g),R=0;for(let te of H.data){let oe=128;for(;oe>0;)D[R++]=te&oe?0:255,oe>>=1}let O=0;for(R=0,D[R]!==0&&(N[0]=1,++O),J=1;J<x;J++)D[R]!==D[R+1]&&(N[J]=D[R]?2:1,++O),R++;for(D[R]!==0&&(N[J]=2,++O),K=1;K<g;K++){R=K*T,p=K*V,D[R-T]!==D[R]&&(N[p]=D[R]?1:8,++O);let te=(D[R]?4:0)+(D[R-T]?8:0);for(J=1;J<x;J++)te=(te>>2)+(D[R+1]?4:0)+(D[R-T+1]?8:0),I[te]&&(N[p+J]=I[te],++O),R++;if(D[R-T]!==D[R]&&(N[p+J]=D[R]?2:4,++O),O>L)return null}for(R=T*(g-1),p=K*V,D[R]!==0&&(N[p]=8,++O),J=1;J<x;J++)D[R]!==D[R+1]&&(N[p+J]=D[R]?4:8,++O),R++;if(D[R]!==0&&(N[p+J]=4,++O),O>L)return null;let X=new Int32Array([0,V,-1,0,-V,0,0,0,1]),ee=new Path2D;for(K=0;O&&K<=g;K++){let te=K*V,oe=te+x;for(;te<oe&&!N[te];)te++;if(te===oe)continue;ee.moveTo(te%V,K);let se=te,ce=N[te];do{let fe=X[ce];do te+=fe;while(!N[te]);let W=N[te];W!==5&&W!==10?(ce=W,N[te]=0):(ce=W&51*ce>>4,N[te]&=ce>>2|ce<<2),ee.lineTo(te%V,te/V|0),N[te]||--O}while(se!==te);--K}return D=null,N=null,function(te){te.save(),te.scale(1/x,-1/g),te.translate(0,-g),te.fill(ee),te.beginPath(),te.restore()}}class y{constructor(x,g){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=r.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=r.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps=null,this.startNewPathAndClipBox([0,0,x,g])}clone(){let x=Object.create(this);return x.clipBox=this.clipBox.slice(),x}setCurrentPoint(x,g){this.x=x,this.y=g}updatePathMinMax(x,g,L){[g,L]=r.Util.applyTransform([g,L],x),this.minX=Math.min(this.minX,g),this.minY=Math.min(this.minY,L),this.maxX=Math.max(this.maxX,g),this.maxY=Math.max(this.maxY,L)}updateRectMinMax(x,g){let L=r.Util.applyTransform(g,x),I=r.Util.applyTransform(g.slice(2),x);this.minX=Math.min(this.minX,L[0],I[0]),this.minY=Math.min(this.minY,L[1],I[1]),this.maxX=Math.max(this.maxX,L[0],I[0]),this.maxY=Math.max(this.maxY,L[1],I[1])}updateScalingPathMinMax(x,g){r.Util.scaleMinMax(x,g),this.minX=Math.min(this.minX,g[0]),this.maxX=Math.max(this.maxX,g[1]),this.minY=Math.min(this.minY,g[2]),this.maxY=Math.max(this.maxY,g[3])}updateCurvePathMinMax(x,g,L,I,V,N,K,J,p,T){let D=r.Util.bezierBoundingBox(g,L,I,V,N,K,J,p);if(T){T[0]=Math.min(T[0],D[0],D[2]),T[1]=Math.max(T[1],D[0],D[2]),T[2]=Math.min(T[2],D[1],D[3]),T[3]=Math.max(T[3],D[1],D[3]);return}this.updateRectMinMax(x,D)}getPathBoundingBox(x=a.PathType.FILL,g=null){let L=[this.minX,this.minY,this.maxX,this.maxY];if(x===a.PathType.STROKE){g||(0,r.unreachable)("Stroke bounding box must include transform.");let I=r.Util.singularValueDecompose2dScale(g),V=I[0]*this.lineWidth/2,N=I[1]*this.lineWidth/2;L[0]-=V,L[1]-=N,L[2]+=V,L[3]+=N}return L}updateClipFromPath(){let x=r.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(x||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(x){this.clipBox=x,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(x=a.PathType.FILL,g=null){return r.Util.intersect(this.clipBox,this.getPathBoundingBox(x,g))}}function h(H,x,g=null){if(typeof ImageData<"u"&&x instanceof ImageData){H.putImageData(x,0,0);return}let L=x.height,I=x.width,V=L%i,N=(L-V)/i,K=V===0?N:N+1,J=H.createImageData(I,i),p=0,T,D=x.data,R=J.data,O,X,ee,ge,te,oe,se,ce;if(g)switch(g.length){case 1:te=g[0],oe=g[0],se=g[0],ce=g[0];break;case 4:te=g[0],oe=g[1],se=g[2],ce=g[3];break}if(x.kind===r.ImageKind.GRAYSCALE_1BPP){let fe=D.byteLength,W=new Uint32Array(R.buffer,0,R.byteLength>>2),de=W.length,be=I+7>>3,Te=4294967295,ke=r.FeatureTest.isLittleEndian?4278190080:255;for(ce&&ce[0]===255&&ce[255]===0&&([Te,ke]=[ke,Te]),O=0;O<K;O++){for(ee=O<N?i:V,T=0,X=0;X<ee;X++){let Me=fe-p,nt=0,Ie=Me>be?I:Me*8-7,Nt=Ie&-8,Ee=0,je=0;for(;nt<Nt;nt+=8)je=D[p++],W[T++]=je&128?Te:ke,W[T++]=je&64?Te:ke,W[T++]=je&32?Te:ke,W[T++]=je&16?Te:ke,W[T++]=je&8?Te:ke,W[T++]=je&4?Te:ke,W[T++]=je&2?Te:ke,W[T++]=je&1?Te:ke;for(;nt<Ie;nt++)Ee===0&&(je=D[p++],Ee=128),W[T++]=je&Ee?Te:ke,Ee>>=1}for(;T<de;)W[T++]=0;H.putImageData(J,0,O*i)}}else if(x.kind===r.ImageKind.RGBA_32BPP){let fe=!!(te||oe||se);for(X=0,ge=I*i*4,O=0;O<N;O++){if(R.set(D.subarray(p,p+ge)),p+=ge,fe)for(let W=0;W<ge;W+=4)te&&(R[W+0]=te[R[W+0]]),oe&&(R[W+1]=oe[R[W+1]]),se&&(R[W+2]=se[R[W+2]]);H.putImageData(J,0,X),X+=i}if(O<K){if(ge=I*V*4,R.set(D.subarray(p,p+ge)),fe)for(let W=0;W<ge;W+=4)te&&(R[W+0]=te[R[W+0]]),oe&&(R[W+1]=oe[R[W+1]]),se&&(R[W+2]=se[R[W+2]]);H.putImageData(J,0,X)}}else if(x.kind===r.ImageKind.RGB_24BPP){let fe=!!(te||oe||se);for(ee=i,ge=I*ee,O=0;O<K;O++){for(O>=N&&(ee=V,ge=I*ee),T=0,X=ge;X--;)R[T++]=D[p++],R[T++]=D[p++],R[T++]=D[p++],R[T++]=255;if(fe)for(let W=0;W<T;W+=4)te&&(R[W+0]=te[R[W+0]]),oe&&(R[W+1]=oe[R[W+1]]),se&&(R[W+2]=se[R[W+2]]);H.putImageData(J,0,O*i)}}else throw new Error(`bad image kind: ${x.kind}`)}function c(H,x){if(x.bitmap){H.drawImage(x.bitmap,0,0);return}let g=x.height,L=x.width,I=g%i,V=(g-I)/i,N=I===0?V:V+1,K=H.createImageData(L,i),J=0,p=x.data,T=K.data;for(let D=0;D<N;D++){let R=D<V?i:I;({srcPos:J}=(0,d.applyMaskImageData)({src:p,srcPos:J,dest:T,width:L,height:R})),H.putImageData(K,0,D*i)}}function u(H,x){let g=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"];for(let L=0,I=g.length;L<I;L++){let V=g[L];H[V]!==void 0&&(x[V]=H[V])}H.setLineDash!==void 0&&(x.setLineDash(H.getLineDash()),x.lineDashOffset=H.lineDashOffset)}function f(H,x){H.strokeStyle=H.fillStyle=x||"#000000",H.fillRule="nonzero",H.globalAlpha=1,H.lineWidth=1,H.lineCap="butt",H.lineJoin="miter",H.miterLimit=10,H.globalCompositeOperation="source-over",H.font="10px sans-serif",H.setLineDash!==void 0&&(H.setLineDash([]),H.lineDashOffset=0)}function M(H,x,g,L){let I=H.length;for(let V=3;V<I;V+=4){let N=H[V];if(N===0)H[V-3]=x,H[V-2]=g,H[V-1]=L;else if(N<255){let K=255-N;H[V-3]=H[V-3]*N+x*K>>8,H[V-2]=H[V-2]*N+g*K>>8,H[V-1]=H[V-1]*N+L*K>>8}}}function E(H,x,g){let L=H.length,I=1/255;for(let V=3;V<L;V+=4){let N=g?g[H[V]]:H[V];x[V]=x[V]*N*I|0}}function w(H,x,g){let L=H.length;for(let I=3;I<L;I+=4){let V=H[I-3]*77+H[I-2]*152+H[I-1]*28;x[I]=g?x[I]*g[V>>8]>>8:x[I]*V>>16}}function P(H,x,g,L,I,V,N,K,J,p,T){let D=!!V,R=D?V[0]:0,O=D?V[1]:0,X=D?V[2]:0,ee;I==="Luminosity"?ee=w:ee=E;let te=Math.min(L,Math.ceil(1048576/g));for(let oe=0;oe<L;oe+=te){let se=Math.min(te,L-oe),ce=H.getImageData(K-p,oe+(J-T),g,se),fe=x.getImageData(K,oe+J,g,se);D&&M(ce.data,R,O,X),ee(ce.data,fe.data,N),x.putImageData(fe,K,oe+J)}}function ne(H,x,g,L){let I=L[0],V=L[1],N=L[2]-I,K=L[3]-V;N===0||K===0||(P(x.context,g,N,K,x.subtype,x.backdrop,x.transferMap,I,V,x.offsetX,x.offsetY),H.save(),H.globalAlpha=1,H.globalCompositeOperation="source-over",H.setTransform(1,0,0,1,0,0),H.drawImage(g.canvas,0,0),H.restore())}function ie(H,x){let g=r.Util.singularValueDecompose2dScale(H);g[0]=Math.fround(g[0]),g[1]=Math.fround(g[1]);let L=Math.fround((globalThis.devicePixelRatio||1)*n.PixelsPerInch.PDF_TO_CSS_UNITS);return x!==void 0?x:g[0]<=L||g[1]<=L}let Z=["butt","round","square"],Y=["miter","round","bevel"],j={},U={},we=class{constructor(x,g,L,I,V,N,K,J){le(this,re);this.ctx=x,this.current=new y(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=g,this.objs=L,this.canvasFactory=I,this.imageLayer=V,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=[],this.optionalContentConfig=N,this.cachedCanvases=new s(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=K,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.backgroundColor=J?.background||null,this.foregroundColor=J?.foreground||null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(x,g=null){return typeof x=="string"?x.startsWith("g_")?this.commonObjs.get(x):this.objs.get(x):g}beginDrawing({transform:x,viewport:g,transparency:L=!1,background:I=null}){let V=this.ctx.canvas.width,N=this.ctx.canvas.height,K=I||"#ffffff";if(this.ctx.save(),this.foregroundColor&&this.backgroundColor){this.ctx.fillStyle=this.foregroundColor;let J=this.foregroundColor=this.ctx.fillStyle;this.ctx.fillStyle=this.backgroundColor;let p=this.backgroundColor=this.ctx.fillStyle,T=!0,D=K;if(this.ctx.fillStyle=K,D=this.ctx.fillStyle,T=typeof D=="string"&&/^#[0-9A-Fa-f]{6}$/.test(D),J==="#000000"&&p==="#ffffff"||J===p||!T)this.foregroundColor=this.backgroundColor=null;else{let[R,O,X]=(0,n.getRGB)(D),ee=te=>(te/=255,te<=.03928?te/12.92:((te+.055)/1.055)**2.4),ge=Math.round(.2126*ee(R)+.7152*ee(O)+.0722*ee(X));this.selectColor=(te,oe,se)=>{let ce=.2126*ee(te)+.7152*ee(oe)+.0722*ee(se);return Math.round(ce)===ge?p:J}}}if(this.ctx.fillStyle=this.backgroundColor||K,this.ctx.fillRect(0,0,V,N),this.ctx.restore(),L){let J=this.cachedCanvases.getCanvas("transparent",V,N);this.compositeCtx=this.ctx,this.transparentCanvas=J.canvas,this.ctx=J.context,this.ctx.save(),this.ctx.transform(...(0,n.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),f(this.ctx,this.foregroundColor),x&&(this.ctx.transform(...x),this.outputScaleX=x[0],this.outputScaleY=x[0]),this.ctx.transform(...g.transform),this.viewportScale=g.scale,this.baseTransform=(0,n.getCurrentTransform)(this.ctx),this.imageLayer&&((0,n.deprecated)("The `imageLayer` functionality will be removed in the future."),this.imageLayer.beginLayout())}executeOperatorList(x,g,L,I){let V=x.argsArray,N=x.fnArray,K=g||0,J=V.length;if(J===K)return K;let p=J-K>_&&typeof L=="function",T=p?Date.now()+C:0,D=0,R=this.commonObjs,O=this.objs,X;for(;;){if(I!==void 0&&K===I.nextBreakPoint)return I.breakIt(K,L),K;if(X=N[K],X!==r.OPS.dependency)this[X].apply(this,V[K]);else for(let ee of V[K]){let ge=ee.startsWith("g_")?R:O;if(!ge.has(ee))return ge.get(ee,L),K}if(K++,K===J)return K;if(p&&++D>_){if(Date.now()>T)return L(),K;D=0}}}endDrawing(){ue(this,re,Vr).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let x of this._cachedBitmapsMap.values()){for(let g of x.values())typeof HTMLCanvasElement<"u"&&g instanceof HTMLCanvasElement&&(g.width=g.height=0);x.clear()}this._cachedBitmapsMap.clear(),this.imageLayer&&this.imageLayer.endLayout()}_scaleImage(x,g){let L=x.width,I=x.height,V=Math.max(Math.hypot(g[0],g[1]),1),N=Math.max(Math.hypot(g[2],g[3]),1),K=L,J=I,p="prescale1",T,D;for(;V>2&&K>1||N>2&&J>1;){let R=K,O=J;V>2&&K>1&&(R=Math.ceil(K/2),V/=K/R),N>2&&J>1&&(O=Math.ceil(J/2),N/=J/O),T=this.cachedCanvases.getCanvas(p,R,O),D=T.context,D.clearRect(0,0,R,O),D.drawImage(x,0,0,K,J,0,0,R,O),x=T.canvas,K=R,J=O,p=p==="prescale1"?"prescale2":"prescale1"}return{img:x,paintWidth:K,paintHeight:J}}_createMaskCanvas(x){let g=this.ctx,{width:L,height:I}=x,V=this.current.fillColor,N=this.current.patternFill,K=(0,n.getCurrentTransform)(g),J,p,T,D;if((x.bitmap||x.data)&&x.count>1){let de=x.bitmap||x.data.buffer,be=K.slice(0,4);p=JSON.stringify(N?be:[be,V]),J=this._cachedBitmapsMap.get(de),J||(J=new Map,this._cachedBitmapsMap.set(de,J));let Te=J.get(p);if(Te&&!N){let ke=Math.round(Math.min(K[0],K[2])+K[4]),Me=Math.round(Math.min(K[1],K[3])+K[5]);return{canvas:Te,offsetX:ke,offsetY:Me}}T=Te}T||(D=this.cachedCanvases.getCanvas("maskCanvas",L,I),c(D.context,x));let R=r.Util.transform(K,[1/L,0,0,-1/I,0,0]);R=r.Util.transform(R,[1,0,0,1,0,-I]);let O=r.Util.applyTransform([0,0],R),X=r.Util.applyTransform([L,I],R),ee=r.Util.normalizeRect([O[0],O[1],X[0],X[1]]),ge=Math.round(ee[2]-ee[0])||1,te=Math.round(ee[3]-ee[1])||1,oe=this.cachedCanvases.getCanvas("fillCanvas",ge,te),se=oe.context,ce=Math.min(O[0],X[0]),fe=Math.min(O[1],X[1]);se.translate(-ce,-fe),se.transform(...R),T||(T=this._scaleImage(D.canvas,(0,n.getCurrentTransformInverse)(se)),T=T.img,J&&N&&J.set(p,T)),se.imageSmoothingEnabled=ie((0,n.getCurrentTransform)(se),x.interpolate),v(se,T,0,0,T.width,T.height,0,0,L,I),se.globalCompositeOperation="source-in";let W=r.Util.transform((0,n.getCurrentTransformInverse)(se),[1,0,0,1,-ce,-fe]);return se.fillStyle=N?V.getPattern(g,this,W,a.PathType.FILL):V,se.fillRect(0,0,L,I),J&&!N&&(this.cachedCanvases.delete("fillCanvas"),J.set(p,oe.canvas)),{canvas:oe.canvas,offsetX:Math.round(ce),offsetY:Math.round(fe)}}setLineWidth(x){x!==this.current.lineWidth&&(this._cachedScaleForStroking=null),this.current.lineWidth=x,this.ctx.lineWidth=x}setLineCap(x){this.ctx.lineCap=Z[x]}setLineJoin(x){this.ctx.lineJoin=Y[x]}setMiterLimit(x){this.ctx.miterLimit=x}setDash(x,g){let L=this.ctx;L.setLineDash!==void 0&&(L.setLineDash(x),L.lineDashOffset=g)}setRenderingIntent(x){}setFlatness(x){}setGState(x){for(let g=0,L=x.length;g<L;g++){let I=x[g],V=I[0],N=I[1];switch(V){case"LW":this.setLineWidth(N);break;case"LC":this.setLineCap(N);break;case"LJ":this.setLineJoin(N);break;case"ML":this.setMiterLimit(N);break;case"D":this.setDash(N[0],N[1]);break;case"RI":this.setRenderingIntent(N);break;case"FL":this.setFlatness(N);break;case"Font":this.setFont(N[0],N[1]);break;case"CA":this.current.strokeAlpha=I[1];break;case"ca":this.current.fillAlpha=I[1],this.ctx.globalAlpha=I[1];break;case"BM":this.ctx.globalCompositeOperation=N;break;case"SMask":this.current.activeSMask=N?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.current.transferMaps=N}}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let x=this.inSMaskMode;this.current.activeSMask&&!x?this.beginSMaskMode():!this.current.activeSMask&&x&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let x=this.ctx.canvas.width,g=this.ctx.canvas.height,L="smaskGroupAt"+this.groupLevel,I=this.cachedCanvases.getCanvas(L,x,g);this.suspendedCtx=this.ctx,this.ctx=I.context;let V=this.ctx;V.setTransform(...(0,n.getCurrentTransform)(this.suspendedCtx)),u(this.suspendedCtx,V),l(V,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),u(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(x){if(!this.current.activeSMask)return;x?(x[0]=Math.floor(x[0]),x[1]=Math.floor(x[1]),x[2]=Math.ceil(x[2]),x[3]=Math.ceil(x[3])):x=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let g=this.current.activeSMask,L=this.suspendedCtx;ne(L,g,this.ctx,x),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(u(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let x=this.current;this.stateStack.push(x),this.current=x.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),u(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null)}transform(x,g,L,I,V,N){this.ctx.transform(x,g,L,I,V,N),this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null}constructPath(x,g,L){let I=this.ctx,V=this.current,N=V.x,K=V.y,J,p,T=(0,n.getCurrentTransform)(I),D=T[0]===0&&T[3]===0||T[1]===0&&T[2]===0,R=D?L.slice(0):null;for(let O=0,X=0,ee=x.length;O<ee;O++)switch(x[O]|0){case r.OPS.rectangle:N=g[X++],K=g[X++];let ge=g[X++],te=g[X++],oe=N+ge,se=K+te;I.moveTo(N,K),ge===0||te===0?I.lineTo(oe,se):(I.lineTo(oe,K),I.lineTo(oe,se),I.lineTo(N,se)),D||V.updateRectMinMax(T,[N,K,oe,se]),I.closePath();break;case r.OPS.moveTo:N=g[X++],K=g[X++],I.moveTo(N,K),D||V.updatePathMinMax(T,N,K);break;case r.OPS.lineTo:N=g[X++],K=g[X++],I.lineTo(N,K),D||V.updatePathMinMax(T,N,K);break;case r.OPS.curveTo:J=N,p=K,N=g[X+4],K=g[X+5],I.bezierCurveTo(g[X],g[X+1],g[X+2],g[X+3],N,K),V.updateCurvePathMinMax(T,J,p,g[X],g[X+1],g[X+2],g[X+3],N,K,R),X+=6;break;case r.OPS.curveTo2:J=N,p=K,I.bezierCurveTo(N,K,g[X],g[X+1],g[X+2],g[X+3]),V.updateCurvePathMinMax(T,J,p,N,K,g[X],g[X+1],g[X+2],g[X+3],R),N=g[X+2],K=g[X+3],X+=4;break;case r.OPS.curveTo3:J=N,p=K,N=g[X+2],K=g[X+3],I.bezierCurveTo(g[X],g[X+1],N,K,N,K),V.updateCurvePathMinMax(T,J,p,g[X],g[X+1],N,K,N,K,R),X+=4;break;case r.OPS.closePath:I.closePath();break}D&&V.updateScalingPathMinMax(T,R),V.setCurrentPoint(N,K)}closePath(){this.ctx.closePath()}stroke(x){x=typeof x<"u"?x:!0;let g=this.ctx,L=this.current.strokeColor;g.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof L=="object"&&L?.getPattern?(g.save(),g.strokeStyle=L.getPattern(g,this,(0,n.getCurrentTransformInverse)(g),a.PathType.STROKE),this.rescaleAndStroke(!1),g.restore()):this.rescaleAndStroke(!0)),x&&this.consumePath(this.current.getClippedPathBoundingBox()),g.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(x){x=typeof x<"u"?x:!0;let g=this.ctx,L=this.current.fillColor,I=this.current.patternFill,V=!1;I&&(g.save(),g.fillStyle=L.getPattern(g,this,(0,n.getCurrentTransformInverse)(g),a.PathType.FILL),V=!0);let N=this.current.getClippedPathBoundingBox();this.contentVisible&&N!==null&&(this.pendingEOFill?(g.fill("evenodd"),this.pendingEOFill=!1):g.fill()),V&&g.restore(),x&&this.consumePath(N)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=j}eoClip(){this.pendingClip=U}beginText(){this.current.textMatrix=r.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let x=this.pendingTextPaths,g=this.ctx;if(x===void 0){g.beginPath();return}g.save(),g.beginPath();for(let L of x)g.setTransform(...L.transform),g.translate(L.x,L.y),L.addToPath(g,L.fontSize);g.restore(),g.clip(),g.beginPath(),delete this.pendingTextPaths}setCharSpacing(x){this.current.charSpacing=x}setWordSpacing(x){this.current.wordSpacing=x}setHScale(x){this.current.textHScale=x/100}setLeading(x){this.current.leading=-x}setFont(x,g){let L=this.commonObjs.get(x),I=this.current;if(!L)throw new Error(`Can't find font for ${x}`);if(I.fontMatrix=L.fontMatrix||r.FONT_IDENTITY_MATRIX,(I.fontMatrix[0]===0||I.fontMatrix[3]===0)&&(0,r.warn)("Invalid font matrix for font "+x),g<0?(g=-g,I.fontDirection=-1):I.fontDirection=1,this.current.font=L,this.current.fontSize=g,L.isType3Font)return;let V=L.loadedName||"sans-serif",N="normal";L.black?N="900":L.bold&&(N="bold");let K=L.italic?"italic":"normal",J=`"${V}", ${L.fallbackName}`,p=g;g<b?p=b:g>m&&(p=m),this.current.fontSizeScale=g/p,this.ctx.font=`${K} ${N} ${p}px ${J}`}setTextRenderingMode(x){this.current.textRenderingMode=x}setTextRise(x){this.current.textRise=x}moveText(x,g){this.current.x=this.current.lineX+=x,this.current.y=this.current.lineY+=g}setLeadingMoveText(x,g){this.setLeading(-g),this.moveText(x,g)}setTextMatrix(x,g,L,I,V,N){this.current.textMatrix=[x,g,L,I,V,N],this.current.textMatrixScale=Math.hypot(x,g),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(x,g,L,I){let V=this.ctx,N=this.current,K=N.font,J=N.textRenderingMode,p=N.fontSize/N.fontSizeScale,T=J&r.TextRenderingMode.FILL_STROKE_MASK,D=!!(J&r.TextRenderingMode.ADD_TO_PATH_FLAG),R=N.patternFill&&!K.missingFile,O;(K.disableFontFace||D||R)&&(O=K.getPathGenerator(this.commonObjs,x)),K.disableFontFace||R?(V.save(),V.translate(g,L),V.beginPath(),O(V,p),I&&V.setTransform(...I),(T===r.TextRenderingMode.FILL||T===r.TextRenderingMode.FILL_STROKE)&&V.fill(),(T===r.TextRenderingMode.STROKE||T===r.TextRenderingMode.FILL_STROKE)&&V.stroke(),V.restore()):((T===r.TextRenderingMode.FILL||T===r.TextRenderingMode.FILL_STROKE)&&V.fillText(x,g,L),(T===r.TextRenderingMode.STROKE||T===r.TextRenderingMode.FILL_STROKE)&&V.strokeText(x,g,L)),D&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,n.getCurrentTransform)(V),x:g,y:L,fontSize:p,addToPath:O})}get isFontSubpixelAAEnabled(){let{context:x}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);x.scale(1.5,1),x.fillText("I",0,10);let g=x.getImageData(0,0,10,10).data,L=!1;for(let I=3;I<g.length;I+=4)if(g[I]>0&&g[I]<255){L=!0;break}return(0,r.shadow)(this,"isFontSubpixelAAEnabled",L)}showText(x){let g=this.current,L=g.font;if(L.isType3Font)return this.showType3Text(x);let I=g.fontSize;if(I===0)return;let V=this.ctx,N=g.fontSizeScale,K=g.charSpacing,J=g.wordSpacing,p=g.fontDirection,T=g.textHScale*p,D=x.length,R=L.vertical,O=R?1:-1,X=L.defaultVMetrics,ee=I*g.fontMatrix[0],ge=g.textRenderingMode===r.TextRenderingMode.FILL&&!L.disableFontFace&&!g.patternFill;V.save(),V.transform(...g.textMatrix),V.translate(g.x,g.y+g.textRise),p>0?V.scale(T,-1):V.scale(T,1);let te;if(g.patternFill){V.save();let W=g.fillColor.getPattern(V,this,(0,n.getCurrentTransformInverse)(V),a.PathType.FILL);te=(0,n.getCurrentTransform)(V),V.restore(),V.fillStyle=W}let oe=g.lineWidth,se=g.textMatrixScale;if(se===0||oe===0){let W=g.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;(W===r.TextRenderingMode.STROKE||W===r.TextRenderingMode.FILL_STROKE)&&(oe=this.getSinglePixelWidth())}else oe/=se;N!==1&&(V.scale(N,N),oe/=N),V.lineWidth=oe;let ce=0,fe;for(fe=0;fe<D;++fe){let W=x[fe];if(typeof W=="number"){ce+=O*W*I/1e3;continue}let de=!1,be=(W.isSpace?J:0)+K,Te=W.fontChar,ke=W.accent,Me,nt,Ie=W.width;if(R){let Ee=W.vmetric||X,je=-(W.vmetric?Ee[1]:Ie*.5)*ee,no=Ee[2]*ee;Ie=Ee?-Ee[0]:Ie,Me=je/N,nt=(ce+no)/N}else Me=ce/N,nt=0;if(L.remeasure&&Ie>0){let Ee=V.measureText(Te).width*1e3/I*N;if(Ie<Ee&&this.isFontSubpixelAAEnabled){let je=Ie/Ee;de=!0,V.save(),V.scale(je,1),Me/=je}else Ie!==Ee&&(Me+=(Ie-Ee)/2e3*I/N)}if(this.contentVisible&&(W.isInFont||L.missingFile)){if(ge&&!ke)V.fillText(Te,Me,nt);else if(this.paintChar(Te,Me,nt,te),ke){let Ee=Me+I*ke.offset.x/N,je=nt-I*ke.offset.y/N;this.paintChar(ke.fontChar,Ee,je,te)}}let Nt;R?Nt=Ie*ee-be*p:Nt=Ie*ee+be*p,ce+=Nt,de&&V.restore()}R?g.y-=ce:g.x+=ce*T,V.restore(),this.compose()}showType3Text(x){let g=this.ctx,L=this.current,I=L.font,V=L.fontSize,N=L.fontDirection,K=I.vertical?1:-1,J=L.charSpacing,p=L.wordSpacing,T=L.textHScale*N,D=L.fontMatrix||r.FONT_IDENTITY_MATRIX,R=x.length,O=L.textRenderingMode===r.TextRenderingMode.INVISIBLE,X,ee,ge,te;if(!(O||V===0)){for(this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,g.save(),g.transform(...L.textMatrix),g.translate(L.x,L.y),g.scale(T,N),X=0;X<R;++X){if(ee=x[X],typeof ee=="number"){te=K*ee*V/1e3,this.ctx.translate(te,0),L.x+=te*T;continue}let oe=(ee.isSpace?p:0)+J,se=I.charProcOperatorList[ee.operatorListId];if(!se){(0,r.warn)(`Type3 character "${ee.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=ee,this.save(),g.scale(V,V),g.transform(...D),this.executeOperatorList(se),this.restore()),ge=r.Util.applyTransform([ee.width,0],D)[0]*V+oe,g.translate(ge,0),L.x+=ge*T}g.restore(),this.processingType3=null}}setCharWidth(x,g){}setCharWidthAndBounds(x,g,L,I,V,N){this.ctx.rect(L,I,V-L,N-I),this.ctx.clip(),this.endPath()}getColorN_Pattern(x){let g;if(x[0]==="TilingPattern"){let L=x[1],I=this.baseTransform||(0,n.getCurrentTransform)(this.ctx),V={createCanvasGraphics:N=>new we(N,this.commonObjs,this.objs,this.canvasFactory)};g=new a.TilingPattern(x,L,this.ctx,V,I)}else g=this._getPattern(x[1],x[2]);return g}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(x,g,L){let I=this.selectColor?.(x,g,L)||r.Util.makeHexColor(x,g,L);this.ctx.strokeStyle=I,this.current.strokeColor=I}setFillRGBColor(x,g,L){let I=this.selectColor?.(x,g,L)||r.Util.makeHexColor(x,g,L);this.ctx.fillStyle=I,this.current.fillColor=I,this.current.patternFill=!1}_getPattern(x,g=null){let L;return this.cachedPatterns.has(x)?L=this.cachedPatterns.get(x):(L=(0,a.getShadingPattern)(this.objs.get(x)),this.cachedPatterns.set(x,L)),g&&(L.matrix=g),L}shadingFill(x){if(!this.contentVisible)return;let g=this.ctx;this.save();let L=this._getPattern(x);g.fillStyle=L.getPattern(g,this,(0,n.getCurrentTransformInverse)(g),a.PathType.SHADING);let I=(0,n.getCurrentTransformInverse)(g);if(I){let V=g.canvas,N=V.width,K=V.height,J=r.Util.applyTransform([0,0],I),p=r.Util.applyTransform([0,K],I),T=r.Util.applyTransform([N,0],I),D=r.Util.applyTransform([N,K],I),R=Math.min(J[0],p[0],T[0],D[0]),O=Math.min(J[1],p[1],T[1],D[1]),X=Math.max(J[0],p[0],T[0],D[0]),ee=Math.max(J[1],p[1],T[1],D[1]);this.ctx.fillRect(R,O,X-R,ee-O)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,r.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,r.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(x,g){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(x)&&x.length===6&&this.transform(...x),this.baseTransform=(0,n.getCurrentTransform)(this.ctx),g)){let L=g[2]-g[0],I=g[3]-g[1];this.ctx.rect(g[0],g[1],L,I),this.current.updateRectMinMax((0,n.getCurrentTransform)(this.ctx),g),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(x){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let g=this.ctx;x.isolated||(0,r.info)("TODO: Support non-isolated groups."),x.knockout&&(0,r.warn)("Knockout groups not supported.");let L=(0,n.getCurrentTransform)(g);if(x.matrix&&g.transform(...x.matrix),!x.bbox)throw new Error("Bounding box is required.");let I=r.Util.getAxialAlignedBoundingBox(x.bbox,(0,n.getCurrentTransform)(g)),V=[0,0,g.canvas.width,g.canvas.height];I=r.Util.intersect(I,V)||[0,0,0,0];let N=Math.floor(I[0]),K=Math.floor(I[1]),J=Math.max(Math.ceil(I[2])-N,1),p=Math.max(Math.ceil(I[3])-K,1),T=1,D=1;J>A&&(T=J/A,J=A),p>A&&(D=p/A,p=A),this.current.startNewPathAndClipBox([0,0,J,p]);let R="groupAt"+this.groupLevel;x.smask&&(R+="_smask_"+this.smaskCounter++%2);let O=this.cachedCanvases.getCanvas(R,J,p),X=O.context;X.scale(1/T,1/D),X.translate(-N,-K),X.transform(...L),x.smask?this.smaskStack.push({canvas:O.canvas,context:X,offsetX:N,offsetY:K,scaleX:T,scaleY:D,subtype:x.smask.subtype,backdrop:x.smask.backdrop,transferMap:x.smask.transferMap||null,startTransformInverse:null}):(g.setTransform(1,0,0,1,0,0),g.translate(N,K),g.scale(T,D),g.save()),u(g,X),this.ctx=X,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(g),this.groupLevel++}endGroup(x){if(!this.contentVisible)return;this.groupLevel--;let g=this.ctx,L=this.groupStack.pop();if(this.ctx=L,this.ctx.imageSmoothingEnabled=!1,x.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let I=(0,n.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...I);let V=r.Util.getAxialAlignedBoundingBox([0,0,g.canvas.width,g.canvas.height],I);this.ctx.drawImage(g.canvas,0,0),this.ctx.restore(),this.compose(V)}}beginAnnotation(x,g,L,I,V){if(ue(this,re,Vr).call(this),f(this.ctx,this.foregroundColor),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(g)&&g.length===4){let N=g[2]-g[0],K=g[3]-g[1];if(V&&this.annotationCanvasMap){L=L.slice(),L[4]-=g[0],L[5]-=g[1],g=g.slice(),g[0]=g[1]=0,g[2]=N,g[3]=K;let[J,p]=r.Util.singularValueDecompose2dScale((0,n.getCurrentTransform)(this.ctx)),{viewportScale:T}=this,D=Math.ceil(N*this.outputScaleX*T),R=Math.ceil(K*this.outputScaleY*T);this.annotationCanvas=this.canvasFactory.create(D,R);let{canvas:O,context:X}=this.annotationCanvas;this.annotationCanvasMap.set(x,O),this.annotationCanvas.savedCtx=this.ctx,this.ctx=X,this.ctx.setTransform(J,0,0,-p,0,K*p),f(this.ctx,this.foregroundColor)}else f(this.ctx,this.foregroundColor),this.ctx.rect(g[0],g[1],N,K),this.ctx.clip(),this.endPath()}this.current=new y(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...L),this.transform(...I)}endAnnotation(){this.annotationCanvas&&(this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(x){if(!this.contentVisible)return;let g=x.count;x=this.getObject(x.data,x),x.count=g;let L=this.ctx,I=this.processingType3;if(I&&(I.compiled===void 0&&(I.compiled=k(x)),I.compiled)){I.compiled(L);return}let V=this._createMaskCanvas(x),N=V.canvas;L.save(),L.setTransform(1,0,0,1,0,0),L.drawImage(N,V.offsetX,V.offsetY),L.restore(),this.compose()}paintImageMaskXObjectRepeat(x,g,L=0,I=0,V,N){if(!this.contentVisible)return;x=this.getObject(x.data,x);let K=this.ctx;K.save();let J=(0,n.getCurrentTransform)(K);K.transform(g,L,I,V,0,0);let p=this._createMaskCanvas(x);K.setTransform(1,0,0,1,0,0);for(let T=0,D=N.length;T<D;T+=2){let R=r.Util.transform(J,[g,L,I,V,N[T],N[T+1]]),[O,X]=r.Util.applyTransform([0,0],R);K.drawImage(p.canvas,O,X)}K.restore(),this.compose()}paintImageMaskXObjectGroup(x){if(!this.contentVisible)return;let g=this.ctx,L=this.current.fillColor,I=this.current.patternFill;for(let V of x){let{data:N,width:K,height:J,transform:p}=V,T=this.cachedCanvases.getCanvas("maskCanvas",K,J),D=T.context;D.save();let R=this.getObject(N,V);c(D,R),D.globalCompositeOperation="source-in",D.fillStyle=I?L.getPattern(D,this,(0,n.getCurrentTransformInverse)(g),a.PathType.FILL):L,D.fillRect(0,0,K,J),D.restore(),g.save(),g.transform(...p),g.scale(1,-1),v(g,T.canvas,0,0,K,J,0,-1,1,1),g.restore()}this.compose()}paintImageXObject(x){if(!this.contentVisible)return;let g=this.getObject(x);if(!g){(0,r.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(g)}paintImageXObjectRepeat(x,g,L,I){if(!this.contentVisible)return;let V=this.getObject(x);if(!V){(0,r.warn)("Dependent image isn't ready yet");return}let N=V.width,K=V.height,J=[];for(let p=0,T=I.length;p<T;p+=2)J.push({transform:[g,0,0,L,I[p],I[p+1]],x:0,y:0,w:N,h:K});this.paintInlineImageXObjectGroup(V,J)}paintInlineImageXObject(x){if(!this.contentVisible)return;let g=x.width,L=x.height,I=this.ctx;this.save(),I.scale(1/g,-1/L);let V;if(typeof HTMLElement=="function"&&x instanceof HTMLElement||!x.data)V=x;else{let p=this.cachedCanvases.getCanvas("inlineImage",g,L),T=p.context;h(T,x,this.current.transferMaps),V=p.canvas}let N=this._scaleImage(V,(0,n.getCurrentTransformInverse)(I));I.imageSmoothingEnabled=ie((0,n.getCurrentTransform)(I),x.interpolate);let[K,J]=v(I,N.img,0,0,N.paintWidth,N.paintHeight,0,-L,g,L);if(this.imageLayer){let[p,T]=r.Util.applyTransform([0,-L],(0,n.getCurrentTransform)(this.ctx));this.imageLayer.appendImage({imgData:x,left:p,top:T,width:K,height:J})}this.compose(),this.restore()}paintInlineImageXObjectGroup(x,g){if(!this.contentVisible)return;let L=this.ctx,I=x.width,V=x.height,N=this.cachedCanvases.getCanvas("inlineImage",I,V),K=N.context;h(K,x,this.current.transferMaps);for(let J of g){if(L.save(),L.transform(...J.transform),L.scale(1,-1),v(L,N.canvas,J.x,J.y,J.w,J.h,0,-1,1,1),this.imageLayer){let[p,T]=r.Util.applyTransform([J.x,J.y],(0,n.getCurrentTransform)(this.ctx));this.imageLayer.appendImage({imgData:x,left:p,top:T,width:I,height:V})}L.restore()}this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(x){}markPointProps(x,g){}beginMarkedContent(x){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(x,g){x==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(g)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(x){let g=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(x);let L=this.ctx;this.pendingClip&&(g||(this.pendingClip===U?L.clip("evenodd"):L.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),L.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let x=(0,n.getCurrentTransform)(this.ctx);if(x[1]===0&&x[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(x[0]),Math.abs(x[3]));else{let g=Math.abs(x[0]*x[3]-x[2]*x[1]),L=Math.hypot(x[0],x[2]),I=Math.hypot(x[1],x[3]);this._cachedGetSinglePixelWidth=Math.max(L,I)/g}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(!this._cachedScaleForStroking){let{lineWidth:x}=this.current,g=(0,n.getCurrentTransform)(this.ctx),L,I;if(g[1]===0&&g[2]===0){let V=Math.abs(g[0]),N=Math.abs(g[3]);if(x===0)L=1/V,I=1/N;else{let K=V*x,J=N*x;L=K<1?1/K:1,I=J<1?1/J:1}}else{let V=Math.abs(g[0]*g[3]-g[2]*g[1]),N=Math.hypot(g[0],g[1]),K=Math.hypot(g[2],g[3]);if(x===0)L=K/V,I=N/V;else{let J=x*V;L=K>J?K/J:1,I=N>J?N/J:1}}this._cachedScaleForStroking=[L,I]}return this._cachedScaleForStroking}rescaleAndStroke(x){let{ctx:g}=this,{lineWidth:L}=this.current,[I,V]=this.getScaleForStroking();if(g.lineWidth=L||1,I===1&&V===1){g.stroke();return}let N,K,J;x&&(N=(0,n.getCurrentTransform)(g),K=g.getLineDash().slice(),J=g.lineDashOffset),g.scale(I,V);let p=Math.max(I,V);g.setLineDash(g.getLineDash().map(T=>T/p)),g.lineDashOffset/=p,g.stroke(),x&&(g.setTransform(...N),g.setLineDash(K),g.lineDashOffset=J)}isContentVisible(){for(let x=this.markedContentStack.length-1;x>=0;x--)if(!this.markedContentStack[x].visible)return!1;return!0}},q=we;re=new WeakSet,Vr=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},t.CanvasGraphics=q;for(let H in r.OPS)q.prototype[H]!==void 0&&(q.prototype[r.OPS[H]]=q.prototype[H])},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TilingPattern=t.PathType=void 0,t.getShadingPattern=i;var n=e(1),r=e(8),a=e(3);let d={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};t.PathType=d;function S(v,k){if(!k||a.isNodeJS)return;let y=k[2]-k[0],h=k[3]-k[1],c=new Path2D;c.rect(k[0],k[1],y,h),v.clip(c)}class b{constructor(){this.constructor===b&&(0,n.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,n.unreachable)("Abstract method `getPattern` called.")}}class m extends b{constructor(k){super(),this._type=k[1],this._bbox=k[2],this._colorStops=k[3],this._p0=k[4],this._p1=k[5],this._r0=k[6],this._r1=k[7],this.matrix=null}_createGradient(k){let y;this._type==="axial"?y=k.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(y=k.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let h of this._colorStops)y.addColorStop(h[0],h[1]);return y}getPattern(k,y,h,c){let u;if(c===d.STROKE||c===d.FILL){let f=y.current.getClippedPathBoundingBox(c,(0,r.getCurrentTransform)(k))||[0,0,0,0],M=Math.ceil(f[2]-f[0])||1,E=Math.ceil(f[3]-f[1])||1,w=y.cachedCanvases.getCanvas("pattern",M,E,!0),P=w.context;P.clearRect(0,0,P.canvas.width,P.canvas.height),P.beginPath(),P.rect(0,0,P.canvas.width,P.canvas.height),P.translate(-f[0],-f[1]),h=n.Util.transform(h,[1,0,0,1,f[0],f[1]]),P.transform(...y.baseTransform),this.matrix&&P.transform(...this.matrix),S(P,this._bbox),P.fillStyle=this._createGradient(P),P.fill(),u=k.createPattern(w.canvas,"no-repeat");let ne=new DOMMatrix(h);try{u.setTransform(ne)}catch(ie){(0,n.warn)(`RadialAxialShadingPattern.getPattern: "${ie?.message}".`)}}else S(k,this._bbox),u=this._createGradient(k);return u}}function A(v,k,y,h,c,u,f,M){let E=k.coords,w=k.colors,P=v.data,ne=v.width*4,ie;E[y+1]>E[h+1]&&(ie=y,y=h,h=ie,ie=u,u=f,f=ie),E[h+1]>E[c+1]&&(ie=h,h=c,c=ie,ie=f,f=M,M=ie),E[y+1]>E[h+1]&&(ie=y,y=h,h=ie,ie=u,u=f,f=ie);let Z=(E[y]+k.offsetX)*k.scaleX,Y=(E[y+1]+k.offsetY)*k.scaleY,j=(E[h]+k.offsetX)*k.scaleX,U=(E[h+1]+k.offsetY)*k.scaleY,q=(E[c]+k.offsetX)*k.scaleX,re=(E[c+1]+k.offsetY)*k.scaleY;if(Y>=re)return;let pe=w[u],we=w[u+1],H=w[u+2],x=w[f],g=w[f+1],L=w[f+2],I=w[M],V=w[M+1],N=w[M+2],K=Math.round(Y),J=Math.round(re),p,T,D,R,O,X,ee,ge;for(let te=K;te<=J;te++){if(te<U){let W;te<Y?W=0:W=(Y-te)/(Y-U),p=Z-(Z-j)*W,T=pe-(pe-x)*W,D=we-(we-g)*W,R=H-(H-L)*W}else{let W;te>re?W=1:U===re?W=0:W=(U-te)/(U-re),p=j-(j-q)*W,T=x-(x-I)*W,D=g-(g-V)*W,R=L-(L-N)*W}let oe;te<Y?oe=0:te>re?oe=1:oe=(Y-te)/(Y-re),O=Z-(Z-q)*oe,X=pe-(pe-I)*oe,ee=we-(we-V)*oe,ge=H-(H-N)*oe;let se=Math.round(Math.min(p,O)),ce=Math.round(Math.max(p,O)),fe=ne*te+se*4;for(let W=se;W<=ce;W++)oe=(p-W)/(p-O),oe<0?oe=0:oe>1&&(oe=1),P[fe++]=T-(T-X)*oe|0,P[fe++]=D-(D-ee)*oe|0,P[fe++]=R-(R-ge)*oe|0,P[fe++]=255}}function C(v,k,y){let h=k.coords,c=k.colors,u,f;switch(k.type){case"lattice":let M=k.verticesPerRow,E=Math.floor(h.length/M)-1,w=M-1;for(u=0;u<E;u++){let P=u*M;for(let ne=0;ne<w;ne++,P++)A(v,y,h[P],h[P+1],h[P+M],c[P],c[P+1],c[P+M]),A(v,y,h[P+M+1],h[P+1],h[P+M],c[P+M+1],c[P+1],c[P+M])}break;case"triangles":for(u=0,f=h.length;u<f;u+=3)A(v,y,h[u],h[u+1],h[u+2],c[u],c[u+1],c[u+2]);break;default:throw new Error("illegal figure")}}class _ extends b{constructor(k){super(),this._coords=k[2],this._colors=k[3],this._figures=k[4],this._bounds=k[5],this._bbox=k[7],this._background=k[8],this.matrix=null}_createMeshCanvas(k,y,h){let M=Math.floor(this._bounds[0]),E=Math.floor(this._bounds[1]),w=Math.ceil(this._bounds[2])-M,P=Math.ceil(this._bounds[3])-E,ne=Math.min(Math.ceil(Math.abs(w*k[0]*1.1)),3e3),ie=Math.min(Math.ceil(Math.abs(P*k[1]*1.1)),3e3),Z=w/ne,Y=P/ie,j={coords:this._coords,colors:this._colors,offsetX:-M,offsetY:-E,scaleX:1/Z,scaleY:1/Y},U=ne+2*2,q=ie+2*2,re=h.getCanvas("mesh",U,q,!1),pe=re.context,we=pe.createImageData(ne,ie);if(y){let x=we.data;for(let g=0,L=x.length;g<L;g+=4)x[g]=y[0],x[g+1]=y[1],x[g+2]=y[2],x[g+3]=255}for(let x of this._figures)C(we,x,j);return pe.putImageData(we,2,2),{canvas:re.canvas,offsetX:M-2*Z,offsetY:E-2*Y,scaleX:Z,scaleY:Y}}getPattern(k,y,h,c){S(k,this._bbox);let u;if(c===d.SHADING)u=n.Util.singularValueDecompose2dScale((0,r.getCurrentTransform)(k));else if(u=n.Util.singularValueDecompose2dScale(y.baseTransform),this.matrix){let M=n.Util.singularValueDecompose2dScale(this.matrix);u=[u[0]*M[0],u[1]*M[1]]}let f=this._createMeshCanvas(u,c===d.SHADING?null:this._background,y.cachedCanvases);return c!==d.SHADING&&(k.setTransform(...y.baseTransform),this.matrix&&k.transform(...this.matrix)),k.translate(f.offsetX,f.offsetY),k.scale(f.scaleX,f.scaleY),k.createPattern(f.canvas,"no-repeat")}}class F extends b{getPattern(){return"hotpink"}}function i(v){switch(v[0]){case"RadialAxial":return new m(v);case"Mesh":return new _(v);case"Dummy":return new F}throw new Error(`Unknown IR type: ${v[0]}`)}let l={COLORED:1,UNCOLORED:2};class s{static get MAX_PATTERN_SIZE(){return(0,n.shadow)(this,"MAX_PATTERN_SIZE",3e3)}constructor(k,y,h,c,u){this.operatorList=k[2],this.matrix=k[3]||[1,0,0,1,0,0],this.bbox=k[4],this.xstep=k[5],this.ystep=k[6],this.paintType=k[7],this.tilingType=k[8],this.color=y,this.ctx=h,this.canvasGraphicsFactory=c,this.baseTransform=u}createPatternCanvas(k){let y=this.operatorList,h=this.bbox,c=this.xstep,u=this.ystep,f=this.paintType,M=this.tilingType,E=this.color,w=this.canvasGraphicsFactory;(0,n.info)("TilingType: "+M);let P=h[0],ne=h[1],ie=h[2],Z=h[3],Y=n.Util.singularValueDecompose2dScale(this.matrix),j=n.Util.singularValueDecompose2dScale(this.baseTransform),U=[Y[0]*j[0],Y[1]*j[1]],q=this.getSizeAndScale(c,this.ctx.canvas.width,U[0]),re=this.getSizeAndScale(u,this.ctx.canvas.height,U[1]),pe=k.cachedCanvases.getCanvas("pattern",q.size,re.size,!0),we=pe.context,H=w.createCanvasGraphics(we);H.groupLevel=k.groupLevel,this.setFillAndStrokeStyleToContext(H,f,E);let x=P,g=ne,L=ie,I=Z;return P<0&&(x=0,L+=Math.abs(P)),ne<0&&(g=0,I+=Math.abs(ne)),we.translate(-(q.scale*x),-(re.scale*g)),H.transform(q.scale,0,0,re.scale,0,0),we.save(),this.clipBbox(H,x,g,L,I),H.baseTransform=(0,r.getCurrentTransform)(H.ctx),H.executeOperatorList(y),H.endDrawing(),{canvas:pe.canvas,scaleX:q.scale,scaleY:re.scale,offsetX:x,offsetY:g}}getSizeAndScale(k,y,h){k=Math.abs(k);let c=Math.max(s.MAX_PATTERN_SIZE,y),u=Math.ceil(k*h);return u>=c?u=c:h=u/k,{scale:h,size:u}}clipBbox(k,y,h,c,u){let f=c-y,M=u-h;k.ctx.rect(y,h,f,M),k.current.updateRectMinMax((0,r.getCurrentTransform)(k.ctx),[y,h,c,u]),k.clip(),k.endPath()}setFillAndStrokeStyleToContext(k,y,h){let c=k.ctx,u=k.current;switch(y){case l.COLORED:let f=this.ctx;c.fillStyle=f.fillStyle,c.strokeStyle=f.strokeStyle,u.fillColor=f.fillStyle,u.strokeColor=f.strokeStyle;break;case l.UNCOLORED:let M=n.Util.makeHexColor(h[0],h[1],h[2]);c.fillStyle=M,c.strokeStyle=M,u.fillColor=M,u.strokeColor=M;break;default:throw new n.FormatError(`Unsupported paint type: ${y}`)}}getPattern(k,y,h,c){let u=h;c!==d.SHADING&&(u=n.Util.transform(u,y.baseTransform),this.matrix&&(u=n.Util.transform(u,this.matrix)));let f=this.createPatternCanvas(y),M=new DOMMatrix(u);M=M.translate(f.offsetX,f.offsetY),M=M.scale(1/f.scaleX,1/f.scaleY);let E=k.createPattern(f.canvas,"repeat");try{E.setTransform(M)}catch(w){(0,n.warn)(`TilingPattern.getPattern: "${w?.message}".`)}return E}}t.TilingPattern=s},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyMaskImageData=r;var n=e(1);function r({src:a,srcPos:d=0,dest:S,destPos:b=0,width:m,height:A,inverseDecode:C=!1}){let _=n.FeatureTest.isLittleEndian?4278190080:255,[F,i]=C?[0,_]:[_,0],l=m>>3,s=m&7,v=a.length;S=new Uint32Array(S.buffer);for(let k=0;k<A;k++){for(let h=d+l;d<h;d++){let c=d<v?a[d]:255;S[b++]=c&128?i:F,S[b++]=c&64?i:F,S[b++]=c&32?i:F,S[b++]=c&16?i:F,S[b++]=c&8?i:F,S[b++]=c&4?i:F,S[b++]=c&2?i:F,S[b++]=c&1?i:F}if(s===0)continue;let y=d<v?a[d++]:255;for(let h=0;h<s;h++)S[b++]=y&1<<7-h?i:F}return{srcPos:d,destPos:b}}},(o,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalWorkerOptions=void 0;let e=Object.create(null);t.GlobalWorkerOptions=e,e.workerPort=e.workerPort===void 0?null:e.workerPort,e.workerSrc=e.workerSrc===void 0?"":e.workerSrc},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandler=void 0;var n=e(1);let r={UNKNOWN:0,DATA:1,ERROR:2},a={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function d(b){switch(b instanceof Error||typeof b=="object"&&b!==null||(0,n.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),b.name){case"AbortException":return new n.AbortException(b.message);case"MissingPDFException":return new n.MissingPDFException(b.message);case"PasswordException":return new n.PasswordException(b.message,b.code);case"UnexpectedResponseException":return new n.UnexpectedResponseException(b.message,b.status);case"UnknownErrorException":return new n.UnknownErrorException(b.message,b.details);default:return new n.UnknownErrorException(b.message,b.toString())}}class S{constructor(m,A,C){this.sourceName=m,this.targetName=A,this.comObj=C,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=_=>{let F=_.data;if(F.targetName!==this.sourceName)return;if(F.stream){this._processStreamMessage(F);return}if(F.callback){let l=F.callbackId,s=this.callbackCapabilities[l];if(!s)throw new Error(`Cannot resolve callback ${l}`);if(delete this.callbackCapabilities[l],F.callback===r.DATA)s.resolve(F.data);else if(F.callback===r.ERROR)s.reject(d(F.reason));else throw new Error("Unexpected callback case");return}let i=this.actionHandler[F.action];if(!i)throw new Error(`Unknown action from worker: ${F.action}`);if(F.callbackId){let l=this.sourceName,s=F.sourceName;new Promise(function(v){v(i(F.data))}).then(function(v){C.postMessage({sourceName:l,targetName:s,callback:r.DATA,callbackId:F.callbackId,data:v})},function(v){C.postMessage({sourceName:l,targetName:s,callback:r.ERROR,callbackId:F.callbackId,reason:d(v)})});return}if(F.streamId){this._createStreamSink(F);return}i(F.data)},C.addEventListener("message",this._onComObjOnMessage)}on(m,A){let C=this.actionHandler;if(C[m])throw new Error(`There is already an actionName called "${m}"`);C[m]=A}send(m,A,C){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:m,data:A},C)}sendWithPromise(m,A,C){let _=this.callbackId++,F=(0,n.createPromiseCapability)();this.callbackCapabilities[_]=F;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:m,callbackId:_,data:A},C)}catch(i){F.reject(i)}return F.promise}sendWithStream(m,A,C,_){let F=this.streamId++,i=this.sourceName,l=this.targetName,s=this.comObj;return new ReadableStream({start:v=>{let k=(0,n.createPromiseCapability)();return this.streamControllers[F]={controller:v,startCall:k,pullCall:null,cancelCall:null,isClosed:!1},s.postMessage({sourceName:i,targetName:l,action:m,streamId:F,data:A,desiredSize:v.desiredSize},_),k.promise},pull:v=>{let k=(0,n.createPromiseCapability)();return this.streamControllers[F].pullCall=k,s.postMessage({sourceName:i,targetName:l,stream:a.PULL,streamId:F,desiredSize:v.desiredSize}),k.promise},cancel:v=>{(0,n.assert)(v instanceof Error,"cancel must have a valid reason");let k=(0,n.createPromiseCapability)();return this.streamControllers[F].cancelCall=k,this.streamControllers[F].isClosed=!0,s.postMessage({sourceName:i,targetName:l,stream:a.CANCEL,streamId:F,reason:d(v)}),k.promise}},C)}_createStreamSink(m){let A=m.streamId,C=this.sourceName,_=m.sourceName,F=this.comObj,i=this,l=this.actionHandler[m.action],s={enqueue(v,k=1,y){if(this.isCancelled)return;let h=this.desiredSize;this.desiredSize-=k,h>0&&this.desiredSize<=0&&(this.sinkCapability=(0,n.createPromiseCapability)(),this.ready=this.sinkCapability.promise),F.postMessage({sourceName:C,targetName:_,stream:a.ENQUEUE,streamId:A,chunk:v},y)},close(){this.isCancelled||(this.isCancelled=!0,F.postMessage({sourceName:C,targetName:_,stream:a.CLOSE,streamId:A}),delete i.streamSinks[A])},error(v){(0,n.assert)(v instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,F.postMessage({sourceName:C,targetName:_,stream:a.ERROR,streamId:A,reason:d(v)}))},sinkCapability:(0,n.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:m.desiredSize,ready:null};s.sinkCapability.resolve(),s.ready=s.sinkCapability.promise,this.streamSinks[A]=s,new Promise(function(v){v(l(m.data,s))}).then(function(){F.postMessage({sourceName:C,targetName:_,stream:a.START_COMPLETE,streamId:A,success:!0})},function(v){F.postMessage({sourceName:C,targetName:_,stream:a.START_COMPLETE,streamId:A,reason:d(v)})})}_processStreamMessage(m){let A=m.streamId,C=this.sourceName,_=m.sourceName,F=this.comObj,i=this.streamControllers[A],l=this.streamSinks[A];switch(m.stream){case a.START_COMPLETE:m.success?i.startCall.resolve():i.startCall.reject(d(m.reason));break;case a.PULL_COMPLETE:m.success?i.pullCall.resolve():i.pullCall.reject(d(m.reason));break;case a.PULL:if(!l){F.postMessage({sourceName:C,targetName:_,stream:a.PULL_COMPLETE,streamId:A,success:!0});break}l.desiredSize<=0&&m.desiredSize>0&&l.sinkCapability.resolve(),l.desiredSize=m.desiredSize,new Promise(function(s){s(l.onPull&&l.onPull())}).then(function(){F.postMessage({sourceName:C,targetName:_,stream:a.PULL_COMPLETE,streamId:A,success:!0})},function(s){F.postMessage({sourceName:C,targetName:_,stream:a.PULL_COMPLETE,streamId:A,reason:d(s)})});break;case a.ENQUEUE:if((0,n.assert)(i,"enqueue should have stream controller"),i.isClosed)break;i.controller.enqueue(m.chunk);break;case a.CLOSE:if((0,n.assert)(i,"close should have stream controller"),i.isClosed)break;i.isClosed=!0,i.controller.close(),this._deleteStreamController(i,A);break;case a.ERROR:(0,n.assert)(i,"error should have stream controller"),i.controller.error(d(m.reason)),this._deleteStreamController(i,A);break;case a.CANCEL_COMPLETE:m.success?i.cancelCall.resolve():i.cancelCall.reject(d(m.reason)),this._deleteStreamController(i,A);break;case a.CANCEL:if(!l)break;new Promise(function(s){s(l.onCancel&&l.onCancel(d(m.reason)))}).then(function(){F.postMessage({sourceName:C,targetName:_,stream:a.CANCEL_COMPLETE,streamId:A,success:!0})},function(s){F.postMessage({sourceName:C,targetName:_,stream:a.CANCEL_COMPLETE,streamId:A,reason:d(s)})}),l.sinkCapability.reject(d(m.reason)),l.isCancelled=!0,delete this.streamSinks[A];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(m,A){await Promise.allSettled([m.startCall&&m.startCall.promise,m.pullCall&&m.pullCall.promise,m.cancelCall&&m.cancelCall.promise]),delete this.streamControllers[A]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}t.MessageHandler=S},(o,t,e)=>{var a,d;Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var n=e(1);class r{constructor({parsedData:b,rawData:m}){le(this,a,void 0);le(this,d,void 0);xe(this,a,b),xe(this,d,m)}getRaw(){return B(this,d)}get(b){return B(this,a).get(b)??null}getAll(){return(0,n.objectFromMap)(B(this,a))}has(b){return B(this,a).has(b)}}a=new WeakMap,d=new WeakMap,t.Metadata=r},(o,t,e)=>{var S,b,m,A,C,_,Or;Object.defineProperty(t,"__esModule",{value:!0}),t.OptionalContentConfig=void 0;var n=e(1);let r=Symbol("INTERNAL");class a{constructor(l,s){le(this,S,!0);this.name=l,this.intent=s}get visible(){return B(this,S)}_setVisible(l,s){l!==r&&(0,n.unreachable)("Internal method `_setVisible` called."),xe(this,S,s)}}S=new WeakMap;class d{constructor(l){le(this,_);le(this,b,!0);le(this,m,new Map);le(this,A,null);le(this,C,null);if(this.name=null,this.creator=null,l!==null){this.name=l.name,this.creator=l.creator,xe(this,C,l.order);for(let s of l.groups)B(this,m).set(s.id,new a(s.name,s.intent));if(l.baseState==="OFF")for(let s of B(this,m).values())s._setVisible(r,!1);for(let s of l.on)B(this,m).get(s)._setVisible(r,!0);for(let s of l.off)B(this,m).get(s)._setVisible(r,!1);xe(this,A,new Map);for(let[s,v]of B(this,m))B(this,A).set(s,v.visible)}}isVisible(l){if(B(this,m).size===0)return!0;if(!l)return(0,n.warn)("Optional content group not defined."),!0;if(l.type==="OCG")return B(this,m).has(l.id)?B(this,m).get(l.id).visible:((0,n.warn)(`Optional content group not found: ${l.id}`),!0);if(l.type==="OCMD"){if(l.expression)return ue(this,_,Or).call(this,l.expression);if(!l.policy||l.policy==="AnyOn"){for(let s of l.ids){if(!B(this,m).has(s))return(0,n.warn)(`Optional content group not found: ${s}`),!0;if(B(this,m).get(s).visible)return!0}return!1}else if(l.policy==="AllOn"){for(let s of l.ids){if(!B(this,m).has(s))return(0,n.warn)(`Optional content group not found: ${s}`),!0;if(!B(this,m).get(s).visible)return!1}return!0}else if(l.policy==="AnyOff"){for(let s of l.ids){if(!B(this,m).has(s))return(0,n.warn)(`Optional content group not found: ${s}`),!0;if(!B(this,m).get(s).visible)return!0}return!1}else if(l.policy==="AllOff"){for(let s of l.ids){if(!B(this,m).has(s))return(0,n.warn)(`Optional content group not found: ${s}`),!0;if(B(this,m).get(s).visible)return!1}return!0}return(0,n.warn)(`Unknown optional content policy ${l.policy}.`),!0}return(0,n.warn)(`Unknown group type ${l.type}.`),!0}setVisibility(l,s=!0){if(!B(this,m).has(l)){(0,n.warn)(`Optional content group not found: ${l}`);return}B(this,m).get(l)._setVisible(r,!!s),xe(this,b,null)}get hasInitialVisibility(){if(B(this,b)!==null)return B(this,b);for(let[l,s]of B(this,m)){let v=B(this,A).get(l);if(s.visible!==v)return xe(this,b,!1)}return xe(this,b,!0)}getOrder(){return B(this,m).size?B(this,C)?B(this,C).slice():[...B(this,m).keys()]:null}getGroups(){return B(this,m).size>0?(0,n.objectFromMap)(B(this,m)):null}getGroup(l){return B(this,m).get(l)||null}}b=new WeakMap,m=new WeakMap,A=new WeakMap,C=new WeakMap,_=new WeakSet,Or=function(l){let s=l.length;if(s<2)return!0;let v=l[0];for(let k=1;k<s;k++){let y=l[k],h;if(Array.isArray(y))h=ue(this,_,Or).call(this,y);else if(B(this,m).has(y))h=B(this,m).get(y).visible;else return(0,n.warn)(`Optional content group not found: ${y}`),!0;switch(v){case"And":if(!h)return!1;break;case"Or":if(h)return!0;break;case"Not":return!h;default:return!0}}return v==="And"},t.OptionalContentConfig=d},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFDataTransportStream=void 0;var n=e(1),r=e(8);class a{constructor(m,A){(0,n.assert)(A,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=m.progressiveDone||!1,this._contentDispositionFilename=m.contentDispositionFilename||null;let C=m.initialData;if(C?.length>0){let _=new Uint8Array(C).buffer;this._queuedChunks.push(_)}this._pdfDataRangeTransport=A,this._isStreamingSupported=!m.disableStream,this._isRangeSupported=!m.disableRange,this._contentLength=m.length,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((_,F)=>{this._onReceiveData({begin:_,chunk:F})}),this._pdfDataRangeTransport.addProgressListener((_,F)=>{this._onProgress({loaded:_,total:F})}),this._pdfDataRangeTransport.addProgressiveReadListener(_=>{this._onReceiveData({chunk:_})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData(m){let A=new Uint8Array(m.chunk).buffer;if(m.begin===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(A):this._queuedChunks.push(A);else{let C=this._rangeReaders.some(function(_){return _._begin!==m.begin?!1:(_._enqueue(A),!0)});(0,n.assert)(C,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(m){if(m.total===void 0){let A=this._rangeReaders[0];A?.onProgress&&A.onProgress({loaded:m.loaded})}else{let A=this._fullRequestReader;A?.onProgress&&A.onProgress({loaded:m.loaded,total:m.total})}}_onProgressiveDone(){this._fullRequestReader&&this._fullRequestReader.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(m){let A=this._rangeReaders.indexOf(m);A>=0&&this._rangeReaders.splice(A,1)}getFullReader(){(0,n.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let m=this._queuedChunks;return this._queuedChunks=null,new d(this,m,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(m,A){if(A<=this._progressiveDataLength)return null;let C=new S(this,m,A);return this._pdfDataRangeTransport.requestDataRange(m,A),this._rangeReaders.push(C),C}cancelAllRequests(m){this._fullRequestReader&&this._fullRequestReader.cancel(m);for(let A of this._rangeReaders.slice(0))A.cancel(m);this._pdfDataRangeTransport.abort()}}t.PDFDataTransportStream=a;class d{constructor(m,A,C=!1,_=null){this._stream=m,this._done=C||!1,this._filename=(0,r.isPdfFile)(_)?_:null,this._queuedChunks=A||[],this._loaded=0;for(let F of this._queuedChunks)this._loaded+=F.byteLength;this._requests=[],this._headersReady=Promise.resolve(),m._fullRequestReader=this,this.onProgress=null}_enqueue(m){this._done||(this._requests.length>0?this._requests.shift().resolve({value:m,done:!1}):this._queuedChunks.push(m),this._loaded+=m.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let m=(0,n.createPromiseCapability)();return this._requests.push(m),m.promise}cancel(m){this._done=!0;for(let A of this._requests)A.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class S{constructor(m,A,C){this._stream=m,this._begin=A,this._end=C,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(m){if(!this._done){if(this._requests.length===0)this._queuedChunk=m;else{this._requests.shift().resolve({value:m,done:!1});for(let C of this._requests)C.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let A=this._queuedChunk;return this._queuedChunk=null,{value:A,done:!1}}if(this._done)return{value:void 0,done:!0};let m=(0,n.createPromiseCapability)();return this._requests.push(m),m.promise}cancel(m){this._done=!0;for(let A of this._requests)A.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(o,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaText=void 0;class e{static textContent(r){let a=[],d={items:a,styles:Object.create(null)};function S(b){if(!b)return;let m=null,A=b.name;if(A==="#text")m=b.value;else if(e.shouldBuildText(A))b?.attributes?.textContent?m=b.attributes.textContent:b.value&&(m=b.value);else return;if(m!==null&&a.push({str:m}),!!b.children)for(let C of b.children)S(C)}return S(r),d}static shouldBuildText(r){return!(r==="textarea"||r==="input"||r==="option"||r==="select")}}t.XfaText=e},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodeStandardFontDataFactory=t.NodeCanvasFactory=t.NodeCMapReaderFactory=void 0;var n=e(9);let r=function(b){return new Promise((m,A)=>{Lr().readFile(b,(_,F)=>{if(_||!F){A(new Error(_));return}m(new Uint8Array(F))})})};class a extends n.BaseCanvasFactory{_createCanvas(m,A){return Es().createCanvas(m,A)}}t.NodeCanvasFactory=a;class d extends n.BaseCMapReaderFactory{_fetchData(m,A){return r(m).then(C=>({cMapData:C,compressionType:A}))}}t.NodeCMapReaderFactory=d;class S extends n.BaseStandardFontDataFactory{_fetchData(m){return r(m)}}t.NodeStandardFontDataFactory=S},(o,t,e)=>{var b,m,A,C,_,F,i,l,s,Wr,k,Os,h,Hr,u,Ws;Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationEditorLayer=void 0;var n=e(7),r=e(1),a=e(23),d=e(24);let M=class{constructor(w){le(this,s);le(this,k);le(this,h);le(this,u);le(this,b,void 0);le(this,m,!1);le(this,A,this.pointerup.bind(this));le(this,C,this.pointerdown.bind(this));le(this,_,new Map);le(this,F,!1);le(this,i,!1);le(this,l,void 0);M._initialized||(M._initialized=!0,a.FreeTextEditor.initialize(w.l10n),d.InkEditor.initialize(w.l10n),w.uiManager.registerEditorTypes([a.FreeTextEditor,d.InkEditor])),xe(this,l,w.uiManager),this.annotationStorage=w.annotationStorage,this.pageIndex=w.pageIndex,this.div=w.div,xe(this,b,w.accessibilityManager),B(this,l).addLayer(this)}updateToolbar(w){B(this,l).updateToolbar(w)}updateMode(w=B(this,l).getMode()){ue(this,u,Ws).call(this),w===r.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),B(this,l).unselectAll()}addInkEditorIfNeeded(w){if(!w&&B(this,l).getMode()!==r.AnnotationEditorType.INK)return;if(!w){for(let ne of B(this,_).values())if(ne.isEmpty()){ne.setInBackground();return}}ue(this,h,Hr).call(this,{offsetX:0,offsetY:0}).setInBackground()}setEditingState(w){B(this,l).setEditingState(w)}addCommands(w){B(this,l).addCommands(w)}enable(){this.div.style.pointerEvents="auto";for(let w of B(this,_).values())w.enableEditing()}disable(){this.div.style.pointerEvents="none";for(let w of B(this,_).values())w.disableEditing()}setActiveEditor(w){B(this,l).getActive()!==w&&B(this,l).setActiveEditor(w)}enableClick(){this.div.addEventListener("pointerdown",B(this,C)),this.div.addEventListener("pointerup",B(this,A))}disableClick(){this.div.removeEventListener("pointerdown",B(this,C)),this.div.removeEventListener("pointerup",B(this,A))}attach(w){B(this,_).set(w.id,w)}detach(w){B(this,_).delete(w.id),B(this,b)?.removePointerInTextLayer(w.contentDiv)}remove(w){B(this,l).removeEditor(w),this.detach(w),this.annotationStorage.remove(w.id),w.div.style.display="none",setTimeout(()=>{w.div.style.display="",w.div.remove(),w.isAttachedToDOM=!1,document.activeElement===document.body&&B(this,l).focusMainContainer()},0),B(this,i)||this.addInkEditorIfNeeded(!1)}add(w){if(ue(this,s,Wr).call(this,w),B(this,l).addEditor(w),this.attach(w),!w.isAttachedToDOM){let P=w.render();this.div.append(P),w.isAttachedToDOM=!0}this.moveEditorInDOM(w),w.onceAdded(),this.addToAnnotationStorage(w)}moveEditorInDOM(w){B(this,b)?.moveElementInDOM(this.div,w.div,w.contentDiv,!0)}addToAnnotationStorage(w){!w.isEmpty()&&!this.annotationStorage.has(w.id)&&this.annotationStorage.setValue(w.id,w)}addOrRebuild(w){w.needsToBeRebuilt()?w.rebuild():this.add(w)}addANewEditor(w){let P=()=>{this.addOrRebuild(w)},ne=()=>{w.remove()};this.addCommands({cmd:P,undo:ne,mustExec:!0})}addUndoableEditor(w){let P=()=>{this.addOrRebuild(w)},ne=()=>{w.remove()};this.addCommands({cmd:P,undo:ne,mustExec:!1})}getNextId(){return B(this,l).getId()}deserialize(w){switch(w.annotationType){case r.AnnotationEditorType.FREETEXT:return a.FreeTextEditor.deserialize(w,this);case r.AnnotationEditorType.INK:return d.InkEditor.deserialize(w,this)}return null}setSelected(w){B(this,l).setSelected(w)}toggleSelected(w){B(this,l).toggleSelected(w)}isSelected(w){return B(this,l).isSelected(w)}unselect(w){B(this,l).unselect(w)}pointerup(w){let P=n.KeyboardManager.platform.isMac;if(!(w.button!==0||w.ctrlKey&&P)&&w.target===this.div&&B(this,F)){if(xe(this,F,!1),!B(this,m)){xe(this,m,!0);return}ue(this,h,Hr).call(this,w)}}pointerdown(w){let P=n.KeyboardManager.platform.isMac;if(w.button!==0||w.ctrlKey&&P||w.target!==this.div)return;xe(this,F,!0);let ne=B(this,l).getActive();xe(this,m,!ne||ne.isEmpty())}drop(w){let P=w.dataTransfer.getData("text/plain"),ne=B(this,l).getEditor(P);if(!ne)return;w.preventDefault(),w.dataTransfer.dropEffect="move",ue(this,s,Wr).call(this,ne);let ie=this.div.getBoundingClientRect(),Z=w.clientX-ie.x,Y=w.clientY-ie.y;ne.translate(Z-ne.startX,Y-ne.startY),this.moveEditorInDOM(ne),ne.div.focus()}dragover(w){w.preventDefault()}destroy(){B(this,l).getActive()?.parent===this&&B(this,l).setActiveEditor(null);for(let w of B(this,_).values())B(this,b)?.removePointerInTextLayer(w.contentDiv),w.isAttachedToDOM=!1,w.div.remove(),w.parent=null;this.div=null,B(this,_).clear(),B(this,l).removeLayer(this)}render(w){this.viewport=w.viewport,(0,n.bindEvents)(this,this.div,["dragover","drop"]),this.setDimensions();for(let P of B(this,l).getEditors(this.pageIndex))this.add(P);this.updateMode()}update(w){this.viewport=w.viewport,this.setDimensions(),this.updateMode()}get scaleFactor(){return this.viewport.scale}get pageDimensions(){let[w,P,ne,ie]=this.viewport.viewBox,Z=ne-w,Y=ie-P;return[Z,Y]}get viewportBaseDimensions(){let{width:w,height:P,rotation:ne}=this.viewport;return ne%180===0?[w,P]:[P,w]}setDimensions(){let{width:w,height:P,rotation:ne}=this.viewport,ie=ne%180!==0,Z=Math.floor(w)+"px",Y=Math.floor(P)+"px";this.div.style.width=ie?Y:Z,this.div.style.height=ie?Z:Y,this.div.setAttribute("data-main-rotation",ne)}},S=M;b=new WeakMap,m=new WeakMap,A=new WeakMap,C=new WeakMap,_=new WeakMap,F=new WeakMap,i=new WeakMap,l=new WeakMap,s=new WeakSet,Wr=function(w){w.parent!==this&&(this.attach(w),w.pageIndex=this.pageIndex,w.parent?.detach(w),w.parent=this,w.div&&w.isAttachedToDOM&&(w.div.remove(),this.div.append(w.div)))},k=new WeakSet,Os=function(w){switch(B(this,l).getMode()){case r.AnnotationEditorType.FREETEXT:return new a.FreeTextEditor(w);case r.AnnotationEditorType.INK:return new d.InkEditor(w)}return null},h=new WeakSet,Hr=function(w){let P=this.getNextId(),ne=ue(this,k,Os).call(this,{parent:this,id:P,x:w.offsetX,y:w.offsetY});return ne&&this.add(ne),ne},u=new WeakSet,Ws=function(){xe(this,i,!0);for(let w of B(this,_).values())w.isEmpty()&&w.remove();xe(this,i,!1)},We(S,"_initialized",!1),t.AnnotationEditorLayer=S},(o,t,e)=>{var S,b,m,A,C,_,F,i,Hs,s,Ns,k,js,h,Nr;Object.defineProperty(t,"__esModule",{value:!0}),t.FreeTextEditor=void 0;var n=e(1),r=e(7),a=e(6);let u=class extends a.AnnotationEditor{constructor(E){super({...E,name:"freeTextEditor"});le(this,i);le(this,s);le(this,k);le(this,h);le(this,S,this.editorDivBlur.bind(this));le(this,b,this.editorDivFocus.bind(this));le(this,m,this.editorDivKeydown.bind(this));le(this,A,void 0);le(this,C,"");le(this,_,!1);le(this,F,void 0);xe(this,A,E.color||u._defaultColor||a.AnnotationEditor._defaultLineColor),xe(this,F,E.fontSize||u._defaultFontSize)}static initialize(E){this._l10nPromise=new Map(["free_text_default_content","editor_free_text_aria_label"].map(P=>[P,E.get(P)]));let w=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(w.getPropertyValue("--freetext-padding"))}static updateDefaultParams(E,w){switch(E){case n.AnnotationEditorParamsType.FREETEXT_SIZE:u._defaultFontSize=w;break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:u._defaultColor=w;break}}updateParams(E,w){switch(E){case n.AnnotationEditorParamsType.FREETEXT_SIZE:ue(this,i,Hs).call(this,w);break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:ue(this,s,Ns).call(this,w);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,u._defaultFontSize],[n.AnnotationEditorParamsType.FREETEXT_COLOR,u._defaultColor||a.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,B(this,F)],[n.AnnotationEditorParamsType.FREETEXT_COLOR,B(this,A)]]}getInitialTranslation(){return[-u._internalPadding*this.parent.scaleFactor,-(u._internalPadding+B(this,F))*this.parent.scaleFactor]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(n.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.enableEditing(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.editorDiv.addEventListener("keydown",B(this,m)),this.editorDiv.addEventListener("focus",B(this,b)),this.editorDiv.addEventListener("blur",B(this,S)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.disableEditing(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",B(this,m)),this.editorDiv.removeEventListener("focus",B(this,b)),this.editorDiv.removeEventListener("blur",B(this,S)),this.div.focus(),this.isEditing=!1)}focusin(E){super.focusin(E),E.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus())}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent.setEditingState(!0),super.remove()}commit(){super.commit(),B(this,_)||(xe(this,_,!0),this.parent.addUndoableEditor(this)),this.disableEditMode(),xe(this,C,ue(this,k,js).call(this).trimEnd()),ue(this,h,Nr).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(E){this.enableEditMode(),this.editorDiv.focus()}keydown(E){E.target===this.div&&E.key==="Enter"&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(E){u._keyboardManager.exec(this,E)}editorDivFocus(E){this.isEditing=!0}editorDivBlur(E){this.isEditing=!1}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let E,w;this.width&&(E=this.x,w=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",`${this.id}-editor`),this.enableEditing(),u._l10nPromise.get("editor_free_text_aria_label").then(ne=>this.editorDiv?.setAttribute("aria-label",ne)),u._l10nPromise.get("free_text_default_content").then(ne=>this.editorDiv?.setAttribute("default-content",ne)),this.editorDiv.contentEditable=!0;let{style:P}=this.editorDiv;if(P.fontSize=`calc(${B(this,F)}px * var(--scale-factor))`,P.color=B(this,A),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,r.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){let[ne,ie]=this.parent.viewportBaseDimensions;this.setAt(E*ne,w*ie,this.width*ne,this.height*ie);for(let Z of B(this,C).split(`
`)){let Y=document.createElement("div");Y.append(Z?document.createTextNode(Z):document.createElement("br")),this.editorDiv.append(Y)}this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(E,w){let P=super.deserialize(E,w);return xe(P,F,E.fontSize),xe(P,A,n.Util.makeHexColor(...E.color)),xe(P,C,E.value),P}serialize(){if(this.isEmpty())return null;let E=u._internalPadding*this.parent.scaleFactor,w=this.getRect(E,E),P=a.AnnotationEditor._colorManager.convert(getComputedStyle(this.editorDiv).color);return{annotationType:n.AnnotationEditorType.FREETEXT,color:P,fontSize:B(this,F),value:B(this,C),pageIndex:this.parent.pageIndex,rect:w,rotation:this.rotation}}},d=u;S=new WeakMap,b=new WeakMap,m=new WeakMap,A=new WeakMap,C=new WeakMap,_=new WeakMap,F=new WeakMap,i=new WeakSet,Hs=function(E){let w=ne=>{this.editorDiv.style.fontSize=`calc(${ne}px * var(--scale-factor))`,this.translate(0,-(ne-B(this,F))*this.parent.scaleFactor),xe(this,F,ne),ue(this,h,Nr).call(this)},P=B(this,F);this.parent.addCommands({cmd:()=>{w(E)},undo:()=>{w(P)},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},s=new WeakSet,Ns=function(E){let w=B(this,A);this.parent.addCommands({cmd:()=>{xe(this,A,E),this.editorDiv.style.color=E},undo:()=>{xe(this,A,w),this.editorDiv.style.color=w},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},k=new WeakSet,js=function(){let E=this.editorDiv.getElementsByTagName("div");if(E.length===0)return this.editorDiv.innerText;let w=[];for(let P=0,ne=E.length;P<ne;P++){let Z=E[P].firstChild;Z?.nodeName==="#text"?w.push(Z.data):w.push("")}return w.join(`
`)},h=new WeakSet,Nr=function(){let[E,w]=this.parent.viewportBaseDimensions,P=this.div.getBoundingClientRect();this.width=P.width/E,this.height=P.height/w},We(d,"_freeTextDefaultContent",""),We(d,"_l10nPromise"),We(d,"_internalPadding",0),We(d,"_defaultColor",null),We(d,"_defaultFontSize",10),We(d,"_keyboardManager",new r.KeyboardManager([[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],u.prototype.commitOrRemove]])),We(d,"_type","freetext"),t.FreeTextEditor=d},(o,t,e)=>{var m,A,C,_,F,i,l,s,v,k,y,h,c,u,f,Gs,E,Us,P,Xs,ie,zs,Y,jr,U,qs,re,Ks,we,Js,x,vt,L,Gr,V,_o,K,bo,p,gn,D,Ur,O,To,ee,Xr,te,$s,se,Ys,fe,Qs,de,zr,Te,Ao,Me,fn,Ie,qr;Object.defineProperty(t,"__esModule",{value:!0}),t.InkEditor=void 0,Object.defineProperty(t,"fitCurve",{enumerable:!0,get:function(){return a.fitCurve}});var n=e(1),r=e(6),a=e(25),d=e(7);let S=16,Ee=class extends r.AnnotationEditor{constructor(ae){super({...ae,name:"inkEditor"});le(this,f);le(this,E);le(this,P);le(this,ie);le(this,Y);le(this,U);le(this,re);le(this,we);le(this,x);le(this,L);le(this,V);le(this,K);le(this,p);le(this,D);le(this,O);le(this,te);le(this,se);le(this,fe);le(this,de);le(this,Te);le(this,Me);le(this,Ie);le(this,m,0);le(this,A,0);le(this,C,0);le(this,_,this.canvasPointermove.bind(this));le(this,F,this.canvasPointerleave.bind(this));le(this,i,this.canvasPointerup.bind(this));le(this,l,this.canvasPointerdown.bind(this));le(this,s,!1);le(this,v,!1);le(this,k,null);le(this,y,null);le(this,h,0);le(this,c,0);le(this,u,null);this.color=ae.color||null,this.thickness=ae.thickness||null,this.opacity=ae.opacity||null,this.paths=[],this.bezierPath2D=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(ae){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink_aria_label"].map(he=>[he,ae.get(he)]))}static updateDefaultParams(ae,he){switch(ae){case n.AnnotationEditorParamsType.INK_THICKNESS:Ee._defaultThickness=he;break;case n.AnnotationEditorParamsType.INK_COLOR:Ee._defaultColor=he;break;case n.AnnotationEditorParamsType.INK_OPACITY:Ee._defaultOpacity=he/100;break}}updateParams(ae,he){switch(ae){case n.AnnotationEditorParamsType.INK_THICKNESS:ue(this,f,Gs).call(this,he);break;case n.AnnotationEditorParamsType.INK_COLOR:ue(this,E,Us).call(this,he);break;case n.AnnotationEditorParamsType.INK_OPACITY:ue(this,P,Xs).call(this,he);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,Ee._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,Ee._defaultColor||r.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(Ee._defaultOpacity*100)]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||Ee._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,this.color||Ee._defaultColor||r.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??Ee._defaultOpacity))]]}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(ue(this,V,_o).call(this),ue(this,K,bo).call(this)),this.isAttachedToDOM||(this.parent.add(this),ue(this,p,gn).call(this)),ue(this,Me,fn).call(this))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,B(this,y).disconnect(),xe(this,y,null),super.remove())}enableEditMode(){B(this,s)||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",B(this,l)),this.canvas.addEventListener("pointerup",B(this,i)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",B(this,l)),this.canvas.removeEventListener("pointerup",B(this,i)))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){B(this,s)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),xe(this,s,!0),this.div.classList.add("disabled"),ue(this,Me,fn).call(this,!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus())}focusin(ae){super.focusin(ae),this.enableEditMode()}canvasPointerdown(ae){ae.button!==0||!this.isInEditMode()||B(this,s)||(this.setInForeground(),ae.type!=="mouse"&&this.div.focus(),ae.stopPropagation(),this.canvas.addEventListener("pointerleave",B(this,F)),this.canvas.addEventListener("pointermove",B(this,_)),ue(this,U,qs).call(this,ae.offsetX,ae.offsetY))}canvasPointermove(ae){ae.stopPropagation(),ue(this,re,Ks).call(this,ae.offsetX,ae.offsetY)}canvasPointerup(ae){ae.button===0&&this.isInEditMode()&&this.currentPath.length!==0&&(ae.stopPropagation(),ue(this,L,Gr).call(this,ae),this.setInBackground())}canvasPointerleave(ae){ue(this,L,Gr).call(this,ae),this.setInBackground()}render(){if(this.div)return this.div;let ae,he;this.width&&(ae=this.x,he=this.y),super.render(),Ee._l10nPromise.get("editor_ink_aria_label").then(Fe=>this.div?.setAttribute("aria-label",Fe));let[Q,G,z,me]=ue(this,ie,zs).call(this);if(this.setAt(Q,G,0,0),this.setDims(z,me),ue(this,V,_o).call(this),this.width){let[Fe,_e]=this.parent.viewportBaseDimensions;this.setAt(ae*Fe,he*_e,this.width*Fe,this.height*_e),xe(this,v,!0),ue(this,p,gn).call(this),this.setDims(this.width*Fe,this.height*_e),ue(this,x,vt).call(this),ue(this,Ie,qr).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return ue(this,K,bo).call(this),this.div}setDimensions(ae,he){let Q=Math.round(ae),G=Math.round(he);if(B(this,h)===Q&&B(this,c)===G)return;xe(this,h,Q),xe(this,c,G),this.canvas.style.visibility="hidden",B(this,m)&&Math.abs(B(this,m)-ae/he)>.01&&(he=Math.ceil(ae/B(this,m)),this.setDims(ae,he));let[z,me]=this.parent.viewportBaseDimensions;this.width=ae/z,this.height=he/me,B(this,s)&&ue(this,D,Ur).call(this,ae,he),ue(this,p,gn).call(this),ue(this,x,vt).call(this),this.canvas.style.visibility="visible"}static deserialize(ae,he){var Ge,Be;let Q=super.deserialize(ae,he);Q.thickness=ae.thickness,Q.color=n.Util.makeHexColor(...ae.color),Q.opacity=ae.opacity;let[G,z]=he.pageDimensions,me=Q.width*G,Fe=Q.height*z,_e=he.scaleFactor,Ae=ae.thickness/2;xe(Q,m,me/Fe),xe(Q,s,!0),xe(Q,h,Math.round(me)),xe(Q,c,Math.round(Fe));for(let{bezier:ve}of ae.paths){let ze=[];Q.paths.push(ze);let Ue=_e*(ve[0]-Ae),ut=_e*(Fe-ve[1]-Ae);for(let qe=2,Ft=ve.length;qe<Ft;qe+=6){let jt=_e*(ve[qe]-Ae),Gt=_e*(Fe-ve[qe+1]-Ae),_t=_e*(ve[qe+2]-Ae),Ze=_e*(Fe-ve[qe+3]-Ae),wt=_e*(ve[qe+4]-Ae),cn=_e*(Fe-ve[qe+5]-Ae);ze.push([[Ue,ut],[jt,Gt],[_t,Ze],[wt,cn]]),Ue=wt,ut=cn}let Le=ue(this,ee,Xr).call(this,ze);Q.bezierPath2D.push(Le)}let Ce=ue(Ge=Q,de,zr).call(Ge);return xe(Q,C,Math.max(S,Ce[2]-Ce[0])),xe(Q,A,Math.max(S,Ce[3]-Ce[1])),ue(Be=Q,D,Ur).call(Be,me,Fe),Q}serialize(){if(this.isEmpty())return null;let ae=this.getRect(0,0),he=this.rotation%180===0?ae[3]-ae[1]:ae[2]-ae[0],Q=r.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:n.AnnotationEditorType.INK,color:Q,thickness:this.thickness,opacity:this.opacity,paths:ue(this,te,$s).call(this,this.scaleFactor/this.parent.scaleFactor,this.translationX,this.translationY,he),pageIndex:this.parent.pageIndex,rect:ae,rotation:this.rotation}}},b=Ee;m=new WeakMap,A=new WeakMap,C=new WeakMap,_=new WeakMap,F=new WeakMap,i=new WeakMap,l=new WeakMap,s=new WeakMap,v=new WeakMap,k=new WeakMap,y=new WeakMap,h=new WeakMap,c=new WeakMap,u=new WeakMap,f=new WeakSet,Gs=function(ae){let he=this.thickness;this.parent.addCommands({cmd:()=>{this.thickness=ae,ue(this,Me,fn).call(this)},undo:()=>{this.thickness=he,ue(this,Me,fn).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},E=new WeakSet,Us=function(ae){let he=this.color;this.parent.addCommands({cmd:()=>{this.color=ae,ue(this,x,vt).call(this)},undo:()=>{this.color=he,ue(this,x,vt).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},P=new WeakSet,Xs=function(ae){ae/=100;let he=this.opacity;this.parent.addCommands({cmd:()=>{this.opacity=ae,ue(this,x,vt).call(this)},undo:()=>{this.opacity=he,ue(this,x,vt).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},ie=new WeakSet,zs=function(){let{width:ae,height:he,rotation:Q}=this.parent.viewport;switch(Q){case 90:return[0,ae,ae,he];case 180:return[ae,he,ae,he];case 270:return[he,0,ae,he];default:return[0,0,ae,he]}},Y=new WeakSet,jr=function(){this.ctx.lineWidth=this.thickness*this.parent.scaleFactor/this.scaleFactor,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.miterLimit=10,this.ctx.strokeStyle=`${this.color}${(0,d.opacityToHex)(this.opacity)}`},U=new WeakSet,qs=function(ae,he){this.isEditing=!0,B(this,v)||(xe(this,v,!0),ue(this,p,gn).call(this),this.thickness||=Ee._defaultThickness,this.color||=Ee._defaultColor||r.AnnotationEditor._defaultLineColor,this.opacity??=Ee._defaultOpacity),this.currentPath.push([ae,he]),xe(this,k,null),ue(this,Y,jr).call(this),this.ctx.beginPath(),this.ctx.moveTo(ae,he),xe(this,u,()=>{B(this,u)&&(B(this,k)&&(this.isEmpty()?(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)):ue(this,x,vt).call(this),this.ctx.lineTo(...B(this,k)),xe(this,k,null),this.ctx.stroke()),window.requestAnimationFrame(B(this,u)))}),window.requestAnimationFrame(B(this,u))},re=new WeakSet,Ks=function(ae,he){let[Q,G]=this.currentPath.at(-1);ae===Q&&he===G||(this.currentPath.push([ae,he]),xe(this,k,[ae,he]))},we=new WeakSet,Js=function(ae,he){var Ae;this.ctx.closePath(),xe(this,u,null),ae=Math.min(Math.max(ae,0),this.canvas.width),he=Math.min(Math.max(he,0),this.canvas.height);let[Q,G]=this.currentPath.at(-1);(ae!==Q||he!==G)&&this.currentPath.push([ae,he]);let z;if(this.currentPath.length!==1)z=(0,a.fitCurve)(this.currentPath,30,null);else{let Ce=[ae,he];z=[[Ce,Ce.slice(),Ce.slice(),Ce]]}let me=ue(Ae=Ee,ee,Xr).call(Ae,z);this.currentPath.length=0;let Fe=()=>{this.paths.push(z),this.bezierPath2D.push(me),this.rebuild()},_e=()=>{this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(ue(this,V,_o).call(this),ue(this,K,bo).call(this)),ue(this,Me,fn).call(this))};this.parent.addCommands({cmd:Fe,undo:_e,mustExec:!0})},x=new WeakSet,vt=function(){if(this.isEmpty()){ue(this,O,To).call(this);return}ue(this,Y,jr).call(this);let{canvas:ae,ctx:he}=this;he.setTransform(1,0,0,1,0,0),he.clearRect(0,0,ae.width,ae.height),ue(this,O,To).call(this);for(let Q of this.bezierPath2D)he.stroke(Q)},L=new WeakSet,Gr=function(ae){ue(this,we,Js).call(this,ae.offsetX,ae.offsetY),this.canvas.removeEventListener("pointerleave",B(this,F)),this.canvas.removeEventListener("pointermove",B(this,_)),this.parent.addToAnnotationStorage(this)},V=new WeakSet,_o=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",Ee._l10nPromise.get("editor_ink_canvas_aria_label").then(ae=>this.canvas?.setAttribute("aria-label",ae)),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},K=new WeakSet,bo=function(){xe(this,y,new ResizeObserver(ae=>{let he=ae[0].contentRect;he.width&&he.height&&this.setDimensions(he.width,he.height)})),B(this,y).observe(this.div)},p=new WeakSet,gn=function(){if(!B(this,v))return;let[ae,he]=this.parent.viewportBaseDimensions;this.canvas.width=Math.ceil(this.width*ae),this.canvas.height=Math.ceil(this.height*he),ue(this,O,To).call(this)},D=new WeakSet,Ur=function(ae,he){let Q=ue(this,Te,Ao).call(this),G=(ae-Q)/B(this,C),z=(he-Q)/B(this,A);this.scaleFactor=Math.min(G,z)},O=new WeakSet,To=function(){let ae=ue(this,Te,Ao).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+ae,this.translationY*this.scaleFactor+ae)},ee=new WeakSet,Xr=function(ae){let he=new Path2D;for(let Q=0,G=ae.length;Q<G;Q++){let[z,me,Fe,_e]=ae[Q];Q===0&&he.moveTo(...z),he.bezierCurveTo(me[0],me[1],Fe[0],Fe[1],_e[0],_e[1])}return he},te=new WeakSet,$s=function(ae,he,Q,G){let me=[],Fe=this.thickness/2,_e,Ae;for(let Ce of this.paths){_e=[],Ae=[];for(let Ge=0,Be=Ce.length;Ge<Be;Ge++){let[ve,ze,Ue,ut]=Ce[Ge],Le=ae*(ve[0]+he)+Fe,qe=G-ae*(ve[1]+Q)-Fe,Ft=ae*(ze[0]+he)+Fe,jt=G-ae*(ze[1]+Q)-Fe,Gt=ae*(Ue[0]+he)+Fe,_t=G-ae*(Ue[1]+Q)-Fe,Ze=ae*(ut[0]+he)+Fe,wt=G-ae*(ut[1]+Q)-Fe;Ge===0&&(_e.push(Le,qe),Ae.push(Le,qe)),_e.push(Ft,jt,Gt,_t,Ze,wt),ue(this,se,Ys).call(this,Le,qe,Ft,jt,Gt,_t,Ze,wt,4,Ae)}me.push({bezier:_e,points:Ae})}return me},se=new WeakSet,Ys=function(ae,he,Q,G,z,me,Fe,_e,Ae,Ce){if(ue(this,fe,Qs).call(this,ae,he,Q,G,z,me,Fe,_e)){Ce.push(Fe,_e);return}for(let Ge=1;Ge<Ae-1;Ge++){let Be=Ge/Ae,ve=1-Be,ze=Be*ae+ve*Q,Ue=Be*he+ve*G,ut=Be*Q+ve*z,Le=Be*G+ve*me,qe=Be*z+ve*Fe,Ft=Be*me+ve*_e;ze=Be*ze+ve*ut,Ue=Be*Ue+ve*Le,ut=Be*ut+ve*qe,Le=Be*Le+ve*Ft,ze=Be*ze+ve*ut,Ue=Be*Ue+ve*Le,Ce.push(ze,Ue)}Ce.push(Fe,_e)},fe=new WeakSet,Qs=function(ae,he,Q,G,z,me,Fe,_e){let Ce=(3*Q-2*ae-Fe)**2,Ge=(3*G-2*he-_e)**2,Be=(3*z-ae-2*Fe)**2,ve=(3*me-he-2*_e)**2;return Math.max(Ce,Be)+Math.max(Ge,ve)<=10},de=new WeakSet,zr=function(){let ae=1/0,he=-1/0,Q=1/0,G=-1/0;for(let z of this.paths)for(let[me,Fe,_e,Ae]of z){let Ce=n.Util.bezierBoundingBox(...me,...Fe,..._e,...Ae);ae=Math.min(ae,Ce[0]),Q=Math.min(Q,Ce[1]),he=Math.max(he,Ce[2]),G=Math.max(G,Ce[3])}return[ae,Q,he,G]},Te=new WeakSet,Ao=function(){return B(this,s)?Math.ceil(this.thickness*this.parent.scaleFactor):0},Me=new WeakSet,fn=function(ae=!1){if(this.isEmpty())return;if(!B(this,s)){ue(this,x,vt).call(this);return}let he=ue(this,de,zr).call(this),Q=ue(this,Te,Ao).call(this);xe(this,C,Math.max(S,he[2]-he[0])),xe(this,A,Math.max(S,he[3]-he[1]));let G=Math.ceil(Q+B(this,C)*this.scaleFactor),z=Math.ceil(Q+B(this,A)*this.scaleFactor),[me,Fe]=this.parent.viewportBaseDimensions;this.width=G/me,this.height=z/Fe,xe(this,m,G/z),ue(this,Ie,qr).call(this);let _e=this.translationX,Ae=this.translationY;this.translationX=-he[0],this.translationY=-he[1],ue(this,p,gn).call(this),ue(this,x,vt).call(this),xe(this,h,G),xe(this,c,z),this.setDims(G,z);let Ce=ae?Q/this.scaleFactor/2:0;this.translate(_e-this.translationX-Ce,Ae-this.translationY-Ce)},Ie=new WeakSet,qr=function(){let{style:ae}=this.div;B(this,m)>=1?(ae.minHeight=`${S}px`,ae.minWidth=`${Math.round(B(this,m)*S)}px`):(ae.minWidth=`${S}px`,ae.minHeight=`${Math.round(S/B(this,m))}px`)},le(b,ee),We(b,"_defaultColor",null),We(b,"_defaultOpacity",1),We(b,"_defaultThickness",1),We(b,"_l10nPromise"),We(b,"_type","ink"),t.InkEditor=b},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fitCurve=void 0;let n=e(26);t.fitCurve=n},o=>{function t(i,l,s){if(!Array.isArray(i))throw new TypeError("First argument should be an array");if(i.forEach(h=>{if(!Array.isArray(h)||h.some(c=>typeof c!="number")||h.length!==i[0].length)throw Error("Each point should be an array of numbers. Each point should have the same amount of numbers.")}),i=i.filter((h,c)=>c===0||!h.every((u,f)=>u===i[c-1][f])),i.length<2)return[];let v=i.length,k=C(i[1],i[0]),y=C(i[v-2],i[v-1]);return e(i,k,y,l,s)}function e(i,l,s,v,k){var h,c,u,f,M,E,w,P,ne,ie,Z,Y,j;if(i.length===2)return Y=_.vectorLen(_.subtract(i[0],i[1]))/3,h=[i[0],_.addArrays(i[0],_.mulItems(l,Y)),_.addArrays(i[1],_.mulItems(s,Y)),i[1]],[h];if(c=S(i),[h,f,E]=n(i,c,c,l,s,k),f===0||f<v)return[h];if(f<v*v)for(u=c,M=f,w=E,j=0;j<20;j++){if(u=a(h,i,u),[h,f,E]=n(i,c,u,l,s,k),f<v)return[h];if(E===w){let U=f/M;if(U>.9999&&U<1.0001)break}M=f,w=E}return Z=[],P=_.subtract(i[E-1],i[E+1]),P.every(U=>U===0)&&(P=_.subtract(i[E-1],i[E]),[P[0],P[1]]=[-P[1],P[0]]),ne=_.normalize(P),ie=_.mulItems(ne,-1),Z=Z.concat(e(i.slice(0,E+1),l,ne,v,k)),Z=Z.concat(e(i.slice(E),ie,s,v,k)),Z}function n(i,l,s,v,k,y){var h,c,u;return h=r(i,s,v,k,y),[c,u]=b(i,h,l),y&&y({bez:h,points:i,params:l,maxErr:c,maxPoint:u}),[h,c,u]}function r(i,l,s,v){var k,y,h,c,u,f,M,E,w,P,ne,ie,Z,Y,j,U,q,re=i[0],pe=i[i.length-1];for(k=[re,null,null,pe],y=_.zeros_Xx2x2(l.length),Z=0,Y=l.length;Z<Y;Z++)U=l[Z],q=1-U,h=y[Z],h[0]=_.mulItems(s,3*U*(q*q)),h[1]=_.mulItems(v,3*q*(U*U));for(c=[[0,0],[0,0]],u=[0,0],Z=0,Y=i.length;Z<Y;Z++)U=l[Z],h=y[Z],c[0][0]+=_.dot(h[0],h[0]),c[0][1]+=_.dot(h[0],h[1]),c[1][0]+=_.dot(h[0],h[1]),c[1][1]+=_.dot(h[1],h[1]),j=_.subtract(i[Z],F.q([re,re,pe,pe],U)),u[0]+=_.dot(h[0],j),u[1]+=_.dot(h[1],j);return f=c[0][0]*c[1][1]-c[1][0]*c[0][1],M=c[0][0]*u[1]-c[1][0]*u[0],E=u[0]*c[1][1]-u[1]*c[0][1],w=f===0?0:E/f,P=f===0?0:M/f,ie=_.vectorLen(_.subtract(re,pe)),ne=1e-6*ie,w<ne||P<ne?(k[1]=_.addArrays(re,_.mulItems(s,ie/3)),k[2]=_.addArrays(pe,_.mulItems(v,ie/3))):(k[1]=_.addArrays(re,_.mulItems(s,w)),k[2]=_.addArrays(pe,_.mulItems(v,P))),k}function a(i,l,s){return s.map((v,k)=>d(i,l[k],v))}function d(i,l,s){var v=_.subtract(F.q(i,s),l),k=F.qprime(i,s),y=_.mulMatrix(v,k),h=_.sum(_.squareItems(k))+2*_.mulMatrix(v,F.qprimeprime(i,s));return h===0?s:s-y/h}function S(i){var l=[],s,v,k;return i.forEach((y,h)=>{s=h?v+_.vectorLen(_.subtract(y,k)):0,l.push(s),v=s,k=y}),l=l.map(y=>y/v),l}function b(i,l,s){var v,k,y,h,c,u,f,M;k=0,y=Math.floor(i.length/2);let E=m(l,10);for(c=0,u=i.length;c<u;c++)f=i[c],M=A(l,s[c],E,10),h=_.subtract(F.q(l,M),f),v=h[0]*h[0]+h[1]*h[1],v>k&&(k=v,y=c);return[k,y]}var m=function(i,l){for(var s,v=[0],k=i[0],y=0,h=1;h<=l;h++)s=F.q(i,h/l),y+=_.vectorLen(_.subtract(s,k)),v.push(y),k=s;return v=v.map(c=>c/y),v};function A(i,l,s,v){if(l<0)return 0;if(l>1)return 1;for(var k,y,h,c,u,f=1;f<=v;f++)if(l<=s[f]){c=(f-1)/v,h=f/v,y=s[f-1],k=s[f],u=(l-y)/(k-y)*(h-c)+c;break}return u}function C(i,l){return _.normalize(_.subtract(i,l))}class _{static zeros_Xx2x2(l){for(var s=[];l--;)s.push([0,0]);return s}static mulItems(l,s){return l.map(v=>v*s)}static mulMatrix(l,s){return l.reduce((v,k,y)=>v+k*s[y],0)}static subtract(l,s){return l.map((v,k)=>v-s[k])}static addArrays(l,s){return l.map((v,k)=>v+s[k])}static addItems(l,s){return l.map(v=>v+s)}static sum(l){return l.reduce((s,v)=>s+v)}static dot(l,s){return _.mulMatrix(l,s)}static vectorLen(l){return Math.hypot(...l)}static divItems(l,s){return l.map(v=>v/s)}static squareItems(l){return l.map(s=>s*s)}static normalize(l){return this.divItems(l,this.vectorLen(l))}}class F{static q(l,s){var v=1-s,k=_.mulItems(l[0],v*v*v),y=_.mulItems(l[1],3*v*v*s),h=_.mulItems(l[2],3*v*s*s),c=_.mulItems(l[3],s*s*s);return _.addArrays(_.addArrays(k,y),_.addArrays(h,c))}static qprime(l,s){var v=1-s,k=_.mulItems(_.subtract(l[1],l[0]),3*v*v),y=_.mulItems(_.subtract(l[2],l[1]),6*v*s),h=_.mulItems(_.subtract(l[3],l[2]),3*s*s);return _.addArrays(_.addArrays(k,y),h)}static qprimeprime(l,s){return _.addArrays(_.mulItems(_.addArrays(_.subtract(l[2],_.mulItems(l[1],2)),l[0]),6*(1-s)),_.mulItems(_.addArrays(_.subtract(l[3],_.mulItems(l[2],2)),l[1]),6*s))}}o.exports=t,o.exports.fitCubic=e,o.exports.createTangent=C},(o,t,e)=>{var x,Kr,L,Jr,V,$r;Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationLayer=void 0;var n=e(1),r=e(8),a=e(5),d=e(28),S=e(29);let b=1e3,m=9,A=new WeakSet;function C(J){return{width:J[2]-J[0],height:J[3]-J[1]}}class _{static create(p){switch(p.data.annotationType){case n.AnnotationType.LINK:return new i(p);case n.AnnotationType.TEXT:return new l(p);case n.AnnotationType.WIDGET:switch(p.data.fieldType){case"Tx":return new v(p);case"Btn":return p.data.radioButton?new y(p):p.data.checkBox?new k(p):new h(p);case"Ch":return new c(p)}return new s(p);case n.AnnotationType.POPUP:return new u(p);case n.AnnotationType.FREETEXT:return new M(p);case n.AnnotationType.LINE:return new E(p);case n.AnnotationType.SQUARE:return new w(p);case n.AnnotationType.CIRCLE:return new P(p);case n.AnnotationType.POLYLINE:return new ne(p);case n.AnnotationType.CARET:return new Z(p);case n.AnnotationType.INK:return new Y(p);case n.AnnotationType.POLYGON:return new ie(p);case n.AnnotationType.HIGHLIGHT:return new j(p);case n.AnnotationType.UNDERLINE:return new U(p);case n.AnnotationType.SQUIGGLY:return new q(p);case n.AnnotationType.STRIKEOUT:return new re(p);case n.AnnotationType.STAMP:return new pe(p);case n.AnnotationType.FILEATTACHMENT:return new we(p);default:return new F(p)}}}class F{constructor(p,{isRenderable:T=!1,ignoreBorder:D=!1,createQuadrilaterals:R=!1}={}){this.isRenderable=T,this.data=p.data,this.layer=p.layer,this.page=p.page,this.viewport=p.viewport,this.linkService=p.linkService,this.downloadManager=p.downloadManager,this.imageResourcesPath=p.imageResourcesPath,this.renderForms=p.renderForms,this.svgFactory=p.svgFactory,this.annotationStorage=p.annotationStorage,this.enableScripting=p.enableScripting,this.hasJSActions=p.hasJSActions,this._fieldObjects=p.fieldObjects,this._mouseState=p.mouseState,T&&(this.container=this._createContainer(D)),R&&(this.quadrilaterals=this._createQuadrilaterals(D))}_createContainer(p=!1){let T=this.data,D=this.page,R=this.viewport,O=document.createElement("section"),{width:X,height:ee}=C(T.rect),[ge,te,oe,se]=R.viewBox,ce=oe-ge,fe=se-te;O.setAttribute("data-annotation-id",T.id);let W=n.Util.normalizeRect([T.rect[0],D.view[3]-T.rect[1]+D.view[1],T.rect[2],D.view[3]-T.rect[3]+D.view[1]]);if(!p&&T.borderStyle.width>0){O.style.borderWidth=`${T.borderStyle.width}px`;let be=T.borderStyle.horizontalCornerRadius,Te=T.borderStyle.verticalCornerRadius;if(be>0||Te>0){let Me=`calc(${be}px * var(--scale-factor)) / calc(${Te}px * var(--scale-factor))`;O.style.borderRadius=Me}else if(this instanceof y){let Me=`calc(${X}px * var(--scale-factor)) / calc(${ee}px * var(--scale-factor))`;O.style.borderRadius=Me}switch(T.borderStyle.style){case n.AnnotationBorderStyleType.SOLID:O.style.borderStyle="solid";break;case n.AnnotationBorderStyleType.DASHED:O.style.borderStyle="dashed";break;case n.AnnotationBorderStyleType.BEVELED:(0,n.warn)("Unimplemented border style: beveled");break;case n.AnnotationBorderStyleType.INSET:(0,n.warn)("Unimplemented border style: inset");break;case n.AnnotationBorderStyleType.UNDERLINE:O.style.borderBottomStyle="solid";break;default:break}let ke=T.borderColor||null;ke?O.style.borderColor=n.Util.makeHexColor(ke[0]|0,ke[1]|0,ke[2]|0):O.style.borderWidth=0}O.style.left=`${100*(W[0]-ge)/ce}%`,O.style.top=`${100*(W[1]-te)/fe}%`;let{rotation:de}=T;return T.hasOwnCanvas||de===0?(O.style.width=`${100*X/ce}%`,O.style.height=`${100*ee/fe}%`):this.setRotation(de,O),O}setRotation(p,T=this.container){let[D,R,O,X]=this.viewport.viewBox,ee=O-D,ge=X-R,{width:te,height:oe}=C(this.data.rect),se,ce;p%180===0?(se=100*te/ee,ce=100*oe/ge):(se=100*oe/ee,ce=100*te/ge),T.style.width=`${se}%`,T.style.height=`${ce}%`,T.setAttribute("data-main-rotation",(360-p)%360)}get _commonActions(){let p=(T,D,R)=>{let O=R.detail[T];R.target.style[D]=d.ColorConverters[`${O[0]}_HTML`](O.slice(1))};return(0,n.shadow)(this,"_commonActions",{display:T=>{let D=T.detail.display%2===1;this.container.style.visibility=D?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:D,print:T.detail.display===0||T.detail.display===3})},print:T=>{this.annotationStorage.setValue(this.data.id,{print:T.detail.print})},hidden:T=>{this.container.style.visibility=T.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:T.detail.hidden})},focus:T=>{setTimeout(()=>T.target.focus({preventScroll:!1}),0)},userName:T=>{T.target.title=T.detail.userName},readonly:T=>{T.detail.readonly?T.target.setAttribute("readonly",""):T.target.removeAttribute("readonly")},required:T=>{this._setRequired(T.target,T.detail.required)},bgColor:T=>{p("bgColor","backgroundColor",T)},fillColor:T=>{p("fillColor","backgroundColor",T)},fgColor:T=>{p("fgColor","color",T)},textColor:T=>{p("textColor","color",T)},borderColor:T=>{p("borderColor","borderColor",T)},strokeColor:T=>{p("strokeColor","borderColor",T)},rotation:T=>{let D=T.detail.rotation;this.setRotation(D),this.annotationStorage.setValue(this.data.id,{rotation:D})}})}_dispatchEventFromSandbox(p,T){let D=this._commonActions;for(let R of Object.keys(T.detail)){let O=p[R]||D[R];O&&O(T)}}_setDefaultPropertiesFromJS(p){if(!this.enableScripting)return;let T=this.annotationStorage.getRawValue(this.data.id);if(!T)return;let D=this._commonActions;for(let[R,O]of Object.entries(T)){let X=D[R];if(X){let ee={detail:{[R]:O},target:p};X(ee),delete T[R]}}}_createQuadrilaterals(p=!1){if(!this.data.quadPoints)return null;let T=[],D=this.data.rect;for(let R of this.data.quadPoints)this.data.rect=[R[2].x,R[2].y,R[1].x,R[1].y],T.push(this._createContainer(p));return this.data.rect=D,T}_createPopup(p,T){let D=this.container;this.quadrilaterals&&(p=p||this.quadrilaterals,D=this.quadrilaterals[0]),p||(p=document.createElement("div"),p.className="popupTriggerArea",D.append(p));let O=new f({container:D,trigger:p,color:T.color,titleObj:T.titleObj,modificationDate:T.modificationDate,contentsObj:T.contentsObj,richText:T.richText,hideWrapper:!0}).render();O.style.left="100%",D.append(O)}_renderQuadrilaterals(p){for(let T of this.quadrilaterals)T.className=p;return this.quadrilaterals}render(){(0,n.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(p,T=null){let D=[];if(this._fieldObjects){let R=this._fieldObjects[p];if(R)for(let{page:O,id:X,exportValues:ee}of R){if(O===-1||X===T)continue;let ge=typeof ee=="string"?ee:null,te=document.querySelector(`[data-element-id="${X}"]`);if(te&&!A.has(te)){(0,n.warn)(`_getElementsByName - element not allowed: ${X}`);continue}D.push({id:X,exportValue:ge,domElement:te})}return D}for(let R of document.getElementsByName(p)){let{id:O,exportValue:X}=R;O!==T&&A.has(R)&&D.push({id:O,exportValue:X,domElement:R})}return D}static get platform(){let p=typeof navigator<"u"?navigator.platform:"";return(0,n.shadow)(this,"platform",{isWin:p.includes("Win"),isMac:p.includes("Mac")})}}class i extends F{constructor(p,T=null){super(p,{isRenderable:!0,ignoreBorder:!!T?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=p.data.isTooltipOnly}render(){let{data:p,linkService:T}=this,D=document.createElement("a");D.setAttribute("data-element-id",p.id);let R=!1;return p.url?(T.addLinkAttributes(D,p.url,p.newWindow),R=!0):p.action?(this._bindNamedAction(D,p.action),R=!0):p.dest?(this._bindLink(D,p.dest),R=!0):(p.actions&&(p.actions.Action||p.actions["Mouse Up"]||p.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(D,p),R=!0),p.resetForm?(this._bindResetFormAction(D,p.resetForm),R=!0):this.isTooltipOnly&&!R&&(this._bindLink(D,""),R=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((O,X)=>{let ee=X===0?D:D.cloneNode();return O.append(ee),O}):(this.container.className="linkAnnotation",R&&this.container.append(D),this.container)}_bindLink(p,T){p.href=this.linkService.getDestinationHash(T),p.onclick=()=>(T&&this.linkService.goToDestination(T),!1),(T||T==="")&&(p.className="internalLink")}_bindNamedAction(p,T){p.href=this.linkService.getAnchorUrl(""),p.onclick=()=>(this.linkService.executeNamedAction(T),!1),p.className="internalLink"}_bindJSAction(p,T){p.href=this.linkService.getAnchorUrl("");let D=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let R of Object.keys(T.actions)){let O=D.get(R);O&&(p[O]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:T.id,name:R}}),!1))}p.onclick||(p.onclick=()=>!1),p.className="internalLink"}_bindResetFormAction(p,T){let D=p.onclick;if(D||(p.href=this.linkService.getAnchorUrl("")),p.className="internalLink",!this._fieldObjects){(0,n.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),D||(p.onclick=()=>!1);return}p.onclick=()=>{D&&D();let{fields:R,refs:O,include:X}=T,ee=[];if(R.length!==0||O.length!==0){let oe=new Set(O);for(let se of R){let ce=this._fieldObjects[se]||[];for(let{id:fe}of ce)oe.add(fe)}for(let se of Object.values(this._fieldObjects))for(let ce of se)oe.has(ce.id)===X&&ee.push(ce)}else for(let oe of Object.values(this._fieldObjects))ee.push(...oe);let ge=this.annotationStorage,te=[];for(let oe of ee){let{id:se}=oe;switch(te.push(se),oe.type){case"text":{let fe=oe.defaultValue||"";ge.setValue(se,{value:fe});break}case"checkbox":case"radiobutton":{let fe=oe.defaultValue===oe.exportValues;ge.setValue(se,{value:fe});break}case"combobox":case"listbox":{let fe=oe.defaultValue||"";ge.setValue(se,{value:fe});break}default:continue}let ce=document.querySelector(`[data-element-id="${se}"]`);if(ce){if(!A.has(ce)){(0,n.warn)(`_bindResetFormAction - element not allowed: ${se}`);continue}}else continue;ce.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:te,name:"ResetForm"}}),!1}}}class l extends F{constructor(p){let T=!!(p.data.hasPopup||p.data.titleObj?.str||p.data.contentsObj?.str||p.data.richText?.str);super(p,{isRenderable:T})}render(){this.container.className="textAnnotation";let p=document.createElement("img");return p.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",p.alt="[{{type}} Annotation]",p.dataset.l10nId="text_annotation_type",p.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(p,this.data),this.container.append(p),this.container}}class s extends F{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(p){let{isWin:T,isMac:D}=F.platform;return T&&p.ctrlKey||D&&p.metaKey}_setEventListener(p,T,D,R){T.includes("mouse")?p.addEventListener(T,O=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:D,value:R(O),shift:O.shiftKey,modifier:this._getKeyModifier(O)}})}):p.addEventListener(T,O=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:D,value:R(O)}})})}_setEventListeners(p,T,D){for(let[R,O]of T)(O==="Action"||this.data.actions?.[O])&&this._setEventListener(p,R,O,D)}_setBackgroundColor(p){let T=this.data.backgroundColor||null;p.style.backgroundColor=T===null?"transparent":n.Util.makeHexColor(T[0],T[1],T[2])}_setTextStyle(p){let T=["left","center","right"],{fontColor:D}=this.data.defaultAppearanceData,R=this.data.defaultAppearanceData.fontSize||m,O=p.style,X;if(this.data.multiLine){let ee=Math.abs(this.data.rect[3]-this.data.rect[1]),ge=Math.round(ee/(n.LINE_FACTOR*R))||1,te=ee/ge;X=Math.min(R,Math.round(te/n.LINE_FACTOR))}else{let ee=Math.abs(this.data.rect[3]-this.data.rect[1]);X=Math.min(R,Math.round(ee/n.LINE_FACTOR))}O.fontSize=`calc(${X}px * var(--scale-factor))`,O.color=n.Util.makeHexColor(D[0],D[1],D[2]),this.data.textAlignment!==null&&(O.textAlign=T[this.data.textAlignment])}_setRequired(p,T){T?p.setAttribute("required",!0):p.removeAttribute("required"),p.setAttribute("aria-required",T)}}class v extends s{constructor(p){let T=p.renderForms||!p.data.hasAppearance&&!!p.data.fieldValue;super(p,{isRenderable:T})}setPropertyOnSiblings(p,T,D,R){let O=this.annotationStorage;for(let X of this._getElementsByName(p.name,p.id))X.domElement&&(X.domElement[T]=D),O.setValue(X.id,{[R]:D})}render(){let p=this.annotationStorage,T=this.data.id;this.container.className="textWidgetAnnotation";let D=null;if(this.renderForms){let R=p.getValue(T,{value:this.data.fieldValue}),O=R.formattedValue||R.value||"",X=p.getValue(T,{charLimit:this.data.maxLen}).charLimit;X&&O.length>X&&(O=O.slice(0,X));let ee={userValue:O,formattedValue:null,valueOnFocus:""};this.data.multiLine?(D=document.createElement("textarea"),D.textContent=O,this.data.doNotScroll&&(D.style.overflowY="hidden")):(D=document.createElement("input"),D.type="text",D.setAttribute("value",O),this.data.doNotScroll&&(D.style.overflowX="hidden")),A.add(D),D.setAttribute("data-element-id",T),D.disabled=this.data.readOnly,D.name=this.data.fieldName,D.tabIndex=b,this._setRequired(D,this.data.required),X&&(D.maxLength=X),D.addEventListener("input",te=>{p.setValue(T,{value:te.target.value}),this.setPropertyOnSiblings(D,"value",te.target.value,"value")}),D.addEventListener("resetform",te=>{let oe=this.data.defaultFieldValue??"";D.value=ee.userValue=oe,ee.formattedValue=null});let ge=te=>{let{formattedValue:oe}=ee;oe!=null&&(te.target.value=oe),te.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){D.addEventListener("focus",oe=>{ee.userValue&&(oe.target.value=ee.userValue),ee.valueOnFocus=oe.target.value}),D.addEventListener("updatefromsandbox",oe=>{let se={value(ce){ee.userValue=ce.detail.value??"",p.setValue(T,{value:ee.userValue.toString()}),ce.target.value=ee.userValue},formattedValue(ce){let{formattedValue:fe}=ce.detail;ee.formattedValue=fe,fe!=null&&ce.target!==document.activeElement&&(ce.target.value=fe),p.setValue(T,{formattedValue:fe})},selRange(ce){ce.target.setSelectionRange(...ce.detail.selRange)},charLimit:ce=>{let{charLimit:fe}=ce.detail,{target:W}=ce;if(fe===0){W.removeAttribute("maxLength");return}W.setAttribute("maxLength",fe);let de=ee.userValue;!de||de.length<=fe||(de=de.slice(0,fe),W.value=ee.userValue=de,p.setValue(T,{value:de}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:T,name:"Keystroke",value:de,willCommit:!0,commitKey:1,selStart:W.selectionStart,selEnd:W.selectionEnd}}))}};this._dispatchEventFromSandbox(se,oe)}),D.addEventListener("keydown",oe=>{let se=-1;if(oe.key==="Escape"?se=0:oe.key==="Enter"?se=2:oe.key==="Tab"&&(se=3),se===-1)return;let{value:ce}=oe.target;ee.valueOnFocus!==ce&&(ee.userValue=ce,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:T,name:"Keystroke",value:ce,willCommit:!0,commitKey:se,selStart:oe.target.selectionStart,selEnd:oe.target.selectionEnd}}))});let te=ge;ge=null,D.addEventListener("blur",oe=>{let{value:se}=oe.target;ee.userValue=se,this._mouseState.isDown&&ee.valueOnFocus!==se&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:T,name:"Keystroke",value:se,willCommit:!0,commitKey:1,selStart:oe.target.selectionStart,selEnd:oe.target.selectionEnd}}),te(oe)}),this.data.actions?.Keystroke&&D.addEventListener("beforeinput",oe=>{let{data:se,target:ce}=oe,{value:fe,selectionStart:W,selectionEnd:de}=ce,be=W,Te=de;switch(oe.inputType){case"deleteWordBackward":{let ke=fe.substring(0,W).match(/\w*[^\w]*$/);ke&&(be-=ke[0].length);break}case"deleteWordForward":{let ke=fe.substring(W).match(/^[^\w]*\w*/);ke&&(Te+=ke[0].length);break}case"deleteContentBackward":W===de&&(be-=1);break;case"deleteContentForward":W===de&&(Te+=1);break}oe.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:T,name:"Keystroke",value:fe,change:se||"",willCommit:!1,selStart:be,selEnd:Te}})}),this._setEventListeners(D,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],oe=>oe.target.value)}if(ge&&D.addEventListener("blur",ge),this.data.comb){let oe=(this.data.rect[2]-this.data.rect[0])/X;D.classList.add("comb"),D.style.letterSpacing=`calc(${oe}px * var(--scale-factor) - 1ch)`}}else D=document.createElement("div"),D.textContent=this.data.fieldValue,D.style.verticalAlign="middle",D.style.display="table-cell";return this._setTextStyle(D),this._setBackgroundColor(D),this._setDefaultPropertiesFromJS(D),this.container.append(D),this.container}}class k extends s{constructor(p){super(p,{isRenderable:p.renderForms})}render(){let p=this.annotationStorage,T=this.data,D=T.id,R=p.getValue(D,{value:T.exportValue===T.fieldValue}).value;typeof R=="string"&&(R=R!=="Off",p.setValue(D,{value:R})),this.container.className="buttonWidgetAnnotation checkBox";let O=document.createElement("input");return A.add(O),O.setAttribute("data-element-id",D),O.disabled=T.readOnly,this._setRequired(O,this.data.required),O.type="checkbox",O.name=T.fieldName,R&&O.setAttribute("checked",!0),O.setAttribute("exportValue",T.exportValue),O.tabIndex=b,O.addEventListener("change",X=>{let{name:ee,checked:ge}=X.target;for(let te of this._getElementsByName(ee,D)){let oe=ge&&te.exportValue===T.exportValue;te.domElement&&(te.domElement.checked=oe),p.setValue(te.id,{value:oe})}p.setValue(D,{value:ge})}),O.addEventListener("resetform",X=>{let ee=T.defaultFieldValue||"Off";X.target.checked=ee===T.exportValue}),this.enableScripting&&this.hasJSActions&&(O.addEventListener("updatefromsandbox",X=>{let ee={value(ge){ge.target.checked=ge.detail.value!=="Off",p.setValue(D,{value:ge.target.checked})}};this._dispatchEventFromSandbox(ee,X)}),this._setEventListeners(O,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],X=>X.target.checked)),this._setBackgroundColor(O),this._setDefaultPropertiesFromJS(O),this.container.append(O),this.container}}class y extends s{constructor(p){super(p,{isRenderable:p.renderForms})}render(){this.container.className="buttonWidgetAnnotation radioButton";let p=this.annotationStorage,T=this.data,D=T.id,R=p.getValue(D,{value:T.fieldValue===T.buttonValue}).value;typeof R=="string"&&(R=R!==T.buttonValue,p.setValue(D,{value:R}));let O=document.createElement("input");if(A.add(O),O.setAttribute("data-element-id",D),O.disabled=T.readOnly,this._setRequired(O,this.data.required),O.type="radio",O.name=T.fieldName,R&&O.setAttribute("checked",!0),O.tabIndex=b,O.addEventListener("change",X=>{let{name:ee,checked:ge}=X.target;for(let te of this._getElementsByName(ee,D))p.setValue(te.id,{value:!1});p.setValue(D,{value:ge})}),O.addEventListener("resetform",X=>{let ee=T.defaultFieldValue;X.target.checked=ee!=null&&ee===T.buttonValue}),this.enableScripting&&this.hasJSActions){let X=T.buttonValue;O.addEventListener("updatefromsandbox",ee=>{let ge={value:te=>{let oe=X===te.detail.value;for(let se of this._getElementsByName(te.target.name)){let ce=oe&&se.id===D;se.domElement&&(se.domElement.checked=ce),p.setValue(se.id,{value:ce})}}};this._dispatchEventFromSandbox(ge,ee)}),this._setEventListeners(O,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ee=>ee.target.checked)}return this._setBackgroundColor(O),this._setDefaultPropertiesFromJS(O),this.container.append(O),this.container}}class h extends i{constructor(p){super(p,{ignoreBorder:p.data.hasAppearance})}render(){let p=super.render();p.className="buttonWidgetAnnotation pushButton",this.data.alternativeText&&(p.title=this.data.alternativeText);let T=p.lastChild;return this.enableScripting&&this.hasJSActions&&T&&(this._setDefaultPropertiesFromJS(T),T.addEventListener("updatefromsandbox",D=>{this._dispatchEventFromSandbox({},D)})),p}}class c extends s{constructor(p){super(p,{isRenderable:p.renderForms})}render(){this.container.className="choiceWidgetAnnotation";let p=this.annotationStorage,T=this.data.id,D=p.getValue(T,{value:this.data.fieldValue}),R=document.createElement("select");A.add(R),R.setAttribute("data-element-id",T),R.disabled=this.data.readOnly,this._setRequired(R,this.data.required),R.name=this.data.fieldName,R.tabIndex=b;let O=this.data.combo&&this.data.options.length>0;this.data.combo||(R.size=this.data.options.length,this.data.multiSelect&&(R.multiple=!0)),R.addEventListener("resetform",te=>{let oe=this.data.defaultFieldValue;for(let se of R.options)se.selected=se.value===oe});for(let te of this.data.options){let oe=document.createElement("option");oe.textContent=te.displayValue,oe.value=te.exportValue,D.value.includes(te.exportValue)&&(oe.setAttribute("selected",!0),O=!1),R.append(oe)}let X=null;if(O){let te=document.createElement("option");te.value=" ",te.setAttribute("hidden",!0),te.setAttribute("selected",!0),R.prepend(te),X=()=>{te.remove(),R.removeEventListener("input",X),X=null},R.addEventListener("input",X)}let ee=(te,oe)=>{let se=oe?"value":"textContent",ce=te.target.options;return te.target.multiple?Array.prototype.filter.call(ce,fe=>fe.selected).map(fe=>fe[se]):ce.selectedIndex===-1?null:ce[ce.selectedIndex][se]},ge=te=>{let oe=te.target.options;return Array.prototype.map.call(oe,se=>({displayValue:se.textContent,exportValue:se.value}))};return this.enableScripting&&this.hasJSActions?(R.addEventListener("updatefromsandbox",te=>{let oe={value(se){X?.();let ce=se.detail.value,fe=new Set(Array.isArray(ce)?ce:[ce]);for(let W of R.options)W.selected=fe.has(W.value);p.setValue(T,{value:ee(se,!0)})},multipleSelection(se){R.multiple=!0},remove(se){let ce=R.options,fe=se.detail.remove;ce[fe].selected=!1,R.remove(fe),ce.length>0&&Array.prototype.findIndex.call(ce,de=>de.selected)===-1&&(ce[0].selected=!0),p.setValue(T,{value:ee(se,!0),items:ge(se)})},clear(se){for(;R.length!==0;)R.remove(0);p.setValue(T,{value:null,items:[]})},insert(se){let{index:ce,displayValue:fe,exportValue:W}=se.detail.insert,de=R.children[ce],be=document.createElement("option");be.textContent=fe,be.value=W,de?de.before(be):R.append(be),p.setValue(T,{value:ee(se,!0),items:ge(se)})},items(se){let{items:ce}=se.detail;for(;R.length!==0;)R.remove(0);for(let fe of ce){let{displayValue:W,exportValue:de}=fe,be=document.createElement("option");be.textContent=W,be.value=de,R.append(be)}R.options.length>0&&(R.options[0].selected=!0),p.setValue(T,{value:ee(se,!0),items:ge(se)})},indices(se){let ce=new Set(se.detail.indices);for(let fe of se.target.options)fe.selected=ce.has(fe.index);p.setValue(T,{value:ee(se,!0)})},editable(se){se.target.disabled=!se.detail.editable}};this._dispatchEventFromSandbox(oe,te)}),R.addEventListener("input",te=>{let oe=ee(te,!0),se=ee(te,!1);p.setValue(T,{value:oe}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:T,name:"Keystroke",value:se,changeEx:oe,willCommit:!0,commitKey:1,keyDown:!1}})}),this._setEventListeners(R,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"]],te=>te.target.checked)):R.addEventListener("input",function(te){p.setValue(T,{value:ee(te,!0)})}),this.data.combo&&this._setTextStyle(R),this._setBackgroundColor(R),this._setDefaultPropertiesFromJS(R),this.container.append(R),this.container}}class u extends F{constructor(p){let T=!!(p.data.titleObj?.str||p.data.contentsObj?.str||p.data.richText?.str);super(p,{isRenderable:T})}render(){let p=["Line","Square","Circle","PolyLine","Polygon","Ink"];if(this.container.className="popupAnnotation",p.includes(this.data.parentType))return this.container;let T=`[data-annotation-id="${this.data.parentId}"]`,D=this.layer.querySelectorAll(T);if(D.length===0)return this.container;let R=new f({container:this.container,trigger:Array.from(D),color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText}),O=this.page,X=n.Util.normalizeRect([this.data.parentRect[0],O.view[3]-this.data.parentRect[1]+O.view[1],this.data.parentRect[2],O.view[3]-this.data.parentRect[3]+O.view[1]]),ee=X[0]+this.data.parentRect[2]-this.data.parentRect[0],ge=X[1],[te,oe,se,ce]=this.viewport.viewBox,fe=se-te,W=ce-oe;return this.container.style.left=`${100*(ee-te)/fe}%`,this.container.style.top=`${100*(ge-oe)/W}%`,this.container.append(R.render()),this.container}}class f{constructor(p){this.container=p.container,this.trigger=p.trigger,this.color=p.color,this.titleObj=p.titleObj,this.modificationDate=p.modificationDate,this.contentsObj=p.contentsObj,this.richText=p.richText,this.hideWrapper=p.hideWrapper||!1,this.pinned=!1}render(){let T=document.createElement("div");T.className="popupWrapper",this.hideElement=this.hideWrapper?T:this.container,this.hideElement.hidden=!0;let D=document.createElement("div");D.className="popup";let R=this.color;if(R){let ee=.7*(255-R[0])+R[0],ge=.7*(255-R[1])+R[1],te=.7*(255-R[2])+R[2];D.style.backgroundColor=n.Util.makeHexColor(ee|0,ge|0,te|0)}let O=document.createElement("h1");O.dir=this.titleObj.dir,O.textContent=this.titleObj.str,D.append(O);let X=r.PDFDateString.toDateObject(this.modificationDate);if(X){let ee=document.createElement("span");ee.className="popupDate",ee.textContent="{{date}}, {{time}}",ee.dataset.l10nId="annotation_date_string",ee.dataset.l10nArgs=JSON.stringify({date:X.toLocaleDateString(),time:X.toLocaleTimeString()}),D.append(ee)}if(this.richText?.str&&(!this.contentsObj?.str||this.contentsObj.str===this.richText.str))S.XfaLayer.render({xfaHtml:this.richText.html,intent:"richText",div:D}),D.lastChild.className="richText popupContent";else{let ee=this._formatContents(this.contentsObj);D.append(ee)}Array.isArray(this.trigger)||(this.trigger=[this.trigger]);for(let ee of this.trigger)ee.addEventListener("click",this._toggle.bind(this)),ee.addEventListener("mouseover",this._show.bind(this,!1)),ee.addEventListener("mouseout",this._hide.bind(this,!1));return D.addEventListener("click",this._hide.bind(this,!0)),T.append(D),T}_formatContents({str:p,dir:T}){let D=document.createElement("p");D.className="popupContent",D.dir=T;let R=p.split(/(?:\r\n?|\n)/);for(let O=0,X=R.length;O<X;++O){let ee=R[O];D.append(document.createTextNode(ee)),O<X-1&&D.append(document.createElement("br"))}return D}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(p=!1){p&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex=parseInt(this.container.style.zIndex)+1e3)}_hide(p=!0){p&&(this.pinned=!1),!this.hideElement.hidden&&!this.pinned&&(this.hideElement.hidden=!0,this.container.style.zIndex=parseInt(this.container.style.zIndex)-1e3)}}class M extends F{constructor(p){let T=!!(p.data.hasPopup||p.data.titleObj?.str||p.data.contentsObj?.str||p.data.richText?.str);super(p,{isRenderable:T,ignoreBorder:!0}),this.textContent=p.data.textContent}render(){if(this.container.className="freeTextAnnotation",this.textContent){let p=document.createElement("div");p.className="annotationTextContent",p.setAttribute("role","comment");for(let T of this.textContent){let D=document.createElement("span");D.textContent=T,p.append(D)}this.container.append(p)}return this.data.hasPopup||this._createPopup(null,this.data),this.container}}class E extends F{constructor(p){let T=!!(p.data.hasPopup||p.data.titleObj?.str||p.data.contentsObj?.str||p.data.richText?.str);super(p,{isRenderable:T,ignoreBorder:!0})}render(){this.container.className="lineAnnotation";let p=this.data,{width:T,height:D}=C(p.rect),R=this.svgFactory.create(T,D,!0),O=this.svgFactory.createElement("svg:line");return O.setAttribute("x1",p.rect[2]-p.lineCoordinates[0]),O.setAttribute("y1",p.rect[3]-p.lineCoordinates[1]),O.setAttribute("x2",p.rect[2]-p.lineCoordinates[2]),O.setAttribute("y2",p.rect[3]-p.lineCoordinates[3]),O.setAttribute("stroke-width",p.borderStyle.width||1),O.setAttribute("stroke","transparent"),O.setAttribute("fill","transparent"),R.append(O),this.container.append(R),this._createPopup(O,p),this.container}}class w extends F{constructor(p){let T=!!(p.data.hasPopup||p.data.titleObj?.str||p.data.contentsObj?.str||p.data.richText?.str);super(p,{isRenderable:T,ignoreBorder:!0})}render(){this.container.className="squareAnnotation";let p=this.data,{width:T,height:D}=C(p.rect),R=this.svgFactory.create(T,D,!0),O=p.borderStyle.width,X=this.svgFactory.createElement("svg:rect");return X.setAttribute("x",O/2),X.setAttribute("y",O/2),X.setAttribute("width",T-O),X.setAttribute("height",D-O),X.setAttribute("stroke-width",O||1),X.setAttribute("stroke","transparent"),X.setAttribute("fill","transparent"),R.append(X),this.container.append(R),this._createPopup(X,p),this.container}}class P extends F{constructor(p){let T=!!(p.data.hasPopup||p.data.titleObj?.str||p.data.contentsObj?.str||p.data.richText?.str);super(p,{isRenderable:T,ignoreBorder:!0})}render(){this.container.className="circleAnnotation";let p=this.data,{width:T,height:D}=C(p.rect),R=this.svgFactory.create(T,D,!0),O=p.borderStyle.width,X=this.svgFactory.createElement("svg:ellipse");return X.setAttribute("cx",T/2),X.setAttribute("cy",D/2),X.setAttribute("rx",T/2-O/2),X.setAttribute("ry",D/2-O/2),X.setAttribute("stroke-width",O||1),X.setAttribute("stroke","transparent"),X.setAttribute("fill","transparent"),R.append(X),this.container.append(R),this._createPopup(X,p),this.container}}class ne extends F{constructor(p){let T=!!(p.data.hasPopup||p.data.titleObj?.str||p.data.contentsObj?.str||p.data.richText?.str);super(p,{isRenderable:T,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;let p=this.data,{width:T,height:D}=C(p.rect),R=this.svgFactory.create(T,D,!0),O=[];for(let ee of p.vertices){let ge=ee.x-p.rect[0],te=p.rect[3]-ee.y;O.push(ge+","+te)}O=O.join(" ");let X=this.svgFactory.createElement(this.svgElementName);return X.setAttribute("points",O),X.setAttribute("stroke-width",p.borderStyle.width||1),X.setAttribute("stroke","transparent"),X.setAttribute("fill","transparent"),R.append(X),this.container.append(R),this._createPopup(X,p),this.container}}class ie extends ne{constructor(p){super(p),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Z extends F{constructor(p){let T=!!(p.data.hasPopup||p.data.titleObj?.str||p.data.contentsObj?.str||p.data.richText?.str);super(p,{isRenderable:T,ignoreBorder:!0})}render(){return this.container.className="caretAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class Y extends F{constructor(p){let T=!!(p.data.hasPopup||p.data.titleObj?.str||p.data.contentsObj?.str||p.data.richText?.str);super(p,{isRenderable:T,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;let p=this.data,{width:T,height:D}=C(p.rect),R=this.svgFactory.create(T,D,!0);for(let O of p.inkLists){let X=[];for(let ge of O){let te=ge.x-p.rect[0],oe=p.rect[3]-ge.y;X.push(`${te},${oe}`)}X=X.join(" ");let ee=this.svgFactory.createElement(this.svgElementName);ee.setAttribute("points",X),ee.setAttribute("stroke-width",p.borderStyle.width||1),ee.setAttribute("stroke","transparent"),ee.setAttribute("fill","transparent"),this._createPopup(ee,p),R.append(ee)}return this.container.append(R),this.container}}class j extends F{constructor(p){let T=!!(p.data.hasPopup||p.data.titleObj?.str||p.data.contentsObj?.str||p.data.richText?.str);super(p,{isRenderable:T,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.className="highlightAnnotation",this.container)}}class U extends F{constructor(p){let T=!!(p.data.hasPopup||p.data.titleObj?.str||p.data.contentsObj?.str||p.data.richText?.str);super(p,{isRenderable:T,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.className="underlineAnnotation",this.container)}}class q extends F{constructor(p){let T=!!(p.data.hasPopup||p.data.titleObj?.str||p.data.contentsObj?.str||p.data.richText?.str);super(p,{isRenderable:T,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.className="squigglyAnnotation",this.container)}}class re extends F{constructor(p){let T=!!(p.data.hasPopup||p.data.titleObj?.str||p.data.contentsObj?.str||p.data.richText?.str);super(p,{isRenderable:T,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.className="strikeoutAnnotation",this.container)}}class pe extends F{constructor(p){let T=!!(p.data.hasPopup||p.data.titleObj?.str||p.data.contentsObj?.str||p.data.richText?.str);super(p,{isRenderable:T,ignoreBorder:!0})}render(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class we extends F{constructor(p){super(p,{isRenderable:!0});let{filename:T,content:D}=this.data.file;this.filename=(0,r.getFilenameFromUrl)(T),this.content=D,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:T,content:D})}render(){this.container.className="fileAttachmentAnnotation";let p=document.createElement("div");return p.className="popupTriggerArea",p.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&(this.data.titleObj?.str||this.data.contentsObj?.str||this.data.richText)&&this._createPopup(p,this.data),this.container.append(p),this.container}_download(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)}}let K=class{static render(p){var ee,ge;let{annotations:T,div:D,viewport:R,accessibilityManager:O}=p;ue(this,L,Jr).call(this,D,R);let X=0;for(let te of T){if(te.annotationType!==n.AnnotationType.POPUP){let{width:se,height:ce}=C(te.rect);if(se<=0||ce<=0)continue}let oe=_.create({data:te,layer:D,page:p.page,viewport:R,linkService:p.linkService,downloadManager:p.downloadManager,imageResourcesPath:p.imageResourcesPath||"",renderForms:p.renderForms!==!1,svgFactory:new r.DOMSVGFactory,annotationStorage:p.annotationStorage||new a.AnnotationStorage,enableScripting:p.enableScripting,hasJSActions:p.hasJSActions,fieldObjects:p.fieldObjects,mouseState:p.mouseState||{isDown:!1}});if(oe.isRenderable){let se=oe.render();if(te.hidden&&(se.style.visibility="hidden"),Array.isArray(se))for(let ce of se)ce.style.zIndex=X++,ue(ee=K,x,Kr).call(ee,ce,te.id,D,O);else se.style.zIndex=X++,oe instanceof u?D.prepend(se):ue(ge=K,x,Kr).call(ge,se,te.id,D,O)}}ue(this,V,$r).call(this,D,p.annotationCanvasMap)}static update(p){let{annotationCanvasMap:T,div:D,viewport:R}=p;ue(this,L,Jr).call(this,D,R),ue(this,V,$r).call(this,D,T),D.hidden=!1}},H=K;x=new WeakSet,Kr=function(p,T,D,R){let O=p.firstChild||p;O.id=`${r.AnnotationPrefix}${T}`,D.append(p),R?.moveElementInDOM(D,p,O,!1)},L=new WeakSet,Jr=function(p,{width:T,height:D,rotation:R}){let{style:O}=p,X=R%180!==0,ee=Math.floor(T)+"px",ge=Math.floor(D)+"px";O.width=X?ge:ee,O.height=X?ee:ge,p.setAttribute("data-main-rotation",R)},V=new WeakSet,$r=function(p,T){if(T){for(let[D,R]of T){let O=p.querySelector(`[data-annotation-id="${D}"]`);if(!O)continue;let{firstChild:X}=O;X?X.nodeName==="CANVAS"?X.replaceWith(R):X.before(R):O.append(R)}T.clear()}},le(H,x),le(H,L),le(H,V),t.AnnotationLayer=H},(o,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorConverters=void 0;function e(r){return Math.floor(Math.max(0,Math.min(1,r))*255).toString(16).padStart(2,"0")}class n{static CMYK_G([a,d,S,b]){return["G",1-Math.min(1,.3*a+.59*S+.11*d+b)]}static G_CMYK([a]){return["CMYK",0,0,0,1-a]}static G_RGB([a]){return["RGB",a,a,a]}static G_HTML([a]){let d=e(a);return`#${d}${d}${d}`}static RGB_G([a,d,S]){return["G",.3*a+.59*d+.11*S]}static RGB_HTML([a,d,S]){let b=e(a),m=e(d),A=e(S);return`#${b}${m}${A}`}static T_HTML(){return"#00000000"}static CMYK_RGB([a,d,S,b]){return["RGB",1-Math.min(1,a+b),1-Math.min(1,S+b),1-Math.min(1,d+b)]}static CMYK_HTML(a){let d=this.CMYK_RGB(a).slice(1);return this.RGB_HTML(d)}static RGB_CMYK([a,d,S]){let b=1-a,m=1-d,A=1-S,C=Math.min(b,m,A);return["CMYK",b,m,A,C]}}t.ColorConverters=n},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaLayer=void 0;var n=e(20);class r{static setupStorage(d,S,b,m,A){let C=m.getValue(S,{value:null});switch(b.name){case"textarea":if(C.value!==null&&(d.textContent=C.value),A==="print")break;d.addEventListener("input",_=>{m.setValue(S,{value:_.target.value})});break;case"input":if(b.attributes.type==="radio"||b.attributes.type==="checkbox"){if(C.value===b.attributes.xfaOn?d.setAttribute("checked",!0):C.value===b.attributes.xfaOff&&d.removeAttribute("checked"),A==="print")break;d.addEventListener("change",_=>{m.setValue(S,{value:_.target.checked?_.target.getAttribute("xfaOn"):_.target.getAttribute("xfaOff")})})}else{if(C.value!==null&&d.setAttribute("value",C.value),A==="print")break;d.addEventListener("input",_=>{m.setValue(S,{value:_.target.value})})}break;case"select":if(C.value!==null)for(let _ of b.children)_.attributes.value===C.value&&(_.attributes.selected=!0);d.addEventListener("input",_=>{let F=_.target.options,i=F.selectedIndex===-1?"":F[F.selectedIndex].value;m.setValue(S,{value:i})});break}}static setAttributes({html:d,element:S,storage:b=null,intent:m,linkService:A}){let{attributes:C}=S,_=d instanceof HTMLAnchorElement;C.type==="radio"&&(C.name=`${C.name}-${m}`);for(let[F,i]of Object.entries(C))if(i!=null)switch(F){case"class":i.length&&d.setAttribute(F,i.join(" "));break;case"dataId":break;case"id":d.setAttribute("data-element-id",i);break;case"style":Object.assign(d.style,i);break;case"textContent":d.textContent=i;break;default:(!_||F!=="href"&&F!=="newWindow")&&d.setAttribute(F,i)}_&&A.addLinkAttributes(d,C.href,C.newWindow),b&&C.dataId&&this.setupStorage(d,C.dataId,S,b)}static render(d){let S=d.annotationStorage,b=d.linkService,m=d.xfaHtml,A=d.intent||"display",C=document.createElement(m.name);m.attributes&&this.setAttributes({html:C,element:m,intent:A,linkService:b});let _=[[m,-1,C]],F=d.div;if(F.append(C),d.viewport){let l=`matrix(${d.viewport.transform.join(",")})`;F.style.transform=l}A!=="richText"&&F.setAttribute("class","xfaLayer xfaFont");let i=[];for(;_.length>0;){let[l,s,v]=_.at(-1);if(s+1===l.children.length){_.pop();continue}let k=l.children[++_.at(-1)[1]];if(k===null)continue;let{name:y}=k;if(y==="#text"){let c=document.createTextNode(k.value);i.push(c),v.append(c);continue}let h;if(k?.attributes?.xmlns?h=document.createElementNS(k.attributes.xmlns,y):h=document.createElement(y),v.append(h),k.attributes&&this.setAttributes({html:h,element:k,storage:S,intent:A,linkService:b}),k.children&&k.children.length>0)_.push([k,-1,h]);else if(k.value){let c=document.createTextNode(k.value);n.XfaText.shouldBuildText(y)&&i.push(c),h.append(c)}}for(let l of F.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))l.setAttribute("readOnly",!0);return{textDivs:i}}static update(d){let S=`matrix(${d.viewport.transform.join(",")})`;d.div.style.transform=S,d.div.hidden=!1}}t.XfaLayer=r},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextLayerRenderTask=void 0,t.renderTextLayer=k;var n=e(1),r=e(8);let a=1e5,d=30,S=.8,b=new Map,m=/^\s+$/g;function A(y,h){let c=b.get(y);if(c)return c;h.save(),h.font=`${d}px ${y}`;let u=h.measureText(""),f=u.fontBoundingBoxAscent,M=Math.abs(u.fontBoundingBoxDescent);if(f){h.restore();let w=f/(f+M);return b.set(y,w),w}h.strokeStyle="red",h.clearRect(0,0,d,d),h.strokeText("g",0,0);let E=h.getImageData(0,0,d,d).data;M=0;for(let w=E.length-1-3;w>=0;w-=4)if(E[w]>0){M=Math.ceil(w/4/d);break}h.clearRect(0,0,d,d),h.strokeText("A",0,d),E=h.getImageData(0,0,d,d).data,f=0;for(let w=0,P=E.length;w<P;w+=4)if(E[w]>0){f=d-Math.floor(w/4/d);break}if(h.restore(),f){let w=f/(f+M);return b.set(y,w),w}return b.set(y,S),S}function C(y,h,c,u){let f=document.createElement("span"),M=y._enhanceTextSelection?{angle:0,canvasWidth:0,hasText:h.str!=="",hasEOL:h.hasEOL,originalTransform:null,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,scale:1,fontSize:0}:{angle:0,canvasWidth:0,hasText:h.str!=="",hasEOL:h.hasEOL,fontSize:0};y._textDivs.push(f);let E=n.Util.transform(y._viewport.transform,h.transform),w=Math.atan2(E[1],E[0]),P=c[h.fontName];P.vertical&&(w+=Math.PI/2);let ne=Math.hypot(E[2],E[3]),ie=ne*A(P.fontFamily,u),Z,Y;w===0?(Z=E[4],Y=E[5]-ie):(Z=E[4]+ie*Math.sin(w),Y=E[5]-ie*Math.cos(w)),f.style.left=`${Z}px`,f.style.top=`${Y}px`,f.style.fontSize=`${ne}px`,f.style.fontFamily=P.fontFamily,M.fontSize=ne,f.setAttribute("role","presentation"),f.textContent=h.str,f.dir=h.dir,y._fontInspectorEnabled&&(f.dataset.fontName=h.fontName),w!==0&&(M.angle=w*(180/Math.PI));let j=!1;if(h.str.length>1||y._enhanceTextSelection&&m.test(h.str))j=!0;else if(h.str!==" "&&h.transform[0]!==h.transform[3]){let U=Math.abs(h.transform[0]),q=Math.abs(h.transform[3]);U!==q&&Math.max(U,q)/Math.min(U,q)>1.5&&(j=!0)}if(j&&(P.vertical?M.canvasWidth=h.height*y._viewport.scale:M.canvasWidth=h.width*y._viewport.scale),y._textDivProperties.set(f,M),y._textContentStream&&y._layoutText(f),y._enhanceTextSelection&&M.hasText){let U=1,q=0;w!==0&&(U=Math.cos(w),q=Math.sin(w));let re=(P.vertical?h.height:h.width)*y._viewport.scale,pe=ne,we,H;w!==0?(we=[U,q,-q,U,Z,Y],H=n.Util.getAxialAlignedBoundingBox([0,0,re,pe],we)):H=[Z,Y,Z+re,Y+pe],y._bounds.push({left:H[0],top:H[1],right:H[2],bottom:H[3],div:f,size:[re,pe],m:we})}}function _(y){if(y._canceled)return;let h=y._textDivs,c=y._capability,u=h.length;if(u>a){y._renderingDone=!0,c.resolve();return}if(!y._textContentStream)for(let f=0;f<u;f++)y._layoutText(h[f]);y._renderingDone=!0,c.resolve()}function F(y,h,c){let u=0;for(let f=0;f<c;f++){let M=y[h++];M>0&&(u=u?Math.min(M,u):M)}return u}function i(y){let h=y._bounds,c=y._viewport,u=l(c.width,c.height,h);for(let f=0;f<u.length;f++){let M=h[f].div,E=y._textDivProperties.get(M);if(E.angle===0){E.paddingLeft=h[f].left-u[f].left,E.paddingTop=h[f].top-u[f].top,E.paddingRight=u[f].right-h[f].right,E.paddingBottom=u[f].bottom-h[f].bottom,y._textDivProperties.set(M,E);continue}let w=u[f],P=h[f],ne=P.m,ie=ne[0],Z=ne[1],Y=[[0,0],[0,P.size[1]],[P.size[0],0],P.size],j=new Float64Array(64);for(let q=0,re=Y.length;q<re;q++){let pe=n.Util.applyTransform(Y[q],ne);j[q+0]=ie&&(w.left-pe[0])/ie,j[q+4]=Z&&(w.top-pe[1])/Z,j[q+8]=ie&&(w.right-pe[0])/ie,j[q+12]=Z&&(w.bottom-pe[1])/Z,j[q+16]=Z&&(w.left-pe[0])/-Z,j[q+20]=ie&&(w.top-pe[1])/ie,j[q+24]=Z&&(w.right-pe[0])/-Z,j[q+28]=ie&&(w.bottom-pe[1])/ie,j[q+32]=ie&&(w.left-pe[0])/-ie,j[q+36]=Z&&(w.top-pe[1])/-Z,j[q+40]=ie&&(w.right-pe[0])/-ie,j[q+44]=Z&&(w.bottom-pe[1])/-Z,j[q+48]=Z&&(w.left-pe[0])/Z,j[q+52]=ie&&(w.top-pe[1])/-ie,j[q+56]=Z&&(w.right-pe[0])/Z,j[q+60]=ie&&(w.bottom-pe[1])/-ie}let U=1+Math.min(Math.abs(ie),Math.abs(Z));E.paddingLeft=F(j,32,16)/U,E.paddingTop=F(j,48,16)/U,E.paddingRight=F(j,0,16)/U,E.paddingBottom=F(j,16,16)/U,y._textDivProperties.set(M,E)}}function l(y,h,c){let u=c.map(function(M,E){return{x1:M.left,y1:M.top,x2:M.right,y2:M.bottom,index:E,x1New:void 0,x2New:void 0}});s(y,u);let f=new Array(c.length);for(let M of u){let E=M.index;f[E]={left:M.x1New,top:0,right:M.x2New,bottom:0}}c.map(function(M,E){let w=f[E],P=u[E];P.x1=M.top,P.y1=y-w.right,P.x2=M.bottom,P.y2=y-w.left,P.index=E,P.x1New=void 0,P.x2New=void 0}),s(h,u);for(let M of u){let E=M.index;f[E].top=M.x1New,f[E].bottom=M.x2New}return f}function s(y,h){h.sort(function(f,M){return f.x1-M.x1||f.index-M.index});let u=[{start:-1/0,end:1/0,boundary:{x1:-1/0,y1:-1/0,x2:0,y2:1/0,index:-1,x1New:0,x2New:0}}];for(let f of h){let M=0;for(;M<u.length&&u[M].end<=f.y1;)M++;let E=u.length-1;for(;E>=0&&u[E].start>=f.y2;)E--;let w,P,ne,ie,Z=-1/0;for(ne=M;ne<=E;ne++){w=u[ne],P=w.boundary;let U;P.x2>f.x1?U=P.index>f.index?P.x1New:f.x1:P.x2New===void 0?U=(P.x2+f.x1)/2:U=P.x2New,U>Z&&(Z=U)}for(f.x1New=Z,ne=M;ne<=E;ne++)w=u[ne],P=w.boundary,P.x2New===void 0?P.x2>f.x1?P.index>f.index&&(P.x2New=P.x2):P.x2New=Z:P.x2New>Z&&(P.x2New=Math.max(Z,P.x2));let Y=[],j=null;for(ne=M;ne<=E;ne++){w=u[ne],P=w.boundary;let U=P.x2>f.x2?P:f;j===U?Y.at(-1).end=w.end:(Y.push({start:w.start,end:w.end,boundary:U}),j=U)}for(u[M].start<f.y1&&(Y[0].start=f.y1,Y.unshift({start:u[M].start,end:f.y1,boundary:u[M].boundary})),f.y2<u[E].end&&(Y.at(-1).end=f.y2,Y.push({start:f.y2,end:u[E].end,boundary:u[E].boundary})),ne=M;ne<=E;ne++){if(w=u[ne],P=w.boundary,P.x2New!==void 0)continue;let U=!1;for(ie=M-1;!U&&ie>=0&&u[ie].start>=P.y1;ie--)U=u[ie].boundary===P;for(ie=E+1;!U&&ie<u.length&&u[ie].end<=P.y2;ie++)U=u[ie].boundary===P;for(ie=0;!U&&ie<Y.length;ie++)U=Y[ie].boundary===P;U||(P.x2New=Z)}Array.prototype.splice.apply(u,[M,E-M+1,...Y])}for(let f of u){let M=f.boundary;M.x2New===void 0&&(M.x2New=Math.max(y,M.x2))}}class v{constructor({textContent:h,textContentStream:c,container:u,viewport:f,textDivs:M,textContentItemsStr:E,enhanceTextSelection:w}){w&&(0,r.deprecated)("The `enhanceTextSelection` functionality will be removed in the future."),this._textContent=h,this._textContentStream=c,this._container=u,this._document=u.ownerDocument,this._viewport=f,this._textDivs=M||[],this._textContentItemsStr=E||[],this._enhanceTextSelection=!!w,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._layoutTextLastFontSize=null,this._layoutTextLastFontFamily=null,this._layoutTextCtx=null,this._textDivProperties=new WeakMap,this._renderingDone=!1,this._canceled=!1,this._capability=(0,n.createPromiseCapability)(),this._renderTimer=null,this._bounds=[],this._devicePixelRatio=globalThis.devicePixelRatio||1,this._capability.promise.finally(()=>{this._enhanceTextSelection||(this._textDivProperties=null),this._layoutTextCtx&&(this._layoutTextCtx.canvas.width=0,this._layoutTextCtx.canvas.height=0,this._layoutTextCtx=null)}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new n.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._renderTimer!==null&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._capability.reject(new Error("TextLayer task cancelled."))}_processItems(h,c){for(let u=0,f=h.length;u<f;u++){if(h[u].str===void 0){if(h[u].type==="beginMarkedContentProps"||h[u].type==="beginMarkedContent"){let M=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),h[u].id!==null&&this._container.setAttribute("id",`${h[u].id}`),M.append(this._container)}else h[u].type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(h[u].str),C(this,h[u],c,this._layoutTextCtx)}}_layoutText(h){let c=this._textDivProperties.get(h),u="";if(c.canvasWidth!==0&&c.hasText){let{fontFamily:f}=h.style,{fontSize:M}=c;(M!==this._layoutTextLastFontSize||f!==this._layoutTextLastFontFamily)&&(this._layoutTextCtx.font=`${M*this._devicePixelRatio}px ${f}`,this._layoutTextLastFontSize=M,this._layoutTextLastFontFamily=f);let{width:E}=this._layoutTextCtx.measureText(h.textContent);if(E>0){let w=this._devicePixelRatio*c.canvasWidth/E;this._enhanceTextSelection&&(c.scale=w),u=`scaleX(${w})`}}if(c.angle!==0&&(u=`rotate(${c.angle}deg) ${u}`),u.length>0&&(this._enhanceTextSelection&&(c.originalTransform=u),h.style.transform=u),c.hasText&&this._container.append(h),c.hasEOL){let f=document.createElement("br");f.setAttribute("role","presentation"),this._container.append(f)}}_render(h=0){let c=(0,n.createPromiseCapability)(),u=Object.create(null),f=this._document.createElement("canvas");if(f.height=f.width=d,this._layoutTextCtx=f.getContext("2d",{alpha:!1}),this._textContent){let M=this._textContent.items,E=this._textContent.styles;this._processItems(M,E),c.resolve()}else if(this._textContentStream){let M=()=>{this._reader.read().then(({value:E,done:w})=>{if(w){c.resolve();return}Object.assign(u,E.styles),this._processItems(E.items,u),M()},c.reject)};this._reader=this._textContentStream.getReader(),M()}else throw new Error('Neither "textContent" nor "textContentStream" parameters specified.');c.promise.then(()=>{u=null,h?this._renderTimer=setTimeout(()=>{_(this),this._renderTimer=null},h):_(this)},this._capability.reject)}expandTextDivs(h=!1){if(!this._enhanceTextSelection||!this._renderingDone)return;this._bounds!==null&&(i(this),this._bounds=null);let c=[],u=[];for(let f=0,M=this._textDivs.length;f<M;f++){let E=this._textDivs[f],w=this._textDivProperties.get(E);w.hasText&&(h?(c.length=0,u.length=0,w.originalTransform&&c.push(w.originalTransform),w.paddingTop>0?(u.push(`${w.paddingTop}px`),c.push(`translateY(${-w.paddingTop}px)`)):u.push(0),w.paddingRight>0?u.push(`${w.paddingRight/w.scale}px`):u.push(0),w.paddingBottom>0?u.push(`${w.paddingBottom}px`):u.push(0),w.paddingLeft>0?(u.push(`${w.paddingLeft/w.scale}px`),c.push(`translateX(${-w.paddingLeft/w.scale}px)`)):u.push(0),E.style.padding=u.join(" "),c.length&&(E.style.transform=c.join(" "))):(E.style.padding=null,E.style.transform=w.originalTransform))}}}t.TextLayerRenderTask=v;function k(y){let h=new v({textContent:y.textContent,textContentStream:y.textContentStream,container:y.container,viewport:y.viewport,textDivs:y.textDivs,textContentItemsStr:y.textContentItemsStr,enhanceTextSelection:y.enhanceTextSelection});return h._render(y.timeout),h}},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SVGGraphics=void 0;var n=e(8),r=e(1),a=e(3);let d=class{constructor(){(0,r.unreachable)("Not implemented: SVGGraphics")}};t.SVGGraphics=d;{let l=function(c){let u=[],f=[];for(let M of c){if(M.fn==="save"){u.push({fnId:92,fn:"group",items:[]}),f.push(u),u=u.at(-1).items;continue}M.fn==="restore"?u=f.pop():u.push(M)}return u},s=function(c){if(Number.isInteger(c))return c.toString();let u=c.toFixed(10),f=u.length-1;if(u[f]!=="0")return u;do f--;while(u[f]==="0");return u.substring(0,u[f]==="."?f:f+1)},v=function(c){if(c[4]===0&&c[5]===0){if(c[1]===0&&c[2]===0)return c[0]===1&&c[3]===1?"":`scale(${s(c[0])} ${s(c[3])})`;if(c[0]===c[3]&&c[1]===-c[2]){let u=Math.acos(c[0])*180/Math.PI;return`rotate(${s(u)})`}}else if(c[0]===1&&c[1]===0&&c[2]===0&&c[3]===1)return`translate(${s(c[4])} ${s(c[5])})`;return`matrix(${s(c[0])} ${s(c[1])} ${s(c[2])} ${s(c[3])} ${s(c[4])} ${s(c[5])})`},S={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},b="http://www.w3.org/XML/1998/namespace",m="http://www.w3.org/1999/xlink",A=["butt","round","square"],C=["miter","round","bevel"],_=function(c,u="",f=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!f)return URL.createObjectURL(new Blob([c],{type:u}));let M="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",E=`data:${u};base64,`;for(let w=0,P=c.length;w<P;w+=3){let ne=c[w]&255,ie=c[w+1]&255,Z=c[w+2]&255,Y=ne>>2,j=(ne&3)<<4|ie>>4,U=w+1<P?(ie&15)<<2|Z>>6:64,q=w+2<P?Z&63:64;E+=M[Y]+M[j]+M[U]+M[q]}return E},F=function(){let c=new Uint8Array([137,80,78,71,13,10,26,10]),u=12,f=new Int32Array(256);for(let Z=0;Z<256;Z++){let Y=Z;for(let j=0;j<8;j++)Y&1?Y=3988292384^Y>>1&2147483647:Y=Y>>1&2147483647;f[Z]=Y}function M(Z,Y,j){let U=-1;for(let q=Y;q<j;q++){let re=(U^Z[q])&255,pe=f[re];U=U>>>8^pe}return U^-1}function E(Z,Y,j,U){let q=U,re=Y.length;j[q]=re>>24&255,j[q+1]=re>>16&255,j[q+2]=re>>8&255,j[q+3]=re&255,q+=4,j[q]=Z.charCodeAt(0)&255,j[q+1]=Z.charCodeAt(1)&255,j[q+2]=Z.charCodeAt(2)&255,j[q+3]=Z.charCodeAt(3)&255,q+=4,j.set(Y,q),q+=Y.length;let pe=M(j,U+4,q);j[q]=pe>>24&255,j[q+1]=pe>>16&255,j[q+2]=pe>>8&255,j[q+3]=pe&255}function w(Z,Y,j){let U=1,q=0;for(let re=Y;re<j;++re)U=(U+(Z[re]&255))%65521,q=(q+U)%65521;return q<<16|U}function P(Z){if(!a.isNodeJS)return ne(Z);try{let Y;parseInt(process.versions.node)>=8?Y=Z:Y=Buffer.from(Z);let j=Cs().deflateSync(Y,{level:9});return j instanceof Uint8Array?j:new Uint8Array(j)}catch(Y){(0,r.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+Y)}return ne(Z)}function ne(Z){let Y=Z.length,j=65535,U=Math.ceil(Y/j),q=new Uint8Array(2+Y+U*5+4),re=0;q[re++]=120,q[re++]=156;let pe=0;for(;Y>j;)q[re++]=0,q[re++]=255,q[re++]=255,q[re++]=0,q[re++]=0,q.set(Z.subarray(pe,pe+j),re),re+=j,pe+=j,Y-=j;q[re++]=1,q[re++]=Y&255,q[re++]=Y>>8&255,q[re++]=~Y&65535&255,q[re++]=(~Y&65535)>>8&255,q.set(Z.subarray(pe),re),re+=Z.length-pe;let we=w(Z,0,Z.length);return q[re++]=we>>24&255,q[re++]=we>>16&255,q[re++]=we>>8&255,q[re++]=we&255,q}function ie(Z,Y,j,U){let q=Z.width,re=Z.height,pe,we,H,x=Z.data;switch(Y){case r.ImageKind.GRAYSCALE_1BPP:we=0,pe=1,H=q+7>>3;break;case r.ImageKind.RGB_24BPP:we=2,pe=8,H=q*3;break;case r.ImageKind.RGBA_32BPP:we=6,pe=8,H=q*4;break;default:throw new Error("invalid format")}let g=new Uint8Array((1+H)*re),L=0,I=0;for(let T=0;T<re;++T)g[L++]=0,g.set(x.subarray(I,I+H),L),I+=H,L+=H;if(Y===r.ImageKind.GRAYSCALE_1BPP&&U){L=0;for(let T=0;T<re;T++){L++;for(let D=0;D<H;D++)g[L++]^=255}}let V=new Uint8Array([q>>24&255,q>>16&255,q>>8&255,q&255,re>>24&255,re>>16&255,re>>8&255,re&255,pe,we,0,0,0]),N=P(g),K=c.length+u*3+V.length+N.length,J=new Uint8Array(K),p=0;return J.set(c,p),p+=c.length,E("IHDR",V,J,p),p+=u+V.length,E("IDATA",N,J,p),p+=u+N.length,E("IEND",new Uint8Array(0),J,p),_(J,"image/png",j)}return function(Y,j,U){let q=Y.kind===void 0?r.ImageKind.GRAYSCALE_1BPP:Y.kind;return ie(Y,q,j,U)}}();class i{constructor(){this.fontSizeScale=1,this.fontWeight=S.fontWeight,this.fontSize=0,this.textMatrix=r.IDENTITY_MATRIX,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=r.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=S.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(u,f){this.x=u,this.y=f}}let k=0,y=0,h=0;t.SVGGraphics=d=class{constructor(c,u,f=!1){(0,n.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new n.DOMSVGFactory,this.current=new i,this.transformMatrix=r.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=c,this.objs=u,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!f,this._operatorIdMapping=[];for(let M in r.OPS)this._operatorIdMapping[r.OPS[M]]=M}save(){this.transformStack.push(this.transformMatrix);let c=this.current;this.extraStack.push(c),this.current=c.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(c){this.save(),this.executeOpTree(c),this.restore()}loadDependencies(c){let u=c.fnArray,f=c.argsArray;for(let M=0,E=u.length;M<E;M++)if(u[M]===r.OPS.dependency)for(let w of f[M]){let P=w.startsWith("g_")?this.commonObjs:this.objs,ne=new Promise(ie=>{P.get(w,ie)});this.current.dependencies.push(ne)}return Promise.all(this.current.dependencies)}transform(c,u,f,M,E,w){let P=[c,u,f,M,E,w];this.transformMatrix=r.Util.transform(this.transformMatrix,P),this.tgrp=null}getSVG(c,u){this.viewport=u;let f=this._initialize(u);return this.loadDependencies(c).then(()=>(this.transformMatrix=r.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(c)),f))}convertOpList(c){let u=this._operatorIdMapping,f=c.argsArray,M=c.fnArray,E=[];for(let w=0,P=M.length;w<P;w++){let ne=M[w];E.push({fnId:ne,fn:u[ne],args:f[w]})}return l(E)}executeOpTree(c){for(let u of c){let f=u.fn,M=u.fnId,E=u.args;switch(M|0){case r.OPS.beginText:this.beginText();break;case r.OPS.dependency:break;case r.OPS.setLeading:this.setLeading(E);break;case r.OPS.setLeadingMoveText:this.setLeadingMoveText(E[0],E[1]);break;case r.OPS.setFont:this.setFont(E);break;case r.OPS.showText:this.showText(E[0]);break;case r.OPS.showSpacedText:this.showText(E[0]);break;case r.OPS.endText:this.endText();break;case r.OPS.moveText:this.moveText(E[0],E[1]);break;case r.OPS.setCharSpacing:this.setCharSpacing(E[0]);break;case r.OPS.setWordSpacing:this.setWordSpacing(E[0]);break;case r.OPS.setHScale:this.setHScale(E[0]);break;case r.OPS.setTextMatrix:this.setTextMatrix(E[0],E[1],E[2],E[3],E[4],E[5]);break;case r.OPS.setTextRise:this.setTextRise(E[0]);break;case r.OPS.setTextRenderingMode:this.setTextRenderingMode(E[0]);break;case r.OPS.setLineWidth:this.setLineWidth(E[0]);break;case r.OPS.setLineJoin:this.setLineJoin(E[0]);break;case r.OPS.setLineCap:this.setLineCap(E[0]);break;case r.OPS.setMiterLimit:this.setMiterLimit(E[0]);break;case r.OPS.setFillRGBColor:this.setFillRGBColor(E[0],E[1],E[2]);break;case r.OPS.setStrokeRGBColor:this.setStrokeRGBColor(E[0],E[1],E[2]);break;case r.OPS.setStrokeColorN:this.setStrokeColorN(E);break;case r.OPS.setFillColorN:this.setFillColorN(E);break;case r.OPS.shadingFill:this.shadingFill(E[0]);break;case r.OPS.setDash:this.setDash(E[0],E[1]);break;case r.OPS.setRenderingIntent:this.setRenderingIntent(E[0]);break;case r.OPS.setFlatness:this.setFlatness(E[0]);break;case r.OPS.setGState:this.setGState(E[0]);break;case r.OPS.fill:this.fill();break;case r.OPS.eoFill:this.eoFill();break;case r.OPS.stroke:this.stroke();break;case r.OPS.fillStroke:this.fillStroke();break;case r.OPS.eoFillStroke:this.eoFillStroke();break;case r.OPS.clip:this.clip("nonzero");break;case r.OPS.eoClip:this.clip("evenodd");break;case r.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case r.OPS.paintImageXObject:this.paintImageXObject(E[0]);break;case r.OPS.paintInlineImageXObject:this.paintInlineImageXObject(E[0]);break;case r.OPS.paintImageMaskXObject:this.paintImageMaskXObject(E[0]);break;case r.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(E[0],E[1]);break;case r.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case r.OPS.closePath:this.closePath();break;case r.OPS.closeStroke:this.closeStroke();break;case r.OPS.closeFillStroke:this.closeFillStroke();break;case r.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case r.OPS.nextLine:this.nextLine();break;case r.OPS.transform:this.transform(E[0],E[1],E[2],E[3],E[4],E[5]);break;case r.OPS.constructPath:this.constructPath(E[0],E[1]);break;case r.OPS.endPath:this.endPath();break;case 92:this.group(u.items);break;default:(0,r.warn)(`Unimplemented operator ${f}`);break}}}setWordSpacing(c){this.current.wordSpacing=c}setCharSpacing(c){this.current.charSpacing=c}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(c,u,f,M,E,w){let P=this.current;P.textMatrix=P.lineMatrix=[c,u,f,M,E,w],P.textMatrixScale=Math.hypot(c,u),P.x=P.lineX=0,P.y=P.lineY=0,P.xcoords=[],P.ycoords=[],P.tspan=this.svgFactory.createElement("svg:tspan"),P.tspan.setAttributeNS(null,"font-family",P.fontFamily),P.tspan.setAttributeNS(null,"font-size",`${s(P.fontSize)}px`),P.tspan.setAttributeNS(null,"y",s(-P.y)),P.txtElement=this.svgFactory.createElement("svg:text"),P.txtElement.append(P.tspan)}beginText(){let c=this.current;c.x=c.lineX=0,c.y=c.lineY=0,c.textMatrix=r.IDENTITY_MATRIX,c.lineMatrix=r.IDENTITY_MATRIX,c.textMatrixScale=1,c.tspan=this.svgFactory.createElement("svg:tspan"),c.txtElement=this.svgFactory.createElement("svg:text"),c.txtgrp=this.svgFactory.createElement("svg:g"),c.xcoords=[],c.ycoords=[]}moveText(c,u){let f=this.current;f.x=f.lineX+=c,f.y=f.lineY+=u,f.xcoords=[],f.ycoords=[],f.tspan=this.svgFactory.createElement("svg:tspan"),f.tspan.setAttributeNS(null,"font-family",f.fontFamily),f.tspan.setAttributeNS(null,"font-size",`${s(f.fontSize)}px`),f.tspan.setAttributeNS(null,"y",s(-f.y))}showText(c){let u=this.current,f=u.font,M=u.fontSize;if(M===0)return;let E=u.fontSizeScale,w=u.charSpacing,P=u.wordSpacing,ne=u.fontDirection,ie=u.textHScale*ne,Z=f.vertical,Y=Z?1:-1,j=f.defaultVMetrics,U=M*u.fontMatrix[0],q=0;for(let we of c){if(we===null){q+=ne*P;continue}else if(typeof we=="number"){q+=Y*we*M/1e3;continue}let H=(we.isSpace?P:0)+w,x=we.fontChar,g,L,I=we.width;if(Z){let N,K=we.vmetric||j;N=we.vmetric?K[1]:I*.5,N=-N*U;let J=K[2]*U;I=K?-K[0]:I,g=N/E,L=(q+J)/E}else g=q/E,L=0;(we.isInFont||f.missingFile)&&(u.xcoords.push(u.x+g),Z&&u.ycoords.push(-u.y+L),u.tspan.textContent+=x);let V;Z?V=I*U-H*ne:V=I*U+H*ne,q+=V}u.tspan.setAttributeNS(null,"x",u.xcoords.map(s).join(" ")),Z?u.tspan.setAttributeNS(null,"y",u.ycoords.map(s).join(" ")):u.tspan.setAttributeNS(null,"y",s(-u.y)),Z?u.y-=q:u.x+=q*ie,u.tspan.setAttributeNS(null,"font-family",u.fontFamily),u.tspan.setAttributeNS(null,"font-size",`${s(u.fontSize)}px`),u.fontStyle!==S.fontStyle&&u.tspan.setAttributeNS(null,"font-style",u.fontStyle),u.fontWeight!==S.fontWeight&&u.tspan.setAttributeNS(null,"font-weight",u.fontWeight);let re=u.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;if(re===r.TextRenderingMode.FILL||re===r.TextRenderingMode.FILL_STROKE?(u.fillColor!==S.fillColor&&u.tspan.setAttributeNS(null,"fill",u.fillColor),u.fillAlpha<1&&u.tspan.setAttributeNS(null,"fill-opacity",u.fillAlpha)):u.textRenderingMode===r.TextRenderingMode.ADD_TO_PATH?u.tspan.setAttributeNS(null,"fill","transparent"):u.tspan.setAttributeNS(null,"fill","none"),re===r.TextRenderingMode.STROKE||re===r.TextRenderingMode.FILL_STROKE){let we=1/(u.textMatrixScale||1);this._setStrokeAttributes(u.tspan,we)}let pe=u.textMatrix;u.textRise!==0&&(pe=pe.slice(),pe[5]+=u.textRise),u.txtElement.setAttributeNS(null,"transform",`${v(pe)} scale(${s(ie)}, -1)`),u.txtElement.setAttributeNS(b,"xml:space","preserve"),u.txtElement.append(u.tspan),u.txtgrp.append(u.txtElement),this._ensureTransformGroup().append(u.txtElement)}setLeadingMoveText(c,u){this.setLeading(-u),this.moveText(c,u)}addFontStyle(c){if(!c.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));let u=_(c.data,c.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${c.loadedName}"; src: url(${u}); }
`}setFont(c){let u=this.current,f=this.commonObjs.get(c[0]),M=c[1];u.font=f,this.embedFonts&&!f.missingFile&&!this.embeddedFonts[f.loadedName]&&(this.addFontStyle(f),this.embeddedFonts[f.loadedName]=f),u.fontMatrix=f.fontMatrix||r.FONT_IDENTITY_MATRIX;let E="normal";f.black?E="900":f.bold&&(E="bold");let w=f.italic?"italic":"normal";M<0?(M=-M,u.fontDirection=-1):u.fontDirection=1,u.fontSize=M,u.fontFamily=f.loadedName,u.fontWeight=E,u.fontStyle=w,u.tspan=this.svgFactory.createElement("svg:tspan"),u.tspan.setAttributeNS(null,"y",s(-u.y)),u.xcoords=[],u.ycoords=[]}endText(){let c=this.current;c.textRenderingMode&r.TextRenderingMode.ADD_TO_PATH_FLAG&&c.txtElement?.hasChildNodes()&&(c.element=c.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(c){c>0&&(this.current.lineWidth=c)}setLineCap(c){this.current.lineCap=A[c]}setLineJoin(c){this.current.lineJoin=C[c]}setMiterLimit(c){this.current.miterLimit=c}setStrokeAlpha(c){this.current.strokeAlpha=c}setStrokeRGBColor(c,u,f){this.current.strokeColor=r.Util.makeHexColor(c,u,f)}setFillAlpha(c){this.current.fillAlpha=c}setFillRGBColor(c,u,f){this.current.fillColor=r.Util.makeHexColor(c,u,f),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(c){this.current.strokeColor=this._makeColorN_Pattern(c)}setFillColorN(c){this.current.fillColor=this._makeColorN_Pattern(c)}shadingFill(c){let u=this.viewport.width,f=this.viewport.height,M=r.Util.inverseTransform(this.transformMatrix),E=r.Util.applyTransform([0,0],M),w=r.Util.applyTransform([0,f],M),P=r.Util.applyTransform([u,0],M),ne=r.Util.applyTransform([u,f],M),ie=Math.min(E[0],w[0],P[0],ne[0]),Z=Math.min(E[1],w[1],P[1],ne[1]),Y=Math.max(E[0],w[0],P[0],ne[0]),j=Math.max(E[1],w[1],P[1],ne[1]),U=this.svgFactory.createElement("svg:rect");U.setAttributeNS(null,"x",ie),U.setAttributeNS(null,"y",Z),U.setAttributeNS(null,"width",Y-ie),U.setAttributeNS(null,"height",j-Z),U.setAttributeNS(null,"fill",this._makeShadingPattern(c)),this.current.fillAlpha<1&&U.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(U)}_makeColorN_Pattern(c){return c[0]==="TilingPattern"?this._makeTilingPattern(c):this._makeShadingPattern(c)}_makeTilingPattern(c){let u=c[1],f=c[2],M=c[3]||r.IDENTITY_MATRIX,[E,w,P,ne]=c[4],ie=c[5],Z=c[6],Y=c[7],j=`shading${h++}`,[U,q,re,pe]=r.Util.normalizeRect([...r.Util.applyTransform([E,w],M),...r.Util.applyTransform([P,ne],M)]),[we,H]=r.Util.singularValueDecompose2dScale(M),x=ie*we,g=Z*H,L=this.svgFactory.createElement("svg:pattern");L.setAttributeNS(null,"id",j),L.setAttributeNS(null,"patternUnits","userSpaceOnUse"),L.setAttributeNS(null,"width",x),L.setAttributeNS(null,"height",g),L.setAttributeNS(null,"x",`${U}`),L.setAttributeNS(null,"y",`${q}`);let I=this.svg,V=this.transformMatrix,N=this.current.fillColor,K=this.current.strokeColor,J=this.svgFactory.create(re-U,pe-q);if(this.svg=J,this.transformMatrix=M,Y===2){let p=r.Util.makeHexColor(...u);this.current.fillColor=p,this.current.strokeColor=p}return this.executeOpTree(this.convertOpList(f)),this.svg=I,this.transformMatrix=V,this.current.fillColor=N,this.current.strokeColor=K,L.append(J.childNodes[0]),this.defs.append(L),`url(#${j})`}_makeShadingPattern(c){switch(typeof c=="string"&&(c=this.objs.get(c)),c[0]){case"RadialAxial":let u=`shading${h++}`,f=c[3],M;switch(c[1]){case"axial":let E=c[4],w=c[5];M=this.svgFactory.createElement("svg:linearGradient"),M.setAttributeNS(null,"id",u),M.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),M.setAttributeNS(null,"x1",E[0]),M.setAttributeNS(null,"y1",E[1]),M.setAttributeNS(null,"x2",w[0]),M.setAttributeNS(null,"y2",w[1]);break;case"radial":let P=c[4],ne=c[5],ie=c[6],Z=c[7];M=this.svgFactory.createElement("svg:radialGradient"),M.setAttributeNS(null,"id",u),M.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),M.setAttributeNS(null,"cx",ne[0]),M.setAttributeNS(null,"cy",ne[1]),M.setAttributeNS(null,"r",Z),M.setAttributeNS(null,"fx",P[0]),M.setAttributeNS(null,"fy",P[1]),M.setAttributeNS(null,"fr",ie);break;default:throw new Error(`Unknown RadialAxial type: ${c[1]}`)}for(let E of f){let w=this.svgFactory.createElement("svg:stop");w.setAttributeNS(null,"offset",E[0]),w.setAttributeNS(null,"stop-color",E[1]),M.append(w)}return this.defs.append(M),`url(#${u})`;case"Mesh":return(0,r.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${c[0]}`)}}setDash(c,u){this.current.dashArray=c,this.current.dashPhase=u}constructPath(c,u){let f=this.current,M=f.x,E=f.y,w=[],P=0;for(let ne of c)switch(ne|0){case r.OPS.rectangle:M=u[P++],E=u[P++];let ie=u[P++],Z=u[P++],Y=M+ie,j=E+Z;w.push("M",s(M),s(E),"L",s(Y),s(E),"L",s(Y),s(j),"L",s(M),s(j),"Z");break;case r.OPS.moveTo:M=u[P++],E=u[P++],w.push("M",s(M),s(E));break;case r.OPS.lineTo:M=u[P++],E=u[P++],w.push("L",s(M),s(E));break;case r.OPS.curveTo:M=u[P+4],E=u[P+5],w.push("C",s(u[P]),s(u[P+1]),s(u[P+2]),s(u[P+3]),s(M),s(E)),P+=6;break;case r.OPS.curveTo2:w.push("C",s(M),s(E),s(u[P]),s(u[P+1]),s(u[P+2]),s(u[P+3])),M=u[P+2],E=u[P+3],P+=4;break;case r.OPS.curveTo3:M=u[P+2],E=u[P+3],w.push("C",s(u[P]),s(u[P+1]),s(M),s(E),s(M),s(E)),P+=4;break;case r.OPS.closePath:w.push("Z");break}w=w.join(" "),f.path&&c.length>0&&c[0]!==r.OPS.rectangle&&c[0]!==r.OPS.moveTo?w=f.path.getAttributeNS(null,"d")+w:(f.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(f.path)),f.path.setAttributeNS(null,"d",w),f.path.setAttributeNS(null,"fill","none"),f.element=f.path,f.setCurrentPoint(M,E)}endPath(){let c=this.current;if(c.path=null,!this.pendingClip)return;if(!c.element){this.pendingClip=null;return}let u=`clippath${k++}`,f=this.svgFactory.createElement("svg:clipPath");f.setAttributeNS(null,"id",u),f.setAttributeNS(null,"transform",v(this.transformMatrix));let M=c.element.cloneNode(!0);if(this.pendingClip==="evenodd"?M.setAttributeNS(null,"clip-rule","evenodd"):M.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,f.append(M),this.defs.append(f),c.activeClipUrl){c.clipGroup=null;for(let E of this.extraStack)E.clipGroup=null;f.setAttributeNS(null,"clip-path",c.activeClipUrl)}c.activeClipUrl=`url(#${u})`,this.tgrp=null}clip(c){this.pendingClip=c}closePath(){let c=this.current;if(c.path){let u=`${c.path.getAttributeNS(null,"d")}Z`;c.path.setAttributeNS(null,"d",u)}}setLeading(c){this.current.leading=-c}setTextRise(c){this.current.textRise=c}setTextRenderingMode(c){this.current.textRenderingMode=c}setHScale(c){this.current.textHScale=c/100}setRenderingIntent(c){}setFlatness(c){}setGState(c){for(let[u,f]of c)switch(u){case"LW":this.setLineWidth(f);break;case"LC":this.setLineCap(f);break;case"LJ":this.setLineJoin(f);break;case"ML":this.setMiterLimit(f);break;case"D":this.setDash(f[0],f[1]);break;case"RI":this.setRenderingIntent(f);break;case"FL":this.setFlatness(f);break;case"Font":this.setFont(f);break;case"CA":this.setStrokeAlpha(f);break;case"ca":this.setFillAlpha(f);break;default:(0,r.warn)(`Unimplemented graphic state operator ${u}`);break}}fill(){let c=this.current;c.element&&(c.element.setAttributeNS(null,"fill",c.fillColor),c.element.setAttributeNS(null,"fill-opacity",c.fillAlpha),this.endPath())}stroke(){let c=this.current;c.element&&(this._setStrokeAttributes(c.element),c.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(c,u=1){let f=this.current,M=f.dashArray;u!==1&&M.length>0&&(M=M.map(function(E){return u*E})),c.setAttributeNS(null,"stroke",f.strokeColor),c.setAttributeNS(null,"stroke-opacity",f.strokeAlpha),c.setAttributeNS(null,"stroke-miterlimit",s(f.miterLimit)),c.setAttributeNS(null,"stroke-linecap",f.lineCap),c.setAttributeNS(null,"stroke-linejoin",f.lineJoin),c.setAttributeNS(null,"stroke-width",s(u*f.lineWidth)+"px"),c.setAttributeNS(null,"stroke-dasharray",M.map(s).join(" ")),c.setAttributeNS(null,"stroke-dashoffset",s(u*f.dashPhase)+"px")}eoFill(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){let c=this.svgFactory.createElement("svg:rect");c.setAttributeNS(null,"x","0"),c.setAttributeNS(null,"y","0"),c.setAttributeNS(null,"width","1px"),c.setAttributeNS(null,"height","1px"),c.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(c)}paintImageXObject(c){let u=c.startsWith("g_")?this.commonObjs.get(c):this.objs.get(c);if(!u){(0,r.warn)(`Dependent image with object ID ${c} is not ready yet`);return}this.paintInlineImageXObject(u)}paintInlineImageXObject(c,u){let f=c.width,M=c.height,E=F(c,this.forceDataSchema,!!u),w=this.svgFactory.createElement("svg:rect");w.setAttributeNS(null,"x","0"),w.setAttributeNS(null,"y","0"),w.setAttributeNS(null,"width",s(f)),w.setAttributeNS(null,"height",s(M)),this.current.element=w,this.clip("nonzero");let P=this.svgFactory.createElement("svg:image");P.setAttributeNS(m,"xlink:href",E),P.setAttributeNS(null,"x","0"),P.setAttributeNS(null,"y",s(-M)),P.setAttributeNS(null,"width",s(f)+"px"),P.setAttributeNS(null,"height",s(M)+"px"),P.setAttributeNS(null,"transform",`scale(${s(1/f)} ${s(-1/M)})`),u?u.append(P):this._ensureTransformGroup().append(P)}paintImageMaskXObject(c){let u=this.current,f=c.width,M=c.height,E=u.fillColor;u.maskId=`mask${y++}`;let w=this.svgFactory.createElement("svg:mask");w.setAttributeNS(null,"id",u.maskId);let P=this.svgFactory.createElement("svg:rect");P.setAttributeNS(null,"x","0"),P.setAttributeNS(null,"y","0"),P.setAttributeNS(null,"width",s(f)),P.setAttributeNS(null,"height",s(M)),P.setAttributeNS(null,"fill",E),P.setAttributeNS(null,"mask",`url(#${u.maskId})`),this.defs.append(w),this._ensureTransformGroup().append(P),this.paintInlineImageXObject(c,w)}paintFormXObjectBegin(c,u){if(Array.isArray(c)&&c.length===6&&this.transform(c[0],c[1],c[2],c[3],c[4],c[5]),u){let f=u[2]-u[0],M=u[3]-u[1],E=this.svgFactory.createElement("svg:rect");E.setAttributeNS(null,"x",u[0]),E.setAttributeNS(null,"y",u[1]),E.setAttributeNS(null,"width",s(f)),E.setAttributeNS(null,"height",s(M)),this.current.element=E,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(c){let u=this.svgFactory.create(c.width,c.height),f=this.svgFactory.createElement("svg:defs");u.append(f),this.defs=f;let M=this.svgFactory.createElement("svg:g");return M.setAttributeNS(null,"transform",v(c.transform)),u.append(M),this.svg=M,u}_ensureClipGroup(){if(!this.current.clipGroup){let c=this.svgFactory.createElement("svg:g");c.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(c),this.current.clipGroup=c}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",v(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}}},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNodeStream=void 0;var n=e(1),r=e(33);let a=Lr(),d=Ms(),S=Ds(),b=Ps(),m=/^file:\/\/\/[a-zA-Z]:\//;function A(y){let h=b.parse(y);return h.protocol==="file:"||h.host?h:/^[a-z]:[/\\]/i.test(y)?b.parse(`file:///${y}`):(h.host||(h.protocol="file:"),h)}class C{constructor(h){this.source=h,this.url=A(h.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&h.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new v(this):new l(this),this._fullRequestReader}getRangeReader(h,c){if(c<=this._progressiveDataLength)return null;let u=this.isFsUrl?new k(this,h,c):new s(this,h,c);return this._rangeRequestReaders.push(u),u}cancelAllRequests(h){this._fullRequestReader&&this._fullRequestReader.cancel(h);for(let c of this._rangeRequestReaders.slice(0))c.cancel(h)}}t.PDFNodeStream=C;class _{constructor(h){this._url=h.url,this._done=!1,this._storedError=null,this.onProgress=null;let c=h.source;this._contentLength=c.length,this._loaded=0,this._filename=null,this._disableRange=c.disableRange||!1,this._rangeChunkSize=c.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!c.disableStream,this._isRangeSupported=!c.disableRange,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)(),this._headersCapability=(0,n.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let h=this._readableStream.read();return h===null?(this._readCapability=(0,n.createPromiseCapability)(),this.read()):(this._loaded+=h.length,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(h).buffer,done:!1})}cancel(h){if(!this._readableStream){this._error(h);return}this._readableStream.destroy(h)}_error(h){this._storedError=h,this._readCapability.resolve()}_setReadableStream(h){this._readableStream=h,h.on("readable",()=>{this._readCapability.resolve()}),h.on("end",()=>{h.destroy(),this._done=!0,this._readCapability.resolve()}),h.on("error",c=>{this._error(c)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new n.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class F{constructor(h){this._url=h.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)();let c=h.source;this._isStreamingSupported=!c.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let h=this._readableStream.read();return h===null?(this._readCapability=(0,n.createPromiseCapability)(),this.read()):(this._loaded+=h.length,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(h).buffer,done:!1})}cancel(h){if(!this._readableStream){this._error(h);return}this._readableStream.destroy(h)}_error(h){this._storedError=h,this._readCapability.resolve()}_setReadableStream(h){this._readableStream=h,h.on("readable",()=>{this._readCapability.resolve()}),h.on("end",()=>{h.destroy(),this._done=!0,this._readCapability.resolve()}),h.on("error",c=>{this._error(c)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function i(y,h){return{protocol:y.protocol,auth:y.auth,host:y.hostname,port:y.port,path:y.path,method:"GET",headers:h}}class l extends _{constructor(h){super(h);let c=u=>{if(u.statusCode===404){let w=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=w,this._headersCapability.reject(w);return}this._headersCapability.resolve(),this._setReadableStream(u);let f=w=>this._readableStream.headers[w.toLowerCase()],{allowRangeRequests:M,suggestedLength:E}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:f,isHttp:h.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=M,this._contentLength=E||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(f)};this._request=null,this._url.protocol==="http:"?this._request=d.request(i(this._url,h.httpHeaders),c):this._request=S.request(i(this._url,h.httpHeaders),c),this._request.on("error",u=>{this._storedError=u,this._headersCapability.reject(u)}),this._request.end()}}class s extends F{constructor(h,c,u){super(h),this._httpHeaders={};for(let M in h.httpHeaders){let E=h.httpHeaders[M];typeof E>"u"||(this._httpHeaders[M]=E)}this._httpHeaders.Range=`bytes=${c}-${u-1}`;let f=M=>{if(M.statusCode===404){let E=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=E;return}this._setReadableStream(M)};this._request=null,this._url.protocol==="http:"?this._request=d.request(i(this._url,this._httpHeaders),f):this._request=S.request(i(this._url,this._httpHeaders),f),this._request.on("error",M=>{this._storedError=M}),this._request.end()}}class v extends _{constructor(h){super(h);let c=decodeURIComponent(this._url.path);m.test(this._url.href)&&(c=c.replace(/^\//,"")),a.lstat(c,(u,f)=>{if(u){u.code==="ENOENT"&&(u=new n.MissingPDFException(`Missing PDF "${c}".`)),this._storedError=u,this._headersCapability.reject(u);return}this._contentLength=f.size,this._setReadableStream(a.createReadStream(c)),this._headersCapability.resolve()})}}class k extends F{constructor(h,c,u){super(h);let f=decodeURIComponent(this._url.path);m.test(this._url.href)&&(f=f.replace(/^\//,"")),this._setReadableStream(a.createReadStream(f,{start:c,end:u-1}))}}},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createResponseStatusError=b,t.extractFilenameFromHeader=S,t.validateRangeRequestCapabilities=d,t.validateResponseStatus=m;var n=e(1),r=e(34),a=e(8);function d({getResponseHeader:A,isHttp:C,rangeChunkSize:_,disableRange:F}){let i={allowRangeRequests:!1,suggestedLength:void 0},l=parseInt(A("Content-Length"),10);return!Number.isInteger(l)||(i.suggestedLength=l,l<=2*_)||F||!C||A("Accept-Ranges")!=="bytes"||(A("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function S(A){let C=A("Content-Disposition");if(C){let _=(0,r.getFilenameFromContentDispositionHeader)(C);if(_.includes("%"))try{_=decodeURIComponent(_)}catch{}if((0,a.isPdfFile)(_))return _}return null}function b(A,C){return A===404||A===0&&C.startsWith("file:")?new n.MissingPDFException('Missing PDF "'+C+'".'):new n.UnexpectedResponseException(`Unexpected server response (${A}) while retrieving PDF "${C}".`,A)}function m(A){return A===200||A===206}},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFilenameFromContentDispositionHeader=r;var n=e(1);function r(a){let d=!0,S=b("filename\\*","i").exec(a);if(S){S=S[1];let l=_(S);return l=unescape(l),l=F(l),l=i(l),A(l)}if(S=C(a),S){let l=i(S);return A(l)}if(S=b("filename","i").exec(a),S){S=S[1];let l=_(S);return l=i(l),A(l)}function b(l,s){return new RegExp("(?:^|;)\\s*"+l+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',s)}function m(l,s){if(l){if(!/^[\x00-\xFF]+$/.test(s))return s;try{let v=new TextDecoder(l,{fatal:!0}),k=(0,n.stringToBytes)(s);s=v.decode(k),d=!1}catch{}}return s}function A(l){return d&&/[\x80-\xff]/.test(l)&&(l=m("utf-8",l),d&&(l=m("iso-8859-1",l))),l}function C(l){let s=[],v,k=b("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(v=k.exec(l))!==null;){let[,h,c,u]=v;if(h=parseInt(h,10),h in s){if(h===0)break;continue}s[h]=[c,u]}let y=[];for(let h=0;h<s.length&&h in s;++h){let[c,u]=s[h];u=_(u),c&&(u=unescape(u),h===0&&(u=F(u))),y.push(u)}return y.join("")}function _(l){if(l.startsWith('"')){let s=l.slice(1).split('\\"');for(let v=0;v<s.length;++v){let k=s[v].indexOf('"');k!==-1&&(s[v]=s[v].slice(0,k),s.length=v+1),s[v]=s[v].replace(/\\(.)/g,"$1")}l=s.join('"')}return l}function F(l){let s=l.indexOf("'");if(s===-1)return l;let v=l.slice(0,s),y=l.slice(s+1).replace(/^[^']*'/,"");return m(v,y)}function i(l){return!l.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(l)?l:l.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(s,v,k,y){if(k==="q"||k==="Q")return y=y.replace(/_/g," "),y=y.replace(/=([0-9a-fA-F]{2})/g,function(h,c){return String.fromCharCode(parseInt(c,16))}),m(v,y);try{y=atob(y)}catch{}return m(v,y)})}return""}},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNetworkStream=void 0;var n=e(1),r=e(33);let a=200,d=206;function S(_){let F=_.response;return typeof F!="string"?F:(0,n.stringToBytes)(F).buffer}class b{constructor(F,i={}){this.url=F,this.isHttp=/^https?:/i.test(F),this.httpHeaders=this.isHttp&&i.httpHeaders||Object.create(null),this.withCredentials=i.withCredentials||!1,this.getXhr=i.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(F,i,l){let s={begin:F,end:i};for(let v in l)s[v]=l[v];return this.request(s)}requestFull(F){return this.request(F)}request(F){let i=this.getXhr(),l=this.currXhrId++,s=this.pendingRequests[l]={xhr:i};i.open("GET",this.url),i.withCredentials=this.withCredentials;for(let v in this.httpHeaders){let k=this.httpHeaders[v];typeof k>"u"||i.setRequestHeader(v,k)}return this.isHttp&&"begin"in F&&"end"in F?(i.setRequestHeader("Range",`bytes=${F.begin}-${F.end-1}`),s.expectedStatus=d):s.expectedStatus=a,i.responseType="arraybuffer",F.onError&&(i.onerror=function(v){F.onError(i.status)}),i.onreadystatechange=this.onStateChange.bind(this,l),i.onprogress=this.onProgress.bind(this,l),s.onHeadersReceived=F.onHeadersReceived,s.onDone=F.onDone,s.onError=F.onError,s.onProgress=F.onProgress,i.send(null),l}onProgress(F,i){let l=this.pendingRequests[F];l&&l.onProgress?.(i)}onStateChange(F,i){let l=this.pendingRequests[F];if(!l)return;let s=l.xhr;if(s.readyState>=2&&l.onHeadersReceived&&(l.onHeadersReceived(),delete l.onHeadersReceived),s.readyState!==4||!(F in this.pendingRequests))return;if(delete this.pendingRequests[F],s.status===0&&this.isHttp){l.onError?.(s.status);return}let v=s.status||a;if(!(v===a&&l.expectedStatus===d)&&v!==l.expectedStatus){l.onError?.(s.status);return}let y=S(s);if(v===d){let h=s.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(h);l.onDone({begin:parseInt(c[1],10),chunk:y})}else y?l.onDone({begin:0,chunk:y}):l.onError?.(s.status)}getRequestXhr(F){return this.pendingRequests[F].xhr}isPendingRequest(F){return F in this.pendingRequests}abortRequest(F){let i=this.pendingRequests[F].xhr;delete this.pendingRequests[F],i.abort()}}class m{constructor(F){this._source=F,this._manager=new b(F.url,{httpHeaders:F.httpHeaders,withCredentials:F.withCredentials}),this._rangeChunkSize=F.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(F){let i=this._rangeRequestReaders.indexOf(F);i>=0&&this._rangeRequestReaders.splice(i,1)}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new A(this._manager,this._source),this._fullRequestReader}getRangeReader(F,i){let l=new C(this._manager,F,i);return l.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(l),l}cancelAllRequests(F){this._fullRequestReader?.cancel(F);for(let i of this._rangeRequestReaders.slice(0))i.cancel(F)}}t.PDFNetworkStream=m;class A{constructor(F,i){this._manager=F;let l={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=i.url,this._fullRequestId=F.requestFull(l),this._headersReceivedCapability=(0,n.createPromiseCapability)(),this._disableRange=i.disableRange||!1,this._contentLength=i.length,this._rangeChunkSize=i.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let F=this._fullRequestId,i=this._manager.getRequestXhr(F),l=k=>i.getResponseHeader(k),{allowRangeRequests:s,suggestedLength:v}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:l,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=v||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(l),this._isRangeSupported&&this._manager.abortRequest(F),this._headersReceivedCapability.resolve()}_onDone(F){if(F&&(this._requests.length>0?this._requests.shift().resolve({value:F.chunk,done:!1}):this._cachedChunks.push(F.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(F){this._storedError=(0,r.createResponseStatusError)(F,this._url),this._headersReceivedCapability.reject(this._storedError);for(let i of this._requests)i.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(F){this.onProgress?.({loaded:F.loaded,total:F.lengthComputable?F.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let F=(0,n.createPromiseCapability)();return this._requests.push(F),F.promise}cancel(F){this._done=!0,this._headersReceivedCapability.reject(F);for(let i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class C{constructor(F,i,l){this._manager=F;let s={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=F.url,this._requestId=F.requestRange(i,l,s),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(F){let i=F.chunk;this._requests.length>0?this._requests.shift().resolve({value:i,done:!1}):this._queuedChunk=i,this._done=!0;for(let l of this._requests)l.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(F){this._storedError=(0,r.createResponseStatusError)(F,this._url);for(let i of this._requests)i.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(F){this.isStreamingSupported||this.onProgress?.({loaded:F.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let i=this._queuedChunk;return this._queuedChunk=null,{value:i,done:!1}}if(this._done)return{value:void 0,done:!0};let F=(0,n.createPromiseCapability)();return this._requests.push(F),F.promise}cancel(F){this._done=!0;for(let i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(o,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFFetchStream=void 0;var n=e(1),r=e(33);function a(A,C,_){return{method:"GET",headers:A,signal:_.signal,mode:"cors",credentials:C?"include":"same-origin",redirect:"follow"}}function d(A){let C=new Headers;for(let _ in A){let F=A[_];typeof F>"u"||C.append(_,F)}return C}class S{constructor(C){this.source=C,this.isHttp=/^https?:/i.test(C.url),this.httpHeaders=this.isHttp&&C.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new b(this),this._fullRequestReader}getRangeReader(C,_){if(_<=this._progressiveDataLength)return null;let F=new m(this,C,_);return this._rangeRequestReaders.push(F),F}cancelAllRequests(C){this._fullRequestReader&&this._fullRequestReader.cancel(C);for(let _ of this._rangeRequestReaders.slice(0))_.cancel(C)}}t.PDFFetchStream=S;class b{constructor(C){this._stream=C,this._reader=null,this._loaded=0,this._filename=null;let _=C.source;this._withCredentials=_.withCredentials||!1,this._contentLength=_.length,this._headersCapability=(0,n.createPromiseCapability)(),this._disableRange=_.disableRange||!1,this._rangeChunkSize=_.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!_.disableStream,this._isRangeSupported=!_.disableRange,this._headers=d(this._stream.httpHeaders);let F=_.url;fetch(F,a(this._headers,this._withCredentials,this._abortController)).then(i=>{if(!(0,r.validateResponseStatus)(i.status))throw(0,r.createResponseStatusError)(i.status,F);this._reader=i.body.getReader(),this._headersCapability.resolve();let l=k=>i.headers.get(k),{allowRangeRequests:s,suggestedLength:v}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:l,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=s,this._contentLength=v||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(l),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new n.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;let{value:C,done:_}=await this._reader.read();return _?{value:C,done:_}:(this._loaded+=C.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(C).buffer,done:!1})}cancel(C){this._reader&&this._reader.cancel(C),this._abortController.abort()}}class m{constructor(C,_,F){this._stream=C,this._reader=null,this._loaded=0;let i=C.source;this._withCredentials=i.withCredentials||!1,this._readCapability=(0,n.createPromiseCapability)(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController,this._headers=d(this._stream.httpHeaders),this._headers.append("Range",`bytes=${_}-${F-1}`);let l=i.url;fetch(l,a(this._headers,this._withCredentials,this._abortController)).then(s=>{if(!(0,r.validateResponseStatus)(s.status))throw(0,r.createResponseStatusError)(s.status,l);this._readCapability.resolve(),this._reader=s.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;let{value:C,done:_}=await this._reader.read();return _?{value:C,done:_}:(this._loaded+=C.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(C).buffer,done:!1})}cancel(C){this._reader&&this._reader.cancel(C),this._abortController.abort()}}}],__webpack_module_cache__={};function __w_pdfjs_require__(o){var t=__webpack_module_cache__[o];if(t!==void 0)return t.exports;var e=__webpack_module_cache__[o]={exports:{}};return __webpack_modules__[o](e,e.exports,__w_pdfjs_require__),e.exports}var __webpack_exports__={};return(()=>{var o=__webpack_exports__;Object.defineProperty(o,"__esModule",{value:!0}),Object.defineProperty(o,"AnnotationEditorLayer",{enumerable:!0,get:function(){return r.AnnotationEditorLayer}}),Object.defineProperty(o,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return t.AnnotationEditorParamsType}}),Object.defineProperty(o,"AnnotationEditorType",{enumerable:!0,get:function(){return t.AnnotationEditorType}}),Object.defineProperty(o,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return a.AnnotationEditorUIManager}}),Object.defineProperty(o,"AnnotationLayer",{enumerable:!0,get:function(){return d.AnnotationLayer}}),Object.defineProperty(o,"AnnotationMode",{enumerable:!0,get:function(){return t.AnnotationMode}}),Object.defineProperty(o,"CMapCompressionType",{enumerable:!0,get:function(){return t.CMapCompressionType}}),Object.defineProperty(o,"GlobalWorkerOptions",{enumerable:!0,get:function(){return S.GlobalWorkerOptions}}),Object.defineProperty(o,"InvalidPDFException",{enumerable:!0,get:function(){return t.InvalidPDFException}}),Object.defineProperty(o,"LoopbackPort",{enumerable:!0,get:function(){return e.LoopbackPort}}),Object.defineProperty(o,"MissingPDFException",{enumerable:!0,get:function(){return t.MissingPDFException}}),Object.defineProperty(o,"OPS",{enumerable:!0,get:function(){return t.OPS}}),Object.defineProperty(o,"PDFDataRangeTransport",{enumerable:!0,get:function(){return e.PDFDataRangeTransport}}),Object.defineProperty(o,"PDFDateString",{enumerable:!0,get:function(){return n.PDFDateString}}),Object.defineProperty(o,"PDFWorker",{enumerable:!0,get:function(){return e.PDFWorker}}),Object.defineProperty(o,"PasswordResponses",{enumerable:!0,get:function(){return t.PasswordResponses}}),Object.defineProperty(o,"PermissionFlag",{enumerable:!0,get:function(){return t.PermissionFlag}}),Object.defineProperty(o,"PixelsPerInch",{enumerable:!0,get:function(){return n.PixelsPerInch}}),Object.defineProperty(o,"RenderingCancelledException",{enumerable:!0,get:function(){return n.RenderingCancelledException}}),Object.defineProperty(o,"SVGGraphics",{enumerable:!0,get:function(){return A.SVGGraphics}}),Object.defineProperty(o,"UNSUPPORTED_FEATURES",{enumerable:!0,get:function(){return t.UNSUPPORTED_FEATURES}}),Object.defineProperty(o,"UnexpectedResponseException",{enumerable:!0,get:function(){return t.UnexpectedResponseException}}),Object.defineProperty(o,"Util",{enumerable:!0,get:function(){return t.Util}}),Object.defineProperty(o,"VerbosityLevel",{enumerable:!0,get:function(){return t.VerbosityLevel}}),Object.defineProperty(o,"XfaLayer",{enumerable:!0,get:function(){return C.XfaLayer}}),Object.defineProperty(o,"build",{enumerable:!0,get:function(){return e.build}}),Object.defineProperty(o,"createPromiseCapability",{enumerable:!0,get:function(){return t.createPromiseCapability}}),Object.defineProperty(o,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return t.createValidAbsoluteUrl}}),Object.defineProperty(o,"getDocument",{enumerable:!0,get:function(){return e.getDocument}}),Object.defineProperty(o,"getFilenameFromUrl",{enumerable:!0,get:function(){return n.getFilenameFromUrl}}),Object.defineProperty(o,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return n.getPdfFilenameFromUrl}}),Object.defineProperty(o,"getXfaPageViewport",{enumerable:!0,get:function(){return n.getXfaPageViewport}}),Object.defineProperty(o,"isPdfFile",{enumerable:!0,get:function(){return n.isPdfFile}}),Object.defineProperty(o,"loadScript",{enumerable:!0,get:function(){return n.loadScript}}),Object.defineProperty(o,"renderTextLayer",{enumerable:!0,get:function(){return m.renderTextLayer}}),Object.defineProperty(o,"shadow",{enumerable:!0,get:function(){return t.shadow}}),Object.defineProperty(o,"version",{enumerable:!0,get:function(){return e.version}});var t=__w_pdfjs_require__(1),e=__w_pdfjs_require__(4),n=__w_pdfjs_require__(8),r=__w_pdfjs_require__(22),a=__w_pdfjs_require__(7),d=__w_pdfjs_require__(27),S=__w_pdfjs_require__(15),b=__w_pdfjs_require__(3),m=__w_pdfjs_require__(30),A=__w_pdfjs_require__(31),C=__w_pdfjs_require__(29);let _="2.16.105",F="172ccdbe5";if(b.isNodeJS){let{PDFNodeStream:i}=__w_pdfjs_require__(32);(0,e.setPDFNetworkStreamFactory)(l=>new i(l))}else{let{PDFNetworkStream:i}=__w_pdfjs_require__(35),{PDFFetchStream:l}=__w_pdfjs_require__(36);(0,e.setPDFNetworkStreamFactory)(s=>(0,n.isValidFetchUrl)(s.url)?new l(s):new i(s))}})(),__webpack_exports__})())});function En(o,t,e){return typeof o===t||o instanceof e}function He(o){return En(o,"function",Function)}function Pe(o){return En(o,"string",String)}function Dt(o){return En(o,"boolean",Boolean)}function ot(o){return En(o,"number",Number)}function bt(o){return $(o)&&En(o,"object",Object)}function Tt(o){return o instanceof Array}function Ke(o,t){throw new Error((t||"Unexpected object: ")+o)}function Se(o){return o==null}function $(o){return!Se(o)}function Ei(o){return o instanceof Uint8Array||o instanceof Uint8ClampedArray||o instanceof Int8Array||o instanceof Uint16Array||o instanceof Int16Array||o instanceof Uint32Array||o instanceof Int32Array||o instanceof Float32Array||o instanceof Float64Array||"BigUint64Array"in globalThis&&o instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&o instanceof globalThis.BigInt64Array}function Ci(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Xe(o){return o.splice(0)}function ro(o,t){for(let e=0;e<o.length;++e)if(o[e]!==t[e])return e;return-1}function Ut(o,t){let e=o.indexOf(t);return e>-1?(fr(o,e),!0):!1}function fr(o,t){return o.splice(t,1)[0]}function Rl(o,t,e){let n=o?0:t.length-1,r=o?t.length:-1,a=o?1:-1;for(let d of e)for(let S=n;S!=r;S+=a){let b=t[S];if(d(b))return b}return null}function Pt(o,...t){return Rl(!0,o,t)}var Cn=class{constructor(){this.listeners=new Map;this.listenerOptions=new Map}addEventListener(t,e,n){if(He(e)){let r=this.listeners.get(t);r||(r=new Array,this.listeners.set(t,r)),r.find(a=>a===e)||(r.push(e),n&&this.listenerOptions.set(e,n))}}removeEventListener(t,e){if(He(e)){let n=this.listeners.get(t);n&&this.removeListener(n,e)}}clearEventListeners(t){for(let[e,n]of this.listeners)if(Se(t)||t===e){for(let r of n)this.removeEventListener(t,r);Xe(n),this.listeners.delete(e)}}removeListener(t,e){let n=t.findIndex(r=>r===e);n>=0&&(fr(t,n),this.listenerOptions.has(e)&&this.listenerOptions.delete(e))}dispatchEvent(t){let e=this.listeners.get(t.type);if(e)for(let n of e){let r=this.listenerOptions.get(n);$(r)&&!Dt(r)&&r.once&&this.removeListener(e,n),n.call(this,t)}return!t.defaultPrevented}},rt=class extends Event{get type(){return super.type}constructor(t,e){super(t,e)}},Ve=class extends Cn{constructor(){super(...arguments);this.bubblers=new Set;this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addEventListener(e,n,r){super.addEventListener(e,n,r)}removeEventListener(e,n){super.removeEventListener(e,n)}clearEventListeners(e){return super.clearEventListeners(e)}addScopedEventListener(e,n,r,a){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([n,r]),this.addEventListener(n,r,a)}removeScope(e){let n=this.scopes.get(e);if(n){this.scopes.delete(e);for(let[r,a]of n)this.removeEventListener(r,a)}}dispatchEvent(e){if(!super.dispatchEvent(e))return!1;if(!e.cancelBubble){for(let n of this.bubblers)if(!n.dispatchEvent(e))return!1}return!0}};var un=class extends rt{constructor(e,n){super(e);this.app=n}},xr=class extends un{constructor(e,n){super("joinroom",e);this.roomName=n}},Fr=class extends un{constructor(t){super("quit",t)}},wr=class extends un{constructor(t){super("shown",t)}},Sr=class extends un{constructor(t){super("hidden",t)}},io=class extends Ve{constructor(e){super();this.env=e;this.dataLogger=null}quit(){this.dispatchEvent(new Fr(this))}join(e){this.dispatchEvent(new xr(this,e)),this.env.avatar.reset()}async show(e){await this.showing(e),this.dispatchEvent(new wr(this))}hide(){this.hiding(),this.dispatchEvent(new Sr(this))}init(e){return this.dataLogger=e.get("dataLogger"),Promise.resolve()}log(e,n){$(this.dataLogger)&&this.dataLogger.log(e,n)}error(e,n,r){$(this.dataLogger)&&this.dataLogger.error(e,n,r)}onError(e,n){return this.error.bind(this,e,n)}};var St=class extends Error{constructor(e,n=null){super(e);this.innerError=n}};var Mi=/([^\/]+)\/(.+)/,Il=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/;var Lt=class{constructor(t,e,n){this._type=t;this._fullSubType=e;this._primaryExtension=null;this.depMessage=null;let r=new Map;this._parameters=r;let a=this._fullSubType.match(Il);this._tree=a[1],this._subType=a[2],this._suffix=a[3];let d=a[4];if(this._value=this._fullValue=this._type+"/",$(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,$(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),$(d)){let S=d.split(";").map(b=>b.trim()).filter(b=>b.length>0).map(b=>b.split("="));for(let[b,...m]of S){let A=m.join("=");r.set(b,A);let C=`; ${b}=${A}`;this._fullValue+=C,b!=="q"&&(this._value+=C)}}this._extensions=n||[],this._primaryExtension=this._extensions[0]||null}static parse(t){if(!t)return null;let e=t.match(Mi);if(!e)return null;let n=e[1],r=e[2];return new Lt(n,r)}deprecate(t){return this.depMessage=t,this}check(){$(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(t){if(Se(t))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let e=null,n=null;if(Pe(t)){let r=t.match(Mi);if(!r)return!1;e=r[1],n=r[2]}else e=t.typeName,n=t._fullSubType;return this.typeName===e&&(this._fullSubType==="*"||this._fullSubType===n)}withParameter(t,e){let n=`${this._fullSubType}; ${t}=${e}`;return new Lt(this.typeName,n,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}addExtension(t){if(!t)throw new Error("File name is not defined");if(this.primaryExtension){let e=t.lastIndexOf(".");if(e>-1){let n=t.substring(e+1);this.extensions.indexOf(n)>-1&&(t=t.substring(0,e))}t=`${t}.${this.primaryExtension}`}return t}};function Vl(o,t,...e){return new Lt(o,t,e)}function Je(o){return Vl.bind(null,o)}var Mn=Je("application");var Xt=Mn("javascript","js");var _r=Mn("json","json");var br=Mn("json; charset=UTF-8","json");var Di=Mn("pdf","pdf");var Tr=Mn("wasm","wasm");var Ol=Je("image");var Ar=Ol("jpeg","jpeg","jpg","jpe");var Pi=Je("model");var Li=Pi("gltf-binary","glb"),Bi=Pi("gltf+json","gltf");var kr=Je("text");var so=kr("css","css");var Ri=kr("plain","txt","text","conf","def","list","log","in");var Ii=kr("xml");function Vi(o){if(o.status>=400)throw new Error("Resource could not be retrieved: "+o.requestPath);return o}function Ne(o){let{content:t}=Vi(o);return t}function vr(o){return $(o)&&He(o.then)&&He(o.catch)&&He(o.finally)&&He(o.fetch)&&He(o.getSize)}var Dn=class{constructor(t,e){this.path=t;this.type=e;this._result=null;this._error=null;this._started=!1;this._finished=!1;this.resolve=null;this.reject=null;this.promise=new Promise((n,r)=>{this.resolve=a=>{this._result=a,this._finished=!0,n(a)},this.reject=a=>{this._error=a,this._finished=!0,r(a)}})}get result(){if($(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}async getSize(t){try{let{contentLength:e}=await t.head(this.path).accept(this.type).exec();return[this,e||1]}catch(e){return console.warn(e),[this,1]}}async fetch(t,e){try{let n=await this.getResult(t,e);this.resolve(n)}catch(n){this.reject(n)}}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};var ao=class extends Dn{constructor(e,n,r){let a;Dt(n)?r=n:a=n;super(e,a);this.useCache=!!r}getResult(e,n){return this.getRequest(e,n).then(Ne)}getRequest(e,n){let r=e.get(this.path).useCache(this.useCache).progress(n);return this.getResponse(r)}};var zt=class extends Ve{constructor(){super(...arguments);this.attached=new Array;this.soFar=null;this.total=null;this.msg=null;this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(e,n,r,a){this.soFar=e,this.total=n,this.msg=r,this.est=a;for(let d of this.attached)d.report(e,n,r,a)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(e){this.report(0,1,e||"starting")}end(e){this.report(1,1,e||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,Xe(this.attached)}};var Pn=class extends zt{constructor(e,n){super();this.i=e;this.prog=n}report(e,n,r,a){super.report(e,n,r,a),this.prog.update(this.i,e,n,r)}};var lo=class{constructor(t){this.prog=t;this.weightTotal=0;this.subProgressCallbacks=new Array;this.subProgressWeights=new Array;this.subProgressValues=new Array;this.start=performance.now();for(let e=0;e<this.subProgressWeights.length;++e)this.subProgressValues[e]=0,this.subProgressCallbacks[e]=new Pn(e,this)}addSubProgress(t){t=t||1,this.weightTotal+=t,this.subProgressWeights.push(t),this.subProgressValues.push(0);let e=new Pn(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(e),e}update(t,e,n,r){if(this.prog){this.subProgressValues[t]=e/n;let a=0;for(let m=0;m<this.subProgressWeights.length;++m)a+=this.subProgressValues[m]*this.subProgressWeights[m];let d=performance.now(),S=d-this.start,b=this.start-d+S*this.weightTotal/a;this.prog.report(a,this.weightTotal,r,b)}}};function mt(o,t){return new yr(t,o).subProgressCallbacks}function Oi(o,t){let e=new Array(t);for(let n=0;n<t;++n)e[n]=1;return mt(o,e)}var yr=class extends lo{constructor(t,e){super(e);for(let n of t)this.addSubProgress(n)}};function pn(o){return o}function Wi(){return!0}function Hi(){return!1}var et=class{constructor(t=!0){this.autoStart=t;this.onThens=new Array;this.onCatches=new Array;this._result=void 0;this._error=void 0;this._executionState="waiting";this._resultState="none";this.resolve=e=>{if(this.running){this._result=e,this._resultState="resolved";for(let n of this.onThens)n(e);this.clear(),this._executionState="finished"}},this.reject=e=>{if(this.running){this._error=e,this._resultState="errored";for(let n of this.onCatches)n(e);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){Xe(this.onThens),Xe(this.onCatches)}start(){this._executionState="running"}resolver(t){return()=>this.resolve(t)}resolveOn(t,e,n){let r=this.resolver(n);t.addEventListener(e,r),this.finally(()=>t.removeEventListener(e,r))}get result(){if($(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((t,e)=>{this.finished?this.errored?e(this.error):t(this.result):(this.onThens.push(t),this.onCatches.push(e))})}then(t,e){return this.project().then(t,e)}catch(t){return this.project().catch(t)}finally(t){return this.project().finally(t)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(t){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",t&&this.start()}};function Ni(o,t){return"on"+t in o}function pt(o,t,e,...n){Se(n)&&(n=[]);let r;if(Pe(e)?n.unshift(e):ot(e)&&(r=e),!(o instanceof Cn)){if(!Ni(o,t))throw new St(`Target does not have a ${t} rejection event`);for(let b of n)if(!Ni(o,b))throw new St(`Target does not have a ${b} rejection event`)}let a=new et;if(ot(r)){let b=setTimeout(a.reject,r,`'${t}' has timed out.`);a.finally(clearTimeout.bind(globalThis,b))}let d=(b,m)=>{o.addEventListener(b,m),a.finally(()=>o.removeEventListener(b,m))};d(t,b=>a.resolve(b));let S=b=>a.reject(b);for(let b of n)d(b,S);return a}function Bt(o){return o.then(Wi).catch(Hi)}var Rt=class{constructor(t,e,n,...r){this.key=t;this.value=e;this.bySetAttribute=n;this.tags=r.map(a=>a.toLocaleUpperCase()),Object.freeze(this)}applyToElement(t){let e=this.key.startsWith("data-");if(!(this.tags.length===0||this.tags.indexOf(t.tagName)>-1||e))console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`);else if(e){let r=this.key.substring(5);t.dataset[r]=this.value}else if(this.key==="style")Object.assign(t.style,this.value);else if(this.key==="classList"){let r=this.value.filter(pn);r.length>0&&r.forEach(a=>t.classList.add(a))}else this.bySetAttribute?t.setAttribute(this.key,this.value):this.key in t?t[this.key]=this.value:this.value===!1?t.removeAttribute(this.key):this.value===!0?t.setAttribute(this.key,""):t.setAttribute(this.key,this.value)}};function ji(o){return new Rt("height",o,!1,"canvas","embed","iframe","img","input","object","video")}function Gi(o){return new Rt("rel",o,!1,"a","area","link")}function Wl(o){return o instanceof URL&&(o=o.href),o}function Ui(o){return new Rt("src",Wl(o),!1,"audio","embed","iframe","img","input","script","source","track","video")}function co(o){return Pe(o)||(o=o.value),new Rt("type",o,!1,"button","input","command","embed","link","object","script","source","style","menu")}function Xi(o){return new Rt("width",o,!1,"canvas","embed","iframe","img","input","object","video")}function zi(o){return`${o}px`}function uo(...o){return`rgb(${o.join(", ")})`}function qi(o){return bt(o)?o.element instanceof Element:!1}function po(o){return qi(o)?o.element:Pe(o)?$i(o):o}function Hl(o){return bt(o)&&"applyToElement"in o&&He(o.applyToElement)}function Ki(o,t,e=""){o=po(o),o.style.display=t?e:"none"}function Ji(o){return o=po(o),o.style.display!=="none"}function Nl(o,...t){o=po(o);for(let e of t)$(e)&&(e instanceof Node?o.append(e):qi(e)?o.append(po(e)):Hl(e)?e.applyToElement(o):o.append(document.createTextNode(e.toLocaleString())));return o}function $i(o){return document.querySelector(o)}function Yi(o){return $i(o)}function ho(o,...t){let e=null;for(let n of t)if(n instanceof Rt&&n.key==="id"){e=document.getElementById(n.value);break}return e==null&&(e=document.createElement(o)),Nl(e,...t),e}function Qi(...o){return ho("canvas",...o)}function mo(...o){return ho("img",...o)}function Zi(...o){return ho("link",...o)}function es(...o){return ho("script",...o)}function Er(o,...t){if(!bt(o))return!1;o=o;for(let e of t){if(!(e in o))return!1;let n=o[e];if(!He(n))return!1}return!0}function jl(o){return Er(o,"dispose")}function Gl(o){return Er(o,"destroy")}function Ul(o){return Er(o,"close")}function at(o){jl(o)&&o.dispose(),Ul(o)&&o.close(),Gl(o)&&o.destroy()}function ts(o,t){try{return t(o)}finally{at(o)}}var Ln="HTMLCanvasElement"in globalThis,Lh="HTMLImageElement"in globalThis,Cr=!1,Zt=!Cr&&"OffscreenCanvas"in globalThis,Xl=!Cr&&"createImageBitmap"in globalThis;function dn(o){return Ln&&o instanceof HTMLCanvasElement}function go(o){return Zt&&o instanceof OffscreenCanvas}function fo(o){return Xl&&o instanceof ImageBitmap}function ns(o){return o instanceof ImageData}function zl(o){return dn(o)||go(o)}function os(o,t){let e=o.getContext("2d");if(Se(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function rs(o,t){let e=o.getContext("2d");if(Se(e))throw new Error("Could not create 2d context for canvas");e.putImageData(t,0,0)}function ql(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var Mr=Zt&&ql(),en=Mr&&Bn||Ln&&tn||null,is=Ln?tn:en;function Kl(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var Bh=Zt&&Kl();function Bn(o,t){return new OffscreenCanvas(o,t)}function tn(o,t){return Qi(Xi(o),ji(t))}function Jl(o){let t=Bn(o.width,o.height);return os(t,o),t}function $l(o){let t=tn(o.width,o.height);return os(t,o),t}var ss=Mr&&Jl||Ln&&$l||null;function Yl(o){let t=Bn(o.width,o.height);return rs(t,o),t}function Ql(o){let t=tn(o.width,o.height);return rs(t,o),t}var as=Mr&&Yl||Ln&&Ql||null;function xo(o,t){let e=o.getContext("2d");if(Se(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function Fo(o){let t=tn(o.width,o.height);return xo(t,o),t}async function hn(o){let t=mo(Ui(o));return await pt(t,"load","error"),t}function ls(o,t,e,n=1){return t=Math.floor(t*n),e=Math.floor(e*n),o.width!=t||o.height!=e?(o.width=t,o.height=e,!0):!1}function Zl(o){return $(o.textBaseline)}function ec(o,t,e,n=1){let r=o.imageSmoothingEnabled,a=o.textBaseline,d=o.textAlign,S=o.font,b=ls(o.canvas,t,e,n);return b&&(o.imageSmoothingEnabled=r,o.textBaseline=a,o.textAlign=d,o.font=S),b}function Rn(o,t,e,n=1){return Zl(o)?ec(o,t,e,n):ls(o.canvas,t,e,n)}function Dr(o,t,e){if(t instanceof Lt&&(t=t.value),go(o))return o.convertToBlob({type:t,quality:e});if(dn(o)){let n=new et;return o.toBlob(n.resolve,t,e),n}else throw new Error("Cannot save image from canvas")}function nn(o){zl(o)?o.width=o.height=0:at(o)}var on=1e-6,At=typeof Float32Array<"u"?Float32Array:Array,In=Math.random;var Ih=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var o=0,t=arguments.length;t--;)o+=arguments[t]*arguments[t];return Math.sqrt(o)});var gt={};yi(gt,{add:()=>ic,angle:()=>yc,bezier:()=>wc,ceil:()=>sc,clone:()=>tc,copy:()=>oc,create:()=>us,cross:()=>fc,dist:()=>Rc,distance:()=>gs,div:()=>Bc,divide:()=>ms,dot:()=>Fs,equals:()=>Dc,exactEquals:()=>Mc,floor:()=>ac,forEach:()=>Wc,fromValues:()=>nc,hermite:()=>Fc,inverse:()=>mc,len:()=>Vc,length:()=>ps,lerp:()=>xc,max:()=>cc,min:()=>lc,mul:()=>Lc,multiply:()=>hs,negate:()=>hc,normalize:()=>gc,random:()=>Sc,rotateX:()=>Ac,rotateY:()=>kc,rotateZ:()=>vc,round:()=>uc,scale:()=>pc,scaleAndAdd:()=>dc,set:()=>rc,sqrDist:()=>Ic,sqrLen:()=>Oc,squaredDistance:()=>fs,squaredLength:()=>xs,str:()=>Cc,sub:()=>Pc,subtract:()=>ds,transformMat3:()=>bc,transformMat4:()=>_c,transformQuat:()=>Tc,zero:()=>Ec});function us(){var o=new At(3);return At!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function tc(o){var t=new At(3);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t}function ps(o){var t=o[0],e=o[1],n=o[2];return Math.hypot(t,e,n)}function nc(o,t,e){var n=new At(3);return n[0]=o,n[1]=t,n[2]=e,n}function oc(o,t){return o[0]=t[0],o[1]=t[1],o[2]=t[2],o}function rc(o,t,e,n){return o[0]=t,o[1]=e,o[2]=n,o}function ic(o,t,e){return o[0]=t[0]+e[0],o[1]=t[1]+e[1],o[2]=t[2]+e[2],o}function ds(o,t,e){return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],o}function hs(o,t,e){return o[0]=t[0]*e[0],o[1]=t[1]*e[1],o[2]=t[2]*e[2],o}function ms(o,t,e){return o[0]=t[0]/e[0],o[1]=t[1]/e[1],o[2]=t[2]/e[2],o}function sc(o,t){return o[0]=Math.ceil(t[0]),o[1]=Math.ceil(t[1]),o[2]=Math.ceil(t[2]),o}function ac(o,t){return o[0]=Math.floor(t[0]),o[1]=Math.floor(t[1]),o[2]=Math.floor(t[2]),o}function lc(o,t,e){return o[0]=Math.min(t[0],e[0]),o[1]=Math.min(t[1],e[1]),o[2]=Math.min(t[2],e[2]),o}function cc(o,t,e){return o[0]=Math.max(t[0],e[0]),o[1]=Math.max(t[1],e[1]),o[2]=Math.max(t[2],e[2]),o}function uc(o,t){return o[0]=Math.round(t[0]),o[1]=Math.round(t[1]),o[2]=Math.round(t[2]),o}function pc(o,t,e){return o[0]=t[0]*e,o[1]=t[1]*e,o[2]=t[2]*e,o}function dc(o,t,e,n){return o[0]=t[0]+e[0]*n,o[1]=t[1]+e[1]*n,o[2]=t[2]+e[2]*n,o}function gs(o,t){var e=t[0]-o[0],n=t[1]-o[1],r=t[2]-o[2];return Math.hypot(e,n,r)}function fs(o,t){var e=t[0]-o[0],n=t[1]-o[1],r=t[2]-o[2];return e*e+n*n+r*r}function xs(o){var t=o[0],e=o[1],n=o[2];return t*t+e*e+n*n}function hc(o,t){return o[0]=-t[0],o[1]=-t[1],o[2]=-t[2],o}function mc(o,t){return o[0]=1/t[0],o[1]=1/t[1],o[2]=1/t[2],o}function gc(o,t){var e=t[0],n=t[1],r=t[2],a=e*e+n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),o[0]=t[0]*a,o[1]=t[1]*a,o[2]=t[2]*a,o}function Fs(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]}function fc(o,t,e){var n=t[0],r=t[1],a=t[2],d=e[0],S=e[1],b=e[2];return o[0]=r*b-a*S,o[1]=a*d-n*b,o[2]=n*S-r*d,o}function xc(o,t,e,n){var r=t[0],a=t[1],d=t[2];return o[0]=r+n*(e[0]-r),o[1]=a+n*(e[1]-a),o[2]=d+n*(e[2]-d),o}function Fc(o,t,e,n,r,a){var d=a*a,S=d*(2*a-3)+1,b=d*(a-2)+a,m=d*(a-1),A=d*(3-2*a);return o[0]=t[0]*S+e[0]*b+n[0]*m+r[0]*A,o[1]=t[1]*S+e[1]*b+n[1]*m+r[1]*A,o[2]=t[2]*S+e[2]*b+n[2]*m+r[2]*A,o}function wc(o,t,e,n,r,a){var d=1-a,S=d*d,b=a*a,m=S*d,A=3*a*S,C=3*b*d,_=b*a;return o[0]=t[0]*m+e[0]*A+n[0]*C+r[0]*_,o[1]=t[1]*m+e[1]*A+n[1]*C+r[1]*_,o[2]=t[2]*m+e[2]*A+n[2]*C+r[2]*_,o}function Sc(o,t){t=t||1;var e=In()*2*Math.PI,n=In()*2-1,r=Math.sqrt(1-n*n)*t;return o[0]=Math.cos(e)*r,o[1]=Math.sin(e)*r,o[2]=n*t,o}function _c(o,t,e){var n=t[0],r=t[1],a=t[2],d=e[3]*n+e[7]*r+e[11]*a+e[15];return d=d||1,o[0]=(e[0]*n+e[4]*r+e[8]*a+e[12])/d,o[1]=(e[1]*n+e[5]*r+e[9]*a+e[13])/d,o[2]=(e[2]*n+e[6]*r+e[10]*a+e[14])/d,o}function bc(o,t,e){var n=t[0],r=t[1],a=t[2];return o[0]=n*e[0]+r*e[3]+a*e[6],o[1]=n*e[1]+r*e[4]+a*e[7],o[2]=n*e[2]+r*e[5]+a*e[8],o}function Tc(o,t,e){var n=e[0],r=e[1],a=e[2],d=e[3],S=t[0],b=t[1],m=t[2],A=r*m-a*b,C=a*S-n*m,_=n*b-r*S,F=r*_-a*C,i=a*A-n*_,l=n*C-r*A,s=d*2;return A*=s,C*=s,_*=s,F*=2,i*=2,l*=2,o[0]=S+A+F,o[1]=b+C+i,o[2]=m+_+l,o}function Ac(o,t,e,n){var r=[],a=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],a[0]=r[0],a[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),a[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),o[0]=a[0]+e[0],o[1]=a[1]+e[1],o[2]=a[2]+e[2],o}function kc(o,t,e,n){var r=[],a=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],a[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),a[1]=r[1],a[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),o[0]=a[0]+e[0],o[1]=a[1]+e[1],o[2]=a[2]+e[2],o}function vc(o,t,e,n){var r=[],a=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],a[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),a[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),a[2]=r[2],o[0]=a[0]+e[0],o[1]=a[1]+e[1],o[2]=a[2]+e[2],o}function yc(o,t){var e=o[0],n=o[1],r=o[2],a=t[0],d=t[1],S=t[2],b=Math.sqrt(e*e+n*n+r*r),m=Math.sqrt(a*a+d*d+S*S),A=b*m,C=A&&Fs(o,t)/A;return Math.acos(Math.min(Math.max(C,-1),1))}function Ec(o){return o[0]=0,o[1]=0,o[2]=0,o}function Cc(o){return"vec3("+o[0]+", "+o[1]+", "+o[2]+")"}function Mc(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]}function Dc(o,t){var e=o[0],n=o[1],r=o[2],a=t[0],d=t[1],S=t[2];return Math.abs(e-a)<=on*Math.max(1,Math.abs(e),Math.abs(a))&&Math.abs(n-d)<=on*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(r-S)<=on*Math.max(1,Math.abs(r),Math.abs(S))}var Pc=ds,Lc=hs,Bc=ms,Rc=gs,Ic=fs,Vc=ps,Oc=xs,Wc=function(){var o=us();return function(t,e,n,r,a,d){var S,b;for(e||(e=3),n||(n=0),r?b=Math.min(r*e+n,t.length):b=t.length,S=n;S<b;S+=e)o[0]=t[S],o[1]=t[S+1],o[2]=t[S+2],a(o,o,d),t[S]=o[0],t[S+1]=o[1],t[S+2]=o[2];return t}}();var qt={};yi(qt,{add:()=>Uc,angle:()=>uu,ceil:()=>Xc,clone:()=>Hc,copy:()=>jc,create:()=>ws,cross:()=>nu,dist:()=>wu,distance:()=>Ts,div:()=>Fu,divide:()=>bs,dot:()=>tu,equals:()=>mu,exactEquals:()=>hu,floor:()=>zc,forEach:()=>bu,fromValues:()=>Nc,inverse:()=>Zc,len:()=>gu,length:()=>ks,lerp:()=>ou,max:()=>Kc,min:()=>qc,mul:()=>xu,multiply:()=>_s,negate:()=>Qc,normalize:()=>eu,random:()=>ru,rotate:()=>cu,round:()=>Jc,scale:()=>$c,scaleAndAdd:()=>Yc,set:()=>Gc,sqrDist:()=>Su,sqrLen:()=>_u,squaredDistance:()=>As,squaredLength:()=>vs,str:()=>du,sub:()=>fu,subtract:()=>Ss,transformMat2:()=>iu,transformMat2d:()=>su,transformMat3:()=>au,transformMat4:()=>lu,zero:()=>pu});function ws(){var o=new At(2);return At!=Float32Array&&(o[0]=0,o[1]=0),o}function Hc(o){var t=new At(2);return t[0]=o[0],t[1]=o[1],t}function Nc(o,t){var e=new At(2);return e[0]=o,e[1]=t,e}function jc(o,t){return o[0]=t[0],o[1]=t[1],o}function Gc(o,t,e){return o[0]=t,o[1]=e,o}function Uc(o,t,e){return o[0]=t[0]+e[0],o[1]=t[1]+e[1],o}function Ss(o,t,e){return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o}function _s(o,t,e){return o[0]=t[0]*e[0],o[1]=t[1]*e[1],o}function bs(o,t,e){return o[0]=t[0]/e[0],o[1]=t[1]/e[1],o}function Xc(o,t){return o[0]=Math.ceil(t[0]),o[1]=Math.ceil(t[1]),o}function zc(o,t){return o[0]=Math.floor(t[0]),o[1]=Math.floor(t[1]),o}function qc(o,t,e){return o[0]=Math.min(t[0],e[0]),o[1]=Math.min(t[1],e[1]),o}function Kc(o,t,e){return o[0]=Math.max(t[0],e[0]),o[1]=Math.max(t[1],e[1]),o}function Jc(o,t){return o[0]=Math.round(t[0]),o[1]=Math.round(t[1]),o}function $c(o,t,e){return o[0]=t[0]*e,o[1]=t[1]*e,o}function Yc(o,t,e,n){return o[0]=t[0]+e[0]*n,o[1]=t[1]+e[1]*n,o}function Ts(o,t){var e=t[0]-o[0],n=t[1]-o[1];return Math.hypot(e,n)}function As(o,t){var e=t[0]-o[0],n=t[1]-o[1];return e*e+n*n}function ks(o){var t=o[0],e=o[1];return Math.hypot(t,e)}function vs(o){var t=o[0],e=o[1];return t*t+e*e}function Qc(o,t){return o[0]=-t[0],o[1]=-t[1],o}function Zc(o,t){return o[0]=1/t[0],o[1]=1/t[1],o}function eu(o,t){var e=t[0],n=t[1],r=e*e+n*n;return r>0&&(r=1/Math.sqrt(r)),o[0]=t[0]*r,o[1]=t[1]*r,o}function tu(o,t){return o[0]*t[0]+o[1]*t[1]}function nu(o,t,e){var n=t[0]*e[1]-t[1]*e[0];return o[0]=o[1]=0,o[2]=n,o}function ou(o,t,e,n){var r=t[0],a=t[1];return o[0]=r+n*(e[0]-r),o[1]=a+n*(e[1]-a),o}function ru(o,t){t=t||1;var e=In()*2*Math.PI;return o[0]=Math.cos(e)*t,o[1]=Math.sin(e)*t,o}function iu(o,t,e){var n=t[0],r=t[1];return o[0]=e[0]*n+e[2]*r,o[1]=e[1]*n+e[3]*r,o}function su(o,t,e){var n=t[0],r=t[1];return o[0]=e[0]*n+e[2]*r+e[4],o[1]=e[1]*n+e[3]*r+e[5],o}function au(o,t,e){var n=t[0],r=t[1];return o[0]=e[0]*n+e[3]*r+e[6],o[1]=e[1]*n+e[4]*r+e[7],o}function lu(o,t,e){var n=t[0],r=t[1];return o[0]=e[0]*n+e[4]*r+e[12],o[1]=e[1]*n+e[5]*r+e[13],o}function cu(o,t,e,n){var r=t[0]-e[0],a=t[1]-e[1],d=Math.sin(n),S=Math.cos(n);return o[0]=r*S-a*d+e[0],o[1]=r*d+a*S+e[1],o}function uu(o,t){var e=o[0],n=o[1],r=t[0],a=t[1],d=Math.sqrt(e*e+n*n)*Math.sqrt(r*r+a*a),S=d&&(e*r+n*a)/d;return Math.acos(Math.min(Math.max(S,-1),1))}function pu(o){return o[0]=0,o[1]=0,o}function du(o){return"vec2("+o[0]+", "+o[1]+")"}function hu(o,t){return o[0]===t[0]&&o[1]===t[1]}function mu(o,t){var e=o[0],n=o[1],r=t[0],a=t[1];return Math.abs(e-r)<=on*Math.max(1,Math.abs(e),Math.abs(r))&&Math.abs(n-a)<=on*Math.max(1,Math.abs(n),Math.abs(a))}var gu=ks,fu=Ss,xu=_s,Fu=bs,wu=Ts,Su=As,_u=vs,bu=function(){var o=ws();return function(t,e,n,r,a,d){var S,b;for(e||(e=2),n||(n=0),r?b=Math.min(r*e+n,t.length):b=t.length,S=n;S<b;S+=e)o[0]=t[S],o[1]=t[S+1],a(o,o,d),t[S]=o[0],t[S+1]=o[1];return t}}();var It=Math.PI,Kt=.5*It,ys=2*It;var Au=864e13,Wh=-Au;function Jt(o,t,e){return Math.min(e,Math.max(t,o))}function Vt(o){return o*ys/360}function $e(o){return o*360/ys}function wo(o,t,e){let n=e-t;return n===0?0:(o-t)/n}function kt(o,t){let e=globalThis,n=e[o];if(Se(n)){if(Se(t))throw new Error(`No value ${o} found`);n=t(),e[o]=n}return n}function Pr(o){return $(o)&&o.length>0?parseFloat(o):null}var mn=class{constructor(t,e){this._url=null;this._base=void 0;this._protocol=null;this._host=null;this._hostName=null;this._userName=null;this._password=null;this._port=null;this._pathName=null;this._hash=null;this._query=new Map;t!==void 0&&(this._url=new URL(t,e),this.rehydrate())}rehydrate(){$(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),$(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),$(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),$(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),$(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),$(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),$(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),$(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[t,e]of this._query)this._url.searchParams.set(t,e);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=Pr(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((t,e)=>this._query.set(e,t))}refresh(){if(this._url===null){if($(this._protocol)&&($(this._host)||$(this._hostName))){if($(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=Pr(this._url.port),this.rehydrate(),!1;if($(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if($(this._pathName)&&$(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return $(this._url)}base(t){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=t,this.refresh(),this}protocol(t){return this._protocol=t,this.refresh()&&(this._url.protocol=t),this}host(t){return this._host=t,this.refresh()&&(this._url.host=t,this._hostName=this._url.hostname,this._port=Pr(this._url.port)),this}hostName(t){return this._hostName=t,this.refresh()&&(this._url.hostname=t,this._host=`${this._url.hostname}:${this._url.port}`),this}port(t){return this._port=t,this.refresh()&&(this._url.port=t.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(t){return this._userName=t,this.refresh()&&(this._url.username=t),this}password(t){return this._password=t,this.refresh()&&(this._url.password=t),this}path(t){return this._pathName=t,this.refresh()&&(this._url.pathname=t),this}pathPop(t){return t=t||/\/[^/]+\/?$/,this.path(this._pathName.replace(t,""))}pathPush(t){let e=this._pathName;return e.endsWith("/")||(e+="/"),e+=t,this.path(e)}query(t,e){return this._query.set(t,e),this.refresh()&&this._url.searchParams.set(t,e),this}hash(t){return this._hash=t,this.refresh()&&(this._url.hash=t),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};var Qr=Bl(Zs(),1);var Yr="2.16.105";var xn=class extends Ve{constructor(e,n,r){super();this._scale=250;this._visible=!0;this.wasVisible=null;this.redrawnEvt=new rt("redrawn");this.element=null;$(r)&&$(r.scale)&&(this._scale=r.scale),this._canvas=is(e,n),this._g=this.canvas.getContext("2d"),dn(this._canvas)&&(this.element=this._canvas)}fillRect(e,n,r,a,d,S){this.g.fillStyle=e,this.g.fillRect(n+S,r+S,a-2*S,d-2*S)}drawText(e,n,r,a){this.g.textAlign=a,this.g.strokeText(e,n,r),this.g.fillText(e,n,r)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}onClear(){this.g.clearRect(0,0,this.canvas.width,this.canvas.height)}clear(){this.onClear(),this.dispatchEvent(this.redrawnEvt)}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(e){this.scale!==e&&(this._scale=e,this.redraw())}get visible(){return this._visible}set visible(e){this.visible!==e&&(this.wasVisible=this._visible,this._visible=e,this.redraw())}};var Wn=class extends St{constructor(){super("Cancellation!")}},Ot=class{constructor(){this._cancelled=!1}get cancelled(){return this._cancelled}check(){if(this.cancelled)throw new Wn}cancel(){this._cancelled=!0}dispose(){throw new Error("Method not implemented.")}};var Hn=kt("Juniper:PdfReady",()=>new et(!1)),Fn=class extends xn{constructor(e,n){super(1,1);this.viewportParams=n;this.pdf=null;this._curPageIndex=null;this.ready=this.load(e)}static async prepare(e,n,r,a,d){let S=null;if(a instanceof Ot?S=a:d=a,S=S||new Ot,!Hn.started){Hn.start(),console.info(`PDF.js v${Yr}`);let b=new mn(e,location.href);b.query("v",Yr),e=b.toString(),Qr.default.GlobalWorkerOptions.workerSrc=await n.get(e).useCache(!r).progress(d).file().then(Ne),S.check(),Hn.resolve()}await Hn,S.check()}get curPageIndex(){return this._curPageIndex}get curPageNumber(){return this.curPageIndex+1}get canGoBack(){return this._curPageIndex>0}get canGoForward(){return this._curPageIndex<this.numPages-1}async load(e){await Hn;let n=Qr.default.getDocument(e);if(this.pdf=await n.promise,this.pdf.numPages===0)throw new Error("No pages found in PDF")}async getPage(e){if(await this.ready,e=Jt(e,0,this.pdf.numPages-1),e!==this._curPageIndex){this._curPageIndex=e;let n=await this.pdf.getPage(e+1),r=n.getViewport(this.viewportParams);Rn(this.g,r.width,r.height),await n.render({canvasContext:this.g,viewport:r,intent:"print"}).promise,this.dispatchEvent(this.redrawnEvt)}}get numPages(){return this.pdf?this.pdf.numPages:null}onRedraw(){return!1}};function ea(o,t){let e=o*It;return .5*(1-Math.cos(e))-t*Math.sin(2*e)}var{ACESFilmicToneMapping:vm,AddEquation:ym,AddOperation:Em,AdditiveAnimationBlendMode:Cm,AdditiveBlending:Mm,AlphaFormat:Dm,AlwaysDepth:Pm,AlwaysStencilFunc:Lm,AmbientLight:ta,AmbientLightProbe:Bm,AnimationClip:Rm,AnimationLoader:Im,AnimationMixer:Vm,AnimationObjectGroup:Om,AnimationUtils:Wm,ArcCurve:Hm,ArrayCamera:Nm,ArrowHelper:jm,Audio:Gm,AudioAnalyser:Um,AudioContext:Xm,AudioListener:zm,AudioLoader:qm,AxesHelper:Km,BackSide:Jm,BasicDepthPacking:$m,BasicShadowMap:Ym,Bone:Qm,BooleanKeyframeTrack:Zm,Box2:eg,Box3:tg,Box3Helper:ng,BoxBufferGeometry:og,BoxGeometry:na,BoxHelper:rg,BufferAttribute:ig,BufferGeometry:sg,BufferGeometryLoader:ag,ByteType:lg,Cache:cg,Camera:ug,CameraHelper:pg,CanvasTexture:dg,CapsuleBufferGeometry:hg,CapsuleGeometry:mg,CatmullRomCurve3:gg,CineonToneMapping:fg,CircleBufferGeometry:xg,CircleGeometry:Fg,ClampToEdgeWrapping:wg,Clock:Sg,Color:Zr,ColorKeyframeTrack:_g,ColorManagement:bg,CompressedArrayTexture:Tg,CompressedTexture:Ag,CompressedTextureLoader:kg,ConeBufferGeometry:vg,ConeGeometry:yg,CubeCamera:vu,CubeReflectionMapping:Eg,CubeRefractionMapping:Cg,CubeTexture:yu,CubeTextureLoader:Mg,CubeUVReflectionMapping:Dg,CubicBezierCurve:Pg,CubicBezierCurve3:Lg,CubicInterpolant:Bg,CullFaceBack:Rg,CullFaceFront:Ig,CullFaceFrontBack:Vg,CullFaceNone:Og,Curve:Wg,CurvePath:Hg,CustomBlending:Ng,CustomToneMapping:jg,CylinderBufferGeometry:Gg,CylinderGeometry:Ug,Cylindrical:Xg,Data3DTexture:zg,DataArrayTexture:qg,DataTexture:Kg,DataTextureLoader:Jg,DataUtils:$g,DecrementStencilOp:Yg,DecrementWrapStencilOp:Qg,DefaultLoadingManager:Zg,DepthFormat:ef,DepthStencilFormat:tf,DepthTexture:nf,DirectionalLight:of,DirectionalLightHelper:rf,DiscreteInterpolant:sf,DisplayP3ColorSpace:af,DodecahedronBufferGeometry:lf,DodecahedronGeometry:cf,DoubleSide:oa,DstAlphaFactor:uf,DstColorFactor:pf,DynamicCopyUsage:df,DynamicDrawUsage:hf,DynamicReadUsage:mf,EdgesGeometry:gf,EllipseCurve:ff,EqualDepth:xf,EqualStencilFunc:Ff,EquirectangularReflectionMapping:wf,EquirectangularRefractionMapping:Sf,Euler:ra,EventDispatcher:_f,ExtrudeBufferGeometry:bf,ExtrudeGeometry:Tf,FileLoader:Af,Float16BufferAttribute:kf,Float32BufferAttribute:vf,Float64BufferAttribute:yf,FloatType:Ef,Fog:Cf,FogExp2:Mf,FramebufferTexture:Df,FrontSide:ko,Frustum:Pf,GLBufferAttribute:Lf,GLSL1:Bf,GLSL3:Rf,GreaterDepth:If,GreaterEqualDepth:Vf,GreaterEqualStencilFunc:Of,GreaterStencilFunc:Wf,GridHelper:Hf,Group:ia,HalfFloatType:Nf,HemisphereLight:jf,HemisphereLightHelper:Gf,HemisphereLightProbe:Uf,IcosahedronBufferGeometry:Xf,IcosahedronGeometry:zf,ImageBitmapLoader:qf,ImageLoader:Kf,ImageUtils:Jf,IncrementStencilOp:$f,IncrementWrapStencilOp:Yf,InstancedBufferAttribute:Qf,InstancedBufferGeometry:Zf,InstancedInterleavedBuffer:ex,InstancedMesh:tx,Int16BufferAttribute:nx,Int32BufferAttribute:ox,Int8BufferAttribute:rx,IntType:ix,InterleavedBuffer:sx,InterleavedBufferAttribute:ax,Interpolant:lx,InterpolateDiscrete:cx,InterpolateLinear:ux,InterpolateSmooth:px,InvertStencilOp:dx,KeepStencilOp:hx,KeyframeTrack:mx,LOD:gx,LatheBufferGeometry:fx,LatheGeometry:xx,Layers:Fx,LessDepth:wx,LessEqualDepth:Sx,LessEqualStencilFunc:_x,LessStencilFunc:bx,Light:Tx,LightProbe:Ax,Line:kx,Line3:vx,LineBasicMaterial:Eu,LineCurve:yx,LineCurve3:Ex,LineDashedMaterial:Cx,LineLoop:Mx,LineSegments:Dx,LinearEncoding:Px,LinearFilter:Lx,LinearInterpolant:Bx,LinearMipMapLinearFilter:Rx,LinearMipMapNearestFilter:Ix,LinearMipmapLinearFilter:Vx,LinearMipmapNearestFilter:Ox,LinearSRGBColorSpace:Wx,LinearToneMapping:Hx,Loader:Nx,LoaderUtils:jx,LoadingManager:Gx,LoopOnce:Ux,LoopPingPong:Xx,LoopRepeat:zx,LuminanceAlphaFormat:qx,LuminanceFormat:Kx,MOUSE:Jx,Material:$x,MaterialLoader:Yx,MathUtils:Qx,Matrix3:Zx,Matrix4:ft,MaxEquation:eF,Mesh:Nn,MeshBasicMaterial:jn,MeshDepthMaterial:tF,MeshDistanceMaterial:nF,MeshLambertMaterial:oF,MeshMatcapMaterial:rF,MeshNormalMaterial:iF,MeshPhongMaterial:sa,MeshPhysicalMaterial:sF,MeshStandardMaterial:aF,MeshToonMaterial:lF,MinEquation:cF,MirroredRepeatWrapping:uF,MixOperation:pF,MultiplyBlending:dF,MultiplyOperation:hF,NearestFilter:mF,NearestMipMapLinearFilter:gF,NearestMipMapNearestFilter:fF,NearestMipmapLinearFilter:xF,NearestMipmapNearestFilter:FF,NeverDepth:wF,NeverStencilFunc:SF,NoBlending:_F,NoColorSpace:bF,NoToneMapping:TF,NormalAnimationBlendMode:AF,NormalBlending:kF,NotEqualDepth:vF,NotEqualStencilFunc:yF,NumberKeyframeTrack:EF,Object3D:lt,ObjectLoader:CF,ObjectSpaceNormalMap:MF,OctahedronBufferGeometry:DF,OctahedronGeometry:PF,OneFactor:LF,OneMinusDstAlphaFactor:BF,OneMinusDstColorFactor:RF,OneMinusSrcAlphaFactor:IF,OneMinusSrcColorFactor:VF,OrthographicCamera:OF,PCFShadowMap:WF,PCFSoftShadowMap:HF,PMREMGenerator:NF,Path:jF,PerspectiveCamera:aa,Plane:GF,PlaneBufferGeometry:UF,PlaneGeometry:vo,PlaneHelper:XF,PointLight:zF,PointLightHelper:qF,Points:KF,PointsMaterial:JF,PolarGridHelper:$F,PolyhedronBufferGeometry:YF,PolyhedronGeometry:QF,PositionalAudio:ZF,PropertyBinding:ew,PropertyMixer:tw,QuadraticBezierCurve:nw,QuadraticBezierCurve3:ow,Quaternion:rn,QuaternionKeyframeTrack:rw,QuaternionLinearInterpolant:iw,RED_GREEN_RGTC2_Format:sw,RED_RGTC1_Format:aw,REVISION:lw,RGBADepthPacking:cw,RGBAFormat:uw,RGBAIntegerFormat:pw,RGBA_ASTC_10x10_Format:dw,RGBA_ASTC_10x5_Format:hw,RGBA_ASTC_10x6_Format:mw,RGBA_ASTC_10x8_Format:gw,RGBA_ASTC_12x10_Format:fw,RGBA_ASTC_12x12_Format:xw,RGBA_ASTC_4x4_Format:Fw,RGBA_ASTC_5x4_Format:ww,RGBA_ASTC_5x5_Format:Sw,RGBA_ASTC_6x5_Format:_w,RGBA_ASTC_6x6_Format:bw,RGBA_ASTC_8x5_Format:Tw,RGBA_ASTC_8x6_Format:Aw,RGBA_ASTC_8x8_Format:kw,RGBA_BPTC_Format:vw,RGBA_ETC2_EAC_Format:yw,RGBA_PVRTC_2BPPV1_Format:Ew,RGBA_PVRTC_4BPPV1_Format:Cw,RGBA_S3TC_DXT1_Format:Mw,RGBA_S3TC_DXT3_Format:Dw,RGBA_S3TC_DXT5_Format:Pw,RGB_ETC1_Format:Lw,RGB_ETC2_Format:Bw,RGB_PVRTC_2BPPV1_Format:Rw,RGB_PVRTC_4BPPV1_Format:Iw,RGB_S3TC_DXT1_Format:Vw,RGFormat:Ow,RGIntegerFormat:Ww,RawShaderMaterial:Hw,Ray:Nw,Raycaster:jw,RectAreaLight:Gw,RedFormat:Uw,RedIntegerFormat:Xw,ReinhardToneMapping:zw,RepeatWrapping:qw,ReplaceStencilOp:Kw,ReverseSubtractEquation:Jw,RingBufferGeometry:$w,RingGeometry:Yw,SIGNED_RED_GREEN_RGTC2_Format:Qw,SIGNED_RED_RGTC1_Format:Zw,SRGBColorSpace:eS,Scene:ei,ShaderChunk:tS,ShaderLib:Gn,ShaderMaterial:la,ShadowMaterial:nS,Shape:oS,ShapeBufferGeometry:rS,ShapeGeometry:iS,ShapePath:sS,ShapeUtils:aS,ShortType:lS,Skeleton:cS,SkeletonHelper:uS,SkinnedMesh:pS,Source:dS,Sphere:hS,SphereBufferGeometry:mS,SphereGeometry:gS,Spherical:fS,SphericalHarmonics3:xS,SplineCurve:FS,SpotLight:wS,SpotLightHelper:SS,Sprite:_S,SpriteMaterial:Cu,SrcAlphaFactor:bS,SrcAlphaSaturateFactor:TS,SrcColorFactor:AS,StaticCopyUsage:kS,StaticDrawUsage:vS,StaticReadUsage:yS,StereoCamera:ES,StreamCopyUsage:CS,StreamDrawUsage:MS,StreamReadUsage:DS,StringKeyframeTrack:PS,SubtractEquation:LS,SubtractiveBlending:BS,TOUCH:RS,TangentSpaceNormalMap:IS,TetrahedronBufferGeometry:VS,TetrahedronGeometry:OS,Texture:yo,TextureLoader:WS,TorusBufferGeometry:HS,TorusGeometry:NS,TorusKnotBufferGeometry:jS,TorusKnotGeometry:GS,Triangle:US,TriangleFanDrawMode:XS,TriangleStripDrawMode:zS,TrianglesDrawMode:qS,TubeBufferGeometry:KS,TubeGeometry:JS,TwoPassDoubleSide:$S,UVMapping:YS,Uint16BufferAttribute:QS,Uint32BufferAttribute:ZS,Uint8BufferAttribute:e_,Uint8ClampedBufferAttribute:t_,Uniform:n_,UniformsGroup:o_,UniformsLib:Un,UniformsUtils:ti,UnsignedByteType:r_,UnsignedInt248Type:i_,UnsignedIntType:s_,UnsignedShort4444Type:a_,UnsignedShort5551Type:l_,UnsignedShortType:c_,VSMShadowMap:u_,Vector2:ca,Vector3:tt,Vector4:ua,VectorKeyframeTrack:p_,VideoTexture:pa,WebGL1Renderer:d_,WebGL3DRenderTarget:h_,WebGLArrayRenderTarget:m_,WebGLCubeRenderTarget:Mu,WebGLMultipleRenderTargets:g_,WebGLRenderTarget:f_,WebGLRenderer:da,WebGLUtils:x_,WireframeGeometry:F_,WrapAroundEnding:w_,ZeroCurvatureEnding:S_,ZeroFactor:__,ZeroSlopeEnding:b_,ZeroStencilOp:T_,_SRGBAFormat:A_,sRGBEncoding:k_}=THREE;function $t(o){return $(o)&&o.isMesh}function ni(o){return $(o)&&o.isMaterial}function Du(o,t){return ni(t)&&t.type===o}function ha(o){return Du("MeshBasicMaterial",o)}function ma(o){return $(o)&&o.isObject3D}function Xn(o){return $(o)&&ma(o.object)}function sn(o){return Xn(o)?o.object:o}function oi(o,t){return o=sn(o),o.visible=t,t}function ri(o){if(!o)return!1;for(o=sn(o);o;){if(!o.visible)return!1;o=o.parent}return!0}function ye(o,...t){let e=t.filter($).map(sn);return e.length>0&&sn(o).add(...e),o}function Eo(o,...t){let e=new lt;return e.name=o,ye(e,...t),e}function Co(o,t,e){let n=new Nn(t,e);return n.name=o,n}var wn=kt("Juniper:ScaledItems",()=>new Map),ga=1,Pu=1.1;var ii=class{constructor(t){this.target=t;this.obj=sn(this.target),this.base=this.obj.scale.clone(),this.p=0,this.dir=0,this.running=!1,this.wasDisabled=this.disabled,this.target.addScopedEventListener(this,"enter",e=>{e.pointer.type!=="nose"&&this.run(1)}),this.target.addScopedEventListener(this,"exit",e=>{e.pointer.type!=="nose"&&this.run(-1)}),this.obj.traverse(e=>{$t(e)&&this.target.addMesh(e)})}get disabled(){return this.target.disabled}run(t){(!this.disabled||t===-1||this.p>0)&&(this.dir=t,this.running=!0)}updateScaling(t){if(this.disabled!==this.wasDisabled&&(this.wasDisabled=this.disabled,this.disabled&&this.run(-1)),this.running){this.p+=this.dir*t,(this.dir>0&&this.p>=1||this.dir<0&&this.p<0)&&(this.p=Math.max(0,Math.min(1,this.p)),this.running=!1);let e=ea(this.p,1.1);this.obj.scale.copy(this.base).multiplyScalar(e*(Pu-ga)+ga)}}dispose(){this.target.removeScope(this)}};function fa(o){let t=wn.get(o);t&&(wn.delete(o),at(t))}function xa(o,t){let e=wn.has(o);if(t!=e)if(t)wn.set(o,new ii(o));else{let n=wn.get(o);at(n),wn.delete(o)}}function it(o){let t=new Array,e=new Set;for(t.push(o);t.length>0;){let n=t.shift();n&&!e.has(n)&&(e.add(n),n.isMesh&&t.push(n.material,n.geometry),n.isMaterial&&t.push(...Object.values(n)),n.isObject3D&&(t.push(...n.children),n.clear(),fa(n)),Tt(n)&&t.push(...n),nn(n))}e.clear()}var si=class extends rt{constructor(e,n){super("itemevicted");this.key=e;this.value=n}},Mo=class extends Ve{constructor(e){super();this.size=e;this.map=new Map;this.usage=new Array;this.removed=new Map}set(e,n){for(this.usage.push(e);this.usage.length>this.size;){let r=this.usage.shift();$(r)&&(this.removed.set(r,this.map.get(r)),this.map.delete(r))}this.removed.delete(e);for(let[r,a]of this.removed)this.dispatchEvent(new si(r,a));return this.removed.clear(),this.map.set(e,n)}has(e){return this.map.has(e)}get(e){return this.map.get(e)}delete(e){return this.map.has(e)?(Ut(this.usage,e),this.map.delete(e)):!1}clear(){Xe(this.usage),this.map.clear()}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}};function Wt(o,t,e){let n=t.map(()=>1),r=mt(o,n);return Promise.all(t.map(async(a,d)=>{let S=r[d];S.start();let b=await e(a,S,d);return S.end(),b}))}var Fb=new tt(0,1,0),Lu=2048,wb=Lu/2;var Fa={rows:3,columns:4,indices:[[-1,2,-1,-1],[0,5,1,4],[-1,3,-1,-1]],rotations:[[0,It,0,0],[0,0,0,0],[0,It,0,0]]},Sb=new Zr(0);var zn=2,Sn=2048,_n=new ra;var Bu=new Map([[90,4],[60,8],[45,3],[30,2]]),wa=[[Kt,0,0,1],[-Kt,0,2,1],[0,Kt,1,0],[0,-Kt,1,2],[It,0,3,1],[0,0,1,1]],Do=class{constructor(t,e){this.fetcher=t;this.fixWatermarks=e;this.baseURL=null;this.isDebug=!1;this.disposed=!1;this.canvas=en(Sn,Sn),this.renderer=new da({canvas:this.canvas,alpha:!1,antialias:!1,depth:!0,logarithmicDepthBuffer:!1,powerPreference:"low-power",precision:"lowp",stencil:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1}),this.camera=new aa(90),this.photosphere=new ia,this.scene=ye(new ei,new ta(16777215,1),this.camera,this.photosphere),this.geometry=new vo(1,1,1,1)}init(t,e){this.baseURL=t,this.isDebug=e}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){for(let t of this.scene.children)it(t);at(this.renderer)}async renderFaces(t,e,n){this.clear(),await this.loadFrames(e,n,t);let r=await Promise.all(wa.map(async([a,d,S,b])=>{let m=Fa.rotations[b][S];_n.set(d,a,m,"YXZ"),this.camera.setRotationFromEuler(_n),this.renderer.render(this.scene,this.camera);let A=await Dr(this.renderer.domElement,Ar.value,1);return URL.createObjectURL(A)}));return this.clear(),r}async renderCubeMap(t,e,n){this.clear();let r=en(Sn*4,Sn*3),a=r.getContext("2d",{alpha:!1});await this.loadFrames(e,n,t);for(let[b,m,A,C]of wa)_n.set(m,b,0,"YXZ"),this.camera.setRotationFromEuler(_n),this.renderer.render(this.scene,this.camera),a.drawImage(this.renderer.domElement,A*Sn,C*Sn);let d=await Dr(r,Ar.value,1),S=URL.createObjectURL(d);return this.clear(),S}getImageAngles(t){let e=new Array,n=t,r=this.fixWatermarks?Bu.get(n):0;for(let a=-90+n;a<90;a+=n)for(let d=-180;d<180;d+=n)e.push([d,a,n+r,zn]);return e.push([0,-90,n+r,zn]),e.push([0,90,n+r,zn]),this.fixWatermarks&&(e.push([0,-90,n,.5*zn]),e.push([0,90,n,.5*zn])),e}async loadFrames(t,e,n){let r=this.getImageAngles(t);await Wt(e,r,(a,d)=>this.loadFrame(n,...a,d))}async loadFrame(t,e,n,r,a,d){let S=.5*Vt(r),b=Math.tan(S),m=.5*a/b,A=t(r,e,n),C=await this.fetcher.get(A,this.baseURL).progress(d).useCache(!this.isDebug).canvas().then(Ne),_=new yo(C),F=new jn({map:_,side:oa}),i=Co(`frame-${r}-${e}-${n}`,this.geometry,F);_.needsUpdate=!0,F.needsUpdate=!0,_n.set(Vt(n),-Vt(e),0,"YXZ"),i.scale.setScalar(a),i.quaternion.setFromEuler(_n),i.position.set(0,0,-m).applyQuaternion(i.quaternion),ye(this.photosphere,i)}clear(){for(let t of this.photosphere.children)it(t);this.photosphere.clear()}};var st=class{constructor(t){this.items=new Map;this.defaultItems=new Array;if($(t))for(let[e,n]of t)this.add(e,n)}add(t,...e){for(let n of e)if(Se(t))this.defaultItems.push(n);else{let r=this.items.get(t);Se(r)&&this.items.set(t,r=[]),r.push(n)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let t of this.defaultItems)yield t;for(let t of this.items.values())for(let e of t)yield e}has(t){return $(t)?this.items.has(t):this.defaultItems.length>0}get(t){return Se(t)?this.defaultItems:this.items.get(t)||[]}count(t){if(Se(t))return this.defaultItems.length;let e=this.get(t);return $(e)?e.length:0}get size(){let t=this.defaultItems.length;for(let e of this.items.values())t+=e.length;return t}delete(t){return Se(t)?Xe(this.defaultItems).length>0:this.items.delete(t)}remove(t,e){if(Se(t))Ut(this.defaultItems,e);else{let n=this.items.get(t);$(n)&&(Ut(n,e),n.length===0&&this.items.delete(t))}}clear(){this.items.clear(),Xe(this.defaultItems)}};var Ht=class{constructor(t){this.items=new Map;if($(t))for(let[e,n,r]of t)this.add(e,n,r)}add(t,e,n){let r=this.items.get(t);return Se(r)&&this.items.set(t,r=new Map),r.set(e,n),this}*entries(){for(let[t,e]of this.items)for(let[n,r]of e)yield[t,n,r]}keys(t){return Se(t)?this.items.keys():this.items.get(t).keys()}*values(){for(let t of this.items.values())for(let e of t.values())yield e}has(t,e){return this.items.has(t)&&(Se(e)||this.items.get(t).has(e))}get(t,e){return Se(e)?this.items.get(t):this.items.has(t)?this.items.get(t).get(e):null}count(t){return this.items.has(t)?this.items.get(t).size:null}get size(){let t=0;for(let e of this.items.values())t+=e.size;return t}delete(t,e){if(Se(e))return this.items.delete(t);if(this.items.has(t)){let n=this.items.get(t),r=n.delete(e);return n.size===0&&this.items.delete(t),r}else return!1}clear(){this.items.clear()}};function yt(...o){return Promise.all(o)}var Po=class extends Ve{constructor(){super();this.event=new rt("quitting");let e=()=>this.dispatchEvent(this.event);window.addEventListener("beforeunload",e),window.addEventListener("unload",e),window.addEventListener("pagehide",e)}};var Ru=298.257223563,Sa=6378137,Iu=.9996,Vu=5e5,Lo=1/Ru,Bo=1-Lo,De=Lo/(2-Lo),Ou=Sa/(1+De)*(1+De*De/4+De*De*De*De/64),qn=Math.sqrt(1-Bo*Bo),ht=1-Bo*Bo,Wu=qn*qn/(1-qn*qn),Hu=1-ht*(.25+ht*(3/64+5*ht/256)),Nu=ht*(3/8+ht*(3/32+45*ht/1024)),ju=ht*ht*(15/256+ht*45/1024),Gu=ht*ht*ht*(35/3072),Uu=[De/2-2*De*De/3+37*De*De*De/96,De*De/48+De*De*De/15,17*De*De*De/480],Xu=[2*De-2*De*De/3,7*De*De/3-8*De*De*De/5,56*De*De*De/15],Re={FalseNorthing:1e7,equatorialRadius:Sa,pointScaleFactor:Iu,E0:Vu,A:Ou,flattening:Lo,e:qn,esq:ht,e0sq:Wu,alpha1:Hu,alpha2:Nu,alpha3:ju,alpha4:Gu,beta:Uu,delta:Xu};var Et=class{static centroid(t){let e=new Map;t.forEach(S=>e.set(S.zone,(e.get(S.zone)||0)+1));let n=0,r=0;for(let[S,b]of e)b>r&&(n=S,r=b);let a=1/t.length,d=t.map(S=>S.rezone(n).toVec3()).reduce((S,b)=>gt.scaleAndAdd(S,S,b,a),gt.create());return new Et().fromVec3(d,n).toLatLng().toUTM()}get easting(){return this._easting}get northing(){return this._northing}get altitude(){return this._altitude}get zone(){return this._zone}get hemisphere(){return this.northing>=0?"northern":"southern"}constructor(t,e,n,r){bt(t)?(this._easting=t.easting,this._northing=t.northing,this._altitude=t.altitude,this._zone=t.zone):(this._easting=t||0,this._northing=e||0,this._altitude=n||0,this._zone=r||0)}toJSON(){return JSON.stringify({easting:this.easting,northing:this.northing,altitude:this.altitude,zone:this.zone,hemisphere:this.hemisphere})}toString(){return`(${this.easting}, ${this.northing}, ${this.altitude}) zone ${this.zone}`}equals(t){return $(t)&&this.hemisphere==t.hemisphere&&this.easting==t.easting&&this.northing==t.northing&&this.altitude==t.altitude&&this.zone==t.zone}static A(t,e,n){let r=3+6*(n-1)-180;return Vt(e-r)*t}static getZoneWidthAtLatitude(t){let e=Vt(t),n=Math.sin(e),r=Math.cos(e),a=n/r,d=Re.e*n,S=Re.equatorialRadius/Math.sqrt(1-d*d),b=a*a,m=Re.e0sq*r*r,A=b*b,C=Vt(3)*r,_=C*C,F=1-b+m,i=5-18*b+A+72*m-58*Re.e0sq,l=F/6+_*i/120,s=1+_*l;return 2*Re.pointScaleFactor*S*C*s}fromLatLng(t){let e=Vt(t.lat),n=Math.sin(e),r=Math.cos(e),a=2*r,d=a*n,S=a*r-1,b=2*S,m=b*d,A=b*S-1,C=m*S+A*d,_=n/r,F=Re.e*n,i=Re.equatorialRadius/Math.sqrt(1-F*F),l=Re.equatorialRadius*(e*Re.alpha1-d*Re.alpha2+m*Re.alpha3-C*Re.alpha4),s=1+(t.lng+180)/6|0,v=Et.A(r,t.lng,s),k=v*v,y=_*_,h=Re.e0sq*r*r,c=y*y,u=1-y+h,f=5-18*y+c+72*h-58*Re.e0sq,M=k*f/120,E=u/6+M,w=1+k*E,P=Re.pointScaleFactor*i*v*w+Re.E0,ne=5-y+9*h+4*h*h,ie=61-58*y+c+600*h-330*Re.e0sq,Z=ne/24+k*ie/720,Y=.5+k*Z,j=l+i*_*k*Y,U=Re.pointScaleFactor*j;return this._easting=P,this._northing=U,this._altitude=t.alt,this._zone=s,this}rezone(t){if(!(1<=t&&t<=60))throw new Error(`Zones must be on the range [1, 60]. Given: ${t}`);if(t!==this.zone){let e=t-this.zone,n=this.toLatLng(),r=Et.getZoneWidthAtLatitude(n.lat);return new Et(this.easting-r*e,this.northing,this.altitude,t)}else return this}toLatLng(){return new Ye().fromUTM(this)}toVec2(){let t=qt.create();return qt.set(t,this.easting,-this.northing),t}fromVec2(t,e){return this._easting=t[0],this._northing=-t[1],this._altitude=0,this._zone=e,this}toVec3(){let t=gt.create();return gt.set(t,this.easting,this.altitude,-this.northing),t}fromVec3(t,e){return this._easting=t[0],this._altitude=t[1],this._northing=-t[2],this._zone=e,this}copy(t){return this._easting=t.easting,this._northing=t.northing,this._altitude=t.altitude,this._zone=t.zone,this}clone(){return new Et(this)}};var Ye=class{static centroid(t){let e=1/t.length,n=t.map(r=>r.toVec3()).reduce((r,a)=>gt.scaleAndAdd(r,r,a,e),gt.create());return new Ye().fromVec3(n)}get alt(){return this._alt}get lat(){return this._lat}get lng(){return this._lng}constructor(t,e,n){bt(t)?(this._lat=t.lat,this._lng=t.lng,this._alt=t.alt):(this._lat=t||0,this._lng=e||0,this._alt=n)}toJSON(){return JSON.stringify({lat:this.lat,lng:this.lng,alt:this.alt})}static parseDMS(t){let e=t.split(" ");if(e.length==3){let n=e[0],r=parseInt(e[1],10),a=parseFloat(e[2]);if((n=="N"||n=="S"||n=="E"||n=="W")&&Number.isInteger(r)&&Number.isFinite(a)){let d=r+a/60;return(n=="S"||n=="W")&&(d*=-1),d}}return Number.NaN}static parseDMSPair(t){let e=t.split(",");if(e.length==2){let n=Ye.parseDMS(e[0]),r=Ye.parseDMS(e[1]);if(!Number.isNaN(n)&&!Number.isNaN(r))return new Ye(n,r)}return null}static parseDecimal(t){let e=t.split(",");if(e.length==2){let n=parseFloat(e[0].trim()),r=parseFloat(e[1].trim());if(Number.isFinite(n)&&Number.isFinite(r))return new Ye(n,r)}return null}static parse(t){let e=Ye.parseDecimal(t),n=Ye.parseDMSPair(t);return e||n}toDMS(t,e=!0){let n=Ye.toDMS(this.lat,"S","N",t),r=Ye.toDMS(this.lng,"W","E",t);if(this.alt&&e){let a=`${this.alt.toFixed(t)}m`;return`<${n}, ${r}> alt ${a}`}else return`<${n}, ${r}>`}toDMSArray(t,e=!1){let n=[Ye.toDMS(this.lat,"S","N",t),Ye.toDMS(this.lng,"W","E",t)];return this.alt&&e&&n.push(`${this.alt.toFixed(t)}m`),n}static toDMS(t,e,n,r){let a=t<0?e:n;t=Math.abs(t);let d=Math.floor(t),S=(t-d)*60,b=Math.floor(S),A=((S-b)*60).toFixed(r);for(;A.indexOf(".")<=1;)A=`0${A}`;return`${a} ${d.toFixed(0)}\xB0 ${b.toFixed(0)}' ${A}"`}toString(t){return t=t||6,`(${this.lat.toFixed(t)}\xB0, ${this.lng.toFixed(t)}\xB0)`}equals(t){return bt(t)&&this.lat==t.lat&&this.lng==t.lng&&this.alt==t.alt}compareTo(t){if(Se(t))return-1;{let e=this.lat-t.lat,n=this.lng-t.lng,r=(this.alt||0)-(t.alt||0);return e==0&&n==0?r:e==0?n:e}}distance(t){let e=this.toUTM(),n=t.toUTM().rezone(e.zone),r=n.easting-e.easting,a=n.northing-e.northing;return Math.sqrt(r*r+a*a)}fromUTM(t){let e=t.hemisphere==="southern"&&t.northing>=0?Re.FalseNorthing:0,n=(t.northing-e)/(Re.pointScaleFactor*Re.A),r=(t.easting-Re.E0)/(Re.pointScaleFactor*Re.A),a=n,d=r;for(let C=1;C<=3;++C){let _=Re.beta[C-1],F=2*C*n,i=2*C*r,l=Math.sin(F),s=Math.cosh(i),v=Math.cos(F),k=Math.sinh(i);a-=_*l*s,d-=_*v*k}let S=Math.asin(Math.sin(a)/Math.cosh(d)),b=S;for(let C=1;C<=3;++C)b+=Re.delta[C-1]*Math.sin(2*C*S);let m=t.zone*6-183,A=Math.atan(Math.sinh(d)/Math.cos(a));for(this._lat=$e(b),this._lng=m+$e(A);this._lng<-180;)this._lng+=360;for(;this._lng>180;)this._lng-=360;return this._alt=t.altitude,this}toUTM(){return new Et().fromLatLng(this)}toVec2(){let t=qt.create();return qt.set(t,this.lng,this.lat),t}fromVec2(t){return this._lng=t[0],this._lat=t[1],this._alt=void 0,this}toVec3(){let t=gt.create();return gt.set(t,this.lng,this.alt,this.lat),t}fromVec3(t){return this._lng=t[0],this._alt=t[1],this._lat=t[2],this}toArray(){return[this._lng,this._alt,this._lat]}fromArray(t){return this.fromVec3(t)}copy(t){return this._lat=t.lat,this._lng=t.lng,this._alt=t.alt,this}clone(){return new Ye(this)}};async function Ro(o,t){let e=new Array(t.length),n=new Array(t.length);for(let d=0;d<t.length;++d){let S=t[d];e[d]=S[0],n[d]=S[1]}let r=mt(o,e),a=new Array(t.length);for(let d=0;d<t.length;++d)a[d]=n[d](r[d]);return await Promise.all(a)}function ai(o){return o.hostname==="www.youtube.com"||o.hostname==="youtube.com"||o.hostname==="youtu.be"}var zu=new Map([["vp9","vp09.00.10.08"]]);function qu(o){return Se(o.vcodec)||o.vcodec==="none"?"audio":"video"}function _a(o,t){let e=[o];if($(t)&&t.length>0&&t!=="none"&&(t=zu.get(t)||t),$(t)&&t.length>0&&t!=="none"){let n=encodeURI(t)!==t?"*":"";e.push(`codecs${n}="${t}"`)}return e.join(";")}var Io=class{constructor(t,e){this.fetcher=t;this.makeProxyURL=e}makeVideoRecord(t){let{content_type:e,acodec:n,vcodec:r}=t;return{contentType:_a(e,r),url:this.makeProxyURL(t.url).href,acodec:n,abr:t.abr*1024,asr:t.asr,vcodec:r,vbr:t.vbr*1024,fps:t.fps,width:t.width,height:t.height,resolution:t.width*t.height}}makeAudioRecord(t){let{content_type:e,acodec:n}=t;return{contentType:_a(e,n),url:this.makeProxyURL(t.url).href,acodec:n,abr:t.abr*1024,asr:t.asr,resolution:t.abr}}makeImageRecord(t){let{content_type:e,url:n,width:r,height:a}=t;return{contentType:e,url:this.makeProxyURL(n).href,width:r,height:a,resolution:r*a}}async loadData(t,e){if(Se(t))throw new Error("must provide a YouTube URL or a YTMetadata object");$(e)&&e.start();let n=null;Pe(t)?n=await this.fetcher.get(t).progress(e).object().then(Ne):($(e)&&e.end(t.title),n=t);let r=0;if($(n.original_url)){let _=new URL(n.original_url);ai(_)&&_.searchParams.has("t")&&(r=parseFloat(_.searchParams.get("t")))}let a=new st((await Promise.all(n.formats)).map(_=>[qu(_),_])),d=n.title,S=n.thumbnails||[],b=n.thumbnail&&this.makeImageRecord(Pt(S,_=>_.url===n.thumbnail)),m=a.get("video").map(_=>this.makeVideoRecord(_)),A=a.get("audio").map(_=>this.makeAudioRecord(_));return{title:d,thumbnail:b,videos:m,audios:A,startTime:r}}};var g1=kt("juniper::loadedFonts",()=>[]);function ba(o){let t=[];return o.fontStyle&&o.fontStyle!=="normal"&&t.push(o.fontStyle),o.fontVariant&&o.fontVariant!=="normal"&&t.push(o.fontVariant),o.fontWeight&&o.fontWeight!=="normal"&&t.push(o.fontWeight),t.push(zi(o.fontSize)),t.push(o.fontFamily),t.join(" ")}var Ku="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function Vo(o,t){if(o<0)throw new Error("Length must be greater than 0");Se(t)&&(t=Ku);let e="";for(let n=0;n<o;++n){let r=Math.floor(Math.random()*t.length);e+=t[r]}return e}var Ta="3.7.24";var Aa=new URL(globalThis.location.href),Kn=Aa.searchParams.has("DEBUG")&&!Aa.searchParams.has("RELEASE");var $u=Kn?Vo(10):Ta;var Yu=50,Qu=12,V1=Yu*Qu;var ka={fontFamily:"Lato",fontSize:20};var Oo=uo(30,67,136),O1=uo(78,77,77),va={fontFamily:ka.fontFamily,fontSize:ka.fontSize,textFillColor:"white"},ya=Object.assign({},va,{bgFillColor:uo(0,120,215),bgStrokeColor:"black",bgStrokeSize:.02,padding:{top:.025,left:.05,bottom:.025,right:.05},minHeight:.2,maxHeight:.2,scale:300}),W1=Object.assign({},va,{textStrokeColor:"black",textStrokeSize:.01,minHeight:.25,maxHeight:.25});var Zu=Kn?".js":".min.js";function ep(o,t){return`/js/${t}/index${o}?v=${$u}`}function Wo(o){return ep(Zu,o)}function Ea(o){return Wo("workers/"+o)}function Ca(o){return Wo("libs/"+o)}var Qe=class{constructor(t,e,n=null){this.value=t;this.desc=e;this.value=t,this.desc=e,this.props=n||{}}contains(t){return t instanceof Qe?this.contains(t.value):this.value.indexOf(t)>=0}changeStyle(t,e){let n=this.value;return n.endsWith(t)&&(n=n.substring(0,n.length-t.length)),n+=e,n}get textStyle(){return this.changeStyle("\uFE0F","\uFE0E")}get emojiStyle(){return this.changeStyle("\uFE0E","\uFE0F")}};var bn=class extends Qe{constructor(e,n,...r){super(e,n);this.width=null;this.alts=r}random(){let e=Math.floor(Math.random()*this.alts.length);if(e<0)return null;let n=this.alts[e];return n instanceof bn?n.random():n}contains(e){if(super.contains(e))return!0;for(let n of this.alts)if(n.contains(e))return!0;return!1}};var Ma=new Qe("\u2B06\uFE0E","Up Arrow: Text");var Da=new Qe("0\uFE0F\u20E3","Keycap Digit Zero"),Pa=new Qe("1\uFE0F\u20E3","Keycap Digit One"),La=new Qe("2\uFE0F\u20E3","Keycap Digit Two"),Ba=new Qe("3\uFE0F\u20E3","Keycap Digit Three"),Ra=new Qe("4\uFE0F\u20E3","Keycap Digit Four"),Ia=new Qe("5\uFE0F\u20E3","Keycap Digit Five"),Va=new Qe("6\uFE0F\u20E3","Keycap Digit Six"),Oa=new Qe("7\uFE0F\u20E3","Keycap Digit Seven"),Wa=new Qe("8\uFE0F\u20E3","Keycap Digit Eight"),Ha=new Qe("9\uFE0F\u20E3","Keycap Digit Nine");var Na=new Qe("\u{1F51F}","Keycap: 10");var ja=new bn("Keycap Digits","Keycap Digits",Da,Pa,La,Ba,Ra,Ia,Va,Oa,Wa,Ha,Na);function Ga(o){let t=o.attributes.position,e=o.attributes.normal,n=o.attributes.uv;for(let r=0;r<e.count;++r){let a=r*e.itemSize,d=r*e.itemSize+1,S=r*e.itemSize+2,b=e.array[a],m=e.array[d],A=e.array[S],C=Math.abs(b),_=Math.abs(m),F=Math.abs(A),i=t.array[a],l=t.array[d],s=t.array[S],v=Math.abs(i),k=Math.abs(l),y=Math.abs(s),h=r*n.itemSize,c=r*n.itemSize+1,u=n.array[h],f=n.array[c],M=0,E=C,w=v;_>E&&(M=1,E=_,w=k),F>E&&(M=2,E=F,w=y),M===0?i<0?(u=-s,f=l):(u=s,f=l):M===1?l<0?(u=i,f=-s):(u=i,f=s):s<0?(u=i,f=l):(u=-i,f=l),u=(u/w+1)/8,f=(f/w+1)/6,M===0?i<0?(u+=0,f+=1/3):(u+=.5,f+=1/3):M===1?l<0?(u+=.25,f+=0):(u+=.25,f+=2/3):s<0?(u+=.25,f+=1/3):(u+=.75,f+=1/3);let P=n.array;P[h]=u,P[c]=f}}var Jn=new na(1,1,1,1,1,1);Jn.name="CubeGeom";Jn.computeBoundingBox();Jn.computeBoundingSphere();var Ua=Jn.clone();Ua.name="InvertedCubeGeom";Ga(Ua);var Tn=class extends Nn{constructor(t,e,n,r){super(Jn,r),this.scale.set(t,e,n)}};Un.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new ca(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};Gn.line={uniforms:ti.merge([Un.common,Un.fog,Un.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var Ho=class extends la{constructor(t){super({type:"LineMaterial",uniforms:ti.clone(Gn.line.uniforms),vertexShader:Gn.line.vertexShader,fragmentShader:Gn.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(e){!!e!="USE_DASH"in this.defines&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(e){!!e!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(t)}};Ho.prototype.isLineMaterial=!0;var li=kt("Juniper:Three:Materials",()=>new Map);function tp(o,t){t in o&&delete o[t]}function Xa(o,t,e){let n=`${o}_${Object.keys(e).map(r=>`${r}:${e[r]}`).join(",")}`;return li.has(n)||(tp(e,"name"),li.set(n,new t(e))),li.get(n)}function np(o){return Object.assign(o,{transparent:!0})}function op(o){return Xa("solid",jn,o)}function za(o){return Xa("solidTransparent",jn,np(o))}function qa(o,t){let e=new Set;o.traverse(n=>{if($t(n)&&ni(n.material)){let r=n.material,a=t(r);r!==a&&(e.add(r),n.material=a)}});for(let n of e)nn(n)}function Ka(o){if(o.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let t={alphaMap:o.alphaMap,alphaTest:o.alphaTest,alphaToCoverage:o.alphaToCoverage,aoMap:o.aoMap,aoMapIntensity:o.aoMapIntensity,blendDst:o.blendDst,blendDstAlpha:o.blendDstAlpha,blendEquation:o.blendEquation,blendEquationAlpha:o.blendEquationAlpha,blending:o.blending,blendSrc:o.blendSrc,blendSrcAlpha:o.blendSrcAlpha,bumpMap:o.bumpMap,bumpScale:o.bumpScale,clipIntersection:o.clipIntersection,clippingPlanes:o.clippingPlanes,clipShadows:o.clipShadows,color:o.color,colorWrite:o.colorWrite,depthFunc:o.depthFunc,depthTest:o.depthTest,depthWrite:o.depthWrite,displacementBias:o.displacementBias,displacementMap:o.displacementMap,displacementScale:o.displacementScale,dithering:o.dithering,emissive:o.emissive,emissiveIntensity:o.emissiveIntensity,emissiveMap:o.emissiveMap,envMap:o.envMap,flatShading:o.flatShading,fog:o.fog,lightMap:o.lightMap,lightMapIntensity:o.lightMapIntensity,map:o.map,name:o.name+"-Standard-To-Phong",normalMap:o.normalMap,normalMapType:o.normalMapType,normalScale:o.normalScale,opacity:o.opacity,polygonOffset:o.polygonOffset,polygonOffsetFactor:o.polygonOffsetFactor,polygonOffsetUnits:o.polygonOffsetUnits,precision:o.precision,premultipliedAlpha:o.premultipliedAlpha,shadowSide:o.shadowSide,side:o.side,stencilFail:o.stencilFail,stencilFunc:o.stencilFunc,stencilFuncMask:o.stencilFuncMask,stencilRef:o.stencilRef,stencilWrite:o.stencilWrite,stencilWriteMask:o.stencilWriteMask,stencilZFail:o.stencilZFail,stencilZPass:o.stencilZPass,toneMapped:o.toneMapped,transparent:o.transparent,userData:o.userData,vertexColors:o.vertexColors,visible:o.visible,wireframe:o.wireframe,wireframeLinecap:o.wireframeLinecap,wireframeLinejoin:o.wireframeLinejoin,wireframeLinewidth:o.wireframeLinewidth};for(let[e,n]of Object.entries(t))Se(n)&&delete t[e];return new sa(t)}var rp=16777215;var No=op({color:rp});var an=class extends xn{constructor(e){super(10,10,e);this.trueWidth=null;this.trueHeight=null;this.trueFontSize=null;this.dx=null;this._minWidth=null;this._maxWidth=null;this._minHeight=null;this._maxHeight=null;this._freezeDimensions=!1;this._dimensionsFrozen=!1;this._bgFillColor=null;this._bgStrokeColor=null;this._bgStrokeSize=null;this._textStrokeColor=null;this._textStrokeSize=null;this._textFillColor="black";this._textDirection="horizontal";this._fontStyle="normal";this._fontVariant="normal";this._fontWeight="normal";this._fontFamily="sans-serif";this._fontSize=20;this._value=null;this.lastValue=null;$(e)&&($(e.minWidth)&&(this._minWidth=e.minWidth),$(e.maxWidth)&&(this._maxWidth=e.maxWidth),$(e.minHeight)&&(this._minHeight=e.minHeight),$(e.maxHeight)&&(this._maxHeight=e.maxHeight),$(e.freezeDimensions)&&(this._freezeDimensions=e.freezeDimensions),$(e.textStrokeColor)&&(this._textStrokeColor=e.textStrokeColor),$(e.textStrokeSize)&&(this._textStrokeSize=e.textStrokeSize),$(e.bgFillColor)&&(this._bgFillColor=e.bgFillColor),$(e.bgStrokeColor)&&(this._bgStrokeColor=e.bgStrokeColor),$(e.bgStrokeSize)&&(this._bgStrokeSize=e.bgStrokeSize),$(e.value)&&(this._value=e.value),$(e.textFillColor)&&(this._textFillColor=e.textFillColor),$(e.textDirection)&&(this._textDirection=e.textDirection),$(e.fontStyle)&&(this._fontStyle=e.fontStyle),$(e.fontVariant)&&(this._fontVariant=e.fontVariant),$(e.fontWeight)&&(this._fontWeight=e.fontWeight),$(e.fontFamily)&&(this._fontFamily=e.fontFamily),$(e.fontSize)&&(this._fontSize=e.fontSize),$(e.padding)&&(ot(e.padding)?this._padding={left:e.padding,right:e.padding,top:e.padding,bottom:e.padding}:this._padding=e.padding)),Se(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(e){this.minWidth!==e&&(this._minWidth=e,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(e){this.maxWidth!==e&&(this._maxWidth=e,this.redraw())}get minHeight(){return this._minHeight}set minHeight(e){this.minHeight!==e&&(this._minHeight=e,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(e){this.maxHeight!==e&&(this._maxHeight=e,this.redraw())}get padding(){return this._padding}set padding(e){if(e instanceof Array)throw new Error("Invalid padding");(this.padding.top!==e.top||this.padding.right!=e.right||this.padding.bottom!=e.bottom||this.padding.left!=e.left)&&(this._padding=e,this.redraw())}get textDirection(){return this._textDirection}set textDirection(e){this.textDirection!==e&&(this._textDirection=e,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(e){this.fontStyle!==e&&(this._fontStyle=e,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(e){this.fontVariant!==e&&(this._fontVariant=e,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(e){this.fontWeight!==e&&(this._fontWeight=e,this.redraw())}get fontSize(){return this._fontSize}set fontSize(e){this.fontSize!==e&&(this._fontSize=e,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(e){this.textFillColor!==e&&(this._textFillColor=e,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(e){this.textStrokeColor!==e&&(this._textStrokeColor=e,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(e){this.textStrokeSize!==e&&(this._textStrokeSize=e,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(e){this.bgFillColor!==e&&(this._bgFillColor=e,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(e){this.bgStrokeColor!==e&&(this._bgStrokeColor=e,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(e){this.bgStrokeSize!==e&&(this._bgStrokeSize=e,this.redraw())}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.redraw())}split(e){return e.replace(/\r\n/g,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.onClear(),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value&&this.value!==this.lastValue){let e=this.split(this.value),n=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let a=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,d=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,S=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,b=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,m=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,A=n?b:d,C=n?m:S,_=n?d:b,F=n?S:m,i=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let l=!1,s=!1,v=1e4,k=0;this.trueFontSize=Jt(this.fontSize*this.scale,k,v);let y=null,h=Number.MAX_VALUE;do{let f=this.fontSize;this._fontSize=this.trueFontSize;let M=ba(this);this._fontSize=f,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=M,this.trueWidth=0,this.trueHeight=0;for(let E of e){let w=this.g.measureText(E);this.trueWidth=Math.max(this.trueWidth,w.width),this.trueHeight+=this.trueFontSize,ot(w.actualBoundingBoxLeft)&&ot(w.actualBoundingBoxRight)&&ot(w.actualBoundingBoxAscent)&&ot(w.actualBoundingBoxDescent)&&(a||(this.trueWidth=w.actualBoundingBoxLeft+w.actualBoundingBoxRight,this.trueHeight=w.actualBoundingBoxAscent+w.actualBoundingBoxDescent,this.dx=(w.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(a){let E=this.trueWidth-A,w=this.trueWidth-C,P=this.trueHeight-_,ne=this.trueHeight-F,ie=Math.abs(E),Z=Math.abs(w),Y=Math.abs(P),j=Math.abs(ne);l=w>1||ne>1,s=E<-1&&P<-1;let U=Math.min(ie,Math.min(Z,Math.min(Y,j)));U<h&&(h=U,y=this.g.font),(l||s)&&i.indexOf(this.g.font)>-1&&y&&(this.g.font=y,l=!1,s=!1),l?(v=this.trueFontSize,this.trueFontSize=(k+this.trueFontSize)/2):s&&(k=this.trueFontSize,this.trueFontSize=(this.trueFontSize+v)/2)}i.push(this.g.font)}while(l||s);a&&(this.trueWidth<A?this.trueWidth=A:this.trueWidth>C&&(this.trueWidth=C),this.trueHeight<_?this.trueHeight=_:this.trueHeight>F&&(this.trueHeight=F));let c=this.trueWidth+this.scale*(this.padding.right+this.padding.left),u=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{Rn(this.g,c,u)}catch(f){throw console.error(f),f}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let r=.5*(e.length-1);for(let a=0;a<e.length;++a){let d=e[a],S=(a-r)*this.trueFontSize,b=this.dx+this.trueWidth/2+this.scale*this.padding.left,m=S+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(d,b,m),this.textFillColor&&this.g.fillText(d,b,m)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let a=this.bgStrokeSize/2;this.g.strokeRect(a,a,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(n){let a=en(this.canvas.height,this.canvas.width),d=a.getContext("2d");d?(d.translate(a.width/2,a.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?d.rotate(Kt):this.textDirection==="vertical-right"&&d.rotate(-Kt),d.translate(-this.canvas.width/2,-this.canvas.height/2),d.drawImage(this.canvas,0,0),Rn(this.g,a.width,a.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(a,0,0)}return this.lastValue=this.value,!0}else{let e=this.value!==this.lastValue;return this.lastValue=this.value,e}}};var Ja=304.79999999999995,GT=Ja*3,ip=10*100,sp=Ja*16.5,ap=sp*40,UT=ip*1e3,XT=ap*8,$a=2.54*4,Ya=$a*3,zT=Ya*3,lp=Ya*16.5,cp=lp*40,qT=100*1e3,KT=cp*8,ci=4*3,up=ci*3,$n=100/2.54,pp=ci*16.5,dp=pp*40,JT=$n*1e3,$T=dp*8,YT=3*3,hp=100/$a,mp=3*16.5,gp=mp*40,QT=hp*1e3,ZT=gp*8,Qa=$n/ci,fp=16.5*40,eA=Qa*1e3,tA=fp*8,xp=$n/up,Fp=16.5/3,wp=Fp*40,nA=xp*1e3,oA=wp*8,Za=16.5/Qa,el=Za*40,rA=el*8,iA=1e3/Za,sA=40*8,Sp=1e3/el,aA=8/Sp;function tl(o){return o/$n}function nl(o){return o*$n}var _p=new ft,jo=new tt,ol=new ua,rl=new rn;function ui(o,t,e){return _p.copy(o.matrixWorld).invert().multiply(t.matrixWorld).decompose(jo,rl,e),ol.set(jo.x,jo.y,jo.z,1),new XRRigidTransform(ol,rl)}var pi=new vo(1,1,1,1);pi.name="PlaneGeom";var An=new tt,bp=0,Yt=class extends lt{constructor(e,n,r,a=null){super();this.webXRLayerType=r;this.lastMatrixWorld=new ft;this._imageWidth=0;this._imageHeight=0;this.forceUpdate=!1;this.wasUsingLayer=!1;this.layer=null;this.curImage=null;this.lastImage=null;this.lastWidth=null;this.lastHeight=null;this.env=null;this.mesh=null;this.stereoLayoutName="mono";this.sizeMode="none";if(e){this.setEnvAndName(e,n);let d=ha(a)?a:za(Object.assign({},a,{name:this.name}));ye(this,this.mesh=Co(n+"-Mesh",pi,d))}}copy(e,n=!0){return super.copy(e,n),this.webXRLayerType=e.webXRLayerType,this.setImageSize(e.imageWidth,e.imageHeight),this.setEnvAndName(e.env,e.name+ ++bp),this.mesh=Pt(this.children,$t),Se(this.mesh)&&(this.mesh=e.mesh.clone(),ye(this,this.mesh)),this.setTextureMap(e.curImage),this}dispose(){this.env.removeScope(this),this.disposeImage(),it(this.mesh)}disposeImage(){this.removeWebXRLayer(),it(this.mesh.material.map),this.curImage=null}setImageSize(e,n){if(e!==this.imageWidth||n!==this.imageHeight){let{objectWidth:r,objectHeight:a}=this;this._imageWidth=e,this._imageHeight=n,this.sizeMode!=="none"&&(this.sizeMode==="fixed-width"?this.objectWidth=r:this.objectHeight=a)}}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get imageAspectRatio(){return this.imageWidth/this.imageHeight}get objectWidth(){return this.scale.x}set objectWidth(e){this.scale.set(e,this.scale.y=e/this.imageAspectRatio,1)}get objectHeight(){return this.scale.y}set objectHeight(e){this.scale.set(this.imageAspectRatio*e,e,1)}get pixelDensity(){let e=nl(this.objectWidth);return this.imageWidth/e}set pixelDensity(e){let n=this.imageWidth/e,r=tl(n);this.objectWidth=r}setEnvAndName(e,n){this.env=e,this.name=n,this.env.addScopedEventListener(this,"update",r=>this.checkWebXRLayer(r.frame))}get needsLayer(){return!ri(this)||Se(this.mesh.material.map)||Se(this.curImage)?!1:this.curImage instanceof HTMLVideoElement?!this.curImage.paused||this.curImage.currentTime>0:!0}removeWebXRLayer(){if($(this.layer)){this.wasUsingLayer=!1,this.env.removeWebXRLayer(this.layer),this.mesh.visible=!0;let e=this.layer;this.layer=null,setTimeout(()=>nn(e),100)}}setTextureMap(e){this.curImage&&this.disposeImage(),e&&(fo(e)?e=ss(e):ns(e)&&(e=as(e)),go(e)&&(e=e),this.curImage=e,e instanceof HTMLVideoElement?(this.setImageSize(e.videoWidth,e.videoHeight),this.mesh.material.map=new pa(e)):(this.setImageSize(e.width,e.height),this.mesh.material.map=new yo(e),this.mesh.material.map.needsUpdate=!0)),this.mesh.material.needsUpdate=!0}get isVideo(){return this.curImage instanceof HTMLVideoElement}updateTexture(){if($(this.curImage)){let e=this.curImage,n=this.isVideo?e.videoWidth:this.curImage.width,r=this.isVideo?e.videoHeight:this.curImage.height;if(this.imageWidth!==n||this.imageHeight!==r){let a=this.curImage;this.disposeImage(),this.setTextureMap(a)}else this.mesh.material.map.needsUpdate=this.forceUpdate=!0}}checkWebXRLayer(e){if(this.mesh.material.map&&this.curImage){let r=this.webXRLayerType!=="none"&&this.env.hasXRCompositionLayers&&this.env.showWebXRLayers&&$(e)&&(this.isVideo&&$(this.env.xrMediaBinding)||!this.isVideo&&$(this.env.xrBinding))&&this.needsLayer,a=r!==this.wasUsingLayer,d=this.curImage!==this.lastImage||this.mesh.material.needsUpdate||this.mesh.material.map.needsUpdate||this.forceUpdate,S=this.imageWidth!==this.lastWidth||this.imageHeight!==this.lastHeight;if(this.wasUsingLayer=r,this.lastImage=this.curImage,this.lastWidth=this.imageWidth,this.lastHeight=this.imageHeight,(a||S)&&((!r||S)&&this.layer&&this.removeWebXRLayer(),r)){let b=this.env.referenceSpace,m=ui(this.env.stage,this.mesh,An);this.lastMatrixWorld.copy(this.matrixWorld);let A=An.x/2,C=An.y/2,_=this.stereoLayoutName==="mono"?"mono":this.stereoLayoutName==="left-right"||this.stereoLayoutName==="right-left"?"stereo-left-right":"stereo-top-bottom";if(this.isVideo){let F=this.stereoLayoutName==="right-left"||this.stereoLayoutName==="bottom-top";this.layer=this.env.xrMediaBinding.createQuadLayer(this.curImage,{space:b,layout:_,invertStereo:F,transform:m,width:A,height:C})}else this.layer=this.env.xrBinding.createQuadLayer({space:b,layout:_,textureType:"texture",isStatic:this.webXRLayerType==="static",viewPixelWidth:this.curImage.width,viewPixelHeight:this.curImage.height,transform:m,width:A,height:C});this.env.addWebXRLayer(this.layer,500),this.mesh.visible=!1}if(this.layer){if(d||this.layer.needsRedraw){let b=this.env.gl,m=this.env.xrBinding.getSubImage(this.layer,e);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!0),b.bindTexture(b.TEXTURE_2D,m.colorTexture),b.texSubImage2D(b.TEXTURE_2D,0,0,0,b.RGBA,b.UNSIGNED_BYTE,this.curImage),b.generateMipmap(b.TEXTURE_2D),b.bindTexture(b.TEXTURE_2D,null),this.forceUpdate=!1}ro(this.matrixWorld.elements,this.lastMatrixWorld.elements)>=0&&(this.layer.transform=ui(this.env.stage,this.mesh,An),this.lastMatrixWorld.copy(this.matrixWorld),this.layer.width=An.x/2,this.layer.height=An.y/2)}else this.forceUpdate=!1}}};var Tp={type:"redrawn"},Go=class extends Yt{constructor(e,n,r,a,d){super(e,n,r,d);this._image=null;this.image=a}get object(){return this}get element(){return dn(this.image.canvas)?this.image.canvas:null}onRedrawn(){this.updateTexture(),this.dispatchEvent(Tp)}get image(){return this._image}set image(e){this.image&&this.image.removeScope(this),this._image=e,this.image&&(this.image.addScopedEventListener(this,"redrawn",()=>this.onRedrawn()),this.setTextureMap(this.image.canvas),this.onRedrawn())}get imageWidth(){return this.image.width}get imageHeight(){return this.image.height}copy(e,n=!0){return super.copy(e,n),this.image=e.image,this}get isVisible(){return Ji(this)}set isVisible(e){Ki(this,e,"inline-block"),oi(this,e),oi(this.mesh,e),this.image.visible=e}};var Ct=class extends Go{constructor(t,e,n,r,a){let d;r instanceof an?d=r:d=new an(r),super(t,e,n,d,a)}onRedrawn(){this.objectHeight=this.imageHeight,super.onRedrawn()}};var Ap=new rt("play"),kp=new rt("stop"),ct=.1,il=new Map(ja.alts.map((o,t)=>[o.value,t.toString()])),kn=class extends zt{constructor(e,n,r,a,d,S,b){super();this.data=r;this.volume=S;this.player=b;this.playButton=null;this.pauseButton=null;this.stopButton=null;this.replayButton=null;this.clickPlay=null;this.disposed=!1;d=il.get(d)||d||"",this.object=Eo(`playback-${a}`),this.textLabel=new Ct(e,`playback-${a}-label`,"none",{minHeight:ct,minWidth:4*ct,maxWidth:4*ct,padding:.02,scale:1e3,bgFillColor:n.labelFillColor,textFillColor:"white"}),this.textLabel.image.value=d,this.textLabel.image.addEventListener("redrawn",()=>this.repositionLabel()),this.progressBar=new Tn(4*ct,.025,.01,No),this.progressBar.visible=!1,this.clickPlay=async()=>{this.player.data!==this.data&&await this.player.load(this.data,this),this.player.volume=this.volume,await this.player.play()},this.load(n,b)}dispose(){this.disposed||(this.data===this.player.data&&this.player.clear(),it(this.object),this.disposed=!0)}repositionLabel(){this.textLabel.position.y=-(ct+this.textLabel.objectHeight)/2}async load(e,n){let[r,a,d,S]=await yt(e.getMeshButton("media","play",ct),e.getMeshButton("media","pause",ct),e.getMeshButton("media","stop",ct),e.getMeshButton("media","replay",ct));ye(this,this.playButton=r,this.pauseButton=a,this.stopButton=d,this.replayButton=S,this.progressBar,this.textLabel),this.playButton.object.position.x=-1.5*ct,this.pauseButton.object.position.x=-.5*ct,this.stopButton.object.position.x=.5*ct,this.replayButton.object.position.x=1.5*ct,this.progressBar.position.y=-ct/2,this.progressBar.position.z=.01,this.repositionLabel();let b=()=>{let _=n.data===this.data;this.playButton.disabled=_&&(n.playbackState==="loading"||n.playbackState==="playing"||n.playbackState==="errored")||!_&&n.playbackState==="loading",this.pauseButton.disabled=!_||n.playbackState==="loading"||n.playbackState!=="playing",this.replayButton.disabled=this.stopButton.disabled=!_||n.playbackState==="loading"||n.playbackState==="stopped"||n.playbackState==="errored",(!_||n.playbackState==="loading"||n.playbackState==="stopped")&&(this.progressBar.visible=!1)};b();let m=_=>F=>{F.source.data===this.data&&_(F)},A=m(b);n.addEventListener("loading",b),n.addEventListener("loaded",A),n.addEventListener("played",A),n.addEventListener("paused",A),n.addEventListener("stopped",b),n.addEventListener("progress",m(_=>this.report(_.value,_.total))),n.addEventListener("played",m(()=>this.dispatchEvent(Ap))),n.addEventListener("stopped",m(()=>this.dispatchEvent(kp)));let C=(_,F)=>{_.addEventListener("click",F)};C(this.playButton,this.clickPlay),C(this.pauseButton,()=>n.pause()),C(this.stopButton,()=>n.stop()),C(this.replayButton,()=>n.restart())}get label(){return $(this.textLabel.image)?this.textLabel.image.value:null}set label(e){e=il.get(e)||e,this.textLabel.image.value=e}report(e,n,r,a){super.report(e,n,r,a);let d=this.p*4*ct;this.progressBar.position.x=.5*(d-4*ct),this.progressBar.scale.x=d,this.progressBar.visible=e>0}};var Uo=new tt,Xo=class{constructor(t,e,n,r){this.scenario=t;this.parent=e;this.player=n;this.clip=null;this.controls=null;this.error=null;this.disposed=!1;this.zone=r.zone,this.minDistance=r.minDistance,this.maxDistance=r.maxDistance,this.spatialize=r.spatialize,this.effect=r.effect,this.label=r.label,this.volume=r.volume,this.enabled=r.enabled,this.transformID=r.transformID,this.key=r.key,this.scenarioID=r.scenarioID,this.fileID=r.fileID,this.fileName=r.fileName,this.filePath=r.filePath,this.fileTagString=r.fileTagString,this.mediaType=r.mediaType,this.trueMediaType=r.trueMediaType,this.copyright=r.copyright,this.copyrightDate=r.copyrightDate}get effects(){return Se(this.effect)?[]:this.effect.split(",").map(t=>t.trim()).filter(t=>t.length>0)}async load(t){if($(this.error))return Promise.resolve();this.disposed=!1;try{this.spatialize?(this.clip=await this.scenario.env.audio.createClip(this.transformID.toString(),this.filePath,this.spatialize,this.spatialize,this.spatialize,this.spatialize,this.volume,this.effects,t),this.clip.spatializer.setAudioProperties(this.minDistance,this.maxDistance,this.scenario.env.audio.algorithm),this.updateAudioPosition()):(ye(this.parent,this.controls=new kn(this.scenario.env,this.scenario.env.uiButtons,this.filePath,`${this.fileName}(${this.transformID})`,this.label,this.volume,this.player)),this.controls.addScopedEventListener(this,"play",()=>{this.scenario.log("play audio",{id:this.transformID})}),this.controls.addScopedEventListener(this,"stop",()=>{this.scenario.log("stop audio",{id:this.transformID})}))}catch(e){this.error=e,this.dispose()}}async reload(t){let e=this.clip&&this.clip.playbackState==="playing";this.dispose(),this.player.cacheBust(this.filePath),await this.load(t),e&&this.clip.play()}updateAudioPosition(){this.parent.getWorldPosition(Uo),this.scenario.env.audio.setClipPosition(this.transformID.toString(),Uo.x,Uo.y,Uo.z)}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){$(this.clip)&&(this.scenario.env.audio.removeClip(this.transformID.toString()),this.clip=null),$(this.controls)&&(this.controls.removeScope(this),this.controls.object.removeFromParent(),this.controls.dispose(),this.controls=null)}play(){return $(this.error)?Promise.resolve():$(this.clip)?this.clip.play():this.controls.clickPlay()}reset(){$(this.error)||($(this.clip)?this.clip.stop():this.player.stop())}};var di="Juniper:ThreeJS:EventSystem:RayTarget",xt=class extends Ve{constructor(e){super();this.object=e;this.meshes=new Array;this._disabled=!1;this._clickable=!1;this._draggable=!1;this._navigable=!1;this.object.userData[di]=this}addMesh(e){return e.userData[di]=this,this.meshes.push(e),this}removeMesh(e){return Ut(this.meshes,e)&&delete e.userData[di],this}addMeshes(...e){for(let n of e)this.addMesh(n);return this}removeMeshes(...e){for(let n of e)this.removeMesh(n);return this}get disabled(){return this._disabled}set disabled(e){this._disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get clickable(){return this._clickable}set clickable(e){this._clickable=e}get draggable(){return this._draggable}set draggable(e){this._draggable=e}get navigable(){return this._navigable}set navigable(e){this._navigable=e}};var zo=class extends xt{constructor(e,n,r,a){super(Eo(n));this.env=e;if($(r)){a=Object.assign({textFillColor:"white",fontFamily:"Segoe UI Emoji",fontSize:20,minHeight:.25,maxHeight:.25},a,{value:r}),this.image=new an(a);let d=Vo(16);this.enabledImage=this.createImage(`${d}-enabled`,1),this.disabledImage=this.createImage(`${d}-disabled`,.5),this.disabledImage.visible=!1,ye(this,this.enabledImage,this.disabledImage)}this.addMesh(this.enabledImage.mesh),this.addMesh(this.disabledImage.mesh),this.clickable=!0,$(r)&&xa(this,!0)}createImage(e,n){return new Ct(this.env,`text-${e}`,"none",this.image,{side:ko,opacity:n})}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.enabledImage.visible=!e,this.disabledImage.visible=e}};var sl=` ${Ma.textStyle} `,vp=new lt,ln=class extends zt{constructor(e,n,r,a,d){super();this.env=e;this.transform=n;this.from=r;this.to=a;d=d||sl,this.icon=new zo(this.env,"navButton",d,ya),this.icon.addEventListener("click",S=>{this.enabled&&this.dispatchEvent(S)}),this.transform.scale.setScalar(.5),this.progressBar=new Tn(this.icon.image.width,.025,.01,No),this.progressBar.position.y=-this.icon.image.height/2,this.progressBar.position.z=.01,ye(this.transform,ye(this.icon,this.progressBar))}get object(){return this.transform}get fromStationID(){return this.from.transformID}get toStationID(){return this.to.transformID}get transformID(){return this.transform&&this.transform.transformID}report(e,n,r,a){super.report(e,n,r,a);let d=this.icon.image.width*this.p;this.progressBar.position.x=.5*(d-this.icon.image.width),this.progressBar.scale.x=d}get label(){return this.icon.image.value}set label(e){this.icon.image.value=this.icon.image.value=e||sl}get enabled(){return!this.icon.disabled}set enabled(e){this.icon.disabled=!e,this.progressBar.visible=!e}static calcMatrix(e,n,r,a=null){a=a||vp;let d=a.parent;return d&&d.remove(a),a.position.copy(n.position),a.position.sub(e.position),a.position.y=0,a.position.normalize(),a.position.multiplyScalar(1.5),a.position.y+=1,a.lookAt(0,r,0),a.updateMatrix(),d&&ye(d,a),a.matrix}resetPosition(){ln.calcMatrix(this.from,this.to,this.env.defaultAvatarHeight,this.object)}};function al(){return"InstallTrigger"in globalThis}var yp=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,qo=navigator.userAgent.match(yp),Ko=!!qo,M0=Ko&&{major:parseFloat(qo[1]),minor:parseFloat(qo[2]),patch:parseFloat(qo[3])},D0=Ko&&/pacific/i.test(navigator.userAgent),P0=Ko&&/quest/i.test(navigator.userAgent),L0=Ko&&/quest 2/i.test(navigator.userAgent);var hi="Worker"in globalThis;function ll(o){let t=new et,e=setInterval(()=>{o()&&(clearInterval(e),t.resolve())},100);return t}async function Oe(o,t){let{status:e,requestPath:n,responsePath:r,content:a,contentType:d,contentLength:S,fileName:b,headers:m,date:A}=o;return{status:e,requestPath:n,responsePath:r,content:$(t)?await t(a):void 0,contentType:d,contentLength:S,fileName:b,headers:m,date:A}}var mi=null;function cl(o){return mi===null&&(mi=new Audio),mi.canPlayType(o)!==""}var Jo=class{constructor(t,e,n,r=!1){this.fetcher=t;this.method=e;this.path=n;this.useBLOBs=r;this.prog=null;this.request={method:e,path:this.path.href,body:null,headers:null,timeout:null,withCredentials:!1,useCache:!1,retryCount:3}}retries(t){return this.request.retryCount=t,this}query(t,e){return this.path.searchParams.set(t,e),this.request.path=this.path.href,this}header(t,e){return this.request.headers===null&&(this.request.headers=new Map),this.request.headers.set(t.toLowerCase(),e),this}headers(t){for(let[e,n]of t.entries())this.header(e,n);return this}timeout(t){return this.request.timeout=t,this}progress(t){return this.prog=t,this}body(t,e){if($(t)){let n=new Set,r=new Array;r.push(t);let a=!1;for(;!a&&r.length>0;){let d=r.shift();if(d&&!n.has(d))if(n.add(d),d instanceof Blob){a=!0;break}else Pe(d)||r.push(...Object.values(d))}if(a){let d=new FormData,S=new Map,b=new Set;for(let[m,A]of Object.entries(t))if(A instanceof Blob){let C=m+".name",_=t[C];Pe(_)&&(S.set(A,_),b.add(C))}for(let[m,A]of Object.entries(t))b.has(m)||(A instanceof Blob?d.append(m,A,S.get(A)):Pe(A)?d.append(m,A):$(A)&&He(A.toString)?d.append(m,A.toString()):console.warn("Can't serialize value to formdata",m,A));t=d,e=void 0}this.request.body=t,this.content(e)}return this}withCredentials(){return this.request.withCredentials=!0,this}useCache(t=!0){return this.request.useCache=t,this}media(t,e){$(e)&&(Pe(e)||(e=e.value),this.header(t,e))}content(t){this.media("content-type",t)}accept(t){return this.media("accept",t),this}blob(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBlob(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBlob(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ke(this.method)}buffer(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBuffer(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBuffer(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ke(this.method)}async file(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return await this.fetcher.sendObjectGetFile(this.request,this.prog);if(this.method==="GET"){if(this.useBLOBs)return await this.fetcher.sendNothingGetFile(this.request,this.prog);{let e=await this.fetcher.sendNothingGetNothing(this.request);return Oe(e,()=>this.request.path)}}else{if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ke(this.method)}}text(t){if(this.accept(t||Ri),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetText(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetText(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ke(this.method)}object(t){if(this.accept(t||_r),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetObject(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetObject(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ke(this.method)}xml(t){if(this.accept(t||Ii),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetXml(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetXml(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ke(this.method)}imageBitmap(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetImageBitmap(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetImageBitmap(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ke(this.method)}exec(){if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetNothing(this.request,this.prog);if(this.method==="GET")throw new St("GET requests should expect a response type");if(this.method==="HEAD"||this.method==="OPTIONS")return this.fetcher.sendNothingGetNothing(this.request);Ke(this.method)}async audioBlob(t){if($(t)&&(Pe(t)||(t=t.value),!cl(t)))throw new Error(`Probably can't play file of type "${t}" at path: ${this.request.path}`);let e=await this.blob(t);if(cl(e.contentType))return e;throw new Error(`Cannot play file of type "${e.contentType}" at path: ${this.request.path}`)}async audioBuffer(t,e){return Oe(await this.audioBlob(e),async n=>await t.decodeAudioData(await n.arrayBuffer()))}async htmlElement(t,e,n){let r=await this.file(n),a=pt(t,e,"error");return t instanceof HTMLLinkElement?t.href=r.content:t.src=r.content,await a,await Oe(r,()=>t)}image(t){return this.htmlElement(mo(),"load",t)}async htmlCanvas(t){let e=tn(1,1);if(this.method==="GET")if(Zt){this.accept(t);let n=await this.fetcher.drawImageToCanvas(this.request,e.transferControlToOffscreen(),this.prog);return await Oe(n,()=>e)}else{let n=await this.image(t);return await Oe(n,r=>(e.width=r.width,e.height=r.height,xo(e,r),at(r),e))}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ke(this.method)}}canvas(t){return Zt?this.offscreenCanvas(t):this.htmlCanvas(t)}async offscreenCanvas(t){if(!Zt)throw new Error("This system does not support OffscreenCanvas");if(this.method==="GET"){let e=await this.image(t);return await Oe(e,n=>{let r=Bn(n.width,n.height);return xo(r,n),at(n),r})}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ke(this.method)}}async style(){let t=Zi(co(so),Gi("stylesheet"));document.head.append(t);let e=await this.htmlElement(t,"load",so);return Oe(e)}async getScript(){let t=es(co(Xt));document.head.append(t);let e=await this.htmlElement(t,"load",Xt);return Oe(e)}async script(t){let e=null,n=this.request.path;if(!t)e=await this.getScript();else if(!t()){let r=ll(t);e=await this.getScript(),await r}return this.prog&&this.prog.end(n),e}async module(){let t=this.request.path,e=await this.file(Xt),n=await import(e.content);return this.prog&&this.prog.end(t),Oe(e,()=>n)}async wasm(t){let e=await this.buffer(Tr);if(!Tr.matches(e.contentType))throw new Error(`Server did not respond with WASM file. Was: ${e.contentType}`);let n=await WebAssembly.compile(e.content),r=await WebAssembly.instantiate(n,t);return Oe(e,()=>r.exports)}async worker(t="module"){let e=this.request.path,n=await this.file(Xt);this.prog=null,this.request.timeout=null;let r=new Worker(n.content,{type:t});return this.prog&&this.prog.end(e),Oe(n,()=>r)}};var $o=class{constructor(t,e=!1){this.service=t;this.useBLOBs=e;{let n=Yi("input[name=__RequestVerificationToken]");n&&this.service.setRequestVerificationToken(n.value)}}clearCache(){return this.service.clearCache()}evict(t,e){return this.service.evict(new URL(t,e||location.href).href)}request(t,e,n){return new Jo(this.service,t,new URL(e,n||location.href),this.useBLOBs)}head(t,e){return this.request("HEAD",t,e)}options(t,e){return this.request("OPTIONS",t,e)}get(t,e){return this.request("GET",t,e)}post(t,e){return this.request("POST",t,e)}put(t,e){return this.request("PUT",t,e)}patch(t,e){return this.request("PATCH",t,e)}delete(t,e){return this.request("DELETE",t,e)}async assets(t,e,...n){Se(n)&&(n=[]),n.unshift(e);let r;vr(t)?n.unshift(t):$(t)&&(r=t),n=n.filter($);let a=await Promise.all(n.map(S=>S.getSize(this))),d=new Map(a);await Ro(r,n.map(S=>[d.get(S),b=>S.fetch(this,b)]))}};var Yo=class{constructor(t){this.impl=t;this.defaultPostHeaders=new Map}setRequestVerificationToken(t){this.defaultPostHeaders.set("RequestVerificationToken",t)}clearCache(){return this.impl.clearCache()}evict(t){return this.impl.evict(t)}sendNothingGetNothing(t){return this.impl.sendNothingGetNothing(t)}sendNothingGetBlob(t,e){return this.impl.sendNothingGetSomething("blob",t,e)}sendObjectGetBlob(t,e){return this.impl.sendSomethingGetSomething("blob",t,this.defaultPostHeaders,e)}sendNothingGetBuffer(t,e){return this.impl.sendNothingGetSomething("arraybuffer",t,e)}sendObjectGetBuffer(t,e){return this.impl.sendSomethingGetSomething("arraybuffer",t,this.defaultPostHeaders,e)}sendNothingGetText(t,e){return this.impl.sendNothingGetSomething("text",t,e)}sendObjectGetText(t,e){return this.impl.sendSomethingGetSomething("text",t,this.defaultPostHeaders,e)}sendNothingGetObject(t,e){return this.impl.sendNothingGetSomething("json",t,e)}sendObjectGetObject(t,e){return this.impl.sendSomethingGetSomething("json",t,this.defaultPostHeaders,e)}sendObjectGetNothing(t,e){return this.impl.sendSomethingGetSomething("",t,this.defaultPostHeaders,e)}drawImageToCanvas(t,e,n){return this.impl.drawImageToCanvas(t,e,n)}async sendNothingGetFile(t,e){return Oe(await this.sendNothingGetBlob(t,e),URL.createObjectURL)}async sendObjectGetFile(t,e){return Oe(await this.sendObjectGetBlob(t,e),URL.createObjectURL)}async sendNothingGetXml(t,e){return Oe(await this.impl.sendNothingGetSomething("document",t,e),n=>n.documentElement)}async sendObjectGetXml(t,e){return Oe(await this.impl.sendSomethingGetSomething("document",t,this.defaultPostHeaders,e),n=>n.documentElement)}async sendNothingGetImageBitmap(t,e){return Oe(await this.sendNothingGetBlob(t,e),createImageBitmap)}async sendObjectGetImageBitmap(t,e){return Oe(await this.sendObjectGetBlob(t,e),createImageBitmap)}};function ul(o,t,e){return new Map(o.map(n=>[t(n),e(n)]))}function pl(o,t){return ul(o,t,pn)}var vn=class{constructor(t){this.db=t}static delete(t){let e=indexedDB.deleteDatabase(t),n=pt(e,"success","error","blocked");return Bt(n)}static async open(t,...e){let n=pl(e,k=>k.name),r=new Ht(e.filter(k=>$(k.indexes)).flatMap(k=>k.indexes.map(y=>[k.name,y.name,y]))),a=new Array,d=new Array,S=new Array,b=new st,m=new st,A=null,C=indexedDB.open(t);if(await Bt(pt(C,"success","error","blocked"))){let k=C.result;A=k.version;let y=new Array;for(let h of k.objectStoreNames)n.has(h)||d.push(h);for(let h of n.keys())k.objectStoreNames.contains(h)?y.push(h):a.push(h);if(y.length>0){let h=k.transaction(y),c=pt(h,"complete","error","abort"),u=Bt(c);for(let f of y){let M=h.objectStore(f),E=n.get(f);$(E.options)&&M.keyPath!==E.options.keyPath&&(d.push(f),a.push(f));for(let w of M.indexNames)r.has(f,w)||(S.indexOf(f)===-1&&S.push(f),m.add(f,w));if(r.has(f))for(let w of r.get(f).keys())if(!M.indexNames.contains(w))S.indexOf(f)===-1&&S.push(f),b.add(f,w);else{let P=r.get(f,w),ne=M.index(w);(Pe(P.keyPath)!==Pe(ne.keyPath)||Pe(P.keyPath)&&Pe(ne.keyPath)&&P.keyPath!==ne.keyPath||Tt(P.keyPath)&&Tt(ne.keyPath)&&ro(P.keyPath,ne.keyPath))&&(S.indexOf(f)===-1&&S.push(f),m.add(f,w),b.add(f,w))}}h.commit(),await u}at(k)}else{A=0,a.push(...n.keys());for(let k of e)if($(k.indexes))for(let y of k.indexes)b.add(k.name,y.name)}(a.length>0||d.length>0||b.size>0||m.size>0)&&++A;let _=new et,F=$(A)?indexedDB.open(t,A):indexedDB.open(t),i=pt(F,"success","error","blocked"),l=Bt(_),s=Bt(i),v=_.resolver(!1);if(F.addEventListener("success",v),F.addEventListener("upgradeneeded",()=>{let k=pt(F.transaction,"complete","error","abort"),y=F.result;for(let c of d)y.deleteObjectStore(c);let h=new Map;for(let c of a){let u=n.get(c),f=y.createObjectStore(c,u.options);h.set(c,f)}for(let c of S){let u=F.transaction.objectStore(c);h.set(c,u)}for(let[c,u]of h){for(let f of m.get(c))u.deleteIndex(f);for(let f of b.get(c)){let M=r.get(c,f);u.createIndex(f,M.keyPath,M.options)}}Bt(k).then(_.resolve).catch(_.reject).finally(()=>F.removeEventListener("success",v))}),!await l)throw _.error;if(!await s)throw i.error;return new vn(F.result)}dispose(){at(this.db)}get name(){return this.db.name}get version(){return this.db.version}get storeNames(){return Array.from(this.db.objectStoreNames)}getStore(t){return new gi(this.db,t)}},gi=class{constructor(t,e){this.db=t;this.storeName=e}async request(t,e){let n=this.db.transaction(this.storeName,e),r=pt(n,"complete","error"),a=n.objectStore(this.storeName),d=t(a),S=pt(d,"success","error");if(!await Bt(S))throw n.abort(),S.error;if(n.commit(),!await Bt(r))throw r.error;return d.result}add(t,e){return this.request(n=>n.add(t,e),"readwrite")}clear(){return this.request(t=>t.clear(),"readwrite")}getCount(t){return this.request(e=>e.count(t),"readonly")}async has(t){return await this.getCount(t)>0}delete(t){return this.request(e=>e.delete(t),"readwrite")}get(t){return this.request(e=>e.get(t),"readonly")}getAll(){return this.request(t=>t.getAll(),"readonly")}getAllKeys(){return this.request(t=>t.getAllKeys(),"readonly")}getKey(t){return this.request(e=>e.getKey(t),"readonly")}openCursor(t,e){return this.request(n=>n.openCursor(t,e),"readonly")}openKeyCursor(t,e){return this.request(n=>n.openKeyCursor(t,e),"readonly")}put(t,e){return this.request(n=>n.put(t,e),"readwrite")}};function dl(o,...t){for(let e of t)if($(e))for(let[n,r]of e)o.set(n,r);return o}var fi=class extends et{constructor(e){super(!1);this.milliseconds=e;this._timer=null}start(){super.start(),this._timer=setTimeout(()=>{this._timer=null,this.resolve()},this.milliseconds)}reset(){super.reset(),$(this._timer)&&(clearTimeout(this._timer),this._timer=null)}};function hl(o){let t=new fi(o);return t.start(),t}function Qo(o,t){return async()=>{let e=null,n=500;for(let r=0;r<=o;++r)try{return r>0&&(await hl(n),n*=2),await t()}catch(a){e=a}throw e}}function Ep(o){return Pe(o)||Ei(o)||o instanceof Blob||o instanceof FormData||Ci(o)||"Document"in globalThis&&o instanceof Document}function Zo(o,t,e,n,r,a){let d=!a;a&&a.then(()=>d=!0);let S=!1,b=r,m=new et;e.addEventListener("loadstart",()=>{d&&!S&&n&&n.start(o)}),e.addEventListener("progress",C=>{if(d&&!S){let _=C;n&&n.report(_.loaded,Math.max(_.loaded,_.total),o),_.loaded===_.total&&(b=!0,S&&m.resolve())}}),e.addEventListener("load",()=>{d&&!S&&(n&&n.end(o),S=!0,b&&m.resolve())});let A=C=>()=>{d&&m.reject(`${C} (${t.status})`)};return e.addEventListener("error",A("error")),e.addEventListener("abort",A("abort")),e.addEventListener("timeout",A("timeout")),m}function xi(o,t,e,n,r,a){if(o.open(t,e),o.responseType="blob",o.timeout=n,r)for(let[d,S]of r)o.setRequestHeader(d,S);$(a)?o.send(a):o.send()}function er(o,t,e){if(!o.has(t))return null;let n=o.get(t);try{let r=e(n);return o.delete(t),r}catch(r){console.warn(t,r)}return null}var Cp=/filename=\"(.+)\"(;|$)/,Mp="Juniper:Fetcher:Cache",tr=class{constructor(){this.cache=null;this.store=null;this.tasks=new Ht;this.cacheReady=this.openCache()}async drawImageToCanvas(t,e,n){let r=await this.sendNothingGetSomething("blob",t,n),a=r.content;return ts(await createImageBitmap(a,{imageOrientation:"from-image"}),d=>(e.width=d.width,e.height=d.height,e.getContext("2d").drawImage(d,0,0),Oe(r)))}async openCache(){let t={keyPath:"requestPath"};this.cache=await vn.open(Mp,{name:"files",options:t}),this.store=await this.cache.getStore("files")}async clearCache(){await this.cacheReady,await this.store.clear()}async evict(t){await this.cacheReady,this.store.has(t)&&await this.store.delete(t)}async readResponseHeaders(t,e){let n=e.getAllResponseHeaders().split(/[\r\n]+/).map(_=>_.trim()).filter(_=>_.length>0).map(_=>{let F=_.split(": "),i=F.shift().toLowerCase(),l=F.join(": ");return[i,l]}),r=new st(n),a=Array.from(r.keys()).map(_=>[_,r.get(_).join(", ")]),d=new Map(a),S=er(d,"content-type",pn),b=er(d,"content-length",parseFloat),m=er(d,"date",_=>new Date(_)),A=er(d,"content-disposition",_=>{if($(_)){let F=_.match(Cp);if($(F))return F[1]}return null});return{status:e.status,requestPath:t,responsePath:e.responseURL,content:void 0,contentType:S,contentLength:b,fileName:A,date:m,headers:d}}async readResponse(t,e){let{responsePath:n,status:r,contentType:a,contentLength:d,fileName:S,date:b,headers:m}=await this.readResponseHeaders(t,e),A={requestPath:t,responsePath:n,status:r,contentType:a,contentLength:d,fileName:S,date:b,headers:m,content:e.response};return $(A.content)&&(A.contentType=A.contentType||A.content.type,A.contentLength=A.contentLength||A.content.size),A}async decodeContent(t,e){return Oe(e,async n=>{if(t==="")return null;if(Se(e.contentType)){let r=Array.from(e.headers.entries()).map(a=>a.join(": ")).join(`
  `);throw new Error(`No content type found in headers: 
  `+r)}else{if(t==="blob")return n;if(t==="arraybuffer")return await n.arrayBuffer();if(t==="json"){let r=await n.text();return r.length>0?JSON.parse(r):null}else if(t==="document"){let r=new DOMParser;if(e.contentType==="application/xhtml+xml"||e.contentType==="text/html"||e.contentType==="application/xml"||e.contentType==="image/svg+xml"||e.contentType==="text/xml")return r.parseFromString(await n.text(),e.contentType);throw new Error("Couldn't parse document")}else{if(t==="text")return await n.text();Ke(t)}}})}async withCachedTask(t,e){return t.method!=="GET"&&t.method!=="HEAD"&&t.method!=="OPTIONS"?await e():(this.tasks.has(t.method,t.path)||this.tasks.add(t.method,t.path,e().finally(()=>this.tasks.delete(t.method,t.path))),this.tasks.get(t.method,t.path))}sendNothingGetNothing(t){return this.withCachedTask(t,Qo(t.retryCount,async()=>{let e=new XMLHttpRequest,n=Zo(`requesting: ${t.path}`,e,e,null,!0);return xi(e,t.method,t.path,t.timeout,t.headers),await n,await this.readResponseHeaders(t.path,e)}))}sendNothingGetSomething(t,e,n){return this.withCachedTask(e,Qo(e.retryCount,async()=>{let r=null,a=e.useCache&&e.method==="GET";a&&($(n)&&n.start(),await this.cacheReady,r=await this.store.get(e.path));let d=Se(r);if(d){let b=new XMLHttpRequest,m=Zo(`requesting: ${e.path}`,b,b,n,!0);xi(b,e.method,e.path,e.timeout,e.headers),await m,r=await this.readResponse(e.path,b),a&&await this.store.add(r)}let S=await this.decodeContent(t,r);return d&&$(n)&&n.end(),S}))}sendSomethingGetSomething(t,e,n,r){let a=null,d=dl(new Map,n,e.headers);if(e.body instanceof FormData&&$(d)){let _=new Array;for(let F of d.keys())F.toLowerCase()==="content-type"&&_.push(F);for(let F of _)d.delete(F)}Ep(e.body)&&!Pe(e.body)?a=e.body:$(e.body)&&(a=JSON.stringify(e.body));let S=$(a),b=Oi(r,S?2:1),[m,A]=b,C=async()=>{let _=new XMLHttpRequest,F=S?Zo("uploading",_,_.upload,m,!1):Promise.resolve(),i=Zo("saving",_,_,A,!0,F);xi(_,e.method,e.path,e.timeout,d,a),await F,await i;let l=await this.readResponse(e.path,_);return await this.decodeContent(t,l)};return Qo(e.retryCount,C)()}};var Yn=class extends Ve{constructor(e,n){super();this.scriptPath=e.scriptPath;let r=-1,a=e.workers,d=null;if(ot(a)?r=a:$(a)?(this.taskCounter=a.curTaskCounter,d=a.workers,r=d.length):r=navigator.hardwareConcurrency||4,r<1)throw new Error("Worker pool size must be a postive integer greater than 0");if(this.workers=new Array(r),Se(d)){this.taskCounter=0;for(let S=0;S<r;++S)this.workers[S]=new n(new Worker(this.scriptPath,{type:"module"}))}else for(let S=0;S<r;++S)this.workers[S]=new n(d[S]);for(let S of this.workers)S.addBubbler(this)}dispose(){this.workers.forEach(at),Xe(this.workers)}nextWorker(){let e=this.peekWorker();return this.taskCounter++,e}peekWorker(){return this.workers[this.taskCounter%this.workers.length]}};function Fi(o){return $(o)&&He(o.report)&&He(o.attach)&&He(o.end)}var Qn=class extends Ve{constructor(e){super();this.worker=e;this.invocations=new Map;this.tasks=new Array;this.taskCounter=0;hi||console.warn("Workers are not supported on this system."),this.worker.addEventListener("message",n=>{let r=n.data;switch(r.type){case"event":this.propogateEvent(r);break;case"progress":this.progressReport(r);break;case"return":this.methodReturned(r);break;case"error":this.invocationError(r);break;default:Ke(r)}})}postMessage(e,n){e.type!=="methodCall"&&Ke(e.type),n?this.worker.postMessage(e,n):this.worker.postMessage(e)}dispose(){this.worker.terminate()}progressReport(e){let n=this.invocations.get(e.taskID);if(n){let{prog:r}=n;r&&r.report(e.soFar,e.total,e.msg,e.est)}}methodReturned(e){let n=this.removeInvocation(e.taskID),{task:r}=n;r.resolve(e.returnValue)}invocationError(e){let n=this.removeInvocation(e.taskID),{task:r,methodName:a}=n;r.reject(new Error(`${a} failed. Reason: ${e.errorMessage}`))}removeInvocation(e){let n=this.invocations.get(e);return this.invocations.delete(e),n}callMethod(e,n,r,a){if(!hi)return Promise.reject(new Error("Workers are not supported on this system."));let d=null,S=null;Fi(n)&&(a=n,n=null,r=null),Fi(r)&&!a&&(a=r,r=null),Tt(n)&&(d=n),Tt(r)&&(S=r);let b=this.taskCounter++,m=Pt(this.tasks,_=>_.finished);m?m.reset():(m=new et,this.tasks.push(m));let A={methodName:e,task:m,prog:a};this.invocations.set(b,A);let C=null;return $(n)?C={type:"methodCall",taskID:b,methodName:e,params:d}:C={type:"methodCall",taskID:b,methodName:e},this.postMessage(C,S),m}};function ml(o=!0){let t=new Yo(new tr);return new $o(t,!Kn)}function gl(o,t,e,n){return`/Editor/Google/StreetView/Image/${o}/${t}/${e}/${n}/`}var nr=class extends Do{constructor(t){super(t,!0)}loadFiles(t,e,n){return this.renderFaces(gl.bind(null,t),e,n)}loadFile(t,e,n){return this.renderCubeMap(gl.bind(null,t),e,n)}async loadImages(t,e,n){let r=await this.loadFiles(t,e,n);return await Promise.all(r.map(hn))}async loadCanvas(t,e,n){let r=await this.loadFile(t,e,n),a=await hn(r);return Fo(a)}};var or=class extends Qn{init(e,n){this.callMethod("init",[e,n])}propogateEvent(e){Ke(e.eventName)}loadFiles(e,n,r){return this.callMethod("loadFiles",[e,n],r)}loadFile(e,n,r){return this.callMethod("loadFile",[e,n],r)}async loadImages(e,n,r){let a=await this.loadFiles(e,n,r);return await Promise.all(a.map(hn))}async loadCanvas(e,n,r){let a=await this.loadFile(e,n,r),d=await hn(a);return Fo(d)}};var rr=class extends Yn{constructor(t,e){t.workers!==1&&(t.workers=1),super(t,e)}get canvases(){return this.peekWorker().canvases}init(t,e){for(let n of this.workers)n.init(t,e)}loadImages(t,e,n){return this.nextWorker().loadImages(t,e,n)}loadCanvas(t,e,n){return this.nextWorker().loadCanvas(t,e,n)}};async function fl(o,t,e){let n=null;if(Dt(t)?e=t:n=t,n=n||new Ot,!al()&&e){let r=await o.get(Ca("three")).text().then(Ne);n.check();let a=await o.get(Ea("photosphere-capture")).text().then(Ne);n.check();let d=r+a,S=new Blob([d],{type:Xt.value}),b=URL.createObjectURL(S);return new rr({scriptPath:b},or)}else return o=o||ml(!1),new nr(o)}var xl=Je("video")("vnd.dlsdc.ytdlp+json","ytdlp.json","ytdlp","json"),Fl=Je("image")("vnd.google.streetview.pano");var ir=class extends ao{constructor(e,n,r,a){if(!Li.matches(r)&&!Bi.matches(r))throw new Error("Only GLTF model types are currently supported");super(n,r,a);this.env=e}async getResponse(e){let n=await e.file();return Oe(n,r=>this.env.loadGltf(r))}};var wi=class extends rt{constructor(e){super("dwell");this.dwellTimeSeconds=e}},Mt=class extends Ve{constructor(e=1,n=.25){super();this.minTimeSeconds=e;this.graceTimeSeconds=n;this.startTime=null;this.graceTimer=null;Object.seal(this)}start(){this.stopGrace(),this.startTime===null&&(this.startTime=performance.now())}stopGrace(){this.graceTimer!==null&&(clearTimeout(this.graceTimer),this.graceTimer=null)}stop(){this.startTime!==null&&(this.graceTimer=setTimeout(()=>{this.graceTimer=null;let e=(performance.now()-this.startTime)/1e3;this.startTime=null,e>this.minTimeSeconds&&this.dispatchEvent(new wi(e))},this.graceTimeSeconds*1e3))}};var wl=kt("Yarrow:Model:modelTemplateTasks",()=>new Map),sr=class extends lt{constructor(e,n,r){super();this.scenario=e;this.model=null;this.error=null;this.disposed=!1;this.name=`model-${n.fileName}`,this.key=n.key,this.scenarioID=n.scenarioID,this.fileID=n.fileID,this.fileName=n.fileName,this.filePath=n.filePath,this.fileTagString=n.fileTagString,this.transformID=n.transformID,this.mediaType=n.mediaType,this.trueMediaType=n.trueMediaType,this.copyright=n.copyright,this.copyrightDate=n.copyrightDate,this.target=new xt(this),ye(r,this),Object.seal(this)}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){$(this.model)&&(this.model.removeFromParent(),it(this.model),this.model=null)}async load(e){if($(this.error))return Promise.resolve();this.disposed=!1;let n=wl.get(this.filePath);if(!n){let d=new ir(this.scenario.env,this.filePath,this.mediaType,!this.scenario.env.DEBUG);n=d.then(S=>{try{qa(S.scene,Ka)}catch(b){this.error=b}return S}),wl.set(this.filePath,n),this.scenario.env.fetcher.assets(e,d)}let r=await n,a=new Mt;a.addEventListener("dwell",d=>{this.scenario.log("model viewed",{id:this.transformID,time:d.dwellTimeSeconds})}),this.model=r.scene.clone(!0),this.model.traverse(d=>{$t(d)&&this.target.addMesh(d)}),this.target.addEventListener("enter",d=>{d.pointer.type==="nose"&&a.start()}),this.target.addEventListener("exit",d=>{d.pointer.type==="nose"&&a.stop()}),ye(this,this.model)}async reload(e){this.dispose(),this.error=null,await this.load(e)}get size(){return this.parent.scale.x}set size(e){this.parent.scale.setScalar(e)}get rotationX(){return $e(this.parent.rotation.x)}get rotationY(){return $e(this.parent.rotation.y)}get rotationZ(){return $e(this.parent.rotation.z)}};function Sl(o){return Se(o)?null:(Pe(o)&&(o=new URL(o,location.href)),o)}function Dp(o){if(Se(o))throw new Error("URL is undefined");if(o=Sl(o),ai(o)){let t=Array.from(o.searchParams.keys()).filter(e=>e!=="v"&&e!=="t");for(let e of t)o.searchParams.delete(e)}return o}function _l(o){if(o=Sl(o),Se(o))throw new Error("URL is undefined");return o=Dp(o),new mn("/vr/link",location.href).query("q",o.href).toURL()}var Tl=1e3,Pp=1e3/Tl,bl=new tt,Si=.15,_i=.1,Lp={minHeight:_i,maxHeight:_i,minWidth:_i,padding:.02,scale:1e3,bgFillColor:Oo,textFillColor:"white"},bi=class extends lt{constructor(e,n,r){super();this.scenario=e;this.originPoint=new tt;this.originRotation=new rn;this._isCallout=!1;this.wasCallout=null;this._alwaysVisible=!1;this.wasAlwaysVisible=null;this.opacity=1;this.lastOpacity=null;this.file=null;this.pdf=null;this.zoomInButton=null;this.zoomOutButton=null;this.prevButton=null;this.pageLabel=null;this.nextButton=null;this.error=null;this.disposed=!1;this.invMatrix=new ft;this.dumpScale=new tt;this.followObj=this.scenario.env.worldUISpace,this.onClick=()=>this.toggle(),this.key=n.key,this.scenarioID=n.scenarioID,this.fileID=n.fileID,this.fileName=n.fileName,this.filePath=n.filePath,this.fileTagString=n.fileTagString,this.mediaType=n.mediaType,this.trueMediaType=n.trueMediaType,this.copyright=n.copyright,this.copyrightDate=n.copyrightDate,this.transformID=n.transformID,this.name=`sign-${n.fileName}`,this.originPoint.copy(this.position),this.originRotation.copy(this.quaternion),ye(r,this),this._alwaysVisible=n.alwaysVisible,this._isCallout=n.isCallout,this.start=-1,this.end=0,this.t=1,this.direction=-1,this.target=new xt(this),this.scenario.addScopedEventListener(this,"present",a=>{this.direction!==-1&&a.source!==this&&this.toggle()})}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){this.scenario.removeScope(this),$(this.image)&&(this.image.dispose(),this.image=null),this.removeButton(this.zoomInButton),this.zoomInButton=null,this.removeButton(this.zoomOutButton),this.zoomOutButton=null,this.removeButton(this.prevButton),this.prevButton=null,this.removeButton(this.nextButton),this.nextButton=null,this.removeButton(this.pageLabel),this.pageLabel=null,this.pdf=null}removeButton(e){$(e)&&(e instanceof Ve&&e.removeScope(this),Xn(e)&&(e.object.removeFromParent(),it(e)))}async load(e){if($(this.error))return Promise.resolve();this.disposed=!1;try{let[n,r,a]=await yt(this.scenario.env.fetcher.get(this.filePath).progress(e).file(),this.scenario.env.uiButtons.getMeshButton("zoom","in",Si),this.scenario.env.uiButtons.getMeshButton("zoom","out",Si));if(this.file=n,this.zoomInButton=r,this.zoomInButton.addScopedEventListener(this,"click",this.onClick),this.zoomInButton.object.visible=this.isCallout,this.zoomOutButton=a,this.zoomOutButton.addScopedEventListener(this,"click",this.onClick),this.zoomOutButton.object.visible=!1,ye(this,this.zoomInButton,this.zoomOutButton),Di.matches(this.file.contentType)){this.pdf=new Fn(this.file.content,{scale:2});let[S,b]=await yt(this.scenario.env.uiButtons.getMeshButton("arrow","left",.1),this.scenario.env.uiButtons.getMeshButton("arrow","right",.1));ye(this,this.prevButton=S,this.pageLabel=new Ct(this.scenario.env,"label-"+this.transformID,"none",Lp,{side:ko}),this.nextButton=b),this.prevButton.addScopedEventListener(this,"click",()=>this.loadImage(this.pdf.curPageIndex-1)),this.nextButton.addScopedEventListener(this,"click",()=>this.loadImage(this.pdf.curPageIndex+1))}ye(this,this.image=new Yt(this.scenario.env,`Sign(${this.key}) ${n.fileName}`,"dynamic"));let d=new Mt;d.addEventListener("dwell",S=>{this.scenario.log("sign viewed",{id:this.transformID,time:S.dwellTimeSeconds})}),this.target.clickable=!0,this.target.addEventListener("click",this.onClick),this.target.addEventListener("enter",S=>{S.pointer.type==="nose"&&d.start()}),this.target.addEventListener("exit",S=>{S.pointer.type==="nose"&&d.stop()}),await this.loadImage(0)}catch(n){this.error=n,this.dispose()}}async reload(e){this.dispose(),this.error=null,await this.load(e)}async loadImage(e){this.pdf&&(this.prevButton.disabled=!0,this.nextButton.disabled=!0);let n=await this.getFrame(e);if(this.image.setTextureMap(n),this.image.objectWidth=1,this.pdf){let r=this.image.objectHeight/2;this.prevButton.object.visible=this.pageLabel.object.visible=this.nextButton.object.visible=this.hasPages,this.hasPages&&(this.prevButton.object.position.set(-.5,-r,.1),this.pageLabel.position.set(0,-r,.1),this.nextButton.object.position.set(.5,-r,.1),this.prevButton.disabled=!this.pdf.canGoBack,this.pageLabel.image.value=`${this.pdf.curPageNumber} of ${this.pdf.numPages}`,this.nextButton.disabled=!this.pdf.canGoForward)}}async getFrame(e){return this.pdf?(this.scenario.log("view sign page",{id:this.transformID,page:e}),await this.pdf.getPage(e),this.pdf.canvas):await this.scenario.env.fetcher.get(this.file.content).image().then(Ne)}get isCallout(){return this._isCallout}set isCallout(e){this._isCallout=e,this.update(0)}get hasPages(){return this.pdf&&this.pdf.numPages>1}get alwaysVisible(){return this._alwaysVisible}set alwaysVisible(e){this._alwaysVisible=e,this.update(0)}get isClickable(){return this.isCallout||!this.alwaysVisible}get showZoomIn(){return this.isClickable&&this.direction===-1&&this.t>=this.end}get showZoomOut(){return this.isClickable&&this.direction===1&&this.t>=this.end}toggle(){if(!$(this.error)&&this.isClickable){if(this.direction!==1){this.scenario.log("expand sign",{id:this.transformID}),this.target.addMesh(this.image.mesh),this.direction=1;let n=new yn(this);this.scenario.dispatchEvent(n)}else this.target.removeMesh(this.image.mesh),this.direction=-1;let e=Math.max(0,this.end-this.t);this.start=performance.now(),this.end=this.start+Tl,this.t=this.start+e}}reset(){$(this.error)||(this.isClickable&&(this.start=-1,this.t=0,this.end=0,this.direction=-1),$(this.image)&&this.image.removeWebXRLayer())}update(e){if($(this.error)||!$(this.parent))return;if($(this.zoomInButton)&&(this.zoomInButton.object.visible=this.showZoomIn,this.zoomOutButton.object.visible=this.showZoomOut,this.isCallout!==this.wasCallout||this.alwaysVisible!==this.wasAlwaysVisible)){let d=this.image.objectWidth/2,S=this.image.objectHeight/2;this.zoomInButton.object.visible=this.isClickable,this.zoomOutButton.object.visible=!1,this.alwaysVisible?this.zoomInButton.object.position.set(d,S,.1):this.zoomInButton.object.position.set(0,0,0),this.zoomOutButton.object.position.set(d,S,.1),this.wasCallout=this.isCallout,this.wasAlwaysVisible=this.alwaysVisible}this.t+=Pp*e;let n=wo(this.t,this.start,this.end),r=Jt(n,0,1),a=this.direction===1?1-r:r;this.isCallout&&(this.invMatrix.copy(this.parent.matrixWorld).invert().multiply(this.followObj.matrixWorld).multiply(bi.offsetMatrix).decompose(this.position,this.quaternion,this.dumpScale),this.position.lerp(this.originPoint,a),this.quaternion.slerp(this.originRotation,a)),$(this.zoomInButton)&&(this.zoomInButton.object.lookAt(this.scenario.env.avatar.worldPos),this.zoomInButton.object.getWorldPosition(bl),this.zoomInButton.size=this.zoomOutButton.size=Si*bl.sub(this.scenario.env.avatar.worldPos).length()/(3*this.size),this.zoomOutButton.object.matrix.copy(this.zoomInButton.object.matrix)),this.alwaysVisible?this.opacity=1:this.opacity=this.alwaysVisible?1:1-a,this.opacity!==this.lastOpacity&&(this.image.mesh.material.opacity=this.opacity,this.image.mesh.material.transparent=this.opacity<1,this.image.mesh.material.needsUpdate=!0,this.image.mesh.visible=0<this.opacity&&this.opacity<1||!(this.scenario.env.showWebXRLayers&&this.scenario.env.hasXRCompositionLayers),this.image.webXRLayerType=this.opacity===1?"dynamic":"none",$(this.pdf)&&(this.prevButton.object.visible=this.pageLabel.object.visible=this.nextButton.object.visible=this.hasPages&&this.opacity===1),this.lastOpacity=this.opacity)}get size(){return this.parent.scale.x}set size(e){this.parent.scale.setScalar(e)}get rotationX(){return $e(this.parent.rotation.x)}get rotationY(){return $e(this.parent.rotation.y)}get rotationZ(){return $e(this.parent.rotation.z)}},Zn=bi;Zn.offsetMatrix=new ft().makeTranslation(0,0,-1.5);var ar=class{constructor(t,e){this.scenario=t;this.key=e.key,this.scenarioID=e.scenarioID,this.transformID=e.transformID,this.fileID=e.fileID,this.fileName=e.fileName,this.filePath=e.filePath,this.fileTagString=e.fileTagString,this.mediaType=e.mediaType,this.trueMediaType=e.trueMediaType,this.copyright=e.copyright,this.copyrightDate=e.copyrightDate,this.location=e.location,this.zone=e.zone,this.label=e.label,this.rotation=e.rotation}async reload(t){this.scenario.evict(this),this.scenario.curStation===this&&await this.scenario.env.withFade(async()=>{this.scenario.env.skybox.clear(),await this.scenario.showStation(this,!1,t)})}};var vl=1e3,Bp=1e3/vl,Al=new tt,kl=.15,Ti=.2,Rp={minHeight:Ti,maxHeight:Ti,minWidth:Ti,padding:.04,scale:1e3,bgFillColor:"white",textFillColor:"black",bgStrokeColor:Oo,bgStrokeSize:.01},Ai=class extends lt{constructor(e,n,r){super();this.scenario=e;this.originPoint=new tt;this.originRotation=new rn;this._isCallout=!1;this.wasCallout=null;this._alwaysVisible=!1;this.wasAlwaysVisible=null;this.opacity=1;this.lastOpacity=null;this.zoomInButton=null;this.error=null;this.disposed=!1;this.invMatrix=new ft;this.dumpScale=new tt;this.followObj=this.scenario.env.worldUISpace,this.onClick=()=>this.toggle(),this.key=n.key,this.scenarioID=n.scenarioID,this.fileID=n.fileID,this.fileName=n.fileName,this.filePath=n.filePath,this.fileTagString=n.fileTagString,this.mediaType=n.mediaType,this.trueMediaType=n.trueMediaType,this.copyright=n.copyright,this.copyrightDate=n.copyrightDate,this.transformID=n.transformID,this.name=`text-${n.fileName}`,this.originPoint.copy(this.position),this.originRotation.copy(this.quaternion),ye(r,this),this._alwaysVisible=n.alwaysVisible,this._isCallout=n.isCallout,this.start=-1,this.end=0,this.t=1,this.direction=-1,this.target=new xt(this),this.scenario.addScopedEventListener(this,"present",a=>{this.direction!==-1&&a.source!==this&&this.toggle()})}get text(){return this.image.image.value}set text(e){this.image.image.value=e}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){this.scenario.removeScope(this),$(this.image)&&(this.image.dispose(),this.image=null),this.removeButton(this.zoomInButton),this.zoomInButton=null}removeButton(e){$(e)&&(e instanceof Ve&&e.removeScope(this),Xn(e)&&(e.object.removeFromParent(),it(e)))}async load(e){if($(this.error))return Promise.resolve();this.disposed=!1;try{let[n,r]=await yt(this.scenario.env.fetcher.get(this.filePath).progress(e).text(),this.scenario.env.uiButtons.getMeshButton("zoom","info",kl));this.zoomInButton=r,this.zoomInButton.addScopedEventListener(this,"click",this.onClick),this.zoomInButton.object.visible=this.isCallout,ye(this,this.zoomInButton),ye(this,this.image=new Ct(this.scenario.env,`Text(${this.key}) ${n.fileName}`,"dynamic",Rp));let a=new Mt;a.addEventListener("dwell",d=>{this.scenario.log("text viewed",{id:this.transformID,time:d.dwellTimeSeconds})}),this.target.clickable=!0,this.target.addEventListener("click",this.onClick),this.target.addEventListener("enter",d=>{d.pointer.type==="nose"&&a.start()}),this.target.addEventListener("exit",d=>{d.pointer.type==="nose"&&a.stop()}),this.image.image.value=n.content}catch(n){this.error=n,this.dispose()}}async reload(e){this.dispose(),this.error=null,await this.load(e)}get isCallout(){return this._isCallout}set isCallout(e){this._isCallout=e,this.update(0)}get alwaysVisible(){return this._alwaysVisible}set alwaysVisible(e){this._alwaysVisible=e,this.update(0)}get isClickable(){return this.isCallout||!this.alwaysVisible}get showZoomIn(){return this.isClickable&&this.direction===-1&&this.t>=this.end}toggle(){if(!$(this.error)&&this.isClickable){if(this.direction!==1){this.scenario.log("expand text",{id:this.transformID}),this.target.addMesh(this.image.mesh),this.direction=1;let n=new yn(this);this.scenario.dispatchEvent(n)}else this.target.removeMesh(this.image.mesh),this.direction=-1;let e=Math.max(0,this.end-this.t);this.start=performance.now(),this.end=this.start+vl,this.t=this.start+e}}reset(){$(this.error)||(this.isClickable&&(this.start=-1,this.t=0,this.end=0,this.direction=-1),$(this.image)&&this.image.removeWebXRLayer())}update(e){if($(this.error)||!$(this.parent))return;if($(this.zoomInButton)&&(this.zoomInButton.object.visible=this.showZoomIn,this.isCallout!==this.wasCallout||this.alwaysVisible!==this.wasAlwaysVisible)){let d=this.image.objectWidth/2,S=this.image.objectHeight/2;this.zoomInButton.object.visible=this.isClickable,this.alwaysVisible?this.zoomInButton.object.position.set(d,S,.1):this.zoomInButton.object.position.set(0,0,0),this.wasCallout=this.isCallout,this.wasAlwaysVisible=this.alwaysVisible}this.t+=Bp*e;let n=wo(this.t,this.start,this.end),r=Jt(n,0,1),a=this.direction===1?1-r:r;this.isCallout&&(this.invMatrix.copy(this.parent.matrixWorld).invert().multiply(this.followObj.matrixWorld).multiply(Ai.offsetMatrix).decompose(this.position,this.quaternion,this.dumpScale),this.position.lerp(this.originPoint,a),this.quaternion.slerp(this.originRotation,a)),$(this.zoomInButton)&&(this.zoomInButton.object.lookAt(this.scenario.env.avatar.worldPos),this.zoomInButton.object.getWorldPosition(Al),this.zoomInButton.size=kl*Al.sub(this.scenario.env.avatar.worldPos).length()/(3*this.size)),this.alwaysVisible?this.opacity=1:this.opacity=this.alwaysVisible?1:1-a,this.opacity!==this.lastOpacity&&(this.image.mesh.material.opacity=this.opacity,this.image.mesh.material.transparent=this.opacity<1,this.image.mesh.material.needsUpdate=!0,this.image.mesh.visible=0<this.opacity&&this.opacity<1||!(this.scenario.env.showWebXRLayers&&this.scenario.env.hasXRCompositionLayers),this.image.webXRLayerType=this.opacity===1?"dynamic":"none",this.lastOpacity=this.opacity)}get size(){return this.parent.scale.x}set size(e){this.parent.scale.setScalar(e)}get rotationX(){return $e(this.parent.rotation.x)}get rotationY(){return $e(this.parent.rotation.y)}get rotationZ(){return $e(this.parent.rotation.z)}},eo=Ai;eo.offsetMatrix=new ft().makeTranslation(0,0,-1.5);var to=class extends lt{constructor(e){super();this.M=new ft;this.data=e,this.name=e.name,this.M.fromArray(e.matrix),this.M.decompose(this.position,this.quaternion,this.scale)}get transformID(){return this.data.id}};var lr=class extends lt{constructor(e,n,r,a,d){super();this.scenario=e;this.proxy=n;this.player=a;this.controls=null;this.data=null;this.error=null;this.disposed=!1;this.label=d.label,this.volume=d.volume,this.enabled=d.enabled,this.transformID=d.transformID,this.key=d.key,this.scenarioID=d.scenarioID,this.fileID=d.fileID,this.fileName=d.fileName,this.filePath=d.filePath,this.fileTagString=d.fileTagString,this.mediaType=d.mediaType,this.trueMediaType=d.trueMediaType,this.copyright=d.copyright,this.copyrightDate=d.copyrightDate,this.sphereEncodingName=d.sphereEncodingName,this.stereoLayoutName=d.stereoLayoutName,this.name="video-"+d.fileName,ye(r,ye(this,this.thumbnail=new Yt(this.scenario.env,"thumbnail-"+d.fileName,"static"))),this.size=r.scale.x,r.scale.setScalar(1),this.target=new xt(this),Object.seal(this)}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){$(this.thumbnail)&&this.thumbnail.dispose(),$(this.controls)&&(this.controls.removeScope(this),this.controls.dispose())}async load(e){if($(this.error))return Promise.resolve();try{let n=mt(e,[10,1]);if(xl.matches(this.mediaType)){this.data=await this.proxy.loadData(this.filePath,n.shift());let S=await this.scenario.env.fetcher.get(this.data.thumbnail.url).image(this.data.thumbnail.contentType).then(Ne);this.thumbnail.setTextureMap(S),this.thumbnail.objectWidth=1,this.thumbnail.mesh.renderOrder=4}let r=this.label||this.data&&this.data.title&&this.data.title.substring(0,25)||this.fileName;ye(this,ye(this.controls=new kn(this.scenario.env,this.scenario.env.uiButtons,this.data||this.filePath,this.filePath,r,this.volume,this.player))),this.controls.object.renderOrder=5,this.controls.object.position.y=-this.thumbnail.objectHeight/2,this.controls.object.position.z=.01;let a=S=>()=>{this.thumbnail.visible=!S,this.player.object.visible=S,S?(this.scenario.log("play video",{id:this.transformID}),ye(this,this.player),this.player.setStereoParameters(this.sphereEncodingName,this.stereoLayoutName),this.player.object.position.set(0,0,0),this.player.object.quaternion.identity(),this.target.addMeshes(...this.player.meshes)):(this.scenario.log("stop video",{id:this.transformID}),this.target.removeMeshes(...this.player.meshes))};this.controls.addScopedEventListener(this,"play",a(!0)),this.controls.addScopedEventListener(this,"stop",a(!1));let d=new Mt;d.addEventListener("dwell",S=>{this.scenario.log("video viewed",{id:this.transformID,time:S.dwellTimeSeconds})}),this.target.addEventListener("enter",S=>{S.pointer.type==="nose"&&d.start()}),this.target.addEventListener("exit",S=>{S.pointer.type==="nose"&&d.stop()}),this.disposed=!1}catch(n){this.error=n,this.dispose()}}async reload(e){this.dispose(),await this.load(e)}reset(){$(this.error)||(this.player.stop(),$(this.thumbnail)&&this.thumbnail.removeWebXRLayer())}get size(){return this.scale.x}set size(e){this.scale.x=this.scale.y=e}get rotationX(){return $e(this.parent.rotation.x)}get rotationY(){return $e(this.parent.rotation.y)}get rotationZ(){return $e(this.parent.rotation.z)}};var ki=class extends rt{constructor(e){super("navigate");this.station=e}},yn=class extends Event{constructor(e){super("present");this.source=e,Object.seal(this)}},cr=class extends Ve{constructor(e,n,r){super();this.env=e;this.dataLogger=n;this.data=r;this.stations=new Array;this.signs=new Array;this.videos=new Array;this.texts=new Array;this.audios=new Array;this.models=new Array;this.signsByStation=new st;this.videosByStation=new st;this.textsByStation=new st;this.audiosByStation=new st;this.modelsByStation=new st;this.curConnections=new Ht;this.transformsByTransformID=new Map;this.zonedClips=new st;this.playbackButtons=new Map;this.videosReady=null;this.cancellationToken=null;this.curStationID=null;this.curZone=null;this.rootTransformID=null;this.__originLL=null;this._originUTM=null;this.windowQuitter=new Po;this.disposed=!1;this._muteEnvAudio=!1;this.imgCache=new Mo(10);this.imgTasks=new Map;this.imgCache.addEventListener("itemevicted",S=>{fo(S.value)&&S.value.close()}),this.yt=new Io(this.env.fetcher,_l),$(r.origin)&&(this._originLL=new Ye(r.origin)),this.startStationID=r.startStationID,this.startRotation=r.startRotation,this.transforms=r.transforms,this.connections=r.connections,this.env.addScopedEventListener(this,"environmentaudiotoggled",()=>{this.environmentAudioMuted=e.environmentAudioMuted});let a=!1,d=()=>{a||(a=!0,this.logLeaveStation(),this.log("leave scenario",{id:this.id}))};this.env.addScopedEventListener(this,"quitting",d),this.windowQuitter.addScopedEventListener(this,"quitting",d),this.env.addScopedEventListener(this,"sceneclearing",()=>{this.pauseCurrentAudioZone(),this.curZone=null}),this.env.avatar.addScopedEventListener(this,"avatarreset",()=>{this.moveToStation(this.curStation)})}get isEmpty(){return this.stations.length===0&&this.connections.length===0&&this.signs.length===0&&this.videos.length===0&&this.texts.length===0&&this.audios.length===0&&this.models.length===0}get rootTransform(){return this.transformsByTransformID.get(this.rootTransformID)}get _originLL(){return this.__originLL}set _originLL(e){this.__originLL=e,$(e)?this._originUTM=this.originLL.toUTM():this._originUTM=null}get originLL(){return this._originLL}get originUTM(){return this._originUTM}get id(){return this.data.id}get name(){return this.data.name}get version(){return this.data.version}get published(){return this.data.published}get roomName(){return this.data.roomName}async loadAssets(e){this.cancellationToken=new Ot,this.clearCache(),this.rig=await fl(this.env.fetcher,this.cancellationToken),this.rig.init(location.href,this.env.DEBUG),e=e||this.env.loadingBar;let[n,r]=mt(e,[1,100]);await Fn.prepare(Wo("pdfjs"),this.env.fetcher,this.env.DEBUG,n);for(let S of this.data.transforms)this.addTransformData(S);for(let S of this.data.transforms)if(S.parentTransformID===0)this.rootTransformID=S.id;else{let b=this.getTransform(S.parentTransformID),m=this.getTransform(S.id);b.attach(m)}let[a,d]=mt(r,[10,1]);this.videosReady=Wt(d,this.data.videoClips,(S,b)=>this.createVideo(S,b).catch(m=>{if(m instanceof Wn)console.warn("Late load cancellation occured");else throw m})).then(()=>null),await Ro(a,[[this.data.stations.length,S=>Wt(S,this.data.stations,(b,m)=>this.createStation(b,m))],[this.data.signs.length,S=>Wt(S,this.data.signs,(b,m)=>this.createSign(b,m))],[this.data.models.length,S=>Wt(S,this.data.models,(b,m)=>this.createModel(b,m))],[this.data.audioTracks.length,S=>Wt(S,this.data.audioTracks,(b,m)=>this.createAudio(b,m))],[this.data.texts.length,S=>Wt(S,this.data.texts,(b,m)=>this.createText(b,m))]]);for(let S of this.data.connections)this.createConnection(S);this.env.addScopedEventListener(this,"update",S=>this.update(S))}dispose(){if(!this.disposed){this.cancellationToken&&this.cancellationToken.cancel(),this.env.infoLabel.image.clear(),this.pauseCurrentAudioZone(),this.env.removeScope(this),this.env.avatar.removeScope(this);for(let n of this.audios)n.dispose();for(let n of this.signs)n.dispose();for(let n of this.models)n.dispose();for(let n of this.videos)n.dispose();for(let n of this.texts)n.dispose();let e=this.transformsByTransformID.get(this.rootTransformID);e.removeFromParent(),it(e),this.transformsByTransformID.clear(),this.signsByStation.clear(),this.audiosByStation.clear(),this.videosByStation.clear(),this.textsByStation.clear(),this.modelsByStation.clear(),this.zonedClips.clear(),Xe(this.audios),Xe(this.videos),Xe(this.texts),Xe(this.signs),Xe(this.models),this.windowQuitter.removeScope(this),this.disposed=!0}}get avatarHeightOffset(){return this.env.avatar.height-this.env.defaultAvatarHeight}update(e){let n=this.signsByStation.get(this.curStation);for(let a of n)a.update(e.dt);let r=this.textsByStation.get(this.curStation);for(let a of r)a.update(e.dt)}get environmentAudioMuted(){return this._muteEnvAudio}set environmentAudioMuted(e){e!==this.environmentAudioMuted&&(this._muteEnvAudio=e,this.environmentAudioMuted?this.pauseCurrentAudioZone():this.playCurrentAudioZone())}addTransformData(e){let n=new to(e);return this.transformsByTransformID.set(n.transformID,n),n}getTransform(e){return this.transformsByTransformID.get(e)}getStation(e){return Pt(this.stations,n=>n.transformID===e)}get curStation(){return this.getStation(this.curStationID)}get startStation(){return this.getStation(this.startStationID)}async createStation(e,n){n&&n.end();let r=new ar(this,e);return this.stations.push(r),r}async createConnection(e){try{let n=this.getStation(e.fromStationID),r=this.getStation(e.toStationID),a=this.getTransform(n.transformID),d=this.getTransform(r.transformID),S=this.getTransform(e.transformID);if(Se(S)){e.transformID=-this.transforms.length;let m={id:e.transformID,name:`nav-icon-from-${a.name}-to-${d.name}`,matrix:ln.calcMatrix(a,d,this.env.defaultAvatarHeight).toArray(),parentTransformID:n.transformID};this.transforms.push(m),S=this.addTransformData(m),ye(a,S)}let b=new ln(this.env,S,a,d,e.label);return b.addEventListener("click",()=>{this.dispatchEvent(new ki(r)),this.showStation(r,!0,this.env.loadingBar)}),this.curConnections.add(n,r,b),b}catch(n){return console.error({task:"createConnection",err:n,data:e}),null}}async createSign(e,n){let r=this.getTransform(e.transformID),a=new Zn(this,e,r);this.signs.push(a),await a.load(n),this.cancellationToken.check();let d=this.findStation(a);return this.signsByStation.add(d,a),a}async createModel(e,n){let r=this.getTransform(e.transformID),a=new sr(this,e,r);this.models.push(a),await a.load(n),this.cancellationToken.check();let d=this.findStation(a);return this.modelsByStation.add(d,a),a}async createAudio(e,n){let r=this.getTransform(e.transformID),a=new Xo(this,r,this.env.audioPlayer,e);this.audios.push(a);let d=this.findStation(a.parent);return this.audiosByStation.add(d,a),await a.load(n),this.cancellationToken.check(),$(a.controls)&&(this.playbackButtons.set(a.parent,a.controls),Se(a.error)&&(a.controls.addEventListener("play",()=>this.pauseCurrentAudioZone()),a.controls.addEventListener("stop",()=>this.playCurrentAudioZone()))),$(a.clip)&&this.zonedClips.add(a.zone,a.clip),a}async createVideo(e,n){let r=this.getTransform(e.transformID),a=new lr(this,this.yt,r,this.env.videoPlayer,e);this.videos.push(a),await a.load(n),this.cancellationToken.check(),this.playbackButtons.set(a.parent,a.controls);let d=this.findStation(a.parent);return this.videosByStation.add(d,a),Se(a.error)&&(a.controls.addEventListener("play",()=>this.pauseCurrentAudioZone()),a.controls.addEventListener("stop",()=>this.playCurrentAudioZone())),a}async createText(e,n){let r=this.getTransform(e.transformID),a=new eo(this,e,r);this.texts.push(a),await a.load(n),this.cancellationToken.check();let d=this.findStation(a);return this.textsByStation.add(d,a),a}getConnectionLabel(e,n){if(Se(e)||Se(n))return null;for(let r of this.connections)if(r.fromStationID===e.transformID&&r.toStationID===n.transformID)return r.label;return null}getStationByObject(e){return e instanceof to?this.getStation(e.transformID):null}findStation(e){let n=this.getStationByObject(e);for(;!n&&e!=null;)e=e.parent,n=this.getStationByObject(e);return n}getStationCenter(e){let n=new tt,r=this.getTransform(e.transformID);return r&&r.getWorldPosition(n),n.y+=this.env.defaultAvatarHeight,n}get visible(){return $(this.rootTransform.parent)}set visible(e){if(e!==this.visible)if(e){if(this.curStationID=null,this.rootTransform==null)throw new Error("No root transform");ye(this.env.foreground,this.rootTransform);for(let n of this.stations){let r=this.getTransform(n.transformID);r.visible=!1}}else this.env.foreground.remove(this.rootTransform)}async showStart(e){if(this.visible=!0,this.startStationID==null)throw new Error("Scenario has no starting point");this.log("start scenario",{id:this.id}),await this.showStation(this.startStation,!1,e),this.env.avatar.setHeadingImmediate(this.startRotation)}async showStation(e,n,r){if(this.logLeaveStation(),this.log("show station",{id:e.transformID}),this.curStationID){let S=this.getStation(this.curStationID);this.resetStationAssets(S)}r=r||this.env.loadingBar,this.curStationID=e.transformID;let a=n?this.env.audio.playClipThrough("footsteps"):Promise.resolve(),d=await this.isCached(e.filePath);this.env.loadingBar.enabled=!d,await this.env.withFade(async()=>{this.env.skybox.rotation=e.rotation;let S=await this.getImage(e.filePath,r);S.length===6?await this.env.skybox.setImages(e.filePath,S):await this.env.skybox.setImage(e.filePath,S[0]),this.moveToStation(e);for(let A of this.stations){let C=this.getTransform(A.transformID);C.visible=A.transformID===e.transformID}let b=this.curConnections.get(e),m=this.getConnectedStations(e);for(let A of m)this.prefetchConnectedStation(b,A);this.resetStationAssets(e),this.env.infoLabel.image.value=e.label||e.fileName,await yt(this.playAudioZone(e.zone),a)}),this.env.loadingBar.enabled=!1}logLeaveStation(){this.curStationID&&this.log("leave station",{id:this.curStationID})}moveToStation(e){$(e)&&(this.getTransform(e.transformID).getWorldPosition(this.env.stage.position),this.env.stage.position.y-=this.avatarHeightOffset)}resetStationAssets(e){let n=this.signsByStation.get(e);for(let S of n)S.reset();let r=this.audiosByStation.get(e);for(let S of r)S.reset();let a=this.videosByStation.get(e);for(let S of a)S.reset();let d=this.textsByStation.get(e);for(let S of d)S.reset()}evict(e){this.imgCache.delete(e.filePath),this.imgTasks.delete(e.filePath)}async prefetchConnectedStation(e,n){let r=e.get(n);r.enabled=!1,this.imgCache.has(n.filePath)||await this.getImage(n.filePath,r),r.enabled=!0}getImage(e,n){if(this.imgCache.has(e))return Promise.resolve(this.imgCache.get(e));if(this.imgTasks.has(e))return this.imgTasks.get(e);let r=this.getImages(e,n).then(a=>(this.imgCache.set(e,a),this.imgTasks.delete(e),a));return this.imgTasks.set(e,r),r}async getImages(e,n){let{contentType:r}=await this.env.fetcher.head(e).exec();if(r===Fl.value){let a=await this.env.fetcher.get(e).text().then(Ne);return await this.rig.loadImages(a,45,n)}else return[await this.env.fetcher.get(e).useCache(!this.env.DEBUG).image().then(Ne)]}async isCached(e){return await this.imgCache.has(e)}clearCache(){this.imgCache.clear()}getConnectedStations(e){return e&&this.connections.filter(n=>n.fromStationID===e.transformID).map(n=>this.getStation(n.toStationID))}async playAudioZone(e){if(e!==this.curZone){let n=new Map,r=new Map;for(let a of this.zonedClips.get(this.curZone))n.set(a.audio,a),a.disable();for(let a of this.zonedClips.get(e))n.has(a.audio)?n.delete(a.audio):r.set(a.audio,a),a.enable();for(let a of n.values())a.pause();await Promise.all(Array.from(r.values()).map(a=>a.play())),this.curZone=e}}pauseCurrentAudioZone(){let e=this.zonedClips.get(this.curZone),n=new Map;for(let r of e)n.set(r.audio,r),r.disable();for(let r of n.values())r.pause()}async playCurrentAudioZone(){if(!this.environmentAudioMuted){let e=this.zonedClips.get(this.curZone),n=new Map;for(let r of e)r.enable(),n.set(r.audio,r);await Promise.all(Array.from(n.values()).map(r=>r.play()))}}log(e,n){this.dataLogger.log(e,n)}error(e,n,r){this.dataLogger.error(e,n,r)}};var ur=class extends cr{constructor(t,e,n){super(t,n,e)}};var vi=class extends Dn{constructor(t){super(t,br)}async getResult(t,e){let[n,r]=mt(e,[1,89]);return await t.get(this.path).progress(n).object().then(Ne).then(async a=>{let d=this.createScenario(a);return await d.loadAssets(r),d})}},pr=class extends vi{constructor(e,n,r){super(`/vr/scenario/${n}`);this.env=e;this.dataLogger=r}createScenario(e){return new ur(this.env,e,this.dataLogger)}};var dr=class extends io{constructor(e){super(e);this.scenarioID=null;this.scenario=null;this.env.audio.setAudioProperties(1,4,"exponential"),Object.seal(this),Object.assign(window,{yarrow:this})}async init(e){let n=e.get("scenarioID");if(Pe(n)&&(n=parseFloat(n)),this.scenarioID=n,!ot(this.scenarioID))throw new St("Expected integer scenario ID");await super.init(e)}async load(e){let n=new pr(this.env,this.scenarioID,this);await this.env.fetcher.assets(e,n),this.scenario=n.result}async showing(e){this.join(this.scenario.roomName),await this.scenario.showStart(e)}hiding(){}dispose(){this.scenario.dispose(),this.env.removeScope(this),this.scenario=null,this.scenarioID=null}get visible(){return $(this.scenario)}};var _C=dr;export{_C as default};
