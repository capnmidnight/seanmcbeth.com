var Ca=Object.create;var Yo=Object.defineProperty;var La=Object.getOwnPropertyDescriptor;var Ba=Object.getOwnPropertyNames;var Pa=Object.getPrototypeOf,Ra=Object.prototype.hasOwnProperty;var Qo=(o=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(o,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):o)(function(o){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+o+'" is not supported')});var Et=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),zr=(o,e)=>{for(var t in e)Yo(o,t,{get:e[t],enumerable:!0})},Ia=(o,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ba(e))!Ra.call(o,r)&&r!==t&&Yo(o,r,{get:()=>e[r],enumerable:!(n=La(e,r))||n.enumerable});return o};var Oa=(o,e,t)=>(t=o!=null?Ca(Pa(o)):{},Ia(e||!o||!o.__esModule?Yo(t,"default",{value:o,enumerable:!0}):t,o));var Fr=Et(()=>{});var $i=Et(()=>{});var Ki=Et(()=>{});var Ji=Et(()=>{});var Yi=Et(()=>{});var Qi=Et(()=>{});var Zi=Et((exports,module)=>{(function(e,t){typeof exports=="object"&&typeof module=="object"?module.exports=t():typeof define=="function"&&define.amd?define("pdfjs-dist/build/pdf",[],t):typeof exports=="object"?exports["pdfjs-dist/build/pdf"]=t():e["pdfjs-dist/build/pdf"]=e.pdfjsLib=t()})(globalThis,()=>(()=>{"use strict";var __webpack_modules__=[,(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VerbosityLevel=e.Util=e.UnknownErrorException=e.UnexpectedResponseException=e.UNSUPPORTED_FEATURES=e.TextRenderingMode=e.StreamType=e.RenderingIntentFlag=e.PermissionFlag=e.PasswordResponses=e.PasswordException=e.PageActionEventType=e.OPS=e.MissingPDFException=e.LINE_FACTOR=e.LINE_DESCENT_FACTOR=e.InvalidPDFException=e.ImageKind=e.IDENTITY_MATRIX=e.FormatError=e.FontType=e.FeatureTest=e.FONT_IDENTITY_MATRIX=e.DocumentActionEventType=e.CMapCompressionType=e.BaseException=e.AnnotationType=e.AnnotationStateModelType=e.AnnotationReviewState=e.AnnotationReplyType=e.AnnotationMode=e.AnnotationMarkedState=e.AnnotationFlag=e.AnnotationFieldFlag=e.AnnotationEditorType=e.AnnotationEditorPrefix=e.AnnotationEditorParamsType=e.AnnotationBorderStyleType=e.AnnotationActionEventType=e.AbortException=void 0,e.arrayByteLength=re,e.arraysToBytes=ie,e.assert=L,e.bytesToString=ne,e.createPromiseCapability=Ma,e.createValidAbsoluteUrl=h,e.escapeString=vt,e.getModificationDate=Da,e.getVerbosityLevel=B,e.info=w,e.isArrayBuffer=ya,e.isArrayEqual=Ea,e.isAscii=Me,e.objectFromMap=oe,e.objectSize=le,e.setVerbosityLevel=$,e.shadow=b,e.string32=ae,e.stringToBytes=Q,e.stringToPDFString=Xe,e.stringToUTF16BEString=Te,e.stringToUTF8String=Ln,e.unreachable=y,e.utf8StringToString=va,e.warn=x,t(2);let n=[1,0,0,1,0,0];e.IDENTITY_MATRIX=n;let r=[.001,0,0,.001,0,0];e.FONT_IDENTITY_MATRIX=r;let s=1.35;e.LINE_FACTOR=s;let l=.35;e.LINE_DESCENT_FACTOR=l;let m={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};e.RenderingIntentFlag=m;let u={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};e.AnnotationMode=u;let i="pdfjs_internal_editor_";e.AnnotationEditorPrefix=i;let c={DISABLE:-1,NONE:0,FREETEXT:3,INK:15};e.AnnotationEditorType=c;let f={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13};e.AnnotationEditorParamsType=f;let F={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};e.PermissionFlag=F;let S={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};e.TextRenderingMode=S;let d={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};e.ImageKind=d;let _={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};e.AnnotationType=_;let T={MARKED:"Marked",REVIEW:"Review"};e.AnnotationStateModelType=T;let R={MARKED:"Marked",UNMARKED:"Unmarked"};e.AnnotationMarkedState=R;let E={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"};e.AnnotationReviewState=E;let P={GROUP:"Group",REPLY:"R"};e.AnnotationReplyType=P;let k={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};e.AnnotationFlag=k;let p={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};e.AnnotationFieldFlag=p;let g={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};e.AnnotationBorderStyleType=g;let A={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};e.AnnotationActionEventType=A;let M={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};e.DocumentActionEventType=M;let D={O:"PageOpen",C:"PageClose"};e.PageActionEventType=D;let V={UNKNOWN:"UNKNOWN",FLATE:"FLATE",LZW:"LZW",DCT:"DCT",JPX:"JPX",JBIG:"JBIG",A85:"A85",AHX:"AHX",CCF:"CCF",RLX:"RLX"};e.StreamType=V;let W={UNKNOWN:"UNKNOWN",TYPE1:"TYPE1",TYPE1STANDARD:"TYPE1STANDARD",TYPE1C:"TYPE1C",CIDFONTTYPE0:"CIDFONTTYPE0",CIDFONTTYPE0C:"CIDFONTTYPE0C",TRUETYPE:"TRUETYPE",CIDFONTTYPE2:"CIDFONTTYPE2",TYPE3:"TYPE3",OPENTYPE:"OPENTYPE",TYPE0:"TYPE0",MMTYPE1:"MMTYPE1"};e.FontType=W;let te={ERRORS:0,WARNINGS:1,INFOS:5};e.VerbosityLevel=te;let Z={NONE:0,BINARY:1,STREAM:2};e.CMapCompressionType=Z;let H={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};e.OPS=H;let N={unknown:"unknown",forms:"forms",javaScript:"javaScript",signatures:"signatures",smask:"smask",shadingPattern:"shadingPattern",font:"font",errorTilingPattern:"errorTilingPattern",errorExtGState:"errorExtGState",errorXObject:"errorXObject",errorFontLoadType3:"errorFontLoadType3",errorFontState:"errorFontState",errorFontMissing:"errorFontMissing",errorFontTranslate:"errorFontTranslate",errorColorSpace:"errorColorSpace",errorOperatorList:"errorOperatorList",errorFontToUnicode:"errorFontToUnicode",errorFontLoadNative:"errorFontLoadNative",errorFontBuildPath:"errorFontBuildPath",errorFontGetPath:"errorFontGetPath",errorMarkedContent:"errorMarkedContent",errorContentSubStream:"errorContentSubStream"};e.UNSUPPORTED_FEATURES=N;let j={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};e.PasswordResponses=j;let J=te.WARNINGS;function $(ee){Number.isInteger(ee)&&(J=ee)}function B(){return J}function w(ee){J>=te.INFOS&&console.log(`Info: ${ee}`)}function x(ee){J>=te.WARNINGS&&console.log(`Warning: ${ee}`)}function y(ee){throw new Error(ee)}function L(ee,z){ee||y(z)}function a(ee){if(!ee)return!1;switch(ee.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function h(ee,z=null,q=null){if(!ee)return null;try{if(q&&typeof ee=="string"){if(q.addDefaultProtocol&&ee.startsWith("www.")){let pe=ee.match(/\./g);pe&&pe.length>=2&&(ee=`http://${ee}`)}if(q.tryConvertEncoding)try{ee=Ln(ee)}catch{}}let se=z?new URL(ee,z):new URL(ee);if(a(se))return se}catch{}return null}function b(ee,z,q){return Object.defineProperty(ee,z,{value:q,enumerable:!0,configurable:!0,writable:!1}),q}let v=function(){function z(q,se){this.constructor===z&&y("Cannot initialize BaseException."),this.message=q,this.name=se}return z.prototype=new Error,z.constructor=z,z}();e.BaseException=v;class C extends v{constructor(z,q){super(z,"PasswordException"),this.code=q}}e.PasswordException=C;class I extends v{constructor(z,q){super(z,"UnknownErrorException"),this.details=q}}e.UnknownErrorException=I;class O extends v{constructor(z){super(z,"InvalidPDFException")}}e.InvalidPDFException=O;class U extends v{constructor(z){super(z,"MissingPDFException")}}e.MissingPDFException=U;class K extends v{constructor(z,q){super(z,"UnexpectedResponseException"),this.status=q}}e.UnexpectedResponseException=K;class G extends v{constructor(z){super(z,"FormatError")}}e.FormatError=G;class Y extends v{constructor(z){super(z,"AbortException")}}e.AbortException=Y;function ne(ee){(typeof ee!="object"||ee===null||ee.length===void 0)&&y("Invalid argument for bytesToString");let z=ee.length,q=8192;if(z<q)return String.fromCharCode.apply(null,ee);let se=[];for(let pe=0;pe<z;pe+=q){let Fe=Math.min(pe+q,z),fe=ee.subarray(pe,Fe);se.push(String.fromCharCode.apply(null,fe))}return se.join("")}function Q(ee){typeof ee!="string"&&y("Invalid argument for stringToBytes");let z=ee.length,q=new Uint8Array(z);for(let se=0;se<z;++se)q[se]=ee.charCodeAt(se)&255;return q}function re(ee){if(ee.length!==void 0)return ee.length;if(ee.byteLength!==void 0)return ee.byteLength;y("Invalid argument for arrayByteLength")}function ie(ee){let z=ee.length;if(z===1&&ee[0]instanceof Uint8Array)return ee[0];let q=0;for(let Fe=0;Fe<z;Fe++)q+=re(ee[Fe]);let se=0,pe=new Uint8Array(q);for(let Fe=0;Fe<z;Fe++){let fe=ee[Fe];fe instanceof Uint8Array||(typeof fe=="string"?fe=Q(fe):fe=new Uint8Array(fe));let gt=fe.byteLength;pe.set(fe,se),se+=gt}return pe}function ae(ee){return String.fromCharCode(ee>>24&255,ee>>16&255,ee>>8&255,ee&255)}function le(ee){return Object.keys(ee).length}function oe(ee){let z=Object.create(null);for(let[q,se]of ee)z[q]=se;return z}function Ae(){let ee=new Uint8Array(4);return ee[0]=1,new Uint32Array(ee.buffer,0,1)[0]===1}function De(){try{return new Function(""),!0}catch{return!1}}class ue{static get isLittleEndian(){return b(this,"isLittleEndian",Ae())}static get isEvalSupported(){return b(this,"isEvalSupported",De())}static get isOffscreenCanvasSupported(){return b(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}}e.FeatureTest=ue;let _e=[...Array(256).keys()].map(ee=>ee.toString(16).padStart(2,"0"));class ve{static makeHexColor(z,q,se){return`#${_e[z]}${_e[q]}${_e[se]}`}static scaleMinMax(z,q){let se;z[0]?(z[0]<0&&(se=q[0],q[0]=q[1],q[1]=se),q[0]*=z[0],q[1]*=z[0],z[3]<0&&(se=q[2],q[2]=q[3],q[3]=se),q[2]*=z[3],q[3]*=z[3]):(se=q[0],q[0]=q[2],q[2]=se,se=q[1],q[1]=q[3],q[3]=se,z[1]<0&&(se=q[2],q[2]=q[3],q[3]=se),q[2]*=z[1],q[3]*=z[1],z[2]<0&&(se=q[0],q[0]=q[1],q[1]=se),q[0]*=z[2],q[1]*=z[2]),q[0]+=z[4],q[1]+=z[4],q[2]+=z[5],q[3]+=z[5]}static transform(z,q){return[z[0]*q[0]+z[2]*q[1],z[1]*q[0]+z[3]*q[1],z[0]*q[2]+z[2]*q[3],z[1]*q[2]+z[3]*q[3],z[0]*q[4]+z[2]*q[5]+z[4],z[1]*q[4]+z[3]*q[5]+z[5]]}static applyTransform(z,q){let se=z[0]*q[0]+z[1]*q[2]+q[4],pe=z[0]*q[1]+z[1]*q[3]+q[5];return[se,pe]}static applyInverseTransform(z,q){let se=q[0]*q[3]-q[1]*q[2],pe=(z[0]*q[3]-z[1]*q[2]+q[2]*q[5]-q[4]*q[3])/se,Fe=(-z[0]*q[1]+z[1]*q[0]+q[4]*q[1]-q[5]*q[0])/se;return[pe,Fe]}static getAxialAlignedBoundingBox(z,q){let se=ve.applyTransform(z,q),pe=ve.applyTransform(z.slice(2,4),q),Fe=ve.applyTransform([z[0],z[3]],q),fe=ve.applyTransform([z[2],z[1]],q);return[Math.min(se[0],pe[0],Fe[0],fe[0]),Math.min(se[1],pe[1],Fe[1],fe[1]),Math.max(se[0],pe[0],Fe[0],fe[0]),Math.max(se[1],pe[1],Fe[1],fe[1])]}static inverseTransform(z){let q=z[0]*z[3]-z[1]*z[2];return[z[3]/q,-z[1]/q,-z[2]/q,z[0]/q,(z[2]*z[5]-z[4]*z[3])/q,(z[4]*z[1]-z[5]*z[0])/q]}static apply3dTransform(z,q){return[z[0]*q[0]+z[1]*q[1]+z[2]*q[2],z[3]*q[0]+z[4]*q[1]+z[5]*q[2],z[6]*q[0]+z[7]*q[1]+z[8]*q[2]]}static singularValueDecompose2dScale(z){let q=[z[0],z[2],z[1],z[3]],se=z[0]*q[0]+z[1]*q[2],pe=z[0]*q[1]+z[1]*q[3],Fe=z[2]*q[0]+z[3]*q[2],fe=z[2]*q[1]+z[3]*q[3],gt=(se+fe)/2,Ot=Math.sqrt((se+fe)**2-4*(se*fe-Fe*pe))/2,yt=gt+Ot||1,Ge=gt-Ot||1;return[Math.sqrt(yt),Math.sqrt(Ge)]}static normalizeRect(z){let q=z.slice(0);return z[0]>z[2]&&(q[0]=z[2],q[2]=z[0]),z[1]>z[3]&&(q[1]=z[3],q[3]=z[1]),q}static intersect(z,q){let se=Math.max(Math.min(z[0],z[2]),Math.min(q[0],q[2])),pe=Math.min(Math.max(z[0],z[2]),Math.max(q[0],q[2]));if(se>pe)return null;let Fe=Math.max(Math.min(z[1],z[3]),Math.min(q[1],q[3])),fe=Math.min(Math.max(z[1],z[3]),Math.max(q[1],q[3]));return Fe>fe?null:[se,Fe,pe,fe]}static bezierBoundingBox(z,q,se,pe,Fe,fe,gt,Ot){let yt=[],Ge=[[],[]],Wt,ft,Bn,Ce,Pn,Rn,$o,Ko;for(let Jo=0;Jo<2;++Jo){if(Jo===0?(ft=6*z-12*se+6*Fe,Wt=-3*z+9*se-9*Fe+3*gt,Bn=3*se-3*z):(ft=6*q-12*pe+6*fe,Wt=-3*q+9*pe-9*fe+3*Ot,Bn=3*pe-3*q),Math.abs(Wt)<1e-12){if(Math.abs(ft)<1e-12)continue;Ce=-Bn/ft,0<Ce&&Ce<1&&yt.push(Ce);continue}$o=ft*ft-4*Bn*Wt,Ko=Math.sqrt($o),!($o<0)&&(Pn=(-ft+Ko)/(2*Wt),0<Pn&&Pn<1&&yt.push(Pn),Rn=(-ft-Ko)/(2*Wt),0<Rn&&Rn<1&&yt.push(Rn))}let tn=yt.length,ze,nn=tn;for(;tn--;)Ce=yt[tn],ze=1-Ce,Ge[0][tn]=ze*ze*ze*z+3*ze*ze*Ce*se+3*ze*Ce*Ce*Fe+Ce*Ce*Ce*gt,Ge[1][tn]=ze*ze*ze*q+3*ze*ze*Ce*pe+3*ze*Ce*Ce*fe+Ce*Ce*Ce*Ot;return Ge[0][nn]=z,Ge[1][nn]=q,Ge[0][nn+1]=gt,Ge[1][nn+1]=Ot,Ge[0].length=Ge[1].length=nn+2,[Math.min(...Ge[0]),Math.min(...Ge[1]),Math.max(...Ge[0]),Math.max(...Ge[1])]}}e.Util=ve;let Ke=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function Xe(ee){if(ee[0]>="\xEF"){let q;if(ee[0]==="\xFE"&&ee[1]==="\xFF"?q="utf-16be":ee[0]==="\xFF"&&ee[1]==="\xFE"?q="utf-16le":ee[0]==="\xEF"&&ee[1]==="\xBB"&&ee[2]==="\xBF"&&(q="utf-8"),q)try{let se=new TextDecoder(q,{fatal:!0}),pe=Q(ee);return se.decode(pe)}catch(se){x(`stringToPDFString: "${se}".`)}}let z=[];for(let q=0,se=ee.length;q<se;q++){let pe=Ke[ee.charCodeAt(q)];z.push(pe?String.fromCharCode(pe):ee.charAt(q))}return z.join("")}function vt(ee){return ee.replace(/([()\\\n\r])/g,z=>z===`
`?"\\n":z==="\r"?"\\r":`\\${z}`)}function Me(ee){return/^[\x00-\x7F]*$/.test(ee)}function Te(ee){let z=["\xFE\xFF"];for(let q=0,se=ee.length;q<se;q++){let pe=ee.charCodeAt(q);z.push(String.fromCharCode(pe>>8&255),String.fromCharCode(pe&255))}return z.join("")}function Ln(ee){return decodeURIComponent(escape(ee))}function va(ee){return unescape(encodeURIComponent(ee))}function ya(ee){return typeof ee=="object"&&ee!==null&&ee.byteLength!==void 0}function Ea(ee,z){if(ee.length!==z.length)return!1;for(let q=0,se=ee.length;q<se;q++)if(ee[q]!==z[q])return!1;return!0}function Da(ee=new Date){return[ee.getUTCFullYear().toString(),(ee.getUTCMonth()+1).toString().padStart(2,"0"),ee.getUTCDate().toString().padStart(2,"0"),ee.getUTCHours().toString().padStart(2,"0"),ee.getUTCMinutes().toString().padStart(2,"0"),ee.getUTCSeconds().toString().padStart(2,"0")].join("")}function Ma(){let ee=Object.create(null),z=!1;return Object.defineProperty(ee,"settled",{get(){return z}}),ee.promise=new Promise(function(q,se){ee.resolve=function(pe){z=!0,q(pe)},ee.reject=function(pe){z=!0,se(pe)}}),ee}},(o,e,t)=>{var n=t(3)},(o,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isNodeJS=void 0;let t=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");e.isNodeJS=t},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.setPDFNetworkStreamFactory=setPDFNetworkStreamFactory,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(5),_display_utils=__w_pdfjs_require__(8),_font_loader=__w_pdfjs_require__(11),_canvas=__w_pdfjs_require__(12),_worker_options=__w_pdfjs_require__(15),_is_node=__w_pdfjs_require__(3),_message_handler=__w_pdfjs_require__(16),_metadata=__w_pdfjs_require__(17),_optional_content_config=__w_pdfjs_require__(18),_transport_stream=__w_pdfjs_require__(19),_xfa_text=__w_pdfjs_require__(20);let DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DefaultCanvasFactory=_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultStandardFontDataFactory=_display_utils.DOMStandardFontDataFactory;if(exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){let{NodeCanvasFactory:o,NodeCMapReaderFactory:e,NodeStandardFontDataFactory:t}=__w_pdfjs_require__(21);exports.DefaultCanvasFactory=DefaultCanvasFactory=o,exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory=e,exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory=t}let createPDFNetworkStream;function setPDFNetworkStreamFactory(o){createPDFNetworkStream=o}function getDocument(o){let e=new PDFDocumentLoadingTask,t;if(typeof o=="string"||o instanceof URL)t={url:o};else if((0,_util.isArrayBuffer)(o))t={data:o};else if(o instanceof PDFDataRangeTransport)t={range:o};else{if(typeof o!="object")throw new Error("Invalid parameter in getDocument, need either string, URL, TypedArray, or parameter object.");if(!o.url&&!o.data&&!o.range)throw new Error("Invalid parameter object: need either .data, .range or .url");t=o}let n=Object.create(null),r=null,s=null;for(let m in t){let u=t[m];switch(m){case"url":if(typeof window<"u")try{n[m]=new URL(u,window.location).href;continue}catch(i){(0,_util.warn)(`Cannot create valid URL: "${i}".`)}else if(typeof u=="string"||u instanceof URL){n[m]=u.toString();continue}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.");case"range":r=u;continue;case"worker":s=u;continue;case"data":if(_is_node.isNodeJS&&typeof Buffer<"u"&&u instanceof Buffer)n[m]=new Uint8Array(u);else{if(u instanceof Uint8Array)break;if(typeof u=="string")n[m]=(0,_util.stringToBytes)(u);else if(typeof u=="object"&&u!==null&&!isNaN(u.length))n[m]=new Uint8Array(u);else if((0,_util.isArrayBuffer)(u))n[m]=new Uint8Array(u);else throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}continue}n[m]=u}if(n.CMapReaderFactory=n.CMapReaderFactory||DefaultCMapReaderFactory,n.StandardFontDataFactory=n.StandardFontDataFactory||DefaultStandardFontDataFactory,n.ignoreErrors=n.stopAtErrors!==!0,n.fontExtraProperties=n.fontExtraProperties===!0,n.pdfBug=n.pdfBug===!0,n.enableXfa=n.enableXfa===!0,(!Number.isInteger(n.rangeChunkSize)||n.rangeChunkSize<1)&&(n.rangeChunkSize=DEFAULT_RANGE_CHUNK_SIZE),(typeof n.docBaseUrl!="string"||(0,_display_utils.isDataScheme)(n.docBaseUrl))&&(n.docBaseUrl=null),(!Number.isInteger(n.maxImageSize)||n.maxImageSize<-1)&&(n.maxImageSize=-1),typeof n.cMapUrl!="string"&&(n.cMapUrl=null),typeof n.standardFontDataUrl!="string"&&(n.standardFontDataUrl=null),typeof n.useWorkerFetch!="boolean"&&(n.useWorkerFetch=n.CMapReaderFactory===_display_utils.DOMCMapReaderFactory&&n.StandardFontDataFactory===_display_utils.DOMStandardFontDataFactory),typeof n.isEvalSupported!="boolean"&&(n.isEvalSupported=!0),typeof n.disableFontFace!="boolean"&&(n.disableFontFace=_is_node.isNodeJS),typeof n.useSystemFonts!="boolean"&&(n.useSystemFonts=!_is_node.isNodeJS&&!n.disableFontFace),(typeof n.ownerDocument!="object"||n.ownerDocument===null)&&(n.ownerDocument=globalThis.document),typeof n.disableRange!="boolean"&&(n.disableRange=!1),typeof n.disableStream!="boolean"&&(n.disableStream=!1),typeof n.disableAutoFetch!="boolean"&&(n.disableAutoFetch=!1),(0,_util.setVerbosityLevel)(n.verbosity),!s){let m={verbosity:n.verbosity,port:_worker_options.GlobalWorkerOptions.workerPort};s=m.port?PDFWorker.fromPort(m):new PDFWorker(m),e._worker=s}let l=e.docId;return s.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");let m=_fetchDocument(s,n,r,l),u=new Promise(function(i){let c;r?c=new _transport_stream.PDFDataTransportStream({length:n.length,initialData:n.initialData,progressiveDone:n.progressiveDone,contentDispositionFilename:n.contentDispositionFilename,disableRange:n.disableRange,disableStream:n.disableStream},r):n.data||(c=createPDFNetworkStream({url:n.url,length:n.length,httpHeaders:n.httpHeaders,withCredentials:n.withCredentials,rangeChunkSize:n.rangeChunkSize,disableRange:n.disableRange,disableStream:n.disableStream})),i(c)});return Promise.all([m,u]).then(function([i,c]){if(e.destroyed)throw new Error("Loading aborted");let f=new _message_handler.MessageHandler(l,i,s.port),F=new WorkerTransport(f,e,c,n);e._transport=F,f.send("Ready",null)})}).catch(e._capability.reject),e}async function _fetchDocument(o,e,t,n){if(o.destroyed)throw new Error("Worker was destroyed");t&&(e.length=t.length,e.initialData=t.initialData,e.progressiveDone=t.progressiveDone,e.contentDispositionFilename=t.contentDispositionFilename);let r=await o.messageHandler.sendWithPromise("GetDocRequest",{docId:n,apiVersion:"2.16.105",source:{data:e.data,url:e.url,password:e.password,disableAutoFetch:e.disableAutoFetch,rangeChunkSize:e.rangeChunkSize,length:e.length},maxImageSize:e.maxImageSize,disableFontFace:e.disableFontFace,docBaseUrl:e.docBaseUrl,ignoreErrors:e.ignoreErrors,isEvalSupported:e.isEvalSupported,fontExtraProperties:e.fontExtraProperties,enableXfa:e.enableXfa,useSystemFonts:e.useSystemFonts,cMapUrl:e.useWorkerFetch?e.cMapUrl:null,standardFontDataUrl:e.useWorkerFetch?e.standardFontDataUrl:null});if(e.data&&(e.data=null),o.destroyed)throw new Error("Worker was destroyed");return r}class PDFDocumentLoadingTask{static#e=0;constructor(){this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId=`d${PDFDocumentLoadingTask.#e++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null,this.onUnsupportedFeature=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0,await this._transport?.destroy(),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(e,t,n=!1,r=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=r,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(let n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(let n of this._progressListeners)n(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(let t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(e,t){this._pdfInfo=e,this._transport=t,Object.defineProperty(this,"fingerprint",{get(){return(0,_display_utils.deprecated)("`PDFDocumentProxy.fingerprint`, please use `PDFDocumentProxy.fingerprints` instead."),this.fingerprints[0]}}),Object.defineProperty(this,"getStats",{value:async()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getStats`, please use the `PDFDocumentProxy.stats`-getter instead."),this.stats||{streamTypes:{},fontTypes:{}})})}get annotationStorage(){return this._transport.annotationStorage}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get stats(){return this._transport.stats}get isPureXfa(){return!!this._transport._htmlForXfa}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}saveDocument(){return this._transport.annotationStorage.size<=0&&(0,_display_utils.deprecated)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead."),this._transport.saveDocument()}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(e,t,n,r,s=!1){this._pageIndex=e,this._pageInfo=t,this._ownerDocument=r,this._transport=n,this._stats=s?new _display_utils.StatTimer:null,this._pdfBug=s,this.commonObjs=n.commonObjs,this.objs=new PDFObjects,this._bitmaps=new Set,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this._annotationPromises=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:r=0,dontFlip:s=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:s})}getAnnotations({intent:e="display"}={}){let t=this._transport.getRenderingIntent(e),n=this._annotationPromises.get(t.cacheKey);return n||(n=this._transport.getAnnotations(this._pageIndex,t.renderingIntent),this._annotationPromises.set(t.cacheKey,n),n=n.then(r=>{for(let s of r)s.titleObj!==void 0&&Object.defineProperty(s,"title",{get(){return(0,_display_utils.deprecated)("`title`-property on annotation, please use `titleObj` instead."),s.titleObj.str}}),s.contentsObj!==void 0&&Object.defineProperty(s,"contents",{get(){return(0,_display_utils.deprecated)("`contents`-property on annotation, please use `contentsObj` instead."),s.contentsObj.str}});return r})),n}getJSActions(){return this._jsActionsPromise||=this._transport.getPageJSActions(this._pageIndex)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,viewport:t,intent:n="display",annotationMode:r=_util.AnnotationMode.ENABLE,transform:s=null,imageLayer:l=null,canvasFactory:m=null,background:u=null,optionalContentConfigPromise:i=null,annotationCanvasMap:c=null,pageColors:f=null,printAnnotationStorage:F=null}){arguments[0]?.renderInteractiveForms!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `renderInteractiveForms`-option, please use the `annotationMode`-option instead."),arguments[0].renderInteractiveForms===!0&&r===_util.AnnotationMode.ENABLE&&(r=_util.AnnotationMode.ENABLE_FORMS)),arguments[0]?.includeAnnotationStorage!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `includeAnnotationStorage`-option, please use the `annotationMode`-option instead."),arguments[0].includeAnnotationStorage===!0&&r===_util.AnnotationMode.ENABLE&&(r=_util.AnnotationMode.ENABLE_STORAGE)),this._stats&&this._stats.time("Overall");let S=this._transport.getRenderingIntent(n,r,F);this.pendingCleanup=!1,i||(i=this._transport.getOptionalContentConfig());let d=this._intentStates.get(S.cacheKey);d||(d=Object.create(null),this._intentStates.set(S.cacheKey,d)),d.streamReaderCancelTimeout&&(clearTimeout(d.streamReaderCancelTimeout),d.streamReaderCancelTimeout=null);let _=m||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),T=!!(S.renderingIntent&_util.RenderingIntentFlag.PRINT);d.displayReadyCapability||(d.displayReadyCapability=(0,_util.createPromiseCapability)(),d.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(S));let R=k=>{d.renderTasks.delete(E),(this.cleanupAfterRender||T)&&(this.pendingCleanup=!0),this._tryCleanup(),k?(E.capability.reject(k),this._abortOperatorList({intentState:d,reason:k instanceof Error?k:new Error(k)})):E.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"))},E=new InternalRenderTask({callback:R,params:{canvasContext:e,viewport:t,transform:s,imageLayer:l,background:u},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:d.operatorList,pageIndex:this._pageIndex,canvasFactory:_,useRequestAnimationFrame:!T,pdfBug:this._pdfBug,pageColors:f});(d.renderTasks||=new Set).add(E);let P=E.task;return Promise.all([d.displayReadyCapability.promise,i]).then(([k,p])=>{if(this.pendingCleanup){R();return}this._stats&&this._stats.time("Rendering"),E.initializeGraphics({transparency:k,optionalContentConfig:p}),E.operatorListChanged()}).catch(R),P}getOperatorList({intent:e="display",annotationMode:t=_util.AnnotationMode.ENABLE,printAnnotationStorage:n=null}={}){function r(){l.operatorList.lastChunk&&(l.opListReadCapability.resolve(l.operatorList),l.renderTasks.delete(m))}let s=this._transport.getRenderingIntent(e,t,n,!0),l=this._intentStates.get(s.cacheKey);l||(l=Object.create(null),this._intentStates.set(s.cacheKey,l));let m;return l.opListReadCapability||(m=Object.create(null),m.operatorListChanged=r,l.opListReadCapability=(0,_util.createPromiseCapability)(),(l.renderTasks||=new Set).add(m),l.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(s)),l.opListReadCapability.promise}streamTextContent({disableCombineTextItems:e=!1,includeMarkedContent:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,combineTextItems:e!==!0,includeMarkedContent:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>_xfa_text.XfaText.textContent(n));let t=this.streamTextContent(e);return new Promise(function(n,r){function s(){l.read().then(function({value:u,done:i}){if(i){n(m);return}Object.assign(m.styles,u.styles),m.items.push(...u.items),s()},r)}let l=t.getReader(),m={items:[],styles:Object.create(null)};s()})}getStructTree(){return this._structTreePromise||=this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(let n of t.renderTasks)e.push(n.completed),n.cancel();this.objs.clear();for(let t of this._bitmaps)t.close();return this._bitmaps.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,this.pendingCleanup=!1,Promise.all(e)}cleanup(e=!1){return this.pendingCleanup=!0,this._tryCleanup(e)}_tryCleanup(e=!1){if(!this.pendingCleanup)return!1;for(let{renderTasks:t,operatorList:n}of this._intentStates.values())if(t.size>0||!n.lastChunk)return!1;this._intentStates.clear(),this.objs.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,e&&this._stats&&(this._stats=new _display_utils.StatTimer);for(let t of this._bitmaps)t.close();return this._bitmaps.clear(),this.pendingCleanup=!1,!0}_startRenderPage(e,t){let n=this._intentStates.get(t);n&&(this._stats&&this._stats.timeEnd("Page Request"),n.displayReadyCapability&&n.displayReadyCapability.resolve(e))}_renderPageChunk(e,t){for(let n=0,r=e.length;n<r;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let n of t.renderTasks)n.operatorListChanged();e.lastChunk&&this._tryCleanup()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageMap:n}){let s=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:n}).getReader(),l=this._intentStates.get(t);l.streamReader=s;let m=()=>{s.read().then(({value:u,done:i})=>{if(i){l.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(u,l),m())},u=>{if(l.streamReader=null,!this._transport.destroyed){if(l.operatorList){l.operatorList.lastChunk=!0;for(let i of l.renderTasks)i.operatorListChanged();this._tryCleanup()}if(l.displayReadyCapability)l.displayReadyCapability.reject(u);else if(l.opListReadCapability)l.opListReadCapability.reject(u);else throw u}})};m()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(!n){if(e.renderTasks.size>0)return;if(t instanceof _display_utils.RenderingCancelledException){e.streamReaderCancelTimeout=setTimeout(()=>{this._abortOperatorList({intentState:e,reason:t,force:!0}),e.streamReaderCancelTimeout=null},RENDERING_CANCELLED_TIMEOUT);return}}if(e.streamReader.cancel(new _util.AbortException(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(let[r,s]of this._intentStates)if(s===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){this._listeners=[],this._deferred=Promise.resolve()}postMessage(e,t){let n={data:structuredClone(e,t)};this._deferred.then(()=>{for(let r of this._listeners)r.call(this,n)})}addEventListener(e,t){this._listeners.push(t)}removeEventListener(e,t){let n=this._listeners.indexOf(t);this._listeners.splice(n,1)}terminate(){this._listeners.length=0}}exports.LoopbackPort=LoopbackPort;let PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_is_node.isNodeJS&&typeof Qo=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){let o=document?.currentScript?.src;o&&(PDFWorkerUtil.fallbackWorkerSrc=o.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(o,e){let t;try{if(t=new URL(o),!t.origin||t.origin==="null")return!1}catch{return!1}let n=new URL(e,t);return t.origin===n.origin},PDFWorkerUtil.createCDNWrapper=function(o){let e=`importScripts("${o}");`;return URL.createObjectURL(new Blob([e]))}}class PDFWorker{static#workerPorts=new WeakMap;constructor({name:o=null,port:e=null,verbosity:t=(0,_util.getVerbosityLevel)()}={}){if(e&&PDFWorker.#workerPorts.has(e))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=o,this.destroyed=!1,this.verbosity=t,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,e){PDFWorker.#workerPorts.set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(o){this._port=o,this._messageHandler=new _message_handler.MessageHandler("main","worker",o),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve()}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:o}=PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,o)||(o=PDFWorkerUtil.createCDNWrapper(new URL(o,window.location).href));let e=new Worker(o),t=new _message_handler.MessageHandler("main","worker",e),n=()=>{e.removeEventListener("error",r),t.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=()=>{this._webWorker||n()};e.addEventListener("error",r),t.on("test",l=>{if(e.removeEventListener("error",r),this.destroyed){n();return}l?(this._messageHandler=t,this._port=e,this._webWorker=e,this._readyCapability.resolve(),t.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),t.destroy(),e.terminate())}),t.on("ready",l=>{if(e.removeEventListener("error",r),this.destroyed){n();return}try{s()}catch{this._setupFakeWorker()}});let s=()=>{let l=new Uint8Array;t.send("test",l,[l.buffer])};s();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then(o=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let e=new LoopbackPort;this._port=e;let t=`fake${PDFWorkerUtil.fakeWorkerId++}`,n=new _message_handler.MessageHandler(t+"_worker",t,e);o.setup(n,e);let r=new _message_handler.MessageHandler(t,t+"_worker",e);this._messageHandler=r,this._readyCapability.resolve(),r.send("configure",{verbosity:this.verbosity})}).catch(o=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${o.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),PDFWorker.#workerPorts.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(o){if(!o?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return this.#workerPorts.has(o.port)?this.#workerPorts.get(o.port):new PDFWorker(o)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){let loader=async()=>{let mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&typeof Qo=="function"){let worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}}exports.PDFWorker=PDFWorker,PDFWorker.getWorkerSrc=function(){return(0,_display_utils.deprecated)("`PDFWorker.getWorkerSrc()`, please use `PDFWorker.workerSrc` instead."),this.workerSrc};class WorkerTransport{#e=null;#t=new Map;#r=new Map;#n=null;constructor(e,t,n,r){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({docId:t.docId,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this._params=r,r.useWorkerFetch||(this.CMapReaderFactory=new r.CMapReaderFactory({baseUrl:r.cMapUrl,isCompressed:r.cMapPacked}),this.StandardFontDataFactory=new r.StandardFontDataFactory({baseUrl:r.standardFontDataUrl})),this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}get stats(){return this.#e}getRenderingIntent(e,t=_util.AnnotationMode.ENABLE,n=null,r=!1){let s=_util.RenderingIntentFlag.DISPLAY,l=null;switch(e){case"any":s=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":s=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${e}`)}switch(t){case _util.AnnotationMode.DISABLE:s+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:s+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:s+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,l=(s&_util.RenderingIntentFlag.PRINT&&n instanceof _annotation_storage.PrintAnnotationStorage?n:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${t}`)}return r&&(s+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:s,cacheKey:`${s}_${_annotation_storage.AnnotationStorage.getHash(l)}`,annotationStorageMap:l}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));let e=[];for(let n of this.#t.values())e.push(n._destroy());this.#t.clear(),this.#r.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#n=null,this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null,this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,r)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=s=>{this._lastProgress={loaded:s.loaded,total:s.total}},r.onPull=()=>{this._fullReader.read().then(function({value:s,done:l}){if(l){r.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(s),"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(s),1,[s])}).catch(s=>{r.error(s)})},r.onCancel=s=>{this._fullReader.cancel(s),r.ready.catch(l=>{if(!this.destroyed)throw l})}}),e.on("ReaderHeadersReady",n=>{let r=(0,_util.createPromiseCapability)(),s=this._fullReader;return s.headersReady.then(()=>{(!s.isStreamingSupported||!s.isRangeSupported)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),s.onProgress=l=>{t.onProgress?.({loaded:l.loaded,total:l.total})}),r.resolve({isStreamingSupported:s.isStreamingSupported,isRangeSupported:s.isRangeSupported,contentLength:s.contentLength})},r.reject),r.promise}),e.on("GetRangeReader",(n,r)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let s=this._networkStream.getRangeReader(n.begin,n.end);if(!s){r.close();return}r.onPull=()=>{s.read().then(function({value:l,done:m}){if(m){r.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(l),"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(l),1,[l])}).catch(l=>{r.error(l)})},r.onCancel=l=>{s.cancel(l),r.ready.catch(m=>{if(!this.destroyed)throw m})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new PDFDocumentProxy(n,this))}),e.on("DocException",function(n){let r;switch(n.name){case"PasswordException":r=new _util.PasswordException(n.message,n.code);break;case"InvalidPDFException":r=new _util.InvalidPDFException(n.message);break;case"MissingPDFException":r=new _util.MissingPDFException(n.message);break;case"UnexpectedResponseException":r=new _util.UnexpectedResponseException(n.message,n.status);break;case"UnknownErrorException":r=new _util.UnknownErrorException(n.message,n.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}t._capability.reject(r)}),e.on("PasswordRequest",n=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),t.onPassword){let r=s=>{s instanceof Error?this._passwordCapability.reject(s):this._passwordCapability.resolve({password:s})};try{t.onPassword(r,n.code)}catch(s){this._passwordCapability.reject(s)}}else this._passwordCapability.reject(new _util.PasswordException(n.message,n.code));return this._passwordCapability.promise}),e.on("DataLoaded",n=>{t.onProgress?.({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;this.#t.get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,r,s])=>{if(!this.destroyed&&!this.commonObjs.has(n))switch(r){case"Font":let l=this._params;if("error"in s){let i=s.error;(0,_util.warn)(`Error during font loading: ${i}`),this.commonObjs.resolve(n,i);break}let m=null;l.pdfBug&&globalThis.FontInspector?.enabled&&(m={registerFont(i,c){globalThis.FontInspector.fontAdded(i,c)}});let u=new _font_loader.FontFaceObject(s,{isEvalSupported:l.isEvalSupported,disableFontFace:l.disableFontFace,ignoreErrors:l.ignoreErrors,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),fontRegistry:m});this.fontLoader.bind(u).catch(i=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!l.fontExtraProperties&&u.data&&(u.data=null),this.commonObjs.resolve(n,u)});break;case"FontPath":case"Image":this.commonObjs.resolve(n,s);break;default:throw new Error(`Got unknown common object type ${r}`)}}),e.on("obj",([n,r,s,l])=>{if(this.destroyed)return;let m=this.#t.get(r);if(!m.objs.has(n))switch(s){case"Image":m.objs.resolve(n,l);let u=8e6;if(l){let i;if(l.bitmap){let{bitmap:c,width:f,height:F}=l;i=f*F*4,m._bitmaps.add(c)}else i=l.data?.length||0;i>u&&(m.cleanupAfterRender=!0)}break;case"Pattern":m.objs.resolve(n,l);break;default:throw new Error(`Got unknown object type ${s}`)}}),e.on("DocProgress",n=>{this.destroyed||t.onProgress?.({loaded:n.loaded,total:n.total})}),e.on("DocStats",n=>{this.destroyed||(this.#e=Object.freeze({streamTypes:Object.freeze(n.streamTypes),fontTypes:Object.freeze(n.fontTypes)}))}),e.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),e.on("FetchBuiltInCMap",n=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.CMapReaderFactory?this.CMapReaderFactory.fetch(n):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),e.on("FetchStandardFontData",n=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.StandardFontDataFactory?this.StandardFontDataFactory.fetch(n):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}_onUnsupportedFeature({featureId:e}){this.destroyed||this.loadingTask.onUnsupportedFeature?.(e)}getData(){return this.messageHandler.sendWithPromise("GetData",null)}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));let t=e-1,n=this.#r.get(t);if(n)return n;let r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(s=>{if(this.destroyed)throw new Error("Transport destroyed");let l=new PDFPageProxy(t,s,this,this._params.ownerDocument,this._params.pdfBug);return this.#t.set(t,l),l});return this.#r.set(t,r),r}getPageIndex(e){return typeof e!="object"||e===null||!Number.isInteger(e.num)||e.num<0||!Number.isInteger(e.gen)||e.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen})}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}saveDocument(){return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:this.annotationStorage.serializable,filename:this._fullReader?.filename??null}).finally(()=>{this.annotationStorage.resetModified()})}getFieldObjects(){return this._getFieldObjectsPromise||=this.messageHandler.sendWithPromise("GetFieldObjects",null)}hasJSActions(){return this._hasJSActionsPromise||=this.messageHandler.sendWithPromise("HasJSActions",null)}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(e=>new _optional_content_config.OptionalContentConfig(e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){return this.#n||=this.messageHandler.sendWithPromise("GetMetadata",null).then(e=>({info:e[0],metadata:e[1]?new _metadata.Metadata(e[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}))}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(await this.messageHandler.sendWithPromise("Cleanup",null),!this.destroyed){for(let t of this.#t.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#n=null,this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null}}get loadingParams(){let e=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:e.disableAutoFetch,enableXfa:e.enableXfa})}}class PDFObjects{#e=Object.create(null);#t(e){let t=this.#e[e];return t||(this.#e[e]={capability:(0,_util.createPromiseCapability)(),data:null})}get(e,t=null){if(t){let r=this.#t(e);return r.capability.promise.then(()=>t(r.data)),null}let n=this.#e[e];if(!n?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){return this.#e[e]?.capability.settled||!1}resolve(e,t=null){let n=this.#t(e);n.data=t,n.capability.resolve()}clear(){this.#e=Object.create(null)}}class RenderTask{#e=null;constructor(e){this.#e=e,this.onContinue=null}get promise(){return this.#e.capability.promise}cancel(){this.#e.cancel()}get separateAnnots(){let{separateAnnots:e}=this.#e.operatorList;if(!e)return!1;let{annotationCanvasMap:t}=this.#e;return e.form||e.canvas&&t?.size>0}}exports.RenderTask=RenderTask;class InternalRenderTask{static#e=new WeakSet;constructor({callback:e,params:t,objs:n,commonObjs:r,annotationCanvasMap:s,operatorList:l,pageIndex:m,canvasFactory:u,useRequestAnimationFrame:i=!1,pdfBug:c=!1,pageColors:f=null}){this.callback=e,this.params=t,this.objs=n,this.commonObjs=r,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=l,this._pageIndex=m,this.canvasFactory=u,this._pdfBug=c,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=i===!0&&typeof window<"u",this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(InternalRenderTask.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");InternalRenderTask.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:n,viewport:r,transform:s,imageLayer:l,background:m}=this.params;this.gfx=new _canvas.CanvasGraphics(n,this.commonObjs,this.objs,this.canvasFactory,l,t,this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:s,viewport:r,transparency:e,background:m}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}cancel(e=null){this.running=!1,this.cancelled=!0,this.gfx&&this.gfx.endDrawing(),this._canvas&&InternalRenderTask.#e.delete(this._canvas),this.callback(e||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas"))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}this.stepper&&this.stepper.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&InternalRenderTask.#e.delete(this._canvas),this.callback())))}}let version="2.16.105";exports.version=version;let build="172ccdbe5";exports.build=build},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PrintAnnotationStorage=e.AnnotationStorage=void 0;var n=t(1),r=t(6),s=t(10);class l{constructor(){this._storage=new Map,this._modified=!1,this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(i,c){let f=this._storage.get(i);return f===void 0?c:Object.assign(c,f)}getRawValue(i){return this._storage.get(i)}remove(i){if(this._storage.delete(i),this._storage.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let c of this._storage.values())if(c instanceof r.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(i,c){let f=this._storage.get(i),F=!1;if(f!==void 0)for(let[S,d]of Object.entries(c))f[S]!==d&&(F=!0,f[S]=d);else F=!0,this._storage.set(i,c);F&&this.#e(),c instanceof r.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(c.constructor._type)}has(i){return this._storage.has(i)}getAll(){return this._storage.size>0?(0,n.objectFromMap)(this._storage):null}get size(){return this._storage.size}#e(){this._modified||(this._modified=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this._modified&&(this._modified=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new m(this)}get serializable(){if(this._storage.size===0)return null;let i=new Map;for(let[c,f]of this._storage){let F=f instanceof r.AnnotationEditor?f.serialize():f;F&&i.set(c,F)}return i}static getHash(i){if(!i)return"";let c=new s.MurmurHash3_64;for(let[f,F]of i)c.update(`${f}:${JSON.stringify(F)}`);return c.hexdigest()}}e.AnnotationStorage=l;class m extends l{#e=null;constructor(i){super(),this.#e=structuredClone(i.serializable)}get print(){(0,n.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}}e.PrintAnnotationStorage=m},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditor=void 0;var n=t(7),r=t(1);class s{#e=this.focusin.bind(this);#t=this.focusout.bind(this);#r=!1;#n=!1;#i=!1;#u=s._zIndex++;static _colorManager=new n.ColorManager;static _zIndex=1;constructor(m){this.constructor===s&&(0,r.unreachable)("Cannot initialize AnnotationEditor."),this.parent=m.parent,this.id=m.id,this.width=this.height=null,this.pageIndex=m.parent.pageIndex,this.name=m.name,this.div=null;let[u,i]=this.parent.viewportBaseDimensions;this.x=m.x/u,this.y=m.y/i,this.rotation=this.parent.viewport.rotation,this.isAttachedToDOM=!1}static get _defaultLineColor(){return(0,r.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#u}focusin(m){this.#r?this.#r=!1:this.parent.setSelected(this)}focusout(m){!this.isAttachedToDOM||m.relatedTarget?.closest(`#${this.id}`)||(m.preventDefault(),this.parent.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.parent.addToAnnotationStorage(this)}dragstart(m){let u=this.parent.div.getBoundingClientRect();this.startX=m.clientX-u.x,this.startY=m.clientY-u.y,m.dataTransfer.setData("text/plain",this.id),m.dataTransfer.effectAllowed="move"}setAt(m,u,i,c){let[f,F]=this.parent.viewportBaseDimensions;[i,c]=this.screenToPageTranslation(i,c),this.x=(m+i)/f,this.y=(u+c)/F,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}translate(m,u){let[i,c]=this.parent.viewportBaseDimensions;[m,u]=this.screenToPageTranslation(m,u),this.x+=m/i,this.y+=u/c,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}screenToPageTranslation(m,u){let{rotation:i}=this.parent.viewport;switch(i){case 90:return[u,-m];case 180:return[-m,-u];case 270:return[-u,m];default:return[m,u]}}setDims(m,u){let[i,c]=this.parent.viewportBaseDimensions;this.div.style.width=`${100*m/i}%`,this.div.style.height=`${100*u/c}%`}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#e),this.div.addEventListener("focusout",this.#t);let[m,u]=this.getInitialTranslation();return this.translate(m,u),(0,n.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(m){let u=n.KeyboardManager.platform.isMac;if(m.button!==0||m.ctrlKey&&u){m.preventDefault();return}m.ctrlKey&&!u||m.shiftKey||m.metaKey&&u?this.parent.toggleSelected(this):this.parent.setSelected(this),this.#r=!0}getRect(m,u){let[i,c]=this.parent.viewportBaseDimensions,[f,F]=this.parent.pageDimensions,S=f*m/i,d=F*u/c,_=this.x*f,T=this.y*F,R=this.width*f,E=this.height*F;switch(this.rotation){case 0:return[_+S,F-T-d-E,_+S+R,F-T-d];case 90:return[_+d,F-T+S,_+d+E,F-T+S+R];case 180:return[_-S-R,F-T+d,_-S,F-T+d+E];case 270:return[_-d-E,F-T-S-R,_-d,F-T-S];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(m,u){let[i,c,f,F]=m,S=f-i,d=F-c;switch(this.rotation){case 0:return[i,u-F,S,d];case 90:return[i,u-c,d,S];case 180:return[f,u-c,S,d];case 270:return[f,u-F,d,S];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#i=!0}disableEditMode(){this.#i=!1}isInEditMode(){return this.#i}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#e)}serialize(){(0,r.unreachable)("An editor must be serializable")}static deserialize(m,u){let i=new this.prototype.constructor({parent:u,id:u.getNextId()});i.rotation=m.rotation;let[c,f]=u.pageDimensions,[F,S,d,_]=i.getRectInCurrentCoords(m.rect,f);return i.x=F/c,i.y=S/f,i.width=d/c,i.height=_/f,i}remove(){this.div.removeEventListener("focusin",this.#e),this.div.removeEventListener("focusout",this.#t),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){this.div?.classList.add("selectedEditor")}unselect(){this.div?.classList.remove("selectedEditor")}updateParams(m,u){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return this.#n}set isEditing(m){this.#n=m,m?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}}e.AnnotationEditor=s},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.KeyboardManager=e.CommandManager=e.ColorManager=e.AnnotationEditorUIManager=void 0,e.bindEvents=s,e.opacityToHex=l;var n=t(1),r=t(8);function s(S,d,_){for(let T of _)d.addEventListener(T,S[T].bind(S))}function l(S){return Math.round(Math.min(255,Math.max(1,255*S))).toString(16).padStart(2,"0")}class m{#e=0;getId(){return`${n.AnnotationEditorPrefix}${this.#e++}`}}class u{#e=[];#t=!1;#r;#n=-1;constructor(d=128){this.#r=d}add({cmd:d,undo:_,mustExec:T,type:R=NaN,overwriteIfSameType:E=!1,keepUndo:P=!1}){if(T&&d(),this.#t)return;let k={cmd:d,undo:_,type:R};if(this.#n===-1){this.#e.length>0&&(this.#e.length=0),this.#n=0,this.#e.push(k);return}if(E&&this.#e[this.#n].type===R){P&&(k.undo=this.#e[this.#n].undo),this.#e[this.#n]=k;return}let p=this.#n+1;p===this.#r?this.#e.splice(0,1):(this.#n=p,p<this.#e.length&&this.#e.splice(p)),this.#e.push(k)}undo(){this.#n!==-1&&(this.#t=!0,this.#e[this.#n].undo(),this.#t=!1,this.#n-=1)}redo(){this.#n<this.#e.length-1&&(this.#n+=1,this.#t=!0,this.#e[this.#n].cmd(),this.#t=!1)}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#e.length-1}destroy(){this.#e=null}}e.CommandManager=u;class i{constructor(d){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let _=i.platform.isMac;for(let[T,R]of d)for(let E of T){let P=E.startsWith("mac+");_&&P?(this.callbacks.set(E.slice(4),R),this.allKeys.add(E.split("+").at(-1))):!_&&!P&&(this.callbacks.set(E,R),this.allKeys.add(E.split("+").at(-1)))}}static get platform(){let d=typeof navigator<"u"?navigator.platform:"";return(0,n.shadow)(this,"platform",{isWin:d.includes("Win"),isMac:d.includes("Mac")})}#e(d){d.altKey&&this.buffer.push("alt"),d.ctrlKey&&this.buffer.push("ctrl"),d.metaKey&&this.buffer.push("meta"),d.shiftKey&&this.buffer.push("shift"),this.buffer.push(d.key);let _=this.buffer.join("+");return this.buffer.length=0,_}exec(d,_){if(!this.allKeys.has(_.key))return;let T=this.callbacks.get(this.#e(_));T&&(T.bind(d)(),_.stopPropagation(),_.preventDefault())}}e.KeyboardManager=i;class c{#e=null;copy(d){d&&(Array.isArray(d)?this.#e=d.map(_=>_.serialize()):this.#e=[d.serialize()],this.#e=this.#e.filter(_=>!!_),this.#e.length===0&&(this.#e=null))}paste(){return this.#e}isEmpty(){return this.#e===null}destroy(){this.#e=null}}class f{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){let d=new Map([["CanvasText",null],["Canvas",null]]);return(0,r.getColorValues)(d),(0,n.shadow)(this,"_colors",d)}convert(d){let _=(0,r.getRGB)(d);if(!window.matchMedia("(forced-colors: active)").matches)return _;for(let[T,R]of this._colors)if(R.every((E,P)=>E===_[P]))return f._colorsMapping.get(T);return _}getHexCode(d){let _=this._colors.get(d);return _?n.Util.makeHexColor(..._):d}}e.ColorManager=f;class F{#e=null;#t=new Map;#r=new Map;#n=new c;#i=new u;#u=0;#a=null;#o=null;#d=new m;#c=!1;#l=n.AnnotationEditorType.NONE;#s=new Set;#f=this.keydown.bind(this);#m=this.onEditingAction.bind(this);#T=this.onPageChanging.bind(this);#b={isEditing:!1,isEmpty:!0,hasEmptyClipboard:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#F=null;static _keyboardManager=new i([[["ctrl+a","mac+meta+a"],F.prototype.selectAll],[["ctrl+c","mac+meta+c"],F.prototype.copy],[["ctrl+v","mac+meta+v"],F.prototype.paste],[["ctrl+x","mac+meta+x"],F.prototype.cut],[["ctrl+z","mac+meta+z"],F.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],F.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],F.prototype.delete],[["Escape","mac+Escape"],F.prototype.unselectAll]]);constructor(d,_){this.#F=d,this.#o=_,this.#o._on("editingaction",this.#m),this.#o._on("pagechanging",this.#T)}destroy(){this.#_(),this.#o._off("editingaction",this.#m),this.#o._off("pagechanging",this.#T);for(let d of this.#r.values())d.destroy();this.#r.clear(),this.#t.clear(),this.#e=null,this.#s.clear(),this.#n.destroy(),this.#i.destroy()}onPageChanging({pageNumber:d}){this.#u=d-1}focusMainContainer(){this.#F.focus()}#v(){this.#F.addEventListener("keydown",this.#f)}#_(){this.#F.removeEventListener("keydown",this.#f)}keydown(d){this.getActive()?.shouldGetKeyboardEvents()||F._keyboardManager.exec(this,d)}onEditingAction(d){["undo","redo","cut","copy","paste","delete","selectAll"].includes(d.name)&&this[d.name]()}#p(d){Object.entries(d).some(([T,R])=>this.#b[T]!==R)&&this.#o.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#b,d)})}#w(d){this.#o.dispatch("annotationeditorparamschanged",{source:this,details:d})}setEditingState(d){d?(this.#v(),this.#p({isEditing:this.#l!==n.AnnotationEditorType.NONE,isEmpty:this.#g(),hasSomethingToUndo:this.#i.hasSomethingToUndo(),hasSomethingToRedo:this.#i.hasSomethingToRedo(),hasSelectedEditor:!1,hasEmptyClipboard:this.#n.isEmpty()})):(this.#_(),this.#p({isEditing:!1}))}registerEditorTypes(d){this.#a=d;for(let _ of this.#a)this.#w(_.defaultPropertiesToUpdate)}getId(){return this.#d.getId()}addLayer(d){this.#r.set(d.pageIndex,d),this.#c?d.enable():d.disable()}removeLayer(d){this.#r.delete(d.pageIndex)}updateMode(d){if(this.#l=d,d===n.AnnotationEditorType.NONE)this.setEditingState(!1),this.#h();else{this.setEditingState(!0),this.#y();for(let _ of this.#r.values())_.updateMode(d)}}updateToolbar(d){d!==this.#l&&this.#o.dispatch("switchannotationeditormode",{source:this,mode:d})}updateParams(d,_){for(let T of this.#s)T.updateParams(d,_);for(let T of this.#a)T.updateDefaultParams(d,_)}#y(){if(!this.#c){this.#c=!0;for(let d of this.#r.values())d.enable()}}#h(){if(this.unselectAll(),this.#c){this.#c=!1;for(let d of this.#r.values())d.disable()}}getEditors(d){let _=[];for(let T of this.#t.values())T.pageIndex===d&&_.push(T);return _}getEditor(d){return this.#t.get(d)}addEditor(d){this.#t.set(d.id,d)}removeEditor(d){this.#t.delete(d.id),this.unselect(d)}#S(d){let _=this.#r.get(d.pageIndex);_?_.addOrRebuild(d):this.addEditor(d)}setActiveEditor(d){this.#e!==d&&(this.#e=d,d&&this.#w(d.propertiesToUpdate))}toggleSelected(d){if(this.#s.has(d)){this.#s.delete(d),d.unselect(),this.#p({hasSelectedEditor:this.hasSelection});return}this.#s.add(d),d.select(),this.#w(d.propertiesToUpdate),this.#p({hasSelectedEditor:!0})}setSelected(d){for(let _ of this.#s)_!==d&&_.unselect();this.#s.clear(),this.#s.add(d),d.select(),this.#w(d.propertiesToUpdate),this.#p({hasSelectedEditor:!0})}isSelected(d){return this.#s.has(d)}unselect(d){d.unselect(),this.#s.delete(d),this.#p({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#s.size!==0}undo(){this.#i.undo(),this.#p({hasSomethingToUndo:this.#i.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#g()})}redo(){this.#i.redo(),this.#p({hasSomethingToUndo:!0,hasSomethingToRedo:this.#i.hasSomethingToRedo(),isEmpty:this.#g()})}addCommands(d){this.#i.add(d),this.#p({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#g()})}#g(){if(this.#t.size===0)return!0;if(this.#t.size===1)for(let d of this.#t.values())return d.isEmpty();return!1}delete(){if(this.#e&&this.#e.commitOrRemove(),!this.hasSelection)return;let d=[...this.#s],_=()=>{for(let R of d)R.remove()},T=()=>{for(let R of d)this.#S(R)};this.addCommands({cmd:_,undo:T,mustExec:!0})}copy(){if(this.#e&&this.#e.commitOrRemove(),this.hasSelection){let d=[];for(let _ of this.#s)_.isEmpty()||d.push(_);if(d.length===0)return;this.#n.copy(d),this.#p({hasEmptyClipboard:!1})}}cut(){this.copy(),this.delete()}paste(){if(this.#n.isEmpty())return;this.unselectAll();let d=this.#r.get(this.#u),_=this.#n.paste().map(E=>d.deserialize(E)),T=()=>{for(let E of _)this.#S(E);this.#x(_)},R=()=>{for(let E of _)E.remove()};this.addCommands({cmd:T,undo:R,mustExec:!0})}#x(d){this.#s.clear();for(let _ of d)_.isEmpty()||(this.#s.add(_),_.select());this.#p({hasSelectedEditor:!0})}selectAll(){for(let d of this.#s)d.commit();this.#x(this.#t.values())}unselectAll(){if(this.#e){this.#e.commitOrRemove();return}if(this.#x.size!==0){for(let d of this.#s)d.unselect();this.#s.clear(),this.#p({hasSelectedEditor:!1})}}isActive(d){return this.#e===d}getActive(){return this.#e}getMode(){return this.#l}}e.AnnotationEditorUIManager=F},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StatTimer=e.RenderingCancelledException=e.PixelsPerInch=e.PageViewport=e.PDFDateString=e.DOMStandardFontDataFactory=e.DOMSVGFactory=e.DOMCanvasFactory=e.DOMCMapReaderFactory=e.AnnotationPrefix=void 0,e.deprecated=g,e.getColorValues=W,e.getCurrentTransform=te,e.getCurrentTransformInverse=Z,e.getFilenameFromUrl=R,e.getPdfFilenameFromUrl=E,e.getRGB=V,e.getXfaPageViewport=D,e.isDataScheme=_,e.isPdfFile=T,e.isValidFetchUrl=k,e.loadScript=p;var n=t(9),r=t(1);let s="http://www.w3.org/2000/svg",l="pdfjs_internal_id_";e.AnnotationPrefix=l;class m{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}e.PixelsPerInch=m;class u extends n.BaseCanvasFactory{constructor({ownerDocument:N=globalThis.document}={}){super(),this._document=N}_createCanvas(N,j){let J=this._document.createElement("canvas");return J.width=N,J.height=j,J}}e.DOMCanvasFactory=u;async function i(H,N=!1){if(k(H,document.baseURI)){let j=await fetch(H);if(!j.ok)throw new Error(j.statusText);return N?new Uint8Array(await j.arrayBuffer()):(0,r.stringToBytes)(await j.text())}return new Promise((j,J)=>{let $=new XMLHttpRequest;$.open("GET",H,!0),N&&($.responseType="arraybuffer"),$.onreadystatechange=()=>{if($.readyState===XMLHttpRequest.DONE){if($.status===200||$.status===0){let B;if(N&&$.response?B=new Uint8Array($.response):!N&&$.responseText&&(B=(0,r.stringToBytes)($.responseText)),B){j(B);return}}J(new Error($.statusText))}},$.send(null)})}class c extends n.BaseCMapReaderFactory{_fetchData(N,j){return i(N,this.isCompressed).then(J=>({cMapData:J,compressionType:j}))}}e.DOMCMapReaderFactory=c;class f extends n.BaseStandardFontDataFactory{_fetchData(N){return i(N,!0)}}e.DOMStandardFontDataFactory=f;class F extends n.BaseSVGFactory{_createSVG(N){return document.createElementNS(s,N)}}e.DOMSVGFactory=F;class S{constructor({viewBox:N,scale:j,rotation:J,offsetX:$=0,offsetY:B=0,dontFlip:w=!1}){this.viewBox=N,this.scale=j,this.rotation=J,this.offsetX=$,this.offsetY=B;let x=(N[2]+N[0])/2,y=(N[3]+N[1])/2,L,a,h,b;switch(J%=360,J<0&&(J+=360),J){case 180:L=-1,a=0,h=0,b=1;break;case 90:L=0,a=1,h=1,b=0;break;case 270:L=0,a=-1,h=-1,b=0;break;case 0:L=1,a=0,h=0,b=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}w&&(h=-h,b=-b);let v,C,I,O;L===0?(v=Math.abs(y-N[1])*j+$,C=Math.abs(x-N[0])*j+B,I=Math.abs(N[3]-N[1])*j,O=Math.abs(N[2]-N[0])*j):(v=Math.abs(x-N[0])*j+$,C=Math.abs(y-N[1])*j+B,I=Math.abs(N[2]-N[0])*j,O=Math.abs(N[3]-N[1])*j),this.transform=[L*j,a*j,h*j,b*j,v-L*j*x-h*j*y,C-a*j*x-b*j*y],this.width=I,this.height=O}clone({scale:N=this.scale,rotation:j=this.rotation,offsetX:J=this.offsetX,offsetY:$=this.offsetY,dontFlip:B=!1}={}){return new S({viewBox:this.viewBox.slice(),scale:N,rotation:j,offsetX:J,offsetY:$,dontFlip:B})}convertToViewportPoint(N,j){return r.Util.applyTransform([N,j],this.transform)}convertToViewportRectangle(N){let j=r.Util.applyTransform([N[0],N[1]],this.transform),J=r.Util.applyTransform([N[2],N[3]],this.transform);return[j[0],j[1],J[0],J[1]]}convertToPdfPoint(N,j){return r.Util.applyInverseTransform([N,j],this.transform)}}e.PageViewport=S;class d extends r.BaseException{constructor(N,j){super(N,"RenderingCancelledException"),this.type=j}}e.RenderingCancelledException=d;function _(H){let N=H.length,j=0;for(;j<N&&H[j].trim()==="";)j++;return H.substring(j,j+5).toLowerCase()==="data:"}function T(H){return typeof H=="string"&&/\.pdf$/i.test(H)}function R(H){let N=H.indexOf("#"),j=H.indexOf("?"),J=Math.min(N>0?N:H.length,j>0?j:H.length);return H.substring(H.lastIndexOf("/",J)+1,J)}function E(H,N="document.pdf"){if(typeof H!="string")return N;if(_(H))return(0,r.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),N;let j=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,J=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,$=j.exec(H),B=J.exec($[1])||J.exec($[2])||J.exec($[3]);if(B&&(B=B[0],B.includes("%")))try{B=J.exec(decodeURIComponent(B))[0]}catch{}return B||N}class P{constructor(){this.started=Object.create(null),this.times=[]}time(N){N in this.started&&(0,r.warn)(`Timer is already running for ${N}`),this.started[N]=Date.now()}timeEnd(N){N in this.started||(0,r.warn)(`Timer has not been started for ${N}`),this.times.push({name:N,start:this.started[N],end:Date.now()}),delete this.started[N]}toString(){let N=[],j=0;for(let J of this.times){let $=J.name;$.length>j&&(j=$.length)}for(let J of this.times){let $=J.end-J.start;N.push(`${J.name.padEnd(j)} ${$}ms
`)}return N.join("")}}e.StatTimer=P;function k(H,N){try{let{protocol:j}=N?new URL(H,N):new URL(H);return j==="http:"||j==="https:"}catch{return!1}}function p(H,N=!1){return new Promise((j,J)=>{let $=document.createElement("script");$.src=H,$.onload=function(B){N&&$.remove(),j(B)},$.onerror=function(){J(new Error(`Cannot load script at: ${$.src}`))},(document.head||document.documentElement).append($)})}function g(H){console.log("Deprecated API usage: "+H)}let A;class M{static toDateObject(N){if(!N||typeof N!="string")return null;A||(A=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));let j=A.exec(N);if(!j)return null;let J=parseInt(j[1],10),$=parseInt(j[2],10);$=$>=1&&$<=12?$-1:0;let B=parseInt(j[3],10);B=B>=1&&B<=31?B:1;let w=parseInt(j[4],10);w=w>=0&&w<=23?w:0;let x=parseInt(j[5],10);x=x>=0&&x<=59?x:0;let y=parseInt(j[6],10);y=y>=0&&y<=59?y:0;let L=j[7]||"Z",a=parseInt(j[8],10);a=a>=0&&a<=23?a:0;let h=parseInt(j[9],10)||0;return h=h>=0&&h<=59?h:0,L==="-"?(w+=a,x+=h):L==="+"&&(w-=a,x-=h),new Date(Date.UTC(J,$,B,w,x,y))}}e.PDFDateString=M;function D(H,{scale:N=1,rotation:j=0}){let{width:J,height:$}=H.attributes.style,B=[0,0,parseInt(J),parseInt($)];return new S({viewBox:B,scale:N,rotation:j})}function V(H){if(H.startsWith("#")){let N=parseInt(H.slice(1),16);return[(N&16711680)>>16,(N&65280)>>8,N&255]}return H.startsWith("rgb(")?H.slice(4,-1).split(",").map(N=>parseInt(N)):H.startsWith("rgba(")?H.slice(5,-1).split(",").map(N=>parseInt(N)).slice(0,3):((0,r.warn)(`Not a valid color format: "${H}"`),[0,0,0])}function W(H){let N=document.createElement("span");N.style.visibility="hidden",document.body.append(N);for(let j of H.keys()){N.style.color=j;let J=window.getComputedStyle(N).color;H.set(j,V(J))}N.remove()}function te(H){let{a:N,b:j,c:J,d:$,e:B,f:w}=H.getTransform();return[N,j,J,$,B,w]}function Z(H){let{a:N,b:j,c:J,d:$,e:B,f:w}=H.getTransform().invertSelf();return[N,j,J,$,B,w]}},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseStandardFontDataFactory=e.BaseSVGFactory=e.BaseCanvasFactory=e.BaseCMapReaderFactory=void 0;var n=t(1);class r{constructor(){this.constructor===r&&(0,n.unreachable)("Cannot initialize BaseCanvasFactory.")}create(i,c){if(i<=0||c<=0)throw new Error("Invalid canvas size");let f=this._createCanvas(i,c);return{canvas:f,context:f.getContext("2d")}}reset(i,c,f){if(!i.canvas)throw new Error("Canvas is not specified");if(c<=0||f<=0)throw new Error("Invalid canvas size");i.canvas.width=c,i.canvas.height=f}destroy(i){if(!i.canvas)throw new Error("Canvas is not specified");i.canvas.width=0,i.canvas.height=0,i.canvas=null,i.context=null}_createCanvas(i,c){(0,n.unreachable)("Abstract method `_createCanvas` called.")}}e.BaseCanvasFactory=r;class s{constructor({baseUrl:i=null,isCompressed:c=!1}){this.constructor===s&&(0,n.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=i,this.isCompressed=c}async fetch({name:i}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!i)throw new Error("CMap name must be specified.");let c=this.baseUrl+i+(this.isCompressed?".bcmap":""),f=this.isCompressed?n.CMapCompressionType.BINARY:n.CMapCompressionType.NONE;return this._fetchData(c,f).catch(F=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${c}`)})}_fetchData(i,c){(0,n.unreachable)("Abstract method `_fetchData` called.")}}e.BaseCMapReaderFactory=s;class l{constructor({baseUrl:i=null}){this.constructor===l&&(0,n.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=i}async fetch({filename:i}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!i)throw new Error("Font filename must be specified.");let c=`${this.baseUrl}${i}`;return this._fetchData(c).catch(f=>{throw new Error(`Unable to load font data at: ${c}`)})}_fetchData(i){(0,n.unreachable)("Abstract method `_fetchData` called.")}}e.BaseStandardFontDataFactory=l;class m{constructor(){this.constructor===m&&(0,n.unreachable)("Cannot initialize BaseSVGFactory.")}create(i,c,f=!1){if(i<=0||c<=0)throw new Error("Invalid SVG dimensions");let F=this._createSVG("svg:svg");return F.setAttribute("version","1.1"),f||(F.setAttribute("width",`${i}px`),F.setAttribute("height",`${c}px`)),F.setAttribute("preserveAspectRatio","none"),F.setAttribute("viewBox",`0 0 ${i} ${c}`),F}createElement(i){if(typeof i!="string")throw new Error("Invalid SVG element type");return this._createSVG(i)}_createSVG(i){(0,n.unreachable)("Abstract method `_createSVG` called.")}}e.BaseSVGFactory=m},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MurmurHash3_64=void 0;var n=t(1);let r=3285377520,s=4294901760,l=65535;class m{constructor(i){this.h1=i?i&4294967295:r,this.h2=i?i&4294967295:r}update(i){let c,f;if(typeof i=="string"){c=new Uint8Array(i.length*2),f=0;for(let A=0,M=i.length;A<M;A++){let D=i.charCodeAt(A);D<=255?c[f++]=D:(c[f++]=D>>>8,c[f++]=D&255)}}else if((0,n.isArrayBuffer)(i))c=i.slice(),f=c.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");let F=f>>2,S=f-F*4,d=new Uint32Array(c.buffer,0,F),_=0,T=0,R=this.h1,E=this.h2,P=3432918353,k=461845907,p=P&l,g=k&l;for(let A=0;A<F;A++)A&1?(_=d[A],_=_*P&s|_*p&l,_=_<<15|_>>>17,_=_*k&s|_*g&l,R^=_,R=R<<13|R>>>19,R=R*5+3864292196):(T=d[A],T=T*P&s|T*p&l,T=T<<15|T>>>17,T=T*k&s|T*g&l,E^=T,E=E<<13|E>>>19,E=E*5+3864292196);switch(_=0,S){case 3:_^=c[F*4+2]<<16;case 2:_^=c[F*4+1]<<8;case 1:_^=c[F*4],_=_*P&s|_*p&l,_=_<<15|_>>>17,_=_*k&s|_*g&l,F&1?R^=_:E^=_}this.h1=R,this.h2=E}hexdigest(){let i=this.h1,c=this.h2;i^=c>>>1,i=i*3981806797&s|i*36045&l,c=c*4283543511&s|((c<<16|i>>>16)*2950163797&s)>>>16,i^=c>>>1,i=i*444984403&s|i*60499&l,c=c*3301882366&s|((c<<16|i>>>16)*3120437893&s)>>>16,i^=c>>>1;let f=(i>>>0).toString(16),F=(c>>>0).toString(16);return f.padStart(8,"0")+F.padStart(8,"0")}}e.MurmurHash3_64=m},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FontLoader=e.FontFaceObject=void 0;var n=t(1);class r{constructor({docId:u,onUnsupportedFeature:i,ownerDocument:c=globalThis.document,styleElement:f=null}){this.constructor===r&&(0,n.unreachable)("Cannot initialize BaseFontLoader."),this.docId=u,this._onUnsupportedFeature=i,this._document=c,this.nativeFontFaces=[],this.styleElement=null}addNativeFontFace(u){this.nativeFontFaces.push(u),this._document.fonts.add(u)}insertRule(u){let i=this.styleElement;i||(i=this.styleElement=this._document.createElement("style"),i.id=`PDFJS_FONT_STYLE_TAG_${this.docId}`,this._document.documentElement.getElementsByTagName("head")[0].append(i));let c=i.sheet;c.insertRule(u,c.cssRules.length)}clear(){for(let u of this.nativeFontFaces)this._document.fonts.delete(u);this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(u){if(u.attached||u.missingFile)return;if(u.attached=!0,this.isFontLoadingAPISupported){let c=u.createNativeFontFace();if(c){this.addNativeFontFace(c);try{await c.loaded}catch(f){throw this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontLoadNative}),(0,n.warn)(`Failed to load font '${c.family}': '${f}'.`),u.disableFontFace=!0,f}}return}let i=u.createFontFaceRule();if(i){if(this.insertRule(i),this.isSyncFontLoadingSupported)return;await new Promise(c=>{let f=this._queueLoadingCallback(c);this._prepareFontLoadEvent([i],[u],f)})}}_queueLoadingCallback(u){(0,n.unreachable)("Abstract method `_queueLoadingCallback`.")}get isFontLoadingAPISupported(){let u=!!this._document?.fonts;return(0,n.shadow)(this,"isFontLoadingAPISupported",u)}get isSyncFontLoadingSupported(){(0,n.unreachable)("Abstract method `isSyncFontLoadingSupported`.")}get _loadTestFont(){(0,n.unreachable)("Abstract method `_loadTestFont`.")}_prepareFontLoadEvent(u,i,c){(0,n.unreachable)("Abstract method `_prepareFontLoadEvent`.")}}let s;e.FontLoader=s,e.FontLoader=s=class extends r{constructor(u){super(u),this.loadingContext={requests:[],nextRequestId:0},this.loadTestFontId=0}get isSyncFontLoadingSupported(){let u=!1;return(typeof navigator>"u"||/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(navigator.userAgent)?.[1]>=14)&&(u=!0),(0,n.shadow)(this,"isSyncFontLoadingSupported",u)}_queueLoadingCallback(u){function i(){for((0,n.assert)(!f.done,"completeRequest() cannot be called twice."),f.done=!0;c.requests.length>0&&c.requests[0].done;){let F=c.requests.shift();setTimeout(F.callback,0)}}let c=this.loadingContext,f={id:`pdfjs-font-loading-${c.nextRequestId++}`,done:!1,complete:i,callback:u};return c.requests.push(f),f}get _loadTestFont(){let u=function(){return atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==")};return(0,n.shadow)(this,"_loadTestFont",u())}_prepareFontLoadEvent(u,i,c){function f(Z,H){return Z.charCodeAt(H)<<24|Z.charCodeAt(H+1)<<16|Z.charCodeAt(H+2)<<8|Z.charCodeAt(H+3)&255}function F(Z,H,N,j){let J=Z.substring(0,H),$=Z.substring(H+N);return J+j+$}let S,d,_=this._document.createElement("canvas");_.width=1,_.height=1;let T=_.getContext("2d"),R=0;function E(Z,H){if(R++,R>30){(0,n.warn)("Load test font never loaded."),H();return}if(T.font="30px "+Z,T.fillText(".",0,20),T.getImageData(0,0,1,1).data[3]>0){H();return}setTimeout(E.bind(null,Z,H))}let P=`lt${Date.now()}${this.loadTestFontId++}`,k=this._loadTestFont;k=F(k,976,P.length,P);let g=16,A=1482184792,M=f(k,g);for(S=0,d=P.length-3;S<d;S+=4)M=M-A+f(P,S)|0;S<P.length&&(M=M-A+f(P+"XXX",S)|0),k=F(k,g,4,(0,n.string32)(M));let D=`url(data:font/opentype;base64,${btoa(k)});`,V=`@font-face {font-family:"${P}";src:${D}}`;this.insertRule(V);let W=[];for(let Z of i)W.push(Z.loadedName);W.push(P);let te=this._document.createElement("div");te.style.visibility="hidden",te.style.width=te.style.height="10px",te.style.position="absolute",te.style.top=te.style.left="0px";for(let Z of W){let H=this._document.createElement("span");H.textContent="Hi",H.style.fontFamily=Z,te.append(H)}this._document.body.append(te),E(P,()=>{te.remove(),c.complete()})}};class l{constructor(u,{isEvalSupported:i=!0,disableFontFace:c=!1,ignoreErrors:f=!1,onUnsupportedFeature:F,fontRegistry:S=null}){this.compiledGlyphs=Object.create(null);for(let d in u)this[d]=u[d];this.isEvalSupported=i!==!1,this.disableFontFace=c===!0,this.ignoreErrors=f===!0,this._onUnsupportedFeature=F,this.fontRegistry=S}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let u;if(!this.cssFontInfo)u=new FontFace(this.loadedName,this.data,{});else{let i={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(i.style=`oblique ${this.cssFontInfo.italicAngle}deg`),u=new FontFace(this.cssFontInfo.fontFamily,this.data,i)}return this.fontRegistry&&this.fontRegistry.registerFont(this),u}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;let u=(0,n.bytesToString)(this.data),i=`url(data:${this.mimetype};base64,${btoa(u)});`,c;if(!this.cssFontInfo)c=`@font-face {font-family:"${this.loadedName}";src:${i}}`;else{let f=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(f+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),c=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${f}src:${i}}`}return this.fontRegistry&&this.fontRegistry.registerFont(this,i),c}getPathGenerator(u,i){if(this.compiledGlyphs[i]!==void 0)return this.compiledGlyphs[i];let c;try{c=u.get(this.loadedName+"_path_"+i)}catch(f){if(!this.ignoreErrors)throw f;return this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontGetPath}),(0,n.warn)(`getPathGenerator - ignoring character: "${f}".`),this.compiledGlyphs[i]=function(F,S){}}if(this.isEvalSupported&&n.FeatureTest.isEvalSupported){let f=[];for(let F of c){let S=F.args!==void 0?F.args.join(","):"";f.push("c.",F.cmd,"(",S,`);
`)}return this.compiledGlyphs[i]=new Function("c","size",f.join(""))}return this.compiledGlyphs[i]=function(f,F){for(let S of c)S.cmd==="scale"&&(S.args=[F,-F]),f[S.cmd].apply(f,S.args)}}}e.FontFaceObject=l},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasGraphics=void 0;var n=t(8),r=t(1),s=t(13),l=t(14),m=t(3);let u=16,i=100,c=4096,f=15,F=10,S=m.isNodeJS&&typeof Path2D>"u"?-1:1e3,d=16;function _(B,w){if(B._removeMirroring)throw new Error("Context is already forwarding operations.");B.__originalSave=B.save,B.__originalRestore=B.restore,B.__originalRotate=B.rotate,B.__originalScale=B.scale,B.__originalTranslate=B.translate,B.__originalTransform=B.transform,B.__originalSetTransform=B.setTransform,B.__originalResetTransform=B.resetTransform,B.__originalClip=B.clip,B.__originalMoveTo=B.moveTo,B.__originalLineTo=B.lineTo,B.__originalBezierCurveTo=B.bezierCurveTo,B.__originalRect=B.rect,B.__originalClosePath=B.closePath,B.__originalBeginPath=B.beginPath,B._removeMirroring=()=>{B.save=B.__originalSave,B.restore=B.__originalRestore,B.rotate=B.__originalRotate,B.scale=B.__originalScale,B.translate=B.__originalTranslate,B.transform=B.__originalTransform,B.setTransform=B.__originalSetTransform,B.resetTransform=B.__originalResetTransform,B.clip=B.__originalClip,B.moveTo=B.__originalMoveTo,B.lineTo=B.__originalLineTo,B.bezierCurveTo=B.__originalBezierCurveTo,B.rect=B.__originalRect,B.closePath=B.__originalClosePath,B.beginPath=B.__originalBeginPath,delete B._removeMirroring},B.save=function(){w.save(),this.__originalSave()},B.restore=function(){w.restore(),this.__originalRestore()},B.translate=function(y,L){w.translate(y,L),this.__originalTranslate(y,L)},B.scale=function(y,L){w.scale(y,L),this.__originalScale(y,L)},B.transform=function(y,L,a,h,b,v){w.transform(y,L,a,h,b,v),this.__originalTransform(y,L,a,h,b,v)},B.setTransform=function(y,L,a,h,b,v){w.setTransform(y,L,a,h,b,v),this.__originalSetTransform(y,L,a,h,b,v)},B.resetTransform=function(){w.resetTransform(),this.__originalResetTransform()},B.rotate=function(y){w.rotate(y),this.__originalRotate(y)},B.clip=function(y){w.clip(y),this.__originalClip(y)},B.moveTo=function(x,y){w.moveTo(x,y),this.__originalMoveTo(x,y)},B.lineTo=function(x,y){w.lineTo(x,y),this.__originalLineTo(x,y)},B.bezierCurveTo=function(x,y,L,a,h,b){w.bezierCurveTo(x,y,L,a,h,b),this.__originalBezierCurveTo(x,y,L,a,h,b)},B.rect=function(x,y,L,a){w.rect(x,y,L,a),this.__originalRect(x,y,L,a)},B.closePath=function(){w.closePath(),this.__originalClosePath()},B.beginPath=function(){w.beginPath(),this.__originalBeginPath()}}class T{constructor(w){this.canvasFactory=w,this.cache=Object.create(null)}getCanvas(w,x,y){let L;return this.cache[w]!==void 0?(L=this.cache[w],this.canvasFactory.reset(L,x,y)):(L=this.canvasFactory.create(x,y),this.cache[w]=L),L}delete(w){delete this.cache[w]}clear(){for(let w in this.cache){let x=this.cache[w];this.canvasFactory.destroy(x),delete this.cache[w]}}}function R(B,w,x,y,L,a,h,b,v,C){let[I,O,U,K,G,Y]=(0,n.getCurrentTransform)(B);if(O===0&&U===0){let re=h*I+G,ie=Math.round(re),ae=b*K+Y,le=Math.round(ae),oe=(h+v)*I+G,Ae=Math.abs(Math.round(oe)-ie)||1,De=(b+C)*K+Y,ue=Math.abs(Math.round(De)-le)||1;return B.setTransform(Math.sign(I),0,0,Math.sign(K),ie,le),B.drawImage(w,x,y,L,a,0,0,Ae,ue),B.setTransform(I,O,U,K,G,Y),[Ae,ue]}if(I===0&&K===0){let re=b*U+G,ie=Math.round(re),ae=h*O+Y,le=Math.round(ae),oe=(b+C)*U+G,Ae=Math.abs(Math.round(oe)-ie)||1,De=(h+v)*O+Y,ue=Math.abs(Math.round(De)-le)||1;return B.setTransform(0,Math.sign(O),Math.sign(U),0,ie,le),B.drawImage(w,x,y,L,a,0,0,ue,Ae),B.setTransform(I,O,U,K,G,Y),[ue,Ae]}B.drawImage(w,x,y,L,a,h,b,v,C);let ne=Math.hypot(I,O),Q=Math.hypot(U,K);return[ne*v,Q*C]}function E(B){let{width:w,height:x}=B;if(w>S||x>S)return null;let y=1e3,L=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),a=w+1,h=new Uint8Array(a*(x+1)),b,v,C,I=w+7&-8,O=new Uint8Array(I*x),U=0;for(let Q of B.data){let re=128;for(;re>0;)O[U++]=Q&re?0:255,re>>=1}let K=0;for(U=0,O[U]!==0&&(h[0]=1,++K),v=1;v<w;v++)O[U]!==O[U+1]&&(h[v]=O[U]?2:1,++K),U++;for(O[U]!==0&&(h[v]=2,++K),b=1;b<x;b++){U=b*I,C=b*a,O[U-I]!==O[U]&&(h[C]=O[U]?1:8,++K);let Q=(O[U]?4:0)+(O[U-I]?8:0);for(v=1;v<w;v++)Q=(Q>>2)+(O[U+1]?4:0)+(O[U-I+1]?8:0),L[Q]&&(h[C+v]=L[Q],++K),U++;if(O[U-I]!==O[U]&&(h[C+v]=O[U]?2:4,++K),K>y)return null}for(U=I*(x-1),C=b*a,O[U]!==0&&(h[C]=8,++K),v=1;v<w;v++)O[U]!==O[U+1]&&(h[C+v]=O[U]?4:8,++K),U++;if(O[U]!==0&&(h[C+v]=4,++K),K>y)return null;let G=new Int32Array([0,a,-1,0,-a,0,0,0,1]),Y=new Path2D;for(b=0;K&&b<=x;b++){let Q=b*a,re=Q+w;for(;Q<re&&!h[Q];)Q++;if(Q===re)continue;Y.moveTo(Q%a,b);let ie=Q,ae=h[Q];do{let le=G[ae];do Q+=le;while(!h[Q]);let oe=h[Q];oe!==5&&oe!==10?(ae=oe,h[Q]=0):(ae=oe&51*ae>>4,h[Q]&=ae>>2|ae<<2),Y.lineTo(Q%a,Q/a|0),h[Q]||--K}while(ie!==Q);--b}return O=null,h=null,function(Q){Q.save(),Q.scale(1/w,-1/x),Q.translate(0,-x),Q.fill(Y),Q.beginPath(),Q.restore()}}class P{constructor(w,x){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=r.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=r.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps=null,this.startNewPathAndClipBox([0,0,w,x])}clone(){let w=Object.create(this);return w.clipBox=this.clipBox.slice(),w}setCurrentPoint(w,x){this.x=w,this.y=x}updatePathMinMax(w,x,y){[x,y]=r.Util.applyTransform([x,y],w),this.minX=Math.min(this.minX,x),this.minY=Math.min(this.minY,y),this.maxX=Math.max(this.maxX,x),this.maxY=Math.max(this.maxY,y)}updateRectMinMax(w,x){let y=r.Util.applyTransform(x,w),L=r.Util.applyTransform(x.slice(2),w);this.minX=Math.min(this.minX,y[0],L[0]),this.minY=Math.min(this.minY,y[1],L[1]),this.maxX=Math.max(this.maxX,y[0],L[0]),this.maxY=Math.max(this.maxY,y[1],L[1])}updateScalingPathMinMax(w,x){r.Util.scaleMinMax(w,x),this.minX=Math.min(this.minX,x[0]),this.maxX=Math.max(this.maxX,x[1]),this.minY=Math.min(this.minY,x[2]),this.maxY=Math.max(this.maxY,x[3])}updateCurvePathMinMax(w,x,y,L,a,h,b,v,C,I){let O=r.Util.bezierBoundingBox(x,y,L,a,h,b,v,C);if(I){I[0]=Math.min(I[0],O[0],O[2]),I[1]=Math.max(I[1],O[0],O[2]),I[2]=Math.min(I[2],O[1],O[3]),I[3]=Math.max(I[3],O[1],O[3]);return}this.updateRectMinMax(w,O)}getPathBoundingBox(w=s.PathType.FILL,x=null){let y=[this.minX,this.minY,this.maxX,this.maxY];if(w===s.PathType.STROKE){x||(0,r.unreachable)("Stroke bounding box must include transform.");let L=r.Util.singularValueDecompose2dScale(x),a=L[0]*this.lineWidth/2,h=L[1]*this.lineWidth/2;y[0]-=a,y[1]-=h,y[2]+=a,y[3]+=h}return y}updateClipFromPath(){let w=r.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(w||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(w){this.clipBox=w,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(w=s.PathType.FILL,x=null){return r.Util.intersect(this.clipBox,this.getPathBoundingBox(w,x))}}function k(B,w,x=null){if(typeof ImageData<"u"&&w instanceof ImageData){B.putImageData(w,0,0);return}let y=w.height,L=w.width,a=y%d,h=(y-a)/d,b=a===0?h:h+1,v=B.createImageData(L,d),C=0,I,O=w.data,U=v.data,K,G,Y,ne,Q,re,ie,ae;if(x)switch(x.length){case 1:Q=x[0],re=x[0],ie=x[0],ae=x[0];break;case 4:Q=x[0],re=x[1],ie=x[2],ae=x[3];break}if(w.kind===r.ImageKind.GRAYSCALE_1BPP){let le=O.byteLength,oe=new Uint32Array(U.buffer,0,U.byteLength>>2),Ae=oe.length,De=L+7>>3,ue=4294967295,_e=r.FeatureTest.isLittleEndian?4278190080:255;for(ae&&ae[0]===255&&ae[255]===0&&([ue,_e]=[_e,ue]),K=0;K<b;K++){for(Y=K<h?d:a,I=0,G=0;G<Y;G++){let ve=le-C,Ke=0,Xe=ve>De?L:ve*8-7,vt=Xe&-8,Me=0,Te=0;for(;Ke<vt;Ke+=8)Te=O[C++],oe[I++]=Te&128?ue:_e,oe[I++]=Te&64?ue:_e,oe[I++]=Te&32?ue:_e,oe[I++]=Te&16?ue:_e,oe[I++]=Te&8?ue:_e,oe[I++]=Te&4?ue:_e,oe[I++]=Te&2?ue:_e,oe[I++]=Te&1?ue:_e;for(;Ke<Xe;Ke++)Me===0&&(Te=O[C++],Me=128),oe[I++]=Te&Me?ue:_e,Me>>=1}for(;I<Ae;)oe[I++]=0;B.putImageData(v,0,K*d)}}else if(w.kind===r.ImageKind.RGBA_32BPP){let le=!!(Q||re||ie);for(G=0,ne=L*d*4,K=0;K<h;K++){if(U.set(O.subarray(C,C+ne)),C+=ne,le)for(let oe=0;oe<ne;oe+=4)Q&&(U[oe+0]=Q[U[oe+0]]),re&&(U[oe+1]=re[U[oe+1]]),ie&&(U[oe+2]=ie[U[oe+2]]);B.putImageData(v,0,G),G+=d}if(K<b){if(ne=L*a*4,U.set(O.subarray(C,C+ne)),le)for(let oe=0;oe<ne;oe+=4)Q&&(U[oe+0]=Q[U[oe+0]]),re&&(U[oe+1]=re[U[oe+1]]),ie&&(U[oe+2]=ie[U[oe+2]]);B.putImageData(v,0,G)}}else if(w.kind===r.ImageKind.RGB_24BPP){let le=!!(Q||re||ie);for(Y=d,ne=L*Y,K=0;K<b;K++){for(K>=h&&(Y=a,ne=L*Y),I=0,G=ne;G--;)U[I++]=O[C++],U[I++]=O[C++],U[I++]=O[C++],U[I++]=255;if(le)for(let oe=0;oe<I;oe+=4)Q&&(U[oe+0]=Q[U[oe+0]]),re&&(U[oe+1]=re[U[oe+1]]),ie&&(U[oe+2]=ie[U[oe+2]]);B.putImageData(v,0,K*d)}}else throw new Error(`bad image kind: ${w.kind}`)}function p(B,w){if(w.bitmap){B.drawImage(w.bitmap,0,0);return}let x=w.height,y=w.width,L=x%d,a=(x-L)/d,h=L===0?a:a+1,b=B.createImageData(y,d),v=0,C=w.data,I=b.data;for(let O=0;O<h;O++){let U=O<a?d:L;({srcPos:v}=(0,l.applyMaskImageData)({src:C,srcPos:v,dest:I,width:y,height:U})),B.putImageData(b,0,O*d)}}function g(B,w){let x=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"];for(let y=0,L=x.length;y<L;y++){let a=x[y];B[a]!==void 0&&(w[a]=B[a])}B.setLineDash!==void 0&&(w.setLineDash(B.getLineDash()),w.lineDashOffset=B.lineDashOffset)}function A(B,w){B.strokeStyle=B.fillStyle=w||"#000000",B.fillRule="nonzero",B.globalAlpha=1,B.lineWidth=1,B.lineCap="butt",B.lineJoin="miter",B.miterLimit=10,B.globalCompositeOperation="source-over",B.font="10px sans-serif",B.setLineDash!==void 0&&(B.setLineDash([]),B.lineDashOffset=0)}function M(B,w,x,y){let L=B.length;for(let a=3;a<L;a+=4){let h=B[a];if(h===0)B[a-3]=w,B[a-2]=x,B[a-1]=y;else if(h<255){let b=255-h;B[a-3]=B[a-3]*h+w*b>>8,B[a-2]=B[a-2]*h+x*b>>8,B[a-1]=B[a-1]*h+y*b>>8}}}function D(B,w,x){let y=B.length,L=1/255;for(let a=3;a<y;a+=4){let h=x?x[B[a]]:B[a];w[a]=w[a]*h*L|0}}function V(B,w,x){let y=B.length;for(let L=3;L<y;L+=4){let a=B[L-3]*77+B[L-2]*152+B[L-1]*28;w[L]=x?w[L]*x[a>>8]>>8:w[L]*a>>16}}function W(B,w,x,y,L,a,h,b,v,C,I){let O=!!a,U=O?a[0]:0,K=O?a[1]:0,G=O?a[2]:0,Y;L==="Luminosity"?Y=V:Y=D;let Q=Math.min(y,Math.ceil(1048576/x));for(let re=0;re<y;re+=Q){let ie=Math.min(Q,y-re),ae=B.getImageData(b-C,re+(v-I),x,ie),le=w.getImageData(b,re+v,x,ie);O&&M(ae.data,U,K,G),Y(ae.data,le.data,h),w.putImageData(le,b,re+v)}}function te(B,w,x,y){let L=y[0],a=y[1],h=y[2]-L,b=y[3]-a;h===0||b===0||(W(w.context,x,h,b,w.subtype,w.backdrop,w.transferMap,L,a,w.offsetX,w.offsetY),B.save(),B.globalAlpha=1,B.globalCompositeOperation="source-over",B.setTransform(1,0,0,1,0,0),B.drawImage(x.canvas,0,0),B.restore())}function Z(B,w){let x=r.Util.singularValueDecompose2dScale(B);x[0]=Math.fround(x[0]),x[1]=Math.fround(x[1]);let y=Math.fround((globalThis.devicePixelRatio||1)*n.PixelsPerInch.PDF_TO_CSS_UNITS);return w!==void 0?w:x[0]<=y||x[1]<=y}let H=["butt","round","square"],N=["miter","round","bevel"],j={},J={};class ${constructor(w,x,y,L,a,h,b,v){this.ctx=w,this.current=new P(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=x,this.objs=y,this.canvasFactory=L,this.imageLayer=a,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=[],this.optionalContentConfig=h,this.cachedCanvases=new T(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=b,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.backgroundColor=v?.background||null,this.foregroundColor=v?.foreground||null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(w,x=null){return typeof w=="string"?w.startsWith("g_")?this.commonObjs.get(w):this.objs.get(w):x}beginDrawing({transform:w,viewport:x,transparency:y=!1,background:L=null}){let a=this.ctx.canvas.width,h=this.ctx.canvas.height,b=L||"#ffffff";if(this.ctx.save(),this.foregroundColor&&this.backgroundColor){this.ctx.fillStyle=this.foregroundColor;let v=this.foregroundColor=this.ctx.fillStyle;this.ctx.fillStyle=this.backgroundColor;let C=this.backgroundColor=this.ctx.fillStyle,I=!0,O=b;if(this.ctx.fillStyle=b,O=this.ctx.fillStyle,I=typeof O=="string"&&/^#[0-9A-Fa-f]{6}$/.test(O),v==="#000000"&&C==="#ffffff"||v===C||!I)this.foregroundColor=this.backgroundColor=null;else{let[U,K,G]=(0,n.getRGB)(O),Y=Q=>(Q/=255,Q<=.03928?Q/12.92:((Q+.055)/1.055)**2.4),ne=Math.round(.2126*Y(U)+.7152*Y(K)+.0722*Y(G));this.selectColor=(Q,re,ie)=>{let ae=.2126*Y(Q)+.7152*Y(re)+.0722*Y(ie);return Math.round(ae)===ne?C:v}}}if(this.ctx.fillStyle=this.backgroundColor||b,this.ctx.fillRect(0,0,a,h),this.ctx.restore(),y){let v=this.cachedCanvases.getCanvas("transparent",a,h);this.compositeCtx=this.ctx,this.transparentCanvas=v.canvas,this.ctx=v.context,this.ctx.save(),this.ctx.transform(...(0,n.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),A(this.ctx,this.foregroundColor),w&&(this.ctx.transform(...w),this.outputScaleX=w[0],this.outputScaleY=w[0]),this.ctx.transform(...x.transform),this.viewportScale=x.scale,this.baseTransform=(0,n.getCurrentTransform)(this.ctx),this.imageLayer&&((0,n.deprecated)("The `imageLayer` functionality will be removed in the future."),this.imageLayer.beginLayout())}executeOperatorList(w,x,y,L){let a=w.argsArray,h=w.fnArray,b=x||0,v=a.length;if(v===b)return b;let C=v-b>F&&typeof y=="function",I=C?Date.now()+f:0,O=0,U=this.commonObjs,K=this.objs,G;for(;;){if(L!==void 0&&b===L.nextBreakPoint)return L.breakIt(b,y),b;if(G=h[b],G!==r.OPS.dependency)this[G].apply(this,a[b]);else for(let Y of a[b]){let ne=Y.startsWith("g_")?U:K;if(!ne.has(Y))return ne.get(Y,y),b}if(b++,b===v)return b;if(C&&++O>F){if(Date.now()>I)return y(),b;O=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let w of this._cachedBitmapsMap.values()){for(let x of w.values())typeof HTMLCanvasElement<"u"&&x instanceof HTMLCanvasElement&&(x.width=x.height=0);w.clear()}this._cachedBitmapsMap.clear(),this.imageLayer&&this.imageLayer.endLayout()}_scaleImage(w,x){let y=w.width,L=w.height,a=Math.max(Math.hypot(x[0],x[1]),1),h=Math.max(Math.hypot(x[2],x[3]),1),b=y,v=L,C="prescale1",I,O;for(;a>2&&b>1||h>2&&v>1;){let U=b,K=v;a>2&&b>1&&(U=Math.ceil(b/2),a/=b/U),h>2&&v>1&&(K=Math.ceil(v/2),h/=v/K),I=this.cachedCanvases.getCanvas(C,U,K),O=I.context,O.clearRect(0,0,U,K),O.drawImage(w,0,0,b,v,0,0,U,K),w=I.canvas,b=U,v=K,C=C==="prescale1"?"prescale2":"prescale1"}return{img:w,paintWidth:b,paintHeight:v}}_createMaskCanvas(w){let x=this.ctx,{width:y,height:L}=w,a=this.current.fillColor,h=this.current.patternFill,b=(0,n.getCurrentTransform)(x),v,C,I,O;if((w.bitmap||w.data)&&w.count>1){let Ae=w.bitmap||w.data.buffer,De=b.slice(0,4);C=JSON.stringify(h?De:[De,a]),v=this._cachedBitmapsMap.get(Ae),v||(v=new Map,this._cachedBitmapsMap.set(Ae,v));let ue=v.get(C);if(ue&&!h){let _e=Math.round(Math.min(b[0],b[2])+b[4]),ve=Math.round(Math.min(b[1],b[3])+b[5]);return{canvas:ue,offsetX:_e,offsetY:ve}}I=ue}I||(O=this.cachedCanvases.getCanvas("maskCanvas",y,L),p(O.context,w));let U=r.Util.transform(b,[1/y,0,0,-1/L,0,0]);U=r.Util.transform(U,[1,0,0,1,0,-L]);let K=r.Util.applyTransform([0,0],U),G=r.Util.applyTransform([y,L],U),Y=r.Util.normalizeRect([K[0],K[1],G[0],G[1]]),ne=Math.round(Y[2]-Y[0])||1,Q=Math.round(Y[3]-Y[1])||1,re=this.cachedCanvases.getCanvas("fillCanvas",ne,Q),ie=re.context,ae=Math.min(K[0],G[0]),le=Math.min(K[1],G[1]);ie.translate(-ae,-le),ie.transform(...U),I||(I=this._scaleImage(O.canvas,(0,n.getCurrentTransformInverse)(ie)),I=I.img,v&&h&&v.set(C,I)),ie.imageSmoothingEnabled=Z((0,n.getCurrentTransform)(ie),w.interpolate),R(ie,I,0,0,I.width,I.height,0,0,y,L),ie.globalCompositeOperation="source-in";let oe=r.Util.transform((0,n.getCurrentTransformInverse)(ie),[1,0,0,1,-ae,-le]);return ie.fillStyle=h?a.getPattern(x,this,oe,s.PathType.FILL):a,ie.fillRect(0,0,y,L),v&&!h&&(this.cachedCanvases.delete("fillCanvas"),v.set(C,re.canvas)),{canvas:re.canvas,offsetX:Math.round(ae),offsetY:Math.round(le)}}setLineWidth(w){w!==this.current.lineWidth&&(this._cachedScaleForStroking=null),this.current.lineWidth=w,this.ctx.lineWidth=w}setLineCap(w){this.ctx.lineCap=H[w]}setLineJoin(w){this.ctx.lineJoin=N[w]}setMiterLimit(w){this.ctx.miterLimit=w}setDash(w,x){let y=this.ctx;y.setLineDash!==void 0&&(y.setLineDash(w),y.lineDashOffset=x)}setRenderingIntent(w){}setFlatness(w){}setGState(w){for(let x=0,y=w.length;x<y;x++){let L=w[x],a=L[0],h=L[1];switch(a){case"LW":this.setLineWidth(h);break;case"LC":this.setLineCap(h);break;case"LJ":this.setLineJoin(h);break;case"ML":this.setMiterLimit(h);break;case"D":this.setDash(h[0],h[1]);break;case"RI":this.setRenderingIntent(h);break;case"FL":this.setFlatness(h);break;case"Font":this.setFont(h[0],h[1]);break;case"CA":this.current.strokeAlpha=L[1];break;case"ca":this.current.fillAlpha=L[1],this.ctx.globalAlpha=L[1];break;case"BM":this.ctx.globalCompositeOperation=h;break;case"SMask":this.current.activeSMask=h?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.current.transferMaps=h}}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let w=this.inSMaskMode;this.current.activeSMask&&!w?this.beginSMaskMode():!this.current.activeSMask&&w&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let w=this.ctx.canvas.width,x=this.ctx.canvas.height,y="smaskGroupAt"+this.groupLevel,L=this.cachedCanvases.getCanvas(y,w,x);this.suspendedCtx=this.ctx,this.ctx=L.context;let a=this.ctx;a.setTransform(...(0,n.getCurrentTransform)(this.suspendedCtx)),g(this.suspendedCtx,a),_(a,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),g(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(w){if(!this.current.activeSMask)return;w?(w[0]=Math.floor(w[0]),w[1]=Math.floor(w[1]),w[2]=Math.ceil(w[2]),w[3]=Math.ceil(w[3])):w=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let x=this.current.activeSMask,y=this.suspendedCtx;te(y,x,this.ctx,w),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(g(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let w=this.current;this.stateStack.push(w),this.current=w.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),g(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null)}transform(w,x,y,L,a,h){this.ctx.transform(w,x,y,L,a,h),this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null}constructPath(w,x,y){let L=this.ctx,a=this.current,h=a.x,b=a.y,v,C,I=(0,n.getCurrentTransform)(L),O=I[0]===0&&I[3]===0||I[1]===0&&I[2]===0,U=O?y.slice(0):null;for(let K=0,G=0,Y=w.length;K<Y;K++)switch(w[K]|0){case r.OPS.rectangle:h=x[G++],b=x[G++];let ne=x[G++],Q=x[G++],re=h+ne,ie=b+Q;L.moveTo(h,b),ne===0||Q===0?L.lineTo(re,ie):(L.lineTo(re,b),L.lineTo(re,ie),L.lineTo(h,ie)),O||a.updateRectMinMax(I,[h,b,re,ie]),L.closePath();break;case r.OPS.moveTo:h=x[G++],b=x[G++],L.moveTo(h,b),O||a.updatePathMinMax(I,h,b);break;case r.OPS.lineTo:h=x[G++],b=x[G++],L.lineTo(h,b),O||a.updatePathMinMax(I,h,b);break;case r.OPS.curveTo:v=h,C=b,h=x[G+4],b=x[G+5],L.bezierCurveTo(x[G],x[G+1],x[G+2],x[G+3],h,b),a.updateCurvePathMinMax(I,v,C,x[G],x[G+1],x[G+2],x[G+3],h,b,U),G+=6;break;case r.OPS.curveTo2:v=h,C=b,L.bezierCurveTo(h,b,x[G],x[G+1],x[G+2],x[G+3]),a.updateCurvePathMinMax(I,v,C,h,b,x[G],x[G+1],x[G+2],x[G+3],U),h=x[G+2],b=x[G+3],G+=4;break;case r.OPS.curveTo3:v=h,C=b,h=x[G+2],b=x[G+3],L.bezierCurveTo(x[G],x[G+1],h,b,h,b),a.updateCurvePathMinMax(I,v,C,x[G],x[G+1],h,b,h,b,U),G+=4;break;case r.OPS.closePath:L.closePath();break}O&&a.updateScalingPathMinMax(I,U),a.setCurrentPoint(h,b)}closePath(){this.ctx.closePath()}stroke(w){w=typeof w<"u"?w:!0;let x=this.ctx,y=this.current.strokeColor;x.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof y=="object"&&y?.getPattern?(x.save(),x.strokeStyle=y.getPattern(x,this,(0,n.getCurrentTransformInverse)(x),s.PathType.STROKE),this.rescaleAndStroke(!1),x.restore()):this.rescaleAndStroke(!0)),w&&this.consumePath(this.current.getClippedPathBoundingBox()),x.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(w){w=typeof w<"u"?w:!0;let x=this.ctx,y=this.current.fillColor,L=this.current.patternFill,a=!1;L&&(x.save(),x.fillStyle=y.getPattern(x,this,(0,n.getCurrentTransformInverse)(x),s.PathType.FILL),a=!0);let h=this.current.getClippedPathBoundingBox();this.contentVisible&&h!==null&&(this.pendingEOFill?(x.fill("evenodd"),this.pendingEOFill=!1):x.fill()),a&&x.restore(),w&&this.consumePath(h)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=j}eoClip(){this.pendingClip=J}beginText(){this.current.textMatrix=r.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let w=this.pendingTextPaths,x=this.ctx;if(w===void 0){x.beginPath();return}x.save(),x.beginPath();for(let y of w)x.setTransform(...y.transform),x.translate(y.x,y.y),y.addToPath(x,y.fontSize);x.restore(),x.clip(),x.beginPath(),delete this.pendingTextPaths}setCharSpacing(w){this.current.charSpacing=w}setWordSpacing(w){this.current.wordSpacing=w}setHScale(w){this.current.textHScale=w/100}setLeading(w){this.current.leading=-w}setFont(w,x){let y=this.commonObjs.get(w),L=this.current;if(!y)throw new Error(`Can't find font for ${w}`);if(L.fontMatrix=y.fontMatrix||r.FONT_IDENTITY_MATRIX,(L.fontMatrix[0]===0||L.fontMatrix[3]===0)&&(0,r.warn)("Invalid font matrix for font "+w),x<0?(x=-x,L.fontDirection=-1):L.fontDirection=1,this.current.font=y,this.current.fontSize=x,y.isType3Font)return;let a=y.loadedName||"sans-serif",h="normal";y.black?h="900":y.bold&&(h="bold");let b=y.italic?"italic":"normal",v=`"${a}", ${y.fallbackName}`,C=x;x<u?C=u:x>i&&(C=i),this.current.fontSizeScale=x/C,this.ctx.font=`${b} ${h} ${C}px ${v}`}setTextRenderingMode(w){this.current.textRenderingMode=w}setTextRise(w){this.current.textRise=w}moveText(w,x){this.current.x=this.current.lineX+=w,this.current.y=this.current.lineY+=x}setLeadingMoveText(w,x){this.setLeading(-x),this.moveText(w,x)}setTextMatrix(w,x,y,L,a,h){this.current.textMatrix=[w,x,y,L,a,h],this.current.textMatrixScale=Math.hypot(w,x),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(w,x,y,L){let a=this.ctx,h=this.current,b=h.font,v=h.textRenderingMode,C=h.fontSize/h.fontSizeScale,I=v&r.TextRenderingMode.FILL_STROKE_MASK,O=!!(v&r.TextRenderingMode.ADD_TO_PATH_FLAG),U=h.patternFill&&!b.missingFile,K;(b.disableFontFace||O||U)&&(K=b.getPathGenerator(this.commonObjs,w)),b.disableFontFace||U?(a.save(),a.translate(x,y),a.beginPath(),K(a,C),L&&a.setTransform(...L),(I===r.TextRenderingMode.FILL||I===r.TextRenderingMode.FILL_STROKE)&&a.fill(),(I===r.TextRenderingMode.STROKE||I===r.TextRenderingMode.FILL_STROKE)&&a.stroke(),a.restore()):((I===r.TextRenderingMode.FILL||I===r.TextRenderingMode.FILL_STROKE)&&a.fillText(w,x,y),(I===r.TextRenderingMode.STROKE||I===r.TextRenderingMode.FILL_STROKE)&&a.strokeText(w,x,y)),O&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,n.getCurrentTransform)(a),x,y,fontSize:C,addToPath:K})}get isFontSubpixelAAEnabled(){let{context:w}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);w.scale(1.5,1),w.fillText("I",0,10);let x=w.getImageData(0,0,10,10).data,y=!1;for(let L=3;L<x.length;L+=4)if(x[L]>0&&x[L]<255){y=!0;break}return(0,r.shadow)(this,"isFontSubpixelAAEnabled",y)}showText(w){let x=this.current,y=x.font;if(y.isType3Font)return this.showType3Text(w);let L=x.fontSize;if(L===0)return;let a=this.ctx,h=x.fontSizeScale,b=x.charSpacing,v=x.wordSpacing,C=x.fontDirection,I=x.textHScale*C,O=w.length,U=y.vertical,K=U?1:-1,G=y.defaultVMetrics,Y=L*x.fontMatrix[0],ne=x.textRenderingMode===r.TextRenderingMode.FILL&&!y.disableFontFace&&!x.patternFill;a.save(),a.transform(...x.textMatrix),a.translate(x.x,x.y+x.textRise),C>0?a.scale(I,-1):a.scale(I,1);let Q;if(x.patternFill){a.save();let oe=x.fillColor.getPattern(a,this,(0,n.getCurrentTransformInverse)(a),s.PathType.FILL);Q=(0,n.getCurrentTransform)(a),a.restore(),a.fillStyle=oe}let re=x.lineWidth,ie=x.textMatrixScale;if(ie===0||re===0){let oe=x.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;(oe===r.TextRenderingMode.STROKE||oe===r.TextRenderingMode.FILL_STROKE)&&(re=this.getSinglePixelWidth())}else re/=ie;h!==1&&(a.scale(h,h),re/=h),a.lineWidth=re;let ae=0,le;for(le=0;le<O;++le){let oe=w[le];if(typeof oe=="number"){ae+=K*oe*L/1e3;continue}let Ae=!1,De=(oe.isSpace?v:0)+b,ue=oe.fontChar,_e=oe.accent,ve,Ke,Xe=oe.width;if(U){let Me=oe.vmetric||G,Te=-(oe.vmetric?Me[1]:Xe*.5)*Y,Ln=Me[2]*Y;Xe=Me?-Me[0]:Xe,ve=Te/h,Ke=(ae+Ln)/h}else ve=ae/h,Ke=0;if(y.remeasure&&Xe>0){let Me=a.measureText(ue).width*1e3/L*h;if(Xe<Me&&this.isFontSubpixelAAEnabled){let Te=Xe/Me;Ae=!0,a.save(),a.scale(Te,1),ve/=Te}else Xe!==Me&&(ve+=(Xe-Me)/2e3*L/h)}if(this.contentVisible&&(oe.isInFont||y.missingFile)){if(ne&&!_e)a.fillText(ue,ve,Ke);else if(this.paintChar(ue,ve,Ke,Q),_e){let Me=ve+L*_e.offset.x/h,Te=Ke-L*_e.offset.y/h;this.paintChar(_e.fontChar,Me,Te,Q)}}let vt;U?vt=Xe*Y-De*C:vt=Xe*Y+De*C,ae+=vt,Ae&&a.restore()}U?x.y-=ae:x.x+=ae*I,a.restore(),this.compose()}showType3Text(w){let x=this.ctx,y=this.current,L=y.font,a=y.fontSize,h=y.fontDirection,b=L.vertical?1:-1,v=y.charSpacing,C=y.wordSpacing,I=y.textHScale*h,O=y.fontMatrix||r.FONT_IDENTITY_MATRIX,U=w.length,K=y.textRenderingMode===r.TextRenderingMode.INVISIBLE,G,Y,ne,Q;if(!(K||a===0)){for(this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,x.save(),x.transform(...y.textMatrix),x.translate(y.x,y.y),x.scale(I,h),G=0;G<U;++G){if(Y=w[G],typeof Y=="number"){Q=b*Y*a/1e3,this.ctx.translate(Q,0),y.x+=Q*I;continue}let re=(Y.isSpace?C:0)+v,ie=L.charProcOperatorList[Y.operatorListId];if(!ie){(0,r.warn)(`Type3 character "${Y.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=Y,this.save(),x.scale(a,a),x.transform(...O),this.executeOperatorList(ie),this.restore()),ne=r.Util.applyTransform([Y.width,0],O)[0]*a+re,x.translate(ne,0),y.x+=ne*I}x.restore(),this.processingType3=null}}setCharWidth(w,x){}setCharWidthAndBounds(w,x,y,L,a,h){this.ctx.rect(y,L,a-y,h-L),this.ctx.clip(),this.endPath()}getColorN_Pattern(w){let x;if(w[0]==="TilingPattern"){let y=w[1],L=this.baseTransform||(0,n.getCurrentTransform)(this.ctx),a={createCanvasGraphics:h=>new $(h,this.commonObjs,this.objs,this.canvasFactory)};x=new s.TilingPattern(w,y,this.ctx,a,L)}else x=this._getPattern(w[1],w[2]);return x}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(w,x,y){let L=this.selectColor?.(w,x,y)||r.Util.makeHexColor(w,x,y);this.ctx.strokeStyle=L,this.current.strokeColor=L}setFillRGBColor(w,x,y){let L=this.selectColor?.(w,x,y)||r.Util.makeHexColor(w,x,y);this.ctx.fillStyle=L,this.current.fillColor=L,this.current.patternFill=!1}_getPattern(w,x=null){let y;return this.cachedPatterns.has(w)?y=this.cachedPatterns.get(w):(y=(0,s.getShadingPattern)(this.objs.get(w)),this.cachedPatterns.set(w,y)),x&&(y.matrix=x),y}shadingFill(w){if(!this.contentVisible)return;let x=this.ctx;this.save();let y=this._getPattern(w);x.fillStyle=y.getPattern(x,this,(0,n.getCurrentTransformInverse)(x),s.PathType.SHADING);let L=(0,n.getCurrentTransformInverse)(x);if(L){let a=x.canvas,h=a.width,b=a.height,v=r.Util.applyTransform([0,0],L),C=r.Util.applyTransform([0,b],L),I=r.Util.applyTransform([h,0],L),O=r.Util.applyTransform([h,b],L),U=Math.min(v[0],C[0],I[0],O[0]),K=Math.min(v[1],C[1],I[1],O[1]),G=Math.max(v[0],C[0],I[0],O[0]),Y=Math.max(v[1],C[1],I[1],O[1]);this.ctx.fillRect(U,K,G-U,Y-K)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,r.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,r.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(w,x){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(w)&&w.length===6&&this.transform(...w),this.baseTransform=(0,n.getCurrentTransform)(this.ctx),x)){let y=x[2]-x[0],L=x[3]-x[1];this.ctx.rect(x[0],x[1],y,L),this.current.updateRectMinMax((0,n.getCurrentTransform)(this.ctx),x),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(w){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let x=this.ctx;w.isolated||(0,r.info)("TODO: Support non-isolated groups."),w.knockout&&(0,r.warn)("Knockout groups not supported.");let y=(0,n.getCurrentTransform)(x);if(w.matrix&&x.transform(...w.matrix),!w.bbox)throw new Error("Bounding box is required.");let L=r.Util.getAxialAlignedBoundingBox(w.bbox,(0,n.getCurrentTransform)(x)),a=[0,0,x.canvas.width,x.canvas.height];L=r.Util.intersect(L,a)||[0,0,0,0];let h=Math.floor(L[0]),b=Math.floor(L[1]),v=Math.max(Math.ceil(L[2])-h,1),C=Math.max(Math.ceil(L[3])-b,1),I=1,O=1;v>c&&(I=v/c,v=c),C>c&&(O=C/c,C=c),this.current.startNewPathAndClipBox([0,0,v,C]);let U="groupAt"+this.groupLevel;w.smask&&(U+="_smask_"+this.smaskCounter++%2);let K=this.cachedCanvases.getCanvas(U,v,C),G=K.context;G.scale(1/I,1/O),G.translate(-h,-b),G.transform(...y),w.smask?this.smaskStack.push({canvas:K.canvas,context:G,offsetX:h,offsetY:b,scaleX:I,scaleY:O,subtype:w.smask.subtype,backdrop:w.smask.backdrop,transferMap:w.smask.transferMap||null,startTransformInverse:null}):(x.setTransform(1,0,0,1,0,0),x.translate(h,b),x.scale(I,O),x.save()),g(x,G),this.ctx=G,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(x),this.groupLevel++}endGroup(w){if(!this.contentVisible)return;this.groupLevel--;let x=this.ctx,y=this.groupStack.pop();if(this.ctx=y,this.ctx.imageSmoothingEnabled=!1,w.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let L=(0,n.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...L);let a=r.Util.getAxialAlignedBoundingBox([0,0,x.canvas.width,x.canvas.height],L);this.ctx.drawImage(x.canvas,0,0),this.ctx.restore(),this.compose(a)}}beginAnnotation(w,x,y,L,a){if(this.#e(),A(this.ctx,this.foregroundColor),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(x)&&x.length===4){let h=x[2]-x[0],b=x[3]-x[1];if(a&&this.annotationCanvasMap){y=y.slice(),y[4]-=x[0],y[5]-=x[1],x=x.slice(),x[0]=x[1]=0,x[2]=h,x[3]=b;let[v,C]=r.Util.singularValueDecompose2dScale((0,n.getCurrentTransform)(this.ctx)),{viewportScale:I}=this,O=Math.ceil(h*this.outputScaleX*I),U=Math.ceil(b*this.outputScaleY*I);this.annotationCanvas=this.canvasFactory.create(O,U);let{canvas:K,context:G}=this.annotationCanvas;this.annotationCanvasMap.set(w,K),this.annotationCanvas.savedCtx=this.ctx,this.ctx=G,this.ctx.setTransform(v,0,0,-C,0,b*C),A(this.ctx,this.foregroundColor)}else A(this.ctx,this.foregroundColor),this.ctx.rect(x[0],x[1],h,b),this.ctx.clip(),this.endPath()}this.current=new P(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...y),this.transform(...L)}endAnnotation(){this.annotationCanvas&&(this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(w){if(!this.contentVisible)return;let x=w.count;w=this.getObject(w.data,w),w.count=x;let y=this.ctx,L=this.processingType3;if(L&&(L.compiled===void 0&&(L.compiled=E(w)),L.compiled)){L.compiled(y);return}let a=this._createMaskCanvas(w),h=a.canvas;y.save(),y.setTransform(1,0,0,1,0,0),y.drawImage(h,a.offsetX,a.offsetY),y.restore(),this.compose()}paintImageMaskXObjectRepeat(w,x,y=0,L=0,a,h){if(!this.contentVisible)return;w=this.getObject(w.data,w);let b=this.ctx;b.save();let v=(0,n.getCurrentTransform)(b);b.transform(x,y,L,a,0,0);let C=this._createMaskCanvas(w);b.setTransform(1,0,0,1,0,0);for(let I=0,O=h.length;I<O;I+=2){let U=r.Util.transform(v,[x,y,L,a,h[I],h[I+1]]),[K,G]=r.Util.applyTransform([0,0],U);b.drawImage(C.canvas,K,G)}b.restore(),this.compose()}paintImageMaskXObjectGroup(w){if(!this.contentVisible)return;let x=this.ctx,y=this.current.fillColor,L=this.current.patternFill;for(let a of w){let{data:h,width:b,height:v,transform:C}=a,I=this.cachedCanvases.getCanvas("maskCanvas",b,v),O=I.context;O.save();let U=this.getObject(h,a);p(O,U),O.globalCompositeOperation="source-in",O.fillStyle=L?y.getPattern(O,this,(0,n.getCurrentTransformInverse)(x),s.PathType.FILL):y,O.fillRect(0,0,b,v),O.restore(),x.save(),x.transform(...C),x.scale(1,-1),R(x,I.canvas,0,0,b,v,0,-1,1,1),x.restore()}this.compose()}paintImageXObject(w){if(!this.contentVisible)return;let x=this.getObject(w);if(!x){(0,r.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(x)}paintImageXObjectRepeat(w,x,y,L){if(!this.contentVisible)return;let a=this.getObject(w);if(!a){(0,r.warn)("Dependent image isn't ready yet");return}let h=a.width,b=a.height,v=[];for(let C=0,I=L.length;C<I;C+=2)v.push({transform:[x,0,0,y,L[C],L[C+1]],x:0,y:0,w:h,h:b});this.paintInlineImageXObjectGroup(a,v)}paintInlineImageXObject(w){if(!this.contentVisible)return;let x=w.width,y=w.height,L=this.ctx;this.save(),L.scale(1/x,-1/y);let a;if(typeof HTMLElement=="function"&&w instanceof HTMLElement||!w.data)a=w;else{let C=this.cachedCanvases.getCanvas("inlineImage",x,y),I=C.context;k(I,w,this.current.transferMaps),a=C.canvas}let h=this._scaleImage(a,(0,n.getCurrentTransformInverse)(L));L.imageSmoothingEnabled=Z((0,n.getCurrentTransform)(L),w.interpolate);let[b,v]=R(L,h.img,0,0,h.paintWidth,h.paintHeight,0,-y,x,y);if(this.imageLayer){let[C,I]=r.Util.applyTransform([0,-y],(0,n.getCurrentTransform)(this.ctx));this.imageLayer.appendImage({imgData:w,left:C,top:I,width:b,height:v})}this.compose(),this.restore()}paintInlineImageXObjectGroup(w,x){if(!this.contentVisible)return;let y=this.ctx,L=w.width,a=w.height,h=this.cachedCanvases.getCanvas("inlineImage",L,a),b=h.context;k(b,w,this.current.transferMaps);for(let v of x){if(y.save(),y.transform(...v.transform),y.scale(1,-1),R(y,h.canvas,v.x,v.y,v.w,v.h,0,-1,1,1),this.imageLayer){let[C,I]=r.Util.applyTransform([v.x,v.y],(0,n.getCurrentTransform)(this.ctx));this.imageLayer.appendImage({imgData:w,left:C,top:I,width:L,height:a})}y.restore()}this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(w){}markPointProps(w,x){}beginMarkedContent(w){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(w,x){w==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(x)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(w){let x=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(w);let y=this.ctx;this.pendingClip&&(x||(this.pendingClip===J?y.clip("evenodd"):y.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),y.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let w=(0,n.getCurrentTransform)(this.ctx);if(w[1]===0&&w[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(w[0]),Math.abs(w[3]));else{let x=Math.abs(w[0]*w[3]-w[2]*w[1]),y=Math.hypot(w[0],w[2]),L=Math.hypot(w[1],w[3]);this._cachedGetSinglePixelWidth=Math.max(y,L)/x}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(!this._cachedScaleForStroking){let{lineWidth:w}=this.current,x=(0,n.getCurrentTransform)(this.ctx),y,L;if(x[1]===0&&x[2]===0){let a=Math.abs(x[0]),h=Math.abs(x[3]);if(w===0)y=1/a,L=1/h;else{let b=a*w,v=h*w;y=b<1?1/b:1,L=v<1?1/v:1}}else{let a=Math.abs(x[0]*x[3]-x[2]*x[1]),h=Math.hypot(x[0],x[1]),b=Math.hypot(x[2],x[3]);if(w===0)y=b/a,L=h/a;else{let v=w*a;y=b>v?b/v:1,L=h>v?h/v:1}}this._cachedScaleForStroking=[y,L]}return this._cachedScaleForStroking}rescaleAndStroke(w){let{ctx:x}=this,{lineWidth:y}=this.current,[L,a]=this.getScaleForStroking();if(x.lineWidth=y||1,L===1&&a===1){x.stroke();return}let h,b,v;w&&(h=(0,n.getCurrentTransform)(x),b=x.getLineDash().slice(),v=x.lineDashOffset),x.scale(L,a);let C=Math.max(L,a);x.setLineDash(x.getLineDash().map(I=>I/C)),x.lineDashOffset/=C,x.stroke(),w&&(x.setTransform(...h),x.setLineDash(b),x.lineDashOffset=v)}isContentVisible(){for(let w=this.markedContentStack.length-1;w>=0;w--)if(!this.markedContentStack[w].visible)return!1;return!0}}e.CanvasGraphics=$;for(let B in r.OPS)$.prototype[B]!==void 0&&($.prototype[r.OPS[B]]=$.prototype[B])},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TilingPattern=e.PathType=void 0,e.getShadingPattern=d;var n=t(1),r=t(8),s=t(3);let l={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};e.PathType=l;function m(R,E){if(!E||s.isNodeJS)return;let P=E[2]-E[0],k=E[3]-E[1],p=new Path2D;p.rect(E[0],E[1],P,k),R.clip(p)}class u{constructor(){this.constructor===u&&(0,n.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,n.unreachable)("Abstract method `getPattern` called.")}}class i extends u{constructor(E){super(),this._type=E[1],this._bbox=E[2],this._colorStops=E[3],this._p0=E[4],this._p1=E[5],this._r0=E[6],this._r1=E[7],this.matrix=null}_createGradient(E){let P;this._type==="axial"?P=E.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(P=E.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let k of this._colorStops)P.addColorStop(k[0],k[1]);return P}getPattern(E,P,k,p){let g;if(p===l.STROKE||p===l.FILL){let A=P.current.getClippedPathBoundingBox(p,(0,r.getCurrentTransform)(E))||[0,0,0,0],M=Math.ceil(A[2]-A[0])||1,D=Math.ceil(A[3]-A[1])||1,V=P.cachedCanvases.getCanvas("pattern",M,D,!0),W=V.context;W.clearRect(0,0,W.canvas.width,W.canvas.height),W.beginPath(),W.rect(0,0,W.canvas.width,W.canvas.height),W.translate(-A[0],-A[1]),k=n.Util.transform(k,[1,0,0,1,A[0],A[1]]),W.transform(...P.baseTransform),this.matrix&&W.transform(...this.matrix),m(W,this._bbox),W.fillStyle=this._createGradient(W),W.fill(),g=E.createPattern(V.canvas,"no-repeat");let te=new DOMMatrix(k);try{g.setTransform(te)}catch(Z){(0,n.warn)(`RadialAxialShadingPattern.getPattern: "${Z?.message}".`)}}else m(E,this._bbox),g=this._createGradient(E);return g}}function c(R,E,P,k,p,g,A,M){let D=E.coords,V=E.colors,W=R.data,te=R.width*4,Z;D[P+1]>D[k+1]&&(Z=P,P=k,k=Z,Z=g,g=A,A=Z),D[k+1]>D[p+1]&&(Z=k,k=p,p=Z,Z=A,A=M,M=Z),D[P+1]>D[k+1]&&(Z=P,P=k,k=Z,Z=g,g=A,A=Z);let H=(D[P]+E.offsetX)*E.scaleX,N=(D[P+1]+E.offsetY)*E.scaleY,j=(D[k]+E.offsetX)*E.scaleX,J=(D[k+1]+E.offsetY)*E.scaleY,$=(D[p]+E.offsetX)*E.scaleX,B=(D[p+1]+E.offsetY)*E.scaleY;if(N>=B)return;let w=V[g],x=V[g+1],y=V[g+2],L=V[A],a=V[A+1],h=V[A+2],b=V[M],v=V[M+1],C=V[M+2],I=Math.round(N),O=Math.round(B),U,K,G,Y,ne,Q,re,ie;for(let ae=I;ae<=O;ae++){if(ae<J){let ue;ae<N?ue=0:ue=(N-ae)/(N-J),U=H-(H-j)*ue,K=w-(w-L)*ue,G=x-(x-a)*ue,Y=y-(y-h)*ue}else{let ue;ae>B?ue=1:J===B?ue=0:ue=(J-ae)/(J-B),U=j-(j-$)*ue,K=L-(L-b)*ue,G=a-(a-v)*ue,Y=h-(h-C)*ue}let le;ae<N?le=0:ae>B?le=1:le=(N-ae)/(N-B),ne=H-(H-$)*le,Q=w-(w-b)*le,re=x-(x-v)*le,ie=y-(y-C)*le;let oe=Math.round(Math.min(U,ne)),Ae=Math.round(Math.max(U,ne)),De=te*ae+oe*4;for(let ue=oe;ue<=Ae;ue++)le=(U-ue)/(U-ne),le<0?le=0:le>1&&(le=1),W[De++]=K-(K-Q)*le|0,W[De++]=G-(G-re)*le|0,W[De++]=Y-(Y-ie)*le|0,W[De++]=255}}function f(R,E,P){let k=E.coords,p=E.colors,g,A;switch(E.type){case"lattice":let M=E.verticesPerRow,D=Math.floor(k.length/M)-1,V=M-1;for(g=0;g<D;g++){let W=g*M;for(let te=0;te<V;te++,W++)c(R,P,k[W],k[W+1],k[W+M],p[W],p[W+1],p[W+M]),c(R,P,k[W+M+1],k[W+1],k[W+M],p[W+M+1],p[W+1],p[W+M])}break;case"triangles":for(g=0,A=k.length;g<A;g+=3)c(R,P,k[g],k[g+1],k[g+2],p[g],p[g+1],p[g+2]);break;default:throw new Error("illegal figure")}}class F extends u{constructor(E){super(),this._coords=E[2],this._colors=E[3],this._figures=E[4],this._bounds=E[5],this._bbox=E[7],this._background=E[8],this.matrix=null}_createMeshCanvas(E,P,k){let M=Math.floor(this._bounds[0]),D=Math.floor(this._bounds[1]),V=Math.ceil(this._bounds[2])-M,W=Math.ceil(this._bounds[3])-D,te=Math.min(Math.ceil(Math.abs(V*E[0]*1.1)),3e3),Z=Math.min(Math.ceil(Math.abs(W*E[1]*1.1)),3e3),H=V/te,N=W/Z,j={coords:this._coords,colors:this._colors,offsetX:-M,offsetY:-D,scaleX:1/H,scaleY:1/N},J=te+2*2,$=Z+2*2,B=k.getCanvas("mesh",J,$,!1),w=B.context,x=w.createImageData(te,Z);if(P){let L=x.data;for(let a=0,h=L.length;a<h;a+=4)L[a]=P[0],L[a+1]=P[1],L[a+2]=P[2],L[a+3]=255}for(let L of this._figures)f(x,L,j);return w.putImageData(x,2,2),{canvas:B.canvas,offsetX:M-2*H,offsetY:D-2*N,scaleX:H,scaleY:N}}getPattern(E,P,k,p){m(E,this._bbox);let g;if(p===l.SHADING)g=n.Util.singularValueDecompose2dScale((0,r.getCurrentTransform)(E));else if(g=n.Util.singularValueDecompose2dScale(P.baseTransform),this.matrix){let M=n.Util.singularValueDecompose2dScale(this.matrix);g=[g[0]*M[0],g[1]*M[1]]}let A=this._createMeshCanvas(g,p===l.SHADING?null:this._background,P.cachedCanvases);return p!==l.SHADING&&(E.setTransform(...P.baseTransform),this.matrix&&E.transform(...this.matrix)),E.translate(A.offsetX,A.offsetY),E.scale(A.scaleX,A.scaleY),E.createPattern(A.canvas,"no-repeat")}}class S extends u{getPattern(){return"hotpink"}}function d(R){switch(R[0]){case"RadialAxial":return new i(R);case"Mesh":return new F(R);case"Dummy":return new S}throw new Error(`Unknown IR type: ${R[0]}`)}let _={COLORED:1,UNCOLORED:2};class T{static get MAX_PATTERN_SIZE(){return(0,n.shadow)(this,"MAX_PATTERN_SIZE",3e3)}constructor(E,P,k,p,g){this.operatorList=E[2],this.matrix=E[3]||[1,0,0,1,0,0],this.bbox=E[4],this.xstep=E[5],this.ystep=E[6],this.paintType=E[7],this.tilingType=E[8],this.color=P,this.ctx=k,this.canvasGraphicsFactory=p,this.baseTransform=g}createPatternCanvas(E){let P=this.operatorList,k=this.bbox,p=this.xstep,g=this.ystep,A=this.paintType,M=this.tilingType,D=this.color,V=this.canvasGraphicsFactory;(0,n.info)("TilingType: "+M);let W=k[0],te=k[1],Z=k[2],H=k[3],N=n.Util.singularValueDecompose2dScale(this.matrix),j=n.Util.singularValueDecompose2dScale(this.baseTransform),J=[N[0]*j[0],N[1]*j[1]],$=this.getSizeAndScale(p,this.ctx.canvas.width,J[0]),B=this.getSizeAndScale(g,this.ctx.canvas.height,J[1]),w=E.cachedCanvases.getCanvas("pattern",$.size,B.size,!0),x=w.context,y=V.createCanvasGraphics(x);y.groupLevel=E.groupLevel,this.setFillAndStrokeStyleToContext(y,A,D);let L=W,a=te,h=Z,b=H;return W<0&&(L=0,h+=Math.abs(W)),te<0&&(a=0,b+=Math.abs(te)),x.translate(-($.scale*L),-(B.scale*a)),y.transform($.scale,0,0,B.scale,0,0),x.save(),this.clipBbox(y,L,a,h,b),y.baseTransform=(0,r.getCurrentTransform)(y.ctx),y.executeOperatorList(P),y.endDrawing(),{canvas:w.canvas,scaleX:$.scale,scaleY:B.scale,offsetX:L,offsetY:a}}getSizeAndScale(E,P,k){E=Math.abs(E);let p=Math.max(T.MAX_PATTERN_SIZE,P),g=Math.ceil(E*k);return g>=p?g=p:k=g/E,{scale:k,size:g}}clipBbox(E,P,k,p,g){let A=p-P,M=g-k;E.ctx.rect(P,k,A,M),E.current.updateRectMinMax((0,r.getCurrentTransform)(E.ctx),[P,k,p,g]),E.clip(),E.endPath()}setFillAndStrokeStyleToContext(E,P,k){let p=E.ctx,g=E.current;switch(P){case _.COLORED:let A=this.ctx;p.fillStyle=A.fillStyle,p.strokeStyle=A.strokeStyle,g.fillColor=A.fillStyle,g.strokeColor=A.strokeStyle;break;case _.UNCOLORED:let M=n.Util.makeHexColor(k[0],k[1],k[2]);p.fillStyle=M,p.strokeStyle=M,g.fillColor=M,g.strokeColor=M;break;default:throw new n.FormatError(`Unsupported paint type: ${P}`)}}getPattern(E,P,k,p){let g=k;p!==l.SHADING&&(g=n.Util.transform(g,P.baseTransform),this.matrix&&(g=n.Util.transform(g,this.matrix)));let A=this.createPatternCanvas(P),M=new DOMMatrix(g);M=M.translate(A.offsetX,A.offsetY),M=M.scale(1/A.scaleX,1/A.scaleY);let D=E.createPattern(A.canvas,"repeat");try{D.setTransform(M)}catch(V){(0,n.warn)(`TilingPattern.getPattern: "${V?.message}".`)}return D}}e.TilingPattern=T},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.applyMaskImageData=r;var n=t(1);function r({src:s,srcPos:l=0,dest:m,destPos:u=0,width:i,height:c,inverseDecode:f=!1}){let F=n.FeatureTest.isLittleEndian?4278190080:255,[S,d]=f?[0,F]:[F,0],_=i>>3,T=i&7,R=s.length;m=new Uint32Array(m.buffer);for(let E=0;E<c;E++){for(let k=l+_;l<k;l++){let p=l<R?s[l]:255;m[u++]=p&128?d:S,m[u++]=p&64?d:S,m[u++]=p&32?d:S,m[u++]=p&16?d:S,m[u++]=p&8?d:S,m[u++]=p&4?d:S,m[u++]=p&2?d:S,m[u++]=p&1?d:S}if(T===0)continue;let P=l<R?s[l++]:255;for(let k=0;k<T;k++)m[u++]=P&1<<7-k?d:S}return{srcPos:l,destPos:u}}},(o,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalWorkerOptions=void 0;let t=Object.create(null);e.GlobalWorkerOptions=t,t.workerPort=t.workerPort===void 0?null:t.workerPort,t.workerSrc=t.workerSrc===void 0?"":t.workerSrc},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MessageHandler=void 0;var n=t(1);let r={UNKNOWN:0,DATA:1,ERROR:2},s={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function l(u){switch(u instanceof Error||typeof u=="object"&&u!==null||(0,n.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),u.name){case"AbortException":return new n.AbortException(u.message);case"MissingPDFException":return new n.MissingPDFException(u.message);case"PasswordException":return new n.PasswordException(u.message,u.code);case"UnexpectedResponseException":return new n.UnexpectedResponseException(u.message,u.status);case"UnknownErrorException":return new n.UnknownErrorException(u.message,u.details);default:return new n.UnknownErrorException(u.message,u.toString())}}class m{constructor(i,c,f){this.sourceName=i,this.targetName=c,this.comObj=f,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=F=>{let S=F.data;if(S.targetName!==this.sourceName)return;if(S.stream){this._processStreamMessage(S);return}if(S.callback){let _=S.callbackId,T=this.callbackCapabilities[_];if(!T)throw new Error(`Cannot resolve callback ${_}`);if(delete this.callbackCapabilities[_],S.callback===r.DATA)T.resolve(S.data);else if(S.callback===r.ERROR)T.reject(l(S.reason));else throw new Error("Unexpected callback case");return}let d=this.actionHandler[S.action];if(!d)throw new Error(`Unknown action from worker: ${S.action}`);if(S.callbackId){let _=this.sourceName,T=S.sourceName;new Promise(function(R){R(d(S.data))}).then(function(R){f.postMessage({sourceName:_,targetName:T,callback:r.DATA,callbackId:S.callbackId,data:R})},function(R){f.postMessage({sourceName:_,targetName:T,callback:r.ERROR,callbackId:S.callbackId,reason:l(R)})});return}if(S.streamId){this._createStreamSink(S);return}d(S.data)},f.addEventListener("message",this._onComObjOnMessage)}on(i,c){let f=this.actionHandler;if(f[i])throw new Error(`There is already an actionName called "${i}"`);f[i]=c}send(i,c,f){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:i,data:c},f)}sendWithPromise(i,c,f){let F=this.callbackId++,S=(0,n.createPromiseCapability)();this.callbackCapabilities[F]=S;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:i,callbackId:F,data:c},f)}catch(d){S.reject(d)}return S.promise}sendWithStream(i,c,f,F){let S=this.streamId++,d=this.sourceName,_=this.targetName,T=this.comObj;return new ReadableStream({start:R=>{let E=(0,n.createPromiseCapability)();return this.streamControllers[S]={controller:R,startCall:E,pullCall:null,cancelCall:null,isClosed:!1},T.postMessage({sourceName:d,targetName:_,action:i,streamId:S,data:c,desiredSize:R.desiredSize},F),E.promise},pull:R=>{let E=(0,n.createPromiseCapability)();return this.streamControllers[S].pullCall=E,T.postMessage({sourceName:d,targetName:_,stream:s.PULL,streamId:S,desiredSize:R.desiredSize}),E.promise},cancel:R=>{(0,n.assert)(R instanceof Error,"cancel must have a valid reason");let E=(0,n.createPromiseCapability)();return this.streamControllers[S].cancelCall=E,this.streamControllers[S].isClosed=!0,T.postMessage({sourceName:d,targetName:_,stream:s.CANCEL,streamId:S,reason:l(R)}),E.promise}},f)}_createStreamSink(i){let c=i.streamId,f=this.sourceName,F=i.sourceName,S=this.comObj,d=this,_=this.actionHandler[i.action],T={enqueue(R,E=1,P){if(this.isCancelled)return;let k=this.desiredSize;this.desiredSize-=E,k>0&&this.desiredSize<=0&&(this.sinkCapability=(0,n.createPromiseCapability)(),this.ready=this.sinkCapability.promise),S.postMessage({sourceName:f,targetName:F,stream:s.ENQUEUE,streamId:c,chunk:R},P)},close(){this.isCancelled||(this.isCancelled=!0,S.postMessage({sourceName:f,targetName:F,stream:s.CLOSE,streamId:c}),delete d.streamSinks[c])},error(R){(0,n.assert)(R instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,S.postMessage({sourceName:f,targetName:F,stream:s.ERROR,streamId:c,reason:l(R)}))},sinkCapability:(0,n.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:i.desiredSize,ready:null};T.sinkCapability.resolve(),T.ready=T.sinkCapability.promise,this.streamSinks[c]=T,new Promise(function(R){R(_(i.data,T))}).then(function(){S.postMessage({sourceName:f,targetName:F,stream:s.START_COMPLETE,streamId:c,success:!0})},function(R){S.postMessage({sourceName:f,targetName:F,stream:s.START_COMPLETE,streamId:c,reason:l(R)})})}_processStreamMessage(i){let c=i.streamId,f=this.sourceName,F=i.sourceName,S=this.comObj,d=this.streamControllers[c],_=this.streamSinks[c];switch(i.stream){case s.START_COMPLETE:i.success?d.startCall.resolve():d.startCall.reject(l(i.reason));break;case s.PULL_COMPLETE:i.success?d.pullCall.resolve():d.pullCall.reject(l(i.reason));break;case s.PULL:if(!_){S.postMessage({sourceName:f,targetName:F,stream:s.PULL_COMPLETE,streamId:c,success:!0});break}_.desiredSize<=0&&i.desiredSize>0&&_.sinkCapability.resolve(),_.desiredSize=i.desiredSize,new Promise(function(T){T(_.onPull&&_.onPull())}).then(function(){S.postMessage({sourceName:f,targetName:F,stream:s.PULL_COMPLETE,streamId:c,success:!0})},function(T){S.postMessage({sourceName:f,targetName:F,stream:s.PULL_COMPLETE,streamId:c,reason:l(T)})});break;case s.ENQUEUE:if((0,n.assert)(d,"enqueue should have stream controller"),d.isClosed)break;d.controller.enqueue(i.chunk);break;case s.CLOSE:if((0,n.assert)(d,"close should have stream controller"),d.isClosed)break;d.isClosed=!0,d.controller.close(),this._deleteStreamController(d,c);break;case s.ERROR:(0,n.assert)(d,"error should have stream controller"),d.controller.error(l(i.reason)),this._deleteStreamController(d,c);break;case s.CANCEL_COMPLETE:i.success?d.cancelCall.resolve():d.cancelCall.reject(l(i.reason)),this._deleteStreamController(d,c);break;case s.CANCEL:if(!_)break;new Promise(function(T){T(_.onCancel&&_.onCancel(l(i.reason)))}).then(function(){S.postMessage({sourceName:f,targetName:F,stream:s.CANCEL_COMPLETE,streamId:c,success:!0})},function(T){S.postMessage({sourceName:f,targetName:F,stream:s.CANCEL_COMPLETE,streamId:c,reason:l(T)})}),_.sinkCapability.reject(l(i.reason)),_.isCancelled=!0,delete this.streamSinks[c];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(i,c){await Promise.allSettled([i.startCall&&i.startCall.promise,i.pullCall&&i.pullCall.promise,i.cancelCall&&i.cancelCall.promise]),delete this.streamControllers[c]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}e.MessageHandler=m},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var n=t(1);class r{#e;#t;constructor({parsedData:l,rawData:m}){this.#e=l,this.#t=m}getRaw(){return this.#t}get(l){return this.#e.get(l)??null}getAll(){return(0,n.objectFromMap)(this.#e)}has(l){return this.#e.has(l)}}e.Metadata=r},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OptionalContentConfig=void 0;var n=t(1);let r=Symbol("INTERNAL");class s{#e=!0;constructor(u,i){this.name=u,this.intent=i}get visible(){return this.#e}_setVisible(u,i){u!==r&&(0,n.unreachable)("Internal method `_setVisible` called."),this.#e=i}}class l{#e=!0;#t=new Map;#r=null;#n=null;constructor(u){if(this.name=null,this.creator=null,u!==null){this.name=u.name,this.creator=u.creator,this.#n=u.order;for(let i of u.groups)this.#t.set(i.id,new s(i.name,i.intent));if(u.baseState==="OFF")for(let i of this.#t.values())i._setVisible(r,!1);for(let i of u.on)this.#t.get(i)._setVisible(r,!0);for(let i of u.off)this.#t.get(i)._setVisible(r,!1);this.#r=new Map;for(let[i,c]of this.#t)this.#r.set(i,c.visible)}}#i(u){let i=u.length;if(i<2)return!0;let c=u[0];for(let f=1;f<i;f++){let F=u[f],S;if(Array.isArray(F))S=this.#i(F);else if(this.#t.has(F))S=this.#t.get(F).visible;else return(0,n.warn)(`Optional content group not found: ${F}`),!0;switch(c){case"And":if(!S)return!1;break;case"Or":if(S)return!0;break;case"Not":return!S;default:return!0}}return c==="And"}isVisible(u){if(this.#t.size===0)return!0;if(!u)return(0,n.warn)("Optional content group not defined."),!0;if(u.type==="OCG")return this.#t.has(u.id)?this.#t.get(u.id).visible:((0,n.warn)(`Optional content group not found: ${u.id}`),!0);if(u.type==="OCMD"){if(u.expression)return this.#i(u.expression);if(!u.policy||u.policy==="AnyOn"){for(let i of u.ids){if(!this.#t.has(i))return(0,n.warn)(`Optional content group not found: ${i}`),!0;if(this.#t.get(i).visible)return!0}return!1}else if(u.policy==="AllOn"){for(let i of u.ids){if(!this.#t.has(i))return(0,n.warn)(`Optional content group not found: ${i}`),!0;if(!this.#t.get(i).visible)return!1}return!0}else if(u.policy==="AnyOff"){for(let i of u.ids){if(!this.#t.has(i))return(0,n.warn)(`Optional content group not found: ${i}`),!0;if(!this.#t.get(i).visible)return!0}return!1}else if(u.policy==="AllOff"){for(let i of u.ids){if(!this.#t.has(i))return(0,n.warn)(`Optional content group not found: ${i}`),!0;if(this.#t.get(i).visible)return!1}return!0}return(0,n.warn)(`Unknown optional content policy ${u.policy}.`),!0}return(0,n.warn)(`Unknown group type ${u.type}.`),!0}setVisibility(u,i=!0){if(!this.#t.has(u)){(0,n.warn)(`Optional content group not found: ${u}`);return}this.#t.get(u)._setVisible(r,!!i),this.#e=null}get hasInitialVisibility(){if(this.#e!==null)return this.#e;for(let[u,i]of this.#t){let c=this.#r.get(u);if(i.visible!==c)return this.#e=!1}return this.#e=!0}getOrder(){return this.#t.size?this.#n?this.#n.slice():[...this.#t.keys()]:null}getGroups(){return this.#t.size>0?(0,n.objectFromMap)(this.#t):null}getGroup(u){return this.#t.get(u)||null}}e.OptionalContentConfig=l},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFDataTransportStream=void 0;var n=t(1),r=t(8);class s{constructor(i,c){(0,n.assert)(c,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=i.progressiveDone||!1,this._contentDispositionFilename=i.contentDispositionFilename||null;let f=i.initialData;if(f?.length>0){let F=new Uint8Array(f).buffer;this._queuedChunks.push(F)}this._pdfDataRangeTransport=c,this._isStreamingSupported=!i.disableStream,this._isRangeSupported=!i.disableRange,this._contentLength=i.length,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((F,S)=>{this._onReceiveData({begin:F,chunk:S})}),this._pdfDataRangeTransport.addProgressListener((F,S)=>{this._onProgress({loaded:F,total:S})}),this._pdfDataRangeTransport.addProgressiveReadListener(F=>{this._onReceiveData({chunk:F})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData(i){let c=new Uint8Array(i.chunk).buffer;if(i.begin===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(c):this._queuedChunks.push(c);else{let f=this._rangeReaders.some(function(F){return F._begin!==i.begin?!1:(F._enqueue(c),!0)});(0,n.assert)(f,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(i){if(i.total===void 0){let c=this._rangeReaders[0];c?.onProgress&&c.onProgress({loaded:i.loaded})}else{let c=this._fullRequestReader;c?.onProgress&&c.onProgress({loaded:i.loaded,total:i.total})}}_onProgressiveDone(){this._fullRequestReader&&this._fullRequestReader.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(i){let c=this._rangeReaders.indexOf(i);c>=0&&this._rangeReaders.splice(c,1)}getFullReader(){(0,n.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let i=this._queuedChunks;return this._queuedChunks=null,new l(this,i,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(i,c){if(c<=this._progressiveDataLength)return null;let f=new m(this,i,c);return this._pdfDataRangeTransport.requestDataRange(i,c),this._rangeReaders.push(f),f}cancelAllRequests(i){this._fullRequestReader&&this._fullRequestReader.cancel(i);for(let c of this._rangeReaders.slice(0))c.cancel(i);this._pdfDataRangeTransport.abort()}}e.PDFDataTransportStream=s;class l{constructor(i,c,f=!1,F=null){this._stream=i,this._done=f||!1,this._filename=(0,r.isPdfFile)(F)?F:null,this._queuedChunks=c||[],this._loaded=0;for(let S of this._queuedChunks)this._loaded+=S.byteLength;this._requests=[],this._headersReady=Promise.resolve(),i._fullRequestReader=this,this.onProgress=null}_enqueue(i){this._done||(this._requests.length>0?this._requests.shift().resolve({value:i,done:!1}):this._queuedChunks.push(i),this._loaded+=i.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let i=(0,n.createPromiseCapability)();return this._requests.push(i),i.promise}cancel(i){this._done=!0;for(let c of this._requests)c.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class m{constructor(i,c,f){this._stream=i,this._begin=c,this._end=f,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(i){if(!this._done){if(this._requests.length===0)this._queuedChunk=i;else{this._requests.shift().resolve({value:i,done:!1});for(let f of this._requests)f.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let c=this._queuedChunk;return this._queuedChunk=null,{value:c,done:!1}}if(this._done)return{value:void 0,done:!0};let i=(0,n.createPromiseCapability)();return this._requests.push(i),i.promise}cancel(i){this._done=!0;for(let c of this._requests)c.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(o,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaText=void 0;class t{static textContent(r){let s=[],l={items:s,styles:Object.create(null)};function m(u){if(!u)return;let i=null,c=u.name;if(c==="#text")i=u.value;else if(t.shouldBuildText(c))u?.attributes?.textContent?i=u.attributes.textContent:u.value&&(i=u.value);else return;if(i!==null&&s.push({str:i}),!!u.children)for(let f of u.children)m(f)}return m(r),l}static shouldBuildText(r){return!(r==="textarea"||r==="input"||r==="option"||r==="select")}}e.XfaText=t},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NodeStandardFontDataFactory=e.NodeCanvasFactory=e.NodeCMapReaderFactory=void 0;var n=t(9);let r=function(u){return new Promise((i,c)=>{Fr().readFile(u,(F,S)=>{if(F||!S){c(new Error(F));return}i(new Uint8Array(S))})})};class s extends n.BaseCanvasFactory{_createCanvas(i,c){return $i().createCanvas(i,c)}}e.NodeCanvasFactory=s;class l extends n.BaseCMapReaderFactory{_fetchData(i,c){return r(i).then(f=>({cMapData:f,compressionType:c}))}}e.NodeCMapReaderFactory=l;class m extends n.BaseStandardFontDataFactory{_fetchData(i){return r(i)}}e.NodeStandardFontDataFactory=m},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditorLayer=void 0;var n=t(7),r=t(1),s=t(23),l=t(24);class m{#e;#t=!1;#r=this.pointerup.bind(this);#n=this.pointerdown.bind(this);#i=new Map;#u=!1;#a=!1;#o;static _initialized=!1;constructor(i){m._initialized||(m._initialized=!0,s.FreeTextEditor.initialize(i.l10n),l.InkEditor.initialize(i.l10n),i.uiManager.registerEditorTypes([s.FreeTextEditor,l.InkEditor])),this.#o=i.uiManager,this.annotationStorage=i.annotationStorage,this.pageIndex=i.pageIndex,this.div=i.div,this.#e=i.accessibilityManager,this.#o.addLayer(this)}updateToolbar(i){this.#o.updateToolbar(i)}updateMode(i=this.#o.getMode()){this.#s(),i===r.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),this.#o.unselectAll()}addInkEditorIfNeeded(i){if(!i&&this.#o.getMode()!==r.AnnotationEditorType.INK)return;if(!i){for(let f of this.#i.values())if(f.isEmpty()){f.setInBackground();return}}this.#l({offsetX:0,offsetY:0}).setInBackground()}setEditingState(i){this.#o.setEditingState(i)}addCommands(i){this.#o.addCommands(i)}enable(){this.div.style.pointerEvents="auto";for(let i of this.#i.values())i.enableEditing()}disable(){this.div.style.pointerEvents="none";for(let i of this.#i.values())i.disableEditing()}setActiveEditor(i){this.#o.getActive()!==i&&this.#o.setActiveEditor(i)}enableClick(){this.div.addEventListener("pointerdown",this.#n),this.div.addEventListener("pointerup",this.#r)}disableClick(){this.div.removeEventListener("pointerdown",this.#n),this.div.removeEventListener("pointerup",this.#r)}attach(i){this.#i.set(i.id,i)}detach(i){this.#i.delete(i.id),this.#e?.removePointerInTextLayer(i.contentDiv)}remove(i){this.#o.removeEditor(i),this.detach(i),this.annotationStorage.remove(i.id),i.div.style.display="none",setTimeout(()=>{i.div.style.display="",i.div.remove(),i.isAttachedToDOM=!1,document.activeElement===document.body&&this.#o.focusMainContainer()},0),this.#a||this.addInkEditorIfNeeded(!1)}#d(i){i.parent!==this&&(this.attach(i),i.pageIndex=this.pageIndex,i.parent?.detach(i),i.parent=this,i.div&&i.isAttachedToDOM&&(i.div.remove(),this.div.append(i.div)))}add(i){if(this.#d(i),this.#o.addEditor(i),this.attach(i),!i.isAttachedToDOM){let c=i.render();this.div.append(c),i.isAttachedToDOM=!0}this.moveEditorInDOM(i),i.onceAdded(),this.addToAnnotationStorage(i)}moveEditorInDOM(i){this.#e?.moveElementInDOM(this.div,i.div,i.contentDiv,!0)}addToAnnotationStorage(i){!i.isEmpty()&&!this.annotationStorage.has(i.id)&&this.annotationStorage.setValue(i.id,i)}addOrRebuild(i){i.needsToBeRebuilt()?i.rebuild():this.add(i)}addANewEditor(i){let c=()=>{this.addOrRebuild(i)},f=()=>{i.remove()};this.addCommands({cmd:c,undo:f,mustExec:!0})}addUndoableEditor(i){let c=()=>{this.addOrRebuild(i)},f=()=>{i.remove()};this.addCommands({cmd:c,undo:f,mustExec:!1})}getNextId(){return this.#o.getId()}#c(i){switch(this.#o.getMode()){case r.AnnotationEditorType.FREETEXT:return new s.FreeTextEditor(i);case r.AnnotationEditorType.INK:return new l.InkEditor(i)}return null}deserialize(i){switch(i.annotationType){case r.AnnotationEditorType.FREETEXT:return s.FreeTextEditor.deserialize(i,this);case r.AnnotationEditorType.INK:return l.InkEditor.deserialize(i,this)}return null}#l(i){let c=this.getNextId(),f=this.#c({parent:this,id:c,x:i.offsetX,y:i.offsetY});return f&&this.add(f),f}setSelected(i){this.#o.setSelected(i)}toggleSelected(i){this.#o.toggleSelected(i)}isSelected(i){return this.#o.isSelected(i)}unselect(i){this.#o.unselect(i)}pointerup(i){let c=n.KeyboardManager.platform.isMac;if(!(i.button!==0||i.ctrlKey&&c)&&i.target===this.div&&this.#u){if(this.#u=!1,!this.#t){this.#t=!0;return}this.#l(i)}}pointerdown(i){let c=n.KeyboardManager.platform.isMac;if(i.button!==0||i.ctrlKey&&c||i.target!==this.div)return;this.#u=!0;let f=this.#o.getActive();this.#t=!f||f.isEmpty()}drop(i){let c=i.dataTransfer.getData("text/plain"),f=this.#o.getEditor(c);if(!f)return;i.preventDefault(),i.dataTransfer.dropEffect="move",this.#d(f);let F=this.div.getBoundingClientRect(),S=i.clientX-F.x,d=i.clientY-F.y;f.translate(S-f.startX,d-f.startY),this.moveEditorInDOM(f),f.div.focus()}dragover(i){i.preventDefault()}destroy(){this.#o.getActive()?.parent===this&&this.#o.setActiveEditor(null);for(let i of this.#i.values())this.#e?.removePointerInTextLayer(i.contentDiv),i.isAttachedToDOM=!1,i.div.remove(),i.parent=null;this.div=null,this.#i.clear(),this.#o.removeLayer(this)}#s(){this.#a=!0;for(let i of this.#i.values())i.isEmpty()&&i.remove();this.#a=!1}render(i){this.viewport=i.viewport,(0,n.bindEvents)(this,this.div,["dragover","drop"]),this.setDimensions();for(let c of this.#o.getEditors(this.pageIndex))this.add(c);this.updateMode()}update(i){this.viewport=i.viewport,this.setDimensions(),this.updateMode()}get scaleFactor(){return this.viewport.scale}get pageDimensions(){let[i,c,f,F]=this.viewport.viewBox,S=f-i,d=F-c;return[S,d]}get viewportBaseDimensions(){let{width:i,height:c,rotation:f}=this.viewport;return f%180===0?[i,c]:[c,i]}setDimensions(){let{width:i,height:c,rotation:f}=this.viewport,F=f%180!==0,S=Math.floor(i)+"px",d=Math.floor(c)+"px";this.div.style.width=F?d:S,this.div.style.height=F?S:d,this.div.setAttribute("data-main-rotation",f)}}e.AnnotationEditorLayer=m},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FreeTextEditor=void 0;var n=t(1),r=t(7),s=t(6);class l extends s.AnnotationEditor{#e=this.editorDivBlur.bind(this);#t=this.editorDivFocus.bind(this);#r=this.editorDivKeydown.bind(this);#n;#i="";#u=!1;#a;static _freeTextDefaultContent="";static _l10nPromise;static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static _keyboardManager=new r.KeyboardManager([[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],l.prototype.commitOrRemove]]);static _type="freetext";constructor(u){super({...u,name:"freeTextEditor"}),this.#n=u.color||l._defaultColor||s.AnnotationEditor._defaultLineColor,this.#a=u.fontSize||l._defaultFontSize}static initialize(u){this._l10nPromise=new Map(["free_text_default_content","editor_free_text_aria_label"].map(c=>[c,u.get(c)]));let i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(u,i){switch(u){case n.AnnotationEditorParamsType.FREETEXT_SIZE:l._defaultFontSize=i;break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:l._defaultColor=i;break}}updateParams(u,i){switch(u){case n.AnnotationEditorParamsType.FREETEXT_SIZE:this.#o(i);break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:this.#d(i);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,l._defaultFontSize],[n.AnnotationEditorParamsType.FREETEXT_COLOR,l._defaultColor||s.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,this.#a],[n.AnnotationEditorParamsType.FREETEXT_COLOR,this.#n]]}#o(u){let i=f=>{this.editorDiv.style.fontSize=`calc(${f}px * var(--scale-factor))`,this.translate(0,-(f-this.#a)*this.parent.scaleFactor),this.#a=f,this.#l()},c=this.#a;this.parent.addCommands({cmd:()=>{i(u)},undo:()=>{i(c)},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#d(u){let i=this.#n;this.parent.addCommands({cmd:()=>{this.#n=u,this.editorDiv.style.color=u},undo:()=>{this.#n=i,this.editorDiv.style.color=i},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}getInitialTranslation(){return[-l._internalPadding*this.parent.scaleFactor,-(l._internalPadding+this.#a)*this.parent.scaleFactor]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(n.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.enableEditing(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.editorDiv.addEventListener("keydown",this.#r),this.editorDiv.addEventListener("focus",this.#t),this.editorDiv.addEventListener("blur",this.#e))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.disableEditing(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",this.#r),this.editorDiv.removeEventListener("focus",this.#t),this.editorDiv.removeEventListener("blur",this.#e),this.div.focus(),this.isEditing=!1)}focusin(u){super.focusin(u),u.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus())}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent.setEditingState(!0),super.remove()}#c(){let u=this.editorDiv.getElementsByTagName("div");if(u.length===0)return this.editorDiv.innerText;let i=[];for(let c=0,f=u.length;c<f;c++){let S=u[c].firstChild;S?.nodeName==="#text"?i.push(S.data):i.push("")}return i.join(`
`)}#l(){let[u,i]=this.parent.viewportBaseDimensions,c=this.div.getBoundingClientRect();this.width=c.width/u,this.height=c.height/i}commit(){super.commit(),this.#u||(this.#u=!0,this.parent.addUndoableEditor(this)),this.disableEditMode(),this.#i=this.#c().trimEnd(),this.#l()}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(u){this.enableEditMode(),this.editorDiv.focus()}keydown(u){u.target===this.div&&u.key==="Enter"&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(u){l._keyboardManager.exec(this,u)}editorDivFocus(u){this.isEditing=!0}editorDivBlur(u){this.isEditing=!1}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let u,i;this.width&&(u=this.x,i=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",`${this.id}-editor`),this.enableEditing(),l._l10nPromise.get("editor_free_text_aria_label").then(f=>this.editorDiv?.setAttribute("aria-label",f)),l._l10nPromise.get("free_text_default_content").then(f=>this.editorDiv?.setAttribute("default-content",f)),this.editorDiv.contentEditable=!0;let{style:c}=this.editorDiv;if(c.fontSize=`calc(${this.#a}px * var(--scale-factor))`,c.color=this.#n,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,r.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){let[f,F]=this.parent.viewportBaseDimensions;this.setAt(u*f,i*F,this.width*f,this.height*F);for(let S of this.#i.split(`
`)){let d=document.createElement("div");d.append(S?document.createTextNode(S):document.createElement("br")),this.editorDiv.append(d)}this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(u,i){let c=super.deserialize(u,i);return c.#a=u.fontSize,c.#n=n.Util.makeHexColor(...u.color),c.#i=u.value,c}serialize(){if(this.isEmpty())return null;let u=l._internalPadding*this.parent.scaleFactor,i=this.getRect(u,u),c=s.AnnotationEditor._colorManager.convert(getComputedStyle(this.editorDiv).color);return{annotationType:n.AnnotationEditorType.FREETEXT,color:c,fontSize:this.#a,value:this.#i,pageIndex:this.parent.pageIndex,rect:i,rotation:this.rotation}}}e.FreeTextEditor=l},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InkEditor=void 0,Object.defineProperty(e,"fitCurve",{enumerable:!0,get:function(){return s.fitCurve}});var n=t(1),r=t(6),s=t(25),l=t(7);let m=16;class u extends r.AnnotationEditor{#e=0;#t=0;#r=0;#n=this.canvasPointermove.bind(this);#i=this.canvasPointerleave.bind(this);#u=this.canvasPointerup.bind(this);#a=this.canvasPointerdown.bind(this);#o=!1;#d=!1;#c=null;#l=null;#s=0;#f=0;#m=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _l10nPromise;static _type="ink";constructor(c){super({...c,name:"inkEditor"}),this.color=c.color||null,this.thickness=c.thickness||null,this.opacity=c.opacity||null,this.paths=[],this.bezierPath2D=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(c){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink_aria_label"].map(f=>[f,c.get(f)]))}static updateDefaultParams(c,f){switch(c){case n.AnnotationEditorParamsType.INK_THICKNESS:u._defaultThickness=f;break;case n.AnnotationEditorParamsType.INK_COLOR:u._defaultColor=f;break;case n.AnnotationEditorParamsType.INK_OPACITY:u._defaultOpacity=f/100;break}}updateParams(c,f){switch(c){case n.AnnotationEditorParamsType.INK_THICKNESS:this.#T(f);break;case n.AnnotationEditorParamsType.INK_COLOR:this.#b(f);break;case n.AnnotationEditorParamsType.INK_OPACITY:this.#F(f);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,u._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,u._defaultColor||r.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(u._defaultOpacity*100)]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||u._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,this.color||u._defaultColor||r.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??u._defaultOpacity))]]}#T(c){let f=this.thickness;this.parent.addCommands({cmd:()=>{this.thickness=c,this.#k()},undo:()=>{this.thickness=f,this.#k()},mustExec:!0,type:n.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#b(c){let f=this.color;this.parent.addCommands({cmd:()=>{this.color=c,this.#h()},undo:()=>{this.color=f,this.#h()},mustExec:!0,type:n.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#F(c){c/=100;let f=this.opacity;this.parent.addCommands({cmd:()=>{this.opacity=c,this.#h()},undo:()=>{this.opacity=f,this.#h()},mustExec:!0,type:n.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(this.#g(),this.#x()),this.isAttachedToDOM||(this.parent.add(this),this.#A()),this.#k())}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#l.disconnect(),this.#l=null,super.remove())}enableEditMode(){this.#o||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",this.#a),this.canvas.addEventListener("pointerup",this.#u))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#a),this.canvas.removeEventListener("pointerup",this.#u))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#v(){let{width:c,height:f,rotation:F}=this.parent.viewport;switch(F){case 90:return[0,c,c,f];case 180:return[c,f,c,f];case 270:return[f,0,c,f];default:return[0,0,c,f]}}#_(){this.ctx.lineWidth=this.thickness*this.parent.scaleFactor/this.scaleFactor,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.miterLimit=10,this.ctx.strokeStyle=`${this.color}${(0,l.opacityToHex)(this.opacity)}`}#p(c,f){this.isEditing=!0,this.#d||(this.#d=!0,this.#A(),this.thickness||=u._defaultThickness,this.color||=u._defaultColor||r.AnnotationEditor._defaultLineColor,this.opacity??=u._defaultOpacity),this.currentPath.push([c,f]),this.#c=null,this.#_(),this.ctx.beginPath(),this.ctx.moveTo(c,f),this.#m=()=>{this.#m&&(this.#c&&(this.isEmpty()?(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)):this.#h(),this.ctx.lineTo(...this.#c),this.#c=null,this.ctx.stroke()),window.requestAnimationFrame(this.#m))},window.requestAnimationFrame(this.#m)}#w(c,f){let[F,S]=this.currentPath.at(-1);c===F&&f===S||(this.currentPath.push([c,f]),this.#c=[c,f])}#y(c,f){this.ctx.closePath(),this.#m=null,c=Math.min(Math.max(c,0),this.canvas.width),f=Math.min(Math.max(f,0),this.canvas.height);let[F,S]=this.currentPath.at(-1);(c!==F||f!==S)&&this.currentPath.push([c,f]);let d;if(this.currentPath.length!==1)d=(0,s.fitCurve)(this.currentPath,30,null);else{let E=[c,f];d=[[E,E.slice(),E.slice(),E]]}let _=u.#C(d);this.currentPath.length=0;let T=()=>{this.paths.push(d),this.bezierPath2D.push(_),this.rebuild()},R=()=>{this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#g(),this.#x()),this.#k())};this.parent.addCommands({cmd:T,undo:R,mustExec:!0})}#h(){if(this.isEmpty()){this.#E();return}this.#_();let{canvas:c,ctx:f}=this;f.setTransform(1,0,0,1,0,0),f.clearRect(0,0,c.width,c.height),this.#E();for(let F of this.bezierPath2D)f.stroke(F)}commit(){this.#o||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#o=!0,this.div.classList.add("disabled"),this.#k(!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus())}focusin(c){super.focusin(c),this.enableEditMode()}canvasPointerdown(c){c.button!==0||!this.isInEditMode()||this.#o||(this.setInForeground(),c.type!=="mouse"&&this.div.focus(),c.stopPropagation(),this.canvas.addEventListener("pointerleave",this.#i),this.canvas.addEventListener("pointermove",this.#n),this.#p(c.offsetX,c.offsetY))}canvasPointermove(c){c.stopPropagation(),this.#w(c.offsetX,c.offsetY)}canvasPointerup(c){c.button===0&&this.isInEditMode()&&this.currentPath.length!==0&&(c.stopPropagation(),this.#S(c),this.setInBackground())}canvasPointerleave(c){this.#S(c),this.setInBackground()}#S(c){this.#y(c.offsetX,c.offsetY),this.canvas.removeEventListener("pointerleave",this.#i),this.canvas.removeEventListener("pointermove",this.#n),this.parent.addToAnnotationStorage(this)}#g(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",u._l10nPromise.get("editor_ink_canvas_aria_label").then(c=>this.canvas?.setAttribute("aria-label",c)),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#x(){this.#l=new ResizeObserver(c=>{let f=c[0].contentRect;f.width&&f.height&&this.setDimensions(f.width,f.height)}),this.#l.observe(this.div)}render(){if(this.div)return this.div;let c,f;this.width&&(c=this.x,f=this.y),super.render(),u._l10nPromise.get("editor_ink_aria_label").then(T=>this.div?.setAttribute("aria-label",T));let[F,S,d,_]=this.#v();if(this.setAt(F,S,0,0),this.setDims(d,_),this.#g(),this.width){let[T,R]=this.parent.viewportBaseDimensions;this.setAt(c*T,f*R,this.width*T,this.height*R),this.#d=!0,this.#A(),this.setDims(this.width*T,this.height*R),this.#h(),this.#B(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#x(),this.div}#A(){if(!this.#d)return;let[c,f]=this.parent.viewportBaseDimensions;this.canvas.width=Math.ceil(this.width*c),this.canvas.height=Math.ceil(this.height*f),this.#E()}setDimensions(c,f){let F=Math.round(c),S=Math.round(f);if(this.#s===F&&this.#f===S)return;this.#s=F,this.#f=S,this.canvas.style.visibility="hidden",this.#e&&Math.abs(this.#e-c/f)>.01&&(f=Math.ceil(c/this.#e),this.setDims(c,f));let[d,_]=this.parent.viewportBaseDimensions;this.width=c/d,this.height=f/_,this.#o&&this.#M(c,f),this.#A(),this.#h(),this.canvas.style.visibility="visible"}#M(c,f){let F=this.#D(),S=(c-F)/this.#r,d=(f-F)/this.#t;this.scaleFactor=Math.min(S,d)}#E(){let c=this.#D()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+c,this.translationY*this.scaleFactor+c)}static#C(c){let f=new Path2D;for(let F=0,S=c.length;F<S;F++){let[d,_,T,R]=c[F];F===0&&f.moveTo(...d),f.bezierCurveTo(_[0],_[1],T[0],T[1],R[0],R[1])}return f}#P(c,f,F,S){let _=[],T=this.thickness/2,R,E;for(let P of this.paths){R=[],E=[];for(let k=0,p=P.length;k<p;k++){let[g,A,M,D]=P[k],V=c*(g[0]+f)+T,W=S-c*(g[1]+F)-T,te=c*(A[0]+f)+T,Z=S-c*(A[1]+F)-T,H=c*(M[0]+f)+T,N=S-c*(M[1]+F)-T,j=c*(D[0]+f)+T,J=S-c*(D[1]+F)-T;k===0&&(R.push(V,W),E.push(V,W)),R.push(te,Z,H,N,j,J),this.#R(V,W,te,Z,H,N,j,J,4,E)}_.push({bezier:R,points:E})}return _}#R(c,f,F,S,d,_,T,R,E,P){if(this.#I(c,f,F,S,d,_,T,R)){P.push(T,R);return}for(let k=1;k<E-1;k++){let p=k/E,g=1-p,A=p*c+g*F,M=p*f+g*S,D=p*F+g*d,V=p*S+g*_,W=p*d+g*T,te=p*_+g*R;A=p*A+g*D,M=p*M+g*V,D=p*D+g*W,V=p*V+g*te,A=p*A+g*D,M=p*M+g*V,P.push(A,M)}P.push(T,R)}#I(c,f,F,S,d,_,T,R){let P=(3*F-2*c-T)**2,k=(3*S-2*f-R)**2,p=(3*d-c-2*T)**2,g=(3*_-f-2*R)**2;return Math.max(P,p)+Math.max(k,g)<=10}#L(){let c=1/0,f=-1/0,F=1/0,S=-1/0;for(let d of this.paths)for(let[_,T,R,E]of d){let P=n.Util.bezierBoundingBox(..._,...T,...R,...E);c=Math.min(c,P[0]),F=Math.min(F,P[1]),f=Math.max(f,P[2]),S=Math.max(S,P[3])}return[c,F,f,S]}#D(){return this.#o?Math.ceil(this.thickness*this.parent.scaleFactor):0}#k(c=!1){if(this.isEmpty())return;if(!this.#o){this.#h();return}let f=this.#L(),F=this.#D();this.#r=Math.max(m,f[2]-f[0]),this.#t=Math.max(m,f[3]-f[1]);let S=Math.ceil(F+this.#r*this.scaleFactor),d=Math.ceil(F+this.#t*this.scaleFactor),[_,T]=this.parent.viewportBaseDimensions;this.width=S/_,this.height=d/T,this.#e=S/d,this.#B();let R=this.translationX,E=this.translationY;this.translationX=-f[0],this.translationY=-f[1],this.#A(),this.#h(),this.#s=S,this.#f=d,this.setDims(S,d);let P=c?F/this.scaleFactor/2:0;this.translate(R-this.translationX-P,E-this.translationY-P)}#B(){let{style:c}=this.div;this.#e>=1?(c.minHeight=`${m}px`,c.minWidth=`${Math.round(this.#e*m)}px`):(c.minWidth=`${m}px`,c.minHeight=`${Math.round(m/this.#e)}px`)}static deserialize(c,f){let F=super.deserialize(c,f);F.thickness=c.thickness,F.color=n.Util.makeHexColor(...c.color),F.opacity=c.opacity;let[S,d]=f.pageDimensions,_=F.width*S,T=F.height*d,R=f.scaleFactor,E=c.thickness/2;F.#e=_/T,F.#o=!0,F.#s=Math.round(_),F.#f=Math.round(T);for(let{bezier:k}of c.paths){let p=[];F.paths.push(p);let g=R*(k[0]-E),A=R*(T-k[1]-E);for(let D=2,V=k.length;D<V;D+=6){let W=R*(k[D]-E),te=R*(T-k[D+1]-E),Z=R*(k[D+2]-E),H=R*(T-k[D+3]-E),N=R*(k[D+4]-E),j=R*(T-k[D+5]-E);p.push([[g,A],[W,te],[Z,H],[N,j]]),g=N,A=j}let M=this.#C(p);F.bezierPath2D.push(M)}let P=F.#L();return F.#r=Math.max(m,P[2]-P[0]),F.#t=Math.max(m,P[3]-P[1]),F.#M(_,T),F}serialize(){if(this.isEmpty())return null;let c=this.getRect(0,0),f=this.rotation%180===0?c[3]-c[1]:c[2]-c[0],F=r.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:n.AnnotationEditorType.INK,color:F,thickness:this.thickness,opacity:this.opacity,paths:this.#P(this.scaleFactor/this.parent.scaleFactor,this.translationX,this.translationY,f),pageIndex:this.parent.pageIndex,rect:c,rotation:this.rotation}}}e.InkEditor=u},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.fitCurve=void 0;let n=t(26);e.fitCurve=n},o=>{function e(d,_,T){if(!Array.isArray(d))throw new TypeError("First argument should be an array");if(d.forEach(k=>{if(!Array.isArray(k)||k.some(p=>typeof p!="number")||k.length!==d[0].length)throw Error("Each point should be an array of numbers. Each point should have the same amount of numbers.")}),d=d.filter((k,p)=>p===0||!k.every((g,A)=>g===d[p-1][A])),d.length<2)return[];let R=d.length,E=f(d[1],d[0]),P=f(d[R-2],d[R-1]);return t(d,E,P,_,T)}function t(d,_,T,R,E){var k,p,g,A,M,D,V,W,te,Z,H,N,j;if(d.length===2)return N=F.vectorLen(F.subtract(d[0],d[1]))/3,k=[d[0],F.addArrays(d[0],F.mulItems(_,N)),F.addArrays(d[1],F.mulItems(T,N)),d[1]],[k];if(p=m(d),[k,A,D]=n(d,p,p,_,T,E),A===0||A<R)return[k];if(A<R*R)for(g=p,M=A,V=D,j=0;j<20;j++){if(g=s(k,d,g),[k,A,D]=n(d,p,g,_,T,E),A<R)return[k];if(D===V){let J=A/M;if(J>.9999&&J<1.0001)break}M=A,V=D}return H=[],W=F.subtract(d[D-1],d[D+1]),W.every(J=>J===0)&&(W=F.subtract(d[D-1],d[D]),[W[0],W[1]]=[-W[1],W[0]]),te=F.normalize(W),Z=F.mulItems(te,-1),H=H.concat(t(d.slice(0,D+1),_,te,R,E)),H=H.concat(t(d.slice(D),Z,T,R,E)),H}function n(d,_,T,R,E,P){var k,p,g;return k=r(d,T,R,E,P),[p,g]=u(d,k,_),P&&P({bez:k,points:d,params:_,maxErr:p,maxPoint:g}),[k,p,g]}function r(d,_,T,R){var E,P,k,p,g,A,M,D,V,W,te,Z,H,N,j,J,$,B=d[0],w=d[d.length-1];for(E=[B,null,null,w],P=F.zeros_Xx2x2(_.length),H=0,N=_.length;H<N;H++)J=_[H],$=1-J,k=P[H],k[0]=F.mulItems(T,3*J*($*$)),k[1]=F.mulItems(R,3*$*(J*J));for(p=[[0,0],[0,0]],g=[0,0],H=0,N=d.length;H<N;H++)J=_[H],k=P[H],p[0][0]+=F.dot(k[0],k[0]),p[0][1]+=F.dot(k[0],k[1]),p[1][0]+=F.dot(k[0],k[1]),p[1][1]+=F.dot(k[1],k[1]),j=F.subtract(d[H],S.q([B,B,w,w],J)),g[0]+=F.dot(k[0],j),g[1]+=F.dot(k[1],j);return A=p[0][0]*p[1][1]-p[1][0]*p[0][1],M=p[0][0]*g[1]-p[1][0]*g[0],D=g[0]*p[1][1]-g[1]*p[0][1],V=A===0?0:D/A,W=A===0?0:M/A,Z=F.vectorLen(F.subtract(B,w)),te=1e-6*Z,V<te||W<te?(E[1]=F.addArrays(B,F.mulItems(T,Z/3)),E[2]=F.addArrays(w,F.mulItems(R,Z/3))):(E[1]=F.addArrays(B,F.mulItems(T,V)),E[2]=F.addArrays(w,F.mulItems(R,W))),E}function s(d,_,T){return T.map((R,E)=>l(d,_[E],R))}function l(d,_,T){var R=F.subtract(S.q(d,T),_),E=S.qprime(d,T),P=F.mulMatrix(R,E),k=F.sum(F.squareItems(E))+2*F.mulMatrix(R,S.qprimeprime(d,T));return k===0?T:T-P/k}function m(d){var _=[],T,R,E;return d.forEach((P,k)=>{T=k?R+F.vectorLen(F.subtract(P,E)):0,_.push(T),R=T,E=P}),_=_.map(P=>P/R),_}function u(d,_,T){var R,E,P,k,p,g,A,M;E=0,P=Math.floor(d.length/2);let D=i(_,10);for(p=0,g=d.length;p<g;p++)A=d[p],M=c(_,T[p],D,10),k=F.subtract(S.q(_,M),A),R=k[0]*k[0]+k[1]*k[1],R>E&&(E=R,P=p);return[E,P]}var i=function(d,_){for(var T,R=[0],E=d[0],P=0,k=1;k<=_;k++)T=S.q(d,k/_),P+=F.vectorLen(F.subtract(T,E)),R.push(P),E=T;return R=R.map(p=>p/P),R};function c(d,_,T,R){if(_<0)return 0;if(_>1)return 1;for(var E,P,k,p,g,A=1;A<=R;A++)if(_<=T[A]){p=(A-1)/R,k=A/R,P=T[A-1],E=T[A],g=(_-P)/(E-P)*(k-p)+p;break}return g}function f(d,_){return F.normalize(F.subtract(d,_))}class F{static zeros_Xx2x2(_){for(var T=[];_--;)T.push([0,0]);return T}static mulItems(_,T){return _.map(R=>R*T)}static mulMatrix(_,T){return _.reduce((R,E,P)=>R+E*T[P],0)}static subtract(_,T){return _.map((R,E)=>R-T[E])}static addArrays(_,T){return _.map((R,E)=>R+T[E])}static addItems(_,T){return _.map(R=>R+T)}static sum(_){return _.reduce((T,R)=>T+R)}static dot(_,T){return F.mulMatrix(_,T)}static vectorLen(_){return Math.hypot(..._)}static divItems(_,T){return _.map(R=>R/T)}static squareItems(_){return _.map(T=>T*T)}static normalize(_){return this.divItems(_,this.vectorLen(_))}}class S{static q(_,T){var R=1-T,E=F.mulItems(_[0],R*R*R),P=F.mulItems(_[1],3*R*R*T),k=F.mulItems(_[2],3*R*T*T),p=F.mulItems(_[3],T*T*T);return F.addArrays(F.addArrays(E,P),F.addArrays(k,p))}static qprime(_,T){var R=1-T,E=F.mulItems(F.subtract(_[1],_[0]),3*R*R),P=F.mulItems(F.subtract(_[2],_[1]),6*R*T),k=F.mulItems(F.subtract(_[3],_[2]),3*T*T);return F.addArrays(F.addArrays(E,P),k)}static qprimeprime(_,T){return F.addArrays(F.mulItems(F.addArrays(F.subtract(_[2],F.mulItems(_[1],2)),_[0]),6*(1-T)),F.mulItems(F.addArrays(F.subtract(_[3],F.mulItems(_[2],2)),_[1]),6*T))}}o.exports=e,o.exports.fitCubic=t,o.exports.createTangent=f},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationLayer=void 0;var n=t(1),r=t(8),s=t(5),l=t(28),m=t(29);let u=1e3,i=9,c=new WeakSet;function f(L){return{width:L[2]-L[0],height:L[3]-L[1]}}class F{static create(a){switch(a.data.annotationType){case n.AnnotationType.LINK:return new d(a);case n.AnnotationType.TEXT:return new _(a);case n.AnnotationType.WIDGET:switch(a.data.fieldType){case"Tx":return new R(a);case"Btn":return a.data.radioButton?new P(a):a.data.checkBox?new E(a):new k(a);case"Ch":return new p(a)}return new T(a);case n.AnnotationType.POPUP:return new g(a);case n.AnnotationType.FREETEXT:return new M(a);case n.AnnotationType.LINE:return new D(a);case n.AnnotationType.SQUARE:return new V(a);case n.AnnotationType.CIRCLE:return new W(a);case n.AnnotationType.POLYLINE:return new te(a);case n.AnnotationType.CARET:return new H(a);case n.AnnotationType.INK:return new N(a);case n.AnnotationType.POLYGON:return new Z(a);case n.AnnotationType.HIGHLIGHT:return new j(a);case n.AnnotationType.UNDERLINE:return new J(a);case n.AnnotationType.SQUIGGLY:return new $(a);case n.AnnotationType.STRIKEOUT:return new B(a);case n.AnnotationType.STAMP:return new w(a);case n.AnnotationType.FILEATTACHMENT:return new x(a);default:return new S(a)}}}class S{constructor(a,{isRenderable:h=!1,ignoreBorder:b=!1,createQuadrilaterals:v=!1}={}){this.isRenderable=h,this.data=a.data,this.layer=a.layer,this.page=a.page,this.viewport=a.viewport,this.linkService=a.linkService,this.downloadManager=a.downloadManager,this.imageResourcesPath=a.imageResourcesPath,this.renderForms=a.renderForms,this.svgFactory=a.svgFactory,this.annotationStorage=a.annotationStorage,this.enableScripting=a.enableScripting,this.hasJSActions=a.hasJSActions,this._fieldObjects=a.fieldObjects,this._mouseState=a.mouseState,h&&(this.container=this._createContainer(b)),v&&(this.quadrilaterals=this._createQuadrilaterals(b))}_createContainer(a=!1){let h=this.data,b=this.page,v=this.viewport,C=document.createElement("section"),{width:I,height:O}=f(h.rect),[U,K,G,Y]=v.viewBox,ne=G-U,Q=Y-K;C.setAttribute("data-annotation-id",h.id);let re=n.Util.normalizeRect([h.rect[0],b.view[3]-h.rect[1]+b.view[1],h.rect[2],b.view[3]-h.rect[3]+b.view[1]]);if(!a&&h.borderStyle.width>0){C.style.borderWidth=`${h.borderStyle.width}px`;let ae=h.borderStyle.horizontalCornerRadius,le=h.borderStyle.verticalCornerRadius;if(ae>0||le>0){let Ae=`calc(${ae}px * var(--scale-factor)) / calc(${le}px * var(--scale-factor))`;C.style.borderRadius=Ae}else if(this instanceof P){let Ae=`calc(${I}px * var(--scale-factor)) / calc(${O}px * var(--scale-factor))`;C.style.borderRadius=Ae}switch(h.borderStyle.style){case n.AnnotationBorderStyleType.SOLID:C.style.borderStyle="solid";break;case n.AnnotationBorderStyleType.DASHED:C.style.borderStyle="dashed";break;case n.AnnotationBorderStyleType.BEVELED:(0,n.warn)("Unimplemented border style: beveled");break;case n.AnnotationBorderStyleType.INSET:(0,n.warn)("Unimplemented border style: inset");break;case n.AnnotationBorderStyleType.UNDERLINE:C.style.borderBottomStyle="solid";break;default:break}let oe=h.borderColor||null;oe?C.style.borderColor=n.Util.makeHexColor(oe[0]|0,oe[1]|0,oe[2]|0):C.style.borderWidth=0}C.style.left=`${100*(re[0]-U)/ne}%`,C.style.top=`${100*(re[1]-K)/Q}%`;let{rotation:ie}=h;return h.hasOwnCanvas||ie===0?(C.style.width=`${100*I/ne}%`,C.style.height=`${100*O/Q}%`):this.setRotation(ie,C),C}setRotation(a,h=this.container){let[b,v,C,I]=this.viewport.viewBox,O=C-b,U=I-v,{width:K,height:G}=f(this.data.rect),Y,ne;a%180===0?(Y=100*K/O,ne=100*G/U):(Y=100*G/O,ne=100*K/U),h.style.width=`${Y}%`,h.style.height=`${ne}%`,h.setAttribute("data-main-rotation",(360-a)%360)}get _commonActions(){let a=(h,b,v)=>{let C=v.detail[h];v.target.style[b]=l.ColorConverters[`${C[0]}_HTML`](C.slice(1))};return(0,n.shadow)(this,"_commonActions",{display:h=>{let b=h.detail.display%2===1;this.container.style.visibility=b?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:b,print:h.detail.display===0||h.detail.display===3})},print:h=>{this.annotationStorage.setValue(this.data.id,{print:h.detail.print})},hidden:h=>{this.container.style.visibility=h.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:h.detail.hidden})},focus:h=>{setTimeout(()=>h.target.focus({preventScroll:!1}),0)},userName:h=>{h.target.title=h.detail.userName},readonly:h=>{h.detail.readonly?h.target.setAttribute("readonly",""):h.target.removeAttribute("readonly")},required:h=>{this._setRequired(h.target,h.detail.required)},bgColor:h=>{a("bgColor","backgroundColor",h)},fillColor:h=>{a("fillColor","backgroundColor",h)},fgColor:h=>{a("fgColor","color",h)},textColor:h=>{a("textColor","color",h)},borderColor:h=>{a("borderColor","borderColor",h)},strokeColor:h=>{a("strokeColor","borderColor",h)},rotation:h=>{let b=h.detail.rotation;this.setRotation(b),this.annotationStorage.setValue(this.data.id,{rotation:b})}})}_dispatchEventFromSandbox(a,h){let b=this._commonActions;for(let v of Object.keys(h.detail)){let C=a[v]||b[v];C&&C(h)}}_setDefaultPropertiesFromJS(a){if(!this.enableScripting)return;let h=this.annotationStorage.getRawValue(this.data.id);if(!h)return;let b=this._commonActions;for(let[v,C]of Object.entries(h)){let I=b[v];if(I){let O={detail:{[v]:C},target:a};I(O),delete h[v]}}}_createQuadrilaterals(a=!1){if(!this.data.quadPoints)return null;let h=[],b=this.data.rect;for(let v of this.data.quadPoints)this.data.rect=[v[2].x,v[2].y,v[1].x,v[1].y],h.push(this._createContainer(a));return this.data.rect=b,h}_createPopup(a,h){let b=this.container;this.quadrilaterals&&(a=a||this.quadrilaterals,b=this.quadrilaterals[0]),a||(a=document.createElement("div"),a.className="popupTriggerArea",b.append(a));let C=new A({container:b,trigger:a,color:h.color,titleObj:h.titleObj,modificationDate:h.modificationDate,contentsObj:h.contentsObj,richText:h.richText,hideWrapper:!0}).render();C.style.left="100%",b.append(C)}_renderQuadrilaterals(a){for(let h of this.quadrilaterals)h.className=a;return this.quadrilaterals}render(){(0,n.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(a,h=null){let b=[];if(this._fieldObjects){let v=this._fieldObjects[a];if(v)for(let{page:C,id:I,exportValues:O}of v){if(C===-1||I===h)continue;let U=typeof O=="string"?O:null,K=document.querySelector(`[data-element-id="${I}"]`);if(K&&!c.has(K)){(0,n.warn)(`_getElementsByName - element not allowed: ${I}`);continue}b.push({id:I,exportValue:U,domElement:K})}return b}for(let v of document.getElementsByName(a)){let{id:C,exportValue:I}=v;C!==h&&c.has(v)&&b.push({id:C,exportValue:I,domElement:v})}return b}static get platform(){let a=typeof navigator<"u"?navigator.platform:"";return(0,n.shadow)(this,"platform",{isWin:a.includes("Win"),isMac:a.includes("Mac")})}}class d extends S{constructor(a,h=null){super(a,{isRenderable:!0,ignoreBorder:!!h?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=a.data.isTooltipOnly}render(){let{data:a,linkService:h}=this,b=document.createElement("a");b.setAttribute("data-element-id",a.id);let v=!1;return a.url?(h.addLinkAttributes(b,a.url,a.newWindow),v=!0):a.action?(this._bindNamedAction(b,a.action),v=!0):a.dest?(this._bindLink(b,a.dest),v=!0):(a.actions&&(a.actions.Action||a.actions["Mouse Up"]||a.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(b,a),v=!0),a.resetForm?(this._bindResetFormAction(b,a.resetForm),v=!0):this.isTooltipOnly&&!v&&(this._bindLink(b,""),v=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((C,I)=>{let O=I===0?b:b.cloneNode();return C.append(O),C}):(this.container.className="linkAnnotation",v&&this.container.append(b),this.container)}_bindLink(a,h){a.href=this.linkService.getDestinationHash(h),a.onclick=()=>(h&&this.linkService.goToDestination(h),!1),(h||h==="")&&(a.className="internalLink")}_bindNamedAction(a,h){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.linkService.executeNamedAction(h),!1),a.className="internalLink"}_bindJSAction(a,h){a.href=this.linkService.getAnchorUrl("");let b=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let v of Object.keys(h.actions)){let C=b.get(v);C&&(a[C]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h.id,name:v}}),!1))}a.onclick||(a.onclick=()=>!1),a.className="internalLink"}_bindResetFormAction(a,h){let b=a.onclick;if(b||(a.href=this.linkService.getAnchorUrl("")),a.className="internalLink",!this._fieldObjects){(0,n.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),b||(a.onclick=()=>!1);return}a.onclick=()=>{b&&b();let{fields:v,refs:C,include:I}=h,O=[];if(v.length!==0||C.length!==0){let G=new Set(C);for(let Y of v){let ne=this._fieldObjects[Y]||[];for(let{id:Q}of ne)G.add(Q)}for(let Y of Object.values(this._fieldObjects))for(let ne of Y)G.has(ne.id)===I&&O.push(ne)}else for(let G of Object.values(this._fieldObjects))O.push(...G);let U=this.annotationStorage,K=[];for(let G of O){let{id:Y}=G;switch(K.push(Y),G.type){case"text":{let Q=G.defaultValue||"";U.setValue(Y,{value:Q});break}case"checkbox":case"radiobutton":{let Q=G.defaultValue===G.exportValues;U.setValue(Y,{value:Q});break}case"combobox":case"listbox":{let Q=G.defaultValue||"";U.setValue(Y,{value:Q});break}default:continue}let ne=document.querySelector(`[data-element-id="${Y}"]`);if(ne){if(!c.has(ne)){(0,n.warn)(`_bindResetFormAction - element not allowed: ${Y}`);continue}}else continue;ne.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:K,name:"ResetForm"}}),!1}}}class _ extends S{constructor(a){let h=!!(a.data.hasPopup||a.data.titleObj?.str||a.data.contentsObj?.str||a.data.richText?.str);super(a,{isRenderable:h})}render(){this.container.className="textAnnotation";let a=document.createElement("img");return a.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",a.alt="[{{type}} Annotation]",a.dataset.l10nId="text_annotation_type",a.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(a,this.data),this.container.append(a),this.container}}class T extends S{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(a){let{isWin:h,isMac:b}=S.platform;return h&&a.ctrlKey||b&&a.metaKey}_setEventListener(a,h,b,v){h.includes("mouse")?a.addEventListener(h,C=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:b,value:v(C),shift:C.shiftKey,modifier:this._getKeyModifier(C)}})}):a.addEventListener(h,C=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:b,value:v(C)}})})}_setEventListeners(a,h,b){for(let[v,C]of h)(C==="Action"||this.data.actions?.[C])&&this._setEventListener(a,v,C,b)}_setBackgroundColor(a){let h=this.data.backgroundColor||null;a.style.backgroundColor=h===null?"transparent":n.Util.makeHexColor(h[0],h[1],h[2])}_setTextStyle(a){let h=["left","center","right"],{fontColor:b}=this.data.defaultAppearanceData,v=this.data.defaultAppearanceData.fontSize||i,C=a.style,I;if(this.data.multiLine){let O=Math.abs(this.data.rect[3]-this.data.rect[1]),U=Math.round(O/(n.LINE_FACTOR*v))||1,K=O/U;I=Math.min(v,Math.round(K/n.LINE_FACTOR))}else{let O=Math.abs(this.data.rect[3]-this.data.rect[1]);I=Math.min(v,Math.round(O/n.LINE_FACTOR))}C.fontSize=`calc(${I}px * var(--scale-factor))`,C.color=n.Util.makeHexColor(b[0],b[1],b[2]),this.data.textAlignment!==null&&(C.textAlign=h[this.data.textAlignment])}_setRequired(a,h){h?a.setAttribute("required",!0):a.removeAttribute("required"),a.setAttribute("aria-required",h)}}class R extends T{constructor(a){let h=a.renderForms||!a.data.hasAppearance&&!!a.data.fieldValue;super(a,{isRenderable:h})}setPropertyOnSiblings(a,h,b,v){let C=this.annotationStorage;for(let I of this._getElementsByName(a.name,a.id))I.domElement&&(I.domElement[h]=b),C.setValue(I.id,{[v]:b})}render(){let a=this.annotationStorage,h=this.data.id;this.container.className="textWidgetAnnotation";let b=null;if(this.renderForms){let v=a.getValue(h,{value:this.data.fieldValue}),C=v.formattedValue||v.value||"",I=a.getValue(h,{charLimit:this.data.maxLen}).charLimit;I&&C.length>I&&(C=C.slice(0,I));let O={userValue:C,formattedValue:null,valueOnFocus:""};this.data.multiLine?(b=document.createElement("textarea"),b.textContent=C,this.data.doNotScroll&&(b.style.overflowY="hidden")):(b=document.createElement("input"),b.type="text",b.setAttribute("value",C),this.data.doNotScroll&&(b.style.overflowX="hidden")),c.add(b),b.setAttribute("data-element-id",h),b.disabled=this.data.readOnly,b.name=this.data.fieldName,b.tabIndex=u,this._setRequired(b,this.data.required),I&&(b.maxLength=I),b.addEventListener("input",K=>{a.setValue(h,{value:K.target.value}),this.setPropertyOnSiblings(b,"value",K.target.value,"value")}),b.addEventListener("resetform",K=>{let G=this.data.defaultFieldValue??"";b.value=O.userValue=G,O.formattedValue=null});let U=K=>{let{formattedValue:G}=O;G!=null&&(K.target.value=G),K.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){b.addEventListener("focus",G=>{O.userValue&&(G.target.value=O.userValue),O.valueOnFocus=G.target.value}),b.addEventListener("updatefromsandbox",G=>{let Y={value(ne){O.userValue=ne.detail.value??"",a.setValue(h,{value:O.userValue.toString()}),ne.target.value=O.userValue},formattedValue(ne){let{formattedValue:Q}=ne.detail;O.formattedValue=Q,Q!=null&&ne.target!==document.activeElement&&(ne.target.value=Q),a.setValue(h,{formattedValue:Q})},selRange(ne){ne.target.setSelectionRange(...ne.detail.selRange)},charLimit:ne=>{let{charLimit:Q}=ne.detail,{target:re}=ne;if(Q===0){re.removeAttribute("maxLength");return}re.setAttribute("maxLength",Q);let ie=O.userValue;!ie||ie.length<=Q||(ie=ie.slice(0,Q),re.value=O.userValue=ie,a.setValue(h,{value:ie}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:ie,willCommit:!0,commitKey:1,selStart:re.selectionStart,selEnd:re.selectionEnd}}))}};this._dispatchEventFromSandbox(Y,G)}),b.addEventListener("keydown",G=>{let Y=-1;if(G.key==="Escape"?Y=0:G.key==="Enter"?Y=2:G.key==="Tab"&&(Y=3),Y===-1)return;let{value:ne}=G.target;O.valueOnFocus!==ne&&(O.userValue=ne,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:ne,willCommit:!0,commitKey:Y,selStart:G.target.selectionStart,selEnd:G.target.selectionEnd}}))});let K=U;U=null,b.addEventListener("blur",G=>{let{value:Y}=G.target;O.userValue=Y,this._mouseState.isDown&&O.valueOnFocus!==Y&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:Y,willCommit:!0,commitKey:1,selStart:G.target.selectionStart,selEnd:G.target.selectionEnd}}),K(G)}),this.data.actions?.Keystroke&&b.addEventListener("beforeinput",G=>{let{data:Y,target:ne}=G,{value:Q,selectionStart:re,selectionEnd:ie}=ne,ae=re,le=ie;switch(G.inputType){case"deleteWordBackward":{let oe=Q.substring(0,re).match(/\w*[^\w]*$/);oe&&(ae-=oe[0].length);break}case"deleteWordForward":{let oe=Q.substring(re).match(/^[^\w]*\w*/);oe&&(le+=oe[0].length);break}case"deleteContentBackward":re===ie&&(ae-=1);break;case"deleteContentForward":re===ie&&(le+=1);break}G.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:Q,change:Y||"",willCommit:!1,selStart:ae,selEnd:le}})}),this._setEventListeners(b,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],G=>G.target.value)}if(U&&b.addEventListener("blur",U),this.data.comb){let G=(this.data.rect[2]-this.data.rect[0])/I;b.classList.add("comb"),b.style.letterSpacing=`calc(${G}px * var(--scale-factor) - 1ch)`}}else b=document.createElement("div"),b.textContent=this.data.fieldValue,b.style.verticalAlign="middle",b.style.display="table-cell";return this._setTextStyle(b),this._setBackgroundColor(b),this._setDefaultPropertiesFromJS(b),this.container.append(b),this.container}}class E extends T{constructor(a){super(a,{isRenderable:a.renderForms})}render(){let a=this.annotationStorage,h=this.data,b=h.id,v=a.getValue(b,{value:h.exportValue===h.fieldValue}).value;typeof v=="string"&&(v=v!=="Off",a.setValue(b,{value:v})),this.container.className="buttonWidgetAnnotation checkBox";let C=document.createElement("input");return c.add(C),C.setAttribute("data-element-id",b),C.disabled=h.readOnly,this._setRequired(C,this.data.required),C.type="checkbox",C.name=h.fieldName,v&&C.setAttribute("checked",!0),C.setAttribute("exportValue",h.exportValue),C.tabIndex=u,C.addEventListener("change",I=>{let{name:O,checked:U}=I.target;for(let K of this._getElementsByName(O,b)){let G=U&&K.exportValue===h.exportValue;K.domElement&&(K.domElement.checked=G),a.setValue(K.id,{value:G})}a.setValue(b,{value:U})}),C.addEventListener("resetform",I=>{let O=h.defaultFieldValue||"Off";I.target.checked=O===h.exportValue}),this.enableScripting&&this.hasJSActions&&(C.addEventListener("updatefromsandbox",I=>{let O={value(U){U.target.checked=U.detail.value!=="Off",a.setValue(b,{value:U.target.checked})}};this._dispatchEventFromSandbox(O,I)}),this._setEventListeners(C,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],I=>I.target.checked)),this._setBackgroundColor(C),this._setDefaultPropertiesFromJS(C),this.container.append(C),this.container}}class P extends T{constructor(a){super(a,{isRenderable:a.renderForms})}render(){this.container.className="buttonWidgetAnnotation radioButton";let a=this.annotationStorage,h=this.data,b=h.id,v=a.getValue(b,{value:h.fieldValue===h.buttonValue}).value;typeof v=="string"&&(v=v!==h.buttonValue,a.setValue(b,{value:v}));let C=document.createElement("input");if(c.add(C),C.setAttribute("data-element-id",b),C.disabled=h.readOnly,this._setRequired(C,this.data.required),C.type="radio",C.name=h.fieldName,v&&C.setAttribute("checked",!0),C.tabIndex=u,C.addEventListener("change",I=>{let{name:O,checked:U}=I.target;for(let K of this._getElementsByName(O,b))a.setValue(K.id,{value:!1});a.setValue(b,{value:U})}),C.addEventListener("resetform",I=>{let O=h.defaultFieldValue;I.target.checked=O!=null&&O===h.buttonValue}),this.enableScripting&&this.hasJSActions){let I=h.buttonValue;C.addEventListener("updatefromsandbox",O=>{let U={value:K=>{let G=I===K.detail.value;for(let Y of this._getElementsByName(K.target.name)){let ne=G&&Y.id===b;Y.domElement&&(Y.domElement.checked=ne),a.setValue(Y.id,{value:ne})}}};this._dispatchEventFromSandbox(U,O)}),this._setEventListeners(C,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],O=>O.target.checked)}return this._setBackgroundColor(C),this._setDefaultPropertiesFromJS(C),this.container.append(C),this.container}}class k extends d{constructor(a){super(a,{ignoreBorder:a.data.hasAppearance})}render(){let a=super.render();a.className="buttonWidgetAnnotation pushButton",this.data.alternativeText&&(a.title=this.data.alternativeText);let h=a.lastChild;return this.enableScripting&&this.hasJSActions&&h&&(this._setDefaultPropertiesFromJS(h),h.addEventListener("updatefromsandbox",b=>{this._dispatchEventFromSandbox({},b)})),a}}class p extends T{constructor(a){super(a,{isRenderable:a.renderForms})}render(){this.container.className="choiceWidgetAnnotation";let a=this.annotationStorage,h=this.data.id,b=a.getValue(h,{value:this.data.fieldValue}),v=document.createElement("select");c.add(v),v.setAttribute("data-element-id",h),v.disabled=this.data.readOnly,this._setRequired(v,this.data.required),v.name=this.data.fieldName,v.tabIndex=u;let C=this.data.combo&&this.data.options.length>0;this.data.combo||(v.size=this.data.options.length,this.data.multiSelect&&(v.multiple=!0)),v.addEventListener("resetform",K=>{let G=this.data.defaultFieldValue;for(let Y of v.options)Y.selected=Y.value===G});for(let K of this.data.options){let G=document.createElement("option");G.textContent=K.displayValue,G.value=K.exportValue,b.value.includes(K.exportValue)&&(G.setAttribute("selected",!0),C=!1),v.append(G)}let I=null;if(C){let K=document.createElement("option");K.value=" ",K.setAttribute("hidden",!0),K.setAttribute("selected",!0),v.prepend(K),I=()=>{K.remove(),v.removeEventListener("input",I),I=null},v.addEventListener("input",I)}let O=(K,G)=>{let Y=G?"value":"textContent",ne=K.target.options;return K.target.multiple?Array.prototype.filter.call(ne,Q=>Q.selected).map(Q=>Q[Y]):ne.selectedIndex===-1?null:ne[ne.selectedIndex][Y]},U=K=>{let G=K.target.options;return Array.prototype.map.call(G,Y=>({displayValue:Y.textContent,exportValue:Y.value}))};return this.enableScripting&&this.hasJSActions?(v.addEventListener("updatefromsandbox",K=>{let G={value(Y){I?.();let ne=Y.detail.value,Q=new Set(Array.isArray(ne)?ne:[ne]);for(let re of v.options)re.selected=Q.has(re.value);a.setValue(h,{value:O(Y,!0)})},multipleSelection(Y){v.multiple=!0},remove(Y){let ne=v.options,Q=Y.detail.remove;ne[Q].selected=!1,v.remove(Q),ne.length>0&&Array.prototype.findIndex.call(ne,ie=>ie.selected)===-1&&(ne[0].selected=!0),a.setValue(h,{value:O(Y,!0),items:U(Y)})},clear(Y){for(;v.length!==0;)v.remove(0);a.setValue(h,{value:null,items:[]})},insert(Y){let{index:ne,displayValue:Q,exportValue:re}=Y.detail.insert,ie=v.children[ne],ae=document.createElement("option");ae.textContent=Q,ae.value=re,ie?ie.before(ae):v.append(ae),a.setValue(h,{value:O(Y,!0),items:U(Y)})},items(Y){let{items:ne}=Y.detail;for(;v.length!==0;)v.remove(0);for(let Q of ne){let{displayValue:re,exportValue:ie}=Q,ae=document.createElement("option");ae.textContent=re,ae.value=ie,v.append(ae)}v.options.length>0&&(v.options[0].selected=!0),a.setValue(h,{value:O(Y,!0),items:U(Y)})},indices(Y){let ne=new Set(Y.detail.indices);for(let Q of Y.target.options)Q.selected=ne.has(Q.index);a.setValue(h,{value:O(Y,!0)})},editable(Y){Y.target.disabled=!Y.detail.editable}};this._dispatchEventFromSandbox(G,K)}),v.addEventListener("input",K=>{let G=O(K,!0),Y=O(K,!1);a.setValue(h,{value:G}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:Y,changeEx:G,willCommit:!0,commitKey:1,keyDown:!1}})}),this._setEventListeners(v,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"]],K=>K.target.checked)):v.addEventListener("input",function(K){a.setValue(h,{value:O(K,!0)})}),this.data.combo&&this._setTextStyle(v),this._setBackgroundColor(v),this._setDefaultPropertiesFromJS(v),this.container.append(v),this.container}}class g extends S{constructor(a){let h=!!(a.data.titleObj?.str||a.data.contentsObj?.str||a.data.richText?.str);super(a,{isRenderable:h})}render(){let a=["Line","Square","Circle","PolyLine","Polygon","Ink"];if(this.container.className="popupAnnotation",a.includes(this.data.parentType))return this.container;let h=`[data-annotation-id="${this.data.parentId}"]`,b=this.layer.querySelectorAll(h);if(b.length===0)return this.container;let v=new A({container:this.container,trigger:Array.from(b),color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText}),C=this.page,I=n.Util.normalizeRect([this.data.parentRect[0],C.view[3]-this.data.parentRect[1]+C.view[1],this.data.parentRect[2],C.view[3]-this.data.parentRect[3]+C.view[1]]),O=I[0]+this.data.parentRect[2]-this.data.parentRect[0],U=I[1],[K,G,Y,ne]=this.viewport.viewBox,Q=Y-K,re=ne-G;return this.container.style.left=`${100*(O-K)/Q}%`,this.container.style.top=`${100*(U-G)/re}%`,this.container.append(v.render()),this.container}}class A{constructor(a){this.container=a.container,this.trigger=a.trigger,this.color=a.color,this.titleObj=a.titleObj,this.modificationDate=a.modificationDate,this.contentsObj=a.contentsObj,this.richText=a.richText,this.hideWrapper=a.hideWrapper||!1,this.pinned=!1}render(){let h=document.createElement("div");h.className="popupWrapper",this.hideElement=this.hideWrapper?h:this.container,this.hideElement.hidden=!0;let b=document.createElement("div");b.className="popup";let v=this.color;if(v){let O=.7*(255-v[0])+v[0],U=.7*(255-v[1])+v[1],K=.7*(255-v[2])+v[2];b.style.backgroundColor=n.Util.makeHexColor(O|0,U|0,K|0)}let C=document.createElement("h1");C.dir=this.titleObj.dir,C.textContent=this.titleObj.str,b.append(C);let I=r.PDFDateString.toDateObject(this.modificationDate);if(I){let O=document.createElement("span");O.className="popupDate",O.textContent="{{date}}, {{time}}",O.dataset.l10nId="annotation_date_string",O.dataset.l10nArgs=JSON.stringify({date:I.toLocaleDateString(),time:I.toLocaleTimeString()}),b.append(O)}if(this.richText?.str&&(!this.contentsObj?.str||this.contentsObj.str===this.richText.str))m.XfaLayer.render({xfaHtml:this.richText.html,intent:"richText",div:b}),b.lastChild.className="richText popupContent";else{let O=this._formatContents(this.contentsObj);b.append(O)}Array.isArray(this.trigger)||(this.trigger=[this.trigger]);for(let O of this.trigger)O.addEventListener("click",this._toggle.bind(this)),O.addEventListener("mouseover",this._show.bind(this,!1)),O.addEventListener("mouseout",this._hide.bind(this,!1));return b.addEventListener("click",this._hide.bind(this,!0)),h.append(b),h}_formatContents({str:a,dir:h}){let b=document.createElement("p");b.className="popupContent",b.dir=h;let v=a.split(/(?:\r\n?|\n)/);for(let C=0,I=v.length;C<I;++C){let O=v[C];b.append(document.createTextNode(O)),C<I-1&&b.append(document.createElement("br"))}return b}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(a=!1){a&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex=parseInt(this.container.style.zIndex)+1e3)}_hide(a=!0){a&&(this.pinned=!1),!this.hideElement.hidden&&!this.pinned&&(this.hideElement.hidden=!0,this.container.style.zIndex=parseInt(this.container.style.zIndex)-1e3)}}class M extends S{constructor(a){let h=!!(a.data.hasPopup||a.data.titleObj?.str||a.data.contentsObj?.str||a.data.richText?.str);super(a,{isRenderable:h,ignoreBorder:!0}),this.textContent=a.data.textContent}render(){if(this.container.className="freeTextAnnotation",this.textContent){let a=document.createElement("div");a.className="annotationTextContent",a.setAttribute("role","comment");for(let h of this.textContent){let b=document.createElement("span");b.textContent=h,a.append(b)}this.container.append(a)}return this.data.hasPopup||this._createPopup(null,this.data),this.container}}class D extends S{constructor(a){let h=!!(a.data.hasPopup||a.data.titleObj?.str||a.data.contentsObj?.str||a.data.richText?.str);super(a,{isRenderable:h,ignoreBorder:!0})}render(){this.container.className="lineAnnotation";let a=this.data,{width:h,height:b}=f(a.rect),v=this.svgFactory.create(h,b,!0),C=this.svgFactory.createElement("svg:line");return C.setAttribute("x1",a.rect[2]-a.lineCoordinates[0]),C.setAttribute("y1",a.rect[3]-a.lineCoordinates[1]),C.setAttribute("x2",a.rect[2]-a.lineCoordinates[2]),C.setAttribute("y2",a.rect[3]-a.lineCoordinates[3]),C.setAttribute("stroke-width",a.borderStyle.width||1),C.setAttribute("stroke","transparent"),C.setAttribute("fill","transparent"),v.append(C),this.container.append(v),this._createPopup(C,a),this.container}}class V extends S{constructor(a){let h=!!(a.data.hasPopup||a.data.titleObj?.str||a.data.contentsObj?.str||a.data.richText?.str);super(a,{isRenderable:h,ignoreBorder:!0})}render(){this.container.className="squareAnnotation";let a=this.data,{width:h,height:b}=f(a.rect),v=this.svgFactory.create(h,b,!0),C=a.borderStyle.width,I=this.svgFactory.createElement("svg:rect");return I.setAttribute("x",C/2),I.setAttribute("y",C/2),I.setAttribute("width",h-C),I.setAttribute("height",b-C),I.setAttribute("stroke-width",C||1),I.setAttribute("stroke","transparent"),I.setAttribute("fill","transparent"),v.append(I),this.container.append(v),this._createPopup(I,a),this.container}}class W extends S{constructor(a){let h=!!(a.data.hasPopup||a.data.titleObj?.str||a.data.contentsObj?.str||a.data.richText?.str);super(a,{isRenderable:h,ignoreBorder:!0})}render(){this.container.className="circleAnnotation";let a=this.data,{width:h,height:b}=f(a.rect),v=this.svgFactory.create(h,b,!0),C=a.borderStyle.width,I=this.svgFactory.createElement("svg:ellipse");return I.setAttribute("cx",h/2),I.setAttribute("cy",b/2),I.setAttribute("rx",h/2-C/2),I.setAttribute("ry",b/2-C/2),I.setAttribute("stroke-width",C||1),I.setAttribute("stroke","transparent"),I.setAttribute("fill","transparent"),v.append(I),this.container.append(v),this._createPopup(I,a),this.container}}class te extends S{constructor(a){let h=!!(a.data.hasPopup||a.data.titleObj?.str||a.data.contentsObj?.str||a.data.richText?.str);super(a,{isRenderable:h,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;let a=this.data,{width:h,height:b}=f(a.rect),v=this.svgFactory.create(h,b,!0),C=[];for(let O of a.vertices){let U=O.x-a.rect[0],K=a.rect[3]-O.y;C.push(U+","+K)}C=C.join(" ");let I=this.svgFactory.createElement(this.svgElementName);return I.setAttribute("points",C),I.setAttribute("stroke-width",a.borderStyle.width||1),I.setAttribute("stroke","transparent"),I.setAttribute("fill","transparent"),v.append(I),this.container.append(v),this._createPopup(I,a),this.container}}class Z extends te{constructor(a){super(a),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class H extends S{constructor(a){let h=!!(a.data.hasPopup||a.data.titleObj?.str||a.data.contentsObj?.str||a.data.richText?.str);super(a,{isRenderable:h,ignoreBorder:!0})}render(){return this.container.className="caretAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class N extends S{constructor(a){let h=!!(a.data.hasPopup||a.data.titleObj?.str||a.data.contentsObj?.str||a.data.richText?.str);super(a,{isRenderable:h,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;let a=this.data,{width:h,height:b}=f(a.rect),v=this.svgFactory.create(h,b,!0);for(let C of a.inkLists){let I=[];for(let U of C){let K=U.x-a.rect[0],G=a.rect[3]-U.y;I.push(`${K},${G}`)}I=I.join(" ");let O=this.svgFactory.createElement(this.svgElementName);O.setAttribute("points",I),O.setAttribute("stroke-width",a.borderStyle.width||1),O.setAttribute("stroke","transparent"),O.setAttribute("fill","transparent"),this._createPopup(O,a),v.append(O)}return this.container.append(v),this.container}}class j extends S{constructor(a){let h=!!(a.data.hasPopup||a.data.titleObj?.str||a.data.contentsObj?.str||a.data.richText?.str);super(a,{isRenderable:h,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.className="highlightAnnotation",this.container)}}class J extends S{constructor(a){let h=!!(a.data.hasPopup||a.data.titleObj?.str||a.data.contentsObj?.str||a.data.richText?.str);super(a,{isRenderable:h,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.className="underlineAnnotation",this.container)}}class $ extends S{constructor(a){let h=!!(a.data.hasPopup||a.data.titleObj?.str||a.data.contentsObj?.str||a.data.richText?.str);super(a,{isRenderable:h,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.className="squigglyAnnotation",this.container)}}class B extends S{constructor(a){let h=!!(a.data.hasPopup||a.data.titleObj?.str||a.data.contentsObj?.str||a.data.richText?.str);super(a,{isRenderable:h,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.className="strikeoutAnnotation",this.container)}}class w extends S{constructor(a){let h=!!(a.data.hasPopup||a.data.titleObj?.str||a.data.contentsObj?.str||a.data.richText?.str);super(a,{isRenderable:h,ignoreBorder:!0})}render(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class x extends S{constructor(a){super(a,{isRenderable:!0});let{filename:h,content:b}=this.data.file;this.filename=(0,r.getFilenameFromUrl)(h),this.content=b,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:h,content:b})}render(){this.container.className="fileAttachmentAnnotation";let a=document.createElement("div");return a.className="popupTriggerArea",a.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&(this.data.titleObj?.str||this.data.contentsObj?.str||this.data.richText)&&this._createPopup(a,this.data),this.container.append(a),this.container}_download(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)}}class y{static#e(a,h,b,v){let C=a.firstChild||a;C.id=`${r.AnnotationPrefix}${h}`,b.append(a),v?.moveElementInDOM(b,a,C,!1)}static render(a){let{annotations:h,div:b,viewport:v,accessibilityManager:C}=a;this.#t(b,v);let I=0;for(let O of h){if(O.annotationType!==n.AnnotationType.POPUP){let{width:K,height:G}=f(O.rect);if(K<=0||G<=0)continue}let U=F.create({data:O,layer:b,page:a.page,viewport:v,linkService:a.linkService,downloadManager:a.downloadManager,imageResourcesPath:a.imageResourcesPath||"",renderForms:a.renderForms!==!1,svgFactory:new r.DOMSVGFactory,annotationStorage:a.annotationStorage||new s.AnnotationStorage,enableScripting:a.enableScripting,hasJSActions:a.hasJSActions,fieldObjects:a.fieldObjects,mouseState:a.mouseState||{isDown:!1}});if(U.isRenderable){let K=U.render();if(O.hidden&&(K.style.visibility="hidden"),Array.isArray(K))for(let G of K)G.style.zIndex=I++,y.#e(G,O.id,b,C);else K.style.zIndex=I++,U instanceof g?b.prepend(K):y.#e(K,O.id,b,C)}}this.#r(b,a.annotationCanvasMap)}static update(a){let{annotationCanvasMap:h,div:b,viewport:v}=a;this.#t(b,v),this.#r(b,h),b.hidden=!1}static#t(a,{width:h,height:b,rotation:v}){let{style:C}=a,I=v%180!==0,O=Math.floor(h)+"px",U=Math.floor(b)+"px";C.width=I?U:O,C.height=I?O:U,a.setAttribute("data-main-rotation",v)}static#r(a,h){if(h){for(let[b,v]of h){let C=a.querySelector(`[data-annotation-id="${b}"]`);if(!C)continue;let{firstChild:I}=C;I?I.nodeName==="CANVAS"?I.replaceWith(v):I.before(v):C.append(v)}h.clear()}}}e.AnnotationLayer=y},(o,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorConverters=void 0;function t(r){return Math.floor(Math.max(0,Math.min(1,r))*255).toString(16).padStart(2,"0")}class n{static CMYK_G([s,l,m,u]){return["G",1-Math.min(1,.3*s+.59*m+.11*l+u)]}static G_CMYK([s]){return["CMYK",0,0,0,1-s]}static G_RGB([s]){return["RGB",s,s,s]}static G_HTML([s]){let l=t(s);return`#${l}${l}${l}`}static RGB_G([s,l,m]){return["G",.3*s+.59*l+.11*m]}static RGB_HTML([s,l,m]){let u=t(s),i=t(l),c=t(m);return`#${u}${i}${c}`}static T_HTML(){return"#00000000"}static CMYK_RGB([s,l,m,u]){return["RGB",1-Math.min(1,s+u),1-Math.min(1,m+u),1-Math.min(1,l+u)]}static CMYK_HTML(s){let l=this.CMYK_RGB(s).slice(1);return this.RGB_HTML(l)}static RGB_CMYK([s,l,m]){let u=1-s,i=1-l,c=1-m,f=Math.min(u,i,c);return["CMYK",u,i,c,f]}}e.ColorConverters=n},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaLayer=void 0;var n=t(20);class r{static setupStorage(l,m,u,i,c){let f=i.getValue(m,{value:null});switch(u.name){case"textarea":if(f.value!==null&&(l.textContent=f.value),c==="print")break;l.addEventListener("input",F=>{i.setValue(m,{value:F.target.value})});break;case"input":if(u.attributes.type==="radio"||u.attributes.type==="checkbox"){if(f.value===u.attributes.xfaOn?l.setAttribute("checked",!0):f.value===u.attributes.xfaOff&&l.removeAttribute("checked"),c==="print")break;l.addEventListener("change",F=>{i.setValue(m,{value:F.target.checked?F.target.getAttribute("xfaOn"):F.target.getAttribute("xfaOff")})})}else{if(f.value!==null&&l.setAttribute("value",f.value),c==="print")break;l.addEventListener("input",F=>{i.setValue(m,{value:F.target.value})})}break;case"select":if(f.value!==null)for(let F of u.children)F.attributes.value===f.value&&(F.attributes.selected=!0);l.addEventListener("input",F=>{let S=F.target.options,d=S.selectedIndex===-1?"":S[S.selectedIndex].value;i.setValue(m,{value:d})});break}}static setAttributes({html:l,element:m,storage:u=null,intent:i,linkService:c}){let{attributes:f}=m,F=l instanceof HTMLAnchorElement;f.type==="radio"&&(f.name=`${f.name}-${i}`);for(let[S,d]of Object.entries(f))if(d!=null)switch(S){case"class":d.length&&l.setAttribute(S,d.join(" "));break;case"dataId":break;case"id":l.setAttribute("data-element-id",d);break;case"style":Object.assign(l.style,d);break;case"textContent":l.textContent=d;break;default:(!F||S!=="href"&&S!=="newWindow")&&l.setAttribute(S,d)}F&&c.addLinkAttributes(l,f.href,f.newWindow),u&&f.dataId&&this.setupStorage(l,f.dataId,m,u)}static render(l){let m=l.annotationStorage,u=l.linkService,i=l.xfaHtml,c=l.intent||"display",f=document.createElement(i.name);i.attributes&&this.setAttributes({html:f,element:i,intent:c,linkService:u});let F=[[i,-1,f]],S=l.div;if(S.append(f),l.viewport){let _=`matrix(${l.viewport.transform.join(",")})`;S.style.transform=_}c!=="richText"&&S.setAttribute("class","xfaLayer xfaFont");let d=[];for(;F.length>0;){let[_,T,R]=F.at(-1);if(T+1===_.children.length){F.pop();continue}let E=_.children[++F.at(-1)[1]];if(E===null)continue;let{name:P}=E;if(P==="#text"){let p=document.createTextNode(E.value);d.push(p),R.append(p);continue}let k;if(E?.attributes?.xmlns?k=document.createElementNS(E.attributes.xmlns,P):k=document.createElement(P),R.append(k),E.attributes&&this.setAttributes({html:k,element:E,storage:m,intent:c,linkService:u}),E.children&&E.children.length>0)F.push([E,-1,k]);else if(E.value){let p=document.createTextNode(E.value);n.XfaText.shouldBuildText(P)&&d.push(p),k.append(p)}}for(let _ of S.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))_.setAttribute("readOnly",!0);return{textDivs:d}}static update(l){let m=`matrix(${l.viewport.transform.join(",")})`;l.div.style.transform=m,l.div.hidden=!1}}e.XfaLayer=r},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TextLayerRenderTask=void 0,e.renderTextLayer=E;var n=t(1),r=t(8);let s=1e5,l=30,m=.8,u=new Map,i=/^\s+$/g;function c(P,k){let p=u.get(P);if(p)return p;k.save(),k.font=`${l}px ${P}`;let g=k.measureText(""),A=g.fontBoundingBoxAscent,M=Math.abs(g.fontBoundingBoxDescent);if(A){k.restore();let V=A/(A+M);return u.set(P,V),V}k.strokeStyle="red",k.clearRect(0,0,l,l),k.strokeText("g",0,0);let D=k.getImageData(0,0,l,l).data;M=0;for(let V=D.length-1-3;V>=0;V-=4)if(D[V]>0){M=Math.ceil(V/4/l);break}k.clearRect(0,0,l,l),k.strokeText("A",0,l),D=k.getImageData(0,0,l,l).data,A=0;for(let V=0,W=D.length;V<W;V+=4)if(D[V]>0){A=l-Math.floor(V/4/l);break}if(k.restore(),A){let V=A/(A+M);return u.set(P,V),V}return u.set(P,m),m}function f(P,k,p,g){let A=document.createElement("span"),M=P._enhanceTextSelection?{angle:0,canvasWidth:0,hasText:k.str!=="",hasEOL:k.hasEOL,originalTransform:null,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,scale:1,fontSize:0}:{angle:0,canvasWidth:0,hasText:k.str!=="",hasEOL:k.hasEOL,fontSize:0};P._textDivs.push(A);let D=n.Util.transform(P._viewport.transform,k.transform),V=Math.atan2(D[1],D[0]),W=p[k.fontName];W.vertical&&(V+=Math.PI/2);let te=Math.hypot(D[2],D[3]),Z=te*c(W.fontFamily,g),H,N;V===0?(H=D[4],N=D[5]-Z):(H=D[4]+Z*Math.sin(V),N=D[5]-Z*Math.cos(V)),A.style.left=`${H}px`,A.style.top=`${N}px`,A.style.fontSize=`${te}px`,A.style.fontFamily=W.fontFamily,M.fontSize=te,A.setAttribute("role","presentation"),A.textContent=k.str,A.dir=k.dir,P._fontInspectorEnabled&&(A.dataset.fontName=k.fontName),V!==0&&(M.angle=V*(180/Math.PI));let j=!1;if(k.str.length>1||P._enhanceTextSelection&&i.test(k.str))j=!0;else if(k.str!==" "&&k.transform[0]!==k.transform[3]){let J=Math.abs(k.transform[0]),$=Math.abs(k.transform[3]);J!==$&&Math.max(J,$)/Math.min(J,$)>1.5&&(j=!0)}if(j&&(W.vertical?M.canvasWidth=k.height*P._viewport.scale:M.canvasWidth=k.width*P._viewport.scale),P._textDivProperties.set(A,M),P._textContentStream&&P._layoutText(A),P._enhanceTextSelection&&M.hasText){let J=1,$=0;V!==0&&(J=Math.cos(V),$=Math.sin(V));let B=(W.vertical?k.height:k.width)*P._viewport.scale,w=te,x,y;V!==0?(x=[J,$,-$,J,H,N],y=n.Util.getAxialAlignedBoundingBox([0,0,B,w],x)):y=[H,N,H+B,N+w],P._bounds.push({left:y[0],top:y[1],right:y[2],bottom:y[3],div:A,size:[B,w],m:x})}}function F(P){if(P._canceled)return;let k=P._textDivs,p=P._capability,g=k.length;if(g>s){P._renderingDone=!0,p.resolve();return}if(!P._textContentStream)for(let A=0;A<g;A++)P._layoutText(k[A]);P._renderingDone=!0,p.resolve()}function S(P,k,p){let g=0;for(let A=0;A<p;A++){let M=P[k++];M>0&&(g=g?Math.min(M,g):M)}return g}function d(P){let k=P._bounds,p=P._viewport,g=_(p.width,p.height,k);for(let A=0;A<g.length;A++){let M=k[A].div,D=P._textDivProperties.get(M);if(D.angle===0){D.paddingLeft=k[A].left-g[A].left,D.paddingTop=k[A].top-g[A].top,D.paddingRight=g[A].right-k[A].right,D.paddingBottom=g[A].bottom-k[A].bottom,P._textDivProperties.set(M,D);continue}let V=g[A],W=k[A],te=W.m,Z=te[0],H=te[1],N=[[0,0],[0,W.size[1]],[W.size[0],0],W.size],j=new Float64Array(64);for(let $=0,B=N.length;$<B;$++){let w=n.Util.applyTransform(N[$],te);j[$+0]=Z&&(V.left-w[0])/Z,j[$+4]=H&&(V.top-w[1])/H,j[$+8]=Z&&(V.right-w[0])/Z,j[$+12]=H&&(V.bottom-w[1])/H,j[$+16]=H&&(V.left-w[0])/-H,j[$+20]=Z&&(V.top-w[1])/Z,j[$+24]=H&&(V.right-w[0])/-H,j[$+28]=Z&&(V.bottom-w[1])/Z,j[$+32]=Z&&(V.left-w[0])/-Z,j[$+36]=H&&(V.top-w[1])/-H,j[$+40]=Z&&(V.right-w[0])/-Z,j[$+44]=H&&(V.bottom-w[1])/-H,j[$+48]=H&&(V.left-w[0])/H,j[$+52]=Z&&(V.top-w[1])/-Z,j[$+56]=H&&(V.right-w[0])/H,j[$+60]=Z&&(V.bottom-w[1])/-Z}let J=1+Math.min(Math.abs(Z),Math.abs(H));D.paddingLeft=S(j,32,16)/J,D.paddingTop=S(j,48,16)/J,D.paddingRight=S(j,0,16)/J,D.paddingBottom=S(j,16,16)/J,P._textDivProperties.set(M,D)}}function _(P,k,p){let g=p.map(function(M,D){return{x1:M.left,y1:M.top,x2:M.right,y2:M.bottom,index:D,x1New:void 0,x2New:void 0}});T(P,g);let A=new Array(p.length);for(let M of g){let D=M.index;A[D]={left:M.x1New,top:0,right:M.x2New,bottom:0}}p.map(function(M,D){let V=A[D],W=g[D];W.x1=M.top,W.y1=P-V.right,W.x2=M.bottom,W.y2=P-V.left,W.index=D,W.x1New=void 0,W.x2New=void 0}),T(k,g);for(let M of g){let D=M.index;A[D].top=M.x1New,A[D].bottom=M.x2New}return A}function T(P,k){k.sort(function(A,M){return A.x1-M.x1||A.index-M.index});let g=[{start:-1/0,end:1/0,boundary:{x1:-1/0,y1:-1/0,x2:0,y2:1/0,index:-1,x1New:0,x2New:0}}];for(let A of k){let M=0;for(;M<g.length&&g[M].end<=A.y1;)M++;let D=g.length-1;for(;D>=0&&g[D].start>=A.y2;)D--;let V,W,te,Z,H=-1/0;for(te=M;te<=D;te++){V=g[te],W=V.boundary;let J;W.x2>A.x1?J=W.index>A.index?W.x1New:A.x1:W.x2New===void 0?J=(W.x2+A.x1)/2:J=W.x2New,J>H&&(H=J)}for(A.x1New=H,te=M;te<=D;te++)V=g[te],W=V.boundary,W.x2New===void 0?W.x2>A.x1?W.index>A.index&&(W.x2New=W.x2):W.x2New=H:W.x2New>H&&(W.x2New=Math.max(H,W.x2));let N=[],j=null;for(te=M;te<=D;te++){V=g[te],W=V.boundary;let J=W.x2>A.x2?W:A;j===J?N.at(-1).end=V.end:(N.push({start:V.start,end:V.end,boundary:J}),j=J)}for(g[M].start<A.y1&&(N[0].start=A.y1,N.unshift({start:g[M].start,end:A.y1,boundary:g[M].boundary})),A.y2<g[D].end&&(N.at(-1).end=A.y2,N.push({start:A.y2,end:g[D].end,boundary:g[D].boundary})),te=M;te<=D;te++){if(V=g[te],W=V.boundary,W.x2New!==void 0)continue;let J=!1;for(Z=M-1;!J&&Z>=0&&g[Z].start>=W.y1;Z--)J=g[Z].boundary===W;for(Z=D+1;!J&&Z<g.length&&g[Z].end<=W.y2;Z++)J=g[Z].boundary===W;for(Z=0;!J&&Z<N.length;Z++)J=N[Z].boundary===W;J||(W.x2New=H)}Array.prototype.splice.apply(g,[M,D-M+1,...N])}for(let A of g){let M=A.boundary;M.x2New===void 0&&(M.x2New=Math.max(P,M.x2))}}class R{constructor({textContent:k,textContentStream:p,container:g,viewport:A,textDivs:M,textContentItemsStr:D,enhanceTextSelection:V}){V&&(0,r.deprecated)("The `enhanceTextSelection` functionality will be removed in the future."),this._textContent=k,this._textContentStream=p,this._container=g,this._document=g.ownerDocument,this._viewport=A,this._textDivs=M||[],this._textContentItemsStr=D||[],this._enhanceTextSelection=!!V,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._layoutTextLastFontSize=null,this._layoutTextLastFontFamily=null,this._layoutTextCtx=null,this._textDivProperties=new WeakMap,this._renderingDone=!1,this._canceled=!1,this._capability=(0,n.createPromiseCapability)(),this._renderTimer=null,this._bounds=[],this._devicePixelRatio=globalThis.devicePixelRatio||1,this._capability.promise.finally(()=>{this._enhanceTextSelection||(this._textDivProperties=null),this._layoutTextCtx&&(this._layoutTextCtx.canvas.width=0,this._layoutTextCtx.canvas.height=0,this._layoutTextCtx=null)}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new n.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._renderTimer!==null&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._capability.reject(new Error("TextLayer task cancelled."))}_processItems(k,p){for(let g=0,A=k.length;g<A;g++){if(k[g].str===void 0){if(k[g].type==="beginMarkedContentProps"||k[g].type==="beginMarkedContent"){let M=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),k[g].id!==null&&this._container.setAttribute("id",`${k[g].id}`),M.append(this._container)}else k[g].type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(k[g].str),f(this,k[g],p,this._layoutTextCtx)}}_layoutText(k){let p=this._textDivProperties.get(k),g="";if(p.canvasWidth!==0&&p.hasText){let{fontFamily:A}=k.style,{fontSize:M}=p;(M!==this._layoutTextLastFontSize||A!==this._layoutTextLastFontFamily)&&(this._layoutTextCtx.font=`${M*this._devicePixelRatio}px ${A}`,this._layoutTextLastFontSize=M,this._layoutTextLastFontFamily=A);let{width:D}=this._layoutTextCtx.measureText(k.textContent);if(D>0){let V=this._devicePixelRatio*p.canvasWidth/D;this._enhanceTextSelection&&(p.scale=V),g=`scaleX(${V})`}}if(p.angle!==0&&(g=`rotate(${p.angle}deg) ${g}`),g.length>0&&(this._enhanceTextSelection&&(p.originalTransform=g),k.style.transform=g),p.hasText&&this._container.append(k),p.hasEOL){let A=document.createElement("br");A.setAttribute("role","presentation"),this._container.append(A)}}_render(k=0){let p=(0,n.createPromiseCapability)(),g=Object.create(null),A=this._document.createElement("canvas");if(A.height=A.width=l,this._layoutTextCtx=A.getContext("2d",{alpha:!1}),this._textContent){let M=this._textContent.items,D=this._textContent.styles;this._processItems(M,D),p.resolve()}else if(this._textContentStream){let M=()=>{this._reader.read().then(({value:D,done:V})=>{if(V){p.resolve();return}Object.assign(g,D.styles),this._processItems(D.items,g),M()},p.reject)};this._reader=this._textContentStream.getReader(),M()}else throw new Error('Neither "textContent" nor "textContentStream" parameters specified.');p.promise.then(()=>{g=null,k?this._renderTimer=setTimeout(()=>{F(this),this._renderTimer=null},k):F(this)},this._capability.reject)}expandTextDivs(k=!1){if(!this._enhanceTextSelection||!this._renderingDone)return;this._bounds!==null&&(d(this),this._bounds=null);let p=[],g=[];for(let A=0,M=this._textDivs.length;A<M;A++){let D=this._textDivs[A],V=this._textDivProperties.get(D);V.hasText&&(k?(p.length=0,g.length=0,V.originalTransform&&p.push(V.originalTransform),V.paddingTop>0?(g.push(`${V.paddingTop}px`),p.push(`translateY(${-V.paddingTop}px)`)):g.push(0),V.paddingRight>0?g.push(`${V.paddingRight/V.scale}px`):g.push(0),V.paddingBottom>0?g.push(`${V.paddingBottom}px`):g.push(0),V.paddingLeft>0?(g.push(`${V.paddingLeft/V.scale}px`),p.push(`translateX(${-V.paddingLeft/V.scale}px)`)):g.push(0),D.style.padding=g.join(" "),p.length&&(D.style.transform=p.join(" "))):(D.style.padding=null,D.style.transform=V.originalTransform))}}}e.TextLayerRenderTask=R;function E(P){let k=new R({textContent:P.textContent,textContentStream:P.textContentStream,container:P.container,viewport:P.viewport,textDivs:P.textDivs,textContentItemsStr:P.textContentItemsStr,enhanceTextSelection:P.enhanceTextSelection});return k._render(P.timeout),k}},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SVGGraphics=void 0;var n=t(8),r=t(1),s=t(3);let l=class{constructor(){(0,r.unreachable)("Not implemented: SVGGraphics")}};e.SVGGraphics=l;{let _=function(p){let g=[],A=[];for(let M of p){if(M.fn==="save"){g.push({fnId:92,fn:"group",items:[]}),A.push(g),g=g.at(-1).items;continue}M.fn==="restore"?g=A.pop():g.push(M)}return g},T=function(p){if(Number.isInteger(p))return p.toString();let g=p.toFixed(10),A=g.length-1;if(g[A]!=="0")return g;do A--;while(g[A]==="0");return g.substring(0,g[A]==="."?A:A+1)},R=function(p){if(p[4]===0&&p[5]===0){if(p[1]===0&&p[2]===0)return p[0]===1&&p[3]===1?"":`scale(${T(p[0])} ${T(p[3])})`;if(p[0]===p[3]&&p[1]===-p[2]){let g=Math.acos(p[0])*180/Math.PI;return`rotate(${T(g)})`}}else if(p[0]===1&&p[1]===0&&p[2]===0&&p[3]===1)return`translate(${T(p[4])} ${T(p[5])})`;return`matrix(${T(p[0])} ${T(p[1])} ${T(p[2])} ${T(p[3])} ${T(p[4])} ${T(p[5])})`},m={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},u="http://www.w3.org/XML/1998/namespace",i="http://www.w3.org/1999/xlink",c=["butt","round","square"],f=["miter","round","bevel"],F=function(p,g="",A=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!A)return URL.createObjectURL(new Blob([p],{type:g}));let M="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",D=`data:${g};base64,`;for(let V=0,W=p.length;V<W;V+=3){let te=p[V]&255,Z=p[V+1]&255,H=p[V+2]&255,N=te>>2,j=(te&3)<<4|Z>>4,J=V+1<W?(Z&15)<<2|H>>6:64,$=V+2<W?H&63:64;D+=M[N]+M[j]+M[J]+M[$]}return D},S=function(){let p=new Uint8Array([137,80,78,71,13,10,26,10]),g=12,A=new Int32Array(256);for(let H=0;H<256;H++){let N=H;for(let j=0;j<8;j++)N&1?N=3988292384^N>>1&2147483647:N=N>>1&2147483647;A[H]=N}function M(H,N,j){let J=-1;for(let $=N;$<j;$++){let B=(J^H[$])&255,w=A[B];J=J>>>8^w}return J^-1}function D(H,N,j,J){let $=J,B=N.length;j[$]=B>>24&255,j[$+1]=B>>16&255,j[$+2]=B>>8&255,j[$+3]=B&255,$+=4,j[$]=H.charCodeAt(0)&255,j[$+1]=H.charCodeAt(1)&255,j[$+2]=H.charCodeAt(2)&255,j[$+3]=H.charCodeAt(3)&255,$+=4,j.set(N,$),$+=N.length;let w=M(j,J+4,$);j[$]=w>>24&255,j[$+1]=w>>16&255,j[$+2]=w>>8&255,j[$+3]=w&255}function V(H,N,j){let J=1,$=0;for(let B=N;B<j;++B)J=(J+(H[B]&255))%65521,$=($+J)%65521;return $<<16|J}function W(H){if(!s.isNodeJS)return te(H);try{let N;parseInt(process.versions.node)>=8?N=H:N=Buffer.from(H);let j=Ki().deflateSync(N,{level:9});return j instanceof Uint8Array?j:new Uint8Array(j)}catch(N){(0,r.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+N)}return te(H)}function te(H){let N=H.length,j=65535,J=Math.ceil(N/j),$=new Uint8Array(2+N+J*5+4),B=0;$[B++]=120,$[B++]=156;let w=0;for(;N>j;)$[B++]=0,$[B++]=255,$[B++]=255,$[B++]=0,$[B++]=0,$.set(H.subarray(w,w+j),B),B+=j,w+=j,N-=j;$[B++]=1,$[B++]=N&255,$[B++]=N>>8&255,$[B++]=~N&65535&255,$[B++]=(~N&65535)>>8&255,$.set(H.subarray(w),B),B+=H.length-w;let x=V(H,0,H.length);return $[B++]=x>>24&255,$[B++]=x>>16&255,$[B++]=x>>8&255,$[B++]=x&255,$}function Z(H,N,j,J){let $=H.width,B=H.height,w,x,y,L=H.data;switch(N){case r.ImageKind.GRAYSCALE_1BPP:x=0,w=1,y=$+7>>3;break;case r.ImageKind.RGB_24BPP:x=2,w=8,y=$*3;break;case r.ImageKind.RGBA_32BPP:x=6,w=8,y=$*4;break;default:throw new Error("invalid format")}let a=new Uint8Array((1+y)*B),h=0,b=0;for(let K=0;K<B;++K)a[h++]=0,a.set(L.subarray(b,b+y),h),b+=y,h+=y;if(N===r.ImageKind.GRAYSCALE_1BPP&&J){h=0;for(let K=0;K<B;K++){h++;for(let G=0;G<y;G++)a[h++]^=255}}let v=new Uint8Array([$>>24&255,$>>16&255,$>>8&255,$&255,B>>24&255,B>>16&255,B>>8&255,B&255,w,x,0,0,0]),C=W(a),I=p.length+g*3+v.length+C.length,O=new Uint8Array(I),U=0;return O.set(p,U),U+=p.length,D("IHDR",v,O,U),U+=g+v.length,D("IDATA",C,O,U),U+=g+C.length,D("IEND",new Uint8Array(0),O,U),F(O,"image/png",j)}return function(N,j,J){let $=N.kind===void 0?r.ImageKind.GRAYSCALE_1BPP:N.kind;return Z(N,$,j,J)}}();class d{constructor(){this.fontSizeScale=1,this.fontWeight=m.fontWeight,this.fontSize=0,this.textMatrix=r.IDENTITY_MATRIX,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=r.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=m.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(g,A){this.x=g,this.y=A}}let E=0,P=0,k=0;e.SVGGraphics=l=class{constructor(p,g,A=!1){(0,n.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new n.DOMSVGFactory,this.current=new d,this.transformMatrix=r.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=p,this.objs=g,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!A,this._operatorIdMapping=[];for(let M in r.OPS)this._operatorIdMapping[r.OPS[M]]=M}save(){this.transformStack.push(this.transformMatrix);let p=this.current;this.extraStack.push(p),this.current=p.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(p){this.save(),this.executeOpTree(p),this.restore()}loadDependencies(p){let g=p.fnArray,A=p.argsArray;for(let M=0,D=g.length;M<D;M++)if(g[M]===r.OPS.dependency)for(let V of A[M]){let W=V.startsWith("g_")?this.commonObjs:this.objs,te=new Promise(Z=>{W.get(V,Z)});this.current.dependencies.push(te)}return Promise.all(this.current.dependencies)}transform(p,g,A,M,D,V){let W=[p,g,A,M,D,V];this.transformMatrix=r.Util.transform(this.transformMatrix,W),this.tgrp=null}getSVG(p,g){this.viewport=g;let A=this._initialize(g);return this.loadDependencies(p).then(()=>(this.transformMatrix=r.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(p)),A))}convertOpList(p){let g=this._operatorIdMapping,A=p.argsArray,M=p.fnArray,D=[];for(let V=0,W=M.length;V<W;V++){let te=M[V];D.push({fnId:te,fn:g[te],args:A[V]})}return _(D)}executeOpTree(p){for(let g of p){let A=g.fn,M=g.fnId,D=g.args;switch(M|0){case r.OPS.beginText:this.beginText();break;case r.OPS.dependency:break;case r.OPS.setLeading:this.setLeading(D);break;case r.OPS.setLeadingMoveText:this.setLeadingMoveText(D[0],D[1]);break;case r.OPS.setFont:this.setFont(D);break;case r.OPS.showText:this.showText(D[0]);break;case r.OPS.showSpacedText:this.showText(D[0]);break;case r.OPS.endText:this.endText();break;case r.OPS.moveText:this.moveText(D[0],D[1]);break;case r.OPS.setCharSpacing:this.setCharSpacing(D[0]);break;case r.OPS.setWordSpacing:this.setWordSpacing(D[0]);break;case r.OPS.setHScale:this.setHScale(D[0]);break;case r.OPS.setTextMatrix:this.setTextMatrix(D[0],D[1],D[2],D[3],D[4],D[5]);break;case r.OPS.setTextRise:this.setTextRise(D[0]);break;case r.OPS.setTextRenderingMode:this.setTextRenderingMode(D[0]);break;case r.OPS.setLineWidth:this.setLineWidth(D[0]);break;case r.OPS.setLineJoin:this.setLineJoin(D[0]);break;case r.OPS.setLineCap:this.setLineCap(D[0]);break;case r.OPS.setMiterLimit:this.setMiterLimit(D[0]);break;case r.OPS.setFillRGBColor:this.setFillRGBColor(D[0],D[1],D[2]);break;case r.OPS.setStrokeRGBColor:this.setStrokeRGBColor(D[0],D[1],D[2]);break;case r.OPS.setStrokeColorN:this.setStrokeColorN(D);break;case r.OPS.setFillColorN:this.setFillColorN(D);break;case r.OPS.shadingFill:this.shadingFill(D[0]);break;case r.OPS.setDash:this.setDash(D[0],D[1]);break;case r.OPS.setRenderingIntent:this.setRenderingIntent(D[0]);break;case r.OPS.setFlatness:this.setFlatness(D[0]);break;case r.OPS.setGState:this.setGState(D[0]);break;case r.OPS.fill:this.fill();break;case r.OPS.eoFill:this.eoFill();break;case r.OPS.stroke:this.stroke();break;case r.OPS.fillStroke:this.fillStroke();break;case r.OPS.eoFillStroke:this.eoFillStroke();break;case r.OPS.clip:this.clip("nonzero");break;case r.OPS.eoClip:this.clip("evenodd");break;case r.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case r.OPS.paintImageXObject:this.paintImageXObject(D[0]);break;case r.OPS.paintInlineImageXObject:this.paintInlineImageXObject(D[0]);break;case r.OPS.paintImageMaskXObject:this.paintImageMaskXObject(D[0]);break;case r.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(D[0],D[1]);break;case r.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case r.OPS.closePath:this.closePath();break;case r.OPS.closeStroke:this.closeStroke();break;case r.OPS.closeFillStroke:this.closeFillStroke();break;case r.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case r.OPS.nextLine:this.nextLine();break;case r.OPS.transform:this.transform(D[0],D[1],D[2],D[3],D[4],D[5]);break;case r.OPS.constructPath:this.constructPath(D[0],D[1]);break;case r.OPS.endPath:this.endPath();break;case 92:this.group(g.items);break;default:(0,r.warn)(`Unimplemented operator ${A}`);break}}}setWordSpacing(p){this.current.wordSpacing=p}setCharSpacing(p){this.current.charSpacing=p}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(p,g,A,M,D,V){let W=this.current;W.textMatrix=W.lineMatrix=[p,g,A,M,D,V],W.textMatrixScale=Math.hypot(p,g),W.x=W.lineX=0,W.y=W.lineY=0,W.xcoords=[],W.ycoords=[],W.tspan=this.svgFactory.createElement("svg:tspan"),W.tspan.setAttributeNS(null,"font-family",W.fontFamily),W.tspan.setAttributeNS(null,"font-size",`${T(W.fontSize)}px`),W.tspan.setAttributeNS(null,"y",T(-W.y)),W.txtElement=this.svgFactory.createElement("svg:text"),W.txtElement.append(W.tspan)}beginText(){let p=this.current;p.x=p.lineX=0,p.y=p.lineY=0,p.textMatrix=r.IDENTITY_MATRIX,p.lineMatrix=r.IDENTITY_MATRIX,p.textMatrixScale=1,p.tspan=this.svgFactory.createElement("svg:tspan"),p.txtElement=this.svgFactory.createElement("svg:text"),p.txtgrp=this.svgFactory.createElement("svg:g"),p.xcoords=[],p.ycoords=[]}moveText(p,g){let A=this.current;A.x=A.lineX+=p,A.y=A.lineY+=g,A.xcoords=[],A.ycoords=[],A.tspan=this.svgFactory.createElement("svg:tspan"),A.tspan.setAttributeNS(null,"font-family",A.fontFamily),A.tspan.setAttributeNS(null,"font-size",`${T(A.fontSize)}px`),A.tspan.setAttributeNS(null,"y",T(-A.y))}showText(p){let g=this.current,A=g.font,M=g.fontSize;if(M===0)return;let D=g.fontSizeScale,V=g.charSpacing,W=g.wordSpacing,te=g.fontDirection,Z=g.textHScale*te,H=A.vertical,N=H?1:-1,j=A.defaultVMetrics,J=M*g.fontMatrix[0],$=0;for(let x of p){if(x===null){$+=te*W;continue}else if(typeof x=="number"){$+=N*x*M/1e3;continue}let y=(x.isSpace?W:0)+V,L=x.fontChar,a,h,b=x.width;if(H){let C,I=x.vmetric||j;C=x.vmetric?I[1]:b*.5,C=-C*J;let O=I[2]*J;b=I?-I[0]:b,a=C/D,h=($+O)/D}else a=$/D,h=0;(x.isInFont||A.missingFile)&&(g.xcoords.push(g.x+a),H&&g.ycoords.push(-g.y+h),g.tspan.textContent+=L);let v;H?v=b*J-y*te:v=b*J+y*te,$+=v}g.tspan.setAttributeNS(null,"x",g.xcoords.map(T).join(" ")),H?g.tspan.setAttributeNS(null,"y",g.ycoords.map(T).join(" ")):g.tspan.setAttributeNS(null,"y",T(-g.y)),H?g.y-=$:g.x+=$*Z,g.tspan.setAttributeNS(null,"font-family",g.fontFamily),g.tspan.setAttributeNS(null,"font-size",`${T(g.fontSize)}px`),g.fontStyle!==m.fontStyle&&g.tspan.setAttributeNS(null,"font-style",g.fontStyle),g.fontWeight!==m.fontWeight&&g.tspan.setAttributeNS(null,"font-weight",g.fontWeight);let B=g.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;if(B===r.TextRenderingMode.FILL||B===r.TextRenderingMode.FILL_STROKE?(g.fillColor!==m.fillColor&&g.tspan.setAttributeNS(null,"fill",g.fillColor),g.fillAlpha<1&&g.tspan.setAttributeNS(null,"fill-opacity",g.fillAlpha)):g.textRenderingMode===r.TextRenderingMode.ADD_TO_PATH?g.tspan.setAttributeNS(null,"fill","transparent"):g.tspan.setAttributeNS(null,"fill","none"),B===r.TextRenderingMode.STROKE||B===r.TextRenderingMode.FILL_STROKE){let x=1/(g.textMatrixScale||1);this._setStrokeAttributes(g.tspan,x)}let w=g.textMatrix;g.textRise!==0&&(w=w.slice(),w[5]+=g.textRise),g.txtElement.setAttributeNS(null,"transform",`${R(w)} scale(${T(Z)}, -1)`),g.txtElement.setAttributeNS(u,"xml:space","preserve"),g.txtElement.append(g.tspan),g.txtgrp.append(g.txtElement),this._ensureTransformGroup().append(g.txtElement)}setLeadingMoveText(p,g){this.setLeading(-g),this.moveText(p,g)}addFontStyle(p){if(!p.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));let g=F(p.data,p.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${p.loadedName}"; src: url(${g}); }
`}setFont(p){let g=this.current,A=this.commonObjs.get(p[0]),M=p[1];g.font=A,this.embedFonts&&!A.missingFile&&!this.embeddedFonts[A.loadedName]&&(this.addFontStyle(A),this.embeddedFonts[A.loadedName]=A),g.fontMatrix=A.fontMatrix||r.FONT_IDENTITY_MATRIX;let D="normal";A.black?D="900":A.bold&&(D="bold");let V=A.italic?"italic":"normal";M<0?(M=-M,g.fontDirection=-1):g.fontDirection=1,g.fontSize=M,g.fontFamily=A.loadedName,g.fontWeight=D,g.fontStyle=V,g.tspan=this.svgFactory.createElement("svg:tspan"),g.tspan.setAttributeNS(null,"y",T(-g.y)),g.xcoords=[],g.ycoords=[]}endText(){let p=this.current;p.textRenderingMode&r.TextRenderingMode.ADD_TO_PATH_FLAG&&p.txtElement?.hasChildNodes()&&(p.element=p.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(p){p>0&&(this.current.lineWidth=p)}setLineCap(p){this.current.lineCap=c[p]}setLineJoin(p){this.current.lineJoin=f[p]}setMiterLimit(p){this.current.miterLimit=p}setStrokeAlpha(p){this.current.strokeAlpha=p}setStrokeRGBColor(p,g,A){this.current.strokeColor=r.Util.makeHexColor(p,g,A)}setFillAlpha(p){this.current.fillAlpha=p}setFillRGBColor(p,g,A){this.current.fillColor=r.Util.makeHexColor(p,g,A),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(p){this.current.strokeColor=this._makeColorN_Pattern(p)}setFillColorN(p){this.current.fillColor=this._makeColorN_Pattern(p)}shadingFill(p){let g=this.viewport.width,A=this.viewport.height,M=r.Util.inverseTransform(this.transformMatrix),D=r.Util.applyTransform([0,0],M),V=r.Util.applyTransform([0,A],M),W=r.Util.applyTransform([g,0],M),te=r.Util.applyTransform([g,A],M),Z=Math.min(D[0],V[0],W[0],te[0]),H=Math.min(D[1],V[1],W[1],te[1]),N=Math.max(D[0],V[0],W[0],te[0]),j=Math.max(D[1],V[1],W[1],te[1]),J=this.svgFactory.createElement("svg:rect");J.setAttributeNS(null,"x",Z),J.setAttributeNS(null,"y",H),J.setAttributeNS(null,"width",N-Z),J.setAttributeNS(null,"height",j-H),J.setAttributeNS(null,"fill",this._makeShadingPattern(p)),this.current.fillAlpha<1&&J.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(J)}_makeColorN_Pattern(p){return p[0]==="TilingPattern"?this._makeTilingPattern(p):this._makeShadingPattern(p)}_makeTilingPattern(p){let g=p[1],A=p[2],M=p[3]||r.IDENTITY_MATRIX,[D,V,W,te]=p[4],Z=p[5],H=p[6],N=p[7],j=`shading${k++}`,[J,$,B,w]=r.Util.normalizeRect([...r.Util.applyTransform([D,V],M),...r.Util.applyTransform([W,te],M)]),[x,y]=r.Util.singularValueDecompose2dScale(M),L=Z*x,a=H*y,h=this.svgFactory.createElement("svg:pattern");h.setAttributeNS(null,"id",j),h.setAttributeNS(null,"patternUnits","userSpaceOnUse"),h.setAttributeNS(null,"width",L),h.setAttributeNS(null,"height",a),h.setAttributeNS(null,"x",`${J}`),h.setAttributeNS(null,"y",`${$}`);let b=this.svg,v=this.transformMatrix,C=this.current.fillColor,I=this.current.strokeColor,O=this.svgFactory.create(B-J,w-$);if(this.svg=O,this.transformMatrix=M,N===2){let U=r.Util.makeHexColor(...g);this.current.fillColor=U,this.current.strokeColor=U}return this.executeOpTree(this.convertOpList(A)),this.svg=b,this.transformMatrix=v,this.current.fillColor=C,this.current.strokeColor=I,h.append(O.childNodes[0]),this.defs.append(h),`url(#${j})`}_makeShadingPattern(p){switch(typeof p=="string"&&(p=this.objs.get(p)),p[0]){case"RadialAxial":let g=`shading${k++}`,A=p[3],M;switch(p[1]){case"axial":let D=p[4],V=p[5];M=this.svgFactory.createElement("svg:linearGradient"),M.setAttributeNS(null,"id",g),M.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),M.setAttributeNS(null,"x1",D[0]),M.setAttributeNS(null,"y1",D[1]),M.setAttributeNS(null,"x2",V[0]),M.setAttributeNS(null,"y2",V[1]);break;case"radial":let W=p[4],te=p[5],Z=p[6],H=p[7];M=this.svgFactory.createElement("svg:radialGradient"),M.setAttributeNS(null,"id",g),M.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),M.setAttributeNS(null,"cx",te[0]),M.setAttributeNS(null,"cy",te[1]),M.setAttributeNS(null,"r",H),M.setAttributeNS(null,"fx",W[0]),M.setAttributeNS(null,"fy",W[1]),M.setAttributeNS(null,"fr",Z);break;default:throw new Error(`Unknown RadialAxial type: ${p[1]}`)}for(let D of A){let V=this.svgFactory.createElement("svg:stop");V.setAttributeNS(null,"offset",D[0]),V.setAttributeNS(null,"stop-color",D[1]),M.append(V)}return this.defs.append(M),`url(#${g})`;case"Mesh":return(0,r.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${p[0]}`)}}setDash(p,g){this.current.dashArray=p,this.current.dashPhase=g}constructPath(p,g){let A=this.current,M=A.x,D=A.y,V=[],W=0;for(let te of p)switch(te|0){case r.OPS.rectangle:M=g[W++],D=g[W++];let Z=g[W++],H=g[W++],N=M+Z,j=D+H;V.push("M",T(M),T(D),"L",T(N),T(D),"L",T(N),T(j),"L",T(M),T(j),"Z");break;case r.OPS.moveTo:M=g[W++],D=g[W++],V.push("M",T(M),T(D));break;case r.OPS.lineTo:M=g[W++],D=g[W++],V.push("L",T(M),T(D));break;case r.OPS.curveTo:M=g[W+4],D=g[W+5],V.push("C",T(g[W]),T(g[W+1]),T(g[W+2]),T(g[W+3]),T(M),T(D)),W+=6;break;case r.OPS.curveTo2:V.push("C",T(M),T(D),T(g[W]),T(g[W+1]),T(g[W+2]),T(g[W+3])),M=g[W+2],D=g[W+3],W+=4;break;case r.OPS.curveTo3:M=g[W+2],D=g[W+3],V.push("C",T(g[W]),T(g[W+1]),T(M),T(D),T(M),T(D)),W+=4;break;case r.OPS.closePath:V.push("Z");break}V=V.join(" "),A.path&&p.length>0&&p[0]!==r.OPS.rectangle&&p[0]!==r.OPS.moveTo?V=A.path.getAttributeNS(null,"d")+V:(A.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(A.path)),A.path.setAttributeNS(null,"d",V),A.path.setAttributeNS(null,"fill","none"),A.element=A.path,A.setCurrentPoint(M,D)}endPath(){let p=this.current;if(p.path=null,!this.pendingClip)return;if(!p.element){this.pendingClip=null;return}let g=`clippath${E++}`,A=this.svgFactory.createElement("svg:clipPath");A.setAttributeNS(null,"id",g),A.setAttributeNS(null,"transform",R(this.transformMatrix));let M=p.element.cloneNode(!0);if(this.pendingClip==="evenodd"?M.setAttributeNS(null,"clip-rule","evenodd"):M.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,A.append(M),this.defs.append(A),p.activeClipUrl){p.clipGroup=null;for(let D of this.extraStack)D.clipGroup=null;A.setAttributeNS(null,"clip-path",p.activeClipUrl)}p.activeClipUrl=`url(#${g})`,this.tgrp=null}clip(p){this.pendingClip=p}closePath(){let p=this.current;if(p.path){let g=`${p.path.getAttributeNS(null,"d")}Z`;p.path.setAttributeNS(null,"d",g)}}setLeading(p){this.current.leading=-p}setTextRise(p){this.current.textRise=p}setTextRenderingMode(p){this.current.textRenderingMode=p}setHScale(p){this.current.textHScale=p/100}setRenderingIntent(p){}setFlatness(p){}setGState(p){for(let[g,A]of p)switch(g){case"LW":this.setLineWidth(A);break;case"LC":this.setLineCap(A);break;case"LJ":this.setLineJoin(A);break;case"ML":this.setMiterLimit(A);break;case"D":this.setDash(A[0],A[1]);break;case"RI":this.setRenderingIntent(A);break;case"FL":this.setFlatness(A);break;case"Font":this.setFont(A);break;case"CA":this.setStrokeAlpha(A);break;case"ca":this.setFillAlpha(A);break;default:(0,r.warn)(`Unimplemented graphic state operator ${g}`);break}}fill(){let p=this.current;p.element&&(p.element.setAttributeNS(null,"fill",p.fillColor),p.element.setAttributeNS(null,"fill-opacity",p.fillAlpha),this.endPath())}stroke(){let p=this.current;p.element&&(this._setStrokeAttributes(p.element),p.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(p,g=1){let A=this.current,M=A.dashArray;g!==1&&M.length>0&&(M=M.map(function(D){return g*D})),p.setAttributeNS(null,"stroke",A.strokeColor),p.setAttributeNS(null,"stroke-opacity",A.strokeAlpha),p.setAttributeNS(null,"stroke-miterlimit",T(A.miterLimit)),p.setAttributeNS(null,"stroke-linecap",A.lineCap),p.setAttributeNS(null,"stroke-linejoin",A.lineJoin),p.setAttributeNS(null,"stroke-width",T(g*A.lineWidth)+"px"),p.setAttributeNS(null,"stroke-dasharray",M.map(T).join(" ")),p.setAttributeNS(null,"stroke-dashoffset",T(g*A.dashPhase)+"px")}eoFill(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){let p=this.svgFactory.createElement("svg:rect");p.setAttributeNS(null,"x","0"),p.setAttributeNS(null,"y","0"),p.setAttributeNS(null,"width","1px"),p.setAttributeNS(null,"height","1px"),p.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(p)}paintImageXObject(p){let g=p.startsWith("g_")?this.commonObjs.get(p):this.objs.get(p);if(!g){(0,r.warn)(`Dependent image with object ID ${p} is not ready yet`);return}this.paintInlineImageXObject(g)}paintInlineImageXObject(p,g){let A=p.width,M=p.height,D=S(p,this.forceDataSchema,!!g),V=this.svgFactory.createElement("svg:rect");V.setAttributeNS(null,"x","0"),V.setAttributeNS(null,"y","0"),V.setAttributeNS(null,"width",T(A)),V.setAttributeNS(null,"height",T(M)),this.current.element=V,this.clip("nonzero");let W=this.svgFactory.createElement("svg:image");W.setAttributeNS(i,"xlink:href",D),W.setAttributeNS(null,"x","0"),W.setAttributeNS(null,"y",T(-M)),W.setAttributeNS(null,"width",T(A)+"px"),W.setAttributeNS(null,"height",T(M)+"px"),W.setAttributeNS(null,"transform",`scale(${T(1/A)} ${T(-1/M)})`),g?g.append(W):this._ensureTransformGroup().append(W)}paintImageMaskXObject(p){let g=this.current,A=p.width,M=p.height,D=g.fillColor;g.maskId=`mask${P++}`;let V=this.svgFactory.createElement("svg:mask");V.setAttributeNS(null,"id",g.maskId);let W=this.svgFactory.createElement("svg:rect");W.setAttributeNS(null,"x","0"),W.setAttributeNS(null,"y","0"),W.setAttributeNS(null,"width",T(A)),W.setAttributeNS(null,"height",T(M)),W.setAttributeNS(null,"fill",D),W.setAttributeNS(null,"mask",`url(#${g.maskId})`),this.defs.append(V),this._ensureTransformGroup().append(W),this.paintInlineImageXObject(p,V)}paintFormXObjectBegin(p,g){if(Array.isArray(p)&&p.length===6&&this.transform(p[0],p[1],p[2],p[3],p[4],p[5]),g){let A=g[2]-g[0],M=g[3]-g[1],D=this.svgFactory.createElement("svg:rect");D.setAttributeNS(null,"x",g[0]),D.setAttributeNS(null,"y",g[1]),D.setAttributeNS(null,"width",T(A)),D.setAttributeNS(null,"height",T(M)),this.current.element=D,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(p){let g=this.svgFactory.create(p.width,p.height),A=this.svgFactory.createElement("svg:defs");g.append(A),this.defs=A;let M=this.svgFactory.createElement("svg:g");return M.setAttributeNS(null,"transform",R(p.transform)),g.append(M),this.svg=M,g}_ensureClipGroup(){if(!this.current.clipGroup){let p=this.svgFactory.createElement("svg:g");p.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(p),this.current.clipGroup=p}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",R(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}}},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNodeStream=void 0;var n=t(1),r=t(33);let s=Fr(),l=Ji(),m=Yi(),u=Qi(),i=/^file:\/\/\/[a-zA-Z]:\//;function c(P){let k=u.parse(P);return k.protocol==="file:"||k.host?k:/^[a-z]:[/\\]/i.test(P)?u.parse(`file:///${P}`):(k.host||(k.protocol="file:"),k)}class f{constructor(k){this.source=k,this.url=c(k.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&k.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new R(this):new _(this),this._fullRequestReader}getRangeReader(k,p){if(p<=this._progressiveDataLength)return null;let g=this.isFsUrl?new E(this,k,p):new T(this,k,p);return this._rangeRequestReaders.push(g),g}cancelAllRequests(k){this._fullRequestReader&&this._fullRequestReader.cancel(k);for(let p of this._rangeRequestReaders.slice(0))p.cancel(k)}}e.PDFNodeStream=f;class F{constructor(k){this._url=k.url,this._done=!1,this._storedError=null,this.onProgress=null;let p=k.source;this._contentLength=p.length,this._loaded=0,this._filename=null,this._disableRange=p.disableRange||!1,this._rangeChunkSize=p.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!p.disableStream,this._isRangeSupported=!p.disableRange,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)(),this._headersCapability=(0,n.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let k=this._readableStream.read();return k===null?(this._readCapability=(0,n.createPromiseCapability)(),this.read()):(this._loaded+=k.length,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(k).buffer,done:!1})}cancel(k){if(!this._readableStream){this._error(k);return}this._readableStream.destroy(k)}_error(k){this._storedError=k,this._readCapability.resolve()}_setReadableStream(k){this._readableStream=k,k.on("readable",()=>{this._readCapability.resolve()}),k.on("end",()=>{k.destroy(),this._done=!0,this._readCapability.resolve()}),k.on("error",p=>{this._error(p)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new n.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class S{constructor(k){this._url=k.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)();let p=k.source;this._isStreamingSupported=!p.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let k=this._readableStream.read();return k===null?(this._readCapability=(0,n.createPromiseCapability)(),this.read()):(this._loaded+=k.length,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(k).buffer,done:!1})}cancel(k){if(!this._readableStream){this._error(k);return}this._readableStream.destroy(k)}_error(k){this._storedError=k,this._readCapability.resolve()}_setReadableStream(k){this._readableStream=k,k.on("readable",()=>{this._readCapability.resolve()}),k.on("end",()=>{k.destroy(),this._done=!0,this._readCapability.resolve()}),k.on("error",p=>{this._error(p)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function d(P,k){return{protocol:P.protocol,auth:P.auth,host:P.hostname,port:P.port,path:P.path,method:"GET",headers:k}}class _ extends F{constructor(k){super(k);let p=g=>{if(g.statusCode===404){let V=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=V,this._headersCapability.reject(V);return}this._headersCapability.resolve(),this._setReadableStream(g);let A=V=>this._readableStream.headers[V.toLowerCase()],{allowRangeRequests:M,suggestedLength:D}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:A,isHttp:k.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=M,this._contentLength=D||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(A)};this._request=null,this._url.protocol==="http:"?this._request=l.request(d(this._url,k.httpHeaders),p):this._request=m.request(d(this._url,k.httpHeaders),p),this._request.on("error",g=>{this._storedError=g,this._headersCapability.reject(g)}),this._request.end()}}class T extends S{constructor(k,p,g){super(k),this._httpHeaders={};for(let M in k.httpHeaders){let D=k.httpHeaders[M];typeof D>"u"||(this._httpHeaders[M]=D)}this._httpHeaders.Range=`bytes=${p}-${g-1}`;let A=M=>{if(M.statusCode===404){let D=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=D;return}this._setReadableStream(M)};this._request=null,this._url.protocol==="http:"?this._request=l.request(d(this._url,this._httpHeaders),A):this._request=m.request(d(this._url,this._httpHeaders),A),this._request.on("error",M=>{this._storedError=M}),this._request.end()}}class R extends F{constructor(k){super(k);let p=decodeURIComponent(this._url.path);i.test(this._url.href)&&(p=p.replace(/^\//,"")),s.lstat(p,(g,A)=>{if(g){g.code==="ENOENT"&&(g=new n.MissingPDFException(`Missing PDF "${p}".`)),this._storedError=g,this._headersCapability.reject(g);return}this._contentLength=A.size,this._setReadableStream(s.createReadStream(p)),this._headersCapability.resolve()})}}class E extends S{constructor(k,p,g){super(k);let A=decodeURIComponent(this._url.path);i.test(this._url.href)&&(A=A.replace(/^\//,"")),this._setReadableStream(s.createReadStream(A,{start:p,end:g-1}))}}},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createResponseStatusError=u,e.extractFilenameFromHeader=m,e.validateRangeRequestCapabilities=l,e.validateResponseStatus=i;var n=t(1),r=t(34),s=t(8);function l({getResponseHeader:c,isHttp:f,rangeChunkSize:F,disableRange:S}){let d={allowRangeRequests:!1,suggestedLength:void 0},_=parseInt(c("Content-Length"),10);return!Number.isInteger(_)||(d.suggestedLength=_,_<=2*F)||S||!f||c("Accept-Ranges")!=="bytes"||(c("Content-Encoding")||"identity")!=="identity"||(d.allowRangeRequests=!0),d}function m(c){let f=c("Content-Disposition");if(f){let F=(0,r.getFilenameFromContentDispositionHeader)(f);if(F.includes("%"))try{F=decodeURIComponent(F)}catch{}if((0,s.isPdfFile)(F))return F}return null}function u(c,f){return c===404||c===0&&f.startsWith("file:")?new n.MissingPDFException('Missing PDF "'+f+'".'):new n.UnexpectedResponseException(`Unexpected server response (${c}) while retrieving PDF "${f}".`,c)}function i(c){return c===200||c===206}},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getFilenameFromContentDispositionHeader=r;var n=t(1);function r(s){let l=!0,m=u("filename\\*","i").exec(s);if(m){m=m[1];let _=F(m);return _=unescape(_),_=S(_),_=d(_),c(_)}if(m=f(s),m){let _=d(m);return c(_)}if(m=u("filename","i").exec(s),m){m=m[1];let _=F(m);return _=d(_),c(_)}function u(_,T){return new RegExp("(?:^|;)\\s*"+_+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',T)}function i(_,T){if(_){if(!/^[\x00-\xFF]+$/.test(T))return T;try{let R=new TextDecoder(_,{fatal:!0}),E=(0,n.stringToBytes)(T);T=R.decode(E),l=!1}catch{}}return T}function c(_){return l&&/[\x80-\xff]/.test(_)&&(_=i("utf-8",_),l&&(_=i("iso-8859-1",_))),_}function f(_){let T=[],R,E=u("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(R=E.exec(_))!==null;){let[,k,p,g]=R;if(k=parseInt(k,10),k in T){if(k===0)break;continue}T[k]=[p,g]}let P=[];for(let k=0;k<T.length&&k in T;++k){let[p,g]=T[k];g=F(g),p&&(g=unescape(g),k===0&&(g=S(g))),P.push(g)}return P.join("")}function F(_){if(_.startsWith('"')){let T=_.slice(1).split('\\"');for(let R=0;R<T.length;++R){let E=T[R].indexOf('"');E!==-1&&(T[R]=T[R].slice(0,E),T.length=R+1),T[R]=T[R].replace(/\\(.)/g,"$1")}_=T.join('"')}return _}function S(_){let T=_.indexOf("'");if(T===-1)return _;let R=_.slice(0,T),P=_.slice(T+1).replace(/^[^']*'/,"");return i(R,P)}function d(_){return!_.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(_)?_:_.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(T,R,E,P){if(E==="q"||E==="Q")return P=P.replace(/_/g," "),P=P.replace(/=([0-9a-fA-F]{2})/g,function(k,p){return String.fromCharCode(parseInt(p,16))}),i(R,P);try{P=atob(P)}catch{}return i(R,P)})}return""}},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNetworkStream=void 0;var n=t(1),r=t(33);let s=200,l=206;function m(F){let S=F.response;return typeof S!="string"?S:(0,n.stringToBytes)(S).buffer}class u{constructor(S,d={}){this.url=S,this.isHttp=/^https?:/i.test(S),this.httpHeaders=this.isHttp&&d.httpHeaders||Object.create(null),this.withCredentials=d.withCredentials||!1,this.getXhr=d.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(S,d,_){let T={begin:S,end:d};for(let R in _)T[R]=_[R];return this.request(T)}requestFull(S){return this.request(S)}request(S){let d=this.getXhr(),_=this.currXhrId++,T=this.pendingRequests[_]={xhr:d};d.open("GET",this.url),d.withCredentials=this.withCredentials;for(let R in this.httpHeaders){let E=this.httpHeaders[R];typeof E>"u"||d.setRequestHeader(R,E)}return this.isHttp&&"begin"in S&&"end"in S?(d.setRequestHeader("Range",`bytes=${S.begin}-${S.end-1}`),T.expectedStatus=l):T.expectedStatus=s,d.responseType="arraybuffer",S.onError&&(d.onerror=function(R){S.onError(d.status)}),d.onreadystatechange=this.onStateChange.bind(this,_),d.onprogress=this.onProgress.bind(this,_),T.onHeadersReceived=S.onHeadersReceived,T.onDone=S.onDone,T.onError=S.onError,T.onProgress=S.onProgress,d.send(null),_}onProgress(S,d){let _=this.pendingRequests[S];_&&_.onProgress?.(d)}onStateChange(S,d){let _=this.pendingRequests[S];if(!_)return;let T=_.xhr;if(T.readyState>=2&&_.onHeadersReceived&&(_.onHeadersReceived(),delete _.onHeadersReceived),T.readyState!==4||!(S in this.pendingRequests))return;if(delete this.pendingRequests[S],T.status===0&&this.isHttp){_.onError?.(T.status);return}let R=T.status||s;if(!(R===s&&_.expectedStatus===l)&&R!==_.expectedStatus){_.onError?.(T.status);return}let P=m(T);if(R===l){let k=T.getResponseHeader("Content-Range"),p=/bytes (\d+)-(\d+)\/(\d+)/.exec(k);_.onDone({begin:parseInt(p[1],10),chunk:P})}else P?_.onDone({begin:0,chunk:P}):_.onError?.(T.status)}getRequestXhr(S){return this.pendingRequests[S].xhr}isPendingRequest(S){return S in this.pendingRequests}abortRequest(S){let d=this.pendingRequests[S].xhr;delete this.pendingRequests[S],d.abort()}}class i{constructor(S){this._source=S,this._manager=new u(S.url,{httpHeaders:S.httpHeaders,withCredentials:S.withCredentials}),this._rangeChunkSize=S.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(S){let d=this._rangeRequestReaders.indexOf(S);d>=0&&this._rangeRequestReaders.splice(d,1)}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new c(this._manager,this._source),this._fullRequestReader}getRangeReader(S,d){let _=new f(this._manager,S,d);return _.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(_),_}cancelAllRequests(S){this._fullRequestReader?.cancel(S);for(let d of this._rangeRequestReaders.slice(0))d.cancel(S)}}e.PDFNetworkStream=i;class c{constructor(S,d){this._manager=S;let _={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=d.url,this._fullRequestId=S.requestFull(_),this._headersReceivedCapability=(0,n.createPromiseCapability)(),this._disableRange=d.disableRange||!1,this._contentLength=d.length,this._rangeChunkSize=d.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let S=this._fullRequestId,d=this._manager.getRequestXhr(S),_=E=>d.getResponseHeader(E),{allowRangeRequests:T,suggestedLength:R}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:_,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});T&&(this._isRangeSupported=!0),this._contentLength=R||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(_),this._isRangeSupported&&this._manager.abortRequest(S),this._headersReceivedCapability.resolve()}_onDone(S){if(S&&(this._requests.length>0?this._requests.shift().resolve({value:S.chunk,done:!1}):this._cachedChunks.push(S.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(S){this._storedError=(0,r.createResponseStatusError)(S,this._url),this._headersReceivedCapability.reject(this._storedError);for(let d of this._requests)d.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(S){this.onProgress?.({loaded:S.loaded,total:S.lengthComputable?S.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let S=(0,n.createPromiseCapability)();return this._requests.push(S),S.promise}cancel(S){this._done=!0,this._headersReceivedCapability.reject(S);for(let d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class f{constructor(S,d,_){this._manager=S;let T={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=S.url,this._requestId=S.requestRange(d,_,T),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(S){let d=S.chunk;this._requests.length>0?this._requests.shift().resolve({value:d,done:!1}):this._queuedChunk=d,this._done=!0;for(let _ of this._requests)_.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(S){this._storedError=(0,r.createResponseStatusError)(S,this._url);for(let d of this._requests)d.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(S){this.isStreamingSupported||this.onProgress?.({loaded:S.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let d=this._queuedChunk;return this._queuedChunk=null,{value:d,done:!1}}if(this._done)return{value:void 0,done:!0};let S=(0,n.createPromiseCapability)();return this._requests.push(S),S.promise}cancel(S){this._done=!0;for(let d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFFetchStream=void 0;var n=t(1),r=t(33);function s(c,f,F){return{method:"GET",headers:c,signal:F.signal,mode:"cors",credentials:f?"include":"same-origin",redirect:"follow"}}function l(c){let f=new Headers;for(let F in c){let S=c[F];typeof S>"u"||f.append(F,S)}return f}class m{constructor(f){this.source=f,this.isHttp=/^https?:/i.test(f.url),this.httpHeaders=this.isHttp&&f.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new u(this),this._fullRequestReader}getRangeReader(f,F){if(F<=this._progressiveDataLength)return null;let S=new i(this,f,F);return this._rangeRequestReaders.push(S),S}cancelAllRequests(f){this._fullRequestReader&&this._fullRequestReader.cancel(f);for(let F of this._rangeRequestReaders.slice(0))F.cancel(f)}}e.PDFFetchStream=m;class u{constructor(f){this._stream=f,this._reader=null,this._loaded=0,this._filename=null;let F=f.source;this._withCredentials=F.withCredentials||!1,this._contentLength=F.length,this._headersCapability=(0,n.createPromiseCapability)(),this._disableRange=F.disableRange||!1,this._rangeChunkSize=F.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!F.disableStream,this._isRangeSupported=!F.disableRange,this._headers=l(this._stream.httpHeaders);let S=F.url;fetch(S,s(this._headers,this._withCredentials,this._abortController)).then(d=>{if(!(0,r.validateResponseStatus)(d.status))throw(0,r.createResponseStatusError)(d.status,S);this._reader=d.body.getReader(),this._headersCapability.resolve();let _=E=>d.headers.get(E),{allowRangeRequests:T,suggestedLength:R}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:_,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=T,this._contentLength=R||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(_),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new n.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;let{value:f,done:F}=await this._reader.read();return F?{value:f,done:F}:(this._loaded+=f.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){this._reader&&this._reader.cancel(f),this._abortController.abort()}}class i{constructor(f,F,S){this._stream=f,this._reader=null,this._loaded=0;let d=f.source;this._withCredentials=d.withCredentials||!1,this._readCapability=(0,n.createPromiseCapability)(),this._isStreamingSupported=!d.disableStream,this._abortController=new AbortController,this._headers=l(this._stream.httpHeaders),this._headers.append("Range",`bytes=${F}-${S-1}`);let _=d.url;fetch(_,s(this._headers,this._withCredentials,this._abortController)).then(T=>{if(!(0,r.validateResponseStatus)(T.status))throw(0,r.createResponseStatusError)(T.status,_);this._readCapability.resolve(),this._reader=T.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;let{value:f,done:F}=await this._reader.read();return F?{value:f,done:F}:(this._loaded+=f.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){this._reader&&this._reader.cancel(f),this._abortController.abort()}}}],__webpack_module_cache__={};function __w_pdfjs_require__(o){var e=__webpack_module_cache__[o];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[o]={exports:{}};return __webpack_modules__[o](t,t.exports,__w_pdfjs_require__),t.exports}var __webpack_exports__={};return(()=>{var o=__webpack_exports__;Object.defineProperty(o,"__esModule",{value:!0}),Object.defineProperty(o,"AnnotationEditorLayer",{enumerable:!0,get:function(){return r.AnnotationEditorLayer}}),Object.defineProperty(o,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return e.AnnotationEditorParamsType}}),Object.defineProperty(o,"AnnotationEditorType",{enumerable:!0,get:function(){return e.AnnotationEditorType}}),Object.defineProperty(o,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return s.AnnotationEditorUIManager}}),Object.defineProperty(o,"AnnotationLayer",{enumerable:!0,get:function(){return l.AnnotationLayer}}),Object.defineProperty(o,"AnnotationMode",{enumerable:!0,get:function(){return e.AnnotationMode}}),Object.defineProperty(o,"CMapCompressionType",{enumerable:!0,get:function(){return e.CMapCompressionType}}),Object.defineProperty(o,"GlobalWorkerOptions",{enumerable:!0,get:function(){return m.GlobalWorkerOptions}}),Object.defineProperty(o,"InvalidPDFException",{enumerable:!0,get:function(){return e.InvalidPDFException}}),Object.defineProperty(o,"LoopbackPort",{enumerable:!0,get:function(){return t.LoopbackPort}}),Object.defineProperty(o,"MissingPDFException",{enumerable:!0,get:function(){return e.MissingPDFException}}),Object.defineProperty(o,"OPS",{enumerable:!0,get:function(){return e.OPS}}),Object.defineProperty(o,"PDFDataRangeTransport",{enumerable:!0,get:function(){return t.PDFDataRangeTransport}}),Object.defineProperty(o,"PDFDateString",{enumerable:!0,get:function(){return n.PDFDateString}}),Object.defineProperty(o,"PDFWorker",{enumerable:!0,get:function(){return t.PDFWorker}}),Object.defineProperty(o,"PasswordResponses",{enumerable:!0,get:function(){return e.PasswordResponses}}),Object.defineProperty(o,"PermissionFlag",{enumerable:!0,get:function(){return e.PermissionFlag}}),Object.defineProperty(o,"PixelsPerInch",{enumerable:!0,get:function(){return n.PixelsPerInch}}),Object.defineProperty(o,"RenderingCancelledException",{enumerable:!0,get:function(){return n.RenderingCancelledException}}),Object.defineProperty(o,"SVGGraphics",{enumerable:!0,get:function(){return c.SVGGraphics}}),Object.defineProperty(o,"UNSUPPORTED_FEATURES",{enumerable:!0,get:function(){return e.UNSUPPORTED_FEATURES}}),Object.defineProperty(o,"UnexpectedResponseException",{enumerable:!0,get:function(){return e.UnexpectedResponseException}}),Object.defineProperty(o,"Util",{enumerable:!0,get:function(){return e.Util}}),Object.defineProperty(o,"VerbosityLevel",{enumerable:!0,get:function(){return e.VerbosityLevel}}),Object.defineProperty(o,"XfaLayer",{enumerable:!0,get:function(){return f.XfaLayer}}),Object.defineProperty(o,"build",{enumerable:!0,get:function(){return t.build}}),Object.defineProperty(o,"createPromiseCapability",{enumerable:!0,get:function(){return e.createPromiseCapability}}),Object.defineProperty(o,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return e.createValidAbsoluteUrl}}),Object.defineProperty(o,"getDocument",{enumerable:!0,get:function(){return t.getDocument}}),Object.defineProperty(o,"getFilenameFromUrl",{enumerable:!0,get:function(){return n.getFilenameFromUrl}}),Object.defineProperty(o,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return n.getPdfFilenameFromUrl}}),Object.defineProperty(o,"getXfaPageViewport",{enumerable:!0,get:function(){return n.getXfaPageViewport}}),Object.defineProperty(o,"isPdfFile",{enumerable:!0,get:function(){return n.isPdfFile}}),Object.defineProperty(o,"loadScript",{enumerable:!0,get:function(){return n.loadScript}}),Object.defineProperty(o,"renderTextLayer",{enumerable:!0,get:function(){return i.renderTextLayer}}),Object.defineProperty(o,"shadow",{enumerable:!0,get:function(){return e.shadow}}),Object.defineProperty(o,"version",{enumerable:!0,get:function(){return t.version}});var e=__w_pdfjs_require__(1),t=__w_pdfjs_require__(4),n=__w_pdfjs_require__(8),r=__w_pdfjs_require__(22),s=__w_pdfjs_require__(7),l=__w_pdfjs_require__(27),m=__w_pdfjs_require__(15),u=__w_pdfjs_require__(3),i=__w_pdfjs_require__(30),c=__w_pdfjs_require__(31),f=__w_pdfjs_require__(29);let F="2.16.105",S="172ccdbe5";if(u.isNodeJS){let{PDFNodeStream:d}=__w_pdfjs_require__(32);(0,t.setPDFNetworkStreamFactory)(_=>new d(_))}else{let{PDFNetworkStream:d}=__w_pdfjs_require__(35),{PDFFetchStream:_}=__w_pdfjs_require__(36);(0,t.setPDFNetworkStreamFactory)(T=>(0,n.isValidFetchUrl)(T.url)?new _(T):new d(T))}})(),__webpack_exports__})())});function on(o,e,t){return typeof o===e||o instanceof t}function Se(o){return on(o,"function",Function)}function he(o){return on(o,"string",String)}function xt(o){return on(o,"boolean",Boolean)}function Le(o){return on(o,"number",Number)}function et(o){return X(o)&&on(o,"object",Object)}function tt(o){return o instanceof Array}function Be(o,e){throw new Error((e||"Unexpected object: ")+o)}function ce(o){return o==null}function X(o){return!ce(o)}function qr(o){return o instanceof Uint8Array||o instanceof Uint8ClampedArray||o instanceof Int8Array||o instanceof Uint16Array||o instanceof Int16Array||o instanceof Uint32Array||o instanceof Int32Array||o instanceof Float32Array||o instanceof Float64Array||"BigUint64Array"in globalThis&&o instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&o instanceof globalThis.BigInt64Array}function $r(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function be(o){return o.splice(0)}function In(o,e){for(let t=0;t<o.length;++t)if(o[t]!==e[t])return t;return-1}function nt(o,e){let t=o.indexOf(e);return t>-1?(Zo(o,t),!0):!1}function Zo(o,e){return o.splice(e,1)[0]}function Wa(o,e,t){let n=o?0:e.length-1,r=o?e.length:-1,s=o?1:-1;for(let l of t)for(let m=n;m!=r;m+=s){let u=e[m];if(l(u))return u}return null}function Ft(o,...e){return Wa(!0,o,e)}var Vt=class{constructor(){this.listeners=new Map,this.listenerOptions=new Map,this.bubblers=new Set,this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addScopedEventListener(e,t,n,r){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([t,n]),this.addEventListener(t,n,r)}removeScope(e){let t=this.scopes.get(e);if(t){this.scopes.delete(e);for(let[n,r]of t)this.removeEventListener(n,r)}}addEventListener(e,t,n){let r=this.listeners.get(e);r||(r=new Array,this.listeners.set(e,r)),r.find(s=>s===t)||(r.push(t),n&&this.listenerOptions.set(t,n))}removeEventListener(e,t){let n=this.listeners.get(e);n&&this.removeListener(n,t)}clearEventListeners(e){for(let[t,n]of this.listeners)if(ce(e)||e===t){for(let r of n)this.removeEventListener(e,r);be(n),this.listeners.delete(t)}}removeListener(e,t){let n=e.findIndex(r=>r===t);n>=0&&(Zo(e,n),this.listenerOptions.has(t)&&this.listenerOptions.delete(t))}dispatchEvent(e){let t=this.listeners.get(e.type);if(t)for(let n of t){let r=this.listenerOptions.get(n);X(r)&&!xt(r)&&r.once&&this.removeListener(t,n),Se(n)?n.call(this,e):n.handleEvent(e)}if(e.defaultPrevented)return!1;for(let n of this.bubblers)if(!n.dispatchEvent(e))return!1;return!0}};var Ie=class extends Event{get type(){return super.type}constructor(e,t){super(e,t)}},xe=class extends Vt{addBubbler(e){super.addBubbler(e)}removeBubbler(e){super.removeBubbler(e)}addScopedEventListener(e,t,n,r){super.addScopedEventListener(e,t,n,r)}addEventListener(e,t,n){super.addEventListener(e,t,n)}removeEventListener(e,t){super.removeEventListener(e,t)}clearEventListeners(e){return super.clearEventListeners(e)}};var Nt=class extends Ie{constructor(e,t){super(e),this.app=t}},er=class extends Nt{constructor(e,t){super("joinroom",e),this.roomName=t}},tr=class extends Nt{constructor(e){super("quit",e)}},nr=class extends Nt{constructor(e){super("shown",e)}},or=class extends Nt{constructor(e){super("hidden",e)}},On=class extends xe{constructor(e){super(),this.env=e,this.dataLogger=null}quit(){this.dispatchEvent(new tr(this))}join(e){this.dispatchEvent(new er(this,e)),this.env.avatar.reset()}async show(e){await this.showing(e),this.dispatchEvent(new nr(this))}hide(){this.hiding(),this.dispatchEvent(new or(this))}init(e){return this.dataLogger=e.get("dataLogger"),Promise.resolve()}log(e,t){X(this.dataLogger)&&this.dataLogger.log(e,t)}error(e,t,n){X(this.dataLogger)&&this.dataLogger.error(e,t,n)}onError(e,t){return this.error.bind(this,e,t)}};var Ht=class extends Error{constructor(e,t=null){super(e),this.innerError=t}};var Kr=/([^\/]+)\/(.+)/,Va=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/;var jt=class o{constructor(e,t,n){this._type=e,this._fullSubType=t,this._primaryExtension=null,this.depMessage=null;let r=new Map;this._parameters=r;let s=this._fullSubType.match(Va);this._tree=s[1],this._subType=s[2],this._suffix=s[3];let l=s[4];if(this._value=this._fullValue=this._type+"/",X(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,X(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),X(l)){let m=l.split(";").map(u=>u.trim()).filter(u=>u.length>0).map(u=>u.split("="));for(let[u,...i]of m){let c=i.join("=");r.set(u,c);let f=`; ${u}=${c}`;this._fullValue+=f,u!=="q"&&(this._value+=f)}}this._extensions=n||[],this._primaryExtension=this._extensions[0]||null}static parse(e){if(!e)return null;let t=e.match(Kr);if(!t)return null;let n=t[1],r=t[2];return new o(n,r)}deprecate(e){return this.depMessage=e,this}check(){X(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(e){if(ce(e))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let t=null,n=null;if(he(e)){let r=e.match(Kr);if(!r)return!1;t=r[1],n=r[2]}else t=e.typeName,n=e._fullSubType;return this.typeName===t&&(this._fullSubType==="*"||this._fullSubType===n)}withParameter(e,t){let n=`${this._fullSubType}; ${e}=${t}`;return new o(this.typeName,n,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}toFileSystemAPIAccepts(){return{[this.value]:this.extensions.map(e=>"."+e)}}addExtension(e){if(!e)throw new Error("File name is not defined");return this.primaryExtension&&(e=o.removeExtension(e),e=`${e}.${this.primaryExtension}`),e}static removeExtension(e){let t=e.lastIndexOf(".");return t>-1&&(e=e.substring(0,t)),e}};function Na(o,e,...t){return new jt(o,e,t)}function ye(o){return Na.bind(null,o)}var rn=ye("application");var wt=rn("javascript","js");var rr=rn("json","json");var ir=rn("json; charset=UTF-8","json");var Jr=rn("pdf","pdf");var sr=rn("wasm","wasm");var Ha=ye("image");var ar=Ha("jpeg","jpeg","jpg","jpe");var Yr=ye("model");var Qr=Yr("gltf-binary","glb"),Zr=Yr("gltf+json","gltf");var cr=ye("text");var sn=cr("css","css");var Wn=cr("plain","txt","text","conf","def","list","log","in");var ei=cr("xml");function ti(o){if(o.status>=400)throw new Error("Resource could not be retrieved: "+o.requestPath);return o}function ke(o){let{content:e}=ti(o);return e}function lr(o){return X(o)&&Se(o.then)&&Se(o.catch)&&Se(o.finally)&&Se(o.fetch)&&Se(o.getSize)}var an=class{get result(){if(X(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}constructor(e,t){this.path=e,this.type=t,this._result=null,this._error=null,this._started=!1,this._finished=!1,this.resolve=null,this.reject=null,this.promise=new Promise((n,r)=>{this.resolve=s=>{this._result=s,this._finished=!0,n(s)},this.reject=s=>{this._error=s,this._finished=!0,r(s)}})}async getSize(e){try{let{contentLength:t}=await e.head(this.path).accept(this.type).exec();return[this,t||1]}catch(t){return console.warn(t),[this,1]}}async fetch(e,t){try{let n=await this.getResult(e,t);this.resolve(n)}catch(n){this.reject(n)}}get[Symbol.toStringTag](){return this.promise.toString()}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}};var Vn=class extends an{constructor(e,t,n){let r;xt(t)?n=t:r=t,super(e,r),this.useCache=!!n}getResult(e,t){return this.getRequest(e,t).then(ke)}getRequest(e,t){let n=e.get(this.path).useCache(this.useCache).progress(t);return this.getResponse(n)}};var ct=class extends xe{constructor(){super(...arguments),this.attached=new Array,this.soFar=null,this.total=null,this.msg=null,this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(e,t,n,r){this.soFar=e,this.total=t,this.msg=n,this.est=r;for(let s of this.attached)s.report(e,t,n,r)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(e){this.report(0,1,e||"starting")}end(e){this.report(1,1,e||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,be(this.attached)}};var cn=class extends ct{constructor(e,t){super(),this.i=e,this.prog=t}report(e,t,n,r){super.report(e,t,n,r),this.prog.update(this.i,e,t,n)}};var Nn=class{constructor(e){this.prog=e,this.weightTotal=0,this.subProgressCallbacks=new Array,this.subProgressWeights=new Array,this.subProgressValues=new Array,this.start=performance.now();for(let t=0;t<this.subProgressWeights.length;++t)this.subProgressValues[t]=0,this.subProgressCallbacks[t]=new cn(t,this)}addSubProgress(e){e=e||1,this.weightTotal+=e,this.subProgressWeights.push(e),this.subProgressValues.push(0);let t=new cn(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(t),t}update(e,t,n,r){if(this.prog){this.subProgressValues[e]=t/n;let s=0;for(let i=0;i<this.subProgressWeights.length;++i)s+=this.subProgressValues[i]*this.subProgressWeights[i];let l=performance.now(),m=l-this.start,u=this.start-l+m*this.weightTotal/s;this.prog.report(s,this.weightTotal,r,u)}}};function Je(o,e){return new ur(e,o).subProgressCallbacks}function ni(o,e){let t=new Array(e);for(let n=0;n<e;++n)t[n]=1;return Je(o,t)}var ur=class extends Nn{constructor(e,t){super(t);for(let n of e)this.addSubProgress(n)}};var Oe=class{constructor(e){if(this.items=new Map,this.defaultItems=new Array,X(e))for(let[t,n]of e)this.add(t,n)}add(e,...t){for(let n of t)if(ce(e))this.defaultItems.push(n);else{let r=this.items.get(e);ce(r)&&this.items.set(e,r=[]),r.push(n)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let e of this.defaultItems)yield e;for(let e of this.items.values())for(let t of e)yield t}has(e){return X(e)?this.items.has(e):this.defaultItems.length>0}get(e){return ce(e)?this.defaultItems:this.items.get(e)||[]}count(e){if(ce(e))return this.defaultItems.length;let t=this.get(e);return X(t)?t.length:0}get size(){let e=this.defaultItems.length;for(let t of this.items.values())e+=t.length;return e}delete(e){return ce(e)?be(this.defaultItems).length>0:this.items.delete(e)}remove(e,t){if(ce(e))nt(this.defaultItems,t);else{let n=this.items.get(e);X(n)&&(nt(n,t),n.length===0&&this.items.delete(e))}}clear(){this.items.clear(),be(this.defaultItems)}};var lt=class{constructor(e){if(this.items=new Map,X(e))for(let[t,n,r]of e)this.add(t,n,r)}add(e,t,n){let r=this.items.get(e);return ce(r)&&this.items.set(e,r=new Map),r.set(t,n),this}*entries(){for(let[e,t]of this.items)for(let[n,r]of t)yield[e,n,r]}keys(e){return ce(e)?this.items.keys():this.items.get(e).keys()}*values(){for(let e of this.items.values())for(let t of e.values())yield t}has(e,t){return this.items.has(e)&&(ce(t)||this.items.get(e).has(t))}get(e,t){return ce(t)?this.items.get(e):this.items.has(e)?this.items.get(e).get(t):null}count(e){return this.items.has(e)?this.items.get(e).size:null}get size(){let e=0;for(let t of this.items.values())e+=t.size;return e}delete(e,t){if(ce(t))return this.items.delete(e);if(this.items.has(e)){let n=this.items.get(e),r=n.delete(t);return n.size===0&&this.items.delete(e),r}else return!1}clear(){this.items.clear()}};var Pe=class{constructor(e=!0){this.autoStart=e,this.onThens=new Array,this.onCatches=new Array,this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",this.resolve=t=>{if(this.running){this._result=t,this._resultState="resolved";for(let n of this.onThens)n(t);this.clear(),this._executionState="finished"}},this.reject=t=>{if(this.running){this._error=t,this._resultState="errored";for(let n of this.onCatches)n(t);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){be(this.onThens),be(this.onCatches)}start(){this._executionState="running"}resolver(e){return()=>this.resolve(e)}resolveOn(e,t,n){let r=this.resolver(n);e.addEventListener(t,r),this.finally(()=>e.removeEventListener(t,r))}get result(){if(X(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((e,t)=>{this.finished?this.errored?t(this.error):e(this.result):(this.onThens.push(e),this.onCatches.push(t))})}then(e,t){return this.project().then(e,t)}catch(e){return this.project().catch(e)}finally(e){return this.project().finally(e)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(e){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",e&&this.start()}};function ln(o){return o}function oi(){return!0}function ri(){return!1}function ii(o,e){return"on"+e in o}function qe(o,e,t,...n){ce(n)&&(n=[]);let r;if(he(t)?n.unshift(t):Le(t)&&(r=t),!(o instanceof Vt)){if(!ii(o,e))throw new Error(`Target does not have a ${e} rejection event`);for(let u of n)if(!ii(o,u))throw new Error(`Target does not have a ${u} rejection event`)}let s=new Pe;if(Le(r)){let u=setTimeout(s.reject,r,`'${e}' has timed out.`);s.finally(clearTimeout.bind(globalThis,u))}let l=(u,i)=>{o.addEventListener(u,i),s.finally(()=>o.removeEventListener(u,i))};l(e,u=>s.resolve(u));let m=u=>s.reject(u);for(let u of n)l(u,m);return s}function ut(o){return o.then(oi).catch(ri)}function pr(o,...e){if(!et(o))return!1;o=o;for(let t of e){if(!(t in o))return!1;let n=o[t];if(!Se(n))return!1}return!0}function ja(o){return pr(o,"dispose")}function Xa(o){return pr(o,"destroy")}function Ua(o){return pr(o,"close")}function Ne(o){ja(o)&&o.dispose(),Ua(o)&&o.close(),Xa(o)&&o.destroy()}function si(o,e){try{return e(o)}finally{Ne(o)}}var Ga="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function un(o,e){if(o<0)throw new Error("Length must be greater than 0");ce(e)&&(e=Ga);let t="";for(let n=0;n<o;++n){let r=Math.floor(Math.random()*e.length);t+=e[r]}return t}var ai=new Map,Hn=class{constructor(e,t,n,...r){this.key=e,this.value=t,this.bySetAttribute=n,this.tags=r.map(s=>s.toLocaleUpperCase()),Object.freeze(this)}applyToElement(e){if(this.tags.length>0&&this.tags.indexOf(e.tagName)===-1){let t=ai.get(e.tagName);t||ai.set(e.tagName,t=new Set),t.has(this.key)||(t.add(this.key),console.warn(`Element ${e.tagName} does not support Attribute ${this.key}`))}this.bySetAttribute?e.setAttribute(this.key,this.value.toString()):this.key in e?e[this.key]=this.value:this.value===!1?e.removeAttribute(this.key):this.value===!0?e.setAttribute(this.key,""):Se(this.value)?this.value(e):e.setAttribute(this.key,this.value.toString())}};function pn(o,e,t,...n){return new Hn(o,e,t,...n)}function ci(o){return o instanceof Hn}function li(o){return pn("height",o,!1,"canvas","embed","iframe","img","input","object","video")}function dr(o){return pn("rel",o,!1,"a","area","link")}function za(o){return o instanceof URL&&(o=o.href),o}function ui(o){return pn("src",za(o),!1,"audio","embed","iframe","img","input","script","source","track","video")}function jn(o){return he(o)||(o=o.value),pn("type",o,!1,"button","input","command","embed","link","object","script","source","style","menu")}function pi(o){return pn("width",o,!1,"canvas","embed","iframe","img","input","object","video")}function di(o){return`${o}px`}function Xn(...o){return`rgb(${o.join(", ")})`}function hi(o){return et(o)?o.element instanceof Element:!1}function hr(o){return hi(o)?o.element:he(o)?fi(o):o}function qa(o){return et(o)&&"applyToElement"in o&&Se(o.applyToElement)}function mi(o,e,t=""){o=hr(o),e?(o.style.removeProperty("display"),getComputedStyle(o).display==="none"&&(o.style.display=t||"block")):o.style.display="none"}function gi(o){return o=hr(o),o.style.display!=="none"}function $a(o,...e){let t=o instanceof Element||o instanceof ShadowRoot?o:he(o)?document.querySelector(o):o.element,n=t instanceof HTMLTemplateElement?t.content:t;for(let r of e)X(r)&&(r instanceof Node?n.appendChild(r):hi(r)?n.appendChild(hr(r)):qa(r)?t instanceof ShadowRoot||r.applyToElement(t):n.appendChild(document.createTextNode(r.toLocaleString())));return t}function fi(o){return document.querySelector(o)}function xi(o){return fi(o)}function Un(o,...e){let t=null,n=e.filter(ci).filter(r=>r.key==="id"||r.key==="query");for(let r of n)r.key==="query"?(t=r.value,nt(e,r)):r.key==="id"&&(t=document.getElementById(r.value),t&&nt(e,r));return t&&t.tagName!==o.toUpperCase()&&console.warn(`Expected a "${o.toUpperCase()}" element but found a "${t.tagName}".`),t||(t=document.createElement(o)),$a(t,...e),t}function Fi(...o){return Un("canvas",...o)}function Gn(...o){return Un("img",...o)}function wi(...o){return Un("link",...o)}function _i(...o){return Un("script",...o)}var dn="HTMLCanvasElement"in globalThis,Ud="HTMLImageElement"in globalThis,mr=!1,Dt=!mr&&"OffscreenCanvas"in globalThis,Ka=!mr&&"createImageBitmap"in globalThis;function zn(o){return dn&&o instanceof HTMLCanvasElement}function qn(o){return Dt&&o instanceof OffscreenCanvas}function $n(o){return Ka&&o instanceof ImageBitmap}function Si(o){return o instanceof ImageData}function Ja(o){return zn(o)||qn(o)}function Ai(o,e){let t=o.getContext("2d");if(ce(t))throw new Error("Could not create 2d context for canvas");t.drawImage(e,0,0)}function ki(o,e){let t=o.getContext("2d");if(ce(t))throw new Error("Could not create 2d context for canvas");t.putImageData(e,0,0)}function Ya(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var gr=Dt&&Ya(),Mt=gr&&hn||dn&&Ct||null,Ti=dn?Ct:Mt;function Qa(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var Gd=Dt&&Qa();function hn(o,e){return new OffscreenCanvas(o,e)}function Ct(o,e){return Fi(pi(o),li(e))}function Za(o){let e=hn(o.width,o.height);return Ai(e,o),e}function ec(o){let e=Ct(o.width,o.height);return Ai(e,o),e}var bi=gr&&Za||dn&&ec||null;function tc(o){let e=hn(o.width,o.height);return ki(e,o),e}function nc(o){let e=Ct(o.width,o.height);return ki(e,o),e}var vi=gr&&tc||dn&&nc||null;function Kn(o,e){let t=o.getContext("2d");if(ce(t))throw new Error("Could not create 2d context for canvas");t.drawImage(e,0,0)}function Jn(o){let e=Ct(o.width,o.height);return Kn(e,o),e}async function Xt(o){let e=Gn(ui(o));return await qe(e,"load","error"),e}function yi(o,e,t,n=1){return e=Math.floor(e*n),t=Math.floor(t*n),o.width!=e||o.height!=t?(o.width=e,o.height=t,!0):!1}function oc(o){return X(o.textBaseline)}function rc(o,e,t,n=1){let r=o.imageSmoothingEnabled,s=o.textBaseline,l=o.textAlign,m=o.font,u=yi(o.canvas,e,t,n);return u&&(o.imageSmoothingEnabled=r,o.textBaseline=s,o.textAlign=l,o.font=m),u}function mn(o,e,t,n=1){return oc(o)?rc(o,e,t,n):yi(o.canvas,e,t,n)}function fr(o,e,t){if(e instanceof jt&&(e=e.value),qn(o))return o.convertToBlob({type:e,quality:t});if(zn(o)){let n=new Pe;return o.toBlob(n.resolve,e,t),n}else throw new Error("Cannot save image from canvas")}function Lt(o){Ja(o)?o.width=o.height=0:Ne(o)}var gn=class extends Ht{constructor(){super("Cancellation!")}},pt=class{constructor(){this._cancelled=!1}get cancelled(){return this._cancelled}check(){if(this.cancelled)throw new gn}cancel(){this._cancelled=!0}};var Yn=class extends xe{constructor(){super(),this.event=new Ie("quitting");let e=()=>this.dispatchEvent(this.event);window.addEventListener("beforeunload",e),window.addEventListener("unload",e),window.addEventListener("pagehide",e)}};function ot(...o){return Promise.all(o)}var Bt=1e-6,rt=typeof Float32Array<"u"?Float32Array:Array,fn=Math.random;var Qd=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var o=0,e=arguments.length;e--;)o+=arguments[e]*arguments[e];return Math.sqrt(o)});var Ye={};zr(Ye,{add:()=>lc,angle:()=>Cc,bezier:()=>kc,ceil:()=>uc,clone:()=>ic,copy:()=>ac,create:()=>Di,cross:()=>_c,dist:()=>Vc,distance:()=>Pi,div:()=>Wc,divide:()=>Bi,dot:()=>Oi,equals:()=>Rc,exactEquals:()=>Pc,floor:()=>pc,forEach:()=>Xc,fromValues:()=>sc,hermite:()=>Ac,inverse:()=>Fc,len:()=>Hc,length:()=>Mi,lerp:()=>Sc,max:()=>hc,min:()=>dc,mul:()=>Oc,multiply:()=>Li,negate:()=>xc,normalize:()=>wc,random:()=>Tc,rotateX:()=>Ec,rotateY:()=>Dc,rotateZ:()=>Mc,round:()=>mc,scale:()=>gc,scaleAndAdd:()=>fc,set:()=>cc,sqrDist:()=>Nc,sqrLen:()=>jc,squaredDistance:()=>Ri,squaredLength:()=>Ii,str:()=>Bc,sub:()=>Ic,subtract:()=>Ci,transformMat3:()=>vc,transformMat4:()=>bc,transformQuat:()=>yc,zero:()=>Lc});function Di(){var o=new rt(3);return rt!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function ic(o){var e=new rt(3);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e}function Mi(o){var e=o[0],t=o[1],n=o[2];return Math.hypot(e,t,n)}function sc(o,e,t){var n=new rt(3);return n[0]=o,n[1]=e,n[2]=t,n}function ac(o,e){return o[0]=e[0],o[1]=e[1],o[2]=e[2],o}function cc(o,e,t,n){return o[0]=e,o[1]=t,o[2]=n,o}function lc(o,e,t){return o[0]=e[0]+t[0],o[1]=e[1]+t[1],o[2]=e[2]+t[2],o}function Ci(o,e,t){return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],o}function Li(o,e,t){return o[0]=e[0]*t[0],o[1]=e[1]*t[1],o[2]=e[2]*t[2],o}function Bi(o,e,t){return o[0]=e[0]/t[0],o[1]=e[1]/t[1],o[2]=e[2]/t[2],o}function uc(o,e){return o[0]=Math.ceil(e[0]),o[1]=Math.ceil(e[1]),o[2]=Math.ceil(e[2]),o}function pc(o,e){return o[0]=Math.floor(e[0]),o[1]=Math.floor(e[1]),o[2]=Math.floor(e[2]),o}function dc(o,e,t){return o[0]=Math.min(e[0],t[0]),o[1]=Math.min(e[1],t[1]),o[2]=Math.min(e[2],t[2]),o}function hc(o,e,t){return o[0]=Math.max(e[0],t[0]),o[1]=Math.max(e[1],t[1]),o[2]=Math.max(e[2],t[2]),o}function mc(o,e){return o[0]=Math.round(e[0]),o[1]=Math.round(e[1]),o[2]=Math.round(e[2]),o}function gc(o,e,t){return o[0]=e[0]*t,o[1]=e[1]*t,o[2]=e[2]*t,o}function fc(o,e,t,n){return o[0]=e[0]+t[0]*n,o[1]=e[1]+t[1]*n,o[2]=e[2]+t[2]*n,o}function Pi(o,e){var t=e[0]-o[0],n=e[1]-o[1],r=e[2]-o[2];return Math.hypot(t,n,r)}function Ri(o,e){var t=e[0]-o[0],n=e[1]-o[1],r=e[2]-o[2];return t*t+n*n+r*r}function Ii(o){var e=o[0],t=o[1],n=o[2];return e*e+t*t+n*n}function xc(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o}function Fc(o,e){return o[0]=1/e[0],o[1]=1/e[1],o[2]=1/e[2],o}function wc(o,e){var t=e[0],n=e[1],r=e[2],s=t*t+n*n+r*r;return s>0&&(s=1/Math.sqrt(s)),o[0]=e[0]*s,o[1]=e[1]*s,o[2]=e[2]*s,o}function Oi(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]}function _c(o,e,t){var n=e[0],r=e[1],s=e[2],l=t[0],m=t[1],u=t[2];return o[0]=r*u-s*m,o[1]=s*l-n*u,o[2]=n*m-r*l,o}function Sc(o,e,t,n){var r=e[0],s=e[1],l=e[2];return o[0]=r+n*(t[0]-r),o[1]=s+n*(t[1]-s),o[2]=l+n*(t[2]-l),o}function Ac(o,e,t,n,r,s){var l=s*s,m=l*(2*s-3)+1,u=l*(s-2)+s,i=l*(s-1),c=l*(3-2*s);return o[0]=e[0]*m+t[0]*u+n[0]*i+r[0]*c,o[1]=e[1]*m+t[1]*u+n[1]*i+r[1]*c,o[2]=e[2]*m+t[2]*u+n[2]*i+r[2]*c,o}function kc(o,e,t,n,r,s){var l=1-s,m=l*l,u=s*s,i=m*l,c=3*s*m,f=3*u*l,F=u*s;return o[0]=e[0]*i+t[0]*c+n[0]*f+r[0]*F,o[1]=e[1]*i+t[1]*c+n[1]*f+r[1]*F,o[2]=e[2]*i+t[2]*c+n[2]*f+r[2]*F,o}function Tc(o,e){e=e||1;var t=fn()*2*Math.PI,n=fn()*2-1,r=Math.sqrt(1-n*n)*e;return o[0]=Math.cos(t)*r,o[1]=Math.sin(t)*r,o[2]=n*e,o}function bc(o,e,t){var n=e[0],r=e[1],s=e[2],l=t[3]*n+t[7]*r+t[11]*s+t[15];return l=l||1,o[0]=(t[0]*n+t[4]*r+t[8]*s+t[12])/l,o[1]=(t[1]*n+t[5]*r+t[9]*s+t[13])/l,o[2]=(t[2]*n+t[6]*r+t[10]*s+t[14])/l,o}function vc(o,e,t){var n=e[0],r=e[1],s=e[2];return o[0]=n*t[0]+r*t[3]+s*t[6],o[1]=n*t[1]+r*t[4]+s*t[7],o[2]=n*t[2]+r*t[5]+s*t[8],o}function yc(o,e,t){var n=t[0],r=t[1],s=t[2],l=t[3],m=e[0],u=e[1],i=e[2],c=r*i-s*u,f=s*m-n*i,F=n*u-r*m,S=r*F-s*f,d=s*c-n*F,_=n*f-r*c,T=l*2;return c*=T,f*=T,F*=T,S*=2,d*=2,_*=2,o[0]=m+c+S,o[1]=u+f+d,o[2]=i+F+_,o}function Ec(o,e,t,n){var r=[],s=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],s[0]=r[0],s[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),s[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),o[0]=s[0]+t[0],o[1]=s[1]+t[1],o[2]=s[2]+t[2],o}function Dc(o,e,t,n){var r=[],s=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],s[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),s[1]=r[1],s[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),o[0]=s[0]+t[0],o[1]=s[1]+t[1],o[2]=s[2]+t[2],o}function Mc(o,e,t,n){var r=[],s=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],s[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),s[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),s[2]=r[2],o[0]=s[0]+t[0],o[1]=s[1]+t[1],o[2]=s[2]+t[2],o}function Cc(o,e){var t=o[0],n=o[1],r=o[2],s=e[0],l=e[1],m=e[2],u=Math.sqrt(t*t+n*n+r*r),i=Math.sqrt(s*s+l*l+m*m),c=u*i,f=c&&Oi(o,e)/c;return Math.acos(Math.min(Math.max(f,-1),1))}function Lc(o){return o[0]=0,o[1]=0,o[2]=0,o}function Bc(o){return"vec3("+o[0]+", "+o[1]+", "+o[2]+")"}function Pc(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]}function Rc(o,e){var t=o[0],n=o[1],r=o[2],s=e[0],l=e[1],m=e[2];return Math.abs(t-s)<=Bt*Math.max(1,Math.abs(t),Math.abs(s))&&Math.abs(n-l)<=Bt*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-m)<=Bt*Math.max(1,Math.abs(r),Math.abs(m))}var Ic=Ci,Oc=Li,Wc=Bi,Vc=Pi,Nc=Ri,Hc=Mi,jc=Ii,Xc=function(){var o=Di();return function(e,t,n,r,s,l){var m,u;for(t||(t=3),n||(n=0),r?u=Math.min(r*t+n,e.length):u=e.length,m=n;m<u;m+=t)o[0]=e[m],o[1]=e[m+1],o[2]=e[m+2],s(o,o,l),e[m]=o[0],e[m+1]=o[1],e[m+2]=o[2];return e}}();var _t={};zr(_t,{add:()=>$c,angle:()=>ml,ceil:()=>Kc,clone:()=>Uc,copy:()=>zc,create:()=>Wi,cross:()=>sl,dist:()=>kl,distance:()=>ji,div:()=>Al,divide:()=>Hi,dot:()=>il,equals:()=>Fl,exactEquals:()=>xl,floor:()=>Jc,forEach:()=>vl,fromValues:()=>Gc,inverse:()=>ol,len:()=>wl,length:()=>Ui,lerp:()=>al,max:()=>Qc,min:()=>Yc,mul:()=>Sl,multiply:()=>Ni,negate:()=>nl,normalize:()=>rl,random:()=>cl,rotate:()=>hl,round:()=>Zc,scale:()=>el,scaleAndAdd:()=>tl,set:()=>qc,sqrDist:()=>Tl,sqrLen:()=>bl,squaredDistance:()=>Xi,squaredLength:()=>Gi,str:()=>fl,sub:()=>_l,subtract:()=>Vi,transformMat2:()=>ll,transformMat2d:()=>ul,transformMat3:()=>pl,transformMat4:()=>dl,zero:()=>gl});function Wi(){var o=new rt(2);return rt!=Float32Array&&(o[0]=0,o[1]=0),o}function Uc(o){var e=new rt(2);return e[0]=o[0],e[1]=o[1],e}function Gc(o,e){var t=new rt(2);return t[0]=o,t[1]=e,t}function zc(o,e){return o[0]=e[0],o[1]=e[1],o}function qc(o,e,t){return o[0]=e,o[1]=t,o}function $c(o,e,t){return o[0]=e[0]+t[0],o[1]=e[1]+t[1],o}function Vi(o,e,t){return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o}function Ni(o,e,t){return o[0]=e[0]*t[0],o[1]=e[1]*t[1],o}function Hi(o,e,t){return o[0]=e[0]/t[0],o[1]=e[1]/t[1],o}function Kc(o,e){return o[0]=Math.ceil(e[0]),o[1]=Math.ceil(e[1]),o}function Jc(o,e){return o[0]=Math.floor(e[0]),o[1]=Math.floor(e[1]),o}function Yc(o,e,t){return o[0]=Math.min(e[0],t[0]),o[1]=Math.min(e[1],t[1]),o}function Qc(o,e,t){return o[0]=Math.max(e[0],t[0]),o[1]=Math.max(e[1],t[1]),o}function Zc(o,e){return o[0]=Math.round(e[0]),o[1]=Math.round(e[1]),o}function el(o,e,t){return o[0]=e[0]*t,o[1]=e[1]*t,o}function tl(o,e,t,n){return o[0]=e[0]+t[0]*n,o[1]=e[1]+t[1]*n,o}function ji(o,e){var t=e[0]-o[0],n=e[1]-o[1];return Math.hypot(t,n)}function Xi(o,e){var t=e[0]-o[0],n=e[1]-o[1];return t*t+n*n}function Ui(o){var e=o[0],t=o[1];return Math.hypot(e,t)}function Gi(o){var e=o[0],t=o[1];return e*e+t*t}function nl(o,e){return o[0]=-e[0],o[1]=-e[1],o}function ol(o,e){return o[0]=1/e[0],o[1]=1/e[1],o}function rl(o,e){var t=e[0],n=e[1],r=t*t+n*n;return r>0&&(r=1/Math.sqrt(r)),o[0]=e[0]*r,o[1]=e[1]*r,o}function il(o,e){return o[0]*e[0]+o[1]*e[1]}function sl(o,e,t){var n=e[0]*t[1]-e[1]*t[0];return o[0]=o[1]=0,o[2]=n,o}function al(o,e,t,n){var r=e[0],s=e[1];return o[0]=r+n*(t[0]-r),o[1]=s+n*(t[1]-s),o}function cl(o,e){e=e||1;var t=fn()*2*Math.PI;return o[0]=Math.cos(t)*e,o[1]=Math.sin(t)*e,o}function ll(o,e,t){var n=e[0],r=e[1];return o[0]=t[0]*n+t[2]*r,o[1]=t[1]*n+t[3]*r,o}function ul(o,e,t){var n=e[0],r=e[1];return o[0]=t[0]*n+t[2]*r+t[4],o[1]=t[1]*n+t[3]*r+t[5],o}function pl(o,e,t){var n=e[0],r=e[1];return o[0]=t[0]*n+t[3]*r+t[6],o[1]=t[1]*n+t[4]*r+t[7],o}function dl(o,e,t){var n=e[0],r=e[1];return o[0]=t[0]*n+t[4]*r+t[12],o[1]=t[1]*n+t[5]*r+t[13],o}function hl(o,e,t,n){var r=e[0]-t[0],s=e[1]-t[1],l=Math.sin(n),m=Math.cos(n);return o[0]=r*m-s*l+t[0],o[1]=r*l+s*m+t[1],o}function ml(o,e){var t=o[0],n=o[1],r=e[0],s=e[1],l=Math.sqrt(t*t+n*n)*Math.sqrt(r*r+s*s),m=l&&(t*r+n*s)/l;return Math.acos(Math.min(Math.max(m,-1),1))}function gl(o){return o[0]=0,o[1]=0,o}function fl(o){return"vec2("+o[0]+", "+o[1]+")"}function xl(o,e){return o[0]===e[0]&&o[1]===e[1]}function Fl(o,e){var t=o[0],n=o[1],r=e[0],s=e[1];return Math.abs(t-r)<=Bt*Math.max(1,Math.abs(t),Math.abs(r))&&Math.abs(n-s)<=Bt*Math.max(1,Math.abs(n),Math.abs(s))}var wl=Ui,_l=Vi,Sl=Ni,Al=Hi,kl=ji,Tl=Xi,bl=Gi,vl=function(){var o=Wi();return function(e,t,n,r,s,l){var m,u;for(t||(t=2),n||(n=0),r?u=Math.min(r*t+n,e.length):u=e.length,m=n;m<u;m+=t)o[0]=e[m],o[1]=e[m+1],s(o,o,l),e[m]=o[0],e[m+1]=o[1];return e}}();var dt=Math.PI,St=.5*dt,zi=2*dt;var El=864e13,th=-El;function At(o,e,t){return Math.min(t,Math.max(e,o))}function ht(o){return o*zi/360}function Ee(o){return o*360/zi}function Qn(o,e,t){let n=t-e;return n===0?0:(o-e)/n}var Dl=298.257223563,qi=6378137,Ml=.9996,Cl=5e5,Zn=1/Dl,eo=1-Zn,me=Zn/(2-Zn),Ll=qi/(1+me)*(1+me*me/4+me*me*me*me/64),xn=Math.sqrt(1-eo*eo),$e=1-eo*eo,Bl=xn*xn/(1-xn*xn),Pl=1-$e*(.25+$e*(3/64+5*$e/256)),Rl=$e*(3/8+$e*(3/32+45*$e/1024)),Il=$e*$e*(15/256+$e*45/1024),Ol=$e*$e*$e*(35/3072),Wl=[me/2-2*me*me/3+37*me*me*me/96,me*me/48+me*me*me/15,17*me*me*me/480],Vl=[2*me-2*me*me/3,7*me*me/3-8*me*me*me/5,56*me*me*me/15],ge={FalseNorthing:1e7,equatorialRadius:qi,pointScaleFactor:Ml,E0:Cl,A:Ll,flattening:Zn,e:xn,esq:$e,e0sq:Bl,alpha1:Pl,alpha2:Rl,alpha3:Il,alpha4:Ol,beta:Wl,delta:Vl};var to=class o{static centroid(e){let t=new Map;e.forEach(m=>t.set(m.zone,(t.get(m.zone)||0)+1));let n=0,r=0;for(let[m,u]of t)u>r&&(n=m,r=u);let s=1/e.length,l=e.map(m=>m.rezone(n).toVec3()).reduce((m,u)=>Ye.scaleAndAdd(m,m,u,s),Ye.create());return new o().fromVec3(l,n).toLatLng().toUTM()}get easting(){return this._easting}get northing(){return this._northing}get altitude(){return this._altitude}get zone(){return this._zone}get hemisphere(){return this.northing>=0?"northern":"southern"}constructor(e,t,n,r){et(e)?(this._easting=e.easting,this._northing=e.northing,this._altitude=e.altitude,this._zone=e.zone):(this._easting=e||0,this._northing=t||0,this._altitude=n||0,this._zone=r||0)}toJSON(){return JSON.stringify({easting:this.easting,northing:this.northing,altitude:this.altitude,zone:this.zone,hemisphere:this.hemisphere})}toString(){return`(${this.easting}, ${this.northing}, ${this.altitude}) zone ${this.zone}`}equals(e){return X(e)&&this.hemisphere==e.hemisphere&&this.easting==e.easting&&this.northing==e.northing&&this.altitude==e.altitude&&this.zone==e.zone}static A(e,t,n){let r=3+6*(n-1)-180;return ht(t-r)*e}static getZoneWidthAtLatitude(e){let t=ht(e),n=Math.sin(t),r=Math.cos(t),s=n/r,l=ge.e*n,m=ge.equatorialRadius/Math.sqrt(1-l*l),u=s*s,i=ge.e0sq*r*r,c=u*u,f=ht(3)*r,F=f*f,S=1-u+i,d=5-18*u+c+72*i-58*ge.e0sq,_=S/6+F*d/120,T=1+F*_;return 2*ge.pointScaleFactor*m*f*T}fromLatLng(e){let t=ht(e.lat),n=Math.sin(t),r=Math.cos(t),s=2*r,l=s*n,m=s*r-1,u=2*m,i=u*l,c=u*m-1,f=i*m+c*l,F=n/r,S=ge.e*n,d=ge.equatorialRadius/Math.sqrt(1-S*S),_=ge.equatorialRadius*(t*ge.alpha1-l*ge.alpha2+i*ge.alpha3-f*ge.alpha4),T=1+(e.lng+180)/6|0,R=o.A(r,e.lng,T),E=R*R,P=F*F,k=ge.e0sq*r*r,p=P*P,g=1-P+k,A=5-18*P+p+72*k-58*ge.e0sq,M=E*A/120,D=g/6+M,V=1+E*D,W=ge.pointScaleFactor*d*R*V+ge.E0,te=5-P+9*k+4*k*k,Z=61-58*P+p+600*k-330*ge.e0sq,H=te/24+E*Z/720,N=.5+E*H,j=_+d*F*E*N,J=ge.pointScaleFactor*j;return this._easting=W,this._northing=J,this._altitude=e.alt,this._zone=T,this}rezone(e){if(!(1<=e&&e<=60))throw new Error(`Zones must be on the range [1, 60]. Given: ${e}`);if(e!==this.zone){let t=e-this.zone,n=this.toLatLng(),r=o.getZoneWidthAtLatitude(n.lat);return new o(this.easting-r*t,this.northing,this.altitude,e)}else return this}toLatLng(){return new Ut().fromUTM(this)}toVec2(){let e=_t.create();return _t.set(e,this.easting,-this.northing),e}fromVec2(e,t){return this._easting=e[0],this._northing=-e[1],this._altitude=0,this._zone=t,this}toVec3(){let e=Ye.create();return Ye.set(e,this.easting,this.altitude,-this.northing),e}fromVec3(e,t){return this._easting=e[0],this._altitude=e[1],this._northing=-e[2],this._zone=t,this}copy(e){return this._easting=e.easting,this._northing=e.northing,this._altitude=e.altitude,this._zone=e.zone,this}clone(){return new o(this)}};var Ut=class o{static centroid(e){let t=1/e.length,n=e.map(r=>r.toVec3()).reduce((r,s)=>Ye.scaleAndAdd(r,r,s,t),Ye.create());return new o().fromVec3(n)}get alt(){return this._alt}get lat(){return this._lat}get lng(){return this._lng}constructor(e,t,n){et(e)?(this._lat=e.lat,this._lng=e.lng,this._alt=e.alt):(this._lat=e||0,this._lng=t||0,this._alt=n)}toJSON(){return JSON.stringify({lat:this.lat,lng:this.lng,alt:this.alt})}static parseDMS(e){let t=e.split(" ");if(t.length==3){let n=t[0],r=parseInt(t[1],10),s=parseFloat(t[2]);if((n=="N"||n=="S"||n=="E"||n=="W")&&Number.isInteger(r)&&Number.isFinite(s)){let l=r+s/60;return(n=="S"||n=="W")&&(l*=-1),l}}return Number.NaN}static parseDMSPair(e){let t=e.split(",");if(t.length==2){let n=o.parseDMS(t[0]),r=o.parseDMS(t[1]);if(!Number.isNaN(n)&&!Number.isNaN(r))return new o(n,r)}return null}static parseDecimal(e){let t=e.split(",");if(t.length==2){let n=parseFloat(t[0].trim()),r=parseFloat(t[1].trim());if(Number.isFinite(n)&&Number.isFinite(r))return new o(n,r)}return null}static parse(e){let t=o.parseDecimal(e),n=o.parseDMSPair(e);return t||n}toDMS(e,t=!0){let n=o.toDMS(this.lat,"S","N",e),r=o.toDMS(this.lng,"W","E",e);if(this.alt&&t){let s=`${this.alt.toFixed(e)}m`;return`<${n}, ${r}> alt ${s}`}else return`<${n}, ${r}>`}toDMSArray(e,t=!1){let n=[o.toDMS(this.lat,"S","N",e),o.toDMS(this.lng,"W","E",e)];return this.alt&&t&&n.push(`${this.alt.toFixed(e)}m`),n}static toDMS(e,t,n,r){let s=e<0?t:n;e=Math.abs(e);let l=Math.floor(e),m=(e-l)*60,u=Math.floor(m),c=((m-u)*60).toFixed(r);for(;c.indexOf(".")<=1;)c=`0${c}`;return`${s} ${l.toFixed(0)}\xB0 ${u.toFixed(0)}' ${c}"`}toString(e){return e=e||6,`(${this.lat.toFixed(e)}\xB0, ${this.lng.toFixed(e)}\xB0)`}equals(e){return et(e)&&this.lat==e.lat&&this.lng==e.lng&&this.alt==e.alt}compareTo(e){if(ce(e))return-1;{let t=this.lat-e.lat,n=this.lng-e.lng,r=(this.alt||0)-(e.alt||0);return t==0&&n==0?r:t==0?n:t}}distance(e){let t=this.toUTM(),n=e.toUTM().rezone(t.zone),r=n.easting-t.easting,s=n.northing-t.northing;return Math.sqrt(r*r+s*s)}fromUTM(e){let t=e.hemisphere==="southern"&&e.northing>=0?ge.FalseNorthing:0,n=(e.northing-t)/(ge.pointScaleFactor*ge.A),r=(e.easting-ge.E0)/(ge.pointScaleFactor*ge.A),s=n,l=r;for(let f=1;f<=3;++f){let F=ge.beta[f-1],S=2*f*n,d=2*f*r,_=Math.sin(S),T=Math.cosh(d),R=Math.cos(S),E=Math.sinh(d);s-=F*_*T,l-=F*R*E}let m=Math.asin(Math.sin(s)/Math.cosh(l)),u=m;for(let f=1;f<=3;++f)u+=ge.delta[f-1]*Math.sin(2*f*m);let i=e.zone*6-183,c=Math.atan(Math.sinh(l)/Math.cos(s));for(this._lat=Ee(u),this._lng=i+Ee(c);this._lng<-180;)this._lng+=360;for(;this._lng>180;)this._lng-=360;return this._alt=e.altitude,this}toUTM(){return new to().fromLatLng(this)}toVec2(){let e=_t.create();return _t.set(e,this.lng,this.lat),e}fromVec2(e){return this._lng=e[0],this._lat=e[1],this._alt=void 0,this}toVec3(){let e=Ye.create();return Ye.set(e,this.lng,this.alt,this.lat),e}fromVec3(e){return this._lng=e[0],this._alt=e[1],this._lat=e[2],this}toArray(){return[this._lng,this._alt,this._lat]}fromArray(e){return this.fromVec3(e)}copy(e){return this._lat=e.lat,this._lng=e.lng,this._alt=e.alt,this}clone(){return new o(this)}};function xr(o){return X(o)&&o.length>0?parseFloat(o):null}var Gt=class{constructor(e,t){this._url=null,this._base=void 0,this._protocol=null,this._host=null,this._hostName=null,this._userName=null,this._password=null,this._port=null,this._pathName=null,this._hash=null,this._query=new Map,e!==void 0&&(this._url=new URL(e,t),this.rehydrate())}rehydrate(){X(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),X(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),X(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),X(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),X(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),X(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),X(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),X(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[e,t]of this._query)this._url.searchParams.set(e,t);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=xr(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((e,t)=>this._query.set(t,e))}refresh(){if(this._url===null){if(X(this._protocol)&&(X(this._host)||X(this._hostName))){if(X(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=xr(this._url.port),this.rehydrate(),!1;if(X(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(X(this._pathName)&&X(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return X(this._url)}base(e){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=e,this.refresh(),this}protocol(e){return this._protocol=e,this.refresh()&&(this._url.protocol=e),this}host(e){return this._host=e,this.refresh()&&(this._url.host=e,this._hostName=this._url.hostname,this._port=xr(this._url.port)),this}hostName(e){return this._hostName=e,this.refresh()&&(this._url.hostname=e,this._host=`${this._url.hostname}:${this._url.port}`),this}port(e){return this._port=e,this.refresh()&&(this._url.port=e.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(e){return this._userName=e,this.refresh()&&(this._url.username=e),this}password(e){return this._password=e,this.refresh()&&(this._url.password=e),this}path(e){return this._pathName=e,this.refresh()&&(this._url.pathname=e),this}pathPop(e){return e=e||/\/[^/]+\/?$/,this.path(this._pathName.replace(e,""))}pathPush(e){let t=this._pathName;return t.endsWith("/")||(t+="/"),t+=e,this.path(t)}query(e,t){return this._query.set(e,t),this.refresh()&&this._url.searchParams.set(e,t),this}hash(e){return this._hash=e,this.refresh()&&(this._url.hash=e),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};function it(o,e){let t=globalThis,n=t[o];if(ce(n)){if(ce(e))throw new Error(`No value ${o} found`);n=e(),t[o]=n}return n}var no=Oa(Zi(),1);var wr="2.16.105";var zt=class extends xe{constructor(e,t,n){super(),this._scale=250,this._visible=!0,this.wasVisible=null,this.redrawnEvt=new Ie("redrawn"),X(n)&&X(n.scale)&&(this._scale=n.scale),this._canvas=Ti(e,t),this._g=this.canvas.getContext("2d")}fillRect(e,t,n,r,s,l){this.g.fillStyle=e,this.g.fillRect(t+l,n+l,r-2*l,s-2*l)}drawText(e,t,n,r){this.g.textAlign=r,this.g.strokeText(e,t,n),this.g.fillText(e,t,n)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}onClear(){this.g.clearRect(0,0,this.canvas.width,this.canvas.height)}clear(){this.onClear(),this.dispatchEvent(this.redrawnEvt)}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(e){this.scale!==e&&(this._scale=e,this.redraw())}get visible(){return this._visible}set visible(e){this.visible!==e&&(this.wasVisible=this._visible,this._visible=e,this.redraw())}};var Fn=it("Juniper:PdfReady",()=>new Pe(!1)),qt=class extends zt{static async prepare(e,t,n,r,s){let l=null;if(r instanceof pt?l=r:s=r,l=l||new pt,!Fn.started){Fn.start(),console.info(`PDF.js v${wr}`);let m=new Gt(e,location.href);m.query("v",wr),e=m.toString(),no.GlobalWorkerOptions.workerSrc=await t.get(e).useCache(!n).progress(s).file().then(ke),l.check(),Fn.resolve()}await Fn,l.check()}get curPageIndex(){return this._curPageIndex}get curPageNumber(){return this.curPageIndex+1}get canGoBack(){return this._curPageIndex>0}get canGoForward(){return this._curPageIndex<this.numPages-1}constructor(e,t){super(1,1),this.viewportParams=t,this.pdf=null,this._curPageIndex=null,this.ready=this.load(e)}async load(e){await Fn;let t=no.getDocument(e);if(this.pdf=await t.promise,this.pdf.numPages===0)throw new Error("No pages found in PDF")}async getPage(e){if(await this.ready,e=At(e,0,this.pdf.numPages-1),e!==this._curPageIndex){this._curPageIndex=e;let t=await this.pdf.getPage(e+1),n=t.getViewport(this.viewportParams);mn(this.g,n.width,n.height),await t.render({canvasContext:this.g,viewport:n,intent:"print"}).promise,this.dispatchEvent(this.redrawnEvt)}}get numPages(){return this.pdf?this.pdf.numPages:null}onRedraw(){return!1}};function mt(o,e,t){let n=e.map(()=>1),r=Je(o,n);return Promise.all(e.map(async(s,l)=>{let m=r[l];m.start();let u=await t(s,m,l);return m.end(),u}))}async function oo(o,e){let t=new Array(e.length),n=new Array(e.length);for(let l=0;l<e.length;++l){let m=e[l];t[l]=m[0],n[l]=m[1]}let r=Je(o,t),s=new Array(e.length);for(let l=0;l<e.length;++l)s[l]=n[l](r[l]);return await Promise.all(s)}var _r=class extends Ie{constructor(e,t){super("itemevicted"),this.key=e,this.value=t}},ro=class extends xe{constructor(e){super(),this.size=e,this.map=new Map,this.usage=new Array,this.removed=new Map}set(e,t){for(this.usage.push(e);this.usage.length>this.size;){let n=this.usage.shift();X(n)&&(this.removed.set(n,this.map.get(n)),this.map.delete(n))}this.removed.delete(e);for(let[n,r]of this.removed)this.dispatchEvent(new _r(n,r));return this.removed.clear(),this.map.set(e,t)}has(e){return this.map.has(e)}get(e){return this.map.get(e)}delete(e){return this.map.has(e)?(nt(this.usage,e),this.map.delete(e)):!1}clear(){be(this.usage),this.map.clear()}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}};var{ACESFilmicToneMapping:im,AddEquation:sm,AddOperation:am,AdditiveAnimationBlendMode:cm,AdditiveBlending:lm,AlphaFormat:um,AlwaysDepth:pm,AlwaysStencilFunc:dm,AmbientLight:es,AmbientLightProbe:hm,AnimationClip:mm,AnimationLoader:gm,AnimationMixer:fm,AnimationObjectGroup:xm,AnimationUtils:Fm,ArcCurve:wm,ArrayCamera:_m,ArrowHelper:Sm,Audio:Am,AudioAnalyser:km,AudioContext:Tm,AudioListener:bm,AudioLoader:vm,AxesHelper:ym,BackSide:Em,BasicDepthPacking:Dm,BasicShadowMap:Mm,Bone:Cm,BooleanKeyframeTrack:Lm,Box2:Bm,Box3:Pm,Box3Helper:Rm,BoxBufferGeometry:Im,BoxGeometry:ts,BoxHelper:Om,BufferAttribute:Wm,BufferGeometry:Vm,BufferGeometryLoader:Nm,ByteType:Hm,Cache:jm,Camera:Xm,CameraHelper:Um,CanvasTexture:Gm,CapsuleBufferGeometry:zm,CapsuleGeometry:qm,CatmullRomCurve3:$m,CineonToneMapping:Km,CircleBufferGeometry:Jm,CircleGeometry:Ym,ClampToEdgeWrapping:Qm,Clock:Zm,Color:Sr,ColorKeyframeTrack:eg,ColorManagement:tg,CompressedArrayTexture:ng,CompressedTexture:og,CompressedTextureLoader:rg,ConeBufferGeometry:ig,ConeGeometry:sg,CubeCamera:Hl,CubeReflectionMapping:ag,CubeRefractionMapping:cg,CubeTexture:jl,CubeTextureLoader:lg,CubeUVReflectionMapping:ug,CubicBezierCurve:pg,CubicBezierCurve3:dg,CubicInterpolant:hg,CullFaceBack:mg,CullFaceFront:gg,CullFaceFrontBack:fg,CullFaceNone:xg,Curve:Fg,CurvePath:wg,CustomBlending:_g,CustomToneMapping:Sg,CylinderBufferGeometry:Ag,CylinderGeometry:kg,Cylindrical:Tg,Data3DTexture:bg,DataArrayTexture:vg,DataTexture:yg,DataTextureLoader:Eg,DataUtils:Dg,DecrementStencilOp:Mg,DecrementWrapStencilOp:Cg,DefaultLoadingManager:Lg,DepthFormat:Bg,DepthStencilFormat:Pg,DepthTexture:Rg,DirectionalLight:Ig,DirectionalLightHelper:Og,DiscreteInterpolant:Wg,DisplayP3ColorSpace:Vg,DodecahedronBufferGeometry:Ng,DodecahedronGeometry:Hg,DoubleSide:ns,DstAlphaFactor:jg,DstColorFactor:Xg,DynamicCopyUsage:Ug,DynamicDrawUsage:Gg,DynamicReadUsage:zg,EdgesGeometry:qg,EllipseCurve:$g,EqualDepth:Kg,EqualStencilFunc:Jg,EquirectangularReflectionMapping:Yg,EquirectangularRefractionMapping:Qg,Euler:os,EventDispatcher:Zg,ExtrudeBufferGeometry:ef,ExtrudeGeometry:tf,FileLoader:nf,Float16BufferAttribute:of,Float32BufferAttribute:rf,Float64BufferAttribute:sf,FloatType:af,Fog:cf,FogExp2:lf,FramebufferTexture:uf,FrontSide:io,Frustum:pf,GLBufferAttribute:df,GLSL1:hf,GLSL3:mf,GreaterDepth:gf,GreaterEqualDepth:ff,GreaterEqualStencilFunc:xf,GreaterStencilFunc:Ff,GridHelper:wf,Group:rs,HalfFloatType:_f,HemisphereLight:Sf,HemisphereLightHelper:Af,HemisphereLightProbe:kf,IcosahedronBufferGeometry:Tf,IcosahedronGeometry:bf,ImageBitmapLoader:vf,ImageLoader:yf,ImageUtils:Ef,IncrementStencilOp:Df,IncrementWrapStencilOp:Mf,InstancedBufferAttribute:Cf,InstancedBufferGeometry:Lf,InstancedInterleavedBuffer:Bf,InstancedMesh:Pf,Int16BufferAttribute:Rf,Int32BufferAttribute:If,Int8BufferAttribute:Of,IntType:Wf,InterleavedBuffer:Vf,InterleavedBufferAttribute:Nf,Interpolant:Hf,InterpolateDiscrete:jf,InterpolateLinear:Xf,InterpolateSmooth:Uf,InvertStencilOp:Gf,KeepStencilOp:zf,KeyframeTrack:qf,LOD:$f,LatheBufferGeometry:Kf,LatheGeometry:Jf,Layers:Yf,LessDepth:Qf,LessEqualDepth:Zf,LessEqualStencilFunc:ex,LessStencilFunc:tx,Light:nx,LightProbe:ox,Line:rx,Line3:ix,LineBasicMaterial:Xl,LineCurve:sx,LineCurve3:ax,LineDashedMaterial:cx,LineLoop:lx,LineSegments:ux,LinearEncoding:px,LinearFilter:dx,LinearInterpolant:hx,LinearMipMapLinearFilter:mx,LinearMipMapNearestFilter:gx,LinearMipmapLinearFilter:fx,LinearMipmapNearestFilter:xx,LinearSRGBColorSpace:Fx,LinearToneMapping:wx,Loader:_x,LoaderUtils:Sx,LoadingManager:Ax,LoopOnce:kx,LoopPingPong:Tx,LoopRepeat:bx,LuminanceAlphaFormat:vx,LuminanceFormat:yx,MOUSE:Ex,Material:Dx,MaterialLoader:Mx,MathUtils:Cx,Matrix3:Lx,Matrix4:Qe,MaxEquation:Bx,Mesh:wn,MeshBasicMaterial:_n,MeshDepthMaterial:Px,MeshDistanceMaterial:Rx,MeshLambertMaterial:Ix,MeshMatcapMaterial:Ox,MeshNormalMaterial:Wx,MeshPhongMaterial:is,MeshPhysicalMaterial:Vx,MeshStandardMaterial:Nx,MeshToonMaterial:Hx,MinEquation:jx,MirroredRepeatWrapping:Xx,MixOperation:Ux,MultiplyBlending:Gx,MultiplyOperation:zx,NearestFilter:qx,NearestMipMapLinearFilter:$x,NearestMipMapNearestFilter:Kx,NearestMipmapLinearFilter:Jx,NearestMipmapNearestFilter:Yx,NeverDepth:Qx,NeverStencilFunc:Zx,NoBlending:eF,NoColorSpace:tF,NoToneMapping:nF,NormalAnimationBlendMode:oF,NormalBlending:rF,NotEqualDepth:iF,NotEqualStencilFunc:sF,NumberKeyframeTrack:aF,Object3D:He,ObjectLoader:cF,ObjectSpaceNormalMap:lF,OctahedronBufferGeometry:uF,OctahedronGeometry:pF,OneFactor:dF,OneMinusDstAlphaFactor:hF,OneMinusDstColorFactor:mF,OneMinusSrcAlphaFactor:gF,OneMinusSrcColorFactor:fF,OrthographicCamera:xF,PCFShadowMap:FF,PCFSoftShadowMap:wF,PMREMGenerator:_F,Path:SF,PerspectiveCamera:ss,Plane:AF,PlaneBufferGeometry:kF,PlaneGeometry:so,PlaneHelper:TF,PointLight:bF,PointLightHelper:vF,Points:yF,PointsMaterial:EF,PolarGridHelper:DF,PolyhedronBufferGeometry:MF,PolyhedronGeometry:CF,PositionalAudio:LF,PropertyBinding:BF,PropertyMixer:PF,QuadraticBezierCurve:RF,QuadraticBezierCurve3:IF,Quaternion:Pt,QuaternionKeyframeTrack:OF,QuaternionLinearInterpolant:WF,RED_GREEN_RGTC2_Format:VF,RED_RGTC1_Format:NF,REVISION:HF,RGBADepthPacking:jF,RGBAFormat:XF,RGBAIntegerFormat:UF,RGBA_ASTC_10x10_Format:GF,RGBA_ASTC_10x5_Format:zF,RGBA_ASTC_10x6_Format:qF,RGBA_ASTC_10x8_Format:$F,RGBA_ASTC_12x10_Format:KF,RGBA_ASTC_12x12_Format:JF,RGBA_ASTC_4x4_Format:YF,RGBA_ASTC_5x4_Format:QF,RGBA_ASTC_5x5_Format:ZF,RGBA_ASTC_6x5_Format:ew,RGBA_ASTC_6x6_Format:tw,RGBA_ASTC_8x5_Format:nw,RGBA_ASTC_8x6_Format:ow,RGBA_ASTC_8x8_Format:rw,RGBA_BPTC_Format:iw,RGBA_ETC2_EAC_Format:sw,RGBA_PVRTC_2BPPV1_Format:aw,RGBA_PVRTC_4BPPV1_Format:cw,RGBA_S3TC_DXT1_Format:lw,RGBA_S3TC_DXT3_Format:uw,RGBA_S3TC_DXT5_Format:pw,RGB_ETC1_Format:dw,RGB_ETC2_Format:hw,RGB_PVRTC_2BPPV1_Format:mw,RGB_PVRTC_4BPPV1_Format:gw,RGB_S3TC_DXT1_Format:fw,RGFormat:xw,RGIntegerFormat:Fw,RawShaderMaterial:ww,Ray:_w,Raycaster:Sw,RectAreaLight:Aw,RedFormat:kw,RedIntegerFormat:Tw,ReinhardToneMapping:bw,RepeatWrapping:vw,ReplaceStencilOp:yw,ReverseSubtractEquation:Ew,RingBufferGeometry:Dw,RingGeometry:Mw,SIGNED_RED_GREEN_RGTC2_Format:Cw,SIGNED_RED_RGTC1_Format:Lw,SRGBColorSpace:Bw,Scene:Ar,ShaderChunk:Pw,ShaderLib:Sn,ShaderMaterial:as,ShadowMaterial:Rw,Shape:Iw,ShapeBufferGeometry:Ow,ShapeGeometry:Ww,ShapePath:Vw,ShapeUtils:Nw,ShortType:Hw,Skeleton:jw,SkeletonHelper:Xw,SkinnedMesh:Uw,Source:Gw,Sphere:zw,SphereBufferGeometry:qw,SphereGeometry:$w,Spherical:Kw,SphericalHarmonics3:Jw,SplineCurve:Yw,SpotLight:Qw,SpotLightHelper:Zw,Sprite:e_,SpriteMaterial:Ul,SrcAlphaFactor:t_,SrcAlphaSaturateFactor:n_,SrcColorFactor:o_,StaticCopyUsage:r_,StaticDrawUsage:i_,StaticReadUsage:s_,StereoCamera:a_,StreamCopyUsage:c_,StreamDrawUsage:l_,StreamReadUsage:u_,StringKeyframeTrack:p_,SubtractEquation:d_,SubtractiveBlending:h_,TOUCH:m_,TangentSpaceNormalMap:g_,TetrahedronBufferGeometry:f_,TetrahedronGeometry:x_,Texture:ao,TextureLoader:F_,TorusBufferGeometry:w_,TorusGeometry:__,TorusKnotBufferGeometry:S_,TorusKnotGeometry:A_,Triangle:k_,TriangleFanDrawMode:T_,TriangleStripDrawMode:b_,TrianglesDrawMode:v_,TubeBufferGeometry:y_,TubeGeometry:E_,TwoPassDoubleSide:D_,UVMapping:M_,Uint16BufferAttribute:C_,Uint32BufferAttribute:L_,Uint8BufferAttribute:B_,Uint8ClampedBufferAttribute:P_,Uniform:R_,UniformsGroup:I_,UniformsLib:An,UniformsUtils:kr,UnsignedByteType:O_,UnsignedInt248Type:W_,UnsignedIntType:V_,UnsignedShort4444Type:N_,UnsignedShort5551Type:H_,UnsignedShortType:j_,VSMShadowMap:X_,Vector2:cs,Vector3:Re,Vector4:ls,VectorKeyframeTrack:U_,VideoTexture:us,WebGL1Renderer:G_,WebGL3DRenderTarget:z_,WebGLArrayRenderTarget:q_,WebGLCubeRenderTarget:Gl,WebGLMultipleRenderTargets:$_,WebGLRenderTarget:K_,WebGLRenderer:ps,WebGLUtils:J_,WireframeGeometry:Y_,WrapAroundEnding:Q_,ZeroCurvatureEnding:Z_,ZeroFactor:e1,ZeroSlopeEnding:t1,ZeroStencilOp:n1,_SRGBAFormat:o1,sRGBEncoding:r1}=THREE;function ds(o,e){let t=o*dt;return .5*(1-Math.cos(t))-e*Math.sin(2*t)}function kt(o){return X(o)&&o.isMesh}function Tr(o){return X(o)&&o.isMaterial}function zl(o,e){return Tr(e)&&e.type===o}function hs(o){return zl("MeshBasicMaterial",o)}function ms(o){return X(o)&&o.isObject3D}function kn(o){return X(o)&&ms(o.object)}function Rt(o){return kn(o)?o.object:o}function br(o,e){return o=Rt(o),o.visible=e,e}function vr(o){if(!o)return!1;for(o=Rt(o);o;){if(!o.visible)return!1;o=o.parent}return!0}function de(o,...e){let t=e.filter(X).map(Rt);return t.length>0&&Rt(o).add(...t),o}function co(o,...e){let t=new He;return t.name=o,de(t,...e),t}function lo(o,e,t){let n=new wn(e,t);return n.name=o,n}var $t=it("Juniper:ScaledItems",()=>new Map),gs=1,ql=1.1;var yr=class{constructor(e){this.target=e,this.obj=Rt(this.target),this.base=this.obj.scale.clone(),this.p=0,this.dir=0,this.running=!1,this.wasDisabled=this.disabled,this.target.addScopedEventListener(this,"enter",t=>{t.pointer.type!=="nose"&&this.run(1)}),this.target.addScopedEventListener(this,"exit",t=>{t.pointer.type!=="nose"&&this.run(-1)}),this.obj.traverse(t=>{kt(t)&&this.target.addMesh(t)})}get disabled(){return this.target.disabled}run(e){(!this.disabled||e===-1||this.p>0)&&(this.dir=e,this.running=!0)}updateScaling(e){if(this.disabled!==this.wasDisabled&&(this.wasDisabled=this.disabled,this.disabled&&this.run(-1)),this.running){this.p+=this.dir*e,(this.dir>0&&this.p>=1||this.dir<0&&this.p<0)&&(this.p=Math.max(0,Math.min(1,this.p)),this.running=!1);let t=ds(this.p,1.1);this.obj.scale.copy(this.base).multiplyScalar(t*(ql-gs)+gs)}}dispose(){this.target.removeScope(this)}};function fs(o){let e=$t.get(o);e&&($t.delete(o),Ne(e))}function xs(o,e){let t=$t.has(o);if(e!=t)if(e)$t.set(o,new yr(o));else{let n=$t.get(o);Ne(n),$t.delete(o)}}function We(o){let e=new Array,t=new Set;for(e.push(o);e.length>0;){let n=e.shift();n&&!t.has(n)&&(t.add(n),n.isMesh&&e.push(n.material,n.geometry),n.isMaterial&&e.push(...Object.values(n)),n.isObject3D&&(e.push(...n.children),n.clear(),fs(n)),tt(n)&&e.push(...n),Lt(n))}t.clear()}var Ue;(function(o){o[o.None=-1]="None",o[o.Left=0]="Left",o[o.Right=1]="Right",o[o.Up=2]="Up",o[o.Down=3]="Down",o[o.Back=4]="Back",o[o.Front=5]="Front"})(Ue||(Ue={}));var O1=new Re(0,1,0),$l=2048,W1=$l/2;var Fs={rows:3,columns:4,indices:[[Ue.None,Ue.Up,Ue.None,Ue.None],[Ue.Left,Ue.Front,Ue.Right,Ue.Back],[Ue.None,Ue.Down,Ue.None,Ue.None]],rotations:[[0,dt,0,0],[0,0,0,0],[0,dt,0,0]]},V1=new Sr(0);var Tn=2,Kt=2048,Jt=new os,Tt;(function(o){o[o.Low=90]="Low",o[o.Medium=60]="Medium",o[o.High=45]="High",o[o.Fine=30]="Fine"})(Tt||(Tt={}));var Kl=new Map([[Tt.Low,4],[Tt.Medium,8],[Tt.High,3],[Tt.Fine,2]]),ws=[[St,0,0,1],[-St,0,2,1],[0,St,1,0],[0,-St,1,2],[dt,0,3,1],[0,0,1,1]],uo=class{constructor(e,t){this.fetcher=e,this.fixWatermarks=t,this.baseURL=null,this.isDebug=!1,this.disposed=!1,this.canvas=Mt(Kt,Kt),this.renderer=new ps({canvas:this.canvas,alpha:!1,antialias:!1,depth:!0,logarithmicDepthBuffer:!1,powerPreference:"low-power",precision:"lowp",stencil:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1}),this.camera=new ss(90),this.photosphere=new rs,this.scene=de(new Ar,new es(16777215,1),this.camera,this.photosphere),this.geometry=new so(1,1,1,1)}init(e,t){this.baseURL=e,this.isDebug=t}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){for(let e of this.scene.children)We(e);Ne(this.renderer)}async renderFaces(e,t,n){this.clear(),await this.loadFrames(t,n,e);let r=await Promise.all(ws.map(async([s,l,m,u])=>{let i=Fs.rotations[u][m];Jt.set(l,s,i,"YXZ"),this.camera.setRotationFromEuler(Jt),this.renderer.render(this.scene,this.camera);let c=await fr(this.renderer.domElement,ar.value,1);return URL.createObjectURL(c)}));return this.clear(),r}async renderCubeMap(e,t,n){this.clear();let r=Mt(Kt*4,Kt*3),s=r.getContext("2d",{alpha:!1});await this.loadFrames(t,n,e);for(let[u,i,c,f]of ws)Jt.set(i,u,0,"YXZ"),this.camera.setRotationFromEuler(Jt),this.renderer.render(this.scene,this.camera),s.drawImage(this.renderer.domElement,c*Kt,f*Kt);let l=await fr(r,ar.value,1),m=URL.createObjectURL(l);return this.clear(),m}getImageAngles(e){let t=new Array,n=e,r=this.fixWatermarks?Kl.get(n):0;for(let s=-90+n;s<90;s+=n)for(let l=-180;l<180;l+=n)t.push([l,s,n+r,Tn]);return t.push([0,-90,n+r,Tn]),t.push([0,90,n+r,Tn]),this.fixWatermarks&&(t.push([0,-90,n,.5*Tn]),t.push([0,90,n,.5*Tn])),t}async loadFrames(e,t,n){let r=this.getImageAngles(e);await mt(t,r,(s,l)=>this.loadFrame(n,...s,l))}async loadFrame(e,t,n,r,s,l){let m=.5*ht(r),u=Math.tan(m),i=.5*s/u,c=e(r,t,n),f=await this.fetcher.get(c,this.baseURL).progress(l).useCache(!this.isDebug).canvas().then(ke),F=new ao(f),S=new _n({map:F,side:ns}),d=lo(`frame-${r}-${t}-${n}`,this.geometry,S);F.needsUpdate=!0,S.needsUpdate=!0,Jt.set(ht(n),-ht(t),0,"YXZ"),d.scale.setScalar(s),d.quaternion.setFromEuler(Jt),d.position.set(0,0,-i).applyQuaternion(d.quaternion),de(this.photosphere,d)}clear(){for(let e of this.photosphere.children)We(e);this.photosphere.clear()}};function Er(o){return o.hostname==="www.youtube.com"||o.hostname==="youtube.com"||o.hostname==="youtu.be"}var Jl=new Map([["vp9","vp09.00.10.08"]]);function Yl(o){return ce(o.vcodec)||o.vcodec==="none"?"audio":"video"}function _s(o,e){let t=[o];if(X(e)&&e.length>0&&e!=="none"&&(e=Jl.get(e)||e),X(e)&&e.length>0&&e!=="none"){let n=encodeURI(e)!==e?"*":"";t.push(`codecs${n}="${e}"`)}return t.join(";")}var po=class{constructor(e,t){this.fetcher=e,this.makeProxyURL=t}makeVideoRecord(e){let{content_type:t,acodec:n,vcodec:r}=e;return{contentType:_s(t,r),url:this.makeProxyURL(e.url).href,acodec:n,abr:e.abr*1024,asr:e.asr,vcodec:r,vbr:e.vbr*1024,fps:e.fps,width:e.width,height:e.height,resolution:e.width*e.height}}makeAudioRecord(e){let{content_type:t,acodec:n}=e;return{contentType:_s(t,n),url:this.makeProxyURL(e.url).href,acodec:n,abr:e.abr*1024,asr:e.asr,resolution:e.abr}}makeImageRecord(e){let{content_type:t,url:n,width:r,height:s}=e;return{contentType:t,url:this.makeProxyURL(n).href,width:r,height:s,resolution:r*s}}async loadData(e,t){if(ce(e))throw new Error("must provide a YouTube URL or a YTMetadata object");X(t)&&t.start();let n=null;he(e)?n=await this.fetcher.get(e).progress(t).object().then(ke):(X(t)&&t.end(e.title),n=e);let r=0;if(X(n.original_url)){let F=new URL(n.original_url);Er(F)&&F.searchParams.has("t")&&(r=parseFloat(F.searchParams.get("t")))}let s=new Oe((await Promise.all(n.formats)).map(F=>[Yl(F),F])),l=n.title,m=n.thumbnails||[],u=n.thumbnail&&this.makeImageRecord(Ft(m,F=>F.url===n.thumbnail)),i=s.get("video").map(F=>this.makeVideoRecord(F)),c=s.get("audio").map(F=>this.makeAudioRecord(F));return{title:l,thumbnail:u,videos:i,audios:c,startTime:r}}};var sS=it("juniper::loadedFonts",()=>[]);function Ss(o){let e=[];return o.fontStyle&&o.fontStyle!=="normal"&&e.push(o.fontStyle),o.fontVariant&&o.fontVariant!=="normal"&&e.push(o.fontVariant),o.fontWeight&&o.fontWeight!=="normal"&&e.push(o.fontWeight),e.push(di(o.fontSize)),e.push(o.fontFamily),e.join(" ")}var As="3.7.24";var ks=new URL(globalThis.location.href),bn=ks.searchParams.has("DEBUG")&&!ks.searchParams.has("RELEASE");var Zl=bn?un(10):As;var eu=50,tu=12,vS=eu*tu;var Ts={fontFamily:"Lato",fontSize:20};var ho=Xn(30,67,136),yS=Xn(78,77,77),bs={fontFamily:Ts.fontFamily,fontSize:Ts.fontSize,textFillColor:"white"},vs=Object.assign({},bs,{bgFillColor:Xn(0,120,215),bgStrokeColor:"black",bgStrokeSize:.02,padding:{top:.025,left:.05,bottom:.025,right:.05},minHeight:.2,maxHeight:.2,scale:300}),ES=Object.assign({},bs,{textStrokeColor:"black",textStrokeSize:.01,minHeight:.25,maxHeight:.25});var nu=bn?".js":".min.js";function ou(o,e){return`/js/${e}/index${o}?v=${Zl}`}function mo(o){return ou(nu,o)}function ys(o){return mo("workers/"+o)}function Es(o){return mo("libs/"+o)}var Ve=class o{constructor(e,t,n=null){this.value=e,this.desc=t,this.value=e,this.desc=t,this.props=n||{}}contains(e){return e instanceof o?this.contains(e.value):this.value.indexOf(e)>=0}changeStyle(e,t){let n=this.value;return n.endsWith(e)&&(n=n.substring(0,n.length-e.length)),n+=t,n}get textStyle(){return this.changeStyle("\uFE0F","\uFE0E")}get emojiStyle(){return this.changeStyle("\uFE0E","\uFE0F")}};var go=class o extends Ve{constructor(e,t,...n){super(e,t),this.width=null,this.alts=n}random(){let e=Math.floor(Math.random()*this.alts.length);if(e<0)return null;let t=this.alts[e];return t instanceof o?t.random():t}contains(e){if(super.contains(e))return!0;for(let t of this.alts)if(t.contains(e))return!0;return!1}};var Ds=new Ve("\u2B06\uFE0E","Up Arrow: Text");var Ms=new Ve("0\uFE0F\u20E3","Keycap Digit Zero"),Cs=new Ve("1\uFE0F\u20E3","Keycap Digit One"),Ls=new Ve("2\uFE0F\u20E3","Keycap Digit Two"),Bs=new Ve("3\uFE0F\u20E3","Keycap Digit Three"),Ps=new Ve("4\uFE0F\u20E3","Keycap Digit Four"),Rs=new Ve("5\uFE0F\u20E3","Keycap Digit Five"),Is=new Ve("6\uFE0F\u20E3","Keycap Digit Six"),Os=new Ve("7\uFE0F\u20E3","Keycap Digit Seven"),Ws=new Ve("8\uFE0F\u20E3","Keycap Digit Eight"),Vs=new Ve("9\uFE0F\u20E3","Keycap Digit Nine");var Ns=new Ve("\u{1F51F}","Keycap: 10");var Hs=new go("Keycap Digits","Keycap Digits",Ms,Cs,Ls,Bs,Ps,Rs,Is,Os,Ws,Vs,Ns);function js(o){let e=o.attributes.position,t=o.attributes.normal,n=o.attributes.uv;for(let r=0;r<t.count;++r){let s=r*t.itemSize,l=r*t.itemSize+1,m=r*t.itemSize+2,u=t.array[s],i=t.array[l],c=t.array[m],f=Math.abs(u),F=Math.abs(i),S=Math.abs(c),d=e.array[s],_=e.array[l],T=e.array[m],R=Math.abs(d),E=Math.abs(_),P=Math.abs(T),k=r*n.itemSize,p=r*n.itemSize+1,g=n.array[k],A=n.array[p],M=0,D=f,V=R;F>D&&(M=1,D=F,V=E),S>D&&(M=2,D=S,V=P),M===0?d<0?(g=-T,A=_):(g=T,A=_):M===1?_<0?(g=d,A=-T):(g=d,A=T):T<0?(g=d,A=_):(g=-d,A=_),g=(g/V+1)/8,A=(A/V+1)/6,M===0?d<0?(g+=0,A+=1/3):(g+=.5,A+=1/3):M===1?_<0?(g+=.25,A+=0):(g+=.25,A+=2/3):T<0?(g+=.25,A+=1/3):(g+=.75,A+=1/3);let W=n.array;W[k]=g,W[p]=A}}var vn=new ts(1,1,1,1,1,1);vn.name="CubeGeom";vn.computeBoundingBox();vn.computeBoundingSphere();var Xs=vn.clone();Xs.name="InvertedCubeGeom";js(Xs);var Yt=class extends wn{constructor(e,t,n,r){super(vn,r),this.scale.set(e,t,n)}};An.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new cs(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};Sn.line={uniforms:kr.merge([An.common,An.fog,An.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var fo=class extends as{constructor(e){super({type:"LineMaterial",uniforms:kr.clone(Sn.line.uniforms),vertexShader:Sn.line.vertexShader,fragmentShader:Sn.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}};fo.prototype.isLineMaterial=!0;var Dr=it("Juniper:Three:Materials",()=>new Map);function ru(o,e){e in o&&delete o[e]}function Us(o,e,t){let n=`${o}_${Object.keys(t).map(r=>`${r}:${t[r]}`).join(",")}`;return Dr.has(n)||(ru(t,"name"),Dr.set(n,new e(t))),Dr.get(n)}function iu(o){return Object.assign(o,{transparent:!0})}function su(o){return Us("solid",_n,o)}function Gs(o){return Us("solidTransparent",_n,iu(o))}function zs(o,e){let t=new Set;o.traverse(n=>{if(kt(n)&&Tr(n.material)){let r=n.material,s=e(r);r!==s&&(t.add(r),n.material=s)}});for(let n of t)Lt(n)}function qs(o){if(o.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let e={alphaMap:o.alphaMap,alphaTest:o.alphaTest,alphaToCoverage:o.alphaToCoverage,aoMap:o.aoMap,aoMapIntensity:o.aoMapIntensity,blendDst:o.blendDst,blendDstAlpha:o.blendDstAlpha,blendEquation:o.blendEquation,blendEquationAlpha:o.blendEquationAlpha,blending:o.blending,blendSrc:o.blendSrc,blendSrcAlpha:o.blendSrcAlpha,bumpMap:o.bumpMap,bumpScale:o.bumpScale,clipIntersection:o.clipIntersection,clippingPlanes:o.clippingPlanes,clipShadows:o.clipShadows,color:o.color,colorWrite:o.colorWrite,depthFunc:o.depthFunc,depthTest:o.depthTest,depthWrite:o.depthWrite,displacementBias:o.displacementBias,displacementMap:o.displacementMap,displacementScale:o.displacementScale,dithering:o.dithering,emissive:o.emissive,emissiveIntensity:o.emissiveIntensity,emissiveMap:o.emissiveMap,envMap:o.envMap,flatShading:o.flatShading,fog:o.fog,lightMap:o.lightMap,lightMapIntensity:o.lightMapIntensity,map:o.map,name:o.name+"-Standard-To-Phong",normalMap:o.normalMap,normalMapType:o.normalMapType,normalScale:o.normalScale,opacity:o.opacity,polygonOffset:o.polygonOffset,polygonOffsetFactor:o.polygonOffsetFactor,polygonOffsetUnits:o.polygonOffsetUnits,precision:o.precision,premultipliedAlpha:o.premultipliedAlpha,shadowSide:o.shadowSide,side:o.side,stencilFail:o.stencilFail,stencilFunc:o.stencilFunc,stencilFuncMask:o.stencilFuncMask,stencilRef:o.stencilRef,stencilWrite:o.stencilWrite,stencilWriteMask:o.stencilWriteMask,stencilZFail:o.stencilZFail,stencilZPass:o.stencilZPass,toneMapped:o.toneMapped,transparent:o.transparent,userData:o.userData,vertexColors:o.vertexColors,visible:o.visible,wireframe:o.wireframe,wireframeLinecap:o.wireframeLinecap,wireframeLinejoin:o.wireframeLinejoin,wireframeLinewidth:o.wireframeLinewidth};for(let[t,n]of Object.entries(e))ce(n)&&delete e[t];return new is(e)}var au=16777215;var xo=su({color:au});var It=class extends zt{constructor(e){super(10,10,e),this.trueWidth=null,this.trueHeight=null,this.trueFontSize=null,this.dx=null,this._minWidth=null,this._maxWidth=null,this._minHeight=null,this._maxHeight=null,this._freezeDimensions=!1,this._dimensionsFrozen=!1,this._bgFillColor=null,this._bgStrokeColor=null,this._bgStrokeSize=null,this._textStrokeColor=null,this._textStrokeSize=null,this._textFillColor="black",this._textDirection="horizontal",this._fontStyle="normal",this._fontVariant="normal",this._fontWeight="normal",this._fontFamily="sans-serif",this._fontSize=20,this._value=null,this.lastValue=null,X(e)&&(X(e.minWidth)&&(this._minWidth=e.minWidth),X(e.maxWidth)&&(this._maxWidth=e.maxWidth),X(e.minHeight)&&(this._minHeight=e.minHeight),X(e.maxHeight)&&(this._maxHeight=e.maxHeight),X(e.freezeDimensions)&&(this._freezeDimensions=e.freezeDimensions),X(e.textStrokeColor)&&(this._textStrokeColor=e.textStrokeColor),X(e.textStrokeSize)&&(this._textStrokeSize=e.textStrokeSize),X(e.bgFillColor)&&(this._bgFillColor=e.bgFillColor),X(e.bgStrokeColor)&&(this._bgStrokeColor=e.bgStrokeColor),X(e.bgStrokeSize)&&(this._bgStrokeSize=e.bgStrokeSize),X(e.value)&&(this._value=e.value),X(e.textFillColor)&&(this._textFillColor=e.textFillColor),X(e.textDirection)&&(this._textDirection=e.textDirection),X(e.fontStyle)&&(this._fontStyle=e.fontStyle),X(e.fontVariant)&&(this._fontVariant=e.fontVariant),X(e.fontWeight)&&(this._fontWeight=e.fontWeight),X(e.fontFamily)&&(this._fontFamily=e.fontFamily),X(e.fontSize)&&(this._fontSize=e.fontSize),X(e.padding)&&(Le(e.padding)?this._padding={left:e.padding,right:e.padding,top:e.padding,bottom:e.padding}:this._padding=e.padding)),ce(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(e){this.minWidth!==e&&(this._minWidth=e,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(e){this.maxWidth!==e&&(this._maxWidth=e,this.redraw())}get minHeight(){return this._minHeight}set minHeight(e){this.minHeight!==e&&(this._minHeight=e,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(e){this.maxHeight!==e&&(this._maxHeight=e,this.redraw())}get padding(){return this._padding}set padding(e){if(e instanceof Array)throw new Error("Invalid padding");(this.padding.top!==e.top||this.padding.right!=e.right||this.padding.bottom!=e.bottom||this.padding.left!=e.left)&&(this._padding=e,this.redraw())}get textDirection(){return this._textDirection}set textDirection(e){this.textDirection!==e&&(this._textDirection=e,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(e){this.fontStyle!==e&&(this._fontStyle=e,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(e){this.fontVariant!==e&&(this._fontVariant=e,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(e){this.fontWeight!==e&&(this._fontWeight=e,this.redraw())}get fontSize(){return this._fontSize}set fontSize(e){this.fontSize!==e&&(this._fontSize=e,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(e){this.textFillColor!==e&&(this._textFillColor=e,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(e){this.textStrokeColor!==e&&(this._textStrokeColor=e,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(e){this.textStrokeSize!==e&&(this._textStrokeSize=e,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(e){this.bgFillColor!==e&&(this._bgFillColor=e,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(e){this.bgStrokeColor!==e&&(this._bgStrokeColor=e,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(e){this.bgStrokeSize!==e&&(this._bgStrokeSize=e,this.redraw())}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.redraw())}split(e){return e.replace(/\r\n/g,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.onClear(),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value&&this.value!==this.lastValue){let e=this.split(this.value),t=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let r=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,s=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,l=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,m=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,u=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,i=t?m:s,c=t?u:l,f=t?s:m,F=t?l:u,S=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let d=!1,_=!1,T=1e4,R=0;this.trueFontSize=At(this.fontSize*this.scale,R,T);let E=null,P=Number.MAX_VALUE;do{let g=this.fontSize;this._fontSize=this.trueFontSize;let A=Ss(this);this._fontSize=g,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=A,this.trueWidth=0,this.trueHeight=0;for(let M of e){let D=this.g.measureText(M);this.trueWidth=Math.max(this.trueWidth,D.width),this.trueHeight+=this.trueFontSize,Le(D.actualBoundingBoxLeft)&&Le(D.actualBoundingBoxRight)&&Le(D.actualBoundingBoxAscent)&&Le(D.actualBoundingBoxDescent)&&(r||(this.trueWidth=D.actualBoundingBoxLeft+D.actualBoundingBoxRight,this.trueHeight=D.actualBoundingBoxAscent+D.actualBoundingBoxDescent,this.dx=(D.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(r){let M=this.trueWidth-i,D=this.trueWidth-c,V=this.trueHeight-f,W=this.trueHeight-F,te=Math.abs(M),Z=Math.abs(D),H=Math.abs(V),N=Math.abs(W);d=D>1||W>1,_=M<-1&&V<-1;let j=Math.min(te,Math.min(Z,Math.min(H,N)));j<P&&(P=j,E=this.g.font),(d||_)&&S.indexOf(this.g.font)>-1&&E&&(this.g.font=E,d=!1,_=!1),d?(T=this.trueFontSize,this.trueFontSize=(R+this.trueFontSize)/2):_&&(R=this.trueFontSize,this.trueFontSize=(this.trueFontSize+T)/2)}S.push(this.g.font)}while(d||_);r&&(this.trueWidth<i?this.trueWidth=i:this.trueWidth>c&&(this.trueWidth=c),this.trueHeight<f?this.trueHeight=f:this.trueHeight>F&&(this.trueHeight=F));let k=this.trueWidth+this.scale*(this.padding.right+this.padding.left),p=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{mn(this.g,k,p)}catch(g){throw console.error(g),g}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let n=.5*(e.length-1);for(let r=0;r<e.length;++r){let s=e[r],l=(r-n)*this.trueFontSize,m=this.dx+this.trueWidth/2+this.scale*this.padding.left,u=l+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(s,m,u),this.textFillColor&&this.g.fillText(s,m,u)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let r=this.bgStrokeSize/2;this.g.strokeRect(r,r,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(t){let r=Mt(this.canvas.height,this.canvas.width),s=r.getContext("2d");s?(s.translate(r.width/2,r.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?s.rotate(St):this.textDirection==="vertical-right"&&s.rotate(-St),s.translate(-this.canvas.width/2,-this.canvas.height/2),s.drawImage(this.canvas,0,0),mn(this.g,r.width,r.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(r,0,0)}return this.lastValue=this.value,!0}else{let e=this.value!==this.lastValue;return this.lastValue=this.value,e}}};function Fo(o){return o instanceof HTMLVideoElement?o.videoWidth:o instanceof VideoFrame?o.displayWidth:o.width}function wo(o){return o instanceof HTMLVideoElement?o.videoHeight:o instanceof VideoFrame?o.displayHeight:o.height}var $s=304.79999999999995,FA=$s*3,cu=10*100,lu=$s*16.5,uu=lu*40,wA=cu*1e3,_A=uu*8,Ks=2.54*4,Js=Ks*3,SA=Js*3,pu=Js*16.5,du=pu*40,AA=100*1e3,kA=du*8,Mr=4*3,hu=Mr*3,yn=100/2.54,mu=Mr*16.5,gu=mu*40,TA=yn*1e3,bA=gu*8,vA=3*3,fu=100/Ks,xu=3*16.5,Fu=xu*40,yA=fu*1e3,EA=Fu*8,Ys=yn/Mr,wu=16.5*40,DA=Ys*1e3,MA=wu*8,_u=yn/hu,Su=16.5/3,Au=Su*40,CA=_u*1e3,LA=Au*8,Qs=16.5/Ys,Zs=Qs*40,BA=Zs*8,PA=1e3/Qs,RA=40*8,ku=1e3/Zs,IA=8/ku;function ea(o){return o/yn}function ta(o){return o*yn}var Cr=new so(1,1,1,1);Cr.name="PlaneGeom";var Tu=new Qe,_o=new Re,na=new ls,oa=new Pt;function Lr(o,e,t){return Tu.copy(o.matrixWorld).invert().multiply(e.matrixWorld).decompose(_o,oa,t),na.set(_o.x,_o.y,_o.z,1),new XRRigidTransform(na,oa)}var Qt=new Re,bu=0,bt=class extends He{constructor(e,t,n,r=null){if(super(),this.webXRLayerType=n,this.lastMatrixWorld=new Qe,this._imageWidth=0,this._imageHeight=0,this.forceUpdate=!1,this.wasUsingLayer=!1,this.layer=null,this.curImage=null,this.lastImage=null,this.lastWidth=null,this.lastHeight=null,this.env=null,this.mesh=null,this.stereoLayoutName="mono",this.sizeMode="none",e){this.setEnvAndName(e,t);let s=hs(r)?r:Gs(Object.assign({},r,{name:this.name}));de(this,this.mesh=lo(t+"-Mesh",Cr,s))}}copy(e,t=!0){return super.copy(e,t),this.webXRLayerType=e.webXRLayerType,this.setImageSize(e.imageWidth,e.imageHeight),this.setEnvAndName(e.env,e.name+ ++bu),this.mesh=Ft(this.children,kt),ce(this.mesh)&&(this.mesh=e.mesh.clone(),de(this,this.mesh)),this.setTextureMap(e.curImage),this}dispose(){this.env.removeScope(this),this.disposeImage(),We(this.mesh)}disposeImage(){this.removeWebXRLayer(),We(this.mesh.material.map),this.curImage=null}setImageSize(e,t){if(e!==this.imageWidth||t!==this.imageHeight){let{objectWidth:n,objectHeight:r}=this;this._imageWidth=e,this._imageHeight=t,this.sizeMode!=="none"&&(this.sizeMode==="fixed-width"?this.objectWidth=n:this.objectHeight=r)}}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get imageAspectRatio(){return this.imageWidth/this.imageHeight}get objectWidth(){return this.scale.x}set objectWidth(e){this.scale.set(e,this.scale.y=e/this.imageAspectRatio,1)}get objectHeight(){return this.scale.y}set objectHeight(e){this.scale.set(this.imageAspectRatio*e,e,1)}get pixelDensity(){let e=ta(this.objectWidth);return this.imageWidth/e}set pixelDensity(e){let t=this.imageWidth/e,n=ea(t);this.objectWidth=n}setEnvAndName(e,t){this.env=e,this.name=t,this.env.addScopedEventListener(this,"update",n=>this.checkWebXRLayer(n.frame))}get needsLayer(){return!vr(this)||ce(this.mesh.material.map)||ce(this.curImage)?!1:this.curImage instanceof HTMLVideoElement?!this.curImage.paused||this.curImage.currentTime>0:!0}removeWebXRLayer(){if(X(this.layer)){this.wasUsingLayer=!1,this.env.removeWebXRLayer(this.layer),this.mesh.visible=!0;let e=this.layer;this.layer=null,setTimeout(()=>Lt(e),100)}}setTextureMap(e){this.curImage&&this.disposeImage(),e&&($n(e)?e=bi(e):Si(e)&&(e=vi(e)),qn(e)&&(e=e),this.curImage=e,this.setImageSize(Fo(e),wo(e)),e instanceof HTMLVideoElement?this.mesh.material.map=new us(e):(this.mesh.material.map=new ao(e),this.mesh.material.map.needsUpdate=!0)),this.mesh.material.needsUpdate=!0}get isVideo(){return this.curImage instanceof HTMLVideoElement}updateTexture(){if(X(this.curImage)){let e=Fo(this.curImage),t=wo(this.curImage);if(this.imageWidth!==e||this.imageHeight!==t){let n=this.curImage;this.disposeImage(),this.setTextureMap(n)}else this.mesh.material.map.needsUpdate=this.forceUpdate=!0}}checkWebXRLayer(e){if(this.mesh.material.map&&this.curImage){let n=this.webXRLayerType!=="none"&&this.env.hasXRCompositionLayers&&this.env.showWebXRLayers&&X(e)&&(this.isVideo&&X(this.env.xrMediaBinding)||!this.isVideo&&X(this.env.xrBinding))&&this.needsLayer,r=n!==this.wasUsingLayer,s=this.curImage!==this.lastImage||this.mesh.material.needsUpdate||this.mesh.material.map.needsUpdate||this.forceUpdate,l=this.imageWidth!==this.lastWidth||this.imageHeight!==this.lastHeight;if(this.wasUsingLayer=n,this.lastImage=this.curImage,this.lastWidth=this.imageWidth,this.lastHeight=this.imageHeight,(r||l)&&((!n||l)&&this.layer&&this.removeWebXRLayer(),n)){let m=this.env.referenceSpace,u=Lr(this.env.stage,this.mesh,Qt);this.lastMatrixWorld.copy(this.matrixWorld);let i=Qt.x/2,c=Qt.y/2,f=this.stereoLayoutName==="mono"?"mono":this.stereoLayoutName==="left-right"||this.stereoLayoutName==="right-left"?"stereo-left-right":"stereo-top-bottom";if(this.isVideo){let F=this.stereoLayoutName==="right-left"||this.stereoLayoutName==="bottom-top";this.layer=this.env.xrMediaBinding.createQuadLayer(this.curImage,{space:m,layout:f,invertStereo:F,transform:u,width:i,height:c})}else this.layer=this.env.xrBinding.createQuadLayer({space:m,layout:f,textureType:"texture",isStatic:this.webXRLayerType==="static",viewPixelWidth:Fo(this.curImage),viewPixelHeight:wo(this.curImage),transform:u,width:i,height:c});this.env.addWebXRLayer(this.layer,500),this.mesh.visible=!1}if(this.layer){if(s||this.layer.needsRedraw){let m=this.env.gl,u=this.env.xrBinding.getSubImage(this.layer,e);m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,!0),m.bindTexture(m.TEXTURE_2D,u.colorTexture),m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,this.curImage),m.generateMipmap(m.TEXTURE_2D),m.bindTexture(m.TEXTURE_2D,null),this.forceUpdate=!1}In(this.matrixWorld.elements,this.lastMatrixWorld.elements)>=0&&(this.layer.transform=Lr(this.env.stage,this.mesh,Qt),this.lastMatrixWorld.copy(this.matrixWorld),this.layer.width=Qt.x/2,this.layer.height=Qt.y/2)}else this.forceUpdate=!1}}};var vu={type:"redrawn"},So=class extends bt{get object(){return this}get element(){return zn(this.image.canvas)?this.image.canvas:null}get canvas(){return this._image.canvas}constructor(e,t,n,r,s){super(e,t,n,s),this._image=null,this.image=r}onRedrawn(){this.updateTexture(),this.dispatchEvent(vu)}get image(){return this._image}set image(e){this.image&&this.image.removeScope(this),this._image=e,this.image&&(this.image.addScopedEventListener(this,"redrawn",()=>this.onRedrawn()),this.setTextureMap(this.image.canvas),this.onRedrawn())}get imageWidth(){return this.image.width}get imageHeight(){return this.image.height}copy(e,t=!0){return super.copy(e,t),this.image=e.image,this}get isVisible(){return gi(this)}set isVisible(e){mi(this,e,"inline-block"),br(this,e),br(this.mesh,e),this.image.visible=e}};var st=class extends So{constructor(e,t,n,r,s){let l;r instanceof It?l=r:l=new It(r),super(e,t,n,l,s)}onRedrawn(){this.objectHeight=this.imageHeight,super.onRedrawn()}};var yu=new Ie("play"),Eu=new Ie("stop"),je=.1,ra=new Map(Hs.alts.map((o,e)=>[o.value,e.toString()])),Zt=class extends ct{constructor(e,t,n,r,s,l,m){super(),this.data=n,this.volume=l,this.player=m,this.playButton=null,this.pauseButton=null,this.stopButton=null,this.replayButton=null,this.clickPlay=null,this.disposed=!1,s=ra.get(s)||s||"",this.object=co(`playback-${r}`),this.textLabel=new st(e,`playback-${r}-label`,"none",{minHeight:je,minWidth:4*je,maxWidth:4*je,padding:.02,scale:1e3,bgFillColor:t.labelFillColor,textFillColor:"white"}),this.textLabel.image.value=s,this.textLabel.image.addEventListener("redrawn",()=>this.repositionLabel()),this.progressBar=new Yt(4*je,.025,.01,xo),this.progressBar.visible=!1,this.clickPlay=async()=>{this.player.data!==this.data&&await this.player.load(this.data,this),this.player.volume=this.volume,await this.player.play()},this.load(t,m)}dispose(){this.disposed||(this.data===this.player.data&&this.player.clear(),We(this.object),this.disposed=!0)}repositionLabel(){this.textLabel.position.y=-(je+this.textLabel.objectHeight)/2}async load(e,t){let[n,r,s,l]=await ot(e.getMeshButton("media","play",je),e.getMeshButton("media","pause",je),e.getMeshButton("media","stop",je),e.getMeshButton("media","replay",je));de(this,this.playButton=n,this.pauseButton=r,this.stopButton=s,this.replayButton=l,this.progressBar,this.textLabel),this.playButton.object.position.x=-1.5*je,this.pauseButton.object.position.x=-.5*je,this.stopButton.object.position.x=.5*je,this.replayButton.object.position.x=1.5*je,this.progressBar.position.y=-je/2,this.progressBar.position.z=.01,this.repositionLabel();let m=()=>{let f=t.data===this.data;this.playButton.disabled=f&&(t.playbackState==="loading"||t.playbackState==="playing"||t.playbackState==="errored")||!f&&t.playbackState==="loading",this.pauseButton.disabled=!f||t.playbackState==="loading"||t.playbackState!=="playing",this.replayButton.disabled=this.stopButton.disabled=!f||t.playbackState==="loading"||t.playbackState==="stopped"||t.playbackState==="errored",(!f||t.playbackState==="loading"||t.playbackState==="stopped")&&(this.progressBar.visible=!1)};m();let u=f=>F=>{F.source.data===this.data&&f(F)},i=u(m);t.addEventListener("loading",m),t.addEventListener("loaded",i),t.addEventListener("played",i),t.addEventListener("paused",i),t.addEventListener("stopped",m),t.addEventListener("progress",u(f=>this.report(f.value,f.total))),t.addEventListener("played",u(()=>this.dispatchEvent(yu))),t.addEventListener("stopped",u(()=>this.dispatchEvent(Eu)));let c=(f,F)=>{f.addEventListener("click",F)};c(this.playButton,this.clickPlay),c(this.pauseButton,()=>t.pause()),c(this.stopButton,()=>t.stop()),c(this.replayButton,()=>t.restart())}get label(){return X(this.textLabel.image)?this.textLabel.image.value:null}set label(e){e=ra.get(e)||e,this.textLabel.image.value=e}report(e,t,n,r){super.report(e,t,n,r);let s=this.p*4*je;this.progressBar.position.x=.5*(s-4*je),this.progressBar.scale.x=s,this.progressBar.visible=e>0}};var Ao=new Re,ko=class{constructor(e,t,n,r){this.scenario=e;this.parent=t;this.player=n;this.zone=r.zone,this.minDistance=r.minDistance,this.maxDistance=r.maxDistance,this.spatialize=r.spatialize,this.effect=r.effect,this.label=r.label,this.volume=r.volume,this.enabled=r.enabled,this.transformID=r.transformID,this.key=r.key,this.scenarioID=r.scenarioID,this.fileID=r.fileID,this.fileName=r.fileName,this.filePath=r.filePath,this.fileTagString=r.fileTagString,this.mediaType=r.mediaType,this.trueMediaType=r.trueMediaType,this.copyright=r.copyright,this.copyrightDate=r.copyrightDate}scenarioID;key;fileID;filePath;fileTagString;mediaType;trueMediaType;copyright;copyrightDate;spatialize;transformID;zone;minDistance;maxDistance;effect;label;volume;enabled;fileName;clip=null;controls=null;error=null;get effects(){return ce(this.effect)?[]:this.effect.split(",").map(e=>e.trim()).filter(e=>e.length>0)}async load(e){if(X(this.error))return Promise.resolve();this.disposed=!1;try{this.spatialize?(this.clip=await this.scenario.env.audio.createClip(this.transformID.toString(),this.filePath,this.spatialize,this.spatialize,this.spatialize,this.spatialize,this.volume,this.effects,e),this.clip.spatializer.setAudioProperties(this.minDistance,this.maxDistance,this.scenario.env.audio.algorithm),this.updateAudioPosition()):(de(this.parent,this.controls=new Zt(this.scenario.env,this.scenario.env.uiButtons,this.filePath,`${this.fileName}(${this.transformID})`,this.label,this.volume,this.player)),this.controls.addScopedEventListener(this,"play",()=>{this.scenario.log("play audio",{id:this.transformID})}),this.controls.addScopedEventListener(this,"stop",()=>{this.scenario.log("stop audio",{id:this.transformID})}))}catch(t){this.error=t,this.dispose()}}async reload(e){let t=this.clip&&this.clip.playbackState==="playing";this.dispose(),this.player.cacheBust(this.filePath),await this.load(e),t&&this.clip.play()}updateAudioPosition(){this.parent.getWorldPosition(Ao),this.scenario.env.audio.setClipPosition(this.transformID.toString(),Ao.x,Ao.y,Ao.z)}disposed=!1;dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){X(this.clip)&&(this.scenario.env.audio.removeClip(this.transformID.toString()),this.clip=null),X(this.controls)&&(this.controls.removeScope(this),this.controls.object.removeFromParent(),this.controls.dispose(),this.controls=null)}play(){return X(this.error)?Promise.resolve():X(this.clip)?this.clip.play():this.controls.clickPlay()}reset(){X(this.error)||(X(this.clip)?this.clip.stop():this.player.stop())}};var Br="Juniper:ThreeJS:EventSystem:RayTarget",Ze=class extends xe{constructor(e){super(),this.object=e,this.meshes=new Array,this._disabled=!1,this._clickable=!1,this._draggable=!1,this._navigable=!1,this.object.userData[Br]=this}addMesh(e){return e.userData[Br]=this,this.meshes.push(e),this}removeMesh(e){return nt(this.meshes,e)&&delete e.userData[Br],this}addMeshes(...e){for(let t of e)this.addMesh(t);return this}removeMeshes(...e){for(let t of e)this.removeMesh(t);return this}get disabled(){return this._disabled}set disabled(e){this._disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get clickable(){return this._clickable}set clickable(e){this._clickable=e}get draggable(){return this._draggable}set draggable(e){this._draggable=e}get navigable(){return this._navigable}set navigable(e){this._navigable=e}};var To=class extends Ze{constructor(e,t,n,r){if(super(co(t)),this.env=e,X(n)){r=Object.assign({textFillColor:"white",fontFamily:"Segoe UI Emoji",fontSize:20,minHeight:.25,maxHeight:.25},r,{value:n}),this.image=new It(r);let s=un(16);this.enabledImage=this.createImage(`${s}-enabled`,1),this.disabledImage=this.createImage(`${s}-disabled`,.5),this.disabledImage.visible=!1,de(this,this.enabledImage,this.disabledImage)}this.addMesh(this.enabledImage.mesh),this.addMesh(this.disabledImage.mesh),this.clickable=!0,X(n)&&xs(this,!0)}createImage(e,t){return new st(this.env,`text-${e}`,"none",this.image,{side:io,opacity:t})}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.enabledImage.visible=!e,this.disabledImage.visible=e}};var ia=` ${Ds.textStyle} `,Du=new He,En=class o extends ct{constructor(t,n,r,s,l){super();this.env=t;this.transform=n;this.from=r;this.to=s;l=l||ia,this.icon=new To(this.env,"navButton",l,vs),this.icon.addEventListener("click",m=>{this.enabled&&this.dispatchEvent(m)}),this.transform.scale.setScalar(.5),this.progressBar=new Yt(this.icon.image.width,.025,.01,xo),this.progressBar.position.y=-this.icon.image.height/2,this.progressBar.position.z=.01,de(this.transform,de(this.icon,this.progressBar))}icon;progressBar;get object(){return this.transform}get fromStationID(){return this.from.transformID}get toStationID(){return this.to.transformID}get transformID(){return this.transform&&this.transform.transformID}report(t,n,r,s){super.report(t,n,r,s);let l=this.icon.image.width*this.p;this.progressBar.position.x=.5*(l-this.icon.image.width),this.progressBar.scale.x=l}get label(){return this.icon.image.value}set label(t){this.icon.image.value=this.icon.image.value=t||ia}get enabled(){return!this.icon.disabled}set enabled(t){this.icon.disabled=!t,this.progressBar.visible=!t}static calcMatrix(t,n,r,s=null){s=s||Du;let l=s.parent;return l&&l.remove(s),s.position.copy(n.position),s.position.sub(t.position),s.position.y=0,s.position.normalize(),s.position.multiplyScalar(1.5),s.position.y+=1,s.lookAt(0,r,0),s.updateMatrix(),l&&de(l,s),s.matrix}resetPosition(){o.calcMatrix(this.from,this.to,this.env.defaultAvatarHeight,this.object)}};var Pr=class extends Ie{constructor(e){super("dwell"),this.dwellTimeSeconds=e}},at=class extends xe{constructor(e=1,t=.25){super(),this.minTimeSeconds=e,this.graceTimeSeconds=t,this.startTime=null,this.graceTimer=null,Object.seal(this)}start(){this.stopGrace(),this.startTime===null&&(this.startTime=performance.now())}stopGrace(){this.graceTimer!==null&&(clearTimeout(this.graceTimer),this.graceTimer=null)}stop(){this.startTime!==null&&(this.graceTimer=setTimeout(()=>{this.graceTimer=null;let e=(performance.now()-this.startTime)/1e3;this.startTime=null,e>this.minTimeSeconds&&this.dispatchEvent(new Pr(e))},this.graceTimeSeconds*1e3))}};async function we(o,e){let{status:t,requestPath:n,responsePath:r,content:s,contentType:l,contentLength:m,fileName:u,headers:i,date:c}=o;return{status:t,requestPath:n,responsePath:r,content:X(e)?await e(s):void 0,contentType:l,contentLength:m,fileName:u,headers:i,date:c}}var bo=class extends Vn{constructor(e,t,n,r){if(!Qr.matches(n)&&!Zr.matches(n))throw new Error("Only GLTF model types are currently supported");super(t,n,r),this.env=e}async getResponse(e){let t=await e.file();return we(t,n=>this.env.loadGltf(n))}};var sa=it("Yarrow:Model:modelTemplateTasks",()=>new Map),vo=class extends He{constructor(t,n,r){super();this.scenario=t;this.name=`model-${n.fileName}`,this.key=n.key,this.scenarioID=n.scenarioID,this.fileID=n.fileID,this.fileName=n.fileName,this.filePath=n.filePath,this.fileTagString=n.fileTagString,this.transformID=n.transformID,this.mediaType=n.mediaType,this.trueMediaType=n.trueMediaType,this.copyright=n.copyright,this.copyrightDate=n.copyrightDate,this.target=new Ze(this),de(r,this),Object.seal(this)}model=null;key;scenarioID;fileID;fileName;filePath;fileTagString;mediaType;trueMediaType;copyright;copyrightDate;transformID;target;error=null;disposed=!1;dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){X(this.model)&&(this.model.removeFromParent(),We(this.model),this.model=null)}async load(t){if(X(this.error))return Promise.resolve();this.disposed=!1;let n=sa.get(this.filePath);if(!n){let l=new bo(this.scenario.env,this.filePath,this.mediaType,!this.scenario.env.DEBUG);n=l.then(m=>{try{zs(m.scene,qs)}catch(u){this.error=u}return m}),sa.set(this.filePath,n),this.scenario.env.fetcher.assets(t,l)}let r=await n,s=new at;s.addEventListener("dwell",l=>{this.scenario.log("model viewed",{id:this.transformID,time:l.dwellTimeSeconds})}),this.model=r.scene.clone(!0),this.model.traverse(l=>{kt(l)&&this.target.addMesh(l)}),this.target.addEventListener("enter",l=>{l.pointer.type==="nose"&&s.start()}),this.target.addEventListener("exit",l=>{l.pointer.type==="nose"&&s.stop()}),de(this,this.model)}async reload(t){this.dispose(),this.error=null,await this.load(t)}get size(){return this.parent.scale.x}set size(t){this.parent.scale.setScalar(t)}get rotationX(){return Ee(this.parent.rotation.x)}get rotationY(){return Ee(this.parent.rotation.y)}get rotationZ(){return Ee(this.parent.rotation.z)}};var ca=1e3,Mu=1e3/ca,aa=new Re,Rr=.15,Ir=.1,Cu={minHeight:Ir,maxHeight:Ir,minWidth:Ir,padding:.02,scale:1e3,bgFillColor:ho,textFillColor:"white"},yo=class o extends He{constructor(t,n,r){super();this.scenario=t;this.followObj=this.scenario.env.worldUISpace,this.onClick=()=>this.toggle(),this.key=n.key,this.scenarioID=n.scenarioID,this.fileID=n.fileID,this.fileName=n.fileName,this.filePath=n.filePath,this.fileTagString=n.fileTagString,this.mediaType=n.mediaType,this.trueMediaType=n.trueMediaType,this.copyright=n.copyright,this.copyrightDate=n.copyrightDate,this.transformID=n.transformID,this.name=`sign-${n.fileName}`,this.originPoint.copy(this.position),this.originRotation.copy(this.quaternion),de(r,this),this._alwaysVisible=n.alwaysVisible,this._isCallout=n.isCallout,this.start=-1,this.end=0,this.t=1,this.direction=-1,this.target=new Ze(this),this.scenario.addScopedEventListener(this,"present",s=>{this.direction!==-1&&s.source!==this&&this.toggle()})}image;start;end;t;direction;key;scenarioID;fileID;fileName;filePath;fileTagString;mediaType;trueMediaType;copyright;copyrightDate;transformID;followObj;onClick;target;static offsetMatrix=new Qe().makeTranslation(0,0,-1.5);originPoint=new Re;originRotation=new Pt;_isCallout=!1;wasCallout=null;_alwaysVisible=!1;wasAlwaysVisible=null;opacity=1;lastOpacity=null;file=null;pdf=null;zoomInButton=null;zoomOutButton=null;prevButton=null;pageLabel=null;nextButton=null;error=null;disposed=!1;dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){this.scenario.removeScope(this),X(this.image)&&(this.image.dispose(),this.image=null),this.removeButton(this.zoomInButton),this.zoomInButton=null,this.removeButton(this.zoomOutButton),this.zoomOutButton=null,this.removeButton(this.prevButton),this.prevButton=null,this.removeButton(this.nextButton),this.nextButton=null,this.removeButton(this.pageLabel),this.pageLabel=null,this.pdf=null}removeButton(t){X(t)&&(t instanceof xe&&t.removeScope(this),kn(t)&&(t.object.removeFromParent(),We(t)))}async load(t){if(X(this.error))return Promise.resolve();this.disposed=!1;try{let[n,r,s]=await ot(this.scenario.env.fetcher.get(this.filePath).progress(t).file(),this.scenario.env.uiButtons.getMeshButton("zoom","in",Rr),this.scenario.env.uiButtons.getMeshButton("zoom","out",Rr));if(this.file=n,this.zoomInButton=r,this.zoomInButton.addScopedEventListener(this,"click",this.onClick),this.zoomInButton.object.visible=this.isCallout,this.zoomOutButton=s,this.zoomOutButton.addScopedEventListener(this,"click",this.onClick),this.zoomOutButton.object.visible=!1,de(this,this.zoomInButton,this.zoomOutButton),Jr.matches(this.file.contentType)){this.pdf=new qt(this.file.content,{scale:2});let[m,u]=await ot(this.scenario.env.uiButtons.getMeshButton("arrow","left",.1),this.scenario.env.uiButtons.getMeshButton("arrow","right",.1));de(this,this.prevButton=m,this.pageLabel=new st(this.scenario.env,"label-"+this.transformID,"none",Cu,{side:io}),this.nextButton=u),this.prevButton.addScopedEventListener(this,"click",()=>this.loadImage(this.pdf.curPageIndex-1)),this.nextButton.addScopedEventListener(this,"click",()=>this.loadImage(this.pdf.curPageIndex+1))}de(this,this.image=new bt(this.scenario.env,`Sign(${this.key}) ${n.fileName}`,"dynamic"));let l=new at;l.addEventListener("dwell",m=>{this.scenario.log("sign viewed",{id:this.transformID,time:m.dwellTimeSeconds})}),this.target.clickable=!0,this.target.addEventListener("click",this.onClick),this.target.addEventListener("enter",m=>{m.pointer.type==="nose"&&l.start()}),this.target.addEventListener("exit",m=>{m.pointer.type==="nose"&&l.stop()}),await this.loadImage(0)}catch(n){this.error=n,this.dispose()}}async reload(t){this.dispose(),this.error=null,await this.load(t)}async loadImage(t){this.pdf&&(this.prevButton.disabled=!0,this.nextButton.disabled=!0);let n=await this.getFrame(t);if(this.image.setTextureMap(n),this.image.objectWidth=1,this.pdf){let r=this.image.objectHeight/2;this.prevButton.object.visible=this.pageLabel.object.visible=this.nextButton.object.visible=this.hasPages,this.hasPages&&(this.prevButton.object.position.set(-.5,-r,.1),this.pageLabel.position.set(0,-r,.1),this.nextButton.object.position.set(.5,-r,.1),this.prevButton.disabled=!this.pdf.canGoBack,this.pageLabel.image.value=`${this.pdf.curPageNumber} of ${this.pdf.numPages}`,this.nextButton.disabled=!this.pdf.canGoForward)}}async getFrame(t){return this.pdf?(this.scenario.log("view sign page",{id:this.transformID,page:t}),await this.pdf.getPage(t),this.pdf.canvas):await this.scenario.env.fetcher.get(this.file.content).image().then(ke)}get isCallout(){return this._isCallout}set isCallout(t){this._isCallout=t,this.update(0)}get hasPages(){return this.pdf&&this.pdf.numPages>1}get alwaysVisible(){return this._alwaysVisible}set alwaysVisible(t){this._alwaysVisible=t,this.update(0)}get isClickable(){return this.isCallout||!this.alwaysVisible}get showZoomIn(){return this.isClickable&&this.direction===-1&&this.t>=this.end}get showZoomOut(){return this.isClickable&&this.direction===1&&this.t>=this.end}toggle(){if(!X(this.error)&&this.isClickable){if(this.direction!==1){this.scenario.log("expand sign",{id:this.transformID}),this.target.addMesh(this.image.mesh),this.direction=1;let n=new en(this);this.scenario.dispatchEvent(n)}else this.target.removeMesh(this.image.mesh),this.direction=-1;let t=Math.max(0,this.end-this.t);this.start=performance.now(),this.end=this.start+ca,this.t=this.start+t}}reset(){X(this.error)||(this.isClickable&&(this.start=-1,this.t=0,this.end=0,this.direction=-1),X(this.image)&&this.image.removeWebXRLayer())}invMatrix=new Qe;dumpScale=new Re;update(t){if(X(this.error)||!X(this.parent))return;if(X(this.zoomInButton)&&(this.zoomInButton.object.visible=this.showZoomIn,this.zoomOutButton.object.visible=this.showZoomOut,this.isCallout!==this.wasCallout||this.alwaysVisible!==this.wasAlwaysVisible)){let l=this.image.objectWidth/2,m=this.image.objectHeight/2;this.zoomInButton.object.visible=this.isClickable,this.zoomOutButton.object.visible=!1,this.alwaysVisible?this.zoomInButton.object.position.set(l,m,.1):this.zoomInButton.object.position.set(0,0,0),this.zoomOutButton.object.position.set(l,m,.1),this.wasCallout=this.isCallout,this.wasAlwaysVisible=this.alwaysVisible}this.t+=Mu*t;let n=Qn(this.t,this.start,this.end),r=At(n,0,1),s=this.direction===1?1-r:r;this.isCallout&&(this.invMatrix.copy(this.parent.matrixWorld).invert().multiply(this.followObj.matrixWorld).multiply(o.offsetMatrix).decompose(this.position,this.quaternion,this.dumpScale),this.position.lerp(this.originPoint,s),this.quaternion.slerp(this.originRotation,s)),X(this.zoomInButton)&&(this.zoomInButton.object.lookAt(this.scenario.env.avatar.worldPos),this.zoomInButton.object.getWorldPosition(aa),this.zoomInButton.size=this.zoomOutButton.size=Rr*aa.sub(this.scenario.env.avatar.worldPos).length()/(3*this.size),this.zoomOutButton.object.matrix.copy(this.zoomInButton.object.matrix)),this.alwaysVisible?this.opacity=1:this.opacity=this.alwaysVisible?1:1-s,this.opacity!==this.lastOpacity&&(this.image.mesh.material.opacity=this.opacity,this.image.mesh.material.transparent=this.opacity<1,this.image.mesh.material.needsUpdate=!0,this.image.mesh.visible=0<this.opacity&&this.opacity<1||!(this.scenario.env.showWebXRLayers&&this.scenario.env.hasXRCompositionLayers),this.image.webXRLayerType=this.opacity===1?"dynamic":"none",X(this.pdf)&&(this.prevButton.object.visible=this.pageLabel.object.visible=this.nextButton.object.visible=this.hasPages&&this.opacity===1),this.lastOpacity=this.opacity)}get size(){return this.parent.scale.x}set size(t){this.parent.scale.setScalar(t)}get rotationX(){return Ee(this.parent.rotation.x)}get rotationY(){return Ee(this.parent.rotation.y)}get rotationZ(){return Ee(this.parent.rotation.z)}};var Eo=class{constructor(e,t){this.scenario=e;this.key=t.key,this.scenarioID=t.scenarioID,this.transformID=t.transformID,this.fileID=t.fileID,this.fileName=t.fileName,this.filePath=t.filePath,this.fileTagString=t.fileTagString,this.mediaType=t.mediaType,this.trueMediaType=t.trueMediaType,this.copyright=t.copyright,this.copyrightDate=t.copyrightDate,this.location=t.location,this.zone=t.zone,this.label=t.label,this.rotation=t.rotation}key;scenarioID;transformID;fileID;filePath;fileTagString;mediaType;trueMediaType;copyright;copyrightDate;location;zone;label;rotation;fileName;async reload(e){this.scenario.evict(this),this.scenario.curStation===this&&await this.scenario.env.withFade(async()=>{this.scenario.env.skybox.clear(),await this.scenario.showStation(this,!1,e)})}};var pa=1e3,Lu=1e3/pa,la=new Re,ua=.15,Or=.2,Bu={minHeight:Or,maxHeight:Or,minWidth:Or,padding:.04,scale:1e3,bgFillColor:"white",textFillColor:"black",bgStrokeColor:ho,bgStrokeSize:.01},Do=class o extends He{constructor(t,n,r){super();this.scenario=t;this.followObj=this.scenario.env.worldUISpace,this.onClick=()=>this.toggle(),this.key=n.key,this.scenarioID=n.scenarioID,this.fileID=n.fileID,this.fileName=n.fileName,this.filePath=n.filePath,this.fileTagString=n.fileTagString,this.mediaType=n.mediaType,this.trueMediaType=n.trueMediaType,this.copyright=n.copyright,this.copyrightDate=n.copyrightDate,this.transformID=n.transformID,this.name=`text-${n.fileName}`,this.originPoint.copy(this.position),this.originRotation.copy(this.quaternion),de(r,this),this._alwaysVisible=n.alwaysVisible,this._isCallout=n.isCallout,this.start=-1,this.end=0,this.t=1,this.direction=-1,this.target=new Ze(this),this.scenario.addScopedEventListener(this,"present",s=>{this.direction!==-1&&s.source!==this&&this.toggle()})}image;start;end;t;direction;key;scenarioID;fileID;fileName;filePath;fileTagString;mediaType;trueMediaType;copyright;copyrightDate;transformID;get text(){return this.image.image.value}set text(t){this.image.image.value=t}followObj;onClick;target;static offsetMatrix=new Qe().makeTranslation(0,0,-1.5);originPoint=new Re;originRotation=new Pt;_isCallout=!1;wasCallout=null;_alwaysVisible=!1;wasAlwaysVisible=null;opacity=1;lastOpacity=null;zoomInButton=null;error=null;disposed=!1;dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){this.scenario.removeScope(this),X(this.image)&&(this.image.dispose(),this.image=null),this.removeButton(this.zoomInButton),this.zoomInButton=null}removeButton(t){X(t)&&(t instanceof xe&&t.removeScope(this),kn(t)&&(t.object.removeFromParent(),We(t)))}async load(t){if(X(this.error))return Promise.resolve();this.disposed=!1;try{let[n,r]=await ot(this.scenario.env.fetcher.get(this.filePath).progress(t).text(),this.scenario.env.uiButtons.getMeshButton("zoom","info",ua));this.zoomInButton=r,this.zoomInButton.addScopedEventListener(this,"click",this.onClick),this.zoomInButton.object.visible=this.isCallout,de(this,this.zoomInButton),de(this,this.image=new st(this.scenario.env,`Text(${this.key}) ${n.fileName}`,"dynamic",Bu));let s=new at;s.addEventListener("dwell",l=>{this.scenario.log("text viewed",{id:this.transformID,time:l.dwellTimeSeconds})}),this.target.clickable=!0,this.target.addEventListener("click",this.onClick),this.target.addEventListener("enter",l=>{l.pointer.type==="nose"&&s.start()}),this.target.addEventListener("exit",l=>{l.pointer.type==="nose"&&s.stop()}),this.image.image.value=n.content}catch(n){this.error=n,this.dispose()}}async reload(t){this.dispose(),this.error=null,await this.load(t)}get isCallout(){return this._isCallout}set isCallout(t){this._isCallout=t,this.update(0)}get alwaysVisible(){return this._alwaysVisible}set alwaysVisible(t){this._alwaysVisible=t,this.update(0)}get isClickable(){return this.isCallout||!this.alwaysVisible}get showZoomIn(){return this.isClickable&&this.direction===-1&&this.t>=this.end}toggle(){if(!X(this.error)&&this.isClickable){if(this.direction!==1){this.scenario.log("expand text",{id:this.transformID}),this.target.addMesh(this.image.mesh),this.direction=1;let n=new en(this);this.scenario.dispatchEvent(n)}else this.target.removeMesh(this.image.mesh),this.direction=-1;let t=Math.max(0,this.end-this.t);this.start=performance.now(),this.end=this.start+pa,this.t=this.start+t}}reset(){X(this.error)||(this.isClickable&&(this.start=-1,this.t=0,this.end=0,this.direction=-1),X(this.image)&&this.image.removeWebXRLayer())}invMatrix=new Qe;dumpScale=new Re;update(t){if(X(this.error)||!X(this.parent))return;if(X(this.zoomInButton)&&(this.zoomInButton.object.visible=this.showZoomIn,this.isCallout!==this.wasCallout||this.alwaysVisible!==this.wasAlwaysVisible)){let l=this.image.objectWidth/2,m=this.image.objectHeight/2;this.zoomInButton.object.visible=this.isClickable,this.alwaysVisible?this.zoomInButton.object.position.set(l,m,.1):this.zoomInButton.object.position.set(0,0,0),this.wasCallout=this.isCallout,this.wasAlwaysVisible=this.alwaysVisible}this.t+=Lu*t;let n=Qn(this.t,this.start,this.end),r=At(n,0,1),s=this.direction===1?1-r:r;this.isCallout&&(this.invMatrix.copy(this.parent.matrixWorld).invert().multiply(this.followObj.matrixWorld).multiply(o.offsetMatrix).decompose(this.position,this.quaternion,this.dumpScale),this.position.lerp(this.originPoint,s),this.quaternion.slerp(this.originRotation,s)),X(this.zoomInButton)&&(this.zoomInButton.object.lookAt(this.scenario.env.avatar.worldPos),this.zoomInButton.object.getWorldPosition(la),this.zoomInButton.size=ua*la.sub(this.scenario.env.avatar.worldPos).length()/(3*this.size)),this.alwaysVisible?this.opacity=1:this.opacity=this.alwaysVisible?1:1-s,this.opacity!==this.lastOpacity&&(this.image.mesh.material.opacity=this.opacity,this.image.mesh.material.transparent=this.opacity<1,this.image.mesh.material.needsUpdate=!0,this.image.mesh.visible=0<this.opacity&&this.opacity<1||!(this.scenario.env.showWebXRLayers&&this.scenario.env.hasXRCompositionLayers),this.image.webXRLayerType=this.opacity===1?"dynamic":"none",this.lastOpacity=this.opacity)}get size(){return this.parent.scale.x}set size(t){this.parent.scale.setScalar(t)}get rotationX(){return Ee(this.parent.rotation.x)}get rotationY(){return Ee(this.parent.rotation.y)}get rotationZ(){return Ee(this.parent.rotation.z)}};var Dn=class extends He{data;M=new Qe;constructor(e){super(),this.data=e,this.name=e.name,this.M.fromArray(e.matrix),this.M.decompose(this.position,this.quaternion,this.scale)}get transformID(){return this.data.id}};var da=ye("video")("vnd.yarrow.ytdlp+json","ytdlp.json","ytdlp","json"),ha=ye("image")("vnd.google.streetview.pano");var Mo=class extends He{constructor(t,n,r,s,l){super();this.scenario=t;this.proxy=n;this.player=s;this.label=l.label,this.volume=l.volume,this.enabled=l.enabled,this.transformID=l.transformID,this.key=l.key,this.scenarioID=l.scenarioID,this.fileID=l.fileID,this.fileName=l.fileName,this.filePath=l.filePath,this.fileTagString=l.fileTagString,this.mediaType=l.mediaType,this.trueMediaType=l.trueMediaType,this.copyright=l.copyright,this.copyrightDate=l.copyrightDate,this.sphereEncodingName=l.sphereEncodingName,this.stereoLayoutName=l.stereoLayoutName,this.name="video-"+l.fileName,de(r,de(this,this.thumbnail=new bt(this.scenario.env,"thumbnail-"+l.fileName,"static"))),this.size=r.scale.x,r.scale.setScalar(1),this.target=new Ze(this),Object.seal(this)}transformID;key;scenarioID;fileID;filePath;fileTagString;mediaType;trueMediaType;copyright;copyrightDate;fileName;label;volume;enabled;sphereEncodingName;stereoLayoutName;controls=null;data=null;error=null;thumbnail;target;disposed=!1;dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){X(this.thumbnail)&&this.thumbnail.dispose(),X(this.controls)&&(this.controls.removeScope(this),this.controls.dispose())}async load(t){if(X(this.error))return Promise.resolve();try{let n=Je(t,[10,1]);if(da.matches(this.mediaType)){this.data=await this.proxy.loadData(this.filePath,n.shift());let m=await this.scenario.env.fetcher.get(this.data.thumbnail.url).image(this.data.thumbnail.contentType).then(ke);this.thumbnail.setTextureMap(m),this.thumbnail.objectWidth=1,this.thumbnail.mesh.renderOrder=4}let r=this.label||this.data&&this.data.title&&this.data.title.substring(0,25)||this.fileName;de(this,de(this.controls=new Zt(this.scenario.env,this.scenario.env.uiButtons,this.data||this.filePath,this.filePath,r,this.volume,this.player))),this.controls.object.renderOrder=5,this.controls.object.position.y=-this.thumbnail.objectHeight/2,this.controls.object.position.z=.01;let s=m=>()=>{this.thumbnail.visible=!m,this.player.object.visible=m,m?(this.scenario.log("play video",{id:this.transformID}),de(this,this.player),this.player.setStereoParameters(this.sphereEncodingName,this.stereoLayoutName),this.player.object.position.set(0,0,0),this.player.object.quaternion.identity(),this.target.addMeshes(...this.player.meshes)):(this.scenario.log("stop video",{id:this.transformID}),this.target.removeMeshes(...this.player.meshes))};this.controls.addScopedEventListener(this,"play",s(!0)),this.controls.addScopedEventListener(this,"stop",s(!1));let l=new at;l.addEventListener("dwell",m=>{this.scenario.log("video viewed",{id:this.transformID,time:m.dwellTimeSeconds})}),this.target.addEventListener("enter",m=>{m.pointer.type==="nose"&&l.start()}),this.target.addEventListener("exit",m=>{m.pointer.type==="nose"&&l.stop()}),this.disposed=!1}catch(n){this.error=n,this.dispose()}}async reload(t){this.dispose(),await this.load(t)}reset(){X(this.error)||(this.player.stop(),X(this.thumbnail)&&this.thumbnail.removeWebXRLayer())}get size(){return this.scale.x}set size(t){this.scale.x=this.scale.y=t}get rotationX(){return Ee(this.parent.rotation.x)}get rotationY(){return Ee(this.parent.rotation.y)}get rotationZ(){return Ee(this.parent.rotation.z)}};function ma(){return"InstallTrigger"in globalThis}var Pu=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,Co=navigator.userAgent.match(Pu),Lo=!!Co,fT=Lo&&{major:parseFloat(Co[1]),minor:parseFloat(Co[2]),patch:parseFloat(Co[3])},xT=Lo&&/pacific/i.test(navigator.userAgent),FT=Lo&&/quest/i.test(navigator.userAgent),wT=Lo&&/quest 2/i.test(navigator.userAgent);var Wr="Worker"in globalThis;function ga(o){let e=new Pe,t=setInterval(()=>{o()&&(clearInterval(t),e.resolve())},100);return e}var Vr=null;function fa(o){return Vr===null&&(Vr=new Audio),Vr.canPlayType(o)!==""}var Bo=class{constructor(e,t,n,r=!1){this.fetcher=e,this.method=t,this.path=n,this.useBLOBs=r,this.prog=null,this.request={method:t,path:this.path.href,body:null,headers:null,timeout:null,withCredentials:!1,useCache:!1,retryCount:3}}retries(e){return this.request.retryCount=e,this}query(e,t){return this.path.searchParams.set(e,t),this.request.path=this.path.href,this}header(e,t){return this.request.headers===null&&(this.request.headers=new Map),this.request.headers.set(e.toLowerCase(),t),this}headers(e){for(let[t,n]of e.entries())this.header(t,n);return this}timeout(e){return this.request.timeout=e,this}progress(e){return this.prog=e,this}body(e,t){if(X(e)){let n=new Set,r=new Array;r.push(e);let s=!1;for(;!s&&r.length>0;){let l=r.shift();if(l&&!n.has(l))if(n.add(l),l instanceof Blob){s=!0;break}else he(l)||r.push(...Object.values(l))}if(s){let l=new FormData,m=new Map,u=new Set;for(let[i,c]of Object.entries(e))if(c instanceof Blob){let f=i+".name",F=e[f];he(F)&&(m.set(c,F),u.add(f))}for(let[i,c]of Object.entries(e))u.has(i)||(c instanceof Blob?l.append(i,c,m.get(c)):he(c)?l.append(i,c):X(c)&&Se(c.toString)?l.append(i,c.toString()):console.warn("Can't serialize value to formdata",i,c));e=l,t=void 0}this.request.body=e,this.content(t)}return this}withCredentials(){return this.request.withCredentials=!0,this}useCache(e=!0){return this.request.useCache=e,this}media(e,t){X(t)&&(he(t)||(t=t.value),this.header(e,t))}content(e){this.media("content-type",e)}accept(e){return this.media("accept",e),this}blob(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBlob(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBlob(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Be(this.method)}buffer(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBuffer(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBuffer(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Be(this.method)}async file(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return await this.fetcher.sendObjectGetFile(this.request,this.prog);if(this.method==="GET"){if(this.useBLOBs)return await this.fetcher.sendNothingGetFile(this.request,this.prog);{let t=await this.fetcher.sendNothingGetNothing(this.request);return we(t,()=>this.request.path)}}else{if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Be(this.method)}}text(e){if(this.accept(e||Wn),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetText(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetText(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Be(this.method)}object(e){if(this.accept(e||rr),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetObject(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetObject(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Be(this.method)}xml(e){if(this.accept(e||ei),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetXml(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetXml(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Be(this.method)}imageBitmap(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetImageBitmap(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetImageBitmap(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Be(this.method)}exec(){if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetNothing(this.request,this.prog);if(this.method==="GET")throw new Error("GET requests should expect a response type");if(this.method==="HEAD"||this.method==="OPTIONS")return this.fetcher.sendNothingGetNothing(this.request);Be(this.method)}async audioBlob(e){if(X(e)&&(he(e)||(e=e.value),!fa(e)))throw new Error(`Probably can't play file of type "${e}" at path: ${this.request.path}`);let t=await this.blob(e);if(fa(t.contentType))return t;throw new Error(`Cannot play file of type "${t.contentType}" at path: ${this.request.path}`)}async audioBuffer(e,t){return we(await this.audioBlob(t),async n=>await e.decodeAudioData(await n.arrayBuffer()))}async htmlElement(e,t,n){let r=await this.file(n),s=qe(e,t,"error");return e instanceof HTMLLinkElement?e.href=r.content:e.src=r.content,await s,await we(r,()=>e)}image(e){return this.htmlElement(Gn(),"load",e)}async htmlCanvas(e){let t=Ct(1,1);if(this.method==="GET")if(Dt){this.accept(e);let n=await this.fetcher.drawImageToCanvas(this.request,t.transferControlToOffscreen(),this.prog);return await we(n,()=>t)}else{let n=await this.image(e);return await we(n,r=>(t.width=r.width,t.height=r.height,Kn(t,r),Ne(r),t))}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Be(this.method)}}canvas(e){return Dt?this.offscreenCanvas(e):this.htmlCanvas(e)}async offscreenCanvas(e){if(!Dt)throw new Error("This system does not support OffscreenCanvas");if(this.method==="GET"){let t=await this.image(e);return await we(t,n=>{let r=hn(n.width,n.height);return Kn(r,n),Ne(n),r})}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Be(this.method)}}async style(){let e=wi(jn(sn),dr("stylesheet"));document.head.append(e);let t=await this.htmlElement(e,"load",sn);return we(t)}async getScript(){let e=_i(jn(wt));document.head.append(e);let t=await this.htmlElement(e,"load",wt);return we(t)}async script(e){let t=null,n=this.request.path;if(!e)t=await this.getScript();else if(!e()){let r=ga(e);t=await this.getScript(),await r}return this.prog&&this.prog.end(n),t}async module(){let e=this.request.path,t=await this.file(wt),n=await import(t.content);return this.prog&&this.prog.end(e),we(t,()=>n)}async wasm(e){let t=await this.buffer(sr);if(!sr.matches(t.contentType))throw new Error(`Server did not respond with WASM file. Was: ${t.contentType}`);let n=await WebAssembly.compile(t.content),r=await WebAssembly.instantiate(n,e);return we(t,()=>r.exports)}async worker(e="module"){let t=this.request.path,n=await this.file(wt);this.prog=null,this.request.timeout=null;let r=new Worker(n.content,{type:e});return this.prog&&this.prog.end(t),we(n,()=>r)}};var Po=class{constructor(e,t=!1){this.service=e,this.useBLOBs=t;{let n=xi("input[name=__RequestVerificationToken]");n&&this.service.setRequestVerificationToken(n.value)}}clearCache(){return this.service.clearCache()}evict(e,t){return this.service.evict(new URL(e,t||location.href).href)}request(e,t,n){return new Bo(this.service,e,new URL(t,n||location.href),this.useBLOBs)}head(e,t){return this.request("HEAD",e,t)}options(e,t){return this.request("OPTIONS",e,t)}get(e,t){return this.request("GET",e,t)}post(e,t){return this.request("POST",e,t)}put(e,t){return this.request("PUT",e,t)}patch(e,t){return this.request("PATCH",e,t)}delete(e,t){return this.request("DELETE",e,t)}async assets(e,t,...n){ce(n)&&(n=[]),n.unshift(t);let r;lr(e)?n.unshift(e):X(e)&&(r=e),n=n.filter(X);let s=await Promise.all(n.map(m=>m.getSize(this))),l=new Map(s);await oo(r,n.map(m=>[l.get(m),u=>m.fetch(this,u)]))}};var Ro=class{constructor(e){this.impl=e,this.defaultPostHeaders=new Map}setRequestVerificationToken(e){this.defaultPostHeaders.set("RequestVerificationToken",e)}clearCache(){return this.impl.clearCache()}evict(e){return this.impl.evict(e)}sendNothingGetNothing(e){return this.impl.sendNothingGetNothing(e)}sendNothingGetBlob(e,t){return this.impl.sendNothingGetSomething("blob",e,t)}sendObjectGetBlob(e,t){return this.impl.sendSomethingGetSomething("blob",e,this.defaultPostHeaders,t)}sendNothingGetBuffer(e,t){return this.impl.sendNothingGetSomething("arraybuffer",e,t)}sendObjectGetBuffer(e,t){return this.impl.sendSomethingGetSomething("arraybuffer",e,this.defaultPostHeaders,t)}sendNothingGetText(e,t){return this.impl.sendNothingGetSomething("text",e,t)}sendObjectGetText(e,t){return this.impl.sendSomethingGetSomething("text",e,this.defaultPostHeaders,t)}sendNothingGetObject(e,t){return this.impl.sendNothingGetSomething("json",e,t)}sendObjectGetObject(e,t){return this.impl.sendSomethingGetSomething("json",e,this.defaultPostHeaders,t)}sendObjectGetNothing(e,t){return this.impl.sendSomethingGetSomething("",e,this.defaultPostHeaders,t)}drawImageToCanvas(e,t,n){return this.impl.drawImageToCanvas(e,t,n)}async sendNothingGetFile(e,t){return we(await this.sendNothingGetBlob(e,t),URL.createObjectURL)}async sendObjectGetFile(e,t){return we(await this.sendObjectGetBlob(e,t),URL.createObjectURL)}async sendNothingGetXml(e,t){return we(await this.impl.sendNothingGetSomething("document",e,t),n=>n.documentElement)}async sendObjectGetXml(e,t){return we(await this.impl.sendSomethingGetSomething("document",e,this.defaultPostHeaders,t),n=>n.documentElement)}async sendNothingGetImageBitmap(e,t){return we(await this.sendNothingGetBlob(e,t),createImageBitmap)}async sendObjectGetImageBitmap(e,t){return we(await this.sendObjectGetBlob(e,t),createImageBitmap)}};function xa(o,e,t){return new Map(o.map(n=>[e(n),t(n)]))}function Fa(o,e){return xa(o,e,ln)}var Io=class o{static delete(e){let t=indexedDB.deleteDatabase(e),n=qe(t,"success","error","blocked");return ut(n)}static async open(e,...t){let n=Fa(t,E=>E.name),r=new lt(t.filter(E=>X(E.indexes)).flatMap(E=>E.indexes.map(P=>[E.name,P.name,P]))),s=new Array,l=new Array,m=new Array,u=new Oe,i=new Oe,c=null,f=indexedDB.open(e);if(await ut(qe(f,"success","error","blocked"))){let E=f.result;c=E.version;let P=new Array;for(let k of E.objectStoreNames)n.has(k)||l.push(k);for(let k of n.keys())E.objectStoreNames.contains(k)?P.push(k):s.push(k);if(P.length>0){let k=E.transaction(P),p=qe(k,"complete","error","abort"),g=ut(p);for(let A of P){let M=k.objectStore(A),D=n.get(A);X(D.options)&&M.keyPath!==D.options.keyPath&&(l.push(A),s.push(A));for(let V of M.indexNames)r.has(A,V)||(m.indexOf(A)===-1&&m.push(A),i.add(A,V));if(r.has(A))for(let V of r.get(A).keys())if(!M.indexNames.contains(V))m.indexOf(A)===-1&&m.push(A),u.add(A,V);else{let W=r.get(A,V),te=M.index(V);(he(W.keyPath)!==he(te.keyPath)||he(W.keyPath)&&he(te.keyPath)&&W.keyPath!==te.keyPath||tt(W.keyPath)&&tt(te.keyPath)&&In(W.keyPath,te.keyPath))&&(m.indexOf(A)===-1&&m.push(A),i.add(A,V),u.add(A,V))}}k.commit(),await g}Ne(E)}else{c=0,s.push(...n.keys());for(let E of t)if(X(E.indexes))for(let P of E.indexes)u.add(E.name,P.name)}(s.length>0||l.length>0||u.size>0||i.size>0)&&++c;let F=new Pe,S=X(c)?indexedDB.open(e,c):indexedDB.open(e),d=qe(S,"success","error","blocked"),_=ut(F),T=ut(d),R=F.resolver(!1);if(S.addEventListener("success",R),S.addEventListener("upgradeneeded",()=>{let E=qe(S.transaction,"complete","error","abort"),P=S.result;for(let p of l)P.deleteObjectStore(p);let k=new Map;for(let p of s){let g=n.get(p),A=P.createObjectStore(p,g.options);k.set(p,A)}for(let p of m){let g=S.transaction.objectStore(p);k.set(p,g)}for(let[p,g]of k){for(let A of i.get(p))g.deleteIndex(A);for(let A of u.get(p)){let M=r.get(p,A);g.createIndex(A,M.keyPath,M.options)}}ut(E).then(F.resolve).catch(F.reject).finally(()=>S.removeEventListener("success",R))}),!await _)throw F.error;if(!await T)throw d.error;return new o(S.result)}constructor(e){this.db=e}dispose(){Ne(this.db)}get name(){return this.db.name}get version(){return this.db.version}get storeNames(){return Array.from(this.db.objectStoreNames)}getStore(e){return new Nr(this.db,e)}},Nr=class{constructor(e,t){this.db=e,this.storeName=t}async request(e,t){let n=this.db.transaction(this.storeName,t),r=qe(n,"complete","error"),s=n.objectStore(this.storeName),l=e(s),m=qe(l,"success","error");if(!await ut(m))throw n.abort(),m.error;if(n.commit(),!await ut(r))throw r.error;return l.result}add(e,t){return this.request(n=>n.add(e,t),"readwrite")}clear(){return this.request(e=>e.clear(),"readwrite")}getCount(e){return this.request(t=>t.count(e),"readonly")}async has(e){return await this.getCount(e)>0}delete(e){return this.request(t=>t.delete(e),"readwrite")}get(e){return this.request(t=>t.get(e),"readonly")}getAll(){return this.request(e=>e.getAll(),"readonly")}getAllKeys(){return this.request(e=>e.getAllKeys(),"readonly")}getKey(e){return this.request(t=>t.getKey(e),"readonly")}openCursor(e,t){return this.request(n=>n.openCursor(e,t),"readonly")}openKeyCursor(e,t){return this.request(n=>n.openKeyCursor(e,t),"readonly")}put(e,t){return this.request(n=>n.put(e,t),"readwrite")}};function wa(o,...e){for(let t of e)if(X(t))for(let[n,r]of t)o.set(n,r);return o}var Hr=class extends Pe{constructor(e){super(!1),this.milliseconds=e,this._timer=null}start(){super.start(),this._timer=setTimeout(()=>{this._timer=null,this.resolve()},this.milliseconds)}reset(){super.reset(),X(this._timer)&&(clearTimeout(this._timer),this._timer=null)}};function _a(o){let e=new Hr(o);return e.start(),e}function Oo(o,e){return async()=>{let t=null,n=500;for(let r=0;r<=o;++r)try{return r>0&&(await _a(n),n*=2),await e()}catch(s){t=s}throw t}}function Ru(o){return he(o)||qr(o)||o instanceof Blob||o instanceof FormData||$r(o)||"Document"in globalThis&&o instanceof Document}function Wo(o,e,t,n,r,s){let l=!s;s&&s.then(()=>l=!0);let m=!1,u=r,i=new Pe;t.addEventListener("loadstart",()=>{l&&!m&&n&&n.start(o)}),t.addEventListener("progress",f=>{if(l&&!m){let F=f;n&&n.report(F.loaded,Math.max(F.loaded,F.total),o),F.loaded===F.total&&(u=!0,m&&i.resolve())}}),t.addEventListener("load",()=>{l&&!m&&(n&&n.end(o),m=!0,u&&i.resolve())});let c=f=>()=>{l&&i.reject(`${f} (${e.status})`)};return t.addEventListener("error",c("error")),t.addEventListener("abort",c("abort")),t.addEventListener("timeout",c("timeout")),i}function jr(o,e,t,n,r,s){if(o.open(e,t),o.responseType="blob",o.timeout=n,r)for(let[l,m]of r)o.setRequestHeader(l,m);X(s)?o.send(s):o.send()}function Vo(o,e,t){if(!o.has(e))return null;let n=o.get(e);try{let r=t(n);return o.delete(e),r}catch(r){console.warn(e,r)}return null}var Iu=/filename=\"(.+)\"(;|$)/,Ou="Juniper:Fetcher:Cache",No=class{constructor(){this.cache=null,this.store=null,this.tasks=new lt,this.cacheReady=this.openCache()}async drawImageToCanvas(e,t,n){let r=await this.sendNothingGetSomething("blob",e,n),s=r.content;return si(await createImageBitmap(s,{imageOrientation:"from-image"}),l=>(t.width=l.width,t.height=l.height,t.getContext("2d").drawImage(l,0,0),we(r)))}async openCache(){let e={keyPath:"requestPath"};this.cache=await Io.open(Ou,{name:"files",options:e}),this.store=await this.cache.getStore("files")}async clearCache(){await this.cacheReady,await this.store.clear()}async evict(e){await this.cacheReady,this.store.has(e)&&await this.store.delete(e)}async readResponseHeaders(e,t){let n=t.getAllResponseHeaders().split(/[\r\n]+/).map(F=>F.trim()).filter(F=>F.length>0).map(F=>{let S=F.split(": "),d=S.shift().toLowerCase(),_=S.join(": ");return[d,_]}),r=new Oe(n),s=Array.from(r.keys()).map(F=>[F,r.get(F).join(", ")]),l=new Map(s),m=Vo(l,"content-type",ln),u=Vo(l,"content-length",parseFloat),i=Vo(l,"date",F=>new Date(F)),c=Vo(l,"content-disposition",F=>{if(X(F)){let S=F.match(Iu);if(X(S))return S[1]}return null});return{status:t.status,requestPath:e,responsePath:t.responseURL,content:void 0,contentType:m,contentLength:u,fileName:c,date:i,headers:l}}async readResponse(e,t){let{responsePath:n,status:r,contentType:s,contentLength:l,fileName:m,date:u,headers:i}=await this.readResponseHeaders(e,t),c={requestPath:e,responsePath:n,status:r,contentType:s,contentLength:l,fileName:m,date:u,headers:i,content:t.response};return X(c.content)&&(c.contentType=c.contentType||c.content.type,c.contentLength=c.contentLength||c.content.size),c}async decodeContent(e,t){return we(t,async n=>{if(e==="")return null;if(ce(t.contentType)){let r=Array.from(t.headers.entries()).map(s=>s.join(": ")).join(`
  `);throw new Error(`No content type found in headers: 
  `+r)}else{if(e==="blob")return n;if(e==="arraybuffer")return await n.arrayBuffer();if(e==="json"){let r=await n.text();return r.length>0?JSON.parse(r):null}else if(e==="document"){let r=new DOMParser;if(t.contentType==="application/xhtml+xml"||t.contentType==="text/html"||t.contentType==="application/xml"||t.contentType==="image/svg+xml"||t.contentType==="text/xml")return r.parseFromString(await n.text(),t.contentType);throw new Error("Couldn't parse document")}else{if(e==="text")return await n.text();Be(e)}}})}async withCachedTask(e,t){return e.method!=="GET"&&e.method!=="HEAD"&&e.method!=="OPTIONS"?await t():(this.tasks.has(e.method,e.path)||this.tasks.add(e.method,e.path,t().finally(()=>this.tasks.delete(e.method,e.path))),this.tasks.get(e.method,e.path))}sendNothingGetNothing(e){return this.withCachedTask(e,Oo(e.retryCount,async()=>{let t=new XMLHttpRequest,n=Wo(`requesting: ${e.path}`,t,t,null,!0);return jr(t,e.method,e.path,e.timeout,e.headers),await n,await this.readResponseHeaders(e.path,t)}))}sendNothingGetSomething(e,t,n){return this.withCachedTask(t,Oo(t.retryCount,async()=>{let r=null,s=t.useCache&&t.method==="GET";s&&(X(n)&&n.start(),await this.cacheReady,r=await this.store.get(t.path));let l=ce(r);if(l){let u=new XMLHttpRequest,i=Wo(`requesting: ${t.path}`,u,u,n,!0);jr(u,t.method,t.path,t.timeout,t.headers),await i,r=await this.readResponse(t.path,u),s&&await this.store.add(r)}let m=await this.decodeContent(e,r);return l&&X(n)&&n.end(),m}))}sendSomethingGetSomething(e,t,n,r){let s=null,l=wa(new Map,n,t.headers),m=null;if(X(l)){let S=new Array;for(let d of l.keys())d.toLowerCase()==="content-type"&&S.push(d);if(S.length>0){t.body instanceof FormData||(m=l.get(S[0]),S.shift());for(let d of S)l.delete(d)}}Ru(t.body)&&!he(t.body)||he(t.body)&&Wn.matches(m)?s=t.body:X(t.body)&&(s=JSON.stringify(t.body));let u=X(s),i=ni(r,u?2:1),[c,f]=i,F=async()=>{let S=new XMLHttpRequest,d=u?Wo("uploading",S,S.upload,c,!1):Promise.resolve(),_=Wo("saving",S,S,f,!0,d);jr(S,t.method,t.path,t.timeout,l,s),await d,await _;let T=await this.readResponse(t.path,S);return await this.decodeContent(e,T)};return Oo(t.retryCount,F)()}};function Xr(o){return X(o)&&Se(o.report)&&Se(o.attach)&&Se(o.end)}var Mn=class extends xe{constructor(e){super(),this.worker=e,this.invocations=new Map,this.tasks=new Array,this.taskCounter=0,Wr||console.warn("Workers are not supported on this system."),this.worker.addEventListener("message",t=>{let n=t.data;switch(n.type){case"event":this.propogateEvent(n);break;case"progress":this.progressReport(n);break;case"return":this.methodReturned(n);break;case"error":this.invocationError(n);break;default:Be(n)}})}postMessage(e,t){e.type!=="methodCall"&&Be(e.type),t?this.worker.postMessage(e,t):this.worker.postMessage(e)}dispose(){this.worker.terminate()}progressReport(e){let t=this.invocations.get(e.taskID);if(t){let{prog:n}=t;n&&n.report(e.soFar,e.total,e.msg,e.est)}}methodReturned(e){let t=this.removeInvocation(e.taskID),{task:n}=t;n.resolve(e.returnValue)}invocationError(e){let t=this.removeInvocation(e.taskID),{task:n,methodName:r}=t;n.reject(new Error(`${r} failed. Reason: ${e.errorMessage}`))}removeInvocation(e){let t=this.invocations.get(e);return this.invocations.delete(e),t}callMethod(e,t,n,r){if(!Wr)return Promise.reject(new Error("Workers are not supported on this system."));let s=null,l=null;Xr(t)&&(r=t,t=null,n=null),Xr(n)&&!r&&(r=n,n=null),tt(t)&&(s=t),tt(n)&&(l=n);let m=this.taskCounter++,u=Ft(this.tasks,f=>f.finished);u?u.reset():(u=new Pe,this.tasks.push(u));let i={methodName:e,task:u,prog:r};this.invocations.set(m,i);let c=null;return X(t)?c={type:"methodCall",taskID:m,methodName:e,params:s}:c={type:"methodCall",taskID:m,methodName:e},this.postMessage(c,l),u}};var Cn=class extends xe{constructor(e,t){super(),this.scriptPath=e.scriptPath;let n=-1,r=e.workers,s=null;if(Le(r)?n=r:X(r)?(this.taskCounter=r.curTaskCounter,s=r.workers,n=s.length):n=navigator.hardwareConcurrency||4,n<1)throw new Error("Worker pool size must be a postive integer greater than 0");if(this.workers=new Array(n),ce(s)){this.taskCounter=0;for(let l=0;l<n;++l)this.workers[l]=new t(new Worker(this.scriptPath,{type:"module"}))}else for(let l=0;l<n;++l)this.workers[l]=new t(s[l]);for(let l of this.workers)l.addBubbler(this)}dispose(){this.workers.forEach(Ne),be(this.workers)}nextWorker(){let e=this.peekWorker();return this.taskCounter++,e}peekWorker(){return this.workers[this.taskCounter%this.workers.length]}};function Sa(o=!0){let e=new Ro(new No);return new Po(e,!bn)}function Aa(o,e,t,n){return`/Editor/Google/StreetView/Image/${o}/${e}/${t}/${n}/`}var Ho=class extends uo{constructor(e){super(e,!0)}loadFiles(e,t,n){return this.renderFaces(Aa.bind(null,e),t,n)}loadFile(e,t,n){return this.renderCubeMap(Aa.bind(null,e),t,n)}async loadImages(e,t,n){let r=await this.loadFiles(e,t,n);return await Promise.all(r.map(Xt))}async loadCanvas(e,t,n){let r=await this.loadFile(e,t,n),s=await Xt(r);return Jn(s)}};var jo=class extends Mn{canvases;init(e,t){this.callMethod("init",[e,t])}propogateEvent(e){Be(e.eventName)}loadFiles(e,t,n){return this.callMethod("loadFiles",[e,t],n)}loadFile(e,t,n){return this.callMethod("loadFile",[e,t],n)}async loadImages(e,t,n){let r=await this.loadFiles(e,t,n);return await Promise.all(r.map(Xt))}async loadCanvas(e,t,n){let r=await this.loadFile(e,t,n),s=await Xt(r);return Jn(s)}};var Xo=class extends Cn{constructor(e,t){e.workers!==1&&(e.workers=1),super(e,t)}get canvases(){return this.peekWorker().canvases}init(e,t){for(let n of this.workers)n.init(e,t)}loadImages(e,t,n){return this.nextWorker().loadImages(e,t,n)}loadCanvas(e,t,n){return this.nextWorker().loadCanvas(e,t,n)}};async function ka(o,e,t){let n=null;if(xt(e)?t=e:n=e,n=n||new pt,!ma()&&t){let r=await o.get(Es("three")).text().then(ke);n.check();let s=await o.get(ys("photosphere-capture")).text().then(ke);n.check();let l=r+s,m=new Blob([l],{type:wt.value}),u=URL.createObjectURL(m);return new Xo({scriptPath:u},jo)}else return o=o||Sa(!1),new Ho(o)}function Ta(o){return ce(o)?null:(he(o)&&(o=new URL(o,location.href)),o)}function Wu(o){if(ce(o))throw new Error("URL is undefined");if(o=Ta(o),Er(o)){let e=Array.from(o.searchParams.keys()).filter(t=>t!=="v"&&t!=="t");for(let t of e)o.searchParams.delete(t)}return o}function ba(o){if(o=Ta(o),ce(o))throw new Error("URL is undefined");return o=Wu(o),new Gt("/vr/link",location.href).query("q",o.href).toURL()}var Ur=class extends Ie{constructor(t){super("navigate");this.station=t}},en=class extends Event{source;constructor(e){super("present"),this.source=e,Object.seal(this)}},Uo=class extends xe{constructor(t,n,r){super();this.env=t;this.dataLogger=n;this.data=r;this.imgCache.addEventListener("itemevicted",m=>{$n(m.value)&&m.value.close()}),this.yt=new po(this.env.fetcher,ba),X(r.origin)&&(this._originLL=new Ut(r.origin)),this.startStationID=r.startStationID,this.startRotation=r.startRotation,this.transforms=r.transforms,this.connections=r.connections,this.env.addScopedEventListener(this,"environmentaudiotoggled",()=>{this.environmentAudioMuted=t.environmentAudioMuted});let s=!1,l=()=>{s||(s=!0,this.logLeaveStation(),this.log("leave scenario",{id:this.id}))};this.env.addScopedEventListener(this,"quitting",l),this.windowQuitter.addScopedEventListener(this,"quitting",l),this.env.addScopedEventListener(this,"sceneclearing",()=>{this.pauseCurrentAudioZone(),this.curZone=null}),this.env.avatar.addScopedEventListener(this,"avatarreset",()=>{this.moveToStation(this.curStation)})}yt;transforms;connections;stations=new Array;signs=new Array;videos=new Array;texts=new Array;audios=new Array;models=new Array;get isEmpty(){return this.stations.length===0&&this.connections.length===0&&this.signs.length===0&&this.videos.length===0&&this.texts.length===0&&this.audios.length===0&&this.models.length===0}signsByStation=new Oe;videosByStation=new Oe;textsByStation=new Oe;audiosByStation=new Oe;modelsByStation=new Oe;curConnections=new lt;transformsByTransformID=new Map;zonedClips=new Oe;playbackButtons=new Map;videosReady=null;cancellationToken=null;rig;curStationID=null;curZone=null;startStationID;startRotation;rootTransformID=null;get rootTransform(){return this.transformsByTransformID.get(this.rootTransformID)}__originLL=null;get _originLL(){return this.__originLL}set _originLL(t){this.__originLL=t,X(t)?this._originUTM=this.originLL.toUTM():this._originUTM=null}get originLL(){return this._originLL}_originUTM=null;get originUTM(){return this._originUTM}get id(){return this.data.id}get name(){return this.data.name}get version(){return this.data.version}get published(){return this.data.published}get roomName(){return this.data.roomName}windowQuitter=new Yn;async loadAssets(t){this.cancellationToken=new pt,this.clearCache(),this.rig=await ka(this.env.fetcher,this.cancellationToken),this.rig.init(location.href,this.env.DEBUG),t=t||this.env.loadingBar;let[n,r]=Je(t,[1,100]);await qt.prepare(mo("pdfjs"),this.env.fetcher,this.env.DEBUG,n);for(let m of this.data.transforms)this.addTransformData(m);for(let m of this.data.transforms)if(m.parentTransformID===0)this.rootTransformID=m.id;else{let u=this.getTransform(m.parentTransformID),i=this.getTransform(m.id);u.attach(i)}let[s,l]=Je(r,[10,1]);this.videosReady=mt(l,this.data.videoClips,(m,u)=>this.createVideo(m,u).catch(i=>{if(i instanceof gn)console.warn("Late load cancellation occured");else throw i})).then(()=>null),await oo(s,[[this.data.stations.length,m=>mt(m,this.data.stations,(u,i)=>this.createStation(u,i))],[this.data.signs.length,m=>mt(m,this.data.signs,(u,i)=>this.createSign(u,i))],[this.data.models.length,m=>mt(m,this.data.models,(u,i)=>this.createModel(u,i))],[this.data.audioTracks.length,m=>mt(m,this.data.audioTracks,(u,i)=>this.createAudio(u,i))],[this.data.texts.length,m=>mt(m,this.data.texts,(u,i)=>this.createText(u,i))]]);for(let m of this.data.connections)this.createConnection(m);this.env.addScopedEventListener(this,"update",m=>this.update(m))}disposed=!1;dispose(){if(!this.disposed){this.cancellationToken&&this.cancellationToken.cancel(),this.env.infoLabel.image.clear(),this.pauseCurrentAudioZone(),this.env.removeScope(this),this.env.avatar.removeScope(this);for(let n of this.audios)n.dispose();for(let n of this.signs)n.dispose();for(let n of this.models)n.dispose();for(let n of this.videos)n.dispose();for(let n of this.texts)n.dispose();let t=this.transformsByTransformID.get(this.rootTransformID);t.removeFromParent(),We(t),this.transformsByTransformID.clear(),this.signsByStation.clear(),this.audiosByStation.clear(),this.videosByStation.clear(),this.textsByStation.clear(),this.modelsByStation.clear(),this.zonedClips.clear(),be(this.audios),be(this.videos),be(this.texts),be(this.signs),be(this.models),this.windowQuitter.removeScope(this),this.disposed=!0}}get avatarHeightOffset(){return this.env.avatar.height-this.env.defaultAvatarHeight}update(t){let n=this.signsByStation.get(this.curStation);for(let s of n)s.update(t.dt);let r=this.textsByStation.get(this.curStation);for(let s of r)s.update(t.dt)}_muteEnvAudio=!1;get environmentAudioMuted(){return this._muteEnvAudio}set environmentAudioMuted(t){t!==this.environmentAudioMuted&&(this._muteEnvAudio=t,this.environmentAudioMuted?this.pauseCurrentAudioZone():this.playCurrentAudioZone())}addTransformData(t){let n=new Dn(t);return this.transformsByTransformID.set(n.transformID,n),n}getTransform(t){return this.transformsByTransformID.get(t)}getStation(t){return Ft(this.stations,n=>n.transformID===t)}get curStation(){return this.getStation(this.curStationID)}get startStation(){return this.getStation(this.startStationID)}async createStation(t,n){n&&n.end();let r=new Eo(this,t);return this.stations.push(r),r}async createConnection(t){try{let n=this.getStation(t.fromStationID),r=this.getStation(t.toStationID),s=this.getTransform(n.transformID),l=this.getTransform(r.transformID),m=this.getTransform(t.transformID);if(ce(m)){t.transformID=-this.transforms.length;let i={id:t.transformID,name:`nav-icon-from-${s.name}-to-${l.name}`,matrix:En.calcMatrix(s,l,this.env.defaultAvatarHeight).toArray(),parentTransformID:n.transformID};this.transforms.push(i),m=this.addTransformData(i),de(s,m)}let u=new En(this.env,m,s,l,t.label);return u.addEventListener("click",()=>{this.dispatchEvent(new Ur(r)),this.showStation(r,!0,this.env.loadingBar)}),this.curConnections.add(n,r,u),u}catch(n){return console.error({task:"createConnection",err:n,data:t}),null}}async createSign(t,n){let r=this.getTransform(t.transformID),s=new yo(this,t,r);this.signs.push(s),await s.load(n),this.cancellationToken.check();let l=this.findStation(s);return this.signsByStation.add(l,s),s}async createModel(t,n){let r=this.getTransform(t.transformID),s=new vo(this,t,r);this.models.push(s),await s.load(n),this.cancellationToken.check();let l=this.findStation(s);return this.modelsByStation.add(l,s),s}async createAudio(t,n){let r=this.getTransform(t.transformID),s=new ko(this,r,this.env.audioPlayer,t);this.audios.push(s);let l=this.findStation(s.parent);return this.audiosByStation.add(l,s),await s.load(n),this.cancellationToken.check(),X(s.controls)&&(this.playbackButtons.set(s.parent,s.controls),ce(s.error)&&(s.controls.addEventListener("play",()=>this.pauseCurrentAudioZone()),s.controls.addEventListener("stop",()=>this.playCurrentAudioZone()))),X(s.clip)&&this.zonedClips.add(s.zone,s.clip),s}async createVideo(t,n){let r=this.getTransform(t.transformID),s=new Mo(this,this.yt,r,this.env.videoPlayer,t);this.videos.push(s),await s.load(n),this.cancellationToken.check(),this.playbackButtons.set(s.parent,s.controls);let l=this.findStation(s.parent);return this.videosByStation.add(l,s),ce(s.error)&&(s.controls.addEventListener("play",()=>this.pauseCurrentAudioZone()),s.controls.addEventListener("stop",()=>this.playCurrentAudioZone())),s}async createText(t,n){let r=this.getTransform(t.transformID),s=new Do(this,t,r);this.texts.push(s),await s.load(n),this.cancellationToken.check();let l=this.findStation(s);return this.textsByStation.add(l,s),s}getConnectionLabel(t,n){if(ce(t)||ce(n))return null;for(let r of this.connections)if(r.fromStationID===t.transformID&&r.toStationID===n.transformID)return r.label;return null}getStationByObject(t){return t instanceof Dn?this.getStation(t.transformID):null}findStation(t){let n=this.getStationByObject(t);for(;!n&&t!=null;)t=t.parent,n=this.getStationByObject(t);return n}getStationCenter(t){let n=new Re,r=this.getTransform(t.transformID);return r&&r.getWorldPosition(n),n.y+=this.env.defaultAvatarHeight,n}get visible(){return X(this.rootTransform.parent)}set visible(t){if(t!==this.visible)if(t){if(this.curStationID=null,this.rootTransform==null)throw new Error("No root transform");de(this.env.foreground,this.rootTransform);for(let n of this.stations){let r=this.getTransform(n.transformID);r.visible=!1}}else this.env.foreground.remove(this.rootTransform)}async showStart(t){if(this.visible=!0,this.startStationID==null)throw new Error("Scenario has no starting point");this.log("start scenario",{id:this.id}),await this.showStation(this.startStation,!1,t),this.env.avatar.setHeadingImmediate(this.startRotation)}async showStation(t,n,r){if(this.logLeaveStation(),this.log("show station",{id:t.transformID}),this.curStationID){let m=this.getStation(this.curStationID);this.resetStationAssets(m)}r=r||this.env.loadingBar,this.curStationID=t.transformID;let s=n?this.env.audio.playClipThrough("footsteps"):Promise.resolve(),l=await this.isCached(t.filePath);this.env.loadingBar.enabled=!l,await this.env.withFade(async()=>{this.env.skybox.rotation=t.rotation;let m=await this.getImage(t.filePath,r);m.length===6?await this.env.skybox.setImages(t.filePath,m):await this.env.skybox.setImage(t.filePath,m[0]),this.moveToStation(t);for(let c of this.stations){let f=this.getTransform(c.transformID);f.visible=c.transformID===t.transformID}let u=this.curConnections.get(t),i=this.getConnectedStations(t);for(let c of i)this.prefetchConnectedStation(u,c);this.resetStationAssets(t),this.env.infoLabel.image.value=t.label||t.fileName,await ot(this.playAudioZone(t.zone),s)}),this.env.loadingBar.enabled=!1}logLeaveStation(){this.curStationID&&this.log("leave station",{id:this.curStationID})}moveToStation(t){X(t)&&(this.getTransform(t.transformID).getWorldPosition(this.env.stage.position),this.env.stage.position.y-=this.avatarHeightOffset)}resetStationAssets(t){let n=this.signsByStation.get(t);for(let m of n)m.reset();let r=this.audiosByStation.get(t);for(let m of r)m.reset();let s=this.videosByStation.get(t);for(let m of s)m.reset();let l=this.textsByStation.get(t);for(let m of l)m.reset()}imgCache=new ro(10);imgTasks=new Map;evict(t){this.imgCache.delete(t.filePath),this.imgTasks.delete(t.filePath)}async prefetchConnectedStation(t,n){let r=t.get(n);r.enabled=!1,this.imgCache.has(n.filePath)||await this.getImage(n.filePath,r),r.enabled=!0}getImage(t,n){if(this.imgCache.has(t))return Promise.resolve(this.imgCache.get(t));if(this.imgTasks.has(t))return this.imgTasks.get(t);let r=this.getImages(t,n).then(s=>(this.imgCache.set(t,s),this.imgTasks.delete(t),s));return this.imgTasks.set(t,r),r}async getImages(t,n){let{contentType:r}=await this.env.fetcher.head(t).exec();if(r===ha.value){let s=await this.env.fetcher.get(t).text().then(ke);return await this.rig.loadImages(s,Tt.High,n)}else return[await this.env.fetcher.get(t).useCache(!this.env.DEBUG).image().then(ke)]}async isCached(t){return await this.imgCache.has(t)}clearCache(){this.imgCache.clear()}getConnectedStations(t){return t&&this.connections.filter(n=>n.fromStationID===t.transformID).map(n=>this.getStation(n.toStationID))}async playAudioZone(t){if(t!==this.curZone){let n=new Map,r=new Map;for(let s of this.zonedClips.get(this.curZone))n.set(s.audio,s),s.disable();for(let s of this.zonedClips.get(t))n.has(s.audio)?n.delete(s.audio):r.set(s.audio,s),s.enable();for(let s of n.values())s.pause();await Promise.all(Array.from(r.values()).map(s=>s.play())),this.curZone=t}}pauseCurrentAudioZone(){let t=this.zonedClips.get(this.curZone),n=new Map;for(let r of t)n.set(r.audio,r),r.disable();for(let r of n.values())r.pause()}async playCurrentAudioZone(){if(!this.environmentAudioMuted){let t=this.zonedClips.get(this.curZone),n=new Map;for(let r of t)r.enable(),n.set(r.audio,r);await Promise.all(Array.from(n.values()).map(r=>r.play()))}}log(t,n){this.dataLogger.log(t,n)}error(t,n,r){this.dataLogger.error(t,n,r)}};var Go=class extends Uo{constructor(e,t,n){super(e,n,t)}};var Gr=class extends an{constructor(e){super(e,ir)}async getResult(e,t){let[n,r]=Je(t,[1,89]);return await e.get(this.path).progress(n).object().then(ke).then(async s=>{let l=this.createScenario(s);return await l.loadAssets(r),l})}},zo=class extends Gr{constructor(t,n,r){super(`/vr/scenario/${n}`);this.env=t;this.dataLogger=r}createScenario(t){return new Go(this.env,t,this.dataLogger)}};var qo=class extends On{scenarioID=null;scenario=null;constructor(e){super(e),this.env.audio.setAudioProperties(1,4,"exponential"),Object.seal(this),Object.assign(window,{yarrow:this})}async init(e){let t=e.get("scenarioID");if(he(t)&&(t=parseFloat(t)),this.scenarioID=t,!Le(this.scenarioID))throw new Ht("Expected integer scenario ID");await super.init(e)}async load(e){let t=new zo(this.env,this.scenarioID,this);await this.env.fetcher.assets(e,t),this.scenario=t.result}async showing(e){this.join(this.scenario.roomName),await this.scenario.showStart(e)}hiding(){}dispose(){this.scenario.dispose(),this.env.removeScope(this),this.scenario=null,this.scenarioID=null}get visible(){return X(this.scenario)}};var Ny=qo;export{Ny as default};
