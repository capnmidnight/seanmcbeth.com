var uw=Object.create;var Lu=Object.defineProperty;var cw=Object.getOwnPropertyDescriptor;var pw=Object.getOwnPropertyNames;var dw=Object.getPrototypeOf,mw=Object.prototype.hasOwnProperty;var hw=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),Bu=(n,t)=>{for(var e in t)Lu(n,e,{get:t[e],enumerable:!0})},fw=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of pw(t))!mw.call(n,o)&&o!==e&&Lu(n,o,{get:()=>t[o],enumerable:!(r=cw(t,o))||r.enumerable});return n};var gw=(n,t,e)=>(e=n!=null?uw(dw(n)):{},fw(t||!n||!n.__esModule?Lu(e,"default",{value:n,enumerable:!0}):e,n));var zg=hw((mp,hp)=>{(function(n,t){typeof mp=="object"&&typeof hp<"u"?hp.exports=t():typeof define=="function"&&define.amd?define(t):n.CardboardVRDisplay=t()})(mp,function(){"use strict";var n=function(){function u(d){this.value=d}function c(d){var h,f;function x(T,v){return new Promise(function(b,C){var P={key:T,arg:v,resolve:b,reject:C,next:null};f?f=f.next=P:(h=f=P,A(T,v))})}function A(T,v){try{var b=d[T](v),C=b.value;C instanceof u?Promise.resolve(C.value).then(function(P){A("next",P)},function(P){A("throw",P)}):y(b.done?"return":"normal",b.value)}catch(P){y("throw",P)}}function y(T,v){switch(T){case"return":h.resolve({value:v,done:!0});break;case"throw":h.reject(v);break;default:h.resolve({value:v,done:!1});break}h=h.next,h?A(h.key,h.arg):f=null}this._invoke=x,typeof d.return!="function"&&(this.return=void 0)}return typeof Symbol=="function"&&Symbol.asyncIterator&&(c.prototype[Symbol.asyncIterator]=function(){return this}),c.prototype.next=function(d){return this._invoke("next",d)},c.prototype.throw=function(d){return this._invoke("throw",d)},c.prototype.return=function(d){return this._invoke("return",d)},{wrap:function(d){return function(){return new c(d.apply(this,arguments))}},await:function(d){return new u(d)}}}(),t=function(u,c){if(!(u instanceof c))throw new TypeError("Cannot call a class as a function")},e=function(){function u(c,d){for(var h=0;h<d.length;h++){var f=d[h];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(c,f.key,f)}}return function(c,d,h){return d&&u(c.prototype,d),h&&u(c,h),c}}(),r=function(){function u(c,d){var h=[],f=!0,x=!1,A=void 0;try{for(var y=c[Symbol.iterator](),T;!(f=(T=y.next()).done)&&(h.push(T.value),!(d&&h.length===d));f=!0);}catch(v){x=!0,A=v}finally{try{!f&&y.return&&y.return()}finally{if(x)throw A}}return h}return function(c,d){if(Array.isArray(c))return c;if(Symbol.iterator in Object(c))return u(c,d);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=.001,i=1,s=function(c,d){return"data:"+c+","+encodeURIComponent(d)},a=function(c,d,h){return c+(d-c)*h},l=function(){var u=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return u}}(),p=function(){var u=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return u}}(),m=function(){var u=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return u}}(),g=function(){var u=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return u}}(),F=function(){var u=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),c=u?parseInt(u[1],10):null;return function(){return c}}(),S=function(){var u=!1;return u=l()&&m()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return u}}(),M=function(){var u=!1;if(F()===65){var c=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(c){var d=c[1].split("."),h=r(d,4),f=h[0],x=h[1],A=h[2],y=h[3];u=parseInt(A,10)===3325&&parseInt(y,10)<148}}return function(){return u}}(),k=function(){var u=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return u}}(),E=function(){var c=window.orientation==90||window.orientation==-90;return k()?!c:c},R=function(c){return!(isNaN(c)||c<=o||c>i)},W=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},V=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},B=function(c){if(p())return!1;if(c.requestFullscreen)c.requestFullscreen();else if(c.webkitRequestFullscreen)c.webkitRequestFullscreen();else if(c.mozRequestFullScreen)c.mozRequestFullScreen();else if(c.msRequestFullscreen)c.msRequestFullscreen();else return!1;return!0},G=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},D=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},O=function(c,d,h,f){var x=c.createShader(c.VERTEX_SHADER);c.shaderSource(x,d),c.compileShader(x);var A=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(A,h),c.compileShader(A);var y=c.createProgram();c.attachShader(y,x),c.attachShader(y,A);for(var T in f)c.bindAttribLocation(y,f[T],T);return c.linkProgram(y),c.deleteShader(x),c.deleteShader(A),y},ne=function(c,d){for(var h={},f=c.getProgramParameter(d,c.ACTIVE_UNIFORMS),x="",A=0;A<f;A++){var y=c.getActiveUniform(d,A);x=y.name.replace("[0]",""),h[x]=c.getUniformLocation(d,x)}return h},ae=function(c,d,h,f,x,A,y){var T=1/(d-h),v=1/(f-x),b=1/(A-y);return c[0]=-2*T,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*v,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*b,c[11]=0,c[12]=(d+h)*T,c[13]=(x+f)*v,c[14]=(y+A)*b,c[15]=1,c},j=function(){var c=!1;return function(d){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(d)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(d.substr(0,4)))&&(c=!0)}(navigator.userAgent||navigator.vendor||window.opera),c},ee=function(c,d){for(var h in d)d.hasOwnProperty(h)&&(c[h]=d[h]);return c},we=function(c){if(l()){var d=c.style.width,h=c.style.height;c.style.width=parseInt(d)+1+"px",c.style.height=parseInt(h)+"px",setTimeout(function(){c.style.width=d,c.style.height=h},100)}window.canvas=c},Fe=function(){var u=Math.PI/180,c=Math.PI*.25;function d(v,b,C,P){var H=Math.tan(b?b.upDegrees*u:c),z=Math.tan(b?b.downDegrees*u:c),K=Math.tan(b?b.leftDegrees*u:c),q=Math.tan(b?b.rightDegrees*u:c),X=2/(K+q),pe=2/(H+z);return v[0]=X,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=pe,v[6]=0,v[7]=0,v[8]=-((K-q)*X*.5),v[9]=(H-z)*pe*.5,v[10]=P/(C-P),v[11]=-1,v[12]=0,v[13]=0,v[14]=P*C/(C-P),v[15]=0,v}function h(v,b,C){var P=b[0],H=b[1],z=b[2],K=b[3],q=P+P,X=H+H,pe=z+z,ke=P*q,Ge=P*X,ve=P*pe,Ke=H*X,dt=H*pe,mt=z*pe,ht=K*q,ft=K*X,Ln=K*pe;return v[0]=1-(Ke+mt),v[1]=Ge+Ln,v[2]=ve-ft,v[3]=0,v[4]=Ge-Ln,v[5]=1-(ke+mt),v[6]=dt+ht,v[7]=0,v[8]=ve+ft,v[9]=dt-ht,v[10]=1-(ke+Ke),v[11]=0,v[12]=C[0],v[13]=C[1],v[14]=C[2],v[15]=1,v}function f(v,b,C){var P=C[0],H=C[1],z=C[2],K,q,X,pe,ke,Ge,ve,Ke,dt,mt,ht,ft;return b===v?(v[12]=b[0]*P+b[4]*H+b[8]*z+b[12],v[13]=b[1]*P+b[5]*H+b[9]*z+b[13],v[14]=b[2]*P+b[6]*H+b[10]*z+b[14],v[15]=b[3]*P+b[7]*H+b[11]*z+b[15]):(K=b[0],q=b[1],X=b[2],pe=b[3],ke=b[4],Ge=b[5],ve=b[6],Ke=b[7],dt=b[8],mt=b[9],ht=b[10],ft=b[11],v[0]=K,v[1]=q,v[2]=X,v[3]=pe,v[4]=ke,v[5]=Ge,v[6]=ve,v[7]=Ke,v[8]=dt,v[9]=mt,v[10]=ht,v[11]=ft,v[12]=K*P+ke*H+dt*z+b[12],v[13]=q*P+Ge*H+mt*z+b[13],v[14]=X*P+ve*H+ht*z+b[14],v[15]=pe*P+Ke*H+ft*z+b[15]),v}function x(v,b){var C=b[0],P=b[1],H=b[2],z=b[3],K=b[4],q=b[5],X=b[6],pe=b[7],ke=b[8],Ge=b[9],ve=b[10],Ke=b[11],dt=b[12],mt=b[13],ht=b[14],ft=b[15],Ln=C*q-P*K,ei=C*X-H*K,ti=C*pe-z*K,ni=P*X-H*q,ri=P*pe-z*q,oi=H*pe-z*X,ii=ke*mt-Ge*dt,si=ke*ht-ve*dt,ai=ke*ft-Ke*dt,li=Ge*ht-ve*mt,ui=Ge*ft-Ke*mt,ci=ve*ft-Ke*ht,Oe=Ln*ci-ei*ui+ti*li+ni*ai-ri*si+oi*ii;return Oe?(Oe=1/Oe,v[0]=(q*ci-X*ui+pe*li)*Oe,v[1]=(H*ui-P*ci-z*li)*Oe,v[2]=(mt*oi-ht*ri+ft*ni)*Oe,v[3]=(ve*ri-Ge*oi-Ke*ni)*Oe,v[4]=(X*ai-K*ci-pe*si)*Oe,v[5]=(C*ci-H*ai+z*si)*Oe,v[6]=(ht*ti-dt*oi-ft*ei)*Oe,v[7]=(ke*oi-ve*ti+Ke*ei)*Oe,v[8]=(K*ui-q*ai+pe*ii)*Oe,v[9]=(P*ai-C*ui-z*ii)*Oe,v[10]=(dt*ri-mt*ti+ft*Ln)*Oe,v[11]=(Ge*ti-ke*ri-Ke*Ln)*Oe,v[12]=(q*si-K*li-X*ii)*Oe,v[13]=(C*li-P*si+H*ii)*Oe,v[14]=(mt*ei-dt*ni-ht*Ln)*Oe,v[15]=(ke*ni-Ge*ei+ve*Ln)*Oe,v):null}var A=new Float32Array([0,0,0,1]),y=new Float32Array([0,0,0]);function T(v,b,C,P,H,z){d(v,P||null,z.depthNear,z.depthFar);var K=C.orientation||A,q=C.position||y;h(b,K,q),H&&f(b,b,H),x(b,b)}return function(v,b,C){return!v||!b?!1:(v.pose=b,v.timestamp=b.timestamp,T(v.leftProjectionMatrix,v.leftViewMatrix,b,C._getFieldOfView("left"),C._getEyeOffset("left"),C),T(v.rightProjectionMatrix,v.rightViewMatrix,b,C._getFieldOfView("right"),C._getEyeOffset("right"),C),!0)}}(),re=function(){var c=window.self!==window.top,d=tt(document.referrer),h=tt(window.location.href);return c&&d!==h},tt=function(c){var d,h=c.indexOf("://");h!==-1?d=h+3:d=0;var f=c.indexOf("/",d);return f===-1&&(f=c.length),c.substring(0,f)},Dn=function(c){if(c.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var d=2*Math.acos(c.w);return d},Ut=function(){var u={};return function(c,d){u[c]===void 0&&(console.warn("webvr-polyfill: "+d),u[c]=!0)}}(),Lt=function(c,d){var h=d?"Please use "+d+" instead.":"";Ut(c,c+" has been deprecated. This may not work on native WebVR displays. "+h)};function Dx(u,c,d){if(!c){d(u);return}for(var h=[],f=null,x=0;x<c.length;++x){var A=c[x];switch(A){case u.TEXTURE_BINDING_2D:case u.TEXTURE_BINDING_CUBE_MAP:var y=c[++x];if(y<u.TEXTURE0||y>u.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),h.push(null,null);break}f||(f=u.getParameter(u.ACTIVE_TEXTURE)),u.activeTexture(y),h.push(u.getParameter(A),null);break;case u.ACTIVE_TEXTURE:f=u.getParameter(u.ACTIVE_TEXTURE),h.push(null);break;default:h.push(u.getParameter(A));break}}d(u);for(var x=0;x<c.length;++x){var A=c[x],T=h[x];switch(A){case u.ACTIVE_TEXTURE:break;case u.ARRAY_BUFFER_BINDING:u.bindBuffer(u.ARRAY_BUFFER,T);break;case u.COLOR_CLEAR_VALUE:u.clearColor(T[0],T[1],T[2],T[3]);break;case u.COLOR_WRITEMASK:u.colorMask(T[0],T[1],T[2],T[3]);break;case u.CURRENT_PROGRAM:u.useProgram(T);break;case u.ELEMENT_ARRAY_BUFFER_BINDING:u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,T);break;case u.FRAMEBUFFER_BINDING:u.bindFramebuffer(u.FRAMEBUFFER,T);break;case u.RENDERBUFFER_BINDING:u.bindRenderbuffer(u.RENDERBUFFER,T);break;case u.TEXTURE_BINDING_2D:var y=c[++x];if(y<u.TEXTURE0||y>u.TEXTURE31)break;u.activeTexture(y),u.bindTexture(u.TEXTURE_2D,T);break;case u.TEXTURE_BINDING_CUBE_MAP:var y=c[++x];if(y<u.TEXTURE0||y>u.TEXTURE31)break;u.activeTexture(y),u.bindTexture(u.TEXTURE_CUBE_MAP,T);break;case u.VIEWPORT:u.viewport(T[0],T[1],T[2],T[3]);break;case u.BLEND:case u.CULL_FACE:case u.DEPTH_TEST:case u.SCISSOR_TEST:case u.STENCIL_TEST:T?u.enable(A):u.disable(A);break;default:console.log("No GL restore behavior for 0x"+A.toString(16));break}f&&u.activeTexture(f)}}var Yo=Dx,Lx=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),Bx=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function Bt(u,c,d,h){this.gl=u,this.cardboardUI=c,this.bufferScale=d,this.dirtySubmitFrameBindings=h,this.ctxAttribs=u.getContextAttributes(),this.instanceExt=u.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=u.drawingBufferWidth,this.bufferHeight=u.drawingBufferHeight,this.realBindFramebuffer=u.bindFramebuffer,this.realEnable=u.enable,this.realDisable=u.disable,this.realColorMask=u.colorMask,this.realClearColor=u.clearColor,this.realViewport=u.viewport,l()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(u.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(u.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=O(u,Lx,Bx,this.attribs),this.uniforms=ne(u,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=u.createBuffer(),this.indexBuffer=u.createBuffer(),this.indexCount=0,this.renderTarget=u.createTexture(),this.framebuffer=u.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=u.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=u.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=u.createRenderbuffer()),this.patch(),this.onResize()}Bt.prototype.destroy=function(){var u=this.gl;this.unpatch(),u.deleteProgram(this.program),u.deleteBuffer(this.vertexBuffer),u.deleteBuffer(this.indexBuffer),u.deleteTexture(this.renderTarget),u.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&u.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&u.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&u.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},Bt.prototype.onResize=function(){var u=this.gl,c=this,d=[u.RENDERBUFFER_BINDING,u.TEXTURE_BINDING_2D,u.TEXTURE0];Yo(u,d,function(h){c.realBindFramebuffer.call(h,h.FRAMEBUFFER,null),c.scissorTest&&c.realDisable.call(h,h.SCISSOR_TEST),c.realColorMask.call(h,!0,!0,!0,!0),c.realViewport.call(h,0,0,h.drawingBufferWidth,h.drawingBufferHeight),c.realClearColor.call(h,0,0,0,1),h.clear(h.COLOR_BUFFER_BIT),c.realBindFramebuffer.call(h,h.FRAMEBUFFER,c.framebuffer),h.bindTexture(h.TEXTURE_2D,c.renderTarget),h.texImage2D(h.TEXTURE_2D,0,c.ctxAttribs.alpha?h.RGBA:h.RGB,c.bufferWidth,c.bufferHeight,0,c.ctxAttribs.alpha?h.RGBA:h.RGB,h.UNSIGNED_BYTE,null),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,c.renderTarget,0),c.ctxAttribs.depth&&c.ctxAttribs.stencil?(h.bindRenderbuffer(h.RENDERBUFFER,c.depthStencilBuffer),h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_STENCIL,c.bufferWidth,c.bufferHeight),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,c.depthStencilBuffer)):c.ctxAttribs.depth?(h.bindRenderbuffer(h.RENDERBUFFER,c.depthBuffer),h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_COMPONENT16,c.bufferWidth,c.bufferHeight),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,c.depthBuffer)):c.ctxAttribs.stencil&&(h.bindRenderbuffer(h.RENDERBUFFER,c.stencilBuffer),h.renderbufferStorage(h.RENDERBUFFER,h.STENCIL_INDEX8,c.bufferWidth,c.bufferHeight),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.STENCIL_ATTACHMENT,h.RENDERBUFFER,c.stencilBuffer)),!h.checkFramebufferStatus(h.FRAMEBUFFER)===h.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),c.realBindFramebuffer.call(h,h.FRAMEBUFFER,c.lastBoundFramebuffer),c.scissorTest&&c.realEnable.call(h,h.SCISSOR_TEST),c.realColorMask.apply(h,c.colorMask),c.realViewport.apply(h,c.viewport),c.realClearColor.apply(h,c.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},Bt.prototype.patch=function(){if(!this.isPatched){var u=this,c=this.gl.canvas,d=this.gl;l()||(c.width=W()*this.bufferScale,c.height=V()*this.bufferScale,Object.defineProperty(c,"width",{configurable:!0,enumerable:!0,get:function(){return u.bufferWidth},set:function(f){u.bufferWidth=f,u.realCanvasWidth.set.call(c,f),u.onResize()}}),Object.defineProperty(c,"height",{configurable:!0,enumerable:!0,get:function(){return u.bufferHeight},set:function(f){u.bufferHeight=f,u.realCanvasHeight.set.call(c,f),u.onResize()}})),this.lastBoundFramebuffer=d.getParameter(d.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(d.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(h,f){u.lastBoundFramebuffer=f||u.framebuffer,u.realBindFramebuffer.call(d,h,u.lastBoundFramebuffer)},this.cullFace=d.getParameter(d.CULL_FACE),this.depthTest=d.getParameter(d.DEPTH_TEST),this.blend=d.getParameter(d.BLEND),this.scissorTest=d.getParameter(d.SCISSOR_TEST),this.stencilTest=d.getParameter(d.STENCIL_TEST),d.enable=function(h){switch(h){case d.CULL_FACE:u.cullFace=!0;break;case d.DEPTH_TEST:u.depthTest=!0;break;case d.BLEND:u.blend=!0;break;case d.SCISSOR_TEST:u.scissorTest=!0;break;case d.STENCIL_TEST:u.stencilTest=!0;break}u.realEnable.call(d,h)},d.disable=function(h){switch(h){case d.CULL_FACE:u.cullFace=!1;break;case d.DEPTH_TEST:u.depthTest=!1;break;case d.BLEND:u.blend=!1;break;case d.SCISSOR_TEST:u.scissorTest=!1;break;case d.STENCIL_TEST:u.stencilTest=!1;break}u.realDisable.call(d,h)},this.colorMask=d.getParameter(d.COLOR_WRITEMASK),d.colorMask=function(h,f,x,A){u.colorMask[0]=h,u.colorMask[1]=f,u.colorMask[2]=x,u.colorMask[3]=A,u.realColorMask.call(d,h,f,x,A)},this.clearColor=d.getParameter(d.COLOR_CLEAR_VALUE),d.clearColor=function(h,f,x,A){u.clearColor[0]=h,u.clearColor[1]=f,u.clearColor[2]=x,u.clearColor[3]=A,u.realClearColor.call(d,h,f,x,A)},this.viewport=d.getParameter(d.VIEWPORT),d.viewport=function(h,f,x,A){u.viewport[0]=h,u.viewport[1]=f,u.viewport[2]=x,u.viewport[3]=A,u.realViewport.call(d,h,f,x,A)},this.isPatched=!0,we(c)}},Bt.prototype.unpatch=function(){if(this.isPatched){var u=this.gl,c=this.gl.canvas;l()||(Object.defineProperty(c,"width",this.realCanvasWidth),Object.defineProperty(c,"height",this.realCanvasHeight)),c.width=this.bufferWidth,c.height=this.bufferHeight,u.bindFramebuffer=this.realBindFramebuffer,u.enable=this.realEnable,u.disable=this.realDisable,u.colorMask=this.realColorMask,u.clearColor=this.realClearColor,u.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&u.bindFramebuffer(u.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){we(c)},1)}},Bt.prototype.setTextureBounds=function(u,c){u||(u=[0,0,.5,1]),c||(c=[.5,0,.5,1]),this.viewportOffsetScale[0]=u[0],this.viewportOffsetScale[1]=u[1],this.viewportOffsetScale[2]=u[2],this.viewportOffsetScale[3]=u[3],this.viewportOffsetScale[4]=c[0],this.viewportOffsetScale[5]=c[1],this.viewportOffsetScale[6]=c[2],this.viewportOffsetScale[7]=c[3]},Bt.prototype.submitFrame=function(){var u=this.gl,c=this,d=[];if(this.dirtySubmitFrameBindings||d.push(u.CURRENT_PROGRAM,u.ARRAY_BUFFER_BINDING,u.ELEMENT_ARRAY_BUFFER_BINDING,u.TEXTURE_BINDING_2D,u.TEXTURE0),Yo(u,d,function(f){c.realBindFramebuffer.call(f,f.FRAMEBUFFER,null);var x=0,A=0;c.instanceExt&&(x=f.getVertexAttrib(c.attribs.position,c.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),A=f.getVertexAttrib(c.attribs.texCoord,c.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),c.cullFace&&c.realDisable.call(f,f.CULL_FACE),c.depthTest&&c.realDisable.call(f,f.DEPTH_TEST),c.blend&&c.realDisable.call(f,f.BLEND),c.scissorTest&&c.realDisable.call(f,f.SCISSOR_TEST),c.stencilTest&&c.realDisable.call(f,f.STENCIL_TEST),c.realColorMask.call(f,!0,!0,!0,!0),c.realViewport.call(f,0,0,f.drawingBufferWidth,f.drawingBufferHeight),(c.ctxAttribs.alpha||l())&&(c.realClearColor.call(f,0,0,0,1),f.clear(f.COLOR_BUFFER_BIT)),f.useProgram(c.program),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c.indexBuffer),f.bindBuffer(f.ARRAY_BUFFER,c.vertexBuffer),f.enableVertexAttribArray(c.attribs.position),f.enableVertexAttribArray(c.attribs.texCoord),f.vertexAttribPointer(c.attribs.position,2,f.FLOAT,!1,20,0),f.vertexAttribPointer(c.attribs.texCoord,3,f.FLOAT,!1,20,8),c.instanceExt&&(x!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.position,0),A!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.texCoord,0)),f.activeTexture(f.TEXTURE0),f.uniform1i(c.uniforms.diffuse,0),f.bindTexture(f.TEXTURE_2D,c.renderTarget),f.uniform4fv(c.uniforms.viewportOffsetScale,c.viewportOffsetScale),f.drawElements(f.TRIANGLES,c.indexCount,f.UNSIGNED_SHORT,0),c.cardboardUI&&c.cardboardUI.renderNoState(),c.realBindFramebuffer.call(c.gl,f.FRAMEBUFFER,c.framebuffer),c.ctxAttribs.preserveDrawingBuffer||(c.realClearColor.call(f,0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),c.dirtySubmitFrameBindings||c.realBindFramebuffer.call(f,f.FRAMEBUFFER,c.lastBoundFramebuffer),c.cullFace&&c.realEnable.call(f,f.CULL_FACE),c.depthTest&&c.realEnable.call(f,f.DEPTH_TEST),c.blend&&c.realEnable.call(f,f.BLEND),c.scissorTest&&c.realEnable.call(f,f.SCISSOR_TEST),c.stencilTest&&c.realEnable.call(f,f.STENCIL_TEST),c.realColorMask.apply(f,c.colorMask),c.realViewport.apply(f,c.viewport),(c.ctxAttribs.alpha||!c.ctxAttribs.preserveDrawingBuffer)&&c.realClearColor.apply(f,c.clearColor),c.instanceExt&&(x!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.position,x),A!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.texCoord,A))}),l()){var h=u.canvas;(h.width!=c.bufferWidth||h.height!=c.bufferHeight)&&(c.bufferWidth=h.width,c.bufferHeight=h.height,c.onResize())}},Bt.prototype.updateDeviceInfo=function(u){var c=this.gl,d=this,h=[c.ARRAY_BUFFER_BINDING,c.ELEMENT_ARRAY_BUFFER_BINDING];Yo(c,h,function(f){var x=d.computeMeshVertices_(d.meshWidth,d.meshHeight,u);if(f.bindBuffer(f.ARRAY_BUFFER,d.vertexBuffer),f.bufferData(f.ARRAY_BUFFER,x,f.STATIC_DRAW),!d.indexCount){var A=d.computeMeshIndices_(d.meshWidth,d.meshHeight);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,d.indexBuffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,A,f.STATIC_DRAW),d.indexCount=A.length}})},Bt.prototype.computeMeshVertices_=function(u,c,d){for(var h=new Float32Array(2*u*c*5),f=d.getLeftEyeVisibleTanAngles(),x=d.getLeftEyeNoLensTanAngles(),A=d.getLeftEyeVisibleScreenRect(x),y=0,T=0;T<2;T++){for(var v=0;v<c;v++)for(var b=0;b<u;b++,y++){var C=b/(u-1),P=v/(c-1),H=C,z=P,K=a(f[0],f[2],C),q=a(f[3],f[1],P),X=Math.sqrt(K*K+q*q),pe=d.distortion.distortInverse(X),ke=K*pe/X,Ge=q*pe/X;C=(ke-x[0])/(x[2]-x[0]),P=(Ge-x[3])/(x[1]-x[3]),C=(A.x+C*A.width-.5)*2,P=(A.y+P*A.height-.5)*2,h[y*5+0]=C,h[y*5+1]=P,h[y*5+2]=H,h[y*5+3]=z,h[y*5+4]=T}var ve=f[2]-f[0];f[0]=-(ve+f[0]),f[2]=ve-f[2],ve=x[2]-x[0],x[0]=-(ve+x[0]),x[2]=ve-x[2],A.x=1-(A.x+A.width)}return h},Bt.prototype.computeMeshIndices_=function(u,c){for(var d=new Uint16Array(2*(u-1)*(c-1)*6),h=u/2,f=c/2,x=0,A=0,y=0;y<2;y++)for(var T=0;T<c;T++)for(var v=0;v<u;v++,x++)v==0||T==0||(v<=h==T<=f?(d[A++]=x,d[A++]=x-u-1,d[A++]=x-u,d[A++]=x-u-1,d[A++]=x,d[A++]=x-1):(d[A++]=x-1,d[A++]=x-u,d[A++]=x,d[A++]=x-u,d[A++]=x-1,d[A++]=x-u-1));return d},Bt.prototype.getOwnPropertyDescriptor_=function(u,c){var d=Object.getOwnPropertyDescriptor(u,c);return(d.get===void 0||d.set===void 0)&&(d.configurable=!0,d.enumerable=!0,d.get=function(){return this.getAttribute(c)},d.set=function(h){this.setAttribute(c,h)}),d};var Px=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),Rx=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),hd=Math.PI/180,Tu=60,fd=12,gd=20,Eu=1,xd=.75,wd=.3125,Ix=4,mr=28,yu=1.5;function hr(u){this.gl=u,this.attribs={position:0},this.program=O(u,Px,Rx,this.attribs),this.uniforms=ne(u,this.program),this.vertexBuffer=u.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}hr.prototype.destroy=function(){var u=this.gl;this.listener&&u.canvas.removeEventListener("click",this.listener,!1),u.deleteProgram(this.program),u.deleteBuffer(this.vertexBuffer)},hr.prototype.listen=function(u,c){var d=this.gl.canvas;this.listener=function(h){var f=d.clientWidth/2,x=mr*yu;h.clientX>f-x&&h.clientX<f+x&&h.clientY>d.clientHeight-x?u(h):h.clientX<x&&h.clientY<x&&c(h)},d.addEventListener("click",this.listener,!1)},hr.prototype.onResize=function(){var u=this.gl,c=this,d=[u.ARRAY_BUFFER_BINDING];Yo(u,d,function(h){var f=[],x=h.drawingBufferWidth/2,A=Math.max(screen.width,screen.height)*window.devicePixelRatio,y=h.drawingBufferWidth/A,T=y*window.devicePixelRatio,v=Ix*T/2,b=mr*yu*T,C=mr*T/2,P=(mr*yu-mr)*T;f.push(x-v,b),f.push(x-v,h.drawingBufferHeight),f.push(x+v,b),f.push(x+v,h.drawingBufferHeight),c.gearOffset=f.length/2;function H(pe,ke){var Ge=(90-pe)*hd,ve=Math.cos(Ge),Ke=Math.sin(Ge);f.push(wd*ve*C+x,wd*Ke*C+C),f.push(ke*ve*C+x,ke*Ke*C+C)}for(var z=0;z<=6;z++){var K=z*Tu;H(K,Eu),H(K+fd,Eu),H(K+gd,xd),H(K+(Tu-gd),xd),H(K+(Tu-fd),Eu)}c.gearVertexCount=f.length/2-c.gearOffset,c.arrowOffset=f.length/2;function q(pe,ke){f.push(P+pe,h.drawingBufferHeight-P-ke)}var X=v/Math.sin(45*hd);q(0,C),q(C,0),q(C+X,X),q(X,C+X),q(X,C-X),q(0,C),q(C,C*2),q(C+X,C*2-X),q(X,C-X),q(0,C),q(X,C-v),q(mr*T,C-v),q(X,C+v),q(mr*T,C+v),c.arrowVertexCount=f.length/2-c.arrowOffset,h.bindBuffer(h.ARRAY_BUFFER,c.vertexBuffer),h.bufferData(h.ARRAY_BUFFER,new Float32Array(f),h.STATIC_DRAW)})},hr.prototype.render=function(){var u=this.gl,c=this,d=[u.CULL_FACE,u.DEPTH_TEST,u.BLEND,u.SCISSOR_TEST,u.STENCIL_TEST,u.COLOR_WRITEMASK,u.VIEWPORT,u.CURRENT_PROGRAM,u.ARRAY_BUFFER_BINDING];Yo(u,d,function(h){h.disable(h.CULL_FACE),h.disable(h.DEPTH_TEST),h.disable(h.BLEND),h.disable(h.SCISSOR_TEST),h.disable(h.STENCIL_TEST),h.colorMask(!0,!0,!0,!0),h.viewport(0,0,h.drawingBufferWidth,h.drawingBufferHeight),c.renderNoState()})},hr.prototype.renderNoState=function(){var u=this.gl;u.useProgram(this.program),u.bindBuffer(u.ARRAY_BUFFER,this.vertexBuffer),u.enableVertexAttribArray(this.attribs.position),u.vertexAttribPointer(this.attribs.position,2,u.FLOAT,!1,8,0),u.uniform4f(this.uniforms.color,1,1,1,1),ae(this.projMat,0,u.drawingBufferWidth,0,u.drawingBufferHeight,.1,1024),u.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),u.drawArrays(u.TRIANGLE_STRIP,0,4),u.drawArrays(u.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),u.drawArrays(u.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function Ms(u){this.coefficients=u}Ms.prototype.distortInverse=function(u){for(var c=0,d=1,h=u-this.distort(c);Math.abs(d-c)>1e-4;){var f=u-this.distort(d),x=d-f*((d-c)/(f-h));c=d,d=x,h=f}return d},Ms.prototype.distort=function(u){for(var c=u*u,d=0,h=0;h<this.coefficients.length;h++)d=c*(d+this.coefficients[h]);return(d+1)*u};var zt=Math.PI/180,Xt=180/Math.PI,Ae=function(c,d,h){this.x=c||0,this.y=d||0,this.z=h||0};Ae.prototype={constructor:Ae,set:function(c,d,h){return this.x=c,this.y=d,this.z=h,this},copy:function(c){return this.x=c.x,this.y=c.y,this.z=c.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var c=this.length();if(c!==0){var d=1/c;this.multiplyScalar(d)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(c){this.x*=c,this.y*=c,this.z*=c},applyQuaternion:function(c){var d=this.x,h=this.y,f=this.z,x=c.x,A=c.y,y=c.z,T=c.w,v=T*d+A*f-y*h,b=T*h+y*d-x*f,C=T*f+x*h-A*d,P=-x*d-A*h-y*f;return this.x=v*T+P*-x+b*-y-C*-A,this.y=b*T+P*-A+C*-x-v*-y,this.z=C*T+P*-y+v*-A-b*-x,this},dot:function(c){return this.x*c.x+this.y*c.y+this.z*c.z},crossVectors:function(c,d){var h=c.x,f=c.y,x=c.z,A=d.x,y=d.y,T=d.z;return this.x=f*T-x*y,this.y=x*A-h*T,this.z=h*y-f*A,this}};var oe=function(c,d,h,f){this.x=c||0,this.y=d||0,this.z=h||0,this.w=f!==void 0?f:1};oe.prototype={constructor:oe,set:function(c,d,h,f){return this.x=c,this.y=d,this.z=h,this.w=f,this},copy:function(c){return this.x=c.x,this.y=c.y,this.z=c.z,this.w=c.w,this},setFromEulerXYZ:function(c,d,h){var f=Math.cos(c/2),x=Math.cos(d/2),A=Math.cos(h/2),y=Math.sin(c/2),T=Math.sin(d/2),v=Math.sin(h/2);return this.x=y*x*A+f*T*v,this.y=f*T*A-y*x*v,this.z=f*x*v+y*T*A,this.w=f*x*A-y*T*v,this},setFromEulerYXZ:function(c,d,h){var f=Math.cos(c/2),x=Math.cos(d/2),A=Math.cos(h/2),y=Math.sin(c/2),T=Math.sin(d/2),v=Math.sin(h/2);return this.x=y*x*A+f*T*v,this.y=f*T*A-y*x*v,this.z=f*x*v-y*T*A,this.w=f*x*A+y*T*v,this},setFromAxisAngle:function(c,d){var h=d/2,f=Math.sin(h);return this.x=c.x*f,this.y=c.y*f,this.z=c.z*f,this.w=Math.cos(h),this},multiply:function(c){return this.multiplyQuaternions(this,c)},multiplyQuaternions:function(c,d){var h=c.x,f=c.y,x=c.z,A=c.w,y=d.x,T=d.y,v=d.z,b=d.w;return this.x=h*b+A*y+f*v-x*T,this.y=f*b+A*T+x*y-h*v,this.z=x*b+A*v+h*T-f*y,this.w=A*b-h*y-f*T-x*v,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var c=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return c===0?(this.x=0,this.y=0,this.z=0,this.w=1):(c=1/c,this.x=this.x*c,this.y=this.y*c,this.z=this.z*c,this.w=this.w*c),this},slerp:function(c,d){if(d===0)return this;if(d===1)return this.copy(c);var h=this.x,f=this.y,x=this.z,A=this.w,y=A*c.w+h*c.x+f*c.y+x*c.z;if(y<0?(this.w=-c.w,this.x=-c.x,this.y=-c.y,this.z=-c.z,y=-y):this.copy(c),y>=1)return this.w=A,this.x=h,this.y=f,this.z=x,this;var T=Math.acos(y),v=Math.sqrt(1-y*y);if(Math.abs(v)<.001)return this.w=.5*(A+this.w),this.x=.5*(h+this.x),this.y=.5*(f+this.y),this.z=.5*(x+this.z),this;var b=Math.sin((1-d)*T)/v,C=Math.sin(d*T)/v;return this.w=A*b+this.w*C,this.x=h*b+this.x*C,this.y=f*b+this.y*C,this.z=x*b+this.z*C,this},setFromUnitVectors:function(){var u,c,d=1e-6;return function(h,f){return u===void 0&&(u=new Ae),c=h.dot(f)+1,c<d?(c=0,Math.abs(h.x)>Math.abs(h.z)?u.set(-h.y,h.x,0):u.set(0,-h.z,h.y)):u.crossVectors(h,f),this.x=u.x,this.y=u.y,this.z=u.z,this.w=c,this.normalize(),this}}()};function Mu(u){this.width=u.width||W(),this.height=u.height||V(),this.widthMeters=u.widthMeters,this.heightMeters=u.heightMeters,this.bevelMeters=u.bevelMeters}var Vx=new Mu({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),Ox=new Mu({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),ku={CardboardV1:new Cu({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new Cu({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function Ie(u,c){this.viewer=ku.CardboardV2,this.updateDeviceParams(u),this.distortion=new Ms(this.viewer.distortionCoefficients);for(var d=0;d<c.length;d++){var h=c[d];ku[h.id]=new Cu(h)}}Ie.prototype.updateDeviceParams=function(u){this.device=this.determineDevice_(u)||this.device},Ie.prototype.getDevice=function(){return this.device},Ie.prototype.setViewer=function(u){this.viewer=u,this.distortion=new Ms(this.viewer.distortionCoefficients)},Ie.prototype.determineDevice_=function(u){if(!u)return l()?(console.warn("Using fallback iOS device measurements."),Ox):(console.warn("Using fallback Android device measurements."),Vx);var c=.0254,d=c/u.xdpi,h=c/u.ydpi,f=W(),x=V();return new Mu({widthMeters:d*f,heightMeters:h*x,bevelMeters:u.bevelMm*.001})},Ie.prototype.getDistortedFieldOfViewLeftEye=function(){var u=this.viewer,c=this.device,d=this.distortion,h=u.screenLensDistance,f=(c.widthMeters-u.interLensDistance)/2,x=u.interLensDistance/2,A=u.baselineLensDistance-c.bevelMeters,y=c.heightMeters-A,T=Xt*Math.atan(d.distort(f/h)),v=Xt*Math.atan(d.distort(x/h)),b=Xt*Math.atan(d.distort(A/h)),C=Xt*Math.atan(d.distort(y/h));return{leftDegrees:Math.min(T,u.fov),rightDegrees:Math.min(v,u.fov),downDegrees:Math.min(b,u.fov),upDegrees:Math.min(C,u.fov)}},Ie.prototype.getLeftEyeVisibleTanAngles=function(){var u=this.viewer,c=this.device,d=this.distortion,h=Math.tan(-zt*u.fov),f=Math.tan(zt*u.fov),x=Math.tan(zt*u.fov),A=Math.tan(-zt*u.fov),y=c.widthMeters/4,T=c.heightMeters/2,v=u.baselineLensDistance-c.bevelMeters-T,b=u.interLensDistance/2-y,C=-v,P=u.screenLensDistance,H=d.distort((b-y)/P),z=d.distort((C+T)/P),K=d.distort((b+y)/P),q=d.distort((C-T)/P),X=new Float32Array(4);return X[0]=Math.max(h,H),X[1]=Math.min(f,z),X[2]=Math.min(x,K),X[3]=Math.max(A,q),X},Ie.prototype.getLeftEyeNoLensTanAngles=function(){var u=this.viewer,c=this.device,d=this.distortion,h=new Float32Array(4),f=d.distortInverse(Math.tan(-zt*u.fov)),x=d.distortInverse(Math.tan(zt*u.fov)),A=d.distortInverse(Math.tan(zt*u.fov)),y=d.distortInverse(Math.tan(-zt*u.fov)),T=c.widthMeters/4,v=c.heightMeters/2,b=u.baselineLensDistance-c.bevelMeters-v,C=u.interLensDistance/2-T,P=-b,H=u.screenLensDistance,z=(C-T)/H,K=(P+v)/H,q=(C+T)/H,X=(P-v)/H;return h[0]=Math.max(f,z),h[1]=Math.min(x,K),h[2]=Math.min(A,q),h[3]=Math.max(y,X),h},Ie.prototype.getLeftEyeVisibleScreenRect=function(u){var c=this.viewer,d=this.device,h=c.screenLensDistance,f=(d.widthMeters-c.interLensDistance)/2,x=c.baselineLensDistance-d.bevelMeters,A=(u[0]*h+f)/d.widthMeters,y=(u[1]*h+x)/d.heightMeters,T=(u[2]*h+f)/d.widthMeters,v=(u[3]*h+x)/d.heightMeters;return{x:A,y:v,width:T-A,height:y-v}},Ie.prototype.getFieldOfViewLeftEye=function(u){return u?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},Ie.prototype.getFieldOfViewRightEye=function(u){var c=this.getFieldOfViewLeftEye(u);return{leftDegrees:c.rightDegrees,rightDegrees:c.leftDegrees,upDegrees:c.upDegrees,downDegrees:c.downDegrees}},Ie.prototype.getUndistortedFieldOfViewLeftEye=function(){var u=this.getUndistortedParams_();return{leftDegrees:Xt*Math.atan(u.outerDist),rightDegrees:Xt*Math.atan(u.innerDist),downDegrees:Xt*Math.atan(u.bottomDist),upDegrees:Xt*Math.atan(u.topDist)}},Ie.prototype.getUndistortedViewportLeftEye=function(){var u=this.getUndistortedParams_(),c=this.viewer,d=this.device,h=c.screenLensDistance,f=d.widthMeters/h,x=d.heightMeters/h,A=d.width/f,y=d.height/x,T=Math.round((u.eyePosX-u.outerDist)*A),v=Math.round((u.eyePosY-u.bottomDist)*y);return{x:T,y:v,width:Math.round((u.eyePosX+u.innerDist)*A)-T,height:Math.round((u.eyePosY+u.topDist)*y)-v}},Ie.prototype.getUndistortedParams_=function(){var u=this.viewer,c=this.device,d=this.distortion,h=u.screenLensDistance,f=u.interLensDistance/2/h,x=c.widthMeters/h,A=c.heightMeters/h,y=x/2-f,T=(u.baselineLensDistance-c.bevelMeters)/h,v=u.fov,b=d.distortInverse(Math.tan(zt*v)),C=Math.min(y,b),P=Math.min(f,b),H=Math.min(T,b),z=Math.min(A-T,b);return{outerDist:C,innerDist:P,topDist:z,bottomDist:H,eyePosX:y,eyePosY:T}};function Cu(u){this.id=u.id,this.label=u.label,this.fov=u.fov,this.interLensDistance=u.interLensDistance,this.baselineLensDistance=u.baselineLensDistance,this.screenLensDistance=u.screenLensDistance,this.distortionCoefficients=u.distortionCoefficients,this.inverseCoefficients=u.inverseCoefficients}Ie.Viewers=ku;var Wx=1,Hx="2019-11-09T17:36:14Z",Nx=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],Gx={format:Wx,last_updated:Hx,devices:Nx};function Zo(u,c){if(this.dpdb=Gx,this.recalculateDeviceParams_(),u){this.onDeviceParamsUpdated=c;var d=new XMLHttpRequest,h=this;d.open("GET",u,!0),d.addEventListener("load",function(){h.loading=!1,d.status>=200&&d.status<=299?(h.dpdb=JSON.parse(d.response),h.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),d.send()}}Zo.prototype.getDeviceParams=function(){return this.deviceParams},Zo.prototype.recalculateDeviceParams_=function(){var u=this.calcDeviceParams_();u?(this.deviceParams=u,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},Zo.prototype.calcDeviceParams_=function(){var u=this.dpdb;if(!u)return console.error("DPDB not available."),null;if(u.format!=1)return console.error("DPDB has unexpected format version."),null;if(!u.devices||!u.devices.length)return console.error("DPDB does not have a devices section."),null;var c=navigator.userAgent||navigator.vendor||window.opera,d=W(),h=V();if(!u.devices)return console.error("DPDB has no devices section."),null;for(var f=0;f<u.devices.length;f++){var x=u.devices[f];if(!x.rules){console.warn("Device["+f+"] has no rules section.");continue}if(x.type!="ios"&&x.type!="android"){console.warn("Device["+f+"] has invalid type.");continue}if(l()==(x.type=="ios")){for(var A=!1,y=0;y<x.rules.length;y++){var T=x.rules[y];if(this.ruleMatches_(T,c,d,h)){A=!0;break}}if(A){var v=x.dpi[0]||x.dpi,b=x.dpi[1]||x.dpi;return new Ux({xdpi:v,ydpi:b,bevelMm:x.bw})}}}return console.warn("No DPDB device match."),null},Zo.prototype.ruleMatches_=function(u,c,d,h){if(!u.ua&&!u.res||(u.ua&&u.ua.substring(0,2)==="SM"&&(u.ua=u.ua.substring(0,7)),u.ua&&c.indexOf(u.ua)<0))return!1;if(u.res){if(!u.res[0]||!u.res[1])return!1;var f=u.res[0],x=u.res[1];if(Math.min(d,h)!=Math.min(f,x)||Math.max(d,h)!=Math.max(f,x))return!1}return!0};function Ux(u){this.xdpi=u.xdpi,this.ydpi=u.ydpi,this.bevelMm=u.bevelMm}function $o(u,c){this.set(u,c)}$o.prototype.set=function(u,c){this.sample=u,this.timestampS=c},$o.prototype.copy=function(u){this.set(u.sample,u.timestampS)};function fr(u,c){this.kFilter=u,this.isDebug=c,this.currentAccelMeasurement=new $o,this.currentGyroMeasurement=new $o,this.previousGyroMeasurement=new $o,l()?this.filterQ=new oe(-1,0,0,1):this.filterQ=new oe(1,0,0,1),this.previousFilterQ=new oe,this.previousFilterQ.copy(this.filterQ),this.accelQ=new oe,this.isOrientationInitialized=!1,this.estimatedGravity=new Ae,this.measuredGravity=new Ae,this.gyroIntegralQ=new oe}fr.prototype.addAccelMeasurement=function(u,c){this.currentAccelMeasurement.set(u,c)},fr.prototype.addGyroMeasurement=function(u,c){this.currentGyroMeasurement.set(u,c);var d=c-this.previousGyroMeasurement.timestampS;R(d)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},fr.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var u=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,c=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,u);this.gyroIntegralQ.multiply(c),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(c);var d=new oe;d.copy(this.filterQ),d.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(d),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var h=new oe;h.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),h.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",Xt*Dn(h),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var f=new oe;f.copy(this.filterQ),f.multiply(h),this.filterQ.slerp(f,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},fr.prototype.getOrientation=function(){return this.filterQ},fr.prototype.accelToQuaternion_=function(u){var c=new Ae;c.copy(u),c.normalize();var d=new oe;return d.setFromUnitVectors(new Ae(0,0,-1),c),d.inverse(),d},fr.prototype.gyroToQuaternionDelta_=function(u,c){var d=new oe,h=new Ae;return h.copy(u),h.normalize(),d.setFromAxisAngle(h,u.length()*c),d};function Fd(u,c){this.predictionTimeS=u,this.isDebug=c,this.previousQ=new oe,this.previousTimestampS=null,this.deltaQ=new oe,this.outQ=new oe}Fd.prototype.getPrediction=function(u,c,d){if(!this.previousTimestampS)return this.previousQ.copy(u),this.previousTimestampS=d,u;var h=new Ae;h.copy(c),h.normalize();var f=c.length();if(f<zt*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(Xt*f).toFixed(1)),this.outQ.copy(u),this.previousQ.copy(u),this.outQ;var x=f*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(h,x),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(u),this.previousTimestampS=d,this.outQ};function At(u,c,d,h){this.yawOnly=d,this.accelerometer=new Ae,this.gyroscope=new Ae,this.filter=new fr(u,h),this.posePredictor=new Fd(c,h),this.isFirefoxAndroid=g(),this.isIOS=l();var f=F();this.isDeviceMotionInRadians=!this.isIOS&&f&&f<66,this.isWithoutDeviceMotion=M()||S(),this.filterToWorldQ=new oe,l()?this.filterToWorldQ.setFromAxisAngle(new Ae(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new Ae(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new oe,this.worldToScreenQ=new oe,this.originalPoseAdjustQ=new oe,this.originalPoseAdjustQ.setFromAxisAngle(new Ae(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),E()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new oe,this.orientationOut_=new Float32Array(4),this.start()}At.prototype.getPosition=function(){return null},At.prototype.getOrientation=function(){var u=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var f=new oe().setFromAxisAngle(new Ae(0,0,-1),0),x=new oe;return window.orientation===-90?x.setFromAxisAngle(new Ae(0,1,0),Math.PI/-2):x.setFromAxisAngle(new Ae(0,1,0),Math.PI/2),f.multiply(x)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var f=new oe;return f.setFromAxisAngle(new Ae(1,0,0),-Math.PI/2),f}(),u=this._deviceOrientationQ;var d=new oe;return d.copy(u),d.multiply(this.deviceOrientationFilterToWorldQ),d.multiply(this.resetQ),d.multiply(this.worldToScreenQ),d.multiplyQuaternions(this.deviceOrientationFixQ,d),this.yawOnly&&(d.x=0,d.z=0,d.normalize()),this.orientationOut_[0]=d.x,this.orientationOut_[1]=d.y,this.orientationOut_[2]=d.z,this.orientationOut_[3]=d.w,this.orientationOut_}else{var c=this.filter.getOrientation();u=this.posePredictor.getPrediction(c,this.gyroscope,this.previousTimestampS)}var d=new oe;return d.copy(this.filterToWorldQ),d.multiply(this.resetQ),d.multiply(u),d.multiply(this.worldToScreenQ),this.yawOnly&&(d.x=0,d.z=0,d.normalize()),this.orientationOut_[0]=d.x,this.orientationOut_[1]=d.y,this.orientationOut_[2]=d.z,this.orientationOut_[3]=d.w,this.orientationOut_},At.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),E()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},At.prototype.onDeviceOrientation_=function(u){this._deviceOrientationQ=this._deviceOrientationQ||new oe;var c=u.alpha,d=u.beta,h=u.gamma;c=(c||0)*Math.PI/180,d=(d||0)*Math.PI/180,h=(h||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(d,c,-h)},At.prototype.onDeviceMotion_=function(u){this.updateDeviceMotion_(u)},At.prototype.updateDeviceMotion_=function(u){var c=u.accelerationIncludingGravity,d=u.rotationRate,h=u.timeStamp/1e3,f=h-this.previousTimestampS;if(f<0){Ut("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=h;return}else if(f<=o||f>i){Ut("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=h;return}this.accelerometer.set(-c.x,-c.y,-c.z),d&&(k()?this.gyroscope.set(-d.beta,d.alpha,d.gamma):this.gyroscope.set(d.alpha,d.beta,d.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,h)),this.filter.addAccelMeasurement(this.accelerometer,h),this.previousTimestampS=h},At.prototype.onOrientationChange_=function(u){this.setScreenTransform_()},At.prototype.onMessage_=function(u){var c=u.data;if(!(!c||!c.type)){var d=c.type.toLowerCase();d==="devicemotion"&&this.updateDeviceMotion_(c.deviceMotionEvent)}},At.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new Ae(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new Ae(0,0,1),Math.PI/2);break;case 180:break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},At.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),l()&&re()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},At.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var zx=60,Xx=new Ae(1,0,0),jx=new Ae(0,0,1),Du=new oe;Du.setFromAxisAngle(Xx,-Math.PI/2),Du.multiply(new oe().setFromAxisAngle(jx,Math.PI/2));var qx=function(){function u(c){t(this,u),this.config=c,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new oe,this._outQ=new oe,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return e(u,[{key:"init",value:function(){var d=null;try{d=new RelativeOrientationSensor({frequency:zx,referenceFrame:"screen"}),d.addEventListener("error",this._onSensorError)}catch(h){this.errors.push(h),h.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):h.name==="ReferenceError"?this.useDeviceMotion():console.error(h)}d&&(this.api="sensor",this.sensor=d,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new At(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var d=this.sensor.quaternion;this._sensorQ.set(d[0],d[1],d[2],d[3]);var h=this._outQ;return h.copy(Du),h.multiply(this._sensorQ),this.config.YAW_ONLY&&(h.x=h.z=0,h.normalize()),this._out[0]=h.x,this._out[1]=h.y,this._out[2]=h.z,this._out[3]=h.w,this._out}},{key:"_onSensorError",value:function(d){this.errors.push(d.error),d.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):d.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(d.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),u}(),Qx="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function gr(){this.loadIcon_();var u=document.createElement("div"),A=u.style;A.position="fixed",A.top=0,A.right=0,A.bottom=0,A.left=0,A.backgroundColor="gray",A.fontFamily="sans-serif",A.zIndex=1e6;var c=document.createElement("img");c.src=this.icon;var A=c.style;A.marginLeft="25%",A.marginTop="25%",A.width="50%",u.appendChild(c);var d=document.createElement("div"),A=d.style;A.textAlign="center",A.fontSize="16px",A.lineHeight="24px",A.margin="24px 25%",A.width="50%",d.innerHTML="Place your phone into your Cardboard viewer.",u.appendChild(d);var h=document.createElement("div"),A=h.style;A.backgroundColor="#CFD8DC",A.position="fixed",A.bottom=0,A.width="100%",A.height="48px",A.padding="14px 24px",A.boxSizing="border-box",A.color="#656A6B",u.appendChild(h);var f=document.createElement("div");f.style.float="left",f.innerHTML="No Cardboard viewer?";var x=document.createElement("a");x.href="https://www.google.com/get/cardboard/get-cardboard/",x.innerHTML="get one",x.target="_blank";var A=x.style;A.float="right",A.fontWeight=600,A.textTransform="uppercase",A.borderLeft="1px solid gray",A.paddingLeft="24px",A.textDecoration="none",A.color="#656A6B",h.appendChild(f),h.appendChild(x),this.overlay=u,this.text=d,this.hide()}gr.prototype.show=function(u){!u&&!this.overlay.parentElement?document.body.appendChild(this.overlay):u&&(this.overlay.parentElement&&this.overlay.parentElement!=u&&this.overlay.parentElement.removeChild(this.overlay),u.appendChild(this.overlay)),this.overlay.style.display="block";var c=this.overlay.querySelector("img"),d=c.style;E()?(d.width="20%",d.marginLeft="40%",d.marginTop="3%"):(d.width="50%",d.marginLeft="25%",d.marginTop="25%")},gr.prototype.hide=function(){this.overlay.style.display="none"},gr.prototype.showTemporarily=function(u,c){this.show(c),this.timer=setTimeout(this.hide.bind(this),u)},gr.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},gr.prototype.update=function(){this.disableShowTemporarily(),!E()&&j()?this.show():this.hide()},gr.prototype.loadIcon_=function(){this.icon=s("image/svg+xml",Qx)};var Kx="CardboardV1",Ad="WEBVR_CARDBOARD_VIEWER",Jx="webvr-polyfill-viewer-selector";function vt(u){try{this.selectedKey=localStorage.getItem(Ad)}catch(c){console.error("Failed to load viewer profile: %s",c)}this.selectedKey||(this.selectedKey=u||Kx),this.dialog=this.createDialog_(Ie.Viewers),this.root=null,this.onChangeCallbacks_=[]}vt.prototype.show=function(u){this.root=u,u.appendChild(this.dialog);var c=this.dialog.querySelector("#"+this.selectedKey);c.checked=!0,this.dialog.style.display="block"},vt.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},vt.prototype.getCurrentViewer=function(){return Ie.Viewers[this.selectedKey]},vt.prototype.getSelectedKey_=function(){var u=this.dialog.querySelector("input[name=field]:checked");return u?u.id:null},vt.prototype.onChange=function(u){this.onChangeCallbacks_.push(u)},vt.prototype.fireOnChange_=function(u){for(var c=0;c<this.onChangeCallbacks_.length;c++)this.onChangeCallbacks_[c](u)},vt.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!Ie.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(Ie.Viewers[this.selectedKey]);try{localStorage.setItem(Ad,this.selectedKey)}catch(u){console.error("Failed to save viewer profile: %s",u)}this.hide()},vt.prototype.createDialog_=function(u){var c=document.createElement("div");c.classList.add(Jx),c.style.display="none";var d=document.createElement("div"),x=d.style;x.position="fixed",x.left=0,x.top=0,x.width="100%",x.height="100%",x.background="rgba(0, 0, 0, 0.3)",d.addEventListener("click",this.hide.bind(this));var h=280,f=document.createElement("div"),x=f.style;x.boxSizing="border-box",x.position="fixed",x.top="24px",x.left="50%",x.marginLeft=-h/2+"px",x.width=h+"px",x.padding="24px",x.overflow="hidden",x.background="#fafafa",x.fontFamily="'Roboto', sans-serif",x.boxShadow="0px 5px 20px #666",f.appendChild(this.createH1_("Select your viewer"));for(var A in u)f.appendChild(this.createChoice_(A,u[A].label));return f.appendChild(this.createButton_("Save",this.onSave_.bind(this))),c.appendChild(d),c.appendChild(f),c},vt.prototype.createH1_=function(u){var c=document.createElement("h1"),d=c.style;return d.color="black",d.fontSize="20px",d.fontWeight="bold",d.marginTop=0,d.marginBottom="24px",c.innerHTML=u,c},vt.prototype.createChoice_=function(u,c){var d=document.createElement("div");d.style.marginTop="8px",d.style.color="black";var h=document.createElement("input");h.style.fontSize="30px",h.setAttribute("id",u),h.setAttribute("type","radio"),h.setAttribute("value",u),h.setAttribute("name","field");var f=document.createElement("label");return f.style.marginLeft="4px",f.setAttribute("for",u),f.innerHTML=c,d.appendChild(h),d.appendChild(f),d},vt.prototype.createButton_=function(u,c){var d=document.createElement("button");d.innerHTML=u;var h=d.style;return h.float="right",h.textTransform="uppercase",h.color="#1094f7",h.fontSize="14px",h.letterSpacing=0,h.border=0,h.background="none",h.marginTop="16px",d.addEventListener("click",c),d};var Yx=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zx(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}function $x(u,c){return c={exports:{}},u(c,c.exports),c.exports}var ew=$x(function(u,c){(function(h,f){u.exports=f()})(Yx,function(){return function(d){var h={};function f(x){if(h[x])return h[x].exports;var A=h[x]={i:x,l:!1,exports:{}};return d[x].call(A.exports,A,A.exports,f),A.l=!0,A.exports}return f.m=d,f.c=h,f.d=function(x,A,y){f.o(x,A)||Object.defineProperty(x,A,{configurable:!1,enumerable:!0,get:y})},f.n=function(x){var A=x&&x.__esModule?function(){return x.default}:function(){return x};return f.d(A,"a",A),A},f.o=function(x,A){return Object.prototype.hasOwnProperty.call(x,A)},f.p="",f(f.s=0)}([function(d,h,f){"use strict";var x=function(){function b(C,P){for(var H=0;H<P.length;H++){var z=P[H];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(C,z.key,z)}}return function(C,P,H){return P&&b(C.prototype,P),H&&b(C,H),C}}();function A(b,C){if(!(b instanceof C))throw new TypeError("Cannot call a class as a function")}var y=f(1),T=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,v=function(){function b(){A(this,b),T?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",y),this.noSleepVideo.addEventListener("timeupdate",function(C){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return x(b,[{key:"enable",value:function(){T?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){T?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),b}();d.exports=v},function(d,h,f){"use strict";d.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),tw=Zx(ew),nw=1e3,rw=[0,0,.5,1],ow=[.5,0,.5,1],iw=window.requestAnimationFrame,sw=window.cancelAnimationFrame;function aw(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function vd(u){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:u.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:u.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:u.canPresent},maxLayers:{writable:!1,enumerable:!0,value:u.maxLayers},hasOrientation:{enumerable:!0,get:function(){return Lt("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),u.hasOrientation}}})}function he(u){u=u||{};var c="wakelock"in u?u.wakelock:!0;this.isPolyfilled=!0,this.displayId=nw++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return Lt("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new vd({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,c&&j()&&(this.wakelock_=new tw)}he.prototype.getFrameData=function(u){return Fe(u,this._getPose(),this)},he.prototype.getPose=function(){return Lt("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},he.prototype.resetPose=function(){return Lt("VRDisplay.prototype.resetPose"),this._resetPose()},he.prototype.getImmediatePose=function(){return Lt("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},he.prototype.requestAnimationFrame=function(u){return iw(u)},he.prototype.cancelAnimationFrame=function(u){return sw(u)},he.prototype.wrapForFullscreen=function(u){if(l())return u;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var c=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",c.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==u)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=u,this.originalParent_=u.parentElement,this.originalParent_||document.body.appendChild(u),!this.fullscreenWrapper_.parentElement){var d=this.fullscreenElement_.parentElement;d.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),d.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var h=this;function f(){if(h.fullscreenElement_){var x=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];h.fullscreenElement_.setAttribute("style",x.join("; ")+";")}}return f(),this.fullscreenWrapper_},he.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var u=this.fullscreenElement_;this.fullscreenElementCachedStyle_?u.setAttribute("style",this.fullscreenElementCachedStyle_):u.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var c=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(u),this.originalParent_===c?c.insertBefore(u,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(u),c.removeChild(this.fullscreenWrapper_),u}},he.prototype.requestPresent=function(u){var c=this.isPresenting,d=this;return u instanceof Array||(Lt("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),u=[u]),new Promise(function(h,f){if(!d.capabilities.canPresent){f(new Error("VRDisplay is not capable of presenting."));return}if(u.length==0||u.length>d.capabilities.maxLayers){f(new Error("Invalid number of layers."));return}var x=u[0];if(!x.source){h();return}var A=x.leftBounds||rw,y=x.rightBounds||ow;if(c){var T=d.layer_;T.source!==x.source&&(T.source=x.source);for(var v=0;v<4;v++)T.leftBounds[v]=A[v],T.rightBounds[v]=y[v];d.wrapForFullscreen(d.layer_.source),d.updatePresent_(),h();return}if(d.layer_={predistorted:x.predistorted,source:x.source,leftBounds:A.slice(0),rightBounds:y.slice(0)},d.waitingForPresent_=!1,d.layer_&&d.layer_.source){var b=d.wrapForFullscreen(d.layer_.source),C=function(){var z=D();d.isPresenting=b===z,d.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(K){console.error("screen.orientation.lock() failed due to",K.message)}),d.waitingForPresent_=!1,d.beginPresent_(),h()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),d.removeFullscreenWrapper(),d.disableWakeLock(),d.endPresent_(),d.removeFullscreenListeners_()),d.fireVRDisplayPresentChange_()},P=function(){d.waitingForPresent_&&(d.removeFullscreenWrapper(),d.removeFullscreenListeners_(),d.disableWakeLock(),d.waitingForPresent_=!1,d.isPresenting=!1,f(new Error("Unable to present.")))};d.addFullscreenListeners_(b,C,P),B(b)?(d.enableWakeLock(),d.waitingForPresent_=!0):(l()||p())&&(d.enableWakeLock(),d.isPresenting=!0,d.beginPresent_(),d.fireVRDisplayPresentChange_(),h())}!d.waitingForPresent_&&!l()&&(G(),f(new Error("Unable to present.")))})},he.prototype.exitPresent=function(){var u=this.isPresenting,c=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(d,h){u?(!G()&&l()&&(c.endPresent_(),c.fireVRDisplayPresentChange_()),p()&&(c.removeFullscreenWrapper(),c.removeFullscreenListeners_(),c.endPresent_(),c.fireVRDisplayPresentChange_()),d()):h(new Error("Was not presenting to VRDisplay."))})},he.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},he.prototype.fireVRDisplayPresentChange_=function(){var u=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(u)},he.prototype.fireVRDisplayConnect_=function(){var u=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(u)},he.prototype.addFullscreenListeners_=function(u,c,d){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=u,this.fullscreenChangeHandler_=c,this.fullscreenErrorHandler_=d,c&&(document.fullscreenEnabled?u.addEventListener("fullscreenchange",c,!1):document.webkitFullscreenEnabled?u.addEventListener("webkitfullscreenchange",c,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",c,!1):document.msFullscreenEnabled&&u.addEventListener("msfullscreenchange",c,!1)),d&&(document.fullscreenEnabled?u.addEventListener("fullscreenerror",d,!1):document.webkitFullscreenEnabled?u.addEventListener("webkitfullscreenerror",d,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",d,!1):document.msFullscreenEnabled&&u.addEventListener("msfullscreenerror",d,!1))},he.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var u=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var c=this.fullscreenChangeHandler_;u.removeEventListener("fullscreenchange",c,!1),u.removeEventListener("webkitfullscreenchange",c,!1),document.removeEventListener("mozfullscreenchange",c,!1),u.removeEventListener("msfullscreenchange",c,!1)}if(this.fullscreenErrorHandler_){var d=this.fullscreenErrorHandler_;u.removeEventListener("fullscreenerror",d,!1),u.removeEventListener("webkitfullscreenerror",d,!1),document.removeEventListener("mozfullscreenerror",d,!1),u.removeEventListener("msfullscreenerror",d,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},he.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},he.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},he.prototype.beginPresent_=function(){},he.prototype.endPresent_=function(){},he.prototype.submitFrame=function(u){},he.prototype.getEyeParameters=function(u){return null};var lw={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},ks={LEFT:"left",RIGHT:"right"};function Ve(u){var c=ee({},lw);u=ee(c,u||{}),he.call(this,{wakelock:u.MOBILE_WAKE_LOCK}),this.config=u,this.displayName="Cardboard VRDisplay",this.capabilities=new vd({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new qx(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new Zo(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new Ie(this.dpdb_.getDeviceParams(),u.ADDITIONAL_VIEWERS),this.viewerSelector_=new vt(u.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new gr),l()&&window.addEventListener("resize",this.onResize_.bind(this))}return Ve.prototype=Object.create(he.prototype),Ve.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},Ve.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},Ve.prototype._getFieldOfView=function(u){var c;if(u==ks.LEFT)c=this.deviceInfo_.getFieldOfViewLeftEye();else if(u==ks.RIGHT)c=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",u),null;return c},Ve.prototype._getEyeOffset=function(u){var c;if(u==ks.LEFT)c=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(u==ks.RIGHT)c=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",u),null;return c},Ve.prototype.getEyeParameters=function(u){var c=this._getEyeOffset(u),d=this._getFieldOfView(u),h={offset:c,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(h,"fieldOfView",{enumerable:!0,get:function(){return Lt("VRFieldOfView","VRFrameData's projection matrices"),d}}),h},Ve.prototype.onDeviceParamsUpdated_=function(u){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(u),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},Ve.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},Ve.prototype.beginPresent_=function(){var u=this.layer_.source.getContext("webgl");u||(u=this.layer_.source.getContext("experimental-webgl")),u||(u=this.layer_.source.getContext("webgl2")),u&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(u.canvas.width=W()*this.bufferScale_,u.canvas.height=V()*this.bufferScale_,this.cardboardUI_=new hr(u)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new hr(u)),this.distorter_=new Bt(u,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(c){this.viewerSelector_.show(this.layer_.source.parentElement),c.stopPropagation(),c.preventDefault()}.bind(this),function(c){this.exitPresent(),c.stopPropagation(),c.preventDefault()}.bind(this)),this.rotateInstructions_&&(E()&&j()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},Ve.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},Ve.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},Ve.prototype.submitFrame=function(u){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var c=this.layer_.source.getContext("webgl");c||(c=this.layer_.source.getContext("experimental-webgl")),c||(c=this.layer_.source.getContext("webgl2"));var d=c.canvas;(d.width!=this.lastWidth||d.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=d.width,this.lastHeight=d.height,this.cardboardUI_.render()}},Ve.prototype.onOrientationChange_=function(u){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},Ve.prototype.onResize_=function(u){if(this.layer_){var c=this.layer_.source.getContext("webgl");c||(c=this.layer_.source.getContext("experimental-webgl")),c||(c=this.layer_.source.getContext("webgl2"));var d=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];c.canvas.setAttribute("style",d.join("; ")+";"),we(c.canvas)}},Ve.prototype.onViewerChanged_=function(u){this.deviceInfo_.setViewer(u),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},Ve.prototype.fireVRDisplayDeviceParamsChange_=function(){var u=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(u)},Ve.VRFrameData=aw,Ve.VRDisplay=he,Ve})});function pi(n,t,e){return typeof n===t||n instanceof e}function Z(n){return pi(n,"function",Function)}function de(n){return pi(n,"string",String)}function St(n){return pi(n,"boolean",Boolean)}function ge(n){return pi(n,"number",Number)}function Cs(n){return L(n)||!Number.isFinite(n)||Number.isNaN(n)}function lt(n){return ge(n)&&!Cs(n)}function Jr(n){return w(n)&&pi(n,"object",Object)}function Ds(n){return n instanceof Date}function jt(n){return n instanceof Array}function dn(n,t){throw new Error((t||"Unexpected object: ")+n)}function L(n){return n==null}function w(n){return!L(n)}function xw(n){return n}function ww(n,t,e){let r=0,o=n.length,i=Math.floor((r+o)/2),s=!1;for(;r<o&&i<n.length;){let a=n[i],l=L(a)?null:e(a);w(l)&&t<l?o=i:(t===l&&(s=!0),r=i+1),i=Math.floor((r+o)/2)}return s||(i+=.5),i}function Fw(n,t,e){e=e||xw;let r=e(t);return ww(n,r,e)}function ue(n){return n.splice(0)}function Sd(n,t){for(let e=0;e<n.length;++e)if(n[e]!==t[e])return e;return-1}function Pu(n,t,e){n.splice(e,0,t)}function Ce(n,t){let e=n.indexOf(t);return e>-1?(Ls(n,e),!0):!1}function Aw(n,t){for(let e=n.length-1;e>=0;--e)if(t(n[e]))return Ls(n,e);return null}function bd(n,t,e){return Aw(n,r=>e(r)===t)}function Ls(n,t){return n.splice(t,1)[0]}function _d(n,...t){n.splice(0,n.length,...t)}function vw(n,t,e){let r=n?0:t.length-1,o=n?t.length:-1,i=n?1:-1;for(let s of e)for(let a=r;a!=o;a+=i){let l=t[a];if(s(l))return l}return null}function nt(n,...t){return vw(!0,n,t)}function Bs(n,t,e,r){let o;return Z(e)?o=e:St(e)&&(r=e),L(r)&&(r=!0),Sw(n,t,o,r)}function Sw(n,t,e,r){let o=Fw(n,t,e),i=o%1===0;return o=o|0,(!i||r)&&Pu(n,t,o),o}function Ps(n,t){let e=Array.from(n);return xr(e,t),e}function xr(n,t){n.sort((e,r)=>{let o=t(e),i=t(r);return o<i?-1:o>i?1:0})}function Bn(n){return n}function Td(n,t){return n&&t}var le=class{constructor(t,e,r,...o){this.key=t;this.value=e;this.bySetAttribute=r;this.tags=o.map(i=>i.toLocaleUpperCase()),Object.freeze(this)}applyToElement(t){let e=this.key.startsWith("data-");if(!(this.tags.length===0||this.tags.indexOf(t.tagName)>-1||e))console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`);else if(e){let o=this.key.substring(5);t.dataset[o]=this.value}else if(this.key==="style")Object.assign(t.style,this.value);else if(this.key==="classList"){let o=this.value.filter(Bn);o.length>0&&o.forEach(i=>t.classList.add(i))}else this.bySetAttribute?t.setAttribute(this.key,this.value):this.key in t?t[this.key]=this.value:this.value===!1?t.removeAttribute(this.key):this.value===!0?t.setAttribute(this.key,""):t.setAttribute(this.key,this.value)}};function Ru(n){return n instanceof le}function Ed(n,...t){let e=[...t],r=nt(n,i=>i instanceof le&&i.key==="classList");w(r)&&(Ce(n,r),e.push(...r.value));let o=nt(n,i=>i instanceof le&&i.key==="className");return w(o)&&(Ce(n,o),e.push(...o.value.split(" "))),e}function mn(n){return new le("autoplay",n,!1,"audio","video")}function Rs(n){return new le("checked",n,!1,"command","input")}function gt(n){return new le("className",n,!1)}function Ue(...n){return new le("classList",n,!1)}function Pt(n){return new le("controls",n,!1,"audio","video")}function Is(n,t){return new le("data-"+n.toLowerCase(),t,!1)}function yd(n){return new le("htmlFor",n,!1,"label","output")}function Md(n){return new le("height",n,!1,"canvas","embed","iframe","img","input","object","video")}function Vs(n){return new le("id",n,!1)}function Pn(n){return new le("loop",n,!1,"audio","bgsound","marquee","video")}function wr(n){return new le("max",n,!1,"input","meter","progress")}function Fr(n){return new le("min",n,!1,"input","meter")}function Os(n){return new le("muted",n,!1,"audio","video")}function kd(n){return new le("selected",n,!1,"option")}function bw(n){return n instanceof URL&&(n=n.href),n}function Yr(n){return new le("src",bw(n),!1,"audio","embed","iframe","img","input","script","source","track","video")}function di(n){return new le("srcObject",n,!1,"audio","video")}function Ar(n){return new le("step",n,!1,"input")}function Ws(n){return new le("title",n,!1)}function mi(n){return de(n)||(n=n.value),new le("type",n,!1,"button","input","command","embed","link","object","script","source","style","menu")}function qt(n){return new le("value",n,!1,"button","data","input","li","meter","option","progress","param")}function Cd(n){return new le("width",n,!1,"canvas","embed","iframe","img","input","object","video")}var hi=class{constructor(){this.listeners=new Map;this.listenerOptions=new Map}addEventListener(t,e,r){if(Z(e)){let o=this.listeners.get(t);o||(o=new Array,this.listeners.set(t,o)),o.find(i=>i===e)||(o.push(e),r&&this.listenerOptions.set(e,r))}}removeEventListener(t,e){if(Z(e)){let r=this.listeners.get(t);r&&this.removeListener(r,e)}}clearEventListeners(t){for(let[e,r]of this.listeners)if(L(t)||t===e){for(let o of r)this.removeEventListener(t,o);ue(r),this.listeners.delete(e)}}removeListener(t,e){let r=t.findIndex(o=>o===e);r>=0&&(Ls(t,r),this.listenerOptions.has(e)&&this.listenerOptions.delete(e))}dispatchEvent(t){let e=this.listeners.get(t.type);if(e)for(let r of e){let o=this.listenerOptions.get(r);w(o)&&!St(o)&&o.once&&this.removeListener(e,r),r.call(this,t)}return!t.defaultPrevented}},N=class extends Event{get type(){return super.type}constructor(t,e){super(t,e)}},te=class extends hi{constructor(){super(...arguments);this.bubblers=new Set;this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addEventListener(e,r,o){super.addEventListener(e,r,o)}removeEventListener(e,r){super.removeEventListener(e,r)}clearEventListeners(e){return super.clearEventListeners(e)}addScopedEventListener(e,r,o,i){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([r,o]),this.addEventListener(r,o,i)}removeScope(e){let r=this.scopes.get(e);if(r){this.scopes.delete(e);for(let[o,i]of r)this.removeEventListener(o,i)}}dispatchEvent(e){if(!super.dispatchEvent(e))return!1;if(!e.cancelBubble){for(let r of this.bubblers)if(!r.dispatchEvent(e))return!1}return!0}};var vr=class extends te{constructor(){super(...arguments);this.attached=new Array;this.soFar=null;this.total=null;this.msg=null;this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(e,r,o,i){this.soFar=e,this.total=r,this.msg=o,this.est=i;for(let s of this.attached)s.report(e,r,o,i)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(e){this.report(0,1,e||"starting")}end(e){this.report(1,1,e||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,ue(this.attached)}};var We=class extends Error{constructor(e,r=null){super(e);this.innerError=r}};var Se=class{constructor(t=!0){this.autoStart=t;this.onThens=new Array;this.onCatches=new Array;this._result=void 0;this._error=void 0;this._executionState="waiting";this._resultState="none";this.resolve=e=>{if(this.running){this._result=e,this._resultState="resolved";for(let r of this.onThens)r(e);this.clear(),this._executionState="finished"}},this.reject=e=>{if(this.running){this._error=e,this._resultState="errored";for(let r of this.onCatches)r(e);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){ue(this.onThens),ue(this.onCatches)}start(){this._executionState="running"}resolver(t){return()=>this.resolve(t)}resolveOn(t,e,r){let o=this.resolver(r);t.addEventListener(e,o),this.finally(()=>t.removeEventListener(e,o))}get result(){if(w(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((t,e)=>{this.finished?this.errored?e(this.error):t(this.result):(this.onThens.push(t),this.onCatches.push(e))})}then(t,e){return this.project().then(t,e)}catch(t){return this.project().catch(t)}finally(t){return this.project().finally(t)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(t){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",t&&this.start()}};function Dd(n,t){return"on"+t in n}function hn(n,t,e,...r){L(r)&&(r=[]);let o;if(de(e)?r.unshift(e):ge(e)&&(o=e),!(n instanceof hi)){if(!Dd(n,t))throw new We(`Target does not have a ${t} rejection event`);for(let l of r)if(!Dd(n,l))throw new We(`Target does not have a ${l} rejection event`)}let i=new Se;if(ge(o)){let l=setTimeout(i.reject,o,`'${t}' has timed out.`);i.finally(clearTimeout.bind(globalThis,l))}let s=(l,p)=>{n.addEventListener(l,p),i.finally(()=>n.removeEventListener(l,p))};s(t,l=>i.resolve(l));let a=l=>i.reject(l);for(let l of r)s(l,a);return i}function fn(n){return`${n}%`}function gn(n){return`${n}em`}function Hs(n){return`${n}px`}function Ld(n){return`${n}pt`}function Bd(n){return`${n}fr`}function Rt(...n){return`rgb(${n.join(", ")})`}function Zr(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}var Iu=class{constructor(t){this._value=t}get value(){return this._value}toString(){return this.value}},Vu=class{constructor(t,e,r){this.pre=t;this.props=e;this.post=r}get value(){return this.pre+this.props.map(t=>t.toString()).join(`
`)+this.post}toString(){return this.value}applyToSheet(t){t.insertRule(this.toString(),t.cssRules.length)}},Ou=class extends Iu{constructor(e,r,o){super(o);this._name=e;this.sep=r}get name(){return this._name}toString(){return this.name+this.sep+this.value+";"}},Wu=class extends Vu{constructor(t,e){super(t+` {
`,e,`
}
`)}},Hu=class extends Ou{constructor(t,e){super(t,": ",e)}},De=class extends Hu{constructor(e,r){super(e.replace(/[A-Z]/g,o=>`-${o.toLocaleLowerCase()}`),r.toString());this.key=e;this.priority=""}applyToElement(e){e.style[this.key]=this.value+this.priority}important(){return this.priority=" !important",this}get value(){return super.value+this.priority}};function Gu(n){return n instanceof De}var Nu=class extends Wu{constructor(t,e){super(t,e)}};function Pd(n,...t){return new Nu(n,t)}function Rd(n){return new De("alignItems",n)}function Id(n){return new De("backgroundColor",n)}function Vd(n){return new De("columnGap",n)}function rt(n){return new De("display",n)}function Od(n){return new De("flexDirection",n)}function Wd(n){return new De("fontSize",n)}function Hd(...n){return new De("gap",n.join(" "))}function Nd(...n){return new De("gridTemplateColumns",n.join(" "))}function Uu(n){return new De("height",n)}function zu(...n){return new De("margin",n.join(" "))}function Gd(n){return new De("maxWidth",n)}function Ud(...n){return new De("padding",n.join(" "))}function zd(n){return new De("paddingRight",n)}function Xd(n){return new De("pointerEvents",n)}function jd(n){return new De("textAlign",n)}function qd(...n){return new De("transform",n.join(" "))}function Sr(n){return new De("width",n)}function Ns(n){return Jr(n)?n.element instanceof Element:!1}function Qt(n){return Ns(n)?n.element:de(n)?_w(n):n}function Qd(n){return Jr(n)&&"applyToElement"in n&&Z(n.applyToElement)}function Kd(n){return n instanceof Element||Ns(n)||Qd(n)||de(n)||ge(n)||St(n)||Ds(n)}function Xe(n,t,e=""){n=Qt(n),n.style.display=t?e:"none"}function bt(n){return n=Qt(n),n.style.display!=="none"}function $(n,...t){n=Qt(n);for(let e of t)w(e)&&(e instanceof Node?n.append(e):Ns(e)?n.append(Qt(e)):Qd(e)?e.applyToElement(n):n.append(document.createTextNode(e.toLocaleString())));return n}function _w(n){return document.querySelector(n)}function Jd(n){return Array.from(document.querySelectorAll(n))}function Je(n,...t){let e=null;for(let r of t)if(r instanceof le&&r.key==="id"){e=document.getElementById(r.value);break}return e==null&&(e=document.createElement(n)),$(e,...t),e}function fi(n){return Jr(n)&&"disabled"in n&&St(n.disabled)}function gi(n){for(n=Qt(n);n.lastChild;)n.lastChild.remove()}function Gs(n,t){n=Qt(n),gi(n),n.append(Ew(t))}function Yd(n,t,e){n=Qt(n);let r=w(e),o=r&&n.classList.contains(e);r&&o!==t&&n.classList.toggle(e)}async function Zd(n,t,e){w(e)&&e.start();let r=n==="canplay"?t.HAVE_CURRENT_DATA:t.HAVE_ENOUGH_DATA;if(t.readyState>=r)return!0;try{return await hn(t,n,"error"),!0}catch(o){return console.warn(t.error,o),!1}finally{w(e)&&e.end()}}function $d(n,t){return Zd("canplay",n,t)}function Us(n,t){return Zd("canplaythrough",n,t)}function Kt(...n){return Je("audio",...n)}function Tw(...n){return Je("button",...n)}function em(...n){return Tw(...n,mi("button"))}function $r(...n){return em(...n,Ue("btn","btn-primary"))}function zs(...n){return em(...n,Ue("btn","btn-secondary"))}function Xs(...n){return Je("canvas",...n)}function Xu(...n){return Je("dd",...n)}function fe(...n){return Je("div",...n)}function tm(...n){return Je("dl",...n)}function nm(...n){return Je("dt",...n)}function rm(...n){return Je("h1",...n)}function om(...n){return Je("h2",...n)}function xi(...n){return Je("img",...n)}function ju(...n){return Je("input",...n)}function qu(...n){return Je("label",...n)}function eo(n,t,e){return Qt(e).id=n,[qu(yd(n),t),e]}function im(...n){return Je("meter",...n)}function js(...n){return Je("option",...n)}function qs(...n){return Je("select",...n)}function wi(...n){return Je("video",...n)}function Fi(...n){return ju(mi("checkbox"),...n)}function to(...n){return ju(mi("number"),...n)}function sm(...n){return ju(mi("range"),...n)}function Ew(n){return document.createTextNode(n)}function am(...n){let t=document.createElement("style");document.head.append(t);for(let e of n)e.applyToSheet(t.sheet)}function no(n){return!(n.shiftKey||n.altKey||n.ctrlKey||n.metaKey)}var Qu=class{constructor(t,e,r){this.name=t;this.callback=e;if(!Z(e))throw new Error("A function instance is required for this parameter");this.opts=r,Object.freeze(this)}applyToElement(t){this.add(t)}add(t){t.addEventListener(this.name,this.callback,this.opts)}remove(t){t.removeEventListener(this.name,this.callback)}};function Ai(n,t,e){return new Qu(n,t,e)}function lm(n,t){return Ai("click",n,t)}function Jt(n,t){return Ai("input",n,t)}function um(n,t){return Ai("play",n,t)}var cm=["change","click","contextmenu","dblclick","mouseup","pointerup","reset","submit","touchend"];function Yt(n,t=!1){let e=async r=>{if(r.isTrusted){if(!t)for(let o of cm)window.removeEventListener(o,e);n()}};for(let r of cm)window.addEventListener(r,e)}function pm(n){if(n.status>=400)throw new Error("Resource could not be retrieved: "+n.requestPath);return n}function ro(n){let{content:t}=pm(n);return t}function br(...n){return Promise.all(n)}function dm(){return"chrome"in globalThis&&!navigator.userAgent.match("CriOS")}function mm(){return"InstallTrigger"in globalThis}function hm(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function yw(){return/^mac/i.test(navigator.platform)}function oo(){return/iP(ad|hone|od)/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||yw()&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>2}function xn(){return/Mobile VR/.test(navigator.userAgent)||/Pico Neo 3 Link/.test(navigator.userAgent)||wn}function Ks(){return"xr"in navigator&&"isSessionSupported"in navigator.xr}function Ku(){return"getVRDisplays"in navigator}function Js(){return Ks()||Ku()}function vi(){return/Android/.test(navigator.userAgent)||/BlackBerry/.test(navigator.userAgent)||/(UC Browser |UCWEB)/.test(navigator.userAgent)||oo()||xn()}function io(){return!vi()}var Mw=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,Qs=navigator.userAgent.match(Mw),wn=!!Qs,fm=wn&&{major:parseFloat(Qs[1]),minor:parseFloat(Qs[2]),patch:parseFloat(Qs[3])},mS=wn&&/pacific/i.test(navigator.userAgent),hS=wn&&/quest/i.test(navigator.userAgent),fS=wn&&/quest 2/i.test(navigator.userAgent);var gS="Worker"in globalThis;function so(...n){let t=[];for(let e of n)w(e)&&e.length>0&&t.indexOf(e)===-1&&t.push(e);return t.join("-")}function Ju(n,...t){if(!Jr(n))return!1;n=n;for(let e of t){if(!(e in n))return!1;let r=n[e];if(!Z(r))return!1}return!0}function kw(n){return Ju(n,"dispose")}function Cw(n){return Ju(n,"destroy")}function Dw(n){return Ju(n,"close")}function Le(n){kw(n)&&n.dispose(),Dw(n)&&n.close(),Cw(n)&&n.destroy()}function Si(n){return w(n)&&"_resolveInput"in n}function bi(n){return Si(n)&&"_resolveOutput"in n}var ao=class extends te{constructor(e,r){super();this.nodeType=e;this.context=r;this._name=null;this.disposed=!1}get name(){return this._name}set name(e){this._name=e,this.context._name(this,e)}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){}isConnected(e,r,o){return this.context._isConnected(this,e,r,o)}resolveOutput(e){let r={source:this,output:e};for(;bi(r.source);)r=r.source._resolveOutput(r.output);return r}resolveInput(e){let r={destination:this,input:e};for(;Si(r.destination);)r=r.destination._resolveInput(r.input);return r}toggle(e,r,o){this._toggle(e,r,o)}_toggle(e,r,o){if(this.isConnected(e,r,o))this._disconnect(e,r,o);else return this._connect(e,r,o)}connect(e,r,o){return this._connect(e,r,o)}_connect(e,r,o){return this.context._connect(this,e,r,o)}disconnect(e,r,o){this._disconnect(e,r,o)}_disconnect(e,r,o){this.context._disconnect(this,e,r,o)}};var je=class extends ao{constructor(e,r,o,i,s){super(e,r);o=o||[],s=s||[];let a=i||o;this.inputs=o;let l=o.filter(bi).map(p=>p);this.outputs=a.filter(bi).map(p=>p),this.allNodes=Array.from(new Set([...l,...this.outputs,...s]))}get exemplar(){return this.allNodes[0]}add(e){this.allNodes.push(e),this.context._parent(this,e)}remove(e){Ce(this.allNodes,e),this.context._unparent(this,e)}onDisposing(){this.allNodes.forEach(Le),super.onDisposing()}get channelCount(){return this.exemplar.channelCount}set channelCount(e){this.allNodes.forEach(r=>r.channelCount=e)}get channelCountMode(){return this.exemplar.channelCountMode}set channelCountMode(e){this.allNodes.forEach(r=>r.channelCountMode=e)}get channelInterpretation(){return this.exemplar.channelInterpretation}set channelInterpretation(e){this.allNodes.forEach(r=>r.channelInterpretation=e)}get numberOfInputs(){return this.inputs.length}get numberOfOutputs(){return this.outputs.length}static resolve(e,r){return r=r||0,r<0||e.length<=r?null:e[r]}_resolveInput(e){return{destination:je.resolve(this.inputs,e)}}_resolveOutput(e){return{source:je.resolve(this.outputs,e)}}};function Lw(n){return n[0]}function Bw(n){return n.shift()}function Pw(n){return n[n.length-1]}function Rw(n){return n.pop()}var Ys=class{constructor(t){this.value=t;this._forward=new Array;this._reverse=new Array}connectSorted(t,e){w(e)?(Bs(this._forward,t,r=>e(r.value)),Bs(t._reverse,this,r=>e(r.value))):this.connectTo(t)}connectTo(t){this.connectAt(t,this._forward.length)}connectAt(t,e){Pu(this._forward,t,e),t._reverse.push(this)}disconnectFrom(t){Ce(this._forward,t),Ce(t._reverse,this)}isConnectedTo(t){return this._forward.indexOf(t)>=0||this._reverse.indexOf(t)>=0}flatten(){let t=new Set,e=[this];for(;e.length>0;){let r=e.shift();w(r)&&!t.has(r)&&(t.add(r),e.push(...r._forward))}return Array.from(t)}*traverse(t){let e=new Set,r=[this],o=t?Lw:Pw,i=t?Bw:Rw;for(;r.length>0;){let s=o(r);e.has(s)?t||(i(r),yield s):(e.add(s),t&&(i(r),yield s),s._forward.length>0&&r.push(...s._forward))}}breadthFirst(){return this.traverse(!0)}depthFirst(){return this.traverse(!1)}search(t,e=!0){for(let r of this.traverse(e))if(t(r))return r;return null}*searchAll(t,e=!0){for(let r of this.traverse(e))t(r)&&(yield r)}find(t,e=!0){return this.search(r=>r.value===t,e)}findAll(t,e=!0){return this.searchAll(r=>r.value===t,e)}contains(t,e=!0){for(let r of this.traverse(e))if(r===t)return!0;return!1}containsValue(t,e=!0){for(let r of this.traverse(e))if(r.value===t)return!0;return!1}get _isEntryPoint(){return this._reverse.length===0}get _isExitPoint(){return this._forward.length===0}get isDisconnected(){return this._isEntryPoint&&this._isExitPoint}get isConnected(){return!this._isExitPoint||!this._isEntryPoint}get isTerminus(){return this._isEntryPoint||this._isExitPoint}get isInternal(){return!this._isEntryPoint&&!this._isExitPoint}};var Zs=class extends Ys{get connections(){return this._forward}get isEntryPoint(){return this._isEntryPoint}get isExitPoint(){return this._isExitPoint}};var Q=class extends ao{constructor(e,r,o){super(e,r);this._node=o;this.context._init(this._node,this.nodeType)}onDisposing(){this.disconnect(),this.context._dispose(this._node),super.onDisposing()}parent(e){this.context._parent(this,e)}get channelCount(){return this._node.channelCount}set channelCount(e){this._node.channelCount=e}get channelCountMode(){return this._node.channelCountMode}set channelCountMode(e){this._node.channelCountMode=e}get channelInterpretation(){return this._node.channelInterpretation}set channelInterpretation(e){this._node.channelInterpretation=e}get numberOfInputs(){return this._node.numberOfInputs}get numberOfOutputs(){return this._node.numberOfOutputs}_resolveInput(e){return{destination:this._node,input:e}}_resolveOutput(e){return{source:this._node,output:e}}};var lo=class extends Q{constructor(t,e){super("analyser",t,new AnalyserNode(t,e))}get fftSize(){return this._node.fftSize}set fftSize(t){this._node.fftSize=t}get frequencyBinCount(){return this._node.frequencyBinCount}get maxDecibels(){return this._node.maxDecibels}set maxDecibels(t){this._node.maxDecibels=t}get minDecibels(){return this._node.minDecibels}set minDecibels(t){this._node.minDecibels=t}get smoothingTimeConstant(){return this._node.smoothingTimeConstant}set smoothingTimeConstant(t){this._node.smoothingTimeConstant=t}getByteFrequencyData(t){this._node.getByteFrequencyData(t)}getByteTimeDomainData(t){this._node.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._node.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._node.getFloatTimeDomainData(t)}};var J=class{constructor(t,e,r){this.nodeType=t;this.context=e;this.param=r;this._name=null;this.disposed=!1;this.context._init(this.param,this.nodeType)}get name(){return this._name}set name(t){this._name=t,this.context._name(this,t)}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){this.context._dispose(this.param)}get automationRate(){return this.param.automationRate}set automationRate(t){this.param.automationRate=t}get defaultValue(){return this.param.defaultValue}get maxValue(){return this.param.maxValue}get minValue(){return this.param.minValue}get value(){return this.param.value}set value(t){this.param.value=t}cancelAndHoldAtTime(t){return this.param.cancelAndHoldAtTime(t),this}cancelScheduledValues(t){return this.param.cancelScheduledValues(t),this}exponentialRampToValueAtTime(t,e){return this.param.exponentialRampToValueAtTime(t,e),this}linearRampToValueAtTime(t,e){return this.param.linearRampToValueAtTime(t,e),this}setTargetAtTime(t,e,r){return this.param.setTargetAtTime(t,e,r),this}setValueAtTime(t,e){return this.param.setValueAtTime(t,e),this}setValueCurveAtTime(t,e,r){return this.param.setValueCurveAtTime(t,e,r),this}_resolveInput(){return{destination:this.param}}resolveInput(){return this._resolveInput()}};var $s=class extends Q{constructor(e,r){super("audio-buffer-source",e,new AudioBufferSourceNode(e,r));this._node.addEventListener("ended",()=>this.dispatchEvent(new N("ended"))),this.parent(this.playbackRate=new J("playbackRate",e,this._node.playbackRate)),this.parent(this.detune=new J("detune",e,this._node.detune))}get buffer(){return this._node.buffer}set buffer(e){this._node.buffer=e}get loop(){return this._node.loop}set loop(e){this._node.loop=e}get loopEnd(){return this._node.loopEnd}set loopEnd(e){this._node.loopEnd=e}get loopStart(){return this._node.loopStart}set loopStart(e){this._node.loopStart=e}get onended(){return this._node.onended}set onended(e){this._node.onended=e}start(e,r,o){this._node.start(e,r,o)}stop(e){this._node.stop(e)}};var ea=class extends Q{constructor(t,e){super("destination",t,e)}get maxChannelCount(){return this._node.maxChannelCount}};var Zt=class extends Q{constructor(e,r){super("biquad-filter",e,new BiquadFilterNode(e,r));this.parent(this.Q=new J("Q",this.context,this._node.Q)),this.parent(this.detune=new J("detune",this.context,this._node.detune)),this.parent(this.frequency=new J("frequency",this.context,this._node.frequency)),this.parent(this.gain=new J("gain",this.context,this._node.gain))}get type(){return this._node.type}set type(e){this._node.type=e}getFrequencyResponse(e,r,o){this._node.getFrequencyResponse(e,r,o)}};var ta=class extends Q{constructor(t,e){super("channel-merger",t,new ChannelMergerNode(t,e))}};var na=class extends Q{constructor(t,e){super("channel-splitter",t,new ChannelSplitterNode(t,e))}};var ra=class extends Q{constructor(e,r){super("constant-source",e,new ConstantSourceNode(e,r));this._node.addEventListener("ended",()=>this.dispatchEvent(new N("ended"))),this.parent(this.offset=new J("offset",this.context,this._node.offset))}get onended(){return this._node.onended}set onended(e){this._node.onended=e}start(e){this._node.start(e)}stop(e){this._node.stop(e)}};var oa=class extends Q{constructor(t,e){super("convolver",t,new ConvolverNode(t,e))}get buffer(){return this._node.buffer}set buffer(t){this._node.buffer=t}get normalize(){return this._node.normalize}set normalize(t){this._node.normalize=t}};var ia=class extends Q{constructor(e,r){super("delay",e,new DelayNode(e,r));this.parent(this.delayTime=new J("delay",this.context,this._node.delayTime))}};var uo=class extends Q{constructor(e,r){super("dynamics-compressor",e,new DynamicsCompressorNode(e,r));this.parent(this.attack=new J("attack",this.context,this._node.attack)),this.parent(this.knee=new J("knee",this.context,this._node.knee)),this.parent(this.ratio=new J("ratio",this.context,this._node.ratio)),this.parent(this.release=new J("release",this.context,this._node.release)),this.parent(this.threshold=new J("threshold",this.context,this._node.threshold))}get reduction(){return this._node.reduction}};var _t=class extends Q{constructor(e,r){super("gain",e,new GainNode(e,r));this.parent(this.gain=new J("gain",this.context,this._node.gain))}};var sa=class extends Q{constructor(t,e){super("iir-filter",t,new IIRFilterNode(t,e))}getFrequencyResponse(t,e,r){this._node.getFrequencyResponse(t,e,r)}};var It=class extends Q{constructor(t,e){super("media-element-audio-source",t,new MediaElementAudioSourceNode(t,e))}get mediaElement(){return this._node.mediaElement}};var Rn=class extends Q{constructor(t,e){super("media-stream-audio-destination",t,new MediaStreamAudioDestinationNode(t,e))}get stream(){return this._node.stream}};var Iw="AudioContext"in globalThis,gm=Iw&&"AudioListener"in globalThis,xm=gm&&"setPosition"in AudioListener.prototype,_i=gm&&"positionX"in AudioListener.prototype,Yu="createMediaStreamSource"in AudioContext.prototype,yb=Z(HTMLMediaElement.prototype.captureStream)||Z(HTMLMediaElement.prototype.mozCaptureStream);var In=class extends Q{constructor(e,r){let o=Kt(Pt(!1),Os(Yu),mn(!0),Pn(!1),rt("none"),di(r.mediaStream)),i;Yu?i=new MediaStreamAudioSourceNode(e,r):i=new MediaElementAudioSourceNode(e,{mediaElement:o});super("media-stream-audio-source",e,i);this._stream=r.mediaStream,this._element=o}onDisposing(){this._element.pause(),super.onDisposing()}get mediaStream(){return this._stream}};var aa=class extends Q{constructor(e,r){super("oscillator",e,new OscillatorNode(e,r));this._node.addEventListener("ended",()=>this.dispatchEvent(new N("ended"))),this.parent(this.detune=new J("detune",this.context,this._node.detune)),this.parent(this.frequency=new J("frequency",this.context,this._node.frequency))}get type(){return this._node.type}set type(e){this._node.type=e}get onended(){return this._node.onended}set onended(e){this._node.onended=e}setPeriodicWave(e){this._node.setPeriodicWave(e)}start(e){this._node.start(e)}stop(e){this._node.stop(e)}};var co=class extends Q{constructor(e,r){super("panner",e,new PannerNode(e,r));this.parent(this.positionX=new J("positionX",this.context,this._node.positionX)),this.parent(this.positionY=new J("positionY",this.context,this._node.positionY)),this.parent(this.positionZ=new J("positionZ",this.context,this._node.positionZ)),this.parent(this.orientationX=new J("orientationX",this.context,this._node.orientationX)),this.parent(this.orientationY=new J("orientationY",this.context,this._node.orientationY)),this.parent(this.orientationZ=new J("orientationZ",this.context,this._node.orientationZ))}get coneInnerAngle(){return this._node.coneInnerAngle}set coneInnerAngle(e){this._node.coneInnerAngle=e}get coneOuterAngle(){return this._node.coneOuterAngle}set coneOuterAngle(e){this._node.coneOuterAngle=e}get coneOuterGain(){return this._node.coneOuterGain}set coneOuterGain(e){this._node.coneOuterGain=e}get distanceModel(){return this._node.distanceModel}set distanceModel(e){this._node.distanceModel=e}get maxDistance(){return this._node.maxDistance}set maxDistance(e){this._node.maxDistance=e}get panningModel(){return this._node.panningModel}set panningModel(e){this._node.panningModel=e}get refDistance(){return this._node.refDistance}set refDistance(e){this._node.refDistance=e}get rolloffFactor(){return this._node.rolloffFactor}set rolloffFactor(e){this._node.rolloffFactor=e}setOrientation(e,r,o){this._node.setOrientation(e,r,o)}setPosition(e,r,o){this._node.setPosition(e,r,o)}};var la=class extends Q{constructor(e,r){super("stereo-panner",e,new StereoPannerNode(e,r));this.parent(this.pan=new J("pan",this.context,this._node.pan))}};var ua=class extends Q{constructor(t,e){super("wave-shaper",t,new WaveShaperNode(t,e))}get curve(){return this._node.curve}set curve(t){this._node.curve=t}get oversample(){return this._node.oversample}set oversample(t){this._node.oversample=t}};!("AudioContext"in globalThis)&&"webkitAudioContext"in globalThis&&(globalThis.AudioContext=globalThis.webkitAudioContext);!("OfflineAudioContext"in globalThis)&&"webkitOfflineAudioContext"in globalThis&&(globalThis.OfflineAudioContext=globalThis.webkitOfflineAudioContext);var Zu=class{constructor(t,e){this.type=t;this.name=e;this.connections=new Set}};function ca(n,t,e,r,o){return n.type===t&&(L(e)||e===n.destination)&&(L(r)||r===n.output)&&(L(o)||o===n.input)}function po(n,t){let e=null,r=null;return w(n)&&({destination:e,input:r}=n.resolveInput(t)),{destination:e,input:r}}var pa=class extends AudioContext{constructor(e){super(e);this.counters=new Map;this.nodes=new Map;this._ready=new Se;this._destination=new ea(this,super.destination),this.state==="running"?this._ready.resolve():this.state==="closed"?this.resume().then(()=>this._ready.resolve()):Yt(()=>this.resume().then(()=>this._ready.resolve())),this.ready.then(()=>console.log("Audio is now ready"))}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}_init(e,r){if(!this.nodes.has(e)){this.counters.has(r)||this.counters.set(r,0);let o=this.counters.get(r),i=`${r}-${o}`;this.nodes.set(e,new Zu(r,i)),Si(e)&&(e.name=i),this.counters.set(r,o+1)}}_name(e,r){let{destination:o}=po(e);if(this.nodes.has(o)){let i=this.nodes.get(o);i.name=`${r}-${i.type}`}}_dispose(e){this.nodes.delete(e)}_isConnected(e,r,o,i){let{source:s,output:a}=e.resolveOutput(o),{destination:l,input:p}=po(r,i);if(L(s)||!this.nodes.has(s))return null;{let m=this.nodes.get(s);for(let g of m.connections)if(ca(g,"conn",l,a,p))return!0;return!1}}_parent(e,r){let{source:o}=e.resolveOutput(),{destination:i}=po(r);this.nodes.has(o)&&this.nodes.get(o).connections.add({type:"parent",src:e,dest:r,destination:i,source:o})}_unparent(e,r){let{source:o}=e.resolveOutput(),{destination:i}=po(r);if(this.nodes.has(o)){let s=this.nodes.get(o).connections,a=new Set;for(let l of s)ca(l,"parent",i)&&a.add(l);for(let l of a)s.delete(l)}}_getConnections(e){return this.nodes.has(e)?this.nodes.get(e).connections:null}_connect(e,r,o,i){let{source:s,output:a}=e.resolveOutput(o),{destination:l,input:p}=po(r,i);if(this.nodes.has(s)){let m=this.nodes.get(s).connections,g=!1;for(let F of m)ca(F,"conn",l,a,p)&&(g=!0);g||m.add({type:"conn",src:e,dest:r,outp:o,inp:i,source:s,destination:l,output:a,input:p})}if(l instanceof AudioNode)return r=r,w(p)?(s.connect(l,a,p),r):w(a)?(s.connect(l,a),r):(s.connect(l),r);l instanceof AudioParam?w(a)?s.connect(l,a):w(l)?s.connect(l):dn(l):dn(l)}_disconnect(e,r,o,i){let s;ge(r)?(s=void 0,o=r):s=r;let{source:a,output:l}=e.resolveOutput(o),{destination:p,input:m}=po(s,i);if(this.nodes.has(a)){let g=this.nodes.get(a).connections,F=new Set;for(let S of g)ca(S,"conn",p,l,m)&&F.add(S);for(let S of F)g.delete(S)}p instanceof AudioNode?w(i)?a.disconnect(p,o,i):w(o)?a.disconnect(p,o):w(p)?a.disconnect(p):a.disconnect():w(o)?a.disconnect(p,o):w(p)?a.disconnect(p):a.disconnect()}getAudioGraph(e){let r=new Map;for(let[o,i]of this.nodes){let s=o instanceof AudioNode?"node":o instanceof AudioParam?"param":"unknown";(e||s!=="param")&&r.set(o,new Zs({name:i.name,type:i.type,nodeClass:s}))}for(let[o,i]of this.nodes){let s=r.get(o);for(let a of i.connections){let l=a.destination;if(r.has(l)){let p=r.get(l);s.connectTo(p),p.connectTo(s)}}}return Array.from(r.values())}get destination(){return this._destination}createAnalyser(){return new lo(this)}createBiquadFilter(){return new Zt(this)}createBufferSource(){return new $s(this)}createChannelMerger(e){return new ta(this,{numberOfInputs:e})}createChannelSplitter(e){return new na(this,{numberOfOutputs:e})}createConstantSource(){return new ra(this)}createConvolver(){return new oa(this)}createDelay(e){return new ia(this,{maxDelayTime:e})}createDynamicsCompressor(){return new uo(this)}createGain(){return new _t(this)}createIIRFilter(e,r){return new sa(this,{feedforward:e,feedback:r})}createMediaElementSource(e){return new It(this,{mediaElement:e})}createMediaStreamDestination(){return new Rn(this)}createMediaStreamSource(e){return new In(this,{mediaStream:e})}createOscillator(){return new aa(this)}createPanner(){return new co(this)}createStereoPanner(){return new la(this)}createWaveShaper(){return new ua(this)}createScriptProcessor(){throw new Error("Script processor nodes are deprecated")}};var Ye=1e-6,_e=typeof Float32Array<"u"?Float32Array:Array,$t=Math.random;var A2=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});function wm(){var n=new _e(9);return _e!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}var mo={};Bu(mo,{add:()=>O1,calculateW:()=>y1,clone:()=>P1,conjugate:()=>D1,copy:()=>I1,create:()=>tc,dot:()=>Xm,equals:()=>z1,exactEquals:()=>U1,exp:()=>Nm,fromEuler:()=>L1,fromMat3:()=>Um,fromValues:()=>R1,getAngle:()=>b1,getAxisAngle:()=>S1,identity:()=>v1,invert:()=>C1,len:()=>N1,length:()=>jm,lerp:()=>H1,ln:()=>Gm,mul:()=>W1,multiply:()=>Hm,normalize:()=>nc,pow:()=>M1,random:()=>k1,rotateX:()=>_1,rotateY:()=>T1,rotateZ:()=>E1,rotationTo:()=>X1,scale:()=>zm,set:()=>V1,setAxes:()=>q1,setAxisAngle:()=>Wm,slerp:()=>fa,sqlerp:()=>j1,sqrLen:()=>G1,squaredLength:()=>qm,str:()=>B1});var ze={};Bu(ze,{add:()=>Nw,angle:()=>a1,bezier:()=>$w,ceil:()=>Gw,clone:()=>Ow,copy:()=>Ww,create:()=>da,cross:()=>Ei,dist:()=>f1,distance:()=>bm,div:()=>h1,divide:()=>Sm,dot:()=>ha,equals:()=>p1,exactEquals:()=>c1,floor:()=>Uw,forEach:()=>w1,fromValues:()=>ma,hermite:()=>Zw,inverse:()=>Jw,len:()=>ec,length:()=>Fm,lerp:()=>Yw,max:()=>Xw,min:()=>zw,mul:()=>m1,multiply:()=>vm,negate:()=>Kw,normalize:()=>$u,random:()=>e1,rotateX:()=>o1,rotateY:()=>i1,rotateZ:()=>s1,round:()=>jw,scale:()=>qw,scaleAndAdd:()=>Qw,set:()=>Hw,sqrDist:()=>g1,sqrLen:()=>x1,squaredDistance:()=>_m,squaredLength:()=>Tm,str:()=>u1,sub:()=>d1,subtract:()=>Am,transformMat3:()=>n1,transformMat4:()=>t1,transformQuat:()=>r1,zero:()=>l1});function da(){var n=new _e(3);return _e!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Ow(n){var t=new _e(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function Fm(n){var t=n[0],e=n[1],r=n[2];return Math.hypot(t,e,r)}function ma(n,t,e){var r=new _e(3);return r[0]=n,r[1]=t,r[2]=e,r}function Ww(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function Hw(n,t,e,r){return n[0]=t,n[1]=e,n[2]=r,n}function Nw(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function Am(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function vm(n,t,e){return n[0]=t[0]*e[0],n[1]=t[1]*e[1],n[2]=t[2]*e[2],n}function Sm(n,t,e){return n[0]=t[0]/e[0],n[1]=t[1]/e[1],n[2]=t[2]/e[2],n}function Gw(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n}function Uw(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n}function zw(n,t,e){return n[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n[2]=Math.min(t[2],e[2]),n}function Xw(n,t,e){return n[0]=Math.max(t[0],e[0]),n[1]=Math.max(t[1],e[1]),n[2]=Math.max(t[2],e[2]),n}function jw(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n}function qw(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function Qw(n,t,e,r){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function bm(n,t){var e=t[0]-n[0],r=t[1]-n[1],o=t[2]-n[2];return Math.hypot(e,r,o)}function _m(n,t){var e=t[0]-n[0],r=t[1]-n[1],o=t[2]-n[2];return e*e+r*r+o*o}function Tm(n){var t=n[0],e=n[1],r=n[2];return t*t+e*e+r*r}function Kw(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n}function Jw(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n}function $u(n,t){var e=t[0],r=t[1],o=t[2],i=e*e+r*r+o*o;return i>0&&(i=1/Math.sqrt(i)),n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n}function ha(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Ei(n,t,e){var r=t[0],o=t[1],i=t[2],s=e[0],a=e[1],l=e[2];return n[0]=o*l-i*a,n[1]=i*s-r*l,n[2]=r*a-o*s,n}function Yw(n,t,e,r){var o=t[0],i=t[1],s=t[2];return n[0]=o+r*(e[0]-o),n[1]=i+r*(e[1]-i),n[2]=s+r*(e[2]-s),n}function Zw(n,t,e,r,o,i){var s=i*i,a=s*(2*i-3)+1,l=s*(i-2)+i,p=s*(i-1),m=s*(3-2*i);return n[0]=t[0]*a+e[0]*l+r[0]*p+o[0]*m,n[1]=t[1]*a+e[1]*l+r[1]*p+o[1]*m,n[2]=t[2]*a+e[2]*l+r[2]*p+o[2]*m,n}function $w(n,t,e,r,o,i){var s=1-i,a=s*s,l=i*i,p=a*s,m=3*i*a,g=3*l*s,F=l*i;return n[0]=t[0]*p+e[0]*m+r[0]*g+o[0]*F,n[1]=t[1]*p+e[1]*m+r[1]*g+o[1]*F,n[2]=t[2]*p+e[2]*m+r[2]*g+o[2]*F,n}function e1(n,t){t=t||1;var e=$t()*2*Math.PI,r=$t()*2-1,o=Math.sqrt(1-r*r)*t;return n[0]=Math.cos(e)*o,n[1]=Math.sin(e)*o,n[2]=r*t,n}function t1(n,t,e){var r=t[0],o=t[1],i=t[2],s=e[3]*r+e[7]*o+e[11]*i+e[15];return s=s||1,n[0]=(e[0]*r+e[4]*o+e[8]*i+e[12])/s,n[1]=(e[1]*r+e[5]*o+e[9]*i+e[13])/s,n[2]=(e[2]*r+e[6]*o+e[10]*i+e[14])/s,n}function n1(n,t,e){var r=t[0],o=t[1],i=t[2];return n[0]=r*e[0]+o*e[3]+i*e[6],n[1]=r*e[1]+o*e[4]+i*e[7],n[2]=r*e[2]+o*e[5]+i*e[8],n}function r1(n,t,e){var r=e[0],o=e[1],i=e[2],s=e[3],a=t[0],l=t[1],p=t[2],m=o*p-i*l,g=i*a-r*p,F=r*l-o*a,S=o*F-i*g,M=i*m-r*F,k=r*g-o*m,E=s*2;return m*=E,g*=E,F*=E,S*=2,M*=2,k*=2,n[0]=a+m+S,n[1]=l+g+M,n[2]=p+F+k,n}function o1(n,t,e,r){var o=[],i=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],i[0]=o[0],i[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),i[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function i1(n,t,e,r){var o=[],i=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],i[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),i[1]=o[1],i[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function s1(n,t,e,r){var o=[],i=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],i[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),i[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),i[2]=o[2],n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function a1(n,t){var e=n[0],r=n[1],o=n[2],i=t[0],s=t[1],a=t[2],l=Math.sqrt(e*e+r*r+o*o),p=Math.sqrt(i*i+s*s+a*a),m=l*p,g=m&&ha(n,t)/m;return Math.acos(Math.min(Math.max(g,-1),1))}function l1(n){return n[0]=0,n[1]=0,n[2]=0,n}function u1(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function c1(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]}function p1(n,t){var e=n[0],r=n[1],o=n[2],i=t[0],s=t[1],a=t[2];return Math.abs(e-i)<=Ye*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(r-s)<=Ye*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-a)<=Ye*Math.max(1,Math.abs(o),Math.abs(a))}var d1=Am,m1=vm,h1=Sm,f1=bm,g1=_m,ec=Fm,x1=Tm,w1=function(){var n=da();return function(t,e,r,o,i,s){var a,l;for(e||(e=3),r||(r=0),o?l=Math.min(o*e+r,t.length):l=t.length,a=r;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],i(n,n,s),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2];return t}}();function F1(){var n=new _e(4);return _e!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Em(n){var t=new _e(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function ym(n,t,e,r){var o=new _e(4);return o[0]=n,o[1]=t,o[2]=e,o[3]=r,o}function Mm(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function km(n,t,e,r,o){return n[0]=t,n[1]=e,n[2]=r,n[3]=o,n}function Cm(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n[3]=t[3]+e[3],n}function Dm(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n}function Lm(n){var t=n[0],e=n[1],r=n[2],o=n[3];return Math.hypot(t,e,r,o)}function Bm(n){var t=n[0],e=n[1],r=n[2],o=n[3];return t*t+e*e+r*r+o*o}function Pm(n,t){var e=t[0],r=t[1],o=t[2],i=t[3],s=e*e+r*r+o*o+i*i;return s>0&&(s=1/Math.sqrt(s)),n[0]=e*s,n[1]=r*s,n[2]=o*s,n[3]=i*s,n}function Rm(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function Im(n,t,e,r){var o=t[0],i=t[1],s=t[2],a=t[3];return n[0]=o+r*(e[0]-o),n[1]=i+r*(e[1]-i),n[2]=s+r*(e[2]-s),n[3]=a+r*(e[3]-a),n}function Vm(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]}function Om(n,t){var e=n[0],r=n[1],o=n[2],i=n[3],s=t[0],a=t[1],l=t[2],p=t[3];return Math.abs(e-s)<=Ye*Math.max(1,Math.abs(e),Math.abs(s))&&Math.abs(r-a)<=Ye*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(o-l)<=Ye*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(i-p)<=Ye*Math.max(1,Math.abs(i),Math.abs(p))}var v2=function(){var n=F1();return function(t,e,r,o,i,s){var a,l;for(e||(e=4),r||(r=0),o?l=Math.min(o*e+r,t.length):l=t.length,a=r;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],n[3]=t[a+3],i(n,n,s),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2],t[a+3]=n[3];return t}}();function tc(){var n=new _e(4);return _e!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function v1(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Wm(n,t,e){e=e*.5;var r=Math.sin(e);return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=Math.cos(e),n}function S1(n,t){var e=Math.acos(t[3])*2,r=Math.sin(e/2);return r>Ye?(n[0]=t[0]/r,n[1]=t[1]/r,n[2]=t[2]/r):(n[0]=1,n[1]=0,n[2]=0),e}function b1(n,t){var e=Xm(n,t);return Math.acos(2*e*e-1)}function Hm(n,t,e){var r=t[0],o=t[1],i=t[2],s=t[3],a=e[0],l=e[1],p=e[2],m=e[3];return n[0]=r*m+s*a+o*p-i*l,n[1]=o*m+s*l+i*a-r*p,n[2]=i*m+s*p+r*l-o*a,n[3]=s*m-r*a-o*l-i*p,n}function _1(n,t,e){e*=.5;var r=t[0],o=t[1],i=t[2],s=t[3],a=Math.sin(e),l=Math.cos(e);return n[0]=r*l+s*a,n[1]=o*l+i*a,n[2]=i*l-o*a,n[3]=s*l-r*a,n}function T1(n,t,e){e*=.5;var r=t[0],o=t[1],i=t[2],s=t[3],a=Math.sin(e),l=Math.cos(e);return n[0]=r*l-i*a,n[1]=o*l+s*a,n[2]=i*l+r*a,n[3]=s*l-o*a,n}function E1(n,t,e){e*=.5;var r=t[0],o=t[1],i=t[2],s=t[3],a=Math.sin(e),l=Math.cos(e);return n[0]=r*l+o*a,n[1]=o*l-r*a,n[2]=i*l+s*a,n[3]=s*l-i*a,n}function y1(n,t){var e=t[0],r=t[1],o=t[2];return n[0]=e,n[1]=r,n[2]=o,n[3]=Math.sqrt(Math.abs(1-e*e-r*r-o*o)),n}function Nm(n,t){var e=t[0],r=t[1],o=t[2],i=t[3],s=Math.sqrt(e*e+r*r+o*o),a=Math.exp(i),l=s>0?a*Math.sin(s)/s:0;return n[0]=e*l,n[1]=r*l,n[2]=o*l,n[3]=a*Math.cos(s),n}function Gm(n,t){var e=t[0],r=t[1],o=t[2],i=t[3],s=Math.sqrt(e*e+r*r+o*o),a=s>0?Math.atan2(s,i)/s:0;return n[0]=e*a,n[1]=r*a,n[2]=o*a,n[3]=.5*Math.log(e*e+r*r+o*o+i*i),n}function M1(n,t,e){return Gm(n,t),zm(n,n,e),Nm(n,n),n}function fa(n,t,e,r){var o=t[0],i=t[1],s=t[2],a=t[3],l=e[0],p=e[1],m=e[2],g=e[3],F,S,M,k,E;return S=o*l+i*p+s*m+a*g,S<0&&(S=-S,l=-l,p=-p,m=-m,g=-g),1-S>Ye?(F=Math.acos(S),M=Math.sin(F),k=Math.sin((1-r)*F)/M,E=Math.sin(r*F)/M):(k=1-r,E=r),n[0]=k*o+E*l,n[1]=k*i+E*p,n[2]=k*s+E*m,n[3]=k*a+E*g,n}function k1(n){var t=$t(),e=$t(),r=$t(),o=Math.sqrt(1-t),i=Math.sqrt(t);return n[0]=o*Math.sin(2*Math.PI*e),n[1]=o*Math.cos(2*Math.PI*e),n[2]=i*Math.sin(2*Math.PI*r),n[3]=i*Math.cos(2*Math.PI*r),n}function C1(n,t){var e=t[0],r=t[1],o=t[2],i=t[3],s=e*e+r*r+o*o+i*i,a=s?1/s:0;return n[0]=-e*a,n[1]=-r*a,n[2]=-o*a,n[3]=i*a,n}function D1(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n}function Um(n,t){var e=t[0]+t[4]+t[8],r;if(e>0)r=Math.sqrt(e+1),n[3]=.5*r,r=.5/r,n[0]=(t[5]-t[7])*r,n[1]=(t[6]-t[2])*r,n[2]=(t[1]-t[3])*r;else{var o=0;t[4]>t[0]&&(o=1),t[8]>t[o*3+o]&&(o=2);var i=(o+1)%3,s=(o+2)%3;r=Math.sqrt(t[o*3+o]-t[i*3+i]-t[s*3+s]+1),n[o]=.5*r,r=.5/r,n[3]=(t[i*3+s]-t[s*3+i])*r,n[i]=(t[i*3+o]+t[o*3+i])*r,n[s]=(t[s*3+o]+t[o*3+s])*r}return n}function L1(n,t,e,r){var o=.5*Math.PI/180;t*=o,e*=o,r*=o;var i=Math.sin(t),s=Math.cos(t),a=Math.sin(e),l=Math.cos(e),p=Math.sin(r),m=Math.cos(r);return n[0]=i*l*m-s*a*p,n[1]=s*a*m+i*l*p,n[2]=s*l*p-i*a*m,n[3]=s*l*m+i*a*p,n}function B1(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"}var P1=Em,R1=ym,I1=Mm,V1=km,O1=Cm,W1=Hm,zm=Dm,Xm=Rm,H1=Im,jm=Lm,N1=jm,qm=Bm,G1=qm,nc=Pm,U1=Vm,z1=Om,X1=function(){var n=da(),t=ma(1,0,0),e=ma(0,1,0);return function(r,o,i){var s=ha(o,i);return s<-.999999?(Ei(n,t,o),ec(n)<1e-6&&Ei(n,e,o),$u(n,n),Wm(r,n,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Ei(n,o,i),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=1+s,nc(r,r))}}(),j1=function(){var n=tc(),t=tc();return function(e,r,o,i,s,a){return fa(n,r,s,a),fa(t,o,i,a),fa(e,n,t,2*a*(1-a)),e}}(),q1=function(){var n=wm();return function(t,e,r,o){return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=o[0],n[4]=o[1],n[7]=o[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],nc(t,Um(t,n))}}();var me={};Bu(me,{add:()=>Z1,angle:()=>wF,ceil:()=>$1,clone:()=>Q1,copy:()=>J1,create:()=>Qm,cross:()=>cF,dist:()=>yF,distance:()=>Zm,div:()=>EF,divide:()=>Ym,dot:()=>uF,equals:()=>SF,exactEquals:()=>vF,floor:()=>eF,forEach:()=>CF,fromValues:()=>K1,inverse:()=>aF,len:()=>bF,length:()=>eh,lerp:()=>pF,max:()=>nF,min:()=>tF,mul:()=>TF,multiply:()=>Jm,negate:()=>sF,normalize:()=>lF,random:()=>dF,rotate:()=>xF,round:()=>rF,scale:()=>oF,scaleAndAdd:()=>iF,set:()=>Y1,sqrDist:()=>MF,sqrLen:()=>kF,squaredDistance:()=>$m,squaredLength:()=>th,str:()=>AF,sub:()=>_F,subtract:()=>Km,transformMat2:()=>mF,transformMat2d:()=>hF,transformMat3:()=>fF,transformMat4:()=>gF,zero:()=>FF});function Qm(){var n=new _e(2);return _e!=Float32Array&&(n[0]=0,n[1]=0),n}function Q1(n){var t=new _e(2);return t[0]=n[0],t[1]=n[1],t}function K1(n,t){var e=new _e(2);return e[0]=n,e[1]=t,e}function J1(n,t){return n[0]=t[0],n[1]=t[1],n}function Y1(n,t,e){return n[0]=t,n[1]=e,n}function Z1(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n}function Km(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n}function Jm(n,t,e){return n[0]=t[0]*e[0],n[1]=t[1]*e[1],n}function Ym(n,t,e){return n[0]=t[0]/e[0],n[1]=t[1]/e[1],n}function $1(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n}function eF(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n}function tF(n,t,e){return n[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n}function nF(n,t,e){return n[0]=Math.max(t[0],e[0]),n[1]=Math.max(t[1],e[1]),n}function rF(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n}function oF(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n}function iF(n,t,e,r){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n}function Zm(n,t){var e=t[0]-n[0],r=t[1]-n[1];return Math.hypot(e,r)}function $m(n,t){var e=t[0]-n[0],r=t[1]-n[1];return e*e+r*r}function eh(n){var t=n[0],e=n[1];return Math.hypot(t,e)}function th(n){var t=n[0],e=n[1];return t*t+e*e}function sF(n,t){return n[0]=-t[0],n[1]=-t[1],n}function aF(n,t){return n[0]=1/t[0],n[1]=1/t[1],n}function lF(n,t){var e=t[0],r=t[1],o=e*e+r*r;return o>0&&(o=1/Math.sqrt(o)),n[0]=t[0]*o,n[1]=t[1]*o,n}function uF(n,t){return n[0]*t[0]+n[1]*t[1]}function cF(n,t,e){var r=t[0]*e[1]-t[1]*e[0];return n[0]=n[1]=0,n[2]=r,n}function pF(n,t,e,r){var o=t[0],i=t[1];return n[0]=o+r*(e[0]-o),n[1]=i+r*(e[1]-i),n}function dF(n,t){t=t||1;var e=$t()*2*Math.PI;return n[0]=Math.cos(e)*t,n[1]=Math.sin(e)*t,n}function mF(n,t,e){var r=t[0],o=t[1];return n[0]=e[0]*r+e[2]*o,n[1]=e[1]*r+e[3]*o,n}function hF(n,t,e){var r=t[0],o=t[1];return n[0]=e[0]*r+e[2]*o+e[4],n[1]=e[1]*r+e[3]*o+e[5],n}function fF(n,t,e){var r=t[0],o=t[1];return n[0]=e[0]*r+e[3]*o+e[6],n[1]=e[1]*r+e[4]*o+e[7],n}function gF(n,t,e){var r=t[0],o=t[1];return n[0]=e[0]*r+e[4]*o+e[12],n[1]=e[1]*r+e[5]*o+e[13],n}function xF(n,t,e,r){var o=t[0]-e[0],i=t[1]-e[1],s=Math.sin(r),a=Math.cos(r);return n[0]=o*a-i*s+e[0],n[1]=o*s+i*a+e[1],n}function wF(n,t){var e=n[0],r=n[1],o=t[0],i=t[1],s=Math.sqrt(e*e+r*r)*Math.sqrt(o*o+i*i),a=s&&(e*o+r*i)/s;return Math.acos(Math.min(Math.max(a,-1),1))}function FF(n){return n[0]=0,n[1]=0,n}function AF(n){return"vec2("+n[0]+", "+n[1]+")"}function vF(n,t){return n[0]===t[0]&&n[1]===t[1]}function SF(n,t){var e=n[0],r=n[1],o=t[0],i=t[1];return Math.abs(e-o)<=Ye*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(r-i)<=Ye*Math.max(1,Math.abs(r),Math.abs(i))}var bF=eh,_F=Km,TF=Jm,EF=Ym,yF=Zm,MF=$m,kF=th,CF=function(){var n=Qm();return function(t,e,r,o,i,s){var a,l;for(e||(e=2),r||(r=0),o?l=Math.min(o*e+r,t.length):l=t.length,a=r;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],i(n,n,s),t[a]=n[0],t[a+1]=n[1];return t}}();var ga=class{constructor(t,e){this.type=t;this.context=e}};var ho=ze.create(),fo=ze.create(),go=class extends ga{get listener(){return this.context.listener}readPose(t){let{p:e,q:r}=t;ze.set(ho,0,0,-1),ze.transformQuat(ho,ho,r),ze.set(fo,0,1,0),ze.transformQuat(fo,fo,r),this.setPosition(e[0],e[1],e[2]),this.setOrientation(ho[0],ho[1],ho[2],fo[0],fo[1],fo[2])}};var xa=class extends go{constructor(t){if(!_i)throw new Error("Latest WebAudio Listener API is not supported");super("web-audio-listener-new",t),Object.seal(this)}setPosition(t,e,r){let o=this.context.currentTime;this.listener.positionX.setValueAtTime(t,o),this.listener.positionY.setValueAtTime(e,o),this.listener.positionZ.setValueAtTime(r,o)}setOrientation(t,e,r,o,i,s){let a=this.context.currentTime;this.listener.forwardX.setValueAtTime(t,a),this.listener.forwardY.setValueAtTime(e,a),this.listener.forwardZ.setValueAtTime(r,a),this.listener.upX.setValueAtTime(o,a),this.listener.upY.setValueAtTime(i,a),this.listener.upZ.setValueAtTime(s,a)}};var wa=class extends go{constructor(t){if(!xm)throw new Error("WebAudio Listener API is not supported");super("web-audio-listener-old",t),Object.seal(this)}setPosition(t,e,r){this.listener.setPosition(t,e,r)}setOrientation(t,e,r,o,i,s){this.listener.setOrientation(t,e,r,o,i,s)}};var xo=class{constructor(){this.p=ze.create();this.q=mo.create();Object.seal(this)}set(t,e,r,o,i,s,a){this.setPosition(t,e,r),this.setOrientation(o,i,s,a)}setPosition(t,e,r){ze.set(this.p,t,e,r)}setOrientation(t,e,r,o){mo.set(this.q,t,e,r,o)}copy(t){ze.copy(this.p,t.p),mo.copy(this.q,t.q)}};var wo=class extends je{constructor(e,r,o,i,s,a){super(e,r,i,s,a);this.spatialized=o;this._minDistance=1;this._maxDistance=10;this._algorithm="inverse"}get minDistance(){return this._minDistance}get maxDistance(){return this._maxDistance}get algorithm(){return this._algorithm}setAudioProperties(e,r,o){this._minDistance=e,this._maxDistance=r,this._algorithm=o}};var yi=ze.create(),Fo=class extends wo{constructor(e,r){let o=new co(r,{panningModel:"HRTF",distanceModel:"inverse",coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:0});super(e,r,!0,[o]);this.lpx=0;this.lpy=0;this.lpz=0;this.lqx=0;this.lqy=0;this.lqz=0;this.lqw=0;this.panner=o}setAudioProperties(e,r,o){super.setAudioProperties(e,r,o),this.panner.refDistance=this.minDistance,this.panner.distanceModel=o,o==="linear"?this.panner.rolloffFactor=1:this.maxDistance<=0?this.panner.rolloffFactor=1/0:o==="inverse"?this.panner.rolloffFactor=1/this.maxDistance:this.panner.rolloffFactor=Math.pow(this.maxDistance,-.2)}readPose(e){let{p:r,q:o}=e,[i,s,a]=r,[l,p,m,g]=o;(i!==this.lpx||s!==this.lpy||a!==this.lpz)&&(this.lpx=i,this.lpy=s,this.lpz=a,this.setPosition(i,s,a,this.context.currentTime)),(l!==this.lqx||p!==this.lqy||m!==this.lqz||g!==this.lqw)&&(this.lqx=l,this.lqy=p,this.lqz=m,this.lqw=g,ze.transformQuat(yi,ze.set(yi,0,0,-1),o),this.setOrientation(yi[0],yi[1],yi[2],this.context.currentTime))}getGainAtDistance(e){let{rolloffFactor:r,refDistance:o,maxDistance:i,distanceModel:s}=this.panner;if(e<=o)return 1;{let a=e-o,l=i-o;if(s==="linear")return 1-r*a/l;if(s==="inverse")return o/(o+r*a);if(s==="exponential")return Math.pow(e/o,-r);dn(s)}}};var Fa=class extends Fo{constructor(t){super("web-audio-panner-new",t),Object.seal(this)}setPosition(t,e,r,o){lt(t)&&lt(e)&&lt(r)&&(Cs(o)&&(o=0),this.panner.positionX.setValueAtTime(t,o),this.panner.positionY.setValueAtTime(e,o),this.panner.positionZ.setValueAtTime(r,o))}setOrientation(t,e,r,o){lt(t)&&lt(e)&&lt(r)&&(Cs(o)&&(o=0),this.panner.orientationX.setValueAtTime(-t,o),this.panner.orientationY.setValueAtTime(-e,o),this.panner.orientationZ.setValueAtTime(-r,o))}};var Aa=class extends Fo{constructor(t){super("web-audio-panner-old",t),Object.seal(this)}setPosition(t,e,r){this.panner.setPosition(t,e,r)}setOrientation(t,e,r){this.panner.setOrientation(t,e,r)}};var va=class extends je{constructor(e){let r=_i?new xa(e):new wa(e),o=new _t(e);o.name="remote-user-input";let i=new _t(e);i.name="spatialized-input";let s=new _t(e);s.name="non-spatialized-input";let a=new Rn(e),l=new Se,p=Kt(Vs("Audio-Device-Manager"),rt("none"),mn(!0),Pt(!0),di(a.stream),um(()=>l.resolve()));Yt(()=>p.play());super("web-audio-destination",e,[s,i,o],[],[a]);this.pose=new xo;this._ready=l,this.listener=r,this.remoteUserInput=o,this.spatializedInput=i,this.nonSpatializedInput=s,this.volumeControl=s,this.destination=a,this.element=p,o.connect(i).connect(this.volumeControl).connect(a)}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}createSpatializer(e){let r=e?this.remoteUserInput:this.spatializedInput,o=_i?new Fa(this.context):new Aa(this.context);return o.connect(r),o}setPosition(e,r,o){this.pose.setPosition(e,r,o),this.listener.readPose(this.pose)}setOrientation(e,r,o,i){this.pose.setOrientation(e,r,o,i),this.listener.readPose(this.pose)}set(e,r,o,i,s,a,l){this.pose.set(e,r,o,i,s,a,l),this.listener.readPose(this.pose)}get stream(){return this.destination.stream}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}};var rc=class extends je{constructor(t){let e=new Zt(t,{type:"bandpass",frequency:2500,Q:4.5}),r=new _t(t,{gain:10});e.connect(r),super("radio-effect",t,[e],[r])}};function nh(n,t){let e=new rc(t);return e.name=`${n}-radio-effect`,e}function rh(n,t){let e=new Zt(t,{type:"bandpass",frequency:400,Q:4.5});return e.name=`${n}-wall-effect`,e}var oh=new Map([["Radio",nh],["Wall",rh]]);var en=class extends je{constructor(e,r,o,i,s){let a=new _t(r);a.name="volume-control",s=s||[];super(e,r,[],[o],s);this.spatializer=o;this.effects=new Array;this.pose=new xo;this.volumeControl=a,this.setEffects(...i)}onDisposing(){ue(this.effects),super.onDisposing()}setEffects(...e){this.disable();for(let o of this.effects)this.remove(o),Le(o);ue(this.effects);let r=this.volumeControl;for(let o of e)if(w(o)){let i=oh.get(o);if(w(i)){let s=i(o,this.context);this.add(s),this.effects.push(s),r=r.connect(s)}}this.enable()}get spatialized(){return this.spatializer.spatialized}get lastInternal(){return this.effects[this.effects.length-1]||this.volumeControl}enable(){this.lastInternal.isConnected()||this.lastInternal.connect(this.spatializer)}disable(){this.lastInternal.isConnected()&&this.lastInternal.disconnect()}tog(){this.lastInternal.isConnected()?this.disable():this.enable()}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}get minDistance(){return w(this.spatializer)?this.spatializer.minDistance:null}get maxDistance(){return w(this.spatializer)?this.spatializer.maxDistance:null}get algorithm(){return w(this.spatializer)?this.spatializer.algorithm:null}setPosition(e,r,o){w(this.spatializer)&&(this.pose.setPosition(e,r,o),this.spatializer.readPose(this.pose))}setOrientation(e,r,o,i){w(this.spatializer)&&(this.pose.setOrientation(e,r,o,i),this.spatializer.readPose(this.pose))}set(e,r,o,i,s,a,l){w(this.spatializer)&&(this.pose.set(e,r,o,i,s,a,l),this.spatializer.readPose(this.pose))}setAudioProperties(e,r,o){w(this.spatializer)&&this.spatializer.setAudioProperties(e,r,o)}};var tn=class extends N{constructor(e,r){super(e);this.source=r}},Vn=class extends tn{constructor(t){super("loaded",t)}},Sa=class extends tn{constructor(e,r){super("errored",e);this.error=r}},On=class extends tn{constructor(t){super("played",t)}},Wn=class extends tn{constructor(t){super("paused",t)}},Hn=class extends tn{constructor(t){super("stopped",t)}},Nn=class extends tn{constructor(e){super("progress",e);this.value=0;this.total=0}};var DF=new N("disposing"),ba=class extends en{constructor(e,r,o,i,s,...a){super("audio-element-source",e,s,a);r.connect(this.volumeControl),this.audio=r.mediaElement,this.disable(),this.loadEvt=new Vn(this),this.playEvt=new On(this),this.pauseEvt=new Wn(this),this.stopEvt=new Hn(this),this.progEvt=new Nn(this);let l=p=>{this.audio.currentTime===0||p.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};this.audio.addEventListener("ended",l),this.audio.addEventListener("pause",l),o&&this.audio.addEventListener("play",()=>{if(this.audio.loop&&this.audio.duration>1){let p=this.audio.duration*Math.random();this.audio.currentTime=p}}),i&&(r.mediaElement.preservesPitch=!1,this.audio.addEventListener("play",()=>{r.mediaElement.playbackRate=1+.1*(2*Math.random()-1)})),this.audio.addEventListener("play",()=>{this.dispatchEvent(this.playEvt)}),this.audio.addEventListener("timeupdate",()=>{this.progEvt.value=this.audio.currentTime,this.progEvt.total=this.audio.duration,this.dispatchEvent(this.progEvt)}),this.audio.autoplay&&this.play().catch(()=>Yt(()=>this.play())),$d(this.audio).then(p=>this.dispatchEvent(p?this.loadEvt:new Sa(this,this.audio.error)))}onDisposing(){this.dispatchEvent(DF),super.onDisposing()}get playbackState(){return this.audio.error?"errored":this.audio.ended||this.audio.paused&&this.audio.currentTime===0?"stopped":this.audio.paused?"paused":"playing"}async play(){this.enable(),await this.context.ready,await this.audio.play()}async playThrough(){let e=hn(this,"stopped");await this.play(),await e}pause(){this.disable(),this.audio.pause()}stop(){this.audio.currentTime=0,this.pause()}restart(){return this.stop(),this.play()}};var oc=class extends N{constructor(e){super("sourceadded");this.source=e}},_a=class extends en{constructor(e,r,...o){super("audio-stream-source",e,r,o);this._stream=null;this._node=null}get stream(){return this._stream}set stream(e){e!==this.stream&&(w(this.stream)&&(this.remove(this._node),Le(this._node),this._node=null),w(e)&&(this._node=new In(this.context,{mediaStream:e}),this._node.name=so("media-stream-source",e.id),this._node.connect(this.volumeControl),this.add(this._node),this.dispatchEvent(new oc(this))))}};var Ta=class extends wo{constructor(t){super("no-spatializer",t.context,!1,[t],[t])}readPose(t){}getGainAtDistance(t){return 1}};function Ea(n){let t=[];for(let e=0;e<n.length;++e){let r=n[e],o=!1;for(let i=0;i<t.length&&!o;++i){let s=t[i];o=r.kind===s.kind&&s.label.indexOf(r.label)>0}o||t.push(r)}return t}var nn=Z(HTMLAudioElement.prototype.setSinkId),ic=class extends N{constructor(e){super("audiooutputchanged");this.device=e}},ih="calla:preferredAudioOutputID",ya=class extends te{constructor(e){super();this.element=e;this._hasAudioPermission=!1;this._ready=new Se;this.start(),Object.seal(this)}get hasAudioPermission(){return this._hasAudioPermission}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}async start(){if(nn){let e=await navigator.mediaDevices.enumerateDevices(),r=nt(e,o=>o.kind==="audiooutput"&&o.label.length>0);if(w(r)){this._hasAudioPermission=!0;let o=await this.getPreferredAudioOutput();o&&await this.setAudioOutputDevice(o)}}this._ready.resolve()}get preferredAudioOutputID(){return nn?localStorage.getItem(ih):null}async getAudioOutputDevices(e=!1){return nn?await this.getAvailableDevices(e)||[]:[]}async getAudioOutputDevice(){if(!nn)return null;let e=this.element&&this.element.sinkId;if(L(e))return null;let r=await this.getAudioOutputDevices();return nt(r,i=>i.deviceId===e)}async getPreferredAudioOutput(){if(!nn)return null;let e=await this.getAudioOutputDevices();return nt(e,o=>o.deviceId===this.preferredAudioOutputID,o=>o.deviceId==="default",o=>o.deviceId.length>0)}async setAudioOutputDevice(e){if(nn){if(w(e)&&e.kind!=="audiooutput")throw new Error(`Device is not an audio output device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(ih,e&&e.deviceId||null);let r=this.element,o=r&&r.sinkId;this.preferredAudioOutputID!==o&&(w(this.preferredAudioOutputID)&&await this.element.setSinkId(this.preferredAudioOutputID),this.dispatchEvent(new ic(e)))}}async getAvailableDevices(e=!1){let r=null,o=null;for(let i=0;i<3;++i){r=await navigator.mediaDevices.enumerateDevices();for(let s of r)s.deviceId.length>0&&(this.hasAudioPermission||(this._hasAudioPermission=s.kind==="audioinput"&&s.label.length>0));if(this.hasAudioPermission)break;try{o=await this.startStream()}catch(s){console.warn(s)}}if(o)for(let i of o.getTracks())i.stop();return r=Ps(r||[],i=>i.label),e&&(r=Ea(r)),nn?r.filter(i=>i.kind==="audiooutput"):[]}startStream(){return navigator.mediaDevices.getUserMedia({audio:!0})}};var sh="juniper::useHeadphones",LF=new N("useheadphonestoggled"),ah=10,Ao=new N("released"),lh="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",Ma=class extends je{constructor(e,r){let o=new pa;"THREE"in globalThis&&globalThis.THREE.AudioContext.setContext(o);let i=new va(o),s=new Ta(i.nonSpatializedInput),a=new ya(i.element);super("audio-manager",o,null,null,[s,i]);this.fetcher=e;this.users=new Map;this.clips=new Map;this.pendingAudio=new Array;this.audioPool=new Array;this.elements=new Map;this.elementCounts=new Map;this._minDistance=.25;this._maxDistance=100;this._algorithm="inverse";this._useHeadphones=!1;this.destination=null;this._ready=new Se;this.localUserID=null;this.destination=i,this.noSpatializer=s,this.speakers=a,br(this.context.ready,this.destination.ready,this.speakers.ready).then(()=>this._ready.resolve()),this.setLocalUserID(r);let l=localStorage.getItem(sh);w(l)?this._useHeadphones=l==="true":this._useHeadphones=xn(),this.enpool(),oo()&&Yt(()=>{let p=[...this.pendingAudio];ue(this.pendingAudio);for(let m of p)m()},!0),Object.seal(this)}get algorithm(){return this._algorithm}get element(){return this.destination.element}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}enpool(){for(let e=0;e<ah;++e){let r=new Se,o=Kt(Yr(lh),Pt(!1),Ai("released",()=>{o.pause(),o.src=lh}));this.audioPool.push(r),oo()?this.pendingAudio.push(()=>{o.play(),r.resolve(o)}):r.resolve(o)}}preparePool(e){for(;this.audioPool.length<e;)this.enpool()}async getPooledAudio(...e){if(this.audioPool.length===0)throw new We("Audio pool exhausted!");let r=this.audioPool.shift();this.audioPool.length<=ah/2&&this.enpool();let o=await r;return o.pause(),$(o,...e),o}async getPooledSource(e,r,o){if(!this.elements.has(e)){let s=await this.getPooledAudio(Yr(r),Pn(o&&!oo()));oo()&&o&&s.addEventListener("ended",()=>s.play());let a=new It(this.context,{mediaElement:s});a.name=so("media-element-source",e),this.elements.set(e,a),this.elementCounts.set(e,0)}let i=this.elements.get(e);return this.elementCounts.set(e,this.elementCounts.get(e)+1),i}releasePooledSource(e){let r=this.elements.get(e);this.elementCounts.set(e,this.elementCounts.get(e)-1),this.elementCounts.get(e)===0&&(r.mediaElement.dispatchEvent(Ao),this.elementCounts.delete(e),this.elements.delete(e))}get useHeadphones(){return this._useHeadphones}set useHeadphones(e){e!==this.useHeadphones&&(this._useHeadphones=e,localStorage.setItem(sh,this.useHeadphones.toString()),this.dispatchEvent(LF))}onDisposing(){this.context.suspend();for(let e of this.users.keys())this.removeUser(e);for(let e of this.clips.keys())this.removeClip(e);super.onDisposing()}get currentTime(){return this.context.currentTime}createSpatializer(e,r){if(e){let o=this.destination.createSpatializer(r);return o.setAudioProperties(this._minDistance,this._maxDistance,this._algorithm),o}else return this.noSpatializer}createUser(e,r){if(!this.users.has(e)){let o=new _a(this.context,this.createSpatializer(!0,!0));o.name=so(r,e),this.users.set(e,o)}return this.users.get(e)}setLocalUserID(e){return this.destination&&(this.localUserID=e),this.destination}createBasicClip(e,r,o){return this.createClip(e,r,!1,!1,!1,!0,o,[])}hasClip(e){return this.clips.has(e)}async createClip(e,r,o,i,s,a,l,p,m){await this.ready;let g,F;de(r)?(g=r,F=await this.fetcher.get(r).progress(m).file().then(ro)):(g=r.path,F=r.result);let S=await this.getPooledSource(g,F,o),M=new ba(this.context,S,s,a,this.createSpatializer(i,!1),...p);return M.addEventListener("disposing",()=>this.releasePooledSource(g)),M.name=so("audio-clip-element",e),M.volume=l,this.clips.set(e,M),M}async playClip(e){this.hasClip(e)&&await this.clips.get(e).play()}async playClipThrough(e){this.hasClip(e)&&await this.clips.get(e).playThrough()}stopClip(e){this.hasClip(e)&&this.clips.get(e).stop()}getUser(e){return this.users.get(e)}getClip(e){return this.clips.get(e)}removeSource(e,r){let o=e.get(r);return w(o)&&(e.delete(r),Le(o)),o}removeUser(e){let r=this.removeSource(this.users,e);w(r.stream)&&(r.stream=null)}removeClip(e){let r=this.removeSource(this.clips,e);return Le(r),r}setUserStream(e,r){if(this.users.has(e)){let o=this.users.get(e);o.stream=r}}setAudioProperties(e,r,o){this._minDistance=e,this._maxDistance=r,this._algorithm=o;for(let i of this.users.values())i.setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let i of this.clips.values())i.setAudioProperties(i.minDistance,i.maxDistance,this.algorithm)}withPoser(e,r,o){let s=e.get(r)||this.destination;return o(s)}withUser(e,r){return this.withPoser(this.users,e,r)}withClip(e,r){return this.withPoser(this.clips,e,r)}setUserPose(e,r,o,i,s,a,l,p){this.withUser(e,m=>{m.set(r,o,i,s,a,l,p)})}setUserPosition(e,r,o,i){this.withUser(e,s=>{s.setPosition(r,o,i)})}setUserOrientation(e,r,o,i,s){this.withUser(e,a=>{a.setOrientation(r,o,i,s)})}setClipPose(e,r,o,i,s,a,l,p){this.withClip(e,m=>{m.set(r,o,i,s,a,l,p)})}setClipPosition(e,r,o,i){this.withClip(e,s=>{s.setPosition(r,o,i)})}setClipOrientation(e,r,o,i,s){this.withClip(e,a=>{a.setOrientation(r,o,i,s)})}};var vo=class extends N{constructor(){super("devicesettingschanged")}},ka=class{constructor(...t){this.permissed=new Set;this.managers=t}get hasPermissions(){for(let t of this.managers)if(!this.permissed.has(t))return!1;return!0}async init(){if(!this.hasPermissions){let t=await this.getDevices();await Promise.all(this.managers.map(e=>e.setDevice(nt(t,r=>r.kind===e.deviceKind&&r.deviceId===e.preferredDeviceID,r=>r.kind===e.deviceKind&&r.deviceId==="default",r=>r.kind===e.deviceKind&&r.deviceId.length>0))))}}async getDevices(t=!1){let e=null,r=null;for(let o=0;o<3;++o)if(e=await navigator.mediaDevices.enumerateDevices(),!this.hasPermissions){let i={};for(let s of this.managers)if(!this.permissed.has(s)){for(let a of e)if(a.kind===s.deviceKind&&a.deviceId.length>0&&a.label.length>0){this.permissed.add(s);break}this.permissed.has(s)||(i[s.mediaType]=!0)}if(!this.hasPermissions)try{r=await navigator.mediaDevices.getUserMedia(i)}catch(s){console.warn(s)}}if(r)for(let o of r.getTracks())o.stop();return e=Ps(e||[],o=>o.label),t&&(e=Ea(e)),e}get outStreams(){return this.managers.map(t=>t.outStream)}};var So=class extends N{constructor(e,r){super("streamchanged");this.oldStream=e;this.newStream=r}};var uh="calla:preferredAudioInputID",Ca=class extends je{constructor(e){let r=e.createGain();r.name="local-mic-user-gain";let o=e.createGain();o.name="local-mic-auto-gain";let i=new Zt(e,{type:"bandpass",frequency:1500,Q:.25});i.name="local-mic-filter";let s=new uo(e,{threshold:-15,knee:40,ratio:17});s.name="local-mic-compressor";let a=new Rn(e);a.name="local-mic-destination";super("local-user-microphone",e,[],[s],[r,i,a]);this.localStreamNode=null;this._hasPermission=!1;this._usingHeadphones=!1;this._device=null;this._enabled=!1;this.volume=r,this.autoGainNode=o,this.compressor=s,this.output=a,r.connect(o).connect(i).connect(s).connect(a),Object.seal(this)}get mediaType(){return"audio"}get deviceKind(){return`${this.mediaType}input`}get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.onChange())}get hasPermission(){return this._hasPermission}get preferredDeviceID(){return localStorage.getItem(uh)}get device(){return this._device}async setDevice(e){if(w(e)&&e.kind!==this.deviceKind)throw new Error(`Device is not an audio input device. Was: ${e.kind}. Label: ${e.label}`);let r=this.device&&this.device.deviceId||null,o=e&&e.deviceId||null;o!==r&&(this._device=e,localStorage.setItem(uh,o),this.onChange())}get inStream(){return this.localStreamNode&&this.localStreamNode.mediaStream||null}set inStream(e){e!==this.inStream&&(this.localStreamNode&&(this.remove(this.localStreamNode),Le(this.localStreamNode),this.localStreamNode=null),e&&(this.localStreamNode=new In(this.context,{mediaStream:e}),this.add(this.localStreamNode),this.localStreamNode.connect(this.volume)))}get outStream(){return this.output.stream}get gain(){return this.volume.gain}get muted(){return this.compressor.isConnected(this.output)}set muted(e){e!==this.muted&&(e?this.compressor.connect(this.output):this.compressor.disconnect(this.output))}get usingHeadphones(){return this._usingHeadphones}set usingHeadphones(e){e!==this.usingHeadphones&&(this._usingHeadphones=e,this.onChange())}async onChange(){this.dispatchEvent(new vo);let e=this.inStream;this.device&&this.enabled?this.inStream=await navigator.mediaDevices.getUserMedia({audio:{deviceId:this.device.deviceId,echoCancellation:!this.usingHeadphones,autoGainControl:!0,noiseSuppression:!0}}):this.inStream=null,this.inStream!==e&&this.dispatchEvent(new So(e,this.outStream))}};function sc(n){return w(n)&&n.length>0?parseFloat(n):null}var bo=class{constructor(t,e){this._url=null;this._base=void 0;this._protocol=null;this._host=null;this._hostName=null;this._userName=null;this._password=null;this._port=null;this._pathName=null;this._hash=null;this._query=new Map;t!==void 0&&(this._url=new URL(t,e),this.rehydrate())}rehydrate(){w(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),w(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),w(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),w(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),w(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),w(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),w(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),w(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[t,e]of this._query)this._url.searchParams.set(t,e);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=sc(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((t,e)=>this._query.set(e,t))}refresh(){if(this._url===null){if(w(this._protocol)&&(w(this._host)||w(this._hostName))){if(w(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=sc(this._url.port),this.rehydrate(),!1;if(w(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(w(this._pathName)&&w(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return w(this._url)}base(t){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=t,this.refresh(),this}protocol(t){return this._protocol=t,this.refresh()&&(this._url.protocol=t),this}host(t){return this._host=t,this.refresh()&&(this._url.host=t,this._hostName=this._url.hostname,this._port=sc(this._url.port)),this}hostName(t){return this._hostName=t,this.refresh()&&(this._url.hostname=t,this._host=`${this._url.hostname}:${this._url.port}`),this}port(t){return this._port=t,this.refresh()&&(this._url.port=t.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(t){return this._userName=t,this.refresh()&&(this._url.username=t),this}password(t){return this._password=t,this.refresh()&&(this._url.password=t),this}path(t){return this._pathName=t,this.refresh()&&(this._url.pathname=t),this}pathPop(t){return t=t||/\/[^/]+\/?$/,this.path(this._pathName.replace(t,""))}pathPush(t){let e=this._pathName;return e.endsWith("/")||(e+="/"),e+=t,this.path(e)}query(t,e){return this._query.set(t,e),this.refresh()&&this._url.searchParams.set(t,e),this}hash(t){return this._hash=t,this.refresh()&&(this._url.hash=t),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};var ac=class extends tn{constructor(t,e){super(t,e)}},_o=class extends ac{constructor(t){super("loading",t)}};var Da=class extends en{constructor(e,r){let o=Kt(mn(!1),Pn(!1),Pt(!0)),i=new It(e,{mediaElement:o});i.name="JuniperAudioPlayer-Input";super("audio-player",e,r,[],[i]);this.cacheBustSources=new Map;this._data=null;this._loaded=!1;this.sourcesByURL=new Map;this.sources=new Array;this.potatoes=new Array;i.connect(this.volumeControl),this.element=o,this.loadingEvt=new _o(this),this.loadEvt=new Vn(this),this.playEvt=new On(this),this.pauseEvt=new Wn(this),this.stopEvt=new Hn(this),this.progEvt=new Nn(this),this.onPlay=async()=>{this.enable(),this.dispatchEvent(this.playEvt)},this.onPause=s=>{this.disable(),this.element.currentTime===0||s.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)},this.onTimeUpdate=async()=>{this.progEvt.value=this.element.currentTime,this.progEvt.total=this.element.duration,this.dispatchEvent(this.progEvt)},this.onError=()=>this.loadAudio(),this.element.addEventListener("play",this.onPlay),this.element.addEventListener("pause",this.onPause),this.element.addEventListener("ended",this.onPause),this.element.addEventListener("error",this.onError),this.element.addEventListener("waiting",this.onWaiting),this.element.addEventListener("canplay",this.onCanPlay),this.element.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{audioPlayer:this})}get data(){return this._data}get loaded(){return this._loaded}get title(){return this.element.title}setTitle(e){this.element.title=e}get hasAudio(){let e=this.sourcesByURL.get(this.element.src);return w(e)&&e.acodec!=="none"||w(this.element.audioTracks)&&this.element.audioTracks.length>0||w(this.element.webkitAudioDecodedByteCount)&&this.element.webkitAudioDecodedByteCount>0||w(this.element.mozHasAudio)&&this.element.mozHasAudio}onDisposing(){super.onDisposing(),this.clear(),this.element.removeEventListener("play",this.onPlay),this.element.removeEventListener("pause",this.onPause),this.element.removeEventListener("ended",this.onPause),this.element.removeEventListener("error",this.onError),this.element.removeEventListener("waiting",this.onWaiting),this.element.removeEventListener("canplay",this.onCanPlay),this.element.removeEventListener("timeupdate",this.onTimeUpdate),this.element.dispatchEvent(Ao)}clear(){this.stop(),this.sourcesByURL.clear(),ue(this.sources),ue(this.potatoes),this.element.src="",this._data=null,this._loaded=!1}cacheBust(e){let r=this.cacheBustSources.get(e)||0;this.cacheBustSources.set(e,r+1)}async load(e,r){this.clear(),this._data=e,de(e)?(this.setTitle(e),this.potatoes.push(e)):(this.setTitle(e.title),xr(e.audios,o=>-o.resolution),_d(this.sources,...e.audios));for(let o of this.sources)this.sourcesByURL.set(o.url,o);if(!this.hasSources)throw new Error("No audio sources");if(this.dispatchEvent(this.loadingEvt),await this.loadAudio(r),!this.hasSources)throw new Error("No audio sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}async getMediaCapabilities(e){let r={type:"file",audio:{contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr}};try{return await navigator.mediaCapabilities.decodingInfo(r)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:r}}}get hasSources(){return this.sources.length>0||this.potatoes.length>0}async loadAudio(e){for(w(e)&&e.start(),this.element.removeEventListener("error",this.onError);this.hasSources;){let r=null,o=this.sources.shift();if(w(o)){let s=await this.getMediaCapabilities(o);if(!s.smooth||!s.powerEfficient){this.potatoes.push(o.url);continue}else r=o.url}else r=this.potatoes.shift();let i=this.cacheBustSources.get(this.data);if(w(i)){let s=new bo(r,location.href);s.query("v",i.toString()),r=s.toString()}if(this.element.src=r,this.element.load(),await Us(this.element)){w(o)?this.sources.unshift(o):this.potatoes.unshift(r),this.element.addEventListener("error",this.onError),w(e)&&e.end();return}}}get playbackState(){return L(this.data)?"empty":this.loaded?this.element.error?"errored":this.element.ended||this.element.paused&&this.element.currentTime===0?"stopped":this.element.paused?"paused":"playing":"loading"}async play(){await this.context.ready,await this.element.play()}async playThrough(){let e=hn(this,"stopped");await this.play(),await e}pause(){this.element.pause()}stop(){this.pause(),this.element.currentTime=0}restart(){return this.stop(),this.play()}};var ch=/([^\/]+)\/(.+)/,BF=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/;var Gn=class{constructor(t,e,r){this._type=t;this._fullSubType=e;this._primaryExtension=null;this.depMessage=null;let o=new Map;this._parameters=o;let i=this._fullSubType.match(BF);this._tree=i[1],this._subType=i[2],this._suffix=i[3];let s=i[4];if(this._value=this._fullValue=this._type+"/",w(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,w(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),w(s)){let a=s.split(";").map(l=>l.trim()).filter(l=>l.length>0).map(l=>l.split("="));for(let[l,...p]of a){let m=p.join("=");o.set(l,m);let g=`; ${l}=${m}`;this._fullValue+=g,l!=="q"&&(this._value+=g)}}this._extensions=r||[],this._primaryExtension=this._extensions[0]||null}static parse(t){if(!t)return null;let e=t.match(ch);if(!e)return null;let r=e[1],o=e[2];return new Gn(r,o)}deprecate(t){return this.depMessage=t,this}check(){w(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(t){if(L(t))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let e=null,r=null;if(de(t)){let o=t.match(ch);if(!o)return!1;e=o[1],r=o[2]}else e=t.typeName,r=t._fullSubType;return this.typeName===e&&(this._fullSubType==="*"||this._fullSubType===r)}withParameter(t,e){let r=`${this._fullSubType}; ${t}=${e}`;return new Gn(this.typeName,r,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}addExtension(t){if(!t)throw new Error("File name is not defined");if(this.primaryExtension){let e=t.lastIndexOf(".");if(e>-1){let r=t.substring(e+1);this.extensions.indexOf(r)>-1&&(t=t.substring(0,e))}t=`${t}.${this.primaryExtension}`}return t}};function PF(n,t,...e){return new Gn(n,t,e)}function Ze(n){return PF.bind(null,n)}var RF=Ze("audio");var Fn=RF("mpeg","mp3","mp2","mp2a","mpga","m2a","m3a");var IF=Ze("image");var ph=IF("png","png");var dh=Ze("model");var _r=dh("gltf-binary","glb"),mh=dh("gltf+json","gltf");var VF=Ze("video");var hh=VF("vnd.mpeg.dash.mpd","mpd");var Mi="HTMLCanvasElement"in globalThis,oy="HTMLImageElement"in globalThis,fh=!1,lc=!fh&&"OffscreenCanvas"in globalThis,OF=!fh&&"createImageBitmap"in globalThis;function Vt(n){return Mi&&n instanceof HTMLCanvasElement}function uc(n){return lc&&n instanceof OffscreenCanvas}function gh(n){return OF&&n instanceof ImageBitmap}function xh(n){return n instanceof ImageData}function WF(n){return Vt(n)||uc(n)}function wh(n,t){let e=n.getContext("2d");if(L(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function Fh(n,t){let e=n.getContext("2d");if(L(e))throw new Error("Could not create 2d context for canvas");e.putImageData(t,0,0)}function HF(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var cc=lc&&HF(),To=cc&&pc||Mi&&Ba||null,La=Mi?Ba:To;function NF(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var iy=lc&&NF();function pc(n,t){return new OffscreenCanvas(n,t)}function Ba(n,t){return Xs(Cd(n),Md(t))}function GF(n){let t=pc(n.width,n.height);return wh(t,n),t}function UF(n){let t=Ba(n.width,n.height);return wh(t,n),t}var Ah=cc&&GF||Mi&&UF||null;function zF(n){let t=pc(n.width,n.height);return Fh(t,n),t}function XF(n){let t=Ba(n.width,n.height);return Fh(t,n),t}var vh=cc&&zF||Mi&&XF||null;function dc(n,t,e,r=1){return t=Math.floor(t*r),e=Math.floor(e*r),n.width!=t||n.height!=e?(n.width=t,n.height=e,!0):!1}function jF(n){return w(n.textBaseline)}function qF(n,t,e,r=1){let o=n.imageSmoothingEnabled,i=n.textBaseline,s=n.textAlign,a=n.font,l=dc(n.canvas,t,e,r);return l&&(n.imageSmoothingEnabled=o,n.textBaseline=i,n.textAlign=s,n.font=a),l}function mc(n,t,e,r=1){return jF(n)?qF(n,t,e,r):dc(n.canvas,t,e,r)}function hc(n,t=1){return dc(n,n.clientWidth,n.clientHeight,t)}function Un(n){WF(n)?n.width=n.height=0:Le(n)}function ki(n){return w(n)&&Z(n.then)&&Z(n.catch)&&Z(n.finally)&&Z(n.fetch)&&Z(n.getSize)}var fc=class{constructor(t,e){this.path=t;this.type=e;this._result=null;this._error=null;this._started=!1;this._finished=!1;this.resolve=null;this.reject=null;this.promise=new Promise((r,o)=>{this.resolve=i=>{this._result=i,this._finished=!0,r(i)},this.reject=i=>{this._error=i,this._finished=!0,o(i)}})}get result(){if(w(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}async getSize(t){try{let{contentLength:e}=await t.head(this.path).accept(this.type).exec();return[this,e||1]}catch(e){return console.warn(e),[this,1]}}async fetch(t,e){try{let r=await this.getResult(t,e);this.resolve(r)}catch(r){this.reject(r)}}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};var Eo=class extends fc{constructor(e,r,o){let i;St(r)?o=r:i=r;super(e,i);this.useCache=!!o}getResult(e,r){return this.getRequest(e,r).then(ro)}getRequest(e,r){let o=e.get(this.path).useCache(this.useCache).progress(r);return this.getResponse(o)}};var Ot=class extends Eo{getResponse(t){return t.file(this.type)}},Pa=class extends Eo{getResponse(t){return t.image(this.type)}};var Te=Math.PI,ct=.5*Te,ut=2*Te;var QF=864e13,gy=-QF;function zn(n){return(n%ut+ut)%ut}function Xn(n,t,e){return Math.min(e,Math.max(t,n))}function $e(n){return n*ut/360}function Ci(n){return n*360/ut}function Sh(...n){let t=Number.MAX_VALUE;for(let e of n)Math.abs(e)<t&&(t=e);return t}function bh(n,t,e){return(1-e)*n+e*t}function gc(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function _h(n){return Math.abs(n)>1e-4?n:0}var jn=class extends te{constructor(e,r,o){super();this._scale=250;this._visible=!0;this.wasVisible=null;this.redrawnEvt=new N("redrawn");this.element=null;w(o)&&w(o.scale)&&(this._scale=o.scale),this._canvas=La(e,r),this._g=this.canvas.getContext("2d"),Vt(this._canvas)&&(this.element=this._canvas)}fillRect(e,r,o,i,s,a){this.g.fillStyle=e,this.g.fillRect(r+a,o+a,i-2*a,s-2*a)}drawText(e,r,o,i){this.g.textAlign=i,this.g.strokeText(e,r,o),this.g.fillText(e,r,o)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}onClear(){this.g.clearRect(0,0,this.canvas.width,this.canvas.height)}clear(){this.onClear(),this.dispatchEvent(this.redrawnEvt)}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(e){this.scale!==e&&(this._scale=e,this.redraw())}get visible(){return this._visible}set visible(e){this.visible!==e&&(this.wasVisible=this._visible,this._visible=e,this.redraw())}};var Ra=class extends jn{constructor(){super(128,128);this._pitchDegrees=0;this._headingDegrees=0;this.redraw()}get pitchDegrees(){return this._pitchDegrees}set pitchDegrees(e){e!==this.pitchDegrees&&(this._pitchDegrees=e,this.redraw())}get headingDegrees(){return this._headingDegrees}set headingDegrees(e){e!==this.headingDegrees&&(this._headingDegrees=e,this.redraw())}setPitchAndHeading(e,r){(e!==this.pitchDegrees||r!==this.headingDegrees)&&(this._pitchDegrees=e,this._headingDegrees=r,this.redraw())}onRedraw(){let e=$e(this.pitchDegrees),r=$e(this.headingDegrees-180),o=5,i=this.canvas.width-2*o,s=this.canvas.height-2*o,a=.5*i,l=.5*s,p=Math.sin(e),m=this.g;return m.save(),m.clearRect(0,0,this.canvas.width,this.canvas.height),m.translate(o,o),m.scale(a,l),m.translate(1,1),m.fillStyle="gray",m.beginPath(),m.arc(0,0,1,0,ut),m.fill(),m.fillStyle="lightgrey",m.beginPath(),m.arc(0,0,1,0,Te,!0),m.fill(),m.save(),m.scale(1,Math.abs(p)),p<0&&(m.fillStyle="gray"),m.beginPath(),m.arc(0,0,1,0,Te,p<0),m.fill(),m.restore(),m.save(),m.shadowColor=Rt(64,64,64),m.shadowBlur=4,m.shadowOffsetX=3,m.shadowOffsetY=3,m.rotate(r),m.fillStyle="red",m.beginPath(),m.moveTo(-.1,0),m.lineTo(0,-.667),m.lineTo(.1,0),m.closePath(),m.fill(),m.fillStyle="white",m.beginPath(),m.moveTo(-.1,0),m.lineTo(0,.667),m.lineTo(.1,0),m.closePath(),m.fill(),m.restore(),m.beginPath(),m.strokeStyle="black",m.lineWidth=.1,m.arc(0,0,1,0,ut),m.stroke(),m.restore(),!0}};function Ia(n,t,e){return new Map(n.map(r=>[t(r),e(r)]))}function Th(n,t){return Ia(n,Bn,t)}var KF="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function Tt(n,t){if(n<0)throw new Error("Length must be greater than 0");L(t)&&(t=KF);let e="";for(let r=0;r<n;++r){let o=Math.floor(Math.random()*t.length);e+=t[o]}return e}var Di=class extends N{constructor(){super("update");this.t=0;this.dt=0;this.sdt=0;this.fps=0}set(e,r){this.t=e,this.dt=r,this.sdt=bh(this.sdt,r,.01),r>0&&(this.fps=1e3/r)}},Va=class extends Di{constructor(){super(),Object.seal(this)}};var yo=class{constructor(t){this.timer=null;this.lt=-1;this.tickHandlers=new Array;this._targetFPS=null;this.targetFPS=t;let e=new Va,r=0;this.onTick=o=>{this.lt>=0&&(r=o-this.lt,e.set(o,r),this.tick(e)),this.lt=o}}get targetFPS(){return this._targetFPS}set targetFPS(t){this._targetFPS=t}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){Ce(this.tickHandlers,t)}tick(t){for(let e of this.tickHandlers)e(t)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};var Oa=class extends yo{constructor(){super()}start(){if(!this.isRunning){let t=e=>{this.timer=requestAnimationFrame(t),this.onTick(e)};this.timer=requestAnimationFrame(t)}}stop(){this.isRunning&&(cancelAnimationFrame(this.timer),super.stop())}};var qn=class{constructor(t){this.task=new Se(!1);this.element=fe(gt("dialog"),rt("none"),Is("dialogname",t),this.container=fe(gt("dialog-container"),this.titleElement=rm(gt("title-bar"),t),this.contentArea=fe(gt("dialog-content")),fe(gt("dialog-controls"),this.confirmButton=$r("Confirm",Ue("confirm-button")),this.cancelButton=zs("Cancel",Ue("cancel-button"))))),this.confirmButton.addEventListener("click",this.task.resolver(!0)),this.cancelButton.addEventListener("click",this.task.resolver(!1)),$(document.body,this)}get title(){return this._title}set title(t){Gs(this.titleElement,this._title=t)}async onShowing(){}onShown(){}async onConfirm(){}onCancel(){}async onClosing(){}onClosed(){}show(t){Xe(this,t)}get isOpen(){return bt(this)}hide(){this.show(!1)}async toggle(){this.isOpen?this.hide():this.showDialog()}async showDialog(){return await this.onShowing(),this.show(!0),this.onShown(),this.task.restart(),await this.task?await this.onConfirm():this.onCancel(),await this.onClosing(),this.show(!1),this.onClosed(),this.task.result}};var yt=20,Wa=yt/2,Et=me.create();function Eh(n,t){return n<0?0:n>t?t:Number.isFinite(n)?n:(console.trace("To infinity... and beyond!"),t)}var Ha=class extends qn{constructor(e,r,o,i){super(e);this.getNodeName=r;this.getNodeColor=o;this.getWeightMod=i;this.timer=new Oa;this.positions=new Map;this.forces=new Map;this.wasGrabbed=new Set;this.mousePoint=me.create();this.grabbed=null;this.graph=null;this.cancelButton.style.display="none";let s=Tt(5);$(this.container,Sr(fn(100)),Uu(fn(100))),$(this.contentArea,fe(rt("grid"),Nd("repeat(11, auto)",Bd(1)),Vd(Hs(5)),Rd("center"),...eo("limit"+s,"Limit",this.t=to(Fr(0),wr(1e3),Ar(.1),qt(5))),...eo("cooling"+s,"Cooling",this.cooling=Fi()),...eo("attract"+s,"Attract",this.attract=to(Fr(-100),wr(100),Ar(.1),qt(1))),...eo("repel"+s,"Repel",this.repel=to(Fr(-100),wr(100),Ar(.1),qt(1))),...eo("hideBare"+s,"Hide bare nodes",this.hideBare=Fi(Rs(!0)))),this.canvas=Xs(rt("block"),Sr(fn(100)),Uu(`calc(${fn(100)} - ${gn(2)})`))),this.g=this.canvas.getContext("2d"),this.g.textAlign="center",this.g.textBaseline="middle",this.timer.addTickHandler(()=>{hc(this.canvas),this.fr91(),this.draw()});let a=me.create();this.canvas.addEventListener("mousedown",l=>{this.setMouse(l),this.grabbed=null;let p=.7071067811865475*yt;for(let m of this.graph){let g=this.positions.get(m);me.sub(a,g,this.mousePoint);let F=me.length(a);F<p&&(this.grabbed=m,this.wasGrabbed.has(m)?this.wasGrabbed.delete(m):this.wasGrabbed.add(m),p=F)}}),this.canvas.addEventListener("mousemove",l=>{this.setMouse(l)}),this.canvas.addEventListener("mouseup",()=>{this.grabbed=null})}get w(){return this.canvas.width-2*yt-200}get h(){return this.canvas.height-2*yt}setMouse(e){let r=e.offsetX*this.canvas.width/this.canvas.clientWidth-yt,o=e.offsetY*this.canvas.height/this.canvas.clientHeight-yt;me.set(this.mousePoint,r,o)}draw(){this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.g.fillStyle="black",this.g.strokeStyle="black",this.g.save(),this.g.translate(yt,yt);for(let e of this.graph){let r=this.positions.get(e);for(let o of e.connections){let i=this.positions.get(o);this.g.beginPath(),this.g.moveTo(r[0],r[1]),this.g.lineTo(i[0],i[1]),this.g.stroke()}}this.g.strokeStyle="lightgrey",this.g.save(),this.g.translate(-Wa,-Wa);for(let e of this.graph)if(e.isConnected||!this.hideBare.checked){this.g.fillStyle=Rt(243,243,243);let r=this.positions.get(e);this.g.fillStyle=this.getNodeColor(e.value),this.g.fillRect(r[0],r[1],yt,yt),this.g.strokeRect(r[0],r[1],yt,yt),this.g.fillStyle="black",this.g.fillText(this.getNodeName(e.value),r[0]+Wa,r[1]+Wa)}this.g.restore(),this.g.restore()}applyForces(e,r){let o=Th(this.graph,()=>me.create());for(let i of this.graph){let s=this.positions.get(i);if(i===this.grabbed)me.copy(s,this.mousePoint);else if(!this.wasGrabbed.has(i)){let a=o.get(i),l=this.forces.get(i);l&&me.add(a,a,l),me.set(Et,this.w,this.h),me.scaleAndAdd(Et,s,Et,-.5);let p=me.length(Et);if(p>0){me.normalize(Et,Et);let m=-1e4*p;m=Math.sign(m)*Math.pow(Math.abs(m),.2),me.scaleAndAdd(a,a,Et,m)}for(let m of this.graph)if(i!==m){let g=this.positions.get(m);me.sub(Et,g,s);let F=me.length(Et);if(F>0){me.normalize(Et,Et);let S=i.isConnectedTo(m),M=this.getWeightMod(i.value,m.value,S),k=2-M,E=M*this.attract.valueAsNumber*e(S,F)-k*this.repel.valueAsNumber*r(S,F);me.scaleAndAdd(a,a,Et,E)}}}}for(let i of this.graph){let s=o.get(i);s[1]*=this.h/this.w;let a=me.length(s);if(a>0){me.scale(s,s,Math.min(this.t.valueAsNumber,a)/a);let l=this.positions.get(i);me.add(l,l,s),l[0]=Eh(l[0],this.w),l[1]=Eh(l[1],this.h)}}this.cooling.checked&&(this.t.valueAsNumber*=.975)}fr91(){let e=this.w*this.h*.1,r=1,o=1.5,i=.1,s=r*Math.sqrt(e/this.graph.length);for(let a=0;a<2;++a)this.applyForces((l,p)=>l?o*Math.sqrt(p)*p/s:0,(l,p)=>i*s*s/p)}onShown(){super.onShown(),this.refreshData(),this.t.valueAsNumber=5,hc(this.canvas),this.timer.isRunning||this.timer.start()}refreshData(){this.positions.clear(),this.forces.clear(),this.wasGrabbed.clear();let e=Math.min(this.w,this.h)/2;for(let r=0;r<this.graph.length;++r){let o=this.graph[r],i=ut*r/this.graph.length,s=e,a=s*Math.cos(i)+this.w/2,l=s*Math.sin(i)+this.h/2;this.positions.set(o,me.fromValues(a,l))}}setGraph(e){this.graph=e}onClosed(){this.timer.stop(),super.onClosed()}};function JF(n){return n.name}function YF(n){if(n.nodeClass==="node")return"lightgreen";if(n.nodeClass==="param")return"lightyellow";if(n.nodeClass==="unknown")return"pink";dn(n.nodeClass)}function ZF(n,t,e){return!e||n.nodeClass===t.nodeClass?1:1.8}var Na=class extends Ha{constructor(e){super("Audio graph",JF,YF,ZF);this.context=e}refreshData(){let e=this.context.getAudioGraph(!1);this.setGraph(e),super.refreshData()}};function Qn(n,t){let e=globalThis,r=e[n];if(L(r)){if(L(t))throw new Error(`No value ${n} found`);r=t(),e[n]=r}return r}var fM=Qn("juniper::loadedFonts",()=>[]);function Ga(n){let t=[];return n.fontStyle&&n.fontStyle!=="normal"&&t.push(n.fontStyle),n.fontVariant&&n.fontVariant!=="normal"&&t.push(n.fontVariant),n.fontWeight&&n.fontWeight!=="normal"&&t.push(n.fontWeight),t.push(Hs(n.fontSize)),t.push(n.fontFamily),t.join(" ")}function yh(n){return"getBattery"in n}var $F=["","N/A","charging"],Mo=class extends jn{constructor(){super(256,128);this.battery=null;this.lastChargeDirection=null;this.lastLevel=null;this.chargeDirection=0;this.level=.5;yh(navigator)?this.readBattery(navigator):this.redraw()}onRedraw(){this.battery?(this.chargeDirection=this.battery.charging?1:-1,this.level=this.battery.level):(this.level+=.1,this.level>1&&(this.level=0));let e=this.chargeDirection!==this.lastChargeDirection,r=this.level!==this.lastLevel;if(!e&&!r)return!1;this.lastChargeDirection=this.chargeDirection,this.lastLevel=this.level;let o=this.level<.1?"red":"silver",i=7,s=.7,a=(1-s)/2,l=this.canvas.width-2*i,p=l-4*i,m=this.canvas.height-4*i,g=l/2,F=this.canvas.height/2,S=$F[this.chargeDirection+1];return this.g.clearRect(0,0,l,this.canvas.height),this.g.save(),this.g.translate(a*this.canvas.width,a*this.canvas.height),this.g.globalAlpha=.75,this.g.scale(s,s),this.fillRect("silver",0,0,l,this.canvas.height,0),this.fillRect("silver",l,F-2*i-10,i+10,4*i+20,0),this.g.clearRect(i,i,l-2*i,this.canvas.height-2*i),this.fillRect("black",i,i,l-2*i,this.canvas.height-2*i,0),this.g.clearRect(2*i,2*i,p*this.level,m),this.fillRect(o,2*i,2*i,p*this.level,m,0),this.g.fillStyle="white",this.g.strokeStyle="black",this.g.lineWidth=4,this.g.textBaseline="middle",this.g.font=Ga({fontSize:m/2,fontFamily:"Lato"}),this.drawText(S,g,F,"center"),this.g.restore(),!0}async readBattery(e){let r=this.redraw.bind(this);r(),this.battery=await e.getBattery(),this.battery.addEventListener("chargingchange",r),this.battery.addEventListener("levelchange",r),setInterval(r,1e3),r()}};Mo.isAvailable=yh(navigator);var Wt=class extends jn{constructor(e){super(10,10,e);this.trueWidth=null;this.trueHeight=null;this.trueFontSize=null;this.dx=null;this._minWidth=null;this._maxWidth=null;this._minHeight=null;this._maxHeight=null;this._freezeDimensions=!1;this._dimensionsFrozen=!1;this._bgFillColor=null;this._bgStrokeColor=null;this._bgStrokeSize=null;this._textStrokeColor=null;this._textStrokeSize=null;this._textFillColor="black";this._textDirection="horizontal";this._fontStyle="normal";this._fontVariant="normal";this._fontWeight="normal";this._fontFamily="sans-serif";this._fontSize=20;this._value=null;this.lastValue=null;w(e)&&(w(e.minWidth)&&(this._minWidth=e.minWidth),w(e.maxWidth)&&(this._maxWidth=e.maxWidth),w(e.minHeight)&&(this._minHeight=e.minHeight),w(e.maxHeight)&&(this._maxHeight=e.maxHeight),w(e.freezeDimensions)&&(this._freezeDimensions=e.freezeDimensions),w(e.textStrokeColor)&&(this._textStrokeColor=e.textStrokeColor),w(e.textStrokeSize)&&(this._textStrokeSize=e.textStrokeSize),w(e.bgFillColor)&&(this._bgFillColor=e.bgFillColor),w(e.bgStrokeColor)&&(this._bgStrokeColor=e.bgStrokeColor),w(e.bgStrokeSize)&&(this._bgStrokeSize=e.bgStrokeSize),w(e.value)&&(this._value=e.value),w(e.textFillColor)&&(this._textFillColor=e.textFillColor),w(e.textDirection)&&(this._textDirection=e.textDirection),w(e.fontStyle)&&(this._fontStyle=e.fontStyle),w(e.fontVariant)&&(this._fontVariant=e.fontVariant),w(e.fontWeight)&&(this._fontWeight=e.fontWeight),w(e.fontFamily)&&(this._fontFamily=e.fontFamily),w(e.fontSize)&&(this._fontSize=e.fontSize),w(e.padding)&&(ge(e.padding)?this._padding={left:e.padding,right:e.padding,top:e.padding,bottom:e.padding}:this._padding=e.padding)),L(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(e){this.minWidth!==e&&(this._minWidth=e,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(e){this.maxWidth!==e&&(this._maxWidth=e,this.redraw())}get minHeight(){return this._minHeight}set minHeight(e){this.minHeight!==e&&(this._minHeight=e,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(e){this.maxHeight!==e&&(this._maxHeight=e,this.redraw())}get padding(){return this._padding}set padding(e){if(e instanceof Array)throw new Error("Invalid padding");(this.padding.top!==e.top||this.padding.right!=e.right||this.padding.bottom!=e.bottom||this.padding.left!=e.left)&&(this._padding=e,this.redraw())}get textDirection(){return this._textDirection}set textDirection(e){this.textDirection!==e&&(this._textDirection=e,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(e){this.fontStyle!==e&&(this._fontStyle=e,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(e){this.fontVariant!==e&&(this._fontVariant=e,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(e){this.fontWeight!==e&&(this._fontWeight=e,this.redraw())}get fontSize(){return this._fontSize}set fontSize(e){this.fontSize!==e&&(this._fontSize=e,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(e){this.textFillColor!==e&&(this._textFillColor=e,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(e){this.textStrokeColor!==e&&(this._textStrokeColor=e,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(e){this.textStrokeSize!==e&&(this._textStrokeSize=e,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(e){this.bgFillColor!==e&&(this._bgFillColor=e,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(e){this.bgStrokeColor!==e&&(this._bgStrokeColor=e,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(e){this.bgStrokeSize!==e&&(this._bgStrokeSize=e,this.redraw())}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.redraw())}split(e){return e.replace(/\r\n/g,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.onClear(),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value&&this.value!==this.lastValue){let e=this.split(this.value),r=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let i=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,s=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,a=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,l=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,p=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,m=r?l:s,g=r?p:a,F=r?s:l,S=r?a:p,M=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let k=!1,E=!1,R=1e4,W=0;this.trueFontSize=Xn(this.fontSize*this.scale,W,R);let V=null,B=Number.MAX_VALUE;do{let O=this.fontSize;this._fontSize=this.trueFontSize;let ne=Ga(this);this._fontSize=O,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=ne,this.trueWidth=0,this.trueHeight=0;for(let ae of e){let j=this.g.measureText(ae);this.trueWidth=Math.max(this.trueWidth,j.width),this.trueHeight+=this.trueFontSize,ge(j.actualBoundingBoxLeft)&&ge(j.actualBoundingBoxRight)&&ge(j.actualBoundingBoxAscent)&&ge(j.actualBoundingBoxDescent)&&(i||(this.trueWidth=j.actualBoundingBoxLeft+j.actualBoundingBoxRight,this.trueHeight=j.actualBoundingBoxAscent+j.actualBoundingBoxDescent,this.dx=(j.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(i){let ae=this.trueWidth-m,j=this.trueWidth-g,ee=this.trueHeight-F,we=this.trueHeight-S,Fe=Math.abs(ae),re=Math.abs(j),tt=Math.abs(ee),Dn=Math.abs(we);k=j>1||we>1,E=ae<-1&&ee<-1;let Ut=Math.min(Fe,Math.min(re,Math.min(tt,Dn)));Ut<B&&(B=Ut,V=this.g.font),(k||E)&&M.indexOf(this.g.font)>-1&&V&&(this.g.font=V,k=!1,E=!1),k?(R=this.trueFontSize,this.trueFontSize=(W+this.trueFontSize)/2):E&&(W=this.trueFontSize,this.trueFontSize=(this.trueFontSize+R)/2)}M.push(this.g.font)}while(k||E);i&&(this.trueWidth<m?this.trueWidth=m:this.trueWidth>g&&(this.trueWidth=g),this.trueHeight<F?this.trueHeight=F:this.trueHeight>S&&(this.trueHeight=S));let G=this.trueWidth+this.scale*(this.padding.right+this.padding.left),D=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{mc(this.g,G,D)}catch(O){throw console.error(O),O}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let o=.5*(e.length-1);for(let i=0;i<e.length;++i){let s=e[i],a=(i-o)*this.trueFontSize,l=this.dx+this.trueWidth/2+this.scale*this.padding.left,p=a+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(s,l,p),this.textFillColor&&this.g.fillText(s,l,p)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let i=this.bgStrokeSize/2;this.g.strokeRect(i,i,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(r){let i=To(this.canvas.height,this.canvas.width),s=i.getContext("2d");s?(s.translate(i.width/2,i.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?s.rotate(ct):this.textDirection==="vertical-right"&&s.rotate(-ct),s.translate(-this.canvas.width/2,-this.canvas.height/2),s.drawImage(this.canvas,0,0),mc(this.g,i.width,i.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(i,0,0)}return this.lastValue=this.value,!0}else{let e=this.value!==this.lastValue;return this.lastValue=this.value,e}}};var Ua=class extends Wt{constructor(){super({textFillColor:"white",textStrokeColor:Rt(0,0,0,.5),textStrokeSize:.025,fontFamily:Zr(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,freezeDimensions:!0});let t=this.update.bind(this);setInterval(t,500),t()}update(){let e=new Date().toLocaleTimeString();(L(this.value)||e.length!==this.value.length)&&this.unfreeze(),this.value=e}};var za=class extends Wt{constructor(){super({textFillColor:"white",textStrokeColor:Rt(0,0,0,.5),textStrokeSize:.025,fontFamily:Zr(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,freezeDimensions:!0});this.fps=null;this.drawCalls=null;this.triangles=null}setStats(e,r,o){this.fps=e,this.drawCalls=r,this.triangles=o;let i=` ${Math.round(this.fps).toFixed(0)}hz ${this.drawCalls}c ${this.triangles}t`;(L(this.value)||i.length!==this.value.length)&&this.unfreeze(),this.value=i}};var Mh="calla:preferredVideoInputID",Xa=class extends te{constructor(){super();this.element=wi(Os(!0));this._hasPermission=!1;this._device=null;this._enabled=!1;Object.seal(this)}get mediaType(){return"video"}get deviceKind(){return`${this.mediaType}input`}get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.onChange())}get hasPermission(){return this._hasPermission}get preferredDeviceID(){return localStorage.getItem(Mh)}get device(){return this._device}checkDevices(e){if(!this.hasPermission){for(let r of e)if(r.kind===this.deviceKind&&r.deviceId.length>0&&r.label.length>0){this._hasPermission=!0;break}}}async setDevice(e){if(w(e)&&e.kind!==this.deviceKind)throw new Error(`Device is not an vide input device. Was: ${e.kind}. Label: ${e.label}`);let r=this.device&&this.device.deviceId||null,o=e&&e.deviceId||null;o!==r&&(this._device=e,localStorage.setItem(Mh,o),await this.onChange())}async onChange(){this.dispatchEvent(new vo);let e=this.inStream;this.device&&this.enabled?this.inStream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.device.deviceId,autoGainControl:!0,height:640,noiseSuppression:!0}}):this.inStream=null,this.inStream!==e&&this.dispatchEvent(new So(e,this.outStream))}get inStream(){return this.element.srcObject}set inStream(e){e!==this.inStream&&(this.inStream&&this.element.pause(),this.element.srcObject=e,this.inStream&&this.element.play())}get outStream(){return this.inStream}stop(){this.inStream=null}};var kh="local-user";function Ch(n,t){return n==="click"&&t&&(n="error"),`InteractionAudio-${n}`}var ja=class{constructor(t,e){this.audio=t;this.eventSys=e;let r=o=>{if(o.pointer.type!=="nose"&&o.rayTarget&&o.rayTarget.clickable){let i=Ch(o.type,!o.rayTarget.enabled);if(this.audio.hasClip(i)){let{x:s,y:a,z:l}=o.point;this.audio.setClipPosition(i,s,a,l),this.audio.playClip(i)}}};this.eventSys.addEventListener("enter",r),this.eventSys.addEventListener("exit",r),this.eventSys.addEventListener("click",r)}create(t,e,r){return this.audio.createClip(Ch(t,!1),e,!1,!0,!1,!0,r,[])}};var{ACESFilmicToneMapping:QM,AddEquation:KM,AddOperation:JM,AdditiveAnimationBlendMode:YM,AdditiveBlending:ZM,AlphaFormat:$M,AlwaysDepth:ek,AlwaysStencilFunc:tk,AmbientLight:Dh,AmbientLightProbe:nk,AnimationClip:Lh,AnimationLoader:rk,AnimationMixer:ok,AnimationObjectGroup:ik,AnimationUtils:sk,ArcCurve:ak,ArrayCamera:lk,ArrowHelper:uk,Audio:ck,AudioAnalyser:pk,AudioContext:dk,AudioListener:mk,AudioLoader:hk,AxesHelper:fk,BackSide:Bh,BasicDepthPacking:gk,BasicShadowMap:xk,Bone:Ph,BooleanKeyframeTrack:wk,Box2:Fk,Box3:Tr,Box3Helper:Ak,BoxBufferGeometry:vk,BoxGeometry:qa,BoxHelper:Sk,BufferAttribute:An,BufferGeometry:Li,BufferGeometryLoader:bk,ByteType:_k,Cache:Tk,Camera:Ek,CameraHelper:yk,CanvasTexture:Rh,CapsuleBufferGeometry:Mk,CapsuleGeometry:kk,CatmullRomCurve3:Ck,CineonToneMapping:Dk,CircleBufferGeometry:Lk,CircleGeometry:Bk,ClampToEdgeWrapping:Ih,Clock:Pk,Color:Be,ColorKeyframeTrack:Rk,ColorManagement:xc,CompressedArrayTexture:Ik,CompressedTexture:Vk,CompressedTextureLoader:Ok,ConeBufferGeometry:Wk,ConeGeometry:Hk,CubeCamera:Vh,CubeReflectionMapping:Nk,CubeRefractionMapping:Gk,CubeTexture:Oh,CubeTextureLoader:Uk,CubeUVReflectionMapping:zk,CubicBezierCurve:Xk,CubicBezierCurve3:jk,CubicInterpolant:qk,CullFaceBack:Qk,CullFaceFront:Kk,CullFaceFrontBack:Jk,CullFaceNone:Yk,Curve:Zk,CurvePath:$k,CustomBlending:e3,CustomToneMapping:t3,CylinderBufferGeometry:n3,CylinderGeometry:Wh,Cylindrical:r3,Data3DTexture:o3,DataArrayTexture:i3,DataTexture:s3,DataTextureLoader:a3,DataUtils:l3,DecrementStencilOp:u3,DecrementWrapStencilOp:c3,DefaultLoadingManager:p3,DepthFormat:d3,DepthStencilFormat:m3,DepthTexture:h3,DirectionalLight:Qa,DirectionalLightHelper:f3,DiscreteInterpolant:g3,DisplayP3ColorSpace:x3,DodecahedronBufferGeometry:w3,DodecahedronGeometry:F3,DoubleSide:Hh,DstAlphaFactor:A3,DstColorFactor:v3,DynamicCopyUsage:S3,DynamicDrawUsage:Nh,DynamicReadUsage:b3,EdgesGeometry:_3,EllipseCurve:T3,EqualDepth:E3,EqualStencilFunc:y3,EquirectangularReflectionMapping:M3,EquirectangularRefractionMapping:k3,Euler:Gh,EventDispatcher:C3,ExtrudeBufferGeometry:D3,ExtrudeGeometry:L3,FileLoader:wc,Float16BufferAttribute:B3,Float32BufferAttribute:Ka,Float64BufferAttribute:P3,FloatType:R3,Fog:I3,FogExp2:V3,FramebufferTexture:O3,FrontSide:Bi,Frustum:W3,GLBufferAttribute:H3,GLSL1:N3,GLSL3:G3,GreaterDepth:U3,GreaterEqualDepth:z3,GreaterEqualStencilFunc:X3,GreaterStencilFunc:j3,GridHelper:Uh,Group:Ja,HalfFloatType:q3,HemisphereLight:Q3,HemisphereLightHelper:K3,HemisphereLightProbe:J3,IcosahedronBufferGeometry:Y3,IcosahedronGeometry:Z3,ImageBitmapLoader:zh,ImageLoader:$3,ImageUtils:eC,IncrementStencilOp:tC,IncrementWrapStencilOp:nC,InstancedBufferAttribute:e0,InstancedBufferGeometry:Xh,InstancedInterleavedBuffer:Pi,InstancedMesh:Ya,Int16BufferAttribute:rC,Int32BufferAttribute:oC,Int8BufferAttribute:iC,IntType:sC,InterleavedBuffer:Fc,InterleavedBufferAttribute:Ht,Interpolant:jh,InterpolateDiscrete:qh,InterpolateLinear:Ac,InterpolateSmooth:aC,InvertStencilOp:lC,KeepStencilOp:uC,KeyframeTrack:cC,LOD:pC,LatheBufferGeometry:dC,LatheGeometry:mC,Layers:hC,LessDepth:fC,LessEqualDepth:gC,LessEqualStencilFunc:xC,LessStencilFunc:wC,Light:FC,LightProbe:AC,Line:Qh,Line3:Kh,LineBasicMaterial:vc,LineCurve:vC,LineCurve3:SC,LineDashedMaterial:bC,LineLoop:Jh,LineSegments:Yh,LinearEncoding:Zh,LinearFilter:Sc,LinearInterpolant:_C,LinearMipMapLinearFilter:TC,LinearMipMapNearestFilter:EC,LinearMipmapLinearFilter:bc,LinearMipmapNearestFilter:$h,LinearSRGBColorSpace:yC,LinearToneMapping:MC,Loader:ef,LoaderUtils:Za,LoadingManager:kC,LoopOnce:CC,LoopPingPong:DC,LoopRepeat:LC,LuminanceAlphaFormat:BC,LuminanceFormat:PC,MOUSE:RC,Material:$a,MaterialLoader:IC,MathUtils:el,Matrix3:VC,Matrix4:xe,MaxEquation:OC,Mesh:Nt,MeshBasicMaterial:ot,MeshDepthMaterial:WC,MeshDistanceMaterial:HC,MeshLambertMaterial:NC,MeshMatcapMaterial:GC,MeshNormalMaterial:UC,MeshPhongMaterial:ko,MeshPhysicalMaterial:Kn,MeshStandardMaterial:_c,MeshToonMaterial:zC,MinEquation:XC,MirroredRepeatWrapping:tf,MixOperation:jC,MultiplyBlending:qC,MultiplyOperation:QC,NearestFilter:nf,NearestMipMapLinearFilter:KC,NearestMipMapNearestFilter:JC,NearestMipmapLinearFilter:rf,NearestMipmapNearestFilter:of,NeverDepth:YC,NeverStencilFunc:ZC,NoBlending:$C,NoColorSpace:eD,NoToneMapping:tD,NormalAnimationBlendMode:nD,NormalBlending:rD,NotEqualDepth:oD,NotEqualStencilFunc:iD,NumberKeyframeTrack:sf,Object3D:Ee,ObjectLoader:sD,ObjectSpaceNormalMap:aD,OctahedronBufferGeometry:lD,OctahedronGeometry:uD,OneFactor:cD,OneMinusDstAlphaFactor:pD,OneMinusDstColorFactor:dD,OneMinusSrcAlphaFactor:mD,OneMinusSrcColorFactor:hD,OrthographicCamera:af,PCFShadowMap:fD,PCFSoftShadowMap:gD,PMREMGenerator:xD,Path:wD,PerspectiveCamera:Ri,Plane:FD,PlaneBufferGeometry:AD,PlaneGeometry:tl,PlaneHelper:vD,PointLight:lf,PointLightHelper:SD,Points:uf,PointsMaterial:cf,PolarGridHelper:bD,PolyhedronBufferGeometry:_D,PolyhedronGeometry:TD,PositionalAudio:ED,PropertyBinding:pf,PropertyMixer:yD,QuadraticBezierCurve:MD,QuadraticBezierCurve3:kD,Quaternion:ce,QuaternionKeyframeTrack:Tc,QuaternionLinearInterpolant:CD,RED_GREEN_RGTC2_Format:DD,RED_RGTC1_Format:LD,REVISION:BD,RGBADepthPacking:PD,RGBAFormat:RD,RGBAIntegerFormat:ID,RGBA_ASTC_10x10_Format:VD,RGBA_ASTC_10x5_Format:OD,RGBA_ASTC_10x6_Format:WD,RGBA_ASTC_10x8_Format:HD,RGBA_ASTC_12x10_Format:ND,RGBA_ASTC_12x12_Format:GD,RGBA_ASTC_4x4_Format:UD,RGBA_ASTC_5x4_Format:zD,RGBA_ASTC_5x5_Format:XD,RGBA_ASTC_6x5_Format:jD,RGBA_ASTC_6x6_Format:qD,RGBA_ASTC_8x5_Format:QD,RGBA_ASTC_8x6_Format:KD,RGBA_ASTC_8x8_Format:JD,RGBA_BPTC_Format:YD,RGBA_ETC2_EAC_Format:ZD,RGBA_PVRTC_2BPPV1_Format:$D,RGBA_PVRTC_4BPPV1_Format:e4,RGBA_S3TC_DXT1_Format:t4,RGBA_S3TC_DXT3_Format:n4,RGBA_S3TC_DXT5_Format:r4,RGB_ETC1_Format:o4,RGB_ETC2_Format:i4,RGB_PVRTC_2BPPV1_Format:s4,RGB_PVRTC_4BPPV1_Format:a4,RGB_S3TC_DXT1_Format:l4,RGFormat:u4,RGIntegerFormat:c4,RawShaderMaterial:p4,Ray:d4,Raycaster:df,RectAreaLight:m4,RedFormat:h4,RedIntegerFormat:f4,ReinhardToneMapping:g4,RepeatWrapping:nl,ReplaceStencilOp:x4,ReverseSubtractEquation:w4,RingBufferGeometry:F4,RingGeometry:A4,SIGNED_RED_GREEN_RGTC2_Format:v4,SIGNED_RED_RGTC1_Format:S4,SRGBColorSpace:Co,Scene:rl,ShaderChunk:b4,ShaderLib:Ii,ShaderMaterial:mf,ShadowMaterial:_4,Shape:T4,ShapeBufferGeometry:E4,ShapeGeometry:y4,ShapePath:M4,ShapeUtils:k4,ShortType:C4,Skeleton:hf,SkeletonHelper:D4,SkinnedMesh:ff,Source:L4,Sphere:Do,SphereBufferGeometry:B4,SphereGeometry:ol,Spherical:P4,SphericalHarmonics3:R4,SplineCurve:I4,SpotLight:gf,SpotLightHelper:V4,Sprite:O4,SpriteMaterial:t0,SrcAlphaFactor:W4,SrcAlphaSaturateFactor:H4,SrcColorFactor:N4,StaticCopyUsage:G4,StaticDrawUsage:U4,StaticReadUsage:z4,StereoCamera:X4,StreamCopyUsage:j4,StreamDrawUsage:q4,StreamReadUsage:Q4,StringKeyframeTrack:K4,SubtractEquation:J4,SubtractiveBlending:Y4,TOUCH:Z4,TangentSpaceNormalMap:$4,TetrahedronBufferGeometry:eL,TetrahedronGeometry:tL,Texture:Vi,TextureLoader:xf,TorusBufferGeometry:nL,TorusGeometry:rL,TorusKnotBufferGeometry:oL,TorusKnotGeometry:iL,Triangle:sL,TriangleFanDrawMode:Oi,TriangleStripDrawMode:il,TrianglesDrawMode:wf,TubeBufferGeometry:aL,TubeGeometry:lL,TwoPassDoubleSide:uL,UVMapping:cL,Uint16BufferAttribute:pL,Uint32BufferAttribute:dL,Uint8BufferAttribute:mL,Uint8ClampedBufferAttribute:hL,Uniform:fL,UniformsGroup:gL,UniformsLib:Wi,UniformsUtils:Ec,UnsignedByteType:xL,UnsignedInt248Type:wL,UnsignedIntType:FL,UnsignedShort4444Type:AL,UnsignedShort5551Type:vL,UnsignedShortType:SL,VSMShadowMap:bL,Vector2:He,Vector3:I,Vector4:rn,VectorKeyframeTrack:Ff,VideoTexture:Af,WebGL1Renderer:_L,WebGL3DRenderTarget:TL,WebGLArrayRenderTarget:EL,WebGLCubeRenderTarget:vf,WebGLMultipleRenderTargets:yL,WebGLRenderTarget:ML,WebGLRenderer:Sf,WebGLUtils:kL,WireframeGeometry:bf,WrapAroundEnding:CL,ZeroCurvatureEnding:DL,ZeroFactor:LL,ZeroSlopeEnding:BL,ZeroStencilOp:PL,_SRGBAFormat:RL,sRGBEncoding:_f}=THREE;function xt(n){return w(n)&&n.isMesh}function yc(n){return w(n)&&n.isMaterial}function sl(n,t){return yc(t)&&t.type===n}function Tf(n){return sl("MeshBasicMaterial",n)}function Hi(n){return sl("MeshStandardMaterial",n)}function Ni(n){return sl("MeshPhongMaterial",n)}function Gi(n){return sl("MeshPhysicalMaterial",n)}function Mc(n){return w(n)&&n.isObject3D}function Ef(n){return w(n)&&n.isQuaternion}function yf(n){return w(n)&&n.isEuler}function kc(n){return w(n)&&Mc(n.object)}function Mf(n){return kc(n)||Mc(n)}function it(n){return kc(n)?n.object:n}function Pe(n,t){return n=it(n),n.visible=t,t}function Lo(n){return n=it(n),n.visible}function al(n){if(!n)return!1;for(n=it(n);n;){if(!n.visible)return!1;n=n.parent}return!0}function U(n,...t){let e=t.filter(w).map(it);return e.length>0&&it(n).add(...e),n}function ie(n,...t){let e=new Ee;return e.name=n,U(e,...t),e}function ll(n,t){n=it(n),fi(n)&&(n.disabled=!t)}function ul(n,t,e){let r=new Nt(t,e);return r.name=n,r}var Ui=(o=>(o.None="None",o.Fullscreen="Fullscreen",o.VR="VR",o.AR="AR",o))(Ui||{});var cl=class{constructor(t){Qn("Juniper.ThreeJS.ScreenUI.ButtonFillColor",()=>am(Pd("#appContainer > .row > .cell > .btn",Id(t)))),this.elements=[this.topLeft=fe(Ue("cell","top","left")),this.topCenter=fe(Ue("cell","top","center")),this.topRight=fe(Ue("cell","top","right")),this.middleLeft=fe(Ue("cell","middle","left")),this.middleCenter=fe(Ue("cell","middle","center")),this.middleRight=fe(Ue("cell","middle","right")),this.bottomLeft=fe(Ue("cell","bottom","left")),this.bottomCenter=fe(Ue("cell","bottom","center")),this.bottomRight=fe(Ue("cell","bottom","right"))],this.cells=[[this.topLeft,this.topCenter,this.topRight],[this.middleLeft,this.middleCenter,this.middleRight],[this.bottomLeft,this.bottomCenter,this.bottomRight]],this.hide()}show(){this.elements.forEach(t=>t.style.removeProperty("display"))}hide(){this.elements.forEach(t=>t.style.display="none")}};function kf(n){return"height"in n}function Cf(n){return"width"in n}var n0=1.25,r0=$e(30),o0=$e(32),pl=class extends Ee{constructor(){super(),this.name="SpaceUI",this.position.y=-.25}addItem(t,e){t=it(t),U(this,t),t.rotation.set(e.y*o0,-e.x*r0,0,"YXZ"),t.position.set(0,0,-n0).applyEuler(t.rotation),kf(e)&&Cf(e)?t.scale.set(e.width,e.height,1):kf(e)?t.scale.multiplyScalar(e.height/t.scale.y):Cf(e)?t.scale.multiplyScalar(e.width/t.scale.x):t.scale.setScalar(e.scale),t.scale.z=1}};var Jn=class{constructor(t){this.items=new Map;if(w(t))for(let[e,r,o]of t)this.add(e,r,o)}add(t,e,r){let o=this.items.get(t);return L(o)&&this.items.set(t,o=new Map),o.set(e,r),this}*entries(){for(let[t,e]of this.items)for(let[r,o]of e)yield[t,r,o]}keys(t){return L(t)?this.items.keys():this.items.get(t).keys()}*values(){for(let t of this.items.values())for(let e of t.values())yield e}has(t,e){return this.items.has(t)&&(L(e)||this.items.get(t).has(e))}get(t,e){return L(e)?this.items.get(t):this.items.has(t)?this.items.get(t).get(e):null}count(t){return this.items.has(t)?this.items.get(t).size:null}get size(){let t=0;for(let e of this.items.values())t+=e.size;return t}delete(t,e){if(L(e))return this.items.delete(t);if(this.items.has(t)){let r=this.items.get(t),o=r.delete(e);return r.size===0&&this.items.delete(t),o}else return!1}clear(){this.items.clear()}};var Er=class{constructor(t){this.items=new Map;this.defaultItems=new Array;if(w(t))for(let[e,r]of t)this.add(e,r)}add(t,...e){for(let r of e)if(L(t))this.defaultItems.push(r);else{let o=this.items.get(t);L(o)&&this.items.set(t,o=[]),o.push(r)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let t of this.defaultItems)yield t;for(let t of this.items.values())for(let e of t)yield e}has(t){return w(t)?this.items.has(t):this.defaultItems.length>0}get(t){return L(t)?this.defaultItems:this.items.get(t)||[]}count(t){if(L(t))return this.defaultItems.length;let e=this.get(t);return w(e)?e.length:0}get size(){let t=this.defaultItems.length;for(let e of this.items.values())t+=e.length;return t}delete(t){return L(t)?ue(this.defaultItems).length>0:this.items.delete(t)}remove(t,e){if(L(t))Ce(this.defaultItems,e);else{let r=this.items.get(t);w(r)&&(Ce(r,e),r.length===0&&this.items.delete(t))}}clear(){this.items.clear(),ue(this.defaultItems)}};var zi=class extends vr{constructor(e,r){super();this.i=e;this.prog=r}report(e,r,o,i){super.report(e,r,o,i),this.prog.update(this.i,e,r,o)}};var Bo=class{constructor(t){this.prog=t;this.weightTotal=0;this.subProgressCallbacks=new Array;this.subProgressWeights=new Array;this.subProgressValues=new Array;this.start=performance.now();for(let e=0;e<this.subProgressWeights.length;++e)this.subProgressValues[e]=0,this.subProgressCallbacks[e]=new zi(e,this)}addSubProgress(t){t=t||1,this.weightTotal+=t,this.subProgressWeights.push(t),this.subProgressValues.push(0);let e=new zi(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(e),e}update(t,e,r,o){if(this.prog){this.subProgressValues[t]=e/r;let i=0;for(let p=0;p<this.subProgressWeights.length;++p)i+=this.subProgressValues[p]*this.subProgressWeights[p];let s=performance.now(),a=s-this.start,l=this.start-s+a*this.weightTotal/i;this.prog.report(i,this.weightTotal,o,l)}}};function dl(n,t){return new Cc(t,n).subProgressCallbacks}var Cc=class extends Bo{constructor(t,e){super(e);for(let r of t)this.addSubProgress(r)}};async function i0(n,t){let e=new Array(t.length),r=new Array(t.length);for(let s=0;s<t.length;++s){let a=t[s];e[s]=a[0],r[s]=a[1]}let o=dl(n,e),i=new Array(t.length);for(let s=0;s<t.length;++s)i[s]=r[s](o[s]);return await Promise.all(i)}function Df(n,...t){let e=t.map(r=>[1,r]);return i0(n,e)}function Lf(n){return de(n.vcodec)}var yr=class extends en{constructor(e,r,o){let i=yr.createMediaElement(wi,Pt(!0)),s=yr.createMediaElement(Kt,Pt(!1)),a=new It(r,{mediaElement:i});a.name=`${e}-video`;let l=new It(r,{mediaElement:s});l.name=`${e}-audio`;super(e,r,o,[],[a,l]);this.onTimeUpdate=null;this.wasUsingAudioElement=!1;this.nextStartTime=null;this._data=null;this._loaded=!1;this.onError=new Map;this.sourcesByURL=new Map;this.sources=new Er;this.potatoes=new Er;a.connect(this.volumeControl),l.connect(this.volumeControl),this.video=i,this.audio=s,this.loadingEvt=new _o(this),this.loadEvt=new Vn(this),this.playEvt=new On(this),this.pauseEvt=new Wn(this),this.stopEvt=new Hn(this),this.progEvt=new Nn(this),this.onSeeked=()=>{this.useAudioElement&&(this.audio.currentTime=this.video.currentTime)},this.onPlay=async()=>{this.onSeeked(),this.useAudioElement&&(await this.context.ready,await this.audio.play()),this.dispatchEvent(this.playEvt)},this.onPause=m=>{this.useAudioElement&&(this.onSeeked(),this.audio.pause()),this.video.currentTime===0||m.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};let p=!1;this.onWaiting=()=>{this.useAudioElement&&(p=!0,this.audio.pause())},this.onCanPlay=async()=>{this.useAudioElement&&p&&(await this.context.ready,await this.audio.play(),p=!1)},this.wasUsingAudioElement=!1,this.onTimeUpdate=async()=>{if(this.video.getVideoPlaybackQuality().totalVideoFrames===0){let g=this.onError.get(this.video);w(g)&&await g()}else if(this.useAudioElement){this.wasUsingAudioElement=!1;let g=this.video.currentTime-this.audio.currentTime;Math.abs(g)>.25&&(this.audio.currentTime=this.video.currentTime)}else this.wasUsingAudioElement||(this.wasUsingAudioElement=!0,this.audio.pause());this.progEvt.value=this.video.currentTime,this.progEvt.total=this.video.duration,this.dispatchEvent(this.progEvt)},this.video.addEventListener("seeked",this.onSeeked),this.video.addEventListener("play",this.onPlay),this.video.addEventListener("pause",this.onPause),this.video.addEventListener("ended",this.onPause),this.video.addEventListener("waiting",this.onWaiting),this.video.addEventListener("canplay",this.onCanPlay),this.video.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{videoPlayer:this})}get data(){return this._data}get loaded(){return this._loaded}get title(){return this.video.title}setTitle(e){this.video.title=e,this.audio.title=e}elementHasAudio(e){let r=this.sourcesByURL.get(e.src);return w(r)&&r.acodec!=="none"||w(e.audioTracks)&&e.audioTracks.length>0||w(e.webkitAudioDecodedByteCount)&&e.webkitAudioDecodedByteCount>0||w(e.mozHasAudio)&&e.mozHasAudio}get useAudioElement(){return!this.elementHasAudio(this.video)&&this.elementHasAudio(this.audio)}onDisposing(){this.clear(),this.video.removeEventListener("seeked",this.onSeeked),this.video.removeEventListener("play",this.onPlay),this.video.removeEventListener("pause",this.onPause),this.video.removeEventListener("ended",this.onPause),this.video.removeEventListener("waiting",this.onWaiting),this.video.removeEventListener("canplay",this.onCanPlay),this.video.removeEventListener("timeupdate",this.onTimeUpdate),super.onDisposing(),this.audio.dispatchEvent(Ao),this.video.dispatchEvent(Ao)}clear(){this.stop();for(let[e,r]of this.onError)e.removeEventListener("error",r);this.onError.clear(),this.sourcesByURL.clear(),this.sources.clear(),this.potatoes.clear(),this.video.src="",this.audio.src="",this.wasUsingAudioElement=!1,this._data=null,this._loaded=!1}async load(e,r){if(this.clear(),this._data=e,de(e)?(this.setTitle(e),this.potatoes.add(this.video,e)):(this.setTitle(e.title),this.fillSources(this.video,e.videos),this.fillSources(this.audio,e.audios)),!this.hasSources(this.video))throw new Error("No video sources found");if(this.dispatchEvent(this.loadingEvt),await Df(r,o=>this.loadMediaElement(this.audio,o),o=>this.loadMediaElement(this.video,o)),de(e)?this.nextStartTime=null:this.nextStartTime=e.startTime,!this.hasSources(this.video))throw new Error("No video playable sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}fillSources(e,r){xr(r,o=>-o.resolution);for(let o of r)hh.matches(o.contentType)||(this.sources.add(e,o),this.sourcesByURL.set(o.url,o))}static createMediaElement(e,...r){return e(mn(!1),Pn(!1),...r)}async getMediaCapabilities(e){let r={type:"file"};Lf(e)?r.video={contentType:e.contentType,bitrate:e.vbr*1024,framerate:e.fps,width:e.width,height:e.height}:e.acodec!=="none"&&(r.audio={contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr});try{return await navigator.mediaCapabilities.decodingInfo(r)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:r}}}hasSources(e){return this.sources.get(e).length>0||this.potatoes.count(e)>0}async loadMediaElement(e,r){for(w(r)&&r.start(),this.onError.has(e)&&(e.removeEventListener("error",this.onError.get(e)),this.onError.delete(e));this.hasSources(e);){let o=null,i=this.sources.get(e).shift();if(w(i)){let s=await this.getMediaCapabilities(i);if(!s.smooth||!s.powerEfficient){this.potatoes.add(e,i.url);continue}else o=i.url}else o=this.potatoes.get(e).shift();if(e.src=o,e.load(),await Us(e)){w(i)?this.sources.get(e).unshift(i):this.potatoes.get(e).unshift(o);let s=()=>this.loadMediaElement(e,r);e.addEventListener("error",s),this.onError.set(e,s),this.wasUsingAudioElement=this.wasUsingAudioElement,w(r)&&r.end();return}}}get width(){return this.video.videoWidth}get height(){return this.video.videoHeight}get playbackState(){return L(this.data)?"empty":this.loaded?this.video.error?"errored":this.video.ended||this.video.paused&&this.video.currentTime===0?"stopped":this.video.paused?"paused":"playing":"loading"}async play(){await this.context.ready,w(this.nextStartTime)&&this.nextStartTime>0&&(this.video.pause(),this.video.currentTime=this.nextStartTime,this.nextStartTime=null),await this.video.play()}async playThrough(){let e=hn(this,"stopped");await this.play(),await e}pause(){this.video.pause()}stop(){this.pause(),this.video.currentTime=0}restart(){return this.stop(),this.play()}};function Bf(n,t){let e=n*Te;return .5*(1-Math.cos(e))-t*Math.sin(2*e)}function Pf(n,t){let e=(n-.5)*Te;return n*n+t*Math.cos(e)}var Mr=Qn("Juniper:ScaledItems",()=>new Map),Rf=1,s0=1.1,a0=.005,Dc=class{constructor(t){this.target=t;this.obj=it(this.target),this.base=this.obj.scale.clone(),this.p=0,this.dir=0,this.running=!1,this.wasDisabled=this.disabled,this.target.addScopedEventListener(this,"enter",e=>{e.pointer.type!=="nose"&&this.run(1)}),this.target.addScopedEventListener(this,"exit",e=>{e.pointer.type!=="nose"&&this.run(-1)}),this.obj.traverse(e=>{xt(e)&&this.target.addMesh(e)})}get disabled(){return this.target.disabled}run(t){(!this.disabled||t===-1||this.p>0)&&(this.dir=t,this.running=!0)}updateScaling(t){if(this.disabled!==this.wasDisabled&&(this.wasDisabled=this.disabled,this.disabled&&this.run(-1)),this.running){this.p+=this.dir*t,(this.dir>0&&this.p>=1||this.dir<0&&this.p<0)&&(this.p=Math.max(0,Math.min(1,this.p)),this.running=!1);let e=Bf(this.p,1.1);this.obj.scale.copy(this.base).multiplyScalar(e*(s0-Rf)+Rf)}}dispose(){this.target.removeScope(this)}};function If(n){n*=a0;for(let t of Mr.values())t.updateScaling(n)}function Vf(n){let t=Mr.get(n);t&&(Mr.delete(n),Le(t))}function ml(n,t){let e=Mr.has(n);if(t!=e)if(t)Mr.set(n,new Dc(n));else{let r=Mr.get(n);Le(r),Mr.delete(n)}}function ye(n){let t=new Array,e=new Set;for(t.push(n);t.length>0;){let r=t.shift();r&&!e.has(r)&&(e.add(r),r.isMesh&&t.push(r.material,r.geometry),r.isMaterial&&t.push(...Object.values(r)),r.isObject3D&&(t.push(...r.children),r.clear(),Vf(r)),jt(r)&&t.push(...r),Un(r))}e.clear()}function l0(n){return[Wf([n[1],n[0],n[2]]),Wf([n[2],n[0],n[3]])]}function Nf(n){return n.map(l0).flat()}var Lc=new I,Of=new I,hl=new I;function Wf(n){let t=[[n[0][0],n[0][1],n[0][2]],[n[1][0],n[1][1],n[1][2]],[n[2][0],n[2][1],n[2][2]]],e=[[n[0][3],n[0][4]],[n[1][3],n[1][4]],[n[2][3],n[2][4]]];hl.fromArray(t[0]),Lc.fromArray(t[1]).sub(hl),hl.fromArray(t[2]),Of.fromArray(t[1]).sub(hl),Lc.cross(Of);let r=Lc.toArray();return{positions:t,uvs:e,normal:r}}function Gf(n){let t=n.map(i=>i.positions).flat(2),e=n.map(i=>i.uvs).flat(2),r=n.flatMap(i=>i.normal),o=new Li;return o.setAttribute("position",new An(new Float32Array(t),3,!1)),o.setAttribute("uv",new An(new Float32Array(e),2,!1)),o.setAttribute("normal",new An(new Float32Array(r),3,!0)),o}function Gt(...n){let t=Nf(n);return Gf(t)}function Po(n,...t){let e=u0(t);for(let o=0;o<n;++o)e=p0(e);t=c0(e);let r=Nf(t);return Gf(r)}function u0(n){return n.map(t=>{let e=Number.MAX_VALUE,r=Number.MIN_VALUE,o=Number.MAX_VALUE,i=Number.MIN_VALUE;for(let l of t){let p=l[3],m=l[4];e=Math.min(e,p),r=Math.max(r,p),o=Math.min(o,m),i=Math.max(i,m)}let s=[e,o],a=[r-e,i-o];return{minUV:s,deltaUV:a,verts:[fl(s,a,t[0]),fl(s,a,t[1]),fl(s,a,t[2]),fl(s,a,t[3])]}})}function fl(n,t,e){return{pos:[e[0],e[1],e[2]],uv:[e[3],e[4]],pUV:[(e[3]-n[0])/t[0],(e[4]-n[1])/t[1]]}}function c0(n){return n.map(t=>[gl(t,0),gl(t,1),gl(t,2),gl(t,3)])}function gl(n,t){let e=n.verts[t];return[e.pos[0],e.pos[1],e.pos[2],e.uv[0],e.uv[1]]}function p0(n){return n.flatMap(t=>{let e=Xi(t,t.verts[0],t.verts[1]),r=Xi(t,t.verts[2],t.verts[3]),o=Xi(t,t.verts[0],t.verts[3]),i=Xi(t,t.verts[1],t.verts[2]),s=Xi(t,e,r);return[{minUV:t.minUV,deltaUV:t.deltaUV,verts:[t.verts[0],e,s,o]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[e,t.verts[1],i,s]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[s,i,t.verts[2],r]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[o,s,r,t.verts[3]]}]})}function Xi(n,t,e){let r=e.pos[0]-t.pos[0],o=e.pos[1]-t.pos[1],i=e.pos[2]-t.pos[2],s=t.pos[0]+.5*r,a=t.pos[1]+.5*o,l=t.pos[2]+.5*i,p=e.pUV[0]-t.pUV[0],m=e.pUV[1]-t.pUV[1],g=t.pUV[0]+.5*p,F=t.pUV[1]+.5*m,S=Hf(g-.5)+.5,M=Hf(F-.5)+.5,k=S*n.deltaUV[0]+n.minUV[0],E=M*n.deltaUV[1]+n.minUV[1];return{pos:[s,a,l],pUV:[g,F],uv:[k,E]}}function Hf(n){return Math.atan(2*n)/ct}Wi.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new He(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};Ii.line={uniforms:Ec.merge([Wi.common,Wi.fog,Wi.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var vn=class extends mf{constructor(t){super({type:"LineMaterial",uniforms:Ec.clone(Ii.line.uniforms),vertexShader:Ii.line.vertexShader,fragmentShader:Ii.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(e){!!e!="USE_DASH"in this.defines&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(e){!!e!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(t)}};vn.prototype.isLineMaterial=!0;var Bc=Qn("Juniper:Three:Materials",()=>new Map);function d0(n,t){t in n&&delete n[t]}function xl(n,t,e){let r=`${n}_${Object.keys(e).map(o=>`${o}:${e[o]}`).join(",")}`;return Bc.has(r)||(d0(e,"name"),Bc.set(r,new t(e))),Bc.get(r)}function m0(n){return Object.assign(n,{transparent:!0})}function Uf(n){return xl("solid",ot,n)}function Ro(n){return xl("solidTransparent",ot,m0(n))}function Pc(n){return xl("lit",ko,n)}function zf(n){return xl("line2",vn,n)}function ji(n,t){let e=new Set;n.traverse(r=>{if(xt(r)&&yc(r.material)){let o=r.material,i=t(o);o!==i&&(e.add(o),r.material=i)}});for(let r of e)Un(r)}function Xf(n){if(n.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let t={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,dithering:n.dithering,envMap:n.envMap,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.emissiveMap||n.map,name:n.name+"-Standard-To-Basic",opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,shadowSide:n.shadowSide,side:n.side,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[e,r]of Object.entries(t))L(r)&&delete t[e];return new ot(t)}function qi(n){if(n.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let t={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,bumpMap:n.bumpMap,bumpScale:n.bumpScale,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,displacementBias:n.displacementBias,displacementMap:n.displacementMap,displacementScale:n.displacementScale,dithering:n.dithering,emissive:n.emissive,emissiveIntensity:n.emissiveIntensity,emissiveMap:n.emissiveMap,envMap:n.envMap,flatShading:n.flatShading,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.map,name:n.name+"-Standard-To-Phong",normalMap:n.normalMap,normalMapType:n.normalMapType,normalScale:n.normalScale,opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,shadowSide:n.shadowSide,side:n.side,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[e,r]of Object.entries(t))L(r)&&delete t[e];return new ko(t)}function jf(n){if(n.type!=="MeshPhysicalMaterial")throw new Error("Input material is not MeshPhysicalMaterial");let t={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,bumpMap:n.bumpMap,bumpScale:n.bumpScale,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,displacementBias:n.displacementBias,displacementMap:n.displacementMap,displacementScale:n.displacementScale,dithering:n.dithering,emissive:n.emissive,emissiveIntensity:n.emissiveIntensity,emissiveMap:n.emissiveMap,envMap:n.envMap,flatShading:n.flatShading,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.map,name:n.name+"-Standard-To-Phong",normalMap:n.normalMap,normalMapType:n.normalMapType,normalScale:n.normalScale,opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,reflectivity:n.reflectivity,shadowSide:n.shadowSide,shininess:n.sheen,side:n.side,specular:n.specularColor,specularMap:n.specularColorMap,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[e,r]of Object.entries(t))L(r)&&delete t[e];return new ko(t)}var h0=12632256,Rc=16777215;var Ic=Pc({color:h0}),qf=Pc({color:Rc});var Qf=304.79999999999995,TP=Qf*3,f0=10*100,g0=Qf*16.5,x0=g0*40,EP=f0*1e3,yP=x0*8,Kf=2.54*4,Jf=Kf*3,MP=Jf*3,w0=Jf*16.5,F0=w0*40,kP=100*1e3,CP=F0*8,Vc=4*3,A0=Vc*3,Qi=100/2.54,v0=Vc*16.5,S0=v0*40,DP=Qi*1e3,LP=S0*8,BP=3*3,b0=100/Kf,_0=3*16.5,T0=_0*40,PP=b0*1e3,RP=T0*8,Oc=Qi/Vc,E0=16.5*40,IP=Oc*1e3,VP=E0*8,y0=Qi/A0,M0=16.5/3,k0=M0*40,OP=y0*1e3,WP=k0*8,Yf=16.5/Oc,Zf=Yf*40,HP=Zf*8,NP=1e3/Yf,GP=40*8,C0=1e3/Zf,UP=8/C0;function $f(n){return n/Oc}function eg(n){return n/Qi}function tg(n){return n*Qi}var D0=new xe,wl=new I,ng=new rn,rg=new ce;function Wc(n,t,e){return D0.copy(n.matrixWorld).invert().multiply(t.matrixWorld).decompose(wl,rg,e),ng.set(wl.x,wl.y,wl.z,1),new XRRigidTransform(ng,rg)}var Hc=new tl(1,1,1,1);Hc.name="PlaneGeom";var Io=new I,L0=0,kr=class extends Ee{constructor(e,r,o,i=null){super();this.webXRLayerType=o;this.lastMatrixWorld=new xe;this._imageWidth=0;this._imageHeight=0;this.forceUpdate=!1;this.wasUsingLayer=!1;this.layer=null;this.curImage=null;this.lastImage=null;this.lastWidth=null;this.lastHeight=null;this.env=null;this.mesh=null;this.stereoLayoutName="mono";this.sizeMode="none";if(e){this.setEnvAndName(e,r);let s=Tf(i)?i:Ro(Object.assign({},i,{name:this.name}));U(this,this.mesh=ul(r+"-Mesh",Hc,s))}}copy(e,r=!0){return super.copy(e,r),this.webXRLayerType=e.webXRLayerType,this.setImageSize(e.imageWidth,e.imageHeight),this.setEnvAndName(e.env,e.name+ ++L0),this.mesh=nt(this.children,xt),L(this.mesh)&&(this.mesh=e.mesh.clone(),U(this,this.mesh)),this.setTextureMap(e.curImage),this}dispose(){this.env.removeScope(this),this.disposeImage(),ye(this.mesh)}disposeImage(){this.removeWebXRLayer(),ye(this.mesh.material.map),this.curImage=null}setImageSize(e,r){if(e!==this.imageWidth||r!==this.imageHeight){let{objectWidth:o,objectHeight:i}=this;this._imageWidth=e,this._imageHeight=r,this.sizeMode!=="none"&&(this.sizeMode==="fixed-width"?this.objectWidth=o:this.objectHeight=i)}}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get imageAspectRatio(){return this.imageWidth/this.imageHeight}get objectWidth(){return this.scale.x}set objectWidth(e){this.scale.set(e,this.scale.y=e/this.imageAspectRatio,1)}get objectHeight(){return this.scale.y}set objectHeight(e){this.scale.set(this.imageAspectRatio*e,e,1)}get pixelDensity(){let e=tg(this.objectWidth);return this.imageWidth/e}set pixelDensity(e){let r=this.imageWidth/e,o=eg(r);this.objectWidth=o}setEnvAndName(e,r){this.env=e,this.name=r,this.env.addScopedEventListener(this,"update",o=>this.checkWebXRLayer(o.frame))}get needsLayer(){return!al(this)||L(this.mesh.material.map)||L(this.curImage)?!1:this.curImage instanceof HTMLVideoElement?!this.curImage.paused||this.curImage.currentTime>0:!0}removeWebXRLayer(){if(w(this.layer)){this.wasUsingLayer=!1,this.env.removeWebXRLayer(this.layer),this.mesh.visible=!0;let e=this.layer;this.layer=null,setTimeout(()=>Un(e),100)}}setTextureMap(e){this.curImage&&this.disposeImage(),e&&(gh(e)?e=Ah(e):xh(e)&&(e=vh(e)),uc(e)&&(e=e),this.curImage=e,e instanceof HTMLVideoElement?(this.setImageSize(e.videoWidth,e.videoHeight),this.mesh.material.map=new Af(e)):(this.setImageSize(e.width,e.height),this.mesh.material.map=new Vi(e),this.mesh.material.map.needsUpdate=!0)),this.mesh.material.needsUpdate=!0}get isVideo(){return this.curImage instanceof HTMLVideoElement}updateTexture(){if(w(this.curImage)){let e=this.curImage,r=this.isVideo?e.videoWidth:this.curImage.width,o=this.isVideo?e.videoHeight:this.curImage.height;if(this.imageWidth!==r||this.imageHeight!==o){let i=this.curImage;this.disposeImage(),this.setTextureMap(i)}else this.mesh.material.map.needsUpdate=this.forceUpdate=!0}}checkWebXRLayer(e){if(this.mesh.material.map&&this.curImage){let o=this.webXRLayerType!=="none"&&this.env.hasXRCompositionLayers&&this.env.showWebXRLayers&&w(e)&&(this.isVideo&&w(this.env.xrMediaBinding)||!this.isVideo&&w(this.env.xrBinding))&&this.needsLayer,i=o!==this.wasUsingLayer,s=this.curImage!==this.lastImage||this.mesh.material.needsUpdate||this.mesh.material.map.needsUpdate||this.forceUpdate,a=this.imageWidth!==this.lastWidth||this.imageHeight!==this.lastHeight;if(this.wasUsingLayer=o,this.lastImage=this.curImage,this.lastWidth=this.imageWidth,this.lastHeight=this.imageHeight,(i||a)&&((!o||a)&&this.layer&&this.removeWebXRLayer(),o)){let l=this.env.referenceSpace,p=Wc(this.env.stage,this.mesh,Io);this.lastMatrixWorld.copy(this.matrixWorld);let m=Io.x/2,g=Io.y/2,F=this.stereoLayoutName==="mono"?"mono":this.stereoLayoutName==="left-right"||this.stereoLayoutName==="right-left"?"stereo-left-right":"stereo-top-bottom";if(this.isVideo){let S=this.stereoLayoutName==="right-left"||this.stereoLayoutName==="bottom-top";this.layer=this.env.xrMediaBinding.createQuadLayer(this.curImage,{space:l,layout:F,invertStereo:S,transform:p,width:m,height:g})}else this.layer=this.env.xrBinding.createQuadLayer({space:l,layout:F,textureType:"texture",isStatic:this.webXRLayerType==="static",viewPixelWidth:this.curImage.width,viewPixelHeight:this.curImage.height,transform:p,width:m,height:g});this.env.addWebXRLayer(this.layer,500),this.mesh.visible=!1}if(this.layer){if(s||this.layer.needsRedraw){let l=this.env.gl,p=this.env.xrBinding.getSubImage(this.layer,e);l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!0),l.bindTexture(l.TEXTURE_2D,p.colorTexture),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.curImage),l.generateMipmap(l.TEXTURE_2D),l.bindTexture(l.TEXTURE_2D,null),this.forceUpdate=!1}Sd(this.matrixWorld.elements,this.lastMatrixWorld.elements)>=0&&(this.layer.transform=Wc(this.env.stage,this.mesh,Io),this.lastMatrixWorld.copy(this.matrixWorld),this.layer.width=Io.x/2,this.layer.height=Io.y/2)}else this.forceUpdate=!1}}};var Al=class extends yr{constructor(e,r,o){super("video-player-3d",r,o);this.material=Ro({name:"videoPlayer-material"}),this.vidMeshes=[];for(let i=0;i<2;++i){let s=new kr(e,`videoPlayer-view${i+1}`,"none",this.material);s.setTextureMap(this.video),s.mesh.renderOrder=4,i>0?s.mesh.layers.disable(0):s.mesh.layers.enable(0),this.vidMeshes.push(s)}this.object=ie("videoPlayer",...this.vidMeshes)}get meshes(){return this.vidMeshes.map(e=>e.mesh)}onDisposing(){super.onDisposing(),ye(this.object),ue(this.vidMeshes)}isSupported(e,r){return r.split("-").map(o=>og.has(e,o)).reduce(Td,!0)}setStereoParameters(e,r){if(!this.isSupported(e,r))throw new Error(`Not supported [encoding: ${e}, layout: ${r}]`);for(let s=0;s<this.vidMeshes.length;++s){let a=this.vidMeshes[s];a.webXRLayerType="none",a.mesh.layers.disable(1),a.mesh.layers.disable(2),r==="left-right"||r==="top-bottom"?a.mesh.layers.enable(this.vidMeshes.length-s):r!=="mono"&&a.mesh.layers.enable(s+1)}let o=this.height/this.width;e!=="N/A"?this.vidMeshes[0].scale.setScalar(100):r==="mono"?this.vidMeshes[0].scale.set(1,o,1):r==="left-right"||r==="right-left"?this.vidMeshes[0].scale.set(1,2*o,1):this.vidMeshes[0].scale.set(1,.5*o,1);for(let s=1;s<this.vidMeshes.length;++s)this.vidMeshes[s].scale.copy(this.vidMeshes[0].scale);let i=r.split("-");for(let s=0;s<i.length;++s){let a=i[s],l=og.get(e,a),p=this.vidMeshes[s];p.webXRLayerType="dynamic",p.visible=!0,p.mesh.geometry!==l&&(ye(p.mesh.geometry),p.mesh.geometry=l)}}},B0=Gt([[-1/2,1/2,0,0,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,0,0]]),ig=[[-1/2,1/2,0,0,1],[1/2,1/2,0,.5,1],[1/2,-1/2,0,.5,0],[-1/2,-1/2,0,0,0]],sg=[[-1/2,1/2,0,.5,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,.5,0]],ag=[[[-1/2,1/2,-1/2,1/3,1],[1/2,1/2,-1/2,2/3,1],[1/2,-1/2,-1/2,2/3,1/2],[-1/2,-1/2,-1/2,1/3,1/2]],[[1/2,1/2,-1/2,2/3,1],[1/2,1/2,1/2,1,1],[1/2,-1/2,1/2,1,1/2],[1/2,-1/2,-1/2,2/3,1/2]],[[-1/2,1/2,1/2,0,1],[-1/2,1/2,-1/2,1/3,1],[-1/2,-1/2,-1/2,1/3,1/2],[-1/2,-1/2,1/2,0,1/2]],[[1/2,1/2,1/2,2/3,1/2],[-1/2,1/2,1/2,2/3,0],[-1/2,-1/2,1/2,1/3,0],[1/2,-1/2,1/2,1/3,1/2]],[[1/2,1/2,-1/2,1,1/2],[-1/2,1/2,-1/2,1,0],[-1/2,1/2,1/2,2/3,0],[1/2,1/2,1/2,2/3,1/2]],[[1/2,-1/2,1/2,1/3,1/2],[-1/2,-1/2,1/2,1/3,0],[-1/2,-1/2,-1/2,0,0],[1/2,-1/2,-1/2,0,1/2]]],Nc=[[[-1/2,1/2,-1/2,0,1/3],[1/2,1/2,-1/2,0,2/3],[1/2,-1/2,-1/2,1/4,2/3],[-1/2,-1/2,-1/2,1/4,1/3]],[[1/2,1/2,-1/2,0,2/3],[1/2,1/2,1/2,0,1],[1/2,-1/2,1/2,1/4,1],[1/2,-1/2,-1/2,1/4,2/3]],[[-1/2,1/2,1/2,0,0],[-1/2,1/2,-1/2,0,1/3],[-1/2,-1/2,-1/2,1/4,1/3],[-1/2,-1/2,1/2,1/4,0]],[[1/2,1/2,1/2,1/4,2/3],[-1/2,1/2,1/2,1/2,2/3],[-1/2,-1/2,1/2,1/2,1/3],[1/2,-1/2,1/2,1/4,1/3]],[[1/2,1/2,-1/2,1/4,1],[-1/2,1/2,-1/2,1/2,1],[-1/2,1/2,1/2,1/2,2/3],[1/2,1/2,1/2,1/4,2/3]],[[1/2,-1/2,1/2,1/4,1/3],[-1/2,-1/2,1/2,1/2,1/3],[-1/2,-1/2,-1/2,1/2,0],[1/2,-1/2,-1/2,1/4,0]]],Gc=[[[-1/2,1/2,-1/2,1/2,1/3],[1/2,1/2,-1/2,1/2,2/3],[1/2,-1/2,-1/2,3/4,2/3],[-1/2,-1/2,-1/2,3/4,1/3]],[[1/2,1/2,-1/2,1/2,2/3],[1/2,1/2,1/2,1/2,1],[1/2,-1/2,1/2,3/4,1],[1/2,-1/2,-1/2,3/4,2/3]],[[-1/2,1/2,1/2,1/2,0],[-1/2,1/2,-1/2,1/2,1/3],[-1/2,-1/2,-1/2,3/4,1/3],[-1/2,-1/2,1/2,3/4,0]],[[1/2,1/2,1/2,3/4,2/3],[-1/2,1/2,1/2,1,2/3],[-1/2,-1/2,1/2,1,1/3],[1/2,-1/2,1/2,3/4,1/3]],[[1/2,1/2,-1/2,3/4,1],[-1/2,1/2,-1/2,1,1],[-1/2,1/2,1/2,1,2/3],[1/2,1/2,1/2,3/4,2/3]],[[1/2,-1/2,1/2,3/4,1/3],[-1/2,-1/2,1/2,1,1/3],[-1/2,-1/2,-1/2,1,0],[1/2,-1/2,-1/2,3/4,0]]],P0=Gt(ig),R0=Gt(sg),I0=Gt(Uc(ig)),V0=Gt(Uc(sg)),lg=cg(Nc),ug=cg(Gc),O0=Gt(...ag),W0=Gt(...Nc),H0=Gt(...Gc),N0=Gt(...lg),G0=Gt(...ug),Ki=4,U0=Po(Ki,...ag),z0=Po(Ki,...Nc),X0=Po(Ki,...Gc),j0=Po(Ki,...lg),q0=Po(Ki,...ug),og=new Jn([["N/A","mono",B0],["N/A","left",P0],["N/A","right",R0],["N/A","top",I0],["N/A","bottom",V0],["Cubemap Strips","mono",O0],["Cubemap Strips","left",W0],["Cubemap Strips","right",H0],["Cubemap Strips","top",N0],["Cubemap Strips","bottom",G0],["Equi-Angular Cubemap (YouTube)","mono",U0],["Equi-Angular Cubemap (YouTube)","left",z0],["Equi-Angular Cubemap (YouTube)","right",X0],["Equi-Angular Cubemap (YouTube)","top",j0],["Equi-Angular Cubemap (YouTube)","bottom",q0]]);function Fl(n){return[n[0],n[1],n[2],n[4],1-n[3]]}function Uc(n){return[Fl(n[0]),Fl(n[1]),Fl(n[2]),Fl(n[3])]}function cg(n){return n.map(Uc)}async function pg(n,t){let{status:e,requestPath:r,responsePath:o,content:i,contentType:s,contentLength:a,fileName:l,headers:p,date:m}=n;return{status:e,requestPath:r,responsePath:o,content:w(t)?await t(i):void 0,contentType:s,contentLength:a,fileName:l,headers:p,date:m}}var Cr=class extends Eo{constructor(e,r,o,i){if(!_r.matches(o)&&!mh.matches(o))throw new Error("Only GLTF model types are currently supported");super(r,o,i);this.env=e}async getResponse(e){let r=await e.file();return pg(r,o=>this.env.loadGltf(o))}};function dg(n,t){let e=[n];for(;e.length>0;){let r=e.shift();if(t(r))return r;r.children.length>0&&e.push(...r.children)}return null}var vl=class{constructor(t,e){this.disposed=!1;this.asset=new Cr(t,e,_r,!t.DEBUG),this.asset.then(()=>{this._model=dg(this.asset.result.scene,xt);let l=this._model.material.roughnessMap;ji(this._model,qi),this._model.material.specularMap=l,t.timer.addTickHandler(a)});function r(l){return l.enabled&&(l.grip.visible||l.hand.visible&&l.hand.joints.wrist&&l.hand.joints.wrist.visible)}let o=t.DEBUG,i=t.xrUI.visible,s=0,a=()=>{let l=t.xrUI.visible,p=0;for(let m of t.eventSys.hands)r(m)&&++p;if(l!==i||p!==s||o!==t.DEBUG){if(t.clockImage.isVisible=l||t.DEBUG,l&&p>0){let m=null;for(let F of t.eventSys.hands)r(F)&&(L(m)||F.handedness==="left")&&(m=F);let g=m.grip.visible?m.grip:m.hand.joints.wrist;if(g!==t.clockImage.object.parent){U(g,U(this,t.clockImage,t.batteryImage));let F=m.handedness==="left"?1:0;g===m.grip?(this.object.rotation.set(0,F*Te,-ct,"XYZ"),this.object.position.set(0,0,.07)):(this.object.rotation.set(0,F*Te,0,"XYZ"),this.object.position.set(0,0,0)),t.clockImage.scale.setScalar(.0175),t.clockImage.position.set(0,.029,0),t.clockImage.rotation.set(-ct,0,-ct),w(t.batteryImage)&&(t.batteryImage.scale.set(2,1,1).multiplyScalar(.008),t.batteryImage.position.set(.0075,.029,0),t.batteryImage.rotation.set(-ct,0,-ct))}}else t.xrUI.addItem(t.clockImage,{x:-1,y:1,height:.1}),w(t.batteryImage)&&t.xrUI.addItem(t.batteryImage,{x:.75,y:-1,width:.2,height:.1});i=l,s=p,o=t.DEBUG}}}get object(){return this._model}dispose(){this.disposed||(w(this.object)&&(this.object.removeFromParent(),ye(this.object),this._model=null),this.disposed=!0)}};var Sl="Juniper:ThreeJS:EventSystem:RayTarget",Dr=class extends te{constructor(e){super();this.object=e;this.meshes=new Array;this._disabled=!1;this._clickable=!1;this._draggable=!1;this._navigable=!1;this.object.userData[Sl]=this}addMesh(e){return e.userData[Sl]=this,this.meshes.push(e),this}removeMesh(e){return Ce(this.meshes,e)&&delete e.userData[Sl],this}addMeshes(...e){for(let r of e)this.addMesh(r);return this}removeMeshes(...e){for(let r of e)this.removeMesh(r);return this}get disabled(){return this._disabled}set disabled(e){this._disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get clickable(){return this._clickable}set clickable(e){this._clickable=e}get draggable(){return this._draggable}set draggable(e){this._draggable=e}get navigable(){return this._navigable}set navigable(e){this._navigable=e}};function Q0(n){return n instanceof Dr}function Ji(n){let t=null;return n&&(Q0(n)?t=n:(n=it(n),n&&(t=n.userData[Sl])),t&&!al(t)&&(t=null)),t}var bl=class extends Dr{constructor(e,r,o,i,s){e=e+Tt(16);super(ie(e));this.enabledMaterial=o;this.disabledMaterial=i;this.mesh=ul(`Mesh-${e}-enabled`,r,o),this.size=s,U(this,this.mesh),this.addMesh(this.mesh),this.clickable=!0,this.disabled=this.disabled,ml(this,!0)}get size(){return this.mesh.scale.x}set size(e){this.mesh.scale.setScalar(e)}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.mesh.material=e?this.disabledMaterial:this.enabledMaterial}};var _l=class{constructor(t,e,r,o,i){this.imagePaths=t;this.padding=e;this.buttonFillColor=r;this.labelFillColor=o;this.uvDescrips=new Jn;this.geoms=new Jn;this.canvas=null;this.texture=null;this.enabledMaterial=null;this.disabledMaterial=null;this.assetSets=new Jn(Array.from(this.imagePaths.entries()).map(([s,a,l])=>[s,a,new Pa(l,ph,!i)])),this.assets=Array.from(this.assetSets.values()),this.ready=Promise.all(this.assets).then(()=>{let s=this.assets.map(O=>O.result),a=Math.max(...s.map(O=>O.width)),l=Math.max(...s.map(O=>O.height)),p=a*l*s.length,m=Math.sqrt(p),g=Math.floor(m/a),F=Math.ceil(s.length/g),S=g*a,M=F*l,k=gc(S),E=gc(M),R=S/k,W=M/E,V=a/k,B=l/E;this.canvas=La(k,E);let G=this.canvas.getContext("2d",{alpha:!1});G.fillStyle=this.buttonFillColor,G.fillRect(0,0,k,E);let D=0;for(let[O,ne,ae]of this.assetSets.entries()){let j=ae.result,ee=D%g,we=(D-ee)/g,Fe=R*(ee*a/S),re=W*(1-we/F)-B,tt=ee*a,Dn=we*l+E-M,Ut=a-2*this.padding,Lt=l-2*this.padding;G.drawImage(j,0,0,j.width,j.height,tt+this.padding,Dn+this.padding,Ut,Lt),this.uvDescrips.add(O,ne,{u:Fe,v:re,du:V,dv:B}),++D}this.texture=new Rh(this.canvas),this.enabledMaterial=new ot({map:this.texture}),this.enabledMaterial.needsUpdate=!0,this.disabledMaterial=new ot({map:this.texture,transparent:!0,opacity:.5}),this.disabledMaterial.needsUpdate=!0})}getImageSrc(t,e){let r=this.imagePaths.get(t),o=r&&r.get(e);if(!o)throw new We(`Button ${t}/${e} does not exist`,this.uvDescrips);return o}async getMeshButton(t,e,r){await this.ready;let o=this.uvDescrips.get(t),i=o&&o.get(e);if(!o||!i)throw new We(`Button ${t}/${e} does not exist`,this.uvDescrips);let s=this.geoms.get(t,e);if(!s){s=new tl(1,1,1,1),s.name=`Geometry:${t}/${e}`,this.geoms.add(t,e,s);let l=s.getAttribute("uv");for(let p=0;p<l.count;++p){let m=l.getX(p)*i.du+i.u,g=l.getY(p)*i.dv+i.v;l.setX(p,m),l.setY(p,g)}}return new bl(e,s,this.enabledMaterial,this.disabledMaterial,r)}};function mg(n,t){n.element instanceof HTMLButtonElement&&(n.element.disabled=!t),ll(n,t)}function hg(n,...t){$(n,...t.filter(Kd)),U(n,...t.filter(Mf))}var Yn=class{constructor(t,e,r){this.element=t;this.object=e;this.displayType=r}get name(){return this.object.name}addEventListener(t,e,r){this.element.addEventListener(t,e,r)}dispatchEvent(t){return this.element.dispatchEvent(t)}removeEventListener(t,e,r){this.element.removeEventListener(t,e,r)}click(){this.element.click()}get visible(){return bt(this)}set visible(t){Xe(this,t,this.displayType),this.object.visible=t}};var Vo=class extends Yn{constructor(e,r,o){let i=Ws(`${r} ${o}`);super($r(i,xi(i,Yr(e.getImageSrc(r,o)))),ie(`${name}-button`),"inline-block");this.mesh=null;this.load(e,r,o)}async load(e,r,o){this.mesh=await e.getMeshButton(r,o,.2),this.mesh.disabled=this.disabled,U(this,this.mesh),this.mesh.object.visible=this.visible,this.mesh.addEventListener("click",()=>{this.element.click()})}get disabled(){return this.element.disabled}set disabled(e){this.element.disabled=e,this.mesh&&(this.mesh.disabled=e)}get visible(){return super.visible}set visible(e){super.visible=e,this.mesh&&Pe(this.mesh,e)}};var K0={type:"redrawn"},Zn=class extends kr{constructor(e,r,o,i,s){super(e,r,o,s);this._image=null;this.image=i}get object(){return this}get element(){return Vt(this.image.canvas)?this.image.canvas:null}onRedrawn(){this.updateTexture(),this.dispatchEvent(K0)}get image(){return this._image}set image(e){this.image&&this.image.removeScope(this),this._image=e,this.image&&(this.image.addScopedEventListener(this,"redrawn",()=>this.onRedrawn()),this.setTextureMap(this.image.canvas),this.onRedrawn())}get imageWidth(){return this.image.width}get imageHeight(){return this.image.height}copy(e,r=!0){return super.copy(e,r),this.image=e.image,this}get isVisible(){return bt(this)}set isVisible(e){Xe(this,e,"inline-block"),Pe(this,e),Pe(this.mesh,e),this.image.visible=e}};function fg(n){return!n.started||n.finished}var zc=class extends Se{constructor(){super(!1);this.time=0;this.duration=0;this.onTick=null}begin(e,r,o){this.restart(),this.time=-e,this.duration=r,this.onTick=o,this.onTick(0)}update(e){fg(this)||(this.time+=e/this.duration,this.time>=1?(this.onTick(1),this.resolve()):this.time>=0&&this.onTick(this.time))}},Tl=class{constructor(){this.animations=new Array}update(t){t=.001*t;for(let e of this.animations)e.update(t)}clear(){for(let t of this.animations)t.resolve()}start(t,e,r){let o=nt(this.animations,fg);return o||this.animations.push(o=new zc),o.begin(t,e,r),o}};var Sn=class extends Zn{constructor(t,e,r,o,i){let s;o instanceof Wt?s=o:s=new Wt(o),super(t,e,r,s,i)}onRedrawn(){this.objectHeight=this.imageHeight,super.onRedrawn()}};var Yi=class extends Dr{constructor(e,r,o,i){super(ie(r));this.env=e;if(w(o)){i=Object.assign({textFillColor:"white",fontFamily:"Segoe UI Emoji",fontSize:20,minHeight:.25,maxHeight:.25},i,{value:o}),this.image=new Wt(i);let s=Tt(16);this.enabledImage=this.createImage(`${s}-enabled`,1),this.disabledImage=this.createImage(`${s}-disabled`,.5),this.disabledImage.visible=!1,U(this,this.enabledImage,this.disabledImage)}this.addMesh(this.enabledImage.mesh),this.addMesh(this.disabledImage.mesh),this.clickable=!0,w(o)&&ml(this,!0)}createImage(e,r){return new Sn(this.env,`text-${e}`,"none",this.image,{side:Bi,opacity:r})}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.enabledImage.visible=!e,this.disabledImage.visible=e}};var gg={bgStrokeColor:"black",bgStrokeSize:.04,textFillColor:"white",scale:150},xg=Object.assign({},gg,{padding:{left:.1,right:.1,top:.025,bottom:.025},fontSize:20,minHeight:.5,maxHeight:.5}),J0=Object.assign({},xg,{bgFillColor:Rt(0,117,215)}),Y0=Object.assign({},xg,{bgFillColor:Rt(117,0,0)}),Z0=Object.assign({},gg,{bgFillColor:"white",textFillColor:"black",padding:{top:.1,left:.1,bottom:.4,right:.1},fontSize:25,minHeight:1,maxHeight:1}),$0=.9;function Xc(n,t){return Object.assign({},n,{fontFamily:t})}var El=class extends qn{constructor(e,r){super("Confirm action");this.env=e;this.object=ie("ConfirmationDialog");this.root=ie("Root");this.animator=new Tl;this.a=0;this.b=0;this.confirmButton.innerText="Yes",this.cancelButton.innerText="No",this.mesh=new Sn(this.env,"confirmationDialogLabel","none",Xc(Z0,r)),this.confirmButton3D=new Yi(this.env,"confirmationDialogConfirmButton","Yes",Xc(J0,r)),this.confirmButton3D.addEventListener("click",()=>this.confirmButton.click()),this.confirmButton3D.object.position.set(1,-.5,.5),this.cancelButton3D=new Yi(this.env,"confirmationDialogCancelButton","No",Xc(Y0,r)),this.cancelButton3D.addEventListener("click",()=>this.cancelButton.click()),this.cancelButton3D.object.position.set(2,-.5,.5),$(this.container,Gd(`calc(${fn(100)} - ${gn(2)})`),Sr("max-content")),$(this.contentArea,Wd(Ld(18)),jd("center"),Ud(gn(1))),U(this,U(this.root,this.mesh,this.confirmButton3D,this.cancelButton3D)),Pe(this.root,!1),this.root.scale.setScalar(0),this.onTick=o=>{let i=Pf(this.a+this.b*o,$0);this.root.scale.set(i,i,.01)}}get name(){return this.object.name}get visible(){return bt(this)}set visible(e){Xe(this,e,"inline-block"),this.mesh.visible=e}update(e){this.animator.update(e)}async showHide(e,r){this.a=e,this.b=r,await this.animator.start(0,.25,this.onTick),this.animator.clear()}get use3D(){return this.env.renderer.xr.isPresenting||this.env.testSpaceLayout}async onShowing(){await super.onShowing(),this.use3D&&(this.root.visible=!0,await this.showHide(0,1))}onShown(){this.use3D&&(this.element.style.display="none")}async onClosing(){this.use3D&&(await this.showHide(1,-1),this.root.visible=!1),await super.onClosing()}prompt(e,r){return this.title=e,Gs(this.contentArea,r),this.mesh.image.value=r,this.showDialog()}};var $n=class extends Yn{constructor(e,r,o,i){super($r(),ie(`${r}-button`),"inline-block");this.buttons=e;this.setName=r;this.activeName=o;this.inactiveName=i;this.enterButton=null;this.exitButton=null;this._isAvailable=!0;this._isEnabled=!0;this._isActive=!1;$(this,this.btnImage=xi()),this.load()}async load(){let[e,r]=await br(this.buttons.getMeshButton(this.setName,this.activeName,.2),this.buttons.getMeshButton(this.setName,this.inactiveName,.2));U(this.object,this.enterButton=e,this.exitButton=r),this.enterButton.addEventListener("click",()=>this.element.click()),this.exitButton.addEventListener("click",()=>this.element.click()),this.refreshState()}get mesh(){return this.active?this.enterButton:this.exitButton}get available(){return this._isAvailable}set available(e){this._isAvailable=e,this.refreshState()}get active(){return this._isActive}set active(e){this._isActive=e,this.refreshState()}get enabled(){return this._isEnabled}set enabled(e){this._isEnabled=e,this.refreshState()}get visible(){return super.visible}set visible(e){super.visible=e,this.refreshState()}refreshState(){let e=this.active?this.inactiveName:this.activeName,r=`${e} ${this.setName}`;if(this.element.title=this.btnImage.title=r,this.btnImage.src=this.buttons.getImageSrc(this.setName,e),this.element.disabled=!this.available||!this.visible||!this.enabled,Xe(this,this.available&&this.visible,"inline-block"),this.enterButton&&this.exitButton){ll(this,this.available&&this.visible&&this.enabled);let o=Pe(this.object,this.available&&this.visible);Pe(this.enterButton,o&&!this.active),Pe(this.exitButton,o&&this.active)}}};var Oo=class extends $n{constructor(e,r){let o=Ui[r];super(e,o.toLowerCase(),"enter","exit");this.mode=r}};function wg(n){return new jc(n)}var jc=class extends Bo{pop(t){return this.addSubProgress(t)}};var Zi=class extends N{constructor(e,r){super(e);this.appName=r}},qc=class extends Zi{constructor(e,r){super("apploading",e);this.appLoadParams=r}},Qc=class extends Zi{constructor(e,r){super("apploaded",e);this.app=r}},Kc=class extends Zi{constructor(e,r){super("appshown",e);this.app=r}},Jc=class{constructor(t,e){this.loader=t;this.name=e;this.params=new Map}param(t,e){return this.params.set(t,e),this}load(t){return this.loader(this.name,this.params,t)}},yl=class extends te{constructor(e,r){super();this.env=e;this.getAppUrl=r;this.loadedModules=new Map;this.loadingApps=new Map;this.currentApps=new Map;this.cacheBustString=null}[Symbol.iterator](){return this.currentApps.values()}isLoaded(e){return this.currentApps.has(e)}get(e){return this.currentApps.get(e)}waitFor(e){if(this.isLoaded(e))return Promise.resolve(this.get(e));let r=new Se;return this.addScopedEventListener(this,"apploaded",o=>{o.appName===e&&(this.removeScope(this),r.resolve(o.app))}),r}async loadAppConstructor(e,r){if(this.loadedModules.has(e))w(r)&&r.end();else{let i=this.getAppUrl(e);if(w(this.cacheBustString)){let a=new bo(i,location.href);a.query("v",this.cacheBustString),i=a.toString()}let s=this.env.fetcher.get(i).progress(r).useCache(!this.env.DEBUG).module().then(ro);this.loadedModules.set(e,s)}let{default:o}=await this.loadedModules.get(e);return o}app(e){return new Jc(this.loadApp.bind(this),e)}loadApp(e,r,o){let i=null;r instanceof Map?i=r:o=r,o=o||this.env.loadingBar;let s=new qc(e,i);if(this.dispatchEvent(s),!this.loadingApps.has(e)){let a=wg(o),l=this.loadAppInstance(this.env,e,i,a.pop(10));this.loadingApps.set(e,l),o=a.pop(1)}return this.loadingApps.get(e)}async loadAppInstance(e,r,o,i){if(!this.currentApps.has(r)){let[s,a]=dl(i,[1,10]),l=await this.loadAppConstructor(r,s),p=new l(e);p.addEventListener("quit",()=>this.unloadApp(r)),p.addEventListener("shown",()=>this.dispatchEvent(new Kc(r,p))),w(o)&&await p.init(o),await p.load(a),this.currentApps.set(r,p),this.dispatchEvent(new Qc(r,p))}return w(i)&&i.end(),this.currentApps.get(r)}unloadApp(e){let r=this.currentApps.get(e);setTimeout(()=>r.clearEventListeners(),100),Le(r),this.currentApps.delete(e),this.loadingApps.delete(e)}};var $i=new I;function es(n){return $i.copy(n),$i.y=0,$i.normalize(),zn(Math.atan2($i.x,$i.z))}function Fg(n){return zn(Math.asin(n.y))}function Lr(n,t){return n.xr.isPresenting?n.xr.getCamera():t}function Ag(n,t,e,r){let o=n.elements;t.set(o[4],o[5],o[6]),e.set(-o[8],-o[9],-o[10]),r.set(o[12],o[13],o[14]),t.normalize(),e.normalize()}function eA(n){return n===DeviceOrientationEvent&&"requestPermission"in n&&Z(n.requestPermission)}var Yc=class extends N{constructor(){super("avatarreset")}},Ml=class extends te{constructor(e,r){super();this.env=e;this.avatarResetEvt=new Yc;this.controlMode="none";this.snapTurnRadians=$e(30);this.sensitivities=new Map([["mousedrag",100],["mousefirstperson",-100],["touchswipe",50],["gamepad",1]]);this.B=new I(0,0,1);this.F=new I;this.U=new I;this.P=new I;this.M=new xe;this.E=new Gh;this.Q1=new ce;this.Q2=new ce;this.Q3=new ce(-Math.sqrt(.5),0,0,Math.sqrt(.5));this.Q4=new ce;this.motion=new He;this.rotStage=new xe;this.axisControl=new He(0,0);this.deviceQ=new ce().identity();this.uv=new He;this.duv=new He;this.move=new I;this.move2=new I;this.radialAcceleration=new He(1.5,1.5);this.radialSpeed=new He(1,1);this.radialEdgeFactor=3/4;this.minFOVDegrees=15;this.maxFOVDegrees=120;this.minPitchRadians=$e(-85);this.maxPitchRadians=$e(85);this.followers=new Array;this.dz=0;this._headingRadians=0;this._pitchRadians=0;this._rollRadians=0;this.headX=0;this.headZ=0;this._worldHeadingRadians=0;this._worldPitchRadians=0;this.fwrd=!1;this.back=!1;this.left=!1;this.rght=!1;this.fwrd2=!1;this.back2=!1;this.left2=!1;this.rght2=!1;this.up=!1;this.down=!1;this.grow=!1;this.shrk=!1;this._keyboardControlEnabled=!1;this.worldPos=new I;this.worldQuat=new ce;this.lockMovement=!1;this.fovZoomEnabled=!0;this.deviceOrientation=null;this.screenOrientation=0;this.alphaOffset=0;this.onDeviceOrientationChangeEvent=null;this.onScreenOrientationChangeEvent=null;this.motionEnabled=!1;this.pointersToSend=new Array;this.disableHorizontal=!1,this.disableVertical=!1,this.invertHorizontal=!1,this.invertVertical=!0,this._height=this.env.defaultAvatarHeight,this.head=ie("Head",r);let o=!1,i=(s,a)=>{if(s==="w"&&(this.fwrd=a),s==="s"&&(this.back=a),s==="a"&&(this.left=a),s==="d"&&(this.rght=a),s==="e"&&(this.up=a),s==="q"&&(this.down=a),s==="ArrowUp"&&(this.fwrd2=a),s==="ArrowDown"&&(this.back2=a),s==="ArrowLeft"&&(this.left2=a),s==="ArrowRight"&&(this.rght2=a),s==="r"&&(this.grow=a),s==="f"&&(this.shrk=a),s==="Home"){let l=o;o=a,l&&!o&&(this.reset(),this.dispatchEvent(this.avatarResetEvt))}};this.onKeyDown=s=>i(s.key,no(s)),this.onKeyUp=s=>i(s.key,!1),this.keyboardControlEnabled=!0,matchMedia("(pointer: coarse)").matches?this.controlMode="touchswipe":matchMedia("(pointer: fine)").matches&&(this.controlMode="mousedrag"),globalThis.isSecureContext&&vi()&&!xn()&&(this.onDeviceOrientationChangeEvent=s=>{this.deviceOrientation=s},this.onScreenOrientationChangeEvent=()=>{"screen"in globalThis&&"orientation"in screen?this.screenOrientation=screen.orientation.angle:"window"in globalThis&&"orientation"in globalThis.window&&(this.screenOrientation=globalThis.window.orientation||0)},hm?Yt(()=>this.startMotionControl()):this.startMotionControl())}set disableVertical(e){this._disableVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set invertVertical(e){this._invertVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set disableHorizontal(e){this._disableHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}set invertHorizontal(e){this._invertHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}get height(){return this.head.position.y}get object(){return this.head}get worldHeadingRadians(){return this._worldHeadingRadians}get worldPitchRadians(){return this._worldPitchRadians}get fov(){return this.env.camera.fov}set fov(e){e!==this.fov&&(this.env.camera.fov=e,this.env.camera.updateProjectionMatrix())}get stage(){return this.head.parent}snapTurn(e){this.setHeading(this.headingRadians-this.snapTurnRadians*e)}get keyboardControlEnabled(){return this._keyboardControlEnabled}set keyboardControlEnabled(e){this._keyboardControlEnabled!==e&&(this._keyboardControlEnabled=e,this._keyboardControlEnabled?(this.env.renderer.domElement.addEventListener("keydown",this.onKeyDown),this.env.renderer.domElement.addEventListener("keyup",this.onKeyUp)):(this.env.renderer.domElement.removeEventListener("keydown",this.onKeyDown),this.env.renderer.domElement.removeEventListener("keyup",this.onKeyUp)))}addFollower(e){this.followers.push(e)}onMove(e,r,o){this.setMode(e),e.canMoveView&&this.controlMode!=="none"&&this.gestureSatisfied(e)&&(this.uv.copy(r),this.duv.copy(o))}setMode(e){e.type==="remote"||e.type==="nose"||(e.type==="hand"?this.controlMode="none":e.type==="gamepad"?this.controlMode="gamepad":e.rayTarget&&e.rayTarget.draggable&&!this.env.eventSys.mouse.isPointerLocked&&e.isPressed(0)?this.controlMode="mouseedge":e.type==="touch"||e.type==="pen"?this.controlMode="touchswipe":e.type==="mouse"?this.controlMode=this.env.eventSys.mouse.isPointerLocked?"mousefirstperson":"mousedrag":dn(e.type))}gestureSatisfied(e){return this.controlMode==="none"?!1:this.controlMode==="gamepad"||this.controlMode==="mousefirstperson"||this.controlMode==="mouseedge"||e.isPressed(0)}get name(){return this.object.name}set name(e){this.object.name=e}get headingRadians(){return this._headingRadians}setHeading(e){this._headingRadians=zn(e)}get pitchRadians(){return this._pitchRadians}setPitch(e,r,o){this._pitchRadians=zn(e+Te)-Te,this._pitchRadians=Xn(this._pitchRadians,r,o)}get rollRadians(){return this._rollRadians}setRoll(e){this._rollRadians=zn(e)}setHeadingImmediate(e){this.setHeading(e),this.updateOrientation(),this.resetFollowers()}setOrientationImmediate(e,r){this.setHeading(e),this._pitchRadians=zn(r),this.updateOrientation()}zoom(e){this.dz=e}update(e){e*=.001;let r=this.deviceOrientation;if(r&&lt(r.alpha)&&lt(r.beta)&&lt(r.gamma)){let o=$e(r.alpha)+this.alphaOffset,i=$e(r.beta),s=$e(r.gamma),a=this.screenOrientation?$e(this.screenOrientation):0;this.E.set(i,o,-s,"YXZ"),this.Q2.setFromAxisAngle(this.B,-a),this.Q4.setFromEuler(this.E).multiply(this.Q3).multiply(this.Q2),this.deviceQ.slerp(this.Q4,.8)}if(!this.lockMovement){if(this.fovZoomEnabled&&Math.abs(this.dz)>0){let i=Math.pow(.95,5e3*e);this.dz=_h(i*this.dz),this.fov=Xn(this.env.camera.fov-this.dz,this.minFOVDegrees,this.maxFOVDegrees)}if(this.controlMode==="mouseedge")this.uv.manhattanLength()>0&&(this.motion.set(this.scaleRadialComponent(-this.uv.x,this.radialSpeed.x,this.radialAcceleration.x),this.scaleRadialComponent(this.uv.y,this.radialSpeed.y,this.radialAcceleration.y)).multiplyScalar(e),this.setHeading(this.headingRadians+this.motion.x),this.setPitch(this.pitchRadians+this.motion.y,this.minPitchRadians,this.maxPitchRadians),this.setRoll(0));else if(this.sensitivities.has(this.controlMode)&&this.duv.manhattanLength()>0){let i=this.sensitivities.get(this.controlMode)||1;this.motion.copy(this.duv).multiplyScalar(i*e).multiply(this.axisControl),this.setHeading(this.headingRadians+this.motion.x),this.setPitch(this.pitchRadians+this.motion.y,this.minPitchRadians,this.maxPitchRadians),this.setRoll(0)}if(this.Q1.setFromAxisAngle(this.stage.up,this.worldHeadingRadians),this.fwrd||this.back||this.left||this.rght||this.up||this.down){let i=(this.left?1:0)+(this.rght?-1:0),s=(this.down?1:0)+(this.up?-1:0),a=(this.fwrd?1:0)+(this.back?-1:0);this.move.set(i,s,a);let l=this.move.length();l>0&&(this.move.multiplyScalar(e/l).applyQuaternion(this.Q1),this.stage.position.add(this.move))}if(this.fwrd2||this.back2||this.left2||this.rght2){let i=(this.left2?1:0)+(this.rght2?-1:0),s=(this.fwrd2?1:0)+(this.back2?-1:0);this.move2.set(i,0,s);let a=this.move2.length();a>0&&(this.move2.multiplyScalar(e/a).applyQuaternion(this.Q1),this.headX+=this.move2.x,this.headZ+=this.move2.z)}if(this.grow||this.shrk){let i=(this.shrk?-1:0)+(this.grow?1:0);this._height+=i*e,this._height=Xn(this._height,1,2)}this.updateOrientation();let o=Math.pow(.95,100*e);this.duv.multiplyScalar(o),this.duv.manhattanLength()<=1e-4&&this.duv.setScalar(0)}}scaleRadialComponent(e,r,o){let i=Math.abs(e);return Math.sign(e)*Math.pow(Math.max(0,i-this.radialEdgeFactor)/(1-this.radialEdgeFactor),o)*r}lookAt(e){e.getWorldPosition(this.P),this.P.sub(this.worldPos);let r=3*ct-Math.atan2(this.P.z,this.P.x),o=Math.atan2(this.P.y,this.P.length());this.setOrientationImmediate(r,o)}updateOrientation(){let e=Lr(this.env.renderer,this.env.camera);this.rotStage.makeRotationY(this._headingRadians),this.stage.matrix.makeTranslation(this.stage.position.x,this.stage.position.y,this.stage.position.z).multiply(this.rotStage),this.stage.matrix.decompose(this.stage.position,this.stage.quaternion,this.stage.scale),this.env.renderer.xr.isPresenting?(this.M.copy(this.stage.matrixWorld).invert(),this.head.position.copy(e.position).applyMatrix4(this.M),this.head.quaternion.copy(this.stage.quaternion).invert().multiply(e.quaternion)):(this.head.position.set(this.headX,this._height,this.headZ),this.E.set(this._pitchRadians,0,this._rollRadians,"XYZ"),this.head.quaternion.setFromEuler(this.E).premultiply(this.deviceQ)),this.env.camera.position.copy(this.head.position),this.env.camera.quaternion.copy(this.head.quaternion),this.head.getWorldPosition(this.worldPos),this.head.getWorldQuaternion(this.worldQuat),this.F.set(0,0,-1).applyQuaternion(this.worldQuat),this._worldHeadingRadians=es(this.F),this._worldPitchRadians=Fg(this.F),Ag(this.head.matrixWorld,this.U,this.F,this.P)}reset(){this.stage.position.setScalar(0),this.setHeadingImmediate(0)}resetFollowers(){for(let e of this.followers)e.reset(this.height,this.worldPos,this.worldHeadingRadians)}async getPermission(){return"DeviceOrientationEvent"in window?eA(DeviceOrientationEvent)?await DeviceOrientationEvent.requestPermission():"granted":"not-supported"}async startMotionControl(){if(!this.motionEnabled){this.onScreenOrientationChangeEvent();let e=await this.getPermission();this.motionEnabled=e==="granted",this.motionEnabled&&("ScreenOrientation"in window?screen.orientation.addEventListener("change",this.onScreenOrientationChangeEvent):window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}}stopMotionControl(){this.motionEnabled&&("ScreenOrientation"in window?screen.orientation.removeEventListener("change",this.onScreenOrientationChangeEvent):window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.motionEnabled=!1)}dispose(){this.stopMotionControl()}get bufferSize(){return 133}writeState(e){ue(this.pointersToSend);let r=this.env.avatar.bufferSize;for(let o of this.env.eventSys.pointers)o.canSend&&(r+=o.bufferSize,this.pointersToSend.push(o));e.length=r,e.position=0,e.writeFloat32(this.height),e.writeMatrix512(this.stage.matrix),e.writeMatrix512(this.head.matrixWorld),e.writeUint8(this.pointersToSend.length);for(let o of this.pointersToSend)o.writeState(e)}};function vg(n){let t=n.attributes.position,e=n.attributes.normal,r=n.attributes.uv;for(let o=0;o<e.count;++o){let i=o*e.itemSize,s=o*e.itemSize+1,a=o*e.itemSize+2,l=e.array[i],p=e.array[s],m=e.array[a],g=Math.abs(l),F=Math.abs(p),S=Math.abs(m),M=t.array[i],k=t.array[s],E=t.array[a],R=Math.abs(M),W=Math.abs(k),V=Math.abs(E),B=o*r.itemSize,G=o*r.itemSize+1,D=r.array[B],O=r.array[G],ne=0,ae=g,j=R;F>ae&&(ne=1,ae=F,j=W),S>ae&&(ne=2,ae=S,j=V),ne===0?M<0?(D=-E,O=k):(D=E,O=k):ne===1?k<0?(D=M,O=-E):(D=M,O=E):E<0?(D=M,O=k):(D=-M,O=k),D=(D/j+1)/8,O=(O/j+1)/6,ne===0?M<0?(D+=0,O+=1/3):(D+=.5,O+=1/3):ne===1?k<0?(D+=.25,O+=0):(D+=.25,O+=2/3):E<0?(D+=.25,O+=1/3):(D+=.75,O+=1/3);let ee=r.array;ee[B]=D,ee[G]=O}}var ts=new qa(1,1,1,1,1,1);ts.name="CubeGeom";ts.computeBoundingBox();ts.computeBoundingSphere();var Sg=ts.clone();Sg.name="InvertedCubeGeom";vg(Sg);var on=class extends Nt{constructor(t,e,r,o){super(ts,o),this.scale.set(t,e,r)}};function bg(n,t,e,r,o){let i=new on(t,e,r,o);return i.name=n,i}var kl=class{constructor(t,e=.15){this.opacity=1;this.direction=0;this.task=new Se(!1);this.material=Ro({name:"FaderMaterial",color:0,side:Bh}),this.object=bg(t,1,1,1,this.material),this.object.renderOrder=Number.MAX_SAFE_INTEGER,this.speed=1/e,this.object.layers.enableAll()}async start(t){this.direction=t,this.task.restart(),await this.task}async fadeOut(){this.direction!=1&&await this.start(1)}async fadeIn(){this.direction!=-1&&await this.start(-1)}update(t){if(this.direction!==0){let e=this.direction*this.speed*t/1e3;0<=this.opacity&&this.opacity<=1&&(this.opacity+=e),(this.direction===1&&this.opacity>=1||this.direction===-1&&this.opacity<=0)&&(this.opacity=Xn(this.opacity,0,1),this.direction=0,this.task.resolve())}this.material.opacity=this.opacity,this.material.transparent=this.opacity<1,this.material.needsUpdate=!0}};var Cl=0;var Wo=3;function _g(n,t){n=it(n),n.traverse(e=>e.layers.set(t))}function Tg(n,t){n=it(n),n.traverse(e=>e.layers.enable(t))}function Mt(n,t,e,r,o,i){let s=new on(r,o,i,qf);return s.position.set(n,t,e),s}var tA=.1,Dl=class extends vr{constructor(){super();this.value=0;this.targetValue=0;this.object=ie("LoadingBar");this._enabled=!0;this.valueBar=new on(0,1,1,Ic),this.valueBar.scale.set(0,1,1);let e=ie("ValueBarContainer");e.scale.set(1,.1,.1),U(this,U(e,this.valueBar),Mt(-.5,0,-.05,.01,.1,.01),Mt(-.5,0,.05,.01,.1,.01),Mt(.5,0,-.05,.01,.1,.01),Mt(.5,0,.05,.01,.1,.01),Mt(-.5,-.05,0,.01,.01,.1),Mt(.5,-.05,0,.01,.01,.1),Mt(-.5,.05,0,.01,.01,.1),Mt(.5,.05,0,.01,.01,.1),Mt(0,-.05,-.05,1,.01,.01),Mt(0,.05,-.05,1,.01,.01),Mt(0,-.05,.05,1,.01,.01),Mt(0,.05,.05,1,.01,.01)),_g(this,Wo)}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,Pe(this,Lo(this)||this.enabled))}report(e,r,o){super.report(e,r,o),this.targetValue=this.p}update(e){this.object.parent.visible&&(this.value=Math.min(this.targetValue,this.value+tA*e),this.valueBar.scale.set(this.value,1,1),this.valueBar.position.x=this.value/2-.5,Pe(this,this.enabled&&this.value>0))}};if(!$c()){let n=Element.prototype,t=Document.prototype;"webkitRequestFullscreen"in n?(n.requestFullscreen=n.webkitRequestFullscreen,t.exitFullscreen=t.webkitRequestFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.webkitFullscreenEnabled}},fullscreenElement:{get:function(){return this.webkitFullscreenElement}}})):"mozRequestFullScreen"in n?(n.requestFullscreen=n.mozRequestFullScreen,t.exitFullscreen=t.mozCancelFullScreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.mozFullScreenEnabled}},fullscreenElement:{get:function(){return this.mozFullScreenElement}}})):"msRequestFullscreen"in n&&(n.requestFullscreen=n.msRequestFullscreen,t.exitFullscreen=t.msExitFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.msFullscreenEnabled}},fullscreenElement:{get:function(){return this.msFullscreenElement}}}))}function $c(){return"requestFullscreen"in HTMLElement.prototype}var nA=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},Ll=nA;var ns=Symbol("@@webxr-polyfill/EventTarget"),bn=class{constructor(){this[ns]={listeners:new Map}}addEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let r=this[ns].listeners.get(t)||[];r.push(e),this[ns].listeners.set(t,r)}removeEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let r=this[ns].listeners.get(t)||[];for(let o=r.length;o>=0;o--)r[o]===e&&r.pop()}dispatchEvent(t,e){let r=this[ns].listeners.get(t)||[],o=[];for(let i=0;i<r.length;i++)o[i]=r[i];for(let i of o)i(e);typeof this[`on${t}`]=="function"&&this[`on${t}`](e)}};var Ne=typeof Float32Array<"u"?Float32Array:Array;var AV=Math.PI/180;function sn(){let n=new Ne(16);return Ne!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function Eg(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function er(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Br(n,t){let e=t[0],r=t[1],o=t[2],i=t[3],s=t[4],a=t[5],l=t[6],p=t[7],m=t[8],g=t[9],F=t[10],S=t[11],M=t[12],k=t[13],E=t[14],R=t[15],W=e*a-r*s,V=e*l-o*s,B=e*p-i*s,G=r*l-o*a,D=r*p-i*a,O=o*p-i*l,ne=m*k-g*M,ae=m*E-F*M,j=m*R-S*M,ee=g*E-F*k,we=g*R-S*k,Fe=F*R-S*E,re=W*Fe-V*we+B*ee+G*j-D*ae+O*ne;return re?(re=1/re,n[0]=(a*Fe-l*we+p*ee)*re,n[1]=(o*we-r*Fe-i*ee)*re,n[2]=(k*O-E*D+R*G)*re,n[3]=(F*D-g*O-S*G)*re,n[4]=(l*j-s*Fe-p*ae)*re,n[5]=(e*Fe-o*j+i*ae)*re,n[6]=(E*B-M*O-R*V)*re,n[7]=(m*O-F*B+S*V)*re,n[8]=(s*we-a*j+p*ne)*re,n[9]=(r*j-e*we-i*ne)*re,n[10]=(M*D-k*B+R*W)*re,n[11]=(g*B-m*D-S*W)*re,n[12]=(a*ae-s*ee-l*ne)*re,n[13]=(e*ee-r*ae+o*ne)*re,n[14]=(k*V-M*G-E*W)*re,n[15]=(m*G-g*V+F*W)*re,n):null}function _n(n,t,e){let r=t[0],o=t[1],i=t[2],s=t[3],a=t[4],l=t[5],p=t[6],m=t[7],g=t[8],F=t[9],S=t[10],M=t[11],k=t[12],E=t[13],R=t[14],W=t[15],V=e[0],B=e[1],G=e[2],D=e[3];return n[0]=V*r+B*a+G*g+D*k,n[1]=V*o+B*l+G*F+D*E,n[2]=V*i+B*p+G*S+D*R,n[3]=V*s+B*m+G*M+D*W,V=e[4],B=e[5],G=e[6],D=e[7],n[4]=V*r+B*a+G*g+D*k,n[5]=V*o+B*l+G*F+D*E,n[6]=V*i+B*p+G*S+D*R,n[7]=V*s+B*m+G*M+D*W,V=e[8],B=e[9],G=e[10],D=e[11],n[8]=V*r+B*a+G*g+D*k,n[9]=V*o+B*l+G*F+D*E,n[10]=V*i+B*p+G*S+D*R,n[11]=V*s+B*m+G*M+D*W,V=e[12],B=e[13],G=e[14],D=e[15],n[12]=V*r+B*a+G*g+D*k,n[13]=V*o+B*l+G*F+D*E,n[14]=V*i+B*p+G*S+D*R,n[15]=V*s+B*m+G*M+D*W,n}function tr(n,t,e){let r=t[0],o=t[1],i=t[2],s=t[3],a=r+r,l=o+o,p=i+i,m=r*a,g=r*l,F=r*p,S=o*l,M=o*p,k=i*p,E=s*a,R=s*l,W=s*p;return n[0]=1-(S+k),n[1]=g+W,n[2]=F-R,n[3]=0,n[4]=g-W,n[5]=1-(m+k),n[6]=M+E,n[7]=0,n[8]=F+R,n[9]=M-E,n[10]=1-(m+S),n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}function Bl(n,t){return n[0]=t[12],n[1]=t[13],n[2]=t[14],n}function Pl(n,t){let e=t[0]+t[5]+t[10],r=0;return e>0?(r=Math.sqrt(e+1)*2,n[3]=.25*r,n[0]=(t[6]-t[9])/r,n[1]=(t[8]-t[2])/r,n[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=Math.sqrt(1+t[0]-t[5]-t[10])*2,n[3]=(t[6]-t[9])/r,n[0]=.25*r,n[1]=(t[1]+t[4])/r,n[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=Math.sqrt(1+t[5]-t[0]-t[10])*2,n[3]=(t[8]-t[2])/r,n[0]=(t[1]+t[4])/r,n[1]=.25*r,n[2]=(t[6]+t[9])/r):(r=Math.sqrt(1+t[10]-t[0]-t[5])*2,n[3]=(t[1]-t[4])/r,n[0]=(t[8]+t[2])/r,n[1]=(t[6]+t[9])/r,n[2]=.25*r),n}function Rl(n,t,e,r,o){let i=1/Math.tan(t/2),s;return n[0]=i/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,o!=null&&o!==1/0?(s=1/(r-o),n[10]=(o+r)*s,n[14]=2*o*r*s):(n[10]=-1,n[14]=-2*r),n}function wt(){let n=new Ne(3);return Ne!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function ep(n){var t=new Ne(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function rA(n){let t=n[0],e=n[1],r=n[2];return Math.sqrt(t*t+e*e+r*r)}function pt(n,t,e){let r=new Ne(3);return r[0]=n,r[1]=t,r[2]=e,r}function tp(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function Ho(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function np(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function Il(n,t){let e=t[0],r=t[1],o=t[2],i=e*e+r*r+o*o;return i>0&&(i=1/Math.sqrt(i),n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i),n}function is(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Vl(n,t,e){let r=t[0],o=t[1],i=t[2],s=e[0],a=e[1],l=e[2];return n[0]=o*l-i*a,n[1]=i*s-r*l,n[2]=r*a-o*s,n}function Rr(n,t,e){let r=e[0],o=e[1],i=e[2],s=e[3],a=t[0],l=t[1],p=t[2],m=o*p-i*l,g=i*a-r*p,F=r*l-o*a,S=o*F-i*g,M=i*m-r*F,k=r*g-o*m,E=s*2;return m*=E,g*=E,F*=E,S*=2,M*=2,k*=2,n[0]=a+m+S,n[1]=l+g+M,n[2]=p+F+k,n}function Mg(n,t){let e=pt(n[0],n[1],n[2]),r=pt(t[0],t[1],t[2]);Il(e,e),Il(r,r);let o=is(e,r);return o>1?0:o<-1?Math.PI:Math.acos(o)}var kg=rA;var vV=function(){let n=wt();return function(t,e,r,o,i,s){let a,l;for(e||(e=3),r||(r=0),o?l=Math.min(o*e+r,t.length):l=t.length,a=r;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],i(n,n,s),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2];return t}}();function Cg(){let n=new Ne(9);return Ne!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function iA(){let n=new Ne(4);return Ne!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Dg(n){let t=new Ne(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function Lg(n,t,e,r){let o=new Ne(4);return o[0]=n,o[1]=t,o[2]=e,o[3]=r,o}function Bg(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function Pg(n,t){let e=t[0],r=t[1],o=t[2],i=t[3],s=e*e+r*r+o*o+i*i;return s>0&&(s=1/Math.sqrt(s),n[0]=e*s,n[1]=r*s,n[2]=o*s,n[3]=i*s),n}var SV=function(){let n=iA();return function(t,e,r,o,i,s){let a,l;for(e||(e=4),r||(r=0),o?l=Math.min(o*e+r,t.length):l=t.length,a=r;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],n[3]=t[a+3],i(n,n,s),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2],t[a+3]=n[3];return t}}();function Ft(){let n=new Ne(4);return Ne!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function aA(n,t,e){e=e*.5;let r=Math.sin(e);return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=Math.cos(e),n}function rp(n,t,e){let r=t[0],o=t[1],i=t[2],s=t[3],a=e[0],l=e[1],p=e[2],m=e[3];return n[0]=r*m+s*a+o*p-i*l,n[1]=o*m+s*l+i*a-r*p,n[2]=i*m+s*p+r*l-o*a,n[3]=s*m-r*a-o*l-i*p,n}function No(n,t,e,r){let o=t[0],i=t[1],s=t[2],a=t[3],l=e[0],p=e[1],m=e[2],g=e[3],F,S,M,k,E;return S=o*l+i*p+s*m+a*g,S<0&&(S=-S,l=-l,p=-p,m=-m,g=-g),1-S>1e-6?(F=Math.acos(S),M=Math.sin(F),k=Math.sin((1-r)*F)/M,E=Math.sin(r*F)/M):(k=1-r,E=r),n[0]=k*o+E*l,n[1]=k*i+E*p,n[2]=k*s+E*m,n[3]=k*a+E*g,n}function op(n,t){let e=t[0],r=t[1],o=t[2],i=t[3],s=e*e+r*r+o*o+i*i,a=s?1/s:0;return n[0]=-e*a,n[1]=-r*a,n[2]=-o*a,n[3]=i*a,n}function lA(n,t){let e=t[0]+t[4]+t[8],r;if(e>0)r=Math.sqrt(e+1),n[3]=.5*r,r=.5/r,n[0]=(t[5]-t[7])*r,n[1]=(t[6]-t[2])*r,n[2]=(t[1]-t[3])*r;else{let o=0;t[4]>t[0]&&(o=1),t[8]>t[o*3+o]&&(o=2);let i=(o+1)%3,s=(o+2)%3;r=Math.sqrt(t[o*3+o]-t[i*3+i]-t[s*3+s]+1),n[o]=.5*r,r=.5/r,n[3]=(t[i*3+s]-t[s*3+i])*r,n[i]=(t[i*3+o]+t[o*3+i])*r,n[s]=(t[s*3+o]+t[o*3+s])*r}return n}function Rg(n,t,e,r){let o=.5*Math.PI/180;t*=o,e*=o,r*=o;let i=Math.sin(t),s=Math.cos(t),a=Math.sin(e),l=Math.cos(e),p=Math.sin(r),m=Math.cos(r);return n[0]=i*l*m-s*a*p,n[1]=s*a*m+i*l*p,n[2]=s*l*p-i*a*m,n[3]=s*l*m+i*a*p,n}var ip=Dg,Ig=Lg,Wl=Bg;var ss=Pg;var LV=function(){let n=wt(),t=pt(1,0,0),e=pt(0,1,0);return function(r,o,i){let s=is(o,i);return s<-.999999?(Vl(n,t,o),kg(n)<1e-6&&Vl(n,e,o),Il(n,n),aA(r,n,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Vl(n,o,i),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=1+s,ss(r,r))}}(),BV=function(){let n=Ft(),t=Ft();return function(e,r,o,i,s,a){return No(n,r,s,a),No(t,o,i,a),No(e,n,t,2*a*(1-a)),e}}(),PV=function(){let n=Cg();return function(t,e,r,o){return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=o[0],n[4]=o[1],n[7]=o[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],ss(t,lA(t,n))}}();var se=Symbol("@@webxr-polyfill/XRRigidTransform"),Tn=class{constructor(){if(this[se]={matrix:null,position:null,orientation:null,inverse:null},arguments.length===0)this[se].matrix=er(new Float32Array(16));else if(arguments.length===1)arguments[0]instanceof Float32Array?this[se].matrix=arguments[0]:(this[se].position=this._getPoint(arguments[0]),this[se].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(arguments.length===2)this[se].position=this._getPoint(arguments[0]),this[se].orientation=this._getPoint(arguments[1]);else throw new Error("Too many arguments!");if(this[se].matrix){let t=wt();Bl(t,this[se].matrix),this[se].position=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2]});let e=Ft();Pl(e,this[se].matrix),this[se].orientation=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2],w:e[3]})}else this[se].matrix=er(new Float32Array(16)),tr(this[se].matrix,Ig(this[se].orientation.x,this[se].orientation.y,this[se].orientation.z,this[se].orientation.w),pt(this[se].position.x,this[se].position.y,this[se].position.z))}_getPoint(t){return t instanceof DOMPointReadOnly?t:DOMPointReadOnly.fromPoint(t)}get matrix(){return this[se].matrix}get position(){return this[se].position}get orientation(){return this[se].orientation}get inverse(){if(this[se].inverse===null){let t=er(new Float32Array(16));Br(t,this[se].matrix),this[se].inverse=new Tn(t),this[se].inverse[se].inverse=this}return this[se].inverse}};var be=Symbol("@@webxr-polyfill/XRSpace");var kt=class{constructor(t=null,e=null){this[be]={specialType:t,inputSource:e,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[be].specialType}get _inputSource(){return this[be].inputSource}_ensurePoseUpdated(t,e){e!=this[be].lastFrameId&&(this[be].lastFrameId=e,this._onPoseUpdate(t))}_onPoseUpdate(t){this[be].specialType=="viewer"&&(this._baseMatrix=t.getBasePoseMatrix())}set _baseMatrix(t){this[be].baseMatrix=t,this[be].inverseBaseMatrix=null}get _baseMatrix(){return this[be].baseMatrix||this[be].inverseBaseMatrix&&(this[be].baseMatrix=new Float32Array(16),Br(this[be].baseMatrix,this[be].inverseBaseMatrix)),this[be].baseMatrix}set _inverseBaseMatrix(t){this[be].inverseBaseMatrix=t,this[be].baseMatrix=null}get _inverseBaseMatrix(){return this[be].inverseBaseMatrix||this[be].baseMatrix&&(this[be].inverseBaseMatrix=new Float32Array(16),Br(this[be].inverseBaseMatrix,this[be].baseMatrix)),this[be].inverseBaseMatrix}_getSpaceRelativeTransform(t){if(!this._inverseBaseMatrix||!t._baseMatrix)return null;let e=new Float32Array(16);return _n(e,this._inverseBaseMatrix,t._baseMatrix),new Tn(e)}};var uA=1.6,nr=Symbol("@@webxr-polyfill/XRReferenceSpace"),as=["viewer","local","local-floor","bounded-floor","unbounded"];function cA(n){return n==="bounded-floor"||n==="local-floor"}var an=class extends kt{constructor(t,e=null){if(!as.includes(t))throw new Error(`XRReferenceSpaceType must be one of ${as}`);if(super(t),t==="bounded-floor"&&!e)throw new Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");cA(t)&&!e&&(e=er(new Float32Array(16)),e[13]=uA),this._inverseBaseMatrix=e||er(new Float32Array(16)),this[nr]={type:t,transform:e,originOffset:er(new Float32Array(16))}}_transformBasePoseMatrix(t,e){_n(t,this._inverseBaseMatrix,e)}_originOffsetMatrix(){return this[nr].originOffset}_adjustForOriginOffset(t){let e=new Float32Array(16);Br(e,this[nr].originOffset),_n(t,e,t)}_getSpaceRelativeTransform(t){let e=super._getSpaceRelativeTransform(t);return this._adjustForOriginOffset(e.matrix),new XRRigidTransform(e.matrix)}getOffsetReferenceSpace(t){let e=new an(this[nr].type,this[nr].transform,this[nr].bounds);return _n(e[nr].originOffset,this[nr].originOffset,t.matrix),e}};var st=Symbol("@@webxr-polyfill/XR"),pA=["inline","immersive-vr","immersive-ar"],dA={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},mA=`Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode
or navigator.xr.requestSession('inline') prior to requesting an immersive
session. This is a limitation specific to the WebXR Polyfill and does not apply
to native implementations of the API.`,ls=class extends bn{constructor(t){super(),this[st]={device:null,devicePromise:t,immersiveSession:null,inlineSessions:new Set},t.then(e=>{this[st].device=e})}async isSessionSupported(t){return this[st].device||await this[st].devicePromise,t!="inline"?Promise.resolve(this[st].device.isSessionSupported(t)):Promise.resolve(!0)}async requestSession(t,e){if(!this[st].device){if(t!="inline")throw new Error(mA);await this[st].devicePromise}if(!pA.includes(t))throw new TypeError(`The provided value '${t}' is not a valid enum value of type XRSessionMode`);let r=dA[t],o=r.requiredFeatures.concat(e&&e.requiredFeatures?e.requiredFeatures:[]),i=r.optionalFeatures.concat(e&&e.optionalFeatures?e.optionalFeatures:[]),s=new Set,a=!1;for(let g of o)this[st].device.isFeatureSupported(g)?s.add(g):(console.error(`The required feature '${g}' is not supported`),a=!0);if(a)throw new DOMException("Session does not support some required features","NotSupportedError");for(let g of i)this[st].device.isFeatureSupported(g)?s.add(g):console.log(`The optional feature '${g}' is not supported`);let l=await this[st].device.requestSession(t,s),p=new XRSession(this[st].device,t,l);t=="inline"?this[st].inlineSessions.add(p):this[st].immersiveSession=p;let m=()=>{t=="inline"?this[st].inlineSessions.delete(p):this[st].immersiveSession=null,p.removeEventListener("end",m)};return p.addEventListener("end",m),p}};var ap;if("performance"in Ll)ap=()=>performance.now();else{let n=Date.now();ap=()=>Date.now()-n}var Hl=ap;var lp=Symbol("@@webxr-polyfill/XRPose"),Ir=class{constructor(t,e){this[lp]={transform:t,emulatedPosition:e}}get transform(){return this[lp].transform}get emulatedPosition(){return this[lp].emulatedPosition}};var Vg=Symbol("@@webxr-polyfill/XRViewerPose"),Vr=class extends Ir{constructor(t,e,r=!1){super(t,r),this[Vg]={views:e}}get views(){return this[Vg].views}};var us=Symbol("@@webxr-polyfill/XRViewport"),Or=class{constructor(t){this[us]={target:t}}get x(){return this[us].target.x}get y(){return this[us].target.y}get width(){return this[us].target.width}get height(){return this[us].target.height}};var Og=["left","right","none"],rr=Symbol("@@webxr-polyfill/XRView"),Wr=class{constructor(t,e,r,o){if(!Og.includes(r))throw new Error(`XREye must be one of: ${Og}`);let i=Object.create(null),s=new Or(i);this[rr]={device:t,eye:r,viewport:s,temp:i,sessionId:o,transform:e}}get eye(){return this[rr].eye}get projectionMatrix(){return this[rr].device.getProjectionMatrix(this.eye)}get transform(){return this[rr].transform}_getViewport(t){if(this[rr].device.getViewport(this[rr].sessionId,this.eye,t,this[rr].temp))return this[rr].viewport}};var Re=Symbol("@@webxr-polyfill/XRFrame"),Wg="XRFrame access outside the callback that produced it is invalid.",hA="getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.",fA=0,or=class{constructor(t,e,r){this[Re]={id:++fA,active:!1,animationFrame:!1,device:t,session:e,sessionId:r}}get session(){return this[Re].session}getViewerPose(t){if(!this[Re].animationFrame)throw new DOMException(hA,"InvalidStateError");if(!this[Re].active)throw new DOMException(Wg,"InvalidStateError");let e=this[Re].device,r=this[Re].session;r[_].viewerSpace._ensurePoseUpdated(e,this[Re].id),t._ensurePoseUpdated(e,this[Re].id);let o=t._getSpaceRelativeTransform(r[_].viewerSpace),i=[];for(let a of r[_].viewSpaces){a._ensurePoseUpdated(e,this[Re].id);let l=t._getSpaceRelativeTransform(a),p=new Wr(e,l,a.eye,this[Re].sessionId);i.push(p)}return new Vr(o,i,!1)}getPose(t,e){if(!this[Re].active)throw new DOMException(Wg,"InvalidStateError");let r=this[Re].device;if(t._specialType==="target-ray"||t._specialType==="grip")return r.getInputPose(t._inputSource,e,t._specialType);{t._ensurePoseUpdated(r,this[Re].id),e._ensurePoseUpdated(r,this[Re].id);let o=e._getSpaceRelativeTransform(t);return o?new XRPose(o,!1):null}return null}};var cs=Symbol("@@webxr-polyfill/XRRenderState"),gA=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null}),ir=class{constructor(t={}){let e=Object.assign({},gA,t);this[cs]={config:e}}get depthNear(){return this[cs].config.depthNear}get depthFar(){return this[cs].config.depthFar}get inlineVerticalFieldOfView(){return this[cs].config.inlineVerticalFieldOfView}get baseLayer(){return this[cs].config.baseLayer}};var Nl=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),ps=Symbol("@@webxr-polyfill/xr-compatible");var Hr=Symbol("@@webxr-polyfill/XRWebGLLayer"),xA=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),ds=class{constructor(t,e,r={}){let o=Object.assign({},xA,r);if(!(t instanceof Nr))throw new Error("session must be a XRSession");if(t.ended)throw new Error("InvalidStateError");if(e[Nl]&&e[ps]!==!0)throw new Error("InvalidStateError");let i=e.getParameter(e.FRAMEBUFFER_BINDING);this[Hr]={context:e,config:o,framebuffer:i,session:t}}get context(){return this[Hr].context}get antialias(){return this[Hr].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return this[Hr].framebuffer}get framebufferWidth(){return this[Hr].context.drawingBufferWidth}get framebufferHeight(){return this[Hr].context.drawingBufferHeight}get _session(){return this[Hr].session}getViewport(t){return t._getViewport(this)}static getNativeFramebufferScaleFactor(t){if(!t)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return t[_].ended?0:1}};var up=Symbol("@@webxr-polyfill/XRInputSourceEvent"),En=class extends Event{constructor(t,e){super(t,e),this[up]={frame:e.frame,inputSource:e.inputSource},Object.setPrototypeOf(this,En.prototype)}get frame(){return this[up].frame}get inputSource(){return this[up].inputSource}};var Hg=Symbol("@@webxr-polyfill/XRSessionEvent"),ln=class extends Event{constructor(t,e){super(t,e),this[Hg]={session:e.session},Object.setPrototypeOf(this,ln.prototype)}get session(){return this[Hg].session}};var Gl=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),yn=class extends Event{constructor(t,e){super(t,e),this[Gl]={session:e.session,added:e.added,removed:e.removed},Object.setPrototypeOf(this,yn.prototype)}get session(){return this[Gl].session}get added(){return this[Gl].added}get removed(){return this[Gl].removed}};var _=Symbol("@@webxr-polyfill/XRSession"),ms=class extends kt{constructor(t){super(t)}get eye(){return this._specialType}_onPoseUpdate(t){this._inverseBaseMatrix=t.getBaseViewMatrix(this._specialType)}},Nr=class extends bn{constructor(t,e,r){super();let o=e!="inline",i=new ir({inlineVerticalFieldOfView:o?null:Math.PI*.5});this[_]={device:t,mode:e,immersive:o,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:r,activeRenderState:i,pendingRenderState:null,viewerSpace:new an("viewer"),viewSpaces:[],currentInputSources:[]},o?this[_].viewSpaces.push(new ms("left"),new ms("right")):this[_].viewSpaces.push(new ms("none")),this[_].onDeviceFrame=()=>{if(this[_].ended||this[_].suspended||(this[_].deviceFrameHandle=null,this[_].startDeviceFrameLoop(),this[_].pendingRenderState!==null&&(this[_].activeRenderState=new ir(this[_].pendingRenderState),this[_].pendingRenderState=null,this[_].activeRenderState.baseLayer&&this[_].device.onBaseLayerSet(this[_].id,this[_].activeRenderState.baseLayer)),this[_].activeRenderState.baseLayer===null))return;let s=new or(t,this,this[_].id),a=this[_].currentFrameCallbacks=this[_].frameCallbacks;this[_].frameCallbacks=[],s[Re].active=!0,s[Re].animationFrame=!0,this[_].device.onFrameStart(this[_].id,this[_].activeRenderState),this._checkInputSourcesChange();let l=Hl();for(let p=0;p<a.length;p++)try{!a[p].cancelled&&typeof a[p].callback=="function"&&a[p].callback(l,s)}catch(m){console.error(m)}this[_].currentFrameCallbacks=null,s[Re].active=!1,this[_].device.onFrameEnd(this[_].id)},this[_].startDeviceFrameLoop=()=>{this[_].deviceFrameHandle===null&&(this[_].deviceFrameHandle=this[_].device.requestAnimationFrame(this[_].onDeviceFrame))},this[_].stopDeviceFrameLoop=()=>{let s=this[_].deviceFrameHandle;s!==null&&(this[_].device.cancelAnimationFrame(s),this[_].deviceFrameHandle=null)},this[_].onPresentationEnd=s=>{if(s!==this[_].id){this[_].suspended=!1,this[_].startDeviceFrameLoop(),this.dispatchEvent("focus",{session:this});return}this[_].ended=!0,this[_].stopDeviceFrameLoop(),t.removeEventListener("@@webxr-polyfill/vr-present-end",this[_].onPresentationEnd),t.removeEventListener("@@webxr-polyfill/vr-present-start",this[_].onPresentationStart),t.removeEventListener("@@webxr-polyfill/input-select-start",this[_].onSelectStart),t.removeEventListener("@@webxr-polyfill/input-select-end",this[_].onSelectEnd),this.dispatchEvent("end",new ln("end",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-end",this[_].onPresentationEnd),this[_].onPresentationStart=s=>{s!==this[_].id&&(this[_].suspended=!0,this[_].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-start",this[_].onPresentationStart),this[_].onSelectStart=s=>{s.sessionId===this[_].id&&this[_].dispatchInputSourceEvent("selectstart",s.inputSource)},t.addEventListener("@@webxr-polyfill/input-select-start",this[_].onSelectStart),this[_].onSelectEnd=s=>{s.sessionId===this[_].id&&(this[_].dispatchInputSourceEvent("selectend",s.inputSource),this[_].dispatchInputSourceEvent("select",s.inputSource))},t.addEventListener("@@webxr-polyfill/input-select-end",this[_].onSelectEnd),this[_].onSqueezeStart=s=>{s.sessionId===this[_].id&&this[_].dispatchInputSourceEvent("squeezestart",s.inputSource)},t.addEventListener("@@webxr-polyfill/input-squeeze-start",this[_].onSqueezeStart),this[_].onSqueezeEnd=s=>{s.sessionId===this[_].id&&(this[_].dispatchInputSourceEvent("squeezeend",s.inputSource),this[_].dispatchInputSourceEvent("squeeze",s.inputSource))},t.addEventListener("@@webxr-polyfill/input-squeeze-end",this[_].onSqueezeEnd),this[_].dispatchInputSourceEvent=(s,a)=>{let l=new or(t,this,this[_].id),p=new En(s,{frame:l,inputSource:a});l[Re].active=!0,this.dispatchEvent(s,p),l[Re].active=!1},this[_].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[_].activeRenderState}get environmentBlendMode(){return this[_].device.environmentBlendMode||"opaque"}async requestReferenceSpace(t){if(this[_].ended)return;if(!as.includes(t))throw new TypeError(`XRReferenceSpaceType must be one of ${as}`);if(!this[_].device.doesSessionSupportReferenceSpace(this[_].id,t))throw new DOMException(`The ${t} reference space is not supported by this session.`,"NotSupportedError");if(t==="viewer")return this[_].viewerSpace;let e=await this[_].device.requestFrameOfReferenceTransform(t);if(t==="bounded-floor")throw e?this[_].device.requestStageBounds()?new DOMException(`The WebXR polyfill does not support the ${t} reference space yet.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError");return new an(t,e)}requestAnimationFrame(t){if(this[_].ended)return;let e=++this[_].frameHandle;return this[_].frameCallbacks.push({handle:e,callback:t,cancelled:!1}),e}cancelAnimationFrame(t){let e=this[_].frameCallbacks,r=e.findIndex(o=>o&&o.handle===t);r>-1&&(e[r].cancelled=!0,e.splice(r,1)),e=this[_].currentFrameCallbacks,e&&(r=e.findIndex(o=>o&&o.handle===t),r>-1&&(e[r].cancelled=!0))}get inputSources(){return this[_].device.getInputSources()}async end(){if(!this[_].ended)return this[_].immersive&&(this[_].ended=!0,this[_].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[_].onPresentationStart),this[_].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[_].onPresentationEnd),this[_].device.removeEventListener("@@webxr-polyfill/input-select-start",this[_].onSelectStart),this[_].device.removeEventListener("@@webxr-polyfill/input-select-end",this[_].onSelectEnd),this.dispatchEvent("end",new ln("end",{session:this}))),this[_].stopDeviceFrameLoop(),this[_].device.endSession(this[_].id)}updateRenderState(t){if(this[_].ended){let r="Can't call updateRenderState on an XRSession that has already ended.";throw new Error(r)}if(t.baseLayer&&t.baseLayer._session!==this){let r="Called updateRenderState with a base layer that was created by a different session.";throw new Error(r)}if(t.inlineVerticalFieldOfView!==null&&t.inlineVerticalFieldOfView!==void 0)if(this[_].immersive){let r="inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.";throw new Error(r)}else t.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,t.inlineVerticalFieldOfView));if(this[_].pendingRenderState===null){let r=this[_].activeRenderState;this[_].pendingRenderState={depthNear:r.depthNear,depthFar:r.depthFar,inlineVerticalFieldOfView:r.inlineVerticalFieldOfView,baseLayer:r.baseLayer}}Object.assign(this[_].pendingRenderState,t)}_checkInputSourcesChange(){let t=[],e=[],r=this.inputSources,o=this[_].currentInputSources;for(let i of r)o.includes(i)||t.push(i);for(let i of o)r.includes(i)||e.push(i);(t.length>0||e.length>0)&&this.dispatchEvent("inputsourceschange",new yn("inputsourceschange",{session:this,added:t,removed:e})),this[_].currentInputSources.length=0;for(let i of r)this[_].currentInputSources.push(i)}};var sr=Symbol("@@webxr-polyfill/XRInputSource"),Gr=class{constructor(t){this[sr]={impl:t,gripSpace:new kt("grip",this),targetRaySpace:new kt("target-ray",this)}}get handedness(){return this[sr].impl.handedness}get targetRayMode(){return this[sr].impl.targetRayMode}get gripSpace(){let t=this[sr].impl.targetRayMode;return t==="gaze"||t==="screen"?null:this[sr].gripSpace}get targetRaySpace(){return this[sr].targetRaySpace}get profiles(){return this[sr].impl.profiles}get gamepad(){return this[sr].impl.gamepad}};var cp=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),Ur=class extends Event{constructor(t,e){super(t,e),this[cp]={referenceSpace:e.referenceSpace,transform:e.transform||null},Object.setPrototypeOf(this,Ur.prototype)}get referenceSpace(){return this[cp].referenceSpace}get transform(){return this[cp].transform}};var Ul={XRSystem:ls,XRSession:Nr,XRSessionEvent:ln,XRFrame:or,XRView:Wr,XRViewport:Or,XRViewerPose:Vr,XRWebGLLayer:ds,XRSpace:kt,XRReferenceSpace:an,XRReferenceSpaceEvent:Ur,XRInputSource:Gr,XRInputSourceEvent:En,XRInputSourcesChangeEvent:yn,XRRenderState:ir,XRRigidTransform:Tn,XRPose:Ir};var pp=n=>typeof n.prototype.makeXRCompatible=="function"?!1:(n.prototype.makeXRCompatible=function(){return this[ps]=!0,Promise.resolve()},!0),dp=n=>{let t=n.prototype.getContext;n.prototype.getContext=function(e,r){let o=t.call(this,e,r);return o&&(o[Nl]=!0,r&&"xrCompatible"in r&&(o[ps]=r.xrCompatible)),o}};var Ng=n=>!!(n.ImageBitmapRenderingContext&&n.createImageBitmap),Gg=n=>{var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(n.navigator.userAgent||n.navigator.vendor||n.opera),t},Ug=n=>{n.style.display="block",n.style.position="absolute",n.style.width=n.style.height="1px",n.style.top=n.style.left="0px"};var ex=gw(zg());var zr=class extends bn{constructor(t){super(),this.global=t,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(t,e){throw new Error("Not implemented")}isSessionSupported(t){throw new Error("Not implemented")}isFeatureSupported(t){throw new Error("Not implemented")}async requestSession(t,e){throw new Error("Not implemented")}requestAnimationFrame(t){throw new Error("Not implemented")}onFrameStart(t){throw new Error("Not implemented")}onFrameEnd(t){throw new Error("Not implemented")}doesSessionSupportReferenceSpace(t,e){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(t,e){}cancelAnimationFrame(t){throw new Error("Not implemented")}endSession(t){throw new Error("Not implemented")}getViewport(t,e,r,o){throw new Error("Not implemented")}getProjectionMatrix(t){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(t){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(t,e,r){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}};var wA={mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},FA={mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},AA={mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},Xg={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},vA={mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[Math.PI*-.08,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},SA={mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},bA={mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},fp={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},_A={"Daydream Controller":wA,"Gear VR Controller":SA,"HTC Vive Focus Controller":FA,"Oculus Go Controller":AA,"Oculus Touch (Right)":Xg,"Oculus Touch (Left)":Xg,"OpenVR Gamepad":vA,"Spatial Controller (Spatial Interaction Source) 045E-065A":fp,"Spatial Controller (Spatial Interaction Source) 045E-065D":bA,"Windows Mixed Reality (Right)":fp,"Windows Mixed Reality (Left)":fp},jg=_A;var qg=pt(.155,-.465,-.15),TA=pt(-.155,-.465,-.15),EA=pt(0,0,-.25),yA=pt(0,0,.05),Qg=pt(-.08,.14,.08),Kg=.4,MA=.4,kA=.61,CA=.175,DA=.12,LA=.87,Jg=180/Math.PI;function BA(n,t,e){function r(l,p,m){return l<p?p:l>m?m:l}var o=t[0]*t[0],i=t[1]*t[1],s=t[2]*t[2],a=t[3]*t[3];if(e==="XYZ")n[0]=Math.atan2(2*(t[0]*t[3]-t[1]*t[2]),a-o-i+s),n[1]=Math.asin(r(2*(t[0]*t[2]+t[1]*t[3]),-1,1)),n[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),a+o-i-s);else if(e==="YXZ")n[0]=Math.asin(r(2*(t[0]*t[3]-t[1]*t[2]),-1,1)),n[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),a-o-i+s),n[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),a-o+i-s);else if(e==="ZXY")n[0]=Math.asin(r(2*(t[0]*t[3]+t[1]*t[2]),-1,1)),n[1]=Math.atan2(2*(t[1]*t[3]-t[2]*t[0]),a-o-i+s),n[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),a-o+i-s);else if(e==="ZYX")n[0]=Math.atan2(2*(t[0]*t[3]+t[2]*t[1]),a-o-i+s),n[1]=Math.asin(r(2*(t[1]*t[3]-t[0]*t[2]),-1,1)),n[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),a+o-i-s);else if(e==="YZX")n[0]=Math.atan2(2*(t[0]*t[3]-t[2]*t[1]),a-o+i-s),n[1]=Math.atan2(2*(t[1]*t[3]-t[0]*t[2]),a+o-i-s),n[2]=Math.asin(r(2*(t[0]*t[1]+t[2]*t[3]),-1,1));else if(e==="XZY")n[0]=Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),a-o+i-s),n[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),a+o-i-s),n[2]=Math.asin(r(2*(t[2]*t[3]-t[0]*t[1]),-1,1));else{console.log("No order given for quaternion to euler conversion.");return}}var hs=class{constructor(){this.hand="right",this.headElbowOffset=qg,this.controllerQ=Ft(),this.lastControllerQ=Ft(),this.headQ=Ft(),this.headPos=wt(),this.elbowPos=wt(),this.wristPos=wt(),this.time=null,this.lastTime=null,this.rootQ=Ft(),this.position=wt()}setHandedness(t){this.hand!=t&&(this.hand=t,this.hand=="left"?this.headElbowOffset=TA:this.headElbowOffset=qg)}update(t,e){this.time=Hl(),t&&(Wl(this.lastControllerQ,this.controllerQ),Wl(this.controllerQ,t)),e&&(Bl(this.headPos,e),Pl(this.headQ,e));let r=this.getHeadYawOrientation_(),o=this.quatAngle_(this.lastControllerQ,this.controllerQ),i=(this.time-this.lastTime)/1e3;o/i>kA?No(this.rootQ,this.rootQ,r,Math.min(o/CA,1)):Wl(this.rootQ,r);let a=pt(0,0,-1);Rr(a,a,this.controllerQ);let l=is(a,[0,1,0]),p=this.clamp_((l-DA)/LA,0,1),m=ip(this.rootQ);op(m,m),rp(m,m,this.controllerQ);let g=this.elbowPos;tp(g,this.headPos),Ho(g,g,this.headElbowOffset);let F=ep(Qg);np(F,F,p),Ho(g,g,F);let M=this.quatAngle_(m,Ft())*Jg,k=1-Math.pow(M/180,4);sssss;let E=Kg,R=1-Kg,W=k*(E+R*p*MA),V=Ft();No(V,V,m,W);let B=op(Ft(),V),G=ip(m);rp(G,G,B);let D=this.wristPos;tp(D,yA),Rr(D,D,V),Ho(D,D,EA),Rr(D,D,G),Ho(D,D,g);let O=ep(Qg);np(O,O,p),Ho(this.position,this.wristPos,O),Rr(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let t=wt();return BA(t,this.headQ,"YXZ"),Rg(Ft(),0,t[1]*Jg,0)}clamp_(t,e,r){return Math.min(Math.max(t,e),r)}quatAngle_(t,e){let r=[0,0,-1],o=[0,0,-1];return Rr(r,r,t),Rr(o,o,e),Mg(r,o)}};var et=Symbol("@@webxr-polyfill/XRRemappedGamepad"),Yg={pressed:!1,touched:!1,value:0};Object.freeze(Yg);var gp=class{constructor(t,e,r){if(r||(r={}),r.userAgentOverrides){for(let p in r.userAgentOverrides)if(navigator.userAgent.includes(p)){let m=r.userAgentOverrides[p];for(let g in m)g in r?Object.assign(r[g],m[g]):r[g]=m[g];break}}let o=new Array(r.axes&&r.axes.length?r.axes.length:t.axes.length),i=new Array(r.buttons&&r.buttons.length?r.buttons.length:t.buttons.length),s=null;if(r.gripTransform){let p=r.gripTransform.orientation||[0,0,0,1];s=sn(),tr(s,ss(p,p),r.gripTransform.position||[0,0,0])}let a=null;if(r.targetRayTransform){let p=r.targetRayTransform.orientation||[0,0,0,1];a=sn(),tr(a,ss(p,p),r.targetRayTransform.position||[0,0,0])}let l=r.profiles;r.displayProfiles&&e.displayName in r.displayProfiles&&(l=r.displayProfiles[e.displayName]),this[et]={gamepad:t,map:r,profiles:l||[t.id],mapping:r.mapping||t.mapping,axes:o,buttons:i,gripTransform:s,targetRayTransform:a},this._update()}_update(){let t=this[et].gamepad,e=this[et].map,r=this[et].axes;for(let i=0;i<r.length;++i)e.axes&&i in e.axes?e.axes[i]===null?r[i]=0:r[i]=t.axes[e.axes[i]]:r[i]=t.axes[i];if(e.axes&&e.axes.invert)for(let i of e.axes.invert)i<r.length&&(r[i]*=-1);let o=this[et].buttons;for(let i=0;i<o.length;++i)e.buttons&&i in e.buttons?e.buttons[i]===null?o[i]=Yg:o[i]=t.buttons[e.buttons[i]]:o[i]=t.buttons[i]}get id(){return""}get _profiles(){return this[et].profiles}get index(){return-1}get connected(){return this[et].gamepad.connected}get timestamp(){return this[et].gamepad.timestamp}get mapping(){return this[et].mapping}get axes(){return this[et].axes}get buttons(){return this[et].buttons}get hapticActuators(){return this[et].gamepad.hapticActuators}},fs=class{constructor(t,e,r=0,o=-1){this.polyfill=t,this.display=e,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new Gr(this),this.lastPosition=wt(),this.emulatedPosition=!1,this.basePoseMatrix=sn(),this.outputMatrix=sn(),this.primaryButtonIndex=r,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=o,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(t){this.nativeGamepad!==t&&(this.nativeGamepad=t,t?this.gamepad=new gp(t,this.display,jg[t.id]):this.gamepad=null),this.handedness=t.hand===""?"none":t.hand,this.gamepad&&this.gamepad._update(),t.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!t.pose.hasPosition):t.hand===""&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let t=this.nativeGamepad.pose,e=t.position,r=t.orientation;if(!e&&!r)return;e?(this.lastPosition[0]=e[0],this.lastPosition[1]=e[1],this.lastPosition[2]=e[2]):t.hasPosition?e=this.lastPosition:(this.armModel||(this.armModel=new hs),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(r,this.polyfill.getBasePoseMatrix()),e=this.armModel.getPosition()),tr(this.basePoseMatrix,r,e)}else Eg(this.basePoseMatrix,this.polyfill.getBasePoseMatrix());return this.basePoseMatrix}getXRPose(t,e){switch(this.updateBasePoseMatrix(),e){case"target-ray":t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[et].targetRayTransform&&_n(this.outputMatrix,this.outputMatrix,this.gamepad[et].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[et].gripTransform&&_n(this.outputMatrix,this.outputMatrix,this.gamepad[et].gripTransform);break;default:return null}return t._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}};var l9=Symbol("@@webxr-polyfill/WebVRDevice"),gs=!1,Zg={highRefreshRate:!0},$g={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},PA=0,xp=class{constructor(t,e,r={}){if(this.mode=t,this.enabledFeatures=e,this.outputContext=null,this.immersive=t=="immersive-vr"||t=="immersive-ar",this.ended=null,this.baseLayer=null,this.id=++PA,this.modifiedCanvasLayer=!1,this.outputContext&&!gs){let o=r.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(o)}}},Xr=class extends zr{constructor(t,e){let{canPresent:r}=e.capabilities;super(t),this.display=e,this.frame=new t.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=r,this.baseModelMatrix=sn(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),t.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=t.navigator&&"getGamepads"in t.navigator,this.HAS_BITMAP_SUPPORT=Ng(t)}get depthNear(){return this.display.depthNear}set depthNear(t){this.display.depthNear=t}get depthFar(){return this.display.depthFar}set depthFar(t){this.display.depthFar=t}onBaseLayerSet(t,e){let r=this.sessions.get(t),o=e.context.canvas;if(r.immersive){let i=this.display.getEyeParameters("left"),s=this.display.getEyeParameters("right");o.width=Math.max(i.renderWidth,s.renderWidth)*2,o.height=Math.max(i.renderHeight,s.renderHeight),this.display.requestPresent([{source:o,attributes:Zg}]).then(()=>{!gs&&!this.global.document.body.contains(o)&&(r.modifiedCanvasLayer=!0,this.global.document.body.appendChild(o),Ug(o)),r.baseLayer=e})}else r.baseLayer=e}isSessionSupported(t){return!(t=="immersive-ar"||t=="immersive-vr"&&this.canPresent===!1)}isFeatureSupported(t){switch(t){case"viewer":return!0;case"local":return!0;case"local-floor":return!0;case"bounded":return!1;case"unbounded":return!1;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let r=t=="immersive-vr";if(r){let i=this.global.document.createElement("canvas");if(!gs){let s=i.getContext("webgl")}await this.display.requestPresent([{source:i,attributes:Zg}])}let o=new xp(t,e,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(o.id,o),r&&(this.immersiveSession=o,this.dispatchEvent("@@webxr-polyfill/vr-present-start",o.id)),Promise.resolve(o.id)}requestAnimationFrame(t){return this.display.requestAnimationFrame(t)}getPrimaryButtonIndex(t){let e=0,r=t.id.toLowerCase();for(let o in $g)if(r.includes(o)){e=$g[o];break}return Math.min(e,t.buttons.length-1)}onFrameStart(t,e){this.display.depthNear=e.depthNear,this.display.depthFar=e.depthFar,this.display.getFrameData(this.frame);let r=this.sessions.get(t);if(r.immersive&&this.CAN_USE_GAMEPAD){let o=this.gamepadInputSources;this.gamepadInputSources={};let i=this.global.navigator.getGamepads();for(let s=0;s<i.length;++s){let a=i[s];if(a&&a.displayId>0){let l=o[s];if(l||(l=new fs(this,this.display,this.getPrimaryButtonIndex(a))),l.updateFromGamepad(a),this.gamepadInputSources[s]=l,l.primaryButtonIndex!=-1){let p=a.buttons[l.primaryButtonIndex].pressed;p&&!l.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:r.id,inputSource:l.inputSource}):!p&&l.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:r.id,inputSource:l.inputSource}),l.primaryActionPressed=p}if(l.primarySqueezeButtonIndex!=-1){let p=a.buttons[l.primarySqueezeButtonIndex].pressed;p&&!l.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:r.id,inputSource:l.inputSource}):!p&&l.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:r.id,inputSource:l.inputSource}),l.primarySqueezeActionPressed=p}}}}if(!gs&&!r.immersive&&r.baseLayer){let o=r.baseLayer.context.canvas;Rl(this.frame.leftProjectionMatrix,e.inlineVerticalFieldOfView,o.width/o.height,e.depthNear,e.depthFar)}}onFrameEnd(t){let e=this.sessions.get(t);if(!(e.ended||!e.baseLayer)){if(e.outputContext&&!(e.immersive&&!this.display.capabilities.hasExternalDisplay)){let r=e.immersive&&this.display.capabilities.hasExternalDisplay,o=e.baseLayer.context.canvas,i=r?o.width/2:o.width,s=o.height;if(!gs){let a=e.outputContext.canvas,l=a.width,p=a.height,m=e.renderContext;this.HAS_BITMAP_SUPPORT?o.transferToImageBitmap?m.transferFromImageBitmap(o.transferToImageBitmap()):this.global.createImageBitmap(o,0,0,i,s,{resizeWidth:l,resizeHeight:p}).then(g=>m.transferFromImageBitmap(g)):m.drawImage(o,0,0,i,s,0,0,l,p)}}e.immersive&&e.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(t){this.display.cancelAnimationFrame(t)}async endSession(t){let e=this.sessions.get(t);if(!e.ended){if(e.immersive)return this.display.exitPresent();e.ended=!0}}doesSessionSupportReferenceSpace(t,e){let r=this.sessions.get(t);return r.ended?!1:r.enabledFeatures.has(e)}requestStageBounds(){if(this.display.stageParameters){let t=this.display.stageParameters.sizeX,e=this.display.stageParameters.sizeZ,r=[];return r.push(-t/2),r.push(-e/2),r.push(t/2),r.push(-e/2),r.push(t/2),r.push(e/2),r.push(-t/2),r.push(e/2),r}return null}async requestFrameOfReferenceTransform(t,e){return(t==="local-floor"||t==="bounded-floor")&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(t){if(t==="left")return this.frame.leftProjectionMatrix;if(t==="right")return this.frame.rightProjectionMatrix;if(t==="none")return this.frame.leftProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(t,e,r,o){let i=this.sessions.get(t),{width:s,height:a}=r.context.canvas;if(!i.immersive)return o.x=o.y=0,o.width=s,o.height=a,!0;if(e==="left"||e==="none")o.x=0;else if(e==="right")o.x=s/2;else return!1;return o.y=0,o.width=s/2,o.height=a,!0}getBasePoseMatrix(){let{position:t,orientation:e}=this.frame.pose;return!t&&!e?this.baseModelMatrix:(t||(t=this.tempVec3,t[0]=t[1]=t[2]=0),tr(this.baseModelMatrix,e,t),this.baseModelMatrix)}getBaseViewMatrix(t){if(t==="left"||t==="none")return this.frame.leftViewMatrix;if(t==="right")return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let t=[];for(let e in this.gamepadInputSources)t.push(this.gamepadInputSources[e].inputSource);return t}getInputPose(t,e,r){if(!e)return null;for(let o in this.gamepadInputSources){let i=this.gamepadInputSources[o];if(i.inputSource===t)return i.getXRPose(e,r)}return null}onWindowResize(){}onVRDisplayPresentChange(t){this.display.isPresenting||this.sessions.forEach(e=>{if(e.immersive&&!e.ended){if(e.modifiedCanvasLayer){let r=e.baseLayer.context.canvas;document.body.removeChild(r),r.setAttribute("style","")}this.immersiveSession===e&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",e.id)}})}};var xs=class extends Xr{constructor(t,e){let r=new ex.default(e||{});super(t,r),this.display=r,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}};var RA=!1,IA=0,wp=class{constructor(t,e){this.mode=t,this.enabledFeatures=e,this.ended=null,this.baseLayer=null,this.id=++IA}},ws=class extends zr{constructor(t){super(t),this.sessions=new Map,this.projectionMatrix=sn(),this.identityMatrix=sn()}onBaseLayerSet(t,e){let r=this.sessions.get(t);r.baseLayer=e}isSessionSupported(t){return t=="inline"}isFeatureSupported(t){switch(t){case"viewer":return!0;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let r=new wp(t,e);return this.sessions.set(r.id,r),Promise.resolve(r.id)}requestAnimationFrame(t){return window.requestAnimationFrame(t)}cancelAnimationFrame(t){window.cancelAnimationFrame(t)}onFrameStart(t,e){if(RA)return;let r=this.sessions.get(t);if(r.baseLayer){let o=r.baseLayer.context.canvas;Rl(this.projectionMatrix,e.inlineVerticalFieldOfView,o.width/o.height,e.depthNear,e.depthFar)}}onFrameEnd(t){}async endSession(t){let e=this.sessions.get(t);e.ended=!0}doesSessionSupportReferenceSpace(t,e){let r=this.sessions.get(t);return r.ended?!1:r.enabledFeatures.has(e)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(t,e){return null}getProjectionMatrix(t){return this.projectionMatrix}getViewport(t,e,r,o){let i=this.sessions.get(t),{width:s,height:a}=r.context.canvas;return o.x=o.y=0,o.width=s,o.height=a,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(t){return this.identityMatrix}getInputSources(){return[]}getInputPose(t,e,r){return null}onWindowResize(){}};var VA=async function(n){let t=null;if("getVRDisplays"in n.navigator)try{let e=await n.navigator.getVRDisplays();e&&e.length&&(t=new Xr(n,e[0]))}catch{}return t},tx=async function(n,t){if(t.webvr){let r=await VA(n);if(r)return r}let e=Gg(n);return e&&t.cardboard||!e&&t.allowCardboardOnDesktop?(n.VRFrameData||(n.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new xs(n,t.cardboardConfig)):new ws(n)};var OA={global:Ll,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},zl=["navigator","HTMLCanvasElement","WebGLRenderingContext"],Fs=class{constructor(t={}){this.config=Object.freeze(Object.assign({},OA,t)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}_injectPolyfill(t){if(!zl.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${zl}`);for(let e of Object.keys(Ul))t[e]!==void 0?console.warn(`${e} already defined on global.`):t[e]=Ul[e];pp(t.WebGLRenderingContext)&&(dp(t.HTMLCanvasElement),t.OffscreenCanvas&&dp(t.OffscreenCanvas),t.WebGL2RenderingContext&&pp(t.WebGL2RenderingContext),window.isSecureContext||console.warn(`WebXR Polyfill Warning:
This page is not running in a secure context (https:// or localhost)!
This means that although the page may be able to use the WebXR Polyfill it will
not be able to use native WebXR implementations, and as such will not be able to
access dedicated VR or AR hardware, and will not be able to take advantage of
any performance improvements a native WebXR implementation may offer. Please
host this content on a secure origin for the best user experience.
`)),this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let t=tx(this.global,this.config);this.xr=new Ul.XRSystem(t),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(t){if(!zl.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${zl}`);if(t.navigator.xr&&"supportsSession"in t.navigator.xr&&!("isSessionSupported"in t.navigator.xr)){let e=t.navigator.xr.supportsSession;t.navigator.xr.isSessionSupported=function(r){return e.call(this,r).then(()=>!0).catch(()=>!1)},t.navigator.xr.supportsSession=function(r){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),e.call(this,r)}}}};navigator.xr||(console.info("Polyfilling WebXR API"),new Fs);var jl=class extends N{constructor(e,r,o,i,s){super(e);this.mode=r;this.session=o;this.referenceSpaceType=i;this.sessionMode=s}},ql=class extends jl{constructor(t,e,r,o){super("sessionstarted",t,e,r,o)}},Ql=class extends jl{constructor(t,e,r,o){super("sessionstopped",t,e,r,o)}},Xl=new Map([["VR",{referenceSpaceType:"local-floor",sessionMode:"immersive-vr"}],["AR",{referenceSpaceType:"local-floor",sessionMode:"immersive-ar"}]]),Kl=class extends te{constructor(e,r,o,i){super();this.renderer=e;this.camera=r;this.fullscreenElement=o;this.enableFullResolution=i;this._currentMode="None";this.buttons=new Map;this.currentSession=null;this.screenUI=null;this.wasVisible=new Map;this.lastFOV=50;this.addEventListener("sessionstarted",s=>{s.sessionMode==="inline"&&(this.lastFOV=this.camera.fov,this.camera.fov=Ci(s.session.renderState.inlineVerticalFieldOfView))}),this.addEventListener("sessionstopped",s=>{s.sessionMode==="inline"&&(this.camera.fov=this.lastFOV)}),this.renderer.xr.addEventListener("sessionstart",()=>this.onSessionStarted()),this.renderer.xr.addEventListener("sessionend",()=>this.onSessionEnded()),this.refresh()}setUI(e,r,o,i){this.screenUI=e,this.buttons.set(r.mode,r),this.buttons.set(o.mode,o),this.buttons.set(i.mode,i);for(let s of this.buttons.values())this.wasVisible.set(s,s.visible),s.addEventListener("click",this.toggleMode.bind(this,s.mode));r.available=!xn()&&$c(),o.available=Js(),i.available=Ks(),this.refresh()}get visible(){return bt(this.renderer.domElement)}set visible(e){Xe(this.renderer.domElement,e),this.screenUI&&(e?this.screenUI.show():this.screenUI.hide())}get currentMode(){return this._currentMode}resize(){if(!this.renderer.xr.isPresenting){let{clientWidth:e,clientHeight:r,width:o,height:i}=this.renderer.domElement,s=Math.floor(e*devicePixelRatio),a=Math.floor(r*devicePixelRatio);e>0&&r>0&&(o!==s||i!==a)&&(this.renderer.setPixelRatio(devicePixelRatio),this.renderer.setSize(e,r,!1),this.camera.aspect=e/r,this.camera.updateProjectionMatrix())}}getMetrics(){let e=this.renderer.domElement.clientWidth,r=this.renderer.domElement.clientHeight,o=this.renderer.getPixelRatio(),i=this.camera.fov;return{width:e,height:r,pixelRatio:o,fov:i}}setMetrics(e,r,o,i){this.renderer.setPixelRatio(o),this.renderer.setSize(e,r,!1),this.camera.aspect=e/r,this.camera.fov=i,this.camera.updateProjectionMatrix()}async refresh(){let e=Array.from(this.buttons.values()).filter(r=>r.available&&r.mode!=="Fullscreen");await Promise.all(e.map(async r=>{let o=Xl.get(r.mode);if(r.available=w(o),r.available){let i=navigator.xr&&await navigator.xr.isSessionSupported(o.sessionMode),s=!Ks()&&Ku()&&o.sessionMode==="immersive-vr"&&o.referenceSpaceType==="local-floor";r.available=i||s}}))}async toggleMode(e){e==="Fullscreen"?await this.toggleFullscreen():e!=="None"&&await this.toggleXR(e)}async start(e){e!==this.currentMode&&(await this.toggleMode(this.currentMode),await this.toggleMode(e))}async stop(){await this.toggleMode(this.currentMode)}get isFullscreen(){return document.fullscreen}async startFullscreen(){this.isFullscreen||(await this.fullscreenElement.requestFullscreen({navigationUI:"show"}),this.setActive("Fullscreen"),this.dispatchEvent(new ql("Fullscreen",null,null,null)))}async stopFullscreen(){this.isFullscreen&&(await document.exitFullscreen(),this.setActive("None"),this.dispatchEvent(new Ql("Fullscreen",null,null,null)))}async toggleFullscreen(){this.isFullscreen?await this.stopFullscreen():await this.startFullscreen()}async toggleXR(e){let r=Xl.get(e);if(w(r)){if(this.currentSession)this.currentSession.end();else if(navigator.xr){this.camera.position.setScalar(0),this.camera.quaternion.identity();try{let o=await navigator.xr.requestSession(r.sessionMode,{optionalFeatures:["local-floor","bounded-floor","high-refresh-rate","hand-tracking","layers"]});if(this.setActive(e),this.currentSession=o,this.renderer.xr.setReferenceSpaceType(r.referenceSpaceType),this.enableFullResolution&&"XRWebGLLayer"in window&&"getNativeFramebufferScaleFactor"in XRWebGLLayer){let i=XRWebGLLayer.getNativeFramebufferScaleFactor(o);this.renderer.xr.setFramebufferScaleFactor(i)}this.renderer.xr.setSession(o)}catch(o){console.error(`Couldn't start session type '${r.sessionMode}'. Reason: ${o&&o.message||o||"UNKNOWN"}`)}}}}onSessionStarted(){let e=this.currentMode,r=Xl.get(this.currentMode),o=this.currentSession;if(o.supportedFrameRates){let i=Math.max(...o.supportedFrameRates);console.log("Changing framerate to",i),o.updateTargetFrameRate(i)}this.dispatchEvent(new ql(e,o,r.referenceSpaceType,r.sessionMode))}onSessionEnded(){let e=this.currentMode,r=Xl.get(this.currentMode),o=this.currentSession;this.currentSession=null,this.renderer.xr.setSession(null),this.setActive("None"),this.dispatchEvent(new Ql(e,o,r.referenceSpaceType,r.sessionMode))}setActive(e){for(let r of this.buttons.values())r.active=r.mode===e,r.visible=this.wasVisible.get(r)&&(e==="None"||e==="Fullscreen"||r.mode===e);this._currentMode=e}};var nx=new I(0,1,0),at=2048,Go=at/2,WA=[1,0,2,3,4,5],Mn={rows:3,columns:4,indices:[[-1,2,-1,-1],[0,5,1,4],[-1,3,-1,-1]],rotations:[[0,Te,0,0],[0,0,0,0],[0,Te,0,0]]},Jl=new Be(0),Yl=class{constructor(t){this.env=t;this.rt=new vf(at);this.rtScene=new rl;this.rtCamera=new Vh(.01,10,this.rt);this._rotation=new ce;this.layerRotation=new ce().identity();this.stageRotation=new ce().identity();this.canvases=new Array(6);this.contexts=new Array(6);this.layerOrientation=null;this.images=null;this.curImagePath=null;this.layer=null;this.wasVisible=!1;this.stageHeading=0;this.rotationNeedsUpdate=!1;this.imageNeedsUpdate=!1;this.useWebXRLayers=!0;this.wasWebXRLayerAvailable=null;this.visible=!0;this.onNeedsRedraw=()=>this.imageNeedsUpdate=!0,this.env.scene.background=Jl;for(let e=0;e<this.canvases.length;++e){let r=this.canvases[e]=To(at,at);this.contexts[e]=r.getContext("2d",{alpha:!1})}for(let e=0;e<Mn.rows;++e){let r=Mn.indices[e],o=Mn.rotations[e];for(let i=0;i<Mn.columns;++i){let s=r[i];if(s>-1){let a=this.contexts[s],l=o[i];l>0&&(l%2,a.translate(Go,Go),a.rotate(l),a.translate(-Go,-Go))}}}this.rt.texture.name="SkyboxOutput",this.rtScene.add(this.rtCamera),this.flipped=To(at,at),this.flipper=this.flipped.getContext("2d",{alpha:!1}),this.flipper.fillStyle=Jl.getHexString(),this.flipper.scale(-1,1),this.flipper.translate(-at,0),this.setImages("",this.canvases),this.env.addScopedEventListener(this,"update",e=>this.checkWebXRLayer(e.frame)),Object.seal(this)}get envMap(){return this._cube}clear(){this.setImage(null,null)}setImage(t,e){return t!==this.curImagePath?w(e)?(this.sliceImage(e),this.setImages(t,this.canvases)):this.setImages(t,null):null}sliceImage(t){let e=t.width/Mn.columns,r=t.height/Mn.rows;for(let o=0;o<Mn.rows;++o){let i=Mn.indices[o];for(let s=0;s<Mn.columns;++s){let a=i[s];a>-1&&this.contexts[a].drawImage(t,s*e,o*r,e,r,0,0,at,at)}}return this.canvases}setImages(t,e){if((t!==this.curImagePath||e!==this.images)&&(this.curImagePath=t,e!==this.images)){if(w(this._cube)&&(ye(this._cube),this._cube=null),w(this.images))for(let r of this.images)ye(r);this.images=e,w(this.images)?(this.rtScene.background=this._cube=new Oh(this.images),this._cube.name="SkyboxInput"):this.rtScene.background=Jl}return this.updateImages(),this._cube}updateImages(){this._cube.needsUpdate=!0,this.imageNeedsUpdate=!0}get rotation(){return this._rotation}set rotation(t){let{x:e,y:r,z:o,w:i}=this._rotation;if(Ef(t))this._rotation.copy(t);else if(yf(t))this._rotation.setFromEuler(t);else if(jt(t))if(t.length===4&&ge(t[0])&&ge(t[1])&&ge(t[2])&&ge(t[3]))this._rotation.fromArray(t);else throw new Error("Skybox rotation was not a valid array format. Needs an array of 4 numbers.");else lt(t)?this._rotation.setFromAxisAngle(nx,t):(w(t)&&console.warn("Skybox rotation must be a THREE.Quaternion, THREE.Euler, number[] (representing a Quaternion), or a number (representing rotation about the Y-axis)."),this._rotation.identity());this.rotationNeedsUpdate=this._rotation.x!==e||this._rotation.y!==r||this._rotation.z!==o||this._rotation.w!==i}checkWebXRLayer(t){if(this._cube){let e=this.useWebXRLayers&&this.env.hasXRCompositionLayers&&w(t)&&w(this.env.xrBinding),r=e!==this.wasWebXRLayerAvailable;if(r){if(e){let o=this.env.renderer.xr.getReferenceSpace();this.layer=this.env.xrBinding.createCubeLayer({space:o,layout:"mono",isStatic:!1,viewPixelWidth:at,viewPixelHeight:at,orientation:this.layerOrientation}),this.layer.addEventListener("redraw",this.onNeedsRedraw),this.env.addWebXRLayer(this.layer,Number.MAX_VALUE)}else this.layer&&(this.env.removeWebXRLayer(this.layer),this.layer.removeEventListener("redraw",this.onNeedsRedraw),Un(this.layer),this.layer=null);this.imageNeedsUpdate=!0}if(!this.layer||!r){let o=this.visible!==this.wasVisible,i=this.env.avatar.headingRadians!==this.stageHeading;if(this.imageNeedsUpdate=this.imageNeedsUpdate||o||this.layer&&this.layer.needsRedraw,this.rotationNeedsUpdate=this.rotationNeedsUpdate||i,this.env.scene.background=this.layer?null:this.visible?this.rt.texture:Jl,this.rotationNeedsUpdate&&(this.layerRotation.copy(this.rotation).invert(),this.stageRotation.setFromAxisAngle(nx,this.env.avatar.headingRadians).premultiply(this.layerRotation),this.layerOrientation=new DOMPointReadOnly(this.stageRotation.x,this.stageRotation.y,this.stageRotation.z,this.stageRotation.w),this.layer?this.layer.orientation=this.layerOrientation:(this.rtCamera.quaternion.copy(this.layerRotation),this.imageNeedsUpdate=!0)),this.imageNeedsUpdate)if(this.layer){let s=this.env.renderer.getContext(),a=this.env.xrBinding.getSubImage(this.layer,t),l=this._cube.images;this.flipper.fillRect(0,0,at,at),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.bindTexture(s.TEXTURE_CUBE_MAP,a.colorTexture);for(let p=0;p<l.length;++p){if(this.visible){let m=l[WA[p]];this.flipper.drawImage(m,0,0,m.width,m.height,0,0,at,at)}s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.flipped)}s.bindTexture(s.TEXTURE_CUBE_MAP,null)}else this.rtCamera.update(this.env.renderer,this.rtScene);this.stageHeading=this.env.avatar.headingRadians,this.imageNeedsUpdate=!1,this.rotationNeedsUpdate=!1,this.wasVisible=this.visible}this.wasWebXRLayerAvailable=e}}};var Uo=new I,rx=0,HA=new I,Zl=new I,Fp=new I,$l=new ce,ox=0,NA=0;function GA(n,t){let e=n-t,r=e+ut,o=e-ut;return Sh(e,r,o)}var As=class extends Ee{constructor(e,r,o,i,s=1){super();this.minDistance=r;this.heightOffset=i;this.speed=s;this.name=e,this.lerp=this.minHeadingRadians>0||this.minDistance>0,this.maxDistance=this.minDistance*5,this.minHeadingRadians=$e(o),this.maxHeadingRadians=Te-this.minHeadingRadians,Object.seal(this)}copy(e,r=!0){return super.copy(e,r),this.name=e.name+ ++NA,this.lerp=e.lerp,this.maxDistance=e.maxDistance,this.minHeadingRadians=e.minHeadingRadians,this.maxHeadingRadians=e.maxHeadingRadians,this}update(e,r,o,i){i*=.001,this.clampTo(this.lerp,e,r,this.minDistance,this.maxDistance,o,this.minHeadingRadians,this.maxHeadingRadians,i)}reset(e,r,o){this.clampTo(!1,e,r,0,0,o,0,0,0)}clampTo(e,r,o,i,s,a,l,p,m){Uo.copy(o),Uo.y-=this.heightOffset*r,rx=a,this.getWorldPosition(Zl),this.getWorldDirection(Fp),Fp.negate(),ox=es(Fp),$l.identity();let g=!e,F=!e;if(e){let S=HA.copy(Uo).sub(Zl).length();i<S&&(S<s&&Uo.lerpVectors(Zl,Uo,this.speed*m),g=!0);let M=GA(rx,ox),k=Math.abs(M);l<k&&(k<p?$l.setFromAxisAngle(this.up,M*this.speed*m):$l.setFromAxisAngle(this.up,M),F=!0)}(g||F)&&(g&&this.position.add(Uo.sub(Zl)),F&&this.quaternion.multiply($l))}};var eu=class extends N{constructor(e,r){super(e);this.button=r}},Ap=class extends eu{constructor(t){super("gamepadbuttonup",t)}},vp=class extends eu{constructor(t){super("gamepadbuttondown",t)}},Sp=class extends N{constructor(e,r,o){super(e);this.axis=r;this.value=o}},bp=class extends Sp{constructor(t,e){super("gamepadaxismaxed",t,e)}},tu=class extends te{constructor(){super();this.lastAxisValues=new Array;this.btnDownEvts=new Array;this.btnUpEvts=new Array;this.wasPressed=new Array;this.axisMaxEvts=new Array;this.wasAxisMaxed=new Array;this.sticks=new Array;this.axisThresholdMax=.9;this.axisThresholdMin=.1;this._pad=null;Object.seal(this)}get displayId(){if("displayId"in this.pad)return this.pad.displayId}get pad(){return this._pad}set pad(e){if(this._pad=e,this.pad){if(this.btnUpEvts.length===0){for(let r=0;r<e.buttons.length;++r)this.btnDownEvts[r]=new vp(r),this.btnUpEvts[r]=new Ap(r),this.wasPressed[r]=!1;for(let r=0;r<e.axes.length;++r)this.axisMaxEvts[r]=new bp(r,0),this.wasAxisMaxed[r]=!1,r%2===0&&r<e.axes.length-1&&(this.sticks[r/2]={x:0,y:0}),this.lastAxisValues[r]=e.axes[r]}for(let r=0;r<this.pad.buttons.length;++r){let o=this.wasPressed[r],i=this.pad.buttons[r].pressed;i!==o&&(this.wasPressed[r]=i,this.dispatchEvent((i?this.btnDownEvts:this.btnUpEvts)[r]))}for(let r=0;r<this.pad.axes.length;++r){let o=this.wasAxisMaxed[r],i=this.pad.axes[r],s=Math.sign(i),a=Math.abs(i),l=a>=this.axisThresholdMax,p=a<=this.axisThresholdMin,m=s*(l?1:p?0:a);l&&!o&&(this.axisMaxEvts[r].value=m,this.dispatchEvent(this.axisMaxEvts[r])),this.wasAxisMaxed[r]=l,this.lastAxisValues[r]=m}for(let r=0;r<this.axes.length-1;r+=2){let o=this.sticks[r/2];o.x=this.axes[r],o.y=this.axes[r+1]}}}get id(){return this.pad?this.pad.id:null}get index(){return this.pad?this.pad.index:null}get connected(){return this.pad&&this.pad.connected}get mapping(){return this.pad?this.pad.mapping:null}get timestamp(){return this.pad?this.pad.timestamp:null}get hand(){return this.pad?this.pad.hand:null}get pose(){return this.pad?this.pad.pose:null}get buttons(){return this.pad?this.pad.buttons:null}get axes(){return this.pad?this.pad.axes:null}get hapticActuators(){return this.pad?this.pad.hapticActuators:null}};var nu=class extends yo{constructor(t){super(t)}start(){this.timer=setInterval(()=>this.onTick(performance.now()),this.targetFrameTime)}stop(){this.timer&&(clearInterval(this.timer),super.stop())}get targetFPS(){return super.targetFPS}set targetFPS(t){super.targetFPS=t,this.isRunning&&this.restart()}};var _p=class extends N{constructor(){super("activity");this.level=0}},vs=class extends lo{constructor(e){super(e,{fftSize:32,minDecibels:-70});this._level=0;this.maxLevel=0;this.activityEvt=new _p;this.timer=new nu(30);let r=new Uint8Array(this.frequencyBinCount);this.timer.addTickHandler(()=>{this.getByteFrequencyData(r),this._level=Math.max(...r),isFinite(this._level)&&(this.maxLevel=Math.max(this.maxLevel,this._level),this.maxLevel>0&&(this._level/=this.maxLevel)),this.activityEvt.level=this.level,this.dispatchEvent(this.activityEvt)})}get level(){return this._level}start(){this.timer.start()}stop(){this.timer.stop()}};var zo=new I;function Tp(n,t,e,r){zo.crossVectors(t,n),n.crossVectors(zo,t),zo.normalize(),n.normalize(),t.normalize(),r.set(zo.x,n.x,-t.x,e.x,zo.y,n.y,-t.y,e.y,zo.z,n.z,-t.z,e.z,0,0,0,1)}var Xo=class{constructor(){this._visible=!0;this._style="default"}get style(){return this._style}set style(t){this._style=t}get visible(){return this._visible}set visible(t){this._visible=t}};var ar=class extends Xo{constructor(e){super();this.env=e;this._object=null;this.T=new I;this.V=new I;this.Q=new ce;this._side=-1;this.f=new I;this.up=new I;this.right=new I}get side(){return this._side}set side(e){this._side=e}get object(){return this._object}set object(e){this._object=e}get position(){return this.object.position}update(e,r,o,i,s,a,l,p,m,g,F){o&&o.face?(this.position.copy(o.point),o.object.getWorldQuaternion(this.Q),this.T.copy(o.face.normal).applyQuaternion(this.Q),this.V.copy(this.T).multiplyScalar(.02),this.position.add(this.V),this.V.copy(this.T).multiplyScalar(10).add(this.position)):(a?this.position.copy(g).multiplyScalar(2).add(m).sub(this.env.avatar.worldPos).normalize().multiplyScalar(s).add(this.env.avatar.worldPos):(this.V.copy(m).add(r).sub(e).multiplyScalar(2),this.position.copy(g).multiplyScalar(s).add(this.V).add(this.env.avatar.worldPos)),this.V.copy(this.env.avatar.worldPos)),this.lookAt(this.position,this.V),this.style=!i||i.navigable&&!p?l?F?"grabbing":"grab":"default":i.enabled?i.draggable?F?"grabbing":"move":i.navigable?"cell":i.clickable?"pointer":"default":"not-allowed"}lookAt(e,r){this.f.copy(r).sub(e).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat),this.right.crossVectors(this.up,this.f),this.up.crossVectors(this.f,this.right),Tp(this.up,this.f,e,this.object.matrixWorld),this.object.matrix.copy(this.object.parent.matrixWorld).invert().multiply(this.object.matrixWorld),this.object.matrix.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.scale.x*=this.side,this.object.matrix.compose(this.object.position,this.object.quaternion,this.object.scale)}};var jr=class extends ar{constructor(e){super(e);this.material=Uf({name:"CursorMat",color:16776960}),this.object=new on(.01,.01,.01,this.material)}get style(){return this._currentStyle}set style(e){if(this._currentStyle=e,xt(this.object)&&!jt(this.object.material))switch(this._currentStyle){case"pointer":this.material.color=new Be(65280),this.material.needsUpdate=!0;break;case"not-allowed":this.material.color=new Be(16711680),this.material.needsUpdate=!0;break;case"move":this.material.color=new Be(255),this.material.needsUpdate=!0;break;case"grab":this.material.color=new Be(16711935),this.material.needsUpdate=!0;break;case"grabbing":this.material.color=new Be(65535),this.material.needsUpdate=!0;break;default:this._currentStyle="default",this.material.color=new Be(16776960),this.material.needsUpdate=!0;break}}get visible(){return Lo(this)}set visible(e){Pe(this,e)}};var ix=new Tr,ru=new I,qr=class extends Xh{constructor(){super(),this.type="LineSegmentsGeometry";let t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],r=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(r),this.setAttribute("position",new Ka(t,3)),this.setAttribute("uv",new Ka(e,2))}applyMatrix4(t){let e=this.attributes.instanceStart,r=this.attributes.instanceEnd;return e!==void 0&&(e.applyMatrix4(t),r.applyMatrix4(t),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let r=new Pi(e,6,1);return this.setAttribute("instanceStart",new Ht(r,3,0)),this.setAttribute("instanceEnd",new Ht(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let r=new Pi(e,6,1);return this.setAttribute("instanceColorStart",new Ht(r,3,0)),this.setAttribute("instanceColorEnd",new Ht(r,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new bf(t.geometry)),this}fromLineSegments(t){let e=t.geometry;if(e.isGeometry){console.error("LineSegmentsGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Tr);let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;t!==void 0&&e!==void 0&&(this.boundingBox.setFromBufferAttribute(t),ix.setFromBufferAttribute(e),this.boundingBox.union(ix))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Do),this.boundingBox===null&&this.computeBoundingBox();let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(t!==void 0&&e!==void 0){let r=this.boundingSphere.center;this.boundingBox.getCenter(r);let o=0;for(let i=0,s=t.count;i<s;i++)ru.fromBufferAttribute(t,i),o=Math.max(o,r.distanceToSquared(ru)),ru.fromBufferAttribute(e,i),o=Math.max(o,r.distanceToSquared(ru));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(t){return console.warn("LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}};qr.prototype.isLineSegmentsGeometry=!0;var sx=new I,ax=new I,qe=new rn,Qe=new rn,un=new rn,Ep=new I,yp=new xe,Ct=new Kh,lx=new I,kn=new Tr,ou=new Do,cn=new rn;function ux(n,t,e,r){return cn.set(0,0,-t,1).applyMatrix4(n.projectionMatrix),cn.multiplyScalar(1/cn.w),cn.x=e/r.width,cn.y=e/r.height,cn.applyMatrix4(n.projectionMatrixInverse),cn.multiplyScalar(1/cn.w),Math.abs(Math.max(cn.x,cn.y))}var Ss=class extends Nt{constructor(t=new qr,e=new vn({color:Math.random()*16777215})){super(t,e),this.type="LineSegments2"}computeLineDistances(){let t=this.geometry,e=t.attributes.instanceStart,r=t.attributes.instanceEnd,o=new Float32Array(2*e.count);for(let s=0,a=0,l=e.count;s<l;s++,a+=2)sx.fromBufferAttribute(e,s),ax.fromBufferAttribute(r,s),o[a]=a===0?0:o[a-1],o[a+1]=o[a]+sx.distanceTo(ax);let i=new Pi(o,2,1);return t.setAttribute("instanceDistanceStart",new Ht(i,1,0)),t.setAttribute("instanceDistanceEnd",new Ht(i,1,1)),this}raycast(t,e){t.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');let r=t.params.Line2!==void 0&&t.params.Line2.threshold||0,o=t.ray,i=t.camera,s=i.projectionMatrix,a=this.matrixWorld,l=this.geometry,p=this.material,m=p.resolution,g=p.linewidth+r,F=l.attributes.instanceStart,S=l.attributes.instanceEnd,M=-i.near;l.boundingSphere===null&&l.computeBoundingSphere(),ou.copy(l.boundingSphere).applyMatrix4(a);let k=Math.max(i.near,ou.distanceToPoint(o.origin)),E=ux(i,k,g,m);if(ou.radius+=E,t.ray.intersectsSphere(ou)===!1)return;l.boundingBox===null&&l.computeBoundingBox(),kn.copy(l.boundingBox).applyMatrix4(a);let R=Math.max(i.near,kn.distanceToPoint(o.origin)),W=ux(i,R,g,m);if(kn.max.x+=W,kn.max.y+=W,kn.max.z+=W,kn.min.x-=W,kn.min.y-=W,kn.min.z-=W,t.ray.intersectsBox(kn)!==!1){o.at(1,un),un.w=1,un.applyMatrix4(i.matrixWorldInverse),un.applyMatrix4(s),un.multiplyScalar(1/un.w),un.x*=m.x/2,un.y*=m.y/2,un.z=0,Ep.copy(un),yp.multiplyMatrices(i.matrixWorldInverse,a);for(let B=0,G=F.count;B<G;B++){qe.fromBufferAttribute(F,B),Qe.fromBufferAttribute(S,B),qe.w=1,Qe.w=1,qe.applyMatrix4(yp),Qe.applyMatrix4(yp);var V=qe.z>M&&Qe.z>M;if(V)continue;if(qe.z>M){let j=qe.z-Qe.z,ee=(qe.z-M)/j;qe.lerp(Qe,ee)}else if(Qe.z>M){let j=Qe.z-qe.z,ee=(Qe.z-M)/j;Qe.lerp(qe,ee)}qe.applyMatrix4(s),Qe.applyMatrix4(s),qe.multiplyScalar(1/qe.w),Qe.multiplyScalar(1/Qe.w),qe.x*=m.x/2,qe.y*=m.y/2,Qe.x*=m.x/2,Qe.y*=m.y/2,Ct.start.copy(qe),Ct.start.z=0,Ct.end.copy(Qe),Ct.end.z=0;let D=Ct.closestPointToPointParameter(Ep,!0);Ct.at(D,lx);let O=el.lerp(qe.z,Qe.z,D),ne=O>=-1&&O<=1,ae=Ep.distanceTo(lx)<g*.5;if(ne&&ae){Ct.start.fromBufferAttribute(F,B),Ct.end.fromBufferAttribute(S,B),Ct.start.applyMatrix4(a),Ct.end.applyMatrix4(a);let j=new I,ee=new I;o.distanceSqToSegment(Ct.start,Ct.end,ee,j),e.push({point:ee,pointOnLine:j,distance:o.origin.distanceTo(ee),object:this,face:null,faceIndex:B,uv:null,uv2:null})}}}}};Ss.prototype.isLineSegments2=!0;var Qr=class extends qr{constructor(){super(),this.type="LineGeometry"}setPositions(t){for(var e=t.length-3,r=new Float32Array(2*e),o=0;o<e;o+=3)r[2*o]=t[o],r[2*o+1]=t[o+1],r[2*o+2]=t[o+2],r[2*o+3]=t[o+3],r[2*o+4]=t[o+4],r[2*o+5]=t[o+5];return super.setPositions(r),this}setColors(t){for(var e=t.length-3,r=new Float32Array(2*e),o=0;o<e;o+=3)r[2*o]=t[o],r[2*o+1]=t[o+1],r[2*o+2]=t[o+2],r[2*o+3]=t[o+3],r[2*o+4]=t[o+4],r[2*o+5]=t[o+5];return super.setColors(r),this}fromLine(t){var e=t.geometry;if(e.isGeometry){console.error("LineGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}};Qr.prototype.isLineGeometry=!0;var bs=class extends Ss{constructor(t=new Qr,e=new vn({color:Math.random()*16777215})){super(t,e),this.type="Line2"}};bs.prototype.isLine2=!0;var cx=new Qr;cx.setPositions([0,0,0,0,0,-1]);var _s=class extends Ee{constructor(e,r,o){super();this._length=1;this.line=new bs(cx,zf({color:e,transparent:r<1,opacity:r,linewidth:o})),this.line.computeLineDistances(),U(this,this.line)}get length(){return this._length}set length(e){this._length=e,this.line.scale.set(1,1,e)}};var pn=(m=>(m[m.LocalUser=0]="LocalUser",m[m.Mouse=1]="Mouse",m[m.Pen=2]="Pen",m[m.Touch=3]="Touch",m[m.Gamepad=4]="Gamepad",m[m.MotionController=5]="MotionController",m[m.MotionControllerLeft=6]="MotionControllerLeft",m[m.MotionControllerRight=7]="MotionControllerRight",m[m.Nose=8]="Nose",m[m.RemoteUser=9]="RemoteUser",m))(pn||{});var iu=class extends Xo{constructor(e){super();this.element=e;this._hidden=!1;this.visible=!0,this.style="default",document.addEventListener("pointerlockchange",()=>{this._hidden=!!document.pointerLockElement,this.refresh()})}get style(){return super.style}set style(e){super.style=e,this.refresh()}get visible(){return super.visible&&!this._hidden}set visible(e){super.visible=e,this.refresh()}refresh(){this.element.style.cursor=this.visible?this.style:"none"}};var jo=class extends ar{constructor(e){super(e);this.xr=e.cursor3D&&e.cursor3D.clone()||new jr(this.env),this.system=new iu(this.env.renderer.domElement),this.xr.side=this.side,this.visible=!1,Object.seal(this)}get object(){return this.xr.object}get side(){return this.xr.side}set side(e){this.xr.side=e}get cursor(){return this.xr}set cursor(e){this.xr=e,this._refresh()}get style(){return this.system.style}get visible(){return super.visible}set visible(e){super.visible=e,this._refresh()}set style(e){this.system.style=e,this.xr.style=e,this._refresh()}_refresh(){let e=this.env.eventSys&&this.env.eventSys.mouse&&this.env.eventSys.mouse.isPointerLocked,r=this.env.renderer.xr.isPresenting||e;Pe(this.xr,this.visible&&r),this.system.visible=this.visible&&!r}lookAt(e,r){this.xr.lookAt(e,r)}};var su=class extends N{constructor(e,r){super(e);this.pointer=r;this._hit=null;this._point=null;this._distance=Number.POSITIVE_INFINITY;this._rayTarget=null;Object.seal(this)}set(e,r){e!==this.hit&&(this._hit=e,e?(this._point=e.point,this._distance=e.distance):(this._point=null,this._distance=Number.POSITIVE_INFINITY)),this._rayTarget=r}get hit(){return this._hit}get rayTarget(){return this._rayTarget}get point(){return this._point}get distance(){return this._distance}};var UA=5,zA=new I,Cn=class extends te{constructor(e,r,o,i){super();this.type=e;this.id=r;this.env=o;this.origin=new I;this.direction=new I;this.up=new I(0,1,0);this.canMoveView=!1;this.mayTeleport=!1;this.buttons=0;this._isActive=!1;this.moveDistance=0;this.pointerEvents=new Map;this.lastButtons=0;this.canClick=!1;this.dragDistance=0;this._enabled=!1;this._cursor=null;this._curHit=null;this._curTarget=null;this._hoveredHit=null;this._hoveredTarget=null;this._cursor=i,this.cursor&&(this.cursor.visible=!1)}get isActive(){return this._isActive}get canSend(){return this.enabled&&this.isActive}get curHit(){return this._curHit}get curTarget(){return this._curTarget}get hoveredHit(){return this._hoveredHit}set hoveredHit(e){if(e!==this.hoveredHit){let r=Ji(e);this._hoveredHit=e,this._hoveredTarget=r}}get name(){return pn[this.id]}get rayTarget(){return this._hoveredTarget}get cursor(){return this._cursor}set cursor(e){if(e!==this.cursor){let r=this.cursor,o=this.cursor&&this.cursor.object&&this.cursor.object.name||"cursor",i=r&&r.object&&r.object.parent;i&&r.object.removeFromParent(),e&&(e.object.name=o,r instanceof jo?(r.cursor=e,i&&U(i,r)):(this._cursor=e,r&&(i&&U(i,e),e.style=r.style,e.visible=r.visible)))}}get needsUpdate(){return this.enabled&&this._isActive}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.cursor&&(this.cursor.visible=e)}setButton(e,r){this.lastButtons=this.buttons;let o=1<<e;if(r?this.buttons|=o:this.buttons&=~o,r)this.canClick=!0,this.dragDistance=0,this.env.avatar.setMode(this),this.setEventState("down");else{if(this.canClick){let i=this.buttons;this.buttons=this.lastButtons,this.setEventState("click"),this.buttons=i}this.setEventState("up")}}isPressed(e){let r=1<<e;return(this.buttons&r)!==0}wasPressed(e){let r=1<<e;return(this.lastButtons&r)!==0}fireRay(e,r){let o=this.env.eventSys.fireRay(e,r);if(o!==this.curHit){let i=Ji(o);this._curHit=o,this._curTarget=i}}getEvent(e){this.pointerEvents.has(e)||this.pointerEvents.set(e,new su(e,this));let r=this.pointerEvents.get(e);if(this.hoveredHit?r.set(this.hoveredHit,this.rayTarget):this.curHit?r.set(this.curHit,this.curTarget):r.set(null,null),r.hit){let o=this.curHit||this.hoveredHit;o&&r.hit!==o&&(r.hit.uv=o.uv)}return r}update(){this.needsUpdate&&this.onUpdate()}onUpdate(){this.updatePointerOrientation();let e=this.isPressed(0);(this.moveDistance>0||e)&&(e&&(this.dragDistance+=this.moveDistance,this.dragDistance>UA&&(this.canClick=!1)),this.setEventState("move")),this.moveDistance=0}setEventState(e){if(this.fireRay(this.origin,this.direction),this.curTarget===this.rayTarget)this.hoveredHit=this.curHit;else{let o=this.isPressed(0),i=this.wasPressed(0);if(e==="move"&&!o||e==="down"&&o&&!i||e==="up"&&!o&&i){if(this.rayTarget){let p=this.getEvent("up");this.rayTarget.dispatchEvent(p);let m=this.getEvent("exit");this.dispatchEvent(m),this.rayTarget.dispatchEvent(m)}if(this.hoveredHit=this.curHit,this.rayTarget){let p=this.getEvent("enter");this.dispatchEvent(p),this.rayTarget.dispatchEvent(p)}}this.hoveredHit&&this.hoveredHit.point.copy(this.direction).multiplyScalar(this.hoveredHit.distance).add(this.origin)}let r=this.getEvent(e);this.dispatchEvent(r),r.rayTarget&&(e!=="click"||r.rayTarget.clickable||r.rayTarget.navigable)&&(e==="click"&&r.rayTarget.clickable&&this.vibrate(),r.rayTarget.enabled&&r.rayTarget.dispatchEvent(r)),this.updateCursor(this.env.avatar.worldPos,zA,!0,2)}get canDragView(){return this.canMoveView}get canTeleport(){return this.mayTeleport}updateCursor(e,r,o,i){this.cursor&&this.cursor.update(e,r,this.hoveredHit||this.curHit,this.rayTarget||this.curTarget,i,o,this.canDragView,this.canTeleport,this.origin,this.direction,this.isPressed(0))}get bufferSize(){return 37}writeState(e){e.writeUint8(this.id),e.writeVector48(this.origin),e.writeVector48(this.direction),e.writeVector48(this.up)}};var XA=.2,WO=.5*XA-.025;var c7={fontFamily:Zr(),fontSize:20,fontWeight:"bold",textFillColor:"white",textStrokeColor:"black",textStrokeSize:.01,padding:{top:.025,right:.05,bottom:.025,left:.05},maxHeight:.2};var Mp=["none","right","left"];function kp(n,t){if(t===wf)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(t===Oi||t===il){let e=n.getIndex();if(e===null){let s=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)s.push(l);n.setIndex(s),e=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}let r=e.count-2,o=[];if(t===Oi)for(let s=1;s<=r;s++)o.push(e.getX(0)),o.push(e.getX(s)),o.push(e.getX(s+1));else for(let s=0;s<r;s++)s%2===0?(o.push(e.getX(s)),o.push(e.getX(s+1)),o.push(e.getX(s+2))):(o.push(e.getX(s+2)),o.push(e.getX(s+1)),o.push(e.getX(s)));o.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let i=n.clone();return i.setIndex(o),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),n}var cr=class extends ef{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new Ip(e)}),this.register(function(e){return new Up(e)}),this.register(function(e){return new zp(e)}),this.register(function(e){return new Xp(e)}),this.register(function(e){return new Op(e)}),this.register(function(e){return new Wp(e)}),this.register(function(e){return new Hp(e)}),this.register(function(e){return new Np(e)}),this.register(function(e){return new Rp(e)}),this.register(function(e){return new Gp(e)}),this.register(function(e){return new Vp(e)}),this.register(function(e){return new Bp(e)}),this.register(function(e){return new jp(e)}),this.register(function(e){return new qp(e)})}load(t,e,r,o){let i=this,s;this.resourcePath!==""?s=this.resourcePath:this.path!==""?s=this.path:s=Za.extractUrlBase(t),this.manager.itemStart(t);let a=function(p){o?o(p):console.error(p),i.manager.itemError(t),i.manager.itemEnd(t)},l=new wc(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(t,function(p){try{i.parse(p,s,function(m){e(m),i.manager.itemEnd(t)},a)}catch(m){a(m)}},r,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,r,o){let i,s={},a={},l=new TextDecoder;if(typeof t=="string")i=JSON.parse(t);else if(t instanceof ArrayBuffer)if(l.decode(new Uint8Array(t,0,4))===fx){try{s[Y.KHR_BINARY_GLTF]=new Qp(t)}catch(g){o&&o(g);return}i=JSON.parse(s[Y.KHR_BINARY_GLTF].content)}else i=JSON.parse(l.decode(t));else i=t;if(i.asset===void 0||i.asset.version[0]<2){o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let p=new td(i,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});p.fileLoader.setRequestHeader(this.requestHeader);for(let m=0;m<this.pluginCallbacks.length;m++){let g=this.pluginCallbacks[m](p);a[g.name]=g,s[g.name]=!0}if(i.extensionsUsed)for(let m=0;m<i.extensionsUsed.length;++m){let g=i.extensionsUsed[m],F=i.extensionsRequired||[];switch(g){case Y.KHR_MATERIALS_UNLIT:s[g]=new Pp;break;case Y.KHR_DRACO_MESH_COMPRESSION:s[g]=new Kp(i,this.dracoLoader);break;case Y.KHR_TEXTURE_TRANSFORM:s[g]=new Jp;break;case Y.KHR_MESH_QUANTIZATION:s[g]=new Yp;break;default:F.indexOf(g)>=0&&a[g]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+g+'".')}}p.setExtensions(s),p.setPlugins(a),p.parse(r,o)}parseAsync(t,e){let r=this;return new Promise(function(o,i){r.parse(t,e,o,i)})}};function qA(){let n={};return{get:function(t){return n[t]},add:function(t,e){n[t]=e},remove:function(t){delete n[t]},removeAll:function(){n={}}}}var Y={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"},Bp=class{constructor(t){this.parser=t,this.name=Y.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let t=this.parser,e=this.parser.json.nodes||[];for(let r=0,o=e.length;r<o;r++){let i=e[r];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){let e=this.parser,r="light:"+t,o=e.cache.get(r);if(o)return o;let i=e.json,l=((i.extensions&&i.extensions[this.name]||{}).lights||[])[t],p,m=new Be(16777215);l.color!==void 0&&m.fromArray(l.color);let g=l.range!==void 0?l.range:0;switch(l.type){case"directional":p=new Qa(m),p.target.position.set(0,0,-1),p.add(p.target);break;case"point":p=new lf(m),p.distance=g;break;case"spot":p=new gf(m),p.distance=g,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,p.angle=l.spot.outerConeAngle,p.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,p.target.position.set(0,0,-1),p.add(p.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return p.position.set(0,0,0),p.decay=2,ur(p,l),l.intensity!==void 0&&(p.intensity=l.intensity),p.name=e.createUniqueName(l.name||"light_"+t),o=Promise.resolve(p),e.cache.add(r,o),o}getDependency(t,e){if(t==="light")return this._loadLight(e)}createNodeAttachment(t){let e=this,r=this.parser,i=r.json.nodes[t],a=(i.extensions&&i.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return r._getNodeRef(e.cache,a,l)})}},Pp=class{constructor(){this.name=Y.KHR_MATERIALS_UNLIT}getMaterialType(){return ot}extendParams(t,e,r){let o=[];t.color=new Be(1,1,1),t.opacity=1;let i=e.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){let s=i.baseColorFactor;t.color.fromArray(s),t.opacity=s[3]}i.baseColorTexture!==void 0&&o.push(r.assignTexture(t,"map",i.baseColorTexture,Co))}return Promise.all(o)}},Rp=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){let o=this.parser.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=o.extensions[this.name].emissiveStrength;return i!==void 0&&(e.emissiveIntensity=i),Promise.resolve()}},Ip=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:Kn}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[],s=o.extensions[this.name];if(s.clearcoatFactor!==void 0&&(e.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&i.push(r.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&i.push(r.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(i.push(r.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){let a=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new He(a,a)}return Promise.all(i)}},Vp=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:Kn}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[],s=o.extensions[this.name];return s.iridescenceFactor!==void 0&&(e.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&i.push(r.assignTexture(e,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(e.iridescenceIOR=s.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&i.push(r.assignTexture(e,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(i)}},Op=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_SHEEN}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:Kn}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[];e.sheenColor=new Be(0,0,0),e.sheenRoughness=0,e.sheen=1;let s=o.extensions[this.name];return s.sheenColorFactor!==void 0&&e.sheenColor.fromArray(s.sheenColorFactor),s.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&i.push(r.assignTexture(e,"sheenColorMap",s.sheenColorTexture,Co)),s.sheenRoughnessTexture!==void 0&&i.push(r.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(i)}},Wp=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:Kn}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[],s=o.extensions[this.name];return s.transmissionFactor!==void 0&&(e.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&i.push(r.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(i)}},Hp=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_VOLUME}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:Kn}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[],s=o.extensions[this.name];e.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&i.push(r.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||1/0;let a=s.attenuationColor||[1,1,1];return e.attenuationColor=new Be(a[0],a[1],a[2]),Promise.all(i)}},Np=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_IOR}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:Kn}extendMaterialParams(t,e){let o=this.parser.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=o.extensions[this.name];return e.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}},Gp=class{constructor(t){this.parser=t,this.name=Y.KHR_MATERIALS_SPECULAR}getMaterialType(t){let r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:Kn}extendMaterialParams(t,e){let r=this.parser,o=r.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let i=[],s=o.extensions[this.name];e.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&i.push(r.assignTexture(e,"specularIntensityMap",s.specularTexture));let a=s.specularColorFactor||[1,1,1];return e.specularColor=new Be(a[0],a[1],a[2]),s.specularColorTexture!==void 0&&i.push(r.assignTexture(e,"specularColorMap",s.specularColorTexture,Co)),Promise.all(i)}},Up=class{constructor(t){this.parser=t,this.name=Y.KHR_TEXTURE_BASISU}loadTexture(t){let e=this.parser,r=e.json,o=r.textures[t];if(!o.extensions||!o.extensions[this.name])return null;let i=o.extensions[this.name],s=e.options.ktx2Loader;if(!s){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,i.source,s)}},zp=class{constructor(t){this.parser=t,this.name=Y.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){let e=this.name,r=this.parser,o=r.json,i=o.textures[t];if(!i.extensions||!i.extensions[e])return null;let s=i.extensions[e],a=o.images[s.source],l=r.textureLoader;if(a.uri){let p=r.options.manager.getHandler(a.uri);p!==null&&(l=p)}return this.detectSupport().then(function(p){if(p)return r.loadTextureImage(t,s.source,l);if(o.extensionsRequired&&o.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){let e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}},Xp=class{constructor(t){this.parser=t,this.name=Y.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){let e=this.name,r=this.parser,o=r.json,i=o.textures[t];if(!i.extensions||!i.extensions[e])return null;let s=i.extensions[e],a=o.images[s.source],l=r.textureLoader;if(a.uri){let p=r.options.manager.getHandler(a.uri);p!==null&&(l=p)}return this.detectSupport().then(function(p){if(p)return r.loadTextureImage(t,s.source,l);if(o.extensionsRequired&&o.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){let e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}},jp=class{constructor(t){this.name=Y.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){let e=this.parser.json,r=e.bufferViews[t];if(r.extensions&&r.extensions[this.name]){let o=r.extensions[this.name],i=this.parser.getDependency("buffer",o.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(a){let l=o.byteOffset||0,p=o.byteLength||0,m=o.count,g=o.byteStride,F=new Uint8Array(a,l,p);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(m,g,F,o.mode,o.filter).then(function(S){return S.buffer}):s.ready.then(function(){let S=new ArrayBuffer(m*g);return s.decodeGltfBuffer(new Uint8Array(S),m,g,F,o.mode,o.filter),S})})}else return null}},qp=class{constructor(t){this.name=Y.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){let e=this.parser.json,r=e.nodes[t];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;let o=e.meshes[r.mesh];for(let p of o.primitives)if(p.mode!==Dt.TRIANGLES&&p.mode!==Dt.TRIANGLE_STRIP&&p.mode!==Dt.TRIANGLE_FAN&&p.mode!==void 0)return null;let s=r.extensions[this.name].attributes,a=[],l={};for(let p in s)a.push(this.parser.getDependency("accessor",s[p]).then(m=>(l[p]=m,l[p])));return a.length<1?null:(a.push(this.parser.createNodeMesh(t)),Promise.all(a).then(p=>{let m=p.pop(),g=m.isGroup?m.children:[m],F=p[0].count,S=[];for(let M of g){let k=new xe,E=new I,R=new ce,W=new I(1,1,1),V=new Ya(M.geometry,M.material,F);for(let B=0;B<F;B++)l.TRANSLATION&&E.fromBufferAttribute(l.TRANSLATION,B),l.ROTATION&&R.fromBufferAttribute(l.ROTATION,B),l.SCALE&&W.fromBufferAttribute(l.SCALE,B),V.setMatrixAt(B,k.compose(E,R,W));for(let B in l)B!=="TRANSLATION"&&B!=="ROTATION"&&B!=="SCALE"&&M.geometry.setAttribute(B,l[B]);Ee.prototype.copy.call(V,M),this.parser.assignFinalMaterial(V),S.push(V)}return m.isGroup?(m.clear(),m.add(...S),m):S[0]}))}},fx="glTF",Ts=12,px={JSON:1313821514,BIN:5130562},Qp=class{constructor(t){this.name=Y.KHR_BINARY_GLTF,this.content=null,this.body=null;let e=new DataView(t,0,Ts),r=new TextDecoder;if(this.header={magic:r.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==fx)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let o=this.header.length-Ts,i=new DataView(t,Ts),s=0;for(;s<o;){let a=i.getUint32(s,!0);s+=4;let l=i.getUint32(s,!0);if(s+=4,l===px.JSON){let p=new Uint8Array(t,Ts+s,a);this.content=r.decode(p)}else if(l===px.BIN){let p=Ts+s;this.body=t.slice(p,p+a)}s+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},Kp=class{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Y.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){let r=this.json,o=this.dracoLoader,i=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,a={},l={},p={};for(let m in s){let g=$p[m]||m.toLowerCase();a[g]=s[m]}for(let m in t.attributes){let g=$p[m]||m.toLowerCase();if(s[m]!==void 0){let F=r.accessors[t.attributes[m]],S=qo[F.componentType];p[g]=S.name,l[g]=F.normalized===!0}}return e.getDependency("bufferView",i).then(function(m){return new Promise(function(g){o.decodeDracoFile(m,function(F){for(let S in F.attributes){let M=F.attributes[S],k=l[S];k!==void 0&&(M.normalized=k)}g(F)},a,p)})})}},Jp=class{constructor(){this.name=Y.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return(e.texCoord===void 0||e.texCoord===t.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.texCoord!==void 0&&(t.channel=e.texCoord),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}},Yp=class{constructor(){this.name=Y.KHR_MESH_QUANTIZATION}},au=class extends jh{constructor(t,e,r,o){super(t,e,r,o)}copySampleValue_(t){let e=this.resultBuffer,r=this.sampleValues,o=this.valueSize,i=t*o*3+o;for(let s=0;s!==o;s++)e[s]=r[i+s];return e}interpolate_(t,e,r,o){let i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=a*2,p=a*3,m=o-e,g=(r-e)/m,F=g*g,S=F*g,M=t*p,k=M-p,E=-2*S+3*F,R=S-F,W=1-E,V=R-F+g;for(let B=0;B!==a;B++){let G=s[k+B+a],D=s[k+B+l]*m,O=s[M+B+a],ne=s[M+B]*m;i[B]=W*G+V*D+E*O+R*ne}return i}},QA=new ce,Zp=class extends au{interpolate_(t,e,r,o){let i=super.interpolate_(t,e,r,o);return QA.fromArray(i).normalize().toArray(i),i}},Dt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},qo={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},dx={9728:nf,9729:Sc,9984:of,9985:$h,9986:rf,9987:bc},mx={33071:Ih,33648:tf,10497:nl},Cp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$p={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},lr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},KA={CUBICSPLINE:void 0,LINEAR:Ac,STEP:qh},Dp={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function JA(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new _c({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Bi})),n.DefaultMaterial}function Kr(n,t,e){for(let r in e.extensions)n[r]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=e.extensions[r])}function ur(n,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(n.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function YA(n,t,e){let r=!1,o=!1,i=!1;for(let p=0,m=t.length;p<m;p++){let g=t[p];if(g.POSITION!==void 0&&(r=!0),g.NORMAL!==void 0&&(o=!0),g.COLOR_0!==void 0&&(i=!0),r&&o&&i)break}if(!r&&!o&&!i)return Promise.resolve(n);let s=[],a=[],l=[];for(let p=0,m=t.length;p<m;p++){let g=t[p];if(r){let F=g.POSITION!==void 0?e.getDependency("accessor",g.POSITION):n.attributes.position;s.push(F)}if(o){let F=g.NORMAL!==void 0?e.getDependency("accessor",g.NORMAL):n.attributes.normal;a.push(F)}if(i){let F=g.COLOR_0!==void 0?e.getDependency("accessor",g.COLOR_0):n.attributes.color;l.push(F)}}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(l)]).then(function(p){let m=p[0],g=p[1],F=p[2];return r&&(n.morphAttributes.position=m),o&&(n.morphAttributes.normal=g),i&&(n.morphAttributes.color=F),n.morphTargetsRelative=!0,n})}function ZA(n,t){if(n.updateMorphTargets(),t.weights!==void 0)for(let e=0,r=t.weights.length;e<r;e++)n.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){let e=t.extras.targetNames;if(n.morphTargetInfluences.length===e.length){n.morphTargetDictionary={};for(let r=0,o=e.length;r<o;r++)n.morphTargetDictionary[e[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function $A(n){let t,e=n.extensions&&n.extensions[Y.KHR_DRACO_MESH_COMPRESSION];if(e?t="draco:"+e.bufferView+":"+e.indices+":"+Lp(e.attributes):t=n.indices+":"+Lp(n.attributes)+":"+n.mode,n.targets!==void 0)for(let r=0,o=n.targets.length;r<o;r++)t+=":"+Lp(n.targets[r]);return t}function Lp(n){let t="",e=Object.keys(n).sort();for(let r=0,o=e.length;r<o;r++)t+=e[r]+":"+n[e[r]]+";";return t}function ed(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function ev(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}var tv=new xe,td=class{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new qA,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,o=!1,i=-1;typeof navigator<"u"&&(r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,o=navigator.userAgent.indexOf("Firefox")>-1,i=o?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||r||o&&i<98?this.textureLoader=new xf(this.options.manager):this.textureLoader=new zh(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new wc(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){let r=this,o=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(s){let a={scene:s[0][o.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:o.asset,parser:r,userData:{}};Kr(i,a,o),ur(a,o),Promise.all(r._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){t(a)})}).catch(e)}_markDefs(){let t=this.json.nodes||[],e=this.json.skins||[],r=this.json.meshes||[];for(let o=0,i=e.length;o<i;o++){let s=e[o].joints;for(let a=0,l=s.length;a<l;a++)t[s[a]].isBone=!0}for(let o=0,i=t.length;o<i;o++){let s=t[o];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(r[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,r){if(t.refs[e]<=1)return r;let o=r.clone(),i=(s,a)=>{let l=this.associations.get(s);l!=null&&this.associations.set(a,l);for(let[p,m]of s.children.entries())i(m,a.children[p])};return i(r,o),o.name+="_instance_"+t.uses[e]++,o}_invokeOne(t){let e=Object.values(this.plugins);e.push(this);for(let r=0;r<e.length;r++){let o=t(e[r]);if(o)return o}return null}_invokeAll(t){let e=Object.values(this.plugins);e.unshift(this);let r=[];for(let o=0;o<e.length;o++){let i=t(e[o]);i&&r.push(i)}return r}getDependency(t,e){let r=t+":"+e,o=this.cache.get(r);if(!o){switch(t){case"scene":o=this.loadScene(e);break;case"node":o=this._invokeOne(function(i){return i.loadNode&&i.loadNode(e)});break;case"mesh":o=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(e)});break;case"accessor":o=this.loadAccessor(e);break;case"bufferView":o=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(e)});break;case"buffer":o=this.loadBuffer(e);break;case"material":o=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(e)});break;case"texture":o=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(e)});break;case"skin":o=this.loadSkin(e);break;case"animation":o=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(e)});break;case"camera":o=this.loadCamera(e);break;default:if(o=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(t,e)}),!o)throw new Error("Unknown type: "+t);break}this.cache.add(r,o)}return o}getDependencies(t){let e=this.cache.get(t);if(!e){let r=this,o=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(o.map(function(i,s){return r.getDependency(t,s)})),this.cache.add(t,e)}return e}loadBuffer(t){let e=this.json.buffers[t],r=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[Y.KHR_BINARY_GLTF].body);let o=this.options;return new Promise(function(i,s){r.load(Za.resolveURL(e.uri,o.path),i,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){let e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(r){let o=e.byteLength||0,i=e.byteOffset||0;return r.slice(i,i+o)})}loadAccessor(t){let e=this,r=this.json,o=this.json.accessors[t];if(o.bufferView===void 0&&o.sparse===void 0){let s=Cp[o.type],a=qo[o.componentType],l=o.normalized===!0,p=new a(o.count*s);return Promise.resolve(new An(p,s,l))}let i=[];return o.bufferView!==void 0?i.push(this.getDependency("bufferView",o.bufferView)):i.push(null),o.sparse!==void 0&&(i.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(i).then(function(s){let a=s[0],l=Cp[o.type],p=qo[o.componentType],m=p.BYTES_PER_ELEMENT,g=m*l,F=o.byteOffset||0,S=o.bufferView!==void 0?r.bufferViews[o.bufferView].byteStride:void 0,M=o.normalized===!0,k,E;if(S&&S!==g){let R=Math.floor(F/S),W="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+R+":"+o.count,V=e.cache.get(W);V||(k=new p(a,R*S,o.count*S/m),V=new Fc(k,S/m),e.cache.add(W,V)),E=new Ht(V,l,F%S/m,M)}else a===null?k=new p(o.count*l):k=new p(a,F,o.count*l),E=new An(k,l,M);if(o.sparse!==void 0){let R=Cp.SCALAR,W=qo[o.sparse.indices.componentType],V=o.sparse.indices.byteOffset||0,B=o.sparse.values.byteOffset||0,G=new W(s[1],V,o.sparse.count*R),D=new p(s[2],B,o.sparse.count*l);a!==null&&(E=new An(E.array.slice(),E.itemSize,E.normalized));for(let O=0,ne=G.length;O<ne;O++){let ae=G[O];if(E.setX(ae,D[O*l]),l>=2&&E.setY(ae,D[O*l+1]),l>=3&&E.setZ(ae,D[O*l+2]),l>=4&&E.setW(ae,D[O*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return E})}loadTexture(t){let e=this.json,r=this.options,i=e.textures[t].source,s=e.images[i],a=this.textureLoader;if(s.uri){let l=r.manager.getHandler(s.uri);l!==null&&(a=l)}return this.loadTextureImage(t,i,a)}loadTextureImage(t,e,r){let o=this,i=this.json,s=i.textures[t],a=i.images[e],l=(a.uri||a.bufferView)+":"+s.sampler;if(this.textureCache[l])return this.textureCache[l];let p=this.loadImageSource(e,r).then(function(m){m.flipY=!1,m.name=s.name||a.name||"",m.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(m.name=a.uri);let F=(i.samplers||{})[s.sampler]||{};return m.magFilter=dx[F.magFilter]||Sc,m.minFilter=dx[F.minFilter]||bc,m.wrapS=mx[F.wrapS]||nl,m.wrapT=mx[F.wrapT]||nl,o.associations.set(m,{textures:t}),m}).catch(function(){return null});return this.textureCache[l]=p,p}loadImageSource(t,e){let r=this,o=this.json,i=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(g=>g.clone());let s=o.images[t],a=self.URL||self.webkitURL,l=s.uri||"",p=!1;if(s.bufferView!==void 0)l=r.getDependency("bufferView",s.bufferView).then(function(g){p=!0;let F=new Blob([g],{type:s.mimeType});return l=a.createObjectURL(F),l});else if(s.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");let m=Promise.resolve(l).then(function(g){return new Promise(function(F,S){let M=F;e.isImageBitmapLoader===!0&&(M=function(k){let E=new Vi(k);E.needsUpdate=!0,F(E)}),e.load(Za.resolveURL(g,i.path),M,void 0,S)})}).then(function(g){return p===!0&&a.revokeObjectURL(l),g.userData.mimeType=s.mimeType||ev(s.uri),g}).catch(function(g){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),g});return this.sourceCache[t]=m,m}assignTexture(t,e,r,o){let i=this;return this.getDependency("texture",r.index).then(function(s){if(!s)return null;if(r.texCoord!==void 0&&r.texCoord>0&&(s=s.clone(),s.channel=r.texCoord),i.extensions[Y.KHR_TEXTURE_TRANSFORM]){let a=r.extensions!==void 0?r.extensions[Y.KHR_TEXTURE_TRANSFORM]:void 0;if(a){let l=i.associations.get(s);s=i.extensions[Y.KHR_TEXTURE_TRANSFORM].extendTexture(s,a),i.associations.set(s,l)}}return o!==void 0&&(s.colorSpace=o),t[e]=s,s})}assignFinalMaterial(t){let e=t.geometry,r=t.material,o=e.attributes.tangent===void 0,i=e.attributes.color!==void 0,s=e.attributes.normal===void 0;if(t.isPoints){let a="PointsMaterial:"+r.uuid,l=this.cache.get(a);l||(l=new cf,$a.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,l.sizeAttenuation=!1,this.cache.add(a,l)),r=l}else if(t.isLine){let a="LineBasicMaterial:"+r.uuid,l=this.cache.get(a);l||(l=new vc,$a.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,this.cache.add(a,l)),r=l}if(o||i||s){let a="ClonedMaterial:"+r.uuid+":";o&&(a+="derivative-tangents:"),i&&(a+="vertex-colors:"),s&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=r.clone(),i&&(l.vertexColors=!0),s&&(l.flatShading=!0),o&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(r))),r=l}t.material=r}getMaterialType(){return _c}loadMaterial(t){let e=this,r=this.json,o=this.extensions,i=r.materials[t],s,a={},l=i.extensions||{},p=[];if(l[Y.KHR_MATERIALS_UNLIT]){let g=o[Y.KHR_MATERIALS_UNLIT];s=g.getMaterialType(),p.push(g.extendParams(a,i,e))}else{let g=i.pbrMetallicRoughness||{};if(a.color=new Be(1,1,1),a.opacity=1,Array.isArray(g.baseColorFactor)){let F=g.baseColorFactor;a.color.fromArray(F),a.opacity=F[3]}g.baseColorTexture!==void 0&&p.push(e.assignTexture(a,"map",g.baseColorTexture,Co)),a.metalness=g.metallicFactor!==void 0?g.metallicFactor:1,a.roughness=g.roughnessFactor!==void 0?g.roughnessFactor:1,g.metallicRoughnessTexture!==void 0&&(p.push(e.assignTexture(a,"metalnessMap",g.metallicRoughnessTexture)),p.push(e.assignTexture(a,"roughnessMap",g.metallicRoughnessTexture))),s=this._invokeOne(function(F){return F.getMaterialType&&F.getMaterialType(t)}),p.push(Promise.all(this._invokeAll(function(F){return F.extendMaterialParams&&F.extendMaterialParams(t,a)})))}i.doubleSided===!0&&(a.side=Hh);let m=i.alphaMode||Dp.OPAQUE;if(m===Dp.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,m===Dp.MASK&&(a.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&s!==ot&&(p.push(e.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new He(1,1),i.normalTexture.scale!==void 0)){let g=i.normalTexture.scale;a.normalScale.set(g,g)}return i.occlusionTexture!==void 0&&s!==ot&&(p.push(e.assignTexture(a,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&s!==ot&&(a.emissive=new Be().fromArray(i.emissiveFactor)),i.emissiveTexture!==void 0&&s!==ot&&p.push(e.assignTexture(a,"emissiveMap",i.emissiveTexture,Co)),Promise.all(p).then(function(){let g=new s(a);return i.name&&(g.name=i.name),ur(g,i),e.associations.set(g,{materials:t}),i.extensions&&Kr(o,g,i),g})}createUniqueName(t){let e=pf.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){let e=this,r=this.extensions,o=this.primitiveCache;function i(a){return r[Y.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,e).then(function(l){return hx(l,a,e)})}let s=[];for(let a=0,l=t.length;a<l;a++){let p=t[a],m=$A(p),g=o[m];if(g)s.push(g.promise);else{let F;p.extensions&&p.extensions[Y.KHR_DRACO_MESH_COMPRESSION]?F=i(p):F=hx(new Li,p,e),o[m]={primitive:p,promise:F},s.push(F)}}return Promise.all(s)}loadMesh(t){let e=this,r=this.json,o=this.extensions,i=r.meshes[t],s=i.primitives,a=[];for(let l=0,p=s.length;l<p;l++){let m=s[l].material===void 0?JA(this.cache):this.getDependency("material",s[l].material);a.push(m)}return a.push(e.loadGeometries(s)),Promise.all(a).then(function(l){let p=l.slice(0,l.length-1),m=l[l.length-1],g=[];for(let S=0,M=m.length;S<M;S++){let k=m[S],E=s[S],R,W=p[S];if(E.mode===Dt.TRIANGLES||E.mode===Dt.TRIANGLE_STRIP||E.mode===Dt.TRIANGLE_FAN||E.mode===void 0)R=i.isSkinnedMesh===!0?new ff(k,W):new Nt(k,W),R.isSkinnedMesh===!0&&R.normalizeSkinWeights(),E.mode===Dt.TRIANGLE_STRIP?R.geometry=kp(R.geometry,il):E.mode===Dt.TRIANGLE_FAN&&(R.geometry=kp(R.geometry,Oi));else if(E.mode===Dt.LINES)R=new Yh(k,W);else if(E.mode===Dt.LINE_STRIP)R=new Qh(k,W);else if(E.mode===Dt.LINE_LOOP)R=new Jh(k,W);else if(E.mode===Dt.POINTS)R=new uf(k,W);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+E.mode);Object.keys(R.geometry.morphAttributes).length>0&&ZA(R,i),R.name=e.createUniqueName(i.name||"mesh_"+t),ur(R,i),E.extensions&&Kr(o,R,E),e.assignFinalMaterial(R),g.push(R)}for(let S=0,M=g.length;S<M;S++)e.associations.set(g[S],{meshes:t,primitives:S});if(g.length===1)return i.extensions&&Kr(o,g[0],i),g[0];let F=new Ja;i.extensions&&Kr(o,F,i),e.associations.set(F,{meshes:t});for(let S=0,M=g.length;S<M;S++)F.add(g[S]);return F})}loadCamera(t){let e,r=this.json.cameras[t],o=r[r.type];if(!o){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?e=new Ri(el.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):r.type==="orthographic"&&(e=new af(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),r.name&&(e.name=this.createUniqueName(r.name)),ur(e,r),Promise.resolve(e)}loadSkin(t){let e=this.json.skins[t],r=[];for(let o=0,i=e.joints.length;o<i;o++)r.push(this._loadNodeShallow(e.joints[o]));return e.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",e.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(o){let i=o.pop(),s=o,a=[],l=[];for(let p=0,m=s.length;p<m;p++){let g=s[p];if(g){a.push(g);let F=new xe;i!==null&&F.fromArray(i.array,p*16),l.push(F)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[p])}return new hf(a,l)})}loadAnimation(t){let r=this.json.animations[t],o=r.name?r.name:"animation_"+t,i=[],s=[],a=[],l=[],p=[];for(let m=0,g=r.channels.length;m<g;m++){let F=r.channels[m],S=r.samplers[F.sampler],M=F.target,k=M.node,E=r.parameters!==void 0?r.parameters[S.input]:S.input,R=r.parameters!==void 0?r.parameters[S.output]:S.output;M.node!==void 0&&(i.push(this.getDependency("node",k)),s.push(this.getDependency("accessor",E)),a.push(this.getDependency("accessor",R)),l.push(S),p.push(M))}return Promise.all([Promise.all(i),Promise.all(s),Promise.all(a),Promise.all(l),Promise.all(p)]).then(function(m){let g=m[0],F=m[1],S=m[2],M=m[3],k=m[4],E=[];for(let R=0,W=g.length;R<W;R++){let V=g[R],B=F[R],G=S[R],D=M[R],O=k[R];if(V===void 0)continue;V.updateMatrix();let ne;switch(lr[O.path]){case lr.weights:ne=sf;break;case lr.rotation:ne=Tc;break;case lr.position:case lr.scale:default:ne=Ff;break}let ae=V.name?V.name:V.uuid,j=D.interpolation!==void 0?KA[D.interpolation]:Ac,ee=[];lr[O.path]===lr.weights?V.traverse(function(Fe){Fe.morphTargetInfluences&&ee.push(Fe.name?Fe.name:Fe.uuid)}):ee.push(ae);let we=G.array;if(G.normalized){let Fe=ed(we.constructor),re=new Float32Array(we.length);for(let tt=0,Dn=we.length;tt<Dn;tt++)re[tt]=we[tt]*Fe;we=re}for(let Fe=0,re=ee.length;Fe<re;Fe++){let tt=new ne(ee[Fe]+"."+lr[O.path],B.array,we,j);D.interpolation==="CUBICSPLINE"&&(tt.createInterpolant=function(Ut){let Lt=this instanceof Tc?Zp:au;return new Lt(this.times,this.values,this.getValueSize()/3,Ut)},tt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),E.push(tt)}}return new Lh(o,void 0,E)})}createNodeMesh(t){let e=this.json,r=this,o=e.nodes[t];return o.mesh===void 0?null:r.getDependency("mesh",o.mesh).then(function(i){let s=r._getNodeRef(r.meshCache,o.mesh,i);return o.weights!==void 0&&s.traverse(function(a){if(a.isMesh)for(let l=0,p=o.weights.length;l<p;l++)a.morphTargetInfluences[l]=o.weights[l]}),s})}loadNode(t){let e=this.json,r=this,o=e.nodes[t],i=r._loadNodeShallow(t),s=[],a=o.children||[];for(let p=0,m=a.length;p<m;p++)s.push(r.getDependency("node",a[p]));let l=o.skin===void 0?Promise.resolve(null):r.getDependency("skin",o.skin);return Promise.all([i,Promise.all(s),l]).then(function(p){let m=p[0],g=p[1],F=p[2];F!==null&&m.traverse(function(S){S.isSkinnedMesh&&S.bind(F,tv)});for(let S=0,M=g.length;S<M;S++)m.add(g[S]);return m})}_loadNodeShallow(t){let e=this.json,r=this.extensions,o=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];let i=e.nodes[t],s=i.name?o.createUniqueName(i.name):"",a=[],l=o._invokeOne(function(p){return p.createNodeMesh&&p.createNodeMesh(t)});return l&&a.push(l),i.camera!==void 0&&a.push(o.getDependency("camera",i.camera).then(function(p){return o._getNodeRef(o.cameraCache,i.camera,p)})),o._invokeAll(function(p){return p.createNodeAttachment&&p.createNodeAttachment(t)}).forEach(function(p){a.push(p)}),this.nodeCache[t]=Promise.all(a).then(function(p){let m;if(i.isBone===!0?m=new Ph:p.length>1?m=new Ja:p.length===1?m=p[0]:m=new Ee,m!==p[0])for(let g=0,F=p.length;g<F;g++)m.add(p[g]);if(i.name&&(m.userData.name=i.name,m.name=s),ur(m,i),i.extensions&&Kr(r,m,i),i.matrix!==void 0){let g=new xe;g.fromArray(i.matrix),m.applyMatrix4(g)}else i.translation!==void 0&&m.position.fromArray(i.translation),i.rotation!==void 0&&m.quaternion.fromArray(i.rotation),i.scale!==void 0&&m.scale.fromArray(i.scale);return o.associations.has(m)||o.associations.set(m,{}),o.associations.get(m).nodes=t,m}),this.nodeCache[t]}loadScene(t){let e=this.extensions,r=this.json.scenes[t],o=this,i=new Ja;r.name&&(i.name=o.createUniqueName(r.name)),ur(i,r),r.extensions&&Kr(e,i,r);let s=r.nodes||[],a=[];for(let l=0,p=s.length;l<p;l++)a.push(o.getDependency("node",s[l]));return Promise.all(a).then(function(l){for(let m=0,g=l.length;m<g;m++)i.add(l[m]);let p=m=>{let g=new Map;for(let[F,S]of o.associations)(F instanceof $a||F instanceof Vi)&&g.set(F,S);return m.traverse(F=>{let S=o.associations.get(F);S!=null&&g.set(F,S)}),g};return o.associations=p(i),i})}};function nv(n,t,e){let r=t.attributes,o=new Tr;if(r.POSITION!==void 0){let a=e.json.accessors[r.POSITION],l=a.min,p=a.max;if(l!==void 0&&p!==void 0){if(o.set(new I(l[0],l[1],l[2]),new I(p[0],p[1],p[2])),a.normalized){let m=ed(qo[a.componentType]);o.min.multiplyScalar(m),o.max.multiplyScalar(m)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let i=t.targets;if(i!==void 0){let a=new I,l=new I;for(let p=0,m=i.length;p<m;p++){let g=i[p];if(g.POSITION!==void 0){let F=e.json.accessors[g.POSITION],S=F.min,M=F.max;if(S!==void 0&&M!==void 0){if(l.setX(Math.max(Math.abs(S[0]),Math.abs(M[0]))),l.setY(Math.max(Math.abs(S[1]),Math.abs(M[1]))),l.setZ(Math.max(Math.abs(S[2]),Math.abs(M[2]))),F.normalized){let k=ed(qo[F.componentType]);l.multiplyScalar(k)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(a)}n.boundingBox=o;let s=new Do;o.getCenter(s.center),s.radius=o.min.distanceTo(o.max)/2,n.boundingSphere=s}function hx(n,t,e){let r=t.attributes,o=[];function i(s,a){return e.getDependency("accessor",s).then(function(l){n.setAttribute(a,l)})}for(let s in r){let a=$p[s]||s.toLowerCase();a in n.attributes||o.push(i(r[s],a))}if(t.indices!==void 0&&!n.index){let s=e.getDependency("accessor",t.indices).then(function(a){n.setIndex(a)});o.push(s)}return ur(n,t),nv(n,t,e),Promise.all(o).then(function(){return t.targets!==void 0?YA(n,t.targets,e):n})}var Me={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function gx(n){let t=await fetch(n);if(t.ok)return t.json();throw new Error(t.statusText)}async function rv(n){if(!n)throw new Error("No basePath supplied");return await gx(`${n}/profilesList.json`)}async function xx(n,t,e=null,r=!0){if(!n)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");let o=await rv(t),i;if(n.profiles.some(l=>{let p=o[l];return p&&(i={profileId:l,profilePath:`${t}/${p.path}`,deprecated:!!p.deprecated}),!!i}),!i){if(!e)throw new Error("No matching profile name found");let l=o[e];if(!l)throw new Error(`No matching profile name found and default profile "${e}" missing.`);i={profileId:e,profilePath:`${t}/${l.path}`,deprecated:!!l.deprecated}}let s=await gx(i.profilePath),a;if(r){let l;if(n.handedness==="any"?l=s.layouts[Object.keys(s.layouts)[0]]:l=s.layouts[n.handedness],!l)throw new Error(`No matching handedness, ${n.handedness}, in profile ${i.profileId}`);l.assetPath&&(a=i.profilePath.replace("profile.json",l.assetPath))}return{profile:s,assetPath:a}}var ov={xAxis:0,yAxis:0,button:0,state:Me.ComponentState.DEFAULT};function iv(n=0,t=0){let e=n,r=t;if(Math.sqrt(n*n+t*t)>1){let s=Math.atan2(t,n);e=Math.cos(s),r=Math.sin(s)}return{normalizedXAxis:e*.5+.5,normalizedYAxis:r*.5+.5}}var nd=class{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===Me.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(ov)}updateFromComponent({xAxis:t,yAxis:e,button:r,state:o}){let{normalizedXAxis:i,normalizedYAxis:s}=iv(t,e);switch(this.componentProperty){case Me.ComponentProperty.X_AXIS:this.value=this.states.includes(o)?i:.5;break;case Me.ComponentProperty.Y_AXIS:this.value=this.states.includes(o)?s:.5;break;case Me.ComponentProperty.BUTTON:this.value=this.states.includes(o)?r:0;break;case Me.ComponentProperty.STATE:this.valueNodeProperty===Me.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(o):this.value=this.states.includes(o)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},rd=class{constructor(t,e){if(!t||!e||!e.visualResponses||!e.gamepadIndices||Object.keys(e.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach(r=>{let o=new nd(e.visualResponses[r]);this.visualResponses[r]=o}),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:Me.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(t){if(this.values.state=Me.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&t.buttons.length>this.gamepadIndices.button){let e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||this.values.button===1?this.values.state=Me.ComponentState.PRESSED:(e.touched||this.values.button>Me.ButtonTouchThreshold)&&(this.values.state=Me.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Me.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Me.AxisTouchThreshold&&(this.values.state=Me.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Me.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Me.AxisTouchThreshold&&(this.values.state=Me.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}},lu=class{constructor(t,e,r){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=r,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(o=>{let i=this.layoutDescription.components[o];this.components[o]=new rd(o,i)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let t=[];return Object.values(this.components).forEach(e=>{t.push(e.data)}),t}updateFromGamepad(){Object.values(this.components).forEach(t=>{t.updateFromGamepad(this.xrInputSource.gamepad)})}};var sv="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",av="generic-trigger",od=class extends Ee{constructor(){super(...arguments);this.envMap=null;this.motionController=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(r=>{xt(r)&&(Hi(r.material)||Ni(r.material)||Gi(r.material))&&(r.material.envMap=this.envMap,r.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(r=>{Object.values(r.visualResponses).forEach(o=>{let{valueNode:i,minNode:s,maxNode:a}=o;i&&(lv(o)?i.visible=o.value:uv(o)&&(i.quaternion.slerpQuaternions(s.quaternion,a.quaternion,o.value),i.position.lerpVectors(s.position,a.position,o.value)))})}))}};function Fx(n,t){return n&&n.valueNodeProperty===t}function lv(n){return Fx(n,"visibility")}function uv(n){return Fx(n,"transform")}function cv(n,t){Object.values(n.components).forEach(e=>{let{type:r,touchPointNodeName:o,visualResponses:i}=e;if(r===Me.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(o),e.touchPointNode){let s=new ol(.001),a=new ot({color:255}),l=new Nt(s,a);e.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(i).forEach(s=>{let{valueNodeName:a,minNodeName:l,maxNodeName:p,valueNodeProperty:m}=s;if(m===Me.VisualResponseProperty.TRANSFORM){if(s.minNode=t.getObjectByName(l),s.maxNode=t.getObjectByName(p),!s.minNode){console.warn(`Could not find ${l} in the model`);return}if(!s.maxNode){console.warn(`Could not find ${p} in the model`);return}}s.valueNode=t.getObjectByName(a),s.valueNode||console.warn(`Could not find ${a} in the model`)})})}function wx(n,t){cv(n.motionController,t),n.envMap&&t.traverse(e=>{xt(e)&&(Hi(e.material)||Ni(e.material)||Gi(e.material))&&(e.material.envMap=n.envMap,e.material.needsUpdate=!0)}),n.add(t)}var uu=class{constructor(t=null){this.gltfLoader=t||new cr,this.path=sv,this._assetCache={}}createControllerModel(t,e=null){let r=new od,o=null;return t.addEventListener("connected",async i=>{let s=i.data;if(!(s.targetRayMode!=="tracked-pointer"||!s.gamepad))try{let{profile:a,assetPath:l}=await xx(s,this.path,e||av);r.motionController=new lu(s,a,l);let p=this._assetCache[r.motionController.assetUrl];if(p)o=p.scene.clone(),wx(r,o);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(r.motionController.assetUrl,m=>{this._assetCache[r.motionController.assetUrl]=m,o=m.scene.clone(),wx(r,o)},null,()=>{throw new Error(`Asset ${r.motionController.assetUrl} missing or malformed.`)})}}catch(a){console.warn(a)}}),t.addEventListener("disconnected",()=>{ye(r.motionController),r.motionController=null,ye(o),o=null}),r}};var pv=new uu,dv=new xe().makeRotationX(-7*Te/9),Ax=new xe,vx=new Map([["none",5],["left",6],["right",7]]);var Sx=new Map([[5,2],[4,3]]),cu=class extends Cn{constructor(e,r){super("hand",5,e,new jr(e));this.laser=new _s(Rc,.75,.002);this._isHand=!1;this.inputSource=null;this._gamepad=new tu;this.delta=new I;this.newOrigin=new I;this.quaternion=new ce;this.newQuat=new ce;this.useHaptics=!0;if(this.mayTeleport=!0,this.object=ie("PointerHand"+r),this.quaternion.identity(),U(this,U(this.controller=this.env.renderer.xr.getController(r),this.laser),U(this.grip=this.env.renderer.xr.getControllerGrip(r),this.gripModel=pv.createControllerModel(this.controller)),U(this.hand=this.env.renderer.xr.getHand(r),this.handModel=this.env.handModelFactory.createHandModel(this.hand))),io()&&dm()&&!wn){let s=!1;this.controller.traverse(a=>{a.name.toLocaleLowerCase().indexOf("oculus")>=0&&(s=!0)}),s&&this.laser.matrix.copy(dv)}this.gamepad.addEventListener("gamepadaxismaxed",s=>{s.axis===2&&this.env.avatar.snapTurn(s.value)});let o=s=>a=>{Sx.has(a.button)&&this.setButton(Sx.get(a.button),s)};this.gamepad.addEventListener("gamepadbuttondown",o(!0)),this.gamepad.addEventListener("gamepadbuttonup",o(!1));let i=(s,a)=>()=>this.setButton(s,a);this.controller.addEventListener("selectstart",i(0,!0)),this.controller.addEventListener("selectend",i(0,!1)),this.controller.addEventListener("squeezestart",i(1,!0)),this.controller.addEventListener("squeezeend",i(1,!1)),this.controller.addEventListener("connected",s=>{s.target===this.controller&&(this.inputSource=s.data,this.gamepad.pad=this.inputSource.gamepad,this._isHand=w(this.inputSource.hand),this.id=vx.get(this.handedness),this.grip.visible=!this.isHand,this.controller.visible=!this.isHand,this.hand.visible=this.isHand,this.enabled=!0,this._isActive=!0,this.env.eventSys.checkXRMouse(),this.updateCursorSide())}),this.controller.addEventListener("disconnected",s=>{s.target===this.controller&&(this.inputSource=null,this.gamepad.pad=null,this._isHand=!1,this.id=vx.get(this.handedness),this.grip.visible=!1,this.controller.visible=!1,this.hand.visible=!1,this.enabled=!1,this._isActive=!1,this.env.eventSys.checkXRMouse(),this.updateCursorSide())}),Object.seal(this)}vibrate(){this._vibrate()}async _vibrate(){if(this.useHaptics&&this.gamepad.hapticActuators)try{await Promise.all(this.gamepad.hapticActuators.map(e=>e.pulse(.25,125)))}catch{this.useHaptics=!1}}get gamepad(){return this._gamepad}get handedness(){return L(this.inputSource)?null:this.inputSource.handedness}get isHand(){return this._isHand}get cursor(){return super.cursor}set cursor(e){super.cursor=e,this.updateCursorSide()}updateCursorSide(){this.cursor.side=this.handedness==="left"?1:-1}updatePointerOrientation(){this.laser.getWorldPosition(this.newOrigin),this.laser.getWorldQuaternion(this.newQuat),this.origin.lerp(this.newOrigin,.9),this.quaternion.slerp(this.newQuat,.9),this.delta.copy(this.origin).add(this.direction),this.direction.set(0,0,-1).applyQuaternion(this.quaternion),this.up.set(0,1,0).applyQuaternion(this.quaternion),this.delta.sub(this.direction).sub(this.origin),this.moveDistance+=50*this.delta.length()}onUpdate(){this.gamepad.pad=this.inputSource&&this.inputSource.gamepad||null,super.onUpdate()}get bufferSize(){return super.bufferSize+2+this.handModel.count*64}writeState(e){if(super.writeState(e),e.writeEnum8(this.handedness,Mp),e.writeUint8(this.handModel.count),this.handModel.isTracking)for(let r=0;r<this.handModel.count;++r)this.handModel.getMatrixAt(r,Ax),e.writeMatrix512(Ax)}};var Qo=class extends Cn{constructor(e,r,o,i){super(e,r,o,i);this.position=new He;this.motion=new He;this.uv=new He;this.duv=new He;this.uvComp=new He(1,-1);this.uvOff=new He(-1,1);this.canMoveView=!0;let s=a=>{this._isActive=this.onCheckEvent(a),this._isActive&&this.onReadEvent(a)};this.element=this.env.renderer.domElement,this.element.addEventListener("pointerdown",s),this.element.addEventListener("pointermove",s),this.element.addEventListener("pointerup",s),this.element.addEventListener("pointercancel",s)}onCheckEvent(e){return e.pointerType===this.type}onReadEvent(e){this.updatePointerOrientation()}updatePointerOrientation(){this.element.clientWidth>0&&this.element.clientHeight>0&&(this.uv.copy(this.position),this.uv.x/=this.element.clientWidth,this.uv.y/=this.element.clientHeight,this.uv.multiplyScalar(2).multiply(this.uvComp).add(this.uvOff),this.duv.copy(this.motion),this.duv.x/=this.element.clientWidth,this.duv.y/=this.element.clientHeight,this.duv.multiplyScalar(2).multiply(this.uvComp),this.moveDistance=200*this.duv.length());let e=Lr(this.env.renderer,this.env.camera);this.origin.setFromMatrixPosition(e.matrixWorld),this.direction.set(this.uv.x,this.uv.y,.5).unproject(e).sub(this.origin).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat)}onUpdate(){this.env.avatar.onMove(this,this.uv,this.duv),super.onUpdate(),this.motion.setScalar(0),this.duv.setScalar(0)}};var Ko=class extends Qo{constructor(e,r,o){let i=l=>{l.pointerType===e&&this.pointerID==null&&(this.pointerID=l.pointerId)},s=l=>{l.pointerType===e&&this.pointerID!=null&&(this.pointerID=null)},a=o.renderer.domElement;a.addEventListener("pointerdown",i),a.addEventListener("pointermove",i);super(e,r,o,new jo(o));this.pointerID=null;this.lastX=null;this.lastY=null;a.addEventListener("pointerup",s),a.addEventListener("pointercancel",s)}onCheckEvent(e){return super.onCheckEvent(e)&&e.pointerId===this.pointerID}onReadEvent(e){this.position.set(e.offsetX,e.offsetY),e.type==="pointerdown"?this.motion.setScalar(0):(this.motion.x+=e.offsetX-this.lastX,this.motion.y+=e.offsetY-this.lastY),this.lastX=e.offsetX,this.lastY=e.offsetY,super.onReadEvent(e),(e.type==="pointerdown"||e.type==="pointerup"||e.type==="pointercancel")&&this.setButton(e.button,e.type==="pointerdown")}};var pu=class extends Ko{constructor(e){super("mouse",1,e);this.allowPointerLock=!1;this.dz=0;this.keyMap=new Map([["`",3],["ContextMenu",2]]);this.element.addEventListener("wheel",r=>{r.preventDefault(),this.dz+=-r.deltaY*.1},{passive:!1}),this.element.addEventListener("contextmenu",r=>{r.preventDefault()}),this.element.addEventListener("pointerdown",r=>{this.onCheckEvent(r)&&(this.allowPointerLock&&!this.isPointerLocked?this.lockPointer():!this.allowPointerLock&&!this.isPointerCaptured&&this.capturePointer())}),this.element.addEventListener("pointerup",r=>{this.onCheckEvent(r)&&(this.allowPointerLock&&this.isPointerLocked?this.unlockPointer():!this.allowPointerLock&&this.isPointerCaptured&&this.releaseCapture())},!0),document.addEventListener("pointerlockchange",()=>{this.cursor.visible=!0}),window.addEventListener("keydown",r=>{this._isActive&&this.keyMap.has(r.key)&&this.setButton(this.keyMap.get(r.key),no(r))}),window.addEventListener("keyup",r=>{this.keyMap.has(r.key)&&this.setButton(this.keyMap.get(r.key),!1)}),this.mayTeleport=!0,Object.seal(this)}updatePointerOrientation(){this.isPointerLocked&&this.position.set(this.env.renderer.domElement.clientWidth,this.env.renderer.domElement.clientHeight).multiplyScalar(.5),super.updatePointerOrientation()}onUpdate(){super.onUpdate(),this.env.avatar.zoom(this.dz),this.dz=0}get isPointerLocked(){return document.pointerLockElement!=null}get isPointerCaptured(){return this.element.hasPointerCapture(this.pointerID)}get canDragView(){return super.canDragView&&!this.isPointerLocked}get canTeleport(){return super.canTeleport&&this.isPointerLocked}lockPointer(){this.element.requestPointerLock()}unlockPointer(){document.exitPointerLock()}capturePointer(){this.element.setPointerCapture(this.pointerID)}releaseCapture(){this.element.releasePointerCapture(this.pointerID)}vibrate(){}};var du=class extends Cn{constructor(e){super("nose",8,e,null);this.point=new I;this.lastPoint=new I;this.mayTeleport=!1,this.enabled=!0,this._isActive=!0,this.updatePointerOrientation(),this.moveDistance=0,Object.seal(this)}vibrate(){}get canSend(){return!1}updatePointerOrientation(){let e=this.env.camera;e.getWorldPosition(this.origin),e.getWorldDirection(this.direction),this.up.copy(e.up),this.point.copy(this.direction).add(this.origin),this.moveDistance=this.point.distanceTo(this.lastPoint),this.lastPoint.copy(this.point)}};var mu=class extends Ko{constructor(t){super("pen",2,t),Object.seal(this)}vibrate(){}};function mv(n){return n.pointerId}var hu=class extends Qo{constructor(e){super("touch",3,e,null);this.dz=0;this.lastZ=0;this.points=new Array;this.lastXs=new Map;this.lastYs=new Map;this._canVibrate=null;Object.seal(this)}get enabled(){return super.enabled}set enabled(e){super.enabled=e,ue(this.points)}onReadEvent(e){bd(this.points,e.pointerId,mv);let r=e.type==="pointerdown"||e.type==="pointermove";if(r&&this.points.push(e),this.points.length===2){let i=this.points[0],s=this.points[1],a=s.offsetX-i.offsetX,l=s.offsetY-i.offsetY,p=5*Math.sqrt(a*a+l*l),m=p-this.lastZ;e.type==="pointermove"&&(this.dz+=m),this.lastZ=p}let o=1/this.points.length;if(r){this.position.setScalar(0);for(let i of this.points)if(this.position.x+=o*i.offsetX,this.position.y+=o*i.offsetY,this.lastXs.has(i.pointerId)){let s=this.lastXs.get(i.pointerId),a=this.lastYs.get(i.pointerId),l=i.offsetX-s,p=i.offsetY-a;this.motion.x+=o*l,this.motion.y+=o*p}}if(r?(this.lastXs.set(e.pointerId,e.offsetX),this.lastYs.set(e.pointerId,e.offsetY)):(this.lastXs.delete(e.pointerId),this.lastYs.delete(e.pointerId)),super.onReadEvent(e),e.type!=="pointermove"){let i=0;for(let s=0;s<this.points.length;++s){let a=this.points[s],l=1<<s;a.buttons!==0?i|=l:i&=~l}for(let s=0;s<10;++s){let a=this.isPressed(s),l=1<<s,p=(i&l)!==0;p!==a&&this.setButton(s,p)}e.type==="pointerup"&&setTimeout(()=>this._isActive=!1,10)}}onUpdate(){this.env.avatar.zoom(this.dz),super.onUpdate(),this.dz=0}get canVibrate(){return this._canVibrate===null&&(this._canVibrate="vibrate"in navigator&&Z(navigator.vibrate)),this._canVibrate}vibrate(){this.canVibrate&&navigator.vibrate(125)}};var hv=(n,t)=>n.distance-t.distance,fu=class extends te{constructor(e){super();this.env=e;this.raycaster=new df;this.hands=new Array;this.hits=new Array;this.queue=new Array;this.targetsFound=new Set;this.targets=new Array;this.customSortFunction=null;this.raycaster.camera=this.env.camera,this.raycaster.layers.set(Cl),this.mouse=new pu(this.env),this.pen=new mu(this.env),this.touches=new hu(this.env),this.nose=new du(this.env);for(let r=0;r<2;++r)this.hands[r]=new cu(this.env,r);this.pointers=[this.mouse,this.pen,this.touches,this.nose,...this.hands];for(let r of this.pointers)r.addBubbler(this),r.cursor&&U(this.env.stage,r.cursor);this.checkXRMouse(),Object.seal(this)}set sortFunction(e){this.customSortFunction=e}get sortFunction(){return this.customSortFunction||hv}checkXRMouse(){let e=0;for(let o of this.hands.values())o.enabled&&++e;let r=e===0;this.mouse.enabled=r,this.pen.enabled=r,this.touches.enabled=r}refreshCursors(){for(let e of this.pointers)e.cursor&&(e.cursor=this.env.cursor3D.clone())}fireRay(e,r){return ue(this.hits),this.raycaster.ray.origin.copy(e),this.raycaster.ray.direction.copy(r),this.raycaster.intersectObjects(this.targets,!1,this.hits),this.hits.sort(this.sortFunction),this.hits[0]||null}update(){for(this.targetsFound.clear(),ue(this.targets),this.queue.push(this.env.scene);this.queue.length>0;){let e=this.queue.shift();e.children.length>0&&this.queue.push(...e.children);let r=Ji(e);r&&!this.targetsFound.has(r)&&(this.targetsFound.add(r),this.targets.push(...r.meshes))}for(let e of this.pointers)e.update()}};var Jo=class extends ar{constructor(e,r){super(e);this.cursorSystem=null;this.object=ie("Cursor3D"),this.cursorSystem=r,this.object.matrixAutoUpdate=!1}add(e,r){U(this,r),Tg(r,Wo),r.visible=e==="default"}get style(){for(let e of this.object.children)if(e.visible)return e.name;return null}set style(e){for(let r of this.object.children)r.visible=r.name===e;if(this.style==null&&this.object.children.length>0){let r=nt(this.object.children,o=>o.name==="default",o=>o!=null);r!=null&&(r.visible=!0)}this.cursorSystem&&(this.cursorSystem.style="none")}get visible(){return Lo(this)}set visible(e){Pe(this,e)}clone(){let e=new Jo(this.env);for(let r of this.object.children)e.add(r.name,r.clone());return e}};var id=new ce().identity(),bx=new ce().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(id.setFromAxisAngle(new I(0,1,0),Math.PI/2),bx.setFromAxisAngle(new I(1,0,0),Math.PI).premultiply(id));var fv="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/",gu=class extends Ee{constructor(e,r,o){super();this.controller=e;this.handedness=r;this.bones=new Map;this.root=null;this.instanceMatrix={needsUpdate:!1};this.oculusBrowserV14Correction=this.handedness==="left"?bx:id;let i=new cr;i.setPath(fv),i.load(`${this.handedness}.glb`,s=>{this.root=s.scene.children[0],this.add(this.root);let a=this.root.getObjectByProperty("type","SkinnedMesh");a.frustumCulled=!1,a.castShadow=!0,a.receiveShadow=!0,Gi(a.material)?a.material=jf(a.material):Hi(a.material)&&(a.material=qi(a.material)),Ni(a.material)&&(a.material.color=o,a.material.shininess=.1),pr.forEach(l=>this.addBone(l))})}addBone(e){if(this.root){let r=this.root.getObjectByName(e);r&&this.bones.set(e,r)}}get count(){return this.bones.size}set count(e){}getMatrixAt(e,r){if(0<=e&&e<pr.length){let o=pr[e];this.bones.has(o)&&r.copy(this.bones.get(o).matrix)}}setMatrixAt(e,r){if(0<=e&&e<pr.length){let o=pr[e];if(this.bones.has(o)){let i=this.bones.get(o);i.matrix.copy(r),i.matrix.decompose(i.position,i.quaternion,i.scale)}}}updateMesh(){if(this.controller)for(let[e,r]of this.bones){let o=this.controller.joints[e];o&&o.visible&&(r.position.copy(o.position),r.quaternion.copy(o.quaternion).multiply(this.oculusBrowserV14Correction))}}};var gv=.008,sd=new xe,_x=new I,Tx=new xe().identity(),Ex=new xe().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(Tx.makeRotationY(Math.PI/2),Ex.makeRotationY(-Math.PI/2));var xu=class extends Ya{constructor(e,r,o,i){let s;i==="boxes"?s=new qa(1,1,1):i==="bones"?s=new Wh(.5,.75,2.25,10,1).rotateX(-Math.PI/2):s=new ol(1,10,10);let a=new ko({color:o,shininess:.1});super(s,a,30);this.controller=e;this.instanceMatrix.setUsage(Nh),this.castShadow=!0,this.receiveShadow=!0,this.oculusBrowserV14Correction=r==="left"?Ex:Tx}updateMesh(){if(this.controller){let e=0;for(let r of pr){let o=this.controller.joints[r];o&&o.visible&&(_x.setScalar(o.jointRadius||gv),sd.compose(o.position,o.quaternion,_x),sd.multiply(this.oculusBrowserV14Correction),this.setMatrixAt(e,sd),e++)}this.count=e}this.instanceMatrix.needsUpdate=!0}};var pr=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],ad=class extends Ee{constructor(e,r,o){super();this.controllerOrHandedness=e;this.color=r;this.profile=o;this.impl=null;let i=null,s=null;de(e)?s=e:i=e;let a=()=>this.add(this.impl=this.createModel(i,s));i?(i.addEventListener("connected",l=>{let p=l.data;p.hand&&!this.impl&&(s=p.handedness,a())}),i.addEventListener("disconnected",()=>{let l=this.impl;this.impl=null,s=null,l.removeFromParent(),ye(l)})):s&&a()}get isTracking(){return!!this.impl}createModel(e,r){return this.profile==="mesh"?new gu(e,r,this.color):new xu(e,r,this.color,this.profile)}get count(){return this.impl?this.impl.count:0}set count(e){this.impl&&(this.impl.count=e)}getMatrixAt(e,r){this.impl&&this.impl.getMatrixAt(e,r)}setMatrixAt(e,r){this.impl&&this.impl.setMatrixAt(e,r)}updateMesh(){this.impl&&this.impl.updateMesh()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.impl&&this.impl.updateMesh()}},wu=class{constructor(t,e){this.color=t;this.profile=e}createHandModel(t){return new ad(t,this.color,this.profile)}};var ld=class extends Di{constructor(){super();this.frame=null;Object.seal(this)}set(e,r,o){super.set(e,r),this.frame=o}},Fu=class{constructor(t){this.renderer=t;this.tickHandlers=new Array;this.lt=-1;this._isRunning=!1;let e=new ld,r=0;this._onTick=(o,i)=>{this.lt>=0&&(r=o-this.lt,e.set(o,r,i),this.tick(e)),this.lt=o}}get isRunning(){return this._isRunning}restart(){this.stop(),this.start()}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){Ce(this.tickHandlers,t)}setAnimationLoop(t){this.renderer.setAnimationLoop(t),this._isRunning=w(t)}start(){this.isRunning||this.setAnimationLoop(this._onTick)}stop(){this.isRunning&&(this.setAnimationLoop(null),this.lt=-1)}tick(t){for(let e of this.tickHandlers)e(t)}};var yx=15,xv=$f(yx),Au=class extends te{constructor(e,r,o,i,s=null,a=null,l=null){super();this.styleSheetPath=r;this.fetcher=o;this.layers=new Array;this.layerSortOrder=new Map;this.spectator=new Ri;this.lastViewport=new rn;this.curViewport=new rn;this.gltfLoader=new cr;this.fadeDepth=0;this.scene=new rl;this.stage=ie("Stage");this.ambient=new Dh(16777215,.5);this.sun=new Qa(16777215,.75);this.ground=new Uh(xv,yx,12632256,8421504);this.foreground=ie("Foreground");this.loadingBar=new Dl;this.handModelFactory=new wu(new Be(12044521),"mesh");this.screenControl=null;this.enableSpectator=!1;this._xrBinding=null;this._xrMediaBinding=null;this._hasXRMediaLayers=null;this._hasXRCompositionLayers=null;if(this.DEBUG=s||!1,this.defaultAvatarHeight=a||1.75,l=l||60,this.camera=new Ri(l,1,.01,1e3),this.cursor3D=new Jo(this),Vt(e)&&(e.style.backgroundColor="black",L(e.parentElement)))throw new Error("The provided canvas must be included in a parent element before constructing the environment.");this.renderer=new Sf({canvas:e,powerPreference:"high-performance",precision:"lowp",antialias:!0,alpha:!0,premultipliedAlpha:!0,depth:!0,logarithmicDepthBuffer:!0,stencil:!1,preserveDrawingBuffer:!1}),this.renderer.domElement.setAttribute("touch-action","none"),this.renderer.domElement.tabIndex=1,this.useNewColorModel=!1,Vt(e)&&(this.screenControl=new Kl(this.renderer,this.camera,this.renderer.domElement.parentElement,i)),this.fader=new kl("ViewFader"),this.worldUISpace=new As("WorldUISpace",.2,20,.125),this.avatar=new Ml(this,this.fader),this.eventSys=new fu(this),this.timer=new Fu(this.renderer),this.skybox=new Yl(this),this.renderer.xr.enabled=!0,this.sun.name="Sun",this.sun.position.set(0,1,1),this.sun.lookAt(0,0,0),this.sun.layers.enableAll();let p=()=>{this.ground.visible=this.renderer.xr.isPresenting};this.screenControl.addEventListener("sessionstarted",p),this.screenControl.addEventListener("sessionstopped",p),p(),this.ambient.name="Fill",this.ambient.layers.enableAll(),this.loadingBar.object.name="MainLoadingBar",this.loadingBar.object.position.set(0,-.25,-2),this.scene.layers.enableAll(),this.avatar.addFollower(this.worldUISpace),U(this.scene,this.sun,this.ambient,U(this.stage,this.ground,this.camera,this.avatar,...this.eventSys.hands),this.foreground,U(this.worldUISpace,this.loadingBar)),this.timer.addTickHandler(m=>this.update(m)),this._start(),globalThis.env=this}get useNewColorModel(){return xc.enabled}set useNewColorModel(e){xc.enabled=e,this.renderer.outputEncoding=e?_f:Zh}async _start(){w(this.styleSheetPath)&&await this.fetcher.get(this.styleSheetPath).style(),this.timer.start()}get gl(){return this.renderer.getContext()}get referenceSpace(){return this.renderer.xr.getReferenceSpace()}update(e){if(this.dispatchEvent(e),this.screenControl.visible){let r=this.xrSession;this._xrBinding=this.renderer.xr.getBinding(),this.hasXRMediaLayers&&this._xrMediaBinding===null===this.renderer.xr.isPresenting&&(this._xrMediaBinding===null&&w(r)?this._xrMediaBinding=new XRMediaBinding(r):this._xrMediaBinding=null);let o=r&&this.renderer.xr.getBaseLayer();o!==this.baseLayer&&(w(this.baseLayer)&&(this.removeWebXRLayer(this.baseLayer),this.baseLayer=null),w(o)&&(this.baseLayer=o,this.addWebXRLayer(o,0))),this.screenControl.resize(),this.eventSys.update(),this.avatar.update(e.dt),this.worldUISpace.update(this.avatar.height,this.avatar.worldPos,this.avatar.worldHeadingRadians,e.dt),this.fader.update(e.dt),If(e.dt),this.loadingBar.update(e.sdt),this.preRender(e);let i=Lr(this.renderer,this.camera);if(i!==this.camera){let s=i;s.layers.mask=this.camera.layers.mask;for(let a=0;a<s.cameras.length;++a){let l=s.cameras[a];l.layers.mask=this.camera.layers.mask,l.layers.enable(a+1),s.layers.enable(a+1)}}this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.enableSpectator&&(this.renderer.xr.isPresenting?io()&&!mm()&&this.drawSnapshot():(this.lastViewport.copy(this.curViewport),this.renderer.getViewport(this.curViewport)))}}drawSnapshot(){let e=this.renderer.xr.isPresenting,r=null;if(e){let o=Lr(this.renderer,this.camera);this.spectator.projectionMatrix.copy(this.camera.projectionMatrix),this.spectator.position.copy(o.position),this.spectator.quaternion.copy(o.quaternion),r=this.renderer.getRenderTarget(),this.renderer.xr.isPresenting=!1,this.renderer.setRenderTarget(null),this.renderer.setViewport(this.lastViewport)}this.renderer.clear(),this.renderer.render(this.scene,e?this.spectator:this.camera),e&&(this.renderer.setViewport(this.curViewport),this.renderer.setRenderTarget(r),this.renderer.xr.isPresenting=!0)}preRender(e){}async onQuitting(){this.dispatchEvent(new N("quitting")),window.location.href="/"}get hasAlpha(){return this.renderer.getContextAttributes().alpha}get xrSession(){return this.renderer.xr.getSession()}get xrBinding(){return this._xrBinding}get xrMediaBinding(){return this._xrMediaBinding}get isReadyForLayers(){return this.hasAlpha&&(!wn||fm.major>=15)}get hasXRMediaLayers(){return this._hasXRMediaLayers===null&&(this._hasXRMediaLayers=this.isReadyForLayers&&"XRMediaBinding"in globalThis&&Z(XRMediaBinding.prototype.createQuadLayer)),this._hasXRMediaLayers}get hasXRCompositionLayers(){return this._hasXRCompositionLayers===null&&(this._hasXRCompositionLayers=this.isReadyForLayers&&"XRWebGLBinding"in globalThis&&Z(XRWebGLBinding.prototype.createCubeLayer)),this._hasXRCompositionLayers}addWebXRLayer(e,r){this.layers.push(e),this.layerSortOrder.set(e,r),xr(this.layers,o=>-this.layerSortOrder.get(o)),this.updateLayers()}removeWebXRLayer(e){this.layerSortOrder.delete(e),Ce(this.layers,e),this.updateLayers()}updateLayers(){let e=this.xrSession;w(e)&&e.updateRenderState({layers:this.layers})}clearScene(){this.dispatchEvent(new N("sceneclearing")),ye(this.foreground),this.dispatchEvent(new N("scenecleared"))}async fadeOut(){++this.fadeDepth,this.fadeDepth===1&&(await this.fader.fadeOut(),this.skybox.visible=!1,this.camera.layers.set(Wo),this.loadingBar.start(),await this.fader.fadeIn())}async fadeIn(){this.fadeDepth===1&&(await this.fader.fadeOut(),this.camera.layers.set(Cl),this.skybox.visible=!0,await this.fader.fadeIn()),--this.fadeDepth}async withFade(e){try{return await this.fadeOut(),await e()}finally{await this.fadeIn()}}get showWebXRLayers(){return this.fadeDepth===0}set3DCursor(e){let r=e.children.slice(0);for(let o of r)this.cursor3D.add(o.name,o);this.eventSys.refreshCursors(),this.dispatchEvent(new N("newcursorloaded"))}async load(e,...r){let o=null;ki(e)?r.push(e):o=e;let i=new Cr(this,"/models/Cursors.glb",_r,!this.DEBUG);r.push(i),await this.fetcher.assets(o,...r),ji(i.result.scene,Xf),this.set3DCursor(i.result.scene)}loadGltf(e){return this.gltfLoader.loadAsync(e)}};function vu(n,t){return Ia(n,t,Bn)}var Es=class extends te{constructor(...e){super();this.element=fe(gt("input-range-with-number"),this.rangeInput=sm(Jt(()=>{this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.dispatchEvent(new N("input"))}),...e),this.numberInput=to(Jt(()=>{this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber,this.rangeInput.dispatchEvent(new Event("input"))}))),this.numberInput.min=this.rangeInput.min,this.numberInput.max=this.rangeInput.max,this.numberInput.step=this.rangeInput.step,this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.numberInput.disabled=this.rangeInput.disabled,this.numberInput.placeholder=this.rangeInput.placeholder}get value(){return this.rangeInput.value}set value(e){this.rangeInput.value=this.numberInput.value=e}get valueAsNumber(){return this.rangeInput.valueAsNumber}set valueAsNumber(e){this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber=e}get disabled(){return this.rangeInput.disabled}set disabled(e){this.rangeInput.disabled=this.numberInput.disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}};var ys=class{constructor(t,...e){this.name=t;this.properties=e}};function ud(n,...t){return new ys(n,...t)}var cd="DefaultPropertyGroup"+Tt(16),wv=gt("single-item");function Mx(n){return n.flatMap(t=>Fv(t).flatMap(Bn))}function Fv(n){let t=cd,e=new Array;return n instanceof ys?(t=n.name,e.push(...n.properties.map(r=>kx(t,r)))):e.push(kx(t,n)),e}function kx(n,t){let e=n===cd?null:Is("groupname",n);if(jt(t)){let[r,...o]=t,i=qu(r);for(let s of o)if(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement||s instanceof HTMLSelectElement){s.id.length===0&&(s.id=Tt(10)),i.htmlFor=s.id;break}return[nm(e,i),Xu(e,...o)]}else return(de(t)||ge(t)||St(t)||Ds(t))&&(t=om(t)),[Xu(e,t)]}function Av(n){return w(n)&&!Gu(n)&&!Ru(n)}var dr=class{constructor(t){this.element=t;this.groups=new Er;this.controls=new Array;this._disabled=!1;let e=[...t.children];for(;e.length>0;){let r=e.shift();fi(r)&&this.controls.push(r),r instanceof HTMLElement&&(this.checkGroup(r),e.push(...r.children))}}static find(){return Array.from(dr._find())}static*_find(){for(let t of Jd(".properties"))yield new dr(t)}static create(...t){let e=t.filter(Av),r=t.filter(Gu),o=t.filter(Ru),i=Ed(o,"properties"),s=Mx(e);return new dr(tm(Ue(...i),...r,...o,...s))}append(...t){let e=Mx(t);$(this.element,...e);for(let r of t){let o=r instanceof ys?r.properties:[r];for(let i of o)if(!de(i)){let[s,...a]=jt(i)?i:[null,i];for(let l of a)fi(l)&&this.controls.push(l)}}for(let r of e)this.checkGroup(r)}checkGroup(t){let e=Qt(t),r=e.dataset.groupname;r!==cd&&this.groups.add(r,t),e.parentElement===this.element&&e.tagName==="DD"&&(!e.previousElementSibling||e.previousElementSibling.tagName!=="DT")&&wv.applyToElement(e)}get disabled(){return this._disabled}set disabled(t){if(t!==this.disabled){this._disabled=t,Yd(this,t,"disabled");for(let e of this.controls)e.disabled=t}}get enabled(){return!this.disabled}set enabled(t){this.disabled=!t}setGroupVisible(t,e){let r=this.groups.get(t);if(r)for(let o of r)Xe(o,e)}getGroupVisible(t){let e=this.groups.get(t);if(e)for(let r of e)return bt(r);return!1}};var Su="micFields"+Tt(8),pd="camFields"+Tt(8);function Cx(n,t,e){gi(n),$(n,js(qt(""),"NONE"),...t.map(r=>js(kd(e&&r.deviceId===e.deviceId),qt(r.deviceId),r.label)))}var bu=class extends qn{constructor(e,r,o,i,s,a=!1){super("Configure devices");this.devices=r;this.audio=o;this.microphones=i;this.webcams=s;this.micLookup=null;this.camLookup=null;this.spkrLookup=null;this.spkrVolumeControl=null;this.speakers=null;this.cancelButton.style.display="none";let l=new Ot("/audio/test-clip.mp3",Fn,!a),p=e.assets(l).then(()=>this.audio.createBasicClip("test-audio",l,.5));$(this.contentArea,zd("2em"),this.properties=dr.create(ud(pd,["Webcams",this.webcamSelector=qs(Jt(async()=>{let m=this.webcamSelector.value,g=this.camLookup.get(m);await this.webcams.setDevice(g)}))]),ud(Su,["Microphones",this.microphoneSelector=qs(rt("inline-block"),Jt(async()=>{let m=this.microphoneSelector.value,g=this.micLookup.get(m);await this.microphones.setDevice(g)}))],["Volume",this.micVolumeControl=new Es(Fr(0),wr(100),Ar(1),qt(0),Jt(()=>{this.microphones.gain.setValueAtTime(this.micVolumeControl.valueAsNumber/100,0)}))],["Levels",this.micLevels=im(rt("inline-block"))]))),nn&&(this.properties.append(["Speakers",this.speakers=qs(Jt(async()=>{let m=this.speakers.value,g=this.spkrLookup.get(m);await this.audio.speakers.setAudioOutputDevice(g)}))]),this.audio.speakers.addEventListener("audiooutputchanged",m=>{this.speakers.value=m.device&&m.device.deviceId||""})),this.properties.append(["Volume",this.spkrVolumeControl=new Es(Fr(0),wr(100),Ar(1),qt(0),Jt(()=>this.audio.destination.volume=this.spkrVolumeControl.valueAsNumber/100))],["",this.testSpkrButton=zs("Test",Ws("Test audio"),zu(gn(.5)),lm(async()=>{this.testSpkrButton.disabled=!0,await p,await this.audio.playClipThrough("test-audio"),this.testSpkrButton.disabled=!1}))],["Using headphones",this.useHeadphones=Fi(Rs(this.audio.useHeadphones),Jt(()=>{this.audio.useHeadphones=this.useHeadphones.checked,Xe(this.headphoneWarning,!this.audio.useHeadphones,"inline-block")}))],this.headphoneWarning=fe(gt("alert alert-warning"),"\u{1F3A7}\u{1F399}\uFE0F This site has a voice chat feature. Voice chat is best experienced using headphones.")),this.activity=new vs(this.audio.context),this.activity.name="device-settings-dialog-activity",this.activity.addEventListener("activity",m=>{this.isOpen&&(this.micLevels.value=m.level)}),this.microphones.connect(this.activity),this.activity.start(),this.properties.setGroupVisible(Su,!1),Object.seal(this)}get showWebcams(){return this.properties.getGroupVisible(pd)}set showWebcams(e){this.properties.setGroupVisible(pd,e)}get showMicrophones(){return this.properties.getGroupVisible(Su)}set showMicrophones(e){this.properties.setGroupVisible(Su,e)}async onShowing(){if(this.showWebcams||this.showMicrophones){await this.devices.init();let e=await this.devices.getDevices();if(this.showWebcams){let r=e.filter(o=>o.kind==="videoinput");this.camLookup=vu(r,o=>o.deviceId),Cx(this.webcamSelector,r,this.webcams.device)}if(this.showMicrophones){let r=e.filter(o=>o.kind==="audioinput");this.micLookup=vu(r,o=>o.deviceId),Cx(this.microphoneSelector,r,this.microphones.device),this.microphones.usingHeadphones=this.useHeadphones.checked,this.microphones.enabled=!0,this.micVolumeControl.valueAsNumber=this.microphones.gain.value*100}}if(nn){await this.audio.speakers.ready;let e=await this.audio.speakers.getAudioOutputDevices();this.spkrLookup=vu(e,o=>o.deviceId),gi(this.speakers),$(this.speakers,...e.map(o=>js(qt(o.deviceId),o.label)));let r=await this.audio.speakers.getAudioOutputDevice();r||(r=await this.audio.speakers.getPreferredAudioOutput(),await this.audio.speakers.setAudioOutputDevice(r)),this.speakers.value=r&&r.deviceId||""}this.spkrVolumeControl.valueAsNumber=this.audio.destination.volume*100,this.useHeadphones.checked=this.audio.useHeadphones,Xe(this.headphoneWarning,!this.audio.useHeadphones,"inline-block"),await super.onShowing()}};var dd=class extends N{constructor(e){super("roomjoined");this.roomName=e}},md=class extends N{constructor(e){super("dialogshowing");this.showing=e}},_u=class extends Au{constructor(e){if(L(e))throw new We("Options are now required");if(L(e.canvas))throw new We("options.canvas is required");if(L(e.fetcher))throw new We("options.fetcher is required");if(L(e.dialogFontFamily))throw new We("options.dialogFontFamily is required");if(L(e.getAppUrl))throw new We("options.getAppUrl is required");if(L(e.uiImagePaths))throw new We("options.uiImagePaths is required");if(L(e.buttonFillColor))throw new We("options.buttonFillColor is required");if(L(e.labelFillColor))throw new We("options.labelFillColor is required");super(e.canvas,e.styleSheetPath,e.fetcher,e.enableFullResolution,e.DEBUG,e.defaultAvatarHeight,e.defaultFOV);this.envAudioToggleEvt=new N("environmentaudiotoggled");this._currentRoom=null;this._testSpaceLayout=!1;this.countTick=0;this.fpses=new Array;this.avgFPS=0;this.screenUISpace=new cl(e.buttonFillColor),this.compassImage=new Ra,this.clockImage=new Zn(this,"Clock","none",new Ua),this.clockImage.sizeMode="fixed-height",this.clockImage.mesh.renderOrder=5,this.statsImage=new Zn(this,"Stats","none",new za),this.statsImage.sizeMode="fixed-height",this.statsImage.mesh.renderOrder=5,this.infoLabel=new Sn(this,"InfoLabel","none",{minHeight:.1,maxHeight:.1,padding:.02,scale:1e3,bgFillColor:e.labelFillColor,textFillColor:"white"}),this.apps=new yl(this,e.getAppUrl),this.apps.addEventListener("apploaded",r=>{r.app.addEventListener("joinroom",o=>{o.roomName!==this._currentRoom&&(this._currentRoom=o.roomName,this.dispatchEvent(new dd(o.roomName)))})}),this.audio=new Ma(e.fetcher,kh),this.graph=new Na(this.audio.context),Vt(e.canvas)&&e.canvas.addEventListener("keypress",r=>{no(r)&&r.key==="`"&&this.graph.showDialog()}),this.audioPlayer=new Da(this.audio.context,this.audio.createSpatializer(!1,!1)),this.videoPlayer=new Al(this,this.audio.context,this.audio.createSpatializer(!1,!1)),this.videoPlayer.object.visible=!1,this.interactionAudio=new ja(this.audio,this.eventSys),this.microphones=new Ca(this.audio.context),this.webcams=new Xa,this.devices=new ka(this.microphones,this.webcams),this.confirmationDialog=new El(this,e.dialogFontFamily),this.devicesDialog=new bu(this.fetcher,this.devices,this.audio,this.microphones,this.webcams,this.DEBUG),this.uiButtons=new _l(e.uiImagePaths,20,e.buttonFillColor,e.labelFillColor,this.DEBUG),this.menuButton=new Vo(this.uiButtons,"ui","menu"),this.settingsButton=new Vo(this.uiButtons,"ui","settings"),this.quitButton=new Vo(this.uiButtons,"ui","quit"),this.muteMicButton=new $n(this.uiButtons,"microphone","mute","unmute"),this.muteCamButton=new $n(this.uiButtons,"media","play","pause"),this.muteEnvAudioButton=new $n(this.uiButtons,"environment-audio","mute","unmute"),this.muteEnvAudioButton.active=!0,this.audio.ready.then(()=>this.muteEnvAudioButton.active=!1),this.vrButton=new Oo(this.uiButtons,"VR"),this.fullscreenButton=new Oo(this.uiButtons,"Fullscreen"),this.arButton=new Oo(this.uiButtons,"AR"),Mo.isAvailable&&vi()&&(this.batteryImage=new Zn(this,"Battery","none",new Mo),this.batteryImage.sizeMode="fixed-height"),this.xrUI=new pl,this.subMenu=new Yn(fe(Vs("juniperSubMenu")),ie("sub-menu"),"flex"),this.createMenu(),this.screenControl.setUI(this.screenUISpace,this.fullscreenButton,this.vrButton,this.arButton),w(this.screenControl)&&this.screenControl.addEventListener("sessionstarted",r=>{r.mode==="Fullscreen"&&this.confirmationDialog.element.parentElement!==this.screenControl.fullscreenElement&&$(this.screenControl.fullscreenElement,this.devicesDialog,this.confirmationDialog)}),w(e.watchModelPath)&&(this.watch=new vl(this,e.watchModelPath)),this.microphones.addEventListener("devicesettingschanged",()=>{this.muteMicButton.active=this.microphones.enabled&&!this.microphones.muted}),this.webcams.addEventListener("devicesettingschanged",()=>{this.muteCamButton.active=this.webcams.enabled}),this.muteMicButton.addEventListener("click",()=>{this.microphones.muted=this.microphones.enabled&&!this.microphones.muted,this.muteMicButton.active=!this.microphones.muted}),this.muteCamButton.addEventListener("click",()=>{this.webcams.enabled=!this.webcams.enabled,this.muteCamButton.active=this.webcams.enabled}),this.muteMicButton.active=this.microphones.enabled&&!this.microphones.muted,this.muteCamButton.active=this.webcams.enabled,Z(e.createSpeechRecognizer)&&(this.speech=e.createSpeechRecognizer(this.fetcher,this.devicesDialog.activity,this.microphones),this.speech.continuous=!0)}get currentRoom(){return this._currentRoom}get testSpaceLayout(){return this._testSpaceLayout}set testSpaceLayout(e){e!==this.testSpaceLayout&&(this._testSpaceLayout=e)}createMenu(){w(this.batteryImage)&&(this.xrUI.addItem(this.batteryImage,{x:.75,y:-1,width:.2,height:.1}),$(this.screenUISpace.topRight,this.batteryImage)),this.xrUI.addItem(this.clockImage,{x:-1,y:1,height:.1}),this.xrUI.addItem(this.statsImage,{x:-1,y:.95,height:.1}),this.xrUI.addItem(this.confirmationDialog,{x:0,y:0,scale:.25}),this.xrUI.addItem(this.menuButton,{x:-1,y:-1,scale:.5}),this.xrUI.addItem(this.infoLabel,{x:0,y:-1.125,scale:.5}),this.xrUI.addItem(this.vrButton,{x:1,y:-1,scale:.5}),this.xrUI.addItem(this.arButton,{x:1,y:-1,scale:.5}),U(this.menuButton,this.subMenu),U(this.worldUISpace,this.xrUI),$(this.screenUISpace.topLeft,Xd("none"),$(this.webcams,rt("inline-block"),Sr(fn(50)),qd("scaleX(-1)"))),$(this.screenUISpace.topRight,this.compassImage,this.statsImage),$(this.screenUISpace.bottomCenter,this.infoLabel),$(this.screenUISpace.bottomRight,this.vrButton,this.arButton,this.fullscreenButton),$(this.screenUISpace.bottomLeft,fe(this.menuButton,rt("flex"),Od("column-reverse"),Hd(gn(.25)),this.subMenu)),hg(this.subMenu,this.settingsButton,this.muteCamButton,this.muteMicButton,this.muteEnvAudioButton,this.quitButton),this.settingsButton.addEventListener("click",async()=>{let e=this.screenControl.currentMode,r=this.renderer.xr.isPresenting;r&&await this.screenControl.stop(),await this.devicesDialog.showDialog(),r&&await this.screenControl.start(e)}),this.muteEnvAudioButton.addEventListener("click",()=>{this.muteEnvAudioButton.active=!this.muteEnvAudioButton.active,this.dispatchEvent(this.envAudioToggleEvt)}),this.quitButton.addEventListener("click",()=>this.withConfirmation("Confirm quit","Are you sure you want to quit?",async()=>{this.renderer.xr.isPresenting&&this.screenControl.stop(),await this.onQuitting()})),this.menuButton.addEventListener("click",()=>this.subMenu.visible=!this.subMenu.visible),[this.settingsButton,this.muteCamButton,this.muteMicButton,this.muteEnvAudioButton,this.quitButton].forEach(e=>e.addEventListener("click",()=>this.subMenu.visible=!1)),this.subMenu.visible=!1,this.vrButton.visible=io()&&Js()||xn(),this.arButton.visible=!1,this.muteCamButton.visible=!1,this.muteMicButton.visible=!1}layoutMenu(){let e=0;for(let r of this.subMenu.object.children)r.visible&&r.position.set(0,++e*.25,0)}preRender(e){super.preRender(e);let{worldPos:r,worldQuat:o}=this.avatar;if(this.audio.setUserPose(this.audio.localUserID,r.x,r.y,r.z,o.x,o.y,o.z,o.w),this.xrUI.visible=this.renderer.xr.isPresenting||this.testSpaceLayout,this.statsImage.isVisible=this.xrUI.visible&&this.DEBUG,this.renderer.xr.isPresenting||this.compassImage.setPitchAndHeading(Ci(this.avatar.worldPitchRadians),Ci(this.avatar.worldHeadingRadians)),this.layoutMenu(),this.DEBUG){let i=Math.round(e.fps);if(this.avgFPS+=i/100,this.fpses.push(i),this.fpses.length>100){let s=this.fpses.shift();this.avgFPS-=s/100}++this.countTick%100===0&&this.statsImage.image.setStats(this.avgFPS,this.renderer.info.render.calls,this.renderer.info.render.triangles)}this.confirmationDialog.update(e.dt)}get environmentAudioMuted(){return this.muteEnvAudioButton.active}async withConfirmation(e,r,o){this.onConfirmationShowing(!0),await this.confirmationDialog.prompt(e,r)&&o(),this.onConfirmationShowing(!1)}onConfirmationShowing(e){mg(this.quitButton,!e),this.dispatchEvent(new md(e))}async load(e,...r){let o=null;ki(e)?(r.push(e),o=this.loadingBar):o=e,Vt(this.renderer.domElement)&&$(this.renderer.domElement.parentElement,this.renderer.domElement,...this.screenUISpace.elements);let i=new Ot("/audio/footsteps.mp3",Fn,!this.DEBUG),s=new Ot("/audio/basic_enter.mp3",Fn,!this.DEBUG),a=new Ot("/audio/basic_exit.mp3",Fn,!this.DEBUG),l=new Ot("/audio/basic_error.mp3",Fn,!this.DEBUG),p=new Ot("/audio/vintage_radio_button_pressed.mp3",Fn,!this.DEBUG);r.push(...this.uiButtons.assets,i,s,a,l,p),w(this.watch)&&r.push(this.watch.asset),await super.load(o,...r),await br(this.audio.createBasicClip("footsteps",i,.5),this.interactionAudio.create("enter",s,.25),this.interactionAudio.create("exit",a,.25),this.interactionAudio.create("error",l,.25),this.interactionAudio.create("click",p,1)),this.screenUISpace.show()}};var EU=_u;export{EU as default};
