var M1=Object.create;var Xl=Object.defineProperty;var k1=Object.getOwnPropertyDescriptor;var E1=Object.getOwnPropertyNames;var b1=Object.getPrototypeOf,y1=Object.prototype.hasOwnProperty;var D1=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),jl=(n,e)=>{for(var t in e)Xl(n,t,{get:e[t],enumerable:!0})},C1=(n,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of E1(e))!y1.call(n,r)&&r!==t&&Xl(n,r,{get:()=>e[r],enumerable:!(o=k1(e,r))||o.enumerable});return n};var B1=(n,e,t)=>(t=n!=null?M1(b1(n)):{},C1(e||!n||!n.__esModule?Xl(t,"default",{value:n,enumerable:!0}):t,n));var sg=D1((vp,Sp)=>{(function(n,e){typeof vp=="object"&&typeof Sp<"u"?Sp.exports=e():typeof define=="function"&&define.amd?define(e):n.CardboardVRDisplay=e()})(vp,function(){"use strict";var n=function(){function c(d){this.value=d}function u(d){var h,f;function g(M,_){return new Promise(function(S,y){var R={key:M,arg:_,resolve:S,reject:y,next:null};f?f=f.next=R:(h=f=R,A(M,_))})}function A(M,_){try{var S=d[M](_),y=S.value;y instanceof c?Promise.resolve(y.value).then(function(R){A("next",R)},function(R){A("throw",R)}):E(S.done?"return":"normal",S.value)}catch(R){E("throw",R)}}function E(M,_){switch(M){case"return":h.resolve({value:_,done:!0});break;case"throw":h.reject(_);break;default:h.resolve({value:_,done:!1});break}h=h.next,h?A(h.key,h.arg):f=null}this._invoke=g,typeof d.return!="function"&&(this.return=void 0)}return typeof Symbol=="function"&&Symbol.asyncIterator&&(u.prototype[Symbol.asyncIterator]=function(){return this}),u.prototype.next=function(d){return this._invoke("next",d)},u.prototype.throw=function(d){return this._invoke("throw",d)},u.prototype.return=function(d){return this._invoke("return",d)},{wrap:function(d){return function(){return new u(d.apply(this,arguments))}},await:function(d){return new c(d)}}}(),e=function(c,u){if(!(c instanceof u))throw new TypeError("Cannot call a class as a function")},t=function(){function c(u,d){for(var h=0;h<d.length;h++){var f=d[h];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(u,f.key,f)}}return function(u,d,h){return d&&c(u.prototype,d),h&&c(u,h),u}}(),o=function(){function c(u,d){var h=[],f=!0,g=!1,A=void 0;try{for(var E=u[Symbol.iterator](),M;!(f=(M=E.next()).done)&&(h.push(M.value),!(d&&h.length===d));f=!0);}catch(_){g=!0,A=_}finally{try{!f&&E.return&&E.return()}finally{if(g)throw A}}return h}return function(u,d){if(Array.isArray(u))return u;if(Symbol.iterator in Object(u))return c(u,d);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=.001,i=1,s=function(u,d){return"data:"+u+","+encodeURIComponent(d)},a=function(u,d,h){return u+(d-u)*h},l=function(){var c=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return c}}(),p=function(){var c=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return c}}(),m=function(){var c=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return c}}(),x=function(){var c=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return c}}(),F=function(){var c=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),u=c?parseInt(c[1],10):null;return function(){return u}}(),v=function(){var c=!1;return c=l()&&m()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return c}}(),k=function(){var c=!1;if(F()===65){var u=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(u){var d=u[1].split("."),h=o(d,4),f=h[0],g=h[1],A=h[2],E=h[3];c=parseInt(A,10)===3325&&parseInt(E,10)<148}}return function(){return c}}(),D=function(){var c=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return c}}(),b=function(){var u=window.orientation==90||window.orientation==-90;return D()?!u:u},P=function(u){return!(isNaN(u)||u<=r||u>i)},O=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},I=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},L=function(u){if(p())return!1;if(u.requestFullscreen)u.requestFullscreen();else if(u.webkitRequestFullscreen)u.webkitRequestFullscreen();else if(u.mozRequestFullScreen)u.mozRequestFullScreen();else if(u.msRequestFullscreen)u.msRequestFullscreen();else return!1;return!0},U=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},C=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},W=function(u,d,h,f){var g=u.createShader(u.VERTEX_SHADER);u.shaderSource(g,d),u.compileShader(g);var A=u.createShader(u.FRAGMENT_SHADER);u.shaderSource(A,h),u.compileShader(A);var E=u.createProgram();u.attachShader(E,g),u.attachShader(E,A);for(var M in f)u.bindAttribLocation(E,f[M],M);return u.linkProgram(E),u.deleteShader(g),u.deleteShader(A),E},$=function(u,d){for(var h={},f=u.getProgramParameter(d,u.ACTIVE_UNIFORMS),g="",A=0;A<f;A++){var E=u.getActiveUniform(d,A);g=E.name.replace("[0]",""),h[g]=u.getUniformLocation(d,g)}return h},Y=function(u,d,h,f,g,A,E){var M=1/(d-h),_=1/(f-g),S=1/(A-E);return u[0]=-2*M,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*_,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*S,u[11]=0,u[12]=(d+h)*M,u[13]=(g+f)*_,u[14]=(E+A)*S,u[15]=1,u},ie=function(){var u=!1;return function(d){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(d)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(d.substr(0,4)))&&(u=!0)}(navigator.userAgent||navigator.vendor||window.opera),u},ne=function(u,d){for(var h in d)d.hasOwnProperty(h)&&(u[h]=d[h]);return u},Te=function(u){if(l()){var d=u.style.width,h=u.style.height;u.style.width=parseInt(d)+1+"px",u.style.height=parseInt(h)+"px",setTimeout(function(){u.style.width=d,u.style.height=h},100)}window.canvas=u},Fe=function(){var c=Math.PI/180,u=Math.PI*.25;function d(_,S,y,R){var H=Math.tan(S?S.upDegrees*c:u),G=Math.tan(S?S.downDegrees*c:u),K=Math.tan(S?S.leftDegrees*c:u),j=Math.tan(S?S.rightDegrees*c:u),X=2/(K+j),he=2/(H+G);return _[0]=X,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=he,_[6]=0,_[7]=0,_[8]=-((K-j)*X*.5),_[9]=(H-G)*he*.5,_[10]=R/(y-R),_[11]=-1,_[12]=0,_[13]=0,_[14]=R*y/(y-R),_[15]=0,_}function h(_,S,y){var R=S[0],H=S[1],G=S[2],K=S[3],j=R+R,X=H+H,he=G+G,Be=R*j,Xe=R*X,_e=R*he,Je=H*X,ft=H*he,xt=G*he,gt=K*j,wt=K*X,bn=K*he;return _[0]=1-(Je+xt),_[1]=Xe+bn,_[2]=_e-wt,_[3]=0,_[4]=Xe-bn,_[5]=1-(Be+xt),_[6]=ft+gt,_[7]=0,_[8]=_e+wt,_[9]=ft-gt,_[10]=1-(Be+Je),_[11]=0,_[12]=y[0],_[13]=y[1],_[14]=y[2],_[15]=1,_}function f(_,S,y){var R=y[0],H=y[1],G=y[2],K,j,X,he,Be,Xe,_e,Je,ft,xt,gt,wt;return S===_?(_[12]=S[0]*R+S[4]*H+S[8]*G+S[12],_[13]=S[1]*R+S[5]*H+S[9]*G+S[13],_[14]=S[2]*R+S[6]*H+S[10]*G+S[14],_[15]=S[3]*R+S[7]*H+S[11]*G+S[15]):(K=S[0],j=S[1],X=S[2],he=S[3],Be=S[4],Xe=S[5],_e=S[6],Je=S[7],ft=S[8],xt=S[9],gt=S[10],wt=S[11],_[0]=K,_[1]=j,_[2]=X,_[3]=he,_[4]=Be,_[5]=Xe,_[6]=_e,_[7]=Je,_[8]=ft,_[9]=xt,_[10]=gt,_[11]=wt,_[12]=K*R+Be*H+ft*G+S[12],_[13]=j*R+Xe*H+xt*G+S[13],_[14]=X*R+_e*H+gt*G+S[14],_[15]=he*R+Je*H+wt*G+S[15]),_}function g(_,S){var y=S[0],R=S[1],H=S[2],G=S[3],K=S[4],j=S[5],X=S[6],he=S[7],Be=S[8],Xe=S[9],_e=S[10],Je=S[11],ft=S[12],xt=S[13],gt=S[14],wt=S[15],bn=y*j-R*K,ti=y*X-H*K,ni=y*he-G*K,oi=R*X-H*j,ri=R*he-G*j,ii=H*he-G*X,si=Be*xt-Xe*ft,ai=Be*gt-_e*ft,ci=Be*wt-Je*ft,li=Xe*gt-_e*xt,ui=Xe*wt-Je*xt,pi=_e*wt-Je*gt,Ne=bn*pi-ti*ui+ni*li+oi*ci-ri*ai+ii*si;return Ne?(Ne=1/Ne,_[0]=(j*pi-X*ui+he*li)*Ne,_[1]=(H*ui-R*pi-G*li)*Ne,_[2]=(xt*ii-gt*ri+wt*oi)*Ne,_[3]=(_e*ri-Xe*ii-Je*oi)*Ne,_[4]=(X*ci-K*pi-he*ai)*Ne,_[5]=(y*pi-H*ci+G*ai)*Ne,_[6]=(gt*ni-ft*ii-wt*ti)*Ne,_[7]=(Be*ii-_e*ni+Je*ti)*Ne,_[8]=(K*ui-j*ci+he*si)*Ne,_[9]=(R*ci-y*ui-G*si)*Ne,_[10]=(ft*ri-xt*ni+wt*bn)*Ne,_[11]=(Xe*ni-Be*ri-Je*bn)*Ne,_[12]=(j*ai-K*li-X*si)*Ne,_[13]=(y*li-R*ai+H*si)*Ne,_[14]=(xt*ti-ft*oi-gt*bn)*Ne,_[15]=(Be*oi-Xe*ti+_e*bn)*Ne,_):null}var A=new Float32Array([0,0,0,1]),E=new Float32Array([0,0,0]);function M(_,S,y,R,H,G){d(_,R||null,G.depthNear,G.depthFar);var K=y.orientation||A,j=y.position||E;h(S,K,j),H&&f(S,S,H),g(S,S)}return function(_,S,y){return!_||!S?!1:(_.pose=S,_.timestamp=S.timestamp,M(_.leftProjectionMatrix,_.leftViewMatrix,S,y._getFieldOfView("left"),y._getEyeOffset("left"),y),M(_.rightProjectionMatrix,_.rightViewMatrix,S,y._getFieldOfView("right"),y._getEyeOffset("right"),y),!0)}}(),se=function(){var u=window.self!==window.top,d=rt(document.referrer),h=rt(window.location.href);return u&&d!==h},rt=function(u){var d,h=u.indexOf("://");h!==-1?d=h+3:d=0;var f=u.indexOf("/",d);return f===-1&&(f=u.length),u.substring(0,f)},hn=function(u){if(u.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var d=2*Math.acos(u.w);return d},ho=function(){var c={};return function(u,d){c[u]===void 0&&(console.warn("webvr-polyfill: "+d),c[u]=!0)}}(),Pt=function(u,d){var h=d?"Please use "+d+" instead.":"";ho(u,u+" has been deprecated. This may not work on native WebVR displays. "+h)};function qg(c,u,d){if(!u){d(c);return}for(var h=[],f=null,g=0;g<u.length;++g){var A=u[g];switch(A){case c.TEXTURE_BINDING_2D:case c.TEXTURE_BINDING_CUBE_MAP:var E=u[++g];if(E<c.TEXTURE0||E>c.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),h.push(null,null);break}f||(f=c.getParameter(c.ACTIVE_TEXTURE)),c.activeTexture(E),h.push(c.getParameter(A),null);break;case c.ACTIVE_TEXTURE:f=c.getParameter(c.ACTIVE_TEXTURE),h.push(null);break;default:h.push(c.getParameter(A));break}}d(c);for(var g=0;g<u.length;++g){var A=u[g],M=h[g];switch(A){case c.ACTIVE_TEXTURE:break;case c.ARRAY_BUFFER_BINDING:c.bindBuffer(c.ARRAY_BUFFER,M);break;case c.COLOR_CLEAR_VALUE:c.clearColor(M[0],M[1],M[2],M[3]);break;case c.COLOR_WRITEMASK:c.colorMask(M[0],M[1],M[2],M[3]);break;case c.CURRENT_PROGRAM:c.useProgram(M);break;case c.ELEMENT_ARRAY_BUFFER_BINDING:c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,M);break;case c.FRAMEBUFFER_BINDING:c.bindFramebuffer(c.FRAMEBUFFER,M);break;case c.RENDERBUFFER_BINDING:c.bindRenderbuffer(c.RENDERBUFFER,M);break;case c.TEXTURE_BINDING_2D:var E=u[++g];if(E<c.TEXTURE0||E>c.TEXTURE31)break;c.activeTexture(E),c.bindTexture(c.TEXTURE_2D,M);break;case c.TEXTURE_BINDING_CUBE_MAP:var E=u[++g];if(E<c.TEXTURE0||E>c.TEXTURE31)break;c.activeTexture(E),c.bindTexture(c.TEXTURE_CUBE_MAP,M);break;case c.VIEWPORT:c.viewport(M[0],M[1],M[2],M[3]);break;case c.BLEND:case c.CULL_FACE:case c.DEPTH_TEST:case c.SCISSOR_TEST:case c.STENCIL_TEST:M?c.enable(A):c.disable(A);break;default:console.log("No GL restore behavior for 0x"+A.toString(16));break}f&&c.activeTexture(f)}}var Zr=qg,Qg=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),Yg=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function Vt(c,u,d,h){this.gl=c,this.cardboardUI=u,this.bufferScale=d,this.dirtySubmitFrameBindings=h,this.ctxAttribs=c.getContextAttributes(),this.instanceExt=c.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=c.drawingBufferWidth,this.bufferHeight=c.drawingBufferHeight,this.realBindFramebuffer=c.bindFramebuffer,this.realEnable=c.enable,this.realDisable=c.disable,this.realColorMask=c.colorMask,this.realClearColor=c.clearColor,this.realViewport=c.viewport,l()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(c.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(c.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=W(c,Qg,Yg,this.attribs),this.uniforms=$(c,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=c.createBuffer(),this.indexBuffer=c.createBuffer(),this.indexCount=0,this.renderTarget=c.createTexture(),this.framebuffer=c.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=c.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=c.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=c.createRenderbuffer()),this.patch(),this.onResize()}Vt.prototype.destroy=function(){var c=this.gl;this.unpatch(),c.deleteProgram(this.program),c.deleteBuffer(this.vertexBuffer),c.deleteBuffer(this.indexBuffer),c.deleteTexture(this.renderTarget),c.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&c.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&c.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&c.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},Vt.prototype.onResize=function(){var c=this.gl,u=this,d=[c.RENDERBUFFER_BINDING,c.TEXTURE_BINDING_2D,c.TEXTURE0];Zr(c,d,function(h){u.realBindFramebuffer.call(h,h.FRAMEBUFFER,null),u.scissorTest&&u.realDisable.call(h,h.SCISSOR_TEST),u.realColorMask.call(h,!0,!0,!0,!0),u.realViewport.call(h,0,0,h.drawingBufferWidth,h.drawingBufferHeight),u.realClearColor.call(h,0,0,0,1),h.clear(h.COLOR_BUFFER_BIT),u.realBindFramebuffer.call(h,h.FRAMEBUFFER,u.framebuffer),h.bindTexture(h.TEXTURE_2D,u.renderTarget),h.texImage2D(h.TEXTURE_2D,0,u.ctxAttribs.alpha?h.RGBA:h.RGB,u.bufferWidth,u.bufferHeight,0,u.ctxAttribs.alpha?h.RGBA:h.RGB,h.UNSIGNED_BYTE,null),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,u.renderTarget,0),u.ctxAttribs.depth&&u.ctxAttribs.stencil?(h.bindRenderbuffer(h.RENDERBUFFER,u.depthStencilBuffer),h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_STENCIL,u.bufferWidth,u.bufferHeight),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,u.depthStencilBuffer)):u.ctxAttribs.depth?(h.bindRenderbuffer(h.RENDERBUFFER,u.depthBuffer),h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_COMPONENT16,u.bufferWidth,u.bufferHeight),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,u.depthBuffer)):u.ctxAttribs.stencil&&(h.bindRenderbuffer(h.RENDERBUFFER,u.stencilBuffer),h.renderbufferStorage(h.RENDERBUFFER,h.STENCIL_INDEX8,u.bufferWidth,u.bufferHeight),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.STENCIL_ATTACHMENT,h.RENDERBUFFER,u.stencilBuffer)),!h.checkFramebufferStatus(h.FRAMEBUFFER)===h.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),u.realBindFramebuffer.call(h,h.FRAMEBUFFER,u.lastBoundFramebuffer),u.scissorTest&&u.realEnable.call(h,h.SCISSOR_TEST),u.realColorMask.apply(h,u.colorMask),u.realViewport.apply(h,u.viewport),u.realClearColor.apply(h,u.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},Vt.prototype.patch=function(){if(!this.isPatched){var c=this,u=this.gl.canvas,d=this.gl;l()||(u.width=O()*this.bufferScale,u.height=I()*this.bufferScale,Object.defineProperty(u,"width",{configurable:!0,enumerable:!0,get:function(){return c.bufferWidth},set:function(f){c.bufferWidth=f,c.realCanvasWidth.set.call(u,f),c.onResize()}}),Object.defineProperty(u,"height",{configurable:!0,enumerable:!0,get:function(){return c.bufferHeight},set:function(f){c.bufferHeight=f,c.realCanvasHeight.set.call(u,f),c.onResize()}})),this.lastBoundFramebuffer=d.getParameter(d.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(d.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(h,f){c.lastBoundFramebuffer=f||c.framebuffer,c.realBindFramebuffer.call(d,h,c.lastBoundFramebuffer)},this.cullFace=d.getParameter(d.CULL_FACE),this.depthTest=d.getParameter(d.DEPTH_TEST),this.blend=d.getParameter(d.BLEND),this.scissorTest=d.getParameter(d.SCISSOR_TEST),this.stencilTest=d.getParameter(d.STENCIL_TEST),d.enable=function(h){switch(h){case d.CULL_FACE:c.cullFace=!0;break;case d.DEPTH_TEST:c.depthTest=!0;break;case d.BLEND:c.blend=!0;break;case d.SCISSOR_TEST:c.scissorTest=!0;break;case d.STENCIL_TEST:c.stencilTest=!0;break}c.realEnable.call(d,h)},d.disable=function(h){switch(h){case d.CULL_FACE:c.cullFace=!1;break;case d.DEPTH_TEST:c.depthTest=!1;break;case d.BLEND:c.blend=!1;break;case d.SCISSOR_TEST:c.scissorTest=!1;break;case d.STENCIL_TEST:c.stencilTest=!1;break}c.realDisable.call(d,h)},this.colorMask=d.getParameter(d.COLOR_WRITEMASK),d.colorMask=function(h,f,g,A){c.colorMask[0]=h,c.colorMask[1]=f,c.colorMask[2]=g,c.colorMask[3]=A,c.realColorMask.call(d,h,f,g,A)},this.clearColor=d.getParameter(d.COLOR_CLEAR_VALUE),d.clearColor=function(h,f,g,A){c.clearColor[0]=h,c.clearColor[1]=f,c.clearColor[2]=g,c.clearColor[3]=A,c.realClearColor.call(d,h,f,g,A)},this.viewport=d.getParameter(d.VIEWPORT),d.viewport=function(h,f,g,A){c.viewport[0]=h,c.viewport[1]=f,c.viewport[2]=g,c.viewport[3]=A,c.realViewport.call(d,h,f,g,A)},this.isPatched=!0,Te(u)}},Vt.prototype.unpatch=function(){if(this.isPatched){var c=this.gl,u=this.gl.canvas;l()||(Object.defineProperty(u,"width",this.realCanvasWidth),Object.defineProperty(u,"height",this.realCanvasHeight)),u.width=this.bufferWidth,u.height=this.bufferHeight,c.bindFramebuffer=this.realBindFramebuffer,c.enable=this.realEnable,c.disable=this.realDisable,c.colorMask=this.realColorMask,c.clearColor=this.realClearColor,c.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&c.bindFramebuffer(c.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){Te(u)},1)}},Vt.prototype.setTextureBounds=function(c,u){c||(c=[0,0,.5,1]),u||(u=[.5,0,.5,1]),this.viewportOffsetScale[0]=c[0],this.viewportOffsetScale[1]=c[1],this.viewportOffsetScale[2]=c[2],this.viewportOffsetScale[3]=c[3],this.viewportOffsetScale[4]=u[0],this.viewportOffsetScale[5]=u[1],this.viewportOffsetScale[6]=u[2],this.viewportOffsetScale[7]=u[3]},Vt.prototype.submitFrame=function(){var c=this.gl,u=this,d=[];if(this.dirtySubmitFrameBindings||d.push(c.CURRENT_PROGRAM,c.ARRAY_BUFFER_BINDING,c.ELEMENT_ARRAY_BUFFER_BINDING,c.TEXTURE_BINDING_2D,c.TEXTURE0),Zr(c,d,function(f){u.realBindFramebuffer.call(f,f.FRAMEBUFFER,null);var g=0,A=0;u.instanceExt&&(g=f.getVertexAttrib(u.attribs.position,u.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),A=f.getVertexAttrib(u.attribs.texCoord,u.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),u.cullFace&&u.realDisable.call(f,f.CULL_FACE),u.depthTest&&u.realDisable.call(f,f.DEPTH_TEST),u.blend&&u.realDisable.call(f,f.BLEND),u.scissorTest&&u.realDisable.call(f,f.SCISSOR_TEST),u.stencilTest&&u.realDisable.call(f,f.STENCIL_TEST),u.realColorMask.call(f,!0,!0,!0,!0),u.realViewport.call(f,0,0,f.drawingBufferWidth,f.drawingBufferHeight),(u.ctxAttribs.alpha||l())&&(u.realClearColor.call(f,0,0,0,1),f.clear(f.COLOR_BUFFER_BIT)),f.useProgram(u.program),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,u.indexBuffer),f.bindBuffer(f.ARRAY_BUFFER,u.vertexBuffer),f.enableVertexAttribArray(u.attribs.position),f.enableVertexAttribArray(u.attribs.texCoord),f.vertexAttribPointer(u.attribs.position,2,f.FLOAT,!1,20,0),f.vertexAttribPointer(u.attribs.texCoord,3,f.FLOAT,!1,20,8),u.instanceExt&&(g!=0&&u.instanceExt.vertexAttribDivisorANGLE(u.attribs.position,0),A!=0&&u.instanceExt.vertexAttribDivisorANGLE(u.attribs.texCoord,0)),f.activeTexture(f.TEXTURE0),f.uniform1i(u.uniforms.diffuse,0),f.bindTexture(f.TEXTURE_2D,u.renderTarget),f.uniform4fv(u.uniforms.viewportOffsetScale,u.viewportOffsetScale),f.drawElements(f.TRIANGLES,u.indexCount,f.UNSIGNED_SHORT,0),u.cardboardUI&&u.cardboardUI.renderNoState(),u.realBindFramebuffer.call(u.gl,f.FRAMEBUFFER,u.framebuffer),u.ctxAttribs.preserveDrawingBuffer||(u.realClearColor.call(f,0,0,0,0),f.clear(f.COLOR_BUFFER_BIT)),u.dirtySubmitFrameBindings||u.realBindFramebuffer.call(f,f.FRAMEBUFFER,u.lastBoundFramebuffer),u.cullFace&&u.realEnable.call(f,f.CULL_FACE),u.depthTest&&u.realEnable.call(f,f.DEPTH_TEST),u.blend&&u.realEnable.call(f,f.BLEND),u.scissorTest&&u.realEnable.call(f,f.SCISSOR_TEST),u.stencilTest&&u.realEnable.call(f,f.STENCIL_TEST),u.realColorMask.apply(f,u.colorMask),u.realViewport.apply(f,u.viewport),(u.ctxAttribs.alpha||!u.ctxAttribs.preserveDrawingBuffer)&&u.realClearColor.apply(f,u.clearColor),u.instanceExt&&(g!=0&&u.instanceExt.vertexAttribDivisorANGLE(u.attribs.position,g),A!=0&&u.instanceExt.vertexAttribDivisorANGLE(u.attribs.texCoord,A))}),l()){var h=c.canvas;(h.width!=u.bufferWidth||h.height!=u.bufferHeight)&&(u.bufferWidth=h.width,u.bufferHeight=h.height,u.onResize())}},Vt.prototype.updateDeviceInfo=function(c){var u=this.gl,d=this,h=[u.ARRAY_BUFFER_BINDING,u.ELEMENT_ARRAY_BUFFER_BINDING];Zr(u,h,function(f){var g=d.computeMeshVertices_(d.meshWidth,d.meshHeight,c);if(f.bindBuffer(f.ARRAY_BUFFER,d.vertexBuffer),f.bufferData(f.ARRAY_BUFFER,g,f.STATIC_DRAW),!d.indexCount){var A=d.computeMeshIndices_(d.meshWidth,d.meshHeight);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,d.indexBuffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,A,f.STATIC_DRAW),d.indexCount=A.length}})},Vt.prototype.computeMeshVertices_=function(c,u,d){for(var h=new Float32Array(2*c*u*5),f=d.getLeftEyeVisibleTanAngles(),g=d.getLeftEyeNoLensTanAngles(),A=d.getLeftEyeVisibleScreenRect(g),E=0,M=0;M<2;M++){for(var _=0;_<u;_++)for(var S=0;S<c;S++,E++){var y=S/(c-1),R=_/(u-1),H=y,G=R,K=a(f[0],f[2],y),j=a(f[3],f[1],R),X=Math.sqrt(K*K+j*j),he=d.distortion.distortInverse(X),Be=K*he/X,Xe=j*he/X;y=(Be-g[0])/(g[2]-g[0]),R=(Xe-g[3])/(g[1]-g[3]),y=(A.x+y*A.width-.5)*2,R=(A.y+R*A.height-.5)*2,h[E*5+0]=y,h[E*5+1]=R,h[E*5+2]=H,h[E*5+3]=G,h[E*5+4]=M}var _e=f[2]-f[0];f[0]=-(_e+f[0]),f[2]=_e-f[2],_e=g[2]-g[0],g[0]=-(_e+g[0]),g[2]=_e-g[2],A.x=1-(A.x+A.width)}return h},Vt.prototype.computeMeshIndices_=function(c,u){for(var d=new Uint16Array(2*(c-1)*(u-1)*6),h=c/2,f=u/2,g=0,A=0,E=0;E<2;E++)for(var M=0;M<u;M++)for(var _=0;_<c;_++,g++)_==0||M==0||(_<=h==M<=f?(d[A++]=g,d[A++]=g-c-1,d[A++]=g-c,d[A++]=g-c-1,d[A++]=g,d[A++]=g-1):(d[A++]=g-1,d[A++]=g-c,d[A++]=g,d[A++]=g-c,d[A++]=g-1,d[A++]=g-c-1));return d},Vt.prototype.getOwnPropertyDescriptor_=function(c,u){var d=Object.getOwnPropertyDescriptor(c,u);return(d.get===void 0||d.set===void 0)&&(d.configurable=!0,d.enumerable=!0,d.get=function(){return this.getAttribute(u)},d.set=function(h){this.setAttribute(u,h)}),d};var Kg=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),Jg=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),Sd=Math.PI/180,Ol=60,Td=12,Md=20,Wl=1,kd=.75,Ed=.3125,Zg=4,mo=28,Hl=1.5;function fo(c){this.gl=c,this.attribs={position:0},this.program=W(c,Kg,Jg,this.attribs),this.uniforms=$(c,this.program),this.vertexBuffer=c.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}fo.prototype.destroy=function(){var c=this.gl;this.listener&&c.canvas.removeEventListener("click",this.listener,!1),c.deleteProgram(this.program),c.deleteBuffer(this.vertexBuffer)},fo.prototype.listen=function(c,u){var d=this.gl.canvas;this.listener=function(h){var f=d.clientWidth/2,g=mo*Hl;h.clientX>f-g&&h.clientX<f+g&&h.clientY>d.clientHeight-g?c(h):h.clientX<g&&h.clientY<g&&u(h)},d.addEventListener("click",this.listener,!1)},fo.prototype.onResize=function(){var c=this.gl,u=this,d=[c.ARRAY_BUFFER_BINDING];Zr(c,d,function(h){var f=[],g=h.drawingBufferWidth/2,A=Math.max(screen.width,screen.height)*window.devicePixelRatio,E=h.drawingBufferWidth/A,M=E*window.devicePixelRatio,_=Zg*M/2,S=mo*Hl*M,y=mo*M/2,R=(mo*Hl-mo)*M;f.push(g-_,S),f.push(g-_,h.drawingBufferHeight),f.push(g+_,S),f.push(g+_,h.drawingBufferHeight),u.gearOffset=f.length/2;function H(he,Be){var Xe=(90-he)*Sd,_e=Math.cos(Xe),Je=Math.sin(Xe);f.push(Ed*_e*y+g,Ed*Je*y+y),f.push(Be*_e*y+g,Be*Je*y+y)}for(var G=0;G<=6;G++){var K=G*Ol;H(K,Wl),H(K+Td,Wl),H(K+Md,kd),H(K+(Ol-Md),kd),H(K+(Ol-Td),Wl)}u.gearVertexCount=f.length/2-u.gearOffset,u.arrowOffset=f.length/2;function j(he,Be){f.push(R+he,h.drawingBufferHeight-R-Be)}var X=_/Math.sin(45*Sd);j(0,y),j(y,0),j(y+X,X),j(X,y+X),j(X,y-X),j(0,y),j(y,y*2),j(y+X,y*2-X),j(X,y-X),j(0,y),j(X,y-_),j(mo*M,y-_),j(X,y+_),j(mo*M,y+_),u.arrowVertexCount=f.length/2-u.arrowOffset,h.bindBuffer(h.ARRAY_BUFFER,u.vertexBuffer),h.bufferData(h.ARRAY_BUFFER,new Float32Array(f),h.STATIC_DRAW)})},fo.prototype.render=function(){var c=this.gl,u=this,d=[c.CULL_FACE,c.DEPTH_TEST,c.BLEND,c.SCISSOR_TEST,c.STENCIL_TEST,c.COLOR_WRITEMASK,c.VIEWPORT,c.CURRENT_PROGRAM,c.ARRAY_BUFFER_BINDING];Zr(c,d,function(h){h.disable(h.CULL_FACE),h.disable(h.DEPTH_TEST),h.disable(h.BLEND),h.disable(h.SCISSOR_TEST),h.disable(h.STENCIL_TEST),h.colorMask(!0,!0,!0,!0),h.viewport(0,0,h.drawingBufferWidth,h.drawingBufferHeight),u.renderNoState()})},fo.prototype.renderNoState=function(){var c=this.gl;c.useProgram(this.program),c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer),c.enableVertexAttribArray(this.attribs.position),c.vertexAttribPointer(this.attribs.position,2,c.FLOAT,!1,8,0),c.uniform4f(this.uniforms.color,1,1,1,1),Y(this.projMat,0,c.drawingBufferWidth,0,c.drawingBufferHeight,.1,1024),c.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),c.drawArrays(c.TRIANGLE_STRIP,0,4),c.drawArrays(c.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),c.drawArrays(c.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function Vs(c){this.coefficients=c}Vs.prototype.distortInverse=function(c){for(var u=0,d=1,h=c-this.distort(u);Math.abs(d-u)>1e-4;){var f=c-this.distort(d),g=d-f*((d-u)/(f-h));u=d,d=g,h=f}return d},Vs.prototype.distort=function(c){for(var u=c*c,d=0,h=0;h<this.coefficients.length;h++)d=u*(d+this.coefficients[h]);return(d+1)*c};var Gt=Math.PI/180,Xt=180/Math.PI,Ae=function(u,d,h){this.x=u||0,this.y=d||0,this.z=h||0};Ae.prototype={constructor:Ae,set:function(u,d,h){return this.x=u,this.y=d,this.z=h,this},copy:function(u){return this.x=u.x,this.y=u.y,this.z=u.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var u=this.length();if(u!==0){var d=1/u;this.multiplyScalar(d)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(u){this.x*=u,this.y*=u,this.z*=u},applyQuaternion:function(u){var d=this.x,h=this.y,f=this.z,g=u.x,A=u.y,E=u.z,M=u.w,_=M*d+A*f-E*h,S=M*h+E*d-g*f,y=M*f+g*h-A*d,R=-g*d-A*h-E*f;return this.x=_*M+R*-g+S*-E-y*-A,this.y=S*M+R*-A+y*-g-_*-E,this.z=y*M+R*-E+_*-A-S*-g,this},dot:function(u){return this.x*u.x+this.y*u.y+this.z*u.z},crossVectors:function(u,d){var h=u.x,f=u.y,g=u.z,A=d.x,E=d.y,M=d.z;return this.x=f*M-g*E,this.y=g*A-h*M,this.z=h*E-f*A,this}};var ae=function(u,d,h,f){this.x=u||0,this.y=d||0,this.z=h||0,this.w=f!==void 0?f:1};ae.prototype={constructor:ae,set:function(u,d,h,f){return this.x=u,this.y=d,this.z=h,this.w=f,this},copy:function(u){return this.x=u.x,this.y=u.y,this.z=u.z,this.w=u.w,this},setFromEulerXYZ:function(u,d,h){var f=Math.cos(u/2),g=Math.cos(d/2),A=Math.cos(h/2),E=Math.sin(u/2),M=Math.sin(d/2),_=Math.sin(h/2);return this.x=E*g*A+f*M*_,this.y=f*M*A-E*g*_,this.z=f*g*_+E*M*A,this.w=f*g*A-E*M*_,this},setFromEulerYXZ:function(u,d,h){var f=Math.cos(u/2),g=Math.cos(d/2),A=Math.cos(h/2),E=Math.sin(u/2),M=Math.sin(d/2),_=Math.sin(h/2);return this.x=E*g*A+f*M*_,this.y=f*M*A-E*g*_,this.z=f*g*_-E*M*A,this.w=f*g*A+E*M*_,this},setFromAxisAngle:function(u,d){var h=d/2,f=Math.sin(h);return this.x=u.x*f,this.y=u.y*f,this.z=u.z*f,this.w=Math.cos(h),this},multiply:function(u){return this.multiplyQuaternions(this,u)},multiplyQuaternions:function(u,d){var h=u.x,f=u.y,g=u.z,A=u.w,E=d.x,M=d.y,_=d.z,S=d.w;return this.x=h*S+A*E+f*_-g*M,this.y=f*S+A*M+g*E-h*_,this.z=g*S+A*_+h*M-f*E,this.w=A*S-h*E-f*M-g*_,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var u=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return u===0?(this.x=0,this.y=0,this.z=0,this.w=1):(u=1/u,this.x=this.x*u,this.y=this.y*u,this.z=this.z*u,this.w=this.w*u),this},slerp:function(u,d){if(d===0)return this;if(d===1)return this.copy(u);var h=this.x,f=this.y,g=this.z,A=this.w,E=A*u.w+h*u.x+f*u.y+g*u.z;if(E<0?(this.w=-u.w,this.x=-u.x,this.y=-u.y,this.z=-u.z,E=-E):this.copy(u),E>=1)return this.w=A,this.x=h,this.y=f,this.z=g,this;var M=Math.acos(E),_=Math.sqrt(1-E*E);if(Math.abs(_)<.001)return this.w=.5*(A+this.w),this.x=.5*(h+this.x),this.y=.5*(f+this.y),this.z=.5*(g+this.z),this;var S=Math.sin((1-d)*M)/_,y=Math.sin(d*M)/_;return this.w=A*S+this.w*y,this.x=h*S+this.x*y,this.y=f*S+this.y*y,this.z=g*S+this.z*y,this},setFromUnitVectors:function(){var c,u,d=1e-6;return function(h,f){return c===void 0&&(c=new Ae),u=h.dot(f)+1,u<d?(u=0,Math.abs(h.x)>Math.abs(h.z)?c.set(-h.y,h.x,0):c.set(0,-h.z,h.y)):c.crossVectors(h,f),this.x=c.x,this.y=c.y,this.z=c.z,this.w=u,this.normalize(),this}}()};function Nl(c){this.width=c.width||O(),this.height=c.height||I(),this.widthMeters=c.widthMeters,this.heightMeters=c.heightMeters,this.bevelMeters=c.bevelMeters}var $g=new Nl({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),e1=new Nl({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),Ul={CardboardV1:new zl({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new zl({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function We(c,u){this.viewer=Ul.CardboardV2,this.updateDeviceParams(c),this.distortion=new Vs(this.viewer.distortionCoefficients);for(var d=0;d<u.length;d++){var h=u[d];Ul[h.id]=new zl(h)}}We.prototype.updateDeviceParams=function(c){this.device=this.determineDevice_(c)||this.device},We.prototype.getDevice=function(){return this.device},We.prototype.setViewer=function(c){this.viewer=c,this.distortion=new Vs(this.viewer.distortionCoefficients)},We.prototype.determineDevice_=function(c){if(!c)return l()?(console.warn("Using fallback iOS device measurements."),e1):(console.warn("Using fallback Android device measurements."),$g);var u=.0254,d=u/c.xdpi,h=u/c.ydpi,f=O(),g=I();return new Nl({widthMeters:d*f,heightMeters:h*g,bevelMeters:c.bevelMm*.001})},We.prototype.getDistortedFieldOfViewLeftEye=function(){var c=this.viewer,u=this.device,d=this.distortion,h=c.screenLensDistance,f=(u.widthMeters-c.interLensDistance)/2,g=c.interLensDistance/2,A=c.baselineLensDistance-u.bevelMeters,E=u.heightMeters-A,M=Xt*Math.atan(d.distort(f/h)),_=Xt*Math.atan(d.distort(g/h)),S=Xt*Math.atan(d.distort(A/h)),y=Xt*Math.atan(d.distort(E/h));return{leftDegrees:Math.min(M,c.fov),rightDegrees:Math.min(_,c.fov),downDegrees:Math.min(S,c.fov),upDegrees:Math.min(y,c.fov)}},We.prototype.getLeftEyeVisibleTanAngles=function(){var c=this.viewer,u=this.device,d=this.distortion,h=Math.tan(-Gt*c.fov),f=Math.tan(Gt*c.fov),g=Math.tan(Gt*c.fov),A=Math.tan(-Gt*c.fov),E=u.widthMeters/4,M=u.heightMeters/2,_=c.baselineLensDistance-u.bevelMeters-M,S=c.interLensDistance/2-E,y=-_,R=c.screenLensDistance,H=d.distort((S-E)/R),G=d.distort((y+M)/R),K=d.distort((S+E)/R),j=d.distort((y-M)/R),X=new Float32Array(4);return X[0]=Math.max(h,H),X[1]=Math.min(f,G),X[2]=Math.min(g,K),X[3]=Math.max(A,j),X},We.prototype.getLeftEyeNoLensTanAngles=function(){var c=this.viewer,u=this.device,d=this.distortion,h=new Float32Array(4),f=d.distortInverse(Math.tan(-Gt*c.fov)),g=d.distortInverse(Math.tan(Gt*c.fov)),A=d.distortInverse(Math.tan(Gt*c.fov)),E=d.distortInverse(Math.tan(-Gt*c.fov)),M=u.widthMeters/4,_=u.heightMeters/2,S=c.baselineLensDistance-u.bevelMeters-_,y=c.interLensDistance/2-M,R=-S,H=c.screenLensDistance,G=(y-M)/H,K=(R+_)/H,j=(y+M)/H,X=(R-_)/H;return h[0]=Math.max(f,G),h[1]=Math.min(g,K),h[2]=Math.min(A,j),h[3]=Math.max(E,X),h},We.prototype.getLeftEyeVisibleScreenRect=function(c){var u=this.viewer,d=this.device,h=u.screenLensDistance,f=(d.widthMeters-u.interLensDistance)/2,g=u.baselineLensDistance-d.bevelMeters,A=(c[0]*h+f)/d.widthMeters,E=(c[1]*h+g)/d.heightMeters,M=(c[2]*h+f)/d.widthMeters,_=(c[3]*h+g)/d.heightMeters;return{x:A,y:_,width:M-A,height:E-_}},We.prototype.getFieldOfViewLeftEye=function(c){return c?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},We.prototype.getFieldOfViewRightEye=function(c){var u=this.getFieldOfViewLeftEye(c);return{leftDegrees:u.rightDegrees,rightDegrees:u.leftDegrees,upDegrees:u.upDegrees,downDegrees:u.downDegrees}},We.prototype.getUndistortedFieldOfViewLeftEye=function(){var c=this.getUndistortedParams_();return{leftDegrees:Xt*Math.atan(c.outerDist),rightDegrees:Xt*Math.atan(c.innerDist),downDegrees:Xt*Math.atan(c.bottomDist),upDegrees:Xt*Math.atan(c.topDist)}},We.prototype.getUndistortedViewportLeftEye=function(){var c=this.getUndistortedParams_(),u=this.viewer,d=this.device,h=u.screenLensDistance,f=d.widthMeters/h,g=d.heightMeters/h,A=d.width/f,E=d.height/g,M=Math.round((c.eyePosX-c.outerDist)*A),_=Math.round((c.eyePosY-c.bottomDist)*E);return{x:M,y:_,width:Math.round((c.eyePosX+c.innerDist)*A)-M,height:Math.round((c.eyePosY+c.topDist)*E)-_}},We.prototype.getUndistortedParams_=function(){var c=this.viewer,u=this.device,d=this.distortion,h=c.screenLensDistance,f=c.interLensDistance/2/h,g=u.widthMeters/h,A=u.heightMeters/h,E=g/2-f,M=(c.baselineLensDistance-u.bevelMeters)/h,_=c.fov,S=d.distortInverse(Math.tan(Gt*_)),y=Math.min(E,S),R=Math.min(f,S),H=Math.min(M,S),G=Math.min(A-M,S);return{outerDist:y,innerDist:R,topDist:G,bottomDist:H,eyePosX:E,eyePosY:M}};function zl(c){this.id=c.id,this.label=c.label,this.fov=c.fov,this.interLensDistance=c.interLensDistance,this.baselineLensDistance=c.baselineLensDistance,this.screenLensDistance=c.screenLensDistance,this.distortionCoefficients=c.distortionCoefficients,this.inverseCoefficients=c.inverseCoefficients}We.Viewers=Ul;var t1=1,n1="2019-11-09T17:36:14Z",o1=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],r1={format:t1,last_updated:n1,devices:o1};function $r(c,u){if(this.dpdb=r1,this.recalculateDeviceParams_(),c){this.onDeviceParamsUpdated=u;var d=new XMLHttpRequest,h=this;d.open("GET",c,!0),d.addEventListener("load",function(){h.loading=!1,d.status>=200&&d.status<=299?(h.dpdb=JSON.parse(d.response),h.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),d.send()}}$r.prototype.getDeviceParams=function(){return this.deviceParams},$r.prototype.recalculateDeviceParams_=function(){var c=this.calcDeviceParams_();c?(this.deviceParams=c,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},$r.prototype.calcDeviceParams_=function(){var c=this.dpdb;if(!c)return console.error("DPDB not available."),null;if(c.format!=1)return console.error("DPDB has unexpected format version."),null;if(!c.devices||!c.devices.length)return console.error("DPDB does not have a devices section."),null;var u=navigator.userAgent||navigator.vendor||window.opera,d=O(),h=I();if(!c.devices)return console.error("DPDB has no devices section."),null;for(var f=0;f<c.devices.length;f++){var g=c.devices[f];if(!g.rules){console.warn("Device["+f+"] has no rules section.");continue}if(g.type!="ios"&&g.type!="android"){console.warn("Device["+f+"] has invalid type.");continue}if(l()==(g.type=="ios")){for(var A=!1,E=0;E<g.rules.length;E++){var M=g.rules[E];if(this.ruleMatches_(M,u,d,h)){A=!0;break}}if(A){var _=g.dpi[0]||g.dpi,S=g.dpi[1]||g.dpi;return new i1({xdpi:_,ydpi:S,bevelMm:g.bw})}}}return console.warn("No DPDB device match."),null},$r.prototype.ruleMatches_=function(c,u,d,h){if(!c.ua&&!c.res||(c.ua&&c.ua.substring(0,2)==="SM"&&(c.ua=c.ua.substring(0,7)),c.ua&&u.indexOf(c.ua)<0))return!1;if(c.res){if(!c.res[0]||!c.res[1])return!1;var f=c.res[0],g=c.res[1];if(Math.min(d,h)!=Math.min(f,g)||Math.max(d,h)!=Math.max(f,g))return!1}return!0};function i1(c){this.xdpi=c.xdpi,this.ydpi=c.ydpi,this.bevelMm=c.bevelMm}function ei(c,u){this.set(c,u)}ei.prototype.set=function(c,u){this.sample=c,this.timestampS=u},ei.prototype.copy=function(c){this.set(c.sample,c.timestampS)};function xo(c,u){this.kFilter=c,this.isDebug=u,this.currentAccelMeasurement=new ei,this.currentGyroMeasurement=new ei,this.previousGyroMeasurement=new ei,l()?this.filterQ=new ae(-1,0,0,1):this.filterQ=new ae(1,0,0,1),this.previousFilterQ=new ae,this.previousFilterQ.copy(this.filterQ),this.accelQ=new ae,this.isOrientationInitialized=!1,this.estimatedGravity=new Ae,this.measuredGravity=new Ae,this.gyroIntegralQ=new ae}xo.prototype.addAccelMeasurement=function(c,u){this.currentAccelMeasurement.set(c,u)},xo.prototype.addGyroMeasurement=function(c,u){this.currentGyroMeasurement.set(c,u);var d=u-this.previousGyroMeasurement.timestampS;P(d)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},xo.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var c=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,u=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,c);this.gyroIntegralQ.multiply(u),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(u);var d=new ae;d.copy(this.filterQ),d.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(d),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var h=new ae;h.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),h.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",Xt*hn(h),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var f=new ae;f.copy(this.filterQ),f.multiply(h),this.filterQ.slerp(f,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},xo.prototype.getOrientation=function(){return this.filterQ},xo.prototype.accelToQuaternion_=function(c){var u=new Ae;u.copy(c),u.normalize();var d=new ae;return d.setFromUnitVectors(new Ae(0,0,-1),u),d.inverse(),d},xo.prototype.gyroToQuaternionDelta_=function(c,u){var d=new ae,h=new Ae;return h.copy(c),h.normalize(),d.setFromAxisAngle(h,c.length()*u),d};function bd(c,u){this.predictionTimeS=c,this.isDebug=u,this.previousQ=new ae,this.previousTimestampS=null,this.deltaQ=new ae,this.outQ=new ae}bd.prototype.getPrediction=function(c,u,d){if(!this.previousTimestampS)return this.previousQ.copy(c),this.previousTimestampS=d,c;var h=new Ae;h.copy(u),h.normalize();var f=u.length();if(f<Gt*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(Xt*f).toFixed(1)),this.outQ.copy(c),this.previousQ.copy(c),this.outQ;var g=f*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(h,g),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(c),this.previousTimestampS=d,this.outQ};function Mt(c,u,d,h){this.yawOnly=d,this.accelerometer=new Ae,this.gyroscope=new Ae,this.filter=new xo(c,h),this.posePredictor=new bd(u,h),this.isFirefoxAndroid=x(),this.isIOS=l();var f=F();this.isDeviceMotionInRadians=!this.isIOS&&f&&f<66,this.isWithoutDeviceMotion=k()||v(),this.filterToWorldQ=new ae,l()?this.filterToWorldQ.setFromAxisAngle(new Ae(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new Ae(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new ae,this.worldToScreenQ=new ae,this.originalPoseAdjustQ=new ae,this.originalPoseAdjustQ.setFromAxisAngle(new Ae(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),b()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new ae,this.orientationOut_=new Float32Array(4),this.start()}Mt.prototype.getPosition=function(){return null},Mt.prototype.getOrientation=function(){var c=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var f=new ae().setFromAxisAngle(new Ae(0,0,-1),0),g=new ae;return window.orientation===-90?g.setFromAxisAngle(new Ae(0,1,0),Math.PI/-2):g.setFromAxisAngle(new Ae(0,1,0),Math.PI/2),f.multiply(g)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var f=new ae;return f.setFromAxisAngle(new Ae(1,0,0),-Math.PI/2),f}(),c=this._deviceOrientationQ;var d=new ae;return d.copy(c),d.multiply(this.deviceOrientationFilterToWorldQ),d.multiply(this.resetQ),d.multiply(this.worldToScreenQ),d.multiplyQuaternions(this.deviceOrientationFixQ,d),this.yawOnly&&(d.x=0,d.z=0,d.normalize()),this.orientationOut_[0]=d.x,this.orientationOut_[1]=d.y,this.orientationOut_[2]=d.z,this.orientationOut_[3]=d.w,this.orientationOut_}else{var u=this.filter.getOrientation();c=this.posePredictor.getPrediction(u,this.gyroscope,this.previousTimestampS)}var d=new ae;return d.copy(this.filterToWorldQ),d.multiply(this.resetQ),d.multiply(c),d.multiply(this.worldToScreenQ),this.yawOnly&&(d.x=0,d.z=0,d.normalize()),this.orientationOut_[0]=d.x,this.orientationOut_[1]=d.y,this.orientationOut_[2]=d.z,this.orientationOut_[3]=d.w,this.orientationOut_},Mt.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),b()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},Mt.prototype.onDeviceOrientation_=function(c){this._deviceOrientationQ=this._deviceOrientationQ||new ae;var u=c.alpha,d=c.beta,h=c.gamma;u=(u||0)*Math.PI/180,d=(d||0)*Math.PI/180,h=(h||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(d,u,-h)},Mt.prototype.onDeviceMotion_=function(c){this.updateDeviceMotion_(c)},Mt.prototype.updateDeviceMotion_=function(c){var u=c.accelerationIncludingGravity,d=c.rotationRate,h=c.timeStamp/1e3,f=h-this.previousTimestampS;if(f<0){ho("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=h;return}else if(f<=r||f>i){ho("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=h;return}this.accelerometer.set(-u.x,-u.y,-u.z),d&&(D()?this.gyroscope.set(-d.beta,d.alpha,d.gamma):this.gyroscope.set(d.alpha,d.beta,d.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,h)),this.filter.addAccelMeasurement(this.accelerometer,h),this.previousTimestampS=h},Mt.prototype.onOrientationChange_=function(c){this.setScreenTransform_()},Mt.prototype.onMessage_=function(c){var u=c.data;if(!(!u||!u.type)){var d=u.type.toLowerCase();d==="devicemotion"&&this.updateDeviceMotion_(u.deviceMotionEvent)}},Mt.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new Ae(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new Ae(0,0,1),Math.PI/2);break;case 180:break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},Mt.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),l()&&se()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},Mt.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var s1=60,a1=new Ae(1,0,0),c1=new Ae(0,0,1),Gl=new ae;Gl.setFromAxisAngle(a1,-Math.PI/2),Gl.multiply(new ae().setFromAxisAngle(c1,Math.PI/2));var l1=function(){function c(u){e(this,c),this.config=u,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new ae,this._outQ=new ae,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return t(c,[{key:"init",value:function(){var d=null;try{d=new RelativeOrientationSensor({frequency:s1,referenceFrame:"screen"}),d.addEventListener("error",this._onSensorError)}catch(h){this.errors.push(h),h.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):h.name==="ReferenceError"?this.useDeviceMotion():console.error(h)}d&&(this.api="sensor",this.sensor=d,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new Mt(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var d=this.sensor.quaternion;this._sensorQ.set(d[0],d[1],d[2],d[3]);var h=this._outQ;return h.copy(Gl),h.multiply(this._sensorQ),this.config.YAW_ONLY&&(h.x=h.z=0,h.normalize()),this._out[0]=h.x,this._out[1]=h.y,this._out[2]=h.z,this._out[3]=h.w,this._out}},{key:"_onSensorError",value:function(d){this.errors.push(d.error),d.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):d.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(d.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),c}(),u1="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function go(){this.loadIcon_();var c=document.createElement("div"),A=c.style;A.position="fixed",A.top=0,A.right=0,A.bottom=0,A.left=0,A.backgroundColor="gray",A.fontFamily="sans-serif",A.zIndex=1e6;var u=document.createElement("img");u.src=this.icon;var A=u.style;A.marginLeft="25%",A.marginTop="25%",A.width="50%",c.appendChild(u);var d=document.createElement("div"),A=d.style;A.textAlign="center",A.fontSize="16px",A.lineHeight="24px",A.margin="24px 25%",A.width="50%",d.innerHTML="Place your phone into your Cardboard viewer.",c.appendChild(d);var h=document.createElement("div"),A=h.style;A.backgroundColor="#CFD8DC",A.position="fixed",A.bottom=0,A.width="100%",A.height="48px",A.padding="14px 24px",A.boxSizing="border-box",A.color="#656A6B",c.appendChild(h);var f=document.createElement("div");f.style.float="left",f.innerHTML="No Cardboard viewer?";var g=document.createElement("a");g.href="https://www.google.com/get/cardboard/get-cardboard/",g.innerHTML="get one",g.target="_blank";var A=g.style;A.float="right",A.fontWeight=600,A.textTransform="uppercase",A.borderLeft="1px solid gray",A.paddingLeft="24px",A.textDecoration="none",A.color="#656A6B",h.appendChild(f),h.appendChild(g),this.overlay=c,this.text=d,this.hide()}go.prototype.show=function(c){!c&&!this.overlay.parentElement?document.body.appendChild(this.overlay):c&&(this.overlay.parentElement&&this.overlay.parentElement!=c&&this.overlay.parentElement.removeChild(this.overlay),c.appendChild(this.overlay)),this.overlay.style.display="block";var u=this.overlay.querySelector("img"),d=u.style;b()?(d.width="20%",d.marginLeft="40%",d.marginTop="3%"):(d.width="50%",d.marginLeft="25%",d.marginTop="25%")},go.prototype.hide=function(){this.overlay.style.display="none"},go.prototype.showTemporarily=function(c,u){this.show(u),this.timer=setTimeout(this.hide.bind(this),c)},go.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},go.prototype.update=function(){this.disableShowTemporarily(),!b()&&ie()?this.show():this.hide()},go.prototype.loadIcon_=function(){this.icon=s("image/svg+xml",u1)};var p1="CardboardV1",yd="WEBVR_CARDBOARD_VIEWER",d1="webvr-polyfill-viewer-selector";function kt(c){try{this.selectedKey=localStorage.getItem(yd)}catch(u){console.error("Failed to load viewer profile: %s",u)}this.selectedKey||(this.selectedKey=c||p1),this.dialog=this.createDialog_(We.Viewers),this.root=null,this.onChangeCallbacks_=[]}kt.prototype.show=function(c){this.root=c,c.appendChild(this.dialog);var u=this.dialog.querySelector("#"+this.selectedKey);u.checked=!0,this.dialog.style.display="block"},kt.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},kt.prototype.getCurrentViewer=function(){return We.Viewers[this.selectedKey]},kt.prototype.getSelectedKey_=function(){var c=this.dialog.querySelector("input[name=field]:checked");return c?c.id:null},kt.prototype.onChange=function(c){this.onChangeCallbacks_.push(c)},kt.prototype.fireOnChange_=function(c){for(var u=0;u<this.onChangeCallbacks_.length;u++)this.onChangeCallbacks_[u](c)},kt.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!We.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(We.Viewers[this.selectedKey]);try{localStorage.setItem(yd,this.selectedKey)}catch(c){console.error("Failed to save viewer profile: %s",c)}this.hide()},kt.prototype.createDialog_=function(c){var u=document.createElement("div");u.classList.add(d1),u.style.display="none";var d=document.createElement("div"),g=d.style;g.position="fixed",g.left=0,g.top=0,g.width="100%",g.height="100%",g.background="rgba(0, 0, 0, 0.3)",d.addEventListener("click",this.hide.bind(this));var h=280,f=document.createElement("div"),g=f.style;g.boxSizing="border-box",g.position="fixed",g.top="24px",g.left="50%",g.marginLeft=-h/2+"px",g.width=h+"px",g.padding="24px",g.overflow="hidden",g.background="#fafafa",g.fontFamily="'Roboto', sans-serif",g.boxShadow="0px 5px 20px #666",f.appendChild(this.createH1_("Select your viewer"));for(var A in c)f.appendChild(this.createChoice_(A,c[A].label));return f.appendChild(this.createButton_("Save",this.onSave_.bind(this))),u.appendChild(d),u.appendChild(f),u},kt.prototype.createH1_=function(c){var u=document.createElement("h1"),d=u.style;return d.color="black",d.fontSize="20px",d.fontWeight="bold",d.marginTop=0,d.marginBottom="24px",u.innerHTML=c,u},kt.prototype.createChoice_=function(c,u){var d=document.createElement("div");d.style.marginTop="8px",d.style.color="black";var h=document.createElement("input");h.style.fontSize="30px",h.setAttribute("id",c),h.setAttribute("type","radio"),h.setAttribute("value",c),h.setAttribute("name","field");var f=document.createElement("label");return f.style.marginLeft="4px",f.setAttribute("for",c),f.innerHTML=u,d.appendChild(h),d.appendChild(f),d},kt.prototype.createButton_=function(c,u){var d=document.createElement("button");d.innerHTML=c;var h=d.style;return h.float="right",h.textTransform="uppercase",h.color="#1094f7",h.fontSize="14px",h.letterSpacing=0,h.border=0,h.background="none",h.marginTop="16px",d.addEventListener("click",u),d};var h1=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function m1(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}function f1(c,u){return u={exports:{}},c(u,u.exports),u.exports}var x1=f1(function(c,u){(function(h,f){c.exports=f()})(h1,function(){return function(d){var h={};function f(g){if(h[g])return h[g].exports;var A=h[g]={i:g,l:!1,exports:{}};return d[g].call(A.exports,A,A.exports,f),A.l=!0,A.exports}return f.m=d,f.c=h,f.d=function(g,A,E){f.o(g,A)||Object.defineProperty(g,A,{configurable:!1,enumerable:!0,get:E})},f.n=function(g){var A=g&&g.__esModule?function(){return g.default}:function(){return g};return f.d(A,"a",A),A},f.o=function(g,A){return Object.prototype.hasOwnProperty.call(g,A)},f.p="",f(f.s=0)}([function(d,h,f){"use strict";var g=function(){function S(y,R){for(var H=0;H<R.length;H++){var G=R[H];G.enumerable=G.enumerable||!1,G.configurable=!0,"value"in G&&(G.writable=!0),Object.defineProperty(y,G.key,G)}}return function(y,R,H){return R&&S(y.prototype,R),H&&S(y,H),y}}();function A(S,y){if(!(S instanceof y))throw new TypeError("Cannot call a class as a function")}var E=f(1),M=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,_=function(){function S(){A(this,S),M?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",E),this.noSleepVideo.addEventListener("timeupdate",function(y){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return g(S,[{key:"enable",value:function(){M?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){M?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),S}();d.exports=_},function(d,h,f){"use strict";d.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),g1=m1(x1),w1=1e3,F1=[0,0,.5,1],A1=[.5,0,.5,1],_1=window.requestAnimationFrame,v1=window.cancelAnimationFrame;function S1(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function Dd(c){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:c.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:c.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:c.canPresent},maxLayers:{writable:!1,enumerable:!0,value:c.maxLayers},hasOrientation:{enumerable:!0,get:function(){return Pt("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),c.hasOrientation}}})}function ge(c){c=c||{};var u="wakelock"in c?c.wakelock:!0;this.isPolyfilled=!0,this.displayId=w1++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return Pt("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new Dd({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,u&&ie()&&(this.wakelock_=new g1)}ge.prototype.getFrameData=function(c){return Fe(c,this._getPose(),this)},ge.prototype.getPose=function(){return Pt("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},ge.prototype.resetPose=function(){return Pt("VRDisplay.prototype.resetPose"),this._resetPose()},ge.prototype.getImmediatePose=function(){return Pt("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},ge.prototype.requestAnimationFrame=function(c){return _1(c)},ge.prototype.cancelAnimationFrame=function(c){return v1(c)},ge.prototype.wrapForFullscreen=function(c){if(l())return c;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var u=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",u.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==c)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=c,this.originalParent_=c.parentElement,this.originalParent_||document.body.appendChild(c),!this.fullscreenWrapper_.parentElement){var d=this.fullscreenElement_.parentElement;d.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),d.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var h=this;function f(){if(h.fullscreenElement_){var g=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];h.fullscreenElement_.setAttribute("style",g.join("; ")+";")}}return f(),this.fullscreenWrapper_},ge.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var c=this.fullscreenElement_;this.fullscreenElementCachedStyle_?c.setAttribute("style",this.fullscreenElementCachedStyle_):c.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var u=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(c),this.originalParent_===u?u.insertBefore(c,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(c),u.removeChild(this.fullscreenWrapper_),c}},ge.prototype.requestPresent=function(c){var u=this.isPresenting,d=this;return c instanceof Array||(Pt("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),c=[c]),new Promise(function(h,f){if(!d.capabilities.canPresent){f(new Error("VRDisplay is not capable of presenting."));return}if(c.length==0||c.length>d.capabilities.maxLayers){f(new Error("Invalid number of layers."));return}var g=c[0];if(!g.source){h();return}var A=g.leftBounds||F1,E=g.rightBounds||A1;if(u){var M=d.layer_;M.source!==g.source&&(M.source=g.source);for(var _=0;_<4;_++)M.leftBounds[_]=A[_],M.rightBounds[_]=E[_];d.wrapForFullscreen(d.layer_.source),d.updatePresent_(),h();return}if(d.layer_={predistorted:g.predistorted,source:g.source,leftBounds:A.slice(0),rightBounds:E.slice(0)},d.waitingForPresent_=!1,d.layer_&&d.layer_.source){var S=d.wrapForFullscreen(d.layer_.source),y=function(){var G=C();d.isPresenting=S===G,d.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(K){console.error("screen.orientation.lock() failed due to",K.message)}),d.waitingForPresent_=!1,d.beginPresent_(),h()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),d.removeFullscreenWrapper(),d.disableWakeLock(),d.endPresent_(),d.removeFullscreenListeners_()),d.fireVRDisplayPresentChange_()},R=function(){d.waitingForPresent_&&(d.removeFullscreenWrapper(),d.removeFullscreenListeners_(),d.disableWakeLock(),d.waitingForPresent_=!1,d.isPresenting=!1,f(new Error("Unable to present.")))};d.addFullscreenListeners_(S,y,R),L(S)?(d.enableWakeLock(),d.waitingForPresent_=!0):(l()||p())&&(d.enableWakeLock(),d.isPresenting=!0,d.beginPresent_(),d.fireVRDisplayPresentChange_(),h())}!d.waitingForPresent_&&!l()&&(U(),f(new Error("Unable to present.")))})},ge.prototype.exitPresent=function(){var c=this.isPresenting,u=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(d,h){c?(!U()&&l()&&(u.endPresent_(),u.fireVRDisplayPresentChange_()),p()&&(u.removeFullscreenWrapper(),u.removeFullscreenListeners_(),u.endPresent_(),u.fireVRDisplayPresentChange_()),d()):h(new Error("Was not presenting to VRDisplay."))})},ge.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},ge.prototype.fireVRDisplayPresentChange_=function(){var c=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(c)},ge.prototype.fireVRDisplayConnect_=function(){var c=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(c)},ge.prototype.addFullscreenListeners_=function(c,u,d){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=c,this.fullscreenChangeHandler_=u,this.fullscreenErrorHandler_=d,u&&(document.fullscreenEnabled?c.addEventListener("fullscreenchange",u,!1):document.webkitFullscreenEnabled?c.addEventListener("webkitfullscreenchange",u,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",u,!1):document.msFullscreenEnabled&&c.addEventListener("msfullscreenchange",u,!1)),d&&(document.fullscreenEnabled?c.addEventListener("fullscreenerror",d,!1):document.webkitFullscreenEnabled?c.addEventListener("webkitfullscreenerror",d,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",d,!1):document.msFullscreenEnabled&&c.addEventListener("msfullscreenerror",d,!1))},ge.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var c=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var u=this.fullscreenChangeHandler_;c.removeEventListener("fullscreenchange",u,!1),c.removeEventListener("webkitfullscreenchange",u,!1),document.removeEventListener("mozfullscreenchange",u,!1),c.removeEventListener("msfullscreenchange",u,!1)}if(this.fullscreenErrorHandler_){var d=this.fullscreenErrorHandler_;c.removeEventListener("fullscreenerror",d,!1),c.removeEventListener("webkitfullscreenerror",d,!1),document.removeEventListener("mozfullscreenerror",d,!1),c.removeEventListener("msfullscreenerror",d,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},ge.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},ge.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},ge.prototype.beginPresent_=function(){},ge.prototype.endPresent_=function(){},ge.prototype.submitFrame=function(c){},ge.prototype.getEyeParameters=function(c){return null};var T1={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},Is={LEFT:"left",RIGHT:"right"};function He(c){var u=ne({},T1);c=ne(u,c||{}),ge.call(this,{wakelock:c.MOBILE_WAKE_LOCK}),this.config=c,this.displayName="Cardboard VRDisplay",this.capabilities=new Dd({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new l1(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new $r(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new We(this.dpdb_.getDeviceParams(),c.ADDITIONAL_VIEWERS),this.viewerSelector_=new kt(c.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new go),l()&&window.addEventListener("resize",this.onResize_.bind(this))}return He.prototype=Object.create(ge.prototype),He.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},He.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},He.prototype._getFieldOfView=function(c){var u;if(c==Is.LEFT)u=this.deviceInfo_.getFieldOfViewLeftEye();else if(c==Is.RIGHT)u=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",c),null;return u},He.prototype._getEyeOffset=function(c){var u;if(c==Is.LEFT)u=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(c==Is.RIGHT)u=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",c),null;return u},He.prototype.getEyeParameters=function(c){var u=this._getEyeOffset(c),d=this._getFieldOfView(c),h={offset:u,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(h,"fieldOfView",{enumerable:!0,get:function(){return Pt("VRFieldOfView","VRFrameData's projection matrices"),d}}),h},He.prototype.onDeviceParamsUpdated_=function(c){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(c),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},He.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},He.prototype.beginPresent_=function(){var c=this.layer_.source.getContext("webgl");c||(c=this.layer_.source.getContext("experimental-webgl")),c||(c=this.layer_.source.getContext("webgl2")),c&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(c.canvas.width=O()*this.bufferScale_,c.canvas.height=I()*this.bufferScale_,this.cardboardUI_=new fo(c)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new fo(c)),this.distorter_=new Vt(c,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(u){this.viewerSelector_.show(this.layer_.source.parentElement),u.stopPropagation(),u.preventDefault()}.bind(this),function(u){this.exitPresent(),u.stopPropagation(),u.preventDefault()}.bind(this)),this.rotateInstructions_&&(b()&&ie()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},He.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},He.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},He.prototype.submitFrame=function(c){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var u=this.layer_.source.getContext("webgl");u||(u=this.layer_.source.getContext("experimental-webgl")),u||(u=this.layer_.source.getContext("webgl2"));var d=u.canvas;(d.width!=this.lastWidth||d.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=d.width,this.lastHeight=d.height,this.cardboardUI_.render()}},He.prototype.onOrientationChange_=function(c){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},He.prototype.onResize_=function(c){if(this.layer_){var u=this.layer_.source.getContext("webgl");u||(u=this.layer_.source.getContext("experimental-webgl")),u||(u=this.layer_.source.getContext("webgl2"));var d=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];u.canvas.setAttribute("style",d.join("; ")+";"),Te(u.canvas)}},He.prototype.onViewerChanged_=function(c){this.deviceInfo_.setViewer(c),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},He.prototype.fireVRDisplayDeviceParamsChange_=function(){var c=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(c)},He.VRFrameData=S1,He.VRDisplay=ge,He})});function di(n,e,t){return typeof n===e||n instanceof t}function ee(n){return di(n,"function",Function)}function oe(n){return di(n,"string",String)}function jt(n){return di(n,"boolean",Boolean)}function me(n){return di(n,"number",Number)}function Os(n){return B(n)||!Number.isFinite(n)||Number.isNaN(n)}function ut(n){return me(n)&&!Os(n)}function yn(n){return w(n)&&di(n,"object",Object)}function Ws(n){return n instanceof Date}function qt(n){return n instanceof Array}function mn(n,e){throw new Error((e||"Unexpected object: ")+n)}function B(n){return n==null}function w(n){return!B(n)}function Cd(n){return yn(n)&&"compareTo"in n&&ee(n.compareTo)}function Qt(n,...e){let t=null;oe(n)?t=n:(t="ascending",e.unshift(n));let o=t==="ascending"?1:-1;return Object.assign((i,s)=>{if(i===s)return 0;for(let a of e){let l=B(i)?null:a(i),p=B(s)?null:a(s),m=l===p?0:oe(l)&&oe(p)?o*l.localeCompare(p):Cd(l)&&Cd(p)?o*l.compareTo(p):t==="ascending"&&l>p||t==="descending"&&l<p?1:-1;if(m!==0)return m}return 0},{direction:t})}function Bd(n,e,t,o="search"){let r=0,i=n.length-1;for(;r<=i;){let s=r+i>>1,a=t(n[s],e);if(a===0){if(o!=="search"){let l=o==="append"?1:-1;for(l>0&&(s+=l);0<=s&&s<n.length&&(a=t(n[s],e))===0;)s+=l;l<0&&(s-=l)}return s}else a<0?r=s-a:i=s-a}return-r-1}function $o(n,e,t,o="search"){let r=o!=="set";o==="set"&&(o="search");let i=null;if(me(t)?i=t:i=Bd(n,e,t,o),i<0)i=-i-1;else if(!r)return-1;return ql(n,e,i),i}function Ld(n,e,t){let o=Bd(n,e,t);return o>=0?(hi(n,o),o):-1}function pe(n){return n.splice(0)}function Rd(n,e){for(let t=0;t<n.length;++t)if(n[t]!==e[t])return t;return-1}function ql(n,e,t){n.splice(t,0,e)}function je(n,e){let t=n.indexOf(e);return t>-1?(hi(n,t),!0):!1}function L1(n,e){for(let t=n.length-1;t>=0;--t)if(e(n[t]))return hi(n,t);return null}function Pd(n,e,t){return L1(n,o=>t(o)===e)}function hi(n,e){return n.splice(e,1)[0]}function Vd(n,...e){n.splice(0,n.length,...e)}function R1(n,e,t){let o=n?0:e.length-1,r=n?e.length:-1,i=n?1:-1;for(let s of t)for(let a=o;a!=r;a+=i){let l=e[a];if(s(l))return l}return null}function Ft(n,...e){return R1(!0,n,e)}function Yt(n){return n}function Id(n,e){return n&&e}var P1="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function At(n,e){if(n<0)throw new Error("Length must be greater than 0");B(e)&&(e=P1);let t="";for(let o=0;o<n;++o){let r=Math.floor(Math.random()*e.length);t+=e[r]}return t}var Od=new Map,Hs=class{constructor(e,t,o,...r){this.key=e,this.value=t,this.bySetAttribute=o,this.tags=r.map(i=>i.toLocaleUpperCase()),Object.freeze(this)}applyToElement(e){if(this.tags.length>0&&this.tags.indexOf(e.tagName)===-1){let t=Od.get(e.tagName);t||Od.set(e.tagName,t=new Set),t.has(this.key)||(t.add(this.key),console.warn(`Element ${e.tagName} does not support Attribute ${this.key}`))}this.bySetAttribute?e.setAttribute(this.key,this.value.toString()):this.key in e?e[this.key]=this.value:this.value===!1?e.removeAttribute(this.key):this.value===!0?e.setAttribute(this.key,""):ee(this.value)?this.value(e):e.setAttribute(this.key,this.value.toString())}};function Le(n,e,t,...o){return new Hs(n,e,t,...o)}function mi(n){return n instanceof Hs}function fn(n){return Le("autoplay",n,!1,"audio","video")}function Ns(n){return Le("checked",n,!1,"command","input")}function ue(...n){return n=n.filter(Yt),Le("CLASS_LIST",e=>e.classList.add(...n),!1)}function It(n){return Le("controls",n,!1,"audio","video")}function Us(n,e){return Le("data-"+n.toLowerCase(),e,!0)}function Wd(n){return Le("htmlFor",n,!1,"label","output")}function Hd(n){return Le("height",n,!1,"canvas","embed","iframe","img","input","object","video")}function zs(n){return Le("id",n,!1)}function Dn(n){return Le("loop",n,!1,"audio","bgsound","marquee","video")}function wo(n){return Le("max",n,!1,"input","meter","progress")}function Fo(n){return Le("min",n,!1,"input","meter")}function Gs(n){return Le("muted",n,!1,"audio","video")}function Nd(n){return Le("selected",n,!1,"option")}function V1(n){return n instanceof URL&&(n=n.href),n}function Ao(n){return Le("src",V1(n),!1,"audio","embed","iframe","img","input","script","source","track","video")}function fi(n){return Le("srcObject",n,!1,"audio","video")}function _o(n){return Le("step",n,!1,"input")}function Xs(n){return Le("title",n,!1)}function xi(n){return oe(n)||(n=n.value),Le("type",n,!1,"button","input","command","embed","link","object","script","source","style","menu")}function Kt(n){return Le("value",n,!1,"button","data","input","li","meter","option","progress","param")}function Ud(n){return Le("width",n,!1,"canvas","embed","iframe","img","input","object","video")}var er=class{constructor(){this.listeners=new Map,this.listenerOptions=new Map,this.bubblers=new Set,this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addScopedEventListener(e,t,o,r){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([t,o]),this.addEventListener(t,o,r)}removeScope(e){let t=this.scopes.get(e);if(t){this.scopes.delete(e);for(let[o,r]of t)this.removeEventListener(o,r)}}addEventListener(e,t,o){let r=this.listeners.get(e);r||(r=new Array,this.listeners.set(e,r)),r.find(i=>i===t)||(r.push(t),o&&this.listenerOptions.set(t,o))}removeEventListener(e,t){let o=this.listeners.get(e);o&&this.removeListener(o,t)}clearEventListeners(e){for(let[t,o]of this.listeners)if(B(e)||e===t){for(let r of o)this.removeEventListener(e,r);pe(o),this.listeners.delete(t)}}removeListener(e,t){let o=e.findIndex(r=>r===t);o>=0&&(hi(e,o),this.listenerOptions.has(t)&&this.listenerOptions.delete(t))}dispatchEvent(e){let t=this.listeners.get(e.type);if(t)for(let o of t){let r=this.listenerOptions.get(o);w(r)&&!jt(r)&&r.once&&this.removeListener(t,o),ee(o)?o.call(this,e):o.handleEvent(e)}if(e.defaultPrevented)return!1;for(let o of this.bubblers)if(!o.dispatchEvent(e))return!1;return!0}};var N=class extends Event{get type(){return super.type}constructor(e,t){super(e,t)}},re=class extends er{addBubbler(e){super.addBubbler(e)}removeBubbler(e){super.removeBubbler(e)}addScopedEventListener(e,t,o,r){super.addScopedEventListener(e,t,o,r)}addEventListener(e,t,o){super.addEventListener(e,t,o)}removeEventListener(e,t){super.removeEventListener(e,t)}clearEventListeners(e){return super.clearEventListeners(e)}};var vo=class extends re{constructor(){super(...arguments),this.attached=new Array,this.soFar=null,this.total=null,this.msg=null,this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(e,t,o,r){this.soFar=e,this.total=t,this.msg=o,this.est=r;for(let i of this.attached)i.report(e,t,o,r)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(e){this.report(0,1,e||"starting")}end(e){this.report(1,1,e||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,pe(this.attached)}};var ve=class{constructor(e=!0){this.autoStart=e,this.onThens=new Array,this.onCatches=new Array,this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",this.resolve=t=>{if(this.running){this._result=t,this._resultState="resolved";for(let o of this.onThens)o(t);this.clear(),this._executionState="finished"}},this.reject=t=>{if(this.running){this._error=t,this._resultState="errored";for(let o of this.onCatches)o(t);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){pe(this.onThens),pe(this.onCatches)}start(){this._executionState="running"}resolver(e){return()=>this.resolve(e)}resolveOn(e,t,o){let r=this.resolver(o);e.addEventListener(t,r),this.finally(()=>e.removeEventListener(t,r))}get result(){if(w(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((e,t)=>{this.finished?this.errored?t(this.error):e(this.result):(this.onThens.push(e),this.onCatches.push(t))})}then(e,t){return this.project().then(e,t)}catch(e){return this.project().catch(e)}finally(e){return this.project().finally(e)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(e){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",e&&this.start()}};function zd(n,e){return"on"+e in n}function Jt(n,e,t,...o){B(o)&&(o=[]);let r;if(oe(t)?o.unshift(t):me(t)&&(r=t),!(n instanceof er)){if(!zd(n,e))throw new Error(`Target does not have a ${e} rejection event`);for(let l of o)if(!zd(n,l))throw new Error(`Target does not have a ${l} rejection event`)}let i=new ve;if(me(r)){let l=setTimeout(i.reject,r,`'${e}' has timed out.`);i.finally(clearTimeout.bind(globalThis,l))}let s=(l,p)=>{n.addEventListener(l,p),i.finally(()=>n.removeEventListener(l,p))};s(e,l=>i.resolve(l));let a=l=>i.reject(l);for(let l of o)s(l,a);return i}var Gd=/([^\/]+)\/(.+)/,I1=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/;var gi=class n{constructor(e,t,o){this._type=e,this._fullSubType=t,this._primaryExtension=null,this.depMessage=null;let r=new Map;this._parameters=r;let i=this._fullSubType.match(I1);this._tree=i[1],this._subType=i[2],this._suffix=i[3];let s=i[4];if(this._value=this._fullValue=this._type+"/",w(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,w(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),w(s)){let a=s.split(";").map(l=>l.trim()).filter(l=>l.length>0).map(l=>l.split("="));for(let[l,...p]of a){let m=p.join("=");r.set(l,m);let x=`; ${l}=${m}`;this._fullValue+=x,l!=="q"&&(this._value+=x)}}this._extensions=o||[],this._primaryExtension=this._extensions[0]||null}static parse(e){if(!e)return null;let t=e.match(Gd);if(!t)return null;let o=t[1],r=t[2];return new n(o,r)}deprecate(e){return this.depMessage=e,this}check(){w(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(e){if(B(e))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let t=null,o=null;if(oe(e)){let r=e.match(Gd);if(!r)return!1;t=r[1],o=r[2]}else t=e.typeName,o=e._fullSubType;return this.typeName===t&&(this._fullSubType==="*"||this._fullSubType===o)}withParameter(e,t){let o=`${this._fullSubType}; ${e}=${t}`;return new n(this.typeName,o,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}toFileSystemAPIAccepts(){return{[this.value]:this.extensions.map(e=>"."+e)}}addExtension(e){if(!e)throw new Error("File name is not defined");return this.primaryExtension&&(e=n.removeExtension(e),e=`${e}.${this.primaryExtension}`),e}static removeExtension(e){let t=e.lastIndexOf(".");return t>-1&&(e=e.substring(0,t)),e}};function O1(n,e,...t){return new gi(n,e,t)}function Ze(n){return O1.bind(null,n)}var W1=Ze("audio");var xn=W1("mpeg","mp3","mp2","mp2a","mpga","m2a","m3a");var H1=Ze("image");var Xd=H1("png","png");var jd=Ze("model");var So=jd("gltf-binary","glb"),qd=jd("gltf+json","gltf");var N1=Ze("video");var Qd=N1("vnd.mpeg.dash.mpd","mpd");function Cn(n){return`${n}%`}function To(n){return`${n}em`}function js(n){return`${n}px`}function Yd(n){return`${n}pt`}function Kd(n){return`${n}fr`}function Ot(...n){return`rgb(${n.join(", ")})`}function tr(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}var Ql=class{constructor(e){this._value=e}get value(){return this._value}toString(){return this.value}},Yl=class{constructor(e,t,o){this.pre=e,this.props=t,this.post=o}get value(){return this.pre+this.props.map(e=>e.toString()).join(`
`)+this.post}toString(){return this.value}applyToSheet(e){e.insertRule(this.toString(),e.cssRules.length)}},Kl=class extends Ql{constructor(e,t,o){super(o),this._name=e,this.sep=t}get name(){return this._name}toString(){return this.name+this.sep+this.value+";"}},Jl=class extends Yl{constructor(e,t){super(e+` {
`,t,`
}
`)}},Zl=class extends Kl{constructor(e,t){super(e,": ",t)}},Me=class extends Zl{constructor(e,t){super(e.replace(/[A-Z]/g,o=>`-${o.toLocaleLowerCase()}`),t.toString()),this.key=e,this.priority=""}applyToElement(e){e.style[this.key]=this.value+this.priority}important(){return this.priority=" !important",this}get value(){return super.value+this.priority}};function eu(n){return n instanceof Me}var $l=class extends Jl{constructor(e,t){super(e,t)}};function Jd(n,...e){return new $l(n,e)}function Zd(n){return new Me("alignItems",n)}function $d(n){return new Me("backgroundColor",n)}function eh(n){return new Me("columnGap",n)}function $e(n){return new Me("display",n)}function th(n){return new Me("flexDirection",n)}function nh(n){return new Me("fontSize",n)}function oh(...n){return new Me("gap",n.join(" "))}function rh(...n){return new Me("gridTemplateColumns",n.join(" "))}function ih(n){return new Me("height",n)}function tu(...n){return new Me("margin",n.join(" "))}function sh(n){return new Me("maxWidth",n)}function ah(n){return new Me("minHeight",n)}function ch(...n){return new Me("padding",n.join(" "))}function lh(n){return new Me("paddingRight",n)}function uh(n){return new Me("pointerEvents",n)}function ph(n){return new Me("textAlign",n)}function dh(...n){return new Me("transform",n.join(" "))}function Mo(n){return new Me("width",n)}function qs(n){return yn(n)?n.element instanceof Element:!1}function gn(n){return qs(n)?n.element:oe(n)?z1(n):n}function hh(n){return yn(n)&&"applyToElement"in n&&ee(n.applyToElement)}function mh(n){return n instanceof Element||qs(n)||hh(n)||oe(n)||me(n)||jt(n)||Ws(n)}function qe(n,e,t=""){n=gn(n),e?(n.style.removeProperty("display"),getComputedStyle(n).display==="none"&&(n.style.display=t||"block")):n.style.display="none"}function Et(n){return n=gn(n),n.style.display!=="none"}function te(n,...e){let t=n instanceof Element||n instanceof ShadowRoot?n:oe(n)?document.querySelector(n):n.element,o=t instanceof HTMLTemplateElement?t.content:t;for(let r of e)w(r)&&(r instanceof Node?o.appendChild(r):qs(r)?o.appendChild(gn(r)):hh(r)?t instanceof ShadowRoot||r.applyToElement(t):o.appendChild(document.createTextNode(r.toLocaleString())));return t}function z1(n){return document.querySelector(n)}function fh(n){return Array.from(document.querySelectorAll(n))}function et(n,...e){let t=null,o=e.filter(mi).filter(r=>r.key==="id"||r.key==="query");for(let r of o)r.key==="query"?(t=r.value,je(e,r)):r.key==="id"&&(t=document.getElementById(r.value),t&&je(e,r));return t&&t.tagName!==n.toUpperCase()&&console.warn(`Expected a "${n.toUpperCase()}" element but found a "${t.tagName}".`),t||(t=document.createElement(n)),te(t,...e),t}function wi(n){return yn(n)&&"disabled"in n&&jt(n.disabled)}function Fi(n){for(n=gn(n);n.lastChild;)n.lastChild.remove()}function Qs(n,e){n=gn(n),Fi(n),n.append(X1(e))}function xh(n,e,t){n=gn(n);let o=w(t),r=o&&n.classList.contains(t);o&&r!==e&&n.classList.toggle(t)}async function gh(n,e,t){w(t)&&t.start();let o=n==="canplay"?e.HAVE_CURRENT_DATA:e.HAVE_ENOUGH_DATA;if(e.readyState>=o)return!0;try{return await Jt(e,n,"error"),!0}catch(r){return console.warn(e.error,r),!1}finally{w(t)&&t.end()}}function wh(n,e){return gh("canplay",n,e)}function Ys(n,e){return gh("canplaythrough",n,e)}function Zt(...n){return et("audio",...n)}function G1(...n){return et("button",...n)}function Fh(...n){return G1(...n,xi("button"))}function nr(...n){return Fh(...n,ue("btn","btn-primary"))}function Ks(...n){return Fh(...n,ue("btn","btn-secondary"))}function Js(...n){return et("canvas",...n)}function nu(...n){return et("dd",...n)}function fe(...n){return et("div",...n)}function Ah(...n){return et("dl",...n)}function _h(...n){return et("dt",...n)}function vh(...n){return et("h1",...n)}function Sh(...n){return et("h2",...n)}function or(...n){return et("img",...n)}function ou(...n){return et("input",...n)}function ru(...n){return et("label",...n)}function rr(n,e,t){return gn(t).id=n,[ru(Wd(n),e),t]}function Th(...n){return et("meter",...n)}function Zs(...n){return et("option",...n)}function $s(...n){return et("select",...n)}function Ai(...n){return et("video",...n)}function _i(...n){return ou(xi("checkbox"),...n)}function ir(...n){return ou(xi("number"),...n)}function Mh(...n){return ou(xi("range"),...n)}function X1(n){return document.createTextNode(n)}function kh(...n){let e=document.createElement("style");document.head.append(e);for(let t of n)t.applyToSheet(e.sheet);return e}function sr(n){return!(n.shiftKey||n.altKey||n.ctrlKey||n.metaKey)}var iu=class{constructor(e,t,o){if(this.name=e,this.callback=t,!ee(t))throw new Error("A function instance is required for this parameter");this.opts=o,Object.freeze(this)}applyToElement(e){this.add(e)}add(e){e.addEventListener(this.name,this.callback,this.opts)}remove(e){e.removeEventListener(this.name,this.callback)}};function ea(n,e,t){return new iu(n,e,t)}function Eh(n,e){return ea("click",n,e)}function $t(n,e){return ea("input",n,e)}function bh(n,e){return ea("play",n,e)}function yh(n,e){return ea("released",n,e)}var Dh=["change","click","contextmenu","dblclick","mouseup","pointerup","reset","submit","touchend"];function en(n,e=!1){let t=async o=>{if(o.isTrusted){if(!e)for(let r of Dh)window.removeEventListener(r,t);n()}};for(let o of Dh)window.addEventListener(o,t)}function Bn(...n){return Promise.all(n)}function Ch(n){if(n.status>=400)throw new Error("Resource could not be retrieved: "+n.requestPath);return n}function ko(n){let{content:e}=Ch(n);return e}function Bh(){return"chrome"in globalThis&&!navigator.userAgent.match("CriOS")}function Lh(){return"InstallTrigger"in globalThis}function Rh(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function j1(){return/^mac/i.test(navigator.platform)}function ar(){return/iP(ad|hone|od)/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||j1()&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>2}function wn(){return/Mobile VR/.test(navigator.userAgent)||/Pico Neo 3 Link/.test(navigator.userAgent)||Fn}function na(){return"xr"in navigator&&"isSessionSupported"in navigator.xr}function su(){return"getVRDisplays"in navigator}function oa(){return na()||su()}function vi(){return/Android/.test(navigator.userAgent)||/BlackBerry/.test(navigator.userAgent)||/(UC Browser |UCWEB)/.test(navigator.userAgent)||ar()||wn()}function cr(){return!vi()}var q1=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,ta=navigator.userAgent.match(q1),Fn=!!ta,Ph=Fn&&{major:parseFloat(ta[1]),minor:parseFloat(ta[2]),patch:parseFloat(ta[3])},xv=Fn&&/pacific/i.test(navigator.userAgent),gv=Fn&&/quest/i.test(navigator.userAgent),wv=Fn&&/quest 2/i.test(navigator.userAgent);var Fv="Worker"in globalThis;function lr(...n){let e=[];for(let t of n)w(t)&&t.length>0&&e.indexOf(t)===-1&&e.push(t);return e.join("-")}function au(n,...e){if(!yn(n))return!1;n=n;for(let t of e){if(!(t in n))return!1;let o=n[t];if(!ee(o))return!1}return!0}function Q1(n){return au(n,"dispose")}function Y1(n){return au(n,"destroy")}function K1(n){return au(n,"close")}function Re(n){Q1(n)&&n.dispose(),K1(n)&&n.close(),Y1(n)&&n.destroy()}function Si(n){return w(n)&&"_resolveInput"in n}function Ti(n){return Si(n)&&"_resolveOutput"in n}var ur=class extends re{get name(){return this._name}set name(e){this._name=e,this.context._name(this,e)}constructor(e,t){super(),this.nodeType=e,this.context=t,this._name=null,this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){}isConnected(e,t,o){return this.context._isConnected(this,e,t,o)}resolveOutput(e){let t={source:this,output:e};for(;Ti(t.source);)t=t.source._resolveOutput(t.output);return t}resolveInput(e){let t={destination:this,input:e};for(;Si(t.destination);)t=t.destination._resolveInput(t.input);return t}toggle(e,t,o){this._toggle(e,t,o)}_toggle(e,t,o){if(this.isConnected(e,t,o))this._disconnect(e,t,o);else return this._connect(e,t,o)}connect(e,t,o){return this._connect(e,t,o)}_connect(e,t,o){return this.context._connect(this,e,t,o)}disconnect(e,t,o){this._disconnect(e,t,o)}_disconnect(e,t,o){this.context._disconnect(this,e,t,o)}};var pt=class n extends ur{get exemplar(){return this.allNodes[0]}constructor(e,t,o,r,i){super(e,t),o=o||[],i=i||[];let s=r||o;this.inputs=o;let a=o.filter(Ti).map(l=>l);this.outputs=s.filter(Ti).map(l=>l),this.allNodes=Array.from(new Set([...a,...this.outputs,...i]))}add(e){this.allNodes.push(e),this.context._parent(this,e)}remove(e){je(this.allNodes,e),this.context._unparent(this,e)}onDisposing(){this.allNodes.forEach(Re),super.onDisposing()}get channelCount(){return this.exemplar.channelCount}set channelCount(e){this.allNodes.forEach(t=>t.channelCount=e)}get channelCountMode(){return this.exemplar.channelCountMode}set channelCountMode(e){this.allNodes.forEach(t=>t.channelCountMode=e)}get channelInterpretation(){return this.exemplar.channelInterpretation}set channelInterpretation(e){this.allNodes.forEach(t=>t.channelInterpretation=e)}get numberOfInputs(){return this.inputs.length}get numberOfOutputs(){return this.outputs.length}static resolve(e,t){return t=t||0,t<0||e.length<=t?null:e[t]}_resolveInput(e){return{destination:n.resolve(this.inputs,e)}}_resolveOutput(e){return{source:n.resolve(this.outputs,e)}}};function ra(n){let e=[];for(let t=0;t<n.length;++t){let o=n[t],r=!1;for(let i=0;i<e.length&&!r;++i){let s=e[i];r=o.kind===s.kind&&s.label.indexOf(o.label)>0}r||e.push(o)}return e}var pr=class extends N{constructor(){super("devicesettingschanged")}},ia=class{constructor(...e){this.permissed=new Set,this.managers=e}get hasPermissions(){for(let e of this.managers)if(!this.permissed.has(e))return!1;return!0}async init(){if(!this.hasPermissions){let e=await this.getDevices();await Promise.all(this.managers.map(t=>t.setDevice(Ft(e,o=>o.kind===t.deviceKind&&o.deviceId===t.preferredDeviceID,o=>o.kind===t.deviceKind&&o.deviceId==="default",o=>o.kind===t.deviceKind&&o.deviceId.length>0))))}}async getDevices(e=!1){let t=null,o=null;for(let r=0;r<3;++r)if(t=await navigator.mediaDevices.enumerateDevices(),!this.hasPermissions){let i={};for(let s of this.managers)if(!this.permissed.has(s)){for(let a of t)if(a.kind===s.deviceKind&&a.deviceId.length>0&&a.label.length>0){this.permissed.add(s);break}this.permissed.has(s)||(i[s.mediaType]=!0)}if(!this.hasPermissions)try{o=await navigator.mediaDevices.getUserMedia(i)}catch(s){console.warn(s)}}if(o)for(let r of o.getTracks())r.stop();return t=(t||[]).sort(cu),e&&(t=ra(t)),t}get outStreams(){return this.managers.map(e=>e.outStream)}},cu=Qt(n=>n.label);var tn=ee(HTMLAudioElement.prototype.setSinkId),lu=class extends N{constructor(e){super("audiooutputchanged"),this.device=e}},Vh="calla:preferredAudioOutputID",sa=class extends re{get hasAudioPermission(){return this._hasAudioPermission}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}constructor(e){super(),this.element=e,this._hasAudioPermission=!1,this._ready=new ve,this.start(),Object.seal(this)}async start(){if(tn){let e=await navigator.mediaDevices.enumerateDevices(),t=Ft(e,o=>o.kind==="audiooutput"&&o.label.length>0);if(w(t)){this._hasAudioPermission=!0;let o=await this.getPreferredAudioOutput();o&&await this.setAudioOutputDevice(o)}}this._ready.resolve()}get preferredAudioOutputID(){return tn?localStorage.getItem(Vh):null}async getAudioOutputDevices(e=!1){return tn?await this.getAvailableDevices(e)||[]:[]}async getAudioOutputDevice(){if(!tn)return null;let e=this.element&&this.element.sinkId;if(B(e))return null;let t=await this.getAudioOutputDevices();return Ft(t,r=>r.deviceId===e)}async getPreferredAudioOutput(){if(!tn)return null;let e=await this.getAudioOutputDevices();return Ft(e,o=>o.deviceId===this.preferredAudioOutputID,o=>o.deviceId==="default",o=>o.deviceId.length>0)}async setAudioOutputDevice(e){if(tn){if(w(e)&&e.kind!=="audiooutput")throw new Error(`Device is not an audio output device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(Vh,e&&e.deviceId||null);let t=this.element,o=t&&t.sinkId;this.preferredAudioOutputID!==o&&(w(this.preferredAudioOutputID)&&await this.element.setSinkId(this.preferredAudioOutputID),this.dispatchEvent(new lu(e)))}}async getAvailableDevices(e=!1){let t=null,o=null;for(let r=0;r<3;++r){t=await navigator.mediaDevices.enumerateDevices();for(let i of t)i.deviceId.length>0&&(this.hasAudioPermission||(this._hasAudioPermission=i.kind==="audioinput"&&i.label.length>0));if(this.hasAudioPermission)break;try{o=await this.startStream()}catch(i){console.warn(i)}}if(o)for(let r of o.getTracks())r.stop();return t=(t||[]).sort(cu),e&&(t=ra(t)),tn?t.filter(r=>r.kind==="audiooutput"):[]}startStream(){return navigator.mediaDevices.getUserMedia({audio:!0})}};function J1(n){return n[0]}function Z1(n){return n.shift()}function $1(n){return n[n.length-1]}function ew(n){return n.pop()}var aa=class{constructor(e){this.value=e,this._forward=new Array,this._reverse=new Array}connectSorted(e,t){if(w(t)){let o=Qt(r=>t(r.value));$o(this._forward,e,o),$o(e._reverse,this,o)}else this.connectTo(e)}connectTo(e){this.connectAt(e,this._forward.length)}connectAt(e,t){ql(this._forward,e,t),e._reverse.push(this)}disconnectFrom(e){je(this._forward,e),je(e._reverse,this)}isConnectedTo(e){return this._forward.indexOf(e)>=0||this._reverse.indexOf(e)>=0}flatten(){let e=new Set,t=[this];for(;t.length>0;){let o=t.shift();w(o)&&!e.has(o)&&(e.add(o),t.push(...o._forward))}return Array.from(e)}*traverse(e){let t=new Set,o=[this],r=e?J1:$1,i=e?Z1:ew;for(;o.length>0;){let s=r(o);t.has(s)?e||(i(o),yield s):(t.add(s),e&&(i(o),yield s),s._forward.length>0&&o.push(...s._forward))}}breadthFirst(){return this.traverse(!0)}depthFirst(){return this.traverse(!1)}search(e,t=!0){for(let o of this.traverse(t))if(e(o))return o;return null}*searchAll(e,t=!0){for(let o of this.traverse(t))e(o)&&(yield o)}find(e,t=!0){return this.search(o=>o.value===e,t)}findAll(e,t=!0){return this.searchAll(o=>o.value===e,t)}contains(e,t=!0){for(let o of this.traverse(t))if(o===e)return!0;return!1}containsValue(e,t=!0){for(let o of this.traverse(t))if(o.value===e)return!0;return!1}get _isEntryPoint(){return this._reverse.length===0}get _isExitPoint(){return this._forward.length===0}get isDisconnected(){return this._isEntryPoint&&this._isExitPoint}get isConnected(){return!this._isExitPoint||!this._isEntryPoint}get isTerminus(){return this._isEntryPoint||this._isExitPoint}get isInternal(){return!this._isEntryPoint&&!this._isExitPoint}};var ca=class extends aa{get connections(){return this._forward}get isEntryPoint(){return this._isEntryPoint}get isExitPoint(){return this._isExitPoint}};var Q=class extends ur{constructor(e,t,o){super(e,t),this._node=o,this.context._init(this._node,this.nodeType)}onDisposing(){this.disconnect(),this.context._dispose(this._node),super.onDisposing()}parent(e){this.context._parent(this,e)}get channelCount(){return this._node.channelCount}set channelCount(e){this._node.channelCount=e}get channelCountMode(){return this._node.channelCountMode}set channelCountMode(e){this._node.channelCountMode=e}get channelInterpretation(){return this._node.channelInterpretation}set channelInterpretation(e){this._node.channelInterpretation=e}get numberOfInputs(){return this._node.numberOfInputs}get numberOfOutputs(){return this._node.numberOfOutputs}_resolveInput(e){return{destination:this._node,input:e}}_resolveOutput(e){return{source:this._node,output:e}}};var dr=class extends Q{constructor(e,t){super("analyser",e,new AnalyserNode(e,t))}get fftSize(){return this._node.fftSize}set fftSize(e){this._node.fftSize=e}get frequencyBinCount(){return this._node.frequencyBinCount}get maxDecibels(){return this._node.maxDecibels}set maxDecibels(e){this._node.maxDecibels=e}get minDecibels(){return this._node.minDecibels}set minDecibels(e){this._node.minDecibels=e}get smoothingTimeConstant(){return this._node.smoothingTimeConstant}set smoothingTimeConstant(e){this._node.smoothingTimeConstant=e}getByteFrequencyData(e){this._node.getByteFrequencyData(e)}getByteTimeDomainData(e){this._node.getByteTimeDomainData(e)}getFloatFrequencyData(e){this._node.getFloatFrequencyData(e)}getFloatTimeDomainData(e){this._node.getFloatTimeDomainData(e)}};var J=class{get name(){return this._name}set name(e){this._name=e,this.context._name(this,e)}constructor(e,t,o){this.nodeType=e,this.context=t,this.param=o,this._name=null,this.disposed=!1,this.context._init(this.param,this.nodeType)}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){this.context._dispose(this.param)}get automationRate(){return this.param.automationRate}set automationRate(e){this.param.automationRate=e}get defaultValue(){return this.param.defaultValue}get maxValue(){return this.param.maxValue}get minValue(){return this.param.minValue}get value(){return this.param.value}set value(e){this.param.value=e}cancelAndHoldAtTime(e){return this.param.cancelAndHoldAtTime(e),this}cancelScheduledValues(e){return this.param.cancelScheduledValues(e),this}exponentialRampToValueAtTime(e,t){return this.param.exponentialRampToValueAtTime(e,t),this}linearRampToValueAtTime(e,t){return this.param.linearRampToValueAtTime(e,t),this}setTargetAtTime(e,t,o){return this.param.setTargetAtTime(e,t,o),this}setValueAtTime(e,t){return this.param.setValueAtTime(e,t),this}setValueCurveAtTime(e,t,o){return this.param.setValueCurveAtTime(e,t,o),this}_resolveInput(){return{destination:this.param}}resolveInput(){return this._resolveInput()}};var la=class extends Q{constructor(e,t){super("audio-buffer-source",e,new AudioBufferSourceNode(e,t)),this._node.addEventListener("ended",()=>this.dispatchEvent(new N("ended"))),this.parent(this.playbackRate=new J("playbackRate",e,this._node.playbackRate)),this.parent(this.detune=new J("detune",e,this._node.detune))}get buffer(){return this._node.buffer}set buffer(e){this._node.buffer=e}get loop(){return this._node.loop}set loop(e){this._node.loop=e}get loopEnd(){return this._node.loopEnd}set loopEnd(e){this._node.loopEnd=e}get loopStart(){return this._node.loopStart}set loopStart(e){this._node.loopStart=e}get onended(){return this._node.onended}set onended(e){this._node.onended=e}start(e,t,o){this._node.start(e,t,o)}stop(e){this._node.stop(e)}};var ua=class extends Q{constructor(e,t){super("destination",e,t)}get maxChannelCount(){return this._node.maxChannelCount}};var nn=class extends Q{constructor(e,t){super("biquad-filter",e,new BiquadFilterNode(e,t)),this.parent(this.Q=new J("Q",this.context,this._node.Q)),this.parent(this.detune=new J("detune",this.context,this._node.detune)),this.parent(this.frequency=new J("frequency",this.context,this._node.frequency)),this.parent(this.gain=new J("gain",this.context,this._node.gain))}get type(){return this._node.type}set type(e){this._node.type=e}getFrequencyResponse(e,t,o){this._node.getFrequencyResponse(e,t,o)}};var pa=class extends Q{constructor(e,t){super("channel-merger",e,new ChannelMergerNode(e,t))}};var da=class extends Q{constructor(e,t){super("channel-splitter",e,new ChannelSplitterNode(e,t))}};var ha=class extends Q{constructor(e,t){super("constant-source",e,new ConstantSourceNode(e,t)),this._node.addEventListener("ended",()=>this.dispatchEvent(new N("ended"))),this.parent(this.offset=new J("offset",this.context,this._node.offset))}get onended(){return this._node.onended}set onended(e){this._node.onended=e}start(e){this._node.start(e)}stop(e){this._node.stop(e)}};var ma=class extends Q{constructor(e,t){super("convolver",e,new ConvolverNode(e,t))}get buffer(){return this._node.buffer}set buffer(e){this._node.buffer=e}get normalize(){return this._node.normalize}set normalize(e){this._node.normalize=e}};var fa=class extends Q{constructor(e,t){super("delay",e,new DelayNode(e,t)),this.parent(this.delayTime=new J("delay",this.context,this._node.delayTime))}};var hr=class extends Q{constructor(e,t){super("dynamics-compressor",e,new DynamicsCompressorNode(e,t)),this.parent(this.attack=new J("attack",this.context,this._node.attack)),this.parent(this.knee=new J("knee",this.context,this._node.knee)),this.parent(this.ratio=new J("ratio",this.context,this._node.ratio)),this.parent(this.release=new J("release",this.context,this._node.release)),this.parent(this.threshold=new J("threshold",this.context,this._node.threshold))}get reduction(){return this._node.reduction}};var bt=class extends Q{constructor(e,t){super("gain",e,new GainNode(e,t)),this.parent(this.gain=new J("gain",this.context,this._node.gain))}};var xa=class extends Q{constructor(e,t){super("iir-filter",e,new IIRFilterNode(e,t))}getFrequencyResponse(e,t,o){this._node.getFrequencyResponse(e,t,o)}};var Wt=class extends Q{constructor(e,t){super("media-element-audio-source",e,new MediaElementAudioSourceNode(e,t))}get mediaElement(){return this._node.mediaElement}};var Ln=class extends Q{constructor(e,t){super("media-stream-audio-destination",e,new MediaStreamAudioDestinationNode(e,t))}get stream(){return this._node.stream}};var tw="AudioContext"in globalThis,Ih=tw&&"AudioListener"in globalThis,Oh=Ih&&"setPosition"in AudioListener.prototype,Mi=Ih&&"positionX"in AudioListener.prototype,uu="createMediaStreamSource"in AudioContext.prototype,OS=ee(HTMLMediaElement.prototype.captureStream)||ee(HTMLMediaElement.prototype.mozCaptureStream);var Rn=class extends Q{constructor(e,t){let o=Zt(It(!1),Gs(uu),fn(!0),Dn(!1),$e("none"),fi(t.mediaStream)),r;uu?r=new MediaStreamAudioSourceNode(e,t):r=new MediaElementAudioSourceNode(e,{mediaElement:o}),super("media-stream-audio-source",e,r),this._stream=t.mediaStream,this._element=o}onDisposing(){this._element.pause(),super.onDisposing()}get mediaStream(){return this._stream}};var ga=class extends Q{constructor(e,t){super("oscillator",e,new OscillatorNode(e,t)),this._node.addEventListener("ended",()=>this.dispatchEvent(new N("ended"))),this.parent(this.detune=new J("detune",this.context,this._node.detune)),this.parent(this.frequency=new J("frequency",this.context,this._node.frequency))}get type(){return this._node.type}set type(e){this._node.type=e}get onended(){return this._node.onended}set onended(e){this._node.onended=e}setPeriodicWave(e){this._node.setPeriodicWave(e)}start(e){this._node.start(e)}stop(e){this._node.stop(e)}};var mr=class extends Q{constructor(e,t){super("panner",e,new PannerNode(e,t)),this.parent(this.positionX=new J("positionX",this.context,this._node.positionX)),this.parent(this.positionY=new J("positionY",this.context,this._node.positionY)),this.parent(this.positionZ=new J("positionZ",this.context,this._node.positionZ)),this.parent(this.orientationX=new J("orientationX",this.context,this._node.orientationX)),this.parent(this.orientationY=new J("orientationY",this.context,this._node.orientationY)),this.parent(this.orientationZ=new J("orientationZ",this.context,this._node.orientationZ))}get coneInnerAngle(){return this._node.coneInnerAngle}set coneInnerAngle(e){this._node.coneInnerAngle=e}get coneOuterAngle(){return this._node.coneOuterAngle}set coneOuterAngle(e){this._node.coneOuterAngle=e}get coneOuterGain(){return this._node.coneOuterGain}set coneOuterGain(e){this._node.coneOuterGain=e}get distanceModel(){return this._node.distanceModel}set distanceModel(e){this._node.distanceModel=e}get maxDistance(){return this._node.maxDistance}set maxDistance(e){this._node.maxDistance=e}get panningModel(){return this._node.panningModel}set panningModel(e){this._node.panningModel=e}get refDistance(){return this._node.refDistance}set refDistance(e){this._node.refDistance=e}get rolloffFactor(){return this._node.rolloffFactor}set rolloffFactor(e){this._node.rolloffFactor=e}setOrientation(e,t,o){this._node.setOrientation(e,t,o)}setPosition(e,t,o){this._node.setPosition(e,t,o)}};var wa=class extends Q{constructor(e,t){super("stereo-panner",e,new StereoPannerNode(e,t)),this.parent(this.pan=new J("pan",this.context,this._node.pan))}};var Fa=class extends Q{constructor(e,t){super("wave-shaper",e,new WaveShaperNode(e,t))}get curve(){return this._node.curve}set curve(e){this._node.curve=e}get oversample(){return this._node.oversample}set oversample(e){this._node.oversample=e}};!("AudioContext"in globalThis)&&"webkitAudioContext"in globalThis&&(globalThis.AudioContext=globalThis.webkitAudioContext);!("OfflineAudioContext"in globalThis)&&"webkitOfflineAudioContext"in globalThis&&(globalThis.OfflineAudioContext=globalThis.webkitOfflineAudioContext);var pu=class{constructor(e,t){this.type=e,this.name=t,this.connections=new Set}};function Aa(n,e,t,o,r){return n.type===e&&(B(t)||t===n.destination)&&(B(o)||o===n.output)&&(B(r)||r===n.input)}function fr(n,e){let t=null,o=null;return w(n)&&({destination:t,input:o}=n.resolveInput(e)),{destination:t,input:o}}var _a=class extends AudioContext{get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}constructor(e){super(e),this.counters=new Map,this.nodes=new Map,this._ready=new ve,this._destination=new ua(this,super.destination),this.state==="running"?this._ready.resolve():this.state==="closed"?this.resume().then(()=>this._ready.resolve()):en(()=>this.resume().then(()=>this._ready.resolve())),this.ready.then(()=>console.log("Audio is now ready"))}_init(e,t){if(!this.nodes.has(e)){this.counters.has(t)||this.counters.set(t,0);let o=this.counters.get(t),r=`${t}-${o}`;this.nodes.set(e,new pu(t,r)),Si(e)&&(e.name=r),this.counters.set(t,o+1)}}_name(e,t){let{destination:o}=fr(e);if(this.nodes.has(o)){let r=this.nodes.get(o);r.name=`${t}-${r.type}`}}_dispose(e){this.nodes.delete(e)}_isConnected(e,t,o,r){let{source:i,output:s}=e.resolveOutput(o),{destination:a,input:l}=fr(t,r);if(B(i)||!this.nodes.has(i))return null;{let p=this.nodes.get(i);for(let m of p.connections)if(Aa(m,"conn",a,s,l))return!0;return!1}}_parent(e,t){let{source:o}=e.resolveOutput(),{destination:r}=fr(t);this.nodes.has(o)&&this.nodes.get(o).connections.add({type:"parent",src:e,dest:t,destination:r,source:o})}_unparent(e,t){let{source:o}=e.resolveOutput(),{destination:r}=fr(t);if(this.nodes.has(o)){let i=this.nodes.get(o).connections,s=new Set;for(let a of i)Aa(a,"parent",r)&&s.add(a);for(let a of s)i.delete(a)}}_getConnections(e){return this.nodes.has(e)?this.nodes.get(e).connections:null}_connect(e,t,o,r){let{source:i,output:s}=e.resolveOutput(o),{destination:a,input:l}=fr(t,r);if(this.nodes.has(i)){let p=this.nodes.get(i).connections,m=!1;for(let x of p)Aa(x,"conn",a,s,l)&&(m=!0);m||p.add({type:"conn",src:e,dest:t,outp:o,inp:r,source:i,destination:a,output:s,input:l})}if(a instanceof AudioNode)return t=t,w(l)?(i.connect(a,s,l),t):w(s)?(i.connect(a,s),t):(i.connect(a),t);a instanceof AudioParam?w(s)?i.connect(a,s):w(a)?i.connect(a):mn(a):mn(a)}_disconnect(e,t,o,r){let i;me(t)?(i=void 0,o=t):i=t;let{source:s,output:a}=e.resolveOutput(o),{destination:l,input:p}=fr(i,r);if(this.nodes.has(s)){let m=this.nodes.get(s).connections,x=new Set;for(let F of m)Aa(F,"conn",l,a,p)&&x.add(F);for(let F of x)m.delete(F)}l instanceof AudioNode?w(r)?s.disconnect(l,o,r):w(o)?s.disconnect(l,o):w(l)?s.disconnect(l):s.disconnect():w(o)?s.disconnect(l,o):w(l)?s.disconnect(l):s.disconnect()}getAudioGraph(e){let t=new Map;for(let[o,r]of this.nodes){let i=o instanceof AudioNode?"node":o instanceof AudioParam?"param":"unknown";(e||i!=="param")&&t.set(o,new ca({name:r.name,type:r.type,nodeClass:i}))}for(let[o,r]of this.nodes){let i=t.get(o);for(let s of r.connections){let a=s.destination;if(t.has(a)){let l=t.get(a);i.connectTo(l),l.connectTo(i)}}}return Array.from(t.values())}get destination(){return this._destination}createAnalyser(){return new dr(this)}createBiquadFilter(){return new nn(this)}createBufferSource(){return new la(this)}createChannelMerger(e){return new pa(this,{numberOfInputs:e})}createChannelSplitter(e){return new da(this,{numberOfOutputs:e})}createConstantSource(){return new ha(this)}createConvolver(){return new ma(this)}createDelay(e){return new fa(this,{maxDelayTime:e})}createDynamicsCompressor(){return new hr(this)}createGain(){return new bt(this)}createIIRFilter(e,t){return new xa(this,{feedforward:e,feedback:t})}createMediaElementSource(e){return new Wt(this,{mediaElement:e})}createMediaStreamDestination(){return new Ln(this)}createMediaStreamSource(e){return new Rn(this,{mediaStream:e})}createOscillator(){return new ga(this)}createPanner(){return new mr(this)}createStereoPanner(){return new wa(this)}createWaveShaper(){return new Fa(this)}createScriptProcessor(){throw new Error("Script processor nodes are deprecated")}};var tt=1e-6,ke=typeof Float32Array<"u"?Float32Array:Array,on=Math.random;var yT=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});function Wh(){var n=new ke(9);return ke!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}var xr={};jl(xr,{add:()=>oF,calculateW:()=>jw,clone:()=>$w,conjugate:()=>Kw,copy:()=>tF,create:()=>mu,dot:()=>dm,equals:()=>lF,exactEquals:()=>cF,exp:()=>cm,fromEuler:()=>Jw,fromMat3:()=>um,fromValues:()=>eF,getAngle:()=>Uw,getAxisAngle:()=>Nw,identity:()=>Hw,invert:()=>Yw,len:()=>sF,length:()=>hm,lerp:()=>iF,ln:()=>lm,mul:()=>rF,multiply:()=>am,normalize:()=>fu,pow:()=>qw,random:()=>Qw,rotateX:()=>zw,rotateY:()=>Gw,rotateZ:()=>Xw,rotationTo:()=>uF,scale:()=>pm,set:()=>nF,setAxes:()=>dF,setAxisAngle:()=>sm,slerp:()=>Ma,sqlerp:()=>pF,sqrLen:()=>aF,squaredLength:()=>mm,str:()=>Zw});var Qe={};jl(Qe,{add:()=>sw,angle:()=>kw,bezier:()=>ww,ceil:()=>aw,clone:()=>ow,copy:()=>rw,create:()=>va,cross:()=>Ei,dist:()=>Rw,distance:()=>Gh,div:()=>Lw,divide:()=>zh,dot:()=>Ta,equals:()=>Dw,exactEquals:()=>yw,floor:()=>cw,forEach:()=>Iw,fromValues:()=>Sa,hermite:()=>gw,inverse:()=>fw,len:()=>hu,length:()=>Hh,lerp:()=>xw,max:()=>uw,min:()=>lw,mul:()=>Bw,multiply:()=>Uh,negate:()=>mw,normalize:()=>du,random:()=>Fw,rotateX:()=>Sw,rotateY:()=>Tw,rotateZ:()=>Mw,round:()=>pw,scale:()=>dw,scaleAndAdd:()=>hw,set:()=>iw,sqrDist:()=>Pw,sqrLen:()=>Vw,squaredDistance:()=>Xh,squaredLength:()=>jh,str:()=>bw,sub:()=>Cw,subtract:()=>Nh,transformMat3:()=>_w,transformMat4:()=>Aw,transformQuat:()=>vw,zero:()=>Ew});function va(){var n=new ke(3);return ke!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function ow(n){var e=new ke(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Hh(n){var e=n[0],t=n[1],o=n[2];return Math.hypot(e,t,o)}function Sa(n,e,t){var o=new ke(3);return o[0]=n,o[1]=e,o[2]=t,o}function rw(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function iw(n,e,t,o){return n[0]=e,n[1]=t,n[2]=o,n}function sw(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function Nh(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function Uh(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n}function zh(n,e,t){return n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n}function aw(n,e){return n[0]=Math.ceil(e[0]),n[1]=Math.ceil(e[1]),n[2]=Math.ceil(e[2]),n}function cw(n,e){return n[0]=Math.floor(e[0]),n[1]=Math.floor(e[1]),n[2]=Math.floor(e[2]),n}function lw(n,e,t){return n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.min(e[2],t[2]),n}function uw(n,e,t){return n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n}function pw(n,e){return n[0]=Math.round(e[0]),n[1]=Math.round(e[1]),n[2]=Math.round(e[2]),n}function dw(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function hw(n,e,t,o){return n[0]=e[0]+t[0]*o,n[1]=e[1]+t[1]*o,n[2]=e[2]+t[2]*o,n}function Gh(n,e){var t=e[0]-n[0],o=e[1]-n[1],r=e[2]-n[2];return Math.hypot(t,o,r)}function Xh(n,e){var t=e[0]-n[0],o=e[1]-n[1],r=e[2]-n[2];return t*t+o*o+r*r}function jh(n){var e=n[0],t=n[1],o=n[2];return e*e+t*t+o*o}function mw(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function fw(n,e){return n[0]=1/e[0],n[1]=1/e[1],n[2]=1/e[2],n}function du(n,e){var t=e[0],o=e[1],r=e[2],i=t*t+o*o+r*r;return i>0&&(i=1/Math.sqrt(i)),n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Ta(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Ei(n,e,t){var o=e[0],r=e[1],i=e[2],s=t[0],a=t[1],l=t[2];return n[0]=r*l-i*a,n[1]=i*s-o*l,n[2]=o*a-r*s,n}function xw(n,e,t,o){var r=e[0],i=e[1],s=e[2];return n[0]=r+o*(t[0]-r),n[1]=i+o*(t[1]-i),n[2]=s+o*(t[2]-s),n}function gw(n,e,t,o,r,i){var s=i*i,a=s*(2*i-3)+1,l=s*(i-2)+i,p=s*(i-1),m=s*(3-2*i);return n[0]=e[0]*a+t[0]*l+o[0]*p+r[0]*m,n[1]=e[1]*a+t[1]*l+o[1]*p+r[1]*m,n[2]=e[2]*a+t[2]*l+o[2]*p+r[2]*m,n}function ww(n,e,t,o,r,i){var s=1-i,a=s*s,l=i*i,p=a*s,m=3*i*a,x=3*l*s,F=l*i;return n[0]=e[0]*p+t[0]*m+o[0]*x+r[0]*F,n[1]=e[1]*p+t[1]*m+o[1]*x+r[1]*F,n[2]=e[2]*p+t[2]*m+o[2]*x+r[2]*F,n}function Fw(n,e){e=e||1;var t=on()*2*Math.PI,o=on()*2-1,r=Math.sqrt(1-o*o)*e;return n[0]=Math.cos(t)*r,n[1]=Math.sin(t)*r,n[2]=o*e,n}function Aw(n,e,t){var o=e[0],r=e[1],i=e[2],s=t[3]*o+t[7]*r+t[11]*i+t[15];return s=s||1,n[0]=(t[0]*o+t[4]*r+t[8]*i+t[12])/s,n[1]=(t[1]*o+t[5]*r+t[9]*i+t[13])/s,n[2]=(t[2]*o+t[6]*r+t[10]*i+t[14])/s,n}function _w(n,e,t){var o=e[0],r=e[1],i=e[2];return n[0]=o*t[0]+r*t[3]+i*t[6],n[1]=o*t[1]+r*t[4]+i*t[7],n[2]=o*t[2]+r*t[5]+i*t[8],n}function vw(n,e,t){var o=t[0],r=t[1],i=t[2],s=t[3],a=e[0],l=e[1],p=e[2],m=r*p-i*l,x=i*a-o*p,F=o*l-r*a,v=r*F-i*x,k=i*m-o*F,D=o*x-r*m,b=s*2;return m*=b,x*=b,F*=b,v*=2,k*=2,D*=2,n[0]=a+m+v,n[1]=l+x+k,n[2]=p+F+D,n}function Sw(n,e,t,o){var r=[],i=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],i[0]=r[0],i[1]=r[1]*Math.cos(o)-r[2]*Math.sin(o),i[2]=r[1]*Math.sin(o)+r[2]*Math.cos(o),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function Tw(n,e,t,o){var r=[],i=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],i[0]=r[2]*Math.sin(o)+r[0]*Math.cos(o),i[1]=r[1],i[2]=r[2]*Math.cos(o)-r[0]*Math.sin(o),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function Mw(n,e,t,o){var r=[],i=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],i[0]=r[0]*Math.cos(o)-r[1]*Math.sin(o),i[1]=r[0]*Math.sin(o)+r[1]*Math.cos(o),i[2]=r[2],n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function kw(n,e){var t=n[0],o=n[1],r=n[2],i=e[0],s=e[1],a=e[2],l=Math.sqrt(t*t+o*o+r*r),p=Math.sqrt(i*i+s*s+a*a),m=l*p,x=m&&Ta(n,e)/m;return Math.acos(Math.min(Math.max(x,-1),1))}function Ew(n){return n[0]=0,n[1]=0,n[2]=0,n}function bw(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function yw(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}function Dw(n,e){var t=n[0],o=n[1],r=n[2],i=e[0],s=e[1],a=e[2];return Math.abs(t-i)<=tt*Math.max(1,Math.abs(t),Math.abs(i))&&Math.abs(o-s)<=tt*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(r-a)<=tt*Math.max(1,Math.abs(r),Math.abs(a))}var Cw=Nh,Bw=Uh,Lw=zh,Rw=Gh,Pw=Xh,hu=Hh,Vw=jh,Iw=function(){var n=va();return function(e,t,o,r,i,s){var a,l;for(t||(t=3),o||(o=0),r?l=Math.min(r*t+o,e.length):l=e.length,a=o;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],i(n,n,s),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2];return e}}();function Ow(){var n=new ke(4);return ke!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function qh(n){var e=new ke(4);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function Qh(n,e,t,o){var r=new ke(4);return r[0]=n,r[1]=e,r[2]=t,r[3]=o,r}function Yh(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function Kh(n,e,t,o,r){return n[0]=e,n[1]=t,n[2]=o,n[3]=r,n}function Jh(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n}function Zh(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function $h(n){var e=n[0],t=n[1],o=n[2],r=n[3];return Math.hypot(e,t,o,r)}function em(n){var e=n[0],t=n[1],o=n[2],r=n[3];return e*e+t*t+o*o+r*r}function tm(n,e){var t=e[0],o=e[1],r=e[2],i=e[3],s=t*t+o*o+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),n[0]=t*s,n[1]=o*s,n[2]=r*s,n[3]=i*s,n}function nm(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function om(n,e,t,o){var r=e[0],i=e[1],s=e[2],a=e[3];return n[0]=r+o*(t[0]-r),n[1]=i+o*(t[1]-i),n[2]=s+o*(t[2]-s),n[3]=a+o*(t[3]-a),n}function rm(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]}function im(n,e){var t=n[0],o=n[1],r=n[2],i=n[3],s=e[0],a=e[1],l=e[2],p=e[3];return Math.abs(t-s)<=tt*Math.max(1,Math.abs(t),Math.abs(s))&&Math.abs(o-a)<=tt*Math.max(1,Math.abs(o),Math.abs(a))&&Math.abs(r-l)<=tt*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-p)<=tt*Math.max(1,Math.abs(i),Math.abs(p))}var DT=function(){var n=Ow();return function(e,t,o,r,i,s){var a,l;for(t||(t=4),o||(o=0),r?l=Math.min(r*t+o,e.length):l=e.length,a=o;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],n[3]=e[a+3],i(n,n,s),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2],e[a+3]=n[3];return e}}();function mu(){var n=new ke(4);return ke!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Hw(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function sm(n,e,t){t=t*.5;var o=Math.sin(t);return n[0]=o*e[0],n[1]=o*e[1],n[2]=o*e[2],n[3]=Math.cos(t),n}function Nw(n,e){var t=Math.acos(e[3])*2,o=Math.sin(t/2);return o>tt?(n[0]=e[0]/o,n[1]=e[1]/o,n[2]=e[2]/o):(n[0]=1,n[1]=0,n[2]=0),t}function Uw(n,e){var t=dm(n,e);return Math.acos(2*t*t-1)}function am(n,e,t){var o=e[0],r=e[1],i=e[2],s=e[3],a=t[0],l=t[1],p=t[2],m=t[3];return n[0]=o*m+s*a+r*p-i*l,n[1]=r*m+s*l+i*a-o*p,n[2]=i*m+s*p+o*l-r*a,n[3]=s*m-o*a-r*l-i*p,n}function zw(n,e,t){t*=.5;var o=e[0],r=e[1],i=e[2],s=e[3],a=Math.sin(t),l=Math.cos(t);return n[0]=o*l+s*a,n[1]=r*l+i*a,n[2]=i*l-r*a,n[3]=s*l-o*a,n}function Gw(n,e,t){t*=.5;var o=e[0],r=e[1],i=e[2],s=e[3],a=Math.sin(t),l=Math.cos(t);return n[0]=o*l-i*a,n[1]=r*l+s*a,n[2]=i*l+o*a,n[3]=s*l-r*a,n}function Xw(n,e,t){t*=.5;var o=e[0],r=e[1],i=e[2],s=e[3],a=Math.sin(t),l=Math.cos(t);return n[0]=o*l+r*a,n[1]=r*l-o*a,n[2]=i*l+s*a,n[3]=s*l-i*a,n}function jw(n,e){var t=e[0],o=e[1],r=e[2];return n[0]=t,n[1]=o,n[2]=r,n[3]=Math.sqrt(Math.abs(1-t*t-o*o-r*r)),n}function cm(n,e){var t=e[0],o=e[1],r=e[2],i=e[3],s=Math.sqrt(t*t+o*o+r*r),a=Math.exp(i),l=s>0?a*Math.sin(s)/s:0;return n[0]=t*l,n[1]=o*l,n[2]=r*l,n[3]=a*Math.cos(s),n}function lm(n,e){var t=e[0],o=e[1],r=e[2],i=e[3],s=Math.sqrt(t*t+o*o+r*r),a=s>0?Math.atan2(s,i)/s:0;return n[0]=t*a,n[1]=o*a,n[2]=r*a,n[3]=.5*Math.log(t*t+o*o+r*r+i*i),n}function qw(n,e,t){return lm(n,e),pm(n,n,t),cm(n,n),n}function Ma(n,e,t,o){var r=e[0],i=e[1],s=e[2],a=e[3],l=t[0],p=t[1],m=t[2],x=t[3],F,v,k,D,b;return v=r*l+i*p+s*m+a*x,v<0&&(v=-v,l=-l,p=-p,m=-m,x=-x),1-v>tt?(F=Math.acos(v),k=Math.sin(F),D=Math.sin((1-o)*F)/k,b=Math.sin(o*F)/k):(D=1-o,b=o),n[0]=D*r+b*l,n[1]=D*i+b*p,n[2]=D*s+b*m,n[3]=D*a+b*x,n}function Qw(n){var e=on(),t=on(),o=on(),r=Math.sqrt(1-e),i=Math.sqrt(e);return n[0]=r*Math.sin(2*Math.PI*t),n[1]=r*Math.cos(2*Math.PI*t),n[2]=i*Math.sin(2*Math.PI*o),n[3]=i*Math.cos(2*Math.PI*o),n}function Yw(n,e){var t=e[0],o=e[1],r=e[2],i=e[3],s=t*t+o*o+r*r+i*i,a=s?1/s:0;return n[0]=-t*a,n[1]=-o*a,n[2]=-r*a,n[3]=i*a,n}function Kw(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function um(n,e){var t=e[0]+e[4]+e[8],o;if(t>0)o=Math.sqrt(t+1),n[3]=.5*o,o=.5/o,n[0]=(e[5]-e[7])*o,n[1]=(e[6]-e[2])*o,n[2]=(e[1]-e[3])*o;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);var i=(r+1)%3,s=(r+2)%3;o=Math.sqrt(e[r*3+r]-e[i*3+i]-e[s*3+s]+1),n[r]=.5*o,o=.5/o,n[3]=(e[i*3+s]-e[s*3+i])*o,n[i]=(e[i*3+r]+e[r*3+i])*o,n[s]=(e[s*3+r]+e[r*3+s])*o}return n}function Jw(n,e,t,o){var r=.5*Math.PI/180;e*=r,t*=r,o*=r;var i=Math.sin(e),s=Math.cos(e),a=Math.sin(t),l=Math.cos(t),p=Math.sin(o),m=Math.cos(o);return n[0]=i*l*m-s*a*p,n[1]=s*a*m+i*l*p,n[2]=s*l*p-i*a*m,n[3]=s*l*m+i*a*p,n}function Zw(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"}var $w=qh,eF=Qh,tF=Yh,nF=Kh,oF=Jh,rF=am,pm=Zh,dm=nm,iF=om,hm=$h,sF=hm,mm=em,aF=mm,fu=tm,cF=rm,lF=im,uF=function(){var n=va(),e=Sa(1,0,0),t=Sa(0,1,0);return function(o,r,i){var s=Ta(r,i);return s<-.999999?(Ei(n,e,r),hu(n)<1e-6&&Ei(n,t,r),du(n,n),sm(o,n,Math.PI),o):s>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(Ei(n,r,i),o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=1+s,fu(o,o))}}(),pF=function(){var n=mu(),e=mu();return function(t,o,r,i,s,a){return Ma(n,o,s,a),Ma(e,r,i,a),Ma(t,n,e,2*a*(1-a)),t}}(),dF=function(){var n=Wh();return function(e,t,o,r){return n[0]=o[0],n[3]=o[1],n[6]=o[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],fu(e,um(e,n))}}();var xe={};jl(xe,{add:()=>gF,angle:()=>IF,ceil:()=>wF,clone:()=>hF,copy:()=>fF,create:()=>fm,cross:()=>yF,dist:()=>jF,distance:()=>Fm,div:()=>XF,divide:()=>wm,dot:()=>bF,equals:()=>NF,exactEquals:()=>HF,floor:()=>FF,forEach:()=>YF,fromValues:()=>mF,inverse:()=>kF,len:()=>UF,length:()=>_m,lerp:()=>DF,max:()=>_F,min:()=>AF,mul:()=>GF,multiply:()=>gm,negate:()=>MF,normalize:()=>EF,random:()=>CF,rotate:()=>VF,round:()=>vF,scale:()=>SF,scaleAndAdd:()=>TF,set:()=>xF,sqrDist:()=>qF,sqrLen:()=>QF,squaredDistance:()=>Am,squaredLength:()=>vm,str:()=>WF,sub:()=>zF,subtract:()=>xm,transformMat2:()=>BF,transformMat2d:()=>LF,transformMat3:()=>RF,transformMat4:()=>PF,zero:()=>OF});function fm(){var n=new ke(2);return ke!=Float32Array&&(n[0]=0,n[1]=0),n}function hF(n){var e=new ke(2);return e[0]=n[0],e[1]=n[1],e}function mF(n,e){var t=new ke(2);return t[0]=n,t[1]=e,t}function fF(n,e){return n[0]=e[0],n[1]=e[1],n}function xF(n,e,t){return n[0]=e,n[1]=t,n}function gF(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function xm(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}function gm(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n}function wm(n,e,t){return n[0]=e[0]/t[0],n[1]=e[1]/t[1],n}function wF(n,e){return n[0]=Math.ceil(e[0]),n[1]=Math.ceil(e[1]),n}function FF(n,e){return n[0]=Math.floor(e[0]),n[1]=Math.floor(e[1]),n}function AF(n,e,t){return n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n}function _F(n,e,t){return n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n}function vF(n,e){return n[0]=Math.round(e[0]),n[1]=Math.round(e[1]),n}function SF(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n}function TF(n,e,t,o){return n[0]=e[0]+t[0]*o,n[1]=e[1]+t[1]*o,n}function Fm(n,e){var t=e[0]-n[0],o=e[1]-n[1];return Math.hypot(t,o)}function Am(n,e){var t=e[0]-n[0],o=e[1]-n[1];return t*t+o*o}function _m(n){var e=n[0],t=n[1];return Math.hypot(e,t)}function vm(n){var e=n[0],t=n[1];return e*e+t*t}function MF(n,e){return n[0]=-e[0],n[1]=-e[1],n}function kF(n,e){return n[0]=1/e[0],n[1]=1/e[1],n}function EF(n,e){var t=e[0],o=e[1],r=t*t+o*o;return r>0&&(r=1/Math.sqrt(r)),n[0]=e[0]*r,n[1]=e[1]*r,n}function bF(n,e){return n[0]*e[0]+n[1]*e[1]}function yF(n,e,t){var o=e[0]*t[1]-e[1]*t[0];return n[0]=n[1]=0,n[2]=o,n}function DF(n,e,t,o){var r=e[0],i=e[1];return n[0]=r+o*(t[0]-r),n[1]=i+o*(t[1]-i),n}function CF(n,e){e=e||1;var t=on()*2*Math.PI;return n[0]=Math.cos(t)*e,n[1]=Math.sin(t)*e,n}function BF(n,e,t){var o=e[0],r=e[1];return n[0]=t[0]*o+t[2]*r,n[1]=t[1]*o+t[3]*r,n}function LF(n,e,t){var o=e[0],r=e[1];return n[0]=t[0]*o+t[2]*r+t[4],n[1]=t[1]*o+t[3]*r+t[5],n}function RF(n,e,t){var o=e[0],r=e[1];return n[0]=t[0]*o+t[3]*r+t[6],n[1]=t[1]*o+t[4]*r+t[7],n}function PF(n,e,t){var o=e[0],r=e[1];return n[0]=t[0]*o+t[4]*r+t[12],n[1]=t[1]*o+t[5]*r+t[13],n}function VF(n,e,t,o){var r=e[0]-t[0],i=e[1]-t[1],s=Math.sin(o),a=Math.cos(o);return n[0]=r*a-i*s+t[0],n[1]=r*s+i*a+t[1],n}function IF(n,e){var t=n[0],o=n[1],r=e[0],i=e[1],s=Math.sqrt(t*t+o*o)*Math.sqrt(r*r+i*i),a=s&&(t*r+o*i)/s;return Math.acos(Math.min(Math.max(a,-1),1))}function OF(n){return n[0]=0,n[1]=0,n}function WF(n){return"vec2("+n[0]+", "+n[1]+")"}function HF(n,e){return n[0]===e[0]&&n[1]===e[1]}function NF(n,e){var t=n[0],o=n[1],r=e[0],i=e[1];return Math.abs(t-r)<=tt*Math.max(1,Math.abs(t),Math.abs(r))&&Math.abs(o-i)<=tt*Math.max(1,Math.abs(o),Math.abs(i))}var UF=_m,zF=xm,GF=gm,XF=wm,jF=Fm,qF=Am,QF=vm,YF=function(){var n=fm();return function(e,t,o,r,i,s){var a,l;for(t||(t=2),o||(o=0),r?l=Math.min(r*t+o,e.length):l=e.length,a=o;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],i(n,n,s),e[a]=n[0],e[a+1]=n[1];return e}}();var gr=class{constructor(){this.p=Qe.create(),this.q=xr.create(),Object.seal(this)}set(e,t,o,r,i,s,a){this.setPosition(e,t,o),this.setOrientation(r,i,s,a)}setPosition(e,t,o){Qe.set(this.p,e,t,o)}setOrientation(e,t,o,r){xr.set(this.q,e,t,o,r)}copy(e){Qe.copy(this.p,e.p),xr.copy(this.q,e.q)}};var ka=class{constructor(e,t){this.type=e,this.context=t}};var wr=Qe.create(),Fr=Qe.create(),Ar=class extends ka{get listener(){return this.context.listener}readPose(e){let{p:t,q:o}=e;Qe.set(wr,0,0,-1),Qe.transformQuat(wr,wr,o),Qe.set(Fr,0,1,0),Qe.transformQuat(Fr,Fr,o),this.setPosition(t[0],t[1],t[2]),this.setOrientation(wr[0],wr[1],wr[2],Fr[0],Fr[1],Fr[2])}};var Ea=class extends Ar{constructor(e){if(!Mi)throw new Error("Latest WebAudio Listener API is not supported");super("web-audio-listener-new",e),Object.seal(this)}setPosition(e,t,o){let r=this.context.currentTime;this.listener.positionX.setValueAtTime(e,r),this.listener.positionY.setValueAtTime(t,r),this.listener.positionZ.setValueAtTime(o,r)}setOrientation(e,t,o,r,i,s){let a=this.context.currentTime;this.listener.forwardX.setValueAtTime(e,a),this.listener.forwardY.setValueAtTime(t,a),this.listener.forwardZ.setValueAtTime(o,a),this.listener.upX.setValueAtTime(r,a),this.listener.upY.setValueAtTime(i,a),this.listener.upZ.setValueAtTime(s,a)}};var ba=class extends Ar{constructor(e){if(!Oh)throw new Error("WebAudio Listener API is not supported");super("web-audio-listener-old",e),Object.seal(this)}setPosition(e,t,o){this.listener.setPosition(e,t,o)}setOrientation(e,t,o,r,i,s){this.listener.setOrientation(e,t,o,r,i,s)}};var _r=class extends pt{constructor(e,t,o,r,i,s){super(e,t,r,i,s),this.spatialized=o,this._minDistance=1,this._maxDistance=10,this._algorithm="inverse"}get minDistance(){return this._minDistance}get maxDistance(){return this._maxDistance}get algorithm(){return this._algorithm}setAudioProperties(e,t,o){this._minDistance=e,this._maxDistance=t,this._algorithm=o}};var bi=Qe.create(),vr=class extends _r{constructor(e,t){let o=new mr(t,{panningModel:"HRTF",distanceModel:"inverse",coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:0});super(e,t,!0,[o]),this.lpx=0,this.lpy=0,this.lpz=0,this.lqx=0,this.lqy=0,this.lqz=0,this.lqw=0,this.panner=o}setAudioProperties(e,t,o){super.setAudioProperties(e,t,o),this.panner.refDistance=this.minDistance,this.panner.distanceModel=o,o==="linear"?this.panner.rolloffFactor=1:this.maxDistance<=0?this.panner.rolloffFactor=1/0:o==="inverse"?this.panner.rolloffFactor=1/this.maxDistance:this.panner.rolloffFactor=Math.pow(this.maxDistance,-.2)}readPose(e){let{p:t,q:o}=e,[r,i,s]=t,[a,l,p,m]=o;(r!==this.lpx||i!==this.lpy||s!==this.lpz)&&(this.lpx=r,this.lpy=i,this.lpz=s,this.setPosition(r,i,s,this.context.currentTime)),(a!==this.lqx||l!==this.lqy||p!==this.lqz||m!==this.lqw)&&(this.lqx=a,this.lqy=l,this.lqz=p,this.lqw=m,Qe.transformQuat(bi,Qe.set(bi,0,0,-1),o),this.setOrientation(bi[0],bi[1],bi[2],this.context.currentTime))}getGainAtDistance(e){let{rolloffFactor:t,refDistance:o,maxDistance:r,distanceModel:i}=this.panner;if(e<=o)return 1;{let s=e-o,a=r-o;if(i==="linear")return 1-t*s/a;if(i==="inverse")return o/(o+t*s);if(i==="exponential")return Math.pow(e/o,-t);mn(i)}}};var ya=class extends vr{constructor(e){super("web-audio-panner-new",e),Object.seal(this)}setPosition(e,t,o,r){ut(e)&&ut(t)&&ut(o)&&(Os(r)&&(r=0),this.panner.positionX.setValueAtTime(e,r),this.panner.positionY.setValueAtTime(t,r),this.panner.positionZ.setValueAtTime(o,r))}setOrientation(e,t,o,r){ut(e)&&ut(t)&&ut(o)&&(Os(r)&&(r=0),this.panner.orientationX.setValueAtTime(-e,r),this.panner.orientationY.setValueAtTime(-t,r),this.panner.orientationZ.setValueAtTime(-o,r))}};var Da=class extends vr{constructor(e){super("web-audio-panner-old",e),Object.seal(this)}setPosition(e,t,o){this.panner.setPosition(e,t,o)}setOrientation(e,t,o){this.panner.setOrientation(e,t,o)}};var Ca=class extends pt{get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}constructor(e){let t=Mi?new Ea(e):new ba(e),o=new bt(e);o.name="remote-user-input";let r=new bt(e);r.name="spatialized-input";let i=new bt(e);i.name="non-spatialized-input";let s=new Ln(e),a=new ve,l=Zt(zs("Audio-Device-Manager"),$e("none"),fn(!0),It(!0),fi(s.stream),bh(()=>a.resolve()));en(()=>l.play()),super("web-audio-destination",e,[i,r,o],[],[s]),this.pose=new gr,this._ready=a,this.listener=t,this.remoteUserInput=o,this.spatializedInput=r,this.nonSpatializedInput=i,this.volumeControl=i,this.destination=s,this.audioElement=l,o.connect(r).connect(this.volumeControl).connect(s)}createSpatializer(e){let t=e?this.remoteUserInput:this.spatializedInput,o=Mi?new ya(this.context):new Da(this.context);return o.connect(t),o}setPosition(e,t,o){this.pose.setPosition(e,t,o),this.listener.readPose(this.pose)}setOrientation(e,t,o,r){this.pose.setOrientation(e,t,o,r),this.listener.readPose(this.pose)}set(e,t,o,r,i,s,a){this.pose.set(e,t,o,r,i,s,a),this.listener.readPose(this.pose)}get stream(){return this.destination.stream}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}};var xu=class extends pt{constructor(e){let t=new nn(e,{type:"bandpass",frequency:2500,Q:4.5}),o=new bt(e,{gain:10});t.connect(o),super("radio-effect",e,[t],[o])}};function Sm(n,e){let t=new xu(e);return t.name=`${n}-radio-effect`,t}function Tm(n,e){let t=new nn(e,{type:"bandpass",frequency:400,Q:4.5});return t.name=`${n}-wall-effect`,t}var Mm=new Map([["Radio",Sm],["Wall",Tm]]);var rn=class extends pt{constructor(e,t,o,r,i){let s=new bt(t);s.name="volume-control",i=i||[],super(e,t,[],[o],i),this.spatializer=o,this.effects=new Array,this.pose=new gr,this.volumeControl=s,this.setEffects(...r)}onDisposing(){pe(this.effects),super.onDisposing()}setEffects(...e){this.disable();for(let o of this.effects)this.remove(o),Re(o);pe(this.effects);let t=this.volumeControl;for(let o of e)if(w(o)){let r=Mm.get(o);if(w(r)){let i=r(o,this.context);this.add(i),this.effects.push(i),t=t.connect(i)}}this.enable()}get spatialized(){return this.spatializer.spatialized}get lastInternal(){return this.effects[this.effects.length-1]||this.volumeControl}enable(){this.lastInternal.isConnected()||this.lastInternal.connect(this.spatializer)}disable(){this.lastInternal.isConnected()&&this.lastInternal.disconnect()}tog(){this.lastInternal.isConnected()?this.disable():this.enable()}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}get minDistance(){return w(this.spatializer)?this.spatializer.minDistance:null}get maxDistance(){return w(this.spatializer)?this.spatializer.maxDistance:null}get algorithm(){return w(this.spatializer)?this.spatializer.algorithm:null}setPosition(e,t,o){w(this.spatializer)&&(this.pose.setPosition(e,t,o),this.spatializer.readPose(this.pose))}setOrientation(e,t,o,r){w(this.spatializer)&&(this.pose.setOrientation(e,t,o,r),this.spatializer.readPose(this.pose))}set(e,t,o,r,i,s,a){w(this.spatializer)&&(this.pose.set(e,t,o,r,i,s,a),this.spatializer.readPose(this.pose))}setAudioProperties(e,t,o){w(this.spatializer)&&this.spatializer.setAudioProperties(e,t,o)}};var sn=class extends N{constructor(e,t){super(e),this.source=t}},Pn=class extends sn{constructor(e){super("loaded",e)}},Ba=class extends sn{constructor(e,t){super("errored",e),this.error=t}},Vn=class extends sn{constructor(e){super("played",e)}},In=class extends sn{constructor(e){super("paused",e)}},On=class extends sn{constructor(e){super("stopped",e)}},Wn=class extends sn{constructor(e){super("progress",e),this.value=0,this.total=0}};var KF=new N("disposing"),La=class extends rn{constructor(e,t,o,r,i,...s){super("audio-element-source",e,i,s),t.connect(this.volumeControl),this.audio=t.mediaElement,this.disable(),this.loadEvt=new Pn(this),this.playEvt=new Vn(this),this.pauseEvt=new In(this),this.stopEvt=new On(this),this.progEvt=new Wn(this);let a=l=>{this.audio.currentTime===0||l.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};this.audio.addEventListener("ended",a),this.audio.addEventListener("pause",a),o&&this.audio.addEventListener("play",()=>{if(this.audio.loop&&this.audio.duration>1){let l=this.audio.duration*Math.random();this.audio.currentTime=l}}),r&&(t.mediaElement.preservesPitch=!1,this.audio.addEventListener("play",()=>{t.mediaElement.playbackRate=1+.1*(2*Math.random()-1)})),this.audio.addEventListener("play",()=>{this.dispatchEvent(this.playEvt)}),this.audio.addEventListener("timeupdate",()=>{this.progEvt.value=this.audio.currentTime,this.progEvt.total=this.audio.duration,this.dispatchEvent(this.progEvt)}),this.audio.autoplay&&this.play().catch(()=>en(()=>this.play())),wh(this.audio).then(l=>this.dispatchEvent(l?this.loadEvt:new Ba(this,this.audio.error)))}onDisposing(){this.dispatchEvent(KF),super.onDisposing()}get playbackState(){return this.audio.error?"errored":this.audio.ended||this.audio.paused&&this.audio.currentTime===0?"stopped":this.audio.paused?"paused":"playing"}async play(){this.enable(),await this.context.ready,await this.audio.play()}async playThrough(){let e=Jt(this,"stopped");await this.play(),await e}pause(){this.disable(),this.audio.pause()}stop(){this.audio.currentTime=0,this.pause()}restart(){return this.stop(),this.play()}};var gu=class extends N{constructor(e){super("sourceadded"),this.source=e}},Ra=class extends rn{constructor(e,t,...o){super("audio-stream-source",e,t,o),this._stream=null,this._node=null}get stream(){return this._stream}set stream(e){e!==this.stream&&(w(this.stream)&&(this.remove(this._node),Re(this._node),this._node=null),w(e)&&(this._node=new Rn(this.context,{mediaStream:e}),this._node.name=lr("media-stream-source",e.id),this._node.connect(this.volumeControl),this.add(this._node),this.dispatchEvent(new gu(this))))}};var Pa=class extends _r{constructor(e){super("no-spatializer",e.context,!1,[e],[e])}readPose(e){}getGainAtDistance(e){return 1}};var km="juniper::useHeadphones",JF=new N("useheadphonestoggled"),Em=10,Sr=new N("released"),bm="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",Va=class extends pt{get algorithm(){return this._algorithm}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}constructor(e,t){let o=new _a;"THREE"in globalThis&&globalThis.THREE.AudioContext.setContext(o);let r=new Ca(o),i=new Pa(r.nonSpatializedInput),s=new sa(r.audioElement);super("audio-manager",o,null,null,[i,r]),this.fetcher=e,this.users=new Map,this.clips=new Map,this.pendingAudio=new Array,this.audioPool=new Array,this.elements=new Map,this.elementCounts=new Map,this._minDistance=.25,this._maxDistance=100,this._algorithm="inverse",this._useHeadphones=!1,this.destination=null,this._ready=new ve,this.localUserID=null,this.destination=r,this.noSpatializer=i,this.speakers=s,Bn(this.context.ready,this.destination.ready,this.speakers.ready).then(()=>this._ready.resolve()),this.setLocalUserID(t);let a=localStorage.getItem(km);w(a)?this._useHeadphones=a==="true":this._useHeadphones=wn(),this.enpool(),ar()&&en(()=>{let l=[...this.pendingAudio];pe(this.pendingAudio);for(let p of l)p()},!0),Object.seal(this)}enpool(){for(let e=0;e<Em;++e){let t=new ve,o=Zt(Ao(bm),It(!1),yh(()=>{o.pause(),o.src=bm}));this.audioPool.push(t),ar()?this.pendingAudio.push(()=>{o.play(),t.resolve(o)}):t.resolve(o)}}preparePool(e){for(;this.audioPool.length<e;)this.enpool()}async getPooledAudio(...e){if(this.audioPool.length===0)throw new Error("Audio pool exhausted!");let t=this.audioPool.shift();this.audioPool.length<=Em/2&&this.enpool();let o=await t;return o.pause(),te(o,...e),o}async getPooledSource(e,t,o){if(!this.elements.has(e)){let i=await this.getPooledAudio(Ao(t),Dn(o&&!ar()));ar()&&o&&i.addEventListener("ended",()=>i.play());let s=new Wt(this.context,{mediaElement:i});s.name=lr("media-element-source",e),this.elements.set(e,s),this.elementCounts.set(e,0)}let r=this.elements.get(e);return this.elementCounts.set(e,this.elementCounts.get(e)+1),r}releasePooledSource(e){let t=this.elements.get(e);this.elementCounts.set(e,this.elementCounts.get(e)-1),this.elementCounts.get(e)===0&&(t.mediaElement.dispatchEvent(Sr),this.elementCounts.delete(e),this.elements.delete(e))}get useHeadphones(){return this._useHeadphones}set useHeadphones(e){e!==this.useHeadphones&&(this._useHeadphones=e,localStorage.setItem(km,this.useHeadphones.toString()),this.dispatchEvent(JF))}onDisposing(){this.context.suspend();for(let e of this.users.keys())this.removeUser(e);for(let e of this.clips.keys())this.removeClip(e);super.onDisposing()}get currentTime(){return this.context.currentTime}createSpatializer(e,t){if(e){let o=this.destination.createSpatializer(t);return o.setAudioProperties(this._minDistance,this._maxDistance,this._algorithm),o}else return this.noSpatializer}createUser(e,t){if(!this.users.has(e)){let o=new Ra(this.context,this.createSpatializer(!0,!0));o.name=lr(t,e),this.users.set(e,o)}return this.users.get(e)}setLocalUserID(e){return this.destination&&(this.localUserID=e),this.destination}createBasicClip(e,t,o){return this.createClip(e,t,!1,!1,!1,!0,o,[])}hasClip(e){return this.clips.has(e)}async createClip(e,t,o,r,i,s,a,l,p){await this.ready;let m,x;oe(t)?(m=t,x=await this.fetcher.get(t).progress(p).file().then(ko)):(m=t.path,x=t.result);let F=await this.getPooledSource(m,x,o),v=new La(this.context,F,i,s,this.createSpatializer(r,!1),...l);return v.addEventListener("disposing",()=>this.releasePooledSource(m)),v.name=lr("audio-clip-element",e),v.volume=a,this.clips.set(e,v),v}async playClip(e){this.hasClip(e)&&await this.clips.get(e).play()}async playClipThrough(e){this.hasClip(e)&&await this.clips.get(e).playThrough()}stopClip(e){this.hasClip(e)&&this.clips.get(e).stop()}getUser(e){return this.users.get(e)}getClip(e){return this.clips.get(e)}removeSource(e,t){let o=e.get(t);return w(o)&&(e.delete(t),Re(o)),o}removeUser(e){let t=this.removeSource(this.users,e);w(t.stream)&&(t.stream=null)}removeClip(e){let t=this.removeSource(this.clips,e);return Re(t),t}setUserStream(e,t){if(this.users.has(e)){let o=this.users.get(e);o.stream=t}}setAudioProperties(e,t,o){this._minDistance=e,this._maxDistance=t,this._algorithm=o;for(let r of this.users.values())r.setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let r of this.clips.values())r.setAudioProperties(r.minDistance,r.maxDistance,this.algorithm)}withPoser(e,t,o){let i=e.get(t)||this.destination;return o(i)}withUser(e,t){return this.withPoser(this.users,e,t)}withClip(e,t){return this.withPoser(this.clips,e,t)}setUserPose(e,t,o,r,i,s,a,l){this.withUser(e,p=>{p.set(t,o,r,i,s,a,l)})}setUserPosition(e,t,o,r){this.withUser(e,i=>{i.setPosition(t,o,r)})}setUserOrientation(e,t,o,r,i){this.withUser(e,s=>{s.setOrientation(t,o,r,i)})}setClipPose(e,t,o,r,i,s,a,l){this.withClip(e,p=>{p.set(t,o,r,i,s,a,l)})}setClipPosition(e,t,o,r){this.withClip(e,i=>{i.setPosition(t,o,r)})}setClipOrientation(e,t,o,r,i){this.withClip(e,s=>{s.setOrientation(t,o,r,i)})}};var Tr=class extends N{constructor(e,t){super("streamchanged"),this.oldStream=e,this.newStream=t}};var ym="calla:preferredAudioInputID",Ia=class extends pt{constructor(e){let t=e.createGain();t.name="local-mic-user-gain";let o=e.createGain();o.name="local-mic-auto-gain";let r=new nn(e,{type:"bandpass",frequency:1500,Q:.25});r.name="local-mic-filter";let i=new hr(e,{threshold:-15,knee:40,ratio:17});i.name="local-mic-compressor";let s=new Ln(e);s.name="local-mic-destination",super("local-user-microphone",e,[],[i],[t,r,s]),this.localStreamNode=null,this._hasPermission=!1,this._usingHeadphones=!1,this._device=null,this._enabled=!1,this.volume=t,this.autoGainNode=o,this.compressor=i,this.output=s,t.connect(o).connect(r).connect(i).connect(s),Object.seal(this)}get mediaType(){return"audio"}get deviceKind(){return`${this.mediaType}input`}get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.onChange())}get hasPermission(){return this._hasPermission}get preferredDeviceID(){return localStorage.getItem(ym)}get device(){return this._device}async setDevice(e){if(w(e)&&e.kind!==this.deviceKind)throw new Error(`Device is not an audio input device. Was: ${e.kind}. Label: ${e.label}`);let t=this.device&&this.device.deviceId||null,o=e&&e.deviceId||null;o!==t&&(this._device=e,localStorage.setItem(ym,o),this.onChange())}get inStream(){return this.localStreamNode&&this.localStreamNode.mediaStream||null}set inStream(e){e!==this.inStream&&(this.localStreamNode&&(this.remove(this.localStreamNode),Re(this.localStreamNode),this.localStreamNode=null),e&&(this.localStreamNode=new Rn(this.context,{mediaStream:e}),this.add(this.localStreamNode),this.localStreamNode.connect(this.volume)))}get outStream(){return this.output.stream}get gain(){return this.volume.gain}get muted(){return this.compressor.isConnected(this.output)}set muted(e){e!==this.muted&&(e?this.compressor.connect(this.output):this.compressor.disconnect(this.output))}get usingHeadphones(){return this._usingHeadphones}set usingHeadphones(e){e!==this.usingHeadphones&&(this._usingHeadphones=e,this.onChange())}async onChange(){this.dispatchEvent(new pr);let e=this.inStream;this.device&&this.enabled?this.inStream=await navigator.mediaDevices.getUserMedia({audio:{deviceId:this.device.deviceId,echoCancellation:!this.usingHeadphones,autoGainControl:!0,noiseSuppression:!0}}):this.inStream=null,this.inStream!==e&&this.dispatchEvent(new Tr(e,this.outStream))}};function wu(n){return w(n)&&n.length>0?parseFloat(n):null}var Mr=class{constructor(e,t){this._url=null,this._base=void 0,this._protocol=null,this._host=null,this._hostName=null,this._userName=null,this._password=null,this._port=null,this._pathName=null,this._hash=null,this._query=new Map,e!==void 0&&(this._url=new URL(e,t),this.rehydrate())}rehydrate(){w(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),w(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),w(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),w(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),w(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),w(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),w(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),w(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[e,t]of this._query)this._url.searchParams.set(e,t);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=wu(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((e,t)=>this._query.set(t,e))}refresh(){if(this._url===null){if(w(this._protocol)&&(w(this._host)||w(this._hostName))){if(w(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=wu(this._url.port),this.rehydrate(),!1;if(w(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(w(this._pathName)&&w(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return w(this._url)}base(e){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=e,this.refresh(),this}protocol(e){return this._protocol=e,this.refresh()&&(this._url.protocol=e),this}host(e){return this._host=e,this.refresh()&&(this._url.host=e,this._hostName=this._url.hostname,this._port=wu(this._url.port)),this}hostName(e){return this._hostName=e,this.refresh()&&(this._url.hostname=e,this._host=`${this._url.hostname}:${this._url.port}`),this}port(e){return this._port=e,this.refresh()&&(this._url.port=e.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(e){return this._userName=e,this.refresh()&&(this._url.username=e),this}password(e){return this._password=e,this.refresh()&&(this._url.password=e),this}path(e){return this._pathName=e,this.refresh()&&(this._url.pathname=e),this}pathPop(e){return e=e||/\/[^/]+\/?$/,this.path(this._pathName.replace(e,""))}pathPush(e){let t=this._pathName;return t.endsWith("/")||(t+="/"),t+=e,this.path(t)}query(e,t){return this._query.set(e,t),this.refresh()&&this._url.searchParams.set(e,t),this}hash(e){return this._hash=e,this.refresh()&&(this._url.hash=e),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};var Oa=Qt("descending",n=>n.resolution);var Fu=class extends sn{constructor(e,t){super(e,t)}},kr=class extends Fu{constructor(e){super("loading",e)}};var Wa=class extends rn{get data(){return this._data}get loaded(){return this._loaded}get title(){return this.audioElement.title}setTitle(e){this.audioElement.title=e}constructor(e,t){let o=Zt(fn(!1),Dn(!1),It(!0)),r=new Wt(e,{mediaElement:o});r.name="JuniperAudioPlayer-Input",super("audio-player",e,t,[],[r]),this.cacheBustSources=new Map,this._data=null,this._loaded=!1,this.sourcesByURL=new Map,this.sources=new Array,this.potatoes=new Array,r.connect(this.volumeControl),this.audioElement=o,this.loadingEvt=new kr(this),this.loadEvt=new Pn(this),this.playEvt=new Vn(this),this.pauseEvt=new In(this),this.stopEvt=new On(this),this.progEvt=new Wn(this),this.onPlay=async()=>{this.enable(),this.dispatchEvent(this.playEvt)},this.onPause=i=>{this.disable(),this.audioElement.currentTime===0||i.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)},this.onTimeUpdate=async()=>{this.progEvt.value=this.audioElement.currentTime,this.progEvt.total=this.audioElement.duration,this.dispatchEvent(this.progEvt)},this.onError=()=>this.loadAudio(),this.audioElement.addEventListener("play",this.onPlay),this.audioElement.addEventListener("pause",this.onPause),this.audioElement.addEventListener("ended",this.onPause),this.audioElement.addEventListener("error",this.onError),this.audioElement.addEventListener("waiting",this.onWaiting),this.audioElement.addEventListener("canplay",this.onCanPlay),this.audioElement.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{audioPlayer:this})}get hasAudio(){let e=this.sourcesByURL.get(this.audioElement.src);return w(e)&&e.acodec!=="none"||w(this.audioElement.audioTracks)&&this.audioElement.audioTracks.length>0||w(this.audioElement.webkitAudioDecodedByteCount)&&this.audioElement.webkitAudioDecodedByteCount>0||w(this.audioElement.mozHasAudio)&&this.audioElement.mozHasAudio}onDisposing(){super.onDisposing(),this.clear(),this.audioElement.removeEventListener("play",this.onPlay),this.audioElement.removeEventListener("pause",this.onPause),this.audioElement.removeEventListener("ended",this.onPause),this.audioElement.removeEventListener("error",this.onError),this.audioElement.removeEventListener("waiting",this.onWaiting),this.audioElement.removeEventListener("canplay",this.onCanPlay),this.audioElement.removeEventListener("timeupdate",this.onTimeUpdate),this.audioElement.dispatchEvent(Sr)}clear(){this.stop(),this.sourcesByURL.clear(),pe(this.sources),pe(this.potatoes),this.audioElement.src="",this._data=null,this._loaded=!1}cacheBust(e){let t=this.cacheBustSources.get(e)||0;this.cacheBustSources.set(e,t+1)}async load(e,t){this.clear(),this._data=e,oe(e)?(this.setTitle(e),this.potatoes.push(e)):(this.setTitle(e.title),e.audios.sort(Oa),Vd(this.sources,...e.audios));for(let o of this.sources)this.sourcesByURL.set(o.url,o);if(!this.hasSources)throw new Error("No audio sources");if(this.dispatchEvent(this.loadingEvt),await this.loadAudio(t),!this.hasSources)throw new Error("No audio sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}async getMediaCapabilities(e){let t={type:"file",audio:{contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr}};try{return await navigator.mediaCapabilities.decodingInfo(t)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:t}}}get hasSources(){return this.sources.length>0||this.potatoes.length>0}async loadAudio(e){for(w(e)&&e.start(),this.audioElement.removeEventListener("error",this.onError);this.hasSources;){let t=null,o=this.sources.shift();if(w(o)){let i=await this.getMediaCapabilities(o);if(!i.smooth||!i.powerEfficient){this.potatoes.push(o.url);continue}else t=o.url}else t=this.potatoes.shift();let r=this.cacheBustSources.get(this.data);if(w(r)){let i=new Mr(t,location.href);i.query("v",r.toString()),t=i.toString()}if(this.audioElement.src=t,this.audioElement.load(),await Ys(this.audioElement)){w(o)?this.sources.unshift(o):this.potatoes.unshift(t),this.audioElement.addEventListener("error",this.onError),w(e)&&e.end();return}}}get playbackState(){return B(this.data)?"empty":this.loaded?this.audioElement.error?"errored":this.audioElement.ended||this.audioElement.paused&&this.audioElement.currentTime===0?"stopped":this.audioElement.paused?"paused":"playing":"loading"}async play(){await this.context.ready,await this.audioElement.play()}async playThrough(){let e=Jt(this,"stopped");await this.play(),await e}pause(){this.audioElement.pause()}stop(){this.pause(),this.audioElement.currentTime=0}restart(){return this.stop(),this.play()}get element(){return this.audioElement}};var yi="HTMLCanvasElement"in globalThis,iE="HTMLImageElement"in globalThis,Dm=!1,Au=!Dm&&"OffscreenCanvas"in globalThis,ZF=!Dm&&"createImageBitmap"in globalThis;function an(n){return yi&&n instanceof HTMLCanvasElement}function _u(n){return Au&&n instanceof OffscreenCanvas}function Cm(n){return ZF&&n instanceof ImageBitmap}function Bm(n){return n instanceof ImageData}function $F(n){return an(n)||_u(n)}function Lm(n,e){let t=n.getContext("2d");if(B(t))throw new Error("Could not create 2d context for canvas");t.drawImage(e,0,0)}function Rm(n,e){let t=n.getContext("2d");if(B(t))throw new Error("Could not create 2d context for canvas");t.putImageData(e,0,0)}function e0(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var vu=Au&&e0(),Er=vu&&Su||yi&&Na||null,Ha=yi?Na:Er;function t0(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var sE=Au&&t0();function Su(n,e){return new OffscreenCanvas(n,e)}function Na(n,e){return Js(Ud(n),Hd(e))}function n0(n){let e=Su(n.width,n.height);return Lm(e,n),e}function o0(n){let e=Na(n.width,n.height);return Lm(e,n),e}var Pm=vu&&n0||yi&&o0||null;function r0(n){let e=Su(n.width,n.height);return Rm(e,n),e}function i0(n){let e=Na(n.width,n.height);return Rm(e,n),e}var Vm=vu&&r0||yi&&i0||null;function Im(n,e,t,o=1){return e=Math.floor(e*o),t=Math.floor(t*o),n.width!=e||n.height!=t?(n.width=e,n.height=t,!0):!1}function s0(n){return w(n.textBaseline)}function a0(n,e,t,o=1){let r=n.imageSmoothingEnabled,i=n.textBaseline,s=n.textAlign,a=n.font,l=Im(n.canvas,e,t,o);return l&&(n.imageSmoothingEnabled=r,n.textBaseline=i,n.textAlign=s,n.font=a),l}function Ua(n,e,t,o=1){return s0(n)?a0(n,e,t,o):Im(n.canvas,e,t,o)}function Om(n,e=1){return Ua(n,n.canvas.clientWidth,n.canvas.clientHeight,e)}function Hn(n){$F(n)?n.width=n.height=0:Re(n)}function Di(n){return w(n)&&ee(n.then)&&ee(n.catch)&&ee(n.finally)&&ee(n.fetch)&&ee(n.getSize)}var Tu=class{get result(){if(w(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}constructor(e,t){this.path=e,this.type=t,this._result=null,this._error=null,this._started=!1,this._finished=!1,this.resolve=null,this.reject=null,this.promise=new Promise((o,r)=>{this.resolve=i=>{this._result=i,this._finished=!0,o(i)},this.reject=i=>{this._error=i,this._finished=!0,r(i)}})}async getSize(e){try{let{contentLength:t}=await e.head(this.path).accept(this.type).exec();return[this,t||1]}catch(t){return console.warn(t),[this,1]}}async fetch(e,t){try{let o=await this.getResult(e,t);this.resolve(o)}catch(o){this.reject(o)}}get[Symbol.toStringTag](){return this.promise.toString()}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}};var br=class extends Tu{constructor(e,t,o){let r;jt(t)?o=t:r=t,super(e,r),this.useCache=!!o}getResult(e,t){return this.getRequest(e,t).then(ko)}getRequest(e,t){let o=e.get(this.path).useCache(this.useCache).progress(t);return this.getResponse(o)}};var Ht=class extends br{getResponse(e){return e.file(this.type)}},za=class extends br{getResponse(e){return e.image(this.type)}};var Ee=Math.PI,ht=.5*Ee,dt=2*Ee;var c0=864e13,fE=-c0;function Nn(n){return(n%dt+dt)%dt}function Un(n,e,t){return Math.min(t,Math.max(e,n))}function nt(n){return n*dt/360}function Ci(n){return n*360/dt}function Wm(...n){let e=Number.MAX_VALUE;for(let t of n)Math.abs(t)<e&&(e=t);return e}function Hm(n,e,t){return(1-t)*n+t*e}function Mu(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function Nm(n){return Math.abs(n)>1e-4?n:0}var zn=class extends re{constructor(e,t,o){super(),this._scale=250,this._visible=!0,this.wasVisible=null,this.redrawnEvt=new N("redrawn"),w(o)&&w(o.scale)&&(this._scale=o.scale),this._canvas=Ha(e,t),this._g=this.canvas.getContext("2d")}fillRect(e,t,o,r,i,s){this.g.fillStyle=e,this.g.fillRect(t+s,o+s,r-2*s,i-2*s)}drawText(e,t,o,r){this.g.textAlign=r,this.g.strokeText(e,t,o),this.g.fillText(e,t,o)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}onClear(){this.g.clearRect(0,0,this.canvas.width,this.canvas.height)}clear(){this.onClear(),this.dispatchEvent(this.redrawnEvt)}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(e){this.scale!==e&&(this._scale=e,this.redraw())}get visible(){return this._visible}set visible(e){this.visible!==e&&(this.wasVisible=this._visible,this._visible=e,this.redraw())}};var Ga=class extends zn{constructor(){super(128,128),this._pitchDegrees=0,this._headingDegrees=0,this.redraw()}get pitchDegrees(){return this._pitchDegrees}set pitchDegrees(e){e!==this.pitchDegrees&&(this._pitchDegrees=e,this.redraw())}get headingDegrees(){return this._headingDegrees}set headingDegrees(e){e!==this.headingDegrees&&(this._headingDegrees=e,this.redraw())}setPitchAndHeading(e,t){(e!==this.pitchDegrees||t!==this.headingDegrees)&&(this._pitchDegrees=e,this._headingDegrees=t,this.redraw())}onRedraw(){let e=nt(this.pitchDegrees),t=nt(this.headingDegrees-180),o=5,r=this.canvas.width-2*o,i=this.canvas.height-2*o,s=.5*r,a=.5*i,l=Math.sin(e),p=this.g;return p.save(),p.clearRect(0,0,this.canvas.width,this.canvas.height),p.translate(o,o),p.scale(s,a),p.translate(1,1),p.fillStyle="gray",p.beginPath(),p.arc(0,0,1,0,dt),p.fill(),p.fillStyle="lightgrey",p.beginPath(),p.arc(0,0,1,0,Ee,!0),p.fill(),p.save(),p.scale(1,Math.abs(l)),l<0&&(p.fillStyle="gray"),p.beginPath(),p.arc(0,0,1,0,Ee,l<0),p.fill(),p.restore(),p.save(),p.shadowColor=Ot(64,64,64),p.shadowBlur=4,p.shadowOffsetX=3,p.shadowOffsetY=3,p.rotate(t),p.fillStyle="red",p.beginPath(),p.moveTo(-.1,0),p.lineTo(0,-.667),p.lineTo(.1,0),p.closePath(),p.fill(),p.fillStyle="white",p.beginPath(),p.moveTo(-.1,0),p.lineTo(0,.667),p.lineTo(.1,0),p.closePath(),p.fill(),p.restore(),p.beginPath(),p.strokeStyle="black",p.lineWidth=.1,p.arc(0,0,1,0,dt),p.stroke(),p.restore(),!0}};function Xa(n,e,t){return new Map(n.map(o=>[e(o),t(o)]))}function Um(n,e){return Xa(n,Yt,e)}var Bi=class extends N{constructor(){super("update"),this.t=0,this.dt=0,this.sdt=0,this.fps=0}set(e,t){this.t=e,this.dt=t,this.sdt=Hm(this.sdt,t,.01),t>0&&(this.fps=1e3/t)}},ja=class extends Bi{constructor(){super(),Object.seal(this)}};var yr=class{constructor(e){this.timer=null,this.lt=-1,this.tickHandlers=new Array,this._targetFPS=null,this.targetFPS=e;let t=new ja,o=0;this.onTick=r=>{this.lt>=0&&(o=r-this.lt,t.set(r,o),this.tick(t)),this.lt=r}}get targetFPS(){return this._targetFPS}set targetFPS(e){this._targetFPS=e}addTickHandler(e){this.tickHandlers.push(e)}removeTickHandler(e){je(this.tickHandlers,e)}tick(e){for(let t of this.tickHandlers)t(e)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};var qa=class extends yr{constructor(){super()}start(){if(!this.isRunning){let e=t=>{this.timer=requestAnimationFrame(e),this.onTick(t)};this.timer=requestAnimationFrame(e)}}stop(){this.isRunning&&(cancelAnimationFrame(this.timer),super.stop())}};var Gn=class{constructor(e){this.task=new ve(!1),this.element=fe(ue("dialog"),$e("none"),Us("dialogname",e),this.container=fe(ue("dialog-container"),this.titleElement=vh(ue("title-bar"),e),this.contentArea=fe(ue("dialog-content")),fe(ue("dialog-controls"),this.confirmButton=nr("Confirm",ue("confirm-button")),this.cancelButton=Ks("Cancel",ue("cancel-button"))))),this.confirmButton.addEventListener("click",this.task.resolver(!0)),this.cancelButton.addEventListener("click",this.task.resolver(!1)),te(document.body,this)}get title(){return this._title}set title(e){Qs(this.titleElement,this._title=e)}async onShowing(){}onShown(){}async onConfirm(){}onCancel(){}async onClosing(){}onClosed(){}show(e){qe(this,e)}get isOpen(){return Et(this)}hide(){this.show(!1)}async toggle(){this.isOpen?this.hide():this.showDialog()}async showDialog(){return await this.onShowing(),this.show(!0),this.onShown(),this.task.restart(),await this.task?await this.onConfirm():this.onCancel(),await this.onClosing(),this.show(!1),this.onClosed(),this.task.result}};var Dt=20,Qa=Dt/2,yt=xe.create();function zm(n,e){return n<0?0:n>e?e:Number.isFinite(n)?n:(console.trace("To infinity... and beyond!"),e)}var Ya=class extends Gn{get w(){return this.canvas.width-2*Dt-200}get h(){return this.canvas.height-2*Dt}constructor(e,t,o,r){super(e),this.getNodeName=t,this.getNodeColor=o,this.getWeightMod=r,this.timer=new qa,this.positions=new Map,this.forces=new Map,this.wasGrabbed=new Set,this.mousePoint=xe.create(),this.grabbed=null,this.graph=null,this.cancelButton.style.display="none";let i=At(5);te(this.container,Mo(Cn(100)),ih(Cn(100))),te(this.contentArea,fe($e("grid"),rh("repeat(11, auto)",Kd(1)),eh(js(5)),Zd("center"),...rr("limit"+i,"Limit",this.t=ir(Fo(0),wo(1e3),_o(.1),Kt(5))),...rr("cooling"+i,"Cooling",this.cooling=_i()),...rr("attract"+i,"Attract",this.attract=ir(Fo(-100),wo(100),_o(.1),Kt(1))),...rr("repel"+i,"Repel",this.repel=ir(Fo(-100),wo(100),_o(.1),Kt(1))),...rr("hideBare"+i,"Hide bare nodes",this.hideBare=_i(Ns(!0)))),this.canvas=Js($e("block"),Mo(Cn(100)),ah("calc(100% - 2em)"))),this.g=this.canvas.getContext("2d"),this.g.textAlign="center",this.g.textBaseline="middle",this.timer.addTickHandler(()=>{this.fr91(),this.draw()}),new ResizeObserver(()=>{Om(this.g)}).observe(this.canvas);let a=xe.create();this.canvas.addEventListener("mousedown",l=>{this.setMouse(l),this.grabbed=null;let p=.7071067811865475*Dt;for(let m of this.graph){let x=this.positions.get(m);xe.sub(a,x,this.mousePoint);let F=xe.length(a);F<p&&(this.grabbed=m,this.wasGrabbed.has(m)?this.wasGrabbed.delete(m):this.wasGrabbed.add(m),p=F)}}),this.canvas.addEventListener("mousemove",l=>{this.setMouse(l)}),this.canvas.addEventListener("mouseup",()=>{this.grabbed=null})}setMouse(e){let t=e.offsetX*this.canvas.width/this.canvas.clientWidth-Dt,o=e.offsetY*this.canvas.height/this.canvas.clientHeight-Dt;xe.set(this.mousePoint,t,o)}draw(){this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.g.fillStyle="black",this.g.strokeStyle="black",this.g.save(),this.g.translate(Dt,Dt);for(let e of this.graph){let t=this.positions.get(e);for(let o of e.connections){let r=this.positions.get(o);this.g.beginPath(),this.g.moveTo(t[0],t[1]),this.g.lineTo(r[0],r[1]),this.g.stroke()}}this.g.strokeStyle="lightgrey",this.g.save(),this.g.translate(-Qa,-Qa);for(let e of this.graph)if(e.isConnected||!this.hideBare.checked){this.g.fillStyle=Ot(243,243,243);let t=this.positions.get(e);this.g.fillStyle=this.getNodeColor(e.value),this.g.fillRect(t[0],t[1],Dt,Dt),this.g.strokeRect(t[0],t[1],Dt,Dt),this.g.fillStyle="black",this.g.fillText(this.getNodeName(e.value),t[0]+Qa,t[1]+Qa)}this.g.restore(),this.g.restore()}applyForces(e,t){let o=Um(this.graph,()=>xe.create());for(let r of this.graph){let i=this.positions.get(r);if(r===this.grabbed)xe.copy(i,this.mousePoint);else if(!this.wasGrabbed.has(r)){let s=o.get(r),a=this.forces.get(r);a&&xe.add(s,s,a),xe.set(yt,this.w,this.h),xe.scaleAndAdd(yt,i,yt,-.5);let l=xe.length(yt);if(l>0){xe.normalize(yt,yt);let p=-1e4*l;p=Math.sign(p)*Math.pow(Math.abs(p),.2),xe.scaleAndAdd(s,s,yt,p)}for(let p of this.graph)if(r!==p){let m=this.positions.get(p);xe.sub(yt,m,i);let x=xe.length(yt);if(x>0){xe.normalize(yt,yt);let F=r.isConnectedTo(p),v=this.getWeightMod(r.value,p.value,F),k=2-v,D=v*this.attract.valueAsNumber*e(F,x)-k*this.repel.valueAsNumber*t(F,x);xe.scaleAndAdd(s,s,yt,D)}}}}for(let r of this.graph){let i=o.get(r);i[1]*=this.h/this.w;let s=xe.length(i);if(s>0){xe.scale(i,i,Math.min(this.t.valueAsNumber,s)/s);let a=this.positions.get(r);xe.add(a,a,i),a[0]=zm(a[0],this.w),a[1]=zm(a[1],this.h)}}this.cooling.checked&&(this.t.valueAsNumber*=.975)}fr91(){let e=this.w*this.h*.1,t=1,o=1.5,r=.1,i=t*Math.sqrt(e/this.graph.length);for(let s=0;s<2;++s)this.applyForces((a,l)=>a?o*Math.sqrt(l)*l/i:0,(a,l)=>r*i*i/l)}onShown(){super.onShown(),this.refreshData(),this.t.valueAsNumber=5,this.timer.isRunning||this.timer.start()}refreshData(){this.positions.clear(),this.forces.clear(),this.wasGrabbed.clear();let e=Math.min(this.w,this.h)/2;for(let t=0;t<this.graph.length;++t){let o=this.graph[t],r=dt*t/this.graph.length,i=e,s=i*Math.cos(r)+this.w/2,a=i*Math.sin(r)+this.h/2;this.positions.set(o,xe.fromValues(s,a))}}setGraph(e){this.graph=e}onClosed(){this.timer.stop(),super.onClosed()}};function l0(n){return n.name}function u0(n){if(n.nodeClass==="node")return"lightgreen";if(n.nodeClass==="param")return"lightyellow";if(n.nodeClass==="unknown")return"pink";mn(n.nodeClass)}function p0(n,e,t){return!t||n.nodeClass===e.nodeClass?1:1.8}var Ka=class extends Ya{constructor(e){super("Audio graph",l0,u0,p0),this.context=e}refreshData(){let e=this.context.getAudioGraph(!1);this.setGraph(e),super.refreshData()}};function Xn(n,e){let t=globalThis,o=t[n];if(B(o)){if(B(e))throw new Error(`No value ${n} found`);o=e(),t[n]=o}return o}var ub=Xn("juniper::loadedFonts",()=>[]);function Ja(n){let e=[];return n.fontStyle&&n.fontStyle!=="normal"&&e.push(n.fontStyle),n.fontVariant&&n.fontVariant!=="normal"&&e.push(n.fontVariant),n.fontWeight&&n.fontWeight!=="normal"&&e.push(n.fontWeight),e.push(js(n.fontSize)),e.push(n.fontFamily),e.join(" ")}function Gm(n){return"getBattery"in n}var d0=["","N/A","charging"],Li=class extends zn{static{this.isAvailable=Gm(navigator)}constructor(){super(256,128),this.battery=null,this.lastChargeDirection=null,this.lastLevel=null,this.chargeDirection=0,this.level=.5,Gm(navigator)?this.readBattery(navigator):this.redraw()}onRedraw(){this.battery?(this.chargeDirection=this.battery.charging?1:-1,this.level=this.battery.level):(this.level+=.1,this.level>1&&(this.level=0));let e=this.chargeDirection!==this.lastChargeDirection,t=this.level!==this.lastLevel;if(!e&&!t)return!1;this.lastChargeDirection=this.chargeDirection,this.lastLevel=this.level;let o=this.level<.1?"red":"silver",r=7,i=.7,s=(1-i)/2,a=this.canvas.width-2*r,l=a-4*r,p=this.canvas.height-4*r,m=a/2,x=this.canvas.height/2,F=d0[this.chargeDirection+1];return this.g.clearRect(0,0,a,this.canvas.height),this.g.save(),this.g.translate(s*this.canvas.width,s*this.canvas.height),this.g.globalAlpha=.75,this.g.scale(i,i),this.fillRect("silver",0,0,a,this.canvas.height,0),this.fillRect("silver",a,x-2*r-10,r+10,4*r+20,0),this.g.clearRect(r,r,a-2*r,this.canvas.height-2*r),this.fillRect("black",r,r,a-2*r,this.canvas.height-2*r,0),this.g.clearRect(2*r,2*r,l*this.level,p),this.fillRect(o,2*r,2*r,l*this.level,p,0),this.g.fillStyle="white",this.g.strokeStyle="black",this.g.lineWidth=4,this.g.textBaseline="middle",this.g.font=Ja({fontSize:p/2,fontFamily:"Lato"}),this.drawText(F,m,x,"center"),this.g.restore(),!0}async readBattery(e){let t=this.redraw.bind(this);t(),this.battery=await e.getBattery(),this.battery.addEventListener("chargingchange",t),this.battery.addEventListener("levelchange",t),setInterval(t,1e3),t()}};var Nt=class extends zn{constructor(e){super(10,10,e),this.trueWidth=null,this.trueHeight=null,this.trueFontSize=null,this.dx=null,this._minWidth=null,this._maxWidth=null,this._minHeight=null,this._maxHeight=null,this._freezeDimensions=!1,this._dimensionsFrozen=!1,this._bgFillColor=null,this._bgStrokeColor=null,this._bgStrokeSize=null,this._textStrokeColor=null,this._textStrokeSize=null,this._textFillColor="black",this._textDirection="horizontal",this._fontStyle="normal",this._fontVariant="normal",this._fontWeight="normal",this._fontFamily="sans-serif",this._fontSize=20,this._value=null,this.lastValue=null,w(e)&&(w(e.minWidth)&&(this._minWidth=e.minWidth),w(e.maxWidth)&&(this._maxWidth=e.maxWidth),w(e.minHeight)&&(this._minHeight=e.minHeight),w(e.maxHeight)&&(this._maxHeight=e.maxHeight),w(e.freezeDimensions)&&(this._freezeDimensions=e.freezeDimensions),w(e.textStrokeColor)&&(this._textStrokeColor=e.textStrokeColor),w(e.textStrokeSize)&&(this._textStrokeSize=e.textStrokeSize),w(e.bgFillColor)&&(this._bgFillColor=e.bgFillColor),w(e.bgStrokeColor)&&(this._bgStrokeColor=e.bgStrokeColor),w(e.bgStrokeSize)&&(this._bgStrokeSize=e.bgStrokeSize),w(e.value)&&(this._value=e.value),w(e.textFillColor)&&(this._textFillColor=e.textFillColor),w(e.textDirection)&&(this._textDirection=e.textDirection),w(e.fontStyle)&&(this._fontStyle=e.fontStyle),w(e.fontVariant)&&(this._fontVariant=e.fontVariant),w(e.fontWeight)&&(this._fontWeight=e.fontWeight),w(e.fontFamily)&&(this._fontFamily=e.fontFamily),w(e.fontSize)&&(this._fontSize=e.fontSize),w(e.padding)&&(me(e.padding)?this._padding={left:e.padding,right:e.padding,top:e.padding,bottom:e.padding}:this._padding=e.padding)),B(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(e){this.minWidth!==e&&(this._minWidth=e,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(e){this.maxWidth!==e&&(this._maxWidth=e,this.redraw())}get minHeight(){return this._minHeight}set minHeight(e){this.minHeight!==e&&(this._minHeight=e,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(e){this.maxHeight!==e&&(this._maxHeight=e,this.redraw())}get padding(){return this._padding}set padding(e){if(e instanceof Array)throw new Error("Invalid padding");(this.padding.top!==e.top||this.padding.right!=e.right||this.padding.bottom!=e.bottom||this.padding.left!=e.left)&&(this._padding=e,this.redraw())}get textDirection(){return this._textDirection}set textDirection(e){this.textDirection!==e&&(this._textDirection=e,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(e){this.fontStyle!==e&&(this._fontStyle=e,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(e){this.fontVariant!==e&&(this._fontVariant=e,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(e){this.fontWeight!==e&&(this._fontWeight=e,this.redraw())}get fontSize(){return this._fontSize}set fontSize(e){this.fontSize!==e&&(this._fontSize=e,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(e){this.textFillColor!==e&&(this._textFillColor=e,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(e){this.textStrokeColor!==e&&(this._textStrokeColor=e,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(e){this.textStrokeSize!==e&&(this._textStrokeSize=e,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(e){this.bgFillColor!==e&&(this._bgFillColor=e,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(e){this.bgStrokeColor!==e&&(this._bgStrokeColor=e,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(e){this.bgStrokeSize!==e&&(this._bgStrokeSize=e,this.redraw())}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.redraw())}split(e){return e.replace(/\r\n/g,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.onClear(),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value&&this.value!==this.lastValue){let e=this.split(this.value),t=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let r=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,i=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,s=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,a=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,l=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,p=t?a:i,m=t?l:s,x=t?i:a,F=t?s:l,v=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let k=!1,D=!1,b=1e4,P=0;this.trueFontSize=Un(this.fontSize*this.scale,P,b);let O=null,I=Number.MAX_VALUE;do{let C=this.fontSize;this._fontSize=this.trueFontSize;let W=Ja(this);this._fontSize=C,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=W,this.trueWidth=0,this.trueHeight=0;for(let $ of e){let Y=this.g.measureText($);this.trueWidth=Math.max(this.trueWidth,Y.width),this.trueHeight+=this.trueFontSize,me(Y.actualBoundingBoxLeft)&&me(Y.actualBoundingBoxRight)&&me(Y.actualBoundingBoxAscent)&&me(Y.actualBoundingBoxDescent)&&(r||(this.trueWidth=Y.actualBoundingBoxLeft+Y.actualBoundingBoxRight,this.trueHeight=Y.actualBoundingBoxAscent+Y.actualBoundingBoxDescent,this.dx=(Y.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(r){let $=this.trueWidth-p,Y=this.trueWidth-m,ie=this.trueHeight-x,ne=this.trueHeight-F,Te=Math.abs($),Fe=Math.abs(Y),se=Math.abs(ie),rt=Math.abs(ne);k=Y>1||ne>1,D=$<-1&&ie<-1;let hn=Math.min(Te,Math.min(Fe,Math.min(se,rt)));hn<I&&(I=hn,O=this.g.font),(k||D)&&v.indexOf(this.g.font)>-1&&O&&(this.g.font=O,k=!1,D=!1),k?(b=this.trueFontSize,this.trueFontSize=(P+this.trueFontSize)/2):D&&(P=this.trueFontSize,this.trueFontSize=(this.trueFontSize+b)/2)}v.push(this.g.font)}while(k||D);r&&(this.trueWidth<p?this.trueWidth=p:this.trueWidth>m&&(this.trueWidth=m),this.trueHeight<x?this.trueHeight=x:this.trueHeight>F&&(this.trueHeight=F));let L=this.trueWidth+this.scale*(this.padding.right+this.padding.left),U=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{Ua(this.g,L,U)}catch(C){throw console.error(C),C}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let o=.5*(e.length-1);for(let r=0;r<e.length;++r){let i=e[r],s=(r-o)*this.trueFontSize,a=this.dx+this.trueWidth/2+this.scale*this.padding.left,l=s+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(i,a,l),this.textFillColor&&this.g.fillText(i,a,l)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let r=this.bgStrokeSize/2;this.g.strokeRect(r,r,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(t){let r=Er(this.canvas.height,this.canvas.width),i=r.getContext("2d");i?(i.translate(r.width/2,r.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?i.rotate(ht):this.textDirection==="vertical-right"&&i.rotate(-ht),i.translate(-this.canvas.width/2,-this.canvas.height/2),i.drawImage(this.canvas,0,0),Ua(this.g,r.width,r.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(r,0,0)}return this.lastValue=this.value,!0}else{let e=this.value!==this.lastValue;return this.lastValue=this.value,e}}};var Za=class extends Nt{constructor(){super({textFillColor:"white",textStrokeColor:Ot(0,0,0,.5),textStrokeSize:.025,fontFamily:tr(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,freezeDimensions:!0});let e=this.update.bind(this);setInterval(e,500),e()}update(){let t=new Date().toLocaleTimeString();(B(this.value)||t.length!==this.value.length)&&this.unfreeze(),this.value=t}};var $a=class extends Nt{constructor(){super({textFillColor:"white",textStrokeColor:Ot(0,0,0,.5),textStrokeSize:.025,fontFamily:tr(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,freezeDimensions:!0}),this.fps=null,this.drawCalls=null,this.triangles=null}setStats(e,t,o){this.fps=e,this.drawCalls=t,this.triangles=o;let r=` ${Math.round(this.fps).toFixed(0)}hz ${this.drawCalls}c ${this.triangles}t`;(B(this.value)||r.length!==this.value.length)&&this.unfreeze(),this.value=r}};var jn=class{constructor(e){if(this.items=new Map,this.defaultItems=new Array,w(e))for(let[t,o]of e)this.add(t,o)}add(e,...t){for(let o of t)if(B(e))this.defaultItems.push(o);else{let r=this.items.get(e);B(r)&&this.items.set(e,r=[]),r.push(o)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let e of this.defaultItems)yield e;for(let e of this.items.values())for(let t of e)yield t}has(e){return w(e)?this.items.has(e):this.defaultItems.length>0}get(e){return B(e)?this.defaultItems:this.items.get(e)||[]}count(e){if(B(e))return this.defaultItems.length;let t=this.get(e);return w(t)?t.length:0}get size(){let e=this.defaultItems.length;for(let t of this.items.values())e+=t.length;return e}delete(e){return B(e)?pe(this.defaultItems).length>0:this.items.delete(e)}remove(e,t){if(B(e))je(this.defaultItems,t);else{let o=this.items.get(e);w(o)&&(je(o,t),o.length===0&&this.items.delete(e))}}clear(){this.items.clear(),pe(this.defaultItems)}};var Ri=class extends vo{constructor(e,t){super(),this.i=e,this.prog=t}report(e,t,o,r){super.report(e,t,o,r),this.prog.update(this.i,e,t,o)}};var Dr=class{constructor(e){this.prog=e,this.weightTotal=0,this.subProgressCallbacks=new Array,this.subProgressWeights=new Array,this.subProgressValues=new Array,this.start=performance.now();for(let t=0;t<this.subProgressWeights.length;++t)this.subProgressValues[t]=0,this.subProgressCallbacks[t]=new Ri(t,this)}addSubProgress(e){e=e||1,this.weightTotal+=e,this.subProgressWeights.push(e),this.subProgressValues.push(0);let t=new Ri(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(t),t}update(e,t,o,r){if(this.prog){this.subProgressValues[e]=t/o;let i=0;for(let p=0;p<this.subProgressWeights.length;++p)i+=this.subProgressValues[p]*this.subProgressWeights[p];let s=performance.now(),a=s-this.start,l=this.start-s+a*this.weightTotal/i;this.prog.report(i,this.weightTotal,r,l)}}};function Pi(n,e){return new ku(e,n).subProgressCallbacks}var ku=class extends Dr{constructor(e,t){super(t);for(let o of e)this.addSubProgress(o)}};async function h0(n,e){let t=new Array(e.length),o=new Array(e.length);for(let s=0;s<e.length;++s){let a=e[s];t[s]=a[0],o[s]=a[1]}let r=Pi(n,t),i=new Array(e.length);for(let s=0;s<e.length;++s)i[s]=o[s](r[s]);return await Promise.all(i)}function Xm(n,...e){let t=e.map(o=>[1,o]);return h0(n,t)}function jm(n){return oe(n.vcodec)}var Vi=class n extends rn{get data(){return this._data}get loaded(){return this._loaded}get title(){return this.video.title}setTitle(e){this.video.title=e,this.audio.title=e}constructor(e,t,o){let r=n.createMediaElement(Ai,It(!0)),i=n.createMediaElement(Zt,It(!1)),s=new Wt(t,{mediaElement:r});s.name=`${e}-video`;let a=new Wt(t,{mediaElement:i});a.name=`${e}-audio`,super(e,t,o,[],[s,a]),this.onTimeUpdate=null,this.wasUsingAudioElement=!1,this.nextStartTime=null,this._data=null,this._loaded=!1,this.onError=new Map,this.sourcesByURL=new Map,this.sources=new jn,this.potatoes=new jn,s.connect(this.volumeControl),a.connect(this.volumeControl),this.video=r,this.audio=i,this.loadingEvt=new kr(this),this.loadEvt=new Pn(this),this.playEvt=new Vn(this),this.pauseEvt=new In(this),this.stopEvt=new On(this),this.progEvt=new Wn(this),this.onSeeked=()=>{this.useAudioElement&&(this.audio.currentTime=this.video.currentTime)},this.onPlay=async()=>{this.onSeeked(),this.useAudioElement&&(await this.context.ready,await this.audio.play()),this.dispatchEvent(this.playEvt)},this.onPause=p=>{this.useAudioElement&&(this.onSeeked(),this.audio.pause()),this.video.currentTime===0||p.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};let l=!1;this.onWaiting=()=>{this.useAudioElement&&(l=!0,this.audio.pause())},this.onCanPlay=async()=>{this.useAudioElement&&l&&(await this.context.ready,await this.audio.play(),l=!1)},this.wasUsingAudioElement=!1,this.onTimeUpdate=async()=>{if(this.video.getVideoPlaybackQuality().totalVideoFrames===0){let m=this.onError.get(this.video);w(m)&&await m()}else if(this.useAudioElement){this.wasUsingAudioElement=!1;let m=this.video.currentTime-this.audio.currentTime;Math.abs(m)>.25&&(this.audio.currentTime=this.video.currentTime)}else this.wasUsingAudioElement||(this.wasUsingAudioElement=!0,this.audio.pause());this.progEvt.value=this.video.currentTime,this.progEvt.total=this.video.duration,this.dispatchEvent(this.progEvt)},this.video.addEventListener("seeked",this.onSeeked),this.video.addEventListener("play",this.onPlay),this.video.addEventListener("pause",this.onPause),this.video.addEventListener("ended",this.onPause),this.video.addEventListener("waiting",this.onWaiting),this.video.addEventListener("canplay",this.onCanPlay),this.video.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{videoPlayer:this})}elementHasAudio(e){let t=this.sourcesByURL.get(e.src);return w(t)&&t.acodec!=="none"||w(e.audioTracks)&&e.audioTracks.length>0||w(e.webkitAudioDecodedByteCount)&&e.webkitAudioDecodedByteCount>0||w(e.mozHasAudio)&&e.mozHasAudio}get useAudioElement(){return!this.elementHasAudio(this.video)&&this.elementHasAudio(this.audio)}onDisposing(){this.clear(),this.video.removeEventListener("seeked",this.onSeeked),this.video.removeEventListener("play",this.onPlay),this.video.removeEventListener("pause",this.onPause),this.video.removeEventListener("ended",this.onPause),this.video.removeEventListener("waiting",this.onWaiting),this.video.removeEventListener("canplay",this.onCanPlay),this.video.removeEventListener("timeupdate",this.onTimeUpdate),super.onDisposing(),this.audio.dispatchEvent(Sr),this.video.dispatchEvent(Sr)}clear(){this.stop();for(let[e,t]of this.onError)e.removeEventListener("error",t);this.onError.clear(),this.sourcesByURL.clear(),this.sources.clear(),this.potatoes.clear(),this.video.src="",this.audio.src="",this.wasUsingAudioElement=!1,this._data=null,this._loaded=!1}async load(e,t){if(this.clear(),this._data=e,oe(e)?(this.setTitle(e),this.potatoes.add(this.video,e)):(this.setTitle(e.title),this.fillSources(this.video,e.videos),this.fillSources(this.audio,e.audios)),!this.hasSources(this.video))throw new Error("No video sources found");if(this.dispatchEvent(this.loadingEvt),await Xm(t,o=>this.loadMediaElement(this.audio,o),o=>this.loadMediaElement(this.video,o)),oe(e)?this.nextStartTime=null:this.nextStartTime=e.startTime,!this.hasSources(this.video))throw new Error("No video playable sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}fillSources(e,t){t.sort(Oa);for(let o of t)Qd.matches(o.contentType)||(this.sources.add(e,o),this.sourcesByURL.set(o.url,o))}static createMediaElement(e,...t){return e(fn(!1),Dn(!1),...t)}async getMediaCapabilities(e){let t={type:"file"};jm(e)?t.video={contentType:e.contentType,bitrate:e.vbr*1024,framerate:e.fps,width:e.width,height:e.height}:e.acodec!=="none"&&(t.audio={contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr});try{return await navigator.mediaCapabilities.decodingInfo(t)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:t}}}hasSources(e){return this.sources.get(e).length>0||this.potatoes.count(e)>0}async loadMediaElement(e,t){for(w(t)&&t.start(),this.onError.has(e)&&(e.removeEventListener("error",this.onError.get(e)),this.onError.delete(e));this.hasSources(e);){let o=null,r=this.sources.get(e).shift();if(w(r)){let i=await this.getMediaCapabilities(r);if(!i.smooth||!i.powerEfficient){this.potatoes.add(e,r.url);continue}else o=r.url}else o=this.potatoes.get(e).shift();if(e.src=o,e.load(),await Ys(e)){w(r)?this.sources.get(e).unshift(r):this.potatoes.get(e).unshift(o);let i=()=>this.loadMediaElement(e,t);e.addEventListener("error",i),this.onError.set(e,i),this.wasUsingAudioElement=this.wasUsingAudioElement,w(t)&&t.end();return}}}get width(){return this.video.videoWidth}get height(){return this.video.videoHeight}get playbackState(){return B(this.data)?"empty":this.loaded?this.video.error?"errored":this.video.ended||this.video.paused&&this.video.currentTime===0?"stopped":this.video.paused?"paused":"playing":"loading"}async play(){await this.context.ready,w(this.nextStartTime)&&this.nextStartTime>0&&(this.video.pause(),this.video.currentTime=this.nextStartTime,this.nextStartTime=null),await this.video.play()}async playThrough(){let e=Jt(this,"stopped");await this.play(),await e}pause(){this.video.pause()}stop(){this.pause(),this.video.currentTime=0}restart(){return this.stop(),this.play()}};var qm="calla:preferredVideoInputID",ec=class extends re{constructor(){super(),this.element=Ai(Gs(!0)),this._hasPermission=!1,this._device=null,this._enabled=!1,Object.seal(this)}get mediaType(){return"video"}get deviceKind(){return`${this.mediaType}input`}get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.onChange())}get hasPermission(){return this._hasPermission}get preferredDeviceID(){return localStorage.getItem(qm)}get device(){return this._device}checkDevices(e){if(!this.hasPermission){for(let t of e)if(t.kind===this.deviceKind&&t.deviceId.length>0&&t.label.length>0){this._hasPermission=!0;break}}}async setDevice(e){if(w(e)&&e.kind!==this.deviceKind)throw new Error(`Device is not an vide input device. Was: ${e.kind}. Label: ${e.label}`);let t=this.device&&this.device.deviceId||null,o=e&&e.deviceId||null;o!==t&&(this._device=e,localStorage.setItem(qm,o),await this.onChange())}async onChange(){this.dispatchEvent(new pr);let e=this.inStream;this.device&&this.enabled?this.inStream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.device.deviceId,autoGainControl:!0,height:640,noiseSuppression:!0}}):this.inStream=null,this.inStream!==e&&this.dispatchEvent(new Tr(e,this.outStream))}get inStream(){return this.element.srcObject}set inStream(e){e!==this.inStream&&(this.inStream&&this.element.pause(),this.element.srcObject=e,this.inStream&&this.element.play())}get outStream(){return this.inStream}stop(){this.inStream=null}};var Qm="local-user";var q;(function(n){n.None="None",n.Fullscreen="Fullscreen",n.VR="VR",n.AR="AR",n.Anaglyph="Anaglyph",n.FullscreenAnaglyph="FullscreenAnaglyph"})(q||(q={}));var tc=class{constructor(e){Xn("Juniper.ThreeJS.ScreenUI.ButtonFillColor",()=>kh(Jd("#appContainer > .row > .cell > .btn",$d(e)))),this.elements=[this.topLeft=fe(ue("cell","top","left")),this.topCenter=fe(ue("cell","top","center")),this.topRight=fe(ue("cell","top","right")),this.middleLeft=fe(ue("cell","middle","left")),this.middleCenter=fe(ue("cell","middle","center")),this.middleRight=fe(ue("cell","middle","right")),this.bottomLeft=fe(ue("cell","bottom","left")),this.bottomCenter=fe(ue("cell","bottom","center")),this.bottomRight=fe(ue("cell","bottom","right"))],this.cells=[[this.topLeft,this.topCenter,this.topRight],[this.middleLeft,this.middleCenter,this.middleRight],[this.bottomLeft,this.bottomCenter,this.bottomRight]],this.hide()}show(){this.elements.forEach(e=>e.style.removeProperty("display"))}hide(){this.elements.forEach(e=>e.style.display="none")}};var{ACESFilmicToneMapping:G3,AddEquation:X3,AddOperation:j3,AdditiveAnimationBlendMode:q3,AdditiveBlending:Q3,AlphaFormat:Y3,AlwaysDepth:K3,AlwaysStencilFunc:J3,AmbientLight:Ym,AmbientLightProbe:Z3,AnimationClip:Km,AnimationLoader:$3,AnimationMixer:ey,AnimationObjectGroup:ty,AnimationUtils:ny,ArcCurve:oy,ArrayCamera:ry,ArrowHelper:iy,Audio:sy,AudioAnalyser:ay,AudioContext:cy,AudioListener:ly,AudioLoader:uy,AxesHelper:py,BackSide:Jm,BasicDepthPacking:dy,BasicShadowMap:hy,Bone:Zm,BooleanKeyframeTrack:my,Box2:fy,Box3:Eo,Box3Helper:xy,BoxBufferGeometry:gy,BoxGeometry:nc,BoxHelper:wy,BufferAttribute:An,BufferGeometry:Ii,BufferGeometryLoader:Fy,ByteType:Ay,Cache:_y,Camera:vy,CameraHelper:Sy,CanvasTexture:$m,CapsuleBufferGeometry:Ty,CapsuleGeometry:My,CatmullRomCurve3:ky,CineonToneMapping:Ey,CircleBufferGeometry:by,CircleGeometry:yy,ClampToEdgeWrapping:ef,Clock:Dy,Color:Pe,ColorKeyframeTrack:Cy,ColorManagement:Eu,CompressedArrayTexture:By,CompressedTexture:Ly,CompressedTextureLoader:Ry,ConeBufferGeometry:Py,ConeGeometry:Vy,CubeCamera:tf,CubeReflectionMapping:Iy,CubeRefractionMapping:Oy,CubeTexture:nf,CubeTextureLoader:Wy,CubeUVReflectionMapping:Hy,CubicBezierCurve:Ny,CubicBezierCurve3:Uy,CubicInterpolant:zy,CullFaceBack:Gy,CullFaceFront:Xy,CullFaceFrontBack:jy,CullFaceNone:qy,Curve:Qy,CurvePath:Yy,CustomBlending:Ky,CustomToneMapping:Jy,CylinderBufferGeometry:Zy,CylinderGeometry:of,Cylindrical:$y,Data3DTexture:eD,DataArrayTexture:tD,DataTexture:nD,DataTextureLoader:oD,DataUtils:rD,DecrementStencilOp:iD,DecrementWrapStencilOp:sD,DefaultLoadingManager:aD,DepthFormat:cD,DepthStencilFormat:lD,DepthTexture:uD,DirectionalLight:oc,DirectionalLightHelper:pD,DiscreteInterpolant:dD,DisplayP3ColorSpace:hD,DodecahedronBufferGeometry:mD,DodecahedronGeometry:fD,DoubleSide:rf,DstAlphaFactor:xD,DstColorFactor:gD,DynamicCopyUsage:wD,DynamicDrawUsage:sf,DynamicReadUsage:FD,EdgesGeometry:AD,EllipseCurve:_D,EqualDepth:vD,EqualStencilFunc:SD,EquirectangularReflectionMapping:TD,EquirectangularRefractionMapping:MD,Euler:af,EventDispatcher:kD,ExtrudeBufferGeometry:ED,ExtrudeGeometry:bD,FileLoader:bu,Float16BufferAttribute:yD,Float32BufferAttribute:rc,Float64BufferAttribute:DD,FloatType:CD,Fog:BD,FogExp2:LD,FramebufferTexture:RD,FrontSide:Oi,Frustum:PD,GLBufferAttribute:VD,GLSL1:ID,GLSL3:OD,GreaterDepth:WD,GreaterEqualDepth:HD,GreaterEqualStencilFunc:ND,GreaterStencilFunc:UD,GridHelper:cf,Group:ic,HalfFloatType:zD,HemisphereLight:GD,HemisphereLightHelper:XD,HemisphereLightProbe:jD,IcosahedronBufferGeometry:qD,IcosahedronGeometry:QD,ImageBitmapLoader:lf,ImageLoader:YD,ImageUtils:KD,IncrementStencilOp:JD,IncrementWrapStencilOp:ZD,InstancedBufferAttribute:m0,InstancedBufferGeometry:uf,InstancedInterleavedBuffer:Wi,InstancedMesh:sc,Int16BufferAttribute:$D,Int32BufferAttribute:e4,Int8BufferAttribute:t4,IntType:n4,InterleavedBuffer:yu,InterleavedBufferAttribute:Ut,Interpolant:pf,InterpolateDiscrete:df,InterpolateLinear:Du,InterpolateSmooth:o4,InvertStencilOp:r4,KeepStencilOp:i4,KeyframeTrack:s4,LOD:a4,LatheBufferGeometry:c4,LatheGeometry:l4,Layers:u4,LessDepth:p4,LessEqualDepth:d4,LessEqualStencilFunc:h4,LessStencilFunc:m4,Light:f4,LightProbe:x4,Line:hf,Line3:mf,LineBasicMaterial:Cu,LineCurve:g4,LineCurve3:w4,LineDashedMaterial:F4,LineLoop:ff,LineSegments:xf,LinearEncoding:gf,LinearFilter:Hi,LinearInterpolant:A4,LinearMipMapLinearFilter:_4,LinearMipMapNearestFilter:v4,LinearMipmapLinearFilter:Bu,LinearMipmapNearestFilter:wf,LinearSRGBColorSpace:S4,LinearToneMapping:T4,Loader:Ff,LoaderUtils:ac,LoadingManager:M4,LoopOnce:k4,LoopPingPong:E4,LoopRepeat:b4,LuminanceAlphaFormat:y4,LuminanceFormat:D4,MOUSE:C4,Material:cc,MaterialLoader:B4,MathUtils:lc,Matrix3:Lu,Matrix4:we,MaxEquation:L4,Mesh:_t,MeshBasicMaterial:it,MeshDepthMaterial:R4,MeshDistanceMaterial:P4,MeshLambertMaterial:V4,MeshMatcapMaterial:I4,MeshNormalMaterial:O4,MeshPhongMaterial:Cr,MeshPhysicalMaterial:qn,MeshStandardMaterial:Ru,MeshToonMaterial:W4,MinEquation:H4,MirroredRepeatWrapping:Af,MixOperation:N4,MultiplyBlending:U4,MultiplyOperation:z4,NearestFilter:uc,NearestMipMapLinearFilter:G4,NearestMipMapNearestFilter:X4,NearestMipmapLinearFilter:_f,NearestMipmapNearestFilter:vf,NeverDepth:j4,NeverStencilFunc:q4,NoBlending:Q4,NoColorSpace:Y4,NoToneMapping:K4,NormalAnimationBlendMode:J4,NormalBlending:Z4,NotEqualDepth:$4,NotEqualStencilFunc:eC,NumberKeyframeTrack:Sf,Object3D:be,ObjectLoader:tC,ObjectSpaceNormalMap:nC,OctahedronBufferGeometry:oC,OctahedronGeometry:rC,OneFactor:iC,OneMinusDstAlphaFactor:sC,OneMinusDstColorFactor:aC,OneMinusSrcAlphaFactor:cC,OneMinusSrcColorFactor:lC,OrthographicCamera:pc,PCFShadowMap:uC,PCFSoftShadowMap:pC,PMREMGenerator:dC,Path:hC,PerspectiveCamera:Ni,Plane:mC,PlaneBufferGeometry:fC,PlaneGeometry:Br,PlaneHelper:xC,PointLight:Tf,PointLightHelper:gC,Points:Mf,PointsMaterial:kf,PolarGridHelper:wC,PolyhedronBufferGeometry:FC,PolyhedronGeometry:AC,PositionalAudio:_C,PropertyBinding:Ef,PropertyMixer:vC,QuadraticBezierCurve:SC,QuadraticBezierCurve3:TC,Quaternion:de,QuaternionKeyframeTrack:Pu,QuaternionLinearInterpolant:MC,RED_GREEN_RGTC2_Format:kC,RED_RGTC1_Format:EC,REVISION:bC,RGBADepthPacking:yC,RGBAFormat:bf,RGBAIntegerFormat:DC,RGBA_ASTC_10x10_Format:CC,RGBA_ASTC_10x5_Format:BC,RGBA_ASTC_10x6_Format:LC,RGBA_ASTC_10x8_Format:RC,RGBA_ASTC_12x10_Format:PC,RGBA_ASTC_12x12_Format:VC,RGBA_ASTC_4x4_Format:IC,RGBA_ASTC_5x4_Format:OC,RGBA_ASTC_5x5_Format:WC,RGBA_ASTC_6x5_Format:HC,RGBA_ASTC_6x6_Format:NC,RGBA_ASTC_8x5_Format:UC,RGBA_ASTC_8x6_Format:zC,RGBA_ASTC_8x8_Format:GC,RGBA_BPTC_Format:XC,RGBA_ETC2_EAC_Format:jC,RGBA_PVRTC_2BPPV1_Format:qC,RGBA_PVRTC_4BPPV1_Format:QC,RGBA_S3TC_DXT1_Format:YC,RGBA_S3TC_DXT3_Format:KC,RGBA_S3TC_DXT5_Format:JC,RGB_ETC1_Format:ZC,RGB_ETC2_Format:$C,RGB_PVRTC_2BPPV1_Format:eB,RGB_PVRTC_4BPPV1_Format:tB,RGB_S3TC_DXT1_Format:nB,RGFormat:oB,RGIntegerFormat:rB,RawShaderMaterial:iB,Ray:sB,Raycaster:yf,RectAreaLight:aB,RedFormat:cB,RedIntegerFormat:lB,ReinhardToneMapping:uB,RepeatWrapping:dc,ReplaceStencilOp:pB,ReverseSubtractEquation:dB,RingBufferGeometry:hB,RingGeometry:mB,SIGNED_RED_GREEN_RGTC2_Format:fB,SIGNED_RED_RGTC1_Format:xB,SRGBColorSpace:Lr,Scene:Rr,ShaderChunk:gB,ShaderLib:Ui,ShaderMaterial:hc,ShadowMaterial:wB,Shape:FB,ShapeBufferGeometry:AB,ShapeGeometry:_B,ShapePath:vB,ShapeUtils:SB,ShortType:TB,Skeleton:Df,SkeletonHelper:MB,SkinnedMesh:Cf,Source:kB,Sphere:Pr,SphereBufferGeometry:EB,SphereGeometry:mc,Spherical:bB,SphericalHarmonics3:yB,SplineCurve:DB,SpotLight:Bf,SpotLightHelper:CB,Sprite:BB,SpriteMaterial:f0,SrcAlphaFactor:LB,SrcAlphaSaturateFactor:RB,SrcColorFactor:PB,StaticCopyUsage:VB,StaticDrawUsage:IB,StaticReadUsage:OB,StereoCamera:Lf,StreamCopyUsage:WB,StreamDrawUsage:HB,StreamReadUsage:NB,StringKeyframeTrack:UB,SubtractEquation:zB,SubtractiveBlending:GB,TOUCH:XB,TangentSpaceNormalMap:jB,TetrahedronBufferGeometry:qB,TetrahedronGeometry:QB,Texture:zi,TextureLoader:Rf,TorusBufferGeometry:YB,TorusGeometry:KB,TorusKnotBufferGeometry:JB,TorusKnotGeometry:ZB,Triangle:$B,TriangleFanDrawMode:Gi,TriangleStripDrawMode:fc,TrianglesDrawMode:Pf,TubeBufferGeometry:e6,TubeGeometry:t6,TwoPassDoubleSide:n6,UVMapping:o6,Uint16BufferAttribute:r6,Uint32BufferAttribute:i6,Uint8BufferAttribute:s6,Uint8ClampedBufferAttribute:a6,Uniform:c6,UniformsGroup:l6,UniformsLib:Xi,UniformsUtils:Vu,UnsignedByteType:u6,UnsignedInt248Type:p6,UnsignedIntType:d6,UnsignedShort4444Type:h6,UnsignedShort5551Type:m6,UnsignedShortType:f6,VSMShadowMap:x6,Vector2:Ue,Vector3:V,Vector4:cn,VectorKeyframeTrack:Vf,VideoTexture:If,WebGL1Renderer:g6,WebGL3DRenderTarget:w6,WebGLArrayRenderTarget:F6,WebGLCubeRenderTarget:Of,WebGLMultipleRenderTargets:A6,WebGLRenderTarget:Iu,WebGLRenderer:Wf,WebGLUtils:_6,WireframeGeometry:Hf,WrapAroundEnding:v6,ZeroCurvatureEnding:S6,ZeroFactor:T6,ZeroSlopeEnding:M6,ZeroStencilOp:k6,_SRGBAFormat:E6,sRGBEncoding:Nf}=THREE;function vt(n){return w(n)&&n.isMesh}function Ou(n){return w(n)&&n.isMaterial}function xc(n,e){return Ou(e)&&e.type===n}function Uf(n){return xc("MeshBasicMaterial",n)}function ji(n){return xc("MeshStandardMaterial",n)}function qi(n){return xc("MeshPhongMaterial",n)}function Qi(n){return xc("MeshPhysicalMaterial",n)}function Wu(n){return w(n)&&n.isObject3D}function zf(n){return w(n)&&n.isQuaternion}function Gf(n){return w(n)&&n.isEuler}function Hu(n){return w(n)&&Wu(n.object)}function Xf(n){return Hu(n)||Wu(n)}function st(n){return Hu(n)?n.object:n}function Ve(n,e){return n=st(n),n.visible=e,e}function Vr(n){return n=st(n),n.visible}function gc(n){if(!n)return!1;for(n=st(n);n;){if(!n.visible)return!1;n=n.parent}return!0}function z(n,...e){let t=e.filter(w).map(st);return t.length>0&&st(n).add(...t),n}function ce(n,...e){let t=new be;return t.name=n,z(t,...e),t}function wc(n,e){n=st(n),wi(n)&&(n.disabled=!e)}function Fc(n,e,t){let o=new _t(e,t);return o.name=n,o}function jf(n){return"height"in n}function qf(n){return"width"in n}var x0=1.25,g0=nt(30),w0=nt(32),Ac=class extends be{constructor(){super(),this.name="SpaceUI",this.position.y=-.25}addItem(e,t){e=st(e),z(this,e),e.rotation.set(t.y*w0,-t.x*g0,0,"YXZ"),e.position.set(0,0,-x0).applyEuler(e.rotation),jf(t)&&qf(t)?e.scale.set(t.width,t.height,1):jf(t)?e.scale.multiplyScalar(t.height/e.scale.y):qf(t)?e.scale.multiplyScalar(t.width/e.scale.x):e.scale.setScalar(t.scale),e.scale.z=1}};var Qn=class{constructor(e){if(this.items=new Map,w(e))for(let[t,o,r]of e)this.add(t,o,r)}add(e,t,o){let r=this.items.get(e);return B(r)&&this.items.set(e,r=new Map),r.set(t,o),this}*entries(){for(let[e,t]of this.items)for(let[o,r]of t)yield[e,o,r]}keys(e){return B(e)?this.items.keys():this.items.get(e).keys()}*values(){for(let e of this.items.values())for(let t of e.values())yield t}has(e,t){return this.items.has(e)&&(B(t)||this.items.get(e).has(t))}get(e,t){return B(t)?this.items.get(e):this.items.has(e)?this.items.get(e).get(t):null}count(e){return this.items.has(e)?this.items.get(e).size:null}get size(){let e=0;for(let t of this.items.values())e+=t.size;return e}delete(e,t){if(B(t))return this.items.delete(e);if(this.items.has(e)){let o=this.items.get(e),r=o.delete(t);return o.size===0&&this.items.delete(e),r}else return!1}clear(){this.items.clear()}};function F0(n){return[Yf([n[1],n[0],n[2]]),Yf([n[2],n[0],n[3]])]}function Jf(n){return n.map(F0).flat()}var Nu=new V,Qf=new V,_c=new V;function Yf(n){let e=[[n[0][0],n[0][1],n[0][2]],[n[1][0],n[1][1],n[1][2]],[n[2][0],n[2][1],n[2][2]]],t=[[n[0][3],n[0][4]],[n[1][3],n[1][4]],[n[2][3],n[2][4]]];_c.fromArray(e[0]),Nu.fromArray(e[1]).sub(_c),_c.fromArray(e[2]),Qf.fromArray(e[1]).sub(_c),Nu.cross(Qf);let o=Nu.toArray();return{positions:e,uvs:t,normal:o}}function Zf(n){let e=n.map(i=>i.positions).flat(2),t=n.map(i=>i.uvs).flat(2),o=n.flatMap(i=>i.normal),r=new Ii;return r.setAttribute("position",new An(new Float32Array(e),3,!1)),r.setAttribute("uv",new An(new Float32Array(t),2,!1)),r.setAttribute("normal",new An(new Float32Array(o),3,!0)),r}function zt(...n){let e=Jf(n);return Zf(e)}function Ir(n,...e){let t=A0(e);for(let r=0;r<n;++r)t=v0(t);e=_0(t);let o=Jf(e);return Zf(o)}function A0(n){return n.map(e=>{let t=Number.MAX_VALUE,o=Number.MIN_VALUE,r=Number.MAX_VALUE,i=Number.MIN_VALUE;for(let l of e){let p=l[3],m=l[4];t=Math.min(t,p),o=Math.max(o,p),r=Math.min(r,m),i=Math.max(i,m)}let s=[t,r],a=[o-t,i-r];return{minUV:s,deltaUV:a,verts:[vc(s,a,e[0]),vc(s,a,e[1]),vc(s,a,e[2]),vc(s,a,e[3])]}})}function vc(n,e,t){return{pos:[t[0],t[1],t[2]],uv:[t[3],t[4]],pUV:[(t[3]-n[0])/e[0],(t[4]-n[1])/e[1]]}}function _0(n){return n.map(e=>[Sc(e,0),Sc(e,1),Sc(e,2),Sc(e,3)])}function Sc(n,e){let t=n.verts[e];return[t.pos[0],t.pos[1],t.pos[2],t.uv[0],t.uv[1]]}function v0(n){return n.flatMap(e=>{let t=Yi(e,e.verts[0],e.verts[1]),o=Yi(e,e.verts[2],e.verts[3]),r=Yi(e,e.verts[0],e.verts[3]),i=Yi(e,e.verts[1],e.verts[2]),s=Yi(e,t,o);return[{minUV:e.minUV,deltaUV:e.deltaUV,verts:[e.verts[0],t,s,r]},{minUV:e.minUV,deltaUV:e.deltaUV,verts:[t,e.verts[1],i,s]},{minUV:e.minUV,deltaUV:e.deltaUV,verts:[s,i,e.verts[2],o]},{minUV:e.minUV,deltaUV:e.deltaUV,verts:[r,s,o,e.verts[3]]}]})}function Yi(n,e,t){let o=t.pos[0]-e.pos[0],r=t.pos[1]-e.pos[1],i=t.pos[2]-e.pos[2],s=e.pos[0]+.5*o,a=e.pos[1]+.5*r,l=e.pos[2]+.5*i,p=t.pUV[0]-e.pUV[0],m=t.pUV[1]-e.pUV[1],x=e.pUV[0]+.5*p,F=e.pUV[1]+.5*m,v=Kf(x-.5)+.5,k=Kf(F-.5)+.5,D=v*n.deltaUV[0]+n.minUV[0],b=k*n.deltaUV[1]+n.minUV[1];return{pos:[s,a,l],pUV:[x,F],uv:[D,b]}}function Kf(n){return Math.atan(2*n)/ht}function $f(n,e){let t=n*Ee;return .5*(1-Math.cos(t))-e*Math.sin(2*t)}function ex(n,e){let t=(n-.5)*Ee;return n*n+e*Math.cos(t)}var bo=Xn("Juniper:ScaledItems",()=>new Map),tx=1,S0=1.1,T0=.005,Uu=class{constructor(e){this.target=e,this.obj=st(this.target),this.base=this.obj.scale.clone(),this.p=0,this.dir=0,this.running=!1,this.wasDisabled=this.disabled,this.target.addScopedEventListener(this,"enter",t=>{t.pointer.type!=="nose"&&this.run(1)}),this.target.addScopedEventListener(this,"exit",t=>{t.pointer.type!=="nose"&&this.run(-1)}),this.obj.traverse(t=>{vt(t)&&this.target.addMesh(t)})}get disabled(){return this.target.disabled}run(e){(!this.disabled||e===-1||this.p>0)&&(this.dir=e,this.running=!0)}updateScaling(e){if(this.disabled!==this.wasDisabled&&(this.wasDisabled=this.disabled,this.disabled&&this.run(-1)),this.running){this.p+=this.dir*e,(this.dir>0&&this.p>=1||this.dir<0&&this.p<0)&&(this.p=Math.max(0,Math.min(1,this.p)),this.running=!1);let t=$f(this.p,1.1);this.obj.scale.copy(this.base).multiplyScalar(t*(S0-tx)+tx)}}dispose(){this.target.removeScope(this)}};function nx(n){n*=T0;for(let e of bo.values())e.updateScaling(n)}function ox(n){let e=bo.get(n);e&&(bo.delete(n),Re(e))}function Tc(n,e){let t=bo.has(n);if(e!=t)if(e)bo.set(n,new Uu(n));else{let o=bo.get(n);Re(o),bo.delete(n)}}function ye(n){let e=new Array,t=new Set;for(e.push(n);e.length>0;){let o=e.shift();o&&!t.has(o)&&(t.add(o),o.isMesh&&e.push(o.material,o.geometry),o.isMaterial&&e.push(...Object.values(o)),o.isObject3D&&(e.push(...o.children),o.clear(),ox(o)),qt(o)&&e.push(...o),Hn(o))}t.clear()}Xi.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Ue(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};Ui.line={uniforms:Vu.merge([Xi.common,Xi.fog,Xi.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var _n=class extends hc{constructor(e){super({type:"LineMaterial",uniforms:Vu.clone(Ui.line.uniforms),vertexShader:Ui.line.vertexShader,fragmentShader:Ui.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}};_n.prototype.isLineMaterial=!0;var zu=Xn("Juniper:Three:Materials",()=>new Map);function M0(n,e){e in n&&delete n[e]}function Mc(n,e,t){let o=`${n}_${Object.keys(t).map(r=>`${r}:${t[r]}`).join(",")}`;return zu.has(o)||(M0(t,"name"),zu.set(o,new e(t))),zu.get(o)}function k0(n){return Object.assign(n,{transparent:!0})}function rx(n){return Mc("solid",it,n)}function Or(n){return Mc("solidTransparent",it,k0(n))}function Gu(n){return Mc("lit",Cr,n)}function ix(n){return Mc("line2",_n,n)}function Ki(n,e){let t=new Set;n.traverse(o=>{if(vt(o)&&Ou(o.material)){let r=o.material,i=e(r);r!==i&&(t.add(r),o.material=i)}});for(let o of t)Hn(o)}function sx(n){if(n.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let e={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,dithering:n.dithering,envMap:n.envMap,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.emissiveMap||n.map,name:n.name+"-Standard-To-Basic",opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,shadowSide:n.shadowSide,side:n.side,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[t,o]of Object.entries(e))B(o)&&delete e[t];return new it(e)}function Ji(n){if(n.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let e={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,bumpMap:n.bumpMap,bumpScale:n.bumpScale,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,displacementBias:n.displacementBias,displacementMap:n.displacementMap,displacementScale:n.displacementScale,dithering:n.dithering,emissive:n.emissive,emissiveIntensity:n.emissiveIntensity,emissiveMap:n.emissiveMap,envMap:n.envMap,flatShading:n.flatShading,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.map,name:n.name+"-Standard-To-Phong",normalMap:n.normalMap,normalMapType:n.normalMapType,normalScale:n.normalScale,opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,shadowSide:n.shadowSide,side:n.side,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[t,o]of Object.entries(e))B(o)&&delete e[t];return new Cr(e)}function ax(n){if(n.type!=="MeshPhysicalMaterial")throw new Error("Input material is not MeshPhysicalMaterial");let e={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,bumpMap:n.bumpMap,bumpScale:n.bumpScale,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,displacementBias:n.displacementBias,displacementMap:n.displacementMap,displacementScale:n.displacementScale,dithering:n.dithering,emissive:n.emissive,emissiveIntensity:n.emissiveIntensity,emissiveMap:n.emissiveMap,envMap:n.envMap,flatShading:n.flatShading,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.map,name:n.name+"-Standard-To-Phong",normalMap:n.normalMap,normalMapType:n.normalMapType,normalScale:n.normalScale,opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,reflectivity:n.reflectivity,shadowSide:n.shadowSide,shininess:n.sheen,side:n.side,specular:n.specularColor,specularMap:n.specularColorMap,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[t,o]of Object.entries(e))B(o)&&delete e[t];return new Cr(e)}var E0=12632256,Xu=16777215;var ju=Gu({color:E0}),cx=Gu({color:Xu});function kc(n){return n instanceof HTMLVideoElement?n.videoWidth:n instanceof VideoFrame?n.displayWidth:n.width}function Ec(n){return n instanceof HTMLVideoElement?n.videoHeight:n instanceof VideoFrame?n.displayHeight:n.height}var lx=304.79999999999995,hL=lx*3,b0=10*100,y0=lx*16.5,D0=y0*40,mL=b0*1e3,fL=D0*8,ux=2.54*4,px=ux*3,xL=px*3,C0=px*16.5,B0=C0*40,gL=100*1e3,wL=B0*8,qu=4*3,L0=qu*3,Zi=100/2.54,R0=qu*16.5,P0=R0*40,FL=Zi*1e3,AL=P0*8,_L=3*3,V0=100/ux,I0=3*16.5,O0=I0*40,vL=V0*1e3,SL=O0*8,Qu=Zi/qu,W0=16.5*40,TL=Qu*1e3,ML=W0*8,H0=Zi/L0,N0=16.5/3,U0=N0*40,kL=H0*1e3,EL=U0*8,dx=16.5/Qu,hx=dx*40,bL=hx*8,yL=1e3/dx,DL=40*8,z0=1e3/hx,CL=8/z0;function mx(n){return n/Qu}function fx(n){return n/Zi}function xx(n){return n*Zi}var Yu=new Br(1,1,1,1);Yu.name="PlaneGeom";var G0=new we,bc=new V,gx=new cn,wx=new de;function Ku(n,e,t){return G0.copy(n.matrixWorld).invert().multiply(e.matrixWorld).decompose(bc,wx,t),gx.set(bc.x,bc.y,bc.z,1),new XRRigidTransform(gx,wx)}var Wr=new V,X0=0,yo=class extends be{constructor(e,t,o,r=null){if(super(),this.webXRLayerType=o,this.lastMatrixWorld=new we,this._imageWidth=0,this._imageHeight=0,this.forceUpdate=!1,this.wasUsingLayer=!1,this.layer=null,this.curImage=null,this.lastImage=null,this.lastWidth=null,this.lastHeight=null,this.env=null,this.mesh=null,this.stereoLayoutName="mono",this.sizeMode="none",e){this.setEnvAndName(e,t);let i=Uf(r)?r:Or(Object.assign({},r,{name:this.name}));z(this,this.mesh=Fc(t+"-Mesh",Yu,i))}}copy(e,t=!0){return super.copy(e,t),this.webXRLayerType=e.webXRLayerType,this.setImageSize(e.imageWidth,e.imageHeight),this.setEnvAndName(e.env,e.name+ ++X0),this.mesh=Ft(this.children,vt),B(this.mesh)&&(this.mesh=e.mesh.clone(),z(this,this.mesh)),this.setTextureMap(e.curImage),this}dispose(){this.env.removeScope(this),this.disposeImage(),ye(this.mesh)}disposeImage(){this.removeWebXRLayer(),ye(this.mesh.material.map),this.curImage=null}setImageSize(e,t){if(e!==this.imageWidth||t!==this.imageHeight){let{objectWidth:o,objectHeight:r}=this;this._imageWidth=e,this._imageHeight=t,this.sizeMode!=="none"&&(this.sizeMode==="fixed-width"?this.objectWidth=o:this.objectHeight=r)}}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get imageAspectRatio(){return this.imageWidth/this.imageHeight}get objectWidth(){return this.scale.x}set objectWidth(e){this.scale.set(e,this.scale.y=e/this.imageAspectRatio,1)}get objectHeight(){return this.scale.y}set objectHeight(e){this.scale.set(this.imageAspectRatio*e,e,1)}get pixelDensity(){let e=xx(this.objectWidth);return this.imageWidth/e}set pixelDensity(e){let t=this.imageWidth/e,o=fx(t);this.objectWidth=o}setEnvAndName(e,t){this.env=e,this.name=t,this.env.addScopedEventListener(this,"update",o=>this.checkWebXRLayer(o.frame))}get needsLayer(){return!gc(this)||B(this.mesh.material.map)||B(this.curImage)?!1:this.curImage instanceof HTMLVideoElement?!this.curImage.paused||this.curImage.currentTime>0:!0}removeWebXRLayer(){if(w(this.layer)){this.wasUsingLayer=!1,this.env.removeWebXRLayer(this.layer),this.mesh.visible=!0;let e=this.layer;this.layer=null,setTimeout(()=>Hn(e),100)}}setTextureMap(e){this.curImage&&this.disposeImage(),e&&(Cm(e)?e=Pm(e):Bm(e)&&(e=Vm(e)),_u(e)&&(e=e),this.curImage=e,this.setImageSize(kc(e),Ec(e)),e instanceof HTMLVideoElement?this.mesh.material.map=new If(e):(this.mesh.material.map=new zi(e),this.mesh.material.map.needsUpdate=!0)),this.mesh.material.needsUpdate=!0}get isVideo(){return this.curImage instanceof HTMLVideoElement}updateTexture(){if(w(this.curImage)){let e=kc(this.curImage),t=Ec(this.curImage);if(this.imageWidth!==e||this.imageHeight!==t){let o=this.curImage;this.disposeImage(),this.setTextureMap(o)}else this.mesh.material.map.needsUpdate=this.forceUpdate=!0}}checkWebXRLayer(e){if(this.mesh.material.map&&this.curImage){let o=this.webXRLayerType!=="none"&&this.env.hasXRCompositionLayers&&this.env.showWebXRLayers&&w(e)&&(this.isVideo&&w(this.env.xrMediaBinding)||!this.isVideo&&w(this.env.xrBinding))&&this.needsLayer,r=o!==this.wasUsingLayer,i=this.curImage!==this.lastImage||this.mesh.material.needsUpdate||this.mesh.material.map.needsUpdate||this.forceUpdate,s=this.imageWidth!==this.lastWidth||this.imageHeight!==this.lastHeight;if(this.wasUsingLayer=o,this.lastImage=this.curImage,this.lastWidth=this.imageWidth,this.lastHeight=this.imageHeight,(r||s)&&((!o||s)&&this.layer&&this.removeWebXRLayer(),o)){let a=this.env.referenceSpace,l=Ku(this.env.stage,this.mesh,Wr);this.lastMatrixWorld.copy(this.matrixWorld);let p=Wr.x/2,m=Wr.y/2,x=this.stereoLayoutName==="mono"?"mono":this.stereoLayoutName==="left-right"||this.stereoLayoutName==="right-left"?"stereo-left-right":"stereo-top-bottom";if(this.isVideo){let F=this.stereoLayoutName==="right-left"||this.stereoLayoutName==="bottom-top";this.layer=this.env.xrMediaBinding.createQuadLayer(this.curImage,{space:a,layout:x,invertStereo:F,transform:l,width:p,height:m})}else this.layer=this.env.xrBinding.createQuadLayer({space:a,layout:x,textureType:"texture",isStatic:this.webXRLayerType==="static",viewPixelWidth:kc(this.curImage),viewPixelHeight:Ec(this.curImage),transform:l,width:p,height:m});this.env.addWebXRLayer(this.layer,500),this.mesh.visible=!1}if(this.layer){if(i||this.layer.needsRedraw){let a=this.env.gl,l=this.env.xrBinding.getSubImage(this.layer,e);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.bindTexture(a.TEXTURE_2D,l.colorTexture),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.curImage),a.generateMipmap(a.TEXTURE_2D),a.bindTexture(a.TEXTURE_2D,null),this.forceUpdate=!1}Rd(this.matrixWorld.elements,this.lastMatrixWorld.elements)>=0&&(this.layer.transform=Ku(this.env.stage,this.mesh,Wr),this.lastMatrixWorld.copy(this.matrixWorld),this.layer.width=Wr.x/2,this.layer.height=Wr.y/2)}else this.forceUpdate=!1}}};var Dc=class extends Vi{constructor(e,t,o){super("video-player-3d",t,o),this.material=Or({name:"videoPlayer-material"}),this.vidMeshes=[];for(let r=0;r<2;++r){let i=new yo(e,`videoPlayer-view${r+1}`,"none",this.material);i.setTextureMap(this.video),i.mesh.renderOrder=4,r>0?i.mesh.layers.disable(0):i.mesh.layers.enable(0),this.vidMeshes.push(i)}this.object=ce("videoPlayer",...this.vidMeshes)}get meshes(){return this.vidMeshes.map(e=>e.mesh)}onDisposing(){super.onDisposing(),ye(this.object),pe(this.vidMeshes)}isSupported(e,t){return t.split("-").map(o=>Fx.has(e,o)).reduce(Id,!0)}setStereoParameters(e,t){if(!this.isSupported(e,t))throw new Error(`Not supported [encoding: ${e}, layout: ${t}]`);for(let i=0;i<this.vidMeshes.length;++i){let s=this.vidMeshes[i];s.webXRLayerType="none",s.mesh.layers.disable(1),s.mesh.layers.disable(2),t==="left-right"||t==="top-bottom"?s.mesh.layers.enable(this.vidMeshes.length-i):t!=="mono"&&s.mesh.layers.enable(i+1)}let o=this.height/this.width;e!=="N/A"?this.vidMeshes[0].scale.setScalar(100):t==="mono"?this.vidMeshes[0].scale.set(1,o,1):t==="left-right"||t==="right-left"?this.vidMeshes[0].scale.set(1,2*o,1):this.vidMeshes[0].scale.set(1,.5*o,1);for(let i=1;i<this.vidMeshes.length;++i)this.vidMeshes[i].scale.copy(this.vidMeshes[0].scale);let r=t.split("-");for(let i=0;i<r.length;++i){let s=r[i],a=Fx.get(e,s),l=this.vidMeshes[i];l.webXRLayerType="dynamic",l.visible=!0,l.mesh.geometry!==a&&(ye(l.mesh.geometry),l.mesh.geometry=a)}}},j0=zt([[-1/2,1/2,0,0,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,0,0]]),Ax=[[-1/2,1/2,0,0,1],[1/2,1/2,0,.5,1],[1/2,-1/2,0,.5,0],[-1/2,-1/2,0,0,0]],_x=[[-1/2,1/2,0,.5,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,.5,0]],vx=[[[-1/2,1/2,-1/2,1/3,1],[1/2,1/2,-1/2,2/3,1],[1/2,-1/2,-1/2,2/3,1/2],[-1/2,-1/2,-1/2,1/3,1/2]],[[1/2,1/2,-1/2,2/3,1],[1/2,1/2,1/2,1,1],[1/2,-1/2,1/2,1,1/2],[1/2,-1/2,-1/2,2/3,1/2]],[[-1/2,1/2,1/2,0,1],[-1/2,1/2,-1/2,1/3,1],[-1/2,-1/2,-1/2,1/3,1/2],[-1/2,-1/2,1/2,0,1/2]],[[1/2,1/2,1/2,2/3,1/2],[-1/2,1/2,1/2,2/3,0],[-1/2,-1/2,1/2,1/3,0],[1/2,-1/2,1/2,1/3,1/2]],[[1/2,1/2,-1/2,1,1/2],[-1/2,1/2,-1/2,1,0],[-1/2,1/2,1/2,2/3,0],[1/2,1/2,1/2,2/3,1/2]],[[1/2,-1/2,1/2,1/3,1/2],[-1/2,-1/2,1/2,1/3,0],[-1/2,-1/2,-1/2,0,0],[1/2,-1/2,-1/2,0,1/2]]],Ju=[[[-1/2,1/2,-1/2,0,1/3],[1/2,1/2,-1/2,0,2/3],[1/2,-1/2,-1/2,1/4,2/3],[-1/2,-1/2,-1/2,1/4,1/3]],[[1/2,1/2,-1/2,0,2/3],[1/2,1/2,1/2,0,1],[1/2,-1/2,1/2,1/4,1],[1/2,-1/2,-1/2,1/4,2/3]],[[-1/2,1/2,1/2,0,0],[-1/2,1/2,-1/2,0,1/3],[-1/2,-1/2,-1/2,1/4,1/3],[-1/2,-1/2,1/2,1/4,0]],[[1/2,1/2,1/2,1/4,2/3],[-1/2,1/2,1/2,1/2,2/3],[-1/2,-1/2,1/2,1/2,1/3],[1/2,-1/2,1/2,1/4,1/3]],[[1/2,1/2,-1/2,1/4,1],[-1/2,1/2,-1/2,1/2,1],[-1/2,1/2,1/2,1/2,2/3],[1/2,1/2,1/2,1/4,2/3]],[[1/2,-1/2,1/2,1/4,1/3],[-1/2,-1/2,1/2,1/2,1/3],[-1/2,-1/2,-1/2,1/2,0],[1/2,-1/2,-1/2,1/4,0]]],Zu=[[[-1/2,1/2,-1/2,1/2,1/3],[1/2,1/2,-1/2,1/2,2/3],[1/2,-1/2,-1/2,3/4,2/3],[-1/2,-1/2,-1/2,3/4,1/3]],[[1/2,1/2,-1/2,1/2,2/3],[1/2,1/2,1/2,1/2,1],[1/2,-1/2,1/2,3/4,1],[1/2,-1/2,-1/2,3/4,2/3]],[[-1/2,1/2,1/2,1/2,0],[-1/2,1/2,-1/2,1/2,1/3],[-1/2,-1/2,-1/2,3/4,1/3],[-1/2,-1/2,1/2,3/4,0]],[[1/2,1/2,1/2,3/4,2/3],[-1/2,1/2,1/2,1,2/3],[-1/2,-1/2,1/2,1,1/3],[1/2,-1/2,1/2,3/4,1/3]],[[1/2,1/2,-1/2,3/4,1],[-1/2,1/2,-1/2,1,1],[-1/2,1/2,1/2,1,2/3],[1/2,1/2,1/2,3/4,2/3]],[[1/2,-1/2,1/2,3/4,1/3],[-1/2,-1/2,1/2,1,1/3],[-1/2,-1/2,-1/2,1,0],[1/2,-1/2,-1/2,3/4,0]]],q0=zt(Ax),Q0=zt(_x),Y0=zt($u(Ax)),K0=zt($u(_x)),Sx=Mx(Ju),Tx=Mx(Zu),J0=zt(...vx),Z0=zt(...Ju),$0=zt(...Zu),eA=zt(...Sx),tA=zt(...Tx),$i=4,nA=Ir($i,...vx),oA=Ir($i,...Ju),rA=Ir($i,...Zu),iA=Ir($i,...Sx),sA=Ir($i,...Tx),Fx=new Qn([["N/A","mono",j0],["N/A","left",q0],["N/A","right",Q0],["N/A","top",Y0],["N/A","bottom",K0],["Cubemap Strips","mono",J0],["Cubemap Strips","left",Z0],["Cubemap Strips","right",$0],["Cubemap Strips","top",eA],["Cubemap Strips","bottom",tA],["Equi-Angular Cubemap (YouTube)","mono",nA],["Equi-Angular Cubemap (YouTube)","left",oA],["Equi-Angular Cubemap (YouTube)","right",rA],["Equi-Angular Cubemap (YouTube)","top",iA],["Equi-Angular Cubemap (YouTube)","bottom",sA]]);function yc(n){return[n[0],n[1],n[2],n[4],1-n[3]]}function $u(n){return[yc(n[0]),yc(n[1]),yc(n[2]),yc(n[3])]}function Mx(n){return n.map($u)}async function kx(n,e){let{status:t,requestPath:o,responsePath:r,content:i,contentType:s,contentLength:a,fileName:l,headers:p,date:m}=n;return{status:t,requestPath:o,responsePath:r,content:w(e)?await e(i):void 0,contentType:s,contentLength:a,fileName:l,headers:p,date:m}}var Do=class extends br{constructor(e,t,o,r){if(!So.matches(o)&&!qd.matches(o))throw new Error("Only GLTF model types are currently supported");super(t,o,r),this.env=e}async getResponse(e){let t=await e.file();return kx(t,o=>this.env.loadGltf(o))}};function Ex(n,e){let t=[n];for(;t.length>0;){let o=t.shift();if(e(o))return o;o.children.length>0&&t.push(...o.children)}return null}var Cc=class{get object(){return this._model}constructor(e,t){this.disposed=!1,this.asset=new Do(e,t,So,!e.DEBUG),this.asset.then(()=>{this._model=Ex(this.asset.result.scene,vt);let l=this._model.material.roughnessMap;Ki(this._model,Ji),this._model.material.specularMap=l,e.timer.addTickHandler(a)});function o(l){return l.enabled&&(l.grip.visible||l.hand.visible&&l.hand.joints.wrist&&l.hand.joints.wrist.visible)}let r=e.DEBUG,i=e.xrUI.visible,s=0,a=()=>{let l=e.xrUI.visible,p=0;for(let m of e.eventSys.hands)o(m)&&++p;if(l!==i||p!==s||r!==e.DEBUG){if(e.clockImage.isVisible=l||e.DEBUG,l&&p>0){let m=null;for(let F of e.eventSys.hands)o(F)&&(B(m)||F.handedness==="left")&&(m=F);let x=m.grip.visible?m.grip:m.hand.joints.wrist;if(x!==e.clockImage.object.parent){z(x,z(this,e.clockImage,e.batteryImage));let F=m.handedness==="left"?1:0;x===m.grip?(this.object.rotation.set(0,F*Ee,-ht,"XYZ"),this.object.position.set(0,0,.07)):(this.object.rotation.set(0,F*Ee,0,"XYZ"),this.object.position.set(0,0,0)),e.clockImage.scale.setScalar(.0175),e.clockImage.position.set(0,.029,0),e.clockImage.rotation.set(-ht,0,-ht),w(e.batteryImage)&&(e.batteryImage.scale.set(2,1,1).multiplyScalar(.008),e.batteryImage.position.set(.0075,.029,0),e.batteryImage.rotation.set(-ht,0,-ht))}}else e.xrUI.addItem(e.clockImage,{x:-1,y:1,height:.1}),w(e.batteryImage)&&e.xrUI.addItem(e.batteryImage,{x:.75,y:-1,width:.2,height:.1});i=l,s=p,r=e.DEBUG}}}dispose(){this.disposed||(w(this.object)&&(this.object.removeFromParent(),ye(this.object),this._model=null),this.disposed=!0)}};function bx(n,e){return n==="click"&&e&&(n="error"),`InteractionAudio-${n}`}var Bc=class{constructor(e,t){this.audio=e,this.eventSys=t;let o=r=>{if(r.pointer.type!=="nose"&&r.rayTarget&&r.rayTarget.clickable){let i=bx(r.type,!r.rayTarget.enabled);if(this.audio.hasClip(i)){let{x:s,y:a,z:l}=r.point;this.audio.setClipPosition(i,s,a,l),this.audio.playClip(i)}}};this.eventSys.addEventListener("enter",o),this.eventSys.addEventListener("exit",o),this.eventSys.addEventListener("click",o)}create(e,t,o){return this.audio.createClip(bx(e,!1),t,!1,!0,!1,!0,o,[])}};var es=class extends Error{constructor(e,t=null){super(e),this.innerError=t}};var Lc="Juniper:ThreeJS:EventSystem:RayTarget",Co=class extends re{constructor(e){super(),this.object=e,this.meshes=new Array,this._disabled=!1,this._clickable=!1,this._draggable=!1,this._navigable=!1,this.object.userData[Lc]=this}addMesh(e){return e.userData[Lc]=this,this.meshes.push(e),this}removeMesh(e){return je(this.meshes,e)&&delete e.userData[Lc],this}addMeshes(...e){for(let t of e)this.addMesh(t);return this}removeMeshes(...e){for(let t of e)this.removeMesh(t);return this}get disabled(){return this._disabled}set disabled(e){this._disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get clickable(){return this._clickable}set clickable(e){this._clickable=e}get draggable(){return this._draggable}set draggable(e){this._draggable=e}get navigable(){return this._navigable}set navigable(e){this._navigable=e}};function aA(n){return n instanceof Co}function ts(n){let e=null;return n&&(aA(n)?e=n:(n=st(n),n&&(e=n.userData[Lc])),e&&!gc(e)&&(e=null)),e}var Rc=class extends Co{constructor(e,t,o,r,i){e=e+At(16),super(ce(e)),this.enabledMaterial=o,this.disabledMaterial=r,this.mesh=Fc(`Mesh-${e}-enabled`,t,o),this.size=i,z(this,this.mesh),this.addMesh(this.mesh),this.clickable=!0,this.disabled=this.disabled,Tc(this,!0)}get size(){return this.mesh.scale.x}set size(e){this.mesh.scale.setScalar(e)}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.mesh.material=e?this.disabledMaterial:this.enabledMaterial}};var Pc=class{constructor(e,t,o,r,i){this.imagePaths=e,this.padding=t,this.buttonFillColor=o,this.labelFillColor=r,this.uvDescrips=new Qn,this.geoms=new Qn,this.canvas=null,this.texture=null,this.enabledMaterial=null,this.disabledMaterial=null,this.assetSets=new Qn(Array.from(this.imagePaths.entries()).map(([s,a,l])=>[s,a,new za(l,Xd,!i)])),this.assets=Array.from(this.assetSets.values()),this.ready=Promise.all(this.assets).then(()=>{let s=this.assets.map(W=>W.result),a=Math.max(...s.map(W=>W.width)),l=Math.max(...s.map(W=>W.height)),p=a*l*s.length,m=Math.sqrt(p),x=Math.floor(m/a),F=Math.ceil(s.length/x),v=x*a,k=F*l,D=Mu(v),b=Mu(k),P=v/D,O=k/b,I=a/D,L=l/b;this.canvas=Ha(D,b);let U=this.canvas.getContext("2d",{alpha:!1});U.fillStyle=this.buttonFillColor,U.fillRect(0,0,D,b);let C=0;for(let[W,$,Y]of this.assetSets.entries()){let ie=Y.result,ne=C%x,Te=(C-ne)/x,Fe=P*(ne*a/v),se=O*(1-Te/F)-L,rt=ne*a,hn=Te*l+b-k,ho=a-2*this.padding,Pt=l-2*this.padding;U.drawImage(ie,0,0,ie.width,ie.height,rt+this.padding,hn+this.padding,ho,Pt),this.uvDescrips.add(W,$,{u:Fe,v:se,du:I,dv:L}),++C}this.texture=new $m(this.canvas),this.enabledMaterial=new it({map:this.texture}),this.enabledMaterial.needsUpdate=!0,this.disabledMaterial=new it({map:this.texture,transparent:!0,opacity:.5}),this.disabledMaterial.needsUpdate=!0})}getImageSrc(e,t){let o=this.imagePaths.get(e),r=o&&o.get(t);if(!r)throw new es(`Button ${e}/${t} does not exist`,this.uvDescrips);return r}async getMeshButton(e,t,o){await this.ready;let r=this.uvDescrips.get(e),i=r&&r.get(t);if(!r||!i)throw new es(`Button ${e}/${t} does not exist`,this.uvDescrips);let s=this.geoms.get(e,t);if(!s){s=new Br(1,1,1,1),s.name=`Geometry:${e}/${t}`,this.geoms.add(e,t,s);let l=s.getAttribute("uv");for(let p=0;p<l.count;++p){let m=l.getX(p)*i.du+i.u,x=l.getY(p)*i.dv+i.v;l.setX(p,m),l.setY(p,x)}}return new Rc(t,s,this.enabledMaterial,this.disabledMaterial,o)}};function yx(n,e){n.element instanceof HTMLButtonElement&&(n.element.disabled=!e),wc(n,e)}function Dx(n,...e){te(n,...e.filter(mh)),z(n,...e.filter(Xf))}var Yn=class{constructor(e,t,o){this.element=e,this.object=t,this.displayType=o}get name(){return this.object.name}addEventListener(e,t,o){this.element.addEventListener(e,t,o)}dispatchEvent(e){return this.element.dispatchEvent(e)}removeEventListener(e,t,o){this.element.removeEventListener(e,t,o)}click(){this.element.click()}get visible(){return Et(this)}set visible(e){qe(this,e,this.displayType),this.object.visible=e}};var Hr=class extends Yn{constructor(e,t,o){let r=Xs(`${t} ${o}`);super(nr(r,or(r,Ao(e.getImageSrc(t,o)))),ce(`${name}-button`),"inline-block"),this.mesh=null,this.load(e,t,o)}async load(e,t,o){this.mesh=await e.getMeshButton(t,o,.2),this.mesh.disabled=this.disabled,z(this,this.mesh),this.mesh.object.visible=this.visible,this.mesh.addEventListener("click",()=>{this.element.click()})}get disabled(){return this.element.disabled}set disabled(e){this.element.disabled=e,this.mesh&&(this.mesh.disabled=e)}get visible(){return super.visible}set visible(e){super.visible=e,this.mesh&&Ve(this.mesh,e)}};var cA={type:"redrawn"},Kn=class extends yo{get object(){return this}get element(){return an(this.image.canvas)?this.image.canvas:null}get canvas(){return this._image.canvas}constructor(e,t,o,r,i){super(e,t,o,i),this._image=null,this.image=r}onRedrawn(){this.updateTexture(),this.dispatchEvent(cA)}get image(){return this._image}set image(e){this.image&&this.image.removeScope(this),this._image=e,this.image&&(this.image.addScopedEventListener(this,"redrawn",()=>this.onRedrawn()),this.setTextureMap(this.image.canvas),this.onRedrawn())}get imageWidth(){return this.image.width}get imageHeight(){return this.image.height}copy(e,t=!0){return super.copy(e,t),this.image=e.image,this}get isVisible(){return Et(this)}set isVisible(e){qe(this,e,"inline-block"),Ve(this,e),Ve(this.mesh,e),this.image.visible=e}};function Cx(n){return!n.started||n.finished}var ep=class extends ve{constructor(){super(!1),this.time=0,this.duration=0,this.onTick=null}begin(e,t,o){this.restart(),this.time=-e,this.duration=t,this.onTick=o,this.onTick(0)}update(e){Cx(this)||(this.time+=e/this.duration,this.time>=1?(this.onTick(1),this.resolve()):this.time>=0&&this.onTick(this.time))}},Vc=class{constructor(){this.animations=new Array}update(e){e=.001*e;for(let t of this.animations)t.update(e)}clear(){for(let e of this.animations)e.resolve()}start(e,t,o){let r=Ft(this.animations,Cx);return r||this.animations.push(r=new ep),r.begin(e,t,o),r}};var vn=class extends Kn{constructor(e,t,o,r,i){let s;r instanceof Nt?s=r:s=new Nt(r),super(e,t,o,s,i)}onRedrawn(){this.objectHeight=this.imageHeight,super.onRedrawn()}};var ns=class extends Co{constructor(e,t,o,r){if(super(ce(t)),this.env=e,w(o)){r=Object.assign({textFillColor:"white",fontFamily:"Segoe UI Emoji",fontSize:20,minHeight:.25,maxHeight:.25},r,{value:o}),this.image=new Nt(r);let i=At(16);this.enabledImage=this.createImage(`${i}-enabled`,1),this.disabledImage=this.createImage(`${i}-disabled`,.5),this.disabledImage.visible=!1,z(this,this.enabledImage,this.disabledImage)}this.addMesh(this.enabledImage.mesh),this.addMesh(this.disabledImage.mesh),this.clickable=!0,w(o)&&Tc(this,!0)}createImage(e,t){return new vn(this.env,`text-${e}`,"none",this.image,{side:Oi,opacity:t})}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.enabledImage.visible=!e,this.disabledImage.visible=e}};var Bx={bgStrokeColor:"black",bgStrokeSize:.04,textFillColor:"white",scale:150},Lx=Object.assign({},Bx,{padding:{left:.1,right:.1,top:.025,bottom:.025},fontSize:20,minHeight:.5,maxHeight:.5}),lA=Object.assign({},Lx,{bgFillColor:Ot(0,117,215)}),uA=Object.assign({},Lx,{bgFillColor:Ot(117,0,0)}),pA=Object.assign({},Bx,{bgFillColor:"white",textFillColor:"black",padding:{top:.1,left:.1,bottom:.4,right:.1},fontSize:25,minHeight:1,maxHeight:1}),dA=.9;function tp(n,e){return Object.assign({},n,{fontFamily:e})}var Ic=class extends Gn{constructor(e,t){super("Confirm action"),this.env=e,this.object=ce("ConfirmationDialog"),this.root=ce("Root"),this.animator=new Vc,this.a=0,this.b=0,this.confirmButton.innerText="Yes",this.cancelButton.innerText="No",this.mesh=new vn(this.env,"confirmationDialogLabel","none",tp(pA,t)),this.confirmButton3D=new ns(this.env,"confirmationDialogConfirmButton","Yes",tp(lA,t)),this.confirmButton3D.addEventListener("click",()=>this.confirmButton.click()),this.confirmButton3D.object.position.set(1,-.5,.5),this.cancelButton3D=new ns(this.env,"confirmationDialogCancelButton","No",tp(uA,t)),this.cancelButton3D.addEventListener("click",()=>this.cancelButton.click()),this.cancelButton3D.object.position.set(2,-.5,.5),te(this.container,sh(`calc(${Cn(100)} - ${To(2)})`),Mo("max-content")),te(this.contentArea,nh(Yd(18)),ph("center"),ch(To(1))),z(this,z(this.root,this.mesh,this.confirmButton3D,this.cancelButton3D)),Ve(this.root,!1),this.root.scale.setScalar(0),this.onTick=o=>{let r=ex(this.a+this.b*o,dA);this.root.scale.set(r,r,.01)}}get name(){return this.object.name}get visible(){return Et(this)}set visible(e){qe(this,e,"inline-block"),this.mesh.visible=e}update(e){this.animator.update(e)}async showHide(e,t){this.a=e,this.b=t,await this.animator.start(0,.25,this.onTick),this.animator.clear()}get use3D(){return this.env.renderer.xr.isPresenting||this.env.testSpaceLayout}async onShowing(){await super.onShowing(),this.use3D&&(this.root.visible=!0,await this.showHide(0,1))}onShown(){this.use3D&&(this.element.style.display="none")}async onClosing(){this.use3D&&(await this.showHide(1,-1),this.root.visible=!1),await super.onClosing()}prompt(e,t){return this.title=e,Qs(this.contentArea,t),this.mesh.image.value=t,this.showDialog()}};var Jn=class extends Yn{constructor(e,t,o,r){super(nr(),ce(`${t}-button`),"inline-block"),this.buttons=e,this.setName=t,this.activeName=o,this.inactiveName=r,this.enterButton=null,this.exitButton=null,this._isAvailable=!0,this._isEnabled=!0,this._isActive=!1,te(this,this.btnImage=or()),this.load()}async load(){let[e,t]=await Bn(this.buttons.getMeshButton(this.setName,this.activeName,.2),this.buttons.getMeshButton(this.setName,this.inactiveName,.2));z(this.object,this.enterButton=e,this.exitButton=t),this.enterButton.addEventListener("click",()=>this.element.click()),this.exitButton.addEventListener("click",()=>this.element.click()),this.refreshState()}get mesh(){return this.active?this.enterButton:this.exitButton}get available(){return this._isAvailable}set available(e){this._isAvailable=e,this.refreshState()}get active(){return this._isActive}set active(e){this._isActive=e,this.refreshState()}get enabled(){return this._isEnabled}set enabled(e){this._isEnabled=e,this.refreshState()}get visible(){return super.visible}set visible(e){super.visible=e,this.refreshState()}refreshState(){let e=this.active?this.inactiveName:this.activeName,t=`${e} ${this.setName}`;if(this.element.title=this.btnImage.title=t,this.btnImage.src=this.buttons.getImageSrc(this.setName,e),this.element.disabled=!this.available||!this.visible||!this.enabled,qe(this,this.available&&this.visible,"inline-block"),this.enterButton&&this.exitButton){wc(this,this.available&&this.visible&&this.enabled);let o=Ve(this.object,this.available&&this.visible);Ve(this.enterButton,o&&!this.active),Ve(this.exitButton,o&&this.active)}}};var Bo=class extends Jn{constructor(e,t){let o=q[t];super(e,o.toLowerCase(),"enter","exit"),this.mode=t}};function Rx(n){return new np(n)}var np=class extends Dr{pop(e){return this.addSubProgress(e)}};var os=class extends N{constructor(e,t){super(e),this.appName=t}},op=class extends os{constructor(e,t){super("apploading",e),this.appLoadParams=t}},rp=class extends os{constructor(e,t){super("apploaded",e),this.app=t}},ip=class extends os{constructor(e,t){super("appshown",e),this.app=t}},sp=class{constructor(e,t){this.loader=e,this.name=t,this.params=new Map}param(e,t){return this.params.set(e,t),this}load(e){return this.loader(this.name,this.params,e)}},Oc=class extends re{constructor(e,t){super(),this.env=e,this.getAppUrl=t,this.loadedModules=new Map,this.loadingApps=new Map,this.currentApps=new Map,this.cacheBustString=null}[Symbol.iterator](){return this.currentApps.values()}isLoaded(e){return this.currentApps.has(e)}get(e){return this.currentApps.get(e)}waitFor(e){if(this.isLoaded(e))return Promise.resolve(this.get(e));let t=new ve;return this.addScopedEventListener(this,"apploaded",o=>{o.appName===e&&(this.removeScope(this),t.resolve(o.app))}),t}async loadAppConstructor(e,t){if(this.loadedModules.has(e))w(t)&&t.end();else{let r=this.getAppUrl(e);if(w(this.cacheBustString)){let s=new Mr(r,location.href);s.query("v",this.cacheBustString),r=s.toString()}let i=this.env.fetcher.get(r).progress(t).useCache(!this.env.DEBUG).module().then(ko);this.loadedModules.set(e,i)}let{default:o}=await this.loadedModules.get(e);return o}app(e){return new sp(this.loadApp.bind(this),e)}loadApp(e,t,o){let r=null;t instanceof Map?r=t:o=t,o=o||this.env.loadingBar;let i=new op(e,r);if(this.dispatchEvent(i),!this.loadingApps.has(e)){let s=Rx(o),a=this.loadAppInstance(this.env,e,r,s.pop(10));this.loadingApps.set(e,a),o=s.pop(1)}return this.loadingApps.get(e)}async loadAppInstance(e,t,o,r){if(!this.currentApps.has(t)){let[i,s]=Pi(r,[1,10]),a=await this.loadAppConstructor(t,i),l=new a(e);l.addEventListener("quit",()=>this.unloadApp(t)),l.addEventListener("shown",()=>this.dispatchEvent(new ip(t,l))),w(o)&&await l.init(o),await l.load(s),this.currentApps.set(t,l),this.dispatchEvent(new rp(t,l))}return w(r)&&r.end(),this.currentApps.get(t)}unloadApp(e){let t=this.currentApps.get(e);setTimeout(()=>t.clearEventListeners(),100),Re(t),this.currentApps.delete(e),this.loadingApps.delete(e)}};var rs=new V;function is(n){return rs.copy(n),rs.y=0,rs.normalize(),Nn(Math.atan2(rs.x,rs.z))}function Px(n){return Nn(Math.asin(n.y))}var Ie;(function(n){n[n.Primary=0]="Primary",n[n.Secondary=1]="Secondary",n[n.Menu=2]="Menu",n[n.Info=3]="Info"})(Ie||(Ie={}));function Lo(n,e){return n.xr.isPresenting?n.xr.getCamera():e}function Vx(n,e,t,o){let r=n.elements;e.set(r[4],r[5],r[6]),t.set(-r[8],-r[9],-r[10]),o.set(r[12],r[13],r[14]),e.normalize(),t.normalize()}function hA(n){return n===DeviceOrientationEvent&&"requestPermission"in n&&ee(n.requestPermission)}var De;(function(n){n.None="none",n.MouseFPS="mousefirstperson",n.MouseDrag="mousedrag",n.ScreenEdge="mouseedge",n.Touch="touchswipe",n.Gamepad="gamepad"})(De||(De={}));var ap=class extends N{constructor(){super("avatarreset")}},Wc=class extends re{set disableVertical(e){this._disableVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set invertVertical(e){this._invertVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set disableHorizontal(e){this._disableHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}set invertHorizontal(e){this._invertHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}get height(){return this.head.position.y}get object(){return this.head}get worldHeadingRadians(){return this._worldHeadingRadians}get worldPitchRadians(){return this._worldPitchRadians}get fov(){return this.env.camera.fov}set fov(e){e!==this.fov&&(this.env.camera.fov=e,this.env.camera.updateProjectionMatrix())}get stage(){return this.head.parent}constructor(e,t){super(),this.env=e,this.avatarResetEvt=new ap,this.controlMode=De.None,this.snapTurnRadians=nt(30),this.sensitivities=new Map([[De.MouseDrag,100],[De.MouseFPS,-100],[De.Touch,50],[De.Gamepad,1]]),this.B=new V(0,0,1),this.F=new V,this.U=new V,this.P=new V,this.M=new we,this.E=new af,this.Q1=new de,this.Q2=new de,this.Q3=new de(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this.Q4=new de,this.motion=new Ue,this.rotStage=new we,this.axisControl=new Ue(0,0),this.deviceQ=new de().identity(),this.uv=new Ue,this.duv=new Ue,this.move=new V,this.move2=new V,this.radialAcceleration=new Ue(1.5,1.5),this.radialSpeed=new Ue(1,1),this.radialEdgeFactor=3/4,this.minFOVDegrees=15,this.maxFOVDegrees=120,this.minPitchRadians=nt(-85),this.maxPitchRadians=nt(85),this.followers=new Array,this.dz=0,this._headingRadians=0,this._pitchRadians=0,this._rollRadians=0,this.headX=0,this.headZ=0,this._worldHeadingRadians=0,this._worldPitchRadians=0,this.fwrd=!1,this.back=!1,this.left=!1,this.rght=!1,this.fwrd2=!1,this.back2=!1,this.left2=!1,this.rght2=!1,this.up=!1,this.down=!1,this.grow=!1,this.shrk=!1,this._keyboardControlEnabled=!1,this.worldPos=new V,this.worldQuat=new de,this.lockMovement=!1,this.fovZoomEnabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.onDeviceOrientationChangeEvent=null,this.onScreenOrientationChangeEvent=null,this.motionEnabled=!1,this.pointersToSend=new Array,this.disableHorizontal=!1,this.disableVertical=!1,this.invertHorizontal=!1,this.invertVertical=!0,this._height=this.env.defaultAvatarHeight,this.head=ce("Head",t);let o=!1,r=(i,s)=>{if(i==="w"&&(this.fwrd=s),i==="s"&&(this.back=s),i==="a"&&(this.left=s),i==="d"&&(this.rght=s),i==="e"&&(this.up=s),i==="q"&&(this.down=s),i==="ArrowUp"&&(this.fwrd2=s),i==="ArrowDown"&&(this.back2=s),i==="ArrowLeft"&&(this.left2=s),i==="ArrowRight"&&(this.rght2=s),i==="r"&&(this.grow=s),i==="f"&&(this.shrk=s),i==="Home"){let a=o;o=s,a&&!o&&(this.reset(),this.dispatchEvent(this.avatarResetEvt))}};this.onKeyDown=i=>r(i.key,sr(i)),this.onKeyUp=i=>r(i.key,!1),this.keyboardControlEnabled=!0,matchMedia("(pointer: coarse)").matches?this.controlMode=De.Touch:matchMedia("(pointer: fine)").matches&&(this.controlMode=De.MouseDrag),globalThis.isSecureContext&&vi()&&!wn()&&(this.onDeviceOrientationChangeEvent=i=>{this.deviceOrientation=i},this.onScreenOrientationChangeEvent=()=>{"screen"in globalThis&&"orientation"in screen?this.screenOrientation=screen.orientation.angle:"window"in globalThis&&"orientation"in globalThis.window&&(this.screenOrientation=globalThis.window.orientation||0)},Rh?en(()=>this.startMotionControl()):this.startMotionControl())}snapTurn(e){this.setHeading(this.headingRadians-this.snapTurnRadians*e)}get keyboardControlEnabled(){return this._keyboardControlEnabled}set keyboardControlEnabled(e){this._keyboardControlEnabled!==e&&(this._keyboardControlEnabled=e,this._keyboardControlEnabled?(this.env.renderer.domElement.addEventListener("keydown",this.onKeyDown),this.env.renderer.domElement.addEventListener("keyup",this.onKeyUp)):(this.env.renderer.domElement.removeEventListener("keydown",this.onKeyDown),this.env.renderer.domElement.removeEventListener("keyup",this.onKeyUp)))}addFollower(e){this.followers.push(e)}onMove(e,t,o){this.setMode(e),e.canMoveView&&this.controlMode!==De.None&&this.gestureSatisfied(e)&&(this.uv.copy(t),this.duv.copy(o))}setMode(e){e.type==="remote"||e.type==="nose"||(e.type==="hand"?this.controlMode=De.None:e.type==="gamepad"?this.controlMode=De.Gamepad:e.rayTarget&&e.rayTarget.draggable&&!this.env.eventSys.mouse.isPointerLocked&&e.isPressed(Ie.Primary)?this.controlMode=De.ScreenEdge:e.type==="touch"||e.type==="pen"?this.controlMode=De.Touch:e.type==="mouse"?this.controlMode=this.env.eventSys.mouse.isPointerLocked?De.MouseFPS:De.MouseDrag:mn(e.type))}gestureSatisfied(e){return this.controlMode===De.None?!1:this.controlMode===De.Gamepad||this.controlMode===De.MouseFPS||this.controlMode===De.ScreenEdge||e.isPressed(Ie.Primary)}get name(){return this.object.name}set name(e){this.object.name=e}get headingRadians(){return this._headingRadians}setHeading(e){this._headingRadians=Nn(e)}get pitchRadians(){return this._pitchRadians}setPitch(e,t,o){this._pitchRadians=Nn(e+Ee)-Ee,this._pitchRadians=Un(this._pitchRadians,t,o)}get rollRadians(){return this._rollRadians}setRoll(e){this._rollRadians=Nn(e)}setHeadingImmediate(e){this.setHeading(e),this.updateOrientation(),this.resetFollowers()}setOrientationImmediate(e,t){this.setHeading(e),this._pitchRadians=Nn(t),this.updateOrientation()}zoom(e){this.dz=e}update(e){e*=.001;let t=this.deviceOrientation;if(t&&ut(t.alpha)&&ut(t.beta)&&ut(t.gamma)){let o=nt(t.alpha)+this.alphaOffset,r=nt(t.beta),i=nt(t.gamma),s=this.screenOrientation?nt(this.screenOrientation):0;this.E.set(r,o,-i,"YXZ"),this.Q2.setFromAxisAngle(this.B,-s),this.Q4.setFromEuler(this.E).multiply(this.Q3).multiply(this.Q2),this.deviceQ.slerp(this.Q4,.8)}if(!this.lockMovement){if(this.fovZoomEnabled&&Math.abs(this.dz)>0){let r=Math.pow(.95,5e3*e);this.dz=Nm(r*this.dz),this.fov=Un(this.env.camera.fov-this.dz,this.minFOVDegrees,this.maxFOVDegrees)}if(this.controlMode===De.ScreenEdge)this.uv.manhattanLength()>0&&(this.motion.set(this.scaleRadialComponent(-this.uv.x,this.radialSpeed.x,this.radialAcceleration.x),this.scaleRadialComponent(this.uv.y,this.radialSpeed.y,this.radialAcceleration.y)).multiplyScalar(e),this.setHeading(this.headingRadians+this.motion.x),this.setPitch(this.pitchRadians+this.motion.y,this.minPitchRadians,this.maxPitchRadians),this.setRoll(0));else if(this.sensitivities.has(this.controlMode)&&this.duv.manhattanLength()>0){let r=this.sensitivities.get(this.controlMode)||1;this.motion.copy(this.duv).multiplyScalar(r*e).multiply(this.axisControl),this.setHeading(this.headingRadians+this.motion.x),this.setPitch(this.pitchRadians+this.motion.y,this.minPitchRadians,this.maxPitchRadians),this.setRoll(0)}if(this.Q1.setFromAxisAngle(this.stage.up,this.worldHeadingRadians),this.fwrd||this.back||this.left||this.rght||this.up||this.down){let r=(this.left?1:0)+(this.rght?-1:0),i=(this.down?1:0)+(this.up?-1:0),s=(this.fwrd?1:0)+(this.back?-1:0);this.move.set(r,i,s);let a=this.move.length();a>0&&(this.move.multiplyScalar(e/a).applyQuaternion(this.Q1),this.stage.position.add(this.move))}if(this.fwrd2||this.back2||this.left2||this.rght2){let r=(this.left2?1:0)+(this.rght2?-1:0),i=(this.fwrd2?1:0)+(this.back2?-1:0);this.move2.set(r,0,i);let s=this.move2.length();s>0&&(this.move2.multiplyScalar(e/s).applyQuaternion(this.Q1),this.headX+=this.move2.x,this.headZ+=this.move2.z)}if(this.grow||this.shrk){let r=(this.shrk?-1:0)+(this.grow?1:0);this._height+=r*e,this._height=Un(this._height,1,2)}this.updateOrientation();let o=Math.pow(.95,100*e);this.duv.multiplyScalar(o),this.duv.manhattanLength()<=1e-4&&this.duv.setScalar(0)}}scaleRadialComponent(e,t,o){let r=Math.abs(e);return Math.sign(e)*Math.pow(Math.max(0,r-this.radialEdgeFactor)/(1-this.radialEdgeFactor),o)*t}lookAt(e){e.getWorldPosition(this.P),this.P.sub(this.worldPos);let t=3*ht-Math.atan2(this.P.z,this.P.x),o=Math.atan2(this.P.y,this.P.length());this.setOrientationImmediate(t,o)}updateOrientation(){let e=Lo(this.env.renderer,this.env.camera);this.rotStage.makeRotationY(this._headingRadians),this.stage.matrix.makeTranslation(this.stage.position.x,this.stage.position.y,this.stage.position.z).multiply(this.rotStage),this.stage.matrix.decompose(this.stage.position,this.stage.quaternion,this.stage.scale),this.env.renderer.xr.isPresenting?(this.M.copy(this.stage.matrixWorld).invert(),this.head.position.copy(e.position).applyMatrix4(this.M),this.head.quaternion.copy(this.stage.quaternion).invert().multiply(e.quaternion)):(this.head.position.set(this.headX,this._height,this.headZ),this.E.set(this._pitchRadians,0,this._rollRadians,"XYZ"),this.head.quaternion.setFromEuler(this.E).premultiply(this.deviceQ)),this.env.camera.position.copy(this.head.position),this.env.camera.quaternion.copy(this.head.quaternion),this.head.getWorldPosition(this.worldPos),this.head.getWorldQuaternion(this.worldQuat),this.F.set(0,0,-1).applyQuaternion(this.worldQuat),this._worldHeadingRadians=is(this.F),this._worldPitchRadians=Px(this.F),Vx(this.head.matrixWorld,this.U,this.F,this.P)}reset(){this.stage.position.setScalar(0),this.setHeadingImmediate(0)}resetFollowers(){for(let e of this.followers)e.reset(this.height,this.worldPos,this.worldHeadingRadians)}async getPermission(){return"DeviceOrientationEvent"in window?hA(DeviceOrientationEvent)?await DeviceOrientationEvent.requestPermission():"granted":"not-supported"}async startMotionControl(){if(!this.motionEnabled){this.onScreenOrientationChangeEvent();let e=await this.getPermission();this.motionEnabled=e==="granted",this.motionEnabled&&("ScreenOrientation"in window?screen.orientation.addEventListener("change",this.onScreenOrientationChangeEvent):window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}}stopMotionControl(){this.motionEnabled&&("ScreenOrientation"in window?screen.orientation.removeEventListener("change",this.onScreenOrientationChangeEvent):window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.motionEnabled=!1)}dispose(){this.stopMotionControl()}get bufferSize(){return 133}writeState(e){pe(this.pointersToSend);let t=this.env.avatar.bufferSize;for(let o of this.env.eventSys.pointers)o.canSend&&(t+=o.bufferSize,this.pointersToSend.push(o));e.length=t,e.position=0,e.writeFloat32(this.height),e.writeMatrix512(this.stage.matrix),e.writeMatrix512(this.head.matrixWorld),e.writeUint8(this.pointersToSend.length);for(let o of this.pointersToSend)o.writeState(e)}};function Ix(n){let e=n.attributes.position,t=n.attributes.normal,o=n.attributes.uv;for(let r=0;r<t.count;++r){let i=r*t.itemSize,s=r*t.itemSize+1,a=r*t.itemSize+2,l=t.array[i],p=t.array[s],m=t.array[a],x=Math.abs(l),F=Math.abs(p),v=Math.abs(m),k=e.array[i],D=e.array[s],b=e.array[a],P=Math.abs(k),O=Math.abs(D),I=Math.abs(b),L=r*o.itemSize,U=r*o.itemSize+1,C=o.array[L],W=o.array[U],$=0,Y=x,ie=P;F>Y&&($=1,Y=F,ie=O),v>Y&&($=2,Y=v,ie=I),$===0?k<0?(C=-b,W=D):(C=b,W=D):$===1?D<0?(C=k,W=-b):(C=k,W=b):b<0?(C=k,W=D):(C=-k,W=D),C=(C/ie+1)/8,W=(W/ie+1)/6,$===0?k<0?(C+=0,W+=1/3):(C+=.5,W+=1/3):$===1?D<0?(C+=.25,W+=0):(C+=.25,W+=2/3):b<0?(C+=.25,W+=1/3):(C+=.75,W+=1/3);let ne=o.array;ne[L]=C,ne[U]=W}}var ss=new nc(1,1,1,1,1,1);ss.name="CubeGeom";ss.computeBoundingBox();ss.computeBoundingSphere();var Ox=ss.clone();Ox.name="InvertedCubeGeom";Ix(Ox);var ln=class extends _t{constructor(e,t,o,r){super(ss,r),this.scale.set(e,t,o)}};function Wx(n,e,t,o,r){let i=new ln(e,t,o,r);return i.name=n,i}var Hc=class{constructor(e,t=.15){this.opacity=1,this.direction=0,this.task=new ve(!1),this.material=Or({name:"FaderMaterial",color:0,side:Jm}),this.object=Wx(e,1,1,1,this.material),this.object.renderOrder=Number.MAX_SAFE_INTEGER,this.speed=1/t,this.object.layers.enableAll()}async start(e){this.direction=e,this.task.restart(),await this.task}async fadeOut(){this.direction!=1&&await this.start(1)}async fadeIn(){this.direction!=-1&&await this.start(-1)}update(e){if(this.direction!==0){let t=this.direction*this.speed*e/1e3;0<=this.opacity&&this.opacity<=1&&(this.opacity+=t),(this.direction===1&&this.opacity>=1||this.direction===-1&&this.opacity<=0)&&(this.opacity=Un(this.opacity,0,1),this.direction=0,this.task.resolve())}this.material.opacity=this.opacity,this.material.transparent=this.opacity<1,this.material.needsUpdate=!0}};var Nc=0;var Nr=3;function Hx(n,e){n=st(n),n.traverse(t=>t.layers.set(e))}function Nx(n,e){n=st(n),n.traverse(t=>t.layers.enable(e))}function Ct(n,e,t,o,r,i){let s=new ln(o,r,i,cx);return s.position.set(n,e,t),s}var mA=.1,Uc=class extends vo{constructor(){super(),this.value=0,this.targetValue=0,this.object=ce("LoadingBar"),this._enabled=!0,this.valueBar=new ln(0,1,1,ju),this.valueBar.scale.set(0,1,1);let e=ce("ValueBarContainer");e.scale.set(1,.1,.1),z(this,z(e,this.valueBar),Ct(-.5,0,-.05,.01,.1,.01),Ct(-.5,0,.05,.01,.1,.01),Ct(.5,0,-.05,.01,.1,.01),Ct(.5,0,.05,.01,.1,.01),Ct(-.5,-.05,0,.01,.01,.1),Ct(.5,-.05,0,.01,.01,.1),Ct(-.5,.05,0,.01,.01,.1),Ct(.5,.05,0,.01,.01,.1),Ct(0,-.05,-.05,1,.01,.01),Ct(0,.05,-.05,1,.01,.01),Ct(0,-.05,.05,1,.01,.01),Ct(0,.05,.05,1,.01,.01)),Hx(this,Nr)}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,Ve(this,Vr(this)||this.enabled))}report(e,t,o){super.report(e,t,o),this.targetValue=this.p}update(e){this.object.parent.visible&&(this.value=Math.min(this.targetValue,this.value+mA*e),this.valueBar.scale.set(this.value,1,1),this.valueBar.position.x=this.value/2-.5,Ve(this,this.enabled&&this.value>0))}};if(!cp()){let n=Element.prototype,e=Document.prototype;"webkitRequestFullscreen"in n?(n.requestFullscreen=n.webkitRequestFullscreen,e.exitFullscreen=e.webkitRequestFullscreen,Object.defineProperties(e,{fullscreenEnabled:{get:function(){return this.webkitFullscreenEnabled}},fullscreenElement:{get:function(){return this.webkitFullscreenElement}}})):"mozRequestFullScreen"in n?(n.requestFullscreen=n.mozRequestFullScreen,e.exitFullscreen=e.mozCancelFullScreen,Object.defineProperties(e,{fullscreenEnabled:{get:function(){return this.mozFullScreenEnabled}},fullscreenElement:{get:function(){return this.mozFullScreenElement}}})):"msRequestFullscreen"in n&&(n.requestFullscreen=n.msRequestFullscreen,e.exitFullscreen=e.msExitFullscreen,Object.defineProperties(e,{fullscreenEnabled:{get:function(){return this.msFullscreenEnabled}},fullscreenElement:{get:function(){return this.msFullscreenElement}}}))}function cp(){return"requestFullscreen"in HTMLElement.prototype}var fA=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},zc=fA;var as=Symbol("@@webxr-polyfill/EventTarget"),Sn=class{constructor(){this[as]={listeners:new Map}}addEventListener(e,t){if(typeof e!="string")throw new Error("`type` must be a string");if(typeof t!="function")throw new Error("`listener` must be a function");let o=this[as].listeners.get(e)||[];o.push(t),this[as].listeners.set(e,o)}removeEventListener(e,t){if(typeof e!="string")throw new Error("`type` must be a string");if(typeof t!="function")throw new Error("`listener` must be a function");let o=this[as].listeners.get(e)||[];for(let r=o.length;r>=0;r--)o[r]===t&&o.pop()}dispatchEvent(e,t){let o=this[as].listeners.get(e)||[],r=[];for(let i=0;i<o.length;i++)r[i]=o[i];for(let i of r)i(t);typeof this[`on${e}`]=="function"&&this[`on${e}`](t)}};var ze=typeof Float32Array<"u"?Float32Array:Array;var OP=Math.PI/180;function un(){let n=new ze(16);return ze!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function Ux(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Zn(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ro(n,e){let t=e[0],o=e[1],r=e[2],i=e[3],s=e[4],a=e[5],l=e[6],p=e[7],m=e[8],x=e[9],F=e[10],v=e[11],k=e[12],D=e[13],b=e[14],P=e[15],O=t*a-o*s,I=t*l-r*s,L=t*p-i*s,U=o*l-r*a,C=o*p-i*a,W=r*p-i*l,$=m*D-x*k,Y=m*b-F*k,ie=m*P-v*k,ne=x*b-F*D,Te=x*P-v*D,Fe=F*P-v*b,se=O*Fe-I*Te+L*ne+U*ie-C*Y+W*$;return se?(se=1/se,n[0]=(a*Fe-l*Te+p*ne)*se,n[1]=(r*Te-o*Fe-i*ne)*se,n[2]=(D*W-b*C+P*U)*se,n[3]=(F*C-x*W-v*U)*se,n[4]=(l*ie-s*Fe-p*Y)*se,n[5]=(t*Fe-r*ie+i*Y)*se,n[6]=(b*L-k*W-P*I)*se,n[7]=(m*W-F*L+v*I)*se,n[8]=(s*Te-a*ie+p*$)*se,n[9]=(o*ie-t*Te-i*$)*se,n[10]=(k*C-D*L+P*O)*se,n[11]=(x*L-m*C-v*O)*se,n[12]=(a*Y-s*ne-l*$)*se,n[13]=(t*ne-o*Y+r*$)*se,n[14]=(D*I-k*U-b*O)*se,n[15]=(m*U-x*I+F*O)*se,n):null}function Tn(n,e,t){let o=e[0],r=e[1],i=e[2],s=e[3],a=e[4],l=e[5],p=e[6],m=e[7],x=e[8],F=e[9],v=e[10],k=e[11],D=e[12],b=e[13],P=e[14],O=e[15],I=t[0],L=t[1],U=t[2],C=t[3];return n[0]=I*o+L*a+U*x+C*D,n[1]=I*r+L*l+U*F+C*b,n[2]=I*i+L*p+U*v+C*P,n[3]=I*s+L*m+U*k+C*O,I=t[4],L=t[5],U=t[6],C=t[7],n[4]=I*o+L*a+U*x+C*D,n[5]=I*r+L*l+U*F+C*b,n[6]=I*i+L*p+U*v+C*P,n[7]=I*s+L*m+U*k+C*O,I=t[8],L=t[9],U=t[10],C=t[11],n[8]=I*o+L*a+U*x+C*D,n[9]=I*r+L*l+U*F+C*b,n[10]=I*i+L*p+U*v+C*P,n[11]=I*s+L*m+U*k+C*O,I=t[12],L=t[13],U=t[14],C=t[15],n[12]=I*o+L*a+U*x+C*D,n[13]=I*r+L*l+U*F+C*b,n[14]=I*i+L*p+U*v+C*P,n[15]=I*s+L*m+U*k+C*O,n}function $n(n,e,t){let o=e[0],r=e[1],i=e[2],s=e[3],a=o+o,l=r+r,p=i+i,m=o*a,x=o*l,F=o*p,v=r*l,k=r*p,D=i*p,b=s*a,P=s*l,O=s*p;return n[0]=1-(v+D),n[1]=x+O,n[2]=F-P,n[3]=0,n[4]=x-O,n[5]=1-(m+D),n[6]=k+b,n[7]=0,n[8]=F+P,n[9]=k-b,n[10]=1-(m+v),n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n}function Gc(n,e){return n[0]=e[12],n[1]=e[13],n[2]=e[14],n}function Xc(n,e){let t=e[0]+e[5]+e[10],o=0;return t>0?(o=Math.sqrt(t+1)*2,n[3]=.25*o,n[0]=(e[6]-e[9])/o,n[1]=(e[8]-e[2])/o,n[2]=(e[1]-e[4])/o):e[0]>e[5]&&e[0]>e[10]?(o=Math.sqrt(1+e[0]-e[5]-e[10])*2,n[3]=(e[6]-e[9])/o,n[0]=.25*o,n[1]=(e[1]+e[4])/o,n[2]=(e[8]+e[2])/o):e[5]>e[10]?(o=Math.sqrt(1+e[5]-e[0]-e[10])*2,n[3]=(e[8]-e[2])/o,n[0]=(e[1]+e[4])/o,n[1]=.25*o,n[2]=(e[6]+e[9])/o):(o=Math.sqrt(1+e[10]-e[0]-e[5])*2,n[3]=(e[1]-e[4])/o,n[0]=(e[8]+e[2])/o,n[1]=(e[6]+e[9])/o,n[2]=.25*o),n}function jc(n,e,t,o,r){let i=1/Math.tan(e/2),s;return n[0]=i/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,r!=null&&r!==1/0?(s=1/(o-r),n[10]=(r+o)*s,n[14]=2*r*o*s):(n[10]=-1,n[14]=-2*o),n}function St(){let n=new ze(3);return ze!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function lp(n){var e=new ze(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function xA(n){let e=n[0],t=n[1],o=n[2];return Math.sqrt(e*e+t*t+o*o)}function mt(n,e,t){let o=new ze(3);return o[0]=n,o[1]=e,o[2]=t,o}function up(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function Ur(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function pp(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function qc(n,e){let t=e[0],o=e[1],r=e[2],i=t*t+o*o+r*r;return i>0&&(i=1/Math.sqrt(i),n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i),n}function us(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Qc(n,e,t){let o=e[0],r=e[1],i=e[2],s=t[0],a=t[1],l=t[2];return n[0]=r*l-i*a,n[1]=i*s-o*l,n[2]=o*a-r*s,n}function Vo(n,e,t){let o=t[0],r=t[1],i=t[2],s=t[3],a=e[0],l=e[1],p=e[2],m=r*p-i*l,x=i*a-o*p,F=o*l-r*a,v=r*F-i*x,k=i*m-o*F,D=o*x-r*m,b=s*2;return m*=b,x*=b,F*=b,v*=2,k*=2,D*=2,n[0]=a+m+v,n[1]=l+x+k,n[2]=p+F+D,n}function Gx(n,e){let t=mt(n[0],n[1],n[2]),o=mt(e[0],e[1],e[2]);qc(t,t),qc(o,o);let r=us(t,o);return r>1?0:r<-1?Math.PI:Math.acos(r)}var Xx=xA;var WP=function(){let n=St();return function(e,t,o,r,i,s){let a,l;for(t||(t=3),o||(o=0),r?l=Math.min(r*t+o,e.length):l=e.length,a=o;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],i(n,n,s),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2];return e}}();function jx(){let n=new ze(9);return ze!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function wA(){let n=new ze(4);return ze!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function qx(n){let e=new ze(4);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function Qx(n,e,t,o){let r=new ze(4);return r[0]=n,r[1]=e,r[2]=t,r[3]=o,r}function Yx(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function Kx(n,e){let t=e[0],o=e[1],r=e[2],i=e[3],s=t*t+o*o+r*r+i*i;return s>0&&(s=1/Math.sqrt(s),n[0]=t*s,n[1]=o*s,n[2]=r*s,n[3]=i*s),n}var HP=function(){let n=wA();return function(e,t,o,r,i,s){let a,l;for(t||(t=4),o||(o=0),r?l=Math.min(r*t+o,e.length):l=e.length,a=o;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],n[3]=e[a+3],i(n,n,s),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2],e[a+3]=n[3];return e}}();function Tt(){let n=new ze(4);return ze!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function AA(n,e,t){t=t*.5;let o=Math.sin(t);return n[0]=o*e[0],n[1]=o*e[1],n[2]=o*e[2],n[3]=Math.cos(t),n}function dp(n,e,t){let o=e[0],r=e[1],i=e[2],s=e[3],a=t[0],l=t[1],p=t[2],m=t[3];return n[0]=o*m+s*a+r*p-i*l,n[1]=r*m+s*l+i*a-o*p,n[2]=i*m+s*p+o*l-r*a,n[3]=s*m-o*a-r*l-i*p,n}function zr(n,e,t,o){let r=e[0],i=e[1],s=e[2],a=e[3],l=t[0],p=t[1],m=t[2],x=t[3],F,v,k,D,b;return v=r*l+i*p+s*m+a*x,v<0&&(v=-v,l=-l,p=-p,m=-m,x=-x),1-v>1e-6?(F=Math.acos(v),k=Math.sin(F),D=Math.sin((1-o)*F)/k,b=Math.sin(o*F)/k):(D=1-o,b=o),n[0]=D*r+b*l,n[1]=D*i+b*p,n[2]=D*s+b*m,n[3]=D*a+b*x,n}function hp(n,e){let t=e[0],o=e[1],r=e[2],i=e[3],s=t*t+o*o+r*r+i*i,a=s?1/s:0;return n[0]=-t*a,n[1]=-o*a,n[2]=-r*a,n[3]=i*a,n}function _A(n,e){let t=e[0]+e[4]+e[8],o;if(t>0)o=Math.sqrt(t+1),n[3]=.5*o,o=.5/o,n[0]=(e[5]-e[7])*o,n[1]=(e[6]-e[2])*o,n[2]=(e[1]-e[3])*o;else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);let i=(r+1)%3,s=(r+2)%3;o=Math.sqrt(e[r*3+r]-e[i*3+i]-e[s*3+s]+1),n[r]=.5*o,o=.5/o,n[3]=(e[i*3+s]-e[s*3+i])*o,n[i]=(e[i*3+r]+e[r*3+i])*o,n[s]=(e[s*3+r]+e[r*3+s])*o}return n}function Jx(n,e,t,o){let r=.5*Math.PI/180;e*=r,t*=r,o*=r;let i=Math.sin(e),s=Math.cos(e),a=Math.sin(t),l=Math.cos(t),p=Math.sin(o),m=Math.cos(o);return n[0]=i*l*m-s*a*p,n[1]=s*a*m+i*l*p,n[2]=s*l*p-i*a*m,n[3]=s*l*m+i*a*p,n}var mp=qx,Zx=Qx,Kc=Yx;var ps=Kx;var KP=function(){let n=St(),e=mt(1,0,0),t=mt(0,1,0);return function(o,r,i){let s=us(r,i);return s<-.999999?(Qc(n,e,r),Xx(n)<1e-6&&Qc(n,t,r),qc(n,n),AA(o,n,Math.PI),o):s>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(Qc(n,r,i),o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=1+s,ps(o,o))}}(),JP=function(){let n=Tt(),e=Tt();return function(t,o,r,i,s,a){return zr(n,o,s,a),zr(e,r,i,a),zr(t,n,e,2*a*(1-a)),t}}(),ZP=function(){let n=jx();return function(e,t,o,r){return n[0]=o[0],n[3]=o[1],n[6]=o[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],ps(e,_A(e,n))}}();var le=Symbol("@@webxr-polyfill/XRRigidTransform"),Io=class n{constructor(){if(this[le]={matrix:null,position:null,orientation:null,inverse:null},arguments.length===0)this[le].matrix=Zn(new Float32Array(16));else if(arguments.length===1)arguments[0]instanceof Float32Array?this[le].matrix=arguments[0]:(this[le].position=this._getPoint(arguments[0]),this[le].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(arguments.length===2)this[le].position=this._getPoint(arguments[0]),this[le].orientation=this._getPoint(arguments[1]);else throw new Error("Too many arguments!");if(this[le].matrix){let e=St();Gc(e,this[le].matrix),this[le].position=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2]});let t=Tt();Xc(t,this[le].matrix),this[le].orientation=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2],w:t[3]})}else this[le].matrix=Zn(new Float32Array(16)),$n(this[le].matrix,Zx(this[le].orientation.x,this[le].orientation.y,this[le].orientation.z,this[le].orientation.w),mt(this[le].position.x,this[le].position.y,this[le].position.z))}_getPoint(e){return e instanceof DOMPointReadOnly?e:DOMPointReadOnly.fromPoint(e)}get matrix(){return this[le].matrix}get position(){return this[le].position}get orientation(){return this[le].orientation}get inverse(){if(this[le].inverse===null){let e=Zn(new Float32Array(16));Ro(e,this[le].matrix),this[le].inverse=new n(e),this[le].inverse[le].inverse=this}return this[le].inverse}};var Se=Symbol("@@webxr-polyfill/XRSpace");var Bt=class{constructor(e=null,t=null){this[Se]={specialType:e,inputSource:t,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[Se].specialType}get _inputSource(){return this[Se].inputSource}_ensurePoseUpdated(e,t){t!=this[Se].lastFrameId&&(this[Se].lastFrameId=t,this._onPoseUpdate(e))}_onPoseUpdate(e){this[Se].specialType=="viewer"&&(this._baseMatrix=e.getBasePoseMatrix())}set _baseMatrix(e){this[Se].baseMatrix=e,this[Se].inverseBaseMatrix=null}get _baseMatrix(){return this[Se].baseMatrix||this[Se].inverseBaseMatrix&&(this[Se].baseMatrix=new Float32Array(16),Ro(this[Se].baseMatrix,this[Se].inverseBaseMatrix)),this[Se].baseMatrix}set _inverseBaseMatrix(e){this[Se].inverseBaseMatrix=e,this[Se].baseMatrix=null}get _inverseBaseMatrix(){return this[Se].inverseBaseMatrix||this[Se].baseMatrix&&(this[Se].inverseBaseMatrix=new Float32Array(16),Ro(this[Se].inverseBaseMatrix,this[Se].baseMatrix)),this[Se].inverseBaseMatrix}_getSpaceRelativeTransform(e){if(!this._inverseBaseMatrix||!e._baseMatrix)return null;let t=new Float32Array(16);return Tn(t,this._inverseBaseMatrix,e._baseMatrix),new Io(t)}};var vA=1.6,eo=Symbol("@@webxr-polyfill/XRReferenceSpace"),ds=["viewer","local","local-floor","bounded-floor","unbounded"];function SA(n){return n==="bounded-floor"||n==="local-floor"}var to=class n extends Bt{constructor(e,t=null){if(!ds.includes(e))throw new Error(`XRReferenceSpaceType must be one of ${ds}`);if(super(e),e==="bounded-floor"&&!t)throw new Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");SA(e)&&!t&&(t=Zn(new Float32Array(16)),t[13]=vA),this._inverseBaseMatrix=t||Zn(new Float32Array(16)),this[eo]={type:e,transform:t,originOffset:Zn(new Float32Array(16))}}_transformBasePoseMatrix(e,t){Tn(e,this._inverseBaseMatrix,t)}_originOffsetMatrix(){return this[eo].originOffset}_adjustForOriginOffset(e){let t=new Float32Array(16);Ro(t,this[eo].originOffset),Tn(e,t,e)}_getSpaceRelativeTransform(e){let t=super._getSpaceRelativeTransform(e);return this._adjustForOriginOffset(t.matrix),new XRRigidTransform(t.matrix)}getOffsetReferenceSpace(e){let t=new n(this[eo].type,this[eo].transform,this[eo].bounds);return Tn(t[eo].originOffset,this[eo].originOffset,e.matrix),t}};var at=Symbol("@@webxr-polyfill/XR"),TA=["inline","immersive-vr","immersive-ar"],MA={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},kA=`Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode
or navigator.xr.requestSession('inline') prior to requesting an immersive
session. This is a limitation specific to the WebXR Polyfill and does not apply
to native implementations of the API.`,hs=class extends Sn{constructor(e){super(),this[at]={device:null,devicePromise:e,immersiveSession:null,inlineSessions:new Set},e.then(t=>{this[at].device=t})}async isSessionSupported(e){return this[at].device||await this[at].devicePromise,e!="inline"?Promise.resolve(this[at].device.isSessionSupported(e)):Promise.resolve(!0)}async requestSession(e,t){if(!this[at].device){if(e!="inline")throw new Error(kA);await this[at].devicePromise}if(!TA.includes(e))throw new TypeError(`The provided value '${e}' is not a valid enum value of type XRSessionMode`);let o=MA[e],r=o.requiredFeatures.concat(t&&t.requiredFeatures?t.requiredFeatures:[]),i=o.optionalFeatures.concat(t&&t.optionalFeatures?t.optionalFeatures:[]),s=new Set,a=!1;for(let x of r)this[at].device.isFeatureSupported(x)?s.add(x):(console.error(`The required feature '${x}' is not supported`),a=!0);if(a)throw new DOMException("Session does not support some required features","NotSupportedError");for(let x of i)this[at].device.isFeatureSupported(x)?s.add(x):console.log(`The optional feature '${x}' is not supported`);let l=await this[at].device.requestSession(e,s),p=new XRSession(this[at].device,e,l);e=="inline"?this[at].inlineSessions.add(p):this[at].immersiveSession=p;let m=()=>{e=="inline"?this[at].inlineSessions.delete(p):this[at].immersiveSession=null,p.removeEventListener("end",m)};return p.addEventListener("end",m),p}};var xp;if("performance"in zc)xp=()=>performance.now();else{let n=Date.now();xp=()=>Date.now()-n}var Jc=xp;var gp=Symbol("@@webxr-polyfill/XRPose"),Oo=class{constructor(e,t){this[gp]={transform:e,emulatedPosition:t}}get transform(){return this[gp].transform}get emulatedPosition(){return this[gp].emulatedPosition}};var $x=Symbol("@@webxr-polyfill/XRViewerPose"),Wo=class extends Oo{constructor(e,t,o=!1){super(e,o),this[$x]={views:t}}get views(){return this[$x].views}};var ms=Symbol("@@webxr-polyfill/XRViewport"),Ho=class{constructor(e){this[ms]={target:e}}get x(){return this[ms].target.x}get y(){return this[ms].target.y}get width(){return this[ms].target.width}get height(){return this[ms].target.height}};var eg=["left","right","none"],no=Symbol("@@webxr-polyfill/XRView"),No=class{constructor(e,t,o,r){if(!eg.includes(o))throw new Error(`XREye must be one of: ${eg}`);let i=Object.create(null),s=new Ho(i);this[no]={device:e,eye:o,viewport:s,temp:i,sessionId:r,transform:t}}get eye(){return this[no].eye}get projectionMatrix(){return this[no].device.getProjectionMatrix(this.eye)}get transform(){return this[no].transform}_getViewport(e){if(this[no].device.getViewport(this[no].sessionId,this.eye,e,this[no].temp))return this[no].viewport}};var Oe=Symbol("@@webxr-polyfill/XRFrame"),tg="XRFrame access outside the callback that produced it is invalid.",EA="getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.",bA=0,oo=class{constructor(e,t,o){this[Oe]={id:++bA,active:!1,animationFrame:!1,device:e,session:t,sessionId:o}}get session(){return this[Oe].session}getViewerPose(e){if(!this[Oe].animationFrame)throw new DOMException(EA,"InvalidStateError");if(!this[Oe].active)throw new DOMException(tg,"InvalidStateError");let t=this[Oe].device,o=this[Oe].session;o[T].viewerSpace._ensurePoseUpdated(t,this[Oe].id),e._ensurePoseUpdated(t,this[Oe].id);let r=e._getSpaceRelativeTransform(o[T].viewerSpace),i=[];for(let a of o[T].viewSpaces){a._ensurePoseUpdated(t,this[Oe].id);let l=e._getSpaceRelativeTransform(a),p=new No(t,l,a.eye,this[Oe].sessionId);i.push(p)}return new Wo(r,i,!1)}getPose(e,t){if(!this[Oe].active)throw new DOMException(tg,"InvalidStateError");let o=this[Oe].device;if(e._specialType==="target-ray"||e._specialType==="grip")return o.getInputPose(e._inputSource,t,e._specialType);{e._ensurePoseUpdated(o,this[Oe].id),t._ensurePoseUpdated(o,this[Oe].id);let r=t._getSpaceRelativeTransform(e);return r?new XRPose(r,!1):null}return null}};var fs=Symbol("@@webxr-polyfill/XRRenderState"),yA=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null}),ro=class{constructor(e={}){let t=Object.assign({},yA,e);this[fs]={config:t}}get depthNear(){return this[fs].config.depthNear}get depthFar(){return this[fs].config.depthFar}get inlineVerticalFieldOfView(){return this[fs].config.inlineVerticalFieldOfView}get baseLayer(){return this[fs].config.baseLayer}};var Zc=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),xs=Symbol("@@webxr-polyfill/xr-compatible");var Uo=Symbol("@@webxr-polyfill/XRWebGLLayer"),DA=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),gs=class{constructor(e,t,o={}){let r=Object.assign({},DA,o);if(!(e instanceof zo))throw new Error("session must be a XRSession");if(e.ended)throw new Error("InvalidStateError");if(t[Zc]&&t[xs]!==!0)throw new Error("InvalidStateError");let i=t.getParameter(t.FRAMEBUFFER_BINDING);this[Uo]={context:t,config:r,framebuffer:i,session:e}}get context(){return this[Uo].context}get antialias(){return this[Uo].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return this[Uo].framebuffer}get framebufferWidth(){return this[Uo].context.drawingBufferWidth}get framebufferHeight(){return this[Uo].context.drawingBufferHeight}get _session(){return this[Uo].session}getViewport(e){return e._getViewport(this)}static getNativeFramebufferScaleFactor(e){if(!e)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return e[T].ended?0:1}};var wp=Symbol("@@webxr-polyfill/XRInputSourceEvent"),Go=class n extends Event{constructor(e,t){super(e,t),this[wp]={frame:t.frame,inputSource:t.inputSource},Object.setPrototypeOf(this,n.prototype)}get frame(){return this[wp].frame}get inputSource(){return this[wp].inputSource}};var ng=Symbol("@@webxr-polyfill/XRSessionEvent"),io=class n extends Event{constructor(e,t){super(e,t),this[ng]={session:t.session},Object.setPrototypeOf(this,n.prototype)}get session(){return this[ng].session}};var $c=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),Xo=class n extends Event{constructor(e,t){super(e,t),this[$c]={session:t.session,added:t.added,removed:t.removed},Object.setPrototypeOf(this,n.prototype)}get session(){return this[$c].session}get added(){return this[$c].added}get removed(){return this[$c].removed}};var T=Symbol("@@webxr-polyfill/XRSession"),ws=class extends Bt{constructor(e){super(e)}get eye(){return this._specialType}_onPoseUpdate(e){this._inverseBaseMatrix=e.getBaseViewMatrix(this._specialType)}},zo=class extends Sn{constructor(e,t,o){super();let r=t!="inline",i=new ro({inlineVerticalFieldOfView:r?null:Math.PI*.5});this[T]={device:e,mode:t,immersive:r,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:o,activeRenderState:i,pendingRenderState:null,viewerSpace:new to("viewer"),viewSpaces:[],currentInputSources:[]},r?this[T].viewSpaces.push(new ws("left"),new ws("right")):this[T].viewSpaces.push(new ws("none")),this[T].onDeviceFrame=()=>{if(this[T].ended||this[T].suspended||(this[T].deviceFrameHandle=null,this[T].startDeviceFrameLoop(),this[T].pendingRenderState!==null&&(this[T].activeRenderState=new ro(this[T].pendingRenderState),this[T].pendingRenderState=null,this[T].activeRenderState.baseLayer&&this[T].device.onBaseLayerSet(this[T].id,this[T].activeRenderState.baseLayer)),this[T].activeRenderState.baseLayer===null))return;let s=new oo(e,this,this[T].id),a=this[T].currentFrameCallbacks=this[T].frameCallbacks;this[T].frameCallbacks=[],s[Oe].active=!0,s[Oe].animationFrame=!0,this[T].device.onFrameStart(this[T].id,this[T].activeRenderState),this._checkInputSourcesChange();let l=Jc();for(let p=0;p<a.length;p++)try{!a[p].cancelled&&typeof a[p].callback=="function"&&a[p].callback(l,s)}catch(m){console.error(m)}this[T].currentFrameCallbacks=null,s[Oe].active=!1,this[T].device.onFrameEnd(this[T].id)},this[T].startDeviceFrameLoop=()=>{this[T].deviceFrameHandle===null&&(this[T].deviceFrameHandle=this[T].device.requestAnimationFrame(this[T].onDeviceFrame))},this[T].stopDeviceFrameLoop=()=>{let s=this[T].deviceFrameHandle;s!==null&&(this[T].device.cancelAnimationFrame(s),this[T].deviceFrameHandle=null)},this[T].onPresentationEnd=s=>{if(s!==this[T].id){this[T].suspended=!1,this[T].startDeviceFrameLoop(),this.dispatchEvent("focus",{session:this});return}this[T].ended=!0,this[T].stopDeviceFrameLoop(),e.removeEventListener("@@webxr-polyfill/vr-present-end",this[T].onPresentationEnd),e.removeEventListener("@@webxr-polyfill/vr-present-start",this[T].onPresentationStart),e.removeEventListener("@@webxr-polyfill/input-select-start",this[T].onSelectStart),e.removeEventListener("@@webxr-polyfill/input-select-end",this[T].onSelectEnd),this.dispatchEvent("end",new io("end",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-end",this[T].onPresentationEnd),this[T].onPresentationStart=s=>{s!==this[T].id&&(this[T].suspended=!0,this[T].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-start",this[T].onPresentationStart),this[T].onSelectStart=s=>{s.sessionId===this[T].id&&this[T].dispatchInputSourceEvent("selectstart",s.inputSource)},e.addEventListener("@@webxr-polyfill/input-select-start",this[T].onSelectStart),this[T].onSelectEnd=s=>{s.sessionId===this[T].id&&(this[T].dispatchInputSourceEvent("selectend",s.inputSource),this[T].dispatchInputSourceEvent("select",s.inputSource))},e.addEventListener("@@webxr-polyfill/input-select-end",this[T].onSelectEnd),this[T].onSqueezeStart=s=>{s.sessionId===this[T].id&&this[T].dispatchInputSourceEvent("squeezestart",s.inputSource)},e.addEventListener("@@webxr-polyfill/input-squeeze-start",this[T].onSqueezeStart),this[T].onSqueezeEnd=s=>{s.sessionId===this[T].id&&(this[T].dispatchInputSourceEvent("squeezeend",s.inputSource),this[T].dispatchInputSourceEvent("squeeze",s.inputSource))},e.addEventListener("@@webxr-polyfill/input-squeeze-end",this[T].onSqueezeEnd),this[T].dispatchInputSourceEvent=(s,a)=>{let l=new oo(e,this,this[T].id),p=new Go(s,{frame:l,inputSource:a});l[Oe].active=!0,this.dispatchEvent(s,p),l[Oe].active=!1},this[T].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[T].activeRenderState}get environmentBlendMode(){return this[T].device.environmentBlendMode||"opaque"}async requestReferenceSpace(e){if(this[T].ended)return;if(!ds.includes(e))throw new TypeError(`XRReferenceSpaceType must be one of ${ds}`);if(!this[T].device.doesSessionSupportReferenceSpace(this[T].id,e))throw new DOMException(`The ${e} reference space is not supported by this session.`,"NotSupportedError");if(e==="viewer")return this[T].viewerSpace;let t=await this[T].device.requestFrameOfReferenceTransform(e);if(e==="bounded-floor")throw t?this[T].device.requestStageBounds()?new DOMException(`The WebXR polyfill does not support the ${e} reference space yet.`,"NotSupportedError"):new DOMException(`${e} XRReferenceSpace not supported by this device.`,"NotSupportedError"):new DOMException(`${e} XRReferenceSpace not supported by this device.`,"NotSupportedError");return new to(e,t)}requestAnimationFrame(e){if(this[T].ended)return;let t=++this[T].frameHandle;return this[T].frameCallbacks.push({handle:t,callback:e,cancelled:!1}),t}cancelAnimationFrame(e){let t=this[T].frameCallbacks,o=t.findIndex(r=>r&&r.handle===e);o>-1&&(t[o].cancelled=!0,t.splice(o,1)),t=this[T].currentFrameCallbacks,t&&(o=t.findIndex(r=>r&&r.handle===e),o>-1&&(t[o].cancelled=!0))}get inputSources(){return this[T].device.getInputSources()}async end(){if(!this[T].ended)return this[T].immersive&&(this[T].ended=!0,this[T].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[T].onPresentationStart),this[T].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[T].onPresentationEnd),this[T].device.removeEventListener("@@webxr-polyfill/input-select-start",this[T].onSelectStart),this[T].device.removeEventListener("@@webxr-polyfill/input-select-end",this[T].onSelectEnd),this.dispatchEvent("end",new io("end",{session:this}))),this[T].stopDeviceFrameLoop(),this[T].device.endSession(this[T].id)}updateRenderState(e){if(this[T].ended){let o="Can't call updateRenderState on an XRSession that has already ended.";throw new Error(o)}if(e.baseLayer&&e.baseLayer._session!==this){let o="Called updateRenderState with a base layer that was created by a different session.";throw new Error(o)}if(e.inlineVerticalFieldOfView!==null&&e.inlineVerticalFieldOfView!==void 0)if(this[T].immersive){let o="inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.";throw new Error(o)}else e.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,e.inlineVerticalFieldOfView));if(this[T].pendingRenderState===null){let o=this[T].activeRenderState;this[T].pendingRenderState={depthNear:o.depthNear,depthFar:o.depthFar,inlineVerticalFieldOfView:o.inlineVerticalFieldOfView,baseLayer:o.baseLayer}}Object.assign(this[T].pendingRenderState,e)}_checkInputSourcesChange(){let e=[],t=[],o=this.inputSources,r=this[T].currentInputSources;for(let i of o)r.includes(i)||e.push(i);for(let i of r)o.includes(i)||t.push(i);(e.length>0||t.length>0)&&this.dispatchEvent("inputsourceschange",new Xo("inputsourceschange",{session:this,added:e,removed:t})),this[T].currentInputSources.length=0;for(let i of o)this[T].currentInputSources.push(i)}};var so=Symbol("@@webxr-polyfill/XRInputSource"),jo=class{constructor(e){this[so]={impl:e,gripSpace:new Bt("grip",this),targetRaySpace:new Bt("target-ray",this)}}get handedness(){return this[so].impl.handedness}get targetRayMode(){return this[so].impl.targetRayMode}get gripSpace(){let e=this[so].impl.targetRayMode;return e==="gaze"||e==="screen"?null:this[so].gripSpace}get targetRaySpace(){return this[so].targetRaySpace}get profiles(){return this[so].impl.profiles}get gamepad(){return this[so].impl.gamepad}};var Fp=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),Fs=class n extends Event{constructor(e,t){super(e,t),this[Fp]={referenceSpace:t.referenceSpace,transform:t.transform||null},Object.setPrototypeOf(this,n.prototype)}get referenceSpace(){return this[Fp].referenceSpace}get transform(){return this[Fp].transform}};var el={XRSystem:hs,XRSession:zo,XRSessionEvent:io,XRFrame:oo,XRView:No,XRViewport:Ho,XRViewerPose:Wo,XRWebGLLayer:gs,XRSpace:Bt,XRReferenceSpace:to,XRReferenceSpaceEvent:Fs,XRInputSource:jo,XRInputSourceEvent:Go,XRInputSourcesChangeEvent:Xo,XRRenderState:ro,XRRigidTransform:Io,XRPose:Oo};var Ap=n=>typeof n.prototype.makeXRCompatible=="function"?!1:(n.prototype.makeXRCompatible=function(){return this[xs]=!0,Promise.resolve()},!0),_p=n=>{let e=n.prototype.getContext;n.prototype.getContext=function(t,o){let r=e.call(this,t,o);return r&&(r[Zc]=!0,o&&"xrCompatible"in o&&(r[xs]=o.xrCompatible)),r}};var og=n=>!!(n.ImageBitmapRenderingContext&&n.createImageBitmap),rg=n=>{var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(n.navigator.userAgent||n.navigator.vendor||n.opera),e},ig=n=>{n.style.display="block",n.style.position="absolute",n.style.width=n.style.height="1px",n.style.top=n.style.left="0px"};var xg=B1(sg());var qo=class extends Sn{constructor(e){super(),this.global=e,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(e,t){throw new Error("Not implemented")}isSessionSupported(e){throw new Error("Not implemented")}isFeatureSupported(e){throw new Error("Not implemented")}async requestSession(e,t){throw new Error("Not implemented")}requestAnimationFrame(e){throw new Error("Not implemented")}onFrameStart(e){throw new Error("Not implemented")}onFrameEnd(e){throw new Error("Not implemented")}doesSessionSupportReferenceSpace(e,t){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(e,t){}cancelAnimationFrame(e){throw new Error("Not implemented")}endSession(e){throw new Error("Not implemented")}getViewport(e,t,o,r){throw new Error("Not implemented")}getProjectionMatrix(e){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(e){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(e,t,o){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}};var CA={mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},BA={mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},LA={mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},ag={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},RA={mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[Math.PI*-.08,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},PA={mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},VA={mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},Tp={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},IA={"Daydream Controller":CA,"Gear VR Controller":PA,"HTC Vive Focus Controller":BA,"Oculus Go Controller":LA,"Oculus Touch (Right)":ag,"Oculus Touch (Left)":ag,"OpenVR Gamepad":RA,"Spatial Controller (Spatial Interaction Source) 045E-065A":Tp,"Spatial Controller (Spatial Interaction Source) 045E-065D":VA,"Windows Mixed Reality (Right)":Tp,"Windows Mixed Reality (Left)":Tp},cg=IA;var lg=mt(.155,-.465,-.15),OA=mt(-.155,-.465,-.15),WA=mt(0,0,-.25),HA=mt(0,0,.05),ug=mt(-.08,.14,.08),pg=.4,NA=.4,UA=.61,zA=.175,GA=.12,XA=.87,dg=180/Math.PI;function jA(n,e,t){function o(l,p,m){return l<p?p:l>m?m:l}var r=e[0]*e[0],i=e[1]*e[1],s=e[2]*e[2],a=e[3]*e[3];if(t==="XYZ")n[0]=Math.atan2(2*(e[0]*e[3]-e[1]*e[2]),a-r-i+s),n[1]=Math.asin(o(2*(e[0]*e[2]+e[1]*e[3]),-1,1)),n[2]=Math.atan2(2*(e[2]*e[3]-e[0]*e[1]),a+r-i-s);else if(t==="YXZ")n[0]=Math.asin(o(2*(e[0]*e[3]-e[1]*e[2]),-1,1)),n[1]=Math.atan2(2*(e[0]*e[2]+e[1]*e[3]),a-r-i+s),n[2]=Math.atan2(2*(e[0]*e[1]+e[2]*e[3]),a-r+i-s);else if(t==="ZXY")n[0]=Math.asin(o(2*(e[0]*e[3]+e[1]*e[2]),-1,1)),n[1]=Math.atan2(2*(e[1]*e[3]-e[2]*e[0]),a-r-i+s),n[2]=Math.atan2(2*(e[2]*e[3]-e[0]*e[1]),a-r+i-s);else if(t==="ZYX")n[0]=Math.atan2(2*(e[0]*e[3]+e[2]*e[1]),a-r-i+s),n[1]=Math.asin(o(2*(e[1]*e[3]-e[0]*e[2]),-1,1)),n[2]=Math.atan2(2*(e[0]*e[1]+e[2]*e[3]),a+r-i-s);else if(t==="YZX")n[0]=Math.atan2(2*(e[0]*e[3]-e[2]*e[1]),a-r+i-s),n[1]=Math.atan2(2*(e[1]*e[3]-e[0]*e[2]),a+r-i-s),n[2]=Math.asin(o(2*(e[0]*e[1]+e[2]*e[3]),-1,1));else if(t==="XZY")n[0]=Math.atan2(2*(e[0]*e[3]+e[1]*e[2]),a-r+i-s),n[1]=Math.atan2(2*(e[0]*e[2]+e[1]*e[3]),a+r-i-s),n[2]=Math.asin(o(2*(e[2]*e[3]-e[0]*e[1]),-1,1));else{console.log("No order given for quaternion to euler conversion.");return}}var As=class{constructor(){this.hand="right",this.headElbowOffset=lg,this.controllerQ=Tt(),this.lastControllerQ=Tt(),this.headQ=Tt(),this.headPos=St(),this.elbowPos=St(),this.wristPos=St(),this.time=null,this.lastTime=null,this.rootQ=Tt(),this.position=St()}setHandedness(e){this.hand!=e&&(this.hand=e,this.hand=="left"?this.headElbowOffset=OA:this.headElbowOffset=lg)}update(e,t){this.time=Jc(),e&&(Kc(this.lastControllerQ,this.controllerQ),Kc(this.controllerQ,e)),t&&(Gc(this.headPos,t),Xc(this.headQ,t));let o=this.getHeadYawOrientation_(),r=this.quatAngle_(this.lastControllerQ,this.controllerQ),i=(this.time-this.lastTime)/1e3;r/i>UA?zr(this.rootQ,this.rootQ,o,Math.min(r/zA,1)):Kc(this.rootQ,o);let a=mt(0,0,-1);Vo(a,a,this.controllerQ);let l=us(a,[0,1,0]),p=this.clamp_((l-GA)/XA,0,1),m=mp(this.rootQ);hp(m,m),dp(m,m,this.controllerQ);let x=this.elbowPos;up(x,this.headPos),Ur(x,x,this.headElbowOffset);let F=lp(ug);pp(F,F,p),Ur(x,x,F);let k=this.quatAngle_(m,Tt())*dg,D=1-Math.pow(k/180,4);sssss;let b=pg,P=1-pg,O=D*(b+P*p*NA),I=Tt();zr(I,I,m,O);let L=hp(Tt(),I),U=mp(m);dp(U,U,L);let C=this.wristPos;up(C,HA),Vo(C,C,I),Ur(C,C,WA),Vo(C,C,U),Ur(C,C,x);let W=lp(ug);pp(W,W,p),Ur(this.position,this.wristPos,W),Vo(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let e=St();return jA(e,this.headQ,"YXZ"),Jx(Tt(),0,e[1]*dg,0)}clamp_(e,t,o){return Math.min(Math.max(e,t),o)}quatAngle_(e,t){let o=[0,0,-1],r=[0,0,-1];return Vo(o,o,e),Vo(r,r,t),Gx(o,r)}};var ot=Symbol("@@webxr-polyfill/XRRemappedGamepad"),hg={pressed:!1,touched:!1,value:0};Object.freeze(hg);var Mp=class{constructor(e,t,o){if(o||(o={}),o.userAgentOverrides){for(let p in o.userAgentOverrides)if(navigator.userAgent.includes(p)){let m=o.userAgentOverrides[p];for(let x in m)x in o?Object.assign(o[x],m[x]):o[x]=m[x];break}}let r=new Array(o.axes&&o.axes.length?o.axes.length:e.axes.length),i=new Array(o.buttons&&o.buttons.length?o.buttons.length:e.buttons.length),s=null;if(o.gripTransform){let p=o.gripTransform.orientation||[0,0,0,1];s=un(),$n(s,ps(p,p),o.gripTransform.position||[0,0,0])}let a=null;if(o.targetRayTransform){let p=o.targetRayTransform.orientation||[0,0,0,1];a=un(),$n(a,ps(p,p),o.targetRayTransform.position||[0,0,0])}let l=o.profiles;o.displayProfiles&&t.displayName in o.displayProfiles&&(l=o.displayProfiles[t.displayName]),this[ot]={gamepad:e,map:o,profiles:l||[e.id],mapping:o.mapping||e.mapping,axes:r,buttons:i,gripTransform:s,targetRayTransform:a},this._update()}_update(){let e=this[ot].gamepad,t=this[ot].map,o=this[ot].axes;for(let i=0;i<o.length;++i)t.axes&&i in t.axes?t.axes[i]===null?o[i]=0:o[i]=e.axes[t.axes[i]]:o[i]=e.axes[i];if(t.axes&&t.axes.invert)for(let i of t.axes.invert)i<o.length&&(o[i]*=-1);let r=this[ot].buttons;for(let i=0;i<r.length;++i)t.buttons&&i in t.buttons?t.buttons[i]===null?r[i]=hg:r[i]=e.buttons[t.buttons[i]]:r[i]=e.buttons[i]}get id(){return""}get _profiles(){return this[ot].profiles}get index(){return-1}get connected(){return this[ot].gamepad.connected}get timestamp(){return this[ot].gamepad.timestamp}get mapping(){return this[ot].mapping}get axes(){return this[ot].axes}get buttons(){return this[ot].buttons}get hapticActuators(){return this[ot].gamepad.hapticActuators}},_s=class{constructor(e,t,o=0,r=-1){this.polyfill=e,this.display=t,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new jo(this),this.lastPosition=St(),this.emulatedPosition=!1,this.basePoseMatrix=un(),this.outputMatrix=un(),this.primaryButtonIndex=o,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=r,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(e){this.nativeGamepad!==e&&(this.nativeGamepad=e,e?this.gamepad=new Mp(e,this.display,cg[e.id]):this.gamepad=null),this.handedness=e.hand===""?"none":e.hand,this.gamepad&&this.gamepad._update(),e.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!e.pose.hasPosition):e.hand===""&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let e=this.nativeGamepad.pose,t=e.position,o=e.orientation;if(!t&&!o)return;t?(this.lastPosition[0]=t[0],this.lastPosition[1]=t[1],this.lastPosition[2]=t[2]):e.hasPosition?t=this.lastPosition:(this.armModel||(this.armModel=new As),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(o,this.polyfill.getBasePoseMatrix()),t=this.armModel.getPosition()),$n(this.basePoseMatrix,o,t)}else Ux(this.basePoseMatrix,this.polyfill.getBasePoseMatrix());return this.basePoseMatrix}getXRPose(e,t){switch(this.updateBasePoseMatrix(),t){case"target-ray":e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[ot].targetRayTransform&&Tn(this.outputMatrix,this.outputMatrix,this.gamepad[ot].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[ot].gripTransform&&Tn(this.outputMatrix,this.outputMatrix,this.gamepad[ot].gripTransform);break;default:return null}return e._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}};var kV=Symbol("@@webxr-polyfill/WebVRDevice"),vs=!1,mg={highRefreshRate:!0},fg={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},qA=0,kp=class{constructor(e,t,o={}){if(this.mode=e,this.enabledFeatures=t,this.outputContext=null,this.immersive=e=="immersive-vr"||e=="immersive-ar",this.ended=null,this.baseLayer=null,this.id=++qA,this.modifiedCanvasLayer=!1,this.outputContext&&!vs){let r=o.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(r)}}},Qo=class extends qo{constructor(e,t){let{canPresent:o}=t.capabilities;super(e),this.display=t,this.frame=new e.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=o,this.baseModelMatrix=un(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),e.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=e.navigator&&"getGamepads"in e.navigator,this.HAS_BITMAP_SUPPORT=og(e)}get depthNear(){return this.display.depthNear}set depthNear(e){this.display.depthNear=e}get depthFar(){return this.display.depthFar}set depthFar(e){this.display.depthFar=e}onBaseLayerSet(e,t){let o=this.sessions.get(e),r=t.context.canvas;if(o.immersive){let i=this.display.getEyeParameters("left"),s=this.display.getEyeParameters("right");r.width=Math.max(i.renderWidth,s.renderWidth)*2,r.height=Math.max(i.renderHeight,s.renderHeight),this.display.requestPresent([{source:r,attributes:mg}]).then(()=>{!vs&&!this.global.document.body.contains(r)&&(o.modifiedCanvasLayer=!0,this.global.document.body.appendChild(r),ig(r)),o.baseLayer=t})}else o.baseLayer=t}isSessionSupported(e){return!(e=="immersive-ar"||e=="immersive-vr"&&this.canPresent===!1)}isFeatureSupported(e){switch(e){case"viewer":return!0;case"local":return!0;case"local-floor":return!0;case"bounded":return!1;case"unbounded":return!1;default:return!1}}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();let o=e=="immersive-vr";if(o){let i=this.global.document.createElement("canvas");if(!vs){let s=i.getContext("webgl")}await this.display.requestPresent([{source:i,attributes:mg}])}let r=new kp(e,t,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(r.id,r),o&&(this.immersiveSession=r,this.dispatchEvent("@@webxr-polyfill/vr-present-start",r.id)),Promise.resolve(r.id)}requestAnimationFrame(e){return this.display.requestAnimationFrame(e)}getPrimaryButtonIndex(e){let t=0,o=e.id.toLowerCase();for(let r in fg)if(o.includes(r)){t=fg[r];break}return Math.min(t,e.buttons.length-1)}onFrameStart(e,t){this.display.depthNear=t.depthNear,this.display.depthFar=t.depthFar,this.display.getFrameData(this.frame);let o=this.sessions.get(e);if(o.immersive&&this.CAN_USE_GAMEPAD){let r=this.gamepadInputSources;this.gamepadInputSources={};let i=this.global.navigator.getGamepads();for(let s=0;s<i.length;++s){let a=i[s];if(a&&a.displayId>0){let l=r[s];if(l||(l=new _s(this,this.display,this.getPrimaryButtonIndex(a))),l.updateFromGamepad(a),this.gamepadInputSources[s]=l,l.primaryButtonIndex!=-1){let p=a.buttons[l.primaryButtonIndex].pressed;p&&!l.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:o.id,inputSource:l.inputSource}):!p&&l.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:o.id,inputSource:l.inputSource}),l.primaryActionPressed=p}if(l.primarySqueezeButtonIndex!=-1){let p=a.buttons[l.primarySqueezeButtonIndex].pressed;p&&!l.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:o.id,inputSource:l.inputSource}):!p&&l.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:o.id,inputSource:l.inputSource}),l.primarySqueezeActionPressed=p}}}}if(!vs&&!o.immersive&&o.baseLayer){let r=o.baseLayer.context.canvas;jc(this.frame.leftProjectionMatrix,t.inlineVerticalFieldOfView,r.width/r.height,t.depthNear,t.depthFar)}}onFrameEnd(e){let t=this.sessions.get(e);if(!(t.ended||!t.baseLayer)){if(t.outputContext&&!(t.immersive&&!this.display.capabilities.hasExternalDisplay)){let o=t.immersive&&this.display.capabilities.hasExternalDisplay,r=t.baseLayer.context.canvas,i=o?r.width/2:r.width,s=r.height;if(!vs){let a=t.outputContext.canvas,l=a.width,p=a.height,m=t.renderContext;this.HAS_BITMAP_SUPPORT?r.transferToImageBitmap?m.transferFromImageBitmap(r.transferToImageBitmap()):this.global.createImageBitmap(r,0,0,i,s,{resizeWidth:l,resizeHeight:p}).then(x=>m.transferFromImageBitmap(x)):m.drawImage(r,0,0,i,s,0,0,l,p)}}t.immersive&&t.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(e){this.display.cancelAnimationFrame(e)}async endSession(e){let t=this.sessions.get(e);if(!t.ended){if(t.immersive)return this.display.exitPresent();t.ended=!0}}doesSessionSupportReferenceSpace(e,t){let o=this.sessions.get(e);return o.ended?!1:o.enabledFeatures.has(t)}requestStageBounds(){if(this.display.stageParameters){let e=this.display.stageParameters.sizeX,t=this.display.stageParameters.sizeZ,o=[];return o.push(-e/2),o.push(-t/2),o.push(e/2),o.push(-t/2),o.push(e/2),o.push(t/2),o.push(-e/2),o.push(t/2),o}return null}async requestFrameOfReferenceTransform(e,t){return(e==="local-floor"||e==="bounded-floor")&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(e){if(e==="left")return this.frame.leftProjectionMatrix;if(e==="right")return this.frame.rightProjectionMatrix;if(e==="none")return this.frame.leftProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(e,t,o,r){let i=this.sessions.get(e),{width:s,height:a}=o.context.canvas;if(!i.immersive)return r.x=r.y=0,r.width=s,r.height=a,!0;if(t==="left"||t==="none")r.x=0;else if(t==="right")r.x=s/2;else return!1;return r.y=0,r.width=s/2,r.height=a,!0}getBasePoseMatrix(){let{position:e,orientation:t}=this.frame.pose;return!e&&!t?this.baseModelMatrix:(e||(e=this.tempVec3,e[0]=e[1]=e[2]=0),$n(this.baseModelMatrix,t,e),this.baseModelMatrix)}getBaseViewMatrix(e){if(e==="left"||e==="none")return this.frame.leftViewMatrix;if(e==="right")return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let e=[];for(let t in this.gamepadInputSources)e.push(this.gamepadInputSources[t].inputSource);return e}getInputPose(e,t,o){if(!t)return null;for(let r in this.gamepadInputSources){let i=this.gamepadInputSources[r];if(i.inputSource===e)return i.getXRPose(t,o)}return null}onWindowResize(){}onVRDisplayPresentChange(e){this.display.isPresenting||this.sessions.forEach(t=>{if(t.immersive&&!t.ended){if(t.modifiedCanvasLayer){let o=t.baseLayer.context.canvas;document.body.removeChild(o),o.setAttribute("style","")}this.immersiveSession===t&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",t.id)}})}};var Ss=class extends Qo{constructor(e,t){let o=new xg.default(t||{});super(e,o),this.display=o,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}};var QA=!1,YA=0,Ep=class{constructor(e,t){this.mode=e,this.enabledFeatures=t,this.ended=null,this.baseLayer=null,this.id=++YA}},Ts=class extends qo{constructor(e){super(e),this.sessions=new Map,this.projectionMatrix=un(),this.identityMatrix=un()}onBaseLayerSet(e,t){let o=this.sessions.get(e);o.baseLayer=t}isSessionSupported(e){return e=="inline"}isFeatureSupported(e){switch(e){case"viewer":return!0;default:return!1}}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();let o=new Ep(e,t);return this.sessions.set(o.id,o),Promise.resolve(o.id)}requestAnimationFrame(e){return window.requestAnimationFrame(e)}cancelAnimationFrame(e){window.cancelAnimationFrame(e)}onFrameStart(e,t){if(QA)return;let o=this.sessions.get(e);if(o.baseLayer){let r=o.baseLayer.context.canvas;jc(this.projectionMatrix,t.inlineVerticalFieldOfView,r.width/r.height,t.depthNear,t.depthFar)}}onFrameEnd(e){}async endSession(e){let t=this.sessions.get(e);t.ended=!0}doesSessionSupportReferenceSpace(e,t){let o=this.sessions.get(e);return o.ended?!1:o.enabledFeatures.has(t)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(e,t){return null}getProjectionMatrix(e){return this.projectionMatrix}getViewport(e,t,o,r){let i=this.sessions.get(e),{width:s,height:a}=o.context.canvas;return r.x=r.y=0,r.width=s,r.height=a,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(e){return this.identityMatrix}getInputSources(){return[]}getInputPose(e,t,o){return null}onWindowResize(){}};var KA=async function(n){let e=null;if("getVRDisplays"in n.navigator)try{let t=await n.navigator.getVRDisplays();t&&t.length&&(e=new Qo(n,t[0]))}catch{}return e},gg=async function(n,e){if(e.webvr){let o=await KA(n);if(o)return o}let t=rg(n);return t&&e.cardboard||!t&&e.allowCardboardOnDesktop?(n.VRFrameData||(n.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new Ss(n,e.cardboardConfig)):new Ts(n)};var JA={global:zc,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},tl=["navigator","HTMLCanvasElement","WebGLRenderingContext"],Ms=class{constructor(e={}){this.config=Object.freeze(Object.assign({},JA,e)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}_injectPolyfill(e){if(!tl.every(t=>!!e[t]))throw new Error(`Global must have the following attributes : ${tl}`);for(let t of Object.keys(el))e[t]!==void 0?console.warn(`${t} already defined on global.`):e[t]=el[t];Ap(e.WebGLRenderingContext)&&(_p(e.HTMLCanvasElement),e.OffscreenCanvas&&_p(e.OffscreenCanvas),e.WebGL2RenderingContext&&Ap(e.WebGL2RenderingContext),window.isSecureContext||console.warn(`WebXR Polyfill Warning:
This page is not running in a secure context (https:// or localhost)!
This means that although the page may be able to use the WebXR Polyfill it will
not be able to use native WebXR implementations, and as such will not be able to
access dedicated VR or AR hardware, and will not be able to take advantage of
any performance improvements a native WebXR implementation may offer. Please
host this content on a secure origin for the best user experience.
`)),this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let e=gg(this.global,this.config);this.xr=new el.XRSystem(e),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(e){if(!tl.every(t=>!!e[t]))throw new Error(`Global must have the following attributes : ${tl}`);if(e.navigator.xr&&"supportsSession"in e.navigator.xr&&!("isSessionSupported"in e.navigator.xr)){let t=e.navigator.xr.supportsSession;e.navigator.xr.isSessionSupported=function(o){return t.call(this,o).then(()=>!0).catch(()=>!1)},e.navigator.xr.supportsSession=function(o){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),t.call(this,o)}}}};var nl=class{constructor(e,t=512,o=512){this.colorMatrixLeft=new Lu().fromArray([.4561,-.0400822,-.0152161,.500484,-.0378246,-.0205971,.176381,-.0157589,-.00546856]),this.colorMatrixRight=new Lu().fromArray([-.0434706,.378476,-.0721527,-.0879388,.73364,-.112961,-.00155529,-.0184503,1.2264]);let r=new pc(-1,1,1,-1,0,1),i=new Rr,s=new Lf;s.eyeSep=.07;let a={minFilter:Hi,magFilter:uc,format:bf},l=new Iu(t,o,a),p=new Iu(t,o,a),m=new hc({uniforms:{mapLeft:{value:l.texture},mapRight:{value:p.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = vec2( uv.x, uv.y );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;","float lin( float c ) {","	return c <= 0.04045 ? c * 0.0773993808 :","			pow( c * 0.9478672986 + 0.0521327014, 2.4 );","}","vec4 lin( vec4 c ) {","	return vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );","}","float dev( float c ) {","	return c <= 0.0031308 ? c * 12.92","			: pow( c, 0.41666 ) * 1.055 - 0.055;","}","void main() {","	vec2 uv = vUv;","	vec4 colorL = lin( texture2D( mapLeft, uv ) );","	vec4 colorR = lin( texture2D( mapRight, uv ) );","	vec3 color = clamp(","			colorMatrixLeft * colorL.rgb +","			colorMatrixRight * colorR.rgb, 0., 1. );","	gl_FragColor = vec4(","			dev( color.r ), dev( color.g ), dev( color.b ),","			max( colorL.a, colorR.a ) );","}"].join(`
`)}),x=new _t(new Br(2,2),m);i.add(x),this.setSize=function(F,v){e.setSize(F,v);let k=e.getPixelRatio();l.setSize(F*k,v*k),p.setSize(F*k,v*k)},this.render=function(F,v){let k=e.getRenderTarget();F.matrixWorldAutoUpdate===!0&&F.updateMatrixWorld(),v.parent===null&&v.matrixWorldAutoUpdate===!0&&v.updateMatrixWorld(),s.update(v),e.setRenderTarget(l),e.clear(),e.render(F,s.cameraL),e.setRenderTarget(p),e.clear(),e.render(F,s.cameraR),e.setRenderTarget(null),e.render(i,r),e.setRenderTarget(k)},this.dispose=function(){l.dispose(),p.dispose(),x.geometry.dispose(),x.material.dispose()}}};navigator.xr||(console.info("Polyfilling WebXR API"),new Ms);var rl=class extends N{constructor(e,t,o,r,i){super(e),this.mode=t,this.session=o,this.referenceSpaceType=r,this.sessionMode=i}},ks=class extends rl{constructor(e,t,o,r){super("sessionstarted",e,t,o,r)}},Es=class extends rl{constructor(e,t,o,r){super("sessionstopped",e,t,o,r)}},ol=new Map([[q.VR,{referenceSpaceType:"local-floor",sessionMode:"immersive-vr"}],[q.AR,{referenceSpaceType:"local-floor",sessionMode:"immersive-ar"}]]),il=class extends re{constructor(e,t,o,r,i){super(),this.renderer=e,this.camera=t,this.fullscreenElement=o,this.enableFullResolution=r,this.enableAnaglyph=i,this._currentMode=q.None,this.buttons=new Map,this.currentSession=null,this.screenUI=null,this.wasVisible=new Map,this.lastFOV=50,this.addEventListener("sessionstarted",s=>{s.sessionMode==="inline"&&(this.lastFOV=this.camera.fov,this.camera.fov=Ci(s.session.renderState.inlineVerticalFieldOfView))}),this.addEventListener("sessionstopped",s=>{s.sessionMode==="inline"&&(this.camera.fov=this.lastFOV)}),this.renderer.xr.addEventListener("sessionstart",()=>this.onSessionStarted()),this.renderer.xr.addEventListener("sessionend",()=>this.onSessionEnded()),this.anaglyph=new nl(this.renderer),this.refresh()}setUI(e,t,o,r,i){this.screenUI=e;for(let s of[t,o,r,i])s&&this.buttons.set(s.mode,s);for(let s of this.buttons.values())this.wasVisible.set(s,s.visible),s.addEventListener("click",this.toggleMode.bind(this,s.mode));t.available=this.enableAnaglyph,o.available=!wn()&&cp(),r.available=oa(),i.available=na(),this.refresh()}get visible(){return Et(this.renderer.domElement)}set visible(e){qe(this.renderer.domElement,e),this.screenUI&&(e?this.screenUI.show():this.screenUI.hide())}get currentMode(){return this._currentMode}resize(){if(!this.renderer.xr.isPresenting){this.renderer.domElement.style.width="",this.renderer.domElement.style.height="";let{clientWidth:e,clientHeight:t,width:o,height:r}=this.renderer.domElement,i=Math.floor(e*devicePixelRatio),s=Math.floor(t*devicePixelRatio);e>0&&t>0&&(o!==i||r!==s)&&(this.renderer.setPixelRatio(devicePixelRatio),this.renderer.setSize(e,t,!1),this.anaglyph.setSize(e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix())}}getMetrics(){let e=this.renderer.domElement.clientWidth,t=this.renderer.domElement.clientHeight,o=this.renderer.getPixelRatio(),r=this.camera.fov;return{width:e,height:t,pixelRatio:o,fov:r}}setMetrics(e,t,o,r){this.renderer.setPixelRatio(o),this.renderer.setSize(e,t,!1),this.camera.aspect=e/t,this.camera.fov=r,this.camera.updateProjectionMatrix()}async refresh(){let e=Array.from(this.buttons.values()).filter(t=>t.available&&t.mode!==q.Fullscreen&&t.mode!==q.Anaglyph);await Promise.all(e.map(async t=>{let o=ol.get(t.mode);if(t.available=w(o),t.available){let r=navigator.xr&&await navigator.xr.isSessionSupported(o.sessionMode),i=!na()&&su()&&o.sessionMode==="immersive-vr"&&o.referenceSpaceType==="local-floor";t.available=r||i}}))}async toggleMode(e){if(e===q.None)throw new Error("Cannot toggle 'None' Screen Mode");if(e===q.VR||e===q.AR)await this.toggleXR(e);else{let t=e.indexOf("Fullscreen")>=0,o=e.indexOf("Anaglyph")>=0,r=this.currentMode.indexOf("Fullscreen")>=0,i=this.currentMode.indexOf("Anaglyph")>=0;t?await this.toggleFullscreen(i):this.setActive(o!==i?r?q.FullscreenAnaglyph:q.Anaglyph:r?q.Fullscreen:q.None)}}async start(e){let t=e;(e===q.Anaglyph&&this.currentMode===q.Fullscreen||e===q.Fullscreen&&this.currentMode===q.Anaglyph)&&(t=q.FullscreenAnaglyph),t!==this.currentMode&&(await this.toggleMode(this.currentMode),await this.toggleMode(e))}async stop(){await this.toggleMode(this.currentMode)}get isFullscreen(){return"fullscreenElement"in document&&w(document.fullscreenElement)||"fullscreen"in document&&document.fullscreen}async startFullscreen(e){this.isFullscreen||(await this.fullscreenElement.requestFullscreen({navigationUI:"show"}),e?(this.setActive(q.FullscreenAnaglyph),this.dispatchEvent(new ks(q.FullscreenAnaglyph,null,null,null))):(this.setActive(q.Fullscreen),this.dispatchEvent(new ks(q.Fullscreen,null,null,null))))}async stopFullscreen(e){this.isFullscreen&&(await document.exitFullscreen(),e?(this.setActive(q.Anaglyph),this.dispatchEvent(new Es(q.FullscreenAnaglyph,null,null,null))):(this.setActive(q.None),this.dispatchEvent(new Es(q.Fullscreen,null,null,null))))}async toggleFullscreen(e){this.isFullscreen?await this.stopFullscreen(e):await this.startFullscreen(e)}async toggleXR(e){let t=ol.get(e);if(w(t)){if(this.currentSession)this.currentSession.end();else if(navigator.xr){this.camera.position.setScalar(0),this.camera.quaternion.identity();try{let o=await navigator.xr.requestSession(t.sessionMode,{optionalFeatures:["local-floor","bounded-floor","high-refresh-rate","hand-tracking","layers"]});if(this.setActive(e),this.currentSession=o,this.renderer.xr.setReferenceSpaceType(t.referenceSpaceType),this.enableFullResolution&&"XRWebGLLayer"in window&&"getNativeFramebufferScaleFactor"in XRWebGLLayer){let r=XRWebGLLayer.getNativeFramebufferScaleFactor(o);this.renderer.xr.setFramebufferScaleFactor(r)}this.renderer.xr.setSession(o)}catch(o){console.error(`Couldn't start session type '${t.sessionMode}'. Reason: ${o&&o.message||o||"UNKNOWN"}`)}}}}onSessionStarted(){let e=this.currentMode,t=ol.get(this.currentMode),o=this.currentSession;if(o.supportedFrameRates){let r=Math.max(...o.supportedFrameRates);console.log("Changing framerate to",r),o.updateTargetFrameRate(r)}this.dispatchEvent(new ks(e,o,t.referenceSpaceType,t.sessionMode))}onSessionEnded(){let e=this.currentMode,t=ol.get(this.currentMode),o=this.currentSession;this.currentSession=null,this.renderer.xr.setSession(null),this.setActive(q.None),this.dispatchEvent(new Es(e,o,t.referenceSpaceType,t.sessionMode))}setActive(e){for(let t of this.buttons.values())t.active=t.mode===e,t.visible=this.wasVisible.get(t)&&(e!==q.VR&&e!==q.AR||t.mode===e);this._currentMode=e}render(e,t){this.renderer.clear(),this.currentMode===q.Anaglyph||this.currentMode===q.FullscreenAnaglyph?this.anaglyph.render(e,t):this.renderer.render(e,t)}};var ct;(function(n){n[n.None=-1]="None",n[n.Left=0]="Left",n[n.Right=1]="Right",n[n.Up=2]="Up",n[n.Down=3]="Down",n[n.Back=4]="Back",n[n.Front=5]="Front"})(ct||(ct={}));var wg=new V(0,1,0),lt=2048,Gr=lt/2,ZA=[1,0,2,3,4,5],Mn={rows:3,columns:4,indices:[[ct.None,ct.Up,ct.None,ct.None],[ct.Left,ct.Front,ct.Right,ct.Back],[ct.None,ct.Down,ct.None,ct.None]],rotations:[[0,Ee,0,0],[0,0,0,0],[0,Ee,0,0]]},sl=new Pe(0),al=class{get envMap(){return this._cube}constructor(e){this.env=e,this.rt=new Of(lt),this.rtScene=new Rr,this.rtCamera=new tf(.01,10,this.rt),this._rotation=new de,this.layerRotation=new de().identity(),this.stageRotation=new de().identity(),this.canvases=new Array(6),this.contexts=new Array(6),this.layerOrientation=null,this.images=null,this.curImagePath=null,this.layer=null,this.wasVisible=!1,this.stageHeading=0,this.rotationNeedsUpdate=!1,this.imageNeedsUpdate=!1,this.useWebXRLayers=!0,this.wasWebXRLayerAvailable=null,this.visible=!0,this.onNeedsRedraw=()=>this.imageNeedsUpdate=!0,this.env.scene.background=sl;for(let t=0;t<this.canvases.length;++t){let o=this.canvases[t]=Er(lt,lt);this.contexts[t]=o.getContext("2d",{alpha:!1})}for(let t=0;t<Mn.rows;++t){let o=Mn.indices[t],r=Mn.rotations[t];for(let i=0;i<Mn.columns;++i){let s=o[i];if(s>-1){let a=this.contexts[s],l=r[i];l>0&&(l%2,a.translate(Gr,Gr),a.rotate(l),a.translate(-Gr,-Gr))}}}this.rt.texture.name="SkyboxOutput",this.rtScene.add(this.rtCamera),this.flipped=Er(lt,lt),this.flipper=this.flipped.getContext("2d",{alpha:!1}),this.flipper.fillStyle=sl.getHexString(),this.flipper.scale(-1,1),this.flipper.translate(-lt,0),this.setImages("",this.canvases),this.env.addScopedEventListener(this,"update",t=>this.checkWebXRLayer(t.frame)),Object.seal(this)}clear(){this.setImage(null,null)}setImage(e,t){return e!==this.curImagePath?w(t)?(this.sliceImage(t),this.setImages(e,this.canvases)):this.setImages(e,null):null}sliceImage(e){let t=e.width/Mn.columns,o=e.height/Mn.rows;for(let r=0;r<Mn.rows;++r){let i=Mn.indices[r];for(let s=0;s<Mn.columns;++s){let a=i[s];a>-1&&this.contexts[a].drawImage(e,s*t,r*o,t,o,0,0,lt,lt)}}return this.canvases}setImages(e,t){if((e!==this.curImagePath||t!==this.images)&&(this.curImagePath=e,t!==this.images)){if(w(this._cube)&&(ye(this._cube),this._cube=null),w(this.images))for(let o of this.images)ye(o);this.images=t,w(this.images)?(this.rtScene.background=this._cube=new nf(this.images),this._cube.name="SkyboxInput"):this.rtScene.background=sl}return this.updateImages(),this._cube}updateImages(){this._cube.needsUpdate=!0,this.imageNeedsUpdate=!0}get rotation(){return this._rotation}set rotation(e){let{x:t,y:o,z:r,w:i}=this._rotation;if(zf(e))this._rotation.copy(e);else if(Gf(e))this._rotation.setFromEuler(e);else if(qt(e))if(e.length===4&&me(e[0])&&me(e[1])&&me(e[2])&&me(e[3]))this._rotation.fromArray(e);else throw new Error("Skybox rotation was not a valid array format. Needs an array of 4 numbers.");else ut(e)?this._rotation.setFromAxisAngle(wg,e):(w(e)&&console.warn("Skybox rotation must be a THREE.Quaternion, THREE.Euler, number[] (representing a Quaternion), or a number (representing rotation about the Y-axis)."),this._rotation.identity());this.rotationNeedsUpdate=this._rotation.x!==t||this._rotation.y!==o||this._rotation.z!==r||this._rotation.w!==i}checkWebXRLayer(e){if(this._cube){let t=this.useWebXRLayers&&this.env.hasXRCompositionLayers&&w(e)&&w(this.env.xrBinding),o=t!==this.wasWebXRLayerAvailable;if(o){if(t){let r=this.env.renderer.xr.getReferenceSpace();this.layer=this.env.xrBinding.createCubeLayer({space:r,layout:"mono",isStatic:!1,viewPixelWidth:lt,viewPixelHeight:lt,orientation:this.layerOrientation}),this.layer.addEventListener("redraw",this.onNeedsRedraw),this.env.addWebXRLayer(this.layer,Number.MAX_VALUE)}else this.layer&&(this.env.removeWebXRLayer(this.layer),this.layer.removeEventListener("redraw",this.onNeedsRedraw),Hn(this.layer),this.layer=null);this.imageNeedsUpdate=!0}if(!this.layer||!o){let r=this.visible!==this.wasVisible,i=this.env.avatar.headingRadians!==this.stageHeading;if(this.imageNeedsUpdate=this.imageNeedsUpdate||r||this.layer&&this.layer.needsRedraw,this.rotationNeedsUpdate=this.rotationNeedsUpdate||i,this.env.scene.background=this.layer?null:this.visible?this.rt.texture:sl,this.rotationNeedsUpdate&&(this.layerRotation.copy(this.rotation).invert(),this.stageRotation.setFromAxisAngle(wg,this.env.avatar.headingRadians).premultiply(this.layerRotation),this.layerOrientation=new DOMPointReadOnly(this.stageRotation.x,this.stageRotation.y,this.stageRotation.z,this.stageRotation.w),this.layer?this.layer.orientation=this.layerOrientation:(this.rtCamera.quaternion.copy(this.layerRotation),this.imageNeedsUpdate=!0)),this.imageNeedsUpdate)if(this.layer){let s=this.env.renderer.getContext(),a=this.env.xrBinding.getSubImage(this.layer,e),l=this._cube.images;this.flipper.fillRect(0,0,lt,lt),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.bindTexture(s.TEXTURE_CUBE_MAP,a.colorTexture);for(let p=0;p<l.length;++p){if(this.visible){let m=l[ZA[p]];this.flipper.drawImage(m,0,0,m.width,m.height,0,0,lt,lt)}s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.flipped)}s.bindTexture(s.TEXTURE_CUBE_MAP,null)}else this.rtCamera.update(this.env.renderer,this.rtScene);this.stageHeading=this.env.avatar.headingRadians,this.imageNeedsUpdate=!1,this.rotationNeedsUpdate=!1,this.wasVisible=this.visible}this.wasWebXRLayerAvailable=t}}};var Xr=new V,Fg=0,$A=new V,cl=new V,bp=new V,ll=new de,Ag=0,e2=0;function t2(n,e){let t=n-e,o=t+dt,r=t-dt;return Wm(t,o,r)}var bs=class extends be{constructor(e,t,o,r,i=1){super(),this.minDistance=t,this.heightOffset=r,this.speed=i,this.name=e,this.lerp=this.minHeadingRadians>0||this.minDistance>0,this.maxDistance=this.minDistance*5,this.minHeadingRadians=nt(o),this.maxHeadingRadians=Ee-this.minHeadingRadians,Object.seal(this)}copy(e,t=!0){return super.copy(e,t),this.name=e.name+ ++e2,this.lerp=e.lerp,this.maxDistance=e.maxDistance,this.minHeadingRadians=e.minHeadingRadians,this.maxHeadingRadians=e.maxHeadingRadians,this}update(e,t,o,r){r*=.001,this.clampTo(this.lerp,e,t,this.minDistance,this.maxDistance,o,this.minHeadingRadians,this.maxHeadingRadians,r)}reset(e,t,o){this.clampTo(!1,e,t,0,0,o,0,0,0)}clampTo(e,t,o,r,i,s,a,l,p){Xr.copy(o),Xr.y-=this.heightOffset*t,Fg=s,this.getWorldPosition(cl),this.getWorldDirection(bp),bp.negate(),Ag=is(bp),ll.identity();let m=!e,x=!e;if(e){let F=$A.copy(Xr).sub(cl).length();r<F&&(F<i&&Xr.lerpVectors(cl,Xr,this.speed*p),m=!0);let v=t2(Fg,Ag),k=Math.abs(v);a<k&&(k<l?ll.setFromAxisAngle(this.up,v*this.speed*p):ll.setFromAxisAngle(this.up,v),x=!0)}(m||x)&&(m&&this.position.add(Xr.sub(cl)),x&&this.quaternion.multiply(ll))}};var ul=class extends N{constructor(e,t){super(e),this.button=t}},yp=class extends ul{constructor(e){super("gamepadbuttonup",e)}},Dp=class extends ul{constructor(e){super("gamepadbuttondown",e)}},Cp=class extends N{constructor(e,t,o){super(e),this.axis=t,this.value=o}},Bp=class extends Cp{constructor(e,t){super("gamepadaxismaxed",e,t)}},pl=class extends re{constructor(){super(),this.lastAxisValues=new Array,this.btnDownEvts=new Array,this.btnUpEvts=new Array,this.wasPressed=new Array,this.axisMaxEvts=new Array,this.wasAxisMaxed=new Array,this.sticks=new Array,this.axisThresholdMax=.9,this.axisThresholdMin=.1,this._pad=null,Object.seal(this)}get displayId(){if("displayId"in this.pad)return this.pad.displayId}get pad(){return this._pad}set pad(e){if(this._pad=e,this.pad){if(this.btnUpEvts.length===0){for(let t=0;t<e.buttons.length;++t)this.btnDownEvts[t]=new Dp(t),this.btnUpEvts[t]=new yp(t),this.wasPressed[t]=!1;for(let t=0;t<e.axes.length;++t)this.axisMaxEvts[t]=new Bp(t,0),this.wasAxisMaxed[t]=!1,t%2===0&&t<e.axes.length-1&&(this.sticks[t/2]={x:0,y:0}),this.lastAxisValues[t]=e.axes[t]}for(let t=0;t<this.pad.buttons.length;++t){let o=this.wasPressed[t],r=this.pad.buttons[t].pressed;r!==o&&(this.wasPressed[t]=r,this.dispatchEvent((r?this.btnDownEvts:this.btnUpEvts)[t]))}for(let t=0;t<this.pad.axes.length;++t){let o=this.wasAxisMaxed[t],r=this.pad.axes[t],i=Math.sign(r),s=Math.abs(r),a=s>=this.axisThresholdMax,l=s<=this.axisThresholdMin,p=i*(a?1:l?0:s);a&&!o&&(this.axisMaxEvts[t].value=p,this.dispatchEvent(this.axisMaxEvts[t])),this.wasAxisMaxed[t]=a,this.lastAxisValues[t]=p}for(let t=0;t<this.axes.length-1;t+=2){let o=this.sticks[t/2];o.x=this.axes[t],o.y=this.axes[t+1]}}}get id(){return this.pad?this.pad.id:null}get index(){return this.pad?this.pad.index:null}get connected(){return this.pad&&this.pad.connected}get mapping(){return this.pad?this.pad.mapping:null}get timestamp(){return this.pad?this.pad.timestamp:null}get hand(){return this.pad?this.pad.hand:null}get pose(){return this.pad?this.pad.pose:null}get buttons(){return this.pad?this.pad.buttons:null}get axes(){return this.pad?this.pad.axes:null}get hapticActuators(){return this.pad?this.pad.hapticActuators:null}get vibrationActuator(){return this.pad?this.pad.vibrationActuator:null}};var dl=class extends yr{constructor(e){super(e)}start(){this.timer=setInterval(()=>this.onTick(performance.now()),this.targetFrameTime)}stop(){this.timer&&(clearInterval(this.timer),super.stop())}get targetFPS(){return super.targetFPS}set targetFPS(e){super.targetFPS=e,this.isRunning&&this.restart()}};var Lp=class extends N{constructor(){super("activity"),this.level=0}},ys=class extends dr{constructor(e){super(e,{fftSize:32,minDecibels:-70}),this._level=0,this.maxLevel=0,this.activityEvt=new Lp,this.timer=new dl(30);let t=new Uint8Array(this.frequencyBinCount);this.timer.addTickHandler(()=>{this.getByteFrequencyData(t),this._level=Math.max(...t),isFinite(this._level)&&(this.maxLevel=Math.max(this.maxLevel,this._level),this.maxLevel>0&&(this._level/=this.maxLevel)),this.activityEvt.level=this.level,this.dispatchEvent(this.activityEvt)})}get level(){return this._level}start(){this.timer.start()}stop(){this.timer.stop()}};var Ge;(function(n){n[n.LocalUser=0]="LocalUser",n[n.Mouse=1]="Mouse",n[n.Pen=2]="Pen",n[n.Touch=3]="Touch",n[n.Gamepad=4]="Gamepad",n[n.MotionController=5]="MotionController",n[n.MotionControllerLeft=6]="MotionControllerLeft",n[n.MotionControllerRight=7]="MotionControllerRight",n[n.Nose=8]="Nose",n[n.RemoteUser=9]="RemoteUser"})(Ge||(Ge={}));var jr=new V;function Rp(n,e,t,o){jr.crossVectors(e,n),n.crossVectors(jr,e),jr.normalize(),n.normalize(),e.normalize(),o.set(jr.x,n.x,-e.x,t.x,jr.y,n.y,-e.y,t.y,jr.z,n.z,-e.z,t.z,0,0,0,1)}var qr=class{constructor(){this._visible=!0,this._style="default"}get style(){return this._style}set style(e){this._style=e}get visible(){return this._visible}set visible(e){this._visible=e}};var ao=class extends qr{get side(){return this._side}set side(e){this._side=e}get object(){return this._object}set object(e){this._object=e}constructor(e){super(),this.env=e,this._object=null,this.T=new V,this.V=new V,this.Q=new de,this._side=-1,this.f=new V,this.up=new V,this.right=new V}get position(){return this.object.position}update(e,t,o,r,i,s,a,l,p,m,x){o&&o.face?(this.position.copy(o.point),o.object.getWorldQuaternion(this.Q),this.T.copy(o.face.normal).applyQuaternion(this.Q),this.V.copy(this.T).multiplyScalar(.02),this.position.add(this.V),this.V.copy(this.T).multiplyScalar(10).add(this.position)):(s?this.position.copy(m).multiplyScalar(2).add(p).sub(this.env.avatar.worldPos).normalize().multiplyScalar(i).add(this.env.avatar.worldPos):(this.V.copy(p).add(t).sub(e).multiplyScalar(2),this.position.copy(m).multiplyScalar(i).add(this.V).add(this.env.avatar.worldPos)),this.V.copy(this.env.avatar.worldPos)),this.lookAt(this.position,this.V),this.style=!r||r.navigable&&!l?a?x?"grabbing":"grab":"default":r.enabled?r.draggable?x?"grabbing":"move":r.navigable?"cell":r.clickable?"pointer":"default":"not-allowed"}lookAt(e,t){this.f.copy(t).sub(e).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat),this.right.crossVectors(this.up,this.f),this.up.crossVectors(this.f,this.right),Rp(this.up,this.f,e,this.object.matrixWorld),this.object.matrix.copy(this.object.parent.matrixWorld).invert().multiply(this.object.matrixWorld),this.object.matrix.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.scale.x*=this.side,this.object.matrix.compose(this.object.position,this.object.quaternion,this.object.scale)}};var Yo=class extends ao{constructor(e){super(e),this.material=rx({name:"CursorMat",color:16776960}),this.object=new ln(.01,.01,.01,this.material)}get style(){return this._currentStyle}set style(e){if(this._currentStyle=e,vt(this.object)&&!qt(this.object.material))switch(this._currentStyle){case"pointer":this.material.color=new Pe(65280),this.material.needsUpdate=!0;break;case"not-allowed":this.material.color=new Pe(16711680),this.material.needsUpdate=!0;break;case"move":this.material.color=new Pe(255),this.material.needsUpdate=!0;break;case"grab":this.material.color=new Pe(16711935),this.material.needsUpdate=!0;break;case"grabbing":this.material.color=new Pe(65535),this.material.needsUpdate=!0;break;default:this._currentStyle="default",this.material.color=new Pe(16776960),this.material.needsUpdate=!0;break}}get visible(){return Vr(this)}set visible(e){Ve(this,e)}};var _g=new Eo,hl=new V,Ko=class extends uf{constructor(){super(),this.type="LineSegmentsGeometry";let e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],o=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(o),this.setAttribute("position",new rc(e,3)),this.setAttribute("uv",new rc(t,2))}applyMatrix4(e){let t=this.attributes.instanceStart,o=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),o.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let o=new Wi(t,6,1);return this.setAttribute("instanceStart",new Ut(o,3,0)),this.setAttribute("instanceEnd",new Ut(o,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let o=new Wi(t,6,1);return this.setAttribute("instanceColorStart",new Ut(o,3,0)),this.setAttribute("instanceColorEnd",new Ut(o,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new Hf(e.geometry)),this}fromLineSegments(e){let t=e.geometry;if(t.isGeometry){console.error("LineSegmentsGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else t.isBufferGeometry&&this.setPositions(t.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Eo);let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),_g.setFromBufferAttribute(t),this.boundingBox.union(_g))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Pr),this.boundingBox===null&&this.computeBoundingBox();let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){let o=this.boundingSphere.center;this.boundingBox.getCenter(o);let r=0;for(let i=0,s=e.count;i<s;i++)hl.fromBufferAttribute(e,i),r=Math.max(r,o.distanceToSquared(hl)),hl.fromBufferAttribute(t,i),r=Math.max(r,o.distanceToSquared(hl));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}};Ko.prototype.isLineSegmentsGeometry=!0;var vg=new V,Sg=new V,Ye=new cn,Ke=new cn,pn=new cn,Pp=new V,Vp=new we,Lt=new mf,Tg=new V,kn=new Eo,ml=new Pr,dn=new cn;function Mg(n,e,t,o){return dn.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),dn.multiplyScalar(1/dn.w),dn.x=t/o.width,dn.y=t/o.height,dn.applyMatrix4(n.projectionMatrixInverse),dn.multiplyScalar(1/dn.w),Math.abs(Math.max(dn.x,dn.y))}var Ds=class extends _t{constructor(e=new Ko,t=new _n({color:Math.random()*16777215})){super(e,t),this.type="LineSegments2"}computeLineDistances(){let e=this.geometry,t=e.attributes.instanceStart,o=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let s=0,a=0,l=t.count;s<l;s++,a+=2)vg.fromBufferAttribute(t,s),Sg.fromBufferAttribute(o,s),r[a]=a===0?0:r[a-1],r[a+1]=r[a]+vg.distanceTo(Sg);let i=new Wi(r,2,1);return e.setAttribute("instanceDistanceStart",new Ut(i,1,0)),e.setAttribute("instanceDistanceEnd",new Ut(i,1,1)),this}raycast(e,t){e.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');let o=e.params.Line2!==void 0&&e.params.Line2.threshold||0,r=e.ray,i=e.camera,s=i.projectionMatrix,a=this.matrixWorld,l=this.geometry,p=this.material,m=p.resolution,x=p.linewidth+o,F=l.attributes.instanceStart,v=l.attributes.instanceEnd,k=-i.near;l.boundingSphere===null&&l.computeBoundingSphere(),ml.copy(l.boundingSphere).applyMatrix4(a);let D=Math.max(i.near,ml.distanceToPoint(r.origin)),b=Mg(i,D,x,m);if(ml.radius+=b,e.ray.intersectsSphere(ml)===!1)return;l.boundingBox===null&&l.computeBoundingBox(),kn.copy(l.boundingBox).applyMatrix4(a);let P=Math.max(i.near,kn.distanceToPoint(r.origin)),O=Mg(i,P,x,m);if(kn.max.x+=O,kn.max.y+=O,kn.max.z+=O,kn.min.x-=O,kn.min.y-=O,kn.min.z-=O,e.ray.intersectsBox(kn)!==!1){r.at(1,pn),pn.w=1,pn.applyMatrix4(i.matrixWorldInverse),pn.applyMatrix4(s),pn.multiplyScalar(1/pn.w),pn.x*=m.x/2,pn.y*=m.y/2,pn.z=0,Pp.copy(pn),Vp.multiplyMatrices(i.matrixWorldInverse,a);for(let L=0,U=F.count;L<U;L++){Ye.fromBufferAttribute(F,L),Ke.fromBufferAttribute(v,L),Ye.w=1,Ke.w=1,Ye.applyMatrix4(Vp),Ke.applyMatrix4(Vp);var I=Ye.z>k&&Ke.z>k;if(I)continue;if(Ye.z>k){let ie=Ye.z-Ke.z,ne=(Ye.z-k)/ie;Ye.lerp(Ke,ne)}else if(Ke.z>k){let ie=Ke.z-Ye.z,ne=(Ke.z-k)/ie;Ke.lerp(Ye,ne)}Ye.applyMatrix4(s),Ke.applyMatrix4(s),Ye.multiplyScalar(1/Ye.w),Ke.multiplyScalar(1/Ke.w),Ye.x*=m.x/2,Ye.y*=m.y/2,Ke.x*=m.x/2,Ke.y*=m.y/2,Lt.start.copy(Ye),Lt.start.z=0,Lt.end.copy(Ke),Lt.end.z=0;let C=Lt.closestPointToPointParameter(Pp,!0);Lt.at(C,Tg);let W=lc.lerp(Ye.z,Ke.z,C),$=W>=-1&&W<=1,Y=Pp.distanceTo(Tg)<x*.5;if($&&Y){Lt.start.fromBufferAttribute(F,L),Lt.end.fromBufferAttribute(v,L),Lt.start.applyMatrix4(a),Lt.end.applyMatrix4(a);let ie=new V,ne=new V;r.distanceSqToSegment(Lt.start,Lt.end,ne,ie),t.push({point:ne,pointOnLine:ie,distance:r.origin.distanceTo(ne),object:this,face:null,faceIndex:L,uv:null,uv2:null})}}}}};Ds.prototype.isLineSegments2=!0;var Jo=class extends Ko{constructor(){super(),this.type="LineGeometry"}setPositions(e){for(var t=e.length-3,o=new Float32Array(2*t),r=0;r<t;r+=3)o[2*r]=e[r],o[2*r+1]=e[r+1],o[2*r+2]=e[r+2],o[2*r+3]=e[r+3],o[2*r+4]=e[r+4],o[2*r+5]=e[r+5];return super.setPositions(o),this}setColors(e){for(var t=e.length-3,o=new Float32Array(2*t),r=0;r<t;r+=3)o[2*r]=e[r],o[2*r+1]=e[r+1],o[2*r+2]=e[r+2],o[2*r+3]=e[r+3],o[2*r+4]=e[r+4],o[2*r+5]=e[r+5];return super.setColors(o),this}fromLine(e){var t=e.geometry;if(t.isGeometry){console.error("LineGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else t.isBufferGeometry&&this.setPositions(t.attributes.position.array);return this}};Jo.prototype.isLineGeometry=!0;var Cs=class extends Ds{constructor(e=new Jo,t=new _n({color:Math.random()*16777215})){super(e,t),this.type="Line2"}};Cs.prototype.isLine2=!0;var kg=new Jo;kg.setPositions([0,0,0,0,0,-1]);var Bs=class extends be{constructor(e,t,o){super(),this._length=1,this.line=new Cs(kg,ix({color:e,transparent:t<1,opacity:t,linewidth:o})),this.line.computeLineDistances(),z(this,this.line)}get length(){return this._length}set length(e){this._length=e,this.line.scale.set(1,1,e)}};var fl=class extends qr{constructor(e){super(),this.element=e,this._hidden=!1,this.visible=!0,this.style="default",document.addEventListener("pointerlockchange",()=>{this._hidden=!!document.pointerLockElement,this.refresh()})}get style(){return super.style}set style(e){super.style=e,this.refresh()}get visible(){return super.visible&&!this._hidden}set visible(e){super.visible=e,this.refresh()}refresh(){this.element.style.cursor=this.visible?this.style:"none"}};var Qr=class extends ao{constructor(e){super(e),this.xr=e.cursor3D&&e.cursor3D.clone()||new Yo(this.env),this.system=new fl(this.env.renderer.domElement),this.xr.side=this.side,this.visible=!1,Object.seal(this)}get object(){return this.xr.object}get side(){return this.xr.side}set side(e){this.xr.side=e}get cursor(){return this.xr}set cursor(e){this.xr=e,this._refresh()}get style(){return this.system.style}get visible(){return super.visible}set visible(e){super.visible=e,this._refresh()}set style(e){this.system.style=e,this.xr.style=e,this._refresh()}_refresh(){let e=this.env.eventSys&&this.env.eventSys.mouse&&this.env.eventSys.mouse.isPointerLocked,t=this.env.renderer.xr.isPresenting||e;Ve(this.xr,this.visible&&t),this.system.visible=this.visible&&!t}lookAt(e,t){this.xr.lookAt(e,t)}};var xl=class extends N{constructor(e,t){super(e),this.pointer=t,this._hit=null,this._point=null,this._distance=Number.POSITIVE_INFINITY,this._rayTarget=null,Object.seal(this)}set(e,t){e!==this.hit&&(this._hit=e,e?(this._point=e.point,this._distance=e.distance):(this._point=null,this._distance=Number.POSITIVE_INFINITY)),this._rayTarget=t}get hit(){return this._hit}get rayTarget(){return this._rayTarget}get point(){return this._point}get distance(){return this._distance}};var n2=5,o2=new V,En=class extends re{constructor(e,t,o,r){super(),this.type=e,this.id=t,this.env=o,this.origin=new V,this.direction=new V,this.up=new V(0,1,0),this.canMoveView=!1,this.mayTeleport=!1,this.buttons=0,this._isActive=!1,this.moveDistance=0,this.pointerEvents=new Map,this.lastButtons=0,this.canClick=!1,this.dragDistance=0,this._enabled=!1,this._cursor=null,this._curHit=null,this._curTarget=null,this._hoveredHit=null,this._hoveredTarget=null,this._cursor=r,this.cursor&&(this.cursor.visible=!1)}get isActive(){return this._isActive}get canSend(){return this.enabled&&this.isActive}get curHit(){return this._curHit}get curTarget(){return this._curTarget}get hoveredHit(){return this._hoveredHit}set hoveredHit(e){if(e!==this.hoveredHit){let t=ts(e);this._hoveredHit=e,this._hoveredTarget=t}}get name(){return Ge[this.id]}get rayTarget(){return this._hoveredTarget}get cursor(){return this._cursor}set cursor(e){if(e!==this.cursor){let t=this.cursor,o=this.cursor&&this.cursor.object&&this.cursor.object.name||"cursor",r=t&&t.object&&t.object.parent;r&&t.object.removeFromParent(),e&&(e.object.name=o,t instanceof Qr?(t.cursor=e,r&&z(r,t)):(this._cursor=e,t&&(r&&z(r,e),e.style=t.style,e.visible=t.visible)))}}get needsUpdate(){return this.enabled&&this._isActive}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.cursor&&(this.cursor.visible=e)}setButton(e,t){this.lastButtons=this.buttons;let o=1<<e;if(t?this.buttons|=o:this.buttons&=~o,t)this.canClick=!0,this.dragDistance=0,this.env.avatar.setMode(this),this.setEventState("down");else{if(this.canClick){let r=this.buttons;this.buttons=this.lastButtons,this.setEventState("click"),this.buttons=r}this.setEventState("up")}}isPressed(e){let t=1<<e;return(this.buttons&t)!==0}wasPressed(e){let t=1<<e;return(this.lastButtons&t)!==0}fireRay(e,t){let o=this.env.eventSys.fireRay(e,t);if(o!==this.curHit){let r=ts(o);this._curHit=o,this._curTarget=r}}getEvent(e){this.pointerEvents.has(e)||this.pointerEvents.set(e,new xl(e,this));let t=this.pointerEvents.get(e);if(this.hoveredHit?t.set(this.hoveredHit,this.rayTarget):this.curHit?t.set(this.curHit,this.curTarget):t.set(null,null),t.hit){let o=this.curHit||this.hoveredHit;o&&t.hit!==o&&(t.hit.uv=o.uv)}return t}update(){this.needsUpdate&&this.onUpdate()}onUpdate(){this.updatePointerOrientation();let e=this.isPressed(Ie.Primary);(this.moveDistance>0||e)&&(e&&(this.dragDistance+=this.moveDistance,this.dragDistance>n2&&(this.canClick=!1)),this.setEventState("move")),this.moveDistance=0}setEventState(e){if(this.fireRay(this.origin,this.direction),this.curTarget===this.rayTarget)this.hoveredHit=this.curHit;else{let o=this.isPressed(Ie.Primary),r=this.wasPressed(Ie.Primary);if(e==="move"&&!o||e==="down"&&o&&!r||e==="up"&&!o&&r){if(this.rayTarget){let l=this.getEvent("up");this.rayTarget.dispatchEvent(l);let p=this.getEvent("exit");this.dispatchEvent(p),this.rayTarget.dispatchEvent(p)}if(this.hoveredHit=this.curHit,this.rayTarget){let l=this.getEvent("enter");this.dispatchEvent(l),this.rayTarget.dispatchEvent(l)}}this.hoveredHit&&this.hoveredHit.point.copy(this.direction).multiplyScalar(this.hoveredHit.distance).add(this.origin)}let t=this.getEvent(e);this.dispatchEvent(t),t.rayTarget&&(e!=="click"||t.rayTarget.clickable||t.rayTarget.navigable)&&(e==="click"&&t.rayTarget.clickable&&this.vibrate(),t.rayTarget.enabled&&t.rayTarget.dispatchEvent(t)),this.updateCursor(this.env.avatar.worldPos,o2,!0,2)}get canDragView(){return this.canMoveView}get canTeleport(){return this.mayTeleport}updateCursor(e,t,o,r){this.cursor&&this.cursor.update(e,t,this.hoveredHit||this.curHit,this.rayTarget||this.curTarget,r,o,this.canDragView,this.canTeleport,this.origin,this.direction,this.isPressed(Ie.Primary))}get bufferSize(){return 37}writeState(e){e.writeUint8(this.id),e.writeVector48(this.origin),e.writeVector48(this.direction),e.writeVector48(this.up)}};var r2=.2,X8=.5*r2-.025;var m7={fontFamily:tr(),fontSize:20,fontWeight:"bold",textFillColor:"white",textStrokeColor:"black",textStrokeSize:.01,padding:{top:.025,right:.05,bottom:.025,left:.05},maxHeight:.2};var Ip=["none","right","left"],q7=Qt(Yt);function Op(n,e){if(e===Pf)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===Gi||e===fc){let t=n.getIndex();if(t===null){let s=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)s.push(l);n.setIndex(s),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}let o=t.count-2,r=[];if(e===Gi)for(let s=1;s<=o;s++)r.push(t.getX(0)),r.push(t.getX(s)),r.push(t.getX(s+1));else for(let s=0;s<o;s++)s%2===0?(r.push(t.getX(s)),r.push(t.getX(s+1)),r.push(t.getX(s+2))):(r.push(t.getX(s+2)),r.push(t.getX(s+1)),r.push(t.getX(s)));r.length/3!==o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let i=n.clone();return i.setIndex(r),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}var uo=class extends Ff{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Xp(t)}),this.register(function(t){return new Zp(t)}),this.register(function(t){return new $p(t)}),this.register(function(t){return new ed(t)}),this.register(function(t){return new qp(t)}),this.register(function(t){return new Qp(t)}),this.register(function(t){return new Yp(t)}),this.register(function(t){return new Kp(t)}),this.register(function(t){return new Gp(t)}),this.register(function(t){return new Jp(t)}),this.register(function(t){return new jp(t)}),this.register(function(t){return new Up(t)}),this.register(function(t){return new td(t)}),this.register(function(t){return new nd(t)})}load(e,t,o,r){let i=this,s;this.resourcePath!==""?s=this.resourcePath:this.path!==""?s=this.path:s=ac.extractUrlBase(e),this.manager.itemStart(e);let a=function(p){r?r(p):console.error(p),i.manager.itemError(e),i.manager.itemEnd(e)},l=new bu(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(p){try{i.parse(p,s,function(m){t(m),i.manager.itemEnd(e)},a)}catch(m){a(m)}},o,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,o,r){let i,s={},a={},l=new TextDecoder;if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===Cg){try{s[Z.KHR_BINARY_GLTF]=new od(e)}catch(x){r&&r(x);return}i=JSON.parse(s[Z.KHR_BINARY_GLTF].content)}else i=JSON.parse(l.decode(e));else i=e;if(i.asset===void 0||i.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let p=new ud(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});p.fileLoader.setRequestHeader(this.requestHeader);for(let m=0;m<this.pluginCallbacks.length;m++){let x=this.pluginCallbacks[m](p);a[x.name]=x,s[x.name]=!0}if(i.extensionsUsed)for(let m=0;m<i.extensionsUsed.length;++m){let x=i.extensionsUsed[m],F=i.extensionsRequired||[];switch(x){case Z.KHR_MATERIALS_UNLIT:s[x]=new zp;break;case Z.KHR_DRACO_MESH_COMPRESSION:s[x]=new rd(i,this.dracoLoader);break;case Z.KHR_TEXTURE_TRANSFORM:s[x]=new id;break;case Z.KHR_MESH_QUANTIZATION:s[x]=new sd;break;default:F.indexOf(x)>=0&&a[x]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+x+'".')}}p.setExtensions(s),p.setPlugins(a),p.parse(o,r)}parseAsync(e,t){let o=this;return new Promise(function(r,i){o.parse(e,t,r,i)})}};function s2(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}var Z={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"},Up=class{constructor(e){this.parser=e,this.name=Z.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let o=0,r=t.length;o<r;o++){let i=t[o];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){let t=this.parser,o="light:"+e,r=t.cache.get(o);if(r)return r;let i=t.json,l=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e],p,m=new Pe(16777215);l.color!==void 0&&m.fromArray(l.color);let x=l.range!==void 0?l.range:0;switch(l.type){case"directional":p=new oc(m),p.target.position.set(0,0,-1),p.add(p.target);break;case"point":p=new Tf(m),p.distance=x;break;case"spot":p=new Bf(m),p.distance=x,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,p.angle=l.spot.outerConeAngle,p.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,p.target.position.set(0,0,-1),p.add(p.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return p.position.set(0,0,0),p.decay=2,lo(p,l),l.intensity!==void 0&&(p.intensity=l.intensity),p.name=t.createUniqueName(l.name||"light_"+e),r=Promise.resolve(p),t.cache.add(o,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){let t=this,o=this.parser,i=o.json.nodes[e],a=(i.extensions&&i.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return o._getNodeRef(t.cache,a,l)})}},zp=class{constructor(){this.name=Z.KHR_MATERIALS_UNLIT}getMaterialType(){return it}extendParams(e,t,o){let r=[];e.color=new Pe(1,1,1),e.opacity=1;let i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){let s=i.baseColorFactor;e.color.fromArray(s),e.opacity=s[3]}i.baseColorTexture!==void 0&&r.push(o.assignTexture(e,"map",i.baseColorTexture,Lr))}return Promise.all(r)}},Gp=class{constructor(e){this.parser=e,this.name=Z.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}},Xp=class{constructor(e){this.parser=e,this.name=Z.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:qn}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];if(s.clearcoatFactor!==void 0&&(t.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&i.push(o.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&i.push(o.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(i.push(o.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){let a=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Ue(a,a)}return Promise.all(i)}},jp=class{constructor(e){this.parser=e,this.name=Z.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:qn}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];return s.iridescenceFactor!==void 0&&(t.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&i.push(o.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(t.iridescenceIOR=s.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&i.push(o.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(i)}},qp=class{constructor(e){this.parser=e,this.name=Z.KHR_MATERIALS_SHEEN}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:qn}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[];t.sheenColor=new Pe(0,0,0),t.sheenRoughness=0,t.sheen=1;let s=r.extensions[this.name];return s.sheenColorFactor!==void 0&&t.sheenColor.fromArray(s.sheenColorFactor),s.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&i.push(o.assignTexture(t,"sheenColorMap",s.sheenColorTexture,Lr)),s.sheenRoughnessTexture!==void 0&&i.push(o.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(i)}},Qp=class{constructor(e){this.parser=e,this.name=Z.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:qn}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];return s.transmissionFactor!==void 0&&(t.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&i.push(o.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(i)}},Yp=class{constructor(e){this.parser=e,this.name=Z.KHR_MATERIALS_VOLUME}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:qn}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];t.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&i.push(o.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;let a=s.attenuationColor||[1,1,1];return t.attenuationColor=new Pe(a[0],a[1],a[2]),Promise.all(i)}},Kp=class{constructor(e){this.parser=e,this.name=Z.KHR_MATERIALS_IOR}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:qn}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}},Jp=class{constructor(e){this.parser=e,this.name=Z.KHR_MATERIALS_SPECULAR}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:qn}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];t.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&i.push(o.assignTexture(t,"specularIntensityMap",s.specularTexture));let a=s.specularColorFactor||[1,1,1];return t.specularColor=new Pe(a[0],a[1],a[2]),s.specularColorTexture!==void 0&&i.push(o.assignTexture(t,"specularColorMap",s.specularColorTexture,Lr)),Promise.all(i)}},Zp=class{constructor(e){this.parser=e,this.name=Z.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,o=t.json,r=o.textures[e];if(!r.extensions||!r.extensions[this.name])return null;let i=r.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(o.extensionsRequired&&o.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,s)}},$p=class{constructor(e){this.parser=e,this.name=Z.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,o=this.parser,r=o.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;let s=i.extensions[t],a=r.images[s.source],l=o.textureLoader;if(a.uri){let p=o.options.manager.getHandler(a.uri);p!==null&&(l=p)}return this.detectSupport().then(function(p){if(p)return o.loadTextureImage(e,s.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return o.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},ed=class{constructor(e){this.parser=e,this.name=Z.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let t=this.name,o=this.parser,r=o.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;let s=i.extensions[t],a=r.images[s.source],l=o.textureLoader;if(a.uri){let p=o.options.manager.getHandler(a.uri);p!==null&&(l=p)}return this.detectSupport().then(function(p){if(p)return o.loadTextureImage(e,s.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return o.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},td=class{constructor(e){this.name=Z.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,o=t.bufferViews[e];if(o.extensions&&o.extensions[this.name]){let r=o.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(a){let l=r.byteOffset||0,p=r.byteLength||0,m=r.count,x=r.byteStride,F=new Uint8Array(a,l,p);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(m,x,F,r.mode,r.filter).then(function(v){return v.buffer}):s.ready.then(function(){let v=new ArrayBuffer(m*x);return s.decodeGltfBuffer(new Uint8Array(v),m,x,F,r.mode,r.filter),v})})}else return null}},nd=class{constructor(e){this.name=Z.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){let t=this.parser.json,o=t.nodes[e];if(!o.extensions||!o.extensions[this.name]||o.mesh===void 0)return null;let r=t.meshes[o.mesh];for(let p of r.primitives)if(p.mode!==Rt.TRIANGLES&&p.mode!==Rt.TRIANGLE_STRIP&&p.mode!==Rt.TRIANGLE_FAN&&p.mode!==void 0)return null;let s=o.extensions[this.name].attributes,a=[],l={};for(let p in s)a.push(this.parser.getDependency("accessor",s[p]).then(m=>(l[p]=m,l[p])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(p=>{let m=p.pop(),x=m.isGroup?m.children:[m],F=p[0].count,v=[];for(let k of x){let D=new we,b=new V,P=new de,O=new V(1,1,1),I=new sc(k.geometry,k.material,F);for(let L=0;L<F;L++)l.TRANSLATION&&b.fromBufferAttribute(l.TRANSLATION,L),l.ROTATION&&P.fromBufferAttribute(l.ROTATION,L),l.SCALE&&O.fromBufferAttribute(l.SCALE,L),I.setMatrixAt(L,D.compose(b,P,O));for(let L in l)L!=="TRANSLATION"&&L!=="ROTATION"&&L!=="SCALE"&&k.geometry.setAttribute(L,l[L]);be.prototype.copy.call(I,k),this.parser.assignFinalMaterial(I),v.push(I)}return m.isGroup?(m.clear(),m.add(...v),m):v[0]}))}},Cg="glTF",Ls=12,Eg={JSON:1313821514,BIN:5130562},od=class{constructor(e){this.name=Z.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,Ls),o=new TextDecoder;if(this.header={magic:o.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Cg)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-Ls,i=new DataView(e,Ls),s=0;for(;s<r;){let a=i.getUint32(s,!0);s+=4;let l=i.getUint32(s,!0);if(s+=4,l===Eg.JSON){let p=new Uint8Array(e,Ls+s,a);this.content=o.decode(p)}else if(l===Eg.BIN){let p=Ls+s;this.body=e.slice(p,p+a)}s+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},rd=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Z.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let o=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,a={},l={},p={};for(let m in s){let x=cd[m]||m.toLowerCase();a[x]=s[m]}for(let m in e.attributes){let x=cd[m]||m.toLowerCase();if(s[m]!==void 0){let F=o.accessors[e.attributes[m]],v=Yr[F.componentType];p[x]=v.name,l[x]=F.normalized===!0}}return t.getDependency("bufferView",i).then(function(m){return new Promise(function(x){r.decodeDracoFile(m,function(F){for(let v in F.attributes){let k=F.attributes[v],D=l[v];D!==void 0&&(k.normalized=D)}x(F)},a,p)})})}},id=class{constructor(){this.name=Z.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},sd=class{constructor(){this.name=Z.KHR_MESH_QUANTIZATION}},gl=class extends pf{constructor(e,t,o,r){super(e,t,o,r)}copySampleValue_(e){let t=this.resultBuffer,o=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let s=0;s!==r;s++)t[s]=o[i+s];return t}interpolate_(e,t,o,r){let i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=a*2,p=a*3,m=r-t,x=(o-t)/m,F=x*x,v=F*x,k=e*p,D=k-p,b=-2*v+3*F,P=v-F,O=1-b,I=P-F+x;for(let L=0;L!==a;L++){let U=s[D+L+a],C=s[D+L+l]*m,W=s[k+L+a],$=s[k+L]*m;i[L]=O*U+I*C+b*W+P*$}return i}},a2=new de,ad=class extends gl{interpolate_(e,t,o,r){let i=super.interpolate_(e,t,o,r);return a2.fromArray(i).normalize().toArray(i),i}},Rt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Yr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},bg={9728:uc,9729:Hi,9984:vf,9985:wf,9986:_f,9987:Bu},yg={33071:ef,33648:Af,10497:dc},Wp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},cd={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},co={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},c2={CUBICSPLINE:void 0,LINEAR:Du,STEP:df},Hp={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function l2(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new Ru({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Oi})),n.DefaultMaterial}function Zo(n,e,t){for(let o in t.extensions)n[o]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[o]=t.extensions[o])}function lo(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function u2(n,e,t){let o=!1,r=!1,i=!1;for(let p=0,m=e.length;p<m;p++){let x=e[p];if(x.POSITION!==void 0&&(o=!0),x.NORMAL!==void 0&&(r=!0),x.COLOR_0!==void 0&&(i=!0),o&&r&&i)break}if(!o&&!r&&!i)return Promise.resolve(n);let s=[],a=[],l=[];for(let p=0,m=e.length;p<m;p++){let x=e[p];if(o){let F=x.POSITION!==void 0?t.getDependency("accessor",x.POSITION):n.attributes.position;s.push(F)}if(r){let F=x.NORMAL!==void 0?t.getDependency("accessor",x.NORMAL):n.attributes.normal;a.push(F)}if(i){let F=x.COLOR_0!==void 0?t.getDependency("accessor",x.COLOR_0):n.attributes.color;l.push(F)}}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(l)]).then(function(p){let m=p[0],x=p[1],F=p[2];return o&&(n.morphAttributes.position=m),r&&(n.morphAttributes.normal=x),i&&(n.morphAttributes.color=F),n.morphTargetsRelative=!0,n})}function p2(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,o=e.weights.length;t<o;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){let t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let o=0,r=t.length;o<r;o++)n.morphTargetDictionary[t[o]]=o}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function d2(n){let e,t=n.extensions&&n.extensions[Z.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Np(t.attributes):e=n.indices+":"+Np(n.attributes)+":"+n.mode,n.targets!==void 0)for(let o=0,r=n.targets.length;o<r;o++)e+=":"+Np(n.targets[o]);return e}function Np(n){let e="",t=Object.keys(n).sort();for(let o=0,r=t.length;o<r;o++)e+=t[o]+":"+n[t[o]]+";";return e}function ld(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function h2(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}var m2=new we,ud=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new s2,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let o=!1,r=!1,i=-1;typeof navigator<"u"&&(o=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,i=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||o||r&&i<98?this.textureLoader=new Rf(this.options.manager):this.textureLoader=new lf(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new bu(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let o=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([o.getDependencies("scene"),o.getDependencies("animation"),o.getDependencies("camera")])}).then(function(s){let a={scene:s[0][r.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:r.asset,parser:o,userData:{}};Zo(i,a,r),lo(a,r),Promise.all(o._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],o=this.json.meshes||[];for(let r=0,i=t.length;r<i;r++){let s=t[r].joints;for(let a=0,l=s.length;a<l;a++)e[s[a]].isBone=!0}for(let r=0,i=e.length;r<i;r++){let s=e[r];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(o[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,o){if(e.refs[t]<=1)return o;let r=o.clone(),i=(s,a)=>{let l=this.associations.get(s);l!=null&&this.associations.set(a,l);for(let[p,m]of s.children.entries())i(m,a.children[p])};return i(o,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let o=0;o<t.length;o++){let r=e(t[o]);if(r)return r}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let o=[];for(let r=0;r<t.length;r++){let i=e(t[r]);i&&o.push(i)}return o}getDependency(e,t){let o=e+":"+t,r=this.cache.get(o);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(i){return i.loadNode&&i.loadNode(t)});break;case"mesh":r=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(o,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){let o=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(i,s){return o.getDependency(e,s)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],o=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Z.KHR_BINARY_GLTF].body);let r=this.options;return new Promise(function(i,s){o.load(ac.resolveURL(t.uri,r.path),i,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(o){let r=t.byteLength||0,i=t.byteOffset||0;return o.slice(i,i+r)})}loadAccessor(e){let t=this,o=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){let s=Wp[r.type],a=Yr[r.componentType],l=r.normalized===!0,p=new a(r.count*s);return Promise.resolve(new An(p,s,l))}let i=[];return r.bufferView!==void 0?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),r.sparse!==void 0&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then(function(s){let a=s[0],l=Wp[r.type],p=Yr[r.componentType],m=p.BYTES_PER_ELEMENT,x=m*l,F=r.byteOffset||0,v=r.bufferView!==void 0?o.bufferViews[r.bufferView].byteStride:void 0,k=r.normalized===!0,D,b;if(v&&v!==x){let P=Math.floor(F/v),O="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+P+":"+r.count,I=t.cache.get(O);I||(D=new p(a,P*v,r.count*v/m),I=new yu(D,v/m),t.cache.add(O,I)),b=new Ut(I,l,F%v/m,k)}else a===null?D=new p(r.count*l):D=new p(a,F,r.count*l),b=new An(D,l,k);if(r.sparse!==void 0){let P=Wp.SCALAR,O=Yr[r.sparse.indices.componentType],I=r.sparse.indices.byteOffset||0,L=r.sparse.values.byteOffset||0,U=new O(s[1],I,r.sparse.count*P),C=new p(s[2],L,r.sparse.count*l);a!==null&&(b=new An(b.array.slice(),b.itemSize,b.normalized));for(let W=0,$=U.length;W<$;W++){let Y=U[W];if(b.setX(Y,C[W*l]),l>=2&&b.setY(Y,C[W*l+1]),l>=3&&b.setZ(Y,C[W*l+2]),l>=4&&b.setW(Y,C[W*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return b})}loadTexture(e){let t=this.json,o=this.options,i=t.textures[e].source,s=t.images[i],a=this.textureLoader;if(s.uri){let l=o.manager.getHandler(s.uri);l!==null&&(a=l)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,o){let r=this,i=this.json,s=i.textures[e],a=i.images[t],l=(a.uri||a.bufferView)+":"+s.sampler;if(this.textureCache[l])return this.textureCache[l];let p=this.loadImageSource(t,o).then(function(m){m.flipY=!1,m.name=s.name||a.name||"",m.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(m.name=a.uri);let F=(i.samplers||{})[s.sampler]||{};return m.magFilter=bg[F.magFilter]||Hi,m.minFilter=bg[F.minFilter]||Bu,m.wrapS=yg[F.wrapS]||dc,m.wrapT=yg[F.wrapT]||dc,r.associations.set(m,{textures:e}),m}).catch(function(){return null});return this.textureCache[l]=p,p}loadImageSource(e,t){let o=this,r=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(x=>x.clone());let s=r.images[e],a=self.URL||self.webkitURL,l=s.uri||"",p=!1;if(s.bufferView!==void 0)l=o.getDependency("bufferView",s.bufferView).then(function(x){p=!0;let F=new Blob([x],{type:s.mimeType});return l=a.createObjectURL(F),l});else if(s.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let m=Promise.resolve(l).then(function(x){return new Promise(function(F,v){let k=F;t.isImageBitmapLoader===!0&&(k=function(D){let b=new zi(D);b.needsUpdate=!0,F(b)}),t.load(ac.resolveURL(x,i.path),k,void 0,v)})}).then(function(x){return p===!0&&a.revokeObjectURL(l),x.userData.mimeType=s.mimeType||h2(s.uri),x}).catch(function(x){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),x});return this.sourceCache[e]=m,m}assignTexture(e,t,o,r){let i=this;return this.getDependency("texture",o.index).then(function(s){if(!s)return null;if(o.texCoord!==void 0&&o.texCoord>0&&(s=s.clone(),s.channel=o.texCoord),i.extensions[Z.KHR_TEXTURE_TRANSFORM]){let a=o.extensions!==void 0?o.extensions[Z.KHR_TEXTURE_TRANSFORM]:void 0;if(a){let l=i.associations.get(s);s=i.extensions[Z.KHR_TEXTURE_TRANSFORM].extendTexture(s,a),i.associations.set(s,l)}}return r!==void 0&&(s.colorSpace=r),e[t]=s,s})}assignFinalMaterial(e){let t=e.geometry,o=e.material,r=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,s=t.attributes.normal===void 0;if(e.isPoints){let a="PointsMaterial:"+o.uuid,l=this.cache.get(a);l||(l=new kf,cc.prototype.copy.call(l,o),l.color.copy(o.color),l.map=o.map,l.sizeAttenuation=!1,this.cache.add(a,l)),o=l}else if(e.isLine){let a="LineBasicMaterial:"+o.uuid,l=this.cache.get(a);l||(l=new Cu,cc.prototype.copy.call(l,o),l.color.copy(o.color),l.map=o.map,this.cache.add(a,l)),o=l}if(r||i||s){let a="ClonedMaterial:"+o.uuid+":";r&&(a+="derivative-tangents:"),i&&(a+="vertex-colors:"),s&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=o.clone(),i&&(l.vertexColors=!0),s&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(o))),o=l}e.material=o}getMaterialType(){return Ru}loadMaterial(e){let t=this,o=this.json,r=this.extensions,i=o.materials[e],s,a={},l=i.extensions||{},p=[];if(l[Z.KHR_MATERIALS_UNLIT]){let x=r[Z.KHR_MATERIALS_UNLIT];s=x.getMaterialType(),p.push(x.extendParams(a,i,t))}else{let x=i.pbrMetallicRoughness||{};if(a.color=new Pe(1,1,1),a.opacity=1,Array.isArray(x.baseColorFactor)){let F=x.baseColorFactor;a.color.fromArray(F),a.opacity=F[3]}x.baseColorTexture!==void 0&&p.push(t.assignTexture(a,"map",x.baseColorTexture,Lr)),a.metalness=x.metallicFactor!==void 0?x.metallicFactor:1,a.roughness=x.roughnessFactor!==void 0?x.roughnessFactor:1,x.metallicRoughnessTexture!==void 0&&(p.push(t.assignTexture(a,"metalnessMap",x.metallicRoughnessTexture)),p.push(t.assignTexture(a,"roughnessMap",x.metallicRoughnessTexture))),s=this._invokeOne(function(F){return F.getMaterialType&&F.getMaterialType(e)}),p.push(Promise.all(this._invokeAll(function(F){return F.extendMaterialParams&&F.extendMaterialParams(e,a)})))}i.doubleSided===!0&&(a.side=rf);let m=i.alphaMode||Hp.OPAQUE;if(m===Hp.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,m===Hp.MASK&&(a.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&s!==it&&(p.push(t.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new Ue(1,1),i.normalTexture.scale!==void 0)){let x=i.normalTexture.scale;a.normalScale.set(x,x)}return i.occlusionTexture!==void 0&&s!==it&&(p.push(t.assignTexture(a,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&s!==it&&(a.emissive=new Pe().fromArray(i.emissiveFactor)),i.emissiveTexture!==void 0&&s!==it&&p.push(t.assignTexture(a,"emissiveMap",i.emissiveTexture,Lr)),Promise.all(p).then(function(){let x=new s(a);return i.name&&(x.name=i.name),lo(x,i),t.associations.set(x,{materials:e}),i.extensions&&Zo(r,x,i),x})}createUniqueName(e){let t=Ef.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){let t=this,o=this.extensions,r=this.primitiveCache;function i(a){return o[Z.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return Dg(l,a,t)})}let s=[];for(let a=0,l=e.length;a<l;a++){let p=e[a],m=d2(p),x=r[m];if(x)s.push(x.promise);else{let F;p.extensions&&p.extensions[Z.KHR_DRACO_MESH_COMPRESSION]?F=i(p):F=Dg(new Ii,p,t),r[m]={primitive:p,promise:F},s.push(F)}}return Promise.all(s)}loadMesh(e){let t=this,o=this.json,r=this.extensions,i=o.meshes[e],s=i.primitives,a=[];for(let l=0,p=s.length;l<p;l++){let m=s[l].material===void 0?l2(this.cache):this.getDependency("material",s[l].material);a.push(m)}return a.push(t.loadGeometries(s)),Promise.all(a).then(function(l){let p=l.slice(0,l.length-1),m=l[l.length-1],x=[];for(let v=0,k=m.length;v<k;v++){let D=m[v],b=s[v],P,O=p[v];if(b.mode===Rt.TRIANGLES||b.mode===Rt.TRIANGLE_STRIP||b.mode===Rt.TRIANGLE_FAN||b.mode===void 0)P=i.isSkinnedMesh===!0?new Cf(D,O):new _t(D,O),P.isSkinnedMesh===!0&&P.normalizeSkinWeights(),b.mode===Rt.TRIANGLE_STRIP?P.geometry=Op(P.geometry,fc):b.mode===Rt.TRIANGLE_FAN&&(P.geometry=Op(P.geometry,Gi));else if(b.mode===Rt.LINES)P=new xf(D,O);else if(b.mode===Rt.LINE_STRIP)P=new hf(D,O);else if(b.mode===Rt.LINE_LOOP)P=new ff(D,O);else if(b.mode===Rt.POINTS)P=new Mf(D,O);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+b.mode);Object.keys(P.geometry.morphAttributes).length>0&&p2(P,i),P.name=t.createUniqueName(i.name||"mesh_"+e),lo(P,i),b.extensions&&Zo(r,P,b),t.assignFinalMaterial(P),x.push(P)}for(let v=0,k=x.length;v<k;v++)t.associations.set(x[v],{meshes:e,primitives:v});if(x.length===1)return i.extensions&&Zo(r,x[0],i),x[0];let F=new ic;i.extensions&&Zo(r,F,i),t.associations.set(F,{meshes:e});for(let v=0,k=x.length;v<k;v++)F.add(x[v]);return F})}loadCamera(e){let t,o=this.json.cameras[e],r=o[o.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return o.type==="perspective"?t=new Ni(lc.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):o.type==="orthographic"&&(t=new pc(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),o.name&&(t.name=this.createUniqueName(o.name)),lo(t,o),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],o=[];for(let r=0,i=t.joints.length;r<i;r++)o.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?o.push(this.getDependency("accessor",t.inverseBindMatrices)):o.push(null),Promise.all(o).then(function(r){let i=r.pop(),s=r,a=[],l=[];for(let p=0,m=s.length;p<m;p++){let x=s[p];if(x){a.push(x);let F=new we;i!==null&&F.fromArray(i.array,p*16),l.push(F)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[p])}return new Df(a,l)})}loadAnimation(e){let o=this.json.animations[e],r=o.name?o.name:"animation_"+e,i=[],s=[],a=[],l=[],p=[];for(let m=0,x=o.channels.length;m<x;m++){let F=o.channels[m],v=o.samplers[F.sampler],k=F.target,D=k.node,b=o.parameters!==void 0?o.parameters[v.input]:v.input,P=o.parameters!==void 0?o.parameters[v.output]:v.output;k.node!==void 0&&(i.push(this.getDependency("node",D)),s.push(this.getDependency("accessor",b)),a.push(this.getDependency("accessor",P)),l.push(v),p.push(k))}return Promise.all([Promise.all(i),Promise.all(s),Promise.all(a),Promise.all(l),Promise.all(p)]).then(function(m){let x=m[0],F=m[1],v=m[2],k=m[3],D=m[4],b=[];for(let P=0,O=x.length;P<O;P++){let I=x[P],L=F[P],U=v[P],C=k[P],W=D[P];if(I===void 0)continue;I.updateMatrix();let $;switch(co[W.path]){case co.weights:$=Sf;break;case co.rotation:$=Pu;break;case co.position:case co.scale:default:$=Vf;break}let Y=I.name?I.name:I.uuid,ie=C.interpolation!==void 0?c2[C.interpolation]:Du,ne=[];co[W.path]===co.weights?I.traverse(function(Fe){Fe.morphTargetInfluences&&ne.push(Fe.name?Fe.name:Fe.uuid)}):ne.push(Y);let Te=U.array;if(U.normalized){let Fe=ld(Te.constructor),se=new Float32Array(Te.length);for(let rt=0,hn=Te.length;rt<hn;rt++)se[rt]=Te[rt]*Fe;Te=se}for(let Fe=0,se=ne.length;Fe<se;Fe++){let rt=new $(ne[Fe]+"."+co[W.path],L.array,Te,ie);C.interpolation==="CUBICSPLINE"&&(rt.createInterpolant=function(ho){let Pt=this instanceof Pu?ad:gl;return new Pt(this.times,this.values,this.getValueSize()/3,ho)},rt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),b.push(rt)}}return new Km(r,void 0,b)})}createNodeMesh(e){let t=this.json,o=this,r=t.nodes[e];return r.mesh===void 0?null:o.getDependency("mesh",r.mesh).then(function(i){let s=o._getNodeRef(o.meshCache,r.mesh,i);return r.weights!==void 0&&s.traverse(function(a){if(a.isMesh)for(let l=0,p=r.weights.length;l<p;l++)a.morphTargetInfluences[l]=r.weights[l]}),s})}loadNode(e){let t=this.json,o=this,r=t.nodes[e],i=o._loadNodeShallow(e),s=[],a=r.children||[];for(let p=0,m=a.length;p<m;p++)s.push(o.getDependency("node",a[p]));let l=r.skin===void 0?Promise.resolve(null):o.getDependency("skin",r.skin);return Promise.all([i,Promise.all(s),l]).then(function(p){let m=p[0],x=p[1],F=p[2];F!==null&&m.traverse(function(v){v.isSkinnedMesh&&v.bind(F,m2)});for(let v=0,k=x.length;v<k;v++)m.add(x[v]);return m})}_loadNodeShallow(e){let t=this.json,o=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];let i=t.nodes[e],s=i.name?r.createUniqueName(i.name):"",a=[],l=r._invokeOne(function(p){return p.createNodeMesh&&p.createNodeMesh(e)});return l&&a.push(l),i.camera!==void 0&&a.push(r.getDependency("camera",i.camera).then(function(p){return r._getNodeRef(r.cameraCache,i.camera,p)})),r._invokeAll(function(p){return p.createNodeAttachment&&p.createNodeAttachment(e)}).forEach(function(p){a.push(p)}),this.nodeCache[e]=Promise.all(a).then(function(p){let m;if(i.isBone===!0?m=new Zm:p.length>1?m=new ic:p.length===1?m=p[0]:m=new be,m!==p[0])for(let x=0,F=p.length;x<F;x++)m.add(p[x]);if(i.name&&(m.userData.name=i.name,m.name=s),lo(m,i),i.extensions&&Zo(o,m,i),i.matrix!==void 0){let x=new we;x.fromArray(i.matrix),m.applyMatrix4(x)}else i.translation!==void 0&&m.position.fromArray(i.translation),i.rotation!==void 0&&m.quaternion.fromArray(i.rotation),i.scale!==void 0&&m.scale.fromArray(i.scale);return r.associations.has(m)||r.associations.set(m,{}),r.associations.get(m).nodes=e,m}),this.nodeCache[e]}loadScene(e){let t=this.extensions,o=this.json.scenes[e],r=this,i=new ic;o.name&&(i.name=r.createUniqueName(o.name)),lo(i,o),o.extensions&&Zo(t,i,o);let s=o.nodes||[],a=[];for(let l=0,p=s.length;l<p;l++)a.push(r.getDependency("node",s[l]));return Promise.all(a).then(function(l){for(let m=0,x=l.length;m<x;m++)i.add(l[m]);let p=m=>{let x=new Map;for(let[F,v]of r.associations)(F instanceof cc||F instanceof zi)&&x.set(F,v);return m.traverse(F=>{let v=r.associations.get(F);v!=null&&x.set(F,v)}),x};return r.associations=p(i),i})}};function f2(n,e,t){let o=e.attributes,r=new Eo;if(o.POSITION!==void 0){let a=t.json.accessors[o.POSITION],l=a.min,p=a.max;if(l!==void 0&&p!==void 0){if(r.set(new V(l[0],l[1],l[2]),new V(p[0],p[1],p[2])),a.normalized){let m=ld(Yr[a.componentType]);r.min.multiplyScalar(m),r.max.multiplyScalar(m)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let i=e.targets;if(i!==void 0){let a=new V,l=new V;for(let p=0,m=i.length;p<m;p++){let x=i[p];if(x.POSITION!==void 0){let F=t.json.accessors[x.POSITION],v=F.min,k=F.max;if(v!==void 0&&k!==void 0){if(l.setX(Math.max(Math.abs(v[0]),Math.abs(k[0]))),l.setY(Math.max(Math.abs(v[1]),Math.abs(k[1]))),l.setZ(Math.max(Math.abs(v[2]),Math.abs(k[2]))),F.normalized){let D=ld(Yr[F.componentType]);l.multiplyScalar(D)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}n.boundingBox=r;let s=new Pr;r.getCenter(s.center),s.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=s}function Dg(n,e,t){let o=e.attributes,r=[];function i(s,a){return t.getDependency("accessor",s).then(function(l){n.setAttribute(a,l)})}for(let s in o){let a=cd[s]||s.toLowerCase();a in n.attributes||r.push(i(o[s],a))}if(e.indices!==void 0&&!n.index){let s=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});r.push(s)}return lo(n,e),f2(n,e,t),Promise.all(r).then(function(){return e.targets!==void 0?u2(n,e.targets,t):n})}var Ce={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function Bg(n){let e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function x2(n){if(!n)throw new Error("No basePath supplied");return await Bg(`${n}/profilesList.json`)}async function Lg(n,e,t=null,o=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");let r=await x2(e),i;if(n.profiles.some(l=>{let p=r[l];return p&&(i={profileId:l,profilePath:`${e}/${p.path}`,deprecated:!!p.deprecated}),!!i}),!i){if(!t)throw new Error("No matching profile name found");let l=r[t];if(!l)throw new Error(`No matching profile name found and default profile "${t}" missing.`);i={profileId:t,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}let s=await Bg(i.profilePath),a;if(o){let l;if(n.handedness==="any"?l=s.layouts[Object.keys(s.layouts)[0]]:l=s.layouts[n.handedness],!l)throw new Error(`No matching handedness, ${n.handedness}, in profile ${i.profileId}`);l.assetPath&&(a=i.profilePath.replace("profile.json",l.assetPath))}return{profile:s,assetPath:a}}var g2={xAxis:0,yAxis:0,button:0,state:Ce.ComponentState.DEFAULT};function w2(n=0,e=0){let t=n,o=e;if(Math.sqrt(n*n+e*e)>1){let s=Math.atan2(e,n);t=Math.cos(s),o=Math.sin(s)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:o*.5+.5}}var pd=class{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Ce.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(g2)}updateFromComponent({xAxis:e,yAxis:t,button:o,state:r}){let{normalizedXAxis:i,normalizedYAxis:s}=w2(e,t);switch(this.componentProperty){case Ce.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?i:.5;break;case Ce.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?s:.5;break;case Ce.ComponentProperty.BUTTON:this.value=this.states.includes(r)?o:0;break;case Ce.ComponentProperty.STATE:this.valueNodeProperty===Ce.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},dd=class{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(o=>{let r=new pd(t.visualResponses[o]);this.visualResponses[o]=r}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:Ce.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Ce.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){let t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=Ce.ComponentState.PRESSED:(t.touched||this.values.button>Ce.ButtonTouchThreshold)&&(this.values.state=Ce.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Ce.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Ce.AxisTouchThreshold&&(this.values.state=Ce.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Ce.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Ce.AxisTouchThreshold&&(this.values.state=Ce.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}},wl=class{constructor(e,t,o){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=o,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(r=>{let i=this.layoutDescription.components[r];this.components[r]=new dd(r,i)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}};var F2="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",A2="generic-trigger",hd=class extends be{constructor(){super(...arguments),this.envMap=null,this.motionController=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{vt(t)&&(ji(t.material)||qi(t.material)||Qi(t.material))&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(o=>{let{valueNode:r,minNode:i,maxNode:s}=o;r&&(_2(o)?r.visible=o.value:v2(o)&&(r.quaternion.slerpQuaternions(i.quaternion,s.quaternion,o.value),r.position.lerpVectors(i.position,s.position,o.value)))})}))}};function Pg(n,e){return n&&n.valueNodeProperty===e}function _2(n){return Pg(n,"visibility")}function v2(n){return Pg(n,"transform")}function S2(n,e){Object.values(n.components).forEach(t=>{let{type:o,touchPointNodeName:r,visualResponses:i}=t;if(o===Ce.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(r),t.touchPointNode){let s=new mc(.001),a=new it({color:255}),l=new _t(s,a);t.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(i).forEach(s=>{let{valueNodeName:a,minNodeName:l,maxNodeName:p,valueNodeProperty:m}=s;if(m===Ce.VisualResponseProperty.TRANSFORM){if(s.minNode=e.getObjectByName(l),s.maxNode=e.getObjectByName(p),!s.minNode){console.warn(`Could not find ${l} in the model`);return}if(!s.maxNode){console.warn(`Could not find ${p} in the model`);return}}s.valueNode=e.getObjectByName(a),s.valueNode||console.warn(`Could not find ${a} in the model`)})})}function Rg(n,e){S2(n.motionController,e),n.envMap&&e.traverse(t=>{vt(t)&&(ji(t.material)||qi(t.material)||Qi(t.material))&&(t.material.envMap=n.envMap,t.material.needsUpdate=!0)}),n.add(e)}var Fl=class{constructor(e=null){this.gltfLoader=e||new uo,this.path=F2,this._assetCache={}}createControllerModel(e,t=null){let o=new hd,r=null;return e.addEventListener("connected",async i=>{let s=i.data;if(!(s.targetRayMode!=="tracked-pointer"||!s.gamepad))try{let{profile:a,assetPath:l}=await Lg(s,this.path,t||A2);o.motionController=new wl(s,a,l);let p=this._assetCache[o.motionController.assetUrl];if(p)r=p.scene.clone(),Rg(o,r);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(o.motionController.assetUrl,m=>{this._assetCache[o.motionController.assetUrl]=m,r=m.scene.clone(),Rg(o,r)},null,()=>{throw new Error(`Asset ${o.motionController.assetUrl} missing or malformed.`)})}}catch(a){console.warn(a)}}),e.addEventListener("disconnected",()=>{ye(o.motionController),o.motionController=null,ye(r),r=null}),o}};var T2=new Fl,M2=new we().makeRotationX(-7*Ee/9),Vg=new we,Ig=new Map([["none",Ge.MotionController],["left",Ge.MotionControllerLeft],["right",Ge.MotionControllerRight]]),Al;(function(n){n[n.Trigger=0]="Trigger",n[n.Grip=1]="Grip",n[n.Stick=3]="Stick",n[n.X_A=4]="X_A",n[n.Y_B=5]="Y_B"})(Al||(Al={}));var Og=new Map([[Al.Y_B,Ie.Menu],[Al.X_A,Ie.Info]]),_l=class extends En{constructor(e,t){if(super("hand",Ge.MotionController,e,new Yo(e)),this.laser=new Bs(Xu,.75,.002),this._isHand=!1,this.inputSource=null,this._gamepad=new pl,this.delta=new V,this.newOrigin=new V,this.quaternion=new de,this.newQuat=new de,this.useHaptics=!0,this.mayTeleport=!0,this.object=ce("PointerHand"+t),this.quaternion.identity(),z(this,z(this.controller=this.env.renderer.xr.getController(t),this.laser),z(this.grip=this.env.renderer.xr.getControllerGrip(t),this.gripModel=T2.createControllerModel(this.controller)),z(this.hand=this.env.renderer.xr.getHand(t),this.handModel=this.env.handModelFactory.createHandModel(this.hand))),cr()&&Bh()&&!Fn){let i=!1;this.controller.traverse(s=>{s.name.toLocaleLowerCase().indexOf("oculus")>=0&&(i=!0)}),i&&this.laser.matrix.copy(M2)}this.gamepad.addEventListener("gamepadaxismaxed",i=>{i.axis===2&&this.env.avatar.snapTurn(i.value)});let o=i=>s=>{Og.has(s.button)&&this.setButton(Og.get(s.button),i)};this.gamepad.addEventListener("gamepadbuttondown",o(!0)),this.gamepad.addEventListener("gamepadbuttonup",o(!1));let r=(i,s)=>()=>this.setButton(i,s);this.controller.addEventListener("selectstart",r(Ie.Primary,!0)),this.controller.addEventListener("selectend",r(Ie.Primary,!1)),this.controller.addEventListener("squeezestart",r(Ie.Secondary,!0)),this.controller.addEventListener("squeezeend",r(Ie.Secondary,!1)),this.controller.addEventListener("connected",i=>{i.target===this.controller&&(this.inputSource=i.data,this.gamepad.pad=this.inputSource.gamepad,this._isHand=w(this.inputSource.hand),this.id=Ig.get(this.handedness),this.grip.visible=!this.isHand,this.controller.visible=!this.isHand,this.hand.visible=this.isHand,this.enabled=!0,this._isActive=!0,this.env.eventSys.checkXRMouse(),this.updateCursorSide())}),this.controller.addEventListener("disconnected",i=>{i.target===this.controller&&(this.inputSource=null,this.gamepad.pad=null,this._isHand=!1,this.id=Ig.get(this.handedness),this.grip.visible=!1,this.controller.visible=!1,this.hand.visible=!1,this.enabled=!1,this._isActive=!1,this.env.eventSys.checkXRMouse(),this.updateCursorSide())}),Object.seal(this)}vibrate(){this._vibrate()}async _vibrate(){if(this.useHaptics&&this.gamepad.hapticActuators)try{await Promise.all(this.gamepad.hapticActuators.map(e=>e.pulse(.25,125)))}catch{this.useHaptics=!1}}get gamepad(){return this._gamepad}get handedness(){return B(this.inputSource)?null:this.inputSource.handedness}get isHand(){return this._isHand}get cursor(){return super.cursor}set cursor(e){super.cursor=e,this.updateCursorSide()}updateCursorSide(){this.cursor.side=this.handedness==="left"?1:-1}updatePointerOrientation(){this.laser.getWorldPosition(this.newOrigin),this.laser.getWorldQuaternion(this.newQuat),this.origin.lerp(this.newOrigin,.9),this.quaternion.slerp(this.newQuat,.9),this.delta.copy(this.origin).add(this.direction),this.direction.set(0,0,-1).applyQuaternion(this.quaternion),this.up.set(0,1,0).applyQuaternion(this.quaternion),this.delta.sub(this.direction).sub(this.origin),this.moveDistance+=50*this.delta.length()}onUpdate(){this.gamepad.pad=this.inputSource&&this.inputSource.gamepad||null,super.onUpdate()}get bufferSize(){return super.bufferSize+2+this.handModel.count*64}writeState(e){if(super.writeState(e),e.writeEnum8(this.handedness,Ip),e.writeUint8(this.handModel.count),this.handModel.isTracking)for(let t=0;t<this.handModel.count;++t)this.handModel.getMatrixAt(t,Vg),e.writeMatrix512(Vg)}};var Kr=class extends En{constructor(e,t,o,r){super(e,t,o,r),this.position=new Ue,this.motion=new Ue,this.uv=new Ue,this.duv=new Ue,this.uvComp=new Ue(1,-1),this.uvOff=new Ue(-1,1),this.canMoveView=!0;let i=s=>{this._isActive=this.onCheckEvent(s),this._isActive&&this.onReadEvent(s)};this.element=this.env.renderer.domElement,this.element.addEventListener("pointerdown",i),this.element.addEventListener("pointermove",i),this.element.addEventListener("pointerup",i),this.element.addEventListener("pointercancel",i)}onCheckEvent(e){return e.pointerType===this.type}onReadEvent(e){this.updatePointerOrientation()}updatePointerOrientation(){this.element.clientWidth>0&&this.element.clientHeight>0&&(this.uv.copy(this.position),this.uv.x/=this.element.clientWidth,this.uv.y/=this.element.clientHeight,this.uv.multiplyScalar(2).multiply(this.uvComp).add(this.uvOff),this.duv.copy(this.motion),this.duv.x/=this.element.clientWidth,this.duv.y/=this.element.clientHeight,this.duv.multiplyScalar(2).multiply(this.uvComp),this.moveDistance=200*this.duv.length());let e=Lo(this.env.renderer,this.env.camera);this.origin.setFromMatrixPosition(e.matrixWorld),this.direction.set(this.uv.x,this.uv.y,.5).unproject(e).sub(this.origin).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat)}onUpdate(){this.env.avatar.onMove(this,this.uv,this.duv),super.onUpdate(),this.motion.setScalar(0),this.duv.setScalar(0)}};var Jr=class extends Kr{constructor(e,t,o){let r=a=>{a.pointerType===e&&this.pointerID==null&&(this.pointerID=a.pointerId)},i=a=>{a.pointerType===e&&this.pointerID!=null&&(this.pointerID=null)},s=o.renderer.domElement;s.addEventListener("pointerdown",r),s.addEventListener("pointermove",r),super(e,t,o,new Qr(o)),this.pointerID=null,this.lastX=null,this.lastY=null,s.addEventListener("pointerup",i),s.addEventListener("pointercancel",i)}onCheckEvent(e){return super.onCheckEvent(e)&&e.pointerId===this.pointerID}onReadEvent(e){this.position.set(e.offsetX,e.offsetY),e.type==="pointerdown"?this.motion.setScalar(0):(this.motion.x+=e.offsetX-this.lastX,this.motion.y+=e.offsetY-this.lastY),this.lastX=e.offsetX,this.lastY=e.offsetY,super.onReadEvent(e),(e.type==="pointerdown"||e.type==="pointerup"||e.type==="pointercancel")&&this.setButton(e.button,e.type==="pointerdown")}};var vl=class extends Jr{constructor(e){super("mouse",Ge.Mouse,e),this.allowPointerLock=!1,this.dz=0,this.keyMap=new Map([["`",Ie.Info],["ContextMenu",Ie.Menu]]),this.element.addEventListener("wheel",t=>{t.preventDefault(),this.dz+=-t.deltaY*.1},{passive:!1}),this.element.addEventListener("contextmenu",t=>{t.preventDefault()}),this.element.addEventListener("pointerdown",t=>{this.onCheckEvent(t)&&(this.allowPointerLock&&!this.isPointerLocked?this.lockPointer():!this.allowPointerLock&&!this.isPointerCaptured&&this.capturePointer())}),this.element.addEventListener("pointerup",t=>{this.onCheckEvent(t)&&(this.allowPointerLock&&this.isPointerLocked?this.unlockPointer():!this.allowPointerLock&&this.isPointerCaptured&&this.releaseCapture())},!0),document.addEventListener("pointerlockchange",()=>{this.cursor.visible=!0}),window.addEventListener("keydown",t=>{this._isActive&&this.keyMap.has(t.key)&&this.setButton(this.keyMap.get(t.key),sr(t))}),window.addEventListener("keyup",t=>{this.keyMap.has(t.key)&&this.setButton(this.keyMap.get(t.key),!1)}),this.mayTeleport=!0,Object.seal(this)}updatePointerOrientation(){this.isPointerLocked&&this.position.set(this.env.renderer.domElement.clientWidth,this.env.renderer.domElement.clientHeight).multiplyScalar(.5),super.updatePointerOrientation()}onUpdate(){super.onUpdate(),this.env.avatar.zoom(this.dz),this.dz=0}get isPointerLocked(){return document.pointerLockElement!=null}get isPointerCaptured(){return this.element.hasPointerCapture(this.pointerID)}get canDragView(){return super.canDragView&&!this.isPointerLocked}get canTeleport(){return super.canTeleport&&this.isPointerLocked}lockPointer(){this.element.requestPointerLock()}unlockPointer(){document.exitPointerLock()}capturePointer(){this.element.setPointerCapture(this.pointerID)}releaseCapture(){this.element.releasePointerCapture(this.pointerID)}vibrate(){}};var Sl=class extends En{constructor(e){super("nose",Ge.Nose,e,null),this.point=new V,this.lastPoint=new V,this.mayTeleport=!1,this.enabled=!0,this._isActive=!0,this.updatePointerOrientation(),this.moveDistance=0,Object.seal(this)}vibrate(){}get canSend(){return!1}updatePointerOrientation(){let e=this.env.camera;e.getWorldPosition(this.origin),e.getWorldDirection(this.direction),this.up.copy(e.up),this.point.copy(this.direction).add(this.origin),this.moveDistance=this.point.distanceTo(this.lastPoint),this.lastPoint.copy(this.point)}};var Tl=class extends Jr{constructor(e){super("pen",Ge.Pen,e),Object.seal(this)}vibrate(){}};function k2(n){return n.pointerId}var Ml=class extends Kr{constructor(e){super("touch",Ge.Touch,e,null),this.dz=0,this.lastZ=0,this.points=new Array,this.lastXs=new Map,this.lastYs=new Map,this._canVibrate=null,Object.seal(this)}get enabled(){return super.enabled}set enabled(e){super.enabled=e,pe(this.points)}onReadEvent(e){Pd(this.points,e.pointerId,k2);let t=e.type==="pointerdown"||e.type==="pointermove";if(t&&this.points.push(e),this.points.length===2){let r=this.points[0],i=this.points[1],s=i.offsetX-r.offsetX,a=i.offsetY-r.offsetY,l=5*Math.sqrt(s*s+a*a),p=l-this.lastZ;e.type==="pointermove"&&(this.dz+=p),this.lastZ=l}let o=1/this.points.length;if(t){this.position.setScalar(0);for(let r of this.points)if(this.position.x+=o*r.offsetX,this.position.y+=o*r.offsetY,this.lastXs.has(r.pointerId)){let i=this.lastXs.get(r.pointerId),s=this.lastYs.get(r.pointerId),a=r.offsetX-i,l=r.offsetY-s;this.motion.x+=o*a,this.motion.y+=o*l}}if(t?(this.lastXs.set(e.pointerId,e.offsetX),this.lastYs.set(e.pointerId,e.offsetY)):(this.lastXs.delete(e.pointerId),this.lastYs.delete(e.pointerId)),super.onReadEvent(e),e.type!=="pointermove"){let r=0;for(let i=0;i<this.points.length;++i){let s=this.points[i],a=1<<i;s.buttons!==0?r|=a:r&=~a}for(let i=0;i<10;++i){let s=this.isPressed(i),a=1<<i,l=(r&a)!==0;l!==s&&this.setButton(i,l)}e.type==="pointerup"&&setTimeout(()=>this._isActive=!1,10)}}onUpdate(){this.env.avatar.zoom(this.dz),super.onUpdate(),this.dz=0}get canVibrate(){return this._canVibrate===null&&(this._canVibrate="vibrate"in navigator&&ee(navigator.vibrate)),this._canVibrate}vibrate(){this.canVibrate&&navigator.vibrate(125)}};var E2=(n,e)=>n.distance-e.distance,kl=class extends re{set sortFunction(e){this.customSortFunction=e}get sortFunction(){return this.customSortFunction||E2}constructor(e){super(),this.env=e,this.raycaster=new yf,this.hands=new Array,this.hits=new Array,this.queue=new Array,this.targetsFound=new Set,this.targets=new Array,this.customSortFunction=null,this.raycaster.camera=this.env.camera,this.raycaster.layers.set(Nc),this.mouse=new vl(this.env),this.pen=new Tl(this.env),this.touches=new Ml(this.env),this.nose=new Sl(this.env);for(let t=0;t<2;++t)this.hands[t]=new _l(this.env,t);this.pointers=[this.mouse,this.pen,this.touches,this.nose,...this.hands];for(let t of this.pointers)t.addBubbler(this),t.cursor&&z(this.env.stage,t.cursor);this.checkXRMouse(),Object.seal(this)}checkXRMouse(){let e=0;for(let o of this.hands.values())o.enabled&&++e;let t=e===0;this.mouse.enabled=t,this.pen.enabled=t,this.touches.enabled=t}refreshCursors(){for(let e of this.pointers)e.cursor&&(e.cursor=this.env.cursor3D.clone())}fireRay(e,t){return pe(this.hits),this.raycaster.ray.origin.copy(e),this.raycaster.ray.direction.copy(t),this.raycaster.intersectObjects(this.targets,!1,this.hits),this.hits.sort(this.sortFunction),this.hits[0]||null}update(){for(this.targetsFound.clear(),pe(this.targets),this.queue.push(this.env.scene);this.queue.length>0;){let e=this.queue.shift();e.children.length>0&&this.queue.push(...e.children);let t=ts(e);t&&!this.targetsFound.has(t)&&(this.targetsFound.add(t),this.targets.push(...t.meshes))}for(let e of this.pointers)e.update()}};var El=class n extends ao{constructor(e,t){super(e),this.cursorSystem=null,this.object=ce("Cursor3D"),this.cursorSystem=t,this.object.matrixAutoUpdate=!1}add(e,t){z(this,t),Nx(t,Nr),t.visible=e==="default"}get style(){for(let e of this.object.children)if(e.visible)return e.name;return null}set style(e){for(let t of this.object.children)t.visible=t.name===e;if(this.style==null&&this.object.children.length>0){let t=Ft(this.object.children,o=>o.name==="default",o=>o!=null);t!=null&&(t.visible=!0)}this.cursorSystem&&(this.cursorSystem.style="none")}get visible(){return Vr(this)}set visible(e){Ve(this,e)}clone(){let e=new n(this.env);for(let t of this.object.children)e.add(t.name,t.clone());return e}};var md=new de().identity(),Wg=new de().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(md.setFromAxisAngle(new V(0,1,0),Math.PI/2),Wg.setFromAxisAngle(new V(1,0,0),Math.PI).premultiply(md));var b2="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/",bl=class extends be{constructor(e,t,o){super(),this.controller=e,this.handedness=t,this.bones=new Map,this.root=null,this.instanceMatrix={needsUpdate:!1},this.oculusBrowserV14Correction=this.handedness==="left"?Wg:md;let r=new uo;r.setPath(b2),r.load(`${this.handedness}.glb`,i=>{this.root=i.scene.children[0],this.add(this.root);let s=this.root.getObjectByProperty("type","SkinnedMesh");s.frustumCulled=!1,s.castShadow=!0,s.receiveShadow=!0,Qi(s.material)?s.material=ax(s.material):ji(s.material)&&(s.material=Ji(s.material)),qi(s.material)&&(s.material.color=o,s.material.shininess=.1),po.forEach(a=>this.addBone(a))})}addBone(e){if(this.root){let t=this.root.getObjectByName(e);t&&this.bones.set(e,t)}}get count(){return this.bones.size}set count(e){}getMatrixAt(e,t){if(0<=e&&e<po.length){let o=po[e];this.bones.has(o)&&t.copy(this.bones.get(o).matrix)}}setMatrixAt(e,t){if(0<=e&&e<po.length){let o=po[e];if(this.bones.has(o)){let r=this.bones.get(o);r.matrix.copy(t),r.matrix.decompose(r.position,r.quaternion,r.scale)}}}updateMesh(){if(this.controller)for(let[e,t]of this.bones){let o=this.controller.joints[e];o&&o.visible&&(t.position.copy(o.position),t.quaternion.copy(o.quaternion).multiply(this.oculusBrowserV14Correction))}}};var y2=.008,fd=new we,Hg=new V,Ng=new we().identity(),Ug=new we().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(Ng.makeRotationY(Math.PI/2),Ug.makeRotationY(-Math.PI/2));var yl=class extends sc{constructor(e,t,o,r){let i;r==="boxes"?i=new nc(1,1,1):r==="bones"?i=new of(.5,.75,2.25,10,1).rotateX(-Math.PI/2):i=new mc(1,10,10);let s=new Cr({color:o,shininess:.1});super(i,s,30),this.controller=e,this.instanceMatrix.setUsage(sf),this.castShadow=!0,this.receiveShadow=!0,this.oculusBrowserV14Correction=t==="left"?Ug:Ng}updateMesh(){if(this.controller){let e=0;for(let t of po){let o=this.controller.joints[t];o&&o.visible&&(Hg.setScalar(o.jointRadius||y2),fd.compose(o.position,o.quaternion,Hg),fd.multiply(this.oculusBrowserV14Correction),this.setMatrixAt(e,fd),e++)}this.count=e}this.instanceMatrix.needsUpdate=!0}};var po=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],xd=class extends be{get isTracking(){return!!this.impl}constructor(e,t,o){super(),this.controllerOrHandedness=e,this.color=t,this.profile=o,this.impl=null;let r=null,i=null;oe(e)?i=e:r=e;let s=()=>this.add(this.impl=this.createModel(r,i));r?(r.addEventListener("connected",a=>{let l=a.data;l.hand&&!this.impl&&(i=l.handedness,s())}),r.addEventListener("disconnected",()=>{let a=this.impl;this.impl=null,i=null,a.removeFromParent(),ye(a)})):i&&s()}createModel(e,t){return this.profile==="mesh"?new bl(e,t,this.color):new yl(e,t,this.color,this.profile)}get count(){return this.impl?this.impl.count:0}set count(e){this.impl&&(this.impl.count=e)}getMatrixAt(e,t){this.impl&&this.impl.getMatrixAt(e,t)}setMatrixAt(e,t){this.impl&&this.impl.setMatrixAt(e,t)}updateMesh(){this.impl&&this.impl.updateMesh()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.impl&&this.impl.updateMesh()}},Dl=class{constructor(e,t){this.color=e,this.profile=t}createHandModel(e){return new xd(e,this.color,this.profile)}};var gd=class extends Bi{constructor(){super(),this.frame=null,Object.seal(this)}set(e,t,o){super.set(e,t),this.frame=o}},Cl=class{constructor(e){this.renderer=e,this.tickHandlers=new Array,this.lt=-1,this._isRunning=!1;let t=new gd,o=0;this._onTick=(r,i)=>{this.lt>=0&&(o=r-this.lt,t.set(r,o,i),this.tick(t)),this.lt=r}}get isRunning(){return this._isRunning}restart(){this.stop(),this.start()}addTickHandler(e){this.tickHandlers.push(e)}removeTickHandler(e){je(this.tickHandlers,e)}setAnimationLoop(e){this.renderer.setAnimationLoop(e),this._isRunning=w(e)}start(){this.isRunning||this.setAnimationLoop(this._onTick)}stop(){this.isRunning&&(this.setAnimationLoop(null),this.lt=-1)}tick(e){for(let t of this.tickHandlers)t(e)}};var zg=15,D2=mx(zg),Bl=class extends re{constructor(e,t,o,r,i,s=null,a=null,l=null){if(super(),this.styleSheetPath=t,this.fetcher=o,this.layers=new Array,this.layerSortOrder=new Map,this.spectator=new Ni,this.lastViewport=new cn,this.curViewport=new cn,this.gltfLoader=new uo,this.fadeDepth=0,this.scene=new Rr,this.stage=ce("Stage"),this.ambient=new Ym(16777215,.5),this.sun=new oc(16777215,.75),this.ground=new cf(D2,zg,12632256,8421504),this.foreground=ce("Foreground"),this.loadingBar=new Uc,this.handModelFactory=new Dl(new Pe(12044521),"mesh"),this.screenControl=null,this.enableSpectator=!1,this._xrBinding=null,this._xrMediaBinding=null,this._hasXRMediaLayers=null,this._hasXRCompositionLayers=null,this.layerSorter=Qt("descending",m=>this.layerSortOrder.get(m)),this.DEBUG=s||!1,this.defaultAvatarHeight=a||1.75,l=l||60,this.camera=new Ni(l,1,.01,1e3),this.cursor3D=new El(this),an(e)&&(e.style.backgroundColor="black",B(e.parentElement)))throw new Error("The provided canvas must be included in a parent element before constructing the environment.");this.renderer=new Wf({canvas:e,powerPreference:"high-performance",precision:"lowp",antialias:!0,alpha:!0,premultipliedAlpha:!0,depth:!0,logarithmicDepthBuffer:!0,stencil:!1,preserveDrawingBuffer:!1}),this.renderer.domElement.setAttribute("touch-action","none"),this.renderer.domElement.tabIndex=1,this.useNewColorModel=!1,an(e)&&(this.screenControl=new il(this.renderer,this.camera,this.renderer.domElement.parentElement,r,i)),this.fader=new Hc("ViewFader"),this.worldUISpace=new bs("WorldUISpace",.2,20,.125),this.avatar=new Wc(this,this.fader),this.eventSys=new kl(this),this.timer=new Cl(this.renderer),this.skybox=new al(this),this.renderer.xr.enabled=!0,this.sun.name="Sun",this.sun.position.set(0,1,1),this.sun.lookAt(0,0,0),this.sun.layers.enableAll();let p=()=>{this.ground.visible=this.renderer.xr.isPresenting};this.screenControl.addEventListener("sessionstarted",p),this.screenControl.addEventListener("sessionstopped",p),p(),this.ambient.name="Fill",this.ambient.layers.enableAll(),this.loadingBar.object.name="MainLoadingBar",this.loadingBar.object.position.set(0,-.25,-2),this.scene.layers.enableAll(),this.avatar.addFollower(this.worldUISpace),z(this.scene,this.sun,this.ambient,z(this.stage,this.ground,this.camera,this.avatar,...this.eventSys.hands),this.foreground,z(this.worldUISpace,this.loadingBar)),this.timer.addTickHandler(m=>this.update(m)),this._start(),globalThis.env=this}get useNewColorModel(){return Eu.enabled}set useNewColorModel(e){Eu.enabled=e,this.renderer.outputEncoding=e?Nf:gf}async _start(){w(this.styleSheetPath)&&await this.fetcher.get(this.styleSheetPath).style(),this.timer.start()}get gl(){return this.renderer.getContext()}get referenceSpace(){return this.renderer.xr.getReferenceSpace()}update(e){if(this.dispatchEvent(e),this.screenControl.visible){let t=this.xrSession;this._xrBinding=this.renderer.xr.getBinding(),this.hasXRMediaLayers&&this._xrMediaBinding===null===this.renderer.xr.isPresenting&&(this._xrMediaBinding===null&&w(t)?this._xrMediaBinding=new XRMediaBinding(t):this._xrMediaBinding=null);let o=t&&this.renderer.xr.getBaseLayer();o!==this.baseLayer&&(w(this.baseLayer)&&(this.removeWebXRLayer(this.baseLayer),this.baseLayer=null),w(o)&&(this.baseLayer=o,this.addWebXRLayer(o,0))),this.screenControl.resize(),this.eventSys.update(),this.avatar.update(e.dt),this.worldUISpace.update(this.avatar.height,this.avatar.worldPos,this.avatar.worldHeadingRadians,e.dt),this.fader.update(e.dt),nx(e.dt),this.loadingBar.update(e.sdt),this.preRender(e);let r=Lo(this.renderer,this.camera);if(r!==this.camera){let i=r;i.layers.mask=this.camera.layers.mask;for(let s=0;s<i.cameras.length;++s){let a=i.cameras[s];a.layers.mask=this.camera.layers.mask,a.layers.enable(s+1),i.layers.enable(s+1)}}this.screenControl.render(this.scene,this.camera),this.enableSpectator&&(this.renderer.xr.isPresenting?cr()&&!Lh()&&this.drawSnapshot():(this.lastViewport.copy(this.curViewport),this.renderer.getViewport(this.curViewport)))}}drawSnapshot(){let e=this.renderer.xr.isPresenting,t=null;if(e){let o=Lo(this.renderer,this.camera);this.spectator.projectionMatrix.copy(this.camera.projectionMatrix),this.spectator.position.copy(o.position),this.spectator.quaternion.copy(o.quaternion),t=this.renderer.getRenderTarget(),this.renderer.xr.isPresenting=!1,this.renderer.setRenderTarget(null),this.renderer.setViewport(this.lastViewport)}this.screenControl.render(this.scene,e?this.spectator:this.camera),e&&(this.renderer.setViewport(this.curViewport),this.renderer.setRenderTarget(t),this.renderer.xr.isPresenting=!0)}preRender(e){}async onQuitting(){this.dispatchEvent(new N("quitting")),window.location.href="/"}get hasAlpha(){return this.renderer.getContextAttributes().alpha}get xrSession(){return this.renderer.xr.getSession()}get xrBinding(){return this._xrBinding}get xrMediaBinding(){return this._xrMediaBinding}get isReadyForLayers(){return this.hasAlpha&&(!Fn||Ph.major>=15)}get hasXRMediaLayers(){return this._hasXRMediaLayers===null&&(this._hasXRMediaLayers=this.isReadyForLayers&&"XRMediaBinding"in globalThis&&ee(XRMediaBinding.prototype.createQuadLayer)),this._hasXRMediaLayers}get hasXRCompositionLayers(){return this._hasXRCompositionLayers===null&&(this._hasXRCompositionLayers=this.isReadyForLayers&&"XRWebGLBinding"in globalThis&&ee(XRWebGLBinding.prototype.createCubeLayer)),this._hasXRCompositionLayers}addWebXRLayer(e,t){this.layerSortOrder.set(e,t),$o(this.layers,e,this.layerSorter),this.updateLayers()}removeWebXRLayer(e){Ld(this.layers,e,this.layerSorter),this.layerSortOrder.delete(e),this.updateLayers()}updateLayers(){let e=this.xrSession;w(e)&&e.updateRenderState({layers:this.layers})}clearScene(){this.dispatchEvent(new N("sceneclearing")),ye(this.foreground),this.dispatchEvent(new N("scenecleared"))}async fadeOut(){++this.fadeDepth,this.fadeDepth===1&&(await this.fader.fadeOut(),this.skybox.visible=!1,this.camera.layers.set(Nr),this.loadingBar.start(),await this.fader.fadeIn())}async fadeIn(){this.fadeDepth===1&&(await this.fader.fadeOut(),this.camera.layers.set(Nc),this.skybox.visible=!0,await this.fader.fadeIn()),--this.fadeDepth}async withFade(e){try{return await this.fadeOut(),await e()}finally{await this.fadeIn()}}get showWebXRLayers(){return this.fadeDepth===0}set3DCursor(e){let t=e.children.slice(0);for(let o of t)this.cursor3D.add(o.name,o);this.eventSys.refreshCursors(),this.dispatchEvent(new N("newcursorloaded"))}async load(e,...t){let o=null;Di(e)?t.push(e):o=e;let r=new Do(this,"/models/Cursors.glb",So,!this.DEBUG);t.push(r),await this.fetcher.assets(o,...t),Ki(r.result.scene,sx),this.set3DCursor(r.result.scene)}loadGltf(e){return this.gltfLoader.loadAsync(e)}};function Ll(n,e){return Xa(n,e,Yt)}var Rs=class extends re{constructor(...e){super(),this.element=fe(ue("input-range-with-number"),this.rangeInput=Mh($t(()=>{this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.dispatchEvent(new N("input"))}),...e),this.numberInput=ir($t(()=>{this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber,this.rangeInput.dispatchEvent(new Event("input"))}))),this.numberInput.min=this.rangeInput.min,this.numberInput.max=this.rangeInput.max,this.numberInput.step=this.rangeInput.step,this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.numberInput.disabled=this.rangeInput.disabled,this.numberInput.placeholder=this.rangeInput.placeholder}get value(){return this.rangeInput.value}set value(e){this.rangeInput.value=this.numberInput.value=e}get valueAsNumber(){return this.rangeInput.valueAsNumber}set valueAsNumber(e){this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber=e}get disabled(){return this.rangeInput.disabled}set disabled(e){this.rangeInput.disabled=this.numberInput.disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}};var Ps=class{constructor(e,...t){this.name=e,this.properties=t}};function wd(n,...e){return new Ps(n,...e)}var Fd="DefaultPropertyGroup"+At(16),C2=ue("single-item");function Gg(n){return n.flatMap(e=>B2(e).flatMap(Yt))}function B2(n){let e=Fd,t=new Array;return n instanceof Ps?(e=n.name,t.push(...n.properties.map(o=>Xg(e,o)))):t.push(Xg(e,n)),t}function Xg(n,e){let t=n===Fd?null:Us("groupname",n);if(qt(e)){let[o,...r]=e,i=ru(o);for(let s of r)if(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement||s instanceof HTMLSelectElement){s.id.length===0&&(s.id=At(10)),i.htmlFor=s.id;break}return[_h(t,i),nu(t,...r)]}else return(oe(e)||me(e)||jt(e)||Ws(e))&&(e=Sh(e)),[nu(t,e)]}function L2(n){return w(n)&&!eu(n)&&!mi(n)}var Rl=class n{static find(){return Array.from(n._find())}static*_find(){for(let e of fh(".properties"))yield new n(e)}static create(...e){let t=e.filter(L2),o=e.filter(eu),r=e.filter(mi),i=Gg(t);return new n(Ah(ue("properties"),...o,...r,...i))}constructor(e){this.element=e,this.groups=new jn,this.controls=new Array,this._disabled=!1;let t=[...e.children];for(;t.length>0;){let o=t.shift();wi(o)&&this.controls.push(o),o instanceof HTMLElement&&(this.checkGroup(o),t.push(...o.children))}}append(...e){let t=Gg(e);te(this.element,...t);for(let o of e){let r=o instanceof Ps?o.properties:[o];for(let i of r)if(!oe(i)){let[s,...a]=qt(i)?i:[null,i];for(let l of a)wi(l)&&this.controls.push(l)}}for(let o of t)this.checkGroup(o)}checkGroup(e){let t=gn(e),o=t.dataset.groupname;o!==Fd&&this.groups.add(o,e),t.parentElement===this.element&&t.tagName==="DD"&&(!t.previousElementSibling||t.previousElementSibling.tagName!=="DT")&&C2.applyToElement(t)}get disabled(){return this._disabled}set disabled(e){if(e!==this.disabled){this._disabled=e,xh(this,e,"disabled");for(let t of this.controls)t.disabled=e}}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}setGroupVisible(e,t){let o=this.groups.get(e);if(o)for(let r of o)qe(r,t)}getGroupVisible(e){let t=this.groups.get(e);if(t)for(let o of t)return Et(o);return!1}};var Pl="micFields"+At(8),Ad="camFields"+At(8);function jg(n,e,t){Fi(n),te(n,Zs(Kt(""),"NONE"),...e.map(o=>Zs(Nd(t&&o.deviceId===t.deviceId),Kt(o.deviceId),o.label)))}var Vl=class extends Gn{constructor(e,t,o,r,i,s=!1){super("Configure devices"),this.devices=t,this.audio=o,this.microphones=r,this.webcams=i,this.micLookup=null,this.camLookup=null,this.spkrLookup=null,this.spkrVolumeControl=null,this.speakers=null,this.cancelButton.style.display="none";let a=new Ht("/audio/test-clip.mp3",xn,!s),l=e.assets(a).then(()=>this.audio.createBasicClip("test-audio",a,.5));te(this.contentArea,lh("2em"),this.properties=Rl.create(wd(Ad,["Webcams",this.webcamSelector=$s($t(async()=>{let p=this.webcamSelector.value,m=this.camLookup.get(p);await this.webcams.setDevice(m)}))]),wd(Pl,["Microphones",this.microphoneSelector=$s($e("inline-block"),$t(async()=>{let p=this.microphoneSelector.value,m=this.micLookup.get(p);await this.microphones.setDevice(m)}))],["Volume",this.micVolumeControl=new Rs(Fo(0),wo(100),_o(1),Kt(0),$t(()=>{this.microphones.gain.setValueAtTime(this.micVolumeControl.valueAsNumber/100,0)}))],["Levels",this.micLevels=Th($e("inline-block"))]))),tn&&(this.properties.append(["Speakers",this.speakers=$s($t(async()=>{let p=this.speakers.value,m=this.spkrLookup.get(p);await this.audio.speakers.setAudioOutputDevice(m)}))]),this.audio.speakers.addEventListener("audiooutputchanged",p=>{this.speakers.value=p.device&&p.device.deviceId||""})),this.properties.append(["Volume",this.spkrVolumeControl=new Rs(Fo(0),wo(100),_o(1),Kt(0),$t(()=>this.audio.destination.volume=this.spkrVolumeControl.valueAsNumber/100))],["",this.testSpkrButton=Ks("Test",Xs("Test audio"),tu(To(.5)),Eh(async()=>{this.testSpkrButton.disabled=!0,await l,await this.audio.playClipThrough("test-audio"),this.testSpkrButton.disabled=!1}))],["Using headphones",this.useHeadphones=_i(Ns(this.audio.useHeadphones),$t(()=>{this.audio.useHeadphones=this.useHeadphones.checked,qe(this.headphoneWarning,!this.audio.useHeadphones,"inline-block")}))],this.headphoneWarning=fe(ue("alert","alert-warning"),"\u{1F3A7}\u{1F399}\uFE0F This site has a voice chat feature. Voice chat is best experienced using headphones.")),this.activity=new ys(this.audio.context),this.activity.name="device-settings-dialog-activity",this.activity.addEventListener("activity",p=>{this.isOpen&&(this.micLevels.value=p.level)}),this.microphones.connect(this.activity),this.activity.start(),this.properties.setGroupVisible(Pl,!1),Object.seal(this)}get showWebcams(){return this.properties.getGroupVisible(Ad)}set showWebcams(e){this.properties.setGroupVisible(Ad,e)}get showMicrophones(){return this.properties.getGroupVisible(Pl)}set showMicrophones(e){this.properties.setGroupVisible(Pl,e)}async onShowing(){if(this.showWebcams||this.showMicrophones){await this.devices.init();let e=await this.devices.getDevices();if(this.showWebcams){let t=e.filter(o=>o.kind==="videoinput");this.camLookup=Ll(t,o=>o.deviceId),jg(this.webcamSelector,t,this.webcams.device)}if(this.showMicrophones){let t=e.filter(o=>o.kind==="audioinput");this.micLookup=Ll(t,o=>o.deviceId),jg(this.microphoneSelector,t,this.microphones.device),this.microphones.usingHeadphones=this.useHeadphones.checked,this.microphones.enabled=!0,this.micVolumeControl.valueAsNumber=this.microphones.gain.value*100}}if(tn){await this.audio.speakers.ready;let e=await this.audio.speakers.getAudioOutputDevices();this.spkrLookup=Ll(e,o=>o.deviceId),Fi(this.speakers),te(this.speakers,...e.map(o=>Zs(Kt(o.deviceId),o.label)));let t=await this.audio.speakers.getAudioOutputDevice();t||(t=await this.audio.speakers.getPreferredAudioOutput(),await this.audio.speakers.setAudioOutputDevice(t)),this.speakers.value=t&&t.deviceId||""}this.spkrVolumeControl.valueAsNumber=this.audio.destination.volume*100,this.useHeadphones.checked=this.audio.useHeadphones,qe(this.headphoneWarning,!this.audio.useHeadphones,"inline-block"),await super.onShowing()}};var _d=class extends N{constructor(e){super("roomjoined"),this.roomName=e}},vd=class extends N{constructor(e){super("dialogshowing"),this.showing=e}},Il=class extends Bl{get currentRoom(){return this._currentRoom}constructor(e){if(B(e))throw new Error("Options are now required");if(B(e.canvas))throw new Error("options.canvas is required");if(B(e.fetcher))throw new Error("options.fetcher is required");if(B(e.dialogFontFamily))throw new Error("options.dialogFontFamily is required");if(B(e.getAppUrl))throw new Error("options.getAppUrl is required");if(B(e.uiImagePaths))throw new Error("options.uiImagePaths is required");if(B(e.buttonFillColor))throw new Error("options.buttonFillColor is required");if(B(e.labelFillColor))throw new Error("options.labelFillColor is required");super(e.canvas,e.styleSheetPath,e.fetcher,e.enableFullResolution,e.enableAnaglyph,e.DEBUG,e.defaultAvatarHeight,e.defaultFOV),this.envAudioToggleEvt=new N("environmentaudiotoggled"),this._currentRoom=null,this._testSpaceLayout=!1,this.countTick=0,this.fpses=new Array,this.avgFPS=0,this.screenUISpace=new tc(e.buttonFillColor),this.compassImage=new Ga,this.clockImage=new Kn(this,"Clock","none",new Za),this.clockImage.sizeMode="fixed-height",this.clockImage.mesh.renderOrder=5,this.statsImage=new Kn(this,"Stats","none",new $a),this.statsImage.sizeMode="fixed-height",this.statsImage.mesh.renderOrder=5,this.infoLabel=new vn(this,"InfoLabel","none",{minHeight:.1,maxHeight:.1,padding:.02,scale:1e3,bgFillColor:e.labelFillColor,textFillColor:"white"}),this.apps=new Oc(this,e.getAppUrl),this.apps.addEventListener("apploaded",t=>{t.app.addEventListener("joinroom",o=>{o.roomName!==this._currentRoom&&(this._currentRoom=o.roomName,this.dispatchEvent(new _d(o.roomName)))})}),this.audio=new Va(e.fetcher,Qm),this.graph=new Ka(this.audio.context),an(e.canvas)&&e.canvas.addEventListener("keypress",t=>{sr(t)&&t.key==="`"&&this.graph.showDialog()}),this.audioPlayer=new Wa(this.audio.context,this.audio.createSpatializer(!1,!1)),this.videoPlayer=new Dc(this,this.audio.context,this.audio.createSpatializer(!1,!1)),this.videoPlayer.object.visible=!1,this.interactionAudio=new Bc(this.audio,this.eventSys),this.microphones=new Ia(this.audio.context),this.webcams=new ec,this.devices=new ia(this.microphones,this.webcams),this.confirmationDialog=new Ic(this,e.dialogFontFamily),this.devicesDialog=new Vl(this.fetcher,this.devices,this.audio,this.microphones,this.webcams,this.DEBUG),this.uiButtons=new Pc(e.uiImagePaths,20,e.buttonFillColor,e.labelFillColor,this.DEBUG),this.menuButton=new Hr(this.uiButtons,"ui","menu"),this.settingsButton=new Hr(this.uiButtons,"ui","settings"),this.quitButton=new Hr(this.uiButtons,"ui","quit"),this.muteMicButton=new Jn(this.uiButtons,"microphone","mute","unmute"),this.muteCamButton=new Jn(this.uiButtons,"media","play","pause"),this.muteEnvAudioButton=new Jn(this.uiButtons,"environment-audio","mute","unmute"),this.muteEnvAudioButton.active=!0,this.audio.ready.then(()=>this.muteEnvAudioButton.active=!1),this.fullscreenButton=new Bo(this.uiButtons,q.Fullscreen),this.anaglyphButton=new Bo(this.uiButtons,q.Anaglyph),this.vrButton=new Bo(this.uiButtons,q.VR),this.arButton=new Bo(this.uiButtons,q.AR),Li.isAvailable&&vi()&&(this.batteryImage=new Kn(this,"Battery","none",new Li),this.batteryImage.sizeMode="fixed-height"),this.xrUI=new Ac,this.subMenu=new Yn(fe(zs("juniperSubMenu")),ce("sub-menu"),"flex"),this.createMenu(),this.screenControl.setUI(this.screenUISpace,this.anaglyphButton,this.fullscreenButton,this.vrButton,this.arButton),w(this.screenControl)&&this.screenControl.addEventListener("sessionstarted",t=>{t.mode===q.Fullscreen&&this.confirmationDialog.element.parentElement!==this.screenControl.fullscreenElement&&te(this.screenControl.fullscreenElement,this.devicesDialog,this.confirmationDialog)}),w(e.watchModelPath)&&(this.watch=new Cc(this,e.watchModelPath)),this.microphones.addEventListener("devicesettingschanged",()=>{this.muteMicButton.active=this.microphones.enabled&&!this.microphones.muted}),this.webcams.addEventListener("devicesettingschanged",()=>{this.muteCamButton.active=this.webcams.enabled}),this.muteMicButton.addEventListener("click",()=>{this.microphones.muted=this.microphones.enabled&&!this.microphones.muted,this.muteMicButton.active=!this.microphones.muted}),this.muteCamButton.addEventListener("click",()=>{this.webcams.enabled=!this.webcams.enabled,this.muteCamButton.active=this.webcams.enabled}),this.muteMicButton.active=this.microphones.enabled&&!this.microphones.muted,this.muteCamButton.active=this.webcams.enabled,ee(e.createSpeechRecognizer)&&(this.speech=e.createSpeechRecognizer(this.fetcher,this.devicesDialog.activity,this.microphones),this.speech.continuous=!0)}get canvas(){return this.statsImage.image.canvas}get testSpaceLayout(){return this._testSpaceLayout}set testSpaceLayout(e){e!==this.testSpaceLayout&&(this._testSpaceLayout=e)}createMenu(){w(this.batteryImage)&&(this.xrUI.addItem(this.batteryImage,{x:.75,y:-1,width:.2,height:.1}),te(this.screenUISpace.topRight,this.batteryImage)),this.xrUI.addItem(this.clockImage,{x:-1,y:1,height:.1}),this.xrUI.addItem(this.statsImage,{x:-1,y:.95,height:.1}),this.xrUI.addItem(this.confirmationDialog,{x:0,y:0,scale:.25}),this.xrUI.addItem(this.menuButton,{x:-1,y:-1,scale:.5}),this.xrUI.addItem(this.infoLabel,{x:0,y:-1.125,scale:.5}),this.xrUI.addItem(this.vrButton,{x:1,y:-1,scale:.5}),this.xrUI.addItem(this.arButton,{x:1,y:-1,scale:.5}),z(this.menuButton,this.subMenu),z(this.worldUISpace,this.xrUI),te(this.screenUISpace.topLeft,uh("none"),te(this.webcams,$e("inline-block"),Mo(Cn(50)),dh("scaleX(-1)"))),this.screenUISpace.topRight.append(...[this.compassImage,this.statsImage].map(e=>e.canvas).filter(an).map(e=>e)),te(this.screenUISpace.bottomCenter,this.infoLabel),te(this.screenUISpace.bottomRight,this.vrButton,this.arButton,this.fullscreenButton,this.anaglyphButton),te(this.screenUISpace.bottomLeft,fe(this.menuButton,$e("flex"),th("column-reverse"),oh(To(.25)),this.subMenu)),Dx(this.subMenu,this.settingsButton,this.muteCamButton,this.muteMicButton,this.muteEnvAudioButton,this.quitButton),this.settingsButton.addEventListener("click",async()=>{let e=this.screenControl.currentMode,t=this.renderer.xr.isPresenting;t&&await this.screenControl.stop(),await this.devicesDialog.showDialog(),t&&await this.screenControl.start(e)}),this.muteEnvAudioButton.addEventListener("click",()=>{this.muteEnvAudioButton.active=!this.muteEnvAudioButton.active,this.dispatchEvent(this.envAudioToggleEvt)}),this.quitButton.addEventListener("click",()=>this.withConfirmation("Confirm quit","Are you sure you want to quit?",async()=>{this.renderer.xr.isPresenting&&this.screenControl.stop(),await this.onQuitting()})),this.menuButton.addEventListener("click",()=>this.subMenu.visible=!this.subMenu.visible),[this.settingsButton,this.muteCamButton,this.muteMicButton,this.muteEnvAudioButton,this.quitButton].forEach(e=>e.addEventListener("click",()=>this.subMenu.visible=!1)),this.subMenu.visible=!1,this.vrButton.visible=cr()&&oa()||wn(),this.arButton.visible=!1,this.muteCamButton.visible=!1,this.muteMicButton.visible=!1}layoutMenu(){let e=0;for(let t of this.subMenu.object.children)t.visible&&t.position.set(0,++e*.25,0)}preRender(e){super.preRender(e);let{worldPos:t,worldQuat:o}=this.avatar;if(this.audio.setUserPose(this.audio.localUserID,t.x,t.y,t.z,o.x,o.y,o.z,o.w),this.xrUI.visible=this.renderer.xr.isPresenting||this.testSpaceLayout,this.statsImage.isVisible=this.xrUI.visible&&this.DEBUG,this.renderer.xr.isPresenting||this.compassImage.setPitchAndHeading(Ci(this.avatar.worldPitchRadians),Ci(this.avatar.worldHeadingRadians)),this.layoutMenu(),this.DEBUG){let r=Math.round(e.fps);if(this.avgFPS+=r/100,this.fpses.push(r),this.fpses.length>100){let i=this.fpses.shift();this.avgFPS-=i/100}++this.countTick%100===0&&this.statsImage.image.setStats(this.avgFPS,this.renderer.info.render.calls,this.renderer.info.render.triangles)}this.confirmationDialog.update(e.dt)}get environmentAudioMuted(){return this.muteEnvAudioButton.active}async withConfirmation(e,t,o){this.onConfirmationShowing(!0),await this.confirmationDialog.prompt(e,t)&&o(),this.onConfirmationShowing(!1)}onConfirmationShowing(e){yx(this.quitButton,!e),this.dispatchEvent(new vd(e))}async load(e,...t){let o=null;Di(e)?(t.push(e),o=this.loadingBar):o=e,an(this.renderer.domElement)&&te(this.renderer.domElement.parentElement,this.renderer.domElement,...this.screenUISpace.elements);let r=new Ht("/audio/footsteps.mp3",xn,!this.DEBUG),i=new Ht("/audio/basic_enter.mp3",xn,!this.DEBUG),s=new Ht("/audio/basic_exit.mp3",xn,!this.DEBUG),a=new Ht("/audio/basic_error.mp3",xn,!this.DEBUG),l=new Ht("/audio/vintage_radio_button_pressed.mp3",xn,!this.DEBUG);t.push(...this.uiButtons.assets,r,i,s,a,l),w(this.watch)&&t.push(this.watch.asset),await super.load(o,...t),await Bn(this.audio.createBasicClip("footsteps",r,.5),this.interactionAudio.create("enter",i,.25),this.interactionAudio.create("exit",s,.25),this.interactionAudio.create("error",a,.25),this.interactionAudio.create("click",l,1)),this.screenUISpace.show()}};var LN=Il;export{LN as default};
