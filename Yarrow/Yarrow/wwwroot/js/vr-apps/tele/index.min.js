var Es=Object.create;var Eo=Object.defineProperty;var bs=Object.getOwnPropertyDescriptor;var Cs=Object.getOwnPropertyNames;var ys=Object.getPrototypeOf,Bs=Object.prototype.hasOwnProperty;var Ie=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var Ls=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),rt=(t,e)=>{for(var n in e)Eo(t,n,{get:e[n],enumerable:!0})},Rs=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Cs(e))!Bs.call(t,r)&&r!==n&&Eo(t,r,{get:()=>e[r],enumerable:!(o=bs(e,r))||o.enumerable});return t};var ii=(t,e,n)=>(n=t!=null?Es(ys(t)):{},Rs(e||!t||!t.__esModule?Eo(n,"default",{value:t,enumerable:!0}):n,t));var Or=Ls((zk,Hr)=>{"use strict";var m={};m.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)};m.localCName=m.generateIdentifier();m.splitLines=function(t){return t.trim().split(`
`).map(e=>e.trim())};m.splitSections=function(t){return t.split(`
m=`).map((n,o)=>(o>0?"m="+n:n).trim()+`\r
`)};m.getDescription=function(t){let e=m.splitSections(t);return e&&e[0]};m.getMediaSections=function(t){let e=m.splitSections(t);return e.shift(),e};m.matchPrefix=function(t,e){return m.splitLines(t).filter(n=>n.indexOf(e)===0)};m.parseCandidate=function(t){let e;t.indexOf("a=candidate:")===0?e=t.substring(12).split(" "):e=t.substring(10).split(" ");let n={foundation:e[0],component:{1:"rtp",2:"rtcp"}[e[1]]||e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]};for(let o=8;o<e.length;o+=2)switch(e[o]){case"raddr":n.relatedAddress=e[o+1];break;case"rport":n.relatedPort=parseInt(e[o+1],10);break;case"tcptype":n.tcpType=e[o+1];break;case"ufrag":n.ufrag=e[o+1],n.usernameFragment=e[o+1];break;default:n[e[o]]===void 0&&(n[e[o]]=e[o+1]);break}return n};m.writeCandidate=function(t){let e=[];e.push(t.foundation);let n=t.component;n==="rtp"?e.push(1):n==="rtcp"?e.push(2):e.push(n),e.push(t.protocol.toUpperCase()),e.push(t.priority),e.push(t.address||t.ip),e.push(t.port);let o=t.type;return e.push("typ"),e.push(o),o!=="host"&&t.relatedAddress&&t.relatedPort&&(e.push("raddr"),e.push(t.relatedAddress),e.push("rport"),e.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(e.push("tcptype"),e.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(e.push("ufrag"),e.push(t.usernameFragment||t.ufrag)),"candidate:"+e.join(" ")};m.parseIceOptions=function(t){return t.substring(14).split(" ")};m.parseRtpMap=function(t){let e=t.substring(9).split(" "),n={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),n.name=e[0],n.clockRate=parseInt(e[1],10),n.channels=e.length===3?parseInt(e[2],10):1,n.numChannels=n.channels,n};m.writeRtpMap=function(t){let e=t.payloadType;t.preferredPayloadType!==void 0&&(e=t.preferredPayloadType);let n=t.channels||t.numChannels||1;return"a=rtpmap:"+e+" "+t.name+"/"+t.clockRate+(n!==1?"/"+n:"")+`\r
`};m.parseExtmap=function(t){let e=t.substring(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1],attributes:e.slice(2).join(" ")}};m.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`};m.parseFmtp=function(t){let e={},n,o=t.substring(t.indexOf(" ")+1).split(";");for(let r=0;r<o.length;r++)n=o[r].trim().split("="),e[n[0].trim()]=n[1];return e};m.writeFmtp=function(t){let e="",n=t.payloadType;if(t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){let o=[];Object.keys(t.parameters).forEach(r=>{t.parameters[r]!==void 0?o.push(r+"="+t.parameters[r]):o.push(r)}),e+="a=fmtp:"+n+" "+o.join(";")+`\r
`}return e};m.parseRtcpFb=function(t){let e=t.substring(t.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}};m.writeRtcpFb=function(t){let e="",n=t.payloadType;return t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(o=>{e+="a=rtcp-fb:"+n+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),e};m.parseSsrcMedia=function(t){let e=t.indexOf(" "),n={ssrc:parseInt(t.substring(7,e),10)},o=t.indexOf(":",e);return o>-1?(n.attribute=t.substring(e+1,o),n.value=t.substring(o+1)):n.attribute=t.substring(e+1),n};m.parseSsrcGroup=function(t){let e=t.substring(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(n=>parseInt(n,10))}};m.getMid=function(t){let e=m.matchPrefix(t,"a=mid:")[0];if(e)return e.substring(6)};m.parseFingerprint=function(t){let e=t.substring(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1].toUpperCase()}};m.getDtlsParameters=function(t,e){return{role:"auto",fingerprints:m.matchPrefix(t+e,"a=fingerprint:").map(m.parseFingerprint)}};m.writeDtlsParameters=function(t,e){let n="a=setup:"+e+`\r
`;return t.fingerprints.forEach(o=>{n+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),n};m.parseCryptoLine=function(t){let e=t.substring(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}};m.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?m.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`};m.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;let e=t.substring(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}};m.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")};m.getCryptoParameters=function(t,e){return m.matchPrefix(t+e,"a=crypto:").map(m.parseCryptoLine)};m.getIceParameters=function(t,e){let n=m.matchPrefix(t+e,"a=ice-ufrag:")[0],o=m.matchPrefix(t+e,"a=ice-pwd:")[0];return n&&o?{usernameFragment:n.substring(12),password:o.substring(10)}:null};m.writeIceParameters=function(t){let e="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(e+=`a=ice-lite\r
`),e};m.parseRtpParameters=function(t){let e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=m.splitLines(t)[0].split(" ");e.profile=o[2];for(let i=3;i<o.length;i++){let a=o[i],s=m.matchPrefix(t,"a=rtpmap:"+a+" ")[0];if(s){let c=m.parseRtpMap(s),p=m.matchPrefix(t,"a=fmtp:"+a+" ");switch(c.parameters=p.length?m.parseFmtp(p[0]):{},c.rtcpFeedback=m.matchPrefix(t,"a=rtcp-fb:"+a+" ").map(m.parseRtcpFb),e.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(c.name.toUpperCase());break;default:break}}}m.matchPrefix(t,"a=extmap:").forEach(i=>{e.headerExtensions.push(m.parseExtmap(i))});let r=m.matchPrefix(t,"a=rtcp-fb:* ").map(m.parseRtcpFb);return e.codecs.forEach(i=>{r.forEach(a=>{i.rtcpFeedback.find(c=>c.type===a.type&&c.parameter===a.parameter)||i.rtcpFeedback.push(a)})}),e};m.writeRtpDescription=function(t,e){let n="";n+="m="+t+" ",n+=e.codecs.length>0?"9":"0",n+=" "+(e.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=e.codecs.map(r=>r.preferredPayloadType!==void 0?r.preferredPayloadType:r.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,e.codecs.forEach(r=>{n+=m.writeRtpMap(r),n+=m.writeFmtp(r),n+=m.writeRtcpFb(r)});let o=0;return e.codecs.forEach(r=>{r.maxptime>o&&(o=r.maxptime)}),o>0&&(n+="a=maxptime:"+o+`\r
`),e.headerExtensions&&e.headerExtensions.forEach(r=>{n+=m.writeExtmap(r)}),n};m.parseRtpEncodingParameters=function(t){let e=[],n=m.parseRtpParameters(t),o=n.fecMechanisms.indexOf("RED")!==-1,r=n.fecMechanisms.indexOf("ULPFEC")!==-1,i=m.matchPrefix(t,"a=ssrc:").map(u=>m.parseSsrcMedia(u)).filter(u=>u.attribute==="cname"),a=i.length>0&&i[0].ssrc,s,c=m.matchPrefix(t,"a=ssrc-group:FID").map(u=>u.substring(17).split(" ").map(h=>parseInt(h,10)));c.length>0&&c[0].length>1&&c[0][0]===a&&(s=c[0][1]),n.codecs.forEach(u=>{if(u.name.toUpperCase()==="RTX"&&u.parameters.apt){let l={ssrc:a,codecPayloadType:parseInt(u.parameters.apt,10)};a&&s&&(l.rtx={ssrc:s}),e.push(l),o&&(l=JSON.parse(JSON.stringify(l)),l.fec={ssrc:a,mechanism:r?"red+ulpfec":"red"},e.push(l))}}),e.length===0&&a&&e.push({ssrc:a});let p=m.matchPrefix(t,"b=");return p.length&&(p[0].indexOf("b=TIAS:")===0?p=parseInt(p[0].substring(7),10):p[0].indexOf("b=AS:")===0?p=parseInt(p[0].substring(5),10)*1e3*.95-50*40*8:p=void 0,e.forEach(u=>{u.maxBitrate=p})),e};m.parseRtcpParameters=function(t){let e={},n=m.matchPrefix(t,"a=ssrc:").map(i=>m.parseSsrcMedia(i)).filter(i=>i.attribute==="cname")[0];n&&(e.cname=n.value,e.ssrc=n.ssrc);let o=m.matchPrefix(t,"a=rtcp-rsize");e.reducedSize=o.length>0,e.compound=o.length===0;let r=m.matchPrefix(t,"a=rtcp-mux");return e.mux=r.length>0,e};m.writeRtcpParameters=function(t){let e="";return t.reducedSize&&(e+=`a=rtcp-rsize\r
`),t.mux&&(e+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(e+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),e};m.parseMsid=function(t){let e,n=m.matchPrefix(t,"a=msid:");if(n.length===1)return e=n[0].substring(7).split(" "),{stream:e[0],track:e[1]};let o=m.matchPrefix(t,"a=ssrc:").map(r=>m.parseSsrcMedia(r)).filter(r=>r.attribute==="msid");if(o.length>0)return e=o[0].value.split(" "),{stream:e[0],track:e[1]}};m.parseSctpDescription=function(t){let e=m.parseMLine(t),n=m.matchPrefix(t,"a=max-message-size:"),o;n.length>0&&(o=parseInt(n[0].substring(19),10)),isNaN(o)&&(o=65536);let r=m.matchPrefix(t,"a=sctp-port:");if(r.length>0)return{port:parseInt(r[0].substring(12),10),protocol:e.fmt,maxMessageSize:o};let i=m.matchPrefix(t,"a=sctpmap:");if(i.length>0){let a=i[0].substring(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:o}}};m.writeSctpDescription=function(t,e){let n=[];return t.protocol!=="DTLS/SCTP"?n=["m="+t.kind+" 9 "+t.protocol+" "+e.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+e.port+`\r
`]:n=["m="+t.kind+" 9 "+t.protocol+" "+e.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+e.port+" "+e.protocol+` 65535\r
`],e.maxMessageSize!==void 0&&n.push("a=max-message-size:"+e.maxMessageSize+`\r
`),n.join("")};m.generateSessionId=function(){return Math.random().toString().substr(2,22)};m.writeSessionBoilerplate=function(t,e,n){let o,r=e!==void 0?e:2;return t?o=t:o=m.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+o+" "+r+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`};m.getDirection=function(t,e){let n=m.splitLines(t);for(let o=0;o<n.length;o++)switch(n[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[o].substring(2);default:}return e?m.getDirection(e):"sendrecv"};m.getKind=function(t){return m.splitLines(t)[0].split(" ")[0].substring(2)};m.isRejected=function(t){return t.split(" ",2)[1]==="0"};m.parseMLine=function(t){let n=m.splitLines(t)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}};m.parseOLine=function(t){let n=m.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}};m.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;let e=m.splitLines(t);for(let n=0;n<e.length;n++)if(e[n].length<2||e[n].charAt(1)!=="=")return!1;return!0};typeof Hr=="object"&&(Hr.exports=m)});function it(t,e,n){return typeof t===e||t instanceof n}function J(t){return it(t,"function",Function)}function j(t){return it(t,"string",String)}function He(t){return it(t,"boolean",Boolean)}function $(t){return it(t,"number",Number)}function Ae(t){return x(t)&&it(t,"object",Object)}function at(t){return t instanceof Array}function T(t){return t==null}function x(t){return!T(t)}function ai(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function si(t){return Ae(t)&&"compareTo"in t&&J(t.compareTo)}function ci(t,...e){let n=null;j(t)?n=t:(n="ascending",e.unshift(t));let o=n==="ascending"?1:-1;return Object.assign((i,a)=>{if(i===a)return 0;for(let s of e){let c=T(i)?null:s(i),p=T(a)?null:s(a),u=c===p?0:j(c)&&j(p)?o*c.localeCompare(p):si(c)&&si(p)?o*c.compareTo(p):n==="ascending"&&c>p||n==="descending"&&c<p?1:-1;if(u!==0)return u}return 0},{direction:n})}function Ps(t,e,n,o="search"){let r=0,i=t.length-1;for(;r<=i;){let a=r+i>>1,s=n(t[a],e);if(s===0){if(o!=="search"){let c=o==="append"?1:-1;for(c>0&&(a+=c);0<=a&&a<t.length&&(s=n(t[a],e))===0;)a+=c;c<0&&(a-=c)}return a}else s<0?r=a-s:i=a-s}return-r-1}function bo(t,e,n,o="search"){let r=o!=="set";o==="set"&&(o="search");let i=null;if($(n)?i=n:i=Ps(t,e,n,o),i<0)i=-i-1;else if(!r)return-1;return Ws(t,e,i),i}function ve(t){return t.splice(0)}function pi(t,e){for(let n=0;n<t.length;++n)if(t[n]!==e[n])return n;return-1}function Ws(t,e,n){t.splice(n,0,e)}function K(t,e){let n=t.indexOf(e);return n>-1?(Co(t,n),!0):!1}function Co(t,e){return t.splice(e,1)[0]}function Vs(t,e,n){let o=t?0:e.length-1,r=t?e.length:-1,i=t?1:-1;for(let a of n)for(let s=o;s!=r;s+=i){let c=e[s];if(a(c))return c}return null}function Vt(t,...e){return Vs(!0,t,e)}function ui(...t){return Promise.all(t)}var li=/([^\/]+)\/(.+)/,Is=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/;var st=class t{constructor(e,n,o){this._type=e,this._fullSubType=n,this._primaryExtension=null,this.depMessage=null;let r=new Map;this._parameters=r;let i=this._fullSubType.match(Is);this._tree=i[1],this._subType=i[2],this._suffix=i[3];let a=i[4];if(this._value=this._fullValue=this._type+"/",x(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,x(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),x(a)){let s=a.split(";").map(c=>c.trim()).filter(c=>c.length>0).map(c=>c.split("="));for(let[c,...p]of s){let u=p.join("=");r.set(c,u);let l=`; ${c}=${u}`;this._fullValue+=l,c!=="q"&&(this._value+=l)}}this._extensions=o||[],this._primaryExtension=this._extensions[0]||null}static parse(e){if(!e)return null;let n=e.match(li);if(!n)return null;let o=n[1],r=n[2];return new t(o,r)}deprecate(e){return this.depMessage=e,this}check(){x(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(e){if(T(e))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let n=null,o=null;if(j(e)){let r=e.match(li);if(!r)return!1;n=r[1],o=r[2]}else n=e.typeName,o=e._fullSubType;return this.typeName===n&&(this._fullSubType==="*"||this._fullSubType===o)}withParameter(e,n){let o=`${this._fullSubType}; ${e}=${n}`;return new t(this.typeName,o,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}toFileSystemAPIAccepts(){return{[this.value]:this.extensions.map(e=>"."+e)}}addExtension(e){if(!e)throw new Error("File name is not defined");return this.primaryExtension&&(e=t.removeExtension(e),e=`${e}.${this.primaryExtension}`),e}static removeExtension(e){let n=e.lastIndexOf(".");return n>-1&&(e=e.substring(0,n)),e}};function Hs(t,e,...n){return new st(t,e,n)}function N(t){return Hs.bind(null,t)}var Os=N("audio");var yo=Os("mpeg","mp3","mp2","mp2a","mpga","m2a","m3a");var di=N("model");var It=di("gltf-binary","glb"),mi=di("gltf+json","gltf");function hi(t){if(t.status>=400)throw new Error("Resource could not be retrieved: "+t.requestPath);return t}function xi(t){let{content:e}=hi(t);return e}var Bo=class{get result(){if(x(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}constructor(e,n){this.path=e,this.type=n,this._result=null,this._error=null,this._started=!1,this._finished=!1,this.resolve=null,this.reject=null,this.promise=new Promise((o,r)=>{this.resolve=i=>{this._result=i,this._finished=!0,o(i)},this.reject=i=>{this._error=i,this._finished=!0,r(i)}})}async getSize(e){try{let{contentLength:n}=await e.head(this.path).accept(this.type).exec();return[this,n||1]}catch(n){return console.warn(n),[this,1]}}async fetch(e,n){try{let o=await this.getResult(e,n);this.resolve(o)}catch(o){this.reject(o)}}get[Symbol.toStringTag](){return this.promise.toString()}then(e,n){return this.promise.then(e,n)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}};var ct=class extends Bo{constructor(e,n,o){let r;He(n)?o=n:r=n,super(e,r),this.useCache=!!o}getResult(e,n){return this.getRequest(e,n).then(xi)}getRequest(e,n){let o=e.get(this.path).useCache(this.useCache).progress(n);return this.getResponse(o)}};var pt=class extends ct{getResponse(e){return e.file(this.type)}};function Lo(t){return t}var Ht=1e-6,ut=typeof Float32Array<"u"?Float32Array:Array,Ro=Math.random;var Gu=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Ot={};rt(Ot,{add:()=>qs,angle:()=>xc,bezier:()=>sc,ceil:()=>Js,clone:()=>Us,copy:()=>Gs,create:()=>Fi,cross:()=>rc,dist:()=>Tc,distance:()=>Si,div:()=>kc,divide:()=>_i,dot:()=>Ai,equals:()=>fc,exactEquals:()=>wc,floor:()=>$s,forEach:()=>Mc,fromValues:()=>js,hermite:()=>ac,inverse:()=>nc,len:()=>vc,length:()=>gi,lerp:()=>ic,max:()=>Ys,min:()=>Ks,mul:()=>Sc,multiply:()=>fi,negate:()=>tc,normalize:()=>oc,random:()=>cc,rotateX:()=>dc,rotateY:()=>mc,rotateZ:()=>hc,round:()=>Qs,scale:()=>Zs,scaleAndAdd:()=>ec,set:()=>zs,sqrDist:()=>Ac,sqrLen:()=>Dc,squaredDistance:()=>ki,squaredLength:()=>Ti,str:()=>gc,sub:()=>_c,subtract:()=>wi,transformMat3:()=>uc,transformMat4:()=>pc,transformQuat:()=>lc,zero:()=>Fc});function Fi(){var t=new ut(3);return ut!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Us(t){var e=new ut(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function gi(t){var e=t[0],n=t[1],o=t[2];return Math.hypot(e,n,o)}function js(t,e,n){var o=new ut(3);return o[0]=t,o[1]=e,o[2]=n,o}function Gs(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function zs(t,e,n,o){return t[0]=e,t[1]=n,t[2]=o,t}function qs(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function wi(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function fi(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function _i(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Js(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function $s(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Ks(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function Ys(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function Qs(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Zs(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function ec(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t}function Si(t,e){var n=e[0]-t[0],o=e[1]-t[1],r=e[2]-t[2];return Math.hypot(n,o,r)}function ki(t,e){var n=e[0]-t[0],o=e[1]-t[1],r=e[2]-t[2];return n*n+o*o+r*r}function Ti(t){var e=t[0],n=t[1],o=t[2];return e*e+n*n+o*o}function tc(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function nc(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function oc(t,e){var n=e[0],o=e[1],r=e[2],i=n*n+o*o+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Ai(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function rc(t,e,n){var o=e[0],r=e[1],i=e[2],a=n[0],s=n[1],c=n[2];return t[0]=r*c-i*s,t[1]=i*a-o*c,t[2]=o*s-r*a,t}function ic(t,e,n,o){var r=e[0],i=e[1],a=e[2];return t[0]=r+o*(n[0]-r),t[1]=i+o*(n[1]-i),t[2]=a+o*(n[2]-a),t}function ac(t,e,n,o,r,i){var a=i*i,s=a*(2*i-3)+1,c=a*(i-2)+i,p=a*(i-1),u=a*(3-2*i);return t[0]=e[0]*s+n[0]*c+o[0]*p+r[0]*u,t[1]=e[1]*s+n[1]*c+o[1]*p+r[1]*u,t[2]=e[2]*s+n[2]*c+o[2]*p+r[2]*u,t}function sc(t,e,n,o,r,i){var a=1-i,s=a*a,c=i*i,p=s*a,u=3*i*s,l=3*c*a,h=c*i;return t[0]=e[0]*p+n[0]*u+o[0]*l+r[0]*h,t[1]=e[1]*p+n[1]*u+o[1]*l+r[1]*h,t[2]=e[2]*p+n[2]*u+o[2]*l+r[2]*h,t}function cc(t,e){e=e||1;var n=Ro()*2*Math.PI,o=Ro()*2-1,r=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(n)*r,t[1]=Math.sin(n)*r,t[2]=o*e,t}function pc(t,e,n){var o=e[0],r=e[1],i=e[2],a=n[3]*o+n[7]*r+n[11]*i+n[15];return a=a||1,t[0]=(n[0]*o+n[4]*r+n[8]*i+n[12])/a,t[1]=(n[1]*o+n[5]*r+n[9]*i+n[13])/a,t[2]=(n[2]*o+n[6]*r+n[10]*i+n[14])/a,t}function uc(t,e,n){var o=e[0],r=e[1],i=e[2];return t[0]=o*n[0]+r*n[3]+i*n[6],t[1]=o*n[1]+r*n[4]+i*n[7],t[2]=o*n[2]+r*n[5]+i*n[8],t}function lc(t,e,n){var o=n[0],r=n[1],i=n[2],a=n[3],s=e[0],c=e[1],p=e[2],u=r*p-i*c,l=i*s-o*p,h=o*c-r*s,F=r*h-i*l,w=i*u-o*h,f=o*l-r*u,W=a*2;return u*=W,l*=W,h*=W,F*=2,w*=2,f*=2,t[0]=s+u+F,t[1]=c+l+w,t[2]=p+h+f,t}function dc(t,e,n,o){var r=[],i=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],i[0]=r[0],i[1]=r[1]*Math.cos(o)-r[2]*Math.sin(o),i[2]=r[1]*Math.sin(o)+r[2]*Math.cos(o),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function mc(t,e,n,o){var r=[],i=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],i[0]=r[2]*Math.sin(o)+r[0]*Math.cos(o),i[1]=r[1],i[2]=r[2]*Math.cos(o)-r[0]*Math.sin(o),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function hc(t,e,n,o){var r=[],i=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],i[0]=r[0]*Math.cos(o)-r[1]*Math.sin(o),i[1]=r[0]*Math.sin(o)+r[1]*Math.cos(o),i[2]=r[2],t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function xc(t,e){var n=t[0],o=t[1],r=t[2],i=e[0],a=e[1],s=e[2],c=Math.sqrt(n*n+o*o+r*r),p=Math.sqrt(i*i+a*a+s*s),u=c*p,l=u&&Ai(t,e)/u;return Math.acos(Math.min(Math.max(l,-1),1))}function Fc(t){return t[0]=0,t[1]=0,t[2]=0,t}function gc(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function wc(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function fc(t,e){var n=t[0],o=t[1],r=t[2],i=e[0],a=e[1],s=e[2];return Math.abs(n-i)<=Ht*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(o-a)<=Ht*Math.max(1,Math.abs(o),Math.abs(a))&&Math.abs(r-s)<=Ht*Math.max(1,Math.abs(r),Math.abs(s))}var _c=wi,Sc=fi,kc=_i,Tc=Si,Ac=ki,vc=gi,Dc=Ti,Mc=function(){var t=Fi();return function(e,n,o,r,i,a){var s,c;for(n||(n=3),o||(o=0),r?c=Math.min(r*n+o,e.length):c=e.length,s=o;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],i(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}();var vi=Ot.fromValues(0,0,-1),lt=Math.PI,dt=.5*lt,le=2*lt;var Ec=864e13,Yu=-Ec;function Di(t){return(t%le+le)%le}function Mi(t,e,n){return Math.min(n,Math.max(e,t))}function Ei(t){return t*le/360}function bi(...t){let e=Number.MAX_VALUE;for(let n of t)Math.abs(n)<e&&(e=n);return e}function Ci(t,e,n){return t*(n-e)+e}function yi(t,e,n){return(1-n)*t+n*e}function Po(t,...e){if(!Ae(t))return!1;t=t;for(let n of e){if(!(n in t))return!1;let o=t[n];if(!J(o))return!1}return!0}function bc(t){return Po(t,"dispose")}function Cc(t){return Po(t,"destroy")}function yc(t){return Po(t,"close")}function H(t){bc(t)&&t.dispose(),yc(t)&&t.close(),Cc(t)&&t.destroy()}async function Bi(t,e){let{status:n,requestPath:o,responsePath:r,content:i,contentType:a,contentLength:s,fileName:c,headers:p,date:u}=t;return{status:n,requestPath:o,responsePath:r,content:x(e)?await e(i):void 0,contentType:a,contentLength:s,fileName:c,headers:p,date:u}}var Nt=class extends ct{constructor(e,n,o,r){if(!It.matches(o)&&!mi.matches(o))throw new Error("Only GLTF model types are currently supported");super(n,o,r),this.env=e}async getResponse(e){let n=await e.file();return Bi(n,o=>this.env.loadGltf(o))}};var mt=class{constructor(){this.listeners=new Map,this.listenerOptions=new Map,this.bubblers=new Set,this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addScopedEventListener(e,n,o,r){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([n,o]),this.addEventListener(n,o,r)}removeScope(e){let n=this.scopes.get(e);if(n){this.scopes.delete(e);for(let[o,r]of n)this.removeEventListener(o,r)}}addEventListener(e,n,o){let r=this.listeners.get(e);r||(r=new Array,this.listeners.set(e,r)),r.find(i=>i===n)||(r.push(n),o&&this.listenerOptions.set(n,o))}removeEventListener(e,n){let o=this.listeners.get(e);o&&this.removeListener(o,n)}clearEventListeners(e){for(let[n,o]of this.listeners)if(T(e)||e===n){for(let r of o)this.removeEventListener(e,r);ve(o),this.listeners.delete(n)}}removeListener(e,n){let o=e.findIndex(r=>r===n);o>=0&&(Co(e,o),this.listenerOptions.has(n)&&this.listenerOptions.delete(n))}dispatchEvent(e){let n=this.listeners.get(e.type);if(n)for(let o of n){let r=this.listenerOptions.get(o);x(r)&&!He(r)&&r.once&&this.removeListener(n,o),J(o)?o.call(this,e):o.handleEvent(e)}if(e.defaultPrevented)return!1;for(let o of this.bubblers)if(!o.dispatchEvent(e))return!1;return!0}};var A=class extends Event{get type(){return super.type}constructor(e,n){super(e,n)}},R=class extends mt{addBubbler(e){super.addBubbler(e)}removeBubbler(e){super.removeBubbler(e)}addScopedEventListener(e,n,o,r){super.addScopedEventListener(e,n,o,r)}addEventListener(e,n,o){super.addEventListener(e,n,o)}removeEventListener(e,n){super.removeEventListener(e,n)}clearEventListeners(e){return super.clearEventListeners(e)}};function Wo(t){return x(t)&&"_resolveInput"in t}function Li(t){return Wo(t)&&"_resolveOutput"in t}var Xt=class extends R{get name(){return this._name}set name(e){this._name=e,this.context._name(this,e)}constructor(e,n){super(),this.nodeType=e,this.context=n,this._name=null,this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){}isConnected(e,n,o){return this.context._isConnected(this,e,n,o)}resolveOutput(e){let n={source:this,output:e};for(;Li(n.source);)n=n.source._resolveOutput(n.output);return n}resolveInput(e){let n={destination:this,input:e};for(;Wo(n.destination);)n=n.destination._resolveInput(n.input);return n}toggle(e,n,o){this._toggle(e,n,o)}_toggle(e,n,o){if(this.isConnected(e,n,o))this._disconnect(e,n,o);else return this._connect(e,n,o)}connect(e,n,o){return this._connect(e,n,o)}_connect(e,n,o){return this.context._connect(this,e,n,o)}disconnect(e,n,o){this._disconnect(e,n,o)}_disconnect(e,n,o){this.context._disconnect(this,e,n,o)}};var Ut=class extends Xt{constructor(e,n,o){super(e,n),this._node=o,this.context._init(this._node,this.nodeType)}onDisposing(){this.disconnect(),this.context._dispose(this._node),super.onDisposing()}parent(e){this.context._parent(this,e)}get channelCount(){return this._node.channelCount}set channelCount(e){this._node.channelCount=e}get channelCountMode(){return this._node.channelCountMode}set channelCountMode(e){this._node.channelCountMode=e}get channelInterpretation(){return this._node.channelInterpretation}set channelInterpretation(e){this._node.channelInterpretation=e}get numberOfInputs(){return this._node.numberOfInputs}get numberOfOutputs(){return this._node.numberOfOutputs}_resolveInput(e){return{destination:this._node,input:e}}_resolveOutput(e){return{source:this._node,output:e}}};var jt=class extends Ut{constructor(e,n){super("analyser",e,new AnalyserNode(e,n))}get fftSize(){return this._node.fftSize}set fftSize(e){this._node.fftSize=e}get frequencyBinCount(){return this._node.frequencyBinCount}get maxDecibels(){return this._node.maxDecibels}set maxDecibels(e){this._node.maxDecibels=e}get minDecibels(){return this._node.minDecibels}set minDecibels(e){this._node.minDecibels=e}get smoothingTimeConstant(){return this._node.smoothingTimeConstant}set smoothingTimeConstant(e){this._node.smoothingTimeConstant=e}getByteFrequencyData(e){this._node.getByteFrequencyData(e)}getByteTimeDomainData(e){this._node.getByteTimeDomainData(e)}getFloatFrequencyData(e){this._node.getFloatFrequencyData(e)}getFloatTimeDomainData(e){this._node.getFloatTimeDomainData(e)}};var Vo=class extends A{constructor(){super("update"),this.t=0,this.dt=0,this.sdt=0,this.fps=0}set(e,n){this.t=e,this.dt=n,this.sdt=yi(this.sdt,n,.01),n>0&&(this.fps=1e3/n)}},Gt=class extends Vo{constructor(){super(),Object.seal(this)}};var zt=class{constructor(e){this.timer=null,this.lt=-1,this.tickHandlers=new Array,this._targetFPS=null,this.targetFPS=e;let n=new Gt,o=0;this.onTick=r=>{this.lt>=0&&(o=r-this.lt,n.set(r,o),this.tick(n)),this.lt=r}}get targetFPS(){return this._targetFPS}set targetFPS(e){this._targetFPS=e}addTickHandler(e){this.tickHandlers.push(e)}removeTickHandler(e){K(this.tickHandlers,e)}tick(e){for(let n of this.tickHandlers)n(e)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};var qt=class extends zt{constructor(e){super(e)}start(){this.timer=setInterval(()=>this.onTick(performance.now()),this.targetFrameTime)}stop(){this.timer&&(clearInterval(this.timer),super.stop())}get targetFPS(){return super.targetFPS}set targetFPS(e){super.targetFPS=e,this.isRunning&&this.restart()}};var Io=class extends A{constructor(){super("activity"),this.level=0}},Oe=class extends jt{constructor(e){super(e,{fftSize:32,minDecibels:-70}),this._level=0,this.maxLevel=0,this.activityEvt=new Io,this.timer=new qt(30);let n=new Uint8Array(this.frequencyBinCount);this.timer.addTickHandler(()=>{this.getByteFrequencyData(n),this._level=Math.max(...n),isFinite(this._level)&&(this.maxLevel=Math.max(this.maxLevel,this._level),this.maxLevel>0&&(this._level/=this.maxLevel)),this.activityEvt.level=this.level,this.dispatchEvent(this.activityEvt)})}get level(){return this._level}start(){this.timer.start()}stop(){this.timer.stop()}};var Ri=new Map,Jt=class{constructor(e,n,o,...r){this.key=e,this.value=n,this.bySetAttribute=o,this.tags=r.map(i=>i.toLocaleUpperCase()),Object.freeze(this)}applyToElement(e){if(this.tags.length>0&&this.tags.indexOf(e.tagName)===-1){let n=Ri.get(e.tagName);n||Ri.set(e.tagName,n=new Set),n.has(this.key)||(n.add(this.key),console.warn(`Element ${e.tagName} does not support Attribute ${this.key}`))}this.bySetAttribute?e.setAttribute(this.key,this.value.toString()):this.key in e?e[this.key]=this.value:this.value===!1?e.removeAttribute(this.key):this.value===!0?e.setAttribute(this.key,""):J(this.value)?this.value(e):e.setAttribute(this.key,this.value.toString())}};function $t(t,e,n,...o){return new Jt(t,e,n,...o)}function Pi(t){return t instanceof Jt}function Wi(t){return $t("autoplay",t,!1,"audio","video")}function Vi(t){return $t("height",t,!1,"canvas","embed","iframe","img","input","object","video")}function Ii(t){return $t("srcObject",t,!1,"audio","video")}function Hi(t){return $t("width",t,!1,"canvas","embed","iframe","img","input","object","video")}function Oi(t){return`${t}px`}function Ni(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}var xe=class{constructor(e=!0){this.autoStart=e,this.onThens=new Array,this.onCatches=new Array,this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",this.resolve=n=>{if(this.running){this._result=n,this._resultState="resolved";for(let o of this.onThens)o(n);this.clear(),this._executionState="finished"}},this.reject=n=>{if(this.running){this._error=n,this._resultState="errored";for(let o of this.onCatches)o(n);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){ve(this.onThens),ve(this.onCatches)}start(){this._executionState="running"}resolver(e){return()=>this.resolve(e)}resolveOn(e,n,o){let r=this.resolver(o);e.addEventListener(n,r),this.finally(()=>e.removeEventListener(n,r))}get result(){if(x(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((e,n)=>{this.finished?this.errored?n(this.error):e(this.result):(this.onThens.push(e),this.onCatches.push(n))})}then(e,n){return this.project().then(e,n)}catch(e){return this.project().catch(e)}finally(e){return this.project().finally(e)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(e){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",e&&this.start()}};function Xi(t){return Ae(t)?t.element instanceof Element:!1}function Ho(t){return Xi(t)?t.element:j(t)?Pc(t):t}function Lc(t){return Ae(t)&&"applyToElement"in t&&J(t.applyToElement)}function Ui(t,e,n=""){t=Ho(t),e?(t.style.removeProperty("display"),getComputedStyle(t).display==="none"&&(t.style.display=n||"block")):t.style.display="none"}function ji(t){return t=Ho(t),t.style.display!=="none"}function Rc(t,...e){let n=t instanceof Element||t instanceof ShadowRoot?t:j(t)?document.querySelector(t):t.element,o=n instanceof HTMLTemplateElement?n.content:n;for(let r of e)x(r)&&(r instanceof Node?o.appendChild(r):Xi(r)?o.appendChild(Ho(r)):Lc(r)?n instanceof ShadowRoot||r.applyToElement(n):o.appendChild(document.createTextNode(r.toLocaleString())));return n}function Pc(t){return document.querySelector(t)}function Gi(t,...e){let n=null,o=e.filter(Pi).filter(r=>r.key==="id"||r.key==="query");for(let r of o)r.key==="query"?(n=r.value,K(e,r)):r.key==="id"&&(n=document.getElementById(r.value),n&&K(e,r));return n&&n.tagName!==t.toUpperCase()&&console.warn(`Expected a "${t.toUpperCase()}" element but found a "${n.tagName}".`),n||(n=document.createElement(t)),Rc(n,...e),n}function zi(...t){return Gi("canvas",...t)}function qi(...t){return Gi("video",...t)}var Kt=class t{constructor(e,n,o=null){this.value=e,this.desc=n,this.value=e,this.desc=n,this.props=o||{}}contains(e){return e instanceof t?this.contains(e.value):this.value.indexOf(e)>=0}changeStyle(e,n){let o=this.value;return o.endsWith(e)&&(o=o.substring(0,o.length-e.length)),o+=n,o}get textStyle(){return this.changeStyle("\uFE0F","\uFE0E")}get emojiStyle(){return this.changeStyle("\uFE0E","\uFE0F")}};var Ji=new Kt("\u2B50","Star");var{ACESFilmicToneMapping:gd,AddEquation:wd,AddOperation:fd,AdditiveAnimationBlendMode:_d,AdditiveBlending:Sd,AlphaFormat:kd,AlwaysDepth:Td,AlwaysStencilFunc:Ad,AmbientLight:vd,AmbientLightProbe:Dd,AnimationClip:Md,AnimationLoader:Ed,AnimationMixer:bd,AnimationObjectGroup:Cd,AnimationUtils:yd,ArcCurve:Bd,ArrayCamera:Ld,ArrowHelper:Rd,Audio:Pd,AudioAnalyser:Wd,AudioContext:Vd,AudioListener:Id,AudioLoader:Hd,AxesHelper:Od,BackSide:Nd,BasicDepthPacking:Xd,BasicShadowMap:Ud,Bone:jd,BooleanKeyframeTrack:Gd,Box2:zd,Box3:ht,Box3Helper:qd,BoxBufferGeometry:Jd,BoxGeometry:$i,BoxHelper:$d,BufferAttribute:Kd,BufferGeometry:Yd,BufferGeometryLoader:Qd,ByteType:Zd,Cache:em,Camera:tm,CameraHelper:nm,CanvasTexture:om,CapsuleBufferGeometry:rm,CapsuleGeometry:im,CatmullRomCurve3:am,CineonToneMapping:sm,CircleBufferGeometry:cm,CircleGeometry:pm,ClampToEdgeWrapping:um,Clock:lm,Color:Fe,ColorKeyframeTrack:dm,ColorManagement:mm,CompressedArrayTexture:hm,CompressedTexture:xm,CompressedTextureLoader:Fm,ConeBufferGeometry:gm,ConeGeometry:wm,CubeCamera:fm,CubeReflectionMapping:_m,CubeRefractionMapping:Sm,CubeTexture:km,CubeTextureLoader:Tm,CubeUVReflectionMapping:Am,CubicBezierCurve:vm,CubicBezierCurve3:Dm,CubicInterpolant:Mm,CullFaceBack:Em,CullFaceFront:bm,CullFaceFrontBack:Cm,CullFaceNone:ym,Curve:Bm,CurvePath:Lm,CustomBlending:Rm,CustomToneMapping:Pm,CylinderBufferGeometry:Wm,CylinderGeometry:Vm,Cylindrical:Im,Data3DTexture:Hm,DataArrayTexture:Om,DataTexture:Nm,DataTextureLoader:Xm,DataUtils:Um,DecrementStencilOp:jm,DecrementWrapStencilOp:Gm,DefaultLoadingManager:zm,DepthFormat:qm,DepthStencilFormat:Jm,DepthTexture:$m,DirectionalLight:Km,DirectionalLightHelper:Ym,DiscreteInterpolant:Qm,DisplayP3ColorSpace:Zm,DodecahedronBufferGeometry:eh,DodecahedronGeometry:th,DoubleSide:nh,DstAlphaFactor:oh,DstColorFactor:rh,DynamicCopyUsage:ih,DynamicDrawUsage:ah,DynamicReadUsage:sh,EdgesGeometry:ch,EllipseCurve:ph,EqualDepth:uh,EqualStencilFunc:lh,EquirectangularReflectionMapping:dh,EquirectangularRefractionMapping:mh,Euler:hh,EventDispatcher:xh,ExtrudeBufferGeometry:Fh,ExtrudeGeometry:gh,FileLoader:wh,Float16BufferAttribute:fh,Float32BufferAttribute:Oo,Float64BufferAttribute:_h,FloatType:Sh,Fog:kh,FogExp2:Th,FramebufferTexture:Ah,FrontSide:Ki,Frustum:vh,GLBufferAttribute:Dh,GLSL1:Mh,GLSL3:Eh,GreaterDepth:bh,GreaterEqualDepth:Ch,GreaterEqualStencilFunc:yh,GreaterStencilFunc:Bh,GridHelper:Lh,Group:Rh,HalfFloatType:Ph,HemisphereLight:Wh,HemisphereLightHelper:Vh,HemisphereLightProbe:Ih,IcosahedronBufferGeometry:Hh,IcosahedronGeometry:Oh,ImageBitmapLoader:Nh,ImageLoader:Xh,ImageUtils:Uh,IncrementStencilOp:jh,IncrementWrapStencilOp:Gh,InstancedBufferAttribute:zh,InstancedBufferGeometry:Yi,InstancedInterleavedBuffer:xt,InstancedMesh:qh,Int16BufferAttribute:Jh,Int32BufferAttribute:$h,Int8BufferAttribute:Kh,IntType:Yh,InterleavedBuffer:Qh,InterleavedBufferAttribute:ge,Interpolant:Zh,InterpolateDiscrete:ex,InterpolateLinear:tx,InterpolateSmooth:nx,InvertStencilOp:ox,KeepStencilOp:rx,KeyframeTrack:ix,LOD:ax,LatheBufferGeometry:sx,LatheGeometry:cx,Layers:px,LessDepth:ux,LessEqualDepth:lx,LessEqualStencilFunc:dx,LessStencilFunc:mx,Light:hx,LightProbe:xx,Line:Fx,Line3:Qi,LineBasicMaterial:Wc,LineCurve:gx,LineCurve3:wx,LineDashedMaterial:fx,LineLoop:_x,LineSegments:Sx,LinearEncoding:kx,LinearFilter:Tx,LinearInterpolant:Ax,LinearMipMapLinearFilter:vx,LinearMipMapNearestFilter:Dx,LinearMipmapLinearFilter:Mx,LinearMipmapNearestFilter:Ex,LinearSRGBColorSpace:bx,LinearToneMapping:Cx,Loader:yx,LoaderUtils:Bx,LoadingManager:Lx,LoopOnce:Rx,LoopPingPong:Px,LoopRepeat:Wx,LuminanceAlphaFormat:Vx,LuminanceFormat:Ix,MOUSE:Hx,Material:Ox,MaterialLoader:Nx,MathUtils:Zi,Matrix3:Xx,Matrix4:te,MaxEquation:Ux,Mesh:De,MeshBasicMaterial:No,MeshDepthMaterial:jx,MeshDistanceMaterial:Gx,MeshLambertMaterial:zx,MeshMatcapMaterial:qx,MeshNormalMaterial:Jx,MeshPhongMaterial:Xo,MeshPhysicalMaterial:$x,MeshStandardMaterial:Kx,MeshToonMaterial:Yx,MinEquation:Qx,MirroredRepeatWrapping:Zx,MixOperation:eF,MultiplyBlending:tF,MultiplyOperation:nF,NearestFilter:oF,NearestMipMapLinearFilter:rF,NearestMipMapNearestFilter:iF,NearestMipmapLinearFilter:aF,NearestMipmapNearestFilter:sF,NeverDepth:cF,NeverStencilFunc:pF,NoBlending:uF,NoColorSpace:lF,NoToneMapping:dF,NormalAnimationBlendMode:mF,NormalBlending:hF,NotEqualDepth:xF,NotEqualStencilFunc:FF,NumberKeyframeTrack:gF,Object3D:Y,ObjectLoader:wF,ObjectSpaceNormalMap:fF,OctahedronBufferGeometry:_F,OctahedronGeometry:SF,OneFactor:kF,OneMinusDstAlphaFactor:TF,OneMinusDstColorFactor:AF,OneMinusSrcAlphaFactor:vF,OneMinusSrcColorFactor:DF,OrthographicCamera:MF,PCFShadowMap:EF,PCFSoftShadowMap:bF,PMREMGenerator:CF,Path:yF,PerspectiveCamera:BF,Plane:LF,PlaneBufferGeometry:RF,PlaneGeometry:ea,PlaneHelper:PF,PointLight:WF,PointLightHelper:VF,Points:IF,PointsMaterial:HF,PolarGridHelper:OF,PolyhedronBufferGeometry:NF,PolyhedronGeometry:XF,PositionalAudio:UF,PropertyBinding:jF,PropertyMixer:GF,QuadraticBezierCurve:zF,QuadraticBezierCurve3:qF,Quaternion:oe,QuaternionKeyframeTrack:JF,QuaternionLinearInterpolant:$F,RED_GREEN_RGTC2_Format:KF,RED_RGTC1_Format:YF,REVISION:QF,RGBADepthPacking:ZF,RGBAFormat:eg,RGBAIntegerFormat:tg,RGBA_ASTC_10x10_Format:ng,RGBA_ASTC_10x5_Format:og,RGBA_ASTC_10x6_Format:rg,RGBA_ASTC_10x8_Format:ig,RGBA_ASTC_12x10_Format:ag,RGBA_ASTC_12x12_Format:sg,RGBA_ASTC_4x4_Format:cg,RGBA_ASTC_5x4_Format:pg,RGBA_ASTC_5x5_Format:ug,RGBA_ASTC_6x5_Format:lg,RGBA_ASTC_6x6_Format:dg,RGBA_ASTC_8x5_Format:mg,RGBA_ASTC_8x6_Format:hg,RGBA_ASTC_8x8_Format:xg,RGBA_BPTC_Format:Fg,RGBA_ETC2_EAC_Format:gg,RGBA_PVRTC_2BPPV1_Format:wg,RGBA_PVRTC_4BPPV1_Format:fg,RGBA_S3TC_DXT1_Format:_g,RGBA_S3TC_DXT3_Format:Sg,RGBA_S3TC_DXT5_Format:kg,RGB_ETC1_Format:Tg,RGB_ETC2_Format:Ag,RGB_PVRTC_2BPPV1_Format:vg,RGB_PVRTC_4BPPV1_Format:Dg,RGB_S3TC_DXT1_Format:Mg,RGFormat:Eg,RGIntegerFormat:bg,RawShaderMaterial:Cg,Ray:yg,Raycaster:Bg,RectAreaLight:Lg,RedFormat:Rg,RedIntegerFormat:Pg,ReinhardToneMapping:Wg,RepeatWrapping:Vg,ReplaceStencilOp:Ig,ReverseSubtractEquation:Hg,RingBufferGeometry:Og,RingGeometry:Ng,SIGNED_RED_GREEN_RGTC2_Format:Xg,SIGNED_RED_RGTC1_Format:Ug,SRGBColorSpace:jg,Scene:Gg,ShaderChunk:zg,ShaderLib:Ft,ShaderMaterial:ta,ShadowMaterial:qg,Shape:Jg,ShapeBufferGeometry:$g,ShapeGeometry:Kg,ShapePath:Yg,ShapeUtils:Qg,ShortType:Zg,Skeleton:ew,SkeletonHelper:tw,SkinnedMesh:nw,Source:ow,Sphere:Yt,SphereBufferGeometry:rw,SphereGeometry:iw,Spherical:aw,SphericalHarmonics3:sw,SplineCurve:cw,SpotLight:pw,SpotLightHelper:uw,Sprite:lw,SpriteMaterial:Vc,SrcAlphaFactor:dw,SrcAlphaSaturateFactor:mw,SrcColorFactor:hw,StaticCopyUsage:xw,StaticDrawUsage:Fw,StaticReadUsage:gw,StereoCamera:ww,StreamCopyUsage:fw,StreamDrawUsage:_w,StreamReadUsage:Sw,StringKeyframeTrack:kw,SubtractEquation:Tw,SubtractiveBlending:Aw,TOUCH:vw,TangentSpaceNormalMap:Dw,TetrahedronBufferGeometry:Mw,TetrahedronGeometry:Ew,Texture:na,TextureLoader:bw,TorusBufferGeometry:Cw,TorusGeometry:yw,TorusKnotBufferGeometry:Bw,TorusKnotGeometry:Lw,Triangle:Rw,TriangleFanDrawMode:Pw,TriangleStripDrawMode:Ww,TrianglesDrawMode:Vw,TubeBufferGeometry:Iw,TubeGeometry:Hw,TwoPassDoubleSide:Ow,UVMapping:Nw,Uint16BufferAttribute:Xw,Uint32BufferAttribute:Uw,Uint8BufferAttribute:jw,Uint8ClampedBufferAttribute:Gw,Uniform:zw,UniformsGroup:qw,UniformsLib:gt,UniformsUtils:Uo,UnsignedByteType:Jw,UnsignedInt248Type:$w,UnsignedIntType:Kw,UnsignedShort4444Type:Yw,UnsignedShort5551Type:Qw,UnsignedShortType:Zw,VSMShadowMap:ef,Vector2:oa,Vector3:g,Vector4:Me,VectorKeyframeTrack:tf,VideoTexture:ra,WebGL1Renderer:nf,WebGL3DRenderTarget:of,WebGLArrayRenderTarget:rf,WebGLCubeRenderTarget:af,WebGLMultipleRenderTargets:sf,WebGLRenderTarget:cf,WebGLRenderer:pf,WebGLUtils:uf,WireframeGeometry:ia,WrapAroundEnding:lf,ZeroCurvatureEnding:df,ZeroFactor:mf,ZeroSlopeEnding:hf,ZeroStencilOp:xf,_SRGBAFormat:Ff,sRGBEncoding:gf}=THREE;var Qt=class{constructor(e=!1){this.littleEndian=e,this.i=0,this._length=-1,this.length=0}get length(){return this._length}set length(e){e!==this.length&&(this._length=e,this.dataView=new DataView(new ArrayBuffer(this.length)),this.i=0)}get buffer(){return this.dataView.buffer}set buffer(e){e!==this.buffer&&(this._length=e.byteLength,this.dataView=new DataView(e),this.i=0)}get position(){return this.i}set position(e){this.i=e}get left(){return this.length-this.i}readUint8(){let e=this.dataView.getUint8(this.i);return this.i+=1,e}writeUint8(e){this.dataView.setUint8(this.i,e),this.i+=1}readUint16(){let e=this.dataView.getUint16(this.i,this.littleEndian);return this.i+=2,e}writeUint16(e){this.dataView.setUint16(this.i,e,this.littleEndian),this.i+=2}readUint32(){let e=this.dataView.getUint32(this.i,this.littleEndian);return this.i+=4,e}writeUint32(e){this.dataView.setUint32(this.i,e,this.littleEndian),this.i+=4}readUint64(){let e=this.dataView.getBigUint64(this.i,this.littleEndian);return this.i+=8,e}writeUint64(e){this.dataView.setBigUint64(this.i,e,this.littleEndian),this.i+=8}readInt64(){let e=this.dataView.getInt8(this.i);return this.i+=1,e}writeInt64(e){this.dataView.setInt8(this.i,e),this.i+=1}readInt16(){let e=this.dataView.getInt16(this.i,this.littleEndian);return this.i+=2,e}writeInt16(e){this.dataView.setInt16(this.i,e,this.littleEndian),this.i+=2}readInt32(){let e=this.dataView.getInt32(this.i,this.littleEndian);return this.i+=4,e}writeInt32(e){this.dataView.setInt32(this.i,e,this.littleEndian),this.i+=4}readInt8(){let e=this.dataView.getBigInt64(this.i,this.littleEndian);return this.i+=8,e}writeInt8(e){this.dataView.setBigInt64(this.i,e,this.littleEndian),this.i+=8}readFloat32(){let e=this.dataView.getFloat32(this.i,this.littleEndian);return this.i+=4,e}writeFloat32(e){this.dataView.setFloat32(this.i,e,this.littleEndian),this.i+=4}readFloat64(){let e=this.dataView.getFloat64(this.i,this.littleEndian);return this.i+=8,e}writeFloat64(e){this.dataView.setFloat64(this.i,e,this.littleEndian),this.i+=8}readEnum8(e){let n=this.readUint8();return e[n]}writeEnum8(e,n){let o=n.indexOf(e);this.writeUint8(o)}};var Ne=class extends Qt{readVector48(e){e.set(this.readFloat32(),this.readFloat32(),this.readFloat32())}writeVector48(e){this.writeFloat32(e.x),this.writeFloat32(e.y),this.writeFloat32(e.z)}readMatrix512(e){e.elements[0]=this.readFloat32(),e.elements[1]=this.readFloat32(),e.elements[2]=this.readFloat32(),e.elements[3]=this.readFloat32(),e.elements[4]=this.readFloat32(),e.elements[5]=this.readFloat32(),e.elements[6]=this.readFloat32(),e.elements[7]=this.readFloat32(),e.elements[8]=this.readFloat32(),e.elements[9]=this.readFloat32(),e.elements[10]=this.readFloat32(),e.elements[11]=this.readFloat32(),e.elements[12]=this.readFloat32(),e.elements[13]=this.readFloat32(),e.elements[14]=this.readFloat32(),e.elements[15]=this.readFloat32()}writeMatrix512(e){this.writeFloat32(e.elements[0]),this.writeFloat32(e.elements[1]),this.writeFloat32(e.elements[2]),this.writeFloat32(e.elements[3]),this.writeFloat32(e.elements[4]),this.writeFloat32(e.elements[5]),this.writeFloat32(e.elements[6]),this.writeFloat32(e.elements[7]),this.writeFloat32(e.elements[8]),this.writeFloat32(e.elements[9]),this.writeFloat32(e.elements[10]),this.writeFloat32(e.elements[11]),this.writeFloat32(e.elements[12]),this.writeFloat32(e.elements[13]),this.writeFloat32(e.elements[14]),this.writeFloat32(e.elements[15])}};var wt=new g;function Zt(t){return wt.copy(t),wt.y=0,wt.normalize(),Di(Math.atan2(wt.x,wt.z))}var Xe=new g,aa=0,Ic=new g,en=new g,jo=new g,tn=new oe,sa=0,Hc=0;function Oc(t,e){let n=t-e,o=n+le,r=n-le;return bi(n,o,r)}var nn=class extends Y{constructor(e,n,o,r,i=1){super(),this.minDistance=n,this.heightOffset=r,this.speed=i,this.name=e,this.lerp=this.minHeadingRadians>0||this.minDistance>0,this.maxDistance=this.minDistance*5,this.minHeadingRadians=Ei(o),this.maxHeadingRadians=lt-this.minHeadingRadians,Object.seal(this)}copy(e,n=!0){return super.copy(e,n),this.name=e.name+ ++Hc,this.lerp=e.lerp,this.maxDistance=e.maxDistance,this.minHeadingRadians=e.minHeadingRadians,this.maxHeadingRadians=e.maxHeadingRadians,this}update(e,n,o,r){r*=.001,this.clampTo(this.lerp,e,n,this.minDistance,this.maxDistance,o,this.minHeadingRadians,this.maxHeadingRadians,r)}reset(e,n,o){this.clampTo(!1,e,n,0,0,o,0,0,0)}clampTo(e,n,o,r,i,a,s,c,p){Xe.copy(o),Xe.y-=this.heightOffset*n,aa=a,this.getWorldPosition(en),this.getWorldDirection(jo),jo.negate(),sa=Zt(jo),tn.identity();let u=!e,l=!e;if(e){let h=Ic.copy(Xe).sub(en).length();r<h&&(h<i&&Xe.lerpVectors(en,Xe,this.speed*p),u=!0);let F=Oc(aa,sa),w=Math.abs(F);s<w&&(w<c?tn.setFromAxisAngle(this.up,F*this.speed*p):tn.setFromAxisAngle(this.up,F),l=!0)}(u||l)&&(u&&this.position.add(Xe.sub(en)),l&&this.quaternion.multiply(tn))}};var ft="HTMLCanvasElement"in globalThis,If="HTMLImageElement"in globalThis,ca=!1,Go=!ca&&"OffscreenCanvas"in globalThis,Nc=!ca&&"createImageBitmap"in globalThis;function zo(t){return ft&&t instanceof HTMLCanvasElement}function qo(t){return Go&&t instanceof OffscreenCanvas}function pa(t){return Nc&&t instanceof ImageBitmap}function ua(t){return t instanceof ImageData}function Xc(t){return zo(t)||qo(t)}function la(t,e){let n=t.getContext("2d");if(T(n))throw new Error("Could not create 2d context for canvas");n.drawImage(e,0,0)}function da(t,e){let n=t.getContext("2d");if(T(n))throw new Error("Could not create 2d context for canvas");n.putImageData(e,0,0)}function Uc(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var Jo=Go&&Uc(),$o=Jo&&Ko||ft&&on||null,ma=ft?on:$o;function jc(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var Hf=Go&&jc();function Ko(t,e){return new OffscreenCanvas(t,e)}function on(t,e){return zi(Hi(t),Vi(e))}function Gc(t){let e=Ko(t.width,t.height);return la(e,t),e}function zc(t){let e=on(t.width,t.height);return la(e,t),e}var ha=Jo&&Gc||ft&&zc||null;function qc(t){let e=Ko(t.width,t.height);return da(e,t),e}function Jc(t){let e=on(t.width,t.height);return da(e,t),e}var xa=Jo&&qc||ft&&Jc||null;function Fa(t,e,n,o=1){return e=Math.floor(e*o),n=Math.floor(n*o),t.width!=e||t.height!=n?(t.width=e,t.height=n,!0):!1}function $c(t){return x(t.textBaseline)}function Kc(t,e,n,o=1){let r=t.imageSmoothingEnabled,i=t.textBaseline,a=t.textAlign,s=t.font,c=Fa(t.canvas,e,n,o);return c&&(t.imageSmoothingEnabled=r,t.textBaseline=i,t.textAlign=a,t.font=s),c}function Yo(t,e,n,o=1){return $c(t)?Kc(t,e,n,o):Fa(t.canvas,e,n,o)}function Ue(t){Xc(t)?t.width=t.height=0:H(t)}function we(t,e){let n=globalThis,o=n[t];if(T(o)){if(T(e))throw new Error(`No value ${t} found`);o=e(),n[t]=o}return o}function Ee(t){return x(t)&&t.isMesh}function Qo(t){return x(t)&&t.isMaterial}function Yc(t,e){return Qo(e)&&e.type===t}function ga(t){return Yc("MeshBasicMaterial",t)}function wa(t){return x(t)&&t.isObject3D}function Qc(t){return x(t)&&wa(t.object)}function fe(t){return Qc(t)?t.object:t}function be(t,e){return t=fe(t),t.visible=e,e}function fa(t){return t=fe(t),t.visible}function rn(t){if(!t)return!1;for(t=fe(t);t;){if(!t.visible)return!1;t=t.parent}return!0}function v(t,...e){let n=e.filter(x).map(fe);return n.length>0&&fe(t).add(...n),t}function je(t,...e){let n=new Y;return n.name=t,v(n,...e),n}function _a(t,e,n){let o=new De(e,n);return o.name=t,o}var Sa=we("Juniper:ScaledItems",()=>new Map);function ka(t){let e=Sa.get(t);e&&(Sa.delete(t),H(e))}function de(t){let e=new Array,n=new Set;for(e.push(t);e.length>0;){let o=e.shift();o&&!n.has(o)&&(n.add(o),o.isMesh&&e.push(o.material,o.geometry),o.isMaterial&&e.push(...Object.values(o)),o.isObject3D&&(e.push(...o.children),o.clear(),ka(o)),at(o)&&e.push(...o),Ue(o))}n.clear()}var E;(function(t){t[t.LocalUser=0]="LocalUser",t[t.Mouse=1]="Mouse",t[t.Pen=2]="Pen",t[t.Touch=3]="Touch",t[t.Gamepad=4]="Gamepad",t[t.MotionController=5]="MotionController",t[t.MotionControllerLeft=6]="MotionControllerLeft",t[t.MotionControllerRight=7]="MotionControllerRight",t[t.Nose=8]="Nose",t[t.RemoteUser=9]="RemoteUser"})(E||(E={}));function Ta(t){switch(t){case E.Mouse:return"mouse";case E.Pen:return"pen";case E.Touch:return"touch";case E.Gamepad:return"gamepad";case E.MotionController:case E.MotionControllerLeft:case E.MotionControllerRight:return"hand";case E.Nose:return"nose";case E.RemoteUser:return"remote";default:return null}}function Aa(t){let e=t.attributes.position,n=t.attributes.normal,o=t.attributes.uv;for(let r=0;r<n.count;++r){let i=r*n.itemSize,a=r*n.itemSize+1,s=r*n.itemSize+2,c=n.array[i],p=n.array[a],u=n.array[s],l=Math.abs(c),h=Math.abs(p),F=Math.abs(u),w=e.array[i],f=e.array[a],W=e.array[s],Te=Math.abs(w),z=Math.abs(f),We=Math.abs(W),q=r*o.itemSize,Ve=r*o.itemSize+1,b=o.array[q],B=o.array[Ve],X=0,L=l,O=Te;h>L&&(X=1,L=h,O=z),F>L&&(X=2,L=F,O=We),X===0?w<0?(b=-W,B=f):(b=W,B=f):X===1?f<0?(b=w,B=-W):(b=w,B=W):W<0?(b=w,B=f):(b=-w,B=f),b=(b/O+1)/8,B=(B/O+1)/6,X===0?w<0?(b+=0,B+=1/3):(b+=.5,B+=1/3):X===1?f<0?(b+=.25,B+=0):(b+=.25,B+=2/3):W<0?(b+=.25,B+=1/3):(b+=.75,B+=1/3);let U=o.array;U[q]=b,U[Ve]=B}}var _t=new $i(1,1,1,1,1,1);_t.name="CubeGeom";_t.computeBoundingBox();_t.computeBoundingSphere();var va=_t.clone();va.name="InvertedCubeGeom";Aa(va);var Q=class extends De{constructor(e,n,o,r){super(_t,r),this.scale.set(e,n,o)}};gt.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new oa(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};Ft.line={uniforms:Uo.merge([gt.common,gt.fog,gt.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var me=class extends ta{constructor(e){super({type:"LineMaterial",uniforms:Uo.clone(Ft.line.uniforms),vertexShader:Ft.line.vertexShader,fragmentShader:Ft.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(n){this.uniforms.diffuse.value=n}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(n){n===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(n){this.uniforms.linewidth.value=n}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(n){!!n!="USE_DASH"in this.defines&&(this.needsUpdate=!0),n===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(n){this.uniforms.dashScale.value=n}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(n){this.uniforms.dashSize.value=n}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(n){this.uniforms.dashOffset.value=n}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(n){this.uniforms.gapSize.value=n}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(n){this.uniforms.opacity.value=n}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(n){this.uniforms.resolution.value.copy(n)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(n){!!n!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),n===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}};me.prototype.isLineMaterial=!0;var Zo=we("Juniper:Three:Materials",()=>new Map);function Zc(t,e){e in t&&delete t[e]}function an(t,e,n){let o=`${t}_${Object.keys(n).map(r=>`${r}:${n[r]}`).join(",")}`;return Zo.has(o)||(Zc(n,"name"),Zo.set(o,new e(n))),Zo.get(o)}function ep(t){return Object.assign(t,{transparent:!0})}function St(t){return an("solid",No,t)}function Da(t){return an("solidTransparent",No,ep(t))}function sn(t){return an("lit",Xo,t)}function Ma(t){return an("line2",me,t)}function Ea(t,e){let n=new Set;t.traverse(o=>{if(Ee(o)&&Qo(o.material)){let r=o.material,i=e(r);r!==i&&(n.add(r),o.material=i)}});for(let o of n)Ue(o)}function ba(t){if(t.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let e={alphaMap:t.alphaMap,alphaTest:t.alphaTest,alphaToCoverage:t.alphaToCoverage,aoMap:t.aoMap,aoMapIntensity:t.aoMapIntensity,blendDst:t.blendDst,blendDstAlpha:t.blendDstAlpha,blendEquation:t.blendEquation,blendEquationAlpha:t.blendEquationAlpha,blending:t.blending,blendSrc:t.blendSrc,blendSrcAlpha:t.blendSrcAlpha,bumpMap:t.bumpMap,bumpScale:t.bumpScale,clipIntersection:t.clipIntersection,clippingPlanes:t.clippingPlanes,clipShadows:t.clipShadows,color:t.color,colorWrite:t.colorWrite,depthFunc:t.depthFunc,depthTest:t.depthTest,depthWrite:t.depthWrite,displacementBias:t.displacementBias,displacementMap:t.displacementMap,displacementScale:t.displacementScale,dithering:t.dithering,emissive:t.emissive,emissiveIntensity:t.emissiveIntensity,emissiveMap:t.emissiveMap,envMap:t.envMap,flatShading:t.flatShading,fog:t.fog,lightMap:t.lightMap,lightMapIntensity:t.lightMapIntensity,map:t.map,name:t.name+"-Standard-To-Phong",normalMap:t.normalMap,normalMapType:t.normalMapType,normalScale:t.normalScale,opacity:t.opacity,polygonOffset:t.polygonOffset,polygonOffsetFactor:t.polygonOffsetFactor,polygonOffsetUnits:t.polygonOffsetUnits,precision:t.precision,premultipliedAlpha:t.premultipliedAlpha,shadowSide:t.shadowSide,side:t.side,stencilFail:t.stencilFail,stencilFunc:t.stencilFunc,stencilFuncMask:t.stencilFuncMask,stencilRef:t.stencilRef,stencilWrite:t.stencilWrite,stencilWriteMask:t.stencilWriteMask,stencilZFail:t.stencilZFail,stencilZPass:t.stencilZPass,toneMapped:t.toneMapped,transparent:t.transparent,userData:t.userData,vertexColors:t.vertexColors,visible:t.visible,wireframe:t.wireframe,wireframeLinecap:t.wireframeLinecap,wireframeLinejoin:t.wireframeLinejoin,wireframeLinewidth:t.wireframeLinewidth};for(let[n,o]of Object.entries(e))T(o)&&delete e[n];return new Xo(e)}var tp=255,er=65280;var np=16711680;var Ca=16776960,op=12632256;var ya=St({color:tp}),Ba=St({color:er});var La=St({color:np});var Ra=sn({color:op});var Ge=new g;function cn(t,e,n,o){Ge.crossVectors(e,t),t.crossVectors(Ge,e),Ge.normalize(),t.normalize(),e.normalize(),o.set(Ge.x,t.x,-e.x,n.x,Ge.y,t.y,-e.y,n.y,Ge.z,t.z,-e.z,n.z,0,0,0,1)}var ze=class{constructor(){this._visible=!0,this._style="default"}get style(){return this._style}set style(e){this._style=e}get visible(){return this._visible}set visible(e){this._visible=e}};var qe=class extends ze{get side(){return this._side}set side(e){this._side=e}get object(){return this._object}set object(e){this._object=e}constructor(e){super(),this.env=e,this._object=null,this.T=new g,this.V=new g,this.Q=new oe,this._side=-1,this.f=new g,this.up=new g,this.right=new g}get position(){return this.object.position}update(e,n,o,r,i,a,s,c,p,u,l){o&&o.face?(this.position.copy(o.point),o.object.getWorldQuaternion(this.Q),this.T.copy(o.face.normal).applyQuaternion(this.Q),this.V.copy(this.T).multiplyScalar(.02),this.position.add(this.V),this.V.copy(this.T).multiplyScalar(10).add(this.position)):(a?this.position.copy(u).multiplyScalar(2).add(p).sub(this.env.avatar.worldPos).normalize().multiplyScalar(i).add(this.env.avatar.worldPos):(this.V.copy(p).add(n).sub(e).multiplyScalar(2),this.position.copy(u).multiplyScalar(i).add(this.V).add(this.env.avatar.worldPos)),this.V.copy(this.env.avatar.worldPos)),this.lookAt(this.position,this.V),this.style=!r||r.navigable&&!c?s?l?"grabbing":"grab":"default":r.enabled?r.draggable?l?"grabbing":"move":r.navigable?"cell":r.clickable?"pointer":"default":"not-allowed"}lookAt(e,n){this.f.copy(n).sub(e).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat),this.right.crossVectors(this.up,this.f),this.up.crossVectors(this.f,this.right),cn(this.up,this.f,e,this.object.matrixWorld),this.object.matrix.copy(this.object.parent.matrixWorld).invert().multiply(this.object.matrixWorld),this.object.matrix.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.scale.x*=this.side,this.object.matrix.compose(this.object.position,this.object.quaternion,this.object.scale)}};var Je=class extends qe{constructor(e){super(e),this.material=St({name:"CursorMat",color:16776960}),this.object=new Q(.01,.01,.01,this.material)}get style(){return this._currentStyle}set style(e){if(this._currentStyle=e,Ee(this.object)&&!at(this.object.material))switch(this._currentStyle){case"pointer":this.material.color=new Fe(65280),this.material.needsUpdate=!0;break;case"not-allowed":this.material.color=new Fe(16711680),this.material.needsUpdate=!0;break;case"move":this.material.color=new Fe(255),this.material.needsUpdate=!0;break;case"grab":this.material.color=new Fe(16711935),this.material.needsUpdate=!0;break;case"grabbing":this.material.color=new Fe(65535),this.material.needsUpdate=!0;break;default:this._currentStyle="default",this.material.color=new Fe(16776960),this.material.needsUpdate=!0;break}}get visible(){return fa(this)}set visible(e){be(this,e)}};var Pa=new ht,pn=new g,Ce=class extends Yi{constructor(){super(),this.type="LineSegmentsGeometry";let e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],n=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],o=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(o),this.setAttribute("position",new Oo(e,3)),this.setAttribute("uv",new Oo(n,2))}applyMatrix4(e){let n=this.attributes.instanceStart,o=this.attributes.instanceEnd;return n!==void 0&&(n.applyMatrix4(e),o.applyMatrix4(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let n;e instanceof Float32Array?n=e:Array.isArray(e)&&(n=new Float32Array(e));let o=new xt(n,6,1);return this.setAttribute("instanceStart",new ge(o,3,0)),this.setAttribute("instanceEnd",new ge(o,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let n;e instanceof Float32Array?n=e:Array.isArray(e)&&(n=new Float32Array(e));let o=new xt(n,6,1);return this.setAttribute("instanceColorStart",new ge(o,3,0)),this.setAttribute("instanceColorEnd",new ge(o,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new ia(e.geometry)),this}fromLineSegments(e){let n=e.geometry;if(n.isGeometry){console.error("LineSegmentsGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else n.isBufferGeometry&&this.setPositions(n.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ht);let e=this.attributes.instanceStart,n=this.attributes.instanceEnd;e!==void 0&&n!==void 0&&(this.boundingBox.setFromBufferAttribute(e),Pa.setFromBufferAttribute(n),this.boundingBox.union(Pa))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Yt),this.boundingBox===null&&this.computeBoundingBox();let e=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(e!==void 0&&n!==void 0){let o=this.boundingSphere.center;this.boundingBox.getCenter(o);let r=0;for(let i=0,a=e.count;i<a;i++)pn.fromBufferAttribute(e,i),r=Math.max(r,o.distanceToSquared(pn)),pn.fromBufferAttribute(n,i),r=Math.max(r,o.distanceToSquared(pn));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}};Ce.prototype.isLineSegmentsGeometry=!0;var Wa=new g,Va=new g,V=new Me,I=new Me,re=new Me,tr=new g,nr=new te,Z=new Qi,Ia=new g,he=new ht,un=new Yt,ie=new Me;function Ha(t,e,n,o){return ie.set(0,0,-e,1).applyMatrix4(t.projectionMatrix),ie.multiplyScalar(1/ie.w),ie.x=n/o.width,ie.y=n/o.height,ie.applyMatrix4(t.projectionMatrixInverse),ie.multiplyScalar(1/ie.w),Math.abs(Math.max(ie.x,ie.y))}var kt=class extends De{constructor(e=new Ce,n=new me({color:Math.random()*16777215})){super(e,n),this.type="LineSegments2"}computeLineDistances(){let e=this.geometry,n=e.attributes.instanceStart,o=e.attributes.instanceEnd,r=new Float32Array(2*n.count);for(let a=0,s=0,c=n.count;a<c;a++,s+=2)Wa.fromBufferAttribute(n,a),Va.fromBufferAttribute(o,a),r[s]=s===0?0:r[s-1],r[s+1]=r[s]+Wa.distanceTo(Va);let i=new xt(r,2,1);return e.setAttribute("instanceDistanceStart",new ge(i,1,0)),e.setAttribute("instanceDistanceEnd",new ge(i,1,1)),this}raycast(e,n){e.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');let o=e.params.Line2!==void 0&&e.params.Line2.threshold||0,r=e.ray,i=e.camera,a=i.projectionMatrix,s=this.matrixWorld,c=this.geometry,p=this.material,u=p.resolution,l=p.linewidth+o,h=c.attributes.instanceStart,F=c.attributes.instanceEnd,w=-i.near;c.boundingSphere===null&&c.computeBoundingSphere(),un.copy(c.boundingSphere).applyMatrix4(s);let f=Math.max(i.near,un.distanceToPoint(r.origin)),W=Ha(i,f,l,u);if(un.radius+=W,e.ray.intersectsSphere(un)===!1)return;c.boundingBox===null&&c.computeBoundingBox(),he.copy(c.boundingBox).applyMatrix4(s);let Te=Math.max(i.near,he.distanceToPoint(r.origin)),z=Ha(i,Te,l,u);if(he.max.x+=z,he.max.y+=z,he.max.z+=z,he.min.x-=z,he.min.y-=z,he.min.z-=z,e.ray.intersectsBox(he)!==!1){r.at(1,re),re.w=1,re.applyMatrix4(i.matrixWorldInverse),re.applyMatrix4(a),re.multiplyScalar(1/re.w),re.x*=u.x/2,re.y*=u.y/2,re.z=0,tr.copy(re),nr.multiplyMatrices(i.matrixWorldInverse,s);for(let q=0,Ve=h.count;q<Ve;q++){V.fromBufferAttribute(h,q),I.fromBufferAttribute(F,q),V.w=1,I.w=1,V.applyMatrix4(nr),I.applyMatrix4(nr);var We=V.z>w&&I.z>w;if(We)continue;if(V.z>w){let O=V.z-I.z,U=(V.z-w)/O;V.lerp(I,U)}else if(I.z>w){let O=I.z-V.z,U=(I.z-w)/O;I.lerp(V,U)}V.applyMatrix4(a),I.applyMatrix4(a),V.multiplyScalar(1/V.w),I.multiplyScalar(1/I.w),V.x*=u.x/2,V.y*=u.y/2,I.x*=u.x/2,I.y*=u.y/2,Z.start.copy(V),Z.start.z=0,Z.end.copy(I),Z.end.z=0;let b=Z.closestPointToPointParameter(tr,!0);Z.at(b,Ia);let B=Zi.lerp(V.z,I.z,b),X=B>=-1&&B<=1,L=tr.distanceTo(Ia)<l*.5;if(X&&L){Z.start.fromBufferAttribute(h,q),Z.end.fromBufferAttribute(F,q),Z.start.applyMatrix4(s),Z.end.applyMatrix4(s);let O=new g,U=new g;r.distanceSqToSegment(Z.start,Z.end,U,O),n.push({point:U,pointOnLine:O,distance:r.origin.distanceTo(U),object:this,face:null,faceIndex:q,uv:null,uv2:null})}}}}};kt.prototype.isLineSegments2=!0;var ye=class extends Ce{constructor(){super(),this.type="LineGeometry"}setPositions(e){for(var n=e.length-3,o=new Float32Array(2*n),r=0;r<n;r+=3)o[2*r]=e[r],o[2*r+1]=e[r+1],o[2*r+2]=e[r+2],o[2*r+3]=e[r+3],o[2*r+4]=e[r+4],o[2*r+5]=e[r+5];return super.setPositions(o),this}setColors(e){for(var n=e.length-3,o=new Float32Array(2*n),r=0;r<n;r+=3)o[2*r]=e[r],o[2*r+1]=e[r+1],o[2*r+2]=e[r+2],o[2*r+3]=e[r+3],o[2*r+4]=e[r+4],o[2*r+5]=e[r+5];return super.setColors(o),this}fromLine(e){var n=e.geometry;if(n.isGeometry){console.error("LineGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else n.isBufferGeometry&&this.setPositions(n.attributes.position.array);return this}};ye.prototype.isLineGeometry=!0;var Tt=class extends kt{constructor(e=new ye,n=new me({color:Math.random()*16777215})){super(e,n),this.type="Line2"}};Tt.prototype.isLine2=!0;var Oa=new ye;Oa.setPositions([0,0,0,0,0,-1]);var ln=class extends Y{constructor(e,n,o){super(),this._length=1,this.line=new Tt(Oa,Ma({color:e,transparent:n<1,opacity:n,linewidth:o})),this.line.computeLineDistances(),v(this,this.line)}get length(){return this._length}set length(e){this._length=e,this.line.scale.set(1,1,e)}};var dn=class extends ze{constructor(e){super(),this.element=e,this._hidden=!1,this.visible=!0,this.style="default",document.addEventListener("pointerlockchange",()=>{this._hidden=!!document.pointerLockElement,this.refresh()})}get style(){return super.style}set style(e){super.style=e,this.refresh()}get visible(){return super.visible&&!this._hidden}set visible(e){super.visible=e,this.refresh()}refresh(){this.element.style.cursor=this.visible?this.style:"none"}};var mn=class extends qe{constructor(e){super(e),this.xr=e.cursor3D&&e.cursor3D.clone()||new Je(this.env),this.system=new dn(this.env.renderer.domElement),this.xr.side=this.side,this.visible=!1,Object.seal(this)}get object(){return this.xr.object}get side(){return this.xr.side}set side(e){this.xr.side=e}get cursor(){return this.xr}set cursor(e){this.xr=e,this._refresh()}get style(){return this.system.style}get visible(){return super.visible}set visible(e){super.visible=e,this._refresh()}set style(e){this.system.style=e,this.xr.style=e,this._refresh()}_refresh(){let e=this.env.eventSys&&this.env.eventSys.mouse&&this.env.eventSys.mouse.isPointerLocked,n=this.env.renderer.xr.isPresenting||e;be(this.xr,this.visible&&n),this.system.visible=this.visible&&!n}lookAt(e,n){this.xr.lookAt(e,n)}};var hn="Juniper:ThreeJS:EventSystem:RayTarget",or=class extends R{constructor(e){super(),this.object=e,this.meshes=new Array,this._disabled=!1,this._clickable=!1,this._draggable=!1,this._navigable=!1,this.object.userData[hn]=this}addMesh(e){return e.userData[hn]=this,this.meshes.push(e),this}removeMesh(e){return K(this.meshes,e)&&delete e.userData[hn],this}addMeshes(...e){for(let n of e)this.addMesh(n);return this}removeMeshes(...e){for(let n of e)this.removeMesh(n);return this}get disabled(){return this._disabled}set disabled(e){this._disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get clickable(){return this._clickable}set clickable(e){this._clickable=e}get draggable(){return this._draggable}set draggable(e){this._draggable=e}get navigable(){return this._navigable}set navigable(e){this._navigable=e}};function rp(t){return t instanceof or}function rr(t){let e=null;return t&&(rp(t)?e=t:(t=fe(t),t&&(e=t.userData[hn])),e&&!rn(e)&&(e=null)),e}var xn=class extends A{constructor(e,n){super(e),this.pointer=n,this._hit=null,this._point=null,this._distance=Number.POSITIVE_INFINITY,this._rayTarget=null,Object.seal(this)}set(e,n){e!==this.hit&&(this._hit=e,e?(this._point=e.point,this._distance=e.distance):(this._point=null,this._distance=Number.POSITIVE_INFINITY)),this._rayTarget=n}get hit(){return this._hit}get rayTarget(){return this._rayTarget}get point(){return this._point}get distance(){return this._distance}};var Be;(function(t){t[t.Primary=0]="Primary",t[t.Secondary=1]="Secondary",t[t.Menu=2]="Menu",t[t.Info=3]="Info"})(Be||(Be={}));var ip=5,ap=new g,Fn=class extends R{constructor(e,n,o,r){super(),this.type=e,this.id=n,this.env=o,this.origin=new g,this.direction=new g,this.up=new g(0,1,0),this.canMoveView=!1,this.mayTeleport=!1,this.buttons=0,this._isActive=!1,this.moveDistance=0,this.pointerEvents=new Map,this.lastButtons=0,this.canClick=!1,this.dragDistance=0,this._enabled=!1,this._cursor=null,this._curHit=null,this._curTarget=null,this._hoveredHit=null,this._hoveredTarget=null,this._cursor=r,this.cursor&&(this.cursor.visible=!1)}get isActive(){return this._isActive}get canSend(){return this.enabled&&this.isActive}get curHit(){return this._curHit}get curTarget(){return this._curTarget}get hoveredHit(){return this._hoveredHit}set hoveredHit(e){if(e!==this.hoveredHit){let n=rr(e);this._hoveredHit=e,this._hoveredTarget=n}}get name(){return E[this.id]}get rayTarget(){return this._hoveredTarget}get cursor(){return this._cursor}set cursor(e){if(e!==this.cursor){let n=this.cursor,o=this.cursor&&this.cursor.object&&this.cursor.object.name||"cursor",r=n&&n.object&&n.object.parent;r&&n.object.removeFromParent(),e&&(e.object.name=o,n instanceof mn?(n.cursor=e,r&&v(r,n)):(this._cursor=e,n&&(r&&v(r,e),e.style=n.style,e.visible=n.visible)))}}get needsUpdate(){return this.enabled&&this._isActive}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.cursor&&(this.cursor.visible=e)}setButton(e,n){this.lastButtons=this.buttons;let o=1<<e;if(n?this.buttons|=o:this.buttons&=~o,n)this.canClick=!0,this.dragDistance=0,this.env.avatar.setMode(this),this.setEventState("down");else{if(this.canClick){let r=this.buttons;this.buttons=this.lastButtons,this.setEventState("click"),this.buttons=r}this.setEventState("up")}}isPressed(e){let n=1<<e;return(this.buttons&n)!==0}wasPressed(e){let n=1<<e;return(this.lastButtons&n)!==0}fireRay(e,n){let o=this.env.eventSys.fireRay(e,n);if(o!==this.curHit){let r=rr(o);this._curHit=o,this._curTarget=r}}getEvent(e){this.pointerEvents.has(e)||this.pointerEvents.set(e,new xn(e,this));let n=this.pointerEvents.get(e);if(this.hoveredHit?n.set(this.hoveredHit,this.rayTarget):this.curHit?n.set(this.curHit,this.curTarget):n.set(null,null),n.hit){let o=this.curHit||this.hoveredHit;o&&n.hit!==o&&(n.hit.uv=o.uv)}return n}update(){this.needsUpdate&&this.onUpdate()}onUpdate(){this.updatePointerOrientation();let e=this.isPressed(Be.Primary);(this.moveDistance>0||e)&&(e&&(this.dragDistance+=this.moveDistance,this.dragDistance>ip&&(this.canClick=!1)),this.setEventState("move")),this.moveDistance=0}setEventState(e){if(this.fireRay(this.origin,this.direction),this.curTarget===this.rayTarget)this.hoveredHit=this.curHit;else{let o=this.isPressed(Be.Primary),r=this.wasPressed(Be.Primary);if(e==="move"&&!o||e==="down"&&o&&!r||e==="up"&&!o&&r){if(this.rayTarget){let c=this.getEvent("up");this.rayTarget.dispatchEvent(c);let p=this.getEvent("exit");this.dispatchEvent(p),this.rayTarget.dispatchEvent(p)}if(this.hoveredHit=this.curHit,this.rayTarget){let c=this.getEvent("enter");this.dispatchEvent(c),this.rayTarget.dispatchEvent(c)}}this.hoveredHit&&this.hoveredHit.point.copy(this.direction).multiplyScalar(this.hoveredHit.distance).add(this.origin)}let n=this.getEvent(e);this.dispatchEvent(n),n.rayTarget&&(e!=="click"||n.rayTarget.clickable||n.rayTarget.navigable)&&(e==="click"&&n.rayTarget.clickable&&this.vibrate(),n.rayTarget.enabled&&n.rayTarget.dispatchEvent(n)),this.updateCursor(this.env.avatar.worldPos,ap,!0,2)}get canDragView(){return this.canMoveView}get canTeleport(){return this.mayTeleport}updateCursor(e,n,o,r){this.cursor&&this.cursor.update(e,n,this.hoveredHit||this.curHit,this.rayTarget||this.curTarget,r,o,this.canDragView,this.canTeleport,this.origin,this.direction,this.isPressed(Be.Primary))}get bufferSize(){return 37}writeState(e){e.writeUint8(this.id),e.writeVector48(this.origin),e.writeVector48(this.direction),e.writeVector48(this.up)}};var Xa=.2,sp=.5*Xa-.025,Na=.05,gn=class extends Fn{constructor(e,n,o){let r=n.cursor3D&&n.cursor3D.clone()||new Je(n);super("remote",E.RemoteUser,n,r),this.avatar=e,this.remoteID=o,this.laser=null,this.D=new g,this.P=new g,this.visualOffset=new g,this.M=new te,this.MW=new te,this.originTarget=new g,this.directionTarget=new g,this.upTarget=new g,this.visualOffsetTarget=new g,this._hand=null,this.killTimeout=null,this.remoteType=Ta(this.remoteID),this.object=je(`remote:${this.avatar.userName}:${this.name}`,this.laser=new ln(this.avatar.isInstructor?er:Ca,this.avatar.isInstructor?1:.5,.002),this.handCube=new Q(Na,Na,Xa,Ra)),this.cursor.object.name=`${this.object.name}:cursor`,this.cursor.visible=!0,this.handCube.position.set(0,0,-sp),this.laser.length=30,Object.seal(this)}get hand(){return this._hand}set hand(e){e!==this.hand&&(this.hand&&(this.hand.removeFromParent(),de(this.hand)),this._hand=e,this.hand?(this.handCube.removeFromParent(),v(this.avatar.stage,this.hand)):v(this.avatar.stage,this.handCube))}readState(e){if(e.readVector48(this.originTarget),e.readVector48(this.directionTarget),e.readVector48(this.upTarget),this.remoteID===E.Mouse||this.remoteID===E.Touch?this.visualOffsetTarget.set(.25,-.55,.05).applyQuaternion(this.avatar.bodyQuaternion):this.visualOffsetTarget.setScalar(0),this.visualOffsetTarget.add(this.avatar.comfortOffset),E.MotionController<=this.remoteID&&this.remoteID<=E.MotionControllerRight){let n=e.readEnum8(Ua),o=e.readUint8();if(o===0)this.hand&&(this.hand=null);else{this.hand||(this.hand=this.env.handModelFactory.createHandModel(n)),this.hand.count=o;for(let r=0;r<o;++r)e.readMatrix512(this.M),this.hand.setMatrixAt(r,this.M);this.hand.updateMesh(),this.deferExecution(1,()=>this.hand=null)}}}deferExecution(e,n){this.killTimeout!==null&&(clearTimeout(this.killTimeout),this.killTimeout=null),this.killTimeout=setTimeout(()=>{this.killTimeout=null,n()},e*1e3)}writeState(e){}onUpdate(){}animate(e){let n=e*.01;this.origin.lerp(this.originTarget,n),this.direction.lerp(this.directionTarget,n).normalize(),this.up.lerp(this.upTarget,n).normalize(),this.visualOffset.lerp(this.visualOffsetTarget,n),this.cursor.visible=this.env.avatar.worldPos.distanceTo(this.origin)<10,this.cursor.visible&&(this.fireRay(this.origin,this.direction),this.updateCursor(this.avatar.worldPos,this.avatar.comfortOffset,!1,4)),this.P.copy(this.origin).add(this.visualOffset),this.cursor.visible?(this.cursor.object.getWorldPosition(this.D).sub(this.P),this.laser.length=this.D.length()-.1,this.D.normalize()):(this.D.copy(this.direction),this.laser.length=10),cn(this.up,this.D,this.P,this.MW),this.M.copy(this.object.parent.matrixWorld).invert().multiply(this.MW).decompose(this.object.position,this.object.quaternion,this.object.scale)}updatePointerOrientation(){}vibrate(){}};function wn(t){return t instanceof HTMLVideoElement?t.videoWidth:t instanceof VideoFrame?t.displayWidth:t.width}function fn(t){return t instanceof HTMLVideoElement?t.videoHeight:t instanceof VideoFrame?t.displayHeight:t.height}var ja=304.79999999999995,H1=ja*3,cp=10*100,pp=ja*16.5,up=pp*40,O1=cp*1e3,N1=up*8,Ga=2.54*4,za=Ga*3,X1=za*3,lp=za*16.5,dp=lp*40,U1=100*1e3,j1=dp*8,ir=4*3,mp=ir*3,At=100/2.54,hp=ir*16.5,xp=hp*40,G1=At*1e3,z1=xp*8,q1=3*3,Fp=100/Ga,gp=3*16.5,wp=gp*40,J1=Fp*1e3,$1=wp*8,qa=At/ir,fp=16.5*40,K1=qa*1e3,Y1=fp*8,_p=At/mp,Sp=16.5/3,kp=Sp*40,Q1=_p*1e3,Z1=kp*8,Ja=16.5/qa,$a=Ja*40,eS=$a*8,tS=1e3/Ja,nS=40*8,Tp=1e3/$a,oS=8/Tp;function Ka(t){return t/At}function Ya(t){return t*At}var ar=new ea(1,1,1,1);ar.name="PlaneGeom";var Ap=new te,_n=new g,Qa=new Me,Za=new oe;function sr(t,e,n){return Ap.copy(t.matrixWorld).invert().multiply(e.matrixWorld).decompose(_n,Za,n),Qa.set(_n.x,_n.y,_n.z,1),new XRRigidTransform(Qa,Za)}var $e=new g,vp=0,Ke=class extends Y{constructor(e,n,o,r=null){if(super(),this.webXRLayerType=o,this.lastMatrixWorld=new te,this._imageWidth=0,this._imageHeight=0,this.forceUpdate=!1,this.wasUsingLayer=!1,this.layer=null,this.curImage=null,this.lastImage=null,this.lastWidth=null,this.lastHeight=null,this.env=null,this.mesh=null,this.stereoLayoutName="mono",this.sizeMode="none",e){this.setEnvAndName(e,n);let i=ga(r)?r:Da(Object.assign({},r,{name:this.name}));v(this,this.mesh=_a(n+"-Mesh",ar,i))}}copy(e,n=!0){return super.copy(e,n),this.webXRLayerType=e.webXRLayerType,this.setImageSize(e.imageWidth,e.imageHeight),this.setEnvAndName(e.env,e.name+ ++vp),this.mesh=Vt(this.children,Ee),T(this.mesh)&&(this.mesh=e.mesh.clone(),v(this,this.mesh)),this.setTextureMap(e.curImage),this}dispose(){this.env.removeScope(this),this.disposeImage(),de(this.mesh)}disposeImage(){this.removeWebXRLayer(),de(this.mesh.material.map),this.curImage=null}setImageSize(e,n){if(e!==this.imageWidth||n!==this.imageHeight){let{objectWidth:o,objectHeight:r}=this;this._imageWidth=e,this._imageHeight=n,this.sizeMode!=="none"&&(this.sizeMode==="fixed-width"?this.objectWidth=o:this.objectHeight=r)}}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get imageAspectRatio(){return this.imageWidth/this.imageHeight}get objectWidth(){return this.scale.x}set objectWidth(e){this.scale.set(e,this.scale.y=e/this.imageAspectRatio,1)}get objectHeight(){return this.scale.y}set objectHeight(e){this.scale.set(this.imageAspectRatio*e,e,1)}get pixelDensity(){let e=Ya(this.objectWidth);return this.imageWidth/e}set pixelDensity(e){let n=this.imageWidth/e,o=Ka(n);this.objectWidth=o}setEnvAndName(e,n){this.env=e,this.name=n,this.env.addScopedEventListener(this,"update",o=>this.checkWebXRLayer(o.frame))}get needsLayer(){return!rn(this)||T(this.mesh.material.map)||T(this.curImage)?!1:this.curImage instanceof HTMLVideoElement?!this.curImage.paused||this.curImage.currentTime>0:!0}removeWebXRLayer(){if(x(this.layer)){this.wasUsingLayer=!1,this.env.removeWebXRLayer(this.layer),this.mesh.visible=!0;let e=this.layer;this.layer=null,setTimeout(()=>Ue(e),100)}}setTextureMap(e){this.curImage&&this.disposeImage(),e&&(pa(e)?e=ha(e):ua(e)&&(e=xa(e)),qo(e)&&(e=e),this.curImage=e,this.setImageSize(wn(e),fn(e)),e instanceof HTMLVideoElement?this.mesh.material.map=new ra(e):(this.mesh.material.map=new na(e),this.mesh.material.map.needsUpdate=!0)),this.mesh.material.needsUpdate=!0}get isVideo(){return this.curImage instanceof HTMLVideoElement}updateTexture(){if(x(this.curImage)){let e=wn(this.curImage),n=fn(this.curImage);if(this.imageWidth!==e||this.imageHeight!==n){let o=this.curImage;this.disposeImage(),this.setTextureMap(o)}else this.mesh.material.map.needsUpdate=this.forceUpdate=!0}}checkWebXRLayer(e){if(this.mesh.material.map&&this.curImage){let o=this.webXRLayerType!=="none"&&this.env.hasXRCompositionLayers&&this.env.showWebXRLayers&&x(e)&&(this.isVideo&&x(this.env.xrMediaBinding)||!this.isVideo&&x(this.env.xrBinding))&&this.needsLayer,r=o!==this.wasUsingLayer,i=this.curImage!==this.lastImage||this.mesh.material.needsUpdate||this.mesh.material.map.needsUpdate||this.forceUpdate,a=this.imageWidth!==this.lastWidth||this.imageHeight!==this.lastHeight;if(this.wasUsingLayer=o,this.lastImage=this.curImage,this.lastWidth=this.imageWidth,this.lastHeight=this.imageHeight,(r||a)&&((!o||a)&&this.layer&&this.removeWebXRLayer(),o)){let s=this.env.referenceSpace,c=sr(this.env.stage,this.mesh,$e);this.lastMatrixWorld.copy(this.matrixWorld);let p=$e.x/2,u=$e.y/2,l=this.stereoLayoutName==="mono"?"mono":this.stereoLayoutName==="left-right"||this.stereoLayoutName==="right-left"?"stereo-left-right":"stereo-top-bottom";if(this.isVideo){let h=this.stereoLayoutName==="right-left"||this.stereoLayoutName==="bottom-top";this.layer=this.env.xrMediaBinding.createQuadLayer(this.curImage,{space:s,layout:l,invertStereo:h,transform:c,width:p,height:u})}else this.layer=this.env.xrBinding.createQuadLayer({space:s,layout:l,textureType:"texture",isStatic:this.webXRLayerType==="static",viewPixelWidth:wn(this.curImage),viewPixelHeight:fn(this.curImage),transform:c,width:p,height:u});this.env.addWebXRLayer(this.layer,500),this.mesh.visible=!1}if(this.layer){if(i||this.layer.needsRedraw){let s=this.env.gl,c=this.env.xrBinding.getSubImage(this.layer,e);s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.bindTexture(s.TEXTURE_2D,c.colorTexture),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.curImage),s.generateMipmap(s.TEXTURE_2D),s.bindTexture(s.TEXTURE_2D,null),this.forceUpdate=!1}pi(this.matrixWorld.elements,this.lastMatrixWorld.elements)>=0&&(this.layer.transform=sr(this.env.stage,this.mesh,$e),this.lastMatrixWorld.copy(this.matrixWorld),this.layer.width=$e.x/2,this.layer.height=$e.y/2)}else this.forceUpdate=!1}}};var vS=we("juniper::loadedFonts",()=>[]);function es(t){let e=[];return t.fontStyle&&t.fontStyle!=="normal"&&e.push(t.fontStyle),t.fontVariant&&t.fontVariant!=="normal"&&e.push(t.fontVariant),t.fontWeight&&t.fontWeight!=="normal"&&e.push(t.fontWeight),e.push(Oi(t.fontSize)),e.push(t.fontFamily),e.join(" ")}var Sn=class extends R{constructor(e,n,o){super(),this._scale=250,this._visible=!0,this.wasVisible=null,this.redrawnEvt=new A("redrawn"),x(o)&&x(o.scale)&&(this._scale=o.scale),this._canvas=ma(e,n),this._g=this.canvas.getContext("2d")}fillRect(e,n,o,r,i,a){this.g.fillStyle=e,this.g.fillRect(n+a,o+a,r-2*a,i-2*a)}drawText(e,n,o,r){this.g.textAlign=r,this.g.strokeText(e,n,o),this.g.fillText(e,n,o)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}onClear(){this.g.clearRect(0,0,this.canvas.width,this.canvas.height)}clear(){this.onClear(),this.dispatchEvent(this.redrawnEvt)}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(e){this.scale!==e&&(this._scale=e,this.redraw())}get visible(){return this._visible}set visible(e){this.visible!==e&&(this.wasVisible=this._visible,this._visible=e,this.redraw())}};var vt=class extends Sn{constructor(e){super(10,10,e),this.trueWidth=null,this.trueHeight=null,this.trueFontSize=null,this.dx=null,this._minWidth=null,this._maxWidth=null,this._minHeight=null,this._maxHeight=null,this._freezeDimensions=!1,this._dimensionsFrozen=!1,this._bgFillColor=null,this._bgStrokeColor=null,this._bgStrokeSize=null,this._textStrokeColor=null,this._textStrokeSize=null,this._textFillColor="black",this._textDirection="horizontal",this._fontStyle="normal",this._fontVariant="normal",this._fontWeight="normal",this._fontFamily="sans-serif",this._fontSize=20,this._value=null,this.lastValue=null,x(e)&&(x(e.minWidth)&&(this._minWidth=e.minWidth),x(e.maxWidth)&&(this._maxWidth=e.maxWidth),x(e.minHeight)&&(this._minHeight=e.minHeight),x(e.maxHeight)&&(this._maxHeight=e.maxHeight),x(e.freezeDimensions)&&(this._freezeDimensions=e.freezeDimensions),x(e.textStrokeColor)&&(this._textStrokeColor=e.textStrokeColor),x(e.textStrokeSize)&&(this._textStrokeSize=e.textStrokeSize),x(e.bgFillColor)&&(this._bgFillColor=e.bgFillColor),x(e.bgStrokeColor)&&(this._bgStrokeColor=e.bgStrokeColor),x(e.bgStrokeSize)&&(this._bgStrokeSize=e.bgStrokeSize),x(e.value)&&(this._value=e.value),x(e.textFillColor)&&(this._textFillColor=e.textFillColor),x(e.textDirection)&&(this._textDirection=e.textDirection),x(e.fontStyle)&&(this._fontStyle=e.fontStyle),x(e.fontVariant)&&(this._fontVariant=e.fontVariant),x(e.fontWeight)&&(this._fontWeight=e.fontWeight),x(e.fontFamily)&&(this._fontFamily=e.fontFamily),x(e.fontSize)&&(this._fontSize=e.fontSize),x(e.padding)&&($(e.padding)?this._padding={left:e.padding,right:e.padding,top:e.padding,bottom:e.padding}:this._padding=e.padding)),T(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(e){this.minWidth!==e&&(this._minWidth=e,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(e){this.maxWidth!==e&&(this._maxWidth=e,this.redraw())}get minHeight(){return this._minHeight}set minHeight(e){this.minHeight!==e&&(this._minHeight=e,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(e){this.maxHeight!==e&&(this._maxHeight=e,this.redraw())}get padding(){return this._padding}set padding(e){if(e instanceof Array)throw new Error("Invalid padding");(this.padding.top!==e.top||this.padding.right!=e.right||this.padding.bottom!=e.bottom||this.padding.left!=e.left)&&(this._padding=e,this.redraw())}get textDirection(){return this._textDirection}set textDirection(e){this.textDirection!==e&&(this._textDirection=e,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(e){this.fontStyle!==e&&(this._fontStyle=e,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(e){this.fontVariant!==e&&(this._fontVariant=e,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(e){this.fontWeight!==e&&(this._fontWeight=e,this.redraw())}get fontSize(){return this._fontSize}set fontSize(e){this.fontSize!==e&&(this._fontSize=e,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(e){this.textFillColor!==e&&(this._textFillColor=e,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(e){this.textStrokeColor!==e&&(this._textStrokeColor=e,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(e){this.textStrokeSize!==e&&(this._textStrokeSize=e,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(e){this.bgFillColor!==e&&(this._bgFillColor=e,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(e){this.bgStrokeColor!==e&&(this._bgStrokeColor=e,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(e){this.bgStrokeSize!==e&&(this._bgStrokeSize=e,this.redraw())}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.redraw())}split(e){return e.replace(/\r\n/g,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.onClear(),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value&&this.value!==this.lastValue){let e=this.split(this.value),n=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let r=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,i=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,a=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,s=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,c=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,p=n?s:i,u=n?c:a,l=n?i:s,h=n?a:c,F=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let w=!1,f=!1,W=1e4,Te=0;this.trueFontSize=Mi(this.fontSize*this.scale,Te,W);let z=null,We=Number.MAX_VALUE;do{let b=this.fontSize;this._fontSize=this.trueFontSize;let B=es(this);this._fontSize=b,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=B,this.trueWidth=0,this.trueHeight=0;for(let X of e){let L=this.g.measureText(X);this.trueWidth=Math.max(this.trueWidth,L.width),this.trueHeight+=this.trueFontSize,$(L.actualBoundingBoxLeft)&&$(L.actualBoundingBoxRight)&&$(L.actualBoundingBoxAscent)&&$(L.actualBoundingBoxDescent)&&(r||(this.trueWidth=L.actualBoundingBoxLeft+L.actualBoundingBoxRight,this.trueHeight=L.actualBoundingBoxAscent+L.actualBoundingBoxDescent,this.dx=(L.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(r){let X=this.trueWidth-p,L=this.trueWidth-u,O=this.trueHeight-l,U=this.trueHeight-h,As=Math.abs(X),vs=Math.abs(L),Ds=Math.abs(O),Ms=Math.abs(U);w=L>1||U>1,f=X<-1&&O<-1;let ri=Math.min(As,Math.min(vs,Math.min(Ds,Ms)));ri<We&&(We=ri,z=this.g.font),(w||f)&&F.indexOf(this.g.font)>-1&&z&&(this.g.font=z,w=!1,f=!1),w?(W=this.trueFontSize,this.trueFontSize=(Te+this.trueFontSize)/2):f&&(Te=this.trueFontSize,this.trueFontSize=(this.trueFontSize+W)/2)}F.push(this.g.font)}while(w||f);r&&(this.trueWidth<p?this.trueWidth=p:this.trueWidth>u&&(this.trueWidth=u),this.trueHeight<l?this.trueHeight=l:this.trueHeight>h&&(this.trueHeight=h));let q=this.trueWidth+this.scale*(this.padding.right+this.padding.left),Ve=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{Yo(this.g,q,Ve)}catch(b){throw console.error(b),b}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let o=.5*(e.length-1);for(let r=0;r<e.length;++r){let i=e[r],a=(r-o)*this.trueFontSize,s=this.dx+this.trueWidth/2+this.scale*this.padding.left,c=a+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(i,s,c),this.textFillColor&&this.g.fillText(i,s,c)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let r=this.bgStrokeSize/2;this.g.strokeRect(r,r,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(n){let r=$o(this.canvas.height,this.canvas.width),i=r.getContext("2d");i?(i.translate(r.width/2,r.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?i.rotate(dt):this.textDirection==="vertical-right"&&i.rotate(-dt),i.translate(-this.canvas.width/2,-this.canvas.height/2),i.drawImage(this.canvas,0,0),Yo(this.g,r.width,r.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(r,0,0)}return this.lastValue=this.value,!0}else{let e=this.value!==this.lastValue;return this.lastValue=this.value,e}}};var Dp={type:"redrawn"},kn=class extends Ke{get object(){return this}get element(){return zo(this.image.canvas)?this.image.canvas:null}get canvas(){return this._image.canvas}constructor(e,n,o,r,i){super(e,n,o,i),this._image=null,this.image=r}onRedrawn(){this.updateTexture(),this.dispatchEvent(Dp)}get image(){return this._image}set image(e){this.image&&this.image.removeScope(this),this._image=e,this.image&&(this.image.addScopedEventListener(this,"redrawn",()=>this.onRedrawn()),this.setTextureMap(this.image.canvas),this.onRedrawn())}get imageWidth(){return this.image.width}get imageHeight(){return this.image.height}copy(e,n=!0){return super.copy(e,n),this.image=e.image,this}get isVisible(){return ji(this)}set isVisible(e){Ui(this,e,"inline-block"),be(this,e),be(this.mesh,e),this.image.visible=e}};var Dt=class extends kn{constructor(e,n,o,r,i){let a;r instanceof vt?a=r:a=new vt(r),super(e,n,o,a,i)}onRedrawn(){this.objectHeight=this.imageHeight,super.onRedrawn()}};var ts={fontFamily:Ni(),fontSize:20,fontWeight:"bold",textFillColor:"white",textStrokeColor:"black",textStrokeSize:.01,padding:{top:.025,right:.05,bottom:.025,left:.05},maxHeight:.2},Tn=class{get object(){return this.avatar}get bodyQuaternion(){return this.headFollower.quaternion}constructor(e,n,o,r,i,a){if(this.env=e,this.avatar=r,this.defaultAvatarHeight=i,this._isInstructor=!1,this.pointers=new Map,this.stage=new Y,this.stagePositionTarget=new g,this.stageOrientationTarget=new oe().identity(),this.headPositionTarget=new g,this.headOrientationTarget=new oe().identity(),this.worldPos=new g,this.worldQuat=new oe,this.F=new g,this.M=new te,this._headSize=1,this._headPulse=1,this.comfortOffset=new g,this.videoElement=null,this.videoMesh=null,this._videoStream=null,this.clearChatTimer=null,this.height=this.defaultAvatarHeight,T(r))throw new Error("Avatar is required");this.avatar=r;let s=[this.avatar];for(;s.length>0;){let p=s.shift();if(p.name==="Head"?this.head=p:p.name==="Body"&&(this.body=p),this.head&&this.body)break;s.push(...p.children)}if(!this.head||!this.body)throw new Error("Avatar doesn't have a Head or Body element");this.userID=n.userID,this.avatar.name=n.userName,this.billboard=je("billboard"),this.nameTag=new Dt(this.env,`nameTag-${n.userName}-${n.userID}`,"none",Object.assign({},ts,a)),this.nameTag.position.y=-.25,this.userName=n.userName,this.chatBox=new Dt(this.env,`chat-${n.userName}-${n.userID}`,"none",Object.assign({},ts,a)),this.chatBox.position.y=-.4,n.addEventListener("chat",p=>this.chatText=p.text);let c=new Ne;n.addEventListener("userState",p=>{c.buffer=p.buffer,this.readState(c)}),n.addEventListener("chat",p=>{this.chatText=p.text}),this.activity=new Oe(this.env.audio.context),this.activity.name=`remote-user-activity-${n.userName}-${n.userID}`,o.addEventListener("sourceadded",p=>{p.source.connect(this.activity),p.source.name=`remote-user-stream-${n.userName}-${n.userID}`}),this.headFollower=new nn("AvatarBody",.05,dt,0,5),v(this.avatar,this.stage,v(this.headFollower,v(this.body,v(this.billboard,this.nameTag,this.chatBox)))),this.activity.addEventListener("activity",p=>{this.headPulse=.2*p.level+1}),this.activity.start()}get audioStream(){let e=this.env.audio.getUser(this.userID);return e&&e.stream||null}set audioStream(e){this.env.audio.setUserStream(this.userID,e)}get videoStream(){return this._videoStream}set videoStream(e){e!==this.videoStream&&(this.videoMesh&&(this.videoMesh.removeFromParent(),de(this.videoMesh),this.videoMesh=null),this.videoElement&&(this.videoElement.pause(),this.videoElement=null),this._videoStream=e,this.videoStream&&(this.videoElement=qi(Ii(this.videoStream),Wi(!0)),this.videoElement.play(),this.videoMesh=new Ke(this.env,`webcam-${this.userID}`,"none",{side:Ki}),this.videoMesh.sizeMode="fixed-height",this.videoMesh.scale.setScalar(.25),this.videoMesh.position.z=.25,this.videoMesh.setTextureMap(this.videoElement)))}dispose(){for(let e of this.pointers.keys())this.removePointer(e);this.activity.stop(),H(this.activity)}get isInstructor(){return this._isInstructor}get headSize(){return this._headSize}set headSize(e){this._headSize=e,this.refreshHead()}get headPulse(){return this._headPulse}set headPulse(e){this._headPulse=e,this.refreshHead()}refreshHead(){this.head&&this.head.scale.setScalar(this.headSize*this.headPulse)}get userName(){return this.nameTag.image.value}set userName(e){if(e){let n=e.match(/^(?:((?:student|instructor))_)?([^<>{}"]+)$/i);n&&(n.length===2?this.nameTag.image.value=n[1]:n.length===3?(this._isInstructor=n[1]&&n[1].toLocaleLowerCase()==="instructor",this.isInstructor?this.nameTag.image.value=Ji.value+n[2]:this.nameTag.image.value=n[2]):this.nameTag.image.value="???")}}get chatText(){return this.chatBox.image.value}set chatText(e){this.chatBox.image.value=e||"",this.clearChatTimer!==null&&(clearTimeout(this.clearChatTimer),this.clearChatTimer=null),e&&e.length>0&&(this.clearChatTimer=setTimeout(()=>{this.chatText=null},3e3))}refreshCursors(){for(let e of this.pointers.values())e.cursor&&(e.cursor=this.env.cursor3D.clone())}update(e){let n=e*.01;this.stage.position.lerp(this.stagePositionTarget,n),this.stage.quaternion.slerp(this.stageOrientationTarget,n),this.head.position.lerp(this.headPositionTarget,n),this.head.quaternion.slerp(this.headOrientationTarget,n),this.head.getWorldPosition(this.worldPos),this.head.getWorldQuaternion(this.worldQuat),this.F.fromArray(vi).applyQuaternion(this.worldQuat);let o=Zt(this.F);this.env.audio.setUserPose(this.userID,this.worldPos.x,this.worldPos.y,this.worldPos.z,this.worldQuat.x,this.worldQuat.y,this.worldQuat.z,this.worldQuat.w),this.headFollower.update(this.worldPos.y-this.avatar.parent.position.y,this.worldPos,o,e);let r=this.height/this.defaultAvatarHeight;this.headSize=r,this.body.scale.setScalar(r),this.F.copy(this.env.avatar.worldPos),this.body.worldToLocal(this.F),this.F.sub(this.body.position).normalize().multiplyScalar(.25),this.billboard.position.copy(this.F);for(let i of this.pointers.values())i.animate(e);this.billboard.lookAt(this.env.avatar.worldPos),this.videoMesh&&(this.videoStream&&!this.videoStream.active&&this.videoMesh.parent&&(this.videoStream=null),this.videoStream&&this.videoStream.active&&this.videoElement.videoWidth>0&&!this.videoMesh.parent&&this.billboard.add(this.videoMesh),this.videoMesh&&this.videoMesh.updateTexture())}assurePointer(e){let n=this.pointers.get(e);return n||(n=new gn(this,this.env,e),this.pointers.set(e,n),v(this.body,n),n.cursor&&v(this.env.stage,n.cursor),e===E.MotionControllerLeft||e===E.MotionControllerRight?this.removePointersExcept(E.MotionControllerLeft,E.MotionControllerRight):this.removePointersExcept(e)),n.deferExecution(3,()=>this.removePointer(e)),n}removePointersExcept(...e){for(let n of this.pointers.keys())e.indexOf(n)===-1&&this.removePointer(n)}removePointer(e){let n=this.pointers.get(e);n&&(n.object.removeFromParent(),this.pointers.delete(e),n.cursor&&n.cursor.object.removeFromParent())}readState(e){e.position=0,this.height=e.readFloat32(),e.readMatrix512(this.M),this.M.decompose(this.stagePositionTarget,this.stageOrientationTarget,this.stage.scale),this.stagePositionTarget.add(this.comfortOffset),e.readMatrix512(this.M),this.M.decompose(this.headPositionTarget,this.headOrientationTarget,this.avatar.scale),this.headPositionTarget.add(this.comfortOffset);let n=e.readUint8();for(let o=0;o<n;++o){let r=e.readUint8();this.assurePointer(r).readState(e)}}};var An=class extends Y{constructor(e){super(),this.color=e,this.center=null,x(this.color)&&(this.center=new Q(.5,.5,.5,sn({color:this.color})),v(this,this.center)),this.xp=new Q(1,.1,.1,La),this.yp=new Q(.1,1,.1,Ba),this.zn=new Q(.1,.1,1,ya),this.xp.position.x=1,this.yp.position.y=1,this.zn.position.z=-1,v(this,this.xp,this.yp,this.zn)}copy(e,n=!0){return super.copy(e,n),this.color=e.color,this.center=new Q(.5,.5,.5,sn({color:e.color})),this}get size(){return this.xp.scale.x}set size(e){x(this.center)&&this.center.scale.setScalar(e),this.xp.scale.setScalar(.1*e),this.yp.scale.setScalar(.1*e),this.zn.scale.setScalar(.1*e),this.xp.scale.x=this.yp.scale.y=this.zn.scale.z=e,this.xp.position.x=this.yp.position.y=e,this.zn.position.z=-e}};var Ye=class extends A{constructor(e,n){super(e),this.app=n}},cr=class extends Ye{constructor(e,n){super("joinroom",e),this.roomName=n}},pr=class extends Ye{constructor(e){super("quit",e)}},ur=class extends Ye{constructor(e){super("shown",e)}},lr=class extends Ye{constructor(e){super("hidden",e)}},vn=class extends R{constructor(e){super(),this.env=e,this.dataLogger=null}quit(){this.dispatchEvent(new pr(this))}join(e){this.dispatchEvent(new cr(this,e)),this.env.avatar.reset()}async show(e){await this.showing(e),this.dispatchEvent(new ur(this))}hide(){this.hiding(),this.dispatchEvent(new lr(this))}init(e){return this.dataLogger=e.get("dataLogger"),Promise.resolve()}log(e,n){x(this.dataLogger)&&this.dataLogger.log(e,n)}error(e,n,o){x(this.dataLogger)&&this.dataLogger.error(e,n,o)}onError(e,n){return this.error.bind(this,e,n)}};var Ua=["none","right","left"],ns=ci(Lo),Dn=class extends vn{constructor(e){super(e),this.sortedUserIDs=new Array,this.avatars=new Map,this.remoteUsers=je("RemoteUsers"),this.conference=null,this.avatarModel=null,this.avatarNameTagFont=null,this.userType=null,this.userName=null,this.meetingID=null,this.roomName=null,this._offsetRadius=0,this.doorOpenSound=new pt("/audio/door_open.mp3",yo,!this.env.DEBUG),this.doorCloseSound=new pt("/audio/door_close.mp3",yo,!this.env.DEBUG),this.avatarModelAsset=new Nt(this.env,"/models/Avatar.glb",It,!this.env.DEBUG),this.assets=[this.doorOpenSound,this.doorCloseSound,this.avatarModelAsset],this.env.addScopedEventListener(this,"update",n=>{for(let o of this.avatars.values())o.update(n.dt)})}async init(e){if(this.avatarNameTagFont=e.get("nameTagFont"),!this.avatarNameTagFont)throw new Error("Missing nameTagFont parameter");this.env.addScopedEventListener(this,"newcursorloaded",()=>{for(let a of this.avatars.values())a.refreshCursors()}),this.env.addScopedEventListener(this,"roomjoined",a=>{this.join(a.roomName)}),this.env.addScopedEventListener(this,"sceneclearing",()=>this.hiding()),this.env.addScopedEventListener(this,"scenecleared",()=>v(this.env.foreground,this.remoteUsers)),this.env.muteMicButton.visible=!0,this.env.muteCamButton.visible=!0,this.remoteUsers.name="Remote Users",this.offsetRadius=1.25,this.conference=this.createConference();let n=33,o=0,r=new Ne;this.env.addScopedEventListener(this,"update",a=>{o+=a.dt,o>=n&&(o-=n,this.env.avatar.writeState(r),this.conference.sendUserState(r.buffer))});let i=a=>{K(this.sortedUserIDs,this.env.avatar.name),this.env.avatar.name=a.userID,bo(this.sortedUserIDs,this.env.avatar.name,ns),this.updateUserOffsets()};return this.conference.addScopedEventListener(this,"roomJoined",i),this.conference.addScopedEventListener(this,"roomLeft",i),this.conference.addScopedEventListener(this,"userJoined",a=>{let s=this.avatarModel?this.avatarModel.clone():new An(16776960),c=new Tn(this.env,a.user,a.source,s,this.env.defaultAvatarHeight,this.avatarNameTagFont);c.userName=a.user.userName,this.avatars.set(a.user.userID,c),bo(this.sortedUserIDs,a.user.userID,ns),v(this.remoteUsers,c),this.updateUserOffsets(),this.env.audio.playClip("join")}),this.conference.addScopedEventListener(this,"trackAdded",a=>{if(a.stream.getAudioTracks().length>0&&this.env.audio.setUserStream(a.user.userID,a.stream),a.stream.getVideoTracks().length>0){let s=this.avatars.get(a.user.userID);s&&(s.videoStream=a.stream)}}),this.conference.addScopedEventListener(this,"trackRemoved",a=>{if(a.stream.getAudioTracks().length>0&&this.env.audio.setUserStream(a.user.userID,null),a.stream.getVideoTracks().length>0){let s=this.avatars.get(a.user.userID);s&&(s.videoStream=null)}}),this.conference.addScopedEventListener(this,"userNameChanged",a=>{let s=this.avatars.get(a.user.userID);s&&(s.userName=a.newUserName)}),this.conference.addScopedEventListener(this,"userLeft",a=>{let s=this.avatars.get(a.user.userID);s&&(s.object.removeFromParent(),this.avatars.delete(a.user.userID),K(this.sortedUserIDs,a.user.userID),de(s),this.updateUserOffsets(),this.env.audio.playClip("leave"))}),this.env.speech&&this.env.speech.addScopedEventListener(this,"result",a=>{this.visible&&this.conference.sendChat(a.results)}),await super.init(e)}async load(e){await this.env.fetcher.assets(e,...this.assets),await ui(this.env.audio.createBasicClip("join",this.doorOpenSound,.25),this.env.audio.createBasicClip("leave",this.doorCloseSound,.25)),this.avatarModel=this.avatarModelAsset.result.scene.children[0],Ea(this.avatarModel,ba)}async showing(e){v(this.env.foreground,this.remoteUsers),x(this.env.currentRoom)&&await this.join(this.env.currentRoom)}dispose(){this.hiding(),this.env.speech&&this.env.speech.removeScope(this),this.env.avatar.removeScope(this),this.env.eventSys.removeScope(this),this.env.removeScope(this),this.conference.removeScope(this),H(this.conference)}hiding(){this.remoteUsers.removeFromParent()}get visible(){return x(this.remoteUsers.parent)}async setConferenceInfo(e,n,o){this.userType=e,this.userName=n,this.meetingID=o,await this.checkConference()}async join(e){this.roomName=e,await this.checkConference()}withUser(e,n){if(this.avatars.has(e)){let o=this.avatars.get(e);if(x(o))return n(o)}return null}get offsetRadius(){return this._offsetRadius}set offsetRadius(e){this._offsetRadius=e,this.updateUserOffsets()}updateUserOffsets(){if(this.offsetRadius>0){let e=this.sortedUserIDs.indexOf(this.env.avatar.name),n=le/this.sortedUserIDs.length,o=(e+1)*n,r=this.offsetRadius*Math.sin(o),i=this.offsetRadius*(Math.cos(o)-1);for(let a=0;a<this.sortedUserIDs.length;++a){let s=this.sortedUserIDs[a],c=(a+1)*n,p=this.offsetRadius*Math.sin(c)-r,u=this.offsetRadius*(Math.cos(c)-1)-i;this.setUserOffset(s,p,0,u)}}}setUserOffset(e,n,o,r){this.withUser(e,i=>i.comfortOffset.set(n,o,r))}getUserOffset(e){return this.withUser(e,n=>n.comfortOffset)}async checkConference(){if(x(this.userType)&&x(this.userName)&&x(this.meetingID)&&x(this.roomName)){let e=`${this.roomName}_${this.meetingID}`.toLocaleLowerCase(),n=`${this.userType}_${this.userName}`;this.conference.roomName!==e&&(await this.conference.connect(),await this.conference.identify(n),await this.conference.join(e))}}};var Mn=class extends R{constructor(){super(),this.event=new A("quitting");let e=()=>this.dispatchEvent(this.event);window.addEventListener("beforeunload",e),window.addEventListener("unload",e),window.addEventListener("pagehide",e)}};var rs=!0,is=!0;function Mt(t,e,n){let o=t.match(e);return o&&o.length>=n&&parseInt(o[n],10)}function ae(t,e,n){if(!t.RTCPeerConnection)return;let o=t.RTCPeerConnection.prototype,r=o.addEventListener;o.addEventListener=function(a,s){if(a!==e)return r.apply(this,arguments);let c=p=>{let u=n(p);u&&(s.handleEvent?s.handleEvent(u):s(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(s,c),r.apply(this,[a,c])};let i=o.removeEventListener;o.removeEventListener=function(a,s){if(a!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(s))return i.apply(this,arguments);let c=this._eventMap[e].get(s);return this._eventMap[e].delete(s),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[a,c])},Object.defineProperty(o,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function as(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(rs=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function ss(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(is=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function En(){if(typeof window=="object"){if(rs)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Qe(t,e){is&&console.warn(t+" is deprecated, please use "+e+" instead.")}function cs(t){let e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;let{navigator:n}=t;if(n.mozGetUserMedia)e.browser="firefox",e.version=Mt(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=Mt(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=Mt(n.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function os(t){return Object.prototype.toString.call(t)==="[object Object]"}function mr(t){return os(t)?Object.keys(t).reduce(function(e,n){let o=os(t[n]),r=o?mr(t[n]):t[n],i=o&&!Object.keys(r).length;return r===void 0||i?e:Object.assign(e,{[n]:r})},{}):t}function dr(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(o=>{o.endsWith("Id")?dr(t,t.get(e[o]),n):o.endsWith("Ids")&&e[o].forEach(r=>{dr(t,t.get(r),n)})}))}function hr(t,e,n){let o=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;let i=[];return t.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&i.push(a)}),i.forEach(a=>{t.forEach(s=>{s.type===o&&s.trackId===a.id&&dr(t,s,r)})}),r}var yn={};rt(yn,{fixNegotiationNeeded:()=>Sr,shimAddTrackRemoveTrack:()=>_r,shimAddTrackRemoveTrackWithNative:()=>ls,shimGetDisplayMedia:()=>us,shimGetSendersWithDtmf:()=>gr,shimGetStats:()=>wr,shimGetUserMedia:()=>bn,shimMediaStream:()=>xr,shimOnTrack:()=>Fr,shimPeerConnection:()=>Cn,shimSenderReceiverGetStats:()=>fr});var ps=En;function bn(t,e){let n=t&&t.navigator;if(!n.mediaDevices)return;let o=function(s){if(typeof s!="object"||s.mandatory||s.optional)return s;let c={};return Object.keys(s).forEach(p=>{if(p==="require"||p==="advanced"||p==="mediaSource")return;let u=typeof s[p]=="object"?s[p]:{ideal:s[p]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);let l=function(h,F){return h?h+F.charAt(0).toUpperCase()+F.slice(1):F==="deviceId"?"sourceId":F};if(u.ideal!==void 0){c.optional=c.optional||[];let h={};typeof u.ideal=="number"?(h[l("min",p)]=u.ideal,c.optional.push(h),h={},h[l("max",p)]=u.ideal,c.optional.push(h)):(h[l("",p)]=u.ideal,c.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[l("",p)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[l(h,p)]=u[h])})}),s.advanced&&(c.optional=(c.optional||[]).concat(s.advanced)),c},r=function(s,c){if(e.version>=61)return c(s);if(s=JSON.parse(JSON.stringify(s)),s&&typeof s.audio=="object"){let p=function(u,l,h){l in u&&!(h in u)&&(u[h]=u[l],delete u[l])};s=JSON.parse(JSON.stringify(s)),p(s.audio,"autoGainControl","googAutoGainControl"),p(s.audio,"noiseSuppression","googNoiseSuppression"),s.audio=o(s.audio)}if(s&&typeof s.video=="object"){let p=s.video.facingMode;p=p&&(typeof p=="object"?p:{ideal:p});let u=e.version<66;if(p&&(p.exact==="user"||p.exact==="environment"||p.ideal==="user"||p.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete s.video.facingMode;let l;if(p.exact==="environment"||p.ideal==="environment"?l=["back","rear"]:(p.exact==="user"||p.ideal==="user")&&(l=["front"]),l)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(w=>w.kind==="videoinput");let F=h.find(w=>l.some(f=>w.label.toLowerCase().includes(f)));return!F&&h.length&&l.includes("back")&&(F=h[h.length-1]),F&&(s.video.deviceId=p.exact?{exact:F.deviceId}:{ideal:F.deviceId}),s.video=o(s.video),ps("chrome: "+JSON.stringify(s)),c(s)})}s.video=o(s.video)}return ps("chrome: "+JSON.stringify(s)),c(s)},i=function(s){return e.version>=64?s:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s.name]||s.name,message:s.message,constraint:s.constraint||s.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(s,c,p){r(s,u=>{n.webkitGetUserMedia(u,c,l=>{p&&p(i(l))})})};if(n.getUserMedia=a.bind(n),n.mediaDevices.getUserMedia){let s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,p=>s(p).then(u=>{if(p.audio&&!u.getAudioTracks().length||p.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(l=>{l.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(i(u))))}}}function us(t,e){if(!(t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices)&&t.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}t.navigator.mediaDevices.getDisplayMedia=function(o){return e(o).then(r=>{let i=o.video&&o.video.width,a=o.video&&o.video.height,s=o.video&&o.video.frameRate;return o.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:s||3}},i&&(o.video.mandatory.maxWidth=i),a&&(o.video.mandatory.maxHeight=a),t.navigator.mediaDevices.getUserMedia(o)})}}}function xr(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Fr(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});let e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=o=>{o.stream.addEventListener("addtrack",r=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(s=>s.track&&s.track.id===r.track.id):i={track:r.track};let a=new Event("track");a.track=r.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[o.stream],this.dispatchEvent(a)}),o.stream.getTracks().forEach(r=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(s=>s.track&&s.track.id===r.id):i={track:r};let a=new Event("track");a.track=r,a.receiver=i,a.transceiver={receiver:i},a.streams=[o.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else ae(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function gr(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){let e=function(r,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=r.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(s,c){let p=r.apply(this,arguments);return p||(p=e(this,s),this._senders.push(p)),p};let i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(s){i.apply(this,arguments);let c=this._senders.indexOf(s);c!==-1&&this._senders.splice(c,1)}}let n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(a=>{this._senders.push(e(this,a))})};let o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],o.apply(this,[i]),i.getTracks().forEach(a=>{let s=this._senders.find(c=>c.track===a);s&&this._senders.splice(this._senders.indexOf(s),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){let e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){let o=e.apply(this,[]);return o.forEach(r=>r._pc=this),o},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function wr(t){if(!t.RTCPeerConnection)return;let e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){let[o,r,i]=arguments;if(arguments.length>0&&typeof o=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof o!="function"))return e.apply(this,[]);let a=function(c){let p={};return c.result().forEach(l=>{let h={id:l.id,timestamp:l.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[l.type]||l.type};l.names().forEach(F=>{h[F]=l.stat(F)}),p[h.id]=h}),p},s=function(c){return new Map(Object.keys(c).map(p=>[p,c[p]]))};if(arguments.length>=2){let c=function(p){r(s(a(p)))};return e.apply(this,[c,o])}return new Promise((c,p)=>{e.apply(this,[function(u){c(s(a(u)))},p])}).then(r,i)}}function fr(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){let n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){let i=n.apply(this,[]);return i.forEach(a=>a._pc=this),i});let o=t.RTCPeerConnection.prototype.addTrack;o&&(t.RTCPeerConnection.prototype.addTrack=function(){let i=o.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){let i=this;return this._pc.getStats().then(a=>hr(a,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){let n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){let r=n.apply(this,[]);return r.forEach(i=>i._pc=this),r}),ae(t,"track",o=>(o.receiver._pc=o.srcElement,o)),t.RTCRtpReceiver.prototype.getStats=function(){let r=this;return this._pc.getStats().then(i=>hr(i,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;let e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){let o=arguments[0],r,i,a;return this.getSenders().forEach(s=>{s.track===o&&(r?a=!0:r=s)}),this.getReceivers().forEach(s=>(s.track===o&&(i?a=!0:i=s),s.track===o)),a||r&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function ls(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};let e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,s){if(!s)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let c=e.apply(this,arguments);return this._shimmedLocalStreams[s.id]?this._shimmedLocalStreams[s.id].indexOf(c)===-1&&this._shimmedLocalStreams[s.id].push(c):this._shimmedLocalStreams[s.id]=[s,c],c};let n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(p=>{if(this.getSenders().find(l=>l.track===p))throw new DOMException("Track already exists.","InvalidAccessError")});let s=this.getSenders();n.apply(this,arguments);let c=this.getSenders().filter(p=>s.indexOf(p)===-1);this._shimmedLocalStreams[a.id]=[a].concat(c)};let o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],o.apply(this,arguments)};let r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(s=>{let c=this._shimmedLocalStreams[s].indexOf(a);c!==-1&&this._shimmedLocalStreams[s].splice(c,1),this._shimmedLocalStreams[s].length===1&&delete this._shimmedLocalStreams[s]}),r.apply(this,arguments)}}function _r(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return ls(t);let n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){let u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(l=>this._reverseStreams[l.id])};let o=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(l=>{if(this.getSenders().find(F=>F.track===l))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){let l=new t.MediaStream(u.getTracks());this._streams[u.id]=l,this._reverseStreams[l.id]=u,u=l}o.apply(this,[u])};let r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(f=>f===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let w=this._streams[l.id];if(w)w.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let f=new t.MediaStream([u]);this._streams[l.id]=f,this._reverseStreams[f.id]=l,this.addStream(f)}return this.getSenders().find(f=>f.track===u)};function i(p,u){let l=u.sdp;return Object.keys(p._reverseStreams||[]).forEach(h=>{let F=p._reverseStreams[h],w=p._streams[F.id];l=l.replace(new RegExp(w.id,"g"),F.id)}),new RTCSessionDescription({type:u.type,sdp:l})}function a(p,u){let l=u.sdp;return Object.keys(p._reverseStreams||[]).forEach(h=>{let F=p._reverseStreams[h],w=p._streams[F.id];l=l.replace(new RegExp(F.id,"g"),w.id)}),new RTCSessionDescription({type:u.type,sdp:l})}["createOffer","createAnswer"].forEach(function(p){let u=t.RTCPeerConnection.prototype[p],l={[p](){let h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[w=>{let f=i(this,w);h[0].apply(null,[f])},w=>{h[1]&&h[1].apply(null,w)},arguments[2]]):u.apply(this,arguments).then(w=>i(this,w))}};t.RTCPeerConnection.prototype[p]=l[p]});let s=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?s.apply(this,arguments):(arguments[0]=a(this,arguments[0]),s.apply(this,arguments))};let c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){let p=c.get.apply(this);return p.type===""?p:i(this,p)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(F=>{this._streams[F].getTracks().find(f=>u.track===f)&&(h=this._streams[F])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Cn(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){let o=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function Sr(t,e){ae(t,"negotiationneeded",n=>{let o=n.target;if(!((e.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")&&o.signalingState!=="stable"))return n})}var Rn={};rt(Rn,{shimAddTransceiver:()=>Mr,shimCreateAnswer:()=>Cr,shimCreateOffer:()=>br,shimGetDisplayMedia:()=>ds,shimGetParameters:()=>Er,shimGetUserMedia:()=>Bn,shimOnTrack:()=>kr,shimPeerConnection:()=>Ln,shimRTCDataChannel:()=>Dr,shimReceiverGetStats:()=>Ar,shimRemoveStream:()=>vr,shimSenderGetStats:()=>Tr});function Bn(t,e){let n=t&&t.navigator,o=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,i,a){Qe("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(i,a)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){let r=function(a,s,c){s in a&&!(c in a)&&(a[c]=a[s],delete a[s])},i=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a.audio,"autoGainControl","mozAutoGainControl"),r(a.audio,"noiseSuppression","mozNoiseSuppression")),i(a)},o&&o.prototype.getSettings){let a=o.prototype.getSettings;o.prototype.getSettings=function(){let s=a.apply(this,arguments);return r(s,"mozAutoGainControl","autoGainControl"),r(s,"mozNoiseSuppression","noiseSuppression"),s}}if(o&&o.prototype.applyConstraints){let a=o.prototype.applyConstraints;o.prototype.applyConstraints=function(s){return this.kind==="audio"&&typeof s=="object"&&(s=JSON.parse(JSON.stringify(s)),r(s,"autoGainControl","mozAutoGainControl"),r(s,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[s])}}}}function ds(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(o){if(!(o&&o.video)){let r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return o.video===!0?o.video={mediaSource:e}:o.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(o)})}function kr(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ln(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){let i=t.RTCPeerConnection.prototype[r],a={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=a[r]});let n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){let[i,a,s]=arguments;return o.apply(this,[i||null]).then(c=>{if(e.version<53&&!a)try{c.forEach(p=>{p.type=n[p.type]||p.type})}catch(p){if(p.name!=="TypeError")throw p;c.forEach((u,l)=>{c.set(l,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(a,s)}}function Tr(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;let e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){let r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r});let n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){let r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Ar(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;let e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){let o=e.apply(this,[]);return o.forEach(r=>r._pc=this),o}),ae(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function vr(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Qe("removeStream","removeTrack"),this.getSenders().forEach(o=>{o.track&&n.getTracks().includes(o.track)&&this.removeTrack(o)})})}function Dr(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Mr(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;let e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let o=arguments[1]&&arguments[1].sendEncodings;o===void 0&&(o=[]),o=[...o];let r=o.length>0;r&&o.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let i=e.apply(this,arguments);if(r){let{sender:a}=i,s=a.getParameters();(!("encodings"in s)||s.encodings.length===1&&Object.keys(s.encodings[0]).length===0)&&(s.encodings=o,a.sendEncodings=o,this.setParametersPromises.push(a.setParameters(s).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return i})}function Er(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;let e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){let o=e.apply(this,arguments);return"encodings"in o||(o.encodings=[].concat(this.sendEncodings||[{}])),o})}function br(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;let e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Cr(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;let e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Pn={};rt(Pn,{shimAudioContext:()=>Ir,shimCallbacksAPI:()=>Lr,shimConstraints:()=>ms,shimCreateOfferLegacy:()=>Vr,shimGetUserMedia:()=>Rr,shimLocalStreamsAPI:()=>yr,shimRTCIceServerUrls:()=>Pr,shimRemoteStreamsAPI:()=>Br,shimTrackEventTransceiver:()=>Wr});function yr(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){let e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(o){this._localStreams||(this._localStreams=[]),this._localStreams.includes(o)||this._localStreams.push(o),o.getAudioTracks().forEach(r=>e.call(this,r,o)),o.getVideoTracks().forEach(r=>e.call(this,r,o))},t.RTCPeerConnection.prototype.addTrack=function(o,...r){return r&&r.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);let o=this._localStreams.indexOf(n);if(o===-1)return;this._localStreams.splice(o,1);let r=n.getTracks();this.getSenders().forEach(i=>{r.includes(i.track)&&this.removeTrack(i)})})}}function Br(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);let i=new Event("addstream");i.stream=r,this.dispatchEvent(i)})})}});let e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){let o=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(o._remoteStreams||(o._remoteStreams=[]),o._remoteStreams.indexOf(i)>=0)return;o._remoteStreams.push(i);let a=new Event("addstream");a.stream=i,o.dispatchEvent(a)})}),e.apply(o,arguments)}}}function Lr(t){if(typeof t!="object"||!t.RTCPeerConnection)return;let e=t.RTCPeerConnection.prototype,n=e.createOffer,o=e.createAnswer,r=e.setLocalDescription,i=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(p,u){let l=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[l]);return u?(h.then(p,u),Promise.resolve()):h},e.createAnswer=function(p,u){let l=arguments.length>=2?arguments[2]:arguments[0],h=o.apply(this,[l]);return u?(h.then(p,u),Promise.resolve()):h};let s=function(c,p,u){let l=r.apply(this,[c]);return u?(l.then(p,u),Promise.resolve()):l};e.setLocalDescription=s,s=function(c,p,u){let l=i.apply(this,[c]);return u?(l.then(p,u),Promise.resolve()):l},e.setRemoteDescription=s,s=function(c,p,u){let l=a.apply(this,[c]);return u?(l.then(p,u),Promise.resolve()):l},e.addIceCandidate=s}function Rr(t){let e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){let n=e.mediaDevices,o=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>o(ms(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(o,r,i){e.mediaDevices.getUserMedia(o).then(r,i)}.bind(e))}function ms(t){return t&&t.video!==void 0?Object.assign({},t,{video:mr(t.video)}):t}function Pr(t){if(!t.RTCPeerConnection)return;let e=t.RTCPeerConnection;t.RTCPeerConnection=function(o,r){if(o&&o.iceServers){let i=[];for(let a=0;a<o.iceServers.length;a++){let s=o.iceServers[a];s.urls===void 0&&s.url?(Qe("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,delete s.url,i.push(s)):i.push(o.iceServers[a])}o.iceServers=i}return new e(o,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Wr(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Vr(t){let e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(o){if(o){typeof o.offerToReceiveAudio<"u"&&(o.offerToReceiveAudio=!!o.offerToReceiveAudio);let r=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");o.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):o.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof o.offerToReceiveVideo<"u"&&(o.offerToReceiveVideo=!!o.offerToReceiveVideo);let i=this.getTransceivers().find(a=>a.receiver.track.kind==="video");o.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):o.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Ir(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Nr={};rt(Nr,{removeExtmapAllowMixed:()=>In,shimAddIceCandidateNullOrEmpty:()=>yt,shimConnectionState:()=>Vn,shimMaxMessageSize:()=>bt,shimParameterlessSetLocalDescription:()=>Bt,shimRTCIceCandidate:()=>Et,shimRTCIceCandidateRelayProtocol:()=>Wn,shimSendThrowTypeError:()=>Ct});var Ze=ii(Or());function Et(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;let e=t.RTCIceCandidate;t.RTCIceCandidate=function(o){if(typeof o=="object"&&o.candidate&&o.candidate.indexOf("a=")===0&&(o=JSON.parse(JSON.stringify(o)),o.candidate=o.candidate.substring(2)),o.candidate&&o.candidate.length){let r=new e(o),i=Ze.default.parseCandidate(o.candidate);for(let a in i)a in r||Object.defineProperty(r,a,{value:i[a]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(o)},t.RTCIceCandidate.prototype=e.prototype,ae(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Wn(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||ae(t,"icecandidate",e=>{if(e.candidate){let n=Ze.default.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function bt(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});let n=function(s){if(!s||!s.sdp)return!1;let c=Ze.default.splitSections(s.sdp);return c.shift(),c.some(p=>{let u=Ze.default.parseMLine(p);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},o=function(s){let c=s.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;let p=parseInt(c[1],10);return p!==p?-1:p},r=function(s){let c=65536;return e.browser==="firefox"&&(e.version<57?s===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},i=function(s,c){let p=65536;e.browser==="firefox"&&e.version===57&&(p=65535);let u=Ze.default.matchPrefix(s.sdp,"a=max-message-size:");return u.length>0?p=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(p=2147483637),p},a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){let{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){let c=o(arguments[0]),p=r(c),u=i(arguments[0],c),l;p===0&&u===0?l=Number.POSITIVE_INFINITY:p===0||u===0?l=Math.max(p,u):l=Math.min(p,u);let h={};Object.defineProperty(h,"maxMessageSize",{get(){return l}}),this._sctp=h}return a.apply(this,arguments)}}function Ct(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(o,r){let i=o.send;o.send=function(){let s=arguments[0],c=s.length||s.size||s.byteLength;if(o.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return i.apply(o,arguments)}}let n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){let r=n.apply(this,arguments);return e(r,this),r},ae(t,"datachannel",o=>(e(o.channel,o.target),o))}function Vn(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;let e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{let o=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{let i=r.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;let a=new Event("connectionstatechange",r);i.dispatchEvent(a)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function In(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;let n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let i=r.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}function yt(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;let n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Bt(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;let n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var Mp=ii(Or());function hs({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){let n=En,o=cs(t),r={browserDetails:o,commonShim:Nr,extractVersion:Mt,disableLog:as,disableWarnings:ss,sdp:Mp};switch(o.browser){case"chrome":if(!yn||!Cn||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(o.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=yn,yt(t,o),Bt(t,o),bn(t,o),xr(t,o),Cn(t,o),Fr(t,o),_r(t,o),gr(t,o),wr(t,o),fr(t,o),Sr(t,o),Et(t,o),Wn(t,o),Vn(t,o),bt(t,o),Ct(t,o),In(t,o);break;case"firefox":if(!Rn||!Ln||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Rn,yt(t,o),Bt(t,o),Bn(t,o),Ln(t,o),kr(t,o),vr(t,o),Tr(t,o),Ar(t,o),Dr(t,o),Mr(t,o),Er(t,o),br(t,o),Cr(t,o),Et(t,o),Vn(t,o),bt(t,o),Ct(t,o);break;case"safari":if(!Pn||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Pn,yt(t,o),Bt(t,o),Pr(t,o),Vr(t,o),Lr(t,o),yr(t,o),Br(t,o),Wr(t,o),Rr(t,o),Ir(t,o),Et(t,o),Wn(t,o),bt(t,o),Ct(t,o),In(t,o);break;default:n("Unsupported browser!");break}return r}var $k=hs({window:typeof window>"u"?void 0:window});var Re=class extends Event{constructor(e){super(e),this.eventType=e}},Hn=class extends Re{constructor(e){super("error"),this.error=e}};var On=class extends Re{constructor(){super("serverConnected")}},Nn=class extends Re{constructor(){super("serverDisconnected")}};var Xn=class extends Re{constructor(e,n){super(e),this.userID=n}},Un=class extends Xn{constructor(e,n){super("roomJoined",e),this.pose=n}},jn=class extends Xn{constructor(e){super("roomLeft",e)}},et=class extends Re{constructor(e,n){super(e),this.user=n}},Gn=class extends et{constructor(e,n){super("userJoined",e),this.source=n}},tt=class extends et{constructor(e){super("userLeft",e)}};var xs;(function(t){t.Audio="audio",t.Video="video"})(xs||(xs={}));var Fs;(function(t){t.Added="added",t.Removed="removed",t.Changed="changed"})(Fs||(Fs={}));var zn=class extends et{constructor(e){super("userState",e),this.buffer=null}},qn=class extends et{constructor(e){super("chat",e),this.text=null}};function Xr(t){let e=new xe,n=setInterval(()=>{t()&&(clearInterval(n),e.resolve())},100);return e}var _;(function(t){t.Disconnected="Disconnected",t.Connecting="Connecting",t.Connected="Connected",t.Disconnecting="Disconnecting"})(_||(_={}));async function gs(t,e,n,o,r,i,a){e()===r?await Xr(()=>e()===o):(e()===i&&await Xr(()=>e()===a),e()===a&&await n())}function Ur(t,e,n){return gs(t,e,n,_.Connected,_.Connecting,_.Disconnecting,_.Disconnected)}function jr(t,e,n){return gs(t,e,n,_.Disconnected,_.Disconnecting,_.Connecting,_.Connected)}var Jn=class extends Oe{constructor(e,n,o,r,i,a,s,c,p,u){super(e),this.control=n,this.min=o,this.max=r,this.threshold=i,this.attack=a,this.decay=s,this.sustain=c,this.hold=p,this.release=u,this.curLength=0,this._enabled=!0,this.shouldRun=!1,this.name="remote-audio-activity";let l=null;this.addEventListener("activity",h=>{let F=performance.now();if(l!=null){let w=F-l;if(this.enabled){let f=h.level;f>=this.threshold&&this.time>=this.length&&(this.time=0),this.time+=w,this.time>this.length&&(this.time=this.length),f>=this.threshold&&this.holding&&(this.time=this.holdStart),this.control.gain.value=this.gain}}l=F})}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.refresh()}start(){this.shouldRun=!0,this.refresh()}stop(){this.shouldRun=!1,this.refresh()}refresh(){let e=this.shouldRun&&this.enabled;e!==this.timer.isRunning&&(e?this.timer.start():(this.timer.stop(),this.control.gain.value=1))}get length(){return this.attack+this.decay+this.hold+this.release}get time(){return this.length-this.curLength}set time(e){this.curLength=this.length-e}get attackStart(){return 0}get attackEnd(){return this.attackStart+this.attack}get decayStart(){return this.attackEnd}get decayEnd(){return this.decayStart+this.decay}get holdStart(){return this.decayEnd}get holdEnd(){return this.holdStart+this.hold}get releaseStart(){return this.holdEnd}get releaseEnd(){return this.releaseStart+this.release}get attacking(){return this.attackStart<=this.time&&this.time<this.attackEnd}get decaying(){return this.decayStart<=this.time&&this.time<this.decayEnd}get holding(){return this.holdStart<=this.time&&this.time<this.holdEnd}get releasing(){return this.releaseStart<this.time&&this.time<this.releaseEnd}get pAttack(){return(this.time-this.attackStart)/this.attack}get pDecay(){return(this.time-this.decayStart)/this.decay}get pRelease(){return(this.time-this.releaseStart)/this.release}get value(){return this.attacking?1-this.pAttack:this.decaying?this.sustain*this.pDecay:this.holding?this.sustain:this.releasing?this.sustain+(1-this.sustain)*this.pRelease:1}get gain(){return Ci(this.value,this.min,this.max)}};var Gr=class{constructor(){this.locks=new Set}isLocked(e){return this.locks.has(e)}isUnlocked(e){return!this.locks.has(e)}lock(e){this.locks.add(e)}unlock(e){this.locks.delete(e)}async withSkipLock(e,n){if(this.isUnlocked(e)){this.lock(e);try{await n()}finally{this.unlock(e)}}}},se=class extends A{constructor(e,n){super(e),this.user=n}},zr=class extends se{constructor(e,n){super("iceError",e),this.address=n.address,this.errorCode=n.errorCode,this.errorText=n.errorText,this.port=n.port,this.url=n.url,Object.seal(this)}},qr=class extends se{constructor(e,n){super("iceCandidate",e),this.candidate=n}},Jr=class extends se{constructor(e,n){super("offer",e),this.offer=n}},$r=class extends se{constructor(e,n){super("answer",e),this.answer=n}},Kr=class extends se{constructor(e){super("streamNeeded",e)}},Yr=class extends se{constructor(e,n,o){super("trackAdded",e),this.track=n,this.stream=o}},Qr=class extends se{constructor(e,n){super("trackMuted",e),this.track=n}},Zr=class extends se{constructor(e,n,o){super("trackRemoved",e),this.track=n,this.stream=o}},ws=new Set,$n=class extends R{constructor(e,n,o){super(),this.userID=e,this.userName=n,this.userStateEvt=new zn(this),this.userChatEvt=new qn(this),this.transceivers=new Array,this.tasks=new Map,this.locks=new Gr,this.channel=null,this.gotOffer=!1,this.disposed=!1,this.trackSent=!1,this.connection=new RTCPeerConnection(o),this.connection.addEventListener("icecandidateerror",i=>{this.dispatchEvent(new zr(this,i))}),this.connection.addEventListener("icecandidate",async i=>{i.candidate&&this.dispatchEvent(new qr(this,i.candidate))}),this.connection.addEventListener("negotiationneeded",async()=>{if(this.trackSent||this.gotOffer){let i=ws.has(this.userID),a=await this.connection.createOffer({iceRestart:i});i||ws.add(this.userID),await this.connection.setLocalDescription(a),this.dispatchEvent(new Jr(this,this.connection.localDescription.toJSON()))}}),this.connection.addEventListener("datachannel",i=>{this.setChannel(i.channel)}),this.connection.addEventListener("track",async i=>{let a=i.transceiver,s=i.track,c=Vt(i.streams,l=>{let h=l.getTracks();for(let F of h)if(F===s)return!0;return!1});this.transceivers.indexOf(a)===-1&&this.transceivers.push(a);let p=()=>{this.dispatchEvent(new Qr(this,s))},u=()=>{s.removeEventListener("ended",u),s.removeEventListener("mute",p),K(this.transceivers,a),this.dispatchEvent(new Zr(this,s,c))};s.addEventListener("ended",u),s.addEventListener("mute",p),this.dispatchEvent(new Yr(this,s,c)),this.trackSent?this.setChannel(this.connection.createDataChannel("poses",{ordered:!1,maxRetransmits:0})):this.start()});let r=!1;this.connection.addEventListener("connectionstatechange",()=>{this.connection.connectionState==="failed"&&r?this.dispatchEvent(new tt(this)):this.connection.connectionState==="connected"&&(r=!0)}),Object.seal(this)}dispose(){if(!this.disposed){this.channel&&(H(this.channel),this.channel=null);for(let e of this.transceivers)e.stop();ve(this.transceivers),H(this.connection),this.disposed=!0}}setChannel(e){this.channel=e,this.channel.binaryType="arraybuffer",this.channel.addEventListener("message",n=>{ai(n.data)&&this.recvUserState(n)})}recvChat(e){this.userChatEvt.text=e,this.dispatchEvent(this.userChatEvt)}async sendUserState(e){if(this.channel&&this.channel.readyState==="open"){let n="sendUserState";this.tasks.has(n)||this.tasks.set(n,new xe),await this.locks.withSkipLock(n,async()=>{this.channel.send(e)})}}recvUserState(e){this.userStateEvt.buffer=e.data,this.dispatchEvent(this.userStateEvt)}async addIceCandidate(e){await this.connection.addIceCandidate(e)}async acceptOffer(e){await this.connection.setRemoteDescription(e),this.gotOffer=!0;let n=await this.connection.createAnswer();await this.connection.setLocalDescription(n),this.dispatchEvent(new $r(this,this.connection.localDescription.toJSON()))}async acceptAnswer(e){await this.connection.setRemoteDescription(e)}start(){this.trackSent||this.dispatchEvent(new Kr(this))}removeStream(e){let n=this.connection.getSenders(),o=new Map(n.map(r=>[r.track,r]));for(let r of e.getTracks())if(o.has(r)){let i=o.get(r);this.connection.removeTrack(i)}}sendStream(...e){for(let n of e)if(n)for(let o of n.getTracks())this.trackSent?this.connection.addTrack(o,n):(this.trackSent=!0,this.transceivers.push(this.connection.addTransceiver(o,{streams:[n]})))}};var Kn="local-user";var ei=we("Juniper:Sockets",()=>new Array);function Qn(...t){let e=new WebSocket(...t);return ei.push(e),e}Qn.CLOSED=WebSocket.CLOSED;Qn.CLOSING=WebSocket.CLOSING;Qn.CONNECTING=WebSocket.CONNECTING;Qn.OPEN=WebSocket.OPEN;Object.assign(window,{sockets:{list:()=>ei,kill:()=>{ei.forEach(H)}}});var fs;(function(t){t.InConference="in-conference",t.JoiningConference="joining-conference",t.Connected="connected",t.Connecting="connecting",t.Prepaired="prepaired",t.Prepairing="prepairing",t.Unprepared="unprepaired"})(fs||(fs={}));var Yn=class extends R{get isAudioMuted(){return this._isAudioMuted}get isVideoMuted(){return this._isVideoMuted}get localUserID(){return this._localUserID}get localUserName(){return this._localUserName}get roomName(){return this._roomName}get hasAudioPermission(){return this._hasAudioPermission}get hasVideoPermission(){return this._hasVideoPermission}constructor(e,n,o,r){super(),this.audio=e,this.microphones=n,this.webcams=o,this.hub=r,this._isAudioMuted=null,this._isVideoMuted=null,this._localUserID=Kn,this._localUserName=null,this._roomName=null,this._conferenceState=_.Disconnected,this._hasAudioPermission=!1,this._hasVideoPermission=!1,this.lastRoom=null,this.lastUserID=null,this.users=new Map,this.windowQuitter=new Mn,this.heartbeatTimer=null,this.disposed=!1;let i=a=>{for(let s of this.users.values())a.oldStream&&s.removeStream(a.oldStream),a.newStream&&s.sendStream(a.newStream)};this.microphones.addEventListener("streamchanged",i),this.webcams.addEventListener("streamchanged",i),this.hub.addEventListener("close",this.onClose.bind(this)),this.hub.addEventListener("reconnecting",this.onReconnecting.bind(this)),this.hub.addEventListener("reconnected",this.onReconnected.bind(this)),this.hub.addEventListener("userJoined",this.onUserJoined.bind(this)),this.hub.addEventListener("iceReceived",this.onIceReceived.bind(this)),this.hub.addEventListener("offerReceived",this.onOfferReceived.bind(this)),this.hub.addEventListener("answerReceived",this.onAnswerReceived.bind(this)),this.hub.addEventListener("userLeft",this.onUserLeft.bind(this)),this.hub.addEventListener("chat",this.onChat.bind(this)),this.remoteGainDecay=new Jn(this.audio.context,this.microphones.autoGainNode,.05,1,.25,0,250,.25,1e3,250),this.audio.destination.remoteUserInput.connect(this.remoteGainDecay),this.remoteGainDecay.enabled=!this.audio.useHeadphones,this.audio.addEventListener("useheadphonestoggled",()=>{this.remoteGainDecay.enabled=!this.audio.useHeadphones}),this.windowQuitter.addScopedEventListener(this,"quitting",()=>{this.conferenceState===_.Connected&&this.toRoom("leave")})}get connectionState(){return this.hub.connectionState}get echoControl(){return this.remoteGainDecay}get isConnected(){return this.connectionState===_.Connected}get conferenceState(){return this._conferenceState}get isConferenced(){return this.conferenceState===_.Connected}setConferenceState(e){this._conferenceState=e}dispose(){this.disposed||(this.leave(),this.disconnect(),this.windowQuitter.removeScope(this),H(this.remoteGainDecay),this.disposed=!0)}err(e,...n){console.warn(e,...n)}async toServer(e,...n){return await this.hub.invoke(e,...n)}async toRoom(e,...n){this.isConnected&&await this.hub.invoke(e,this.localUserID,this.roomName,...n)}async toUser(e,n,...o){this.isConnected&&await this.hub.invoke(e,this.localUserID,n,...o)}async connect(){await Ur("Connecting",()=>this.connectionState,async()=>{await this.hub.start(),this.heartbeatTimer=setInterval(()=>{this.hub.connectionState===_.Connected&&this.hub.invoke("heartbeat",this.localUserID)},2500),this.dispatchEvent(new On)})}async join(e){this.lastRoom!==null&&e!==this.lastRoom&&await this.leave(),await Ur(`Joining room ${e}`,()=>this.conferenceState,async()=>{this.setConferenceState(_.Connecting),this._roomName=e,await this.toServer("join",this.roomName),this.lastRoom=this.roomName,this.setConferenceState(_.Connected);let n=this.audio.setLocalUserID(this.localUserID);this.dispatchEvent(new Un(this.localUserID,n.pose)),await this.toRoom("greetEveryone",this.localUserName)})}async identify(e){this.localUserID===Kn&&(this._localUserID=null),this._localUserID=this.localUserID||await this.toServer("getNewUserID"),this._localUserName=e,this.localUserID&&this.localUserID!==this.lastUserID&&this.isConnected&&(this.lastUserID=this.localUserID,await this.toServer("identify",this.localUserID))}async leave(){await jr(`Leaving room ${this.lastRoom}`,()=>this.conferenceState,async()=>{this.setConferenceState(_.Disconnecting),await this.toRoom("leave")});for(let e of this.users.values())this.removeUser(e);this._roomName=this.lastRoom=null,this.setConferenceState(_.Disconnected),this.dispatchEvent(new jn(this.localUserID))}async disconnect(){x(this.heartbeatTimer)&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null),this.conferenceState!==_.Disconnected&&await this.leave(),await jr("Disconnecting",()=>this.connectionState,async()=>{await this.hub.stop(),this._localUserID=this.lastUserID=Kn,this.audio.setLocalUserID(this.localUserID),this.dispatchEvent(new Nn)})}onClose(){this.lastRoom=null,this.lastUserID=null,this.setConferenceState(_.Disconnected)}onReconnecting(e){this.dispatchEvent(new Hn(e.error))}async onReconnected(){this.lastRoom=null,this.lastUserID=null,this.setConferenceState(_.Disconnected),await this.identify(this.localUserName),await this.join(this.roomName)}async onUserJoined(e){if(this.users.has(e.fromUserID))this.users.get(e.fromUserID).start();else{this.users.size===0&&this.remoteGainDecay.start();let n=await this.getRTCConfiguration(),o=new $n(e.fromUserID,e.fromUserName,n);this.users.set(o.userID,o),o.addEventListener("iceError",this.onIceError.bind(this)),o.addEventListener("iceCandidate",this.onIceCandidate.bind(this)),o.addEventListener("offer",this.onOfferCreated.bind(this)),o.addEventListener("answer",this.onAnswerCreated.bind(this)),o.addEventListener("streamNeeded",this.onStreamNeeded.bind(this)),o.addEventListener("trackAdded",this.onTrackAdded.bind(this)),o.addEventListener("trackMuted",this.onTrackMuted.bind(this)),o.addEventListener("trackRemoved",this.onTrackRemoved.bind(this)),o.addEventListener("userLeft",i=>this.removeUser(i.user)),this.toUser("greet",o.userID,this.localUserName);let r=this.audio.createUser(o.userID,o.userName);this.dispatchEvent(new Gn(o,r))}}async getRTCConfiguration(){return await this.toServer("getRTCConfiguration",this.localUserID)}onIceError(e){this.err("icecandidateerror",this.localUserName,e.user.userName,`${e.url} [${e.errorCode}]: ${e.errorText}`)}async onIceCandidate(e){await this.sendIce(e.user.userID,e.candidate)}async onIceReceived(e){try{let n=this.users.get(e.fromUserID);if(n){let o=JSON.parse(e.candidateJSON);await n.addIceCandidate(o)}}catch(n){this.err("iceReceived",`${n.message} [${e.fromUserID}] (${e.candidateJSON})`)}}async onOfferCreated(e){await this.sendOffer(e.user.userID,e.offer)}async onOfferReceived(e){try{let n=this.users.get(e.fromUserID);if(n){let o=JSON.parse(e.offerJSON);await n.acceptOffer(o)}}catch(n){this.err("offerReceived",n.message)}}async onAnswerCreated(e){await this.sendAnswer(e.user.userID,e.answer)}async onAnswerReceived(e){try{let n=this.users.get(e.fromUserID);if(n){let o=JSON.parse(e.answerJSON);await n.acceptAnswer(o)}}catch(n){this.err("answerReceived",n.message)}}onStreamNeeded(e){e.user.sendStream(this.microphones.outStream,this.webcams.outStream)}onTrackAdded(e){this.dispatchEvent(e)}onTrackMuted(e){this.dispatchEvent(e)}onTrackRemoved(e){this.dispatchEvent(e)}onUserLeft(e){this.removeUser(this.users.get(e.fromUserID))}removeUser(e){x(e)&&(H(e),this.users.delete(e.userID),this.users.size===0&&this.remoteGainDecay.stop(),this.audio.removeUser(e.userID),this.dispatchEvent(new tt(e)))}onChat(e){let n=this.users.get(e.fromUserID);n&&n.recvChat(e.text)}sendChat(e){this.conferenceState===_.Connected&&this.toRoom("chat",e)}async sendIce(e,n){await this.toUser("sendIce",e,JSON.stringify(n))}async sendOffer(e,n){await this.toUser("sendOffer",e,JSON.stringify(n))}async sendAnswer(e,n){await this.toUser("sendAnswer",e,JSON.stringify(n))}async forEachUser(e){this.conferenceState===_.Connected&&await Promise.all(Array.from(this.users.values()).map(e))}async sendUserState(e){await this.forEachUser(n=>n.sendUserState(e))}userExists(e){return this.users.has(e)}getUserNames(){return Array.from(this.users.values()).map(e=>[e.userID,e.userName])}};var Zn=class extends A{constructor(){super("close")}},eo=class extends A{constructor(e){super("reconnecting"),this.error=e}},to=class extends A{constructor(){super("reconnected")}},no=class extends A{constructor(e,n){super("userJoined"),this.fromUserID=e,this.fromUserName=n}},oo=class extends A{constructor(e,n){super("iceReceived"),this.fromUserID=e,this.candidateJSON=n}},ro=class extends A{constructor(e,n){super("offerReceived"),this.fromUserID=e,this.offerJSON=n}},io=class extends A{constructor(e,n){super("answerReceived"),this.fromUserID=e,this.answerJSON=n}},ao=class extends A{constructor(e){super("userLeft"),this.fromUserID=e}},so=class extends A{constructor(){super("chat"),this.fromUserID=null,this.text=null}set(e,n){this.fromUserID=e,this.text=n}};var ee=class extends Error{constructor(e,n){let o=new.target.prototype;super(`${e}: Status code '${n}'`),this.statusCode=n,this.__proto__=o}},_e=class extends Error{constructor(e="A timeout occurred."){let n=new.target.prototype;super(e),this.__proto__=n}},P=class extends Error{constructor(e="An abort occurred."){let n=new.target.prototype;super(e),this.__proto__=n}},co=class extends Error{constructor(e,n){let o=new.target.prototype;super(e),this.transport=n,this.errorType="UnsupportedTransportError",this.__proto__=o}},po=class extends Error{constructor(e,n){let o=new.target.prototype;super(e),this.transport=n,this.errorType="DisabledTransportError",this.__proto__=o}},uo=class extends Error{constructor(e,n){let o=new.target.prototype;super(e),this.transport=n,this.errorType="FailedToStartTransportError",this.__proto__=o}},lo=class extends Error{constructor(e){let n=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=n}},mo=class extends Error{constructor(e,n){let o=new.target.prototype;super(e),this.innerErrors=n,this.__proto__=o}};var nt=class{constructor(e,n,o){this.statusCode=e,this.statusText=n,this.content=o}},ce=class{get(e,n){return this.send({...n,method:"GET",url:e})}post(e,n){return this.send({...n,method:"POST",url:e})}delete(e,n){return this.send({...n,method:"DELETE",url:e})}getCookieString(e){return""}};var d;(function(t){t[t.Trace=0]="Trace",t[t.Debug=1]="Debug",t[t.Information=2]="Information",t[t.Warning=3]="Warning",t[t.Error=4]="Error",t[t.Critical=5]="Critical",t[t.None=6]="None"})(d||(d={}));var pe=class{constructor(){}log(e,n){}};pe.instance=new pe;var Ep="7.0.10",D=class{static isRequired(e,n){if(e==null)throw new Error(`The '${n}' argument is required.`)}static isNotEmpty(e,n){if(!e||e.match(/^\s*$/))throw new Error(`The '${n}' argument should not be empty.`)}static isIn(e,n,o){if(!(e in n))throw new Error(`Unknown ${o} value: ${e}.`)}},M=class{static get isBrowser(){return typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return typeof self=="object"&&"importScripts"in self}static get isReactNative(){return typeof window=="object"&&typeof window.document>"u"}static get isNode(){return!this.isBrowser&&!this.isWebWorker&&!this.isReactNative}};function Se(t,e){let n="";return ke(t)?(n=`Binary data of length ${t.byteLength}`,e&&(n+=`. Content: '${bp(t)}'`)):typeof t=="string"&&(n=`String data of length ${t.length}`,e&&(n+=`. Content: '${t}'`)),n}function bp(t){let e=new Uint8Array(t),n="";return e.forEach(o=>{let r=o<16?"0":"";n+=`0x${r}${o.toString(16)} `}),n.substr(0,n.length-1)}function ke(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}async function xo(t,e,n,o,r,i){let a={},[s,c]=ue();a[s]=c,t.log(d.Trace,`(${e} transport) sending data. ${Se(r,i.logMessageContent)}.`);let p=ke(r)?"arraybuffer":"text",u=await n.post(o,{content:r,headers:{...a,...i.headers},responseType:p,timeout:i.timeout,withCredentials:i.withCredentials});t.log(d.Trace,`(${e} transport) request complete. Response status: ${u.statusCode}.`)}function _s(t){return t===void 0?new Pe(d.Information):t===null?pe.instance:t.log!==void 0?t:new Pe(t)}var ho=class{constructor(e,n){this._subject=e,this._observer=n}dispose(){let e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(n=>{})}},Pe=class{constructor(e){this._minLevel=e,this.out=console}log(e,n){if(e>=this._minLevel){let o=`[${new Date().toISOString()}] ${d[e]}: ${n}`;switch(e){case d.Critical:case d.Error:this.out.error(o);break;case d.Warning:this.out.warn(o);break;case d.Information:this.out.info(o);break;default:this.out.log(o);break}}}};function ue(){let t="X-SignalR-User-Agent";return M.isNode&&(t="User-Agent"),[t,Cp(Ep,yp(),Lp(),Bp())]}function Cp(t,e,n,o){let r="Microsoft SignalR/",i=t.split(".");return r+=`${i[0]}.${i[1]}`,r+=` (${t}; `,e&&e!==""?r+=`${e}; `:r+="Unknown OS; ",r+=`${n}`,o?r+=`; ${o}`:r+="; Unknown Runtime Version",r+=")",r}function yp(){if(M.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function Bp(){if(M.isNode)return process.versions.node}function Lp(){return M.isNode?"NodeJS":"Browser"}function ti(t){return t.stack?t.stack:t.message?t.message:`${t}`}function Ss(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}var Fo=class extends ce{constructor(e){if(super(),this._logger=e,typeof fetch>"u"){let n=typeof __webpack_require__=="function"?__non_webpack_require__:Ie;this._jar=new(n("tough-cookie")).CookieJar,this._fetchType=n("node-fetch"),this._fetchType=n("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(Ss());if(typeof AbortController>"u"){let n=typeof __webpack_require__=="function"?__non_webpack_require__:Ie;this._abortControllerType=n("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new P;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");let n=new this._abortControllerType,o;e.abortSignal&&(e.abortSignal.onabort=()=>{n.abort(),o=new P});let r=null;if(e.timeout){let c=e.timeout;r=setTimeout(()=>{n.abort(),this._logger.log(d.Warning,"Timeout from HTTP request."),o=new _e},c)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},ke(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");let i;try{i=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:n.signal})}catch(c){throw o||(this._logger.log(d.Warning,`Error from HTTP request. ${c}.`),c)}finally{r&&clearTimeout(r),e.abortSignal&&(e.abortSignal.onabort=null)}if(!i.ok){let c=await ks(i,"text");throw new ee(c||i.statusText,i.status)}let s=await ks(i,e.responseType);return new nt(i.status,i.statusText,s)}getCookieString(e){let n="";return M.isNode&&this._jar&&this._jar.getCookies(e,(o,r)=>n=r.join("; ")),n}};function ks(t,e){let n;switch(e){case"arraybuffer":n=t.arrayBuffer();break;case"text":n=t.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`);default:n=t.text();break}return n}var go=class extends ce{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new P):e.method?e.url?new Promise((n,o)=>{let r=new XMLHttpRequest;r.open(e.method,e.url,!0),r.withCredentials=e.withCredentials===void 0?!0:e.withCredentials,r.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(ke(e.content)?r.setRequestHeader("Content-Type","application/octet-stream"):r.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));let i=e.headers;i&&Object.keys(i).forEach(a=>{r.setRequestHeader(a,i[a])}),e.responseType&&(r.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{r.abort(),o(new P)}),e.timeout&&(r.timeout=e.timeout),r.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),r.status>=200&&r.status<300?n(new nt(r.status,r.statusText,r.response||r.responseText)):o(new ee(r.response||r.responseText||r.statusText,r.status))},r.onerror=()=>{this._logger.log(d.Warning,`Error from HTTP request. ${r.status}: ${r.statusText}.`),o(new ee(r.statusText,r.status))},r.ontimeout=()=>{this._logger.log(d.Warning,"Timeout from HTTP request."),o(new _e)},r.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}};var wo=class extends ce{constructor(e){if(super(),typeof fetch<"u"||M.isNode)this._httpClient=new Fo(e);else if(typeof XMLHttpRequest<"u")this._httpClient=new go(e);else throw new Error("No usable HttpClient found.")}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new P):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}};var G=class t{static write(e){return`${e}${t.RecordSeparator}`}static parse(e){if(e[e.length-1]!==t.RecordSeparator)throw new Error("Message is incomplete.");let n=e.split(t.RecordSeparator);return n.pop(),n}};G.RecordSeparatorCode=30;G.RecordSeparator=String.fromCharCode(G.RecordSeparatorCode);var fo=class{writeHandshakeRequest(e){return G.write(JSON.stringify(e))}parseHandshakeResponse(e){let n,o;if(ke(e)){let s=new Uint8Array(e),c=s.indexOf(G.RecordSeparatorCode);if(c===-1)throw new Error("Message is incomplete.");let p=c+1;n=String.fromCharCode.apply(null,Array.prototype.slice.call(s.slice(0,p))),o=s.byteLength>p?s.slice(p).buffer:null}else{let s=e,c=s.indexOf(G.RecordSeparator);if(c===-1)throw new Error("Message is incomplete.");let p=c+1;n=s.substring(0,p),o=s.length>p?s.substring(p):null}let r=G.parse(n),i=JSON.parse(r[0]);if(i.type)throw new Error("Expected a handshake response from the server.");return[o,i]}};var k;(function(t){t[t.Invocation=1]="Invocation",t[t.StreamItem=2]="StreamItem",t[t.Completion=3]="Completion",t[t.StreamInvocation=4]="StreamInvocation",t[t.CancelInvocation=5]="CancelInvocation",t[t.Ping=6]="Ping",t[t.Close=7]="Close"})(k||(k={}));var _o=class{constructor(){this.observers=[]}next(e){for(let n of this.observers)n.next(e)}error(e){for(let n of this.observers)n.error&&n.error(e)}complete(){for(let e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new ho(this,e)}};var Rp=30*1e3,Pp=15*1e3,S;(function(t){t.Disconnected="Disconnected",t.Connecting="Connecting",t.Connected="Connected",t.Disconnecting="Disconnecting",t.Reconnecting="Reconnecting"})(S||(S={}));var Lt=class t{constructor(e,n,o,r){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(d.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://docs.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},D.isRequired(e,"connection"),D.isRequired(n,"logger"),D.isRequired(o,"protocol"),this.serverTimeoutInMilliseconds=Rp,this.keepAliveIntervalInMilliseconds=Pp,this._logger=n,this._protocol=o,this.connection=e,this._reconnectPolicy=r,this._handshakeProtocol=new fo,this.connection.onreceive=i=>this._processIncomingData(i),this.connection.onclose=i=>this._connectionClosed(i),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=S.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:k.Ping})}static create(e,n,o,r){return new t(e,n,o,r)}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==S.Disconnected&&this._connectionState!==S.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==S.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=S.Connecting,this._logger.log(d.Debug,"Starting HubConnection.");try{await this._startInternal(),M.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=S.Connected,this._connectionStarted=!0,this._logger.log(d.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=S.Disconnected,this._logger.log(d.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;let e=new Promise((n,o)=>{this._handshakeResolver=n,this._handshakeRejecter=o});await this.connection.start(this._protocol.transferFormat);try{let n={protocol:this._protocol.name,version:this._protocol.version};if(this._logger.log(d.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(n)),this._logger.log(d.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(n){throw this._logger.log(d.Debug,`Hub handshake failed with error '${n}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(n),n}}async stop(){let e=this._startPromise;this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch{}}_stopInternal(e){return this._connectionState===S.Disconnected?(this._logger.log(d.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve()):this._connectionState===S.Disconnecting?(this._logger.log(d.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState=S.Disconnecting,this._logger.log(d.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(d.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new P("The connection was stopped before the hub handshake could complete."),this.connection.stop(e)))}stream(e,...n){let[o,r]=this._replaceStreamingParams(n),i=this._createStreamInvocation(e,n,r),a,s=new _o;return s.cancelCallback=()=>{let c=this._createCancelInvocation(i.invocationId);return delete this._callbacks[i.invocationId],a.then(()=>this._sendWithProtocol(c))},this._callbacks[i.invocationId]=(c,p)=>{if(p){s.error(p);return}else c&&(c.type===k.Completion?c.error?s.error(new Error(c.error)):s.complete():s.next(c.item))},a=this._sendWithProtocol(i).catch(c=>{s.error(c),delete this._callbacks[i.invocationId]}),this._launchStreams(o,a),s}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._sendMessage(this._protocol.writeMessage(e))}send(e,...n){let[o,r]=this._replaceStreamingParams(n),i=this._sendWithProtocol(this._createInvocation(e,n,!0,r));return this._launchStreams(o,i),i}invoke(e,...n){let[o,r]=this._replaceStreamingParams(n),i=this._createInvocation(e,n,!1,r);return new Promise((s,c)=>{this._callbacks[i.invocationId]=(u,l)=>{if(l){c(l);return}else u&&(u.type===k.Completion?u.error?c(new Error(u.error)):s(u.result):c(new Error(`Unexpected message type: ${u.type}`)))};let p=this._sendWithProtocol(i).catch(u=>{c(u),delete this._callbacks[i.invocationId]});this._launchStreams(o,p)})}on(e,n){!e||!n||(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(n)===-1&&this._methods[e].push(n))}off(e,n){if(!e)return;e=e.toLowerCase();let o=this._methods[e];if(o)if(n){let r=o.indexOf(n);r!==-1&&(o.splice(r,1),o.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){let n=this._protocol.parseMessages(e,this._logger);for(let o of n)switch(o.type){case k.Invocation:this._invokeClientMethod(o);break;case k.StreamItem:case k.Completion:{let r=this._callbacks[o.invocationId];if(r){o.type===k.Completion&&delete this._callbacks[o.invocationId];try{r(o)}catch(i){this._logger.log(d.Error,`Stream callback threw error: ${ti(i)}`)}}break}case k.Ping:break;case k.Close:{this._logger.log(d.Information,"Close message received from server.");let r=o.error?new Error("Server returned an error on close: "+o.error):void 0;o.allowReconnect===!0?this.connection.stop(r):this._stopPromise=this._stopInternal(r);break}default:this._logger.log(d.Warning,`Invalid message type: ${o.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let n,o;try{[o,n]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(r){let i="Error parsing handshake response: "+r;this._logger.log(d.Error,i);let a=new Error(i);throw this._handshakeRejecter(a),a}if(n.error){let r="Server returned handshake error: "+n.error;this._logger.log(d.Error,r);let i=new Error(r);throw this._handshakeRejecter(i),i}else this._logger.log(d.Debug,"Server handshake complete.");return this._handshakeResolver(),o}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===S.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){let n=e.target.toLowerCase(),o=this._methods[n];if(!o){this._logger.log(d.Warning,`No client method with the name '${n}' found.`),e.invocationId&&(this._logger.log(d.Warning,`No result given for '${n}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)));return}let r=o.slice(),i=!!e.invocationId,a,s,c;for(let p of r)try{let u=a;a=await p.apply(this,e.arguments),i&&a&&u&&(this._logger.log(d.Error,`Multiple results provided for '${n}'. Sending error to server.`),c=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),s=void 0}catch(u){s=u,this._logger.log(d.Error,`A callback for the method '${n}' threw error '${u}'.`)}c?await this._sendWithProtocol(c):i?(s?c=this._createCompletionMessage(e.invocationId,`${s}`,null):a!==void 0?c=this._createCompletionMessage(e.invocationId,null,a):(this._logger.log(d.Warning,`No result given for '${n}' method and invocation ID '${e.invocationId}'.`),c=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(c)):a&&this._logger.log(d.Error,`Result given for '${n}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(d.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new P("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===S.Disconnecting?this._completeClose(e):this._connectionState===S.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===S.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=S.Disconnected,this._connectionStarted=!1,M.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(n=>n.apply(this,[e]))}catch(n){this._logger.log(d.Error,`An onclose callback called with error '${e}' threw error '${n}'.`)}}}async _reconnect(e){let n=Date.now(),o=0,r=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),i=this._getNextRetryDelay(o++,0,r);if(i===null){this._logger.log(d.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(e);return}if(this._connectionState=S.Reconnecting,e?this._logger.log(d.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(d.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(a=>a.apply(this,[e]))}catch(a){this._logger.log(d.Error,`An onreconnecting callback called with error '${e}' threw error '${a}'.`)}if(this._connectionState!==S.Reconnecting){this._logger.log(d.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;i!==null;){if(this._logger.log(d.Information,`Reconnect attempt number ${o} will start in ${i} ms.`),await new Promise(a=>{this._reconnectDelayHandle=setTimeout(a,i)}),this._reconnectDelayHandle=void 0,this._connectionState!==S.Reconnecting){this._logger.log(d.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=S.Connected,this._logger.log(d.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(a=>a.apply(this,[this.connection.connectionId]))}catch(a){this._logger.log(d.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${a}'.`)}return}catch(a){if(this._logger.log(d.Information,`Reconnect attempt failed because of error '${a}'.`),this._connectionState!==S.Reconnecting){this._logger.log(d.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===S.Disconnecting&&this._completeClose();return}r=a instanceof Error?a:new Error(a.toString()),i=this._getNextRetryDelay(o++,Date.now()-n,r)}}this._logger.log(d.Information,`Reconnect retries have been exhausted after ${Date.now()-n} ms and ${o} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,n,o){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:n,previousRetryCount:e,retryReason:o})}catch(r){return this._logger.log(d.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${n}) threw error '${r}'.`),null}}_cancelCallbacksWithError(e){let n=this._callbacks;this._callbacks={},Object.keys(n).forEach(o=>{let r=n[o];try{r(null,e)}catch(i){this._logger.log(d.Error,`Stream 'error' callback called with '${e}' threw error: ${ti(i)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,n,o,r){if(o)return r.length!==0?{arguments:n,streamIds:r,target:e,type:k.Invocation}:{arguments:n,target:e,type:k.Invocation};{let i=this._invocationId;return this._invocationId++,r.length!==0?{arguments:n,invocationId:i.toString(),streamIds:r,target:e,type:k.Invocation}:{arguments:n,invocationId:i.toString(),target:e,type:k.Invocation}}}_launchStreams(e,n){if(e.length!==0){n||(n=Promise.resolve());for(let o in e)e[o].subscribe({complete:()=>{n=n.then(()=>this._sendWithProtocol(this._createCompletionMessage(o)))},error:r=>{let i;r instanceof Error?i=r.message:r&&r.toString?i=r.toString():i="Unknown error",n=n.then(()=>this._sendWithProtocol(this._createCompletionMessage(o,i)))},next:r=>{n=n.then(()=>this._sendWithProtocol(this._createStreamItemMessage(o,r)))}})}}_replaceStreamingParams(e){let n=[],o=[];for(let r=0;r<e.length;r++){let i=e[r];if(this._isObservable(i)){let a=this._invocationId;this._invocationId++,n[a]=i,o.push(a.toString()),e.splice(r,1)}}return[n,o]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,n,o){let r=this._invocationId;return this._invocationId++,o.length!==0?{arguments:n,invocationId:r.toString(),streamIds:o,target:e,type:k.StreamInvocation}:{arguments:n,invocationId:r.toString(),target:e,type:k.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:k.CancelInvocation}}_createStreamItemMessage(e,n){return{invocationId:e,item:n,type:k.StreamItem}}_createCompletionMessage(e,n,o){return n?{error:n,invocationId:e,type:k.Completion}:{invocationId:e,result:o,type:k.Completion}}};var Wp=[0,2e3,1e4,3e4,null],Rt=class{constructor(e){this._retryDelays=e!==void 0?[...e,null]:Wp}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}};var ne=class{};ne.Authorization="Authorization";ne.Cookie="Cookie";var So=class extends ce{constructor(e,n){super(),this._innerClient=e,this._accessTokenFactory=n}async send(e){let n=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(n=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);let o=await this._innerClient.send(e);return n&&o.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):o}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[ne.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[ne.Authorization]&&delete e.headers[ne.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}};var C;(function(t){t[t.None=0]="None",t[t.WebSockets=1]="WebSockets",t[t.ServerSentEvents=2]="ServerSentEvents",t[t.LongPolling=4]="LongPolling"})(C||(C={}));var y;(function(t){t[t.Text=1]="Text",t[t.Binary=2]="Binary"})(y||(y={}));var ko=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};var Pt=class{constructor(e,n,o){this._httpClient=e,this._logger=n,this._pollAbort=new ko,this._options=o,this._running=!1,this.onreceive=null,this.onclose=null}get pollAborted(){return this._pollAbort.aborted}async connect(e,n){if(D.isRequired(e,"url"),D.isRequired(n,"transferFormat"),D.isIn(n,y,"transferFormat"),this._url=e,this._logger.log(d.Trace,"(LongPolling transport) Connecting."),n===y.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");let[o,r]=ue(),i={[o]:r,...this._options.headers},a={abortSignal:this._pollAbort.signal,headers:i,timeout:1e5,withCredentials:this._options.withCredentials};n===y.Binary&&(a.responseType="arraybuffer");let s=`${e}&_=${Date.now()}`;this._logger.log(d.Trace,`(LongPolling transport) polling: ${s}.`);let c=await this._httpClient.get(s,a);c.statusCode!==200?(this._logger.log(d.Error,`(LongPolling transport) Unexpected response code: ${c.statusCode}.`),this._closeError=new ee(c.statusText||"",c.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,a)}async _poll(e,n){try{for(;this._running;)try{let o=`${e}&_=${Date.now()}`;this._logger.log(d.Trace,`(LongPolling transport) polling: ${o}.`);let r=await this._httpClient.get(o,n);r.statusCode===204?(this._logger.log(d.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):r.statusCode!==200?(this._logger.log(d.Error,`(LongPolling transport) Unexpected response code: ${r.statusCode}.`),this._closeError=new ee(r.statusText||"",r.statusCode),this._running=!1):r.content?(this._logger.log(d.Trace,`(LongPolling transport) data received. ${Se(r.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(r.content)):this._logger.log(d.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(o){this._running?o instanceof _e?this._logger.log(d.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=o,this._running=!1):this._logger.log(d.Trace,`(LongPolling transport) Poll errored after shutdown: ${o.message}`)}}finally{this._logger.log(d.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?xo(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(d.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(d.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);let e={},[n,o]=ue();e[n]=o;let r={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};await this._httpClient.delete(this._url,r),this._logger.log(d.Trace,"(LongPolling transport) DELETE request sent.")}finally{this._logger.log(d.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(d.Trace,e),this.onclose(this._closeError)}}};var To=class{constructor(e,n,o,r){this._httpClient=e,this._accessToken=n,this._logger=o,this._options=r,this.onreceive=null,this.onclose=null}async connect(e,n){return D.isRequired(e,"url"),D.isRequired(n,"transferFormat"),D.isIn(n,y,"transferFormat"),this._logger.log(d.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((o,r)=>{let i=!1;if(n!==y.Text){r(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let a;if(M.isBrowser||M.isWebWorker)a=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{let s=this._httpClient.getCookieString(e),c={};c.Cookie=s;let[p,u]=ue();c[p]=u,a=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...c,...this._options.headers}})}try{a.onmessage=s=>{if(this.onreceive)try{this._logger.log(d.Trace,`(SSE transport) data received. ${Se(s.data,this._options.logMessageContent)}.`),this.onreceive(s.data)}catch(c){this._close(c);return}},a.onerror=s=>{i?this._close():r(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},a.onopen=()=>{this._logger.log(d.Information,`SSE connected to ${this._url}`),this._eventSource=a,i=!0,o()}}catch(s){r(s);return}})}async send(e){return this._eventSource?xo(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}};var Ao=class{constructor(e,n,o,r,i,a){this._logger=o,this._accessTokenFactory=n,this._logMessageContent=r,this._webSocketConstructor=i,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=a}async connect(e,n){D.isRequired(e,"url"),D.isRequired(n,"transferFormat"),D.isIn(n,y,"transferFormat"),this._logger.log(d.Trace,"(WebSockets transport) Connecting.");let o;return this._accessTokenFactory&&(o=await this._accessTokenFactory()),new Promise((r,i)=>{e=e.replace(/^http/,"ws");let a,s=this._httpClient.getCookieString(e),c=!1;if(M.isNode||M.isReactNative){let p={},[u,l]=ue();p[u]=l,o&&(p[ne.Authorization]=`Bearer ${o}`),s&&(p[ne.Cookie]=s),a=new this._webSocketConstructor(e,void 0,{headers:{...p,...this._headers}})}else o&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(o)}`);a||(a=new this._webSocketConstructor(e)),n===y.Binary&&(a.binaryType="arraybuffer"),a.onopen=p=>{this._logger.log(d.Information,`WebSocket connected to ${e}.`),this._webSocket=a,c=!0,r()},a.onerror=p=>{let u=null;typeof ErrorEvent<"u"&&p instanceof ErrorEvent?u=p.error:u="There was an error with the transport",this._logger.log(d.Information,`(WebSockets transport) ${u}.`)},a.onmessage=p=>{if(this._logger.log(d.Trace,`(WebSockets transport) data received. ${Se(p.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(p.data)}catch(u){this._close(u);return}},a.onclose=p=>{if(c)this._close(p);else{let u=null;typeof ErrorEvent<"u"&&p instanceof ErrorEvent?u=p.error:u="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",i(new Error(u))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(d.Trace,`(WebSockets transport) sending data. ${Se(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(d.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(e)&&(e.wasClean===!1||e.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)):e instanceof Error?this.onclose(e):this.onclose())}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}};var Ts=100,vo=class{constructor(e,n={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,D.isRequired(e,"url"),this._logger=_s(n.logger),this.baseUrl=this._resolveUrl(e),n=n||{},n.logMessageContent=n.logMessageContent===void 0?!1:n.logMessageContent,typeof n.withCredentials=="boolean"||n.withCredentials===void 0)n.withCredentials=n.withCredentials===void 0?!0:n.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");n.timeout=n.timeout===void 0?100*1e3:n.timeout;let o=null,r=null;if(M.isNode&&typeof Ie<"u"){let i=typeof __webpack_require__=="function"?__non_webpack_require__:Ie;o=i("ws"),r=i("eventsource")}!M.isNode&&typeof WebSocket<"u"&&!n.WebSocket?n.WebSocket=WebSocket:M.isNode&&!n.WebSocket&&o&&(n.WebSocket=o),!M.isNode&&typeof EventSource<"u"&&!n.EventSource?n.EventSource=EventSource:M.isNode&&!n.EventSource&&typeof r<"u"&&(n.EventSource=r),this._httpClient=new So(n.httpClient||new wo(this._logger),n.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=n,this.onreceive=null,this.onclose=null}async start(e){if(e=e||y.Binary,D.isIn(e,y,"transferFormat"),this._logger.log(d.Debug,`Starting connection with transfer format '${y[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,this._connectionState==="Disconnecting"){let n="Failed to start the HttpConnection before stop() was called.";return this._logger.log(d.Error,n),await this._stopPromise,Promise.reject(new P(n))}else if(this._connectionState!=="Connected"){let n="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(d.Error,n),Promise.reject(new P(n))}this._connectionStarted=!0}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new ni(this.transport)),this._sendQueue.send(e))}async stop(e){if(this._connectionState==="Disconnected")return this._logger.log(d.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(d.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(n=>{this._stopPromiseResolver=n}),await this._stopInternal(e),await this._stopPromise}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(n){this._logger.log(d.Error,`HttpConnection.transport.stop() threw error '${n}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(d.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let n=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===C.WebSockets)this.transport=this._constructTransport(C.WebSockets),await this._startTransport(n,e);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let o=null,r=0;do{if(o=await this._getNegotiationResponse(n),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new P("The connection was stopped during negotiation.");if(o.error)throw new Error(o.error);if(o.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(o.url&&(n=o.url),o.accessToken){let i=o.accessToken;this._accessTokenFactory=()=>i,this._httpClient._accessToken=i,this._httpClient._accessTokenFactory=void 0}r++}while(o.url&&r<Ts);if(r===Ts&&o.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(n,this._options.transport,o,e)}this.transport instanceof Pt&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(d.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(o){return this._logger.log(d.Error,"Failed to start the connection: "+o),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(o)}}async _getNegotiationResponse(e){let n={},[o,r]=ue();n[o]=r;let i=this._resolveNegotiateUrl(e);this._logger.log(d.Debug,`Sending negotiation request: ${i}.`);try{let a=await this._httpClient.post(i,{content:"",headers:{...n,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(a.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${a.statusCode}'`));let s=JSON.parse(a.content);return(!s.negotiateVersion||s.negotiateVersion<1)&&(s.connectionToken=s.connectionId),s}catch(a){let s="Failed to complete negotiation with the server: "+a;return a instanceof ee&&a.statusCode===404&&(s=s+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(d.Error,s),Promise.reject(new lo(s))}}_createConnectUrl(e,n){return n?e+(e.indexOf("?")===-1?"?":"&")+`id=${n}`:e}async _createTransport(e,n,o,r){let i=this._createConnectUrl(e,o.connectionToken);if(this._isITransport(n)){this._logger.log(d.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=n,await this._startTransport(i,r),this.connectionId=o.connectionId;return}let a=[],s=o.availableTransports||[],c=o;for(let p of s){let u=this._resolveTransportOrError(p,n,r);if(u instanceof Error)a.push(`${p.transport} failed:`),a.push(u);else if(this._isITransport(u)){if(this.transport=u,!c){try{c=await this._getNegotiationResponse(e)}catch(l){return Promise.reject(l)}i=this._createConnectUrl(e,c.connectionToken)}try{await this._startTransport(i,r),this.connectionId=c.connectionId;return}catch(l){if(this._logger.log(d.Error,`Failed to start the transport '${p.transport}': ${l}`),c=void 0,a.push(new uo(`${p.transport} failed: ${l}`,C[p.transport])),this._connectionState!=="Connecting"){let h="Failed to select transport before stop() was called.";return this._logger.log(d.Debug,h),Promise.reject(new P(h))}}}}return a.length>0?Promise.reject(new mo(`Unable to connect to the server with any of the available transports. ${a.join(" ")}`,a)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case C.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Ao(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case C.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new To(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case C.LongPolling:return new Pt(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,n){return this.transport.onreceive=this.onreceive,this.transport.onclose=o=>this._stopConnection(o),this.transport.connect(e,n)}_resolveTransportOrError(e,n,o){let r=C[e.transport];if(r==null)return this._logger.log(d.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(Vp(n,r))if(e.transferFormats.map(a=>y[a]).indexOf(o)>=0){if(r===C.WebSockets&&!this._options.WebSocket||r===C.ServerSentEvents&&!this._options.EventSource)return this._logger.log(d.Debug,`Skipping transport '${C[r]}' because it is not supported in your environment.'`),new co(`'${C[r]}' is not supported in your environment.`,r);this._logger.log(d.Debug,`Selecting transport '${C[r]}'.`);try{return this._constructTransport(r)}catch(a){return a}}else return this._logger.log(d.Debug,`Skipping transport '${C[r]}' because it does not support the requested transfer format '${y[o]}'.`),new Error(`'${C[r]}' does not support ${y[o]}.`);else return this._logger.log(d.Debug,`Skipping transport '${C[r]}' because it was disabled by the client.`),new po(`'${C[r]}' is disabled by the client.`,r)}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(d.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(d.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(d.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(d.Error,`Connection disconnected with error '${e}'.`):this._logger.log(d.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(n=>{this._logger.log(d.Error,`TransportSendQueue.stop() threw error '${n}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(n){this._logger.log(d.Error,`HttpConnection.onclose(${e}) threw error '${n}'.`)}}}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!M.isBrowser)throw new Error(`Cannot resolve '${e}'.`);let n=window.document.createElement("a");return n.href=e,this._logger.log(d.Information,`Normalizing '${e}' to '${n.href}'.`),n.href}_resolveNegotiateUrl(e){let n=e.indexOf("?"),o=e.substring(0,n===-1?e.length:n);return o[o.length-1]!=="/"&&(o+="/"),o+="negotiate",o+=n===-1?"":e.substring(n),o.indexOf("negotiateVersion")===-1&&(o+=n===-1?"?":"&",o+="negotiateVersion="+this._negotiateVersion),o}};function Vp(t,e){return!t||(e&t)!==0}var ni=class t{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new ot,this._transportResult=new ot,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new ot),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new ot;let e=this._transportResult;this._transportResult=void 0;let n=typeof this._buffer[0]=="string"?this._buffer.join(""):t._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(n),e.resolve()}catch(o){e.reject(o)}}}static _concatBuffers(e){let n=e.map(i=>i.byteLength).reduce((i,a)=>i+a),o=new Uint8Array(n),r=0;for(let i of e)o.set(new Uint8Array(i),r),r+=i.byteLength;return o.buffer}},ot=class{constructor(){this.promise=new Promise((e,n)=>[this._resolver,this._rejecter]=[e,n])}resolve(){this._resolver()}reject(e){this._rejecter(e)}};var Ip="json",Do=class{constructor(){this.name=Ip,this.version=1,this.transferFormat=y.Text}parseMessages(e,n){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];n===null&&(n=pe.instance);let o=G.parse(e),r=[];for(let i of o){let a=JSON.parse(i);if(typeof a.type!="number")throw new Error("Invalid payload.");switch(a.type){case k.Invocation:this._isInvocationMessage(a);break;case k.StreamItem:this._isStreamItemMessage(a);break;case k.Completion:this._isCompletionMessage(a);break;case k.Ping:break;case k.Close:break;default:n.log(d.Information,"Unknown message type '"+a.type+"' ignored.");continue}r.push(a)}return r}writeMessage(e){return G.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_assertNotEmptyString(e,n){if(typeof e!="string"||e==="")throw new Error(n)}};var Hp={trace:d.Trace,debug:d.Debug,info:d.Information,information:d.Information,warn:d.Warning,warning:d.Warning,error:d.Error,critical:d.Critical,none:d.None};function Op(t){let e=Hp[t.toLowerCase()];if(typeof e<"u")return e;throw new Error(`Unknown log level: ${t}`)}var Wt=class{configureLogging(e){if(D.isRequired(e,"logging"),Np(e))this.logger=e;else if(typeof e=="string"){let n=Op(e);this.logger=new Pe(n)}else this.logger=new Pe(e);return this}withUrl(e,n){return D.isRequired(e,"url"),D.isNotEmpty(e,"url"),this.url=e,typeof n=="object"?this.httpConnectionOptions={...this.httpConnectionOptions,...n}:this.httpConnectionOptions={...this.httpConnectionOptions,transport:n},this}withHubProtocol(e){return D.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new Rt(e):this.reconnectPolicy=e:this.reconnectPolicy=new Rt,this}build(){let e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");let n=new vo(this.url,e);return Lt.create(n,this.logger||pe.instance,this.protocol||new Do,this.reconnectPolicy)}};function Np(t){return t.log!==void 0}var Xp=new Map([[S.Connected,_.Connected],[S.Connecting,_.Connecting],[S.Reconnecting,_.Connecting],[S.Disconnected,_.Disconnected],[S.Disconnecting,_.Disconnecting]]),Mo=class extends R{hub;constructor(e){super(),this.hub=new Wt().withAutomaticReconnect().withUrl(e,C.WebSockets).build(),this.hub.onclose(()=>this.dispatchEvent(new Zn)),this.hub.onreconnecting(o=>this.dispatchEvent(new eo(o))),this.hub.onreconnected(()=>this.dispatchEvent(new to)),this.hub.on("userJoined",(o,r)=>this.dispatchEvent(new no(o,r))),this.hub.on("iceReceived",(o,r)=>this.dispatchEvent(new oo(o,r))),this.hub.on("offerReceived",(o,r)=>this.dispatchEvent(new ro(o,r))),this.hub.on("answerReceived",(o,r)=>this.dispatchEvent(new io(o,r))),this.hub.on("userLeft",o=>this.dispatchEvent(new ao(o)));let n=new so;this.hub.on("chat",(o,r)=>{n.set(o,r),this.dispatchEvent(n)}),window.addEventListener("unload",()=>this.stop())}start(){return this.hub.start()}stop(){return this.hub.stop()}invoke(e,...n){return this.hub.invoke(e,...n)}get connectionState(){return Xp.get(this.hub.state)}};var oi=class extends Dn{hubName=null;constructor(e){super(e),Object.seal(this)}async init(e){if(this.hubName=e.get("hub"),!this.hubName)throw new Error("Missing hub parameter");await super.init(e)}setConferenceInfo(e,n,o){return this.log("connect",{userName:n,meetingID:o,userType:e}),super.setConferenceInfo(e,n,o)}createConference(){return new Yn(this.env.audio,this.env.microphones,this.env.webcams,new Mo(this.hubName))}};export{oi as default};
