var d_=Object.create;var wp=Object.defineProperty;var h_=Object.getOwnPropertyDescriptor;var m_=Object.getOwnPropertyNames;var f_=Object.getPrototypeOf,g_=Object.prototype.hasOwnProperty;var x_=(r,t,e)=>t in r?wp(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var Ag=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(t,e)=>(typeof require<"u"?require:t)[e]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var zo=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),pr=(r,t)=>{for(var e in t)wp(r,e,{get:t[e],enumerable:!0})},w_=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of m_(t))!g_.call(r,i)&&i!==e&&wp(r,i,{get:()=>t[i],enumerable:!(n=h_(t,i))||n.enumerable});return r};var K1=(r,t,e)=>(e=r!=null?d_(f_(r)):{},w_(t||!r||!r.__esModule?wp(e,"default",{value:r,enumerable:!0}):e,r));var _n=(r,t,e)=>(x_(r,typeof t!="symbol"?t+"":t,e),e),bg=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var H=(r,t,e)=>(bg(r,t,"read from private field"),e?e.call(r):t.get(r)),Fe=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},He=(r,t,e,n)=>(bg(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e),Sg=(r,t,e,n)=>({set _(i){He(r,t,i,e)},get _(){return H(r,t,n)}}),_e=(r,t,e)=>(bg(r,t,"access private method"),e);var Hy=zo((Rw,Bw)=>{(function(r,t){typeof Rw=="object"&&typeof Bw<"u"?Bw.exports=t():typeof define=="function"&&define.amd?define(t):r.CardboardVRDisplay=t()})(Rw,function(){"use strict";var r=function(){function x(_){this.value=_}function F(_){var I,W;function re(Ee,me){return new Promise(function(we,Ve){var Ke={key:Ee,arg:me,resolve:we,reject:Ve,next:null};W?W=W.next=Ke:(I=W=Ke,le(Ee,me))})}function le(Ee,me){try{var we=_[Ee](me),Ve=we.value;Ve instanceof x?Promise.resolve(Ve.value).then(function(Ke){le("next",Ke)},function(Ke){le("throw",Ke)}):Me(we.done?"return":"normal",we.value)}catch(Ke){Me("throw",Ke)}}function Me(Ee,me){switch(Ee){case"return":I.resolve({value:me,done:!0});break;case"throw":I.reject(me);break;default:I.resolve({value:me,done:!1});break}I=I.next,I?le(I.key,I.arg):W=null}this._invoke=re,typeof _.return!="function"&&(this.return=void 0)}return typeof Symbol=="function"&&Symbol.asyncIterator&&(F.prototype[Symbol.asyncIterator]=function(){return this}),F.prototype.next=function(_){return this._invoke("next",_)},F.prototype.throw=function(_){return this._invoke("throw",_)},F.prototype.return=function(_){return this._invoke("return",_)},{wrap:function(_){return function(){return new F(_.apply(this,arguments))}},await:function(_){return new x(_)}}}(),t=function(x,F){if(!(x instanceof F))throw new TypeError("Cannot call a class as a function")},e=function(){function x(F,_){for(var I=0;I<_.length;I++){var W=_[I];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(F,W.key,W)}}return function(F,_,I){return _&&x(F.prototype,_),I&&x(F,I),F}}(),n=function(){function x(F,_){var I=[],W=!0,re=!1,le=void 0;try{for(var Me=F[Symbol.iterator](),Ee;!(W=(Ee=Me.next()).done)&&(I.push(Ee.value),!(_&&I.length===_));W=!0);}catch(me){re=!0,le=me}finally{try{!W&&Me.return&&Me.return()}finally{if(re)throw le}}return I}return function(F,_){if(Array.isArray(F))return F;if(Symbol.iterator in Object(F))return x(F,_);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=.001,o=1,s=function(F,_){return"data:"+F+","+encodeURIComponent(_)},l=function(F,_,I){return F+(_-F)*I},c=function(){var x=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return x}}(),u=function(){var x=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return x}}(),p=function(){var x=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return x}}(),f=function(){var x=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return x}}(),w=function(){var x=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),F=x?parseInt(x[1],10):null;return function(){return F}}(),A=function(){var x=!1;return x=c()&&p()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return x}}(),m=function(){var x=!1;if(w()===65){var F=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(F){var _=F[1].split("."),I=n(_,4),W=I[0],re=I[1],le=I[2],Me=I[3];x=parseInt(le,10)===3325&&parseInt(Me,10)<148}}return function(){return x}}(),d=function(){var x=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return x}}(),h=function(){var F=window.orientation==90||window.orientation==-90;return d()?!F:F},M=function(F){return!(isNaN(F)||F<=i||F>o)},k=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},E=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},b=function(F){if(u())return!1;if(F.requestFullscreen)F.requestFullscreen();else if(F.webkitRequestFullscreen)F.webkitRequestFullscreen();else if(F.mozRequestFullScreen)F.mozRequestFullScreen();else if(F.msRequestFullscreen)F.msRequestFullscreen();else return!1;return!0},g=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},v=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},y=function(F,_,I,W){var re=F.createShader(F.VERTEX_SHADER);F.shaderSource(re,_),F.compileShader(re);var le=F.createShader(F.FRAGMENT_SHADER);F.shaderSource(le,I),F.compileShader(le);var Me=F.createProgram();F.attachShader(Me,re),F.attachShader(Me,le);for(var Ee in W)F.bindAttribLocation(Me,W[Ee],Ee);return F.linkProgram(Me),F.deleteShader(re),F.deleteShader(le),Me},V=function(F,_){for(var I={},W=F.getProgramParameter(_,F.ACTIVE_UNIFORMS),re="",le=0;le<W;le++){var Me=F.getActiveUniform(_,le);re=Me.name.replace("[0]",""),I[re]=F.getUniformLocation(_,re)}return I},B=function(F,_,I,W,re,le,Me){var Ee=1/(_-I),me=1/(W-re),we=1/(le-Me);return F[0]=-2*Ee,F[1]=0,F[2]=0,F[3]=0,F[4]=0,F[5]=-2*me,F[6]=0,F[7]=0,F[8]=0,F[9]=0,F[10]=2*we,F[11]=0,F[12]=(_+I)*Ee,F[13]=(re+W)*me,F[14]=(Me+le)*we,F[15]=1,F},D=function(){var F=!1;return function(_){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(_)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(_.substr(0,4)))&&(F=!0)}(navigator.userAgent||navigator.vendor||window.opera),F},L=function(F,_){for(var I in _)_.hasOwnProperty(I)&&(F[I]=_[I]);return F},J=function(F){if(c()){var _=F.style.width,I=F.style.height;F.style.width=parseInt(_)+1+"px",F.style.height=parseInt(I)+"px",setTimeout(function(){F.style.width=_,F.style.height=I},100)}window.canvas=F},ae=function(){var x=Math.PI/180,F=Math.PI*.25;function _(me,we,Ve,Ke){var rt=Math.tan(we?we.upDegrees*x:F),lt=Math.tan(we?we.downDegrees*x:F),kt=Math.tan(we?we.leftDegrees*x:F),dt=Math.tan(we?we.rightDegrees*x:F),ut=2/(kt+dt),cn=2/(rt+lt);return me[0]=ut,me[1]=0,me[2]=0,me[3]=0,me[4]=0,me[5]=cn,me[6]=0,me[7]=0,me[8]=-((kt-dt)*ut*.5),me[9]=(rt-lt)*cn*.5,me[10]=Ke/(Ve-Ke),me[11]=-1,me[12]=0,me[13]=0,me[14]=Ke*Ve/(Ve-Ke),me[15]=0,me}function I(me,we,Ve){var Ke=we[0],rt=we[1],lt=we[2],kt=we[3],dt=Ke+Ke,ut=rt+rt,cn=lt+lt,Rn=Ke*dt,qn=Ke*ut,Fn=Ke*cn,ur=rt*ut,jr=rt*cn,Gr=lt*cn,Xr=kt*dt,qr=kt*ut,Uo=kt*cn;return me[0]=1-(ur+Gr),me[1]=qn+Uo,me[2]=Fn-qr,me[3]=0,me[4]=qn-Uo,me[5]=1-(Rn+Gr),me[6]=jr+Xr,me[7]=0,me[8]=Fn+qr,me[9]=jr-Xr,me[10]=1-(Rn+ur),me[11]=0,me[12]=Ve[0],me[13]=Ve[1],me[14]=Ve[2],me[15]=1,me}function W(me,we,Ve){var Ke=Ve[0],rt=Ve[1],lt=Ve[2],kt,dt,ut,cn,Rn,qn,Fn,ur,jr,Gr,Xr,qr;return we===me?(me[12]=we[0]*Ke+we[4]*rt+we[8]*lt+we[12],me[13]=we[1]*Ke+we[5]*rt+we[9]*lt+we[13],me[14]=we[2]*Ke+we[6]*rt+we[10]*lt+we[14],me[15]=we[3]*Ke+we[7]*rt+we[11]*lt+we[15]):(kt=we[0],dt=we[1],ut=we[2],cn=we[3],Rn=we[4],qn=we[5],Fn=we[6],ur=we[7],jr=we[8],Gr=we[9],Xr=we[10],qr=we[11],me[0]=kt,me[1]=dt,me[2]=ut,me[3]=cn,me[4]=Rn,me[5]=qn,me[6]=Fn,me[7]=ur,me[8]=jr,me[9]=Gr,me[10]=Xr,me[11]=qr,me[12]=kt*Ke+Rn*rt+jr*lt+we[12],me[13]=dt*Ke+qn*rt+Gr*lt+we[13],me[14]=ut*Ke+Fn*rt+Xr*lt+we[14],me[15]=cn*Ke+ur*rt+qr*lt+we[15]),me}function re(me,we){var Ve=we[0],Ke=we[1],rt=we[2],lt=we[3],kt=we[4],dt=we[5],ut=we[6],cn=we[7],Rn=we[8],qn=we[9],Fn=we[10],ur=we[11],jr=we[12],Gr=we[13],Xr=we[14],qr=we[15],Uo=Ve*dt-Ke*kt,Sc=Ve*ut-rt*kt,yc=Ve*cn-lt*kt,Tc=Ke*ut-rt*dt,Ec=Ke*cn-lt*dt,_c=rt*cn-lt*ut,Mc=Rn*Gr-qn*jr,kc=Rn*Xr-Fn*jr,Cc=Rn*qr-ur*jr,Dc=qn*Xr-Fn*Gr,Pc=qn*qr-ur*Gr,Lc=Fn*qr-ur*Xr,Wn=Uo*Lc-Sc*Pc+yc*Dc+Tc*Cc-Ec*kc+_c*Mc;return Wn?(Wn=1/Wn,me[0]=(dt*Lc-ut*Pc+cn*Dc)*Wn,me[1]=(rt*Pc-Ke*Lc-lt*Dc)*Wn,me[2]=(Gr*_c-Xr*Ec+qr*Tc)*Wn,me[3]=(Fn*Ec-qn*_c-ur*Tc)*Wn,me[4]=(ut*Cc-kt*Lc-cn*kc)*Wn,me[5]=(Ve*Lc-rt*Cc+lt*kc)*Wn,me[6]=(Xr*yc-jr*_c-qr*Sc)*Wn,me[7]=(Rn*_c-Fn*yc+ur*Sc)*Wn,me[8]=(kt*Pc-dt*Cc+cn*Mc)*Wn,me[9]=(Ke*Cc-Ve*Pc-lt*Mc)*Wn,me[10]=(jr*Ec-Gr*yc+qr*Uo)*Wn,me[11]=(qn*yc-Rn*Ec-ur*Uo)*Wn,me[12]=(dt*kc-kt*Dc-ut*Mc)*Wn,me[13]=(Ve*Dc-Ke*kc+rt*Mc)*Wn,me[14]=(Gr*Sc-jr*Tc-Xr*Uo)*Wn,me[15]=(Rn*Tc-qn*Sc+Fn*Uo)*Wn,me):null}var le=new Float32Array([0,0,0,1]),Me=new Float32Array([0,0,0]);function Ee(me,we,Ve,Ke,rt,lt){_(me,Ke||null,lt.depthNear,lt.depthFar);var kt=Ve.orientation||le,dt=Ve.position||Me;I(we,kt,dt),rt&&W(we,we,rt),re(we,we)}return function(me,we,Ve){return!me||!we?!1:(me.pose=we,me.timestamp=we.timestamp,Ee(me.leftProjectionMatrix,me.leftViewMatrix,we,Ve._getFieldOfView("left"),Ve._getEyeOffset("left"),Ve),Ee(me.rightProjectionMatrix,me.rightViewMatrix,we,Ve._getFieldOfView("right"),Ve._getEyeOffset("right"),Ve),!0)}}(),Q=function(){var F=window.self!==window.top,_=ee(document.referrer),I=ee(window.location.href);return F&&_!==I},ee=function(F){var _,I=F.indexOf("://");I!==-1?_=I+3:_=0;var W=F.indexOf("/",_);return W===-1&&(W=F.length),F.substring(0,W)},K=function(F){if(F.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var _=2*Math.acos(F.w);return _},$=function(){var x={};return function(F,_){x[F]===void 0&&(console.warn("webvr-polyfill: "+_),x[F]=!0)}}(),te=function(F,_){var I=_?"Please use "+_+" instead.":"";$(F,F+" has been deprecated. This may not work on native WebVR displays. "+I)};function xe(x,F,_){if(!F){_(x);return}for(var I=[],W=null,re=0;re<F.length;++re){var le=F[re];switch(le){case x.TEXTURE_BINDING_2D:case x.TEXTURE_BINDING_CUBE_MAP:var Me=F[++re];if(Me<x.TEXTURE0||Me>x.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),I.push(null,null);break}W||(W=x.getParameter(x.ACTIVE_TEXTURE)),x.activeTexture(Me),I.push(x.getParameter(le),null);break;case x.ACTIVE_TEXTURE:W=x.getParameter(x.ACTIVE_TEXTURE),I.push(null);break;default:I.push(x.getParameter(le));break}}_(x);for(var re=0;re<F.length;++re){var le=F[re],Ee=I[re];switch(le){case x.ACTIVE_TEXTURE:break;case x.ARRAY_BUFFER_BINDING:x.bindBuffer(x.ARRAY_BUFFER,Ee);break;case x.COLOR_CLEAR_VALUE:x.clearColor(Ee[0],Ee[1],Ee[2],Ee[3]);break;case x.COLOR_WRITEMASK:x.colorMask(Ee[0],Ee[1],Ee[2],Ee[3]);break;case x.CURRENT_PROGRAM:x.useProgram(Ee);break;case x.ELEMENT_ARRAY_BUFFER_BINDING:x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,Ee);break;case x.FRAMEBUFFER_BINDING:x.bindFramebuffer(x.FRAMEBUFFER,Ee);break;case x.RENDERBUFFER_BINDING:x.bindRenderbuffer(x.RENDERBUFFER,Ee);break;case x.TEXTURE_BINDING_2D:var Me=F[++re];if(Me<x.TEXTURE0||Me>x.TEXTURE31)break;x.activeTexture(Me),x.bindTexture(x.TEXTURE_2D,Ee);break;case x.TEXTURE_BINDING_CUBE_MAP:var Me=F[++re];if(Me<x.TEXTURE0||Me>x.TEXTURE31)break;x.activeTexture(Me),x.bindTexture(x.TEXTURE_CUBE_MAP,Ee);break;case x.VIEWPORT:x.viewport(Ee[0],Ee[1],Ee[2],Ee[3]);break;case x.BLEND:case x.CULL_FACE:case x.DEPTH_TEST:case x.SCISSOR_TEST:case x.STENCIL_TEST:Ee?x.enable(le):x.disable(le);break;default:console.log("No GL restore behavior for 0x"+le.toString(16));break}W&&x.activeTexture(W)}}var be=xe,Ue=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),Y=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function P(x,F,_,I){this.gl=x,this.cardboardUI=F,this.bufferScale=_,this.dirtySubmitFrameBindings=I,this.ctxAttribs=x.getContextAttributes(),this.instanceExt=x.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=x.drawingBufferWidth,this.bufferHeight=x.drawingBufferHeight,this.realBindFramebuffer=x.bindFramebuffer,this.realEnable=x.enable,this.realDisable=x.disable,this.realColorMask=x.colorMask,this.realClearColor=x.clearColor,this.realViewport=x.viewport,c()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(x.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(x.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=y(x,Ue,Y,this.attribs),this.uniforms=V(x,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=x.createBuffer(),this.indexBuffer=x.createBuffer(),this.indexCount=0,this.renderTarget=x.createTexture(),this.framebuffer=x.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=x.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=x.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=x.createRenderbuffer()),this.patch(),this.onResize()}P.prototype.destroy=function(){var x=this.gl;this.unpatch(),x.deleteProgram(this.program),x.deleteBuffer(this.vertexBuffer),x.deleteBuffer(this.indexBuffer),x.deleteTexture(this.renderTarget),x.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&x.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&x.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&x.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},P.prototype.onResize=function(){var x=this.gl,F=this,_=[x.RENDERBUFFER_BINDING,x.TEXTURE_BINDING_2D,x.TEXTURE0];be(x,_,function(I){F.realBindFramebuffer.call(I,I.FRAMEBUFFER,null),F.scissorTest&&F.realDisable.call(I,I.SCISSOR_TEST),F.realColorMask.call(I,!0,!0,!0,!0),F.realViewport.call(I,0,0,I.drawingBufferWidth,I.drawingBufferHeight),F.realClearColor.call(I,0,0,0,1),I.clear(I.COLOR_BUFFER_BIT),F.realBindFramebuffer.call(I,I.FRAMEBUFFER,F.framebuffer),I.bindTexture(I.TEXTURE_2D,F.renderTarget),I.texImage2D(I.TEXTURE_2D,0,F.ctxAttribs.alpha?I.RGBA:I.RGB,F.bufferWidth,F.bufferHeight,0,F.ctxAttribs.alpha?I.RGBA:I.RGB,I.UNSIGNED_BYTE,null),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,F.renderTarget,0),F.ctxAttribs.depth&&F.ctxAttribs.stencil?(I.bindRenderbuffer(I.RENDERBUFFER,F.depthStencilBuffer),I.renderbufferStorage(I.RENDERBUFFER,I.DEPTH_STENCIL,F.bufferWidth,F.bufferHeight),I.framebufferRenderbuffer(I.FRAMEBUFFER,I.DEPTH_STENCIL_ATTACHMENT,I.RENDERBUFFER,F.depthStencilBuffer)):F.ctxAttribs.depth?(I.bindRenderbuffer(I.RENDERBUFFER,F.depthBuffer),I.renderbufferStorage(I.RENDERBUFFER,I.DEPTH_COMPONENT16,F.bufferWidth,F.bufferHeight),I.framebufferRenderbuffer(I.FRAMEBUFFER,I.DEPTH_ATTACHMENT,I.RENDERBUFFER,F.depthBuffer)):F.ctxAttribs.stencil&&(I.bindRenderbuffer(I.RENDERBUFFER,F.stencilBuffer),I.renderbufferStorage(I.RENDERBUFFER,I.STENCIL_INDEX8,F.bufferWidth,F.bufferHeight),I.framebufferRenderbuffer(I.FRAMEBUFFER,I.STENCIL_ATTACHMENT,I.RENDERBUFFER,F.stencilBuffer)),!I.checkFramebufferStatus(I.FRAMEBUFFER)===I.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),F.realBindFramebuffer.call(I,I.FRAMEBUFFER,F.lastBoundFramebuffer),F.scissorTest&&F.realEnable.call(I,I.SCISSOR_TEST),F.realColorMask.apply(I,F.colorMask),F.realViewport.apply(I,F.viewport),F.realClearColor.apply(I,F.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},P.prototype.patch=function(){if(!this.isPatched){var x=this,F=this.gl.canvas,_=this.gl;c()||(F.width=k()*this.bufferScale,F.height=E()*this.bufferScale,Object.defineProperty(F,"width",{configurable:!0,enumerable:!0,get:function(){return x.bufferWidth},set:function(W){x.bufferWidth=W,x.realCanvasWidth.set.call(F,W),x.onResize()}}),Object.defineProperty(F,"height",{configurable:!0,enumerable:!0,get:function(){return x.bufferHeight},set:function(W){x.bufferHeight=W,x.realCanvasHeight.set.call(F,W),x.onResize()}})),this.lastBoundFramebuffer=_.getParameter(_.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(_.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(I,W){x.lastBoundFramebuffer=W||x.framebuffer,x.realBindFramebuffer.call(_,I,x.lastBoundFramebuffer)},this.cullFace=_.getParameter(_.CULL_FACE),this.depthTest=_.getParameter(_.DEPTH_TEST),this.blend=_.getParameter(_.BLEND),this.scissorTest=_.getParameter(_.SCISSOR_TEST),this.stencilTest=_.getParameter(_.STENCIL_TEST),_.enable=function(I){switch(I){case _.CULL_FACE:x.cullFace=!0;break;case _.DEPTH_TEST:x.depthTest=!0;break;case _.BLEND:x.blend=!0;break;case _.SCISSOR_TEST:x.scissorTest=!0;break;case _.STENCIL_TEST:x.stencilTest=!0;break}x.realEnable.call(_,I)},_.disable=function(I){switch(I){case _.CULL_FACE:x.cullFace=!1;break;case _.DEPTH_TEST:x.depthTest=!1;break;case _.BLEND:x.blend=!1;break;case _.SCISSOR_TEST:x.scissorTest=!1;break;case _.STENCIL_TEST:x.stencilTest=!1;break}x.realDisable.call(_,I)},this.colorMask=_.getParameter(_.COLOR_WRITEMASK),_.colorMask=function(I,W,re,le){x.colorMask[0]=I,x.colorMask[1]=W,x.colorMask[2]=re,x.colorMask[3]=le,x.realColorMask.call(_,I,W,re,le)},this.clearColor=_.getParameter(_.COLOR_CLEAR_VALUE),_.clearColor=function(I,W,re,le){x.clearColor[0]=I,x.clearColor[1]=W,x.clearColor[2]=re,x.clearColor[3]=le,x.realClearColor.call(_,I,W,re,le)},this.viewport=_.getParameter(_.VIEWPORT),_.viewport=function(I,W,re,le){x.viewport[0]=I,x.viewport[1]=W,x.viewport[2]=re,x.viewport[3]=le,x.realViewport.call(_,I,W,re,le)},this.isPatched=!0,J(F)}},P.prototype.unpatch=function(){if(this.isPatched){var x=this.gl,F=this.gl.canvas;c()||(Object.defineProperty(F,"width",this.realCanvasWidth),Object.defineProperty(F,"height",this.realCanvasHeight)),F.width=this.bufferWidth,F.height=this.bufferHeight,x.bindFramebuffer=this.realBindFramebuffer,x.enable=this.realEnable,x.disable=this.realDisable,x.colorMask=this.realColorMask,x.clearColor=this.realClearColor,x.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&x.bindFramebuffer(x.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){J(F)},1)}},P.prototype.setTextureBounds=function(x,F){x||(x=[0,0,.5,1]),F||(F=[.5,0,.5,1]),this.viewportOffsetScale[0]=x[0],this.viewportOffsetScale[1]=x[1],this.viewportOffsetScale[2]=x[2],this.viewportOffsetScale[3]=x[3],this.viewportOffsetScale[4]=F[0],this.viewportOffsetScale[5]=F[1],this.viewportOffsetScale[6]=F[2],this.viewportOffsetScale[7]=F[3]},P.prototype.submitFrame=function(){var x=this.gl,F=this,_=[];if(this.dirtySubmitFrameBindings||_.push(x.CURRENT_PROGRAM,x.ARRAY_BUFFER_BINDING,x.ELEMENT_ARRAY_BUFFER_BINDING,x.TEXTURE_BINDING_2D,x.TEXTURE0),be(x,_,function(W){F.realBindFramebuffer.call(W,W.FRAMEBUFFER,null);var re=0,le=0;F.instanceExt&&(re=W.getVertexAttrib(F.attribs.position,F.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),le=W.getVertexAttrib(F.attribs.texCoord,F.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),F.cullFace&&F.realDisable.call(W,W.CULL_FACE),F.depthTest&&F.realDisable.call(W,W.DEPTH_TEST),F.blend&&F.realDisable.call(W,W.BLEND),F.scissorTest&&F.realDisable.call(W,W.SCISSOR_TEST),F.stencilTest&&F.realDisable.call(W,W.STENCIL_TEST),F.realColorMask.call(W,!0,!0,!0,!0),F.realViewport.call(W,0,0,W.drawingBufferWidth,W.drawingBufferHeight),(F.ctxAttribs.alpha||c())&&(F.realClearColor.call(W,0,0,0,1),W.clear(W.COLOR_BUFFER_BIT)),W.useProgram(F.program),W.bindBuffer(W.ELEMENT_ARRAY_BUFFER,F.indexBuffer),W.bindBuffer(W.ARRAY_BUFFER,F.vertexBuffer),W.enableVertexAttribArray(F.attribs.position),W.enableVertexAttribArray(F.attribs.texCoord),W.vertexAttribPointer(F.attribs.position,2,W.FLOAT,!1,20,0),W.vertexAttribPointer(F.attribs.texCoord,3,W.FLOAT,!1,20,8),F.instanceExt&&(re!=0&&F.instanceExt.vertexAttribDivisorANGLE(F.attribs.position,0),le!=0&&F.instanceExt.vertexAttribDivisorANGLE(F.attribs.texCoord,0)),W.activeTexture(W.TEXTURE0),W.uniform1i(F.uniforms.diffuse,0),W.bindTexture(W.TEXTURE_2D,F.renderTarget),W.uniform4fv(F.uniforms.viewportOffsetScale,F.viewportOffsetScale),W.drawElements(W.TRIANGLES,F.indexCount,W.UNSIGNED_SHORT,0),F.cardboardUI&&F.cardboardUI.renderNoState(),F.realBindFramebuffer.call(F.gl,W.FRAMEBUFFER,F.framebuffer),F.ctxAttribs.preserveDrawingBuffer||(F.realClearColor.call(W,0,0,0,0),W.clear(W.COLOR_BUFFER_BIT)),F.dirtySubmitFrameBindings||F.realBindFramebuffer.call(W,W.FRAMEBUFFER,F.lastBoundFramebuffer),F.cullFace&&F.realEnable.call(W,W.CULL_FACE),F.depthTest&&F.realEnable.call(W,W.DEPTH_TEST),F.blend&&F.realEnable.call(W,W.BLEND),F.scissorTest&&F.realEnable.call(W,W.SCISSOR_TEST),F.stencilTest&&F.realEnable.call(W,W.STENCIL_TEST),F.realColorMask.apply(W,F.colorMask),F.realViewport.apply(W,F.viewport),(F.ctxAttribs.alpha||!F.ctxAttribs.preserveDrawingBuffer)&&F.realClearColor.apply(W,F.clearColor),F.instanceExt&&(re!=0&&F.instanceExt.vertexAttribDivisorANGLE(F.attribs.position,re),le!=0&&F.instanceExt.vertexAttribDivisorANGLE(F.attribs.texCoord,le))}),c()){var I=x.canvas;(I.width!=F.bufferWidth||I.height!=F.bufferHeight)&&(F.bufferWidth=I.width,F.bufferHeight=I.height,F.onResize())}},P.prototype.updateDeviceInfo=function(x){var F=this.gl,_=this,I=[F.ARRAY_BUFFER_BINDING,F.ELEMENT_ARRAY_BUFFER_BINDING];be(F,I,function(W){var re=_.computeMeshVertices_(_.meshWidth,_.meshHeight,x);if(W.bindBuffer(W.ARRAY_BUFFER,_.vertexBuffer),W.bufferData(W.ARRAY_BUFFER,re,W.STATIC_DRAW),!_.indexCount){var le=_.computeMeshIndices_(_.meshWidth,_.meshHeight);W.bindBuffer(W.ELEMENT_ARRAY_BUFFER,_.indexBuffer),W.bufferData(W.ELEMENT_ARRAY_BUFFER,le,W.STATIC_DRAW),_.indexCount=le.length}})},P.prototype.computeMeshVertices_=function(x,F,_){for(var I=new Float32Array(2*x*F*5),W=_.getLeftEyeVisibleTanAngles(),re=_.getLeftEyeNoLensTanAngles(),le=_.getLeftEyeVisibleScreenRect(re),Me=0,Ee=0;Ee<2;Ee++){for(var me=0;me<F;me++)for(var we=0;we<x;we++,Me++){var Ve=we/(x-1),Ke=me/(F-1),rt=Ve,lt=Ke,kt=l(W[0],W[2],Ve),dt=l(W[3],W[1],Ke),ut=Math.sqrt(kt*kt+dt*dt),cn=_.distortion.distortInverse(ut),Rn=kt*cn/ut,qn=dt*cn/ut;Ve=(Rn-re[0])/(re[2]-re[0]),Ke=(qn-re[3])/(re[1]-re[3]),Ve=(le.x+Ve*le.width-.5)*2,Ke=(le.y+Ke*le.height-.5)*2,I[Me*5+0]=Ve,I[Me*5+1]=Ke,I[Me*5+2]=rt,I[Me*5+3]=lt,I[Me*5+4]=Ee}var Fn=W[2]-W[0];W[0]=-(Fn+W[0]),W[2]=Fn-W[2],Fn=re[2]-re[0],re[0]=-(Fn+re[0]),re[2]=Fn-re[2],le.x=1-(le.x+le.width)}return I},P.prototype.computeMeshIndices_=function(x,F){for(var _=new Uint16Array(2*(x-1)*(F-1)*6),I=x/2,W=F/2,re=0,le=0,Me=0;Me<2;Me++)for(var Ee=0;Ee<F;Ee++)for(var me=0;me<x;me++,re++)me==0||Ee==0||(me<=I==Ee<=W?(_[le++]=re,_[le++]=re-x-1,_[le++]=re-x,_[le++]=re-x-1,_[le++]=re,_[le++]=re-1):(_[le++]=re-1,_[le++]=re-x,_[le++]=re,_[le++]=re-x,_[le++]=re-1,_[le++]=re-x-1));return _},P.prototype.getOwnPropertyDescriptor_=function(x,F){var _=Object.getOwnPropertyDescriptor(x,F);return(_.get===void 0||_.set===void 0)&&(_.configurable=!0,_.enumerable=!0,_.get=function(){return this.getAttribute(F)},_.set=function(I){this.setAttribute(F,I)}),_};var C=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),N=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),j=Math.PI/180,z=60,X=12,oe=20,se=1,S=.75,R=.3125,O=4,U=28,G=1.5;function Z(x){this.gl=x,this.attribs={position:0},this.program=y(x,C,N,this.attribs),this.uniforms=V(x,this.program),this.vertexBuffer=x.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}Z.prototype.destroy=function(){var x=this.gl;this.listener&&x.canvas.removeEventListener("click",this.listener,!1),x.deleteProgram(this.program),x.deleteBuffer(this.vertexBuffer)},Z.prototype.listen=function(x,F){var _=this.gl.canvas;this.listener=function(I){var W=_.clientWidth/2,re=U*G;I.clientX>W-re&&I.clientX<W+re&&I.clientY>_.clientHeight-re?x(I):I.clientX<re&&I.clientY<re&&F(I)},_.addEventListener("click",this.listener,!1)},Z.prototype.onResize=function(){var x=this.gl,F=this,_=[x.ARRAY_BUFFER_BINDING];be(x,_,function(I){var W=[],re=I.drawingBufferWidth/2,le=Math.max(screen.width,screen.height)*window.devicePixelRatio,Me=I.drawingBufferWidth/le,Ee=Me*window.devicePixelRatio,me=O*Ee/2,we=U*G*Ee,Ve=U*Ee/2,Ke=(U*G-U)*Ee;W.push(re-me,we),W.push(re-me,I.drawingBufferHeight),W.push(re+me,we),W.push(re+me,I.drawingBufferHeight),F.gearOffset=W.length/2;function rt(cn,Rn){var qn=(90-cn)*j,Fn=Math.cos(qn),ur=Math.sin(qn);W.push(R*Fn*Ve+re,R*ur*Ve+Ve),W.push(Rn*Fn*Ve+re,Rn*ur*Ve+Ve)}for(var lt=0;lt<=6;lt++){var kt=lt*z;rt(kt,se),rt(kt+X,se),rt(kt+oe,S),rt(kt+(z-oe),S),rt(kt+(z-X),se)}F.gearVertexCount=W.length/2-F.gearOffset,F.arrowOffset=W.length/2;function dt(cn,Rn){W.push(Ke+cn,I.drawingBufferHeight-Ke-Rn)}var ut=me/Math.sin(45*j);dt(0,Ve),dt(Ve,0),dt(Ve+ut,ut),dt(ut,Ve+ut),dt(ut,Ve-ut),dt(0,Ve),dt(Ve,Ve*2),dt(Ve+ut,Ve*2-ut),dt(ut,Ve-ut),dt(0,Ve),dt(ut,Ve-me),dt(U*Ee,Ve-me),dt(ut,Ve+me),dt(U*Ee,Ve+me),F.arrowVertexCount=W.length/2-F.arrowOffset,I.bindBuffer(I.ARRAY_BUFFER,F.vertexBuffer),I.bufferData(I.ARRAY_BUFFER,new Float32Array(W),I.STATIC_DRAW)})},Z.prototype.render=function(){var x=this.gl,F=this,_=[x.CULL_FACE,x.DEPTH_TEST,x.BLEND,x.SCISSOR_TEST,x.STENCIL_TEST,x.COLOR_WRITEMASK,x.VIEWPORT,x.CURRENT_PROGRAM,x.ARRAY_BUFFER_BINDING];be(x,_,function(I){I.disable(I.CULL_FACE),I.disable(I.DEPTH_TEST),I.disable(I.BLEND),I.disable(I.SCISSOR_TEST),I.disable(I.STENCIL_TEST),I.colorMask(!0,!0,!0,!0),I.viewport(0,0,I.drawingBufferWidth,I.drawingBufferHeight),F.renderNoState()})},Z.prototype.renderNoState=function(){var x=this.gl;x.useProgram(this.program),x.bindBuffer(x.ARRAY_BUFFER,this.vertexBuffer),x.enableVertexAttribArray(this.attribs.position),x.vertexAttribPointer(this.attribs.position,2,x.FLOAT,!1,8,0),x.uniform4f(this.uniforms.color,1,1,1,1),B(this.projMat,0,x.drawingBufferWidth,0,x.drawingBufferHeight,.1,1024),x.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),x.drawArrays(x.TRIANGLE_STRIP,0,4),x.drawArrays(x.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),x.drawArrays(x.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function he(x){this.coefficients=x}he.prototype.distortInverse=function(x){for(var F=0,_=1,I=x-this.distort(F);Math.abs(_-F)>1e-4;){var W=x-this.distort(_),re=_-W*((_-F)/(W-I));F=_,_=re,I=W}return _},he.prototype.distort=function(x){for(var F=x*x,_=0,I=0;I<this.coefficients.length;I++)_=F*(_+this.coefficients[I]);return(_+1)*x};var Pe=Math.PI/180,pe=180/Math.PI,de=function(F,_,I){this.x=F||0,this.y=_||0,this.z=I||0};de.prototype={constructor:de,set:function(F,_,I){return this.x=F,this.y=_,this.z=I,this},copy:function(F){return this.x=F.x,this.y=F.y,this.z=F.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var F=this.length();if(F!==0){var _=1/F;this.multiplyScalar(_)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(F){this.x*=F,this.y*=F,this.z*=F},applyQuaternion:function(F){var _=this.x,I=this.y,W=this.z,re=F.x,le=F.y,Me=F.z,Ee=F.w,me=Ee*_+le*W-Me*I,we=Ee*I+Me*_-re*W,Ve=Ee*W+re*I-le*_,Ke=-re*_-le*I-Me*W;return this.x=me*Ee+Ke*-re+we*-Me-Ve*-le,this.y=we*Ee+Ke*-le+Ve*-re-me*-Me,this.z=Ve*Ee+Ke*-Me+me*-le-we*-re,this},dot:function(F){return this.x*F.x+this.y*F.y+this.z*F.z},crossVectors:function(F,_){var I=F.x,W=F.y,re=F.z,le=_.x,Me=_.y,Ee=_.z;return this.x=W*Ee-re*Me,this.y=re*le-I*Ee,this.z=I*Me-W*le,this}};var ge=function(F,_,I,W){this.x=F||0,this.y=_||0,this.z=I||0,this.w=W!==void 0?W:1};ge.prototype={constructor:ge,set:function(F,_,I,W){return this.x=F,this.y=_,this.z=I,this.w=W,this},copy:function(F){return this.x=F.x,this.y=F.y,this.z=F.z,this.w=F.w,this},setFromEulerXYZ:function(F,_,I){var W=Math.cos(F/2),re=Math.cos(_/2),le=Math.cos(I/2),Me=Math.sin(F/2),Ee=Math.sin(_/2),me=Math.sin(I/2);return this.x=Me*re*le+W*Ee*me,this.y=W*Ee*le-Me*re*me,this.z=W*re*me+Me*Ee*le,this.w=W*re*le-Me*Ee*me,this},setFromEulerYXZ:function(F,_,I){var W=Math.cos(F/2),re=Math.cos(_/2),le=Math.cos(I/2),Me=Math.sin(F/2),Ee=Math.sin(_/2),me=Math.sin(I/2);return this.x=Me*re*le+W*Ee*me,this.y=W*Ee*le-Me*re*me,this.z=W*re*me-Me*Ee*le,this.w=W*re*le+Me*Ee*me,this},setFromAxisAngle:function(F,_){var I=_/2,W=Math.sin(I);return this.x=F.x*W,this.y=F.y*W,this.z=F.z*W,this.w=Math.cos(I),this},multiply:function(F){return this.multiplyQuaternions(this,F)},multiplyQuaternions:function(F,_){var I=F.x,W=F.y,re=F.z,le=F.w,Me=_.x,Ee=_.y,me=_.z,we=_.w;return this.x=I*we+le*Me+W*me-re*Ee,this.y=W*we+le*Ee+re*Me-I*me,this.z=re*we+le*me+I*Ee-W*Me,this.w=le*we-I*Me-W*Ee-re*me,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var F=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return F===0?(this.x=0,this.y=0,this.z=0,this.w=1):(F=1/F,this.x=this.x*F,this.y=this.y*F,this.z=this.z*F,this.w=this.w*F),this},slerp:function(F,_){if(_===0)return this;if(_===1)return this.copy(F);var I=this.x,W=this.y,re=this.z,le=this.w,Me=le*F.w+I*F.x+W*F.y+re*F.z;if(Me<0?(this.w=-F.w,this.x=-F.x,this.y=-F.y,this.z=-F.z,Me=-Me):this.copy(F),Me>=1)return this.w=le,this.x=I,this.y=W,this.z=re,this;var Ee=Math.acos(Me),me=Math.sqrt(1-Me*Me);if(Math.abs(me)<.001)return this.w=.5*(le+this.w),this.x=.5*(I+this.x),this.y=.5*(W+this.y),this.z=.5*(re+this.z),this;var we=Math.sin((1-_)*Ee)/me,Ve=Math.sin(_*Ee)/me;return this.w=le*we+this.w*Ve,this.x=I*we+this.x*Ve,this.y=W*we+this.y*Ve,this.z=re*we+this.z*Ve,this},setFromUnitVectors:function(){var x,F,_=1e-6;return function(I,W){return x===void 0&&(x=new de),F=I.dot(W)+1,F<_?(F=0,Math.abs(I.x)>Math.abs(I.z)?x.set(-I.y,I.x,0):x.set(0,-I.z,I.y)):x.crossVectors(I,W),this.x=x.x,this.y=x.y,this.z=x.z,this.w=F,this.normalize(),this}}()};function Se(x){this.width=x.width||k(),this.height=x.height||E(),this.widthMeters=x.widthMeters,this.heightMeters=x.heightMeters,this.bevelMeters=x.bevelMeters}var Oe=new Se({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),q=new Se({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),ke={CardboardV1:new $e({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new $e({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function Ge(x,F){this.viewer=ke.CardboardV2,this.updateDeviceParams(x),this.distortion=new he(this.viewer.distortionCoefficients);for(var _=0;_<F.length;_++){var I=F[_];ke[I.id]=new $e(I)}}Ge.prototype.updateDeviceParams=function(x){this.device=this.determineDevice_(x)||this.device},Ge.prototype.getDevice=function(){return this.device},Ge.prototype.setViewer=function(x){this.viewer=x,this.distortion=new he(this.viewer.distortionCoefficients)},Ge.prototype.determineDevice_=function(x){if(!x)return c()?(console.warn("Using fallback iOS device measurements."),q):(console.warn("Using fallback Android device measurements."),Oe);var F=.0254,_=F/x.xdpi,I=F/x.ydpi,W=k(),re=E();return new Se({widthMeters:_*W,heightMeters:I*re,bevelMeters:x.bevelMm*.001})},Ge.prototype.getDistortedFieldOfViewLeftEye=function(){var x=this.viewer,F=this.device,_=this.distortion,I=x.screenLensDistance,W=(F.widthMeters-x.interLensDistance)/2,re=x.interLensDistance/2,le=x.baselineLensDistance-F.bevelMeters,Me=F.heightMeters-le,Ee=pe*Math.atan(_.distort(W/I)),me=pe*Math.atan(_.distort(re/I)),we=pe*Math.atan(_.distort(le/I)),Ve=pe*Math.atan(_.distort(Me/I));return{leftDegrees:Math.min(Ee,x.fov),rightDegrees:Math.min(me,x.fov),downDegrees:Math.min(we,x.fov),upDegrees:Math.min(Ve,x.fov)}},Ge.prototype.getLeftEyeVisibleTanAngles=function(){var x=this.viewer,F=this.device,_=this.distortion,I=Math.tan(-Pe*x.fov),W=Math.tan(Pe*x.fov),re=Math.tan(Pe*x.fov),le=Math.tan(-Pe*x.fov),Me=F.widthMeters/4,Ee=F.heightMeters/2,me=x.baselineLensDistance-F.bevelMeters-Ee,we=x.interLensDistance/2-Me,Ve=-me,Ke=x.screenLensDistance,rt=_.distort((we-Me)/Ke),lt=_.distort((Ve+Ee)/Ke),kt=_.distort((we+Me)/Ke),dt=_.distort((Ve-Ee)/Ke),ut=new Float32Array(4);return ut[0]=Math.max(I,rt),ut[1]=Math.min(W,lt),ut[2]=Math.min(re,kt),ut[3]=Math.max(le,dt),ut},Ge.prototype.getLeftEyeNoLensTanAngles=function(){var x=this.viewer,F=this.device,_=this.distortion,I=new Float32Array(4),W=_.distortInverse(Math.tan(-Pe*x.fov)),re=_.distortInverse(Math.tan(Pe*x.fov)),le=_.distortInverse(Math.tan(Pe*x.fov)),Me=_.distortInverse(Math.tan(-Pe*x.fov)),Ee=F.widthMeters/4,me=F.heightMeters/2,we=x.baselineLensDistance-F.bevelMeters-me,Ve=x.interLensDistance/2-Ee,Ke=-we,rt=x.screenLensDistance,lt=(Ve-Ee)/rt,kt=(Ke+me)/rt,dt=(Ve+Ee)/rt,ut=(Ke-me)/rt;return I[0]=Math.max(W,lt),I[1]=Math.min(re,kt),I[2]=Math.min(le,dt),I[3]=Math.max(Me,ut),I},Ge.prototype.getLeftEyeVisibleScreenRect=function(x){var F=this.viewer,_=this.device,I=F.screenLensDistance,W=(_.widthMeters-F.interLensDistance)/2,re=F.baselineLensDistance-_.bevelMeters,le=(x[0]*I+W)/_.widthMeters,Me=(x[1]*I+re)/_.heightMeters,Ee=(x[2]*I+W)/_.widthMeters,me=(x[3]*I+re)/_.heightMeters;return{x:le,y:me,width:Ee-le,height:Me-me}},Ge.prototype.getFieldOfViewLeftEye=function(x){return x?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},Ge.prototype.getFieldOfViewRightEye=function(x){var F=this.getFieldOfViewLeftEye(x);return{leftDegrees:F.rightDegrees,rightDegrees:F.leftDegrees,upDegrees:F.upDegrees,downDegrees:F.downDegrees}},Ge.prototype.getUndistortedFieldOfViewLeftEye=function(){var x=this.getUndistortedParams_();return{leftDegrees:pe*Math.atan(x.outerDist),rightDegrees:pe*Math.atan(x.innerDist),downDegrees:pe*Math.atan(x.bottomDist),upDegrees:pe*Math.atan(x.topDist)}},Ge.prototype.getUndistortedViewportLeftEye=function(){var x=this.getUndistortedParams_(),F=this.viewer,_=this.device,I=F.screenLensDistance,W=_.widthMeters/I,re=_.heightMeters/I,le=_.width/W,Me=_.height/re,Ee=Math.round((x.eyePosX-x.outerDist)*le),me=Math.round((x.eyePosY-x.bottomDist)*Me);return{x:Ee,y:me,width:Math.round((x.eyePosX+x.innerDist)*le)-Ee,height:Math.round((x.eyePosY+x.topDist)*Me)-me}},Ge.prototype.getUndistortedParams_=function(){var x=this.viewer,F=this.device,_=this.distortion,I=x.screenLensDistance,W=x.interLensDistance/2/I,re=F.widthMeters/I,le=F.heightMeters/I,Me=re/2-W,Ee=(x.baselineLensDistance-F.bevelMeters)/I,me=x.fov,we=_.distortInverse(Math.tan(Pe*me)),Ve=Math.min(Me,we),Ke=Math.min(W,we),rt=Math.min(Ee,we),lt=Math.min(le-Ee,we);return{outerDist:Ve,innerDist:Ke,topDist:lt,bottomDist:rt,eyePosX:Me,eyePosY:Ee}};function $e(x){this.id=x.id,this.label=x.label,this.fov=x.fov,this.interLensDistance=x.interLensDistance,this.baselineLensDistance=x.baselineLensDistance,this.screenLensDistance=x.screenLensDistance,this.distortionCoefficients=x.distortionCoefficients,this.inverseCoefficients=x.inverseCoefficients}Ge.Viewers=ke;var it=1,_t="2019-11-09T17:36:14Z",Nn=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],Jt={format:it,last_updated:_t,devices:Nn};function Lr(x,F){if(this.dpdb=Jt,this.recalculateDeviceParams_(),x){this.onDeviceParamsUpdated=F;var _=new XMLHttpRequest,I=this;_.open("GET",x,!0),_.addEventListener("load",function(){I.loading=!1,_.status>=200&&_.status<=299?(I.dpdb=JSON.parse(_.response),I.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),_.send()}}Lr.prototype.getDeviceParams=function(){return this.deviceParams},Lr.prototype.recalculateDeviceParams_=function(){var x=this.calcDeviceParams_();x?(this.deviceParams=x,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},Lr.prototype.calcDeviceParams_=function(){var x=this.dpdb;if(!x)return console.error("DPDB not available."),null;if(x.format!=1)return console.error("DPDB has unexpected format version."),null;if(!x.devices||!x.devices.length)return console.error("DPDB does not have a devices section."),null;var F=navigator.userAgent||navigator.vendor||window.opera,_=k(),I=E();if(!x.devices)return console.error("DPDB has no devices section."),null;for(var W=0;W<x.devices.length;W++){var re=x.devices[W];if(!re.rules){console.warn("Device["+W+"] has no rules section.");continue}if(re.type!="ios"&&re.type!="android"){console.warn("Device["+W+"] has invalid type.");continue}if(c()==(re.type=="ios")){for(var le=!1,Me=0;Me<re.rules.length;Me++){var Ee=re.rules[Me];if(this.ruleMatches_(Ee,F,_,I)){le=!0;break}}if(le){var me=re.dpi[0]||re.dpi,we=re.dpi[1]||re.dpi;return new bt({xdpi:me,ydpi:we,bevelMm:re.bw})}}}return console.warn("No DPDB device match."),null},Lr.prototype.ruleMatches_=function(x,F,_,I){if(!x.ua&&!x.res||(x.ua&&x.ua.substring(0,2)==="SM"&&(x.ua=x.ua.substring(0,7)),x.ua&&F.indexOf(x.ua)<0))return!1;if(x.res){if(!x.res[0]||!x.res[1])return!1;var W=x.res[0],re=x.res[1];if(Math.min(_,I)!=Math.min(W,re)||Math.max(_,I)!=Math.max(W,re))return!1}return!0};function bt(x){this.xdpi=x.xdpi,this.ydpi=x.ydpi,this.bevelMm=x.bevelMm}function rn(x,F){this.set(x,F)}rn.prototype.set=function(x,F){this.sample=x,this.timestampS=F},rn.prototype.copy=function(x){this.set(x.sample,x.timestampS)};function ti(x,F){this.kFilter=x,this.isDebug=F,this.currentAccelMeasurement=new rn,this.currentGyroMeasurement=new rn,this.previousGyroMeasurement=new rn,c()?this.filterQ=new ge(-1,0,0,1):this.filterQ=new ge(1,0,0,1),this.previousFilterQ=new ge,this.previousFilterQ.copy(this.filterQ),this.accelQ=new ge,this.isOrientationInitialized=!1,this.estimatedGravity=new de,this.measuredGravity=new de,this.gyroIntegralQ=new ge}ti.prototype.addAccelMeasurement=function(x,F){this.currentAccelMeasurement.set(x,F)},ti.prototype.addGyroMeasurement=function(x,F){this.currentGyroMeasurement.set(x,F);var _=F-this.previousGyroMeasurement.timestampS;M(_)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},ti.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var x=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,F=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,x);this.gyroIntegralQ.multiply(F),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(F);var _=new ge;_.copy(this.filterQ),_.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(_),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var I=new ge;I.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),I.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",pe*K(I),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var W=new ge;W.copy(this.filterQ),W.multiply(I),this.filterQ.slerp(W,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},ti.prototype.getOrientation=function(){return this.filterQ},ti.prototype.accelToQuaternion_=function(x){var F=new de;F.copy(x),F.normalize();var _=new ge;return _.setFromUnitVectors(new de(0,0,-1),F),_.inverse(),_},ti.prototype.gyroToQuaternionDelta_=function(x,F){var _=new ge,I=new de;return I.copy(x),I.normalize(),_.setFromAxisAngle(I,x.length()*F),_};function ve(x,F){this.predictionTimeS=x,this.isDebug=F,this.previousQ=new ge,this.previousTimestampS=null,this.deltaQ=new ge,this.outQ=new ge}ve.prototype.getPrediction=function(x,F,_){if(!this.previousTimestampS)return this.previousQ.copy(x),this.previousTimestampS=_,x;var I=new de;I.copy(F),I.normalize();var W=F.length();if(W<Pe*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(pe*W).toFixed(1)),this.outQ.copy(x),this.previousQ.copy(x),this.outQ;var re=W*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(I,re),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(x),this.previousTimestampS=_,this.outQ};function Ce(x,F,_,I){this.yawOnly=_,this.accelerometer=new de,this.gyroscope=new de,this.filter=new ti(x,I),this.posePredictor=new ve(F,I),this.isFirefoxAndroid=f(),this.isIOS=c();var W=w();this.isDeviceMotionInRadians=!this.isIOS&&W&&W<66,this.isWithoutDeviceMotion=m()||A(),this.filterToWorldQ=new ge,c()?this.filterToWorldQ.setFromAxisAngle(new de(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new de(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new ge,this.worldToScreenQ=new ge,this.originalPoseAdjustQ=new ge,this.originalPoseAdjustQ.setFromAxisAngle(new de(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),h()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new ge,this.orientationOut_=new Float32Array(4),this.start()}Ce.prototype.getPosition=function(){return null},Ce.prototype.getOrientation=function(){var x=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var W=new ge().setFromAxisAngle(new de(0,0,-1),0),re=new ge;return window.orientation===-90?re.setFromAxisAngle(new de(0,1,0),Math.PI/-2):re.setFromAxisAngle(new de(0,1,0),Math.PI/2),W.multiply(re)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var W=new ge;return W.setFromAxisAngle(new de(1,0,0),-Math.PI/2),W}(),x=this._deviceOrientationQ;var _=new ge;return _.copy(x),_.multiply(this.deviceOrientationFilterToWorldQ),_.multiply(this.resetQ),_.multiply(this.worldToScreenQ),_.multiplyQuaternions(this.deviceOrientationFixQ,_),this.yawOnly&&(_.x=0,_.z=0,_.normalize()),this.orientationOut_[0]=_.x,this.orientationOut_[1]=_.y,this.orientationOut_[2]=_.z,this.orientationOut_[3]=_.w,this.orientationOut_}else{var F=this.filter.getOrientation();x=this.posePredictor.getPrediction(F,this.gyroscope,this.previousTimestampS)}var _=new ge;return _.copy(this.filterToWorldQ),_.multiply(this.resetQ),_.multiply(x),_.multiply(this.worldToScreenQ),this.yawOnly&&(_.x=0,_.z=0,_.normalize()),this.orientationOut_[0]=_.x,this.orientationOut_[1]=_.y,this.orientationOut_[2]=_.z,this.orientationOut_[3]=_.w,this.orientationOut_},Ce.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),h()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},Ce.prototype.onDeviceOrientation_=function(x){this._deviceOrientationQ=this._deviceOrientationQ||new ge;var F=x.alpha,_=x.beta,I=x.gamma;F=(F||0)*Math.PI/180,_=(_||0)*Math.PI/180,I=(I||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(_,F,-I)},Ce.prototype.onDeviceMotion_=function(x){this.updateDeviceMotion_(x)},Ce.prototype.updateDeviceMotion_=function(x){var F=x.accelerationIncludingGravity,_=x.rotationRate,I=x.timeStamp/1e3,W=I-this.previousTimestampS;if(W<0){$("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=I;return}else if(W<=i||W>o){$("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=I;return}this.accelerometer.set(-F.x,-F.y,-F.z),_&&(d()?this.gyroscope.set(-_.beta,_.alpha,_.gamma):this.gyroscope.set(_.alpha,_.beta,_.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,I)),this.filter.addAccelMeasurement(this.accelerometer,I),this.previousTimestampS=I},Ce.prototype.onOrientationChange_=function(x){this.setScreenTransform_()},Ce.prototype.onMessage_=function(x){var F=x.data;if(!(!F||!F.type)){var _=F.type.toLowerCase();_==="devicemotion"&&this.updateDeviceMotion_(F.deviceMotionEvent)}},Ce.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new de(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new de(0,0,1),Math.PI/2);break;case 180:break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},Ce.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),c()&&Q()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},Ce.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var ue=60,ne=new de(1,0,0),ie=new de(0,0,1),Be=new ge;Be.setFromAxisAngle(ne,-Math.PI/2),Be.multiply(new ge().setFromAxisAngle(ie,Math.PI/2));var ze=function(){function x(F){t(this,x),this.config=F,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new ge,this._outQ=new ge,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return e(x,[{key:"init",value:function(){var _=null;try{_=new RelativeOrientationSensor({frequency:ue,referenceFrame:"screen"}),_.addEventListener("error",this._onSensorError)}catch(I){this.errors.push(I),I.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):I.name==="ReferenceError"?this.useDeviceMotion():console.error(I)}_&&(this.api="sensor",this.sensor=_,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new Ce(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var _=this.sensor.quaternion;this._sensorQ.set(_[0],_[1],_[2],_[3]);var I=this._outQ;return I.copy(Be),I.multiply(this._sensorQ),this.config.YAW_ONLY&&(I.x=I.z=0,I.normalize()),this._out[0]=I.x,this._out[1]=I.y,this._out[2]=I.z,this._out[3]=I.w,this._out}},{key:"_onSensorError",value:function(_){this.errors.push(_.error),_.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):_.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(_.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),x}(),Qe="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function Ze(){this.loadIcon_();var x=document.createElement("div"),le=x.style;le.position="fixed",le.top=0,le.right=0,le.bottom=0,le.left=0,le.backgroundColor="gray",le.fontFamily="sans-serif",le.zIndex=1e6;var F=document.createElement("img");F.src=this.icon;var le=F.style;le.marginLeft="25%",le.marginTop="25%",le.width="50%",x.appendChild(F);var _=document.createElement("div"),le=_.style;le.textAlign="center",le.fontSize="16px",le.lineHeight="24px",le.margin="24px 25%",le.width="50%",_.innerHTML="Place your phone into your Cardboard viewer.",x.appendChild(_);var I=document.createElement("div"),le=I.style;le.backgroundColor="#CFD8DC",le.position="fixed",le.bottom=0,le.width="100%",le.height="48px",le.padding="14px 24px",le.boxSizing="border-box",le.color="#656A6B",x.appendChild(I);var W=document.createElement("div");W.style.float="left",W.innerHTML="No Cardboard viewer?";var re=document.createElement("a");re.href="https://www.google.com/get/cardboard/get-cardboard/",re.innerHTML="get one",re.target="_blank";var le=re.style;le.float="right",le.fontWeight=600,le.textTransform="uppercase",le.borderLeft="1px solid gray",le.paddingLeft="24px",le.textDecoration="none",le.color="#656A6B",I.appendChild(W),I.appendChild(re),this.overlay=x,this.text=_,this.hide()}Ze.prototype.show=function(x){!x&&!this.overlay.parentElement?document.body.appendChild(this.overlay):x&&(this.overlay.parentElement&&this.overlay.parentElement!=x&&this.overlay.parentElement.removeChild(this.overlay),x.appendChild(this.overlay)),this.overlay.style.display="block";var F=this.overlay.querySelector("img"),_=F.style;h()?(_.width="20%",_.marginLeft="40%",_.marginTop="3%"):(_.width="50%",_.marginLeft="25%",_.marginTop="25%")},Ze.prototype.hide=function(){this.overlay.style.display="none"},Ze.prototype.showTemporarily=function(x,F){this.show(F),this.timer=setTimeout(this.hide.bind(this),x)},Ze.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},Ze.prototype.update=function(){this.disableShowTemporarily(),!h()&&D()?this.show():this.hide()},Ze.prototype.loadIcon_=function(){this.icon=s("image/svg+xml",Qe)};var yt="CardboardV1",mn="WEBVR_CARDBOARD_VIEWER",jt="webvr-polyfill-viewer-selector";function nt(x){try{this.selectedKey=localStorage.getItem(mn)}catch(F){console.error("Failed to load viewer profile: %s",F)}this.selectedKey||(this.selectedKey=x||yt),this.dialog=this.createDialog_(Ge.Viewers),this.root=null,this.onChangeCallbacks_=[]}nt.prototype.show=function(x){this.root=x,x.appendChild(this.dialog);var F=this.dialog.querySelector("#"+this.selectedKey);F.checked=!0,this.dialog.style.display="block"},nt.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},nt.prototype.getCurrentViewer=function(){return Ge.Viewers[this.selectedKey]},nt.prototype.getSelectedKey_=function(){var x=this.dialog.querySelector("input[name=field]:checked");return x?x.id:null},nt.prototype.onChange=function(x){this.onChangeCallbacks_.push(x)},nt.prototype.fireOnChange_=function(x){for(var F=0;F<this.onChangeCallbacks_.length;F++)this.onChangeCallbacks_[F](x)},nt.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!Ge.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(Ge.Viewers[this.selectedKey]);try{localStorage.setItem(mn,this.selectedKey)}catch(x){console.error("Failed to save viewer profile: %s",x)}this.hide()},nt.prototype.createDialog_=function(x){var F=document.createElement("div");F.classList.add(jt),F.style.display="none";var _=document.createElement("div"),re=_.style;re.position="fixed",re.left=0,re.top=0,re.width="100%",re.height="100%",re.background="rgba(0, 0, 0, 0.3)",_.addEventListener("click",this.hide.bind(this));var I=280,W=document.createElement("div"),re=W.style;re.boxSizing="border-box",re.position="fixed",re.top="24px",re.left="50%",re.marginLeft=-I/2+"px",re.width=I+"px",re.padding="24px",re.overflow="hidden",re.background="#fafafa",re.fontFamily="'Roboto', sans-serif",re.boxShadow="0px 5px 20px #666",W.appendChild(this.createH1_("Select your viewer"));for(var le in x)W.appendChild(this.createChoice_(le,x[le].label));return W.appendChild(this.createButton_("Save",this.onSave_.bind(this))),F.appendChild(_),F.appendChild(W),F},nt.prototype.createH1_=function(x){var F=document.createElement("h1"),_=F.style;return _.color="black",_.fontSize="20px",_.fontWeight="bold",_.marginTop=0,_.marginBottom="24px",F.innerHTML=x,F},nt.prototype.createChoice_=function(x,F){var _=document.createElement("div");_.style.marginTop="8px",_.style.color="black";var I=document.createElement("input");I.style.fontSize="30px",I.setAttribute("id",x),I.setAttribute("type","radio"),I.setAttribute("value",x),I.setAttribute("name","field");var W=document.createElement("label");return W.style.marginLeft="4px",W.setAttribute("for",x),W.innerHTML=F,_.appendChild(I),_.appendChild(W),_},nt.prototype.createButton_=function(x,F){var _=document.createElement("button");_.innerHTML=x;var I=_.style;return I.float="right",I.textTransform="uppercase",I.color="#1094f7",I.fontSize="14px",I.letterSpacing=0,I.border=0,I.background="none",I.marginTop="16px",_.addEventListener("click",F),_};var Tn=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vn(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}function $n(x,F){return F={exports:{}},x(F,F.exports),F.exports}var Ht=$n(function(x,F){(function(I,W){x.exports=W()})(Tn,function(){return function(_){var I={};function W(re){if(I[re])return I[re].exports;var le=I[re]={i:re,l:!1,exports:{}};return _[re].call(le.exports,le,le.exports,W),le.l=!0,le.exports}return W.m=_,W.c=I,W.d=function(re,le,Me){W.o(re,le)||Object.defineProperty(re,le,{configurable:!1,enumerable:!0,get:Me})},W.n=function(re){var le=re&&re.__esModule?function(){return re.default}:function(){return re};return W.d(le,"a",le),le},W.o=function(re,le){return Object.prototype.hasOwnProperty.call(re,le)},W.p="",W(W.s=0)}([function(_,I,W){"use strict";var re=function(){function we(Ve,Ke){for(var rt=0;rt<Ke.length;rt++){var lt=Ke[rt];lt.enumerable=lt.enumerable||!1,lt.configurable=!0,"value"in lt&&(lt.writable=!0),Object.defineProperty(Ve,lt.key,lt)}}return function(Ve,Ke,rt){return Ke&&we(Ve.prototype,Ke),rt&&we(Ve,rt),Ve}}();function le(we,Ve){if(!(we instanceof Ve))throw new TypeError("Cannot call a class as a function")}var Me=W(1),Ee=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,me=function(){function we(){le(this,we),Ee?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",Me),this.noSleepVideo.addEventListener("timeupdate",function(Ve){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return re(we,[{key:"enable",value:function(){Ee?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){Ee?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),we}();_.exports=me},function(_,I,W){"use strict";_.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),En=vn(Ht),Ur=1e3,Ni=[0,0,.5,1],Hi=[.5,0,.5,1],ni=window.requestAnimationFrame,In=window.cancelAnimationFrame;function zr(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function fo(x){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:x.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:x.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:x.canPresent},maxLayers:{writable:!1,enumerable:!0,value:x.maxLayers},hasOrientation:{enumerable:!0,get:function(){return te("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),x.hasOrientation}}})}function pn(x){x=x||{};var F="wakelock"in x?x.wakelock:!0;this.isPolyfilled=!0,this.displayId=Ur++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return te("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new fo({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,F&&D()&&(this.wakelock_=new En)}pn.prototype.getFrameData=function(x){return ae(x,this._getPose(),this)},pn.prototype.getPose=function(){return te("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},pn.prototype.resetPose=function(){return te("VRDisplay.prototype.resetPose"),this._resetPose()},pn.prototype.getImmediatePose=function(){return te("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},pn.prototype.requestAnimationFrame=function(x){return ni(x)},pn.prototype.cancelAnimationFrame=function(x){return In(x)},pn.prototype.wrapForFullscreen=function(x){if(c())return x;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var F=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",F.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==x)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=x,this.originalParent_=x.parentElement,this.originalParent_||document.body.appendChild(x),!this.fullscreenWrapper_.parentElement){var _=this.fullscreenElement_.parentElement;_.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),_.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var I=this;function W(){if(I.fullscreenElement_){var re=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];I.fullscreenElement_.setAttribute("style",re.join("; ")+";")}}return W(),this.fullscreenWrapper_},pn.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var x=this.fullscreenElement_;this.fullscreenElementCachedStyle_?x.setAttribute("style",this.fullscreenElementCachedStyle_):x.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var F=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(x),this.originalParent_===F?F.insertBefore(x,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(x),F.removeChild(this.fullscreenWrapper_),x}},pn.prototype.requestPresent=function(x){var F=this.isPresenting,_=this;return x instanceof Array||(te("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),x=[x]),new Promise(function(I,W){if(!_.capabilities.canPresent){W(new Error("VRDisplay is not capable of presenting."));return}if(x.length==0||x.length>_.capabilities.maxLayers){W(new Error("Invalid number of layers."));return}var re=x[0];if(!re.source){I();return}var le=re.leftBounds||Ni,Me=re.rightBounds||Hi;if(F){var Ee=_.layer_;Ee.source!==re.source&&(Ee.source=re.source);for(var me=0;me<4;me++)Ee.leftBounds[me]=le[me],Ee.rightBounds[me]=Me[me];_.wrapForFullscreen(_.layer_.source),_.updatePresent_(),I();return}if(_.layer_={predistorted:re.predistorted,source:re.source,leftBounds:le.slice(0),rightBounds:Me.slice(0)},_.waitingForPresent_=!1,_.layer_&&_.layer_.source){var we=_.wrapForFullscreen(_.layer_.source),Ve=function(){var lt=v();_.isPresenting=we===lt,_.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(kt){console.error("screen.orientation.lock() failed due to",kt.message)}),_.waitingForPresent_=!1,_.beginPresent_(),I()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),_.removeFullscreenWrapper(),_.disableWakeLock(),_.endPresent_(),_.removeFullscreenListeners_()),_.fireVRDisplayPresentChange_()},Ke=function(){_.waitingForPresent_&&(_.removeFullscreenWrapper(),_.removeFullscreenListeners_(),_.disableWakeLock(),_.waitingForPresent_=!1,_.isPresenting=!1,W(new Error("Unable to present.")))};_.addFullscreenListeners_(we,Ve,Ke),b(we)?(_.enableWakeLock(),_.waitingForPresent_=!0):(c()||u())&&(_.enableWakeLock(),_.isPresenting=!0,_.beginPresent_(),_.fireVRDisplayPresentChange_(),I())}!_.waitingForPresent_&&!c()&&(g(),W(new Error("Unable to present.")))})},pn.prototype.exitPresent=function(){var x=this.isPresenting,F=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(_,I){x?(!g()&&c()&&(F.endPresent_(),F.fireVRDisplayPresentChange_()),u()&&(F.removeFullscreenWrapper(),F.removeFullscreenListeners_(),F.endPresent_(),F.fireVRDisplayPresentChange_()),_()):I(new Error("Was not presenting to VRDisplay."))})},pn.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},pn.prototype.fireVRDisplayPresentChange_=function(){var x=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(x)},pn.prototype.fireVRDisplayConnect_=function(){var x=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(x)},pn.prototype.addFullscreenListeners_=function(x,F,_){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=x,this.fullscreenChangeHandler_=F,this.fullscreenErrorHandler_=_,F&&(document.fullscreenEnabled?x.addEventListener("fullscreenchange",F,!1):document.webkitFullscreenEnabled?x.addEventListener("webkitfullscreenchange",F,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",F,!1):document.msFullscreenEnabled&&x.addEventListener("msfullscreenchange",F,!1)),_&&(document.fullscreenEnabled?x.addEventListener("fullscreenerror",_,!1):document.webkitFullscreenEnabled?x.addEventListener("webkitfullscreenerror",_,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",_,!1):document.msFullscreenEnabled&&x.addEventListener("msfullscreenerror",_,!1))},pn.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var x=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var F=this.fullscreenChangeHandler_;x.removeEventListener("fullscreenchange",F,!1),x.removeEventListener("webkitfullscreenchange",F,!1),document.removeEventListener("mozfullscreenchange",F,!1),x.removeEventListener("msfullscreenchange",F,!1)}if(this.fullscreenErrorHandler_){var _=this.fullscreenErrorHandler_;x.removeEventListener("fullscreenerror",_,!1),x.removeEventListener("webkitfullscreenerror",_,!1),document.removeEventListener("mozfullscreenerror",_,!1),x.removeEventListener("msfullscreenerror",_,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},pn.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},pn.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},pn.prototype.beginPresent_=function(){},pn.prototype.endPresent_=function(){},pn.prototype.submitFrame=function(x){},pn.prototype.getEyeParameters=function(x){return null};var p_={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},xp={LEFT:"left",RIGHT:"right"};function Hn(x){var F=L({},p_);x=L(F,x||{}),pn.call(this,{wakelock:x.MOBILE_WAKE_LOCK}),this.config=x,this.displayName="Cardboard VRDisplay",this.capabilities=new fo({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new ze(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new Lr(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new Ge(this.dpdb_.getDeviceParams(),x.ADDITIONAL_VIEWERS),this.viewerSelector_=new nt(x.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Ze),c()&&window.addEventListener("resize",this.onResize_.bind(this))}return Hn.prototype=Object.create(pn.prototype),Hn.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},Hn.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},Hn.prototype._getFieldOfView=function(x){var F;if(x==xp.LEFT)F=this.deviceInfo_.getFieldOfViewLeftEye();else if(x==xp.RIGHT)F=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",x),null;return F},Hn.prototype._getEyeOffset=function(x){var F;if(x==xp.LEFT)F=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(x==xp.RIGHT)F=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",x),null;return F},Hn.prototype.getEyeParameters=function(x){var F=this._getEyeOffset(x),_=this._getFieldOfView(x),I={offset:F,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(I,"fieldOfView",{enumerable:!0,get:function(){return te("VRFieldOfView","VRFrameData's projection matrices"),_}}),I},Hn.prototype.onDeviceParamsUpdated_=function(x){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(x),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},Hn.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},Hn.prototype.beginPresent_=function(){var x=this.layer_.source.getContext("webgl");x||(x=this.layer_.source.getContext("experimental-webgl")),x||(x=this.layer_.source.getContext("webgl2")),x&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(x.canvas.width=k()*this.bufferScale_,x.canvas.height=E()*this.bufferScale_,this.cardboardUI_=new Z(x)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new Z(x)),this.distorter_=new P(x,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(F){this.viewerSelector_.show(this.layer_.source.parentElement),F.stopPropagation(),F.preventDefault()}.bind(this),function(F){this.exitPresent(),F.stopPropagation(),F.preventDefault()}.bind(this)),this.rotateInstructions_&&(h()&&D()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},Hn.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},Hn.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},Hn.prototype.submitFrame=function(x){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var F=this.layer_.source.getContext("webgl");F||(F=this.layer_.source.getContext("experimental-webgl")),F||(F=this.layer_.source.getContext("webgl2"));var _=F.canvas;(_.width!=this.lastWidth||_.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=_.width,this.lastHeight=_.height,this.cardboardUI_.render()}},Hn.prototype.onOrientationChange_=function(x){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},Hn.prototype.onResize_=function(x){if(this.layer_){var F=this.layer_.source.getContext("webgl");F||(F=this.layer_.source.getContext("experimental-webgl")),F||(F=this.layer_.source.getContext("webgl2"));var _=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];F.canvas.setAttribute("style",_.join("; ")+";"),J(F.canvas)}},Hn.prototype.onViewerChanged_=function(x){this.deviceInfo_.setViewer(x),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},Hn.prototype.fireVRDisplayDeviceParamsChange_=function(){var x=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(x)},Hn.VRFrameData=zr,Hn.VRDisplay=pn,Hn})});var Kv=zo(()=>{});var qT=zo(()=>{});var KT=zo(()=>{});var YT=zo(()=>{});var JT=zo(()=>{});var QT=zo(()=>{});var wE=zo((exports,module)=>{(function(t,e){typeof exports=="object"&&typeof module=="object"?module.exports=e():typeof define=="function"&&define.amd?define("pdfjs-dist/build/pdf",[],e):typeof exports=="object"?exports["pdfjs-dist/build/pdf"]=e():t["pdfjs-dist/build/pdf"]=t.pdfjsLib=e()})(globalThis,()=>(()=>{"use strict";var __webpack_modules__=[,(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VerbosityLevel=t.Util=t.UnknownErrorException=t.UnexpectedResponseException=t.UNSUPPORTED_FEATURES=t.TextRenderingMode=t.StreamType=t.RenderingIntentFlag=t.PermissionFlag=t.PasswordResponses=t.PasswordException=t.PageActionEventType=t.OPS=t.MissingPDFException=t.LINE_FACTOR=t.LINE_DESCENT_FACTOR=t.InvalidPDFException=t.ImageKind=t.IDENTITY_MATRIX=t.FormatError=t.FontType=t.FeatureTest=t.FONT_IDENTITY_MATRIX=t.DocumentActionEventType=t.CMapCompressionType=t.BaseException=t.AnnotationType=t.AnnotationStateModelType=t.AnnotationReviewState=t.AnnotationReplyType=t.AnnotationMode=t.AnnotationMarkedState=t.AnnotationFlag=t.AnnotationFieldFlag=t.AnnotationEditorType=t.AnnotationEditorPrefix=t.AnnotationEditorParamsType=t.AnnotationBorderStyleType=t.AnnotationActionEventType=t.AbortException=void 0,t.arrayByteLength=he,t.arraysToBytes=Pe,t.assert=P,t.bytesToString=G,t.createPromiseCapability=Ce,t.createValidAbsoluteUrl=N,t.escapeString=_t,t.getModificationDate=ve,t.getVerbosityLevel=xe,t.info=be,t.isArrayBuffer=rn,t.isArrayEqual=ti,t.isAscii=Nn,t.objectFromMap=ge,t.objectSize=de,t.setVerbosityLevel=te,t.shadow=j,t.string32=pe,t.stringToBytes=Z,t.stringToPDFString=it,t.stringToUTF16BEString=Jt,t.stringToUTF8String=Lr,t.unreachable=Y,t.utf8StringToString=bt,t.warn=Ue,e(2);let n=[1,0,0,1,0,0];t.IDENTITY_MATRIX=n;let i=[.001,0,0,.001,0,0];t.FONT_IDENTITY_MATRIX=i;let o=1.35;t.LINE_FACTOR=o;let s=.35;t.LINE_DESCENT_FACTOR=s;let l={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};t.RenderingIntentFlag=l;let c={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};t.AnnotationMode=c;let u="pdfjs_internal_editor_";t.AnnotationEditorPrefix=u;let p={DISABLE:-1,NONE:0,FREETEXT:3,INK:15};t.AnnotationEditorType=p;let f={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13};t.AnnotationEditorParamsType=f;let w={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};t.PermissionFlag=w;let A={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};t.TextRenderingMode=A;let m={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};t.ImageKind=m;let d={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};t.AnnotationType=d;let h={MARKED:"Marked",REVIEW:"Review"};t.AnnotationStateModelType=h;let M={MARKED:"Marked",UNMARKED:"Unmarked"};t.AnnotationMarkedState=M;let k={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"};t.AnnotationReviewState=k;let E={GROUP:"Group",REPLY:"R"};t.AnnotationReplyType=E;let b={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};t.AnnotationFlag=b;let g={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};t.AnnotationFieldFlag=g;let v={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};t.AnnotationBorderStyleType=v;let y={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};t.AnnotationActionEventType=y;let V={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};t.DocumentActionEventType=V;let B={O:"PageOpen",C:"PageClose"};t.PageActionEventType=B;let D={UNKNOWN:"UNKNOWN",FLATE:"FLATE",LZW:"LZW",DCT:"DCT",JPX:"JPX",JBIG:"JBIG",A85:"A85",AHX:"AHX",CCF:"CCF",RLX:"RLX"};t.StreamType=D;let L={UNKNOWN:"UNKNOWN",TYPE1:"TYPE1",TYPE1STANDARD:"TYPE1STANDARD",TYPE1C:"TYPE1C",CIDFONTTYPE0:"CIDFONTTYPE0",CIDFONTTYPE0C:"CIDFONTTYPE0C",TRUETYPE:"TRUETYPE",CIDFONTTYPE2:"CIDFONTTYPE2",TYPE3:"TYPE3",OPENTYPE:"OPENTYPE",TYPE0:"TYPE0",MMTYPE1:"MMTYPE1"};t.FontType=L;let J={ERRORS:0,WARNINGS:1,INFOS:5};t.VerbosityLevel=J;let ae={NONE:0,BINARY:1,STREAM:2};t.CMapCompressionType=ae;let Q={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};t.OPS=Q;let ee={unknown:"unknown",forms:"forms",javaScript:"javaScript",signatures:"signatures",smask:"smask",shadingPattern:"shadingPattern",font:"font",errorTilingPattern:"errorTilingPattern",errorExtGState:"errorExtGState",errorXObject:"errorXObject",errorFontLoadType3:"errorFontLoadType3",errorFontState:"errorFontState",errorFontMissing:"errorFontMissing",errorFontTranslate:"errorFontTranslate",errorColorSpace:"errorColorSpace",errorOperatorList:"errorOperatorList",errorFontToUnicode:"errorFontToUnicode",errorFontLoadNative:"errorFontLoadNative",errorFontBuildPath:"errorFontBuildPath",errorFontGetPath:"errorFontGetPath",errorMarkedContent:"errorMarkedContent",errorContentSubStream:"errorContentSubStream"};t.UNSUPPORTED_FEATURES=ee;let K={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};t.PasswordResponses=K;let $=J.WARNINGS;function te(ue){Number.isInteger(ue)&&($=ue)}function xe(){return $}function be(ue){$>=J.INFOS&&console.log(`Info: ${ue}`)}function Ue(ue){$>=J.WARNINGS&&console.log(`Warning: ${ue}`)}function Y(ue){throw new Error(ue)}function P(ue,ne){ue||Y(ne)}function C(ue){if(!ue)return!1;switch(ue.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function N(ue,ne=null,ie=null){if(!ue)return null;try{if(ie&&typeof ue=="string"){if(ie.addDefaultProtocol&&ue.startsWith("www.")){let ze=ue.match(/\./g);ze&&ze.length>=2&&(ue=`http://${ue}`)}if(ie.tryConvertEncoding)try{ue=Lr(ue)}catch{}}let Be=ne?new URL(ue,ne):new URL(ue);if(C(Be))return Be}catch{}return null}function j(ue,ne,ie){return Object.defineProperty(ue,ne,{value:ie,enumerable:!0,configurable:!0,writable:!1}),ie}let z=function(){function ne(ie,Be){this.constructor===ne&&Y("Cannot initialize BaseException."),this.message=ie,this.name=Be}return ne.prototype=new Error,ne.constructor=ne,ne}();t.BaseException=z;class X extends z{constructor(ne,ie){super(ne,"PasswordException"),this.code=ie}}t.PasswordException=X;class oe extends z{constructor(ne,ie){super(ne,"UnknownErrorException"),this.details=ie}}t.UnknownErrorException=oe;class se extends z{constructor(ne){super(ne,"InvalidPDFException")}}t.InvalidPDFException=se;class S extends z{constructor(ne){super(ne,"MissingPDFException")}}t.MissingPDFException=S;class R extends z{constructor(ne,ie){super(ne,"UnexpectedResponseException"),this.status=ie}}t.UnexpectedResponseException=R;class O extends z{constructor(ne){super(ne,"FormatError")}}t.FormatError=O;class U extends z{constructor(ne){super(ne,"AbortException")}}t.AbortException=U;function G(ue){(typeof ue!="object"||ue===null||ue.length===void 0)&&Y("Invalid argument for bytesToString");let ne=ue.length,ie=8192;if(ne<ie)return String.fromCharCode.apply(null,ue);let Be=[];for(let ze=0;ze<ne;ze+=ie){let Qe=Math.min(ze+ie,ne),Ze=ue.subarray(ze,Qe);Be.push(String.fromCharCode.apply(null,Ze))}return Be.join("")}function Z(ue){typeof ue!="string"&&Y("Invalid argument for stringToBytes");let ne=ue.length,ie=new Uint8Array(ne);for(let Be=0;Be<ne;++Be)ie[Be]=ue.charCodeAt(Be)&255;return ie}function he(ue){if(ue.length!==void 0)return ue.length;if(ue.byteLength!==void 0)return ue.byteLength;Y("Invalid argument for arrayByteLength")}function Pe(ue){let ne=ue.length;if(ne===1&&ue[0]instanceof Uint8Array)return ue[0];let ie=0;for(let Qe=0;Qe<ne;Qe++)ie+=he(ue[Qe]);let Be=0,ze=new Uint8Array(ie);for(let Qe=0;Qe<ne;Qe++){let Ze=ue[Qe];Ze instanceof Uint8Array||(typeof Ze=="string"?Ze=Z(Ze):Ze=new Uint8Array(Ze));let yt=Ze.byteLength;ze.set(Ze,Be),Be+=yt}return ze}function pe(ue){return String.fromCharCode(ue>>24&255,ue>>16&255,ue>>8&255,ue&255)}function de(ue){return Object.keys(ue).length}function ge(ue){let ne=Object.create(null);for(let[ie,Be]of ue)ne[ie]=Be;return ne}function Se(){let ue=new Uint8Array(4);return ue[0]=1,new Uint32Array(ue.buffer,0,1)[0]===1}function Oe(){try{return new Function(""),!0}catch{return!1}}class q{static get isLittleEndian(){return j(this,"isLittleEndian",Se())}static get isEvalSupported(){return j(this,"isEvalSupported",Oe())}static get isOffscreenCanvasSupported(){return j(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}}t.FeatureTest=q;let ke=[...Array(256).keys()].map(ue=>ue.toString(16).padStart(2,"0"));class Ge{static makeHexColor(ne,ie,Be){return`#${ke[ne]}${ke[ie]}${ke[Be]}`}static scaleMinMax(ne,ie){let Be;ne[0]?(ne[0]<0&&(Be=ie[0],ie[0]=ie[1],ie[1]=Be),ie[0]*=ne[0],ie[1]*=ne[0],ne[3]<0&&(Be=ie[2],ie[2]=ie[3],ie[3]=Be),ie[2]*=ne[3],ie[3]*=ne[3]):(Be=ie[0],ie[0]=ie[2],ie[2]=Be,Be=ie[1],ie[1]=ie[3],ie[3]=Be,ne[1]<0&&(Be=ie[2],ie[2]=ie[3],ie[3]=Be),ie[2]*=ne[1],ie[3]*=ne[1],ne[2]<0&&(Be=ie[0],ie[0]=ie[1],ie[1]=Be),ie[0]*=ne[2],ie[1]*=ne[2]),ie[0]+=ne[4],ie[1]+=ne[4],ie[2]+=ne[5],ie[3]+=ne[5]}static transform(ne,ie){return[ne[0]*ie[0]+ne[2]*ie[1],ne[1]*ie[0]+ne[3]*ie[1],ne[0]*ie[2]+ne[2]*ie[3],ne[1]*ie[2]+ne[3]*ie[3],ne[0]*ie[4]+ne[2]*ie[5]+ne[4],ne[1]*ie[4]+ne[3]*ie[5]+ne[5]]}static applyTransform(ne,ie){let Be=ne[0]*ie[0]+ne[1]*ie[2]+ie[4],ze=ne[0]*ie[1]+ne[1]*ie[3]+ie[5];return[Be,ze]}static applyInverseTransform(ne,ie){let Be=ie[0]*ie[3]-ie[1]*ie[2],ze=(ne[0]*ie[3]-ne[1]*ie[2]+ie[2]*ie[5]-ie[4]*ie[3])/Be,Qe=(-ne[0]*ie[1]+ne[1]*ie[0]+ie[4]*ie[1]-ie[5]*ie[0])/Be;return[ze,Qe]}static getAxialAlignedBoundingBox(ne,ie){let Be=Ge.applyTransform(ne,ie),ze=Ge.applyTransform(ne.slice(2,4),ie),Qe=Ge.applyTransform([ne[0],ne[3]],ie),Ze=Ge.applyTransform([ne[2],ne[1]],ie);return[Math.min(Be[0],ze[0],Qe[0],Ze[0]),Math.min(Be[1],ze[1],Qe[1],Ze[1]),Math.max(Be[0],ze[0],Qe[0],Ze[0]),Math.max(Be[1],ze[1],Qe[1],Ze[1])]}static inverseTransform(ne){let ie=ne[0]*ne[3]-ne[1]*ne[2];return[ne[3]/ie,-ne[1]/ie,-ne[2]/ie,ne[0]/ie,(ne[2]*ne[5]-ne[4]*ne[3])/ie,(ne[4]*ne[1]-ne[5]*ne[0])/ie]}static apply3dTransform(ne,ie){return[ne[0]*ie[0]+ne[1]*ie[1]+ne[2]*ie[2],ne[3]*ie[0]+ne[4]*ie[1]+ne[5]*ie[2],ne[6]*ie[0]+ne[7]*ie[1]+ne[8]*ie[2]]}static singularValueDecompose2dScale(ne){let ie=[ne[0],ne[2],ne[1],ne[3]],Be=ne[0]*ie[0]+ne[1]*ie[2],ze=ne[0]*ie[1]+ne[1]*ie[3],Qe=ne[2]*ie[0]+ne[3]*ie[2],Ze=ne[2]*ie[1]+ne[3]*ie[3],yt=(Be+Ze)/2,mn=Math.sqrt((Be+Ze)**2-4*(Be*Ze-Qe*ze))/2,jt=yt+mn||1,nt=yt-mn||1;return[Math.sqrt(jt),Math.sqrt(nt)]}static normalizeRect(ne){let ie=ne.slice(0);return ne[0]>ne[2]&&(ie[0]=ne[2],ie[2]=ne[0]),ne[1]>ne[3]&&(ie[1]=ne[3],ie[3]=ne[1]),ie}static intersect(ne,ie){let Be=Math.max(Math.min(ne[0],ne[2]),Math.min(ie[0],ie[2])),ze=Math.min(Math.max(ne[0],ne[2]),Math.max(ie[0],ie[2]));if(Be>ze)return null;let Qe=Math.max(Math.min(ne[1],ne[3]),Math.min(ie[1],ie[3])),Ze=Math.min(Math.max(ne[1],ne[3]),Math.max(ie[1],ie[3]));return Qe>Ze?null:[Be,Qe,ze,Ze]}static bezierBoundingBox(ne,ie,Be,ze,Qe,Ze,yt,mn){let jt=[],nt=[[],[]],Tn,vn,$n,Ht,En,Ur,Ni,Hi;for(let fo=0;fo<2;++fo){if(fo===0?(vn=6*ne-12*Be+6*Qe,Tn=-3*ne+9*Be-9*Qe+3*yt,$n=3*Be-3*ne):(vn=6*ie-12*ze+6*Ze,Tn=-3*ie+9*ze-9*Ze+3*mn,$n=3*ze-3*ie),Math.abs(Tn)<1e-12){if(Math.abs(vn)<1e-12)continue;Ht=-$n/vn,0<Ht&&Ht<1&&jt.push(Ht);continue}Ni=vn*vn-4*$n*Tn,Hi=Math.sqrt(Ni),!(Ni<0)&&(En=(-vn+Hi)/(2*Tn),0<En&&En<1&&jt.push(En),Ur=(-vn-Hi)/(2*Tn),0<Ur&&Ur<1&&jt.push(Ur))}let ni=jt.length,In,zr=ni;for(;ni--;)Ht=jt[ni],In=1-Ht,nt[0][ni]=In*In*In*ne+3*In*In*Ht*Be+3*In*Ht*Ht*Qe+Ht*Ht*Ht*yt,nt[1][ni]=In*In*In*ie+3*In*In*Ht*ze+3*In*Ht*Ht*Ze+Ht*Ht*Ht*mn;return nt[0][zr]=ne,nt[1][zr]=ie,nt[0][zr+1]=yt,nt[1][zr+1]=mn,nt[0].length=nt[1].length=zr+2,[Math.min(...nt[0]),Math.min(...nt[1]),Math.max(...nt[0]),Math.max(...nt[1])]}}t.Util=Ge;let $e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function it(ue){if(ue[0]>="\xEF"){let ie;if(ue[0]==="\xFE"&&ue[1]==="\xFF"?ie="utf-16be":ue[0]==="\xFF"&&ue[1]==="\xFE"?ie="utf-16le":ue[0]==="\xEF"&&ue[1]==="\xBB"&&ue[2]==="\xBF"&&(ie="utf-8"),ie)try{let Be=new TextDecoder(ie,{fatal:!0}),ze=Z(ue);return Be.decode(ze)}catch(Be){Ue(`stringToPDFString: "${Be}".`)}}let ne=[];for(let ie=0,Be=ue.length;ie<Be;ie++){let ze=$e[ue.charCodeAt(ie)];ne.push(ze?String.fromCharCode(ze):ue.charAt(ie))}return ne.join("")}function _t(ue){return ue.replace(/([()\\\n\r])/g,ne=>ne===`
`?"\\n":ne==="\r"?"\\r":`\\${ne}`)}function Nn(ue){return/^[\x00-\x7F]*$/.test(ue)}function Jt(ue){let ne=["\xFE\xFF"];for(let ie=0,Be=ue.length;ie<Be;ie++){let ze=ue.charCodeAt(ie);ne.push(String.fromCharCode(ze>>8&255),String.fromCharCode(ze&255))}return ne.join("")}function Lr(ue){return decodeURIComponent(escape(ue))}function bt(ue){return unescape(encodeURIComponent(ue))}function rn(ue){return typeof ue=="object"&&ue!==null&&ue.byteLength!==void 0}function ti(ue,ne){if(ue.length!==ne.length)return!1;for(let ie=0,Be=ue.length;ie<Be;ie++)if(ue[ie]!==ne[ie])return!1;return!0}function ve(ue=new Date){return[ue.getUTCFullYear().toString(),(ue.getUTCMonth()+1).toString().padStart(2,"0"),ue.getUTCDate().toString().padStart(2,"0"),ue.getUTCHours().toString().padStart(2,"0"),ue.getUTCMinutes().toString().padStart(2,"0"),ue.getUTCSeconds().toString().padStart(2,"0")].join("")}function Ce(){let ue=Object.create(null),ne=!1;return Object.defineProperty(ue,"settled",{get(){return ne}}),ue.promise=new Promise(function(ie,Be){ue.resolve=function(ze){ne=!0,ie(ze)},ue.reject=function(ze){ne=!0,Be(ze)}}),ue}},(r,t,e)=>{var n=e(3)},(r,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNodeJS=void 0;let e=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");t.isNodeJS=e},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var r,e,n,i,o,s,l,c,Yv,p,f;Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.setPDFNetworkStreamFactory=setPDFNetworkStreamFactory,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(5),_display_utils=__w_pdfjs_require__(8),_font_loader=__w_pdfjs_require__(11),_canvas=__w_pdfjs_require__(12),_worker_options=__w_pdfjs_require__(15),_is_node=__w_pdfjs_require__(3),_message_handler=__w_pdfjs_require__(16),_metadata=__w_pdfjs_require__(17),_optional_content_config=__w_pdfjs_require__(18),_transport_stream=__w_pdfjs_require__(19),_xfa_text=__w_pdfjs_require__(20);let DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DefaultCanvasFactory=_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultStandardFontDataFactory=_display_utils.DOMStandardFontDataFactory;if(exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){let{NodeCanvasFactory:A,NodeCMapReaderFactory:m,NodeStandardFontDataFactory:d}=__w_pdfjs_require__(21);exports.DefaultCanvasFactory=DefaultCanvasFactory=A,exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory=m,exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory=d}let createPDFNetworkStream;function setPDFNetworkStreamFactory(A){createPDFNetworkStream=A}function getDocument(A){let m=new PDFDocumentLoadingTask,d;if(typeof A=="string"||A instanceof URL)d={url:A};else if((0,_util.isArrayBuffer)(A))d={data:A};else if(A instanceof PDFDataRangeTransport)d={range:A};else{if(typeof A!="object")throw new Error("Invalid parameter in getDocument, need either string, URL, TypedArray, or parameter object.");if(!A.url&&!A.data&&!A.range)throw new Error("Invalid parameter object: need either .data, .range or .url");d=A}let h=Object.create(null),M=null,k=null;for(let b in d){let g=d[b];switch(b){case"url":if(typeof window<"u")try{h[b]=new URL(g,window.location).href;continue}catch(v){(0,_util.warn)(`Cannot create valid URL: "${v}".`)}else if(typeof g=="string"||g instanceof URL){h[b]=g.toString();continue}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.");case"range":M=g;continue;case"worker":k=g;continue;case"data":if(_is_node.isNodeJS&&typeof Buffer<"u"&&g instanceof Buffer)h[b]=new Uint8Array(g);else{if(g instanceof Uint8Array)break;if(typeof g=="string")h[b]=(0,_util.stringToBytes)(g);else if(typeof g=="object"&&g!==null&&!isNaN(g.length))h[b]=new Uint8Array(g);else if((0,_util.isArrayBuffer)(g))h[b]=new Uint8Array(g);else throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}continue}h[b]=g}if(h.CMapReaderFactory=h.CMapReaderFactory||DefaultCMapReaderFactory,h.StandardFontDataFactory=h.StandardFontDataFactory||DefaultStandardFontDataFactory,h.ignoreErrors=h.stopAtErrors!==!0,h.fontExtraProperties=h.fontExtraProperties===!0,h.pdfBug=h.pdfBug===!0,h.enableXfa=h.enableXfa===!0,(!Number.isInteger(h.rangeChunkSize)||h.rangeChunkSize<1)&&(h.rangeChunkSize=DEFAULT_RANGE_CHUNK_SIZE),(typeof h.docBaseUrl!="string"||(0,_display_utils.isDataScheme)(h.docBaseUrl))&&(h.docBaseUrl=null),(!Number.isInteger(h.maxImageSize)||h.maxImageSize<-1)&&(h.maxImageSize=-1),typeof h.cMapUrl!="string"&&(h.cMapUrl=null),typeof h.standardFontDataUrl!="string"&&(h.standardFontDataUrl=null),typeof h.useWorkerFetch!="boolean"&&(h.useWorkerFetch=h.CMapReaderFactory===_display_utils.DOMCMapReaderFactory&&h.StandardFontDataFactory===_display_utils.DOMStandardFontDataFactory),typeof h.isEvalSupported!="boolean"&&(h.isEvalSupported=!0),typeof h.disableFontFace!="boolean"&&(h.disableFontFace=_is_node.isNodeJS),typeof h.useSystemFonts!="boolean"&&(h.useSystemFonts=!_is_node.isNodeJS&&!h.disableFontFace),(typeof h.ownerDocument!="object"||h.ownerDocument===null)&&(h.ownerDocument=globalThis.document),typeof h.disableRange!="boolean"&&(h.disableRange=!1),typeof h.disableStream!="boolean"&&(h.disableStream=!1),typeof h.disableAutoFetch!="boolean"&&(h.disableAutoFetch=!1),(0,_util.setVerbosityLevel)(h.verbosity),!k){let b={verbosity:h.verbosity,port:_worker_options.GlobalWorkerOptions.workerPort};k=b.port?PDFWorker.fromPort(b):new PDFWorker(b),m._worker=k}let E=m.docId;return k.promise.then(function(){if(m.destroyed)throw new Error("Loading aborted");let b=_fetchDocument(k,h,M,E),g=new Promise(function(v){let y;M?y=new _transport_stream.PDFDataTransportStream({length:h.length,initialData:h.initialData,progressiveDone:h.progressiveDone,contentDispositionFilename:h.contentDispositionFilename,disableRange:h.disableRange,disableStream:h.disableStream},M):h.data||(y=createPDFNetworkStream({url:h.url,length:h.length,httpHeaders:h.httpHeaders,withCredentials:h.withCredentials,rangeChunkSize:h.rangeChunkSize,disableRange:h.disableRange,disableStream:h.disableStream})),v(y)});return Promise.all([b,g]).then(function([v,y]){if(m.destroyed)throw new Error("Loading aborted");let V=new _message_handler.MessageHandler(E,v,k.port),B=new WorkerTransport(V,m,y,h);m._transport=B,V.send("Ready",null)})}).catch(m._capability.reject),m}async function _fetchDocument(A,m,d,h){if(A.destroyed)throw new Error("Worker was destroyed");d&&(m.length=d.length,m.initialData=d.initialData,m.progressiveDone=d.progressiveDone,m.contentDispositionFilename=d.contentDispositionFilename);let M=await A.messageHandler.sendWithPromise("GetDocRequest",{docId:h,apiVersion:"2.16.105",source:{data:m.data,url:m.url,password:m.password,disableAutoFetch:m.disableAutoFetch,rangeChunkSize:m.rangeChunkSize,length:m.length},maxImageSize:m.maxImageSize,disableFontFace:m.disableFontFace,docBaseUrl:m.docBaseUrl,ignoreErrors:m.ignoreErrors,isEvalSupported:m.isEvalSupported,fontExtraProperties:m.fontExtraProperties,enableXfa:m.enableXfa,useSystemFonts:m.useSystemFonts,cMapUrl:m.useWorkerFetch?m.cMapUrl:null,standardFontDataUrl:m.useWorkerFetch?m.standardFontDataUrl:null});if(m.data&&(m.data=null),A.destroyed)throw new Error("Worker was destroyed");return M}let t=class{constructor(){this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId=`d${Sg(t,r)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null,this.onUnsupportedFeature=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0,await this._transport?.destroy(),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}},PDFDocumentLoadingTask=t;r=new WeakMap,Fe(PDFDocumentLoadingTask,r,0),exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(m,d,h=!1,M=null){this.length=m,this.initialData=d,this.progressiveDone=h,this.contentDispositionFilename=M,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(m){this._rangeListeners.push(m)}addProgressListener(m){this._progressListeners.push(m)}addProgressiveReadListener(m){this._progressiveReadListeners.push(m)}addProgressiveDoneListener(m){this._progressiveDoneListeners.push(m)}onDataRange(m,d){for(let h of this._rangeListeners)h(m,d)}onDataProgress(m,d){this._readyCapability.promise.then(()=>{for(let h of this._progressListeners)h(m,d)})}onDataProgressiveRead(m){this._readyCapability.promise.then(()=>{for(let d of this._progressiveReadListeners)d(m)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let m of this._progressiveDoneListeners)m()})}transportReady(){this._readyCapability.resolve()}requestDataRange(m,d){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(m,d){this._pdfInfo=m,this._transport=d,Object.defineProperty(this,"fingerprint",{get(){return(0,_display_utils.deprecated)("`PDFDocumentProxy.fingerprint`, please use `PDFDocumentProxy.fingerprints` instead."),this.fingerprints[0]}}),Object.defineProperty(this,"getStats",{value:async()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getStats`, please use the `PDFDocumentProxy.stats`-getter instead."),this.stats||{streamTypes:{},fontTypes:{}})})}get annotationStorage(){return this._transport.annotationStorage}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get stats(){return this._transport.stats}get isPureXfa(){return!!this._transport._htmlForXfa}get allXfaHtml(){return this._transport._htmlForXfa}getPage(m){return this._transport.getPage(m)}getPageIndex(m){return this._transport.getPageIndex(m)}getDestinations(){return this._transport.getDestinations()}getDestination(m){return this._transport.getDestination(m)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(m=!1){return this._transport.startCleanup(m||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}saveDocument(){return this._transport.annotationStorage.size<=0&&(0,_display_utils.deprecated)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead."),this._transport.saveDocument()}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(m,d,h,M,k=!1){this._pageIndex=m,this._pageInfo=d,this._ownerDocument=M,this._transport=h,this._stats=k?new _display_utils.StatTimer:null,this._pdfBug=k,this.commonObjs=h.commonObjs,this.objs=new PDFObjects,this._bitmaps=new Set,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this._annotationPromises=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:m,rotation:d=this.rotate,offsetX:h=0,offsetY:M=0,dontFlip:k=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:m,rotation:d,offsetX:h,offsetY:M,dontFlip:k})}getAnnotations({intent:m="display"}={}){let d=this._transport.getRenderingIntent(m),h=this._annotationPromises.get(d.cacheKey);return h||(h=this._transport.getAnnotations(this._pageIndex,d.renderingIntent),this._annotationPromises.set(d.cacheKey,h),h=h.then(M=>{for(let k of M)k.titleObj!==void 0&&Object.defineProperty(k,"title",{get(){return(0,_display_utils.deprecated)("`title`-property on annotation, please use `titleObj` instead."),k.titleObj.str}}),k.contentsObj!==void 0&&Object.defineProperty(k,"contents",{get(){return(0,_display_utils.deprecated)("`contents`-property on annotation, please use `contentsObj` instead."),k.contentsObj.str}});return M})),h}getJSActions(){return this._jsActionsPromise||=this._transport.getPageJSActions(this._pageIndex)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:m,viewport:d,intent:h="display",annotationMode:M=_util.AnnotationMode.ENABLE,transform:k=null,imageLayer:E=null,canvasFactory:b=null,background:g=null,optionalContentConfigPromise:v=null,annotationCanvasMap:y=null,pageColors:V=null,printAnnotationStorage:B=null}){arguments[0]?.renderInteractiveForms!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `renderInteractiveForms`-option, please use the `annotationMode`-option instead."),arguments[0].renderInteractiveForms===!0&&M===_util.AnnotationMode.ENABLE&&(M=_util.AnnotationMode.ENABLE_FORMS)),arguments[0]?.includeAnnotationStorage!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `includeAnnotationStorage`-option, please use the `annotationMode`-option instead."),arguments[0].includeAnnotationStorage===!0&&M===_util.AnnotationMode.ENABLE&&(M=_util.AnnotationMode.ENABLE_STORAGE)),this._stats&&this._stats.time("Overall");let D=this._transport.getRenderingIntent(h,M,B);this.pendingCleanup=!1,v||(v=this._transport.getOptionalContentConfig());let L=this._intentStates.get(D.cacheKey);L||(L=Object.create(null),this._intentStates.set(D.cacheKey,L)),L.streamReaderCancelTimeout&&(clearTimeout(L.streamReaderCancelTimeout),L.streamReaderCancelTimeout=null);let J=b||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),ae=!!(D.renderingIntent&_util.RenderingIntentFlag.PRINT);L.displayReadyCapability||(L.displayReadyCapability=(0,_util.createPromiseCapability)(),L.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(D));let Q=$=>{L.renderTasks.delete(ee),(this.cleanupAfterRender||ae)&&(this.pendingCleanup=!0),this._tryCleanup(),$?(ee.capability.reject($),this._abortOperatorList({intentState:L,reason:$ instanceof Error?$:new Error($)})):ee.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"))},ee=new InternalRenderTask({callback:Q,params:{canvasContext:m,viewport:d,transform:k,imageLayer:E,background:g},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:y,operatorList:L.operatorList,pageIndex:this._pageIndex,canvasFactory:J,useRequestAnimationFrame:!ae,pdfBug:this._pdfBug,pageColors:V});(L.renderTasks||=new Set).add(ee);let K=ee.task;return Promise.all([L.displayReadyCapability.promise,v]).then(([$,te])=>{if(this.pendingCleanup){Q();return}this._stats&&this._stats.time("Rendering"),ee.initializeGraphics({transparency:$,optionalContentConfig:te}),ee.operatorListChanged()}).catch(Q),K}getOperatorList({intent:m="display",annotationMode:d=_util.AnnotationMode.ENABLE,printAnnotationStorage:h=null}={}){function M(){E.operatorList.lastChunk&&(E.opListReadCapability.resolve(E.operatorList),E.renderTasks.delete(b))}let k=this._transport.getRenderingIntent(m,d,h,!0),E=this._intentStates.get(k.cacheKey);E||(E=Object.create(null),this._intentStates.set(k.cacheKey,E));let b;return E.opListReadCapability||(b=Object.create(null),b.operatorListChanged=M,E.opListReadCapability=(0,_util.createPromiseCapability)(),(E.renderTasks||=new Set).add(b),E.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(k)),E.opListReadCapability.promise}streamTextContent({disableCombineTextItems:m=!1,includeMarkedContent:d=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,combineTextItems:m!==!0,includeMarkedContent:d===!0},{highWaterMark:100,size(M){return M.items.length}})}getTextContent(m={}){if(this._transport._htmlForXfa)return this.getXfa().then(h=>_xfa_text.XfaText.textContent(h));let d=this.streamTextContent(m);return new Promise(function(h,M){function k(){E.read().then(function({value:g,done:v}){if(v){h(b);return}Object.assign(b.styles,g.styles),b.items.push(...g.items),k()},M)}let E=d.getReader(),b={items:[],styles:Object.create(null)};k()})}getStructTree(){return this._structTreePromise||=this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let m=[];for(let d of this._intentStates.values())if(this._abortOperatorList({intentState:d,reason:new Error("Page was destroyed."),force:!0}),!d.opListReadCapability)for(let h of d.renderTasks)m.push(h.completed),h.cancel();this.objs.clear();for(let d of this._bitmaps)d.close();return this._bitmaps.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,this.pendingCleanup=!1,Promise.all(m)}cleanup(m=!1){return this.pendingCleanup=!0,this._tryCleanup(m)}_tryCleanup(m=!1){if(!this.pendingCleanup)return!1;for(let{renderTasks:d,operatorList:h}of this._intentStates.values())if(d.size>0||!h.lastChunk)return!1;this._intentStates.clear(),this.objs.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,m&&this._stats&&(this._stats=new _display_utils.StatTimer);for(let d of this._bitmaps)d.close();return this._bitmaps.clear(),this.pendingCleanup=!1,!0}_startRenderPage(m,d){let h=this._intentStates.get(d);h&&(this._stats&&this._stats.timeEnd("Page Request"),h.displayReadyCapability&&h.displayReadyCapability.resolve(m))}_renderPageChunk(m,d){for(let h=0,M=m.length;h<M;h++)d.operatorList.fnArray.push(m.fnArray[h]),d.operatorList.argsArray.push(m.argsArray[h]);d.operatorList.lastChunk=m.lastChunk,d.operatorList.separateAnnots=m.separateAnnots;for(let h of d.renderTasks)h.operatorListChanged();m.lastChunk&&this._tryCleanup()}_pumpOperatorList({renderingIntent:m,cacheKey:d,annotationStorageMap:h}){let k=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:m,cacheKey:d,annotationStorage:h}).getReader(),E=this._intentStates.get(d);E.streamReader=k;let b=()=>{k.read().then(({value:g,done:v})=>{if(v){E.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(g,E),b())},g=>{if(E.streamReader=null,!this._transport.destroyed){if(E.operatorList){E.operatorList.lastChunk=!0;for(let v of E.renderTasks)v.operatorListChanged();this._tryCleanup()}if(E.displayReadyCapability)E.displayReadyCapability.reject(g);else if(E.opListReadCapability)E.opListReadCapability.reject(g);else throw g}})};b()}_abortOperatorList({intentState:m,reason:d,force:h=!1}){if(m.streamReader){if(!h){if(m.renderTasks.size>0)return;if(d instanceof _display_utils.RenderingCancelledException){m.streamReaderCancelTimeout=setTimeout(()=>{this._abortOperatorList({intentState:m,reason:d,force:!0}),m.streamReaderCancelTimeout=null},RENDERING_CANCELLED_TIMEOUT);return}}if(m.streamReader.cancel(new _util.AbortException(d.message)).catch(()=>{}),m.streamReader=null,!this._transport.destroyed){for(let[M,k]of this._intentStates)if(k===m){this._intentStates.delete(M);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){this._listeners=[],this._deferred=Promise.resolve()}postMessage(m,d){let h={data:structuredClone(m,d)};this._deferred.then(()=>{for(let M of this._listeners)M.call(this,h)})}addEventListener(m,d){this._listeners.push(d)}removeEventListener(m,d){let h=this._listeners.indexOf(d);this._listeners.splice(h,1)}terminate(){this._listeners.length=0}}exports.LoopbackPort=LoopbackPort;let PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_is_node.isNodeJS&&typeof Ag=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){let A=document?.currentScript?.src;A&&(PDFWorkerUtil.fallbackWorkerSrc=A.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(A,m){let d;try{if(d=new URL(A),!d.origin||d.origin==="null")return!1}catch{return!1}let h=new URL(m,d);return d.origin===h.origin},PDFWorkerUtil.createCDNWrapper=function(A){let m=`importScripts("${A}");`;return URL.createObjectURL(new Blob([m]))}}let _PDFWorker=class{constructor({name:A=null,port:m=null,verbosity:d=(0,_util.getVerbosityLevel)()}={}){if(m&&H(_PDFWorker,e).has(m))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=A,this.destroyed=!1,this.verbosity=d,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,m){H(_PDFWorker,e).set(m,this),this._initializeFromPort(m);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(A){this._port=A,this._messageHandler=new _message_handler.MessageHandler("main","worker",A),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve()}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:A}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,A)||(A=PDFWorkerUtil.createCDNWrapper(new URL(A,window.location).href));let m=new Worker(A),d=new _message_handler.MessageHandler("main","worker",m),h=()=>{m.removeEventListener("error",M),d.destroy(),m.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},M=()=>{this._webWorker||h()};m.addEventListener("error",M),d.on("test",E=>{if(m.removeEventListener("error",M),this.destroyed){h();return}E?(this._messageHandler=d,this._port=m,this._webWorker=m,this._readyCapability.resolve(),d.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),d.destroy(),m.terminate())}),d.on("ready",E=>{if(m.removeEventListener("error",M),this.destroyed){h();return}try{k()}catch{this._setupFakeWorker()}});let k=()=>{let E=new Uint8Array;d.send("test",E,[E.buffer])};k();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(A=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let m=new LoopbackPort;this._port=m;let d=`fake${PDFWorkerUtil.fakeWorkerId++}`,h=new _message_handler.MessageHandler(d+"_worker",d,m);A.setup(h,m);let M=new _message_handler.MessageHandler(d,d+"_worker",m);this._messageHandler=M,this._readyCapability.resolve(),M.send("configure",{verbosity:this.verbosity})}).catch(A=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${A.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),H(_PDFWorker,e).delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(A){if(!A?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return H(this,e).has(A.port)?H(this,e).get(A.port):new _PDFWorker(A)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){let loader=async()=>{let mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&typeof Ag=="function"){let worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}},PDFWorker=_PDFWorker;e=new WeakMap,Fe(PDFWorker,e,new WeakMap),exports.PDFWorker=PDFWorker,PDFWorker.getWorkerSrc=function(){return(0,_display_utils.deprecated)("`PDFWorker.getWorkerSrc()`, please use `PDFWorker.workerSrc` instead."),this.workerSrc};class WorkerTransport{constructor(m,d,h,M){Fe(this,n,null);Fe(this,i,new Map);Fe(this,o,new Map);Fe(this,s,null);this.messageHandler=m,this.loadingTask=d,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({docId:d.docId,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:M.ownerDocument,styleElement:M.styleElement}),this._params=M,M.useWorkerFetch||(this.CMapReaderFactory=new M.CMapReaderFactory({baseUrl:M.cMapUrl,isCompressed:M.cMapPacked}),this.StandardFontDataFactory=new M.StandardFontDataFactory({baseUrl:M.standardFontDataUrl})),this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=h,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}get stats(){return H(this,n)}getRenderingIntent(m,d=_util.AnnotationMode.ENABLE,h=null,M=!1){let k=_util.RenderingIntentFlag.DISPLAY,E=null;switch(m){case"any":k=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":k=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${m}`)}switch(d){case _util.AnnotationMode.DISABLE:k+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:k+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:k+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,E=(k&_util.RenderingIntentFlag.PRINT&&h instanceof _annotation_storage.PrintAnnotationStorage?h:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${d}`)}return M&&(k+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:k,cacheKey:`${k}_${_annotation_storage.AnnotationStorage.getHash(E)}`,annotationStorageMap:E}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));let m=[];for(let h of H(this,i).values())m.push(h._destroy());H(this,i).clear(),H(this,o).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let d=this.messageHandler.sendWithPromise("Terminate",null);return m.push(d),Promise.all(m).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),He(this,s,null),this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null,this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:m,loadingTask:d}=this;m.on("GetReader",(h,M)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=k=>{this._lastProgress={loaded:k.loaded,total:k.total}},M.onPull=()=>{this._fullReader.read().then(function({value:k,done:E}){if(E){M.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(k),"GetReader - expected an ArrayBuffer."),M.enqueue(new Uint8Array(k),1,[k])}).catch(k=>{M.error(k)})},M.onCancel=k=>{this._fullReader.cancel(k),M.ready.catch(E=>{if(!this.destroyed)throw E})}}),m.on("ReaderHeadersReady",h=>{let M=(0,_util.createPromiseCapability)(),k=this._fullReader;return k.headersReady.then(()=>{(!k.isStreamingSupported||!k.isRangeSupported)&&(this._lastProgress&&d.onProgress?.(this._lastProgress),k.onProgress=E=>{d.onProgress?.({loaded:E.loaded,total:E.total})}),M.resolve({isStreamingSupported:k.isStreamingSupported,isRangeSupported:k.isRangeSupported,contentLength:k.contentLength})},M.reject),M.promise}),m.on("GetRangeReader",(h,M)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let k=this._networkStream.getRangeReader(h.begin,h.end);if(!k){M.close();return}M.onPull=()=>{k.read().then(function({value:E,done:b}){if(b){M.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(E),"GetRangeReader - expected an ArrayBuffer."),M.enqueue(new Uint8Array(E),1,[E])}).catch(E=>{M.error(E)})},M.onCancel=E=>{k.cancel(E),M.ready.catch(b=>{if(!this.destroyed)throw b})}}),m.on("GetDoc",({pdfInfo:h})=>{this._numPages=h.numPages,this._htmlForXfa=h.htmlForXfa,delete h.htmlForXfa,d._capability.resolve(new PDFDocumentProxy(h,this))}),m.on("DocException",function(h){let M;switch(h.name){case"PasswordException":M=new _util.PasswordException(h.message,h.code);break;case"InvalidPDFException":M=new _util.InvalidPDFException(h.message);break;case"MissingPDFException":M=new _util.MissingPDFException(h.message);break;case"UnexpectedResponseException":M=new _util.UnexpectedResponseException(h.message,h.status);break;case"UnknownErrorException":M=new _util.UnknownErrorException(h.message,h.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}d._capability.reject(M)}),m.on("PasswordRequest",h=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),d.onPassword){let M=k=>{k instanceof Error?this._passwordCapability.reject(k):this._passwordCapability.resolve({password:k})};try{d.onPassword(M,h.code)}catch(k){this._passwordCapability.reject(k)}}else this._passwordCapability.reject(new _util.PasswordException(h.message,h.code));return this._passwordCapability.promise}),m.on("DataLoaded",h=>{d.onProgress?.({loaded:h.length,total:h.length}),this.downloadInfoCapability.resolve(h)}),m.on("StartRenderPage",h=>{if(this.destroyed)return;H(this,i).get(h.pageIndex)._startRenderPage(h.transparency,h.cacheKey)}),m.on("commonobj",([h,M,k])=>{if(!this.destroyed&&!this.commonObjs.has(h))switch(M){case"Font":let E=this._params;if("error"in k){let v=k.error;(0,_util.warn)(`Error during font loading: ${v}`),this.commonObjs.resolve(h,v);break}let b=null;E.pdfBug&&globalThis.FontInspector?.enabled&&(b={registerFont(v,y){globalThis.FontInspector.fontAdded(v,y)}});let g=new _font_loader.FontFaceObject(k,{isEvalSupported:E.isEvalSupported,disableFontFace:E.disableFontFace,ignoreErrors:E.ignoreErrors,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),fontRegistry:b});this.fontLoader.bind(g).catch(v=>m.sendWithPromise("FontFallback",{id:h})).finally(()=>{!E.fontExtraProperties&&g.data&&(g.data=null),this.commonObjs.resolve(h,g)});break;case"FontPath":case"Image":this.commonObjs.resolve(h,k);break;default:throw new Error(`Got unknown common object type ${M}`)}}),m.on("obj",([h,M,k,E])=>{if(this.destroyed)return;let b=H(this,i).get(M);if(!b.objs.has(h))switch(k){case"Image":b.objs.resolve(h,E);let g=8e6;if(E){let v;if(E.bitmap){let{bitmap:y,width:V,height:B}=E;v=V*B*4,b._bitmaps.add(y)}else v=E.data?.length||0;v>g&&(b.cleanupAfterRender=!0)}break;case"Pattern":b.objs.resolve(h,E);break;default:throw new Error(`Got unknown object type ${k}`)}}),m.on("DocProgress",h=>{this.destroyed||d.onProgress?.({loaded:h.loaded,total:h.total})}),m.on("DocStats",h=>{this.destroyed||He(this,n,Object.freeze({streamTypes:Object.freeze(h.streamTypes),fontTypes:Object.freeze(h.fontTypes)}))}),m.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),m.on("FetchBuiltInCMap",h=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.CMapReaderFactory?this.CMapReaderFactory.fetch(h):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),m.on("FetchStandardFontData",h=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.StandardFontDataFactory?this.StandardFontDataFactory.fetch(h):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}_onUnsupportedFeature({featureId:m}){this.destroyed||this.loadingTask.onUnsupportedFeature?.(m)}getData(){return this.messageHandler.sendWithPromise("GetData",null)}getPage(m){if(!Number.isInteger(m)||m<=0||m>this._numPages)return Promise.reject(new Error("Invalid page request."));let d=m-1,h=H(this,o).get(d);if(h)return h;let M=this.messageHandler.sendWithPromise("GetPage",{pageIndex:d}).then(k=>{if(this.destroyed)throw new Error("Transport destroyed");let E=new PDFPageProxy(d,k,this,this._params.ownerDocument,this._params.pdfBug);return H(this,i).set(d,E),E});return H(this,o).set(d,M),M}getPageIndex(m){return typeof m!="object"||m===null||!Number.isInteger(m.num)||m.num<0||!Number.isInteger(m.gen)||m.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:m.num,gen:m.gen})}getAnnotations(m,d){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:m,intent:d})}saveDocument(){return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:this.annotationStorage.serializable,filename:this._fullReader?.filename??null}).finally(()=>{this.annotationStorage.resetModified()})}getFieldObjects(){return this._getFieldObjectsPromise||=this.messageHandler.sendWithPromise("GetFieldObjects",null)}hasJSActions(){return this._hasJSActionsPromise||=this.messageHandler.sendWithPromise("HasJSActions",null)}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(m){return typeof m!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:m})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(m){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:m})}getStructTree(m){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:m})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(m=>new _optional_content_config.OptionalContentConfig(m))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){return H(this,s)||He(this,s,this.messageHandler.sendWithPromise("GetMetadata",null).then(m=>({info:m[0],metadata:m[1]?new _metadata.Metadata(m[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null})))}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(m=!1){if(await this.messageHandler.sendWithPromise("Cleanup",null),!this.destroyed){for(let d of H(this,i).values())if(!d.cleanup())throw new Error(`startCleanup: Page ${d.pageNumber} is currently rendering.`);this.commonObjs.clear(),m||this.fontLoader.clear(),He(this,s,null),this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null}}get loadingParams(){let m=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:m.disableAutoFetch,enableXfa:m.enableXfa})}}n=new WeakMap,i=new WeakMap,o=new WeakMap,s=new WeakMap;class PDFObjects{constructor(){Fe(this,c);Fe(this,l,Object.create(null))}get(m,d=null){if(d){let M=_e(this,c,Yv).call(this,m);return M.capability.promise.then(()=>d(M.data)),null}let h=H(this,l)[m];if(!h?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${m}.`);return h.data}has(m){return H(this,l)[m]?.capability.settled||!1}resolve(m,d=null){let h=_e(this,c,Yv).call(this,m);h.data=d,h.capability.resolve()}clear(){He(this,l,Object.create(null))}}l=new WeakMap,c=new WeakSet,Yv=function(m){let d=H(this,l)[m];return d||(H(this,l)[m]={capability:(0,_util.createPromiseCapability)(),data:null})};class RenderTask{constructor(m){Fe(this,p,null);He(this,p,m),this.onContinue=null}get promise(){return H(this,p).capability.promise}cancel(){H(this,p).cancel()}get separateAnnots(){let{separateAnnots:m}=H(this,p).operatorList;if(!m)return!1;let{annotationCanvasMap:d}=H(this,p);return m.form||m.canvas&&d?.size>0}}p=new WeakMap,exports.RenderTask=RenderTask;let w=class{constructor({callback:m,params:d,objs:h,commonObjs:M,annotationCanvasMap:k,operatorList:E,pageIndex:b,canvasFactory:g,useRequestAnimationFrame:v=!1,pdfBug:y=!1,pageColors:V=null}){this.callback=m,this.params=d,this.objs=h,this.commonObjs=M,this.annotationCanvasMap=k,this.operatorListIdx=null,this.operatorList=E,this._pageIndex=b,this.canvasFactory=g,this._pdfBug=y,this.pageColors=V,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=v===!0&&typeof window<"u",this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=d.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:m=!1,optionalContentConfig:d}){if(this.cancelled)return;if(this._canvas){if(H(w,f).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");H(w,f).add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:h,viewport:M,transform:k,imageLayer:E,background:b}=this.params;this.gfx=new _canvas.CanvasGraphics(h,this.commonObjs,this.objs,this.canvasFactory,E,d,this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:k,viewport:M,transparency:m,background:b}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}cancel(m=null){this.running=!1,this.cancelled=!0,this.gfx&&this.gfx.endDrawing(),this._canvas&&H(w,f).delete(this._canvas),this.callback(m||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas"))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}this.stepper&&this.stepper.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&H(w,f).delete(this._canvas),this.callback())))}},InternalRenderTask=w;f=new WeakMap,Fe(InternalRenderTask,f,new WeakSet);let version="2.16.105";exports.version=version;let build="172ccdbe5";exports.build=build},(r,t,e)=>{var c,$T,p;Object.defineProperty(t,"__esModule",{value:!0}),t.PrintAnnotationStorage=t.AnnotationStorage=void 0;var n=e(1),i=e(6),o=e(10);class s{constructor(){Fe(this,c);this._storage=new Map,this._modified=!1,this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(w,A){let m=this._storage.get(w);return m===void 0?A:Object.assign(A,m)}getRawValue(w){return this._storage.get(w)}remove(w){if(this._storage.delete(w),this._storage.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let A of this._storage.values())if(A instanceof i.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(w,A){let m=this._storage.get(w),d=!1;if(m!==void 0)for(let[h,M]of Object.entries(A))m[h]!==M&&(d=!0,m[h]=M);else d=!0,this._storage.set(w,A);d&&_e(this,c,$T).call(this),A instanceof i.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(A.constructor._type)}has(w){return this._storage.has(w)}getAll(){return this._storage.size>0?(0,n.objectFromMap)(this._storage):null}get size(){return this._storage.size}resetModified(){this._modified&&(this._modified=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new l(this)}get serializable(){if(this._storage.size===0)return null;let w=new Map;for(let[A,m]of this._storage){let d=m instanceof i.AnnotationEditor?m.serialize():m;d&&w.set(A,d)}return w}static getHash(w){if(!w)return"";let A=new o.MurmurHash3_64;for(let[m,d]of w)A.update(`${m}:${JSON.stringify(d)}`);return A.hexdigest()}}c=new WeakSet,$T=function(){this._modified||(this._modified=!0,typeof this.onSetModified=="function"&&this.onSetModified())},t.AnnotationStorage=s;class l extends s{constructor(A){super();Fe(this,p,null);He(this,p,structuredClone(A.serializable))}get print(){(0,n.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return H(this,p)}}p=new WeakMap,t.PrintAnnotationStorage=l},(r,t,e)=>{var s,l,c,u,p,f;Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationEditor=void 0;var n=e(7),i=e(1);let w=class{constructor(m){Fe(this,s,this.focusin.bind(this));Fe(this,l,this.focusout.bind(this));Fe(this,c,!1);Fe(this,u,!1);Fe(this,p,!1);Fe(this,f,w._zIndex++);this.constructor===w&&(0,i.unreachable)("Cannot initialize AnnotationEditor."),this.parent=m.parent,this.id=m.id,this.width=this.height=null,this.pageIndex=m.parent.pageIndex,this.name=m.name,this.div=null;let[d,h]=this.parent.viewportBaseDimensions;this.x=m.x/d,this.y=m.y/h,this.rotation=this.parent.viewport.rotation,this.isAttachedToDOM=!1}static get _defaultLineColor(){return(0,i.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=H(this,f)}focusin(m){H(this,c)?He(this,c,!1):this.parent.setSelected(this)}focusout(m){!this.isAttachedToDOM||m.relatedTarget?.closest(`#${this.id}`)||(m.preventDefault(),this.parent.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.parent.addToAnnotationStorage(this)}dragstart(m){let d=this.parent.div.getBoundingClientRect();this.startX=m.clientX-d.x,this.startY=m.clientY-d.y,m.dataTransfer.setData("text/plain",this.id),m.dataTransfer.effectAllowed="move"}setAt(m,d,h,M){let[k,E]=this.parent.viewportBaseDimensions;[h,M]=this.screenToPageTranslation(h,M),this.x=(m+h)/k,this.y=(d+M)/E,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}translate(m,d){let[h,M]=this.parent.viewportBaseDimensions;[m,d]=this.screenToPageTranslation(m,d),this.x+=m/h,this.y+=d/M,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}screenToPageTranslation(m,d){let{rotation:h}=this.parent.viewport;switch(h){case 90:return[d,-m];case 180:return[-m,-d];case 270:return[-d,m];default:return[m,d]}}setDims(m,d){let[h,M]=this.parent.viewportBaseDimensions;this.div.style.width=`${100*m/h}%`,this.div.style.height=`${100*d/M}%`}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",H(this,s)),this.div.addEventListener("focusout",H(this,l));let[m,d]=this.getInitialTranslation();return this.translate(m,d),(0,n.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(m){let d=n.KeyboardManager.platform.isMac;if(m.button!==0||m.ctrlKey&&d){m.preventDefault();return}m.ctrlKey&&!d||m.shiftKey||m.metaKey&&d?this.parent.toggleSelected(this):this.parent.setSelected(this),He(this,c,!0)}getRect(m,d){let[h,M]=this.parent.viewportBaseDimensions,[k,E]=this.parent.pageDimensions,b=k*m/h,g=E*d/M,v=this.x*k,y=this.y*E,V=this.width*k,B=this.height*E;switch(this.rotation){case 0:return[v+b,E-y-g-B,v+b+V,E-y-g];case 90:return[v+g,E-y+b,v+g+B,E-y+b+V];case 180:return[v-b-V,E-y+g,v-b,E-y+g+B];case 270:return[v-g-B,E-y-b-V,v-g,E-y-b];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(m,d){let[h,M,k,E]=m,b=k-h,g=E-M;switch(this.rotation){case 0:return[h,d-E,b,g];case 90:return[h,d-M,g,b];case 180:return[k,d-M,b,g];case 270:return[k,d-E,g,b];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){He(this,p,!0)}disableEditMode(){He(this,p,!1)}isInEditMode(){return H(this,p)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",H(this,s))}serialize(){(0,i.unreachable)("An editor must be serializable")}static deserialize(m,d){let h=new this.prototype.constructor({parent:d,id:d.getNextId()});h.rotation=m.rotation;let[M,k]=d.pageDimensions,[E,b,g,v]=h.getRectInCurrentCoords(m.rect,k);return h.x=E/M,h.y=b/k,h.width=g/M,h.height=v/k,h}remove(){this.div.removeEventListener("focusin",H(this,s)),this.div.removeEventListener("focusout",H(this,l)),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){this.div?.classList.add("selectedEditor")}unselect(){this.div?.classList.remove("selectedEditor")}updateParams(m,d){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return H(this,u)}set isEditing(m){He(this,u,m),m?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}},o=w;s=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,p=new WeakMap,f=new WeakMap,_n(o,"_colorManager",new n.ColorManager),_n(o,"_zIndex",1),t.AnnotationEditor=o},(r,t,e)=>{var A,m,d,h,M,k,ZT,g,y,V,B,D,L,J,ae,Q,ee,K,$,te,xe,be,Ue,Y,P,C,eE,j,Jv,X,$r,se,rp,R,tE,U,nE,Z,Qv,Pe,ip,de,df;Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardManager=t.CommandManager=t.ColorManager=t.AnnotationEditorUIManager=void 0,t.bindEvents=o,t.opacityToHex=s;var n=e(1),i=e(8);function o(Oe,q,ke){for(let Ge of ke)q.addEventListener(Ge,Oe[Ge].bind(Oe))}function s(Oe){return Math.round(Math.min(255,Math.max(1,255*Oe))).toString(16).padStart(2,"0")}class l{constructor(){Fe(this,A,0)}getId(){return`${n.AnnotationEditorPrefix}${Sg(this,A)._++}`}}A=new WeakMap;class c{constructor(q=128){Fe(this,m,[]);Fe(this,d,!1);Fe(this,h,void 0);Fe(this,M,-1);He(this,h,q)}add({cmd:q,undo:ke,mustExec:Ge,type:$e=NaN,overwriteIfSameType:it=!1,keepUndo:_t=!1}){if(Ge&&q(),H(this,d))return;let Nn={cmd:q,undo:ke,type:$e};if(H(this,M)===-1){H(this,m).length>0&&(H(this,m).length=0),He(this,M,0),H(this,m).push(Nn);return}if(it&&H(this,m)[H(this,M)].type===$e){_t&&(Nn.undo=H(this,m)[H(this,M)].undo),H(this,m)[H(this,M)]=Nn;return}let Jt=H(this,M)+1;Jt===H(this,h)?H(this,m).splice(0,1):(He(this,M,Jt),Jt<H(this,m).length&&H(this,m).splice(Jt)),H(this,m).push(Nn)}undo(){H(this,M)!==-1&&(He(this,d,!0),H(this,m)[H(this,M)].undo(),He(this,d,!1),He(this,M,H(this,M)-1))}redo(){H(this,M)<H(this,m).length-1&&(He(this,M,H(this,M)+1),He(this,d,!0),H(this,m)[H(this,M)].cmd(),He(this,d,!1))}hasSomethingToUndo(){return H(this,M)!==-1}hasSomethingToRedo(){return H(this,M)<H(this,m).length-1}destroy(){He(this,m,null)}}m=new WeakMap,d=new WeakMap,h=new WeakMap,M=new WeakMap,t.CommandManager=c;let b=class{constructor(q){Fe(this,k);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let ke=b.platform.isMac;for(let[Ge,$e]of q)for(let it of Ge){let _t=it.startsWith("mac+");ke&&_t?(this.callbacks.set(it.slice(4),$e),this.allKeys.add(it.split("+").at(-1))):!ke&&!_t&&(this.callbacks.set(it,$e),this.allKeys.add(it.split("+").at(-1)))}}static get platform(){let q=typeof navigator<"u"?navigator.platform:"";return(0,n.shadow)(this,"platform",{isWin:q.includes("Win"),isMac:q.includes("Mac")})}exec(q,ke){if(!this.allKeys.has(ke.key))return;let Ge=this.callbacks.get(_e(this,k,ZT).call(this,ke));Ge&&(Ge.bind(q)(),ke.stopPropagation(),ke.preventDefault())}},u=b;k=new WeakSet,ZT=function(q){q.altKey&&this.buffer.push("alt"),q.ctrlKey&&this.buffer.push("ctrl"),q.metaKey&&this.buffer.push("meta"),q.shiftKey&&this.buffer.push("shift"),this.buffer.push(q.key);let ke=this.buffer.join("+");return this.buffer.length=0,ke},t.KeyboardManager=u;class p{constructor(){Fe(this,g,null)}copy(q){q&&(Array.isArray(q)?He(this,g,q.map(ke=>ke.serialize())):He(this,g,[q.serialize()]),He(this,g,H(this,g).filter(ke=>!!ke)),H(this,g).length===0&&He(this,g,null))}paste(){return H(this,g)}isEmpty(){return H(this,g)===null}destroy(){He(this,g,null)}}g=new WeakMap;let v=class{get _colors(){let q=new Map([["CanvasText",null],["Canvas",null]]);return(0,i.getColorValues)(q),(0,n.shadow)(this,"_colors",q)}convert(q){let ke=(0,i.getRGB)(q);if(!window.matchMedia("(forced-colors: active)").matches)return ke;for(let[Ge,$e]of this._colors)if($e.every((it,_t)=>it===ke[_t]))return v._colorsMapping.get(Ge);return ke}getHexCode(q){let ke=this._colors.get(q);return ke?n.Util.makeHexColor(...ke):q}},f=v;_n(f,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]])),t.ColorManager=f;let Se=class{constructor(q,ke){Fe(this,C);Fe(this,j);Fe(this,X);Fe(this,se);Fe(this,R);Fe(this,U);Fe(this,Z);Fe(this,Pe);Fe(this,de);Fe(this,y,null);Fe(this,V,new Map);Fe(this,B,new Map);Fe(this,D,new p);Fe(this,L,new c);Fe(this,J,0);Fe(this,ae,null);Fe(this,Q,null);Fe(this,ee,new l);Fe(this,K,!1);Fe(this,$,n.AnnotationEditorType.NONE);Fe(this,te,new Set);Fe(this,xe,this.keydown.bind(this));Fe(this,be,this.onEditingAction.bind(this));Fe(this,Ue,this.onPageChanging.bind(this));Fe(this,Y,{isEditing:!1,isEmpty:!0,hasEmptyClipboard:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});Fe(this,P,null);He(this,P,q),He(this,Q,ke),H(this,Q)._on("editingaction",H(this,be)),H(this,Q)._on("pagechanging",H(this,Ue))}destroy(){_e(this,j,Jv).call(this),H(this,Q)._off("editingaction",H(this,be)),H(this,Q)._off("pagechanging",H(this,Ue));for(let q of H(this,B).values())q.destroy();H(this,B).clear(),H(this,V).clear(),He(this,y,null),H(this,te).clear(),H(this,D).destroy(),H(this,L).destroy()}onPageChanging({pageNumber:q}){He(this,J,q-1)}focusMainContainer(){H(this,P).focus()}keydown(q){this.getActive()?.shouldGetKeyboardEvents()||Se._keyboardManager.exec(this,q)}onEditingAction(q){["undo","redo","cut","copy","paste","delete","selectAll"].includes(q.name)&&this[q.name]()}setEditingState(q){q?(_e(this,C,eE).call(this),_e(this,X,$r).call(this,{isEditing:H(this,$)!==n.AnnotationEditorType.NONE,isEmpty:_e(this,Pe,ip).call(this),hasSomethingToUndo:H(this,L).hasSomethingToUndo(),hasSomethingToRedo:H(this,L).hasSomethingToRedo(),hasSelectedEditor:!1,hasEmptyClipboard:H(this,D).isEmpty()})):(_e(this,j,Jv).call(this),_e(this,X,$r).call(this,{isEditing:!1}))}registerEditorTypes(q){He(this,ae,q);for(let ke of H(this,ae))_e(this,se,rp).call(this,ke.defaultPropertiesToUpdate)}getId(){return H(this,ee).getId()}addLayer(q){H(this,B).set(q.pageIndex,q),H(this,K)?q.enable():q.disable()}removeLayer(q){H(this,B).delete(q.pageIndex)}updateMode(q){if(He(this,$,q),q===n.AnnotationEditorType.NONE)this.setEditingState(!1),_e(this,U,nE).call(this);else{this.setEditingState(!0),_e(this,R,tE).call(this);for(let ke of H(this,B).values())ke.updateMode(q)}}updateToolbar(q){q!==H(this,$)&&H(this,Q).dispatch("switchannotationeditormode",{source:this,mode:q})}updateParams(q,ke){for(let Ge of H(this,te))Ge.updateParams(q,ke);for(let Ge of H(this,ae))Ge.updateDefaultParams(q,ke)}getEditors(q){let ke=[];for(let Ge of H(this,V).values())Ge.pageIndex===q&&ke.push(Ge);return ke}getEditor(q){return H(this,V).get(q)}addEditor(q){H(this,V).set(q.id,q)}removeEditor(q){H(this,V).delete(q.id),this.unselect(q)}setActiveEditor(q){H(this,y)!==q&&(He(this,y,q),q&&_e(this,se,rp).call(this,q.propertiesToUpdate))}toggleSelected(q){if(H(this,te).has(q)){H(this,te).delete(q),q.unselect(),_e(this,X,$r).call(this,{hasSelectedEditor:this.hasSelection});return}H(this,te).add(q),q.select(),_e(this,se,rp).call(this,q.propertiesToUpdate),_e(this,X,$r).call(this,{hasSelectedEditor:!0})}setSelected(q){for(let ke of H(this,te))ke!==q&&ke.unselect();H(this,te).clear(),H(this,te).add(q),q.select(),_e(this,se,rp).call(this,q.propertiesToUpdate),_e(this,X,$r).call(this,{hasSelectedEditor:!0})}isSelected(q){return H(this,te).has(q)}unselect(q){q.unselect(),H(this,te).delete(q),_e(this,X,$r).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return H(this,te).size!==0}undo(){H(this,L).undo(),_e(this,X,$r).call(this,{hasSomethingToUndo:H(this,L).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:_e(this,Pe,ip).call(this)})}redo(){H(this,L).redo(),_e(this,X,$r).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:H(this,L).hasSomethingToRedo(),isEmpty:_e(this,Pe,ip).call(this)})}addCommands(q){H(this,L).add(q),_e(this,X,$r).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:_e(this,Pe,ip).call(this)})}delete(){if(H(this,y)&&H(this,y).commitOrRemove(),!this.hasSelection)return;let q=[...H(this,te)],ke=()=>{for(let $e of q)$e.remove()},Ge=()=>{for(let $e of q)_e(this,Z,Qv).call(this,$e)};this.addCommands({cmd:ke,undo:Ge,mustExec:!0})}copy(){if(H(this,y)&&H(this,y).commitOrRemove(),this.hasSelection){let q=[];for(let ke of H(this,te))ke.isEmpty()||q.push(ke);if(q.length===0)return;H(this,D).copy(q),_e(this,X,$r).call(this,{hasEmptyClipboard:!1})}}cut(){this.copy(),this.delete()}paste(){if(H(this,D).isEmpty())return;this.unselectAll();let q=H(this,B).get(H(this,J)),ke=H(this,D).paste().map(it=>q.deserialize(it)),Ge=()=>{for(let it of ke)_e(this,Z,Qv).call(this,it);_e(this,de,df).call(this,ke)},$e=()=>{for(let it of ke)it.remove()};this.addCommands({cmd:Ge,undo:$e,mustExec:!0})}selectAll(){for(let q of H(this,te))q.commit();_e(this,de,df).call(this,H(this,V).values())}unselectAll(){if(H(this,y)){H(this,y).commitOrRemove();return}if(_e(this,de,df).size!==0){for(let q of H(this,te))q.unselect();H(this,te).clear(),_e(this,X,$r).call(this,{hasSelectedEditor:!1})}}isActive(q){return H(this,y)===q}getActive(){return H(this,y)}getMode(){return H(this,$)}},w=Se;y=new WeakMap,V=new WeakMap,B=new WeakMap,D=new WeakMap,L=new WeakMap,J=new WeakMap,ae=new WeakMap,Q=new WeakMap,ee=new WeakMap,K=new WeakMap,$=new WeakMap,te=new WeakMap,xe=new WeakMap,be=new WeakMap,Ue=new WeakMap,Y=new WeakMap,P=new WeakMap,C=new WeakSet,eE=function(){H(this,P).addEventListener("keydown",H(this,xe))},j=new WeakSet,Jv=function(){H(this,P).removeEventListener("keydown",H(this,xe))},X=new WeakSet,$r=function(q){Object.entries(q).some(([Ge,$e])=>H(this,Y)[Ge]!==$e)&&H(this,Q).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(H(this,Y),q)})},se=new WeakSet,rp=function(q){H(this,Q).dispatch("annotationeditorparamschanged",{source:this,details:q})},R=new WeakSet,tE=function(){if(!H(this,K)){He(this,K,!0);for(let q of H(this,B).values())q.enable()}},U=new WeakSet,nE=function(){if(this.unselectAll(),H(this,K)){He(this,K,!1);for(let q of H(this,B).values())q.disable()}},Z=new WeakSet,Qv=function(q){let ke=H(this,B).get(q.pageIndex);ke?ke.addOrRebuild(q):this.addEditor(q)},Pe=new WeakSet,ip=function(){if(H(this,V).size===0)return!0;if(H(this,V).size===1)for(let q of H(this,V).values())return q.isEmpty();return!1},de=new WeakSet,df=function(q){H(this,te).clear();for(let ke of q)ke.isEmpty()||(H(this,te).add(ke),ke.select());_e(this,X,$r).call(this,{hasSelectedEditor:!0})},_n(w,"_keyboardManager",new u([[["ctrl+a","mac+meta+a"],Se.prototype.selectAll],[["ctrl+c","mac+meta+c"],Se.prototype.copy],[["ctrl+v","mac+meta+v"],Se.prototype.paste],[["ctrl+x","mac+meta+x"],Se.prototype.cut],[["ctrl+z","mac+meta+z"],Se.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],Se.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],Se.prototype.delete],[["Escape","mac+Escape"],Se.prototype.unselectAll]])),t.AnnotationEditorUIManager=w},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StatTimer=t.RenderingCancelledException=t.PixelsPerInch=t.PageViewport=t.PDFDateString=t.DOMStandardFontDataFactory=t.DOMSVGFactory=t.DOMCanvasFactory=t.DOMCMapReaderFactory=t.AnnotationPrefix=void 0,t.deprecated=v,t.getColorValues=L,t.getCurrentTransform=J,t.getCurrentTransformInverse=ae,t.getFilenameFromUrl=M,t.getPdfFilenameFromUrl=k,t.getRGB=D,t.getXfaPageViewport=B,t.isDataScheme=d,t.isPdfFile=h,t.isValidFetchUrl=b,t.loadScript=g;var n=e(9),i=e(1);let o="http://www.w3.org/2000/svg",s="pdfjs_internal_id_";t.AnnotationPrefix=s;let Q=class{},l=Q;_n(l,"CSS",96),_n(l,"PDF",72),_n(l,"PDF_TO_CSS_UNITS",Q.CSS/Q.PDF),t.PixelsPerInch=l;class c extends n.BaseCanvasFactory{constructor({ownerDocument:K=globalThis.document}={}){super(),this._document=K}_createCanvas(K,$){let te=this._document.createElement("canvas");return te.width=K,te.height=$,te}}t.DOMCanvasFactory=c;async function u(ee,K=!1){if(b(ee,document.baseURI)){let $=await fetch(ee);if(!$.ok)throw new Error($.statusText);return K?new Uint8Array(await $.arrayBuffer()):(0,i.stringToBytes)(await $.text())}return new Promise(($,te)=>{let xe=new XMLHttpRequest;xe.open("GET",ee,!0),K&&(xe.responseType="arraybuffer"),xe.onreadystatechange=()=>{if(xe.readyState===XMLHttpRequest.DONE){if(xe.status===200||xe.status===0){let be;if(K&&xe.response?be=new Uint8Array(xe.response):!K&&xe.responseText&&(be=(0,i.stringToBytes)(xe.responseText)),be){$(be);return}}te(new Error(xe.statusText))}},xe.send(null)})}class p extends n.BaseCMapReaderFactory{_fetchData(K,$){return u(K,this.isCompressed).then(te=>({cMapData:te,compressionType:$}))}}t.DOMCMapReaderFactory=p;class f extends n.BaseStandardFontDataFactory{_fetchData(K){return u(K,!0)}}t.DOMStandardFontDataFactory=f;class w extends n.BaseSVGFactory{_createSVG(K){return document.createElementNS(o,K)}}t.DOMSVGFactory=w;class A{constructor({viewBox:K,scale:$,rotation:te,offsetX:xe=0,offsetY:be=0,dontFlip:Ue=!1}){this.viewBox=K,this.scale=$,this.rotation=te,this.offsetX=xe,this.offsetY=be;let Y=(K[2]+K[0])/2,P=(K[3]+K[1])/2,C,N,j,z;switch(te%=360,te<0&&(te+=360),te){case 180:C=-1,N=0,j=0,z=1;break;case 90:C=0,N=1,j=1,z=0;break;case 270:C=0,N=-1,j=-1,z=0;break;case 0:C=1,N=0,j=0,z=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}Ue&&(j=-j,z=-z);let X,oe,se,S;C===0?(X=Math.abs(P-K[1])*$+xe,oe=Math.abs(Y-K[0])*$+be,se=Math.abs(K[3]-K[1])*$,S=Math.abs(K[2]-K[0])*$):(X=Math.abs(Y-K[0])*$+xe,oe=Math.abs(P-K[1])*$+be,se=Math.abs(K[2]-K[0])*$,S=Math.abs(K[3]-K[1])*$),this.transform=[C*$,N*$,j*$,z*$,X-C*$*Y-j*$*P,oe-N*$*Y-z*$*P],this.width=se,this.height=S}clone({scale:K=this.scale,rotation:$=this.rotation,offsetX:te=this.offsetX,offsetY:xe=this.offsetY,dontFlip:be=!1}={}){return new A({viewBox:this.viewBox.slice(),scale:K,rotation:$,offsetX:te,offsetY:xe,dontFlip:be})}convertToViewportPoint(K,$){return i.Util.applyTransform([K,$],this.transform)}convertToViewportRectangle(K){let $=i.Util.applyTransform([K[0],K[1]],this.transform),te=i.Util.applyTransform([K[2],K[3]],this.transform);return[$[0],$[1],te[0],te[1]]}convertToPdfPoint(K,$){return i.Util.applyInverseTransform([K,$],this.transform)}}t.PageViewport=A;class m extends i.BaseException{constructor(K,$){super(K,"RenderingCancelledException"),this.type=$}}t.RenderingCancelledException=m;function d(ee){let K=ee.length,$=0;for(;$<K&&ee[$].trim()==="";)$++;return ee.substring($,$+5).toLowerCase()==="data:"}function h(ee){return typeof ee=="string"&&/\.pdf$/i.test(ee)}function M(ee){let K=ee.indexOf("#"),$=ee.indexOf("?"),te=Math.min(K>0?K:ee.length,$>0?$:ee.length);return ee.substring(ee.lastIndexOf("/",te)+1,te)}function k(ee,K="document.pdf"){if(typeof ee!="string")return K;if(d(ee))return(0,i.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),K;let $=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,te=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,xe=$.exec(ee),be=te.exec(xe[1])||te.exec(xe[2])||te.exec(xe[3]);if(be&&(be=be[0],be.includes("%")))try{be=te.exec(decodeURIComponent(be))[0]}catch{}return be||K}class E{constructor(){this.started=Object.create(null),this.times=[]}time(K){K in this.started&&(0,i.warn)(`Timer is already running for ${K}`),this.started[K]=Date.now()}timeEnd(K){K in this.started||(0,i.warn)(`Timer has not been started for ${K}`),this.times.push({name:K,start:this.started[K],end:Date.now()}),delete this.started[K]}toString(){let K=[],$=0;for(let te of this.times){let xe=te.name;xe.length>$&&($=xe.length)}for(let te of this.times){let xe=te.end-te.start;K.push(`${te.name.padEnd($)} ${xe}ms
`)}return K.join("")}}t.StatTimer=E;function b(ee,K){try{let{protocol:$}=K?new URL(ee,K):new URL(ee);return $==="http:"||$==="https:"}catch{return!1}}function g(ee,K=!1){return new Promise(($,te)=>{let xe=document.createElement("script");xe.src=ee,xe.onload=function(be){K&&xe.remove(),$(be)},xe.onerror=function(){te(new Error(`Cannot load script at: ${xe.src}`))},(document.head||document.documentElement).append(xe)})}function v(ee){console.log("Deprecated API usage: "+ee)}let y;class V{static toDateObject(K){if(!K||typeof K!="string")return null;y||(y=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));let $=y.exec(K);if(!$)return null;let te=parseInt($[1],10),xe=parseInt($[2],10);xe=xe>=1&&xe<=12?xe-1:0;let be=parseInt($[3],10);be=be>=1&&be<=31?be:1;let Ue=parseInt($[4],10);Ue=Ue>=0&&Ue<=23?Ue:0;let Y=parseInt($[5],10);Y=Y>=0&&Y<=59?Y:0;let P=parseInt($[6],10);P=P>=0&&P<=59?P:0;let C=$[7]||"Z",N=parseInt($[8],10);N=N>=0&&N<=23?N:0;let j=parseInt($[9],10)||0;return j=j>=0&&j<=59?j:0,C==="-"?(Ue+=N,Y+=j):C==="+"&&(Ue-=N,Y-=j),new Date(Date.UTC(te,xe,be,Ue,Y,P))}}t.PDFDateString=V;function B(ee,{scale:K=1,rotation:$=0}){let{width:te,height:xe}=ee.attributes.style,be=[0,0,parseInt(te),parseInt(xe)];return new A({viewBox:be,scale:K,rotation:$})}function D(ee){if(ee.startsWith("#")){let K=parseInt(ee.slice(1),16);return[(K&16711680)>>16,(K&65280)>>8,K&255]}return ee.startsWith("rgb(")?ee.slice(4,-1).split(",").map(K=>parseInt(K)):ee.startsWith("rgba(")?ee.slice(5,-1).split(",").map(K=>parseInt(K)).slice(0,3):((0,i.warn)(`Not a valid color format: "${ee}"`),[0,0,0])}function L(ee){let K=document.createElement("span");K.style.visibility="hidden",document.body.append(K);for(let $ of ee.keys()){K.style.color=$;let te=window.getComputedStyle(K).color;ee.set($,D(te))}K.remove()}function J(ee){let{a:K,b:$,c:te,d:xe,e:be,f:Ue}=ee.getTransform();return[K,$,te,xe,be,Ue]}function ae(ee){let{a:K,b:$,c:te,d:xe,e:be,f:Ue}=ee.getTransform().invertSelf();return[K,$,te,xe,be,Ue]}},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseStandardFontDataFactory=t.BaseSVGFactory=t.BaseCanvasFactory=t.BaseCMapReaderFactory=void 0;var n=e(1);class i{constructor(){this.constructor===i&&(0,n.unreachable)("Cannot initialize BaseCanvasFactory.")}create(u,p){if(u<=0||p<=0)throw new Error("Invalid canvas size");let f=this._createCanvas(u,p);return{canvas:f,context:f.getContext("2d")}}reset(u,p,f){if(!u.canvas)throw new Error("Canvas is not specified");if(p<=0||f<=0)throw new Error("Invalid canvas size");u.canvas.width=p,u.canvas.height=f}destroy(u){if(!u.canvas)throw new Error("Canvas is not specified");u.canvas.width=0,u.canvas.height=0,u.canvas=null,u.context=null}_createCanvas(u,p){(0,n.unreachable)("Abstract method `_createCanvas` called.")}}t.BaseCanvasFactory=i;class o{constructor({baseUrl:u=null,isCompressed:p=!1}){this.constructor===o&&(0,n.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=u,this.isCompressed=p}async fetch({name:u}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!u)throw new Error("CMap name must be specified.");let p=this.baseUrl+u+(this.isCompressed?".bcmap":""),f=this.isCompressed?n.CMapCompressionType.BINARY:n.CMapCompressionType.NONE;return this._fetchData(p,f).catch(w=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${p}`)})}_fetchData(u,p){(0,n.unreachable)("Abstract method `_fetchData` called.")}}t.BaseCMapReaderFactory=o;class s{constructor({baseUrl:u=null}){this.constructor===s&&(0,n.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=u}async fetch({filename:u}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!u)throw new Error("Font filename must be specified.");let p=`${this.baseUrl}${u}`;return this._fetchData(p).catch(f=>{throw new Error(`Unable to load font data at: ${p}`)})}_fetchData(u){(0,n.unreachable)("Abstract method `_fetchData` called.")}}t.BaseStandardFontDataFactory=s;class l{constructor(){this.constructor===l&&(0,n.unreachable)("Cannot initialize BaseSVGFactory.")}create(u,p,f=!1){if(u<=0||p<=0)throw new Error("Invalid SVG dimensions");let w=this._createSVG("svg:svg");return w.setAttribute("version","1.1"),f||(w.setAttribute("width",`${u}px`),w.setAttribute("height",`${p}px`)),w.setAttribute("preserveAspectRatio","none"),w.setAttribute("viewBox",`0 0 ${u} ${p}`),w}createElement(u){if(typeof u!="string")throw new Error("Invalid SVG element type");return this._createSVG(u)}_createSVG(u){(0,n.unreachable)("Abstract method `_createSVG` called.")}}t.BaseSVGFactory=l},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MurmurHash3_64=void 0;var n=e(1);let i=3285377520,o=4294901760,s=65535;class l{constructor(u){this.h1=u?u&4294967295:i,this.h2=u?u&4294967295:i}update(u){let p,f;if(typeof u=="string"){p=new Uint8Array(u.length*2),f=0;for(let y=0,V=u.length;y<V;y++){let B=u.charCodeAt(y);B<=255?p[f++]=B:(p[f++]=B>>>8,p[f++]=B&255)}}else if((0,n.isArrayBuffer)(u))p=u.slice(),f=p.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");let w=f>>2,A=f-w*4,m=new Uint32Array(p.buffer,0,w),d=0,h=0,M=this.h1,k=this.h2,E=3432918353,b=461845907,g=E&s,v=b&s;for(let y=0;y<w;y++)y&1?(d=m[y],d=d*E&o|d*g&s,d=d<<15|d>>>17,d=d*b&o|d*v&s,M^=d,M=M<<13|M>>>19,M=M*5+3864292196):(h=m[y],h=h*E&o|h*g&s,h=h<<15|h>>>17,h=h*b&o|h*v&s,k^=h,k=k<<13|k>>>19,k=k*5+3864292196);switch(d=0,A){case 3:d^=p[w*4+2]<<16;case 2:d^=p[w*4+1]<<8;case 1:d^=p[w*4],d=d*E&o|d*g&s,d=d<<15|d>>>17,d=d*b&o|d*v&s,w&1?M^=d:k^=d}this.h1=M,this.h2=k}hexdigest(){let u=this.h1,p=this.h2;u^=p>>>1,u=u*3981806797&o|u*36045&s,p=p*4283543511&o|((p<<16|u>>>16)*2950163797&o)>>>16,u^=p>>>1,u=u*444984403&o|u*60499&s,p=p*3301882366&o|((p<<16|u>>>16)*3120437893&o)>>>16,u^=p>>>1;let f=(u>>>0).toString(16),w=(p>>>0).toString(16);return f.padStart(8,"0")+w.padStart(8,"0")}}t.MurmurHash3_64=l},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FontLoader=t.FontFaceObject=void 0;var n=e(1);class i{constructor({docId:c,onUnsupportedFeature:u,ownerDocument:p=globalThis.document,styleElement:f=null}){this.constructor===i&&(0,n.unreachable)("Cannot initialize BaseFontLoader."),this.docId=c,this._onUnsupportedFeature=u,this._document=p,this.nativeFontFaces=[],this.styleElement=null}addNativeFontFace(c){this.nativeFontFaces.push(c),this._document.fonts.add(c)}insertRule(c){let u=this.styleElement;u||(u=this.styleElement=this._document.createElement("style"),u.id=`PDFJS_FONT_STYLE_TAG_${this.docId}`,this._document.documentElement.getElementsByTagName("head")[0].append(u));let p=u.sheet;p.insertRule(c,p.cssRules.length)}clear(){for(let c of this.nativeFontFaces)this._document.fonts.delete(c);this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(c){if(c.attached||c.missingFile)return;if(c.attached=!0,this.isFontLoadingAPISupported){let p=c.createNativeFontFace();if(p){this.addNativeFontFace(p);try{await p.loaded}catch(f){throw this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontLoadNative}),(0,n.warn)(`Failed to load font '${p.family}': '${f}'.`),c.disableFontFace=!0,f}}return}let u=c.createFontFaceRule();if(u){if(this.insertRule(u),this.isSyncFontLoadingSupported)return;await new Promise(p=>{let f=this._queueLoadingCallback(p);this._prepareFontLoadEvent([u],[c],f)})}}_queueLoadingCallback(c){(0,n.unreachable)("Abstract method `_queueLoadingCallback`.")}get isFontLoadingAPISupported(){let c=!!this._document?.fonts;return(0,n.shadow)(this,"isFontLoadingAPISupported",c)}get isSyncFontLoadingSupported(){(0,n.unreachable)("Abstract method `isSyncFontLoadingSupported`.")}get _loadTestFont(){(0,n.unreachable)("Abstract method `_loadTestFont`.")}_prepareFontLoadEvent(c,u,p){(0,n.unreachable)("Abstract method `_prepareFontLoadEvent`.")}}let o;t.FontLoader=o,t.FontLoader=o=class extends i{constructor(c){super(c),this.loadingContext={requests:[],nextRequestId:0},this.loadTestFontId=0}get isSyncFontLoadingSupported(){let c=!1;return(typeof navigator>"u"||/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(navigator.userAgent)?.[1]>=14)&&(c=!0),(0,n.shadow)(this,"isSyncFontLoadingSupported",c)}_queueLoadingCallback(c){function u(){for((0,n.assert)(!f.done,"completeRequest() cannot be called twice."),f.done=!0;p.requests.length>0&&p.requests[0].done;){let w=p.requests.shift();setTimeout(w.callback,0)}}let p=this.loadingContext,f={id:`pdfjs-font-loading-${p.nextRequestId++}`,done:!1,complete:u,callback:c};return p.requests.push(f),f}get _loadTestFont(){let c=function(){return atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==")};return(0,n.shadow)(this,"_loadTestFont",c())}_prepareFontLoadEvent(c,u,p){function f(ae,Q){return ae.charCodeAt(Q)<<24|ae.charCodeAt(Q+1)<<16|ae.charCodeAt(Q+2)<<8|ae.charCodeAt(Q+3)&255}function w(ae,Q,ee,K){let $=ae.substring(0,Q),te=ae.substring(Q+ee);return $+K+te}let A,m,d=this._document.createElement("canvas");d.width=1,d.height=1;let h=d.getContext("2d"),M=0;function k(ae,Q){if(M++,M>30){(0,n.warn)("Load test font never loaded."),Q();return}if(h.font="30px "+ae,h.fillText(".",0,20),h.getImageData(0,0,1,1).data[3]>0){Q();return}setTimeout(k.bind(null,ae,Q))}let E=`lt${Date.now()}${this.loadTestFontId++}`,b=this._loadTestFont;b=w(b,976,E.length,E);let v=16,y=1482184792,V=f(b,v);for(A=0,m=E.length-3;A<m;A+=4)V=V-y+f(E,A)|0;A<E.length&&(V=V-y+f(E+"XXX",A)|0),b=w(b,v,4,(0,n.string32)(V));let B=`url(data:font/opentype;base64,${btoa(b)});`,D=`@font-face {font-family:"${E}";src:${B}}`;this.insertRule(D);let L=[];for(let ae of u)L.push(ae.loadedName);L.push(E);let J=this._document.createElement("div");J.style.visibility="hidden",J.style.width=J.style.height="10px",J.style.position="absolute",J.style.top=J.style.left="0px";for(let ae of L){let Q=this._document.createElement("span");Q.textContent="Hi",Q.style.fontFamily=ae,J.append(Q)}this._document.body.append(J),k(E,()=>{J.remove(),p.complete()})}};class s{constructor(c,{isEvalSupported:u=!0,disableFontFace:p=!1,ignoreErrors:f=!1,onUnsupportedFeature:w,fontRegistry:A=null}){this.compiledGlyphs=Object.create(null);for(let m in c)this[m]=c[m];this.isEvalSupported=u!==!1,this.disableFontFace=p===!0,this.ignoreErrors=f===!0,this._onUnsupportedFeature=w,this.fontRegistry=A}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let c;if(!this.cssFontInfo)c=new FontFace(this.loadedName,this.data,{});else{let u={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(u.style=`oblique ${this.cssFontInfo.italicAngle}deg`),c=new FontFace(this.cssFontInfo.fontFamily,this.data,u)}return this.fontRegistry&&this.fontRegistry.registerFont(this),c}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;let c=(0,n.bytesToString)(this.data),u=`url(data:${this.mimetype};base64,${btoa(c)});`,p;if(!this.cssFontInfo)p=`@font-face {font-family:"${this.loadedName}";src:${u}}`;else{let f=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(f+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),p=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${f}src:${u}}`}return this.fontRegistry&&this.fontRegistry.registerFont(this,u),p}getPathGenerator(c,u){if(this.compiledGlyphs[u]!==void 0)return this.compiledGlyphs[u];let p;try{p=c.get(this.loadedName+"_path_"+u)}catch(f){if(!this.ignoreErrors)throw f;return this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontGetPath}),(0,n.warn)(`getPathGenerator - ignoring character: "${f}".`),this.compiledGlyphs[u]=function(w,A){}}if(this.isEvalSupported&&n.FeatureTest.isEvalSupported){let f=[];for(let w of p){let A=w.args!==void 0?w.args.join(","):"";f.push("c.",w.cmd,"(",A,`);
`)}return this.compiledGlyphs[u]=new Function("c","size",f.join(""))}return this.compiledGlyphs[u]=function(f,w){for(let A of p)A.cmd==="scale"&&(A.args=[w,-w]),f[A.cmd].apply(f,A.args)}}}t.FontFaceObject=s},(r,t,e)=>{var xe,$v;Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasGraphics=void 0;var n=e(8),i=e(1),o=e(13),s=e(14),l=e(3);let c=16,u=100,p=4096,f=15,w=10,A=l.isNodeJS&&typeof Path2D>"u"?-1:1e3,m=16;function d(Y,P){if(Y._removeMirroring)throw new Error("Context is already forwarding operations.");Y.__originalSave=Y.save,Y.__originalRestore=Y.restore,Y.__originalRotate=Y.rotate,Y.__originalScale=Y.scale,Y.__originalTranslate=Y.translate,Y.__originalTransform=Y.transform,Y.__originalSetTransform=Y.setTransform,Y.__originalResetTransform=Y.resetTransform,Y.__originalClip=Y.clip,Y.__originalMoveTo=Y.moveTo,Y.__originalLineTo=Y.lineTo,Y.__originalBezierCurveTo=Y.bezierCurveTo,Y.__originalRect=Y.rect,Y.__originalClosePath=Y.closePath,Y.__originalBeginPath=Y.beginPath,Y._removeMirroring=()=>{Y.save=Y.__originalSave,Y.restore=Y.__originalRestore,Y.rotate=Y.__originalRotate,Y.scale=Y.__originalScale,Y.translate=Y.__originalTranslate,Y.transform=Y.__originalTransform,Y.setTransform=Y.__originalSetTransform,Y.resetTransform=Y.__originalResetTransform,Y.clip=Y.__originalClip,Y.moveTo=Y.__originalMoveTo,Y.lineTo=Y.__originalLineTo,Y.bezierCurveTo=Y.__originalBezierCurveTo,Y.rect=Y.__originalRect,Y.closePath=Y.__originalClosePath,Y.beginPath=Y.__originalBeginPath,delete Y._removeMirroring},Y.save=function(){P.save(),this.__originalSave()},Y.restore=function(){P.restore(),this.__originalRestore()},Y.translate=function(N,j){P.translate(N,j),this.__originalTranslate(N,j)},Y.scale=function(N,j){P.scale(N,j),this.__originalScale(N,j)},Y.transform=function(N,j,z,X,oe,se){P.transform(N,j,z,X,oe,se),this.__originalTransform(N,j,z,X,oe,se)},Y.setTransform=function(N,j,z,X,oe,se){P.setTransform(N,j,z,X,oe,se),this.__originalSetTransform(N,j,z,X,oe,se)},Y.resetTransform=function(){P.resetTransform(),this.__originalResetTransform()},Y.rotate=function(N){P.rotate(N),this.__originalRotate(N)},Y.clip=function(N){P.clip(N),this.__originalClip(N)},Y.moveTo=function(C,N){P.moveTo(C,N),this.__originalMoveTo(C,N)},Y.lineTo=function(C,N){P.lineTo(C,N),this.__originalLineTo(C,N)},Y.bezierCurveTo=function(C,N,j,z,X,oe){P.bezierCurveTo(C,N,j,z,X,oe),this.__originalBezierCurveTo(C,N,j,z,X,oe)},Y.rect=function(C,N,j,z){P.rect(C,N,j,z),this.__originalRect(C,N,j,z)},Y.closePath=function(){P.closePath(),this.__originalClosePath()},Y.beginPath=function(){P.beginPath(),this.__originalBeginPath()}}class h{constructor(P){this.canvasFactory=P,this.cache=Object.create(null)}getCanvas(P,C,N){let j;return this.cache[P]!==void 0?(j=this.cache[P],this.canvasFactory.reset(j,C,N)):(j=this.canvasFactory.create(C,N),this.cache[P]=j),j}delete(P){delete this.cache[P]}clear(){for(let P in this.cache){let C=this.cache[P];this.canvasFactory.destroy(C),delete this.cache[P]}}}function M(Y,P,C,N,j,z,X,oe,se,S){let[R,O,U,G,Z,he]=(0,n.getCurrentTransform)(Y);if(O===0&&U===0){let de=X*R+Z,ge=Math.round(de),Se=oe*G+he,Oe=Math.round(Se),q=(X+se)*R+Z,ke=Math.abs(Math.round(q)-ge)||1,Ge=(oe+S)*G+he,$e=Math.abs(Math.round(Ge)-Oe)||1;return Y.setTransform(Math.sign(R),0,0,Math.sign(G),ge,Oe),Y.drawImage(P,C,N,j,z,0,0,ke,$e),Y.setTransform(R,O,U,G,Z,he),[ke,$e]}if(R===0&&G===0){let de=oe*U+Z,ge=Math.round(de),Se=X*O+he,Oe=Math.round(Se),q=(oe+S)*U+Z,ke=Math.abs(Math.round(q)-ge)||1,Ge=(X+se)*O+he,$e=Math.abs(Math.round(Ge)-Oe)||1;return Y.setTransform(0,Math.sign(O),Math.sign(U),0,ge,Oe),Y.drawImage(P,C,N,j,z,0,0,$e,ke),Y.setTransform(R,O,U,G,Z,he),[$e,ke]}Y.drawImage(P,C,N,j,z,X,oe,se,S);let Pe=Math.hypot(R,O),pe=Math.hypot(U,G);return[Pe*se,pe*S]}function k(Y){let{width:P,height:C}=Y;if(P>A||C>A)return null;let N=1e3,j=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),z=P+1,X=new Uint8Array(z*(C+1)),oe,se,S,R=P+7&-8,O=new Uint8Array(R*C),U=0;for(let pe of Y.data){let de=128;for(;de>0;)O[U++]=pe&de?0:255,de>>=1}let G=0;for(U=0,O[U]!==0&&(X[0]=1,++G),se=1;se<P;se++)O[U]!==O[U+1]&&(X[se]=O[U]?2:1,++G),U++;for(O[U]!==0&&(X[se]=2,++G),oe=1;oe<C;oe++){U=oe*R,S=oe*z,O[U-R]!==O[U]&&(X[S]=O[U]?1:8,++G);let pe=(O[U]?4:0)+(O[U-R]?8:0);for(se=1;se<P;se++)pe=(pe>>2)+(O[U+1]?4:0)+(O[U-R+1]?8:0),j[pe]&&(X[S+se]=j[pe],++G),U++;if(O[U-R]!==O[U]&&(X[S+se]=O[U]?2:4,++G),G>N)return null}for(U=R*(C-1),S=oe*z,O[U]!==0&&(X[S]=8,++G),se=1;se<P;se++)O[U]!==O[U+1]&&(X[S+se]=O[U]?4:8,++G),U++;if(O[U]!==0&&(X[S+se]=4,++G),G>N)return null;let Z=new Int32Array([0,z,-1,0,-z,0,0,0,1]),he=new Path2D;for(oe=0;G&&oe<=C;oe++){let pe=oe*z,de=pe+P;for(;pe<de&&!X[pe];)pe++;if(pe===de)continue;he.moveTo(pe%z,oe);let ge=pe,Se=X[pe];do{let Oe=Z[Se];do pe+=Oe;while(!X[pe]);let q=X[pe];q!==5&&q!==10?(Se=q,X[pe]=0):(Se=q&51*Se>>4,X[pe]&=Se>>2|Se<<2),he.lineTo(pe%z,pe/z|0),X[pe]||--G}while(ge!==pe);--oe}return O=null,X=null,function(pe){pe.save(),pe.scale(1/P,-1/C),pe.translate(0,-C),pe.fill(he),pe.beginPath(),pe.restore()}}class E{constructor(P,C){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=i.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=i.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=i.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps=null,this.startNewPathAndClipBox([0,0,P,C])}clone(){let P=Object.create(this);return P.clipBox=this.clipBox.slice(),P}setCurrentPoint(P,C){this.x=P,this.y=C}updatePathMinMax(P,C,N){[C,N]=i.Util.applyTransform([C,N],P),this.minX=Math.min(this.minX,C),this.minY=Math.min(this.minY,N),this.maxX=Math.max(this.maxX,C),this.maxY=Math.max(this.maxY,N)}updateRectMinMax(P,C){let N=i.Util.applyTransform(C,P),j=i.Util.applyTransform(C.slice(2),P);this.minX=Math.min(this.minX,N[0],j[0]),this.minY=Math.min(this.minY,N[1],j[1]),this.maxX=Math.max(this.maxX,N[0],j[0]),this.maxY=Math.max(this.maxY,N[1],j[1])}updateScalingPathMinMax(P,C){i.Util.scaleMinMax(P,C),this.minX=Math.min(this.minX,C[0]),this.maxX=Math.max(this.maxX,C[1]),this.minY=Math.min(this.minY,C[2]),this.maxY=Math.max(this.maxY,C[3])}updateCurvePathMinMax(P,C,N,j,z,X,oe,se,S,R){let O=i.Util.bezierBoundingBox(C,N,j,z,X,oe,se,S);if(R){R[0]=Math.min(R[0],O[0],O[2]),R[1]=Math.max(R[1],O[0],O[2]),R[2]=Math.min(R[2],O[1],O[3]),R[3]=Math.max(R[3],O[1],O[3]);return}this.updateRectMinMax(P,O)}getPathBoundingBox(P=o.PathType.FILL,C=null){let N=[this.minX,this.minY,this.maxX,this.maxY];if(P===o.PathType.STROKE){C||(0,i.unreachable)("Stroke bounding box must include transform.");let j=i.Util.singularValueDecompose2dScale(C),z=j[0]*this.lineWidth/2,X=j[1]*this.lineWidth/2;N[0]-=z,N[1]-=X,N[2]+=z,N[3]+=X}return N}updateClipFromPath(){let P=i.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(P||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(P){this.clipBox=P,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(P=o.PathType.FILL,C=null){return i.Util.intersect(this.clipBox,this.getPathBoundingBox(P,C))}}function b(Y,P,C=null){if(typeof ImageData<"u"&&P instanceof ImageData){Y.putImageData(P,0,0);return}let N=P.height,j=P.width,z=N%m,X=(N-z)/m,oe=z===0?X:X+1,se=Y.createImageData(j,m),S=0,R,O=P.data,U=se.data,G,Z,he,Pe,pe,de,ge,Se;if(C)switch(C.length){case 1:pe=C[0],de=C[0],ge=C[0],Se=C[0];break;case 4:pe=C[0],de=C[1],ge=C[2],Se=C[3];break}if(P.kind===i.ImageKind.GRAYSCALE_1BPP){let Oe=O.byteLength,q=new Uint32Array(U.buffer,0,U.byteLength>>2),ke=q.length,Ge=j+7>>3,$e=4294967295,it=i.FeatureTest.isLittleEndian?4278190080:255;for(Se&&Se[0]===255&&Se[255]===0&&([$e,it]=[it,$e]),G=0;G<oe;G++){for(he=G<X?m:z,R=0,Z=0;Z<he;Z++){let _t=Oe-S,Nn=0,Jt=_t>Ge?j:_t*8-7,Lr=Jt&-8,bt=0,rn=0;for(;Nn<Lr;Nn+=8)rn=O[S++],q[R++]=rn&128?$e:it,q[R++]=rn&64?$e:it,q[R++]=rn&32?$e:it,q[R++]=rn&16?$e:it,q[R++]=rn&8?$e:it,q[R++]=rn&4?$e:it,q[R++]=rn&2?$e:it,q[R++]=rn&1?$e:it;for(;Nn<Jt;Nn++)bt===0&&(rn=O[S++],bt=128),q[R++]=rn&bt?$e:it,bt>>=1}for(;R<ke;)q[R++]=0;Y.putImageData(se,0,G*m)}}else if(P.kind===i.ImageKind.RGBA_32BPP){let Oe=!!(pe||de||ge);for(Z=0,Pe=j*m*4,G=0;G<X;G++){if(U.set(O.subarray(S,S+Pe)),S+=Pe,Oe)for(let q=0;q<Pe;q+=4)pe&&(U[q+0]=pe[U[q+0]]),de&&(U[q+1]=de[U[q+1]]),ge&&(U[q+2]=ge[U[q+2]]);Y.putImageData(se,0,Z),Z+=m}if(G<oe){if(Pe=j*z*4,U.set(O.subarray(S,S+Pe)),Oe)for(let q=0;q<Pe;q+=4)pe&&(U[q+0]=pe[U[q+0]]),de&&(U[q+1]=de[U[q+1]]),ge&&(U[q+2]=ge[U[q+2]]);Y.putImageData(se,0,Z)}}else if(P.kind===i.ImageKind.RGB_24BPP){let Oe=!!(pe||de||ge);for(he=m,Pe=j*he,G=0;G<oe;G++){for(G>=X&&(he=z,Pe=j*he),R=0,Z=Pe;Z--;)U[R++]=O[S++],U[R++]=O[S++],U[R++]=O[S++],U[R++]=255;if(Oe)for(let q=0;q<R;q+=4)pe&&(U[q+0]=pe[U[q+0]]),de&&(U[q+1]=de[U[q+1]]),ge&&(U[q+2]=ge[U[q+2]]);Y.putImageData(se,0,G*m)}}else throw new Error(`bad image kind: ${P.kind}`)}function g(Y,P){if(P.bitmap){Y.drawImage(P.bitmap,0,0);return}let C=P.height,N=P.width,j=C%m,z=(C-j)/m,X=j===0?z:z+1,oe=Y.createImageData(N,m),se=0,S=P.data,R=oe.data;for(let O=0;O<X;O++){let U=O<z?m:j;({srcPos:se}=(0,s.applyMaskImageData)({src:S,srcPos:se,dest:R,width:N,height:U})),Y.putImageData(oe,0,O*m)}}function v(Y,P){let C=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"];for(let N=0,j=C.length;N<j;N++){let z=C[N];Y[z]!==void 0&&(P[z]=Y[z])}Y.setLineDash!==void 0&&(P.setLineDash(Y.getLineDash()),P.lineDashOffset=Y.lineDashOffset)}function y(Y,P){Y.strokeStyle=Y.fillStyle=P||"#000000",Y.fillRule="nonzero",Y.globalAlpha=1,Y.lineWidth=1,Y.lineCap="butt",Y.lineJoin="miter",Y.miterLimit=10,Y.globalCompositeOperation="source-over",Y.font="10px sans-serif",Y.setLineDash!==void 0&&(Y.setLineDash([]),Y.lineDashOffset=0)}function V(Y,P,C,N){let j=Y.length;for(let z=3;z<j;z+=4){let X=Y[z];if(X===0)Y[z-3]=P,Y[z-2]=C,Y[z-1]=N;else if(X<255){let oe=255-X;Y[z-3]=Y[z-3]*X+P*oe>>8,Y[z-2]=Y[z-2]*X+C*oe>>8,Y[z-1]=Y[z-1]*X+N*oe>>8}}}function B(Y,P,C){let N=Y.length,j=1/255;for(let z=3;z<N;z+=4){let X=C?C[Y[z]]:Y[z];P[z]=P[z]*X*j|0}}function D(Y,P,C){let N=Y.length;for(let j=3;j<N;j+=4){let z=Y[j-3]*77+Y[j-2]*152+Y[j-1]*28;P[j]=C?P[j]*C[z>>8]>>8:P[j]*z>>16}}function L(Y,P,C,N,j,z,X,oe,se,S,R){let O=!!z,U=O?z[0]:0,G=O?z[1]:0,Z=O?z[2]:0,he;j==="Luminosity"?he=D:he=B;let pe=Math.min(N,Math.ceil(1048576/C));for(let de=0;de<N;de+=pe){let ge=Math.min(pe,N-de),Se=Y.getImageData(oe-S,de+(se-R),C,ge),Oe=P.getImageData(oe,de+se,C,ge);O&&V(Se.data,U,G,Z),he(Se.data,Oe.data,X),P.putImageData(Oe,oe,de+se)}}function J(Y,P,C,N){let j=N[0],z=N[1],X=N[2]-j,oe=N[3]-z;X===0||oe===0||(L(P.context,C,X,oe,P.subtype,P.backdrop,P.transferMap,j,z,P.offsetX,P.offsetY),Y.save(),Y.globalAlpha=1,Y.globalCompositeOperation="source-over",Y.setTransform(1,0,0,1,0,0),Y.drawImage(C.canvas,0,0),Y.restore())}function ae(Y,P){let C=i.Util.singularValueDecompose2dScale(Y);C[0]=Math.fround(C[0]),C[1]=Math.fround(C[1]);let N=Math.fround((globalThis.devicePixelRatio||1)*n.PixelsPerInch.PDF_TO_CSS_UNITS);return P!==void 0?P:C[0]<=N||C[1]<=N}let Q=["butt","round","square"],ee=["miter","round","bevel"],K={},$={},Ue=class{constructor(P,C,N,j,z,X,oe,se){Fe(this,xe);this.ctx=P,this.current=new E(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=C,this.objs=N,this.canvasFactory=j,this.imageLayer=z,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=[],this.optionalContentConfig=X,this.cachedCanvases=new h(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=oe,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.backgroundColor=se?.background||null,this.foregroundColor=se?.foreground||null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(P,C=null){return typeof P=="string"?P.startsWith("g_")?this.commonObjs.get(P):this.objs.get(P):C}beginDrawing({transform:P,viewport:C,transparency:N=!1,background:j=null}){let z=this.ctx.canvas.width,X=this.ctx.canvas.height,oe=j||"#ffffff";if(this.ctx.save(),this.foregroundColor&&this.backgroundColor){this.ctx.fillStyle=this.foregroundColor;let se=this.foregroundColor=this.ctx.fillStyle;this.ctx.fillStyle=this.backgroundColor;let S=this.backgroundColor=this.ctx.fillStyle,R=!0,O=oe;if(this.ctx.fillStyle=oe,O=this.ctx.fillStyle,R=typeof O=="string"&&/^#[0-9A-Fa-f]{6}$/.test(O),se==="#000000"&&S==="#ffffff"||se===S||!R)this.foregroundColor=this.backgroundColor=null;else{let[U,G,Z]=(0,n.getRGB)(O),he=pe=>(pe/=255,pe<=.03928?pe/12.92:((pe+.055)/1.055)**2.4),Pe=Math.round(.2126*he(U)+.7152*he(G)+.0722*he(Z));this.selectColor=(pe,de,ge)=>{let Se=.2126*he(pe)+.7152*he(de)+.0722*he(ge);return Math.round(Se)===Pe?S:se}}}if(this.ctx.fillStyle=this.backgroundColor||oe,this.ctx.fillRect(0,0,z,X),this.ctx.restore(),N){let se=this.cachedCanvases.getCanvas("transparent",z,X);this.compositeCtx=this.ctx,this.transparentCanvas=se.canvas,this.ctx=se.context,this.ctx.save(),this.ctx.transform(...(0,n.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),y(this.ctx,this.foregroundColor),P&&(this.ctx.transform(...P),this.outputScaleX=P[0],this.outputScaleY=P[0]),this.ctx.transform(...C.transform),this.viewportScale=C.scale,this.baseTransform=(0,n.getCurrentTransform)(this.ctx),this.imageLayer&&((0,n.deprecated)("The `imageLayer` functionality will be removed in the future."),this.imageLayer.beginLayout())}executeOperatorList(P,C,N,j){let z=P.argsArray,X=P.fnArray,oe=C||0,se=z.length;if(se===oe)return oe;let S=se-oe>w&&typeof N=="function",R=S?Date.now()+f:0,O=0,U=this.commonObjs,G=this.objs,Z;for(;;){if(j!==void 0&&oe===j.nextBreakPoint)return j.breakIt(oe,N),oe;if(Z=X[oe],Z!==i.OPS.dependency)this[Z].apply(this,z[oe]);else for(let he of z[oe]){let Pe=he.startsWith("g_")?U:G;if(!Pe.has(he))return Pe.get(he,N),oe}if(oe++,oe===se)return oe;if(S&&++O>w){if(Date.now()>R)return N(),oe;O=0}}}endDrawing(){_e(this,xe,$v).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let P of this._cachedBitmapsMap.values()){for(let C of P.values())typeof HTMLCanvasElement<"u"&&C instanceof HTMLCanvasElement&&(C.width=C.height=0);P.clear()}this._cachedBitmapsMap.clear(),this.imageLayer&&this.imageLayer.endLayout()}_scaleImage(P,C){let N=P.width,j=P.height,z=Math.max(Math.hypot(C[0],C[1]),1),X=Math.max(Math.hypot(C[2],C[3]),1),oe=N,se=j,S="prescale1",R,O;for(;z>2&&oe>1||X>2&&se>1;){let U=oe,G=se;z>2&&oe>1&&(U=Math.ceil(oe/2),z/=oe/U),X>2&&se>1&&(G=Math.ceil(se/2),X/=se/G),R=this.cachedCanvases.getCanvas(S,U,G),O=R.context,O.clearRect(0,0,U,G),O.drawImage(P,0,0,oe,se,0,0,U,G),P=R.canvas,oe=U,se=G,S=S==="prescale1"?"prescale2":"prescale1"}return{img:P,paintWidth:oe,paintHeight:se}}_createMaskCanvas(P){let C=this.ctx,{width:N,height:j}=P,z=this.current.fillColor,X=this.current.patternFill,oe=(0,n.getCurrentTransform)(C),se,S,R,O;if((P.bitmap||P.data)&&P.count>1){let ke=P.bitmap||P.data.buffer,Ge=oe.slice(0,4);S=JSON.stringify(X?Ge:[Ge,z]),se=this._cachedBitmapsMap.get(ke),se||(se=new Map,this._cachedBitmapsMap.set(ke,se));let $e=se.get(S);if($e&&!X){let it=Math.round(Math.min(oe[0],oe[2])+oe[4]),_t=Math.round(Math.min(oe[1],oe[3])+oe[5]);return{canvas:$e,offsetX:it,offsetY:_t}}R=$e}R||(O=this.cachedCanvases.getCanvas("maskCanvas",N,j),g(O.context,P));let U=i.Util.transform(oe,[1/N,0,0,-1/j,0,0]);U=i.Util.transform(U,[1,0,0,1,0,-j]);let G=i.Util.applyTransform([0,0],U),Z=i.Util.applyTransform([N,j],U),he=i.Util.normalizeRect([G[0],G[1],Z[0],Z[1]]),Pe=Math.round(he[2]-he[0])||1,pe=Math.round(he[3]-he[1])||1,de=this.cachedCanvases.getCanvas("fillCanvas",Pe,pe),ge=de.context,Se=Math.min(G[0],Z[0]),Oe=Math.min(G[1],Z[1]);ge.translate(-Se,-Oe),ge.transform(...U),R||(R=this._scaleImage(O.canvas,(0,n.getCurrentTransformInverse)(ge)),R=R.img,se&&X&&se.set(S,R)),ge.imageSmoothingEnabled=ae((0,n.getCurrentTransform)(ge),P.interpolate),M(ge,R,0,0,R.width,R.height,0,0,N,j),ge.globalCompositeOperation="source-in";let q=i.Util.transform((0,n.getCurrentTransformInverse)(ge),[1,0,0,1,-Se,-Oe]);return ge.fillStyle=X?z.getPattern(C,this,q,o.PathType.FILL):z,ge.fillRect(0,0,N,j),se&&!X&&(this.cachedCanvases.delete("fillCanvas"),se.set(S,de.canvas)),{canvas:de.canvas,offsetX:Math.round(Se),offsetY:Math.round(Oe)}}setLineWidth(P){P!==this.current.lineWidth&&(this._cachedScaleForStroking=null),this.current.lineWidth=P,this.ctx.lineWidth=P}setLineCap(P){this.ctx.lineCap=Q[P]}setLineJoin(P){this.ctx.lineJoin=ee[P]}setMiterLimit(P){this.ctx.miterLimit=P}setDash(P,C){let N=this.ctx;N.setLineDash!==void 0&&(N.setLineDash(P),N.lineDashOffset=C)}setRenderingIntent(P){}setFlatness(P){}setGState(P){for(let C=0,N=P.length;C<N;C++){let j=P[C],z=j[0],X=j[1];switch(z){case"LW":this.setLineWidth(X);break;case"LC":this.setLineCap(X);break;case"LJ":this.setLineJoin(X);break;case"ML":this.setMiterLimit(X);break;case"D":this.setDash(X[0],X[1]);break;case"RI":this.setRenderingIntent(X);break;case"FL":this.setFlatness(X);break;case"Font":this.setFont(X[0],X[1]);break;case"CA":this.current.strokeAlpha=j[1];break;case"ca":this.current.fillAlpha=j[1],this.ctx.globalAlpha=j[1];break;case"BM":this.ctx.globalCompositeOperation=X;break;case"SMask":this.current.activeSMask=X?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.current.transferMaps=X}}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let P=this.inSMaskMode;this.current.activeSMask&&!P?this.beginSMaskMode():!this.current.activeSMask&&P&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let P=this.ctx.canvas.width,C=this.ctx.canvas.height,N="smaskGroupAt"+this.groupLevel,j=this.cachedCanvases.getCanvas(N,P,C);this.suspendedCtx=this.ctx,this.ctx=j.context;let z=this.ctx;z.setTransform(...(0,n.getCurrentTransform)(this.suspendedCtx)),v(this.suspendedCtx,z),d(z,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),v(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(P){if(!this.current.activeSMask)return;P?(P[0]=Math.floor(P[0]),P[1]=Math.floor(P[1]),P[2]=Math.ceil(P[2]),P[3]=Math.ceil(P[3])):P=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let C=this.current.activeSMask,N=this.suspendedCtx;J(N,C,this.ctx,P),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(v(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let P=this.current;this.stateStack.push(P),this.current=P.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),v(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null)}transform(P,C,N,j,z,X){this.ctx.transform(P,C,N,j,z,X),this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null}constructPath(P,C,N){let j=this.ctx,z=this.current,X=z.x,oe=z.y,se,S,R=(0,n.getCurrentTransform)(j),O=R[0]===0&&R[3]===0||R[1]===0&&R[2]===0,U=O?N.slice(0):null;for(let G=0,Z=0,he=P.length;G<he;G++)switch(P[G]|0){case i.OPS.rectangle:X=C[Z++],oe=C[Z++];let Pe=C[Z++],pe=C[Z++],de=X+Pe,ge=oe+pe;j.moveTo(X,oe),Pe===0||pe===0?j.lineTo(de,ge):(j.lineTo(de,oe),j.lineTo(de,ge),j.lineTo(X,ge)),O||z.updateRectMinMax(R,[X,oe,de,ge]),j.closePath();break;case i.OPS.moveTo:X=C[Z++],oe=C[Z++],j.moveTo(X,oe),O||z.updatePathMinMax(R,X,oe);break;case i.OPS.lineTo:X=C[Z++],oe=C[Z++],j.lineTo(X,oe),O||z.updatePathMinMax(R,X,oe);break;case i.OPS.curveTo:se=X,S=oe,X=C[Z+4],oe=C[Z+5],j.bezierCurveTo(C[Z],C[Z+1],C[Z+2],C[Z+3],X,oe),z.updateCurvePathMinMax(R,se,S,C[Z],C[Z+1],C[Z+2],C[Z+3],X,oe,U),Z+=6;break;case i.OPS.curveTo2:se=X,S=oe,j.bezierCurveTo(X,oe,C[Z],C[Z+1],C[Z+2],C[Z+3]),z.updateCurvePathMinMax(R,se,S,X,oe,C[Z],C[Z+1],C[Z+2],C[Z+3],U),X=C[Z+2],oe=C[Z+3],Z+=4;break;case i.OPS.curveTo3:se=X,S=oe,X=C[Z+2],oe=C[Z+3],j.bezierCurveTo(C[Z],C[Z+1],X,oe,X,oe),z.updateCurvePathMinMax(R,se,S,C[Z],C[Z+1],X,oe,X,oe,U),Z+=4;break;case i.OPS.closePath:j.closePath();break}O&&z.updateScalingPathMinMax(R,U),z.setCurrentPoint(X,oe)}closePath(){this.ctx.closePath()}stroke(P){P=typeof P<"u"?P:!0;let C=this.ctx,N=this.current.strokeColor;C.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof N=="object"&&N?.getPattern?(C.save(),C.strokeStyle=N.getPattern(C,this,(0,n.getCurrentTransformInverse)(C),o.PathType.STROKE),this.rescaleAndStroke(!1),C.restore()):this.rescaleAndStroke(!0)),P&&this.consumePath(this.current.getClippedPathBoundingBox()),C.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(P){P=typeof P<"u"?P:!0;let C=this.ctx,N=this.current.fillColor,j=this.current.patternFill,z=!1;j&&(C.save(),C.fillStyle=N.getPattern(C,this,(0,n.getCurrentTransformInverse)(C),o.PathType.FILL),z=!0);let X=this.current.getClippedPathBoundingBox();this.contentVisible&&X!==null&&(this.pendingEOFill?(C.fill("evenodd"),this.pendingEOFill=!1):C.fill()),z&&C.restore(),P&&this.consumePath(X)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=K}eoClip(){this.pendingClip=$}beginText(){this.current.textMatrix=i.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let P=this.pendingTextPaths,C=this.ctx;if(P===void 0){C.beginPath();return}C.save(),C.beginPath();for(let N of P)C.setTransform(...N.transform),C.translate(N.x,N.y),N.addToPath(C,N.fontSize);C.restore(),C.clip(),C.beginPath(),delete this.pendingTextPaths}setCharSpacing(P){this.current.charSpacing=P}setWordSpacing(P){this.current.wordSpacing=P}setHScale(P){this.current.textHScale=P/100}setLeading(P){this.current.leading=-P}setFont(P,C){let N=this.commonObjs.get(P),j=this.current;if(!N)throw new Error(`Can't find font for ${P}`);if(j.fontMatrix=N.fontMatrix||i.FONT_IDENTITY_MATRIX,(j.fontMatrix[0]===0||j.fontMatrix[3]===0)&&(0,i.warn)("Invalid font matrix for font "+P),C<0?(C=-C,j.fontDirection=-1):j.fontDirection=1,this.current.font=N,this.current.fontSize=C,N.isType3Font)return;let z=N.loadedName||"sans-serif",X="normal";N.black?X="900":N.bold&&(X="bold");let oe=N.italic?"italic":"normal",se=`"${z}", ${N.fallbackName}`,S=C;C<c?S=c:C>u&&(S=u),this.current.fontSizeScale=C/S,this.ctx.font=`${oe} ${X} ${S}px ${se}`}setTextRenderingMode(P){this.current.textRenderingMode=P}setTextRise(P){this.current.textRise=P}moveText(P,C){this.current.x=this.current.lineX+=P,this.current.y=this.current.lineY+=C}setLeadingMoveText(P,C){this.setLeading(-C),this.moveText(P,C)}setTextMatrix(P,C,N,j,z,X){this.current.textMatrix=[P,C,N,j,z,X],this.current.textMatrixScale=Math.hypot(P,C),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(P,C,N,j){let z=this.ctx,X=this.current,oe=X.font,se=X.textRenderingMode,S=X.fontSize/X.fontSizeScale,R=se&i.TextRenderingMode.FILL_STROKE_MASK,O=!!(se&i.TextRenderingMode.ADD_TO_PATH_FLAG),U=X.patternFill&&!oe.missingFile,G;(oe.disableFontFace||O||U)&&(G=oe.getPathGenerator(this.commonObjs,P)),oe.disableFontFace||U?(z.save(),z.translate(C,N),z.beginPath(),G(z,S),j&&z.setTransform(...j),(R===i.TextRenderingMode.FILL||R===i.TextRenderingMode.FILL_STROKE)&&z.fill(),(R===i.TextRenderingMode.STROKE||R===i.TextRenderingMode.FILL_STROKE)&&z.stroke(),z.restore()):((R===i.TextRenderingMode.FILL||R===i.TextRenderingMode.FILL_STROKE)&&z.fillText(P,C,N),(R===i.TextRenderingMode.STROKE||R===i.TextRenderingMode.FILL_STROKE)&&z.strokeText(P,C,N)),O&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,n.getCurrentTransform)(z),x:C,y:N,fontSize:S,addToPath:G})}get isFontSubpixelAAEnabled(){let{context:P}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);P.scale(1.5,1),P.fillText("I",0,10);let C=P.getImageData(0,0,10,10).data,N=!1;for(let j=3;j<C.length;j+=4)if(C[j]>0&&C[j]<255){N=!0;break}return(0,i.shadow)(this,"isFontSubpixelAAEnabled",N)}showText(P){let C=this.current,N=C.font;if(N.isType3Font)return this.showType3Text(P);let j=C.fontSize;if(j===0)return;let z=this.ctx,X=C.fontSizeScale,oe=C.charSpacing,se=C.wordSpacing,S=C.fontDirection,R=C.textHScale*S,O=P.length,U=N.vertical,G=U?1:-1,Z=N.defaultVMetrics,he=j*C.fontMatrix[0],Pe=C.textRenderingMode===i.TextRenderingMode.FILL&&!N.disableFontFace&&!C.patternFill;z.save(),z.transform(...C.textMatrix),z.translate(C.x,C.y+C.textRise),S>0?z.scale(R,-1):z.scale(R,1);let pe;if(C.patternFill){z.save();let q=C.fillColor.getPattern(z,this,(0,n.getCurrentTransformInverse)(z),o.PathType.FILL);pe=(0,n.getCurrentTransform)(z),z.restore(),z.fillStyle=q}let de=C.lineWidth,ge=C.textMatrixScale;if(ge===0||de===0){let q=C.textRenderingMode&i.TextRenderingMode.FILL_STROKE_MASK;(q===i.TextRenderingMode.STROKE||q===i.TextRenderingMode.FILL_STROKE)&&(de=this.getSinglePixelWidth())}else de/=ge;X!==1&&(z.scale(X,X),de/=X),z.lineWidth=de;let Se=0,Oe;for(Oe=0;Oe<O;++Oe){let q=P[Oe];if(typeof q=="number"){Se+=G*q*j/1e3;continue}let ke=!1,Ge=(q.isSpace?se:0)+oe,$e=q.fontChar,it=q.accent,_t,Nn,Jt=q.width;if(U){let bt=q.vmetric||Z,rn=-(q.vmetric?bt[1]:Jt*.5)*he,ti=bt[2]*he;Jt=bt?-bt[0]:Jt,_t=rn/X,Nn=(Se+ti)/X}else _t=Se/X,Nn=0;if(N.remeasure&&Jt>0){let bt=z.measureText($e).width*1e3/j*X;if(Jt<bt&&this.isFontSubpixelAAEnabled){let rn=Jt/bt;ke=!0,z.save(),z.scale(rn,1),_t/=rn}else Jt!==bt&&(_t+=(Jt-bt)/2e3*j/X)}if(this.contentVisible&&(q.isInFont||N.missingFile)){if(Pe&&!it)z.fillText($e,_t,Nn);else if(this.paintChar($e,_t,Nn,pe),it){let bt=_t+j*it.offset.x/X,rn=Nn-j*it.offset.y/X;this.paintChar(it.fontChar,bt,rn,pe)}}let Lr;U?Lr=Jt*he-Ge*S:Lr=Jt*he+Ge*S,Se+=Lr,ke&&z.restore()}U?C.y-=Se:C.x+=Se*R,z.restore(),this.compose()}showType3Text(P){let C=this.ctx,N=this.current,j=N.font,z=N.fontSize,X=N.fontDirection,oe=j.vertical?1:-1,se=N.charSpacing,S=N.wordSpacing,R=N.textHScale*X,O=N.fontMatrix||i.FONT_IDENTITY_MATRIX,U=P.length,G=N.textRenderingMode===i.TextRenderingMode.INVISIBLE,Z,he,Pe,pe;if(!(G||z===0)){for(this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,C.save(),C.transform(...N.textMatrix),C.translate(N.x,N.y),C.scale(R,X),Z=0;Z<U;++Z){if(he=P[Z],typeof he=="number"){pe=oe*he*z/1e3,this.ctx.translate(pe,0),N.x+=pe*R;continue}let de=(he.isSpace?S:0)+se,ge=j.charProcOperatorList[he.operatorListId];if(!ge){(0,i.warn)(`Type3 character "${he.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=he,this.save(),C.scale(z,z),C.transform(...O),this.executeOperatorList(ge),this.restore()),Pe=i.Util.applyTransform([he.width,0],O)[0]*z+de,C.translate(Pe,0),N.x+=Pe*R}C.restore(),this.processingType3=null}}setCharWidth(P,C){}setCharWidthAndBounds(P,C,N,j,z,X){this.ctx.rect(N,j,z-N,X-j),this.ctx.clip(),this.endPath()}getColorN_Pattern(P){let C;if(P[0]==="TilingPattern"){let N=P[1],j=this.baseTransform||(0,n.getCurrentTransform)(this.ctx),z={createCanvasGraphics:X=>new Ue(X,this.commonObjs,this.objs,this.canvasFactory)};C=new o.TilingPattern(P,N,this.ctx,z,j)}else C=this._getPattern(P[1],P[2]);return C}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(P,C,N){let j=this.selectColor?.(P,C,N)||i.Util.makeHexColor(P,C,N);this.ctx.strokeStyle=j,this.current.strokeColor=j}setFillRGBColor(P,C,N){let j=this.selectColor?.(P,C,N)||i.Util.makeHexColor(P,C,N);this.ctx.fillStyle=j,this.current.fillColor=j,this.current.patternFill=!1}_getPattern(P,C=null){let N;return this.cachedPatterns.has(P)?N=this.cachedPatterns.get(P):(N=(0,o.getShadingPattern)(this.objs.get(P)),this.cachedPatterns.set(P,N)),C&&(N.matrix=C),N}shadingFill(P){if(!this.contentVisible)return;let C=this.ctx;this.save();let N=this._getPattern(P);C.fillStyle=N.getPattern(C,this,(0,n.getCurrentTransformInverse)(C),o.PathType.SHADING);let j=(0,n.getCurrentTransformInverse)(C);if(j){let z=C.canvas,X=z.width,oe=z.height,se=i.Util.applyTransform([0,0],j),S=i.Util.applyTransform([0,oe],j),R=i.Util.applyTransform([X,0],j),O=i.Util.applyTransform([X,oe],j),U=Math.min(se[0],S[0],R[0],O[0]),G=Math.min(se[1],S[1],R[1],O[1]),Z=Math.max(se[0],S[0],R[0],O[0]),he=Math.max(se[1],S[1],R[1],O[1]);this.ctx.fillRect(U,G,Z-U,he-G)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,i.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,i.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(P,C){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(P)&&P.length===6&&this.transform(...P),this.baseTransform=(0,n.getCurrentTransform)(this.ctx),C)){let N=C[2]-C[0],j=C[3]-C[1];this.ctx.rect(C[0],C[1],N,j),this.current.updateRectMinMax((0,n.getCurrentTransform)(this.ctx),C),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(P){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let C=this.ctx;P.isolated||(0,i.info)("TODO: Support non-isolated groups."),P.knockout&&(0,i.warn)("Knockout groups not supported.");let N=(0,n.getCurrentTransform)(C);if(P.matrix&&C.transform(...P.matrix),!P.bbox)throw new Error("Bounding box is required.");let j=i.Util.getAxialAlignedBoundingBox(P.bbox,(0,n.getCurrentTransform)(C)),z=[0,0,C.canvas.width,C.canvas.height];j=i.Util.intersect(j,z)||[0,0,0,0];let X=Math.floor(j[0]),oe=Math.floor(j[1]),se=Math.max(Math.ceil(j[2])-X,1),S=Math.max(Math.ceil(j[3])-oe,1),R=1,O=1;se>p&&(R=se/p,se=p),S>p&&(O=S/p,S=p),this.current.startNewPathAndClipBox([0,0,se,S]);let U="groupAt"+this.groupLevel;P.smask&&(U+="_smask_"+this.smaskCounter++%2);let G=this.cachedCanvases.getCanvas(U,se,S),Z=G.context;Z.scale(1/R,1/O),Z.translate(-X,-oe),Z.transform(...N),P.smask?this.smaskStack.push({canvas:G.canvas,context:Z,offsetX:X,offsetY:oe,scaleX:R,scaleY:O,subtype:P.smask.subtype,backdrop:P.smask.backdrop,transferMap:P.smask.transferMap||null,startTransformInverse:null}):(C.setTransform(1,0,0,1,0,0),C.translate(X,oe),C.scale(R,O),C.save()),v(C,Z),this.ctx=Z,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(C),this.groupLevel++}endGroup(P){if(!this.contentVisible)return;this.groupLevel--;let C=this.ctx,N=this.groupStack.pop();if(this.ctx=N,this.ctx.imageSmoothingEnabled=!1,P.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let j=(0,n.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...j);let z=i.Util.getAxialAlignedBoundingBox([0,0,C.canvas.width,C.canvas.height],j);this.ctx.drawImage(C.canvas,0,0),this.ctx.restore(),this.compose(z)}}beginAnnotation(P,C,N,j,z){if(_e(this,xe,$v).call(this),y(this.ctx,this.foregroundColor),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(C)&&C.length===4){let X=C[2]-C[0],oe=C[3]-C[1];if(z&&this.annotationCanvasMap){N=N.slice(),N[4]-=C[0],N[5]-=C[1],C=C.slice(),C[0]=C[1]=0,C[2]=X,C[3]=oe;let[se,S]=i.Util.singularValueDecompose2dScale((0,n.getCurrentTransform)(this.ctx)),{viewportScale:R}=this,O=Math.ceil(X*this.outputScaleX*R),U=Math.ceil(oe*this.outputScaleY*R);this.annotationCanvas=this.canvasFactory.create(O,U);let{canvas:G,context:Z}=this.annotationCanvas;this.annotationCanvasMap.set(P,G),this.annotationCanvas.savedCtx=this.ctx,this.ctx=Z,this.ctx.setTransform(se,0,0,-S,0,oe*S),y(this.ctx,this.foregroundColor)}else y(this.ctx,this.foregroundColor),this.ctx.rect(C[0],C[1],X,oe),this.ctx.clip(),this.endPath()}this.current=new E(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...N),this.transform(...j)}endAnnotation(){this.annotationCanvas&&(this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(P){if(!this.contentVisible)return;let C=P.count;P=this.getObject(P.data,P),P.count=C;let N=this.ctx,j=this.processingType3;if(j&&(j.compiled===void 0&&(j.compiled=k(P)),j.compiled)){j.compiled(N);return}let z=this._createMaskCanvas(P),X=z.canvas;N.save(),N.setTransform(1,0,0,1,0,0),N.drawImage(X,z.offsetX,z.offsetY),N.restore(),this.compose()}paintImageMaskXObjectRepeat(P,C,N=0,j=0,z,X){if(!this.contentVisible)return;P=this.getObject(P.data,P);let oe=this.ctx;oe.save();let se=(0,n.getCurrentTransform)(oe);oe.transform(C,N,j,z,0,0);let S=this._createMaskCanvas(P);oe.setTransform(1,0,0,1,0,0);for(let R=0,O=X.length;R<O;R+=2){let U=i.Util.transform(se,[C,N,j,z,X[R],X[R+1]]),[G,Z]=i.Util.applyTransform([0,0],U);oe.drawImage(S.canvas,G,Z)}oe.restore(),this.compose()}paintImageMaskXObjectGroup(P){if(!this.contentVisible)return;let C=this.ctx,N=this.current.fillColor,j=this.current.patternFill;for(let z of P){let{data:X,width:oe,height:se,transform:S}=z,R=this.cachedCanvases.getCanvas("maskCanvas",oe,se),O=R.context;O.save();let U=this.getObject(X,z);g(O,U),O.globalCompositeOperation="source-in",O.fillStyle=j?N.getPattern(O,this,(0,n.getCurrentTransformInverse)(C),o.PathType.FILL):N,O.fillRect(0,0,oe,se),O.restore(),C.save(),C.transform(...S),C.scale(1,-1),M(C,R.canvas,0,0,oe,se,0,-1,1,1),C.restore()}this.compose()}paintImageXObject(P){if(!this.contentVisible)return;let C=this.getObject(P);if(!C){(0,i.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(C)}paintImageXObjectRepeat(P,C,N,j){if(!this.contentVisible)return;let z=this.getObject(P);if(!z){(0,i.warn)("Dependent image isn't ready yet");return}let X=z.width,oe=z.height,se=[];for(let S=0,R=j.length;S<R;S+=2)se.push({transform:[C,0,0,N,j[S],j[S+1]],x:0,y:0,w:X,h:oe});this.paintInlineImageXObjectGroup(z,se)}paintInlineImageXObject(P){if(!this.contentVisible)return;let C=P.width,N=P.height,j=this.ctx;this.save(),j.scale(1/C,-1/N);let z;if(typeof HTMLElement=="function"&&P instanceof HTMLElement||!P.data)z=P;else{let S=this.cachedCanvases.getCanvas("inlineImage",C,N),R=S.context;b(R,P,this.current.transferMaps),z=S.canvas}let X=this._scaleImage(z,(0,n.getCurrentTransformInverse)(j));j.imageSmoothingEnabled=ae((0,n.getCurrentTransform)(j),P.interpolate);let[oe,se]=M(j,X.img,0,0,X.paintWidth,X.paintHeight,0,-N,C,N);if(this.imageLayer){let[S,R]=i.Util.applyTransform([0,-N],(0,n.getCurrentTransform)(this.ctx));this.imageLayer.appendImage({imgData:P,left:S,top:R,width:oe,height:se})}this.compose(),this.restore()}paintInlineImageXObjectGroup(P,C){if(!this.contentVisible)return;let N=this.ctx,j=P.width,z=P.height,X=this.cachedCanvases.getCanvas("inlineImage",j,z),oe=X.context;b(oe,P,this.current.transferMaps);for(let se of C){if(N.save(),N.transform(...se.transform),N.scale(1,-1),M(N,X.canvas,se.x,se.y,se.w,se.h,0,-1,1,1),this.imageLayer){let[S,R]=i.Util.applyTransform([se.x,se.y],(0,n.getCurrentTransform)(this.ctx));this.imageLayer.appendImage({imgData:P,left:S,top:R,width:j,height:z})}N.restore()}this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(P){}markPointProps(P,C){}beginMarkedContent(P){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(P,C){P==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(C)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(P){let C=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(P);let N=this.ctx;this.pendingClip&&(C||(this.pendingClip===$?N.clip("evenodd"):N.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),N.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let P=(0,n.getCurrentTransform)(this.ctx);if(P[1]===0&&P[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(P[0]),Math.abs(P[3]));else{let C=Math.abs(P[0]*P[3]-P[2]*P[1]),N=Math.hypot(P[0],P[2]),j=Math.hypot(P[1],P[3]);this._cachedGetSinglePixelWidth=Math.max(N,j)/C}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(!this._cachedScaleForStroking){let{lineWidth:P}=this.current,C=(0,n.getCurrentTransform)(this.ctx),N,j;if(C[1]===0&&C[2]===0){let z=Math.abs(C[0]),X=Math.abs(C[3]);if(P===0)N=1/z,j=1/X;else{let oe=z*P,se=X*P;N=oe<1?1/oe:1,j=se<1?1/se:1}}else{let z=Math.abs(C[0]*C[3]-C[2]*C[1]),X=Math.hypot(C[0],C[1]),oe=Math.hypot(C[2],C[3]);if(P===0)N=oe/z,j=X/z;else{let se=P*z;N=oe>se?oe/se:1,j=X>se?X/se:1}}this._cachedScaleForStroking=[N,j]}return this._cachedScaleForStroking}rescaleAndStroke(P){let{ctx:C}=this,{lineWidth:N}=this.current,[j,z]=this.getScaleForStroking();if(C.lineWidth=N||1,j===1&&z===1){C.stroke();return}let X,oe,se;P&&(X=(0,n.getCurrentTransform)(C),oe=C.getLineDash().slice(),se=C.lineDashOffset),C.scale(j,z);let S=Math.max(j,z);C.setLineDash(C.getLineDash().map(R=>R/S)),C.lineDashOffset/=S,C.stroke(),P&&(C.setTransform(...X),C.setLineDash(oe),C.lineDashOffset=se)}isContentVisible(){for(let P=this.markedContentStack.length-1;P>=0;P--)if(!this.markedContentStack[P].visible)return!1;return!0}},te=Ue;xe=new WeakSet,$v=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},t.CanvasGraphics=te;for(let Y in i.OPS)te.prototype[Y]!==void 0&&(te.prototype[i.OPS[Y]]=te.prototype[Y])},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TilingPattern=t.PathType=void 0,t.getShadingPattern=m;var n=e(1),i=e(8),o=e(3);let s={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};t.PathType=s;function l(M,k){if(!k||o.isNodeJS)return;let E=k[2]-k[0],b=k[3]-k[1],g=new Path2D;g.rect(k[0],k[1],E,b),M.clip(g)}class c{constructor(){this.constructor===c&&(0,n.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,n.unreachable)("Abstract method `getPattern` called.")}}class u extends c{constructor(k){super(),this._type=k[1],this._bbox=k[2],this._colorStops=k[3],this._p0=k[4],this._p1=k[5],this._r0=k[6],this._r1=k[7],this.matrix=null}_createGradient(k){let E;this._type==="axial"?E=k.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(E=k.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let b of this._colorStops)E.addColorStop(b[0],b[1]);return E}getPattern(k,E,b,g){let v;if(g===s.STROKE||g===s.FILL){let y=E.current.getClippedPathBoundingBox(g,(0,i.getCurrentTransform)(k))||[0,0,0,0],V=Math.ceil(y[2]-y[0])||1,B=Math.ceil(y[3]-y[1])||1,D=E.cachedCanvases.getCanvas("pattern",V,B,!0),L=D.context;L.clearRect(0,0,L.canvas.width,L.canvas.height),L.beginPath(),L.rect(0,0,L.canvas.width,L.canvas.height),L.translate(-y[0],-y[1]),b=n.Util.transform(b,[1,0,0,1,y[0],y[1]]),L.transform(...E.baseTransform),this.matrix&&L.transform(...this.matrix),l(L,this._bbox),L.fillStyle=this._createGradient(L),L.fill(),v=k.createPattern(D.canvas,"no-repeat");let J=new DOMMatrix(b);try{v.setTransform(J)}catch(ae){(0,n.warn)(`RadialAxialShadingPattern.getPattern: "${ae?.message}".`)}}else l(k,this._bbox),v=this._createGradient(k);return v}}function p(M,k,E,b,g,v,y,V){let B=k.coords,D=k.colors,L=M.data,J=M.width*4,ae;B[E+1]>B[b+1]&&(ae=E,E=b,b=ae,ae=v,v=y,y=ae),B[b+1]>B[g+1]&&(ae=b,b=g,g=ae,ae=y,y=V,V=ae),B[E+1]>B[b+1]&&(ae=E,E=b,b=ae,ae=v,v=y,y=ae);let Q=(B[E]+k.offsetX)*k.scaleX,ee=(B[E+1]+k.offsetY)*k.scaleY,K=(B[b]+k.offsetX)*k.scaleX,$=(B[b+1]+k.offsetY)*k.scaleY,te=(B[g]+k.offsetX)*k.scaleX,xe=(B[g+1]+k.offsetY)*k.scaleY;if(ee>=xe)return;let be=D[v],Ue=D[v+1],Y=D[v+2],P=D[y],C=D[y+1],N=D[y+2],j=D[V],z=D[V+1],X=D[V+2],oe=Math.round(ee),se=Math.round(xe),S,R,O,U,G,Z,he,Pe;for(let pe=oe;pe<=se;pe++){if(pe<$){let q;pe<ee?q=0:q=(ee-pe)/(ee-$),S=Q-(Q-K)*q,R=be-(be-P)*q,O=Ue-(Ue-C)*q,U=Y-(Y-N)*q}else{let q;pe>xe?q=1:$===xe?q=0:q=($-pe)/($-xe),S=K-(K-te)*q,R=P-(P-j)*q,O=C-(C-z)*q,U=N-(N-X)*q}let de;pe<ee?de=0:pe>xe?de=1:de=(ee-pe)/(ee-xe),G=Q-(Q-te)*de,Z=be-(be-j)*de,he=Ue-(Ue-z)*de,Pe=Y-(Y-X)*de;let ge=Math.round(Math.min(S,G)),Se=Math.round(Math.max(S,G)),Oe=J*pe+ge*4;for(let q=ge;q<=Se;q++)de=(S-q)/(S-G),de<0?de=0:de>1&&(de=1),L[Oe++]=R-(R-Z)*de|0,L[Oe++]=O-(O-he)*de|0,L[Oe++]=U-(U-Pe)*de|0,L[Oe++]=255}}function f(M,k,E){let b=k.coords,g=k.colors,v,y;switch(k.type){case"lattice":let V=k.verticesPerRow,B=Math.floor(b.length/V)-1,D=V-1;for(v=0;v<B;v++){let L=v*V;for(let J=0;J<D;J++,L++)p(M,E,b[L],b[L+1],b[L+V],g[L],g[L+1],g[L+V]),p(M,E,b[L+V+1],b[L+1],b[L+V],g[L+V+1],g[L+1],g[L+V])}break;case"triangles":for(v=0,y=b.length;v<y;v+=3)p(M,E,b[v],b[v+1],b[v+2],g[v],g[v+1],g[v+2]);break;default:throw new Error("illegal figure")}}class w extends c{constructor(k){super(),this._coords=k[2],this._colors=k[3],this._figures=k[4],this._bounds=k[5],this._bbox=k[7],this._background=k[8],this.matrix=null}_createMeshCanvas(k,E,b){let V=Math.floor(this._bounds[0]),B=Math.floor(this._bounds[1]),D=Math.ceil(this._bounds[2])-V,L=Math.ceil(this._bounds[3])-B,J=Math.min(Math.ceil(Math.abs(D*k[0]*1.1)),3e3),ae=Math.min(Math.ceil(Math.abs(L*k[1]*1.1)),3e3),Q=D/J,ee=L/ae,K={coords:this._coords,colors:this._colors,offsetX:-V,offsetY:-B,scaleX:1/Q,scaleY:1/ee},$=J+2*2,te=ae+2*2,xe=b.getCanvas("mesh",$,te,!1),be=xe.context,Ue=be.createImageData(J,ae);if(E){let P=Ue.data;for(let C=0,N=P.length;C<N;C+=4)P[C]=E[0],P[C+1]=E[1],P[C+2]=E[2],P[C+3]=255}for(let P of this._figures)f(Ue,P,K);return be.putImageData(Ue,2,2),{canvas:xe.canvas,offsetX:V-2*Q,offsetY:B-2*ee,scaleX:Q,scaleY:ee}}getPattern(k,E,b,g){l(k,this._bbox);let v;if(g===s.SHADING)v=n.Util.singularValueDecompose2dScale((0,i.getCurrentTransform)(k));else if(v=n.Util.singularValueDecompose2dScale(E.baseTransform),this.matrix){let V=n.Util.singularValueDecompose2dScale(this.matrix);v=[v[0]*V[0],v[1]*V[1]]}let y=this._createMeshCanvas(v,g===s.SHADING?null:this._background,E.cachedCanvases);return g!==s.SHADING&&(k.setTransform(...E.baseTransform),this.matrix&&k.transform(...this.matrix)),k.translate(y.offsetX,y.offsetY),k.scale(y.scaleX,y.scaleY),k.createPattern(y.canvas,"no-repeat")}}class A extends c{getPattern(){return"hotpink"}}function m(M){switch(M[0]){case"RadialAxial":return new u(M);case"Mesh":return new w(M);case"Dummy":return new A}throw new Error(`Unknown IR type: ${M[0]}`)}let d={COLORED:1,UNCOLORED:2};class h{static get MAX_PATTERN_SIZE(){return(0,n.shadow)(this,"MAX_PATTERN_SIZE",3e3)}constructor(k,E,b,g,v){this.operatorList=k[2],this.matrix=k[3]||[1,0,0,1,0,0],this.bbox=k[4],this.xstep=k[5],this.ystep=k[6],this.paintType=k[7],this.tilingType=k[8],this.color=E,this.ctx=b,this.canvasGraphicsFactory=g,this.baseTransform=v}createPatternCanvas(k){let E=this.operatorList,b=this.bbox,g=this.xstep,v=this.ystep,y=this.paintType,V=this.tilingType,B=this.color,D=this.canvasGraphicsFactory;(0,n.info)("TilingType: "+V);let L=b[0],J=b[1],ae=b[2],Q=b[3],ee=n.Util.singularValueDecompose2dScale(this.matrix),K=n.Util.singularValueDecompose2dScale(this.baseTransform),$=[ee[0]*K[0],ee[1]*K[1]],te=this.getSizeAndScale(g,this.ctx.canvas.width,$[0]),xe=this.getSizeAndScale(v,this.ctx.canvas.height,$[1]),be=k.cachedCanvases.getCanvas("pattern",te.size,xe.size,!0),Ue=be.context,Y=D.createCanvasGraphics(Ue);Y.groupLevel=k.groupLevel,this.setFillAndStrokeStyleToContext(Y,y,B);let P=L,C=J,N=ae,j=Q;return L<0&&(P=0,N+=Math.abs(L)),J<0&&(C=0,j+=Math.abs(J)),Ue.translate(-(te.scale*P),-(xe.scale*C)),Y.transform(te.scale,0,0,xe.scale,0,0),Ue.save(),this.clipBbox(Y,P,C,N,j),Y.baseTransform=(0,i.getCurrentTransform)(Y.ctx),Y.executeOperatorList(E),Y.endDrawing(),{canvas:be.canvas,scaleX:te.scale,scaleY:xe.scale,offsetX:P,offsetY:C}}getSizeAndScale(k,E,b){k=Math.abs(k);let g=Math.max(h.MAX_PATTERN_SIZE,E),v=Math.ceil(k*b);return v>=g?v=g:b=v/k,{scale:b,size:v}}clipBbox(k,E,b,g,v){let y=g-E,V=v-b;k.ctx.rect(E,b,y,V),k.current.updateRectMinMax((0,i.getCurrentTransform)(k.ctx),[E,b,g,v]),k.clip(),k.endPath()}setFillAndStrokeStyleToContext(k,E,b){let g=k.ctx,v=k.current;switch(E){case d.COLORED:let y=this.ctx;g.fillStyle=y.fillStyle,g.strokeStyle=y.strokeStyle,v.fillColor=y.fillStyle,v.strokeColor=y.strokeStyle;break;case d.UNCOLORED:let V=n.Util.makeHexColor(b[0],b[1],b[2]);g.fillStyle=V,g.strokeStyle=V,v.fillColor=V,v.strokeColor=V;break;default:throw new n.FormatError(`Unsupported paint type: ${E}`)}}getPattern(k,E,b,g){let v=b;g!==s.SHADING&&(v=n.Util.transform(v,E.baseTransform),this.matrix&&(v=n.Util.transform(v,this.matrix)));let y=this.createPatternCanvas(E),V=new DOMMatrix(v);V=V.translate(y.offsetX,y.offsetY),V=V.scale(1/y.scaleX,1/y.scaleY);let B=k.createPattern(y.canvas,"repeat");try{B.setTransform(V)}catch(D){(0,n.warn)(`TilingPattern.getPattern: "${D?.message}".`)}return B}}t.TilingPattern=h},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyMaskImageData=i;var n=e(1);function i({src:o,srcPos:s=0,dest:l,destPos:c=0,width:u,height:p,inverseDecode:f=!1}){let w=n.FeatureTest.isLittleEndian?4278190080:255,[A,m]=f?[0,w]:[w,0],d=u>>3,h=u&7,M=o.length;l=new Uint32Array(l.buffer);for(let k=0;k<p;k++){for(let b=s+d;s<b;s++){let g=s<M?o[s]:255;l[c++]=g&128?m:A,l[c++]=g&64?m:A,l[c++]=g&32?m:A,l[c++]=g&16?m:A,l[c++]=g&8?m:A,l[c++]=g&4?m:A,l[c++]=g&2?m:A,l[c++]=g&1?m:A}if(h===0)continue;let E=s<M?o[s++]:255;for(let b=0;b<h;b++)l[c++]=E&1<<7-b?m:A}return{srcPos:s,destPos:c}}},(r,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalWorkerOptions=void 0;let e=Object.create(null);t.GlobalWorkerOptions=e,e.workerPort=e.workerPort===void 0?null:e.workerPort,e.workerSrc=e.workerSrc===void 0?"":e.workerSrc},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandler=void 0;var n=e(1);let i={UNKNOWN:0,DATA:1,ERROR:2},o={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function s(c){switch(c instanceof Error||typeof c=="object"&&c!==null||(0,n.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),c.name){case"AbortException":return new n.AbortException(c.message);case"MissingPDFException":return new n.MissingPDFException(c.message);case"PasswordException":return new n.PasswordException(c.message,c.code);case"UnexpectedResponseException":return new n.UnexpectedResponseException(c.message,c.status);case"UnknownErrorException":return new n.UnknownErrorException(c.message,c.details);default:return new n.UnknownErrorException(c.message,c.toString())}}class l{constructor(u,p,f){this.sourceName=u,this.targetName=p,this.comObj=f,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=w=>{let A=w.data;if(A.targetName!==this.sourceName)return;if(A.stream){this._processStreamMessage(A);return}if(A.callback){let d=A.callbackId,h=this.callbackCapabilities[d];if(!h)throw new Error(`Cannot resolve callback ${d}`);if(delete this.callbackCapabilities[d],A.callback===i.DATA)h.resolve(A.data);else if(A.callback===i.ERROR)h.reject(s(A.reason));else throw new Error("Unexpected callback case");return}let m=this.actionHandler[A.action];if(!m)throw new Error(`Unknown action from worker: ${A.action}`);if(A.callbackId){let d=this.sourceName,h=A.sourceName;new Promise(function(M){M(m(A.data))}).then(function(M){f.postMessage({sourceName:d,targetName:h,callback:i.DATA,callbackId:A.callbackId,data:M})},function(M){f.postMessage({sourceName:d,targetName:h,callback:i.ERROR,callbackId:A.callbackId,reason:s(M)})});return}if(A.streamId){this._createStreamSink(A);return}m(A.data)},f.addEventListener("message",this._onComObjOnMessage)}on(u,p){let f=this.actionHandler;if(f[u])throw new Error(`There is already an actionName called "${u}"`);f[u]=p}send(u,p,f){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:u,data:p},f)}sendWithPromise(u,p,f){let w=this.callbackId++,A=(0,n.createPromiseCapability)();this.callbackCapabilities[w]=A;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:u,callbackId:w,data:p},f)}catch(m){A.reject(m)}return A.promise}sendWithStream(u,p,f,w){let A=this.streamId++,m=this.sourceName,d=this.targetName,h=this.comObj;return new ReadableStream({start:M=>{let k=(0,n.createPromiseCapability)();return this.streamControllers[A]={controller:M,startCall:k,pullCall:null,cancelCall:null,isClosed:!1},h.postMessage({sourceName:m,targetName:d,action:u,streamId:A,data:p,desiredSize:M.desiredSize},w),k.promise},pull:M=>{let k=(0,n.createPromiseCapability)();return this.streamControllers[A].pullCall=k,h.postMessage({sourceName:m,targetName:d,stream:o.PULL,streamId:A,desiredSize:M.desiredSize}),k.promise},cancel:M=>{(0,n.assert)(M instanceof Error,"cancel must have a valid reason");let k=(0,n.createPromiseCapability)();return this.streamControllers[A].cancelCall=k,this.streamControllers[A].isClosed=!0,h.postMessage({sourceName:m,targetName:d,stream:o.CANCEL,streamId:A,reason:s(M)}),k.promise}},f)}_createStreamSink(u){let p=u.streamId,f=this.sourceName,w=u.sourceName,A=this.comObj,m=this,d=this.actionHandler[u.action],h={enqueue(M,k=1,E){if(this.isCancelled)return;let b=this.desiredSize;this.desiredSize-=k,b>0&&this.desiredSize<=0&&(this.sinkCapability=(0,n.createPromiseCapability)(),this.ready=this.sinkCapability.promise),A.postMessage({sourceName:f,targetName:w,stream:o.ENQUEUE,streamId:p,chunk:M},E)},close(){this.isCancelled||(this.isCancelled=!0,A.postMessage({sourceName:f,targetName:w,stream:o.CLOSE,streamId:p}),delete m.streamSinks[p])},error(M){(0,n.assert)(M instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,A.postMessage({sourceName:f,targetName:w,stream:o.ERROR,streamId:p,reason:s(M)}))},sinkCapability:(0,n.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:u.desiredSize,ready:null};h.sinkCapability.resolve(),h.ready=h.sinkCapability.promise,this.streamSinks[p]=h,new Promise(function(M){M(d(u.data,h))}).then(function(){A.postMessage({sourceName:f,targetName:w,stream:o.START_COMPLETE,streamId:p,success:!0})},function(M){A.postMessage({sourceName:f,targetName:w,stream:o.START_COMPLETE,streamId:p,reason:s(M)})})}_processStreamMessage(u){let p=u.streamId,f=this.sourceName,w=u.sourceName,A=this.comObj,m=this.streamControllers[p],d=this.streamSinks[p];switch(u.stream){case o.START_COMPLETE:u.success?m.startCall.resolve():m.startCall.reject(s(u.reason));break;case o.PULL_COMPLETE:u.success?m.pullCall.resolve():m.pullCall.reject(s(u.reason));break;case o.PULL:if(!d){A.postMessage({sourceName:f,targetName:w,stream:o.PULL_COMPLETE,streamId:p,success:!0});break}d.desiredSize<=0&&u.desiredSize>0&&d.sinkCapability.resolve(),d.desiredSize=u.desiredSize,new Promise(function(h){h(d.onPull&&d.onPull())}).then(function(){A.postMessage({sourceName:f,targetName:w,stream:o.PULL_COMPLETE,streamId:p,success:!0})},function(h){A.postMessage({sourceName:f,targetName:w,stream:o.PULL_COMPLETE,streamId:p,reason:s(h)})});break;case o.ENQUEUE:if((0,n.assert)(m,"enqueue should have stream controller"),m.isClosed)break;m.controller.enqueue(u.chunk);break;case o.CLOSE:if((0,n.assert)(m,"close should have stream controller"),m.isClosed)break;m.isClosed=!0,m.controller.close(),this._deleteStreamController(m,p);break;case o.ERROR:(0,n.assert)(m,"error should have stream controller"),m.controller.error(s(u.reason)),this._deleteStreamController(m,p);break;case o.CANCEL_COMPLETE:u.success?m.cancelCall.resolve():m.cancelCall.reject(s(u.reason)),this._deleteStreamController(m,p);break;case o.CANCEL:if(!d)break;new Promise(function(h){h(d.onCancel&&d.onCancel(s(u.reason)))}).then(function(){A.postMessage({sourceName:f,targetName:w,stream:o.CANCEL_COMPLETE,streamId:p,success:!0})},function(h){A.postMessage({sourceName:f,targetName:w,stream:o.CANCEL_COMPLETE,streamId:p,reason:s(h)})}),d.sinkCapability.reject(s(u.reason)),d.isCancelled=!0,delete this.streamSinks[p];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(u,p){await Promise.allSettled([u.startCall&&u.startCall.promise,u.pullCall&&u.pullCall.promise,u.cancelCall&&u.cancelCall.promise]),delete this.streamControllers[p]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}t.MessageHandler=l},(r,t,e)=>{var o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var n=e(1);class i{constructor({parsedData:c,rawData:u}){Fe(this,o,void 0);Fe(this,s,void 0);He(this,o,c),He(this,s,u)}getRaw(){return H(this,s)}get(c){return H(this,o).get(c)??null}getAll(){return(0,n.objectFromMap)(H(this,o))}has(c){return H(this,o).has(c)}}o=new WeakMap,s=new WeakMap,t.Metadata=i},(r,t,e)=>{var l,c,u,p,f,w,Zv;Object.defineProperty(t,"__esModule",{value:!0}),t.OptionalContentConfig=void 0;var n=e(1);let i=Symbol("INTERNAL");class o{constructor(d,h){Fe(this,l,!0);this.name=d,this.intent=h}get visible(){return H(this,l)}_setVisible(d,h){d!==i&&(0,n.unreachable)("Internal method `_setVisible` called."),He(this,l,h)}}l=new WeakMap;class s{constructor(d){Fe(this,w);Fe(this,c,!0);Fe(this,u,new Map);Fe(this,p,null);Fe(this,f,null);if(this.name=null,this.creator=null,d!==null){this.name=d.name,this.creator=d.creator,He(this,f,d.order);for(let h of d.groups)H(this,u).set(h.id,new o(h.name,h.intent));if(d.baseState==="OFF")for(let h of H(this,u).values())h._setVisible(i,!1);for(let h of d.on)H(this,u).get(h)._setVisible(i,!0);for(let h of d.off)H(this,u).get(h)._setVisible(i,!1);He(this,p,new Map);for(let[h,M]of H(this,u))H(this,p).set(h,M.visible)}}isVisible(d){if(H(this,u).size===0)return!0;if(!d)return(0,n.warn)("Optional content group not defined."),!0;if(d.type==="OCG")return H(this,u).has(d.id)?H(this,u).get(d.id).visible:((0,n.warn)(`Optional content group not found: ${d.id}`),!0);if(d.type==="OCMD"){if(d.expression)return _e(this,w,Zv).call(this,d.expression);if(!d.policy||d.policy==="AnyOn"){for(let h of d.ids){if(!H(this,u).has(h))return(0,n.warn)(`Optional content group not found: ${h}`),!0;if(H(this,u).get(h).visible)return!0}return!1}else if(d.policy==="AllOn"){for(let h of d.ids){if(!H(this,u).has(h))return(0,n.warn)(`Optional content group not found: ${h}`),!0;if(!H(this,u).get(h).visible)return!1}return!0}else if(d.policy==="AnyOff"){for(let h of d.ids){if(!H(this,u).has(h))return(0,n.warn)(`Optional content group not found: ${h}`),!0;if(!H(this,u).get(h).visible)return!0}return!1}else if(d.policy==="AllOff"){for(let h of d.ids){if(!H(this,u).has(h))return(0,n.warn)(`Optional content group not found: ${h}`),!0;if(H(this,u).get(h).visible)return!1}return!0}return(0,n.warn)(`Unknown optional content policy ${d.policy}.`),!0}return(0,n.warn)(`Unknown group type ${d.type}.`),!0}setVisibility(d,h=!0){if(!H(this,u).has(d)){(0,n.warn)(`Optional content group not found: ${d}`);return}H(this,u).get(d)._setVisible(i,!!h),He(this,c,null)}get hasInitialVisibility(){if(H(this,c)!==null)return H(this,c);for(let[d,h]of H(this,u)){let M=H(this,p).get(d);if(h.visible!==M)return He(this,c,!1)}return He(this,c,!0)}getOrder(){return H(this,u).size?H(this,f)?H(this,f).slice():[...H(this,u).keys()]:null}getGroups(){return H(this,u).size>0?(0,n.objectFromMap)(H(this,u)):null}getGroup(d){return H(this,u).get(d)||null}}c=new WeakMap,u=new WeakMap,p=new WeakMap,f=new WeakMap,w=new WeakSet,Zv=function(d){let h=d.length;if(h<2)return!0;let M=d[0];for(let k=1;k<h;k++){let E=d[k],b;if(Array.isArray(E))b=_e(this,w,Zv).call(this,E);else if(H(this,u).has(E))b=H(this,u).get(E).visible;else return(0,n.warn)(`Optional content group not found: ${E}`),!0;switch(M){case"And":if(!b)return!1;break;case"Or":if(b)return!0;break;case"Not":return!b;default:return!0}}return M==="And"},t.OptionalContentConfig=s},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFDataTransportStream=void 0;var n=e(1),i=e(8);class o{constructor(u,p){(0,n.assert)(p,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=u.progressiveDone||!1,this._contentDispositionFilename=u.contentDispositionFilename||null;let f=u.initialData;if(f?.length>0){let w=new Uint8Array(f).buffer;this._queuedChunks.push(w)}this._pdfDataRangeTransport=p,this._isStreamingSupported=!u.disableStream,this._isRangeSupported=!u.disableRange,this._contentLength=u.length,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((w,A)=>{this._onReceiveData({begin:w,chunk:A})}),this._pdfDataRangeTransport.addProgressListener((w,A)=>{this._onProgress({loaded:w,total:A})}),this._pdfDataRangeTransport.addProgressiveReadListener(w=>{this._onReceiveData({chunk:w})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData(u){let p=new Uint8Array(u.chunk).buffer;if(u.begin===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(p):this._queuedChunks.push(p);else{let f=this._rangeReaders.some(function(w){return w._begin!==u.begin?!1:(w._enqueue(p),!0)});(0,n.assert)(f,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(u){if(u.total===void 0){let p=this._rangeReaders[0];p?.onProgress&&p.onProgress({loaded:u.loaded})}else{let p=this._fullRequestReader;p?.onProgress&&p.onProgress({loaded:u.loaded,total:u.total})}}_onProgressiveDone(){this._fullRequestReader&&this._fullRequestReader.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(u){let p=this._rangeReaders.indexOf(u);p>=0&&this._rangeReaders.splice(p,1)}getFullReader(){(0,n.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let u=this._queuedChunks;return this._queuedChunks=null,new s(this,u,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(u,p){if(p<=this._progressiveDataLength)return null;let f=new l(this,u,p);return this._pdfDataRangeTransport.requestDataRange(u,p),this._rangeReaders.push(f),f}cancelAllRequests(u){this._fullRequestReader&&this._fullRequestReader.cancel(u);for(let p of this._rangeReaders.slice(0))p.cancel(u);this._pdfDataRangeTransport.abort()}}t.PDFDataTransportStream=o;class s{constructor(u,p,f=!1,w=null){this._stream=u,this._done=f||!1,this._filename=(0,i.isPdfFile)(w)?w:null,this._queuedChunks=p||[],this._loaded=0;for(let A of this._queuedChunks)this._loaded+=A.byteLength;this._requests=[],this._headersReady=Promise.resolve(),u._fullRequestReader=this,this.onProgress=null}_enqueue(u){this._done||(this._requests.length>0?this._requests.shift().resolve({value:u,done:!1}):this._queuedChunks.push(u),this._loaded+=u.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let u=(0,n.createPromiseCapability)();return this._requests.push(u),u.promise}cancel(u){this._done=!0;for(let p of this._requests)p.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class l{constructor(u,p,f){this._stream=u,this._begin=p,this._end=f,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(u){if(!this._done){if(this._requests.length===0)this._queuedChunk=u;else{this._requests.shift().resolve({value:u,done:!1});for(let f of this._requests)f.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let p=this._queuedChunk;return this._queuedChunk=null,{value:p,done:!1}}if(this._done)return{value:void 0,done:!0};let u=(0,n.createPromiseCapability)();return this._requests.push(u),u.promise}cancel(u){this._done=!0;for(let p of this._requests)p.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(r,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaText=void 0;class e{static textContent(i){let o=[],s={items:o,styles:Object.create(null)};function l(c){if(!c)return;let u=null,p=c.name;if(p==="#text")u=c.value;else if(e.shouldBuildText(p))c?.attributes?.textContent?u=c.attributes.textContent:c.value&&(u=c.value);else return;if(u!==null&&o.push({str:u}),!!c.children)for(let f of c.children)l(f)}return l(i),s}static shouldBuildText(i){return!(i==="textarea"||i==="input"||i==="option"||i==="select")}}t.XfaText=e},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodeStandardFontDataFactory=t.NodeCanvasFactory=t.NodeCMapReaderFactory=void 0;var n=e(9);let i=function(c){return new Promise((u,p)=>{Kv().readFile(c,(w,A)=>{if(w||!A){p(new Error(w));return}u(new Uint8Array(A))})})};class o extends n.BaseCanvasFactory{_createCanvas(u,p){return qT().createCanvas(u,p)}}t.NodeCanvasFactory=o;class s extends n.BaseCMapReaderFactory{_fetchData(u,p){return i(u).then(f=>({cMapData:f,compressionType:p}))}}t.NodeCMapReaderFactory=s;class l extends n.BaseStandardFontDataFactory{_fetchData(u){return i(u)}}t.NodeStandardFontDataFactory=l},(r,t,e)=>{var c,u,p,f,w,A,m,d,h,e1,k,rE,b,t1,v,iE;Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationEditorLayer=void 0;var n=e(7),i=e(1),o=e(23),s=e(24);let V=class{constructor(D){Fe(this,h);Fe(this,k);Fe(this,b);Fe(this,v);Fe(this,c,void 0);Fe(this,u,!1);Fe(this,p,this.pointerup.bind(this));Fe(this,f,this.pointerdown.bind(this));Fe(this,w,new Map);Fe(this,A,!1);Fe(this,m,!1);Fe(this,d,void 0);V._initialized||(V._initialized=!0,o.FreeTextEditor.initialize(D.l10n),s.InkEditor.initialize(D.l10n),D.uiManager.registerEditorTypes([o.FreeTextEditor,s.InkEditor])),He(this,d,D.uiManager),this.annotationStorage=D.annotationStorage,this.pageIndex=D.pageIndex,this.div=D.div,He(this,c,D.accessibilityManager),H(this,d).addLayer(this)}updateToolbar(D){H(this,d).updateToolbar(D)}updateMode(D=H(this,d).getMode()){_e(this,v,iE).call(this),D===i.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),H(this,d).unselectAll()}addInkEditorIfNeeded(D){if(!D&&H(this,d).getMode()!==i.AnnotationEditorType.INK)return;if(!D){for(let J of H(this,w).values())if(J.isEmpty()){J.setInBackground();return}}_e(this,b,t1).call(this,{offsetX:0,offsetY:0}).setInBackground()}setEditingState(D){H(this,d).setEditingState(D)}addCommands(D){H(this,d).addCommands(D)}enable(){this.div.style.pointerEvents="auto";for(let D of H(this,w).values())D.enableEditing()}disable(){this.div.style.pointerEvents="none";for(let D of H(this,w).values())D.disableEditing()}setActiveEditor(D){H(this,d).getActive()!==D&&H(this,d).setActiveEditor(D)}enableClick(){this.div.addEventListener("pointerdown",H(this,f)),this.div.addEventListener("pointerup",H(this,p))}disableClick(){this.div.removeEventListener("pointerdown",H(this,f)),this.div.removeEventListener("pointerup",H(this,p))}attach(D){H(this,w).set(D.id,D)}detach(D){H(this,w).delete(D.id),H(this,c)?.removePointerInTextLayer(D.contentDiv)}remove(D){H(this,d).removeEditor(D),this.detach(D),this.annotationStorage.remove(D.id),D.div.style.display="none",setTimeout(()=>{D.div.style.display="",D.div.remove(),D.isAttachedToDOM=!1,document.activeElement===document.body&&H(this,d).focusMainContainer()},0),H(this,m)||this.addInkEditorIfNeeded(!1)}add(D){if(_e(this,h,e1).call(this,D),H(this,d).addEditor(D),this.attach(D),!D.isAttachedToDOM){let L=D.render();this.div.append(L),D.isAttachedToDOM=!0}this.moveEditorInDOM(D),D.onceAdded(),this.addToAnnotationStorage(D)}moveEditorInDOM(D){H(this,c)?.moveElementInDOM(this.div,D.div,D.contentDiv,!0)}addToAnnotationStorage(D){!D.isEmpty()&&!this.annotationStorage.has(D.id)&&this.annotationStorage.setValue(D.id,D)}addOrRebuild(D){D.needsToBeRebuilt()?D.rebuild():this.add(D)}addANewEditor(D){let L=()=>{this.addOrRebuild(D)},J=()=>{D.remove()};this.addCommands({cmd:L,undo:J,mustExec:!0})}addUndoableEditor(D){let L=()=>{this.addOrRebuild(D)},J=()=>{D.remove()};this.addCommands({cmd:L,undo:J,mustExec:!1})}getNextId(){return H(this,d).getId()}deserialize(D){switch(D.annotationType){case i.AnnotationEditorType.FREETEXT:return o.FreeTextEditor.deserialize(D,this);case i.AnnotationEditorType.INK:return s.InkEditor.deserialize(D,this)}return null}setSelected(D){H(this,d).setSelected(D)}toggleSelected(D){H(this,d).toggleSelected(D)}isSelected(D){return H(this,d).isSelected(D)}unselect(D){H(this,d).unselect(D)}pointerup(D){let L=n.KeyboardManager.platform.isMac;if(!(D.button!==0||D.ctrlKey&&L)&&D.target===this.div&&H(this,A)){if(He(this,A,!1),!H(this,u)){He(this,u,!0);return}_e(this,b,t1).call(this,D)}}pointerdown(D){let L=n.KeyboardManager.platform.isMac;if(D.button!==0||D.ctrlKey&&L||D.target!==this.div)return;He(this,A,!0);let J=H(this,d).getActive();He(this,u,!J||J.isEmpty())}drop(D){let L=D.dataTransfer.getData("text/plain"),J=H(this,d).getEditor(L);if(!J)return;D.preventDefault(),D.dataTransfer.dropEffect="move",_e(this,h,e1).call(this,J);let ae=this.div.getBoundingClientRect(),Q=D.clientX-ae.x,ee=D.clientY-ae.y;J.translate(Q-J.startX,ee-J.startY),this.moveEditorInDOM(J),J.div.focus()}dragover(D){D.preventDefault()}destroy(){H(this,d).getActive()?.parent===this&&H(this,d).setActiveEditor(null);for(let D of H(this,w).values())H(this,c)?.removePointerInTextLayer(D.contentDiv),D.isAttachedToDOM=!1,D.div.remove(),D.parent=null;this.div=null,H(this,w).clear(),H(this,d).removeLayer(this)}render(D){this.viewport=D.viewport,(0,n.bindEvents)(this,this.div,["dragover","drop"]),this.setDimensions();for(let L of H(this,d).getEditors(this.pageIndex))this.add(L);this.updateMode()}update(D){this.viewport=D.viewport,this.setDimensions(),this.updateMode()}get scaleFactor(){return this.viewport.scale}get pageDimensions(){let[D,L,J,ae]=this.viewport.viewBox,Q=J-D,ee=ae-L;return[Q,ee]}get viewportBaseDimensions(){let{width:D,height:L,rotation:J}=this.viewport;return J%180===0?[D,L]:[L,D]}setDimensions(){let{width:D,height:L,rotation:J}=this.viewport,ae=J%180!==0,Q=Math.floor(D)+"px",ee=Math.floor(L)+"px";this.div.style.width=ae?ee:Q,this.div.style.height=ae?Q:ee,this.div.setAttribute("data-main-rotation",J)}},l=V;c=new WeakMap,u=new WeakMap,p=new WeakMap,f=new WeakMap,w=new WeakMap,A=new WeakMap,m=new WeakMap,d=new WeakMap,h=new WeakSet,e1=function(D){D.parent!==this&&(this.attach(D),D.pageIndex=this.pageIndex,D.parent?.detach(D),D.parent=this,D.div&&D.isAttachedToDOM&&(D.div.remove(),this.div.append(D.div)))},k=new WeakSet,rE=function(D){switch(H(this,d).getMode()){case i.AnnotationEditorType.FREETEXT:return new o.FreeTextEditor(D);case i.AnnotationEditorType.INK:return new s.InkEditor(D)}return null},b=new WeakSet,t1=function(D){let L=this.getNextId(),J=_e(this,k,rE).call(this,{parent:this,id:L,x:D.offsetX,y:D.offsetY});return J&&this.add(J),J},v=new WeakSet,iE=function(){He(this,m,!0);for(let D of H(this,w).values())D.isEmpty()&&D.remove();He(this,m,!1)},_n(l,"_initialized",!1),t.AnnotationEditorLayer=l},(r,t,e)=>{var l,c,u,p,f,w,A,m,oE,h,sE,k,aE,b,n1;Object.defineProperty(t,"__esModule",{value:!0}),t.FreeTextEditor=void 0;var n=e(1),i=e(7),o=e(6);let v=class extends o.AnnotationEditor{constructor(B){super({...B,name:"freeTextEditor"});Fe(this,m);Fe(this,h);Fe(this,k);Fe(this,b);Fe(this,l,this.editorDivBlur.bind(this));Fe(this,c,this.editorDivFocus.bind(this));Fe(this,u,this.editorDivKeydown.bind(this));Fe(this,p,void 0);Fe(this,f,"");Fe(this,w,!1);Fe(this,A,void 0);He(this,p,B.color||v._defaultColor||o.AnnotationEditor._defaultLineColor),He(this,A,B.fontSize||v._defaultFontSize)}static initialize(B){this._l10nPromise=new Map(["free_text_default_content","editor_free_text_aria_label"].map(L=>[L,B.get(L)]));let D=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(D.getPropertyValue("--freetext-padding"))}static updateDefaultParams(B,D){switch(B){case n.AnnotationEditorParamsType.FREETEXT_SIZE:v._defaultFontSize=D;break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:v._defaultColor=D;break}}updateParams(B,D){switch(B){case n.AnnotationEditorParamsType.FREETEXT_SIZE:_e(this,m,oE).call(this,D);break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:_e(this,h,sE).call(this,D);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,v._defaultFontSize],[n.AnnotationEditorParamsType.FREETEXT_COLOR,v._defaultColor||o.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,H(this,A)],[n.AnnotationEditorParamsType.FREETEXT_COLOR,H(this,p)]]}getInitialTranslation(){return[-v._internalPadding*this.parent.scaleFactor,-(v._internalPadding+H(this,A))*this.parent.scaleFactor]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(n.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.enableEditing(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.editorDiv.addEventListener("keydown",H(this,u)),this.editorDiv.addEventListener("focus",H(this,c)),this.editorDiv.addEventListener("blur",H(this,l)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.disableEditing(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",H(this,u)),this.editorDiv.removeEventListener("focus",H(this,c)),this.editorDiv.removeEventListener("blur",H(this,l)),this.div.focus(),this.isEditing=!1)}focusin(B){super.focusin(B),B.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus())}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent.setEditingState(!0),super.remove()}commit(){super.commit(),H(this,w)||(He(this,w,!0),this.parent.addUndoableEditor(this)),this.disableEditMode(),He(this,f,_e(this,k,aE).call(this).trimEnd()),_e(this,b,n1).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(B){this.enableEditMode(),this.editorDiv.focus()}keydown(B){B.target===this.div&&B.key==="Enter"&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(B){v._keyboardManager.exec(this,B)}editorDivFocus(B){this.isEditing=!0}editorDivBlur(B){this.isEditing=!1}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let B,D;this.width&&(B=this.x,D=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",`${this.id}-editor`),this.enableEditing(),v._l10nPromise.get("editor_free_text_aria_label").then(J=>this.editorDiv?.setAttribute("aria-label",J)),v._l10nPromise.get("free_text_default_content").then(J=>this.editorDiv?.setAttribute("default-content",J)),this.editorDiv.contentEditable=!0;let{style:L}=this.editorDiv;if(L.fontSize=`calc(${H(this,A)}px * var(--scale-factor))`,L.color=H(this,p),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,i.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){let[J,ae]=this.parent.viewportBaseDimensions;this.setAt(B*J,D*ae,this.width*J,this.height*ae);for(let Q of H(this,f).split(`
`)){let ee=document.createElement("div");ee.append(Q?document.createTextNode(Q):document.createElement("br")),this.editorDiv.append(ee)}this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(B,D){let L=super.deserialize(B,D);return He(L,A,B.fontSize),He(L,p,n.Util.makeHexColor(...B.color)),He(L,f,B.value),L}serialize(){if(this.isEmpty())return null;let B=v._internalPadding*this.parent.scaleFactor,D=this.getRect(B,B),L=o.AnnotationEditor._colorManager.convert(getComputedStyle(this.editorDiv).color);return{annotationType:n.AnnotationEditorType.FREETEXT,color:L,fontSize:H(this,A),value:H(this,f),pageIndex:this.parent.pageIndex,rect:D,rotation:this.rotation}}},s=v;l=new WeakMap,c=new WeakMap,u=new WeakMap,p=new WeakMap,f=new WeakMap,w=new WeakMap,A=new WeakMap,m=new WeakSet,oE=function(B){let D=J=>{this.editorDiv.style.fontSize=`calc(${J}px * var(--scale-factor))`,this.translate(0,-(J-H(this,A))*this.parent.scaleFactor),He(this,A,J),_e(this,b,n1).call(this)},L=H(this,A);this.parent.addCommands({cmd:()=>{D(B)},undo:()=>{D(L)},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},h=new WeakSet,sE=function(B){let D=H(this,p);this.parent.addCommands({cmd:()=>{He(this,p,B),this.editorDiv.style.color=B},undo:()=>{He(this,p,D),this.editorDiv.style.color=D},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},k=new WeakSet,aE=function(){let B=this.editorDiv.getElementsByTagName("div");if(B.length===0)return this.editorDiv.innerText;let D=[];for(let L=0,J=B.length;L<J;L++){let Q=B[L].firstChild;Q?.nodeName==="#text"?D.push(Q.data):D.push("")}return D.join(`
`)},b=new WeakSet,n1=function(){let[B,D]=this.parent.viewportBaseDimensions,L=this.div.getBoundingClientRect();this.width=L.width/B,this.height=L.height/D},_n(s,"_freeTextDefaultContent",""),_n(s,"_l10nPromise"),_n(s,"_internalPadding",0),_n(s,"_defaultColor",null),_n(s,"_defaultFontSize",10),_n(s,"_keyboardManager",new i.KeyboardManager([[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],v.prototype.commitOrRemove]])),_n(s,"_type","freetext"),t.FreeTextEditor=s},(r,t,e)=>{var u,p,f,w,A,m,d,h,M,k,E,b,g,v,y,lE,B,cE,L,uE,ae,pE,ee,r1,$,dE,xe,hE,Ue,mE,P,uo,N,i1,z,hf,oe,mf,S,$l,O,o1,G,ff,he,s1,pe,fE,ge,gE,Oe,xE,ke,a1,$e,gf,_t,Zl,Jt,l1;Object.defineProperty(t,"__esModule",{value:!0}),t.InkEditor=void 0,Object.defineProperty(t,"fitCurve",{enumerable:!0,get:function(){return o.fitCurve}});var n=e(1),i=e(6),o=e(25),s=e(7);let l=16,bt=class extends i.AnnotationEditor{constructor(ve){super({...ve,name:"inkEditor"});Fe(this,y);Fe(this,B);Fe(this,L);Fe(this,ae);Fe(this,ee);Fe(this,$);Fe(this,xe);Fe(this,Ue);Fe(this,P);Fe(this,N);Fe(this,z);Fe(this,oe);Fe(this,S);Fe(this,O);Fe(this,G);Fe(this,pe);Fe(this,ge);Fe(this,Oe);Fe(this,ke);Fe(this,$e);Fe(this,_t);Fe(this,Jt);Fe(this,u,0);Fe(this,p,0);Fe(this,f,0);Fe(this,w,this.canvasPointermove.bind(this));Fe(this,A,this.canvasPointerleave.bind(this));Fe(this,m,this.canvasPointerup.bind(this));Fe(this,d,this.canvasPointerdown.bind(this));Fe(this,h,!1);Fe(this,M,!1);Fe(this,k,null);Fe(this,E,null);Fe(this,b,0);Fe(this,g,0);Fe(this,v,null);this.color=ve.color||null,this.thickness=ve.thickness||null,this.opacity=ve.opacity||null,this.paths=[],this.bezierPath2D=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(ve){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink_aria_label"].map(Ce=>[Ce,ve.get(Ce)]))}static updateDefaultParams(ve,Ce){switch(ve){case n.AnnotationEditorParamsType.INK_THICKNESS:bt._defaultThickness=Ce;break;case n.AnnotationEditorParamsType.INK_COLOR:bt._defaultColor=Ce;break;case n.AnnotationEditorParamsType.INK_OPACITY:bt._defaultOpacity=Ce/100;break}}updateParams(ve,Ce){switch(ve){case n.AnnotationEditorParamsType.INK_THICKNESS:_e(this,y,lE).call(this,Ce);break;case n.AnnotationEditorParamsType.INK_COLOR:_e(this,B,cE).call(this,Ce);break;case n.AnnotationEditorParamsType.INK_OPACITY:_e(this,L,uE).call(this,Ce);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,bt._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,bt._defaultColor||i.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(bt._defaultOpacity*100)]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||bt._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,this.color||bt._defaultColor||i.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??bt._defaultOpacity))]]}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(_e(this,z,hf).call(this),_e(this,oe,mf).call(this)),this.isAttachedToDOM||(this.parent.add(this),_e(this,S,$l).call(this)),_e(this,_t,Zl).call(this))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,H(this,E).disconnect(),He(this,E,null),super.remove())}enableEditMode(){H(this,h)||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",H(this,d)),this.canvas.addEventListener("pointerup",H(this,m)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",H(this,d)),this.canvas.removeEventListener("pointerup",H(this,m)))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){H(this,h)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),He(this,h,!0),this.div.classList.add("disabled"),_e(this,_t,Zl).call(this,!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus())}focusin(ve){super.focusin(ve),this.enableEditMode()}canvasPointerdown(ve){ve.button!==0||!this.isInEditMode()||H(this,h)||(this.setInForeground(),ve.type!=="mouse"&&this.div.focus(),ve.stopPropagation(),this.canvas.addEventListener("pointerleave",H(this,A)),this.canvas.addEventListener("pointermove",H(this,w)),_e(this,$,dE).call(this,ve.offsetX,ve.offsetY))}canvasPointermove(ve){ve.stopPropagation(),_e(this,xe,hE).call(this,ve.offsetX,ve.offsetY)}canvasPointerup(ve){ve.button===0&&this.isInEditMode()&&this.currentPath.length!==0&&(ve.stopPropagation(),_e(this,N,i1).call(this,ve),this.setInBackground())}canvasPointerleave(ve){_e(this,N,i1).call(this,ve),this.setInBackground()}render(){if(this.div)return this.div;let ve,Ce;this.width&&(ve=this.x,Ce=this.y),super.render(),bt._l10nPromise.get("editor_ink_aria_label").then(ze=>this.div?.setAttribute("aria-label",ze));let[ue,ne,ie,Be]=_e(this,ae,pE).call(this);if(this.setAt(ue,ne,0,0),this.setDims(ie,Be),_e(this,z,hf).call(this),this.width){let[ze,Qe]=this.parent.viewportBaseDimensions;this.setAt(ve*ze,Ce*Qe,this.width*ze,this.height*Qe),He(this,M,!0),_e(this,S,$l).call(this),this.setDims(this.width*ze,this.height*Qe),_e(this,P,uo).call(this),_e(this,Jt,l1).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return _e(this,oe,mf).call(this),this.div}setDimensions(ve,Ce){let ue=Math.round(ve),ne=Math.round(Ce);if(H(this,b)===ue&&H(this,g)===ne)return;He(this,b,ue),He(this,g,ne),this.canvas.style.visibility="hidden",H(this,u)&&Math.abs(H(this,u)-ve/Ce)>.01&&(Ce=Math.ceil(ve/H(this,u)),this.setDims(ve,Ce));let[ie,Be]=this.parent.viewportBaseDimensions;this.width=ve/ie,this.height=Ce/Be,H(this,h)&&_e(this,O,o1).call(this,ve,Ce),_e(this,S,$l).call(this),_e(this,P,uo).call(this),this.canvas.style.visibility="visible"}static deserialize(ve,Ce){var mn,jt;let ue=super.deserialize(ve,Ce);ue.thickness=ve.thickness,ue.color=n.Util.makeHexColor(...ve.color),ue.opacity=ve.opacity;let[ne,ie]=Ce.pageDimensions,Be=ue.width*ne,ze=ue.height*ie,Qe=Ce.scaleFactor,Ze=ve.thickness/2;He(ue,u,Be/ze),He(ue,h,!0),He(ue,b,Math.round(Be)),He(ue,g,Math.round(ze));for(let{bezier:nt}of ve.paths){let Tn=[];ue.paths.push(Tn);let vn=Qe*(nt[0]-Ze),$n=Qe*(ze-nt[1]-Ze);for(let En=2,Ur=nt.length;En<Ur;En+=6){let Ni=Qe*(nt[En]-Ze),Hi=Qe*(ze-nt[En+1]-Ze),ni=Qe*(nt[En+2]-Ze),In=Qe*(ze-nt[En+3]-Ze),zr=Qe*(nt[En+4]-Ze),fo=Qe*(ze-nt[En+5]-Ze);Tn.push([[vn,$n],[Ni,Hi],[ni,In],[zr,fo]]),vn=zr,$n=fo}let Ht=_e(this,he,s1).call(this,Tn);ue.bezierPath2D.push(Ht)}let yt=_e(mn=ue,ke,a1).call(mn);return He(ue,f,Math.max(l,yt[2]-yt[0])),He(ue,p,Math.max(l,yt[3]-yt[1])),_e(jt=ue,O,o1).call(jt,Be,ze),ue}serialize(){if(this.isEmpty())return null;let ve=this.getRect(0,0),Ce=this.rotation%180===0?ve[3]-ve[1]:ve[2]-ve[0],ue=i.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:n.AnnotationEditorType.INK,color:ue,thickness:this.thickness,opacity:this.opacity,paths:_e(this,pe,fE).call(this,this.scaleFactor/this.parent.scaleFactor,this.translationX,this.translationY,Ce),pageIndex:this.parent.pageIndex,rect:ve,rotation:this.rotation}}},c=bt;u=new WeakMap,p=new WeakMap,f=new WeakMap,w=new WeakMap,A=new WeakMap,m=new WeakMap,d=new WeakMap,h=new WeakMap,M=new WeakMap,k=new WeakMap,E=new WeakMap,b=new WeakMap,g=new WeakMap,v=new WeakMap,y=new WeakSet,lE=function(ve){let Ce=this.thickness;this.parent.addCommands({cmd:()=>{this.thickness=ve,_e(this,_t,Zl).call(this)},undo:()=>{this.thickness=Ce,_e(this,_t,Zl).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},B=new WeakSet,cE=function(ve){let Ce=this.color;this.parent.addCommands({cmd:()=>{this.color=ve,_e(this,P,uo).call(this)},undo:()=>{this.color=Ce,_e(this,P,uo).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},L=new WeakSet,uE=function(ve){ve/=100;let Ce=this.opacity;this.parent.addCommands({cmd:()=>{this.opacity=ve,_e(this,P,uo).call(this)},undo:()=>{this.opacity=Ce,_e(this,P,uo).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},ae=new WeakSet,pE=function(){let{width:ve,height:Ce,rotation:ue}=this.parent.viewport;switch(ue){case 90:return[0,ve,ve,Ce];case 180:return[ve,Ce,ve,Ce];case 270:return[Ce,0,ve,Ce];default:return[0,0,ve,Ce]}},ee=new WeakSet,r1=function(){this.ctx.lineWidth=this.thickness*this.parent.scaleFactor/this.scaleFactor,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.miterLimit=10,this.ctx.strokeStyle=`${this.color}${(0,s.opacityToHex)(this.opacity)}`},$=new WeakSet,dE=function(ve,Ce){this.isEditing=!0,H(this,M)||(He(this,M,!0),_e(this,S,$l).call(this),this.thickness||=bt._defaultThickness,this.color||=bt._defaultColor||i.AnnotationEditor._defaultLineColor,this.opacity??=bt._defaultOpacity),this.currentPath.push([ve,Ce]),He(this,k,null),_e(this,ee,r1).call(this),this.ctx.beginPath(),this.ctx.moveTo(ve,Ce),He(this,v,()=>{H(this,v)&&(H(this,k)&&(this.isEmpty()?(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)):_e(this,P,uo).call(this),this.ctx.lineTo(...H(this,k)),He(this,k,null),this.ctx.stroke()),window.requestAnimationFrame(H(this,v)))}),window.requestAnimationFrame(H(this,v))},xe=new WeakSet,hE=function(ve,Ce){let[ue,ne]=this.currentPath.at(-1);ve===ue&&Ce===ne||(this.currentPath.push([ve,Ce]),He(this,k,[ve,Ce]))},Ue=new WeakSet,mE=function(ve,Ce){var Ze;this.ctx.closePath(),He(this,v,null),ve=Math.min(Math.max(ve,0),this.canvas.width),Ce=Math.min(Math.max(Ce,0),this.canvas.height);let[ue,ne]=this.currentPath.at(-1);(ve!==ue||Ce!==ne)&&this.currentPath.push([ve,Ce]);let ie;if(this.currentPath.length!==1)ie=(0,o.fitCurve)(this.currentPath,30,null);else{let yt=[ve,Ce];ie=[[yt,yt.slice(),yt.slice(),yt]]}let Be=_e(Ze=bt,he,s1).call(Ze,ie);this.currentPath.length=0;let ze=()=>{this.paths.push(ie),this.bezierPath2D.push(Be),this.rebuild()},Qe=()=>{this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(_e(this,z,hf).call(this),_e(this,oe,mf).call(this)),_e(this,_t,Zl).call(this))};this.parent.addCommands({cmd:ze,undo:Qe,mustExec:!0})},P=new WeakSet,uo=function(){if(this.isEmpty()){_e(this,G,ff).call(this);return}_e(this,ee,r1).call(this);let{canvas:ve,ctx:Ce}=this;Ce.setTransform(1,0,0,1,0,0),Ce.clearRect(0,0,ve.width,ve.height),_e(this,G,ff).call(this);for(let ue of this.bezierPath2D)Ce.stroke(ue)},N=new WeakSet,i1=function(ve){_e(this,Ue,mE).call(this,ve.offsetX,ve.offsetY),this.canvas.removeEventListener("pointerleave",H(this,A)),this.canvas.removeEventListener("pointermove",H(this,w)),this.parent.addToAnnotationStorage(this)},z=new WeakSet,hf=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",bt._l10nPromise.get("editor_ink_canvas_aria_label").then(ve=>this.canvas?.setAttribute("aria-label",ve)),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},oe=new WeakSet,mf=function(){He(this,E,new ResizeObserver(ve=>{let Ce=ve[0].contentRect;Ce.width&&Ce.height&&this.setDimensions(Ce.width,Ce.height)})),H(this,E).observe(this.div)},S=new WeakSet,$l=function(){if(!H(this,M))return;let[ve,Ce]=this.parent.viewportBaseDimensions;this.canvas.width=Math.ceil(this.width*ve),this.canvas.height=Math.ceil(this.height*Ce),_e(this,G,ff).call(this)},O=new WeakSet,o1=function(ve,Ce){let ue=_e(this,$e,gf).call(this),ne=(ve-ue)/H(this,f),ie=(Ce-ue)/H(this,p);this.scaleFactor=Math.min(ne,ie)},G=new WeakSet,ff=function(){let ve=_e(this,$e,gf).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+ve,this.translationY*this.scaleFactor+ve)},he=new WeakSet,s1=function(ve){let Ce=new Path2D;for(let ue=0,ne=ve.length;ue<ne;ue++){let[ie,Be,ze,Qe]=ve[ue];ue===0&&Ce.moveTo(...ie),Ce.bezierCurveTo(Be[0],Be[1],ze[0],ze[1],Qe[0],Qe[1])}return Ce},pe=new WeakSet,fE=function(ve,Ce,ue,ne){let Be=[],ze=this.thickness/2,Qe,Ze;for(let yt of this.paths){Qe=[],Ze=[];for(let mn=0,jt=yt.length;mn<jt;mn++){let[nt,Tn,vn,$n]=yt[mn],Ht=ve*(nt[0]+Ce)+ze,En=ne-ve*(nt[1]+ue)-ze,Ur=ve*(Tn[0]+Ce)+ze,Ni=ne-ve*(Tn[1]+ue)-ze,Hi=ve*(vn[0]+Ce)+ze,ni=ne-ve*(vn[1]+ue)-ze,In=ve*($n[0]+Ce)+ze,zr=ne-ve*($n[1]+ue)-ze;mn===0&&(Qe.push(Ht,En),Ze.push(Ht,En)),Qe.push(Ur,Ni,Hi,ni,In,zr),_e(this,ge,gE).call(this,Ht,En,Ur,Ni,Hi,ni,In,zr,4,Ze)}Be.push({bezier:Qe,points:Ze})}return Be},ge=new WeakSet,gE=function(ve,Ce,ue,ne,ie,Be,ze,Qe,Ze,yt){if(_e(this,Oe,xE).call(this,ve,Ce,ue,ne,ie,Be,ze,Qe)){yt.push(ze,Qe);return}for(let mn=1;mn<Ze-1;mn++){let jt=mn/Ze,nt=1-jt,Tn=jt*ve+nt*ue,vn=jt*Ce+nt*ne,$n=jt*ue+nt*ie,Ht=jt*ne+nt*Be,En=jt*ie+nt*ze,Ur=jt*Be+nt*Qe;Tn=jt*Tn+nt*$n,vn=jt*vn+nt*Ht,$n=jt*$n+nt*En,Ht=jt*Ht+nt*Ur,Tn=jt*Tn+nt*$n,vn=jt*vn+nt*Ht,yt.push(Tn,vn)}yt.push(ze,Qe)},Oe=new WeakSet,xE=function(ve,Ce,ue,ne,ie,Be,ze,Qe){let yt=(3*ue-2*ve-ze)**2,mn=(3*ne-2*Ce-Qe)**2,jt=(3*ie-ve-2*ze)**2,nt=(3*Be-Ce-2*Qe)**2;return Math.max(yt,jt)+Math.max(mn,nt)<=10},ke=new WeakSet,a1=function(){let ve=1/0,Ce=-1/0,ue=1/0,ne=-1/0;for(let ie of this.paths)for(let[Be,ze,Qe,Ze]of ie){let yt=n.Util.bezierBoundingBox(...Be,...ze,...Qe,...Ze);ve=Math.min(ve,yt[0]),ue=Math.min(ue,yt[1]),Ce=Math.max(Ce,yt[2]),ne=Math.max(ne,yt[3])}return[ve,ue,Ce,ne]},$e=new WeakSet,gf=function(){return H(this,h)?Math.ceil(this.thickness*this.parent.scaleFactor):0},_t=new WeakSet,Zl=function(ve=!1){if(this.isEmpty())return;if(!H(this,h)){_e(this,P,uo).call(this);return}let Ce=_e(this,ke,a1).call(this),ue=_e(this,$e,gf).call(this);He(this,f,Math.max(l,Ce[2]-Ce[0])),He(this,p,Math.max(l,Ce[3]-Ce[1]));let ne=Math.ceil(ue+H(this,f)*this.scaleFactor),ie=Math.ceil(ue+H(this,p)*this.scaleFactor),[Be,ze]=this.parent.viewportBaseDimensions;this.width=ne/Be,this.height=ie/ze,He(this,u,ne/ie),_e(this,Jt,l1).call(this);let Qe=this.translationX,Ze=this.translationY;this.translationX=-Ce[0],this.translationY=-Ce[1],_e(this,S,$l).call(this),_e(this,P,uo).call(this),He(this,b,ne),He(this,g,ie),this.setDims(ne,ie);let yt=ve?ue/this.scaleFactor/2:0;this.translate(Qe-this.translationX-yt,Ze-this.translationY-yt)},Jt=new WeakSet,l1=function(){let{style:ve}=this.div;H(this,u)>=1?(ve.minHeight=`${l}px`,ve.minWidth=`${Math.round(H(this,u)*l)}px`):(ve.minWidth=`${l}px`,ve.minHeight=`${Math.round(l/H(this,u))}px`)},Fe(c,he),_n(c,"_defaultColor",null),_n(c,"_defaultOpacity",1),_n(c,"_defaultThickness",1),_n(c,"_l10nPromise"),_n(c,"_type","ink"),t.InkEditor=c},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fitCurve=void 0;let n=e(26);t.fitCurve=n},r=>{function t(m,d,h){if(!Array.isArray(m))throw new TypeError("First argument should be an array");if(m.forEach(b=>{if(!Array.isArray(b)||b.some(g=>typeof g!="number")||b.length!==m[0].length)throw Error("Each point should be an array of numbers. Each point should have the same amount of numbers.")}),m=m.filter((b,g)=>g===0||!b.every((v,y)=>v===m[g-1][y])),m.length<2)return[];let M=m.length,k=f(m[1],m[0]),E=f(m[M-2],m[M-1]);return e(m,k,E,d,h)}function e(m,d,h,M,k){var b,g,v,y,V,B,D,L,J,ae,Q,ee,K;if(m.length===2)return ee=w.vectorLen(w.subtract(m[0],m[1]))/3,b=[m[0],w.addArrays(m[0],w.mulItems(d,ee)),w.addArrays(m[1],w.mulItems(h,ee)),m[1]],[b];if(g=l(m),[b,y,B]=n(m,g,g,d,h,k),y===0||y<M)return[b];if(y<M*M)for(v=g,V=y,D=B,K=0;K<20;K++){if(v=o(b,m,v),[b,y,B]=n(m,g,v,d,h,k),y<M)return[b];if(B===D){let $=y/V;if($>.9999&&$<1.0001)break}V=y,D=B}return Q=[],L=w.subtract(m[B-1],m[B+1]),L.every($=>$===0)&&(L=w.subtract(m[B-1],m[B]),[L[0],L[1]]=[-L[1],L[0]]),J=w.normalize(L),ae=w.mulItems(J,-1),Q=Q.concat(e(m.slice(0,B+1),d,J,M,k)),Q=Q.concat(e(m.slice(B),ae,h,M,k)),Q}function n(m,d,h,M,k,E){var b,g,v;return b=i(m,h,M,k,E),[g,v]=c(m,b,d),E&&E({bez:b,points:m,params:d,maxErr:g,maxPoint:v}),[b,g,v]}function i(m,d,h,M){var k,E,b,g,v,y,V,B,D,L,J,ae,Q,ee,K,$,te,xe=m[0],be=m[m.length-1];for(k=[xe,null,null,be],E=w.zeros_Xx2x2(d.length),Q=0,ee=d.length;Q<ee;Q++)$=d[Q],te=1-$,b=E[Q],b[0]=w.mulItems(h,3*$*(te*te)),b[1]=w.mulItems(M,3*te*($*$));for(g=[[0,0],[0,0]],v=[0,0],Q=0,ee=m.length;Q<ee;Q++)$=d[Q],b=E[Q],g[0][0]+=w.dot(b[0],b[0]),g[0][1]+=w.dot(b[0],b[1]),g[1][0]+=w.dot(b[0],b[1]),g[1][1]+=w.dot(b[1],b[1]),K=w.subtract(m[Q],A.q([xe,xe,be,be],$)),v[0]+=w.dot(b[0],K),v[1]+=w.dot(b[1],K);return y=g[0][0]*g[1][1]-g[1][0]*g[0][1],V=g[0][0]*v[1]-g[1][0]*v[0],B=v[0]*g[1][1]-v[1]*g[0][1],D=y===0?0:B/y,L=y===0?0:V/y,ae=w.vectorLen(w.subtract(xe,be)),J=1e-6*ae,D<J||L<J?(k[1]=w.addArrays(xe,w.mulItems(h,ae/3)),k[2]=w.addArrays(be,w.mulItems(M,ae/3))):(k[1]=w.addArrays(xe,w.mulItems(h,D)),k[2]=w.addArrays(be,w.mulItems(M,L))),k}function o(m,d,h){return h.map((M,k)=>s(m,d[k],M))}function s(m,d,h){var M=w.subtract(A.q(m,h),d),k=A.qprime(m,h),E=w.mulMatrix(M,k),b=w.sum(w.squareItems(k))+2*w.mulMatrix(M,A.qprimeprime(m,h));return b===0?h:h-E/b}function l(m){var d=[],h,M,k;return m.forEach((E,b)=>{h=b?M+w.vectorLen(w.subtract(E,k)):0,d.push(h),M=h,k=E}),d=d.map(E=>E/M),d}function c(m,d,h){var M,k,E,b,g,v,y,V;k=0,E=Math.floor(m.length/2);let B=u(d,10);for(g=0,v=m.length;g<v;g++)y=m[g],V=p(d,h[g],B,10),b=w.subtract(A.q(d,V),y),M=b[0]*b[0]+b[1]*b[1],M>k&&(k=M,E=g);return[k,E]}var u=function(m,d){for(var h,M=[0],k=m[0],E=0,b=1;b<=d;b++)h=A.q(m,b/d),E+=w.vectorLen(w.subtract(h,k)),M.push(E),k=h;return M=M.map(g=>g/E),M};function p(m,d,h,M){if(d<0)return 0;if(d>1)return 1;for(var k,E,b,g,v,y=1;y<=M;y++)if(d<=h[y]){g=(y-1)/M,b=y/M,E=h[y-1],k=h[y],v=(d-E)/(k-E)*(b-g)+g;break}return v}function f(m,d){return w.normalize(w.subtract(m,d))}class w{static zeros_Xx2x2(d){for(var h=[];d--;)h.push([0,0]);return h}static mulItems(d,h){return d.map(M=>M*h)}static mulMatrix(d,h){return d.reduce((M,k,E)=>M+k*h[E],0)}static subtract(d,h){return d.map((M,k)=>M-h[k])}static addArrays(d,h){return d.map((M,k)=>M+h[k])}static addItems(d,h){return d.map(M=>M+h)}static sum(d){return d.reduce((h,M)=>h+M)}static dot(d,h){return w.mulMatrix(d,h)}static vectorLen(d){return Math.hypot(...d)}static divItems(d,h){return d.map(M=>M/h)}static squareItems(d){return d.map(h=>h*h)}static normalize(d){return this.divItems(d,this.vectorLen(d))}}class A{static q(d,h){var M=1-h,k=w.mulItems(d[0],M*M*M),E=w.mulItems(d[1],3*M*M*h),b=w.mulItems(d[2],3*M*h*h),g=w.mulItems(d[3],h*h*h);return w.addArrays(w.addArrays(k,E),w.addArrays(b,g))}static qprime(d,h){var M=1-h,k=w.mulItems(w.subtract(d[1],d[0]),3*M*M),E=w.mulItems(w.subtract(d[2],d[1]),6*M*h),b=w.mulItems(w.subtract(d[3],d[2]),3*h*h);return w.addArrays(w.addArrays(k,E),b)}static qprimeprime(d,h){return w.addArrays(w.mulItems(w.addArrays(w.subtract(d[2],w.mulItems(d[1],2)),d[0]),6*(1-h)),w.mulItems(w.addArrays(w.subtract(d[3],w.mulItems(d[2],2)),d[1]),6*h))}}r.exports=t,r.exports.fitCubic=e,r.exports.createTangent=f},(r,t,e)=>{var P,c1,N,u1,z,p1;Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationLayer=void 0;var n=e(1),i=e(8),o=e(5),s=e(28),l=e(29);let c=1e3,u=9,p=new WeakSet;function f(se){return{width:se[2]-se[0],height:se[3]-se[1]}}class w{static create(S){switch(S.data.annotationType){case n.AnnotationType.LINK:return new m(S);case n.AnnotationType.TEXT:return new d(S);case n.AnnotationType.WIDGET:switch(S.data.fieldType){case"Tx":return new M(S);case"Btn":return S.data.radioButton?new E(S):S.data.checkBox?new k(S):new b(S);case"Ch":return new g(S)}return new h(S);case n.AnnotationType.POPUP:return new v(S);case n.AnnotationType.FREETEXT:return new V(S);case n.AnnotationType.LINE:return new B(S);case n.AnnotationType.SQUARE:return new D(S);case n.AnnotationType.CIRCLE:return new L(S);case n.AnnotationType.POLYLINE:return new J(S);case n.AnnotationType.CARET:return new Q(S);case n.AnnotationType.INK:return new ee(S);case n.AnnotationType.POLYGON:return new ae(S);case n.AnnotationType.HIGHLIGHT:return new K(S);case n.AnnotationType.UNDERLINE:return new $(S);case n.AnnotationType.SQUIGGLY:return new te(S);case n.AnnotationType.STRIKEOUT:return new xe(S);case n.AnnotationType.STAMP:return new be(S);case n.AnnotationType.FILEATTACHMENT:return new Ue(S);default:return new A(S)}}}class A{constructor(S,{isRenderable:R=!1,ignoreBorder:O=!1,createQuadrilaterals:U=!1}={}){this.isRenderable=R,this.data=S.data,this.layer=S.layer,this.page=S.page,this.viewport=S.viewport,this.linkService=S.linkService,this.downloadManager=S.downloadManager,this.imageResourcesPath=S.imageResourcesPath,this.renderForms=S.renderForms,this.svgFactory=S.svgFactory,this.annotationStorage=S.annotationStorage,this.enableScripting=S.enableScripting,this.hasJSActions=S.hasJSActions,this._fieldObjects=S.fieldObjects,this._mouseState=S.mouseState,R&&(this.container=this._createContainer(O)),U&&(this.quadrilaterals=this._createQuadrilaterals(O))}_createContainer(S=!1){let R=this.data,O=this.page,U=this.viewport,G=document.createElement("section"),{width:Z,height:he}=f(R.rect),[Pe,pe,de,ge]=U.viewBox,Se=de-Pe,Oe=ge-pe;G.setAttribute("data-annotation-id",R.id);let q=n.Util.normalizeRect([R.rect[0],O.view[3]-R.rect[1]+O.view[1],R.rect[2],O.view[3]-R.rect[3]+O.view[1]]);if(!S&&R.borderStyle.width>0){G.style.borderWidth=`${R.borderStyle.width}px`;let Ge=R.borderStyle.horizontalCornerRadius,$e=R.borderStyle.verticalCornerRadius;if(Ge>0||$e>0){let _t=`calc(${Ge}px * var(--scale-factor)) / calc(${$e}px * var(--scale-factor))`;G.style.borderRadius=_t}else if(this instanceof E){let _t=`calc(${Z}px * var(--scale-factor)) / calc(${he}px * var(--scale-factor))`;G.style.borderRadius=_t}switch(R.borderStyle.style){case n.AnnotationBorderStyleType.SOLID:G.style.borderStyle="solid";break;case n.AnnotationBorderStyleType.DASHED:G.style.borderStyle="dashed";break;case n.AnnotationBorderStyleType.BEVELED:(0,n.warn)("Unimplemented border style: beveled");break;case n.AnnotationBorderStyleType.INSET:(0,n.warn)("Unimplemented border style: inset");break;case n.AnnotationBorderStyleType.UNDERLINE:G.style.borderBottomStyle="solid";break;default:break}let it=R.borderColor||null;it?G.style.borderColor=n.Util.makeHexColor(it[0]|0,it[1]|0,it[2]|0):G.style.borderWidth=0}G.style.left=`${100*(q[0]-Pe)/Se}%`,G.style.top=`${100*(q[1]-pe)/Oe}%`;let{rotation:ke}=R;return R.hasOwnCanvas||ke===0?(G.style.width=`${100*Z/Se}%`,G.style.height=`${100*he/Oe}%`):this.setRotation(ke,G),G}setRotation(S,R=this.container){let[O,U,G,Z]=this.viewport.viewBox,he=G-O,Pe=Z-U,{width:pe,height:de}=f(this.data.rect),ge,Se;S%180===0?(ge=100*pe/he,Se=100*de/Pe):(ge=100*de/he,Se=100*pe/Pe),R.style.width=`${ge}%`,R.style.height=`${Se}%`,R.setAttribute("data-main-rotation",(360-S)%360)}get _commonActions(){let S=(R,O,U)=>{let G=U.detail[R];U.target.style[O]=s.ColorConverters[`${G[0]}_HTML`](G.slice(1))};return(0,n.shadow)(this,"_commonActions",{display:R=>{let O=R.detail.display%2===1;this.container.style.visibility=O?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:O,print:R.detail.display===0||R.detail.display===3})},print:R=>{this.annotationStorage.setValue(this.data.id,{print:R.detail.print})},hidden:R=>{this.container.style.visibility=R.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:R.detail.hidden})},focus:R=>{setTimeout(()=>R.target.focus({preventScroll:!1}),0)},userName:R=>{R.target.title=R.detail.userName},readonly:R=>{R.detail.readonly?R.target.setAttribute("readonly",""):R.target.removeAttribute("readonly")},required:R=>{this._setRequired(R.target,R.detail.required)},bgColor:R=>{S("bgColor","backgroundColor",R)},fillColor:R=>{S("fillColor","backgroundColor",R)},fgColor:R=>{S("fgColor","color",R)},textColor:R=>{S("textColor","color",R)},borderColor:R=>{S("borderColor","borderColor",R)},strokeColor:R=>{S("strokeColor","borderColor",R)},rotation:R=>{let O=R.detail.rotation;this.setRotation(O),this.annotationStorage.setValue(this.data.id,{rotation:O})}})}_dispatchEventFromSandbox(S,R){let O=this._commonActions;for(let U of Object.keys(R.detail)){let G=S[U]||O[U];G&&G(R)}}_setDefaultPropertiesFromJS(S){if(!this.enableScripting)return;let R=this.annotationStorage.getRawValue(this.data.id);if(!R)return;let O=this._commonActions;for(let[U,G]of Object.entries(R)){let Z=O[U];if(Z){let he={detail:{[U]:G},target:S};Z(he),delete R[U]}}}_createQuadrilaterals(S=!1){if(!this.data.quadPoints)return null;let R=[],O=this.data.rect;for(let U of this.data.quadPoints)this.data.rect=[U[2].x,U[2].y,U[1].x,U[1].y],R.push(this._createContainer(S));return this.data.rect=O,R}_createPopup(S,R){let O=this.container;this.quadrilaterals&&(S=S||this.quadrilaterals,O=this.quadrilaterals[0]),S||(S=document.createElement("div"),S.className="popupTriggerArea",O.append(S));let G=new y({container:O,trigger:S,color:R.color,titleObj:R.titleObj,modificationDate:R.modificationDate,contentsObj:R.contentsObj,richText:R.richText,hideWrapper:!0}).render();G.style.left="100%",O.append(G)}_renderQuadrilaterals(S){for(let R of this.quadrilaterals)R.className=S;return this.quadrilaterals}render(){(0,n.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(S,R=null){let O=[];if(this._fieldObjects){let U=this._fieldObjects[S];if(U)for(let{page:G,id:Z,exportValues:he}of U){if(G===-1||Z===R)continue;let Pe=typeof he=="string"?he:null,pe=document.querySelector(`[data-element-id="${Z}"]`);if(pe&&!p.has(pe)){(0,n.warn)(`_getElementsByName - element not allowed: ${Z}`);continue}O.push({id:Z,exportValue:Pe,domElement:pe})}return O}for(let U of document.getElementsByName(S)){let{id:G,exportValue:Z}=U;G!==R&&p.has(U)&&O.push({id:G,exportValue:Z,domElement:U})}return O}static get platform(){let S=typeof navigator<"u"?navigator.platform:"";return(0,n.shadow)(this,"platform",{isWin:S.includes("Win"),isMac:S.includes("Mac")})}}class m extends A{constructor(S,R=null){super(S,{isRenderable:!0,ignoreBorder:!!R?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=S.data.isTooltipOnly}render(){let{data:S,linkService:R}=this,O=document.createElement("a");O.setAttribute("data-element-id",S.id);let U=!1;return S.url?(R.addLinkAttributes(O,S.url,S.newWindow),U=!0):S.action?(this._bindNamedAction(O,S.action),U=!0):S.dest?(this._bindLink(O,S.dest),U=!0):(S.actions&&(S.actions.Action||S.actions["Mouse Up"]||S.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(O,S),U=!0),S.resetForm?(this._bindResetFormAction(O,S.resetForm),U=!0):this.isTooltipOnly&&!U&&(this._bindLink(O,""),U=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((G,Z)=>{let he=Z===0?O:O.cloneNode();return G.append(he),G}):(this.container.className="linkAnnotation",U&&this.container.append(O),this.container)}_bindLink(S,R){S.href=this.linkService.getDestinationHash(R),S.onclick=()=>(R&&this.linkService.goToDestination(R),!1),(R||R==="")&&(S.className="internalLink")}_bindNamedAction(S,R){S.href=this.linkService.getAnchorUrl(""),S.onclick=()=>(this.linkService.executeNamedAction(R),!1),S.className="internalLink"}_bindJSAction(S,R){S.href=this.linkService.getAnchorUrl("");let O=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let U of Object.keys(R.actions)){let G=O.get(U);G&&(S[G]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:R.id,name:U}}),!1))}S.onclick||(S.onclick=()=>!1),S.className="internalLink"}_bindResetFormAction(S,R){let O=S.onclick;if(O||(S.href=this.linkService.getAnchorUrl("")),S.className="internalLink",!this._fieldObjects){(0,n.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),O||(S.onclick=()=>!1);return}S.onclick=()=>{O&&O();let{fields:U,refs:G,include:Z}=R,he=[];if(U.length!==0||G.length!==0){let de=new Set(G);for(let ge of U){let Se=this._fieldObjects[ge]||[];for(let{id:Oe}of Se)de.add(Oe)}for(let ge of Object.values(this._fieldObjects))for(let Se of ge)de.has(Se.id)===Z&&he.push(Se)}else for(let de of Object.values(this._fieldObjects))he.push(...de);let Pe=this.annotationStorage,pe=[];for(let de of he){let{id:ge}=de;switch(pe.push(ge),de.type){case"text":{let Oe=de.defaultValue||"";Pe.setValue(ge,{value:Oe});break}case"checkbox":case"radiobutton":{let Oe=de.defaultValue===de.exportValues;Pe.setValue(ge,{value:Oe});break}case"combobox":case"listbox":{let Oe=de.defaultValue||"";Pe.setValue(ge,{value:Oe});break}default:continue}let Se=document.querySelector(`[data-element-id="${ge}"]`);if(Se){if(!p.has(Se)){(0,n.warn)(`_bindResetFormAction - element not allowed: ${ge}`);continue}}else continue;Se.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:pe,name:"ResetForm"}}),!1}}}class d extends A{constructor(S){let R=!!(S.data.hasPopup||S.data.titleObj?.str||S.data.contentsObj?.str||S.data.richText?.str);super(S,{isRenderable:R})}render(){this.container.className="textAnnotation";let S=document.createElement("img");return S.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",S.alt="[{{type}} Annotation]",S.dataset.l10nId="text_annotation_type",S.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(S,this.data),this.container.append(S),this.container}}class h extends A{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(S){let{isWin:R,isMac:O}=A.platform;return R&&S.ctrlKey||O&&S.metaKey}_setEventListener(S,R,O,U){R.includes("mouse")?S.addEventListener(R,G=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:O,value:U(G),shift:G.shiftKey,modifier:this._getKeyModifier(G)}})}):S.addEventListener(R,G=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:O,value:U(G)}})})}_setEventListeners(S,R,O){for(let[U,G]of R)(G==="Action"||this.data.actions?.[G])&&this._setEventListener(S,U,G,O)}_setBackgroundColor(S){let R=this.data.backgroundColor||null;S.style.backgroundColor=R===null?"transparent":n.Util.makeHexColor(R[0],R[1],R[2])}_setTextStyle(S){let R=["left","center","right"],{fontColor:O}=this.data.defaultAppearanceData,U=this.data.defaultAppearanceData.fontSize||u,G=S.style,Z;if(this.data.multiLine){let he=Math.abs(this.data.rect[3]-this.data.rect[1]),Pe=Math.round(he/(n.LINE_FACTOR*U))||1,pe=he/Pe;Z=Math.min(U,Math.round(pe/n.LINE_FACTOR))}else{let he=Math.abs(this.data.rect[3]-this.data.rect[1]);Z=Math.min(U,Math.round(he/n.LINE_FACTOR))}G.fontSize=`calc(${Z}px * var(--scale-factor))`,G.color=n.Util.makeHexColor(O[0],O[1],O[2]),this.data.textAlignment!==null&&(G.textAlign=R[this.data.textAlignment])}_setRequired(S,R){R?S.setAttribute("required",!0):S.removeAttribute("required"),S.setAttribute("aria-required",R)}}class M extends h{constructor(S){let R=S.renderForms||!S.data.hasAppearance&&!!S.data.fieldValue;super(S,{isRenderable:R})}setPropertyOnSiblings(S,R,O,U){let G=this.annotationStorage;for(let Z of this._getElementsByName(S.name,S.id))Z.domElement&&(Z.domElement[R]=O),G.setValue(Z.id,{[U]:O})}render(){let S=this.annotationStorage,R=this.data.id;this.container.className="textWidgetAnnotation";let O=null;if(this.renderForms){let U=S.getValue(R,{value:this.data.fieldValue}),G=U.formattedValue||U.value||"",Z=S.getValue(R,{charLimit:this.data.maxLen}).charLimit;Z&&G.length>Z&&(G=G.slice(0,Z));let he={userValue:G,formattedValue:null,valueOnFocus:""};this.data.multiLine?(O=document.createElement("textarea"),O.textContent=G,this.data.doNotScroll&&(O.style.overflowY="hidden")):(O=document.createElement("input"),O.type="text",O.setAttribute("value",G),this.data.doNotScroll&&(O.style.overflowX="hidden")),p.add(O),O.setAttribute("data-element-id",R),O.disabled=this.data.readOnly,O.name=this.data.fieldName,O.tabIndex=c,this._setRequired(O,this.data.required),Z&&(O.maxLength=Z),O.addEventListener("input",pe=>{S.setValue(R,{value:pe.target.value}),this.setPropertyOnSiblings(O,"value",pe.target.value,"value")}),O.addEventListener("resetform",pe=>{let de=this.data.defaultFieldValue??"";O.value=he.userValue=de,he.formattedValue=null});let Pe=pe=>{let{formattedValue:de}=he;de!=null&&(pe.target.value=de),pe.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){O.addEventListener("focus",de=>{he.userValue&&(de.target.value=he.userValue),he.valueOnFocus=de.target.value}),O.addEventListener("updatefromsandbox",de=>{let ge={value(Se){he.userValue=Se.detail.value??"",S.setValue(R,{value:he.userValue.toString()}),Se.target.value=he.userValue},formattedValue(Se){let{formattedValue:Oe}=Se.detail;he.formattedValue=Oe,Oe!=null&&Se.target!==document.activeElement&&(Se.target.value=Oe),S.setValue(R,{formattedValue:Oe})},selRange(Se){Se.target.setSelectionRange(...Se.detail.selRange)},charLimit:Se=>{let{charLimit:Oe}=Se.detail,{target:q}=Se;if(Oe===0){q.removeAttribute("maxLength");return}q.setAttribute("maxLength",Oe);let ke=he.userValue;!ke||ke.length<=Oe||(ke=ke.slice(0,Oe),q.value=he.userValue=ke,S.setValue(R,{value:ke}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:R,name:"Keystroke",value:ke,willCommit:!0,commitKey:1,selStart:q.selectionStart,selEnd:q.selectionEnd}}))}};this._dispatchEventFromSandbox(ge,de)}),O.addEventListener("keydown",de=>{let ge=-1;if(de.key==="Escape"?ge=0:de.key==="Enter"?ge=2:de.key==="Tab"&&(ge=3),ge===-1)return;let{value:Se}=de.target;he.valueOnFocus!==Se&&(he.userValue=Se,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:R,name:"Keystroke",value:Se,willCommit:!0,commitKey:ge,selStart:de.target.selectionStart,selEnd:de.target.selectionEnd}}))});let pe=Pe;Pe=null,O.addEventListener("blur",de=>{let{value:ge}=de.target;he.userValue=ge,this._mouseState.isDown&&he.valueOnFocus!==ge&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:R,name:"Keystroke",value:ge,willCommit:!0,commitKey:1,selStart:de.target.selectionStart,selEnd:de.target.selectionEnd}}),pe(de)}),this.data.actions?.Keystroke&&O.addEventListener("beforeinput",de=>{let{data:ge,target:Se}=de,{value:Oe,selectionStart:q,selectionEnd:ke}=Se,Ge=q,$e=ke;switch(de.inputType){case"deleteWordBackward":{let it=Oe.substring(0,q).match(/\w*[^\w]*$/);it&&(Ge-=it[0].length);break}case"deleteWordForward":{let it=Oe.substring(q).match(/^[^\w]*\w*/);it&&($e+=it[0].length);break}case"deleteContentBackward":q===ke&&(Ge-=1);break;case"deleteContentForward":q===ke&&($e+=1);break}de.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:R,name:"Keystroke",value:Oe,change:ge||"",willCommit:!1,selStart:Ge,selEnd:$e}})}),this._setEventListeners(O,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],de=>de.target.value)}if(Pe&&O.addEventListener("blur",Pe),this.data.comb){let de=(this.data.rect[2]-this.data.rect[0])/Z;O.classList.add("comb"),O.style.letterSpacing=`calc(${de}px * var(--scale-factor) - 1ch)`}}else O=document.createElement("div"),O.textContent=this.data.fieldValue,O.style.verticalAlign="middle",O.style.display="table-cell";return this._setTextStyle(O),this._setBackgroundColor(O),this._setDefaultPropertiesFromJS(O),this.container.append(O),this.container}}class k extends h{constructor(S){super(S,{isRenderable:S.renderForms})}render(){let S=this.annotationStorage,R=this.data,O=R.id,U=S.getValue(O,{value:R.exportValue===R.fieldValue}).value;typeof U=="string"&&(U=U!=="Off",S.setValue(O,{value:U})),this.container.className="buttonWidgetAnnotation checkBox";let G=document.createElement("input");return p.add(G),G.setAttribute("data-element-id",O),G.disabled=R.readOnly,this._setRequired(G,this.data.required),G.type="checkbox",G.name=R.fieldName,U&&G.setAttribute("checked",!0),G.setAttribute("exportValue",R.exportValue),G.tabIndex=c,G.addEventListener("change",Z=>{let{name:he,checked:Pe}=Z.target;for(let pe of this._getElementsByName(he,O)){let de=Pe&&pe.exportValue===R.exportValue;pe.domElement&&(pe.domElement.checked=de),S.setValue(pe.id,{value:de})}S.setValue(O,{value:Pe})}),G.addEventListener("resetform",Z=>{let he=R.defaultFieldValue||"Off";Z.target.checked=he===R.exportValue}),this.enableScripting&&this.hasJSActions&&(G.addEventListener("updatefromsandbox",Z=>{let he={value(Pe){Pe.target.checked=Pe.detail.value!=="Off",S.setValue(O,{value:Pe.target.checked})}};this._dispatchEventFromSandbox(he,Z)}),this._setEventListeners(G,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Z=>Z.target.checked)),this._setBackgroundColor(G),this._setDefaultPropertiesFromJS(G),this.container.append(G),this.container}}class E extends h{constructor(S){super(S,{isRenderable:S.renderForms})}render(){this.container.className="buttonWidgetAnnotation radioButton";let S=this.annotationStorage,R=this.data,O=R.id,U=S.getValue(O,{value:R.fieldValue===R.buttonValue}).value;typeof U=="string"&&(U=U!==R.buttonValue,S.setValue(O,{value:U}));let G=document.createElement("input");if(p.add(G),G.setAttribute("data-element-id",O),G.disabled=R.readOnly,this._setRequired(G,this.data.required),G.type="radio",G.name=R.fieldName,U&&G.setAttribute("checked",!0),G.tabIndex=c,G.addEventListener("change",Z=>{let{name:he,checked:Pe}=Z.target;for(let pe of this._getElementsByName(he,O))S.setValue(pe.id,{value:!1});S.setValue(O,{value:Pe})}),G.addEventListener("resetform",Z=>{let he=R.defaultFieldValue;Z.target.checked=he!=null&&he===R.buttonValue}),this.enableScripting&&this.hasJSActions){let Z=R.buttonValue;G.addEventListener("updatefromsandbox",he=>{let Pe={value:pe=>{let de=Z===pe.detail.value;for(let ge of this._getElementsByName(pe.target.name)){let Se=de&&ge.id===O;ge.domElement&&(ge.domElement.checked=Se),S.setValue(ge.id,{value:Se})}}};this._dispatchEventFromSandbox(Pe,he)}),this._setEventListeners(G,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],he=>he.target.checked)}return this._setBackgroundColor(G),this._setDefaultPropertiesFromJS(G),this.container.append(G),this.container}}class b extends m{constructor(S){super(S,{ignoreBorder:S.data.hasAppearance})}render(){let S=super.render();S.className="buttonWidgetAnnotation pushButton",this.data.alternativeText&&(S.title=this.data.alternativeText);let R=S.lastChild;return this.enableScripting&&this.hasJSActions&&R&&(this._setDefaultPropertiesFromJS(R),R.addEventListener("updatefromsandbox",O=>{this._dispatchEventFromSandbox({},O)})),S}}class g extends h{constructor(S){super(S,{isRenderable:S.renderForms})}render(){this.container.className="choiceWidgetAnnotation";let S=this.annotationStorage,R=this.data.id,O=S.getValue(R,{value:this.data.fieldValue}),U=document.createElement("select");p.add(U),U.setAttribute("data-element-id",R),U.disabled=this.data.readOnly,this._setRequired(U,this.data.required),U.name=this.data.fieldName,U.tabIndex=c;let G=this.data.combo&&this.data.options.length>0;this.data.combo||(U.size=this.data.options.length,this.data.multiSelect&&(U.multiple=!0)),U.addEventListener("resetform",pe=>{let de=this.data.defaultFieldValue;for(let ge of U.options)ge.selected=ge.value===de});for(let pe of this.data.options){let de=document.createElement("option");de.textContent=pe.displayValue,de.value=pe.exportValue,O.value.includes(pe.exportValue)&&(de.setAttribute("selected",!0),G=!1),U.append(de)}let Z=null;if(G){let pe=document.createElement("option");pe.value=" ",pe.setAttribute("hidden",!0),pe.setAttribute("selected",!0),U.prepend(pe),Z=()=>{pe.remove(),U.removeEventListener("input",Z),Z=null},U.addEventListener("input",Z)}let he=(pe,de)=>{let ge=de?"value":"textContent",Se=pe.target.options;return pe.target.multiple?Array.prototype.filter.call(Se,Oe=>Oe.selected).map(Oe=>Oe[ge]):Se.selectedIndex===-1?null:Se[Se.selectedIndex][ge]},Pe=pe=>{let de=pe.target.options;return Array.prototype.map.call(de,ge=>({displayValue:ge.textContent,exportValue:ge.value}))};return this.enableScripting&&this.hasJSActions?(U.addEventListener("updatefromsandbox",pe=>{let de={value(ge){Z?.();let Se=ge.detail.value,Oe=new Set(Array.isArray(Se)?Se:[Se]);for(let q of U.options)q.selected=Oe.has(q.value);S.setValue(R,{value:he(ge,!0)})},multipleSelection(ge){U.multiple=!0},remove(ge){let Se=U.options,Oe=ge.detail.remove;Se[Oe].selected=!1,U.remove(Oe),Se.length>0&&Array.prototype.findIndex.call(Se,ke=>ke.selected)===-1&&(Se[0].selected=!0),S.setValue(R,{value:he(ge,!0),items:Pe(ge)})},clear(ge){for(;U.length!==0;)U.remove(0);S.setValue(R,{value:null,items:[]})},insert(ge){let{index:Se,displayValue:Oe,exportValue:q}=ge.detail.insert,ke=U.children[Se],Ge=document.createElement("option");Ge.textContent=Oe,Ge.value=q,ke?ke.before(Ge):U.append(Ge),S.setValue(R,{value:he(ge,!0),items:Pe(ge)})},items(ge){let{items:Se}=ge.detail;for(;U.length!==0;)U.remove(0);for(let Oe of Se){let{displayValue:q,exportValue:ke}=Oe,Ge=document.createElement("option");Ge.textContent=q,Ge.value=ke,U.append(Ge)}U.options.length>0&&(U.options[0].selected=!0),S.setValue(R,{value:he(ge,!0),items:Pe(ge)})},indices(ge){let Se=new Set(ge.detail.indices);for(let Oe of ge.target.options)Oe.selected=Se.has(Oe.index);S.setValue(R,{value:he(ge,!0)})},editable(ge){ge.target.disabled=!ge.detail.editable}};this._dispatchEventFromSandbox(de,pe)}),U.addEventListener("input",pe=>{let de=he(pe,!0),ge=he(pe,!1);S.setValue(R,{value:de}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:R,name:"Keystroke",value:ge,changeEx:de,willCommit:!0,commitKey:1,keyDown:!1}})}),this._setEventListeners(U,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"]],pe=>pe.target.checked)):U.addEventListener("input",function(pe){S.setValue(R,{value:he(pe,!0)})}),this.data.combo&&this._setTextStyle(U),this._setBackgroundColor(U),this._setDefaultPropertiesFromJS(U),this.container.append(U),this.container}}class v extends A{constructor(S){let R=!!(S.data.titleObj?.str||S.data.contentsObj?.str||S.data.richText?.str);super(S,{isRenderable:R})}render(){let S=["Line","Square","Circle","PolyLine","Polygon","Ink"];if(this.container.className="popupAnnotation",S.includes(this.data.parentType))return this.container;let R=`[data-annotation-id="${this.data.parentId}"]`,O=this.layer.querySelectorAll(R);if(O.length===0)return this.container;let U=new y({container:this.container,trigger:Array.from(O),color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText}),G=this.page,Z=n.Util.normalizeRect([this.data.parentRect[0],G.view[3]-this.data.parentRect[1]+G.view[1],this.data.parentRect[2],G.view[3]-this.data.parentRect[3]+G.view[1]]),he=Z[0]+this.data.parentRect[2]-this.data.parentRect[0],Pe=Z[1],[pe,de,ge,Se]=this.viewport.viewBox,Oe=ge-pe,q=Se-de;return this.container.style.left=`${100*(he-pe)/Oe}%`,this.container.style.top=`${100*(Pe-de)/q}%`,this.container.append(U.render()),this.container}}class y{constructor(S){this.container=S.container,this.trigger=S.trigger,this.color=S.color,this.titleObj=S.titleObj,this.modificationDate=S.modificationDate,this.contentsObj=S.contentsObj,this.richText=S.richText,this.hideWrapper=S.hideWrapper||!1,this.pinned=!1}render(){let R=document.createElement("div");R.className="popupWrapper",this.hideElement=this.hideWrapper?R:this.container,this.hideElement.hidden=!0;let O=document.createElement("div");O.className="popup";let U=this.color;if(U){let he=.7*(255-U[0])+U[0],Pe=.7*(255-U[1])+U[1],pe=.7*(255-U[2])+U[2];O.style.backgroundColor=n.Util.makeHexColor(he|0,Pe|0,pe|0)}let G=document.createElement("h1");G.dir=this.titleObj.dir,G.textContent=this.titleObj.str,O.append(G);let Z=i.PDFDateString.toDateObject(this.modificationDate);if(Z){let he=document.createElement("span");he.className="popupDate",he.textContent="{{date}}, {{time}}",he.dataset.l10nId="annotation_date_string",he.dataset.l10nArgs=JSON.stringify({date:Z.toLocaleDateString(),time:Z.toLocaleTimeString()}),O.append(he)}if(this.richText?.str&&(!this.contentsObj?.str||this.contentsObj.str===this.richText.str))l.XfaLayer.render({xfaHtml:this.richText.html,intent:"richText",div:O}),O.lastChild.className="richText popupContent";else{let he=this._formatContents(this.contentsObj);O.append(he)}Array.isArray(this.trigger)||(this.trigger=[this.trigger]);for(let he of this.trigger)he.addEventListener("click",this._toggle.bind(this)),he.addEventListener("mouseover",this._show.bind(this,!1)),he.addEventListener("mouseout",this._hide.bind(this,!1));return O.addEventListener("click",this._hide.bind(this,!0)),R.append(O),R}_formatContents({str:S,dir:R}){let O=document.createElement("p");O.className="popupContent",O.dir=R;let U=S.split(/(?:\r\n?|\n)/);for(let G=0,Z=U.length;G<Z;++G){let he=U[G];O.append(document.createTextNode(he)),G<Z-1&&O.append(document.createElement("br"))}return O}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(S=!1){S&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex=parseInt(this.container.style.zIndex)+1e3)}_hide(S=!0){S&&(this.pinned=!1),!this.hideElement.hidden&&!this.pinned&&(this.hideElement.hidden=!0,this.container.style.zIndex=parseInt(this.container.style.zIndex)-1e3)}}class V extends A{constructor(S){let R=!!(S.data.hasPopup||S.data.titleObj?.str||S.data.contentsObj?.str||S.data.richText?.str);super(S,{isRenderable:R,ignoreBorder:!0}),this.textContent=S.data.textContent}render(){if(this.container.className="freeTextAnnotation",this.textContent){let S=document.createElement("div");S.className="annotationTextContent",S.setAttribute("role","comment");for(let R of this.textContent){let O=document.createElement("span");O.textContent=R,S.append(O)}this.container.append(S)}return this.data.hasPopup||this._createPopup(null,this.data),this.container}}class B extends A{constructor(S){let R=!!(S.data.hasPopup||S.data.titleObj?.str||S.data.contentsObj?.str||S.data.richText?.str);super(S,{isRenderable:R,ignoreBorder:!0})}render(){this.container.className="lineAnnotation";let S=this.data,{width:R,height:O}=f(S.rect),U=this.svgFactory.create(R,O,!0),G=this.svgFactory.createElement("svg:line");return G.setAttribute("x1",S.rect[2]-S.lineCoordinates[0]),G.setAttribute("y1",S.rect[3]-S.lineCoordinates[1]),G.setAttribute("x2",S.rect[2]-S.lineCoordinates[2]),G.setAttribute("y2",S.rect[3]-S.lineCoordinates[3]),G.setAttribute("stroke-width",S.borderStyle.width||1),G.setAttribute("stroke","transparent"),G.setAttribute("fill","transparent"),U.append(G),this.container.append(U),this._createPopup(G,S),this.container}}class D extends A{constructor(S){let R=!!(S.data.hasPopup||S.data.titleObj?.str||S.data.contentsObj?.str||S.data.richText?.str);super(S,{isRenderable:R,ignoreBorder:!0})}render(){this.container.className="squareAnnotation";let S=this.data,{width:R,height:O}=f(S.rect),U=this.svgFactory.create(R,O,!0),G=S.borderStyle.width,Z=this.svgFactory.createElement("svg:rect");return Z.setAttribute("x",G/2),Z.setAttribute("y",G/2),Z.setAttribute("width",R-G),Z.setAttribute("height",O-G),Z.setAttribute("stroke-width",G||1),Z.setAttribute("stroke","transparent"),Z.setAttribute("fill","transparent"),U.append(Z),this.container.append(U),this._createPopup(Z,S),this.container}}class L extends A{constructor(S){let R=!!(S.data.hasPopup||S.data.titleObj?.str||S.data.contentsObj?.str||S.data.richText?.str);super(S,{isRenderable:R,ignoreBorder:!0})}render(){this.container.className="circleAnnotation";let S=this.data,{width:R,height:O}=f(S.rect),U=this.svgFactory.create(R,O,!0),G=S.borderStyle.width,Z=this.svgFactory.createElement("svg:ellipse");return Z.setAttribute("cx",R/2),Z.setAttribute("cy",O/2),Z.setAttribute("rx",R/2-G/2),Z.setAttribute("ry",O/2-G/2),Z.setAttribute("stroke-width",G||1),Z.setAttribute("stroke","transparent"),Z.setAttribute("fill","transparent"),U.append(Z),this.container.append(U),this._createPopup(Z,S),this.container}}class J extends A{constructor(S){let R=!!(S.data.hasPopup||S.data.titleObj?.str||S.data.contentsObj?.str||S.data.richText?.str);super(S,{isRenderable:R,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;let S=this.data,{width:R,height:O}=f(S.rect),U=this.svgFactory.create(R,O,!0),G=[];for(let he of S.vertices){let Pe=he.x-S.rect[0],pe=S.rect[3]-he.y;G.push(Pe+","+pe)}G=G.join(" ");let Z=this.svgFactory.createElement(this.svgElementName);return Z.setAttribute("points",G),Z.setAttribute("stroke-width",S.borderStyle.width||1),Z.setAttribute("stroke","transparent"),Z.setAttribute("fill","transparent"),U.append(Z),this.container.append(U),this._createPopup(Z,S),this.container}}class ae extends J{constructor(S){super(S),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Q extends A{constructor(S){let R=!!(S.data.hasPopup||S.data.titleObj?.str||S.data.contentsObj?.str||S.data.richText?.str);super(S,{isRenderable:R,ignoreBorder:!0})}render(){return this.container.className="caretAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class ee extends A{constructor(S){let R=!!(S.data.hasPopup||S.data.titleObj?.str||S.data.contentsObj?.str||S.data.richText?.str);super(S,{isRenderable:R,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;let S=this.data,{width:R,height:O}=f(S.rect),U=this.svgFactory.create(R,O,!0);for(let G of S.inkLists){let Z=[];for(let Pe of G){let pe=Pe.x-S.rect[0],de=S.rect[3]-Pe.y;Z.push(`${pe},${de}`)}Z=Z.join(" ");let he=this.svgFactory.createElement(this.svgElementName);he.setAttribute("points",Z),he.setAttribute("stroke-width",S.borderStyle.width||1),he.setAttribute("stroke","transparent"),he.setAttribute("fill","transparent"),this._createPopup(he,S),U.append(he)}return this.container.append(U),this.container}}class K extends A{constructor(S){let R=!!(S.data.hasPopup||S.data.titleObj?.str||S.data.contentsObj?.str||S.data.richText?.str);super(S,{isRenderable:R,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.className="highlightAnnotation",this.container)}}class $ extends A{constructor(S){let R=!!(S.data.hasPopup||S.data.titleObj?.str||S.data.contentsObj?.str||S.data.richText?.str);super(S,{isRenderable:R,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.className="underlineAnnotation",this.container)}}class te extends A{constructor(S){let R=!!(S.data.hasPopup||S.data.titleObj?.str||S.data.contentsObj?.str||S.data.richText?.str);super(S,{isRenderable:R,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.className="squigglyAnnotation",this.container)}}class xe extends A{constructor(S){let R=!!(S.data.hasPopup||S.data.titleObj?.str||S.data.contentsObj?.str||S.data.richText?.str);super(S,{isRenderable:R,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.className="strikeoutAnnotation",this.container)}}class be extends A{constructor(S){let R=!!(S.data.hasPopup||S.data.titleObj?.str||S.data.contentsObj?.str||S.data.richText?.str);super(S,{isRenderable:R,ignoreBorder:!0})}render(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class Ue extends A{constructor(S){super(S,{isRenderable:!0});let{filename:R,content:O}=this.data.file;this.filename=(0,i.getFilenameFromUrl)(R),this.content=O,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:R,content:O})}render(){this.container.className="fileAttachmentAnnotation";let S=document.createElement("div");return S.className="popupTriggerArea",S.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&(this.data.titleObj?.str||this.data.contentsObj?.str||this.data.richText)&&this._createPopup(S,this.data),this.container.append(S),this.container}_download(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)}}let oe=class{static render(S){var he,Pe;let{annotations:R,div:O,viewport:U,accessibilityManager:G}=S;_e(this,N,u1).call(this,O,U);let Z=0;for(let pe of R){if(pe.annotationType!==n.AnnotationType.POPUP){let{width:ge,height:Se}=f(pe.rect);if(ge<=0||Se<=0)continue}let de=w.create({data:pe,layer:O,page:S.page,viewport:U,linkService:S.linkService,downloadManager:S.downloadManager,imageResourcesPath:S.imageResourcesPath||"",renderForms:S.renderForms!==!1,svgFactory:new i.DOMSVGFactory,annotationStorage:S.annotationStorage||new o.AnnotationStorage,enableScripting:S.enableScripting,hasJSActions:S.hasJSActions,fieldObjects:S.fieldObjects,mouseState:S.mouseState||{isDown:!1}});if(de.isRenderable){let ge=de.render();if(pe.hidden&&(ge.style.visibility="hidden"),Array.isArray(ge))for(let Se of ge)Se.style.zIndex=Z++,_e(he=oe,P,c1).call(he,Se,pe.id,O,G);else ge.style.zIndex=Z++,de instanceof v?O.prepend(ge):_e(Pe=oe,P,c1).call(Pe,ge,pe.id,O,G)}}_e(this,z,p1).call(this,O,S.annotationCanvasMap)}static update(S){let{annotationCanvasMap:R,div:O,viewport:U}=S;_e(this,N,u1).call(this,O,U),_e(this,z,p1).call(this,O,R),O.hidden=!1}},Y=oe;P=new WeakSet,c1=function(S,R,O,U){let G=S.firstChild||S;G.id=`${i.AnnotationPrefix}${R}`,O.append(S),U?.moveElementInDOM(O,S,G,!1)},N=new WeakSet,u1=function(S,{width:R,height:O,rotation:U}){let{style:G}=S,Z=U%180!==0,he=Math.floor(R)+"px",Pe=Math.floor(O)+"px";G.width=Z?Pe:he,G.height=Z?he:Pe,S.setAttribute("data-main-rotation",U)},z=new WeakSet,p1=function(S,R){if(R){for(let[O,U]of R){let G=S.querySelector(`[data-annotation-id="${O}"]`);if(!G)continue;let{firstChild:Z}=G;Z?Z.nodeName==="CANVAS"?Z.replaceWith(U):Z.before(U):G.append(U)}R.clear()}},Fe(Y,P),Fe(Y,N),Fe(Y,z),t.AnnotationLayer=Y},(r,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorConverters=void 0;function e(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}class n{static CMYK_G([o,s,l,c]){return["G",1-Math.min(1,.3*o+.59*l+.11*s+c)]}static G_CMYK([o]){return["CMYK",0,0,0,1-o]}static G_RGB([o]){return["RGB",o,o,o]}static G_HTML([o]){let s=e(o);return`#${s}${s}${s}`}static RGB_G([o,s,l]){return["G",.3*o+.59*s+.11*l]}static RGB_HTML([o,s,l]){let c=e(o),u=e(s),p=e(l);return`#${c}${u}${p}`}static T_HTML(){return"#00000000"}static CMYK_RGB([o,s,l,c]){return["RGB",1-Math.min(1,o+c),1-Math.min(1,l+c),1-Math.min(1,s+c)]}static CMYK_HTML(o){let s=this.CMYK_RGB(o).slice(1);return this.RGB_HTML(s)}static RGB_CMYK([o,s,l]){let c=1-o,u=1-s,p=1-l,f=Math.min(c,u,p);return["CMYK",c,u,p,f]}}t.ColorConverters=n},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaLayer=void 0;var n=e(20);class i{static setupStorage(s,l,c,u,p){let f=u.getValue(l,{value:null});switch(c.name){case"textarea":if(f.value!==null&&(s.textContent=f.value),p==="print")break;s.addEventListener("input",w=>{u.setValue(l,{value:w.target.value})});break;case"input":if(c.attributes.type==="radio"||c.attributes.type==="checkbox"){if(f.value===c.attributes.xfaOn?s.setAttribute("checked",!0):f.value===c.attributes.xfaOff&&s.removeAttribute("checked"),p==="print")break;s.addEventListener("change",w=>{u.setValue(l,{value:w.target.checked?w.target.getAttribute("xfaOn"):w.target.getAttribute("xfaOff")})})}else{if(f.value!==null&&s.setAttribute("value",f.value),p==="print")break;s.addEventListener("input",w=>{u.setValue(l,{value:w.target.value})})}break;case"select":if(f.value!==null)for(let w of c.children)w.attributes.value===f.value&&(w.attributes.selected=!0);s.addEventListener("input",w=>{let A=w.target.options,m=A.selectedIndex===-1?"":A[A.selectedIndex].value;u.setValue(l,{value:m})});break}}static setAttributes({html:s,element:l,storage:c=null,intent:u,linkService:p}){let{attributes:f}=l,w=s instanceof HTMLAnchorElement;f.type==="radio"&&(f.name=`${f.name}-${u}`);for(let[A,m]of Object.entries(f))if(m!=null)switch(A){case"class":m.length&&s.setAttribute(A,m.join(" "));break;case"dataId":break;case"id":s.setAttribute("data-element-id",m);break;case"style":Object.assign(s.style,m);break;case"textContent":s.textContent=m;break;default:(!w||A!=="href"&&A!=="newWindow")&&s.setAttribute(A,m)}w&&p.addLinkAttributes(s,f.href,f.newWindow),c&&f.dataId&&this.setupStorage(s,f.dataId,l,c)}static render(s){let l=s.annotationStorage,c=s.linkService,u=s.xfaHtml,p=s.intent||"display",f=document.createElement(u.name);u.attributes&&this.setAttributes({html:f,element:u,intent:p,linkService:c});let w=[[u,-1,f]],A=s.div;if(A.append(f),s.viewport){let d=`matrix(${s.viewport.transform.join(",")})`;A.style.transform=d}p!=="richText"&&A.setAttribute("class","xfaLayer xfaFont");let m=[];for(;w.length>0;){let[d,h,M]=w.at(-1);if(h+1===d.children.length){w.pop();continue}let k=d.children[++w.at(-1)[1]];if(k===null)continue;let{name:E}=k;if(E==="#text"){let g=document.createTextNode(k.value);m.push(g),M.append(g);continue}let b;if(k?.attributes?.xmlns?b=document.createElementNS(k.attributes.xmlns,E):b=document.createElement(E),M.append(b),k.attributes&&this.setAttributes({html:b,element:k,storage:l,intent:p,linkService:c}),k.children&&k.children.length>0)w.push([k,-1,b]);else if(k.value){let g=document.createTextNode(k.value);n.XfaText.shouldBuildText(E)&&m.push(g),b.append(g)}}for(let d of A.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))d.setAttribute("readOnly",!0);return{textDivs:m}}static update(s){let l=`matrix(${s.viewport.transform.join(",")})`;s.div.style.transform=l,s.div.hidden=!1}}t.XfaLayer=i},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextLayerRenderTask=void 0,t.renderTextLayer=k;var n=e(1),i=e(8);let o=1e5,s=30,l=.8,c=new Map,u=/^\s+$/g;function p(E,b){let g=c.get(E);if(g)return g;b.save(),b.font=`${s}px ${E}`;let v=b.measureText(""),y=v.fontBoundingBoxAscent,V=Math.abs(v.fontBoundingBoxDescent);if(y){b.restore();let D=y/(y+V);return c.set(E,D),D}b.strokeStyle="red",b.clearRect(0,0,s,s),b.strokeText("g",0,0);let B=b.getImageData(0,0,s,s).data;V=0;for(let D=B.length-1-3;D>=0;D-=4)if(B[D]>0){V=Math.ceil(D/4/s);break}b.clearRect(0,0,s,s),b.strokeText("A",0,s),B=b.getImageData(0,0,s,s).data,y=0;for(let D=0,L=B.length;D<L;D+=4)if(B[D]>0){y=s-Math.floor(D/4/s);break}if(b.restore(),y){let D=y/(y+V);return c.set(E,D),D}return c.set(E,l),l}function f(E,b,g,v){let y=document.createElement("span"),V=E._enhanceTextSelection?{angle:0,canvasWidth:0,hasText:b.str!=="",hasEOL:b.hasEOL,originalTransform:null,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,scale:1,fontSize:0}:{angle:0,canvasWidth:0,hasText:b.str!=="",hasEOL:b.hasEOL,fontSize:0};E._textDivs.push(y);let B=n.Util.transform(E._viewport.transform,b.transform),D=Math.atan2(B[1],B[0]),L=g[b.fontName];L.vertical&&(D+=Math.PI/2);let J=Math.hypot(B[2],B[3]),ae=J*p(L.fontFamily,v),Q,ee;D===0?(Q=B[4],ee=B[5]-ae):(Q=B[4]+ae*Math.sin(D),ee=B[5]-ae*Math.cos(D)),y.style.left=`${Q}px`,y.style.top=`${ee}px`,y.style.fontSize=`${J}px`,y.style.fontFamily=L.fontFamily,V.fontSize=J,y.setAttribute("role","presentation"),y.textContent=b.str,y.dir=b.dir,E._fontInspectorEnabled&&(y.dataset.fontName=b.fontName),D!==0&&(V.angle=D*(180/Math.PI));let K=!1;if(b.str.length>1||E._enhanceTextSelection&&u.test(b.str))K=!0;else if(b.str!==" "&&b.transform[0]!==b.transform[3]){let $=Math.abs(b.transform[0]),te=Math.abs(b.transform[3]);$!==te&&Math.max($,te)/Math.min($,te)>1.5&&(K=!0)}if(K&&(L.vertical?V.canvasWidth=b.height*E._viewport.scale:V.canvasWidth=b.width*E._viewport.scale),E._textDivProperties.set(y,V),E._textContentStream&&E._layoutText(y),E._enhanceTextSelection&&V.hasText){let $=1,te=0;D!==0&&($=Math.cos(D),te=Math.sin(D));let xe=(L.vertical?b.height:b.width)*E._viewport.scale,be=J,Ue,Y;D!==0?(Ue=[$,te,-te,$,Q,ee],Y=n.Util.getAxialAlignedBoundingBox([0,0,xe,be],Ue)):Y=[Q,ee,Q+xe,ee+be],E._bounds.push({left:Y[0],top:Y[1],right:Y[2],bottom:Y[3],div:y,size:[xe,be],m:Ue})}}function w(E){if(E._canceled)return;let b=E._textDivs,g=E._capability,v=b.length;if(v>o){E._renderingDone=!0,g.resolve();return}if(!E._textContentStream)for(let y=0;y<v;y++)E._layoutText(b[y]);E._renderingDone=!0,g.resolve()}function A(E,b,g){let v=0;for(let y=0;y<g;y++){let V=E[b++];V>0&&(v=v?Math.min(V,v):V)}return v}function m(E){let b=E._bounds,g=E._viewport,v=d(g.width,g.height,b);for(let y=0;y<v.length;y++){let V=b[y].div,B=E._textDivProperties.get(V);if(B.angle===0){B.paddingLeft=b[y].left-v[y].left,B.paddingTop=b[y].top-v[y].top,B.paddingRight=v[y].right-b[y].right,B.paddingBottom=v[y].bottom-b[y].bottom,E._textDivProperties.set(V,B);continue}let D=v[y],L=b[y],J=L.m,ae=J[0],Q=J[1],ee=[[0,0],[0,L.size[1]],[L.size[0],0],L.size],K=new Float64Array(64);for(let te=0,xe=ee.length;te<xe;te++){let be=n.Util.applyTransform(ee[te],J);K[te+0]=ae&&(D.left-be[0])/ae,K[te+4]=Q&&(D.top-be[1])/Q,K[te+8]=ae&&(D.right-be[0])/ae,K[te+12]=Q&&(D.bottom-be[1])/Q,K[te+16]=Q&&(D.left-be[0])/-Q,K[te+20]=ae&&(D.top-be[1])/ae,K[te+24]=Q&&(D.right-be[0])/-Q,K[te+28]=ae&&(D.bottom-be[1])/ae,K[te+32]=ae&&(D.left-be[0])/-ae,K[te+36]=Q&&(D.top-be[1])/-Q,K[te+40]=ae&&(D.right-be[0])/-ae,K[te+44]=Q&&(D.bottom-be[1])/-Q,K[te+48]=Q&&(D.left-be[0])/Q,K[te+52]=ae&&(D.top-be[1])/-ae,K[te+56]=Q&&(D.right-be[0])/Q,K[te+60]=ae&&(D.bottom-be[1])/-ae}let $=1+Math.min(Math.abs(ae),Math.abs(Q));B.paddingLeft=A(K,32,16)/$,B.paddingTop=A(K,48,16)/$,B.paddingRight=A(K,0,16)/$,B.paddingBottom=A(K,16,16)/$,E._textDivProperties.set(V,B)}}function d(E,b,g){let v=g.map(function(V,B){return{x1:V.left,y1:V.top,x2:V.right,y2:V.bottom,index:B,x1New:void 0,x2New:void 0}});h(E,v);let y=new Array(g.length);for(let V of v){let B=V.index;y[B]={left:V.x1New,top:0,right:V.x2New,bottom:0}}g.map(function(V,B){let D=y[B],L=v[B];L.x1=V.top,L.y1=E-D.right,L.x2=V.bottom,L.y2=E-D.left,L.index=B,L.x1New=void 0,L.x2New=void 0}),h(b,v);for(let V of v){let B=V.index;y[B].top=V.x1New,y[B].bottom=V.x2New}return y}function h(E,b){b.sort(function(y,V){return y.x1-V.x1||y.index-V.index});let v=[{start:-1/0,end:1/0,boundary:{x1:-1/0,y1:-1/0,x2:0,y2:1/0,index:-1,x1New:0,x2New:0}}];for(let y of b){let V=0;for(;V<v.length&&v[V].end<=y.y1;)V++;let B=v.length-1;for(;B>=0&&v[B].start>=y.y2;)B--;let D,L,J,ae,Q=-1/0;for(J=V;J<=B;J++){D=v[J],L=D.boundary;let $;L.x2>y.x1?$=L.index>y.index?L.x1New:y.x1:L.x2New===void 0?$=(L.x2+y.x1)/2:$=L.x2New,$>Q&&(Q=$)}for(y.x1New=Q,J=V;J<=B;J++)D=v[J],L=D.boundary,L.x2New===void 0?L.x2>y.x1?L.index>y.index&&(L.x2New=L.x2):L.x2New=Q:L.x2New>Q&&(L.x2New=Math.max(Q,L.x2));let ee=[],K=null;for(J=V;J<=B;J++){D=v[J],L=D.boundary;let $=L.x2>y.x2?L:y;K===$?ee.at(-1).end=D.end:(ee.push({start:D.start,end:D.end,boundary:$}),K=$)}for(v[V].start<y.y1&&(ee[0].start=y.y1,ee.unshift({start:v[V].start,end:y.y1,boundary:v[V].boundary})),y.y2<v[B].end&&(ee.at(-1).end=y.y2,ee.push({start:y.y2,end:v[B].end,boundary:v[B].boundary})),J=V;J<=B;J++){if(D=v[J],L=D.boundary,L.x2New!==void 0)continue;let $=!1;for(ae=V-1;!$&&ae>=0&&v[ae].start>=L.y1;ae--)$=v[ae].boundary===L;for(ae=B+1;!$&&ae<v.length&&v[ae].end<=L.y2;ae++)$=v[ae].boundary===L;for(ae=0;!$&&ae<ee.length;ae++)$=ee[ae].boundary===L;$||(L.x2New=Q)}Array.prototype.splice.apply(v,[V,B-V+1,...ee])}for(let y of v){let V=y.boundary;V.x2New===void 0&&(V.x2New=Math.max(E,V.x2))}}class M{constructor({textContent:b,textContentStream:g,container:v,viewport:y,textDivs:V,textContentItemsStr:B,enhanceTextSelection:D}){D&&(0,i.deprecated)("The `enhanceTextSelection` functionality will be removed in the future."),this._textContent=b,this._textContentStream=g,this._container=v,this._document=v.ownerDocument,this._viewport=y,this._textDivs=V||[],this._textContentItemsStr=B||[],this._enhanceTextSelection=!!D,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._layoutTextLastFontSize=null,this._layoutTextLastFontFamily=null,this._layoutTextCtx=null,this._textDivProperties=new WeakMap,this._renderingDone=!1,this._canceled=!1,this._capability=(0,n.createPromiseCapability)(),this._renderTimer=null,this._bounds=[],this._devicePixelRatio=globalThis.devicePixelRatio||1,this._capability.promise.finally(()=>{this._enhanceTextSelection||(this._textDivProperties=null),this._layoutTextCtx&&(this._layoutTextCtx.canvas.width=0,this._layoutTextCtx.canvas.height=0,this._layoutTextCtx=null)}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new n.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._renderTimer!==null&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._capability.reject(new Error("TextLayer task cancelled."))}_processItems(b,g){for(let v=0,y=b.length;v<y;v++){if(b[v].str===void 0){if(b[v].type==="beginMarkedContentProps"||b[v].type==="beginMarkedContent"){let V=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),b[v].id!==null&&this._container.setAttribute("id",`${b[v].id}`),V.append(this._container)}else b[v].type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(b[v].str),f(this,b[v],g,this._layoutTextCtx)}}_layoutText(b){let g=this._textDivProperties.get(b),v="";if(g.canvasWidth!==0&&g.hasText){let{fontFamily:y}=b.style,{fontSize:V}=g;(V!==this._layoutTextLastFontSize||y!==this._layoutTextLastFontFamily)&&(this._layoutTextCtx.font=`${V*this._devicePixelRatio}px ${y}`,this._layoutTextLastFontSize=V,this._layoutTextLastFontFamily=y);let{width:B}=this._layoutTextCtx.measureText(b.textContent);if(B>0){let D=this._devicePixelRatio*g.canvasWidth/B;this._enhanceTextSelection&&(g.scale=D),v=`scaleX(${D})`}}if(g.angle!==0&&(v=`rotate(${g.angle}deg) ${v}`),v.length>0&&(this._enhanceTextSelection&&(g.originalTransform=v),b.style.transform=v),g.hasText&&this._container.append(b),g.hasEOL){let y=document.createElement("br");y.setAttribute("role","presentation"),this._container.append(y)}}_render(b=0){let g=(0,n.createPromiseCapability)(),v=Object.create(null),y=this._document.createElement("canvas");if(y.height=y.width=s,this._layoutTextCtx=y.getContext("2d",{alpha:!1}),this._textContent){let V=this._textContent.items,B=this._textContent.styles;this._processItems(V,B),g.resolve()}else if(this._textContentStream){let V=()=>{this._reader.read().then(({value:B,done:D})=>{if(D){g.resolve();return}Object.assign(v,B.styles),this._processItems(B.items,v),V()},g.reject)};this._reader=this._textContentStream.getReader(),V()}else throw new Error('Neither "textContent" nor "textContentStream" parameters specified.');g.promise.then(()=>{v=null,b?this._renderTimer=setTimeout(()=>{w(this),this._renderTimer=null},b):w(this)},this._capability.reject)}expandTextDivs(b=!1){if(!this._enhanceTextSelection||!this._renderingDone)return;this._bounds!==null&&(m(this),this._bounds=null);let g=[],v=[];for(let y=0,V=this._textDivs.length;y<V;y++){let B=this._textDivs[y],D=this._textDivProperties.get(B);D.hasText&&(b?(g.length=0,v.length=0,D.originalTransform&&g.push(D.originalTransform),D.paddingTop>0?(v.push(`${D.paddingTop}px`),g.push(`translateY(${-D.paddingTop}px)`)):v.push(0),D.paddingRight>0?v.push(`${D.paddingRight/D.scale}px`):v.push(0),D.paddingBottom>0?v.push(`${D.paddingBottom}px`):v.push(0),D.paddingLeft>0?(v.push(`${D.paddingLeft/D.scale}px`),g.push(`translateX(${-D.paddingLeft/D.scale}px)`)):v.push(0),B.style.padding=v.join(" "),g.length&&(B.style.transform=g.join(" "))):(B.style.padding=null,B.style.transform=D.originalTransform))}}}t.TextLayerRenderTask=M;function k(E){let b=new M({textContent:E.textContent,textContentStream:E.textContentStream,container:E.container,viewport:E.viewport,textDivs:E.textDivs,textContentItemsStr:E.textContentItemsStr,enhanceTextSelection:E.enhanceTextSelection});return b._render(E.timeout),b}},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SVGGraphics=void 0;var n=e(8),i=e(1),o=e(3);let s=class{constructor(){(0,i.unreachable)("Not implemented: SVGGraphics")}};t.SVGGraphics=s;{let d=function(g){let v=[],y=[];for(let V of g){if(V.fn==="save"){v.push({fnId:92,fn:"group",items:[]}),y.push(v),v=v.at(-1).items;continue}V.fn==="restore"?v=y.pop():v.push(V)}return v},h=function(g){if(Number.isInteger(g))return g.toString();let v=g.toFixed(10),y=v.length-1;if(v[y]!=="0")return v;do y--;while(v[y]==="0");return v.substring(0,v[y]==="."?y:y+1)},M=function(g){if(g[4]===0&&g[5]===0){if(g[1]===0&&g[2]===0)return g[0]===1&&g[3]===1?"":`scale(${h(g[0])} ${h(g[3])})`;if(g[0]===g[3]&&g[1]===-g[2]){let v=Math.acos(g[0])*180/Math.PI;return`rotate(${h(v)})`}}else if(g[0]===1&&g[1]===0&&g[2]===0&&g[3]===1)return`translate(${h(g[4])} ${h(g[5])})`;return`matrix(${h(g[0])} ${h(g[1])} ${h(g[2])} ${h(g[3])} ${h(g[4])} ${h(g[5])})`},l={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},c="http://www.w3.org/XML/1998/namespace",u="http://www.w3.org/1999/xlink",p=["butt","round","square"],f=["miter","round","bevel"],w=function(g,v="",y=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!y)return URL.createObjectURL(new Blob([g],{type:v}));let V="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",B=`data:${v};base64,`;for(let D=0,L=g.length;D<L;D+=3){let J=g[D]&255,ae=g[D+1]&255,Q=g[D+2]&255,ee=J>>2,K=(J&3)<<4|ae>>4,$=D+1<L?(ae&15)<<2|Q>>6:64,te=D+2<L?Q&63:64;B+=V[ee]+V[K]+V[$]+V[te]}return B},A=function(){let g=new Uint8Array([137,80,78,71,13,10,26,10]),v=12,y=new Int32Array(256);for(let Q=0;Q<256;Q++){let ee=Q;for(let K=0;K<8;K++)ee&1?ee=3988292384^ee>>1&2147483647:ee=ee>>1&2147483647;y[Q]=ee}function V(Q,ee,K){let $=-1;for(let te=ee;te<K;te++){let xe=($^Q[te])&255,be=y[xe];$=$>>>8^be}return $^-1}function B(Q,ee,K,$){let te=$,xe=ee.length;K[te]=xe>>24&255,K[te+1]=xe>>16&255,K[te+2]=xe>>8&255,K[te+3]=xe&255,te+=4,K[te]=Q.charCodeAt(0)&255,K[te+1]=Q.charCodeAt(1)&255,K[te+2]=Q.charCodeAt(2)&255,K[te+3]=Q.charCodeAt(3)&255,te+=4,K.set(ee,te),te+=ee.length;let be=V(K,$+4,te);K[te]=be>>24&255,K[te+1]=be>>16&255,K[te+2]=be>>8&255,K[te+3]=be&255}function D(Q,ee,K){let $=1,te=0;for(let xe=ee;xe<K;++xe)$=($+(Q[xe]&255))%65521,te=(te+$)%65521;return te<<16|$}function L(Q){if(!o.isNodeJS)return J(Q);try{let ee;parseInt(process.versions.node)>=8?ee=Q:ee=Buffer.from(Q);let K=KT().deflateSync(ee,{level:9});return K instanceof Uint8Array?K:new Uint8Array(K)}catch(ee){(0,i.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+ee)}return J(Q)}function J(Q){let ee=Q.length,K=65535,$=Math.ceil(ee/K),te=new Uint8Array(2+ee+$*5+4),xe=0;te[xe++]=120,te[xe++]=156;let be=0;for(;ee>K;)te[xe++]=0,te[xe++]=255,te[xe++]=255,te[xe++]=0,te[xe++]=0,te.set(Q.subarray(be,be+K),xe),xe+=K,be+=K,ee-=K;te[xe++]=1,te[xe++]=ee&255,te[xe++]=ee>>8&255,te[xe++]=~ee&65535&255,te[xe++]=(~ee&65535)>>8&255,te.set(Q.subarray(be),xe),xe+=Q.length-be;let Ue=D(Q,0,Q.length);return te[xe++]=Ue>>24&255,te[xe++]=Ue>>16&255,te[xe++]=Ue>>8&255,te[xe++]=Ue&255,te}function ae(Q,ee,K,$){let te=Q.width,xe=Q.height,be,Ue,Y,P=Q.data;switch(ee){case i.ImageKind.GRAYSCALE_1BPP:Ue=0,be=1,Y=te+7>>3;break;case i.ImageKind.RGB_24BPP:Ue=2,be=8,Y=te*3;break;case i.ImageKind.RGBA_32BPP:Ue=6,be=8,Y=te*4;break;default:throw new Error("invalid format")}let C=new Uint8Array((1+Y)*xe),N=0,j=0;for(let R=0;R<xe;++R)C[N++]=0,C.set(P.subarray(j,j+Y),N),j+=Y,N+=Y;if(ee===i.ImageKind.GRAYSCALE_1BPP&&$){N=0;for(let R=0;R<xe;R++){N++;for(let O=0;O<Y;O++)C[N++]^=255}}let z=new Uint8Array([te>>24&255,te>>16&255,te>>8&255,te&255,xe>>24&255,xe>>16&255,xe>>8&255,xe&255,be,Ue,0,0,0]),X=L(C),oe=g.length+v*3+z.length+X.length,se=new Uint8Array(oe),S=0;return se.set(g,S),S+=g.length,B("IHDR",z,se,S),S+=v+z.length,B("IDATA",X,se,S),S+=v+X.length,B("IEND",new Uint8Array(0),se,S),w(se,"image/png",K)}return function(ee,K,$){let te=ee.kind===void 0?i.ImageKind.GRAYSCALE_1BPP:ee.kind;return ae(ee,te,K,$)}}();class m{constructor(){this.fontSizeScale=1,this.fontWeight=l.fontWeight,this.fontSize=0,this.textMatrix=i.IDENTITY_MATRIX,this.fontMatrix=i.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=i.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=l.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(v,y){this.x=v,this.y=y}}let k=0,E=0,b=0;t.SVGGraphics=s=class{constructor(g,v,y=!1){(0,n.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new n.DOMSVGFactory,this.current=new m,this.transformMatrix=i.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=g,this.objs=v,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!y,this._operatorIdMapping=[];for(let V in i.OPS)this._operatorIdMapping[i.OPS[V]]=V}save(){this.transformStack.push(this.transformMatrix);let g=this.current;this.extraStack.push(g),this.current=g.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(g){this.save(),this.executeOpTree(g),this.restore()}loadDependencies(g){let v=g.fnArray,y=g.argsArray;for(let V=0,B=v.length;V<B;V++)if(v[V]===i.OPS.dependency)for(let D of y[V]){let L=D.startsWith("g_")?this.commonObjs:this.objs,J=new Promise(ae=>{L.get(D,ae)});this.current.dependencies.push(J)}return Promise.all(this.current.dependencies)}transform(g,v,y,V,B,D){let L=[g,v,y,V,B,D];this.transformMatrix=i.Util.transform(this.transformMatrix,L),this.tgrp=null}getSVG(g,v){this.viewport=v;let y=this._initialize(v);return this.loadDependencies(g).then(()=>(this.transformMatrix=i.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(g)),y))}convertOpList(g){let v=this._operatorIdMapping,y=g.argsArray,V=g.fnArray,B=[];for(let D=0,L=V.length;D<L;D++){let J=V[D];B.push({fnId:J,fn:v[J],args:y[D]})}return d(B)}executeOpTree(g){for(let v of g){let y=v.fn,V=v.fnId,B=v.args;switch(V|0){case i.OPS.beginText:this.beginText();break;case i.OPS.dependency:break;case i.OPS.setLeading:this.setLeading(B);break;case i.OPS.setLeadingMoveText:this.setLeadingMoveText(B[0],B[1]);break;case i.OPS.setFont:this.setFont(B);break;case i.OPS.showText:this.showText(B[0]);break;case i.OPS.showSpacedText:this.showText(B[0]);break;case i.OPS.endText:this.endText();break;case i.OPS.moveText:this.moveText(B[0],B[1]);break;case i.OPS.setCharSpacing:this.setCharSpacing(B[0]);break;case i.OPS.setWordSpacing:this.setWordSpacing(B[0]);break;case i.OPS.setHScale:this.setHScale(B[0]);break;case i.OPS.setTextMatrix:this.setTextMatrix(B[0],B[1],B[2],B[3],B[4],B[5]);break;case i.OPS.setTextRise:this.setTextRise(B[0]);break;case i.OPS.setTextRenderingMode:this.setTextRenderingMode(B[0]);break;case i.OPS.setLineWidth:this.setLineWidth(B[0]);break;case i.OPS.setLineJoin:this.setLineJoin(B[0]);break;case i.OPS.setLineCap:this.setLineCap(B[0]);break;case i.OPS.setMiterLimit:this.setMiterLimit(B[0]);break;case i.OPS.setFillRGBColor:this.setFillRGBColor(B[0],B[1],B[2]);break;case i.OPS.setStrokeRGBColor:this.setStrokeRGBColor(B[0],B[1],B[2]);break;case i.OPS.setStrokeColorN:this.setStrokeColorN(B);break;case i.OPS.setFillColorN:this.setFillColorN(B);break;case i.OPS.shadingFill:this.shadingFill(B[0]);break;case i.OPS.setDash:this.setDash(B[0],B[1]);break;case i.OPS.setRenderingIntent:this.setRenderingIntent(B[0]);break;case i.OPS.setFlatness:this.setFlatness(B[0]);break;case i.OPS.setGState:this.setGState(B[0]);break;case i.OPS.fill:this.fill();break;case i.OPS.eoFill:this.eoFill();break;case i.OPS.stroke:this.stroke();break;case i.OPS.fillStroke:this.fillStroke();break;case i.OPS.eoFillStroke:this.eoFillStroke();break;case i.OPS.clip:this.clip("nonzero");break;case i.OPS.eoClip:this.clip("evenodd");break;case i.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case i.OPS.paintImageXObject:this.paintImageXObject(B[0]);break;case i.OPS.paintInlineImageXObject:this.paintInlineImageXObject(B[0]);break;case i.OPS.paintImageMaskXObject:this.paintImageMaskXObject(B[0]);break;case i.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(B[0],B[1]);break;case i.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case i.OPS.closePath:this.closePath();break;case i.OPS.closeStroke:this.closeStroke();break;case i.OPS.closeFillStroke:this.closeFillStroke();break;case i.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case i.OPS.nextLine:this.nextLine();break;case i.OPS.transform:this.transform(B[0],B[1],B[2],B[3],B[4],B[5]);break;case i.OPS.constructPath:this.constructPath(B[0],B[1]);break;case i.OPS.endPath:this.endPath();break;case 92:this.group(v.items);break;default:(0,i.warn)(`Unimplemented operator ${y}`);break}}}setWordSpacing(g){this.current.wordSpacing=g}setCharSpacing(g){this.current.charSpacing=g}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(g,v,y,V,B,D){let L=this.current;L.textMatrix=L.lineMatrix=[g,v,y,V,B,D],L.textMatrixScale=Math.hypot(g,v),L.x=L.lineX=0,L.y=L.lineY=0,L.xcoords=[],L.ycoords=[],L.tspan=this.svgFactory.createElement("svg:tspan"),L.tspan.setAttributeNS(null,"font-family",L.fontFamily),L.tspan.setAttributeNS(null,"font-size",`${h(L.fontSize)}px`),L.tspan.setAttributeNS(null,"y",h(-L.y)),L.txtElement=this.svgFactory.createElement("svg:text"),L.txtElement.append(L.tspan)}beginText(){let g=this.current;g.x=g.lineX=0,g.y=g.lineY=0,g.textMatrix=i.IDENTITY_MATRIX,g.lineMatrix=i.IDENTITY_MATRIX,g.textMatrixScale=1,g.tspan=this.svgFactory.createElement("svg:tspan"),g.txtElement=this.svgFactory.createElement("svg:text"),g.txtgrp=this.svgFactory.createElement("svg:g"),g.xcoords=[],g.ycoords=[]}moveText(g,v){let y=this.current;y.x=y.lineX+=g,y.y=y.lineY+=v,y.xcoords=[],y.ycoords=[],y.tspan=this.svgFactory.createElement("svg:tspan"),y.tspan.setAttributeNS(null,"font-family",y.fontFamily),y.tspan.setAttributeNS(null,"font-size",`${h(y.fontSize)}px`),y.tspan.setAttributeNS(null,"y",h(-y.y))}showText(g){let v=this.current,y=v.font,V=v.fontSize;if(V===0)return;let B=v.fontSizeScale,D=v.charSpacing,L=v.wordSpacing,J=v.fontDirection,ae=v.textHScale*J,Q=y.vertical,ee=Q?1:-1,K=y.defaultVMetrics,$=V*v.fontMatrix[0],te=0;for(let Ue of g){if(Ue===null){te+=J*L;continue}else if(typeof Ue=="number"){te+=ee*Ue*V/1e3;continue}let Y=(Ue.isSpace?L:0)+D,P=Ue.fontChar,C,N,j=Ue.width;if(Q){let X,oe=Ue.vmetric||K;X=Ue.vmetric?oe[1]:j*.5,X=-X*$;let se=oe[2]*$;j=oe?-oe[0]:j,C=X/B,N=(te+se)/B}else C=te/B,N=0;(Ue.isInFont||y.missingFile)&&(v.xcoords.push(v.x+C),Q&&v.ycoords.push(-v.y+N),v.tspan.textContent+=P);let z;Q?z=j*$-Y*J:z=j*$+Y*J,te+=z}v.tspan.setAttributeNS(null,"x",v.xcoords.map(h).join(" ")),Q?v.tspan.setAttributeNS(null,"y",v.ycoords.map(h).join(" ")):v.tspan.setAttributeNS(null,"y",h(-v.y)),Q?v.y-=te:v.x+=te*ae,v.tspan.setAttributeNS(null,"font-family",v.fontFamily),v.tspan.setAttributeNS(null,"font-size",`${h(v.fontSize)}px`),v.fontStyle!==l.fontStyle&&v.tspan.setAttributeNS(null,"font-style",v.fontStyle),v.fontWeight!==l.fontWeight&&v.tspan.setAttributeNS(null,"font-weight",v.fontWeight);let xe=v.textRenderingMode&i.TextRenderingMode.FILL_STROKE_MASK;if(xe===i.TextRenderingMode.FILL||xe===i.TextRenderingMode.FILL_STROKE?(v.fillColor!==l.fillColor&&v.tspan.setAttributeNS(null,"fill",v.fillColor),v.fillAlpha<1&&v.tspan.setAttributeNS(null,"fill-opacity",v.fillAlpha)):v.textRenderingMode===i.TextRenderingMode.ADD_TO_PATH?v.tspan.setAttributeNS(null,"fill","transparent"):v.tspan.setAttributeNS(null,"fill","none"),xe===i.TextRenderingMode.STROKE||xe===i.TextRenderingMode.FILL_STROKE){let Ue=1/(v.textMatrixScale||1);this._setStrokeAttributes(v.tspan,Ue)}let be=v.textMatrix;v.textRise!==0&&(be=be.slice(),be[5]+=v.textRise),v.txtElement.setAttributeNS(null,"transform",`${M(be)} scale(${h(ae)}, -1)`),v.txtElement.setAttributeNS(c,"xml:space","preserve"),v.txtElement.append(v.tspan),v.txtgrp.append(v.txtElement),this._ensureTransformGroup().append(v.txtElement)}setLeadingMoveText(g,v){this.setLeading(-v),this.moveText(g,v)}addFontStyle(g){if(!g.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));let v=w(g.data,g.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${g.loadedName}"; src: url(${v}); }
`}setFont(g){let v=this.current,y=this.commonObjs.get(g[0]),V=g[1];v.font=y,this.embedFonts&&!y.missingFile&&!this.embeddedFonts[y.loadedName]&&(this.addFontStyle(y),this.embeddedFonts[y.loadedName]=y),v.fontMatrix=y.fontMatrix||i.FONT_IDENTITY_MATRIX;let B="normal";y.black?B="900":y.bold&&(B="bold");let D=y.italic?"italic":"normal";V<0?(V=-V,v.fontDirection=-1):v.fontDirection=1,v.fontSize=V,v.fontFamily=y.loadedName,v.fontWeight=B,v.fontStyle=D,v.tspan=this.svgFactory.createElement("svg:tspan"),v.tspan.setAttributeNS(null,"y",h(-v.y)),v.xcoords=[],v.ycoords=[]}endText(){let g=this.current;g.textRenderingMode&i.TextRenderingMode.ADD_TO_PATH_FLAG&&g.txtElement?.hasChildNodes()&&(g.element=g.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(g){g>0&&(this.current.lineWidth=g)}setLineCap(g){this.current.lineCap=p[g]}setLineJoin(g){this.current.lineJoin=f[g]}setMiterLimit(g){this.current.miterLimit=g}setStrokeAlpha(g){this.current.strokeAlpha=g}setStrokeRGBColor(g,v,y){this.current.strokeColor=i.Util.makeHexColor(g,v,y)}setFillAlpha(g){this.current.fillAlpha=g}setFillRGBColor(g,v,y){this.current.fillColor=i.Util.makeHexColor(g,v,y),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(g){this.current.strokeColor=this._makeColorN_Pattern(g)}setFillColorN(g){this.current.fillColor=this._makeColorN_Pattern(g)}shadingFill(g){let v=this.viewport.width,y=this.viewport.height,V=i.Util.inverseTransform(this.transformMatrix),B=i.Util.applyTransform([0,0],V),D=i.Util.applyTransform([0,y],V),L=i.Util.applyTransform([v,0],V),J=i.Util.applyTransform([v,y],V),ae=Math.min(B[0],D[0],L[0],J[0]),Q=Math.min(B[1],D[1],L[1],J[1]),ee=Math.max(B[0],D[0],L[0],J[0]),K=Math.max(B[1],D[1],L[1],J[1]),$=this.svgFactory.createElement("svg:rect");$.setAttributeNS(null,"x",ae),$.setAttributeNS(null,"y",Q),$.setAttributeNS(null,"width",ee-ae),$.setAttributeNS(null,"height",K-Q),$.setAttributeNS(null,"fill",this._makeShadingPattern(g)),this.current.fillAlpha<1&&$.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append($)}_makeColorN_Pattern(g){return g[0]==="TilingPattern"?this._makeTilingPattern(g):this._makeShadingPattern(g)}_makeTilingPattern(g){let v=g[1],y=g[2],V=g[3]||i.IDENTITY_MATRIX,[B,D,L,J]=g[4],ae=g[5],Q=g[6],ee=g[7],K=`shading${b++}`,[$,te,xe,be]=i.Util.normalizeRect([...i.Util.applyTransform([B,D],V),...i.Util.applyTransform([L,J],V)]),[Ue,Y]=i.Util.singularValueDecompose2dScale(V),P=ae*Ue,C=Q*Y,N=this.svgFactory.createElement("svg:pattern");N.setAttributeNS(null,"id",K),N.setAttributeNS(null,"patternUnits","userSpaceOnUse"),N.setAttributeNS(null,"width",P),N.setAttributeNS(null,"height",C),N.setAttributeNS(null,"x",`${$}`),N.setAttributeNS(null,"y",`${te}`);let j=this.svg,z=this.transformMatrix,X=this.current.fillColor,oe=this.current.strokeColor,se=this.svgFactory.create(xe-$,be-te);if(this.svg=se,this.transformMatrix=V,ee===2){let S=i.Util.makeHexColor(...v);this.current.fillColor=S,this.current.strokeColor=S}return this.executeOpTree(this.convertOpList(y)),this.svg=j,this.transformMatrix=z,this.current.fillColor=X,this.current.strokeColor=oe,N.append(se.childNodes[0]),this.defs.append(N),`url(#${K})`}_makeShadingPattern(g){switch(typeof g=="string"&&(g=this.objs.get(g)),g[0]){case"RadialAxial":let v=`shading${b++}`,y=g[3],V;switch(g[1]){case"axial":let B=g[4],D=g[5];V=this.svgFactory.createElement("svg:linearGradient"),V.setAttributeNS(null,"id",v),V.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),V.setAttributeNS(null,"x1",B[0]),V.setAttributeNS(null,"y1",B[1]),V.setAttributeNS(null,"x2",D[0]),V.setAttributeNS(null,"y2",D[1]);break;case"radial":let L=g[4],J=g[5],ae=g[6],Q=g[7];V=this.svgFactory.createElement("svg:radialGradient"),V.setAttributeNS(null,"id",v),V.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),V.setAttributeNS(null,"cx",J[0]),V.setAttributeNS(null,"cy",J[1]),V.setAttributeNS(null,"r",Q),V.setAttributeNS(null,"fx",L[0]),V.setAttributeNS(null,"fy",L[1]),V.setAttributeNS(null,"fr",ae);break;default:throw new Error(`Unknown RadialAxial type: ${g[1]}`)}for(let B of y){let D=this.svgFactory.createElement("svg:stop");D.setAttributeNS(null,"offset",B[0]),D.setAttributeNS(null,"stop-color",B[1]),V.append(D)}return this.defs.append(V),`url(#${v})`;case"Mesh":return(0,i.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${g[0]}`)}}setDash(g,v){this.current.dashArray=g,this.current.dashPhase=v}constructPath(g,v){let y=this.current,V=y.x,B=y.y,D=[],L=0;for(let J of g)switch(J|0){case i.OPS.rectangle:V=v[L++],B=v[L++];let ae=v[L++],Q=v[L++],ee=V+ae,K=B+Q;D.push("M",h(V),h(B),"L",h(ee),h(B),"L",h(ee),h(K),"L",h(V),h(K),"Z");break;case i.OPS.moveTo:V=v[L++],B=v[L++],D.push("M",h(V),h(B));break;case i.OPS.lineTo:V=v[L++],B=v[L++],D.push("L",h(V),h(B));break;case i.OPS.curveTo:V=v[L+4],B=v[L+5],D.push("C",h(v[L]),h(v[L+1]),h(v[L+2]),h(v[L+3]),h(V),h(B)),L+=6;break;case i.OPS.curveTo2:D.push("C",h(V),h(B),h(v[L]),h(v[L+1]),h(v[L+2]),h(v[L+3])),V=v[L+2],B=v[L+3],L+=4;break;case i.OPS.curveTo3:V=v[L+2],B=v[L+3],D.push("C",h(v[L]),h(v[L+1]),h(V),h(B),h(V),h(B)),L+=4;break;case i.OPS.closePath:D.push("Z");break}D=D.join(" "),y.path&&g.length>0&&g[0]!==i.OPS.rectangle&&g[0]!==i.OPS.moveTo?D=y.path.getAttributeNS(null,"d")+D:(y.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(y.path)),y.path.setAttributeNS(null,"d",D),y.path.setAttributeNS(null,"fill","none"),y.element=y.path,y.setCurrentPoint(V,B)}endPath(){let g=this.current;if(g.path=null,!this.pendingClip)return;if(!g.element){this.pendingClip=null;return}let v=`clippath${k++}`,y=this.svgFactory.createElement("svg:clipPath");y.setAttributeNS(null,"id",v),y.setAttributeNS(null,"transform",M(this.transformMatrix));let V=g.element.cloneNode(!0);if(this.pendingClip==="evenodd"?V.setAttributeNS(null,"clip-rule","evenodd"):V.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,y.append(V),this.defs.append(y),g.activeClipUrl){g.clipGroup=null;for(let B of this.extraStack)B.clipGroup=null;y.setAttributeNS(null,"clip-path",g.activeClipUrl)}g.activeClipUrl=`url(#${v})`,this.tgrp=null}clip(g){this.pendingClip=g}closePath(){let g=this.current;if(g.path){let v=`${g.path.getAttributeNS(null,"d")}Z`;g.path.setAttributeNS(null,"d",v)}}setLeading(g){this.current.leading=-g}setTextRise(g){this.current.textRise=g}setTextRenderingMode(g){this.current.textRenderingMode=g}setHScale(g){this.current.textHScale=g/100}setRenderingIntent(g){}setFlatness(g){}setGState(g){for(let[v,y]of g)switch(v){case"LW":this.setLineWidth(y);break;case"LC":this.setLineCap(y);break;case"LJ":this.setLineJoin(y);break;case"ML":this.setMiterLimit(y);break;case"D":this.setDash(y[0],y[1]);break;case"RI":this.setRenderingIntent(y);break;case"FL":this.setFlatness(y);break;case"Font":this.setFont(y);break;case"CA":this.setStrokeAlpha(y);break;case"ca":this.setFillAlpha(y);break;default:(0,i.warn)(`Unimplemented graphic state operator ${v}`);break}}fill(){let g=this.current;g.element&&(g.element.setAttributeNS(null,"fill",g.fillColor),g.element.setAttributeNS(null,"fill-opacity",g.fillAlpha),this.endPath())}stroke(){let g=this.current;g.element&&(this._setStrokeAttributes(g.element),g.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(g,v=1){let y=this.current,V=y.dashArray;v!==1&&V.length>0&&(V=V.map(function(B){return v*B})),g.setAttributeNS(null,"stroke",y.strokeColor),g.setAttributeNS(null,"stroke-opacity",y.strokeAlpha),g.setAttributeNS(null,"stroke-miterlimit",h(y.miterLimit)),g.setAttributeNS(null,"stroke-linecap",y.lineCap),g.setAttributeNS(null,"stroke-linejoin",y.lineJoin),g.setAttributeNS(null,"stroke-width",h(v*y.lineWidth)+"px"),g.setAttributeNS(null,"stroke-dasharray",V.map(h).join(" ")),g.setAttributeNS(null,"stroke-dashoffset",h(v*y.dashPhase)+"px")}eoFill(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){let g=this.svgFactory.createElement("svg:rect");g.setAttributeNS(null,"x","0"),g.setAttributeNS(null,"y","0"),g.setAttributeNS(null,"width","1px"),g.setAttributeNS(null,"height","1px"),g.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(g)}paintImageXObject(g){let v=g.startsWith("g_")?this.commonObjs.get(g):this.objs.get(g);if(!v){(0,i.warn)(`Dependent image with object ID ${g} is not ready yet`);return}this.paintInlineImageXObject(v)}paintInlineImageXObject(g,v){let y=g.width,V=g.height,B=A(g,this.forceDataSchema,!!v),D=this.svgFactory.createElement("svg:rect");D.setAttributeNS(null,"x","0"),D.setAttributeNS(null,"y","0"),D.setAttributeNS(null,"width",h(y)),D.setAttributeNS(null,"height",h(V)),this.current.element=D,this.clip("nonzero");let L=this.svgFactory.createElement("svg:image");L.setAttributeNS(u,"xlink:href",B),L.setAttributeNS(null,"x","0"),L.setAttributeNS(null,"y",h(-V)),L.setAttributeNS(null,"width",h(y)+"px"),L.setAttributeNS(null,"height",h(V)+"px"),L.setAttributeNS(null,"transform",`scale(${h(1/y)} ${h(-1/V)})`),v?v.append(L):this._ensureTransformGroup().append(L)}paintImageMaskXObject(g){let v=this.current,y=g.width,V=g.height,B=v.fillColor;v.maskId=`mask${E++}`;let D=this.svgFactory.createElement("svg:mask");D.setAttributeNS(null,"id",v.maskId);let L=this.svgFactory.createElement("svg:rect");L.setAttributeNS(null,"x","0"),L.setAttributeNS(null,"y","0"),L.setAttributeNS(null,"width",h(y)),L.setAttributeNS(null,"height",h(V)),L.setAttributeNS(null,"fill",B),L.setAttributeNS(null,"mask",`url(#${v.maskId})`),this.defs.append(D),this._ensureTransformGroup().append(L),this.paintInlineImageXObject(g,D)}paintFormXObjectBegin(g,v){if(Array.isArray(g)&&g.length===6&&this.transform(g[0],g[1],g[2],g[3],g[4],g[5]),v){let y=v[2]-v[0],V=v[3]-v[1],B=this.svgFactory.createElement("svg:rect");B.setAttributeNS(null,"x",v[0]),B.setAttributeNS(null,"y",v[1]),B.setAttributeNS(null,"width",h(y)),B.setAttributeNS(null,"height",h(V)),this.current.element=B,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(g){let v=this.svgFactory.create(g.width,g.height),y=this.svgFactory.createElement("svg:defs");v.append(y),this.defs=y;let V=this.svgFactory.createElement("svg:g");return V.setAttributeNS(null,"transform",M(g.transform)),v.append(V),this.svg=V,v}_ensureClipGroup(){if(!this.current.clipGroup){let g=this.svgFactory.createElement("svg:g");g.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(g),this.current.clipGroup=g}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",M(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}}},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNodeStream=void 0;var n=e(1),i=e(33);let o=Kv(),s=YT(),l=JT(),c=QT(),u=/^file:\/\/\/[a-zA-Z]:\//;function p(E){let b=c.parse(E);return b.protocol==="file:"||b.host?b:/^[a-z]:[/\\]/i.test(E)?c.parse(`file:///${E}`):(b.host||(b.protocol="file:"),b)}class f{constructor(b){this.source=b,this.url=p(b.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&b.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new M(this):new d(this),this._fullRequestReader}getRangeReader(b,g){if(g<=this._progressiveDataLength)return null;let v=this.isFsUrl?new k(this,b,g):new h(this,b,g);return this._rangeRequestReaders.push(v),v}cancelAllRequests(b){this._fullRequestReader&&this._fullRequestReader.cancel(b);for(let g of this._rangeRequestReaders.slice(0))g.cancel(b)}}t.PDFNodeStream=f;class w{constructor(b){this._url=b.url,this._done=!1,this._storedError=null,this.onProgress=null;let g=b.source;this._contentLength=g.length,this._loaded=0,this._filename=null,this._disableRange=g.disableRange||!1,this._rangeChunkSize=g.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!g.disableStream,this._isRangeSupported=!g.disableRange,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)(),this._headersCapability=(0,n.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let b=this._readableStream.read();return b===null?(this._readCapability=(0,n.createPromiseCapability)(),this.read()):(this._loaded+=b.length,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(b).buffer,done:!1})}cancel(b){if(!this._readableStream){this._error(b);return}this._readableStream.destroy(b)}_error(b){this._storedError=b,this._readCapability.resolve()}_setReadableStream(b){this._readableStream=b,b.on("readable",()=>{this._readCapability.resolve()}),b.on("end",()=>{b.destroy(),this._done=!0,this._readCapability.resolve()}),b.on("error",g=>{this._error(g)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new n.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class A{constructor(b){this._url=b.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)();let g=b.source;this._isStreamingSupported=!g.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let b=this._readableStream.read();return b===null?(this._readCapability=(0,n.createPromiseCapability)(),this.read()):(this._loaded+=b.length,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(b).buffer,done:!1})}cancel(b){if(!this._readableStream){this._error(b);return}this._readableStream.destroy(b)}_error(b){this._storedError=b,this._readCapability.resolve()}_setReadableStream(b){this._readableStream=b,b.on("readable",()=>{this._readCapability.resolve()}),b.on("end",()=>{b.destroy(),this._done=!0,this._readCapability.resolve()}),b.on("error",g=>{this._error(g)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function m(E,b){return{protocol:E.protocol,auth:E.auth,host:E.hostname,port:E.port,path:E.path,method:"GET",headers:b}}class d extends w{constructor(b){super(b);let g=v=>{if(v.statusCode===404){let D=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=D,this._headersCapability.reject(D);return}this._headersCapability.resolve(),this._setReadableStream(v);let y=D=>this._readableStream.headers[D.toLowerCase()],{allowRangeRequests:V,suggestedLength:B}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:y,isHttp:b.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=V,this._contentLength=B||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(y)};this._request=null,this._url.protocol==="http:"?this._request=s.request(m(this._url,b.httpHeaders),g):this._request=l.request(m(this._url,b.httpHeaders),g),this._request.on("error",v=>{this._storedError=v,this._headersCapability.reject(v)}),this._request.end()}}class h extends A{constructor(b,g,v){super(b),this._httpHeaders={};for(let V in b.httpHeaders){let B=b.httpHeaders[V];typeof B>"u"||(this._httpHeaders[V]=B)}this._httpHeaders.Range=`bytes=${g}-${v-1}`;let y=V=>{if(V.statusCode===404){let B=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=B;return}this._setReadableStream(V)};this._request=null,this._url.protocol==="http:"?this._request=s.request(m(this._url,this._httpHeaders),y):this._request=l.request(m(this._url,this._httpHeaders),y),this._request.on("error",V=>{this._storedError=V}),this._request.end()}}class M extends w{constructor(b){super(b);let g=decodeURIComponent(this._url.path);u.test(this._url.href)&&(g=g.replace(/^\//,"")),o.lstat(g,(v,y)=>{if(v){v.code==="ENOENT"&&(v=new n.MissingPDFException(`Missing PDF "${g}".`)),this._storedError=v,this._headersCapability.reject(v);return}this._contentLength=y.size,this._setReadableStream(o.createReadStream(g)),this._headersCapability.resolve()})}}class k extends A{constructor(b,g,v){super(b);let y=decodeURIComponent(this._url.path);u.test(this._url.href)&&(y=y.replace(/^\//,"")),this._setReadableStream(o.createReadStream(y,{start:g,end:v-1}))}}},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createResponseStatusError=c,t.extractFilenameFromHeader=l,t.validateRangeRequestCapabilities=s,t.validateResponseStatus=u;var n=e(1),i=e(34),o=e(8);function s({getResponseHeader:p,isHttp:f,rangeChunkSize:w,disableRange:A}){let m={allowRangeRequests:!1,suggestedLength:void 0},d=parseInt(p("Content-Length"),10);return!Number.isInteger(d)||(m.suggestedLength=d,d<=2*w)||A||!f||p("Accept-Ranges")!=="bytes"||(p("Content-Encoding")||"identity")!=="identity"||(m.allowRangeRequests=!0),m}function l(p){let f=p("Content-Disposition");if(f){let w=(0,i.getFilenameFromContentDispositionHeader)(f);if(w.includes("%"))try{w=decodeURIComponent(w)}catch{}if((0,o.isPdfFile)(w))return w}return null}function c(p,f){return p===404||p===0&&f.startsWith("file:")?new n.MissingPDFException('Missing PDF "'+f+'".'):new n.UnexpectedResponseException(`Unexpected server response (${p}) while retrieving PDF "${f}".`,p)}function u(p){return p===200||p===206}},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFilenameFromContentDispositionHeader=i;var n=e(1);function i(o){let s=!0,l=c("filename\\*","i").exec(o);if(l){l=l[1];let d=w(l);return d=unescape(d),d=A(d),d=m(d),p(d)}if(l=f(o),l){let d=m(l);return p(d)}if(l=c("filename","i").exec(o),l){l=l[1];let d=w(l);return d=m(d),p(d)}function c(d,h){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function u(d,h){if(d){if(!/^[\x00-\xFF]+$/.test(h))return h;try{let M=new TextDecoder(d,{fatal:!0}),k=(0,n.stringToBytes)(h);h=M.decode(k),s=!1}catch{}}return h}function p(d){return s&&/[\x80-\xff]/.test(d)&&(d=u("utf-8",d),s&&(d=u("iso-8859-1",d))),d}function f(d){let h=[],M,k=c("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(M=k.exec(d))!==null;){let[,b,g,v]=M;if(b=parseInt(b,10),b in h){if(b===0)break;continue}h[b]=[g,v]}let E=[];for(let b=0;b<h.length&&b in h;++b){let[g,v]=h[b];v=w(v),g&&(v=unescape(v),b===0&&(v=A(v))),E.push(v)}return E.join("")}function w(d){if(d.startsWith('"')){let h=d.slice(1).split('\\"');for(let M=0;M<h.length;++M){let k=h[M].indexOf('"');k!==-1&&(h[M]=h[M].slice(0,k),h.length=M+1),h[M]=h[M].replace(/\\(.)/g,"$1")}d=h.join('"')}return d}function A(d){let h=d.indexOf("'");if(h===-1)return d;let M=d.slice(0,h),E=d.slice(h+1).replace(/^[^']*'/,"");return u(M,E)}function m(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,M,k,E){if(k==="q"||k==="Q")return E=E.replace(/_/g," "),E=E.replace(/=([0-9a-fA-F]{2})/g,function(b,g){return String.fromCharCode(parseInt(g,16))}),u(M,E);try{E=atob(E)}catch{}return u(M,E)})}return""}},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNetworkStream=void 0;var n=e(1),i=e(33);let o=200,s=206;function l(w){let A=w.response;return typeof A!="string"?A:(0,n.stringToBytes)(A).buffer}class c{constructor(A,m={}){this.url=A,this.isHttp=/^https?:/i.test(A),this.httpHeaders=this.isHttp&&m.httpHeaders||Object.create(null),this.withCredentials=m.withCredentials||!1,this.getXhr=m.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(A,m,d){let h={begin:A,end:m};for(let M in d)h[M]=d[M];return this.request(h)}requestFull(A){return this.request(A)}request(A){let m=this.getXhr(),d=this.currXhrId++,h=this.pendingRequests[d]={xhr:m};m.open("GET",this.url),m.withCredentials=this.withCredentials;for(let M in this.httpHeaders){let k=this.httpHeaders[M];typeof k>"u"||m.setRequestHeader(M,k)}return this.isHttp&&"begin"in A&&"end"in A?(m.setRequestHeader("Range",`bytes=${A.begin}-${A.end-1}`),h.expectedStatus=s):h.expectedStatus=o,m.responseType="arraybuffer",A.onError&&(m.onerror=function(M){A.onError(m.status)}),m.onreadystatechange=this.onStateChange.bind(this,d),m.onprogress=this.onProgress.bind(this,d),h.onHeadersReceived=A.onHeadersReceived,h.onDone=A.onDone,h.onError=A.onError,h.onProgress=A.onProgress,m.send(null),d}onProgress(A,m){let d=this.pendingRequests[A];d&&d.onProgress?.(m)}onStateChange(A,m){let d=this.pendingRequests[A];if(!d)return;let h=d.xhr;if(h.readyState>=2&&d.onHeadersReceived&&(d.onHeadersReceived(),delete d.onHeadersReceived),h.readyState!==4||!(A in this.pendingRequests))return;if(delete this.pendingRequests[A],h.status===0&&this.isHttp){d.onError?.(h.status);return}let M=h.status||o;if(!(M===o&&d.expectedStatus===s)&&M!==d.expectedStatus){d.onError?.(h.status);return}let E=l(h);if(M===s){let b=h.getResponseHeader("Content-Range"),g=/bytes (\d+)-(\d+)\/(\d+)/.exec(b);d.onDone({begin:parseInt(g[1],10),chunk:E})}else E?d.onDone({begin:0,chunk:E}):d.onError?.(h.status)}getRequestXhr(A){return this.pendingRequests[A].xhr}isPendingRequest(A){return A in this.pendingRequests}abortRequest(A){let m=this.pendingRequests[A].xhr;delete this.pendingRequests[A],m.abort()}}class u{constructor(A){this._source=A,this._manager=new c(A.url,{httpHeaders:A.httpHeaders,withCredentials:A.withCredentials}),this._rangeChunkSize=A.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(A){let m=this._rangeRequestReaders.indexOf(A);m>=0&&this._rangeRequestReaders.splice(m,1)}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new p(this._manager,this._source),this._fullRequestReader}getRangeReader(A,m){let d=new f(this._manager,A,m);return d.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(d),d}cancelAllRequests(A){this._fullRequestReader?.cancel(A);for(let m of this._rangeRequestReaders.slice(0))m.cancel(A)}}t.PDFNetworkStream=u;class p{constructor(A,m){this._manager=A;let d={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=m.url,this._fullRequestId=A.requestFull(d),this._headersReceivedCapability=(0,n.createPromiseCapability)(),this._disableRange=m.disableRange||!1,this._contentLength=m.length,this._rangeChunkSize=m.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let A=this._fullRequestId,m=this._manager.getRequestXhr(A),d=k=>m.getResponseHeader(k),{allowRangeRequests:h,suggestedLength:M}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:d,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});h&&(this._isRangeSupported=!0),this._contentLength=M||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(d),this._isRangeSupported&&this._manager.abortRequest(A),this._headersReceivedCapability.resolve()}_onDone(A){if(A&&(this._requests.length>0?this._requests.shift().resolve({value:A.chunk,done:!1}):this._cachedChunks.push(A.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let m of this._requests)m.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(A){this._storedError=(0,i.createResponseStatusError)(A,this._url),this._headersReceivedCapability.reject(this._storedError);for(let m of this._requests)m.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(A){this.onProgress?.({loaded:A.loaded,total:A.lengthComputable?A.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let A=(0,n.createPromiseCapability)();return this._requests.push(A),A.promise}cancel(A){this._done=!0,this._headersReceivedCapability.reject(A);for(let m of this._requests)m.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class f{constructor(A,m,d){this._manager=A;let h={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=A.url,this._requestId=A.requestRange(m,d,h),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(A){let m=A.chunk;this._requests.length>0?this._requests.shift().resolve({value:m,done:!1}):this._queuedChunk=m,this._done=!0;for(let d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(A){this._storedError=(0,i.createResponseStatusError)(A,this._url);for(let m of this._requests)m.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(A){this.isStreamingSupported||this.onProgress?.({loaded:A.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let m=this._queuedChunk;return this._queuedChunk=null,{value:m,done:!1}}if(this._done)return{value:void 0,done:!0};let A=(0,n.createPromiseCapability)();return this._requests.push(A),A.promise}cancel(A){this._done=!0;for(let m of this._requests)m.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(r,t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFFetchStream=void 0;var n=e(1),i=e(33);function o(p,f,w){return{method:"GET",headers:p,signal:w.signal,mode:"cors",credentials:f?"include":"same-origin",redirect:"follow"}}function s(p){let f=new Headers;for(let w in p){let A=p[w];typeof A>"u"||f.append(w,A)}return f}class l{constructor(f){this.source=f,this.isHttp=/^https?:/i.test(f.url),this.httpHeaders=this.isHttp&&f.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new c(this),this._fullRequestReader}getRangeReader(f,w){if(w<=this._progressiveDataLength)return null;let A=new u(this,f,w);return this._rangeRequestReaders.push(A),A}cancelAllRequests(f){this._fullRequestReader&&this._fullRequestReader.cancel(f);for(let w of this._rangeRequestReaders.slice(0))w.cancel(f)}}t.PDFFetchStream=l;class c{constructor(f){this._stream=f,this._reader=null,this._loaded=0,this._filename=null;let w=f.source;this._withCredentials=w.withCredentials||!1,this._contentLength=w.length,this._headersCapability=(0,n.createPromiseCapability)(),this._disableRange=w.disableRange||!1,this._rangeChunkSize=w.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!w.disableStream,this._isRangeSupported=!w.disableRange,this._headers=s(this._stream.httpHeaders);let A=w.url;fetch(A,o(this._headers,this._withCredentials,this._abortController)).then(m=>{if(!(0,i.validateResponseStatus)(m.status))throw(0,i.createResponseStatusError)(m.status,A);this._reader=m.body.getReader(),this._headersCapability.resolve();let d=k=>m.headers.get(k),{allowRangeRequests:h,suggestedLength:M}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:d,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=h,this._contentLength=M||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(d),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new n.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;let{value:f,done:w}=await this._reader.read();return w?{value:f,done:w}:(this._loaded+=f.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){this._reader&&this._reader.cancel(f),this._abortController.abort()}}class u{constructor(f,w,A){this._stream=f,this._reader=null,this._loaded=0;let m=f.source;this._withCredentials=m.withCredentials||!1,this._readCapability=(0,n.createPromiseCapability)(),this._isStreamingSupported=!m.disableStream,this._abortController=new AbortController,this._headers=s(this._stream.httpHeaders),this._headers.append("Range",`bytes=${w}-${A-1}`);let d=m.url;fetch(d,o(this._headers,this._withCredentials,this._abortController)).then(h=>{if(!(0,i.validateResponseStatus)(h.status))throw(0,i.createResponseStatusError)(h.status,d);this._readCapability.resolve(),this._reader=h.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;let{value:f,done:w}=await this._reader.read();return w?{value:f,done:w}:(this._loaded+=f.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){this._reader&&this._reader.cancel(f),this._abortController.abort()}}}],__webpack_module_cache__={};function __w_pdfjs_require__(r){var t=__webpack_module_cache__[r];if(t!==void 0)return t.exports;var e=__webpack_module_cache__[r]={exports:{}};return __webpack_modules__[r](e,e.exports,__w_pdfjs_require__),e.exports}var __webpack_exports__={};return(()=>{var r=__webpack_exports__;Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"AnnotationEditorLayer",{enumerable:!0,get:function(){return i.AnnotationEditorLayer}}),Object.defineProperty(r,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return t.AnnotationEditorParamsType}}),Object.defineProperty(r,"AnnotationEditorType",{enumerable:!0,get:function(){return t.AnnotationEditorType}}),Object.defineProperty(r,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return o.AnnotationEditorUIManager}}),Object.defineProperty(r,"AnnotationLayer",{enumerable:!0,get:function(){return s.AnnotationLayer}}),Object.defineProperty(r,"AnnotationMode",{enumerable:!0,get:function(){return t.AnnotationMode}}),Object.defineProperty(r,"CMapCompressionType",{enumerable:!0,get:function(){return t.CMapCompressionType}}),Object.defineProperty(r,"GlobalWorkerOptions",{enumerable:!0,get:function(){return l.GlobalWorkerOptions}}),Object.defineProperty(r,"InvalidPDFException",{enumerable:!0,get:function(){return t.InvalidPDFException}}),Object.defineProperty(r,"LoopbackPort",{enumerable:!0,get:function(){return e.LoopbackPort}}),Object.defineProperty(r,"MissingPDFException",{enumerable:!0,get:function(){return t.MissingPDFException}}),Object.defineProperty(r,"OPS",{enumerable:!0,get:function(){return t.OPS}}),Object.defineProperty(r,"PDFDataRangeTransport",{enumerable:!0,get:function(){return e.PDFDataRangeTransport}}),Object.defineProperty(r,"PDFDateString",{enumerable:!0,get:function(){return n.PDFDateString}}),Object.defineProperty(r,"PDFWorker",{enumerable:!0,get:function(){return e.PDFWorker}}),Object.defineProperty(r,"PasswordResponses",{enumerable:!0,get:function(){return t.PasswordResponses}}),Object.defineProperty(r,"PermissionFlag",{enumerable:!0,get:function(){return t.PermissionFlag}}),Object.defineProperty(r,"PixelsPerInch",{enumerable:!0,get:function(){return n.PixelsPerInch}}),Object.defineProperty(r,"RenderingCancelledException",{enumerable:!0,get:function(){return n.RenderingCancelledException}}),Object.defineProperty(r,"SVGGraphics",{enumerable:!0,get:function(){return p.SVGGraphics}}),Object.defineProperty(r,"UNSUPPORTED_FEATURES",{enumerable:!0,get:function(){return t.UNSUPPORTED_FEATURES}}),Object.defineProperty(r,"UnexpectedResponseException",{enumerable:!0,get:function(){return t.UnexpectedResponseException}}),Object.defineProperty(r,"Util",{enumerable:!0,get:function(){return t.Util}}),Object.defineProperty(r,"VerbosityLevel",{enumerable:!0,get:function(){return t.VerbosityLevel}}),Object.defineProperty(r,"XfaLayer",{enumerable:!0,get:function(){return f.XfaLayer}}),Object.defineProperty(r,"build",{enumerable:!0,get:function(){return e.build}}),Object.defineProperty(r,"createPromiseCapability",{enumerable:!0,get:function(){return t.createPromiseCapability}}),Object.defineProperty(r,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return t.createValidAbsoluteUrl}}),Object.defineProperty(r,"getDocument",{enumerable:!0,get:function(){return e.getDocument}}),Object.defineProperty(r,"getFilenameFromUrl",{enumerable:!0,get:function(){return n.getFilenameFromUrl}}),Object.defineProperty(r,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return n.getPdfFilenameFromUrl}}),Object.defineProperty(r,"getXfaPageViewport",{enumerable:!0,get:function(){return n.getXfaPageViewport}}),Object.defineProperty(r,"isPdfFile",{enumerable:!0,get:function(){return n.isPdfFile}}),Object.defineProperty(r,"loadScript",{enumerable:!0,get:function(){return n.loadScript}}),Object.defineProperty(r,"renderTextLayer",{enumerable:!0,get:function(){return u.renderTextLayer}}),Object.defineProperty(r,"shadow",{enumerable:!0,get:function(){return t.shadow}}),Object.defineProperty(r,"version",{enumerable:!0,get:function(){return e.version}});var t=__w_pdfjs_require__(1),e=__w_pdfjs_require__(4),n=__w_pdfjs_require__(8),i=__w_pdfjs_require__(22),o=__w_pdfjs_require__(7),s=__w_pdfjs_require__(27),l=__w_pdfjs_require__(15),c=__w_pdfjs_require__(3),u=__w_pdfjs_require__(30),p=__w_pdfjs_require__(31),f=__w_pdfjs_require__(29);let w="2.16.105",A="172ccdbe5";if(c.isNodeJS){let{PDFNodeStream:m}=__w_pdfjs_require__(32);(0,e.setPDFNetworkStreamFactory)(d=>new m(d))}else{let{PDFNetworkStream:m}=__w_pdfjs_require__(35),{PDFFetchStream:d}=__w_pdfjs_require__(36);(0,e.setPDFNetworkStreamFactory)(h=>(0,n.isValidFetchUrl)(h.url)?new d(h):new m(h))}})(),__webpack_exports__})())});function Ic(r,t,e){return typeof r===t||r instanceof e}function ht(r){return Ic(r,"function",Function)}function et(r){return Ic(r,"string",String)}function dr(r){return Ic(r,"boolean",Boolean)}function Rt(r){return Ic(r,"number",Number)}function vp(r){return fe(r)||!Number.isFinite(r)||Number.isNaN(r)}function Ir(r){return Rt(r)&&!vp(r)}function bi(r){return T(r)&&Ic(r,"object",Object)}function jo(r){return r instanceof Date}function hr(r){return r instanceof Array}function Ot(r,t){throw new Error((t||"Unexpected object: ")+r)}function fe(r){return r==null}function T(r){return!fe(r)}function Y1(r){return r instanceof Uint8Array||r instanceof Uint8ClampedArray||r instanceof Int8Array||r instanceof Uint16Array||r instanceof Int16Array||r instanceof Uint32Array||r instanceof Int32Array||r instanceof Float32Array||r instanceof Float64Array||"BigUint64Array"in globalThis&&r instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&r instanceof globalThis.BigInt64Array}function J1(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function on(r){return`${r}%`}function Fp(r){return`${r}deg`}function mr(r){return`${r}em`}function yr(r){return`${r}px`}function Q1(r){return`${r}pt`}function Go(r){return`${r}fr`}function Tr(...r){return`rgb(${r.join(", ")})`}function Ap(...r){return`hsla(${r.join(", ")})`}function ba(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}var yg=class{constructor(t){this._value=t}get value(){return this._value}toString(){return this.value}},Tg=class{constructor(t,e,n){this.pre=t;this.props=e;this.post=n}get value(){return this.pre+this.props.map(t=>t.toString()).join(`
`)+this.post}toString(){return this.value}applyToSheet(t){t.insertRule(this.toString(),t.cssRules.length)}},Eg=class extends yg{constructor(e,n,i){super(i);this._name=e;this.sep=n}get name(){return this._name}toString(){return this.name+this.sep+this.value+";"}},_g=class extends Tg{constructor(t,e){super(t+` {
`,e,`
}
`)}},Mg=class extends Eg{constructor(t,e){super(t,": ",e)}},Tt=class extends Mg{constructor(e,n){super(e.replace(/[A-Z]/g,i=>`-${i.toLocaleLowerCase()}`),n.toString());this.key=e;this.priority=""}applyToElement(e){e.style[this.key]=this.value+this.priority}important(){return this.priority=" !important",this}get value(){return super.value+this.priority}};function Cg(r){return r instanceof Tt}var kg=class extends _g{constructor(t,e){super(t,e)}};function $1(r,...t){return new kg(r,t)}function Z1(r){return new Tt("alignItems",r)}function e0(r){return new Tt("backgroundColor",r)}function t0(r){return new Tt("border",r)}function n0(r){return new Tt("color",r)}function bp(r){return new Tt("columnGap",r)}function Sp(r){return new Tt("cursor",r)}function fn(r){return new Tt("display",r)}function r0(r){return new Tt("flexDirection",r)}function i0(r){return new Tt("fontSize",r)}function o0(...r){return new Tt("gap",r.join(" "))}function s0(r){return new Tt("gridAutoFlow",r)}function Dg(r,t){return et(r)||(r=[r,t].filter(T).join("/")),new Tt("gridColumn",r)}function Pg(r,t){return et(r)||(r=[r,t].filter(T).join("/")),new Tt("gridRow",r)}function Cs(...r){return new Tt("gridTemplateColumns",r.join(" "))}function Lg(...r){return new Tt("gridTemplateRows",r.join(" "))}function go(r){return new Tt("height",r)}function a0(r){return new Tt("left",r)}function yp(...r){return new Tt("margin",r.join(" "))}function Tp(r){return new Tt("maxWidth",r)}function Ep(r){return new Tt("opacity",r)}function _p(...r){return new Tt("overflow",r.join(" "))}function Sa(...r){return new Tt("padding",r.join(" "))}function l0(r){return new Tt("paddingRight",r)}function c0(r){return new Tt("pointerEvents",r)}function u0(r){return new Tt("textAlign",r)}function p0(r){return new Tt("textOverflow",r)}function d0(r){return new Tt("top",r)}function h0(...r){return new Tt("transform",r.join(" "))}function m0(r){return new Tt("whiteSpace",r)}function Kn(r){return new Tt("width",r)}var un=class extends Error{constructor(e,n=null){super(e);this.innerError=n}};function Rr(r){return r}function f0(){return!0}function Mp(){return!1}function g0(r,t){return r&&t}function v_(r){return r}function F_(r,t,e){let n=0,i=r.length,o=Math.floor((n+i)/2),s=!1;for(;n<i&&o<r.length;){let l=r[o],c=fe(l)?null:e(l);T(c)&&t<c?i=o:(t===c&&(s=!0),n=o+1),o=Math.floor((n+i)/2)}return s||(o+=.5),o}function A_(r,t,e){e=e||v_;let n=e(t);return F_(r,n,e)}function ct(r){return r.splice(0)}function kp(r,t){for(let e=0;e<r.length;++e)if(r[e]!==t[e])return e;return-1}function Xo(r,t,e){r.splice(e,0,t)}function Wt(r,t){let e=r.indexOf(t);return e>-1?(Cp(r,e),!0):!1}function b_(r,t){for(let e=r.length-1;e>=0;--e)if(t(r[e]))return Cp(r,e);return null}function x0(r,t,e){return b_(r,n=>e(n)===t)}function Cp(r,t){return r.splice(t,1)[0]}function Un(r,...t){r.splice(0,r.length,...t)}function w0(r,t,e){let n=r?0:t.length-1,i=r?t.length:-1,o=r?1:-1;for(let s of e)for(let l=n;l!=i;l+=o){let c=t[l];if(s(c))return c}return null}function Mn(r,...t){return w0(!0,r,t)}function Ig(r,...t){return w0(!1,r,t)}function ri(r,t,e,n){let i;return ht(e)?i=e:dr(e)&&(n=e),fe(n)&&(n=!0),S_(r,t,i,n)}function S_(r,t,e,n){let i=A_(r,t,e),o=i%1===0;return i=i|0,(!o||n)&&Xo(r,t,i),i}function ya(r,t){let e=Array.from(r);return Ds(e,t),e}function Ds(r,t){r.sort((e,n)=>{let i=t(e),o=t(n);return i<o?-1:i>o?1:0})}var Rc=class{constructor(){this.listeners=new Map;this.listenerOptions=new Map}addEventListener(t,e,n){if(ht(e)){let i=this.listeners.get(t);i||(i=new Array,this.listeners.set(t,i)),i.find(o=>o===e)||(i.push(e),n&&this.listenerOptions.set(e,n))}}removeEventListener(t,e){if(ht(e)){let n=this.listeners.get(t);n&&this.removeListener(n,e)}}clearEventListeners(t){for(let[e,n]of this.listeners)if(fe(t)||t===e){for(let i of n)this.removeEventListener(t,i);ct(n),this.listeners.delete(e)}}removeListener(t,e){let n=t.findIndex(i=>i===e);n>=0&&(Cp(t,n),this.listenerOptions.has(e)&&this.listenerOptions.delete(e))}dispatchEvent(t){let e=this.listeners.get(t.type);if(e)for(let n of e){let i=this.listenerOptions.get(n);T(i)&&!dr(i)&&i.once&&this.removeListener(e,n),n.call(this,t)}return!t.defaultPrevented}},Ae=class extends Event{get type(){return super.type}constructor(t,e){super(t,e)}},qe=class extends Rc{constructor(){super(...arguments);this.bubblers=new Set;this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addEventListener(e,n,i){super.addEventListener(e,n,i)}removeEventListener(e,n){super.removeEventListener(e,n)}clearEventListeners(e){return super.clearEventListeners(e)}addScopedEventListener(e,n,i,o){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([n,i]),this.addEventListener(n,i,o)}removeScope(e){let n=this.scopes.get(e);if(n){this.scopes.delete(e);for(let[i,o]of n)this.removeEventListener(i,o)}}dispatchEvent(e){if(!super.dispatchEvent(e))return!1;if(!e.cancelBubble){for(let n of this.bubblers)if(!n.dispatchEvent(e))return!1}return!0}};var mt=class{constructor(t=!0){this.autoStart=t;this.onThens=new Array;this.onCatches=new Array;this._result=void 0;this._error=void 0;this._executionState="waiting";this._resultState="none";this.resolve=e=>{if(this.running){this._result=e,this._resultState="resolved";for(let n of this.onThens)n(e);this.clear(),this._executionState="finished"}},this.reject=e=>{if(this.running){this._error=e,this._resultState="errored";for(let n of this.onCatches)n(e);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){ct(this.onThens),ct(this.onCatches)}start(){this._executionState="running"}resolver(t){return()=>this.resolve(t)}resolveOn(t,e,n){let i=this.resolver(n);t.addEventListener(e,i),this.finally(()=>t.removeEventListener(e,i))}get result(){if(T(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((t,e)=>{this.finished?this.errored?e(this.error):t(this.result):(this.onThens.push(t),this.onCatches.push(e))})}then(t,e){return this.project().then(t,e)}catch(t){return this.project().catch(t)}finally(t){return this.project().finally(t)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(t){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",t&&this.start()}};function v0(r,t){return"on"+t in r}function dn(r,t,e,...n){fe(n)&&(n=[]);let i;if(et(e)?n.unshift(e):Rt(e)&&(i=e),!(r instanceof Rc)){if(!v0(r,t))throw new un(`Target does not have a ${t} rejection event`);for(let c of n)if(!v0(r,c))throw new un(`Target does not have a ${c} rejection event`)}let o=new mt;if(Rt(i)){let c=setTimeout(o.reject,i,`'${t}' has timed out.`);o.finally(clearTimeout.bind(globalThis,c))}let s=(c,u)=>{r.addEventListener(c,u),o.finally(()=>r.removeEventListener(c,u))};s(t,c=>o.resolve(c));let l=c=>o.reject(c);for(let c of n)s(c,l);return o}function Si(r){return r.then(f0).catch(Mp)}var ot=class{constructor(t,e,n,...i){this.key=t;this.value=e;this.bySetAttribute=n;this.tags=i.map(o=>o.toLocaleUpperCase()),Object.freeze(this)}applyToElement(t){let e=this.key.startsWith("data-");if(!(this.tags.length===0||this.tags.indexOf(t.tagName)>-1||e))console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`);else if(e){let i=this.key.substring(5);t.dataset[i]=this.value}else if(this.key==="style")Object.assign(t.style,this.value);else if(this.key==="classList"){let i=this.value.filter(Rr);i.length>0&&i.forEach(o=>t.classList.add(o))}else this.bySetAttribute?t.setAttribute(this.key,this.value):this.key in t?t[this.key]=this.value:this.value===!1?t.removeAttribute(this.key):this.value===!0?t.setAttribute(this.key,""):t.setAttribute(this.key,this.value)}};function Rg(r){return r instanceof ot}function F0(r,...t){let e=[...t],n=Mn(r,o=>o instanceof ot&&o.key==="classList");T(n)&&(Wt(r,n),e.push(...n.value));let i=Mn(r,o=>o instanceof ot&&o.key==="className");return T(i)&&(Wt(r,i),e.push(...i.value.split(" "))),e}function A0(r){return new ot("ariaValueMax",r,!1)}function b0(r){return new ot("ariaValueMin",r,!1)}function S0(r){return new ot("ariaValueNow",r,!1)}function qo(r){return new ot("autocomplete",r?"on":"off",!1,"form","input","select","textarea")}function xo(r){return new ot("autoplay",r,!1,"audio","video")}function Dp(r){return new ot("checked",r,!1,"command","input")}function Xe(r){return new ot("className",r,!1)}function Ne(...r){return new ot("classList",r,!1)}function Bg(r){return new ot("colspan",r,!1,"td","th")}function Br(r){return new ot("controls",r,!1,"audio","video")}function kn(r,t){return new ot("data-"+r.toLowerCase(),t,!1)}function Bc(r){return new ot("draggable",r,!1)}function y0(r){return new ot("htmlFor",r,!1,"label","output")}function T0(r){return new ot("height",r,!1,"canvas","embed","iframe","img","input","object","video")}function Ct(r){return new ot("id",r,!1)}function Pp(r){return new ot("list",r,!0,"input")}function Ko(r){return new ot("loop",r,!1,"audio","bgsound","marquee","video")}function vt(r){return new ot("max",r,!1,"input","meter","progress")}function Ft(r){return new ot("min",r,!1,"input","meter")}function E0(r){return new ot("multiple",r,!1,"input","select")}function Lp(r){return new ot("muted",r,!1,"audio","video")}function Ta(r){return new ot("name",r,!1,"button","form","fieldset","iframe","input","keygen","object","output","select","textarea","map","meta","param")}function _0(r){return new ot("open",r,!1,"details")}function Ut(r){return new ot("placeholder",r,!1,"input","textarea")}function M0(r){return new ot("rel",r,!1,"a","area","link")}function Yo(r){return new ot("required",r,!1,"input","select","textarea")}function k0(r){return new ot("role",r,!1)}function C0(r){return new ot("selected",r,!1,"option")}function y_(r){return r instanceof URL&&(r=r.href),r}function Zn(r){return new ot("src",y_(r),!1,"audio","embed","iframe","img","input","script","source","track","video")}function Vc(r){return new ot("srcObject",r,!1,"audio","video")}function ft(r){return new ot("step",r,!1,"input")}function D0(r){return new ot("tabindex",r,!1)}function Er(r){return new ot("title",r,!1)}function Kr(r){return et(r)||(r=r.value),new ot("type",r,!1,"button","input","command","embed","link","object","script","source","style","menu")}function hn(r){return new ot("value",r,!1,"button","data","input","li","meter","option","progress","param")}function P0(r){return new ot("width",r,!1,"canvas","embed","iframe","img","input","object","video")}function Ea(r){return new ot("wrap",r,!1,"textarea")}function Oc(r){return bi(r)?r.element instanceof Element:!1}function sn(r){return Oc(r)?r.element:et(r)?Rp(r):r}function L0(r){return bi(r)&&"applyToElement"in r&&ht(r.applyToElement)}function I0(r){return r instanceof Element||Oc(r)||L0(r)||et(r)||Rt(r)||dr(r)||jo(r)}function R0(r){return Oc(r)||r instanceof Element}function st(r,t,e=""){r=sn(r),r.style.display=t?e:"none"}function zn(r){return r=sn(r),r.style.display!=="none"}function B0(r,t="block"){st(r,!zn(r),t)}function Wi(r,t,e){r=sn(r),t=sn(t),e=sn(e),r&&t&&r.insertBefore(t,e)}function Nc(r){if(r=sn(r),r.parentElement){for(let t=0;t<r.parentElement.childElementCount;++t)if(r.parentElement.children[t]===r)return t}return null}function Vg(r,t){return r=sn(r),r.dataset[t.toLowerCase()]}function We(r,...t){r=sn(r);for(let e of t)T(e)&&(e instanceof Node?r.append(e):Oc(e)?r.append(sn(e)):L0(e)?e.applyToElement(r):r.append(document.createTextNode(e.toLocaleString())));return r}function V0(r){r=sn(r),T(r)&&r.remove()}function Ip(r,...t){return r=sn(r),r.replaceWith(...t.map(sn)),r}function Og(r,t){let e=De(),n=t(e);return Ip(e,Ip(r,n)),n}function Rp(r){return document.querySelector(r)}function Bp(r){return Array.from(document.querySelectorAll(r))}function O0(r){return Rp(r)}function Mt(r,...t){let e=null;for(let n of t)if(n instanceof ot&&n.key==="id"){e=document.getElementById(n.value);break}return e==null&&(e=document.createElement(r)),We(e,...t),e}function Jo(r){return bi(r)&&"disabled"in r&&dr(r.disabled)}function Bt(r){for(r=sn(r);r.lastChild;)r.lastChild.remove()}function Ye(r,t){r=sn(r),Bt(r),r.append(E_(t))}function N0(r){return r=sn(r),r.innerText}function _a(r,t){r=sn(r),r.title=t}function jn(r,t,e){r=sn(r);let n=T(e),i=n&&r.classList.contains(e);n&&i!==t&&r.classList.toggle(e)}function Qo(r,t,e,n){r=sn(r),r.disabled=!t,Ye(r,e),_a(r,n)}async function H0(r,t,e){T(e)&&e.start();let n=r==="canplay"?t.HAVE_CURRENT_DATA:t.HAVE_ENOUGH_DATA;if(t.readyState>=n)return!0;try{return await dn(t,r,"error"),!0}catch(i){return console.warn(t.error,i),!1}finally{T(e)&&e.end()}}function W0(r,t){return H0("canplay",r,t)}function Vp(r,t){return H0("canplaythrough",r,t)}function ii(...r){return Mt("audio",...r)}function U0(...r){return Mt("button",...r)}function oi(...r){return U0(...r,Kr("button"))}function Ps(...r){return oi(...r,Ne("btn","btn-sm"))}function yi(...r){return oi(...r,Ne("btn","btn-primary"))}function er(...r){return oi(...r,Ne("btn","btn-sm","btn-primary"))}function Ma(...r){return oi(...r,Ne("btn","btn-secondary"))}function ka(...r){return oi(...r,Ne("btn","btn-sm","btn-secondary"))}function z0(...r){return oi(...r,Ne("btn","btn-sm","btn-outline-secondary"))}function j0(...r){return oi(...r,Ne("btn","btn-danger"))}function Op(...r){return oi(...r,Ne("btn","btn-sm","btn-danger"))}function G0(...r){return U0(...r,Kr("reset"))}function Ca(...r){return Mt("canvas",...r)}function X0(...r){return Mt("datalist",...r)}function Ng(...r){return Mt("dd",...r)}function q0(...r){return Mt("details",...r)}function De(...r){return Mt("div",...r)}function K0(...r){return Mt("dl",...r)}function Y0(...r){return Mt("dt",...r)}function J0(...r){return Mt("h1",...r)}function Np(...r){return Mt("h2",...r)}function Q0(...r){return Mt("h3",...r)}function Hg(...r){return Mt("hr",...r)}function T_(...r){return Mt("i",...r)}function $0(r,...t){return T_(Xe(`fa fa-${r}`),...t)}function Da(...r){return Mt("iframe",...r)}function tr(...r){return Mt("img",...r)}function Ls(...r){return Mt("input",...r)}function Hc(...r){return Mt("label",...r)}function Pa(r,t,e){return sn(e).id=r,[Hc(y0(r),t),e]}function Z0(...r){return Mt("li",...r)}function eF(...r){return Mt("link",...r)}function tF(...r){return Mt("meter",...r)}function Bn(...r){return Mt("option",...r)}function nF(...r){return Mt("script",...r)}function fr(...r){return Mt("select",...r)}function Ui(...r){return Mt("span",...r)}function rF(...r){return Mt("summary",...r)}function iF(...r){return Mt("table",...r)}function oF(...r){return Mt("tbody",...r)}function Hp(...r){return Mt("td",...r)}function zi(...r){return Mt("textarea",...r)}function sF(...r){return Mt("tfoot",...r)}function La(...r){return Mt("th",...r)}function aF(...r){return Mt("thead",...r)}function Ia(...r){return Mt("tr",...r)}function lF(...r){return Mt("ul",...r)}function Is(...r){return Mt("video",...r)}function nr(...r){return Ls(Kr("checkbox"),...r)}function Wp(...r){return Ls(Kr("date"),...r)}function cF(...r){return Ls(Kr("file"),...r)}function Vr(...r){return Ls(Kr("number"),...r)}function uF(...r){return Ls(Kr("range"),...r)}function gr(...r){return Ls(Kr("text"),...r)}function pF(...r){return Ls(Kr("url"),...r)}function E_(r){return document.createTextNode(r)}function an(...r){return De(yp("auto"),...r)}function dF(...r){let t=document.createElement("style");document.head.append(t);for(let e of r)e.applyToSheet(t.sheet)}var Yr=class extends qe{constructor(){super(...arguments);this.attached=new Array;this.soFar=null;this.total=null;this.msg=null;this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(e,n,i,o){this.soFar=e,this.total=n,this.msg=i,this.est=o;for(let s of this.attached)s.report(e,n,i,o)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(e){this.report(0,1,e||"starting")}end(e){this.report(1,1,e||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,ct(this.attached)}};var Wc=class extends Yr{constructor(e,n){super();this.i=e;this.prog=n}report(e,n,i,o){super.report(e,n,i,o),this.prog.update(this.i,e,n,i)}};var Ra=class{constructor(t){this.prog=t;this.weightTotal=0;this.subProgressCallbacks=new Array;this.subProgressWeights=new Array;this.subProgressValues=new Array;this.start=performance.now();for(let e=0;e<this.subProgressWeights.length;++e)this.subProgressValues[e]=0,this.subProgressCallbacks[e]=new Wc(e,this)}addSubProgress(t){t=t||1,this.weightTotal+=t,this.subProgressWeights.push(t),this.subProgressValues.push(0);let e=new Wc(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(e),e}update(t,e,n,i){if(this.prog){this.subProgressValues[t]=e/n;let o=0;for(let u=0;u<this.subProgressWeights.length;++u)o+=this.subProgressValues[u]*this.subProgressWeights[u];let s=performance.now(),l=s-this.start,c=this.start-s+l*this.weightTotal/o;this.prog.report(o,this.weightTotal,i,c)}}};function Gt(r,t){return new Wg(t,r).subProgressCallbacks}function Up(r,t){let e=new Array(t);for(let n=0;n<t;++n)e[n]=1;return Gt(r,e)}var Wg=class extends Ra{constructor(t,e){super(e);for(let n of t)this.addSubProgress(n)}};async function Uc(r,t){let e=new Array(t.length),n=new Array(t.length);for(let s=0;s<t.length;++s){let l=t[s];e[s]=l[0],n[s]=l[1]}let i=Gt(r,e),o=new Array(t.length);for(let s=0;s<t.length;++s)o[s]=n[s](i[s]);return await Promise.all(o)}function hF(r,...t){let e=t.map(n=>[1,n]);return Uc(r,e)}var Ug={};pr(Ug,{Application_A2L:()=>M_,Application_AML:()=>W_,Application_ATF:()=>G_,Application_ATFX:()=>X_,Application_ATXML:()=>nM,Application_Activemessage:()=>k_,Application_Alto_CostmapJson:()=>P_,Application_Alto_CostmapfilterJson:()=>D_,Application_Alto_DirectoryJson:()=>L_,Application_Alto_EndpointcostJson:()=>I_,Application_Alto_EndpointcostparamsJson:()=>R_,Application_Alto_EndpointpropJson:()=>B_,Application_Alto_EndpointpropparamsJson:()=>V_,Application_Alto_ErrorJson:()=>O_,Application_Alto_NetworkmapJson:()=>H_,Application_Alto_NetworkmapfilterJson:()=>N_,Application_Andrew_Inset:()=>U_,Application_Applefile:()=>z_,Application_Applixware:()=>j_,Application_AtomXml:()=>Q_,Application_AtomcatXml:()=>q_,Application_AtomdeletedXml:()=>K_,Application_Atomicmail:()=>Y_,Application_AtomsvcXml:()=>J_,Application_Atsc_DwdXml:()=>$_,Application_Atsc_HeldXml:()=>Z_,Application_Atsc_RdtJson:()=>eM,Application_Atsc_RsatXml:()=>tM,Application_Auth_PolicyXml:()=>rM,Application_Bacnet_XddZip:()=>iM,Application_Batch_SMTP:()=>oM,Application_Bdoc:()=>sM,Application_BeepXml:()=>aM,Application_CALS_1840:()=>pM,Application_CDFXXML:()=>xM,Application_CEA:()=>yM,Application_CSTAdataXml:()=>WM,Application_CalendarJson:()=>lM,Application_CalendarXml:()=>cM,Application_Call_Completion:()=>uM,Application_Cbor:()=>dM,Application_Cbor_Seq:()=>hM,Application_Cccex:()=>mM,Application_CcmpXml:()=>fM,Application_CcxmlXml:()=>gM,Application_Cdmi_Capability:()=>wM,Application_Cdmi_Container:()=>vM,Application_Cdmi_Domain:()=>FM,Application_Cdmi_Object:()=>AM,Application_Cdmi_Queue:()=>bM,Application_Cdni:()=>SM,Application_Cea_2018Xml:()=>TM,Application_CellmlXml:()=>EM,Application_Cfw:()=>_M,Application_ClueXml:()=>kM,Application_Clue_infoXml:()=>MM,Application_Cms:()=>CM,Application_CnrpXml:()=>DM,Application_Coap_GroupJson:()=>PM,Application_Coap_Payload:()=>LM,Application_Commonground:()=>IM,Application_Conference_InfoXml:()=>RM,Application_Cose:()=>BM,Application_Cose_Key:()=>VM,Application_Cose_Key_Set:()=>OM,Application_CplXml:()=>NM,Application_Csrattrs:()=>HM,Application_CstaXml:()=>UM,Application_CsvmJson:()=>zM,Application_Cu_Seeme:()=>jM,Application_Cwt:()=>GM,Application_Cybercash:()=>XM,Application_DCD:()=>$M,Application_DII:()=>i2,Application_DIT:()=>o2,Application_Dart:()=>qM,Application_DashXml:()=>YM,Application_Dashdelta:()=>KM,Application_DavmountXml:()=>JM,Application_Dca_Rft:()=>QM,Application_Dec_Dx:()=>ZM,Application_Dialog_InfoXml:()=>e2,Application_Dicom:()=>t2,Application_DicomJson:()=>n2,Application_DicomXml:()=>r2,Application_Dns:()=>s2,Application_DnsJson:()=>l2,Application_Dns_Message:()=>a2,Application_DocbookXml:()=>c2,Application_DotsCbor:()=>u2,Application_DskppXml:()=>p2,Application_DsscDer:()=>d2,Application_DsscXml:()=>h2,Application_Dvcs:()=>m2,Application_EDIFACT:()=>w2,Application_EDI_Consent:()=>g2,Application_EDI_X12:()=>x2,Application_Ecmascript:()=>f2,Application_Efi:()=>v2,Application_EmergencyCallDataCommentXml:()=>F2,Application_EmergencyCallDataControlXml:()=>A2,Application_EmergencyCallDataDeviceInfoXml:()=>b2,Application_EmergencyCallDataECallMSD:()=>S2,Application_EmergencyCallDataProviderInfoXml:()=>y2,Application_EmergencyCallDataServiceInfoXml:()=>T2,Application_EmergencyCallDataSubscriberInfoXml:()=>E2,Application_EmergencyCallDataVEDSXml:()=>_2,Application_EmmaXml:()=>M2,Application_EmotionmlXml:()=>k2,Application_Encaprtp:()=>C2,Application_EppXml:()=>D2,Application_EpubZip:()=>P2,Application_Eshop:()=>L2,Application_Example:()=>I2,Application_Exi:()=>R2,Application_Expect_Ct_ReportJson:()=>B2,Application_Fastinfoset:()=>V2,Application_Fastsoap:()=>O2,Application_FdtXml:()=>N2,Application_FhirJson:()=>H2,Application_FhirXml:()=>W2,Application_Fido_TrustedAppsJson:()=>U2,Application_Fits:()=>z2,Application_Flexfec:()=>j2,Application_Font_Sfnt:()=>G2,Application_Font_Tdpfr:()=>X2,Application_Font_Woff:()=>q2,Application_Framework_AttributesXml:()=>K2,Application_GeoJson:()=>Y2,Application_GeoJson_Seq:()=>J2,Application_GeopackageSqlite3:()=>Q2,Application_GeoxacmlXml:()=>$2,Application_Gltf_Buffer:()=>Z2,Application_GmlXml:()=>ek,Application_GpxXml:()=>tk,Application_Gxf:()=>nk,Application_Gzip:()=>rk,Application_H224:()=>ik,Application_HeldXml:()=>ok,Application_Hjson:()=>sk,Application_Http:()=>ak,Application_Hyperstudio:()=>lk,Application_IOTP:()=>Fk,Application_ISUP:()=>Sk,Application_Ibe_Key_RequestXml:()=>ck,Application_Ibe_Pkg_ReplyXml:()=>uk,Application_Ibe_Pp_Data:()=>pk,Application_Iges:()=>dk,Application_Im_IscomposingXml:()=>hk,Application_Index:()=>mk,Application_IndexCmd:()=>fk,Application_IndexObj:()=>gk,Application_IndexResponse:()=>xk,Application_IndexVnd:()=>wk,Application_InkmlXml:()=>vk,Application_Ipfix:()=>Ak,Application_Ipp:()=>bk,Application_ItsXml:()=>yk,Application_Java_Archive:()=>Tk,Application_Java_Serialized_Object:()=>Ek,Application_Java_Vm:()=>_k,Application_Javascript:()=>Ei,Application_Jf2feedJson:()=>Mk,Application_Jose:()=>kk,Application_JoseJson:()=>Ck,Application_JrdJson:()=>Dk,Application_Json:()=>Oa,Application_Json5:()=>Pk,Application_JsonUTF8:()=>wo,Application_Json_PatchJson:()=>Lk,Application_Json_Seq:()=>Ik,Application_JsonmlJson:()=>Rk,Application_JwkJson:()=>Vk,Application_Jwk_SetJson:()=>Bk,Application_Jwt:()=>Ok,Application_Kpml_RequestXml:()=>Nk,Application_Kpml_ResponseXml:()=>Hk,Application_LXF:()=>qk,Application_LdJson:()=>Wk,Application_LgrXml:()=>Uk,Application_Link_Format:()=>zk,Application_Load_ControlXml:()=>jk,Application_LostXml:()=>Xk,Application_LostsyncXml:()=>Gk,Application_MF4:()=>yC,Application_Mac_Binhex40:()=>Kk,Application_Mac_Compactpro:()=>Yk,Application_Macwriteii:()=>Jk,Application_MadsXml:()=>Qk,Application_ManifestJson:()=>$k,Application_Marc:()=>Zk,Application_MarcxmlXml:()=>eC,Application_Mathematica:()=>tC,Application_MathmlXml:()=>iC,Application_Mathml_ContentXml:()=>nC,Application_Mathml_PresentationXml:()=>rC,Application_Mbms_Associated_Procedure_DescriptionXml:()=>oC,Application_Mbms_DeregisterXml:()=>sC,Application_Mbms_EnvelopeXml:()=>aC,Application_Mbms_MskXml:()=>cC,Application_Mbms_Msk_ResponseXml:()=>lC,Application_Mbms_Protection_DescriptionXml:()=>uC,Application_Mbms_Reception_ReportXml:()=>pC,Application_Mbms_RegisterXml:()=>hC,Application_Mbms_Register_ResponseXml:()=>dC,Application_Mbms_ScheduleXml:()=>mC,Application_Mbms_User_Service_DescriptionXml:()=>fC,Application_Mbox:()=>gC,Application_Media_Policy_DatasetXml:()=>wC,Application_Media_controlXml:()=>xC,Application_MediaservercontrolXml:()=>vC,Application_Merge_PatchJson:()=>FC,Application_Metalink4Xml:()=>AC,Application_MetalinkXml:()=>bC,Application_MetsXml:()=>SC,Application_Mikey:()=>TC,Application_Mipc:()=>EC,Application_Mmt_AeiXml:()=>_C,Application_Mmt_UsdXml:()=>MC,Application_ModsXml:()=>kC,Application_Moss_Keys:()=>CC,Application_Moss_Signature:()=>DC,Application_Mosskey_Data:()=>PC,Application_Mosskey_Request:()=>LC,Application_Mp21:()=>IC,Application_Mp4:()=>RC,Application_Mpeg4_Generic:()=>BC,Application_Mpeg4_Iod:()=>VC,Application_Mpeg4_Iod_Xmt:()=>OC,Application_Mrb_ConsumerXml:()=>NC,Application_Mrb_PublishXml:()=>HC,Application_Msc_IvrXml:()=>WC,Application_Msc_MixerXml:()=>UC,Application_Msword:()=>zC,Application_MudJson:()=>jC,Application_Multipart_Core:()=>GC,Application_Mxf:()=>XC,Application_N_Quads:()=>qC,Application_N_Triples:()=>KC,Application_Nasdata:()=>YC,Application_News_Checkgroups:()=>JC,Application_News_Groupinfo:()=>QC,Application_News_Transmission:()=>$C,Application_NlsmlXml:()=>ZC,Application_Node:()=>eD,Application_Nss:()=>tD,Application_ODA:()=>oD,Application_ODX:()=>aD,Application_Ocsp_Request:()=>nD,Application_Ocsp_Response:()=>rD,Application_Octet_Stream:()=>iD,Application_OdmXml:()=>sD,Application_Oebps_PackageXml:()=>lD,Application_Ogg:()=>cD,Application_OmdocXml:()=>uD,Application_Onenote:()=>pD,Application_Oscore:()=>dD,Application_Oxps:()=>hD,Application_P2p_OverlayXml:()=>mD,Application_PDX:()=>wD,Application_Parityfec:()=>fD,Application_Passport:()=>gD,Application_Patch_Ops_ErrorXml:()=>xD,Application_Pdf:()=>vo,Application_Pem_Certificate_Chain:()=>vD,Application_Pgp_Encrypted:()=>FD,Application_Pgp_Keys:()=>AD,Application_Pgp_Signature:()=>bD,Application_Pics_Rules:()=>SD,Application_PidfXml:()=>TD,Application_Pidf_DiffXml:()=>yD,Application_Pkcs10:()=>ED,Application_Pkcs12:()=>_D,Application_Pkcs7_Mime:()=>MD,Application_Pkcs7_Signature:()=>kD,Application_Pkcs8:()=>CD,Application_Pkcs8_Encrypted:()=>DD,Application_Pkix_Attr_Cert:()=>PD,Application_Pkix_Cert:()=>LD,Application_Pkix_Crl:()=>ID,Application_Pkix_Pkipath:()=>RD,Application_Pkixcmp:()=>BD,Application_PlsXml:()=>VD,Application_Poc_SettingsXml:()=>OD,Application_Postscript:()=>ND,Application_Ppsp_TrackerJson:()=>HD,Application_ProblemJson:()=>WD,Application_ProblemXml:()=>UD,Application_ProvenanceXml:()=>zD,Application_PrsAlvestrandTitrax_Sheet:()=>jD,Application_PrsCww:()=>GD,Application_PrsHpubZip:()=>XD,Application_PrsNprend:()=>qD,Application_PrsPlucker:()=>KD,Application_PrsRdf_Xml_Crypt:()=>YD,Application_PrsXsfXml:()=>JD,Application_PskcXml:()=>QD,Application_QSIG:()=>$D,Application_RamlYaml:()=>ZD,Application_Raptorfec:()=>eP,Application_RdapJson:()=>tP,Application_RdfXml:()=>nP,Application_ReginfoXml:()=>rP,Application_Relax_Ng_Compact_Syntax:()=>iP,Application_Remote_Printing:()=>oP,Application_ReputonJson:()=>sP,Application_Resource_ListsXml:()=>lP,Application_Resource_Lists_DiffXml:()=>aP,Application_RfcXml:()=>cP,Application_Riscos:()=>uP,Application_RlmiXml:()=>pP,Application_Rls_ServicesXml:()=>dP,Application_Route_ApdXml:()=>hP,Application_Route_S_TsidXml:()=>mP,Application_Route_UsdXml:()=>fP,Application_Rpki_Ghostbusters:()=>gP,Application_Rpki_Manifest:()=>xP,Application_Rpki_Publication:()=>wP,Application_Rpki_Roa:()=>vP,Application_Rpki_Updown:()=>FP,Application_RsdXml:()=>AP,Application_RssXml:()=>bP,Application_Rtf:()=>SP,Application_Rtploopback:()=>yP,Application_Rtx:()=>TP,Application_SGML:()=>$P,Application_SamlassertionXml:()=>EP,Application_SamlmetadataXml:()=>_P,Application_SbmlXml:()=>MP,Application_ScaipXml:()=>kP,Application_ScenarioJson:()=>C_,Application_ScimJson:()=>CP,Application_Scvp_Cv_Request:()=>DP,Application_Scvp_Cv_Response:()=>PP,Application_Scvp_Vp_Request:()=>LP,Application_Scvp_Vp_Response:()=>IP,Application_Sdp:()=>RP,Application_SeceventJwt:()=>BP,Application_SenmlCbor:()=>OP,Application_SenmlJson:()=>NP,Application_SenmlXml:()=>HP,Application_Senml_Exi:()=>VP,Application_SensmlCbor:()=>UP,Application_SensmlJson:()=>zP,Application_SensmlXml:()=>jP,Application_Sensml_Exi:()=>WP,Application_SepXml:()=>XP,Application_Sep_Exi:()=>GP,Application_Session_Info:()=>qP,Application_Set_Payment:()=>KP,Application_Set_Payment_Initiation:()=>YP,Application_Set_Registration:()=>JP,Application_Set_Registration_Initiation:()=>QP,Application_Sgml_Open_Catalog:()=>ZP,Application_ShfXml:()=>eL,Application_Sieve:()=>tL,Application_SimpleSymbolContainer:()=>iL,Application_Simple_FilterXml:()=>nL,Application_Simple_Message_Summary:()=>rL,Application_Sipc:()=>oL,Application_Slate:()=>sL,Application_Smil:()=>aL,Application_SmilXml:()=>lL,Application_Smpte336m:()=>cL,Application_SoapFastinfoset:()=>uL,Application_SoapXml:()=>pL,Application_Sparql_Query:()=>dL,Application_Sparql_ResultsXml:()=>hL,Application_Spirits_EventXml:()=>mL,Application_Sql:()=>fL,Application_Srgs:()=>gL,Application_SrgsXml:()=>xL,Application_SruXml:()=>wL,Application_SsdlXml:()=>vL,Application_SsmlXml:()=>FL,Application_StixJson:()=>AL,Application_SwidXml:()=>bL,Application_TETRA_ISI:()=>VL,Application_Tamp_Apex_Update:()=>SL,Application_Tamp_Apex_Update_Confirm:()=>yL,Application_Tamp_Community_Update:()=>TL,Application_Tamp_Community_Update_Confirm:()=>EL,Application_Tamp_Error:()=>_L,Application_Tamp_Sequence_Adjust:()=>ML,Application_Tamp_Sequence_Adjust_Confirm:()=>kL,Application_Tamp_Status_Query:()=>CL,Application_Tamp_Status_Response:()=>DL,Application_Tamp_Update:()=>PL,Application_Tamp_Update_Confirm:()=>LL,Application_Tar:()=>IL,Application_TaxiiJson:()=>RL,Application_TeiXml:()=>BL,Application_ThraudXml:()=>OL,Application_Timestamp_Query:()=>NL,Application_Timestamp_Reply:()=>HL,Application_Timestamped_Data:()=>WL,Application_TlsrptGzip:()=>UL,Application_TlsrptJson:()=>zL,Application_Tnauthlist:()=>jL,Application_Toml:()=>GL,Application_Trickle_Ice_Sdpfrag:()=>XL,Application_Trig:()=>qL,Application_TtmlXml:()=>KL,Application_Tve_Trigger:()=>YL,Application_Tzif:()=>JL,Application_Tzif_Leap:()=>QL,Application_Ubjson:()=>$L,Application_Ulpfec:()=>ZL,Application_Urc_GrpsheetXml:()=>e3,Application_Urc_RessheetXml:()=>t3,Application_Urc_TargetdescXml:()=>n3,Application_Urc_UisocketdescXml:()=>r3,Application_VcardJson:()=>i3,Application_VcardXml:()=>o3,Application_Vemmi:()=>s3,Application_Vendor_1000mindsDecision_ModelXml:()=>a3,Application_Vendor_1d_Interleaved_Parityfec:()=>l3,Application_Vendor_3MPost_It_Notes:()=>iI,Application_Vendor_3gpdash_Qoe_ReportXml:()=>c3,Application_Vendor_3gpp2BcmcsinfoXml:()=>m3,Application_Vendor_3gpp2Sms:()=>f3,Application_Vendor_3gpp2Tcap:()=>g3,Application_Vendor_3gppAccess_Transfer_EventsXml:()=>x3,Application_Vendor_3gppBsfXml:()=>w3,Application_Vendor_3gppGMOPXml:()=>v3,Application_Vendor_3gppMc_Signalling_Ear:()=>F3,Application_Vendor_3gppMcdata_Affiliation_CommandXml:()=>A3,Application_Vendor_3gppMcdata_InfoXml:()=>b3,Application_Vendor_3gppMcdata_Payload:()=>S3,Application_Vendor_3gppMcdata_Service_ConfigXml:()=>y3,Application_Vendor_3gppMcdata_Signalling:()=>T3,Application_Vendor_3gppMcdata_Ue_ConfigXml:()=>E3,Application_Vendor_3gppMcdata_User_ProfileXml:()=>_3,Application_Vendor_3gppMcptt_Affiliation_CommandXml:()=>M3,Application_Vendor_3gppMcptt_Floor_RequestXml:()=>k3,Application_Vendor_3gppMcptt_InfoXml:()=>C3,Application_Vendor_3gppMcptt_Location_InfoXml:()=>D3,Application_Vendor_3gppMcptt_Mbms_Usage_InfoXml:()=>P3,Application_Vendor_3gppMcptt_Service_ConfigXml:()=>L3,Application_Vendor_3gppMcptt_SignedXml:()=>I3,Application_Vendor_3gppMcptt_Ue_ConfigXml:()=>R3,Application_Vendor_3gppMcptt_Ue_Init_ConfigXml:()=>B3,Application_Vendor_3gppMcptt_User_ProfileXml:()=>V3,Application_Vendor_3gppMcvideo_Affiliation_CommandXml:()=>O3,Application_Vendor_3gppMcvideo_Affiliation_InfoXml:()=>N3,Application_Vendor_3gppMcvideo_InfoXml:()=>H3,Application_Vendor_3gppMcvideo_Location_InfoXml:()=>W3,Application_Vendor_3gppMcvideo_Mbms_Usage_InfoXml:()=>U3,Application_Vendor_3gppMcvideo_Service_ConfigXml:()=>z3,Application_Vendor_3gppMcvideo_Transmission_RequestXml:()=>j3,Application_Vendor_3gppMcvideo_Ue_ConfigXml:()=>G3,Application_Vendor_3gppMcvideo_User_ProfileXml:()=>X3,Application_Vendor_3gppMid_CallXml:()=>q3,Application_Vendor_3gppPic_Bw_Large:()=>K3,Application_Vendor_3gppPic_Bw_Small:()=>Y3,Application_Vendor_3gppPic_Bw_Var:()=>J3,Application_Vendor_3gppSRVCC_InfoXml:()=>eI,Application_Vendor_3gppSms:()=>Q3,Application_Vendor_3gppSmsXml:()=>$3,Application_Vendor_3gppSrvcc_ExtXml:()=>Z3,Application_Vendor_3gppState_And_Event_InfoXml:()=>tI,Application_Vendor_3gppUssdXml:()=>nI,Application_Vendor_3gpp_ImsXml:()=>u3,Application_Vendor_3gpp_ProseXml:()=>d3,Application_Vendor_3gpp_Prose_Pc3chXml:()=>p3,Application_Vendor_3gpp_V2x_Local_Service_Information:()=>h3,Application_Vendor_3lightssoftwareImagescal:()=>rI,Application_Vendor_AccpacSimplyAso:()=>oI,Application_Vendor_AccpacSimplyImp:()=>sI,Application_Vendor_Acucobol:()=>aI,Application_Vendor_Acucorp:()=>lI,Application_Vendor_AdobeAir_Application_Installer_PackageZip:()=>cI,Application_Vendor_AdobeFlashMovie:()=>uI,Application_Vendor_AdobeFormscentralFcdt:()=>pI,Application_Vendor_AdobeFxp:()=>dI,Application_Vendor_AdobePartial_Upload:()=>hI,Application_Vendor_AdobeXdpXml:()=>mI,Application_Vendor_AdobeXfdf:()=>fI,Application_Vendor_AetherImp:()=>gI,Application_Vendor_AfpcAfplinedata:()=>xI,Application_Vendor_AfpcAfplinedata_Pagedef:()=>wI,Application_Vendor_AfpcFoca_Charset:()=>vI,Application_Vendor_AfpcFoca_Codedfont:()=>FI,Application_Vendor_AfpcFoca_Codepage:()=>AI,Application_Vendor_AfpcModca:()=>bI,Application_Vendor_AfpcModca_Formdef:()=>SI,Application_Vendor_AfpcModca_Mediummap:()=>yI,Application_Vendor_AfpcModca_Objectcontainer:()=>TI,Application_Vendor_AfpcModca_Overlay:()=>EI,Application_Vendor_AfpcModca_Pagesegment:()=>_I,Application_Vendor_Ah_Barcode:()=>MI,Application_Vendor_AheadSpace:()=>kI,Application_Vendor_AirzipFilesecureAzf:()=>CI,Application_Vendor_AirzipFilesecureAzs:()=>DI,Application_Vendor_AmadeusJson:()=>PI,Application_Vendor_AmazonEbook:()=>LI,Application_Vendor_AmazonMobi8_Ebook:()=>II,Application_Vendor_AmericandynamicsAcc:()=>RI,Application_Vendor_AmigaAmi:()=>BI,Application_Vendor_AmundsenMazeXml:()=>VI,Application_Vendor_AndroidOta:()=>OI,Application_Vendor_AndroidPackage_Archive:()=>NI,Application_Vendor_Anki:()=>HI,Application_Vendor_Anser_Web_Certificate_Issue_Initiation:()=>WI,Application_Vendor_Anser_Web_Funds_Transfer_Initiation:()=>UI,Application_Vendor_AntixGame_Component:()=>zI,Application_Vendor_ApacheThriftBinary:()=>jI,Application_Vendor_ApacheThriftCompact:()=>GI,Application_Vendor_ApacheThriftJson:()=>XI,Application_Vendor_ApiJson:()=>qI,Application_Vendor_AplextorWarrpJson:()=>KI,Application_Vendor_ApothekendeReservationJson:()=>YI,Application_Vendor_AppleInstallerXml:()=>JI,Application_Vendor_AppleKeynote:()=>QI,Application_Vendor_AppleMpegurl:()=>$I,Application_Vendor_AppleNumbers:()=>ZI,Application_Vendor_ApplePages:()=>eR,Application_Vendor_ApplePkpass:()=>tR,Application_Vendor_ArastraSwi:()=>nR,Application_Vendor_AristanetworksSwi:()=>rR,Application_Vendor_ArtisanJson:()=>iR,Application_Vendor_Artsquare:()=>oR,Application_Vendor_Astraea_SoftwareIota:()=>sR,Application_Vendor_Audiograph:()=>aR,Application_Vendor_Autopackage:()=>lR,Application_Vendor_AvalonJson:()=>cR,Application_Vendor_AvistarXml:()=>uR,Application_Vendor_BalsamiqBmmlXml:()=>pR,Application_Vendor_BalsamiqBmpr:()=>dR,Application_Vendor_Banana_Accounting:()=>hR,Application_Vendor_BbfUspError:()=>mR,Application_Vendor_BbfUspMsg:()=>fR,Application_Vendor_BbfUspMsgJson:()=>gR,Application_Vendor_Bekitzur_StechJson:()=>xR,Application_Vendor_BintMed_Content:()=>wR,Application_Vendor_BiopaxRdfXml:()=>vR,Application_Vendor_Blink_Idb_Value_Wrapper:()=>FR,Application_Vendor_BlueiceMultipass:()=>AR,Application_Vendor_BluetoothEpOob:()=>bR,Application_Vendor_BluetoothLeOob:()=>SR,Application_Vendor_Bmi:()=>yR,Application_Vendor_Bpf:()=>TR,Application_Vendor_Bpf3:()=>ER,Application_Vendor_Businessobjects:()=>_R,Application_Vendor_ByuUapiJson:()=>MR,Application_Vendor_Cab_Jscript:()=>kR,Application_Vendor_Canon_Cpdl:()=>CR,Application_Vendor_Canon_Lips:()=>DR,Application_Vendor_Capasystems_PgJson:()=>PR,Application_Vendor_CendioThinlincClientconf:()=>LR,Application_Vendor_Century_SystemsTcp_stream:()=>IR,Application_Vendor_ChemdrawXml:()=>RR,Application_Vendor_Chess_Pgn:()=>BR,Application_Vendor_ChipnutsKaraoke_Mmd:()=>VR,Application_Vendor_Ciedi:()=>OR,Application_Vendor_Cinderella:()=>NR,Application_Vendor_CirpackIsdn_Ext:()=>HR,Application_Vendor_CitationstylesStyleXml:()=>WR,Application_Vendor_Claymore:()=>UR,Application_Vendor_CloantoRp9:()=>zR,Application_Vendor_ClonkC4group:()=>jR,Application_Vendor_CluetrustCartomobile_Config:()=>GR,Application_Vendor_CluetrustCartomobile_Config_Pkg:()=>XR,Application_Vendor_Coffeescript:()=>qR,Application_Vendor_CollabioXodocumentsDocument:()=>KR,Application_Vendor_CollabioXodocumentsDocument_Template:()=>YR,Application_Vendor_CollabioXodocumentsPresentation:()=>JR,Application_Vendor_CollabioXodocumentsPresentation_Template:()=>QR,Application_Vendor_CollabioXodocumentsSpreadsheet:()=>$R,Application_Vendor_CollabioXodocumentsSpreadsheet_Template:()=>ZR,Application_Vendor_CollectionDocJson:()=>eB,Application_Vendor_CollectionJson:()=>tB,Application_Vendor_CollectionNextJson:()=>nB,Application_Vendor_ComicbookZip:()=>iB,Application_Vendor_Comicbook_Rar:()=>rB,Application_Vendor_Commerce_Battelle:()=>oB,Application_Vendor_Commonspace:()=>sB,Application_Vendor_ContactCmsg:()=>aB,Application_Vendor_CoreosIgnitionJson:()=>lB,Application_Vendor_Cosmocaller:()=>cB,Application_Vendor_CrickClicker:()=>uB,Application_Vendor_CrickClickerKeyboard:()=>pB,Application_Vendor_CrickClickerPalette:()=>dB,Application_Vendor_CrickClickerTemplate:()=>hB,Application_Vendor_CrickClickerWordbank:()=>mB,Application_Vendor_CriticaltoolsWbsXml:()=>fB,Application_Vendor_CryptiiPipeJson:()=>gB,Application_Vendor_Crypto_Shade_File:()=>xB,Application_Vendor_Ctc_Posml:()=>wB,Application_Vendor_CtctWsXml:()=>vB,Application_Vendor_Cups_Pdf:()=>FB,Application_Vendor_Cups_Postscript:()=>AB,Application_Vendor_Cups_Ppd:()=>bB,Application_Vendor_Cups_Raster:()=>SB,Application_Vendor_Cups_Raw:()=>yB,Application_Vendor_Curl:()=>TB,Application_Vendor_CurlCar:()=>EB,Application_Vendor_CurlPcurl:()=>_B,Application_Vendor_CyanDeanRootXml:()=>MB,Application_Vendor_Cybank:()=>kB,Application_Vendor_D2lCoursepackage1p0Zip:()=>CB,Application_Vendor_Dart:()=>DB,Application_Vendor_Data_VisionRdz:()=>PB,Application_Vendor_DatapackageJson:()=>LB,Application_Vendor_DataresourceJson:()=>IB,Application_Vendor_DebianBinary_Package:()=>RB,Application_Vendor_DeceData:()=>BB,Application_Vendor_DeceTtmlXml:()=>VB,Application_Vendor_DeceUnspecified:()=>OB,Application_Vendor_DeceZip:()=>NB,Application_Vendor_DenovoFcselayout_Link:()=>HB,Application_Vendor_DesmumeMovie:()=>WB,Application_Vendor_Dir_BiPlate_Dl_Nosuffix:()=>UB,Application_Vendor_DmDelegationXml:()=>zB,Application_Vendor_Dna:()=>jB,Application_Vendor_DocumentJson:()=>GB,Application_Vendor_DolbyMlp:()=>XB,Application_Vendor_DolbyMobile1:()=>qB,Application_Vendor_DolbyMobile2:()=>KB,Application_Vendor_DoremirScorecloud_Binary_Document:()=>YB,Application_Vendor_Dpgraph:()=>JB,Application_Vendor_Dreamfactory:()=>QB,Application_Vendor_DriveJson:()=>$B,Application_Vendor_Ds_Keypoint:()=>ZB,Application_Vendor_DtgLocal:()=>e4,Application_Vendor_DtgLocalFlash:()=>t4,Application_Vendor_DtgLocalHtml:()=>n4,Application_Vendor_DvbAit:()=>r4,Application_Vendor_DvbDvbj:()=>i4,Application_Vendor_DvbEsgcontainer:()=>o4,Application_Vendor_DvbIpdcdftnotifaccess:()=>s4,Application_Vendor_DvbIpdcesgaccess:()=>a4,Application_Vendor_DvbIpdcesgaccess2:()=>l4,Application_Vendor_DvbIpdcesgpdd:()=>c4,Application_Vendor_DvbIpdcroaming:()=>u4,Application_Vendor_DvbIptvAlfec_Base:()=>p4,Application_Vendor_DvbIptvAlfec_Enhancement:()=>d4,Application_Vendor_DvbNotif_Aggregate_RootXml:()=>h4,Application_Vendor_DvbNotif_ContainerXml:()=>m4,Application_Vendor_DvbNotif_GenericXml:()=>f4,Application_Vendor_DvbNotif_Ia_MsglistXml:()=>g4,Application_Vendor_DvbNotif_Ia_Registration_RequestXml:()=>x4,Application_Vendor_DvbNotif_Ia_Registration_ResponseXml:()=>w4,Application_Vendor_DvbNotif_InitXml:()=>v4,Application_Vendor_DvbPfr:()=>F4,Application_Vendor_DvbService:()=>A4,Application_Vendor_Dxr:()=>b4,Application_Vendor_Dynageo:()=>S4,Application_Vendor_Dzr:()=>y4,Application_Vendor_EasykaraokeCdgdownload:()=>T4,Application_Vendor_Ecdis_Update:()=>E4,Application_Vendor_EcipRlp:()=>_4,Application_Vendor_EcowinChart:()=>M4,Application_Vendor_EcowinFilerequest:()=>k4,Application_Vendor_EcowinFileupdate:()=>C4,Application_Vendor_EcowinSeries:()=>D4,Application_Vendor_EcowinSeriesrequest:()=>P4,Application_Vendor_EcowinSeriesupdate:()=>L4,Application_Vendor_EfiImg:()=>I4,Application_Vendor_EfiIso:()=>R4,Application_Vendor_EmclientAccessrequestXml:()=>B4,Application_Vendor_Enliven:()=>V4,Application_Vendor_EnphaseEnvoy:()=>O4,Application_Vendor_EprintsDataXml:()=>N4,Application_Vendor_EpsonEsf:()=>H4,Application_Vendor_EpsonMsf:()=>W4,Application_Vendor_EpsonQuickanime:()=>U4,Application_Vendor_EpsonSalt:()=>z4,Application_Vendor_EpsonSsf:()=>j4,Application_Vendor_EricssonQuickcall:()=>G4,Application_Vendor_Espass_EspassZip:()=>X4,Application_Vendor_Eszigno3Xml:()=>q4,Application_Vendor_EtsiAocXml:()=>K4,Application_Vendor_EtsiAsic_EZip:()=>Y4,Application_Vendor_EtsiAsic_SZip:()=>J4,Application_Vendor_EtsiCugXml:()=>Q4,Application_Vendor_EtsiIptvcommandXml:()=>$4,Application_Vendor_EtsiIptvdiscoveryXml:()=>Z4,Application_Vendor_EtsiIptvprofileXml:()=>eV,Application_Vendor_EtsiIptvsad_BcXml:()=>tV,Application_Vendor_EtsiIptvsad_CodXml:()=>nV,Application_Vendor_EtsiIptvsad_NpvrXml:()=>rV,Application_Vendor_EtsiIptvserviceXml:()=>iV,Application_Vendor_EtsiIptvsyncXml:()=>oV,Application_Vendor_EtsiIptvueprofileXml:()=>sV,Application_Vendor_EtsiMcidXml:()=>aV,Application_Vendor_EtsiMheg5:()=>lV,Application_Vendor_EtsiOverload_Control_Policy_DatasetXml:()=>cV,Application_Vendor_EtsiPstnXml:()=>uV,Application_Vendor_EtsiSciXml:()=>pV,Application_Vendor_EtsiSimservsXml:()=>dV,Application_Vendor_EtsiTimestamp_Token:()=>hV,Application_Vendor_EtsiTslDer:()=>mV,Application_Vendor_EtsiTslXml:()=>fV,Application_Vendor_EudoraData:()=>gV,Application_Vendor_EvolvEcigProfile:()=>xV,Application_Vendor_EvolvEcigSettings:()=>wV,Application_Vendor_EvolvEcigTheme:()=>vV,Application_Vendor_Exstream_EmpowerZip:()=>FV,Application_Vendor_Exstream_Package:()=>AV,Application_Vendor_Ezpix_Album:()=>bV,Application_Vendor_Ezpix_Package:()=>SV,Application_Vendor_F_SecureMobile:()=>yV,Application_Vendor_Fastcopy_Disk_Image:()=>TV,Application_Vendor_Fdf:()=>EV,Application_Vendor_FdsnMseed:()=>_V,Application_Vendor_FdsnSeed:()=>MV,Application_Vendor_Ffsns:()=>kV,Application_Vendor_FiclabFlbZip:()=>CV,Application_Vendor_FilmitZfc:()=>DV,Application_Vendor_Fints:()=>PV,Application_Vendor_FiremonkeysCloudcell:()=>LV,Application_Vendor_FloGraphIt:()=>IV,Application_Vendor_FluxtimeClip:()=>RV,Application_Vendor_Font_Fontforge_Sfd:()=>BV,Application_Vendor_Framemaker:()=>VV,Application_Vendor_FrogansFnc:()=>OV,Application_Vendor_FrogansLtf:()=>NV,Application_Vendor_FscWeblaunch:()=>HV,Application_Vendor_FujitsuOasys:()=>WV,Application_Vendor_FujitsuOasys2:()=>UV,Application_Vendor_FujitsuOasys3:()=>zV,Application_Vendor_FujitsuOasysgp:()=>jV,Application_Vendor_FujitsuOasysprs:()=>GV,Application_Vendor_FujixeroxART4:()=>qV,Application_Vendor_FujixeroxART_EX:()=>XV,Application_Vendor_FujixeroxDdd:()=>KV,Application_Vendor_FujixeroxDocuworks:()=>YV,Application_Vendor_FujixeroxDocuworksBinder:()=>JV,Application_Vendor_FujixeroxDocuworksContainer:()=>QV,Application_Vendor_FujixeroxHBPL:()=>$V,Application_Vendor_Fut_Misnet:()=>ZV,Application_Vendor_FutoinCbor:()=>eO,Application_Vendor_FutoinJson:()=>tO,Application_Vendor_Fuzzysheet:()=>nO,Application_Vendor_GenomatixTuxedo:()=>rO,Application_Vendor_GenticsGrdJson:()=>iO,Application_Vendor_GeoJson:()=>lO,Application_Vendor_GeocubeXml:()=>oO,Application_Vendor_GeogebraFile:()=>sO,Application_Vendor_GeogebraTool:()=>aO,Application_Vendor_Geometry_Explorer:()=>cO,Application_Vendor_Geonext:()=>uO,Application_Vendor_Geoplan:()=>pO,Application_Vendor_Geospace:()=>dO,Application_Vendor_Gerber:()=>hO,Application_Vendor_GlobalplatformCard_Content_Mgt:()=>mO,Application_Vendor_GlobalplatformCard_Content_Mgt_Response:()=>fO,Application_Vendor_Gmx:()=>gO,Application_Vendor_Google_Apps_Document:()=>xO,Application_Vendor_Google_Apps_Presentation:()=>wO,Application_Vendor_Google_Apps_Spreadsheet:()=>vO,Application_Vendor_Google_EarthKmlXml:()=>FO,Application_Vendor_Google_EarthKmz:()=>AO,Application_Vendor_GovSkE_FormXml:()=>bO,Application_Vendor_GovSkE_FormZip:()=>SO,Application_Vendor_GovSkXmldatacontainerXml:()=>yO,Application_Vendor_Grafeq:()=>TO,Application_Vendor_Gridmp:()=>EO,Application_Vendor_Groove_Account:()=>_O,Application_Vendor_Groove_Help:()=>MO,Application_Vendor_Groove_Identity_Message:()=>kO,Application_Vendor_Groove_Injector:()=>CO,Application_Vendor_Groove_Tool_Message:()=>DO,Application_Vendor_Groove_Tool_Template:()=>PO,Application_Vendor_Groove_Vcard:()=>LO,Application_Vendor_HalJson:()=>IO,Application_Vendor_HalXml:()=>RO,Application_Vendor_HandHeld_EntertainmentXml:()=>BO,Application_Vendor_Hbci:()=>VO,Application_Vendor_HcJson:()=>OO,Application_Vendor_Hcl_Bireports:()=>NO,Application_Vendor_Hdt:()=>HO,Application_Vendor_HerokuJson:()=>WO,Application_Vendor_HheLesson_Player:()=>UO,Application_Vendor_Hp_HPGL:()=>zO,Application_Vendor_Hp_Hpid:()=>jO,Application_Vendor_Hp_Hps:()=>GO,Application_Vendor_Hp_Jlyt:()=>XO,Application_Vendor_Hp_PCL:()=>qO,Application_Vendor_Hp_PCLXL:()=>KO,Application_Vendor_Httphone:()=>YO,Application_Vendor_HydrostatixSof_Data:()=>JO,Application_Vendor_HyperJson:()=>ZO,Application_Vendor_Hyper_ItemJson:()=>QO,Application_Vendor_HyperdriveJson:()=>$O,Application_Vendor_Hzn_3d_Crossword:()=>e6,Application_Vendor_IbmAfplinedata:()=>t6,Application_Vendor_IbmElectronic_Media:()=>n6,Application_Vendor_IbmMiniPay:()=>r6,Application_Vendor_IbmModcap:()=>i6,Application_Vendor_IbmRights_Management:()=>o6,Application_Vendor_IbmSecure_Container:()=>s6,Application_Vendor_Iccprofile:()=>a6,Application_Vendor_Ieee1905:()=>l6,Application_Vendor_Igloader:()=>c6,Application_Vendor_ImagemeterFolderZip:()=>u6,Application_Vendor_ImagemeterImageZip:()=>p6,Application_Vendor_Immervision_Ivp:()=>d6,Application_Vendor_Immervision_Ivu:()=>h6,Application_Vendor_ImsImsccv1p1:()=>m6,Application_Vendor_ImsImsccv1p2:()=>f6,Application_Vendor_ImsImsccv1p3:()=>g6,Application_Vendor_ImsLisV2ResultJson:()=>x6,Application_Vendor_ImsLtiV2ToolconsumerprofileJson:()=>w6,Application_Vendor_ImsLtiV2ToolproxyIdJson:()=>v6,Application_Vendor_ImsLtiV2ToolproxyJson:()=>F6,Application_Vendor_ImsLtiV2ToolsettingsJson:()=>A6,Application_Vendor_ImsLtiV2ToolsettingsSimpleJson:()=>b6,Application_Vendor_InformedcontrolRmsXml:()=>S6,Application_Vendor_Informix_Visionary:()=>y6,Application_Vendor_InfotechProject:()=>T6,Application_Vendor_InfotechProjectXml:()=>E6,Application_Vendor_InnopathWampNotification:()=>_6,Application_Vendor_InsorsIgm:()=>M6,Application_Vendor_InterconFormnet:()=>k6,Application_Vendor_Intergeo:()=>C6,Application_Vendor_IntertrustDigibox:()=>D6,Application_Vendor_IntertrustNncp:()=>P6,Application_Vendor_IntuQbo:()=>L6,Application_Vendor_IntuQfx:()=>I6,Application_Vendor_IptcG2CatalogitemXml:()=>R6,Application_Vendor_IptcG2ConceptitemXml:()=>B6,Application_Vendor_IptcG2KnowledgeitemXml:()=>V6,Application_Vendor_IptcG2NewsitemXml:()=>O6,Application_Vendor_IptcG2NewsmessageXml:()=>N6,Application_Vendor_IptcG2PackageitemXml:()=>H6,Application_Vendor_IptcG2PlanningitemXml:()=>W6,Application_Vendor_IpunpluggedRcprofile:()=>U6,Application_Vendor_IrepositoryPackageXml:()=>z6,Application_Vendor_Is_Xpr:()=>j6,Application_Vendor_IsacFcs:()=>G6,Application_Vendor_Iso11783_10Zip:()=>X6,Application_Vendor_Jam:()=>q6,Application_Vendor_Japannet_Directory_Service:()=>K6,Application_Vendor_Japannet_Jpnstore_Wakeup:()=>Y6,Application_Vendor_Japannet_Payment_Wakeup:()=>J6,Application_Vendor_Japannet_Registration:()=>Q6,Application_Vendor_Japannet_Registration_Wakeup:()=>$6,Application_Vendor_Japannet_Setstore_Wakeup:()=>Z6,Application_Vendor_Japannet_Verification:()=>eN,Application_Vendor_Japannet_Verification_Wakeup:()=>tN,Application_Vendor_JcpJavameMidlet_Rms:()=>nN,Application_Vendor_Jisp:()=>rN,Application_Vendor_JoostJoda_Archive:()=>iN,Application_Vendor_JskIsdn_Ngn:()=>oN,Application_Vendor_Kahootz:()=>sN,Application_Vendor_KdeKarbon:()=>aN,Application_Vendor_KdeKchart:()=>lN,Application_Vendor_KdeKformula:()=>cN,Application_Vendor_KdeKivio:()=>uN,Application_Vendor_KdeKontour:()=>pN,Application_Vendor_KdeKpresenter:()=>dN,Application_Vendor_KdeKspread:()=>hN,Application_Vendor_KdeKword:()=>mN,Application_Vendor_Kenameaapp:()=>fN,Application_Vendor_Kidspiration:()=>gN,Application_Vendor_Kinar:()=>xN,Application_Vendor_Koan:()=>wN,Application_Vendor_Kodak_Descriptor:()=>vN,Application_Vendor_Las:()=>FN,Application_Vendor_LasLasJson:()=>AN,Application_Vendor_LasLasXml:()=>bN,Application_Vendor_Laszip:()=>SN,Application_Vendor_LeapJson:()=>yN,Application_Vendor_Liberty_RequestXml:()=>TN,Application_Vendor_LlamagraphicsLife_BalanceDesktop:()=>EN,Application_Vendor_LlamagraphicsLife_BalanceExchangeXml:()=>_N,Application_Vendor_LogipipeCircuitZip:()=>MN,Application_Vendor_Loom:()=>kN,Application_Vendor_Lotus_1_2_3:()=>CN,Application_Vendor_Lotus_Approach:()=>DN,Application_Vendor_Lotus_Freelance:()=>PN,Application_Vendor_Lotus_Notes:()=>LN,Application_Vendor_Lotus_Organizer:()=>IN,Application_Vendor_Lotus_Screencam:()=>RN,Application_Vendor_Lotus_Wordpro:()=>BN,Application_Vendor_MFER:()=>YN,Application_Vendor_MacportsPortpkg:()=>VN,Application_Vendor_Mapbox_Vector_Tile:()=>ON,Application_Vendor_MarlinDrmActiontokenXml:()=>NN,Application_Vendor_MarlinDrmConftokenXml:()=>HN,Application_Vendor_MarlinDrmLicenseXml:()=>WN,Application_Vendor_MarlinDrmMdcf:()=>UN,Application_Vendor_MasonJson:()=>zN,Application_Vendor_MaxmindMaxmind_Db:()=>jN,Application_Vendor_Mcd:()=>GN,Application_Vendor_Medcalcdata:()=>XN,Application_Vendor_MediastationCdkey:()=>qN,Application_Vendor_Meridian_Slingshot:()=>KN,Application_Vendor_Mfmp:()=>JN,Application_Vendor_MicroJson:()=>ZN,Application_Vendor_MicrografxFlo:()=>QN,Application_Vendor_MicrografxIgx:()=>$N,Application_Vendor_MicrosoftPortable_Executable:()=>e5,Application_Vendor_MicrosoftWindowsThumbnail_Cache:()=>t5,Application_Vendor_MieleJson:()=>n5,Application_Vendor_Mif:()=>r5,Application_Vendor_Minisoft_Hp3000_Save:()=>i5,Application_Vendor_MitsubishiMisty_GuardTrustweb:()=>o5,Application_Vendor_MobiusDAF:()=>s5,Application_Vendor_MobiusDIS:()=>a5,Application_Vendor_MobiusMBK:()=>l5,Application_Vendor_MobiusMQY:()=>c5,Application_Vendor_MobiusMSL:()=>u5,Application_Vendor_MobiusPLC:()=>p5,Application_Vendor_MobiusTXF:()=>d5,Application_Vendor_MophunApplication:()=>h5,Application_Vendor_MophunCertificate:()=>m5,Application_Vendor_MotorolaFlexsuite:()=>f5,Application_Vendor_MotorolaFlexsuiteAdsi:()=>g5,Application_Vendor_MotorolaFlexsuiteFis:()=>x5,Application_Vendor_MotorolaFlexsuiteGotap:()=>w5,Application_Vendor_MotorolaFlexsuiteKmr:()=>v5,Application_Vendor_MotorolaFlexsuiteTtc:()=>F5,Application_Vendor_MotorolaFlexsuiteWem:()=>A5,Application_Vendor_MotorolaIprm:()=>b5,Application_Vendor_MozillaXulXml:()=>S5,Application_Vendor_Ms_3mfdocument:()=>y5,Application_Vendor_Ms_Artgalry:()=>T5,Application_Vendor_Ms_Asf:()=>E5,Application_Vendor_Ms_Cab_Compressed:()=>_5,Application_Vendor_Ms_ColorIccprofile:()=>M5,Application_Vendor_Ms_Excel:()=>k5,Application_Vendor_Ms_ExcelAddinMacroEnabled12:()=>C5,Application_Vendor_Ms_ExcelSheetBinaryMacroEnabled12:()=>D5,Application_Vendor_Ms_ExcelSheetMacroEnabled12:()=>P5,Application_Vendor_Ms_ExcelTemplateMacroEnabled12:()=>L5,Application_Vendor_Ms_Fontobject:()=>I5,Application_Vendor_Ms_Htmlhelp:()=>R5,Application_Vendor_Ms_Ims:()=>B5,Application_Vendor_Ms_Lrm:()=>V5,Application_Vendor_Ms_OfficeActiveXXml:()=>O5,Application_Vendor_Ms_Officetheme:()=>N5,Application_Vendor_Ms_Opentype:()=>H5,Application_Vendor_Ms_Outlook:()=>W5,Application_Vendor_Ms_PackageObfuscated_Opentype:()=>U5,Application_Vendor_Ms_PkiSeccat:()=>z5,Application_Vendor_Ms_PkiStl:()=>j5,Application_Vendor_Ms_PlayreadyInitiatorXml:()=>G5,Application_Vendor_Ms_Powerpoint:()=>X5,Application_Vendor_Ms_PowerpointAddinMacroEnabled12:()=>q5,Application_Vendor_Ms_PowerpointPresentationMacroEnabled12:()=>K5,Application_Vendor_Ms_PowerpointSlideMacroEnabled12:()=>Y5,Application_Vendor_Ms_PowerpointSlideshowMacroEnabled12:()=>J5,Application_Vendor_Ms_PowerpointTemplateMacroEnabled12:()=>Q5,Application_Vendor_Ms_PrintDeviceCapabilitiesXml:()=>$5,Application_Vendor_Ms_PrintSchemaTicketXml:()=>e9,Application_Vendor_Ms_PrintingPrintticketXml:()=>Z5,Application_Vendor_Ms_Project:()=>t9,Application_Vendor_Ms_Tnef:()=>n9,Application_Vendor_Ms_WindowsDevicepairing:()=>r9,Application_Vendor_Ms_WindowsNwprintingOob:()=>i9,Application_Vendor_Ms_WindowsPrinterpairing:()=>o9,Application_Vendor_Ms_WindowsWsdOob:()=>s9,Application_Vendor_Ms_WmdrmLic_Chlg_Req:()=>a9,Application_Vendor_Ms_WmdrmLic_Resp:()=>l9,Application_Vendor_Ms_WmdrmMeter_Chlg_Req:()=>c9,Application_Vendor_Ms_WmdrmMeter_Resp:()=>u9,Application_Vendor_Ms_WordDocumentMacroEnabled12:()=>p9,Application_Vendor_Ms_WordTemplateMacroEnabled12:()=>d9,Application_Vendor_Ms_Works:()=>h9,Application_Vendor_Ms_Wpl:()=>m9,Application_Vendor_Ms_Xpsdocument:()=>f9,Application_Vendor_Msa_Disk_Image:()=>g9,Application_Vendor_Mseq:()=>x9,Application_Vendor_Msign:()=>w9,Application_Vendor_MultiadCreator:()=>v9,Application_Vendor_MultiadCreatorCif:()=>F9,Application_Vendor_Music_Niff:()=>A9,Application_Vendor_Musician:()=>b9,Application_Vendor_MuveeStyle:()=>S9,Application_Vendor_Mynfc:()=>y9,Application_Vendor_NcdControl:()=>T9,Application_Vendor_NcdReference:()=>E9,Application_Vendor_NearstInvJson:()=>_9,Application_Vendor_Nervana:()=>M9,Application_Vendor_Netfpx:()=>k9,Application_Vendor_NeurolanguageNlu:()=>C9,Application_Vendor_Nimn:()=>D9,Application_Vendor_NintendoNitroRom:()=>P9,Application_Vendor_NintendoSnesRom:()=>L9,Application_Vendor_Nitf:()=>I9,Application_Vendor_Noblenet_Directory:()=>R9,Application_Vendor_Noblenet_Sealer:()=>B9,Application_Vendor_Noblenet_Web:()=>V9,Application_Vendor_NokiaCatalogs:()=>O9,Application_Vendor_NokiaConmlWbxml:()=>N9,Application_Vendor_NokiaConmlXml:()=>H9,Application_Vendor_NokiaISDS_Radio_Presets:()=>U9,Application_Vendor_NokiaIptvConfigXml:()=>W9,Application_Vendor_NokiaLandmarkWbxml:()=>j9,Application_Vendor_NokiaLandmarkXml:()=>G9,Application_Vendor_NokiaLandmarkcollectionXml:()=>z9,Application_Vendor_NokiaN_GageAcXml:()=>X9,Application_Vendor_NokiaN_GageData:()=>q9,Application_Vendor_NokiaN_GageSymbianInstall:()=>K9,Application_Vendor_NokiaNcd:()=>Y9,Application_Vendor_NokiaPcdWbxml:()=>J9,Application_Vendor_NokiaPcdXml:()=>Q9,Application_Vendor_NokiaRadio_Preset:()=>$9,Application_Vendor_NokiaRadio_Presets:()=>Z9,Application_Vendor_NovadigmEDM:()=>eH,Application_Vendor_NovadigmEDX:()=>tH,Application_Vendor_NovadigmEXT:()=>nH,Application_Vendor_Ntt_LocalContent_Share:()=>rH,Application_Vendor_Ntt_LocalFile_Transfer:()=>iH,Application_Vendor_Ntt_LocalOgw_remote_Access:()=>oH,Application_Vendor_Ntt_LocalSip_Ta_remote:()=>sH,Application_Vendor_Ntt_LocalSip_Ta_tcp_stream:()=>aH,Application_Vendor_OasisOpendocumentChart:()=>lH,Application_Vendor_OasisOpendocumentChart_Template:()=>cH,Application_Vendor_OasisOpendocumentDatabase:()=>uH,Application_Vendor_OasisOpendocumentFormula:()=>pH,Application_Vendor_OasisOpendocumentFormula_Template:()=>dH,Application_Vendor_OasisOpendocumentGraphics:()=>hH,Application_Vendor_OasisOpendocumentGraphics_Template:()=>mH,Application_Vendor_OasisOpendocumentImage:()=>fH,Application_Vendor_OasisOpendocumentImage_Template:()=>gH,Application_Vendor_OasisOpendocumentPresentation:()=>xH,Application_Vendor_OasisOpendocumentPresentation_Template:()=>wH,Application_Vendor_OasisOpendocumentSpreadsheet:()=>vH,Application_Vendor_OasisOpendocumentSpreadsheet_Template:()=>FH,Application_Vendor_OasisOpendocumentText:()=>AH,Application_Vendor_OasisOpendocumentText_Master:()=>bH,Application_Vendor_OasisOpendocumentText_Template:()=>SH,Application_Vendor_OasisOpendocumentText_Web:()=>yH,Application_Vendor_Obn:()=>TH,Application_Vendor_OcfCbor:()=>EH,Application_Vendor_OftnL10nJson:()=>_H,Application_Vendor_OipfContentaccessdownloadXml:()=>MH,Application_Vendor_OipfContentaccessstreamingXml:()=>kH,Application_Vendor_OipfCspg_Hexbinary:()=>CH,Application_Vendor_OipfDaeSvgXml:()=>DH,Application_Vendor_OipfDaeXhtmlXml:()=>PH,Application_Vendor_OipfMippvcontrolmessageXml:()=>LH,Application_Vendor_OipfPaeGem:()=>IH,Application_Vendor_OipfSpdiscoveryXml:()=>RH,Application_Vendor_OipfSpdlistXml:()=>BH,Application_Vendor_OipfUeprofileXml:()=>VH,Application_Vendor_OipfUserprofileXml:()=>OH,Application_Vendor_Olpc_Sugar:()=>NH,Application_Vendor_OmaBcastAssociated_Procedure_ParameterXml:()=>zH,Application_Vendor_OmaBcastDrm_TriggerXml:()=>jH,Application_Vendor_OmaBcastImdXml:()=>GH,Application_Vendor_OmaBcastLtkm:()=>XH,Application_Vendor_OmaBcastNotificationXml:()=>qH,Application_Vendor_OmaBcastProvisioningtrigger:()=>KH,Application_Vendor_OmaBcastSgboot:()=>YH,Application_Vendor_OmaBcastSgddXml:()=>JH,Application_Vendor_OmaBcastSgdu:()=>QH,Application_Vendor_OmaBcastSimple_Symbol_Container:()=>$H,Application_Vendor_OmaBcastSmartcard_TriggerXml:()=>ZH,Application_Vendor_OmaBcastSprovXml:()=>eW,Application_Vendor_OmaBcastStkm:()=>tW,Application_Vendor_OmaCab_Address_BookXml:()=>nW,Application_Vendor_OmaCab_Feature_HandlerXml:()=>rW,Application_Vendor_OmaCab_PccXml:()=>iW,Application_Vendor_OmaCab_Subs_InviteXml:()=>oW,Application_Vendor_OmaCab_User_PrefsXml:()=>sW,Application_Vendor_OmaDcd:()=>aW,Application_Vendor_OmaDcdc:()=>lW,Application_Vendor_OmaDd2Xml:()=>cW,Application_Vendor_OmaDrmRisdXml:()=>uW,Application_Vendor_OmaGroup_Usage_ListXml:()=>mW,Application_Vendor_OmaLwm2mJson:()=>gW,Application_Vendor_OmaLwm2mTlv:()=>xW,Application_Vendor_OmaPalXml:()=>wW,Application_Vendor_OmaPocDetailed_Progress_ReportXml:()=>vW,Application_Vendor_OmaPocFinal_ReportXml:()=>FW,Application_Vendor_OmaPocGroupsXml:()=>AW,Application_Vendor_OmaPocInvocation_DescriptorXml:()=>bW,Application_Vendor_OmaPocOptimized_Progress_ReportXml:()=>SW,Application_Vendor_OmaPush:()=>yW,Application_Vendor_OmaScidmMessagesXml:()=>TW,Application_Vendor_OmaXcap_DirectoryXml:()=>EW,Application_Vendor_Oma_Scws_Config:()=>HH,Application_Vendor_Oma_Scws_Http_Request:()=>WH,Application_Vendor_Oma_Scws_Http_Response:()=>UH,Application_Vendor_Omads_EmailXml:()=>pW,Application_Vendor_Omads_FileXml:()=>dW,Application_Vendor_Omads_FolderXml:()=>hW,Application_Vendor_Omaloc_Supl_Init:()=>fW,Application_Vendor_Onepager:()=>_W,Application_Vendor_Onepagertamp:()=>MW,Application_Vendor_Onepagertamx:()=>kW,Application_Vendor_Onepagertat:()=>CW,Application_Vendor_Onepagertatp:()=>DW,Application_Vendor_Onepagertatx:()=>PW,Application_Vendor_OpenbloxGameXml:()=>IW,Application_Vendor_OpenbloxGame_Binary:()=>LW,Application_Vendor_OpeneyeOeb:()=>RW,Application_Vendor_OpenofficeorgExtension:()=>BW,Application_Vendor_OpenstreetmapDataXml:()=>VW,Application_Vendor_Openxmlformats_OfficedocumentCustomXmlPropertiesXml:()=>NW,Application_Vendor_Openxmlformats_OfficedocumentCustom_PropertiesXml:()=>OW,Application_Vendor_Openxmlformats_OfficedocumentDrawingXml:()=>XW,Application_Vendor_Openxmlformats_OfficedocumentDrawingmlChartXml:()=>WW,Application_Vendor_Openxmlformats_OfficedocumentDrawingmlChartshapesXml:()=>HW,Application_Vendor_Openxmlformats_OfficedocumentDrawingmlDiagramColorsXml:()=>UW,Application_Vendor_Openxmlformats_OfficedocumentDrawingmlDiagramDataXml:()=>zW,Application_Vendor_Openxmlformats_OfficedocumentDrawingmlDiagramLayoutXml:()=>jW,Application_Vendor_Openxmlformats_OfficedocumentDrawingmlDiagramStyleXml:()=>GW,Application_Vendor_Openxmlformats_OfficedocumentExtended_PropertiesXml:()=>qW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlCommentAuthorsXml:()=>KW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlCommentsXml:()=>YW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlHandoutMasterXml:()=>JW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlNotesMasterXml:()=>QW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlNotesSlideXml:()=>$W,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlPresPropsXml:()=>t8,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlPresentation:()=>ZW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlPresentationMainXml:()=>e8,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlSlide:()=>n8,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlSlideLayoutXml:()=>r8,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlSlideMasterXml:()=>i8,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlSlideUpdateInfoXml:()=>a8,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlSlideXml:()=>l8,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlSlideshow:()=>o8,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlSlideshowMainXml:()=>s8,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlTableStylesXml:()=>c8,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlTagsXml:()=>u8,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlTemplate:()=>p8,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlTemplateMainXml:()=>d8,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlViewPropsXml:()=>h8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlCalcChainXml:()=>m8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlChartsheetXml:()=>f8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlCommentsXml:()=>g8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlConnectionsXml:()=>x8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlDialogsheetXml:()=>w8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlExternalLinkXml:()=>v8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlPivotCacheDefinitionXml:()=>F8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlPivotCacheRecordsXml:()=>A8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlPivotTableXml:()=>b8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlQueryTableXml:()=>S8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlRevisionHeadersXml:()=>y8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlRevisionLogXml:()=>T8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlSharedStringsXml:()=>E8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlSheet:()=>_8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlSheetMainXml:()=>M8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlSheetMetadataXml:()=>k8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlStylesXml:()=>C8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlTableSingleCellsXml:()=>D8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlTableXml:()=>P8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlTemplate:()=>L8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlTemplateMainXml:()=>I8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlUserNamesXml:()=>R8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlVolatileDependenciesXml:()=>B8,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlWorksheetXml:()=>V8,Application_Vendor_Openxmlformats_OfficedocumentThemeOverrideXml:()=>O8,Application_Vendor_Openxmlformats_OfficedocumentThemeXml:()=>N8,Application_Vendor_Openxmlformats_OfficedocumentVmlDrawing:()=>H8,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlCommentsXml:()=>W8,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlDocument:()=>U8,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlDocumentGlossaryXml:()=>z8,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlDocumentMainXml:()=>j8,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlEndnotesXml:()=>G8,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlFontTableXml:()=>X8,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlFooterXml:()=>q8,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlFootnotesXml:()=>K8,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlNumberingXml:()=>Y8,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlSettingsXml:()=>J8,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlStylesXml:()=>Q8,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlTemplate:()=>$8,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlTemplateMainXml:()=>Z8,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlWebSettingsXml:()=>e7,Application_Vendor_Openxmlformats_PackageCore_PropertiesXml:()=>t7,Application_Vendor_Openxmlformats_PackageDigital_Signature_XmlsignatureXml:()=>n7,Application_Vendor_Openxmlformats_PackageRelationshipsXml:()=>r7,Application_Vendor_OracleResourceJson:()=>i7,Application_Vendor_OrangeIndata:()=>o7,Application_Vendor_OsaNetdeploy:()=>s7,Application_Vendor_OsgeoMapguidePackage:()=>a7,Application_Vendor_OsgiBundle:()=>l7,Application_Vendor_OsgiDp:()=>c7,Application_Vendor_OsgiSubsystem:()=>u7,Application_Vendor_OtpsCt_KipXml:()=>p7,Application_Vendor_OxliCountgraph:()=>d7,Application_Vendor_PagerdutyJson:()=>h7,Application_Vendor_Palm:()=>m7,Application_Vendor_Panoply:()=>f7,Application_Vendor_PaosXml:()=>g7,Application_Vendor_Patentdive:()=>x7,Application_Vendor_Patientecommsdoc:()=>w7,Application_Vendor_Pawaafile:()=>v7,Application_Vendor_Pcos:()=>F7,Application_Vendor_PgFormat:()=>A7,Application_Vendor_PgOsasli:()=>b7,Application_Vendor_PiaccessApplication_Licence:()=>S7,Application_Vendor_Picsel:()=>y7,Application_Vendor_PmiWidget:()=>T7,Application_Vendor_PocGroup_AdvertisementXml:()=>E7,Application_Vendor_Pocketlearn:()=>_7,Application_Vendor_Powerbuilder6:()=>M7,Application_Vendor_Powerbuilder6_S:()=>k7,Application_Vendor_Powerbuilder7:()=>C7,Application_Vendor_Powerbuilder75:()=>P7,Application_Vendor_Powerbuilder75_S:()=>L7,Application_Vendor_Powerbuilder7_S:()=>D7,Application_Vendor_Preminet:()=>I7,Application_Vendor_PreviewsystemsBox:()=>R7,Application_Vendor_ProteusMagazine:()=>B7,Application_Vendor_Psfs:()=>V7,Application_Vendor_Publishare_Delta_Tree:()=>O7,Application_Vendor_PviPtid1:()=>N7,Application_Vendor_Pwg_Multiplexed:()=>H7,Application_Vendor_Pwg_Xhtml_PrintXml:()=>W7,Application_Vendor_QualcommBrew_App_Res:()=>U7,Application_Vendor_Quarantainenet:()=>z7,Application_Vendor_QuarkQuarkXPress:()=>j7,Application_Vendor_Quobject_Quoxdocument:()=>G7,Application_Vendor_RadisysMomlXml:()=>X7,Application_Vendor_RadisysMsmlXml:()=>sU,Application_Vendor_RadisysMsml_AuditXml:()=>Q7,Application_Vendor_RadisysMsml_Audit_ConfXml:()=>q7,Application_Vendor_RadisysMsml_Audit_ConnXml:()=>K7,Application_Vendor_RadisysMsml_Audit_DialogXml:()=>Y7,Application_Vendor_RadisysMsml_Audit_StreamXml:()=>J7,Application_Vendor_RadisysMsml_ConfXml:()=>$7,Application_Vendor_RadisysMsml_DialogXml:()=>oU,Application_Vendor_RadisysMsml_Dialog_BaseXml:()=>Z7,Application_Vendor_RadisysMsml_Dialog_Fax_DetectXml:()=>eU,Application_Vendor_RadisysMsml_Dialog_Fax_SendrecvXml:()=>tU,Application_Vendor_RadisysMsml_Dialog_GroupXml:()=>nU,Application_Vendor_RadisysMsml_Dialog_SpeechXml:()=>rU,Application_Vendor_RadisysMsml_Dialog_TransformXml:()=>iU,Application_Vendor_RainstorData:()=>aU,Application_Vendor_Rapid:()=>lU,Application_Vendor_Rar:()=>cU,Application_Vendor_RealvncBed:()=>uU,Application_Vendor_RecordareMusicxml:()=>pU,Application_Vendor_RecordareMusicxmlXml:()=>dU,Application_Vendor_RenLearnRlprint:()=>hU,Application_Vendor_RestfulJson:()=>mU,Application_Vendor_RigCryptonote:()=>fU,Application_Vendor_RimCod:()=>gU,Application_Vendor_Rn_Realmedia:()=>xU,Application_Vendor_Rn_Realmedia_Vbr:()=>wU,Application_Vendor_Route66Link66Xml:()=>vU,Application_Vendor_Rs_274x:()=>FU,Application_Vendor_RuckusDownload:()=>AU,Application_Vendor_S3sms:()=>bU,Application_Vendor_SailingtrackerTrack:()=>SU,Application_Vendor_Sar:()=>yU,Application_Vendor_SbmCid:()=>TU,Application_Vendor_SbmMid2:()=>EU,Application_Vendor_Scribus:()=>_U,Application_Vendor_Sealed3df:()=>MU,Application_Vendor_SealedCsf:()=>kU,Application_Vendor_SealedDoc:()=>CU,Application_Vendor_SealedEml:()=>DU,Application_Vendor_SealedMht:()=>IU,Application_Vendor_SealedNet:()=>RU,Application_Vendor_SealedPpt:()=>BU,Application_Vendor_SealedTiff:()=>VU,Application_Vendor_SealedXls:()=>OU,Application_Vendor_SealedmediaSoftsealHtml:()=>PU,Application_Vendor_SealedmediaSoftsealPdf:()=>LU,Application_Vendor_Seemail:()=>NU,Application_Vendor_Sema:()=>HU,Application_Vendor_Semd:()=>WU,Application_Vendor_Semf:()=>UU,Application_Vendor_Shade_Save_File:()=>zU,Application_Vendor_ShanaInformedFormdata:()=>jU,Application_Vendor_ShanaInformedFormtemplate:()=>GU,Application_Vendor_ShanaInformedInterchange:()=>XU,Application_Vendor_ShanaInformedPackage:()=>qU,Application_Vendor_ShootproofJson:()=>KU,Application_Vendor_ShopkickJson:()=>YU,Application_Vendor_SigrokSession:()=>JU,Application_Vendor_SimTech_MindMapper:()=>QU,Application_Vendor_SirenJson:()=>$U,Application_Vendor_Smaf:()=>ZU,Application_Vendor_SmartNotebook:()=>ez,Application_Vendor_SmartTeacher:()=>tz,Application_Vendor_Software602FillerFormXml:()=>rz,Application_Vendor_Software602FillerForm_Xml_Zip:()=>nz,Application_Vendor_SolentSdkmXml:()=>iz,Application_Vendor_SpotfireDxp:()=>oz,Application_Vendor_SpotfireSfs:()=>sz,Application_Vendor_Sqlite3:()=>az,Application_Vendor_Sss_Cod:()=>lz,Application_Vendor_Sss_Dtf:()=>cz,Application_Vendor_Sss_Ntf:()=>uz,Application_Vendor_StardivisionCalc:()=>pz,Application_Vendor_StardivisionDraw:()=>dz,Application_Vendor_StardivisionImpress:()=>hz,Application_Vendor_StardivisionMath:()=>mz,Application_Vendor_StardivisionWriter:()=>fz,Application_Vendor_StardivisionWriter_Global:()=>gz,Application_Vendor_StepmaniaPackage:()=>xz,Application_Vendor_StepmaniaStepchart:()=>wz,Application_Vendor_Street_Stream:()=>vz,Application_Vendor_SunWadlXml:()=>Fz,Application_Vendor_SunXmlCalc:()=>Az,Application_Vendor_SunXmlCalcTemplate:()=>bz,Application_Vendor_SunXmlDraw:()=>Sz,Application_Vendor_SunXmlDrawTemplate:()=>yz,Application_Vendor_SunXmlImpress:()=>Tz,Application_Vendor_SunXmlImpressTemplate:()=>Ez,Application_Vendor_SunXmlMath:()=>_z,Application_Vendor_SunXmlWriter:()=>Mz,Application_Vendor_SunXmlWriterGlobal:()=>kz,Application_Vendor_SunXmlWriterTemplate:()=>Cz,Application_Vendor_Sus_Calendar:()=>Dz,Application_Vendor_Svd:()=>Pz,Application_Vendor_Swiftview_Ics:()=>Lz,Application_Vendor_SymbianInstall:()=>Iz,Application_Vendor_SyncmlDmNotification:()=>Vz,Application_Vendor_SyncmlDmWbxml:()=>Hz,Application_Vendor_SyncmlDmXml:()=>Wz,Application_Vendor_SyncmlDmddfWbxml:()=>Rz,Application_Vendor_SyncmlDmddfXml:()=>Bz,Application_Vendor_SyncmlDmtndsWbxml:()=>Oz,Application_Vendor_SyncmlDmtndsXml:()=>Nz,Application_Vendor_SyncmlDsNotification:()=>Uz,Application_Vendor_SyncmlXml:()=>zz,Application_Vendor_TableschemaJson:()=>jz,Application_Vendor_TaoIntent_Module_Archive:()=>Gz,Application_Vendor_TcpdumpPcap:()=>Xz,Application_Vendor_Think_CellPpttcJson:()=>qz,Application_Vendor_TmdMediaflexApiXml:()=>Kz,Application_Vendor_Tml:()=>Yz,Application_Vendor_Tmobile_Livetv:()=>Jz,Application_Vendor_TriOnesource:()=>$z,Application_Vendor_TridTpt:()=>Qz,Application_Vendor_TriscapeMxs:()=>Zz,Application_Vendor_Trueapp:()=>ej,Application_Vendor_Truedoc:()=>tj,Application_Vendor_UbisoftWebplayer:()=>nj,Application_Vendor_Ufdl:()=>rj,Application_Vendor_UiqTheme:()=>ij,Application_Vendor_Umajin:()=>oj,Application_Vendor_Unity:()=>sj,Application_Vendor_UomlXml:()=>aj,Application_Vendor_UplanetAlert:()=>lj,Application_Vendor_UplanetAlert_Wbxml:()=>cj,Application_Vendor_UplanetBearer_Choice:()=>uj,Application_Vendor_UplanetBearer_Choice_Wbxml:()=>pj,Application_Vendor_UplanetCacheop:()=>dj,Application_Vendor_UplanetCacheop_Wbxml:()=>hj,Application_Vendor_UplanetChannel:()=>mj,Application_Vendor_UplanetChannel_Wbxml:()=>fj,Application_Vendor_UplanetList:()=>gj,Application_Vendor_UplanetList_Wbxml:()=>xj,Application_Vendor_UplanetListcmd:()=>wj,Application_Vendor_UplanetListcmd_Wbxml:()=>vj,Application_Vendor_UplanetSignal:()=>Fj,Application_Vendor_Uri_Map:()=>Aj,Application_Vendor_ValveSourceMaterial:()=>bj,Application_Vendor_Vcx:()=>Sj,Application_Vendor_Vd_Study:()=>yj,Application_Vendor_Vectorworks:()=>Tj,Application_Vendor_VelJson:()=>Ej,Application_Vendor_VerimatrixVcas:()=>_j,Application_Vendor_VeryantThin:()=>Mj,Application_Vendor_VesEncrypted:()=>kj,Application_Vendor_VidsoftVidconference:()=>Cj,Application_Vendor_Visio:()=>Dj,Application_Vendor_Visionary:()=>Pj,Application_Vendor_VividenceScriptfile:()=>Lj,Application_Vendor_Vsf:()=>Ij,Application_Vendor_WapSic:()=>Rj,Application_Vendor_WapSlc:()=>Bj,Application_Vendor_WapWbxml:()=>Vj,Application_Vendor_WapWmlc:()=>Oj,Application_Vendor_WapWmlscriptc:()=>Nj,Application_Vendor_Webturbo:()=>Hj,Application_Vendor_WfaP2p:()=>Wj,Application_Vendor_WfaWsc:()=>Uj,Application_Vendor_WindowsDevicepairing:()=>zj,Application_Vendor_Wmc:()=>jj,Application_Vendor_WmfBootstrap:()=>Gj,Application_Vendor_WolframMathematica:()=>Xj,Application_Vendor_WolframMathematicaPackage:()=>qj,Application_Vendor_WolframPlayer:()=>Kj,Application_Vendor_Wordperfect:()=>Yj,Application_Vendor_Wqd:()=>Jj,Application_Vendor_Wrq_Hp3000_Labelled:()=>Qj,Application_Vendor_WtStf:()=>$j,Application_Vendor_WvCspWbxml:()=>Zj,Application_Vendor_WvCspXml:()=>eG,Application_Vendor_WvSspXml:()=>tG,Application_Vendor_XacmlJson:()=>nG,Application_Vendor_Xara:()=>rG,Application_Vendor_Xfdl:()=>iG,Application_Vendor_XfdlWebform:()=>oG,Application_Vendor_XmiXml:()=>sG,Application_Vendor_XmpieCpkg:()=>aG,Application_Vendor_XmpieDpkg:()=>lG,Application_Vendor_XmpiePlan:()=>cG,Application_Vendor_XmpiePpkg:()=>uG,Application_Vendor_XmpieXlim:()=>pG,Application_Vendor_YamahaHv_Dic:()=>dG,Application_Vendor_YamahaHv_Script:()=>hG,Application_Vendor_YamahaHv_Voice:()=>mG,Application_Vendor_YamahaOpenscoreformat:()=>fG,Application_Vendor_YamahaOpenscoreformatOsfpvgXml:()=>gG,Application_Vendor_YamahaRemote_Setup:()=>xG,Application_Vendor_YamahaSmaf_Audio:()=>wG,Application_Vendor_YamahaSmaf_Phrase:()=>vG,Application_Vendor_YamahaThrough_Ngn:()=>FG,Application_Vendor_YamahaTunnel_Udpencap:()=>AG,Application_Vendor_Yaoweme:()=>bG,Application_Vendor_Yellowriver_Custom_Menu:()=>SG,Application_Vendor_YoutubeYt:()=>yG,Application_Vendor_Zul:()=>TG,Application_Vendor_ZzazzDeckXml:()=>EG,Application_VividenceScriptfile:()=>_G,Application_VoicexmlXml:()=>MG,Application_Voucher_CmsJson:()=>kG,Application_Vq_Rtcpxr:()=>CG,Application_Wasm:()=>zp,Application_WatcherinfoXml:()=>DG,Application_Webpush_OptionsJson:()=>PG,Application_Whoispp_Query:()=>LG,Application_Whoispp_Response:()=>IG,Application_Widget:()=>RG,Application_Winhlp:()=>BG,Application_Wita:()=>VG,Application_Wordperfect51:()=>OG,Application_WsdlXml:()=>NG,Application_WspolicyXml:()=>HG,Application_X400_Bp:()=>mK,Application_X_7z_Compressed:()=>WG,Application_X_Abiword:()=>UG,Application_X_Ace_Compressed:()=>zG,Application_X_Amf:()=>jG,Application_X_Apple_Diskimage:()=>GG,Application_X_Arj:()=>XG,Application_X_Authorware_Bin:()=>qG,Application_X_Authorware_Map:()=>KG,Application_X_Authorware_Seg:()=>YG,Application_X_Bcpio:()=>JG,Application_X_Bdoc:()=>QG,Application_X_Bittorrent:()=>$G,Application_X_Blorb:()=>ZG,Application_X_Bzip:()=>eX,Application_X_Bzip2:()=>tX,Application_X_Cbr:()=>nX,Application_X_Cdlink:()=>rX,Application_X_Cfs_Compressed:()=>iX,Application_X_Chat:()=>oX,Application_X_Chess_Pgn:()=>sX,Application_X_Chrome_Extension:()=>aX,Application_X_Compress:()=>cX,Application_X_Conference:()=>uX,Application_X_Cpio:()=>pX,Application_X_Csh:()=>dX,Application_X_Deb:()=>lX,Application_X_Debian_Package:()=>hX,Application_X_Dgc_Compressed:()=>mX,Application_X_Director:()=>fX,Application_X_Doom:()=>gX,Application_X_DtbncxXml:()=>xX,Application_X_DtbookXml:()=>wX,Application_X_DtbresourceXml:()=>vX,Application_X_Dvi:()=>FX,Application_X_Envoy:()=>AX,Application_X_Eva:()=>bX,Application_X_Font_Bdf:()=>SX,Application_X_Font_Dos:()=>yX,Application_X_Font_Framemaker:()=>TX,Application_X_Font_Ghostscript:()=>EX,Application_X_Font_Libgrx:()=>_X,Application_X_Font_Linux_Psf:()=>MX,Application_X_Font_Pcf:()=>kX,Application_X_Font_Snf:()=>CX,Application_X_Font_Speedo:()=>DX,Application_X_Font_Sunos_News:()=>PX,Application_X_Font_Type1:()=>LX,Application_X_Font_Vfont:()=>IX,Application_X_Freearc:()=>RX,Application_X_Futuresplash:()=>BX,Application_X_Gca_Compressed:()=>VX,Application_X_Glulx:()=>OX,Application_X_Gnumeric:()=>NX,Application_X_Gramps_Xml:()=>HX,Application_X_Gtar:()=>WX,Application_X_Gzip:()=>UX,Application_X_Hdf:()=>zX,Application_X_Httpd_Php:()=>jX,Application_X_Install_Instructions:()=>GX,Application_X_Iso9660_Image:()=>XX,Application_X_Iwork_Keynote_Sffkey:()=>qX,Application_X_Iwork_Numbers_Sffnumbers:()=>KX,Application_X_Iwork_Pages_Sffpages:()=>YX,Application_X_Java_Jnlp_File:()=>JX,Application_X_Javascript:()=>QX,Application_X_Keepass2:()=>$X,Application_X_Latex:()=>ZX,Application_X_Lua_Bytecode:()=>eq,Application_X_Lzh_Compressed:()=>tq,Application_X_Mie:()=>nq,Application_X_Mobipocket_Ebook:()=>rq,Application_X_Mpegurl:()=>iq,Application_X_Ms_Application:()=>oq,Application_X_Ms_Shortcut:()=>sq,Application_X_Ms_Wmd:()=>aq,Application_X_Ms_Wmz:()=>lq,Application_X_Ms_Xbap:()=>cq,Application_X_Msaccess:()=>pq,Application_X_Msbinder:()=>dq,Application_X_Mscardfile:()=>hq,Application_X_Msclip:()=>mq,Application_X_Msdos_Program:()=>uq,Application_X_Msdownload:()=>fq,Application_X_Msmediaview:()=>gq,Application_X_Msmetafile:()=>xq,Application_X_Msmoney:()=>wq,Application_X_Mspublisher:()=>vq,Application_X_Msschedule:()=>Fq,Application_X_Msterminal:()=>Aq,Application_X_Mswrite:()=>bq,Application_X_Netcdf:()=>Sq,Application_X_Ns_Proxy_Autoconfig:()=>yq,Application_X_Nzb:()=>Tq,Application_X_Pkcs12:()=>Eq,Application_X_Pkcs7_Certificates:()=>_q,Application_X_Pkcs7_Certreqresp:()=>Mq,Application_X_Rar_Compressed:()=>kq,Application_X_Research_Info_Systems:()=>Cq,Application_X_Sh:()=>Dq,Application_X_Shar:()=>Pq,Application_X_Shockwave_Flash:()=>Lq,Application_X_Silverlight_App:()=>Iq,Application_X_Sql:()=>Rq,Application_X_Stuffit:()=>Bq,Application_X_Stuffitx:()=>Vq,Application_X_Subrip:()=>Oq,Application_X_Sv4cpio:()=>Nq,Application_X_Sv4crc:()=>Hq,Application_X_T3vm_Image:()=>Wq,Application_X_Tads:()=>Uq,Application_X_Tar:()=>zq,Application_X_Tcl:()=>jq,Application_X_Tex:()=>Gq,Application_X_Tex_Tfm:()=>Xq,Application_X_Texinfo:()=>qq,Application_X_Tgif:()=>Kq,Application_X_Url:()=>zc,Application_X_Ustar:()=>Yq,Application_X_Virtualbox_Hdd:()=>Jq,Application_X_Virtualbox_Ova:()=>Qq,Application_X_Virtualbox_Ovf:()=>$q,Application_X_Virtualbox_Vbox:()=>Zq,Application_X_Virtualbox_Vbox_Extpack:()=>eK,Application_X_Virtualbox_Vdi:()=>tK,Application_X_Virtualbox_Vhd:()=>nK,Application_X_Virtualbox_Vmdk:()=>rK,Application_X_Wais_Source:()=>iK,Application_X_Web_App_ManifestJson:()=>oK,Application_X_Www_Form_Urlencoded:()=>sK,Application_X_X509_Ca_Cert:()=>aK,Application_X_Xfig:()=>lK,Application_X_XliffXml:()=>cK,Application_X_Xpinstall:()=>uK,Application_X_Xz:()=>pK,Application_X_Zip_Compressed:()=>dK,Application_X_Zmachine:()=>hK,Application_XacmlXml:()=>fK,Application_XamlXml:()=>gK,Application_Xcap_AttXml:()=>xK,Application_Xcap_CapsXml:()=>wK,Application_Xcap_DiffXml:()=>vK,Application_Xcap_ElXml:()=>FK,Application_Xcap_ErrorXml:()=>AK,Application_Xcap_NsXml:()=>bK,Application_Xcon_Conference_InfoXml:()=>yK,Application_Xcon_Conference_Info_DiffXml:()=>SK,Application_XencXml:()=>TK,Application_XhtmlXml:()=>_K,Application_Xhtml_VoiceXml:()=>EK,Application_XliffXml:()=>MK,Application_Xml:()=>kK,Application_Xml_Dtd:()=>CK,Application_Xml_External_Parsed_Entity:()=>DK,Application_Xml_PatchXml:()=>PK,Application_XmppXml:()=>LK,Application_XopXml:()=>IK,Application_XprocXml:()=>RK,Application_XsltXml:()=>BK,Application_XspfXml:()=>VK,Application_XvXml:()=>OK,Application_Yang:()=>NK,Application_Yang_DataJson:()=>HK,Application_Yang_DataXml:()=>WK,Application_Yang_PatchJson:()=>UK,Application_Yang_PatchXml:()=>zK,Application_YinXml:()=>jK,Application_Zip:()=>GK,Application_Zlib:()=>XK,Application_Zstd:()=>qK});var mF=/([^\/]+)\/(.+)/,__=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/;function Ba(r){return r.flatMap(t=>t.extensions.map(e=>"."+e)).sort().join(", ")}var Ti=class{constructor(t,e,n){this._type=t;this._fullSubType=e;this._primaryExtension=null;this.depMessage=null;let i=new Map;this._parameters=i;let o=this._fullSubType.match(__);this._tree=o[1],this._subType=o[2],this._suffix=o[3];let s=o[4];if(this._value=this._fullValue=this._type+"/",T(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,T(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),T(s)){let l=s.split(";").map(c=>c.trim()).filter(c=>c.length>0).map(c=>c.split("="));for(let[c,...u]of l){let p=u.join("=");i.set(c,p);let f=`; ${c}=${p}`;this._fullValue+=f,c!=="q"&&(this._value+=f)}}this._extensions=n||[],this._primaryExtension=this._extensions[0]||null}static parse(t){if(!t)return null;let e=t.match(mF);if(!e)return null;let n=e[1],i=e[2];return new Ti(n,i)}deprecate(t){return this.depMessage=t,this}check(){T(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(t){if(fe(t))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let e=null,n=null;if(et(t)){let i=t.match(mF);if(!i)return!1;e=i[1],n=i[2]}else e=t.typeName,n=t._fullSubType;return this.typeName===e&&(this._fullSubType==="*"||this._fullSubType===n)}withParameter(t,e){let n=`${this._fullSubType}; ${t}=${e}`;return new Ti(this.typeName,n,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}addExtension(t){if(!t)throw new Error("File name is not defined");if(this.primaryExtension){let e=t.lastIndexOf(".");if(e>-1){let n=t.substring(e+1);this.extensions.indexOf(n)>-1&&(t=t.substring(0,e))}t=`${t}.${this.primaryExtension}`}return t}};function Va(r,t,...e){return new Ti(r,t,e)}function tn(r){return Va.bind(null,r)}var a=tn("application"),M_=a("a2l"),k_=a("activemessage"),C_=a("activity+json","json"),D_=a("alto-costmapfilter+json","json"),P_=a("alto-costmap+json","json"),L_=a("alto-directory+json","json"),I_=a("alto-endpointcost+json","json"),R_=a("alto-endpointcostparams+json","json"),B_=a("alto-endpointprop+json","json"),V_=a("alto-endpointpropparams+json","json"),O_=a("alto-error+json","json"),N_=a("alto-networkmapfilter+json","json"),H_=a("alto-networkmap+json","json"),W_=a("aml"),U_=a("andrew-inset","ez"),z_=a("applefile"),j_=a("applixware","aw"),G_=a("atf"),X_=a("atfx"),q_=a("atomcat+xml","atomcat"),K_=a("atomdeleted+xml","xml"),Y_=a("atomicmail"),J_=a("atomsvc+xml","atomsvc"),Q_=a("atom+xml","atom"),$_=a("atsc-dwd+xml","xml"),Z_=a("atsc-held+xml","xml"),eM=a("atsc-rdt+json","json"),tM=a("atsc-rsat+xml","xml"),nM=a("atxml"),rM=a("auth-policy+xml","xml"),iM=a("bacnet-xdd+zip","zip"),oM=a("batch-smtp"),sM=a("bdoc","bdoc"),aM=a("beep+xml","xml"),lM=a("calendar+json","json"),cM=a("calendar+xml","xml"),uM=a("call-completion"),pM=a("cals-1840"),dM=a("cbor"),hM=a("cbor-seq"),mM=a("cccex"),fM=a("ccmp+xml","xml"),gM=a("ccxml+xml","ccxml"),xM=a("cdfx+xml","xml"),wM=a("cdmi-capability","cdmia"),vM=a("cdmi-container","cdmic"),FM=a("cdmi-domain","cdmid"),AM=a("cdmi-object","cdmio"),bM=a("cdmi-queue","cdmiq"),SM=a("cdni"),yM=a("cea"),TM=a("cea-2018+xml","xml"),EM=a("cellml+xml","xml"),_M=a("cfw"),MM=a("clue_info+xml","xml"),kM=a("clue+xml","xml"),CM=a("cms"),DM=a("cnrp+xml","xml"),PM=a("coap-group+json","json"),LM=a("coap-payload"),IM=a("commonground"),RM=a("conference-info+xml","xml"),BM=a("cose"),VM=a("cose-key"),OM=a("cose-key-set"),NM=a("cpl+xml","xml"),HM=a("csrattrs"),WM=a("cstadata+xml","xml"),UM=a("csta+xml","xml"),zM=a("csvm+json","json"),jM=a("cu-seeme","cu"),GM=a("cwt"),XM=a("cybercash"),qM=a("dart"),KM=a("dashdelta"),YM=a("dash+xml","xml"),JM=a("davmount+xml","davmount"),QM=a("dca-rft"),$M=a("dcd"),ZM=a("dec-dx"),e2=a("dialog-info+xml","xml"),t2=a("dicom"),n2=a("dicom+json","json"),r2=a("dicom+xml","xml"),i2=a("dii"),o2=a("dit"),s2=a("dns"),a2=a("dns-message"),l2=a("dns+json","json"),c2=a("docbook+xml","dbk"),u2=a("dots+cbor","cbor"),p2=a("dskpp+xml","xml"),d2=a("dssc+der","dssc"),h2=a("dssc+xml","xdssc"),m2=a("dvcs"),f2=a("ecmascript","ecma"),g2=a("edi-consent"),x2=a("edi-x12"),w2=a("edifact"),v2=a("efi"),F2=a("emergencycalldata.comment+xml","xml"),A2=a("emergencycalldata.control+xml","xml"),b2=a("emergencycalldata.deviceinfo+xml","xml"),S2=a("emergencycalldata.ecall.msd"),y2=a("emergencycalldata.providerinfo+xml","xml"),T2=a("emergencycalldata.serviceinfo+xml","xml"),E2=a("emergencycalldata.subscriberinfo+xml","xml"),_2=a("emergencycalldata.veds+xml","xml"),M2=a("emma+xml","emma"),k2=a("emotionml+xml","xml"),C2=a("encaprtp"),D2=a("epp+xml","xml"),P2=a("epub+zip","epub"),L2=a("eshop"),I2=a("example"),R2=a("exi","exi"),B2=a("expect-ct-report+json","json"),V2=a("fastinfoset"),O2=a("fastsoap"),N2=a("fdt+xml","xml"),H2=a("fhir+json","json"),W2=a("fhir+xml","xml"),U2=a("fido.trusted-apps+json"),z2=a("fits"),j2=a("flexfec"),G2=a("font-sfnt").deprecate("in favor of font/sfnt"),X2=a("font-tdpfr","pfr"),q2=a("font-woff").deprecate("in favor of font/woff"),K2=a("framework-attributes+xml","xml"),Y2=a("geo+json","json"),J2=a("geo+json-seq","json-seq"),Q2=a("geopackage+sqlite3","sqlite3"),$2=a("geoxacml+xml","xml"),Z2=a("gltf-buffer"),ek=a("gml+xml","gml"),tk=a("gpx+xml","gpx"),nk=a("gxf","gxf"),rk=a("gzip"),ik=a("h224"),ok=a("held+xml","xml"),sk=a("hjson","hjson"),ak=a("http"),lk=a("hyperstudio","stk"),ck=a("ibe-key-request+xml","xml"),uk=a("ibe-pkg-reply+xml","xml"),pk=a("ibe-pp-data"),dk=a("iges"),hk=a("im-iscomposing+xml","xml"),mk=a("index"),fk=a("index.cmd"),gk=a("index.obj"),xk=a("index.response"),wk=a("index.vnd"),vk=a("inkml+xml","ink","inkml"),Fk=a("iotp"),Ak=a("ipfix","ipfix"),bk=a("ipp"),Sk=a("isup"),yk=a("its+xml","xml"),Tk=a("java-archive","jar"),Ek=a("java-serialized-object","ser"),_k=a("java-vm","class"),Ei=a("javascript","js"),Mk=a("jf2feed+json","json"),kk=a("jose"),Ck=a("jose+json","json"),Dk=a("jrd+json","json"),Oa=a("json","json"),Pk=a("json5","json5"),wo=a("json; charset=UTF-8","json"),Lk=a("json-patch+json","json"),Ik=a("json-seq"),Rk=a("jsonml+json","jsonml"),Bk=a("jwk-set+json","json"),Vk=a("jwk+json","json"),Ok=a("jwt"),Nk=a("kpml-request+xml","xml"),Hk=a("kpml-response+xml","xml"),Wk=a("ld+json","json"),Uk=a("lgr+xml","xml"),zk=a("link-format"),jk=a("load-control+xml","xml"),Gk=a("lostsync+xml","xml"),Xk=a("lost+xml","lostxml"),qk=a("lxf"),Kk=a("mac-binhex40","hqx"),Yk=a("mac-compactpro","cpt"),Jk=a("macwriteii"),Qk=a("mads+xml","mads"),$k=a("manifest+json","webmanifest"),Zk=a("marc","mrc"),eC=a("marcxml+xml","mrcx"),tC=a("mathematica","ma","nb","mb"),nC=a("mathml-content+xml","xml"),rC=a("mathml-presentation+xml","xml"),iC=a("mathml+xml","mathml"),oC=a("mbms-associated-procedure-description+xml","xml"),sC=a("mbms-deregister+xml","xml"),aC=a("mbms-envelope+xml","xml"),lC=a("mbms-msk-response+xml","xml"),cC=a("mbms-msk+xml","xml"),uC=a("mbms-protection-description+xml","xml"),pC=a("mbms-reception-report+xml","xml"),dC=a("mbms-register-response+xml","xml"),hC=a("mbms-register+xml","xml"),mC=a("mbms-schedule+xml","xml"),fC=a("mbms-user-service-description+xml","xml"),gC=a("mbox","mbox"),xC=a("media_control+xml","xml"),wC=a("media-policy-dataset+xml","xml"),vC=a("mediaservercontrol+xml","mscml"),FC=a("merge-patch+json","json"),AC=a("metalink4+xml","meta4"),bC=a("metalink+xml","metalink"),SC=a("mets+xml","mets"),yC=a("mf4"),TC=a("mikey"),EC=a("mipc"),_C=a("mmt-aei+xml","xml"),MC=a("mmt-usd+xml","xml"),kC=a("mods+xml","mods"),CC=a("moss-keys"),DC=a("moss-signature"),PC=a("mosskey-data"),LC=a("mosskey-request"),IC=a("mp21","m21","mp21"),RC=a("mp4","mp4s"),BC=a("mpeg4-generic"),VC=a("mpeg4-iod"),OC=a("mpeg4-iod-xmt"),NC=a("mrb-consumer+xml","xml"),HC=a("mrb-publish+xml","xml"),WC=a("msc-ivr+xml","xml"),UC=a("msc-mixer+xml","xml"),zC=a("msword","doc","dot"),jC=a("mud+json","json"),GC=a("multipart-core"),XC=a("mxf","mxf"),qC=a("n-quads"),KC=a("n-triples"),YC=a("nasdata"),JC=a("news-checkgroups"),QC=a("news-groupinfo"),$C=a("news-transmission"),ZC=a("nlsml+xml","xml"),eD=a("node"),tD=a("nss"),nD=a("ocsp-request"),rD=a("ocsp-response"),iD=a("octet-stream","bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy"),oD=a("oda","oda"),sD=a("odm+xml","xml"),aD=a("odx"),lD=a("oebps-package+xml","opf"),cD=a("ogg","ogx"),uD=a("omdoc+xml","omdoc"),pD=a("onenote","onetoc","onetoc2","onetmp","onepkg"),dD=a("oscore"),hD=a("oxps","oxps"),mD=a("p2p-overlay+xml","xml"),fD=a("parityfec"),gD=a("passport"),xD=a("patch-ops-error+xml","xer"),vo=a("pdf","pdf"),wD=a("pdx"),vD=a("pem-certificate-chain"),FD=a("pgp-encrypted","pgp"),AD=a("pgp-keys"),bD=a("pgp-signature","asc","sig"),SD=a("pics-rules","prf"),yD=a("pidf-diff+xml","xml"),TD=a("pidf+xml","xml"),ED=a("pkcs10","p10"),_D=a("pkcs12"),MD=a("pkcs7-mime","p7m","p7c"),kD=a("pkcs7-signature","p7s"),CD=a("pkcs8","p8"),DD=a("pkcs8-encrypted"),PD=a("pkix-attr-cert","ac"),LD=a("pkix-cert","cer"),ID=a("pkix-crl","crl"),RD=a("pkix-pkipath","pkipath"),BD=a("pkixcmp","pki"),VD=a("pls+xml","pls"),OD=a("poc-settings+xml","xml"),ND=a("postscript","ai","eps","ps"),HD=a("ppsp-tracker+json","json"),WD=a("problem+json","json"),UD=a("problem+xml","xml"),zD=a("provenance+xml","xml"),jD=a("prs.alvestrand.titrax-sheet"),GD=a("prs.cww","cww"),XD=a("prs.hpub+zip","zip"),qD=a("prs.nprend"),KD=a("prs.plucker"),YD=a("prs.rdf-xml-crypt"),JD=a("prs.xsf+xml","xml"),QD=a("pskc+xml","pskcxml"),$D=a("qsig"),ZD=a("raml+yaml","raml"),eP=a("raptorfec"),tP=a("rdap+json","json"),nP=a("rdf+xml","rdf"),rP=a("reginfo+xml","rif"),iP=a("relax-ng-compact-syntax","rnc"),oP=a("remote-printing"),sP=a("reputon+json","json"),aP=a("resource-lists-diff+xml","rld"),lP=a("resource-lists+xml","rl"),cP=a("rfc+xml","xml"),uP=a("riscos"),pP=a("rlmi+xml","xml"),dP=a("rls-services+xml","rs"),hP=a("route-apd+xml","xml"),mP=a("route-s-tsid+xml","xml"),fP=a("route-usd+xml","xml"),gP=a("rpki-ghostbusters","gbr"),xP=a("rpki-manifest","mft"),wP=a("rpki-publication"),vP=a("rpki-roa","roa"),FP=a("rpki-updown"),AP=a("rsd+xml","rsd"),bP=a("rss+xml","rss"),SP=a("rtf","rtf"),yP=a("rtploopback"),TP=a("rtx"),EP=a("samlassertion+xml","xml"),_P=a("samlmetadata+xml","xml"),MP=a("sbml+xml","sbml"),kP=a("scaip+xml","xml"),CP=a("scim+json","json"),DP=a("scvp-cv-request","scq"),PP=a("scvp-cv-response","scs"),LP=a("scvp-vp-request","spq"),IP=a("scvp-vp-response","spp"),RP=a("sdp","sdp"),BP=a("secevent+jwt","jwt"),VP=a("senml-exi"),OP=a("senml+cbor","cbor"),NP=a("senml+json","json"),HP=a("senml+xml","xml"),WP=a("sensml-exi"),UP=a("sensml+cbor","cbor"),zP=a("sensml+json","json"),jP=a("sensml+xml","xml"),GP=a("sep-exi"),XP=a("sep+xml","xml"),qP=a("session-info"),KP=a("set-payment"),YP=a("set-payment-initiation","setpay"),JP=a("set-registration"),QP=a("set-registration-initiation","setreg"),$P=a("sgml"),ZP=a("sgml-open-catalog"),eL=a("shf+xml","shf"),tL=a("sieve"),nL=a("simple-filter+xml","xml"),rL=a("simple-message-summary"),iL=a("simplesymbolcontainer"),oL=a("sipc"),sL=a("slate"),aL=a("smil").deprecate("in favor of application/smil+xml"),lL=a("smil+xml","smi","smil"),cL=a("smpte336m"),uL=a("soap+fastinfoset","fastinfoset"),pL=a("soap+xml","xml"),dL=a("sparql-query","rq"),hL=a("sparql-results+xml","srx"),mL=a("spirits-event+xml","xml"),fL=a("sql"),gL=a("srgs","gram"),xL=a("srgs+xml","grxml"),wL=a("sru+xml","sru"),vL=a("ssdl+xml","ssdl"),FL=a("ssml+xml","ssml"),AL=a("stix+json","json"),bL=a("swid+xml","xml"),SL=a("tamp-apex-update"),yL=a("tamp-apex-update-confirm"),TL=a("tamp-community-update"),EL=a("tamp-community-update-confirm"),_L=a("tamp-error"),ML=a("tamp-sequence-adjust"),kL=a("tamp-sequence-adjust-confirm"),CL=a("tamp-status-query"),DL=a("tamp-status-response"),PL=a("tamp-update"),LL=a("tamp-update-confirm"),IL=a("tar"),RL=a("taxii+json","json"),BL=a("tei+xml","tei","teicorpus"),VL=a("tetra_isi"),OL=a("thraud+xml","tfi"),NL=a("timestamp-query"),HL=a("timestamp-reply"),WL=a("timestamped-data","tsd"),UL=a("tlsrpt+gzip","gzip"),zL=a("tlsrpt+json","json"),jL=a("tnauthlist"),GL=a("toml","toml"),XL=a("trickle-ice-sdpfrag"),qL=a("trig"),KL=a("ttml+xml","xml"),YL=a("tve-trigger"),JL=a("tzif"),QL=a("tzif-leap"),$L=a("ubjson","ubj"),ZL=a("ulpfec"),e3=a("urc-grpsheet+xml","xml"),t3=a("urc-ressheet+xml","xml"),n3=a("urc-targetdesc+xml","xml"),r3=a("urc-uisocketdesc+xml","xml"),i3=a("vcard+json","json"),o3=a("vcard+xml","xml"),s3=a("vemmi"),a3=a("vnd.1000minds.decision-model+xml","xml"),l3=a("1d-interleaved-parityfec"),c3=a("3gpdash-qoe-report+xml","xml"),u3=a("3gpp-ims+xml","xml"),p3=a("vnd.3gpp-prose-pc3ch+xml","xml"),d3=a("vnd.3gpp-prose+xml","xml"),h3=a("vnd.3gpp-v2x-local-service-information"),m3=a("vnd.3gpp2.bcmcsinfo+xml","xml"),f3=a("vnd.3gpp2.sms"),g3=a("vnd.3gpp2.tcap","tcap"),x3=a("vnd.3gpp.access-transfer-events+xml","xml"),w3=a("vnd.3gpp.bsf+xml","xml"),v3=a("vnd.3gpp.gmop+xml","xml"),F3=a("vnd.3gpp.mc-signalling-ear"),A3=a("vnd.3gpp.mcdata-affiliation-command+xml","xml"),b3=a("vnd.3gpp.mcdata-info+xml","xml"),S3=a("vnd.3gpp.mcdata-payload"),y3=a("vnd.3gpp.mcdata-service-config+xml","xml"),T3=a("vnd.3gpp.mcdata-signalling"),E3=a("vnd.3gpp.mcdata-ue-config+xml","xml"),_3=a("vnd.3gpp.mcdata-user-profile+xml","xml"),M3=a("vnd.3gpp.mcptt-affiliation-command+xml","xml"),k3=a("vnd.3gpp.mcptt-floor-request+xml","xml"),C3=a("vnd.3gpp.mcptt-info+xml","xml"),D3=a("vnd.3gpp.mcptt-location-info+xml","xml"),P3=a("vnd.3gpp.mcptt-mbms-usage-info+xml","xml"),L3=a("vnd.3gpp.mcptt-service-config+xml","xml"),I3=a("vnd.3gpp.mcptt-signed+xml","xml"),R3=a("vnd.3gpp.mcptt-ue-config+xml","xml"),B3=a("vnd.3gpp.mcptt-ue-init-config+xml","xml"),V3=a("vnd.3gpp.mcptt-user-profile+xml","xml"),O3=a("vnd.3gpp.mcvideo-affiliation-command+xml","xml"),N3=a("vnd.3gpp.mcvideo-affiliation-info+xml","xml").deprecate("in favor of application/vnd.3gpp.mcvideo-info+xml"),H3=a("vnd.3gpp.mcvideo-info+xml","xml"),W3=a("vnd.3gpp.mcvideo-location-info+xml","xml"),U3=a("vnd.3gpp.mcvideo-mbms-usage-info+xml","xml"),z3=a("vnd.3gpp.mcvideo-service-config+xml","xml"),j3=a("vnd.3gpp.mcvideo-transmission-request+xml","xml"),G3=a("vnd.3gpp.mcvideo-ue-config+xml","xml"),X3=a("vnd.3gpp.mcvideo-user-profile+xml","xml"),q3=a("vnd.3gpp.mid-call+xml","xml"),K3=a("vnd.3gpp.pic-bw-large","plb"),Y3=a("vnd.3gpp.pic-bw-small","psb"),J3=a("vnd.3gpp.pic-bw-var","pvb"),Q3=a("vnd.3gpp.sms"),$3=a("vnd.3gpp.sms+xml","xml"),Z3=a("vnd.3gpp.srvcc-ext+xml","xml"),eI=a("vnd.3gpp.srvcc-info+xml","xml"),tI=a("vnd.3gpp.state-and-event-info+xml","xml"),nI=a("vnd.3gpp.ussd+xml","xml"),rI=a("vnd.3lightssoftware.imagescal"),iI=a("vnd.3m.post-it-notes","pwn"),oI=a("vnd.accpac.simply.aso","aso"),sI=a("vnd.accpac.simply.imp","imp"),aI=a("vnd.acucobol","acu"),lI=a("vnd.acucorp","atc","acutc"),cI=a("vnd.adobe.air-application-installer-package+zip","air"),uI=a("vnd.adobe.flash.movie"),pI=a("vnd.adobe.formscentral.fcdt","fcdt"),dI=a("vnd.adobe.fxp","fxp","fxpl"),hI=a("vnd.adobe.partial-upload"),mI=a("vnd.adobe.xdp+xml","xdp"),fI=a("vnd.adobe.xfdf","xfdf"),gI=a("vnd.aether.imp"),xI=a("vnd.afpc.afplinedata"),wI=a("vnd.afpc.afplinedata-pagedef"),vI=a("vnd.afpc.foca-charset"),FI=a("vnd.afpc.foca-codedfont"),AI=a("vnd.afpc.foca-codepage"),bI=a("vnd.afpc.modca"),SI=a("vnd.afpc.modca-formdef"),yI=a("vnd.afpc.modca-mediummap"),TI=a("vnd.afpc.modca-objectcontainer"),EI=a("vnd.afpc.modca-overlay"),_I=a("vnd.afpc.modca-pagesegment"),MI=a("vnd.ah-barcode"),kI=a("vnd.ahead.space","ahead"),CI=a("vnd.airzip.filesecure.azf","azf"),DI=a("vnd.airzip.filesecure.azs","azs"),PI=a("vnd.amadeus+json","json"),LI=a("vnd.amazon.ebook","azw"),II=a("vnd.amazon.mobi8-ebook"),RI=a("vnd.americandynamics.acc","acc"),BI=a("vnd.amiga.ami","ami"),VI=a("vnd.amundsen.maze+xml","xml"),OI=a("vnd.android.ota"),NI=a("vnd.android.package-archive","apk"),HI=a("vnd.anki"),WI=a("vnd.anser-web-certificate-issue-initiation","cii"),UI=a("vnd.anser-web-funds-transfer-initiation","fti"),zI=a("vnd.antix.game-component","atx"),jI=a("vnd.apache.thrift.binary"),GI=a("vnd.apache.thrift.compact"),XI=a("vnd.apache.thrift.json"),qI=a("vnd.api+json","json"),KI=a("vnd.aplextor.warrp+json","json"),YI=a("vnd.apothekende.reservation+json","json"),JI=a("vnd.apple.installer+xml","mpkg"),QI=a("vnd.apple.keynote"),$I=a("vnd.apple.mpegurl","m3u8"),ZI=a("vnd.apple.numbers"),eR=a("vnd.apple.pages"),tR=a("vnd.apple.pkpass","pkpass"),nR=a("vnd.arastra.swi").deprecate("in favor of application/vnd.aristanetworks.swi"),rR=a("vnd.aristanetworks.swi","swi"),iR=a("vnd.artisan+json","json"),oR=a("vnd.artsquare"),sR=a("vnd.astraea-software.iota","iota"),aR=a("vnd.audiograph","aep"),lR=a("vnd.autopackage"),cR=a("vnd.avalon+json","json"),uR=a("vnd.avistar+xml","xml"),pR=a("vnd.balsamiq.bmml+xml","xml"),dR=a("vnd.balsamiq.bmpr"),hR=a("vnd.banana-accounting"),mR=a("vnd.bbf.usp.error"),fR=a("vnd.bbf.usp.msg"),gR=a("vnd.bbf.usp.msg+json","json"),xR=a("vnd.bekitzur-stech+json","json"),wR=a("vnd.bint.med-content"),vR=a("vnd.biopax.rdf+xml","xml"),FR=a("vnd.blink-idb-value-wrapper"),AR=a("vnd.blueice.multipass","mpm"),bR=a("vnd.bluetooth.ep.oob"),SR=a("vnd.bluetooth.le.oob"),yR=a("vnd.bmi","bmi"),TR=a("vnd.bpf"),ER=a("vnd.bpf3"),_R=a("vnd.businessobjects","rep"),MR=a("vnd.byu.uapi+json","json"),kR=a("vnd.cab-jscript"),CR=a("vnd.canon-cpdl"),DR=a("vnd.canon-lips"),PR=a("vnd.capasystems-pg+json","json"),LR=a("vnd.cendio.thinlinc.clientconf"),IR=a("vnd.century-systems.tcp_stream"),RR=a("vnd.chemdraw+xml","cdxml"),BR=a("vnd.chess-pgn"),VR=a("vnd.chipnuts.karaoke-mmd","mmd"),OR=a("vnd.ciedi"),NR=a("vnd.cinderella","cdy"),HR=a("vnd.cirpack.isdn-ext"),WR=a("vnd.citationstyles.style+xml","xml"),UR=a("vnd.claymore","cla"),zR=a("vnd.cloanto.rp9","rp9"),jR=a("vnd.clonk.c4group","c4g","c4d","c4f","c4p","c4u"),GR=a("vnd.cluetrust.cartomobile-config","c11amc"),XR=a("vnd.cluetrust.cartomobile-config-pkg","c11amz"),qR=a("vnd.coffeescript"),KR=a("vnd.collabio.xodocuments.document"),YR=a("vnd.collabio.xodocuments.document-template"),JR=a("vnd.collabio.xodocuments.presentation"),QR=a("vnd.collabio.xodocuments.presentation-template"),$R=a("vnd.collabio.xodocuments.spreadsheet"),ZR=a("vnd.collabio.xodocuments.spreadsheet-template"),eB=a("vnd.collection.doc+json","json"),tB=a("vnd.collection+json","json"),nB=a("vnd.collection.next+json","json"),rB=a("vnd.comicbook-rar"),iB=a("vnd.comicbook+zip","zip"),oB=a("vnd.commerce-battelle"),sB=a("vnd.commonspace","csp"),aB=a("vnd.contact.cmsg","cdbcmsg"),lB=a("vnd.coreos.ignition+json","json"),cB=a("vnd.cosmocaller","cmc"),uB=a("vnd.crick.clicker","clkx"),pB=a("vnd.crick.clicker.keyboard","clkk"),dB=a("vnd.crick.clicker.palette","clkp"),hB=a("vnd.crick.clicker.template","clkt"),mB=a("vnd.crick.clicker.wordbank","clkw"),fB=a("vnd.criticaltools.wbs+xml","wbs"),gB=a("vnd.cryptii.pipe+json","json"),xB=a("vnd.crypto-shade-file"),wB=a("vnd.ctc-posml","pml"),vB=a("vnd.ctct.ws+xml","xml"),FB=a("vnd.cups-pdf"),AB=a("vnd.cups-postscript"),bB=a("vnd.cups-ppd","ppd"),SB=a("vnd.cups-raster"),yB=a("vnd.cups-raw"),TB=a("vnd.curl"),EB=a("vnd.curl.car","car"),_B=a("vnd.curl.pcurl","pcurl"),MB=a("vnd.cyan.dean.root+xml","xml"),kB=a("vnd.cybank"),CB=a("vnd.d2l.coursepackage1p0+zip","zip"),DB=a("vnd.dart","dart"),PB=a("vnd.data-vision.rdz","rdz"),LB=a("vnd.datapackage+json","json"),IB=a("vnd.dataresource+json","json"),RB=a("vnd.debian.binary-package"),BB=a("vnd.dece.data","uvf","uvvf","uvd","uvvd"),VB=a("vnd.dece.ttml+xml","uvt","uvvt"),OB=a("vnd.dece.unspecified","uvx","uvvx"),NB=a("vnd.dece.zip","uvz","uvvz"),HB=a("vnd.denovo.fcselayout-link","fe_launch"),WB=a("vnd.desmume.movie"),UB=a("vnd.dir-bi.plate-dl-nosuffix"),zB=a("vnd.dm.delegation+xml","xml"),jB=a("vnd.dna","dna"),GB=a("vnd.document+json","json"),XB=a("vnd.dolby.mlp","mlp"),qB=a("vnd.dolby.mobile.1"),KB=a("vnd.dolby.mobile.2"),YB=a("vnd.doremir.scorecloud-binary-document"),JB=a("vnd.dpgraph","dpg"),QB=a("vnd.dreamfactory","dfac"),$B=a("vnd.drive+json","json"),ZB=a("vnd.ds-keypoint","kpxx"),e4=a("vnd.dtg.local"),t4=a("vnd.dtg.local.flash"),n4=a("vnd.dtg.local.html"),r4=a("vnd.dvb.ait","ait"),i4=a("vnd.dvb.dvbj"),o4=a("vnd.dvb.esgcontainer"),s4=a("vnd.dvb.ipdcdftnotifaccess"),a4=a("vnd.dvb.ipdcesgaccess"),l4=a("vnd.dvb.ipdcesgaccess2"),c4=a("vnd.dvb.ipdcesgpdd"),u4=a("vnd.dvb.ipdcroaming"),p4=a("vnd.dvb.iptv.alfec-base"),d4=a("vnd.dvb.iptv.alfec-enhancement"),h4=a("vnd.dvb.notif-aggregate-root+xml","xml"),m4=a("vnd.dvb.notif-container+xml","xml"),f4=a("vnd.dvb.notif-generic+xml","xml"),g4=a("vnd.dvb.notif-ia-msglist+xml","xml"),x4=a("vnd.dvb.notif-ia-registration-request+xml","xml"),w4=a("vnd.dvb.notif-ia-registration-response+xml","xml"),v4=a("vnd.dvb.notif-init+xml","xml"),F4=a("vnd.dvb.pfr"),A4=a("vnd.dvb.service","svc"),b4=a("vnd.dxr"),S4=a("vnd.dynageo","geo"),y4=a("vnd.dzr"),T4=a("vnd.easykaraoke.cdgdownload"),E4=a("vnd.ecdis-update"),_4=a("vnd.ecip.rlp"),M4=a("vnd.ecowin.chart","mag"),k4=a("vnd.ecowin.filerequest"),C4=a("vnd.ecowin.fileupdate"),D4=a("vnd.ecowin.series"),P4=a("vnd.ecowin.seriesrequest"),L4=a("vnd.ecowin.seriesupdate"),I4=a("vnd.efi.img"),R4=a("vnd.efi.iso"),B4=a("vnd.emclient.accessrequest+xml","xml"),V4=a("vnd.enliven","nml"),O4=a("vnd.enphase.envoy"),N4=a("vnd.eprints.data+xml","xml"),H4=a("vnd.epson.esf","esf"),W4=a("vnd.epson.msf","msf"),U4=a("vnd.epson.quickanime","qam"),z4=a("vnd.epson.salt","slt"),j4=a("vnd.epson.ssf","ssf"),G4=a("vnd.ericsson.quickcall"),X4=a("vnd.espass-espass+zip","zip"),q4=a("vnd.eszigno3+xml","es3","et3"),K4=a("vnd.etsi.aoc+xml","xml"),Y4=a("vnd.etsi.asic-e+zip","zip"),J4=a("vnd.etsi.asic-s+zip","zip"),Q4=a("vnd.etsi.cug+xml","xml"),$4=a("vnd.etsi.iptvcommand+xml","xml"),Z4=a("vnd.etsi.iptvdiscovery+xml","xml"),eV=a("vnd.etsi.iptvprofile+xml","xml"),tV=a("vnd.etsi.iptvsad-bc+xml","xml"),nV=a("vnd.etsi.iptvsad-cod+xml","xml"),rV=a("vnd.etsi.iptvsad-npvr+xml","xml"),iV=a("vnd.etsi.iptvservice+xml","xml"),oV=a("vnd.etsi.iptvsync+xml","xml"),sV=a("vnd.etsi.iptvueprofile+xml","xml"),aV=a("vnd.etsi.mcid+xml","xml"),lV=a("vnd.etsi.mheg5"),cV=a("vnd.etsi.overload-control-policy-dataset+xml","xml"),uV=a("vnd.etsi.pstn+xml","xml"),pV=a("vnd.etsi.sci+xml","xml"),dV=a("vnd.etsi.simservs+xml","xml"),hV=a("vnd.etsi.timestamp-token"),mV=a("vnd.etsi.tsl.der"),fV=a("vnd.etsi.tsl+xml","xml"),gV=a("vnd.eudora.data"),xV=a("vnd.evolv.ecig.profile"),wV=a("vnd.evolv.ecig.settings"),vV=a("vnd.evolv.ecig.theme"),FV=a("vnd.exstream-empower+zip","zip"),AV=a("vnd.exstream-package"),bV=a("vnd.ezpix-album","ez2"),SV=a("vnd.ezpix-package","ez3"),yV=a("vnd.f-secure.mobile"),TV=a("vnd.fastcopy-disk-image"),EV=a("vnd.fdf","fdf"),_V=a("vnd.fdsn.mseed","mseed"),MV=a("vnd.fdsn.seed","seed","dataless"),kV=a("vnd.ffsns"),CV=a("vnd.ficlab.flb+zip","zip"),DV=a("vnd.filmit.zfc"),PV=a("vnd.fints"),LV=a("vnd.firemonkeys.cloudcell"),IV=a("vnd.flographit","gph"),RV=a("vnd.fluxtime.clip","ftc"),BV=a("vnd.font-fontforge-sfd"),VV=a("vnd.framemaker","fm","frame","maker","book"),OV=a("vnd.frogans.fnc","fnc"),NV=a("vnd.frogans.ltf","ltf"),HV=a("vnd.fsc.weblaunch","fsc"),WV=a("vnd.fujitsu.oasys","oas"),UV=a("vnd.fujitsu.oasys2","oa2"),zV=a("vnd.fujitsu.oasys3","oa3"),jV=a("vnd.fujitsu.oasysgp","fg5"),GV=a("vnd.fujitsu.oasysprs","bh2"),XV=a("vnd.fujixerox.art-ex"),qV=a("vnd.fujixerox.art4"),KV=a("vnd.fujixerox.ddd","ddd"),YV=a("vnd.fujixerox.docuworks","xdw"),JV=a("vnd.fujixerox.docuworks.binder","xbd"),QV=a("vnd.fujixerox.docuworks.container"),$V=a("vnd.fujixerox.hbpl"),ZV=a("vnd.fut-misnet"),eO=a("vnd.futoin+cbor","cbor"),tO=a("vnd.futoin+json","json"),nO=a("vnd.fuzzysheet","fzs"),rO=a("vnd.genomatix.tuxedo","txd"),iO=a("vnd.gentics.grd+json","json"),oO=a("vnd.geocube+xml","xml").deprecate("by request"),sO=a("vnd.geogebra.file","ggb"),aO=a("vnd.geogebra.tool","ggt"),lO=a("vnd.geo+json","json").deprecate("in favor of application/geo+json"),cO=a("vnd.geometry-explorer","gex","gre"),uO=a("vnd.geonext","gxt"),pO=a("vnd.geoplan","g2w"),dO=a("vnd.geospace","g3w"),hO=a("vnd.gerber"),mO=a("vnd.globalplatform.card-content-mgt"),fO=a("vnd.globalplatform.card-content-mgt-response"),gO=a("vnd.gmx","gmx").deprecate("with no reason given"),xO=a("vnd.google-apps.document","gdoc"),wO=a("vnd.google-apps.presentation","gslides"),vO=a("vnd.google-apps.spreadsheet","gsheet"),FO=a("vnd.google-earth.kml+xml","kml"),AO=a("vnd.google-earth.kmz","kmz"),bO=a("vnd.gov.sk.e-form+xml","xml"),SO=a("vnd.gov.sk.e-form+zip","zip"),yO=a("vnd.gov.sk.xmldatacontainer+xml","xml"),TO=a("vnd.grafeq","gqf","gqs"),EO=a("vnd.gridmp"),_O=a("vnd.groove-account","gac"),MO=a("vnd.groove-help","ghf"),kO=a("vnd.groove-identity-message","gim"),CO=a("vnd.groove-injector","grv"),DO=a("vnd.groove-tool-message","gtm"),PO=a("vnd.groove-tool-template","tpl"),LO=a("vnd.groove-vcard","vcg"),IO=a("vnd.hal+json","json"),RO=a("vnd.hal+xml","hal"),BO=a("vnd.handheld-entertainment+xml","zmm"),VO=a("vnd.hbci","hbci"),OO=a("vnd.hc+json","json"),NO=a("vnd.hcl-bireports"),HO=a("vnd.hdt"),WO=a("vnd.heroku+json","json"),UO=a("vnd.hhe.lesson-player","les"),zO=a("vnd.hp-hpgl","hpgl"),jO=a("vnd.hp-hpid","hpid"),GO=a("vnd.hp-hps","hps"),XO=a("vnd.hp-jlyt","jlt"),qO=a("vnd.hp-pcl","pcl"),KO=a("vnd.hp-pclxl","pclxl"),YO=a("vnd.httphone"),JO=a("vnd.hydrostatix.sof-data","sfd-hdstx"),QO=a("vnd.hyper-item+json","json"),$O=a("vnd.hyperdrive+json","json"),ZO=a("vnd.hyper+json","json"),e6=a("vnd.hzn-3d-crossword"),t6=a("vnd.ibm.afplinedata").deprecate("in favor of vnd.afpc.afplinedata"),n6=a("vnd.ibm.electronic-media"),r6=a("vnd.ibm.minipay","mpy"),i6=a("vnd.ibm.modcap","afp","listafp","list3820").deprecate("in favor of application/vnd.afpc.modca"),o6=a("vnd.ibm.rights-management","irm"),s6=a("vnd.ibm.secure-container","sc"),a6=a("vnd.iccprofile","icc","icm"),l6=a("vnd.ieee.1905"),c6=a("vnd.igloader","igl"),u6=a("vnd.imagemeter.folder+zip","zip"),p6=a("vnd.imagemeter.image+zip","zip"),d6=a("vnd.immervision-ivp","ivp"),h6=a("vnd.immervision-ivu","ivu"),m6=a("vnd.ims.imsccv1p1"),f6=a("vnd.ims.imsccv1p2"),g6=a("vnd.ims.imsccv1p3"),x6=a("vnd.ims.lis.v2.result+json","json"),w6=a("vnd.ims.lti.v2.toolconsumerprofile+json","json"),v6=a("vnd.ims.lti.v2.toolproxy.id+json","json"),F6=a("vnd.ims.lti.v2.toolproxy+json","json"),A6=a("vnd.ims.lti.v2.toolsettings+json","json"),b6=a("vnd.ims.lti.v2.toolsettings.simple+json","json"),S6=a("vnd.informedcontrol.rms+xml","xml"),y6=a("vnd.informix-visionary").deprecate("in favor of application/vnd.visionary"),T6=a("vnd.infotech.project"),E6=a("vnd.infotech.project+xml","xml"),_6=a("vnd.innopath.wamp.notification"),M6=a("vnd.insors.igm","igm"),k6=a("vnd.intercon.formnet","xpw","xpx"),C6=a("vnd.intergeo","i2g"),D6=a("vnd.intertrust.digibox"),P6=a("vnd.intertrust.nncp"),L6=a("vnd.intu.qbo","qbo"),I6=a("vnd.intu.qfx","qfx"),R6=a("vnd.iptc.g2.catalogitem+xml","xml"),B6=a("vnd.iptc.g2.conceptitem+xml","xml"),V6=a("vnd.iptc.g2.knowledgeitem+xml","xml"),O6=a("vnd.iptc.g2.newsitem+xml","xml"),N6=a("vnd.iptc.g2.newsmessage+xml","xml"),H6=a("vnd.iptc.g2.packageitem+xml","xml"),W6=a("vnd.iptc.g2.planningitem+xml","xml"),U6=a("vnd.ipunplugged.rcprofile","rcprofile"),z6=a("vnd.irepository.package+xml","irp"),j6=a("vnd.is-xpr","xpr"),G6=a("vnd.isac.fcs","fcs"),X6=a("vnd.iso11783-10+zip","zip"),q6=a("vnd.jam","jam"),K6=a("vnd.japannet-directory-service"),Y6=a("vnd.japannet-jpnstore-wakeup"),J6=a("vnd.japannet-payment-wakeup"),Q6=a("vnd.japannet-registration"),$6=a("vnd.japannet-registration-wakeup"),Z6=a("vnd.japannet-setstore-wakeup"),eN=a("vnd.japannet-verification"),tN=a("vnd.japannet-verification-wakeup"),nN=a("vnd.jcp.javame.midlet-rms","rms"),rN=a("vnd.jisp","jisp"),iN=a("vnd.joost.joda-archive","joda"),oN=a("vnd.jsk.isdn-ngn"),sN=a("vnd.kahootz","ktz","ktr"),aN=a("vnd.kde.karbon","karbon"),lN=a("vnd.kde.kchart","chrt"),cN=a("vnd.kde.kformula","kfo"),uN=a("vnd.kde.kivio","flw"),pN=a("vnd.kde.kontour","kon"),dN=a("vnd.kde.kpresenter","kpr","kpt"),hN=a("vnd.kde.kspread","ksp"),mN=a("vnd.kde.kword","kwd","kwt"),fN=a("vnd.kenameaapp","htke"),gN=a("vnd.kidspiration","kia"),xN=a("vnd.kinar","kne","knp"),wN=a("vnd.koan","skp","skd","skt","skm"),vN=a("vnd.kodak-descriptor","sse"),FN=a("vnd.las"),AN=a("vnd.las.las+json","json"),bN=a("vnd.las.las+xml","lasxml"),SN=a("vnd.laszip"),yN=a("vnd.leap+json","json"),TN=a("vnd.liberty-request+xml","xml"),EN=a("vnd.llamagraphics.life-balance.desktop","lbd"),_N=a("vnd.llamagraphics.life-balance.exchange+xml","lbe"),MN=a("vnd.logipipe.circuit+zip","zip"),kN=a("vnd.loom"),CN=a("vnd.lotus-1-2-3","123"),DN=a("vnd.lotus-approach","apr"),PN=a("vnd.lotus-freelance","pre"),LN=a("vnd.lotus-notes","nsf"),IN=a("vnd.lotus-organizer","org"),RN=a("vnd.lotus-screencam","scm"),BN=a("vnd.lotus-wordpro","lwp"),VN=a("vnd.macports.portpkg","portpkg"),ON=a("vnd.mapbox-vector-tile"),NN=a("vnd.marlin.drm.actiontoken+xml","xml"),HN=a("vnd.marlin.drm.conftoken+xml","xml"),WN=a("vnd.marlin.drm.license+xml","xml"),UN=a("vnd.marlin.drm.mdcf"),zN=a("vnd.mason+json","json"),jN=a("vnd.maxmind.maxmind-db"),GN=a("vnd.mcd","mcd"),XN=a("vnd.medcalcdata","mc1"),qN=a("vnd.mediastation.cdkey","cdkey"),KN=a("vnd.meridian-slingshot"),YN=a("vnd.mfer","mwf"),JN=a("vnd.mfmp","mfm"),QN=a("vnd.micrografx.flo","flo"),$N=a("vnd.micrografx.igx","igx"),ZN=a("vnd.micro+json","json"),e5=a("vnd.microsoft.portable-executable"),t5=a("vnd.microsoft.windows.thumbnail-cache"),n5=a("vnd.miele+json","json"),r5=a("vnd.mif","mif"),i5=a("vnd.minisoft-hp3000-save"),o5=a("vnd.mitsubishi.misty-guard.trustweb"),s5=a("vnd.mobius.daf","daf"),a5=a("vnd.mobius.dis","dis"),l5=a("vnd.mobius.mbk","mbk"),c5=a("vnd.mobius.mqy","mqy"),u5=a("vnd.mobius.msl","msl"),p5=a("vnd.mobius.plc","plc"),d5=a("vnd.mobius.txf","txf"),h5=a("vnd.mophun.application","mpn"),m5=a("vnd.mophun.certificate","mpc"),f5=a("vnd.motorola.flexsuite"),g5=a("vnd.motorola.flexsuite.adsi"),x5=a("vnd.motorola.flexsuite.fis"),w5=a("vnd.motorola.flexsuite.gotap"),v5=a("vnd.motorola.flexsuite.kmr"),F5=a("vnd.motorola.flexsuite.ttc"),A5=a("vnd.motorola.flexsuite.wem"),b5=a("vnd.motorola.iprm"),S5=a("vnd.mozilla.xul+xml","xul"),y5=a("vnd.ms-3mfdocument"),T5=a("vnd.ms-artgalry","cil"),E5=a("vnd.ms-asf"),_5=a("vnd.ms-cab-compressed","cab"),M5=a("vnd.ms-color.iccprofile"),k5=a("vnd.ms-excel","xls","xlm","xla","xlc","xlt","xlw"),C5=a("vnd.ms-excel.addin.macroenabled.12","xlam"),D5=a("vnd.ms-excel.sheet.binary.macroenabled.12","xlsb"),P5=a("vnd.ms-excel.sheet.macroenabled.12","xlsm"),L5=a("vnd.ms-excel.template.macroenabled.12","xltm"),I5=a("vnd.ms-fontobject","eot"),R5=a("vnd.ms-htmlhelp","chm"),B5=a("vnd.ms-ims","ims"),V5=a("vnd.ms-lrm","lrm"),O5=a("vnd.ms-office.activex+xml","xml"),N5=a("vnd.ms-officetheme","thmx"),H5=a("vnd.ms-opentype"),W5=a("vnd.ms-outlook","msg"),U5=a("vnd.ms-package.obfuscated-opentype"),z5=a("vnd.ms-pki.seccat","cat"),j5=a("vnd.ms-pki.stl","stl"),G5=a("vnd.ms-playready.initiator+xml","xml"),X5=a("vnd.ms-powerpoint","ppt","pps","pot"),q5=a("vnd.ms-powerpoint.addin.macroenabled.12","ppam"),K5=a("vnd.ms-powerpoint.presentation.macroenabled.12","pptm"),Y5=a("vnd.ms-powerpoint.slide.macroenabled.12","sldm"),J5=a("vnd.ms-powerpoint.slideshow.macroenabled.12","ppsm"),Q5=a("vnd.ms-powerpoint.template.macroenabled.12","potm"),$5=a("vnd.ms-printdevicecapabilities+xml","xml"),Z5=a("vnd.ms-printing.printticket+xml","xml"),e9=a("vnd.ms-printschematicket+xml","xml"),t9=a("vnd.ms-project","mpp","mpt"),n9=a("vnd.ms-tnef"),r9=a("vnd.ms-windows.devicepairing"),i9=a("vnd.ms-windows.nwprinting.oob"),o9=a("vnd.ms-windows.printerpairing"),s9=a("vnd.ms-windows.wsd.oob"),a9=a("vnd.ms-wmdrm.lic-chlg-req"),l9=a("vnd.ms-wmdrm.lic-resp"),c9=a("vnd.ms-wmdrm.meter-chlg-req"),u9=a("vnd.ms-wmdrm.meter-resp"),p9=a("vnd.ms-word.document.macroenabled.12","docm"),d9=a("vnd.ms-word.template.macroenabled.12","dotm"),h9=a("vnd.ms-works","wps","wks","wcm","wdb"),m9=a("vnd.ms-wpl","wpl"),f9=a("vnd.ms-xpsdocument","xps"),g9=a("vnd.msa-disk-image"),x9=a("vnd.mseq","mseq"),w9=a("vnd.msign"),v9=a("vnd.multiad.creator"),F9=a("vnd.multiad.creator.cif"),A9=a("vnd.music-niff"),b9=a("vnd.musician","mus"),S9=a("vnd.muvee.style","msty"),y9=a("vnd.mynfc","taglet"),T9=a("vnd.ncd.control"),E9=a("vnd.ncd.reference"),_9=a("vnd.nearst.inv+json","json"),M9=a("vnd.nervana"),k9=a("vnd.netfpx"),C9=a("vnd.neurolanguage.nlu","nlu"),D9=a("vnd.nimn"),P9=a("vnd.nintendo.nitro.rom"),L9=a("vnd.nintendo.snes.rom"),I9=a("vnd.nitf","ntf","nitf"),R9=a("vnd.noblenet-directory","nnd"),B9=a("vnd.noblenet-sealer","nns"),V9=a("vnd.noblenet-web","nnw"),O9=a("vnd.nokia.catalogs"),N9=a("vnd.nokia.conml+wbxml","wbxml"),H9=a("vnd.nokia.conml+xml","xml"),W9=a("vnd.nokia.iptv.config+xml","xml"),U9=a("vnd.nokia.isds-radio-presets"),z9=a("vnd.nokia.landmarkcollection+xml","xml"),j9=a("vnd.nokia.landmark+wbxml","wbxml"),G9=a("vnd.nokia.landmark+xml","xml"),X9=a("vnd.nokia.n-gage.ac+xml","xml"),q9=a("vnd.nokia.n-gage.data","ngdat"),K9=a("vnd.nokia.n-gage.symbian.install","n-gage").deprecate("as obsolete with no replacement given"),Y9=a("vnd.nokia.ncd"),J9=a("vnd.nokia.pcd+wbxml","wbxml"),Q9=a("vnd.nokia.pcd+xml","xml"),$9=a("vnd.nokia.radio-preset","rpst"),Z9=a("vnd.nokia.radio-presets","rpss"),eH=a("vnd.novadigm.edm","edm"),tH=a("vnd.novadigm.edx","edx"),nH=a("vnd.novadigm.ext","ext"),rH=a("vnd.ntt-local.content-share"),iH=a("vnd.ntt-local.file-transfer"),oH=a("vnd.ntt-local.ogw_remote-access"),sH=a("vnd.ntt-local.sip-ta_remote"),aH=a("vnd.ntt-local.sip-ta_tcp_stream"),lH=a("vnd.oasis.opendocument.chart","odc"),cH=a("vnd.oasis.opendocument.chart-template","otc"),uH=a("vnd.oasis.opendocument.database","odb"),pH=a("vnd.oasis.opendocument.formula","odf"),dH=a("vnd.oasis.opendocument.formula-template","odft"),hH=a("vnd.oasis.opendocument.graphics","odg"),mH=a("vnd.oasis.opendocument.graphics-template","otg"),fH=a("vnd.oasis.opendocument.image","odi"),gH=a("vnd.oasis.opendocument.image-template","oti"),xH=a("vnd.oasis.opendocument.presentation","odp"),wH=a("vnd.oasis.opendocument.presentation-template","otp"),vH=a("vnd.oasis.opendocument.spreadsheet","ods"),FH=a("vnd.oasis.opendocument.spreadsheet-template","ots"),AH=a("vnd.oasis.opendocument.text","odt"),bH=a("vnd.oasis.opendocument.text-master","odm"),SH=a("vnd.oasis.opendocument.text-template","ott"),yH=a("vnd.oasis.opendocument.text-web","oth"),TH=a("vnd.obn"),EH=a("vnd.ocf+cbor","cbor"),_H=a("vnd.oftn.l10n+json","json"),MH=a("vnd.oipf.contentaccessdownload+xml","xml"),kH=a("vnd.oipf.contentaccessstreaming+xml","xml"),CH=a("vnd.oipf.cspg-hexbinary"),DH=a("vnd.oipf.dae.svg+xml","xml"),PH=a("vnd.oipf.dae.xhtml+xml","xml"),LH=a("vnd.oipf.mippvcontrolmessage+xml","xml"),IH=a("vnd.oipf.pae.gem"),RH=a("vnd.oipf.spdiscovery+xml","xml"),BH=a("vnd.oipf.spdlist+xml","xml"),VH=a("vnd.oipf.ueprofile+xml","xml"),OH=a("vnd.oipf.userprofile+xml","xml"),NH=a("vnd.olpc-sugar","xo"),HH=a("vnd.oma-scws-config"),WH=a("vnd.oma-scws-http-request"),UH=a("vnd.oma-scws-http-response"),zH=a("vnd.oma.bcast.associated-procedure-parameter+xml","xml"),jH=a("vnd.oma.bcast.drm-trigger+xml","xml"),GH=a("vnd.oma.bcast.imd+xml","xml"),XH=a("vnd.oma.bcast.ltkm"),qH=a("vnd.oma.bcast.notification+xml","xml"),KH=a("vnd.oma.bcast.provisioningtrigger"),YH=a("vnd.oma.bcast.sgboot"),JH=a("vnd.oma.bcast.sgdd+xml","xml"),QH=a("vnd.oma.bcast.sgdu"),$H=a("vnd.oma.bcast.simple-symbol-container"),ZH=a("vnd.oma.bcast.smartcard-trigger+xml","xml"),eW=a("vnd.oma.bcast.sprov+xml","xml"),tW=a("vnd.oma.bcast.stkm"),nW=a("vnd.oma.cab-address-book+xml","xml"),rW=a("vnd.oma.cab-feature-handler+xml","xml"),iW=a("vnd.oma.cab-pcc+xml","xml"),oW=a("vnd.oma.cab-subs-invite+xml","xml"),sW=a("vnd.oma.cab-user-prefs+xml","xml"),aW=a("vnd.oma.dcd"),lW=a("vnd.oma.dcdc"),cW=a("vnd.oma.dd2+xml","dd2"),uW=a("vnd.oma.drm.risd+xml","xml"),pW=a("vnd.omads-email+xml","xml"),dW=a("vnd.omads-file+xml","xml"),hW=a("vnd.omads-folder+xml","xml"),mW=a("vnd.oma.group-usage-list+xml","xml"),fW=a("vnd.omaloc-supl-init"),gW=a("vnd.oma.lwm2m+json","json"),xW=a("vnd.oma.lwm2m+tlv","tlv"),wW=a("vnd.oma.pal+xml","xml"),vW=a("vnd.oma.poc.detailed-progress-report+xml","xml"),FW=a("vnd.oma.poc.final-report+xml","xml"),AW=a("vnd.oma.poc.groups+xml","xml"),bW=a("vnd.oma.poc.invocation-descriptor+xml","xml"),SW=a("vnd.oma.poc.optimized-progress-report+xml","xml"),yW=a("vnd.oma.push"),TW=a("vnd.oma.scidm.messages+xml","xml"),EW=a("vnd.oma.xcap-directory+xml","xml"),_W=a("vnd.onepager"),MW=a("vnd.onepagertamp"),kW=a("vnd.onepagertamx"),CW=a("vnd.onepagertat"),DW=a("vnd.onepagertatp"),PW=a("vnd.onepagertatx"),LW=a("vnd.openblox.game-binary"),IW=a("vnd.openblox.game+xml","xml"),RW=a("vnd.openeye.oeb"),BW=a("vnd.openofficeorg.extension","oxt"),VW=a("vnd.openstreetmap.data+xml","xml"),OW=a("vnd.openxmlformats-officedocument.custom-properties+xml","xml"),NW=a("vnd.openxmlformats-officedocument.customxmlproperties+xml","xml"),HW=a("vnd.openxmlformats-officedocument.drawingml.chartshapes+xml","xml"),WW=a("vnd.openxmlformats-officedocument.drawingml.chart+xml","xml"),UW=a("vnd.openxmlformats-officedocument.drawingml.diagramcolors+xml","xml"),zW=a("vnd.openxmlformats-officedocument.drawingml.diagramdata+xml","xml"),jW=a("vnd.openxmlformats-officedocument.drawingml.diagramlayout+xml","xml"),GW=a("vnd.openxmlformats-officedocument.drawingml.diagramstyle+xml","xml"),XW=a("vnd.openxmlformats-officedocument.drawing+xml","xml"),qW=a("vnd.openxmlformats-officedocument.extended-properties+xml","xml"),KW=a("vnd.openxmlformats-officedocument.presentationml.commentauthors+xml","xml"),YW=a("vnd.openxmlformats-officedocument.presentationml.comments+xml","xml"),JW=a("vnd.openxmlformats-officedocument.presentationml.handoutmaster+xml","xml"),QW=a("vnd.openxmlformats-officedocument.presentationml.notesmaster+xml","xml"),$W=a("vnd.openxmlformats-officedocument.presentationml.notesslide+xml","xml"),ZW=a("vnd.openxmlformats-officedocument.presentationml.presentation","pptx"),e8=a("vnd.openxmlformats-officedocument.presentationml.presentation.main+xml","xml"),t8=a("vnd.openxmlformats-officedocument.presentationml.presprops+xml","xml"),n8=a("vnd.openxmlformats-officedocument.presentationml.slide","sldx"),r8=a("vnd.openxmlformats-officedocument.presentationml.slidelayout+xml","xml"),i8=a("vnd.openxmlformats-officedocument.presentationml.slidemaster+xml","xml"),o8=a("vnd.openxmlformats-officedocument.presentationml.slideshow","ppsx"),s8=a("vnd.openxmlformats-officedocument.presentationml.slideshow.main+xml","xml"),a8=a("vnd.openxmlformats-officedocument.presentationml.slideupdateinfo+xml","xml"),l8=a("vnd.openxmlformats-officedocument.presentationml.slide+xml","xml"),c8=a("vnd.openxmlformats-officedocument.presentationml.tablestyles+xml","xml"),u8=a("vnd.openxmlformats-officedocument.presentationml.tags+xml","xml"),p8=a("vnd.openxmlformats-officedocument.presentationml.template","potx"),d8=a("vnd.openxmlformats-officedocument.presentationml.template.main+xml","xml"),h8=a("vnd.openxmlformats-officedocument.presentationml.viewprops+xml","xml"),m8=a("vnd.openxmlformats-officedocument.spreadsheetml.calcchain+xml","xml"),f8=a("vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml","xml"),g8=a("vnd.openxmlformats-officedocument.spreadsheetml.comments+xml","xml"),x8=a("vnd.openxmlformats-officedocument.spreadsheetml.connections+xml","xml"),w8=a("vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml","xml"),v8=a("vnd.openxmlformats-officedocument.spreadsheetml.externallink+xml","xml"),F8=a("vnd.openxmlformats-officedocument.spreadsheetml.pivotcachedefinition+xml","xml"),A8=a("vnd.openxmlformats-officedocument.spreadsheetml.pivotcacherecords+xml","xml"),b8=a("vnd.openxmlformats-officedocument.spreadsheetml.pivottable+xml","xml"),S8=a("vnd.openxmlformats-officedocument.spreadsheetml.querytable+xml","xml"),y8=a("vnd.openxmlformats-officedocument.spreadsheetml.revisionheaders+xml","xml"),T8=a("vnd.openxmlformats-officedocument.spreadsheetml.revisionlog+xml","xml"),E8=a("vnd.openxmlformats-officedocument.spreadsheetml.sharedstrings+xml","xml"),_8=a("vnd.openxmlformats-officedocument.spreadsheetml.sheet","xlsx"),M8=a("vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml","xml"),k8=a("vnd.openxmlformats-officedocument.spreadsheetml.sheetmetadata+xml","xml"),C8=a("vnd.openxmlformats-officedocument.spreadsheetml.styles+xml","xml"),D8=a("vnd.openxmlformats-officedocument.spreadsheetml.tablesinglecells+xml","xml"),P8=a("vnd.openxmlformats-officedocument.spreadsheetml.table+xml","xml"),L8=a("vnd.openxmlformats-officedocument.spreadsheetml.template","xltx"),I8=a("vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml","xml"),R8=a("vnd.openxmlformats-officedocument.spreadsheetml.usernames+xml","xml"),B8=a("vnd.openxmlformats-officedocument.spreadsheetml.volatiledependencies+xml","xml"),V8=a("vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml","xml"),O8=a("vnd.openxmlformats-officedocument.themeoverride+xml","xml"),N8=a("vnd.openxmlformats-officedocument.theme+xml","xml"),H8=a("vnd.openxmlformats-officedocument.vmldrawing"),W8=a("vnd.openxmlformats-officedocument.wordprocessingml.comments+xml","xml"),U8=a("vnd.openxmlformats-officedocument.wordprocessingml.document","docx"),z8=a("vnd.openxmlformats-officedocument.wordprocessingml.document.glossary+xml","xml"),j8=a("vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml","xml"),G8=a("vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml","xml"),X8=a("vnd.openxmlformats-officedocument.wordprocessingml.fonttable+xml","xml"),q8=a("vnd.openxmlformats-officedocument.wordprocessingml.footer+xml","xml"),K8=a("vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml","xml"),Y8=a("vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml","xml"),J8=a("vnd.openxmlformats-officedocument.wordprocessingml.settings+xml","xml"),Q8=a("vnd.openxmlformats-officedocument.wordprocessingml.styles+xml","xml"),$8=a("vnd.openxmlformats-officedocument.wordprocessingml.template","dotx"),Z8=a("vnd.openxmlformats-officedocument.wordprocessingml.template.main+xml","xml"),e7=a("vnd.openxmlformats-officedocument.wordprocessingml.websettings+xml","xml"),t7=a("vnd.openxmlformats-package.core-properties+xml","xml"),n7=a("vnd.openxmlformats-package.digital-signature-xmlsignature+xml","xml"),r7=a("vnd.openxmlformats-package.relationships+xml","xml"),i7=a("vnd.oracle.resource+json","json"),o7=a("vnd.orange.indata"),s7=a("vnd.osa.netdeploy"),a7=a("vnd.osgeo.mapguide.package","mgp"),l7=a("vnd.osgi.bundle"),c7=a("vnd.osgi.dp","dp"),u7=a("vnd.osgi.subsystem","esa"),p7=a("vnd.otps.ct-kip+xml","xml"),d7=a("vnd.oxli.countgraph"),h7=a("vnd.pagerduty+json","json"),m7=a("vnd.palm","pdb","pqa","oprc"),f7=a("vnd.panoply"),g7=a("vnd.paos.xml"),x7=a("vnd.patentdive"),w7=a("vnd.patientecommsdoc"),v7=a("vnd.pawaafile","paw"),F7=a("vnd.pcos"),A7=a("vnd.pg.format","str"),b7=a("vnd.pg.osasli","ei6"),S7=a("vnd.piaccess.application-licence"),y7=a("vnd.picsel","efif"),T7=a("vnd.pmi.widget","wg"),E7=a("vnd.poc.group-advertisement+xml","xml"),_7=a("vnd.pocketlearn","plf"),M7=a("vnd.powerbuilder6","pbd"),k7=a("vnd.powerbuilder6-s"),C7=a("vnd.powerbuilder7"),D7=a("vnd.powerbuilder7-s"),P7=a("vnd.powerbuilder75"),L7=a("vnd.powerbuilder75-s"),I7=a("vnd.preminet"),R7=a("vnd.previewsystems.box","box"),B7=a("vnd.proteus.magazine","mgz"),V7=a("vnd.psfs"),O7=a("vnd.publishare-delta-tree","qps"),N7=a("vnd.pvi.ptid1","ptid"),H7=a("vnd.pwg-multiplexed"),W7=a("vnd.pwg-xhtml-print+xml","xml"),U7=a("vnd.qualcomm.brew-app-res"),z7=a("vnd.quarantainenet"),j7=a("vnd.quark.quarkxpress","qxd","qxt","qwd","qwt","qxl","qxb"),G7=a("vnd.quobject-quoxdocument"),X7=a("vnd.radisys.moml+xml","xml"),q7=a("vnd.radisys.msml-audit-conf+xml","xml"),K7=a("vnd.radisys.msml-audit-conn+xml","xml"),Y7=a("vnd.radisys.msml-audit-dialog+xml","xml"),J7=a("vnd.radisys.msml-audit-stream+xml","xml"),Q7=a("vnd.radisys.msml-audit+xml","xml"),$7=a("vnd.radisys.msml-conf+xml","xml"),Z7=a("vnd.radisys.msml-dialog-base+xml","xml"),eU=a("vnd.radisys.msml-dialog-fax-detect+xml","xml"),tU=a("vnd.radisys.msml-dialog-fax-sendrecv+xml","xml"),nU=a("vnd.radisys.msml-dialog-group+xml","xml"),rU=a("vnd.radisys.msml-dialog-speech+xml","xml"),iU=a("vnd.radisys.msml-dialog-transform+xml","xml"),oU=a("vnd.radisys.msml-dialog+xml","xml"),sU=a("vnd.radisys.msml+xml","xml"),aU=a("vnd.rainstor.data"),lU=a("vnd.rapid"),cU=a("vnd.rar"),uU=a("vnd.realvnc.bed","bed"),pU=a("vnd.recordare.musicxml","mxl"),dU=a("vnd.recordare.musicxml+xml","musicxml"),hU=a("vnd.renlearn.rlprint"),mU=a("vnd.restful+json","json"),fU=a("vnd.rig.cryptonote","cryptonote"),gU=a("vnd.rim.cod","cod"),xU=a("vnd.rn-realmedia","rm"),wU=a("vnd.rn-realmedia-vbr","rmvb"),vU=a("vnd.route66.link66+xml","link66"),FU=a("vnd.rs-274x"),AU=a("vnd.ruckus.download"),bU=a("vnd.s3sms"),SU=a("vnd.sailingtracker.track","st"),yU=a("vnd.sar"),TU=a("vnd.sbm.cid"),EU=a("vnd.sbm.mid2"),_U=a("vnd.scribus"),MU=a("vnd.sealed.3df"),kU=a("vnd.sealed.csf"),CU=a("vnd.sealed.doc"),DU=a("vnd.sealed.eml"),PU=a("vnd.sealedmedia.softseal.html"),LU=a("vnd.sealedmedia.softseal.pdf"),IU=a("vnd.sealed.mht"),RU=a("vnd.sealed.net"),BU=a("vnd.sealed.ppt"),VU=a("vnd.sealed.tiff"),OU=a("vnd.sealed.xls"),NU=a("vnd.seemail","see"),HU=a("vnd.sema","sema"),WU=a("vnd.semd","semd"),UU=a("vnd.semf","semf"),zU=a("vnd.shade-save-file"),jU=a("vnd.shana.informed.formdata","ifm"),GU=a("vnd.shana.informed.formtemplate","itp"),XU=a("vnd.shana.informed.interchange","iif"),qU=a("vnd.shana.informed.package","ipk"),KU=a("vnd.shootproof+json","json"),YU=a("vnd.shopkick+json","json"),JU=a("vnd.sigrok.session"),QU=a("vnd.simtech-mindmapper","twd","twds"),$U=a("vnd.siren+json","json"),ZU=a("vnd.smaf","mmf"),ez=a("vnd.smart.notebook"),tz=a("vnd.smart.teacher","teacher"),nz=a("vnd.software602.filler.form-xml-zip"),rz=a("vnd.software602.filler.form+xml","xml"),iz=a("vnd.solent.sdkm+xml","sdkm","sdkd"),oz=a("vnd.spotfire.dxp","dxp"),sz=a("vnd.spotfire.sfs","sfs"),az=a("vnd.sqlite3"),lz=a("vnd.sss-cod"),cz=a("vnd.sss-dtf"),uz=a("vnd.sss-ntf"),pz=a("vnd.stardivision.calc","sdc"),dz=a("vnd.stardivision.draw","sda"),hz=a("vnd.stardivision.impress","sdd"),mz=a("vnd.stardivision.math","smf"),fz=a("vnd.stardivision.writer","sdw","vor"),gz=a("vnd.stardivision.writer-global","sgl"),xz=a("vnd.stepmania.package","smzip"),wz=a("vnd.stepmania.stepchart","sm"),vz=a("vnd.street-stream"),Fz=a("vnd.sun.wadl+xml","xml"),Az=a("vnd.sun.xml.calc","sxc"),bz=a("vnd.sun.xml.calc.template","stc"),Sz=a("vnd.sun.xml.draw","sxd"),yz=a("vnd.sun.xml.draw.template","std"),Tz=a("vnd.sun.xml.impress","sxi"),Ez=a("vnd.sun.xml.impress.template","sti"),_z=a("vnd.sun.xml.math","sxm"),Mz=a("vnd.sun.xml.writer","sxw"),kz=a("vnd.sun.xml.writer.global","sxg"),Cz=a("vnd.sun.xml.writer.template","stw"),Dz=a("vnd.sus-calendar","sus","susp"),Pz=a("vnd.svd","svd"),Lz=a("vnd.swiftview-ics"),Iz=a("vnd.symbian.install","sis","sisx"),Rz=a("vnd.syncml.dmddf+wbxml","wbxml"),Bz=a("vnd.syncml.dmddf+xml","xml"),Vz=a("vnd.syncml.dm.notification"),Oz=a("vnd.syncml.dmtnds+wbxml","wbxml"),Nz=a("vnd.syncml.dmtnds+xml","xml"),Hz=a("vnd.syncml.dm+wbxml","bdm"),Wz=a("vnd.syncml.dm+xml","xdm"),Uz=a("vnd.syncml.ds.notification"),zz=a("vnd.syncml+xml","xsm"),jz=a("vnd.tableschema+json","json"),Gz=a("vnd.tao.intent-module-archive","tao"),Xz=a("vnd.tcpdump.pcap","pcap","cap","dmp"),qz=a("vnd.think-cell.ppttc+json","json"),Kz=a("vnd.tmd.mediaflex.api+xml","xml"),Yz=a("vnd.tml"),Jz=a("vnd.tmobile-livetv","tmo"),Qz=a("vnd.trid.tpt","tpt"),$z=a("vnd.tri.onesource"),Zz=a("vnd.triscape.mxs","mxs"),ej=a("vnd.trueapp","tra"),tj=a("vnd.truedoc"),nj=a("vnd.ubisoft.webplayer"),rj=a("vnd.ufdl","ufd","ufdl"),ij=a("vnd.uiq.theme","utz"),oj=a("vnd.umajin","umj"),sj=a("vnd.unity","unityweb"),aj=a("vnd.uoml+xml","uoml"),lj=a("vnd.uplanet.alert"),cj=a("vnd.uplanet.alert-wbxml"),uj=a("vnd.uplanet.bearer-choice"),pj=a("vnd.uplanet.bearer-choice-wbxml"),dj=a("vnd.uplanet.cacheop"),hj=a("vnd.uplanet.cacheop-wbxml"),mj=a("vnd.uplanet.channel"),fj=a("vnd.uplanet.channel-wbxml"),gj=a("vnd.uplanet.list"),xj=a("vnd.uplanet.list-wbxml"),wj=a("vnd.uplanet.listcmd"),vj=a("vnd.uplanet.listcmd-wbxml"),Fj=a("vnd.uplanet.signal"),Aj=a("vnd.uri-map"),bj=a("vnd.valve.source.material"),Sj=a("vnd.vcx","vcx"),yj=a("vnd.vd-study"),Tj=a("vnd.vectorworks"),Ej=a("vnd.vel+json","json"),_j=a("vnd.verimatrix.vcas"),Mj=a("vnd.veryant.thin"),kj=a("vnd.ves.encrypted"),Cj=a("vnd.vidsoft.vidconference"),Dj=a("vnd.visio","vsd","vst","vss","vsw"),Pj=a("vnd.visionary","vis"),Lj=a("vnd.vividence.scriptfile"),Ij=a("vnd.vsf","vsf"),Rj=a("vnd.wap.sic"),Bj=a("vnd.wap.slc"),Vj=a("vnd.wap.wbxml","wbxml"),Oj=a("vnd.wap.wmlc","wmlc"),Nj=a("vnd.wap.wmlscriptc","wmlsc"),Hj=a("vnd.webturbo","wtb"),Wj=a("vnd.wfa.p2p"),Uj=a("vnd.wfa.wsc"),zj=a("vnd.windows.devicepairing"),jj=a("vnd.wmc"),Gj=a("vnd.wmf.bootstrap"),Xj=a("vnd.wolfram.mathematica"),qj=a("vnd.wolfram.mathematica.package"),Kj=a("vnd.wolfram.player","nbp"),Yj=a("vnd.wordperfect","wpd"),Jj=a("vnd.wqd","wqd"),Qj=a("vnd.wrq-hp3000-labelled"),$j=a("vnd.wt.stf","stf"),Zj=a("vnd.wv.csp+wbxml","wbxml"),eG=a("vnd.wv.csp+xml","xml"),tG=a("vnd.wv.ssp+xml","xml"),nG=a("vnd.xacml+json","json"),rG=a("vnd.xara","xar"),iG=a("vnd.xfdl","xfdl"),oG=a("vnd.xfdl.webform"),sG=a("vnd.xmi+xml","xml"),aG=a("vnd.xmpie.cpkg"),lG=a("vnd.xmpie.dpkg"),cG=a("vnd.xmpie.plan"),uG=a("vnd.xmpie.ppkg"),pG=a("vnd.xmpie.xlim"),dG=a("vnd.yamaha.hv-dic","hvd"),hG=a("vnd.yamaha.hv-script","hvs"),mG=a("vnd.yamaha.hv-voice","hvp"),fG=a("vnd.yamaha.openscoreformat","osf"),gG=a("vnd.yamaha.openscoreformat.osfpvg+xml","osfpvg"),xG=a("vnd.yamaha.remote-setup"),wG=a("vnd.yamaha.smaf-audio","saf"),vG=a("vnd.yamaha.smaf-phrase","spf"),FG=a("vnd.yamaha.through-ngn"),AG=a("vnd.yamaha.tunnel-udpencap"),bG=a("vnd.yaoweme"),SG=a("vnd.yellowriver-custom-menu","cmp"),yG=a("vnd.youtube.yt").deprecate("in favor of video/vnd.youtube.yt"),TG=a("vnd.zul","zir","zirz"),EG=a("vnd.zzazz.deck+xml","zaz"),_G=a("vividence.scriptfile"),MG=a("voicexml+xml","vxml"),kG=a("voucher-cms+json","json"),CG=a("vq-rtcpxr"),zp=a("wasm","wasm"),DG=a("watcherinfo+xml","xml"),PG=a("webpush-options+json","json"),LG=a("whoispp-query"),IG=a("whoispp-response"),RG=a("widget","wgt"),BG=a("winhlp","hlp"),VG=a("wita"),OG=a("wordperfect5.1"),NG=a("wsdl+xml","wsdl"),HG=a("wspolicy+xml","wspolicy"),WG=a("x-7z-compressed","7z"),UG=a("x-abiword","abw"),zG=a("x-ace-compressed","ace"),jG=a("x-amf"),GG=a("x-apple-diskimage","dmg"),XG=a("x-arj","arj"),qG=a("x-authorware-bin","aab","x32","u32","vox"),KG=a("x-authorware-map","aam"),YG=a("x-authorware-seg","aas"),JG=a("x-bcpio","bcpio"),QG=a("x-bdoc","bdoc"),$G=a("x-bittorrent","torrent"),ZG=a("x-blorb","blb","blorb"),eX=a("x-bzip","bz"),tX=a("x-bzip2","bz2","boz"),nX=a("x-cbr","cbr","cba","cbt","cbz","cb7"),rX=a("x-cdlink","vcd"),iX=a("x-cfs-compressed","cfs"),oX=a("x-chat","chat"),sX=a("x-chess-pgn","pgn"),aX=a("x-chrome-extension","crx"),lX=a("x-deb"),cX=a("x-compress"),uX=a("x-conference","nsc"),pX=a("x-cpio","cpio"),dX=a("x-csh","csh"),hX=a("x-debian-package","deb","udeb"),mX=a("x-dgc-compressed","dgc"),fX=a("x-director","dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"),gX=a("x-doom","wad"),xX=a("x-dtbncx+xml","ncx"),wX=a("x-dtbook+xml","dtb"),vX=a("x-dtbresource+xml","res"),FX=a("x-dvi","dvi"),AX=a("x-envoy","evy"),bX=a("x-eva","eva"),SX=a("x-font-bdf","bdf"),yX=a("x-font-dos"),TX=a("x-font-framemaker"),EX=a("x-font-ghostscript","gsf"),_X=a("x-font-libgrx"),MX=a("x-font-linux-psf","psf"),kX=a("x-font-pcf","pcf"),CX=a("x-font-snf","snf"),DX=a("x-font-speedo"),PX=a("x-font-sunos-news"),LX=a("x-font-type1","pfa","pfb","pfm","afm"),IX=a("x-font-vfont"),RX=a("x-freearc","arc"),BX=a("x-futuresplash","spl"),VX=a("x-gca-compressed","gca"),OX=a("x-glulx","ulx"),NX=a("x-gnumeric","gnumeric"),HX=a("x-gramps-xml","gramps"),WX=a("x-gtar","gtar"),UX=a("x-gzip"),zX=a("x-hdf","hdf"),jX=a("x-httpd-php","php"),GX=a("x-install-instructions","install"),XX=a("x-iso9660-image","iso"),qX=a("x-iwork-keynote-sffkey","key").deprecate("alias for iWorks Keynote file"),KX=a("x-iwork-numbers-sffnumbers","numbers").deprecate("alias for iWorks Numbers file"),YX=a("x-iwork-pages-sffpages","pages").deprecate("alias for iWorks Pages file"),JX=a("x-java-jnlp-file","jnlp"),QX=a("x-javascript"),$X=a("x-keepass2","kdbx"),ZX=a("x-latex","latex"),eq=a("x-lua-bytecode","luac"),tq=a("x-lzh-compressed","lzh","lha"),nq=a("x-mie","mie"),rq=a("x-mobipocket-ebook","prc","mobi"),iq=a("x-mpegurl"),oq=a("x-ms-application","application"),sq=a("x-ms-shortcut","lnk"),aq=a("x-ms-wmd","wmd"),lq=a("x-ms-wmz","wmz"),cq=a("x-ms-xbap","xbap"),uq=a("x-msdos-program","exe"),pq=a("x-msaccess","mdb"),dq=a("x-msbinder","obd"),hq=a("x-mscardfile","crd"),mq=a("x-msclip","clp"),fq=a("x-msdownload","exe","dll","com","bat","msi"),gq=a("x-msmediaview","mvb","m13","m14"),xq=a("x-msmetafile","wmf","wmz","emf","emz"),wq=a("x-msmoney","mny"),vq=a("x-mspublisher","pub"),Fq=a("x-msschedule","scd"),Aq=a("x-msterminal","trm"),bq=a("x-mswrite","wri"),Sq=a("x-netcdf","nc","cdf"),yq=a("x-ns-proxy-autoconfig","pac"),Tq=a("x-nzb","nzb"),Eq=a("x-pkcs12","p12","pfx"),_q=a("x-pkcs7-certificates","p7b","spc"),Mq=a("x-pkcs7-certreqresp","p7r"),kq=a("x-rar-compressed","rar"),Cq=a("x-research-info-systems","ris"),Dq=a("x-sh","sh"),Pq=a("x-shar","shar"),Lq=a("x-shockwave-flash","swf"),Iq=a("x-silverlight-app","xap"),Rq=a("x-sql","sql"),Bq=a("x-stuffit","sit"),Vq=a("x-stuffitx","sitx"),Oq=a("x-subrip","srt"),Nq=a("x-sv4cpio","sv4cpio"),Hq=a("x-sv4crc","sv4crc"),Wq=a("x-t3vm-image","t3"),Uq=a("x-tads","gam"),zq=a("x-tar","tar"),jq=a("x-tcl","tcl"),Gq=a("x-tex","tex"),Xq=a("x-tex-tfm","tfm"),qq=a("x-texinfo","texinfo","texi"),Kq=a("x-tgif","obj"),zc=a("x-url","url"),Yq=a("x-ustar","ustar"),Jq=a("x-virtualbox-hdd","hdd"),Qq=a("x-virtualbox-ova","ova"),$q=a("x-virtualbox-ovf","ovf"),Zq=a("x-virtualbox-vbox","vbox"),eK=a("x-virtualbox-vbox-extpack","vbox-extpack"),tK=a("x-virtualbox-vdi","vdi"),nK=a("x-virtualbox-vhd","vhd"),rK=a("x-virtualbox-vmdk","vmdk"),iK=a("x-wais-source","src"),oK=a("x-web-app-manifest+json","webapp"),sK=a("x-www-form-urlencoded"),aK=a("x-x509-ca-cert","der","crt"),lK=a("x-xfig","fig"),cK=a("x-xliff+xml","xlf"),uK=a("x-xpinstall","xpi"),pK=a("x-xz","xz"),dK=a("x-zip-compressed","zip"),hK=a("x-zmachine","z1","z2","z3","z4","z5","z6","z7","z8"),mK=a("x400-bp"),fK=a("xacml+xml","xml"),gK=a("xaml+xml","xaml"),xK=a("xcap-att+xml","xml"),wK=a("xcap-caps+xml","xml"),vK=a("xcap-diff+xml","xdf"),FK=a("xcap-el+xml","xml"),AK=a("xcap-error+xml","xml"),bK=a("xcap-ns+xml","xml"),SK=a("xcon-conference-info-diff+xml","xml"),yK=a("xcon-conference-info+xml","xml"),TK=a("xenc+xml","xenc"),EK=a("xhtml-voice+xml","xml"),_K=a("xhtml+xml","xhtml","xht"),MK=a("xliff+xml","xml"),kK=a("xml","xml","xsl"),CK=a("xml-dtd","dtd"),DK=a("xml-external-parsed-entity"),PK=a("xml-patch+xml","xml"),LK=a("xmpp+xml","xml"),IK=a("xop+xml","xop"),RK=a("xproc+xml","xpl"),BK=a("xslt+xml","xslt"),VK=a("xspf+xml","xspf"),OK=a("xv+xml","mxml","xhvml","xvml","xvm"),NK=a("yang","yang"),HK=a("yang-data+json","json"),WK=a("yang-data+xml","xml"),UK=a("yang-patch+json","json"),zK=a("yang-patch+xml","xml"),jK=a("yin+xml","yin"),GK=a("zip","zip"),XK=a("zlib"),qK=a("zstd");var zg={};pr(zg,{Audio_AMR:()=>QK,Audio_AMR_WB:()=>$K,Audio_ATRAC3:()=>iY,Audio_ATRAC_ADVANCED_LOSSLESS:()=>nY,Audio_ATRAC_X:()=>rY,Audio_Aac:()=>KK,Audio_Ac3:()=>YK,Audio_Adpcm:()=>JK,Audio_Amr_WbPlus:()=>ZK,Audio_Aptx:()=>eY,Audio_Asc:()=>tY,Audio_BV16:()=>sY,Audio_BV32:()=>aY,Audio_Basic:()=>oY,Audio_CN:()=>cY,Audio_Clearmode:()=>lY,Audio_DAT12:()=>uY,Audio_DV:()=>gY,Audio_DVI4:()=>xY,Audio_Dls:()=>pY,Audio_Dsr_Es201108:()=>dY,Audio_Dsr_Es202050:()=>hY,Audio_Dsr_Es202211:()=>mY,Audio_Dsr_Es202212:()=>fY,Audio_EVRC:()=>FY,Audio_EVRC0:()=>bY,Audio_EVRC1:()=>SY,Audio_EVRCB:()=>yY,Audio_EVRCB0:()=>TY,Audio_EVRCB1:()=>EY,Audio_EVRCNW:()=>_Y,Audio_EVRCNW0:()=>MY,Audio_EVRCNW1:()=>kY,Audio_EVRCWB:()=>CY,Audio_EVRCWB0:()=>DY,Audio_EVRCWB1:()=>PY,Audio_EVRC_QCP:()=>AY,Audio_EVS:()=>LY,Audio_Eac3:()=>wY,Audio_Encaprtp:()=>vY,Audio_Example:()=>IY,Audio_Flexfec:()=>RY,Audio_Fwdred:()=>BY,Audio_G711_0:()=>VY,Audio_G719:()=>OY,Audio_G722:()=>NY,Audio_G7221:()=>HY,Audio_G723:()=>WY,Audio_G726_16:()=>UY,Audio_G726_24:()=>zY,Audio_G726_32:()=>jY,Audio_G726_40:()=>GY,Audio_G728:()=>XY,Audio_G729:()=>qY,Audio_G7291:()=>KY,Audio_G729D:()=>YY,Audio_G729E:()=>JY,Audio_GSM:()=>QY,Audio_GSM_EFR:()=>$Y,Audio_GSM_HR_08:()=>ZY,Audio_ILBC:()=>eJ,Audio_Ip_Mr_v25:()=>tJ,Audio_Isac:()=>nJ,Audio_L16:()=>rJ,Audio_L20:()=>iJ,Audio_L24:()=>oJ,Audio_L8:()=>sJ,Audio_LPC:()=>aJ,Audio_MELP:()=>lJ,Audio_MELP1200:()=>cJ,Audio_MELP2400:()=>uJ,Audio_MELP600:()=>pJ,Audio_MP4A_LATM:()=>fJ,Audio_MPA:()=>gJ,Audio_Midi:()=>dJ,Audio_Mobile_Xmf:()=>hJ,Audio_Mp4:()=>mJ,Audio_Mpa_Robust:()=>xJ,Audio_Mpeg:()=>Or,Audio_Mpeg4_Generic:()=>wJ,Audio_Musepack:()=>vJ,Audio_Ogg:()=>FJ,Audio_Opus:()=>AJ,Audio_PCMA:()=>SJ,Audio_PCMA_WB:()=>yJ,Audio_PCMU:()=>TJ,Audio_PCMU_WB:()=>EJ,Audio_Parityfec:()=>bJ,Audio_PrsSid:()=>_J,Audio_Qcelp:()=>MJ,Audio_RED:()=>CJ,Audio_Raptorfec:()=>kJ,Audio_Rtp_Enc_Aescm128:()=>DJ,Audio_Rtp_Midi:()=>PJ,Audio_Rtploopback:()=>LJ,Audio_Rtx:()=>IJ,Audio_S3m:()=>RJ,Audio_SMV:()=>VJ,Audio_SMV0:()=>NJ,Audio_SMV_QCP:()=>OJ,Audio_Silk:()=>BJ,Audio_Sp_Midi:()=>HJ,Audio_Speex:()=>WJ,Audio_T140c:()=>UJ,Audio_T38:()=>zJ,Audio_TETRA_ACELP:()=>GJ,Audio_TETRA_ACELP_BB:()=>XJ,Audio_Telephone_Event:()=>jJ,Audio_Tone:()=>qJ,Audio_UEMCLIP:()=>KJ,Audio_Ulpfec:()=>YJ,Audio_Usac:()=>JJ,Audio_VDVI:()=>QJ,Audio_VMR_WB:()=>jQ,Audio_Vendor_1d_Interleaved_Parityfec:()=>$J,Audio_Vendor_32kadpcm:()=>ZJ,Audio_Vendor_3gpp:()=>eQ,Audio_Vendor_3gpp2:()=>tQ,Audio_Vendor_3gppIufp:()=>nQ,Audio_Vendor_4SB:()=>rQ,Audio_Vendor_Audiokoz:()=>iQ,Audio_Vendor_CELP:()=>oQ,Audio_Vendor_CiscoNse:()=>sQ,Audio_Vendor_CmlesRadio_Events:()=>aQ,Audio_Vendor_CnsAnp1:()=>lQ,Audio_Vendor_CnsInf1:()=>cQ,Audio_Vendor_DeceAudio:()=>uQ,Audio_Vendor_Digital_Winds:()=>pQ,Audio_Vendor_DlnaAdts:()=>dQ,Audio_Vendor_DolbyHeaac1:()=>hQ,Audio_Vendor_DolbyHeaac2:()=>mQ,Audio_Vendor_DolbyMlp:()=>fQ,Audio_Vendor_DolbyMps:()=>gQ,Audio_Vendor_DolbyPl2:()=>xQ,Audio_Vendor_DolbyPl2x:()=>wQ,Audio_Vendor_DolbyPl2z:()=>vQ,Audio_Vendor_DolbyPulse1:()=>FQ,Audio_Vendor_Dra:()=>AQ,Audio_Vendor_Dts:()=>bQ,Audio_Vendor_DtsHd:()=>SQ,Audio_Vendor_DtsUhd:()=>yQ,Audio_Vendor_DvbFile:()=>TQ,Audio_Vendor_EveradPlj:()=>EQ,Audio_Vendor_HnsAudio:()=>_Q,Audio_Vendor_LucentVoice:()=>MQ,Audio_Vendor_Ms_PlayreadyMediaPya:()=>kQ,Audio_Vendor_NokiaMobile_Xmf:()=>CQ,Audio_Vendor_NortelVbk:()=>DQ,Audio_Vendor_NueraEcelp4800:()=>PQ,Audio_Vendor_NueraEcelp7470:()=>LQ,Audio_Vendor_NueraEcelp9600:()=>IQ,Audio_Vendor_OctelSbc:()=>RQ,Audio_Vendor_PresonusMultitrack:()=>BQ,Audio_Vendor_Qcelp:()=>VQ,Audio_Vendor_Rhetorex32kadpcm:()=>OQ,Audio_Vendor_Rip:()=>NQ,Audio_Vendor_Rn_Realaudio:()=>HQ,Audio_Vendor_SealedmediaSoftsealMpeg:()=>WQ,Audio_Vendor_VmxCvsd:()=>UQ,Audio_Vendor_Wave:()=>zQ,Audio_Vorbis:()=>GQ,Audio_Vorbis_Config:()=>XQ,Audio_Wav:()=>qQ,Audio_Wave:()=>KQ,Audio_WebMOpus:()=>YQ,Audio_Webm:()=>jc,Audio_X_Aac:()=>JQ,Audio_X_Aiff:()=>QQ,Audio_X_Caf:()=>$Q,Audio_X_Flac:()=>ZQ,Audio_X_Matroska:()=>e$,Audio_X_Mpegurl:()=>t$,Audio_X_Ms_Wax:()=>n$,Audio_X_Ms_Wma:()=>r$,Audio_X_Pn_Realaudio:()=>i$,Audio_X_Pn_Realaudio_Plugin:()=>o$,Audio_X_Tta:()=>s$,Audio_X_Wav:()=>a$,Audio_Xm:()=>l$});var ce=tn("audio"),KK=ce("aac","aac"),YK=ce("ac3","ac3"),JK=ce("adpcm","adp"),QK=ce("amr","amr"),$K=ce("amr-wb"),ZK=ce("amr-wb+"),eY=ce("aptx"),tY=ce("asc"),nY=ce("atrac-advanced-lossless"),rY=ce("atrac-x"),iY=ce("atrac3"),oY=ce("basic","au","snd"),sY=ce("bv16"),aY=ce("bv32"),lY=ce("clearmode"),cY=ce("cn"),uY=ce("dat12"),pY=ce("dls"),dY=ce("dsr-es201108"),hY=ce("dsr-es202050"),mY=ce("dsr-es202211"),fY=ce("dsr-es202212"),gY=ce("dv"),xY=ce("dvi4"),wY=ce("eac3"),vY=ce("encaprtp"),FY=ce("evrc"),AY=ce("evrc-qcp"),bY=ce("evrc0"),SY=ce("evrc1"),yY=ce("evrcb"),TY=ce("evrcb0"),EY=ce("evrcb1"),_Y=ce("evrcnw"),MY=ce("evrcnw0"),kY=ce("evrcnw1"),CY=ce("evrcwb"),DY=ce("evrcwb0"),PY=ce("evrcwb1"),LY=ce("evs"),IY=ce("example"),RY=ce("flexfec"),BY=ce("fwdred"),VY=ce("g711-0"),OY=ce("g719"),NY=ce("g722"),HY=ce("g7221"),WY=ce("g723"),UY=ce("g726-16"),zY=ce("g726-24"),jY=ce("g726-32"),GY=ce("g726-40"),XY=ce("g728"),qY=ce("g729"),KY=ce("g7291"),YY=ce("g729d"),JY=ce("g729e"),QY=ce("gsm","gsm"),$Y=ce("gsm-efr"),ZY=ce("gsm-hr-08"),eJ=ce("ilbc"),tJ=ce("ip-mr_v2.5"),nJ=ce("isac"),rJ=ce("l16"),iJ=ce("l20"),oJ=ce("l24"),sJ=ce("l8"),aJ=ce("lpc"),lJ=ce("melp"),cJ=ce("melp1200"),uJ=ce("melp2400"),pJ=ce("melp600"),dJ=ce("midi","mid","midi","kar","rmi"),hJ=ce("mobile-xmf"),mJ=ce("mp4","m4a","mp4a"),fJ=ce("mp4a-latm"),gJ=ce("mpa"),xJ=ce("mpa-robust"),Or=ce("mpeg","mp3","mp2","mp2a","mpga","m2a","m3a"),wJ=ce("mpeg4-generic"),vJ=ce("musepack"),FJ=ce("ogg","ogg","oga","spx"),AJ=ce("opus"),bJ=ce("parityfec"),SJ=ce("pcma"),yJ=ce("pcma-wb"),TJ=ce("pcmu"),EJ=ce("pcmu-wb"),_J=ce("prs.sid"),MJ=ce("qcelp"),kJ=ce("raptorfec"),CJ=ce("red"),DJ=ce("rtp-enc-aescm128"),PJ=ce("rtp-midi"),LJ=ce("rtploopback"),IJ=ce("rtx"),RJ=ce("s3m","s3m"),BJ=ce("silk","sil"),VJ=ce("smv"),OJ=ce("smv-qcp"),NJ=ce("smv0"),HJ=ce("sp-midi"),WJ=ce("speex"),UJ=ce("t140c"),zJ=ce("t38"),jJ=ce("telephone-event"),GJ=ce("tetra_acelp"),XJ=ce("tetra_acelp_bb"),qJ=ce("tone"),KJ=ce("uemclip"),YJ=ce("ulpfec"),JJ=ce("usac"),QJ=ce("vdvi"),$J=ce("1d-interleaved-parityfec"),ZJ=ce("32kadpcm"),eQ=ce("3gpp"),tQ=ce("3gpp2"),nQ=ce("vnd.3gpp.iufp"),rQ=ce("vnd.4sb"),iQ=ce("vnd.audiokoz"),oQ=ce("vnd.celp"),sQ=ce("vnd.cisco.nse"),aQ=ce("vnd.cmles.radio-events"),lQ=ce("vnd.cns.anp1"),cQ=ce("vnd.cns.inf1"),uQ=ce("vnd.dece.audio","uva","uvva"),pQ=ce("vnd.digital-winds","eol"),dQ=ce("vnd.dlna.adts"),hQ=ce("vnd.dolby.heaac.1"),mQ=ce("vnd.dolby.heaac.2"),fQ=ce("vnd.dolby.mlp"),gQ=ce("vnd.dolby.mps"),xQ=ce("vnd.dolby.pl2"),wQ=ce("vnd.dolby.pl2x"),vQ=ce("vnd.dolby.pl2z"),FQ=ce("vnd.dolby.pulse.1"),AQ=ce("vnd.dra","dra"),bQ=ce("vnd.dts","dts"),SQ=ce("vnd.dts.hd","dtshd"),yQ=ce("vnd.dts.uhd"),TQ=ce("vnd.dvb.file"),EQ=ce("vnd.everad.plj"),_Q=ce("vnd.hns.audio"),MQ=ce("vnd.lucent.voice","lvp"),kQ=ce("vnd.ms-playready.media.pya","pya"),CQ=ce("vnd.nokia.mobile-xmf"),DQ=ce("vnd.nortel.vbk"),PQ=ce("vnd.nuera.ecelp4800","ecelp4800"),LQ=ce("vnd.nuera.ecelp7470","ecelp7470"),IQ=ce("vnd.nuera.ecelp9600","ecelp9600"),RQ=ce("vnd.octel.sbc"),BQ=ce("vnd.presonus.multitrack"),VQ=ce("vnd.qcelp").deprecate("in favor of audio/qcelp"),OQ=ce("vnd.rhetorex.32kadpcm"),NQ=ce("vnd.rip","rip"),HQ=ce("vnd.rn-realaudio"),WQ=ce("vnd.sealedmedia.softseal.mpeg"),UQ=ce("vnd.vmx.cvsd"),zQ=ce("vnd.wave","wav"),jQ=ce("vmr-wb"),GQ=ce("vorbis"),XQ=ce("vorbis-config"),qQ=ce("wav","wav"),KQ=ce("wave","wav"),jc=ce("webm","weba","webm"),YQ=ce("webm; codec=opus","weba"),JQ=ce("x-aac","aac"),QQ=ce("x-aiff","aif","aiff","aifc"),$Q=ce("x-caf","caf"),ZQ=ce("x-flac","flac"),e$=ce("x-matroska","mka"),t$=ce("x-mpegurl","m3u"),n$=ce("x-ms-wax","wax"),r$=ce("x-ms-wma","wma"),i$=ce("x-pn-realaudio","ram","ra"),o$=ce("x-pn-realaudio-plugin","rmp"),s$=ce("x-tta"),a$=ce("x-wav","wav"),l$=ce("xm","xm");var jg={};pr(jg,{Chemical_X_Cdx:()=>c$,Chemical_X_Cif:()=>u$,Chemical_X_Cmdf:()=>p$,Chemical_X_Cml:()=>d$,Chemical_X_Csml:()=>h$,Chemical_X_Pdb:()=>m$,Chemical_X_Xyz:()=>f$});var Rs=tn("chemical"),c$=Rs("x-cdx","cdx"),u$=Rs("x-cif","cif"),p$=Rs("x-cmdf","cmdf"),d$=Rs("x-cml","cml"),h$=Rs("x-csml","csml"),m$=Rs("x-pdb"),f$=Rs("x-xyz","xyz");var Gg={};pr(Gg,{Font_Collection:()=>g$,Font_Otf:()=>x$,Font_Sfnt:()=>w$,Font_Ttf:()=>v$,Font_Woff:()=>F$,Font_Woff2:()=>A$});var Na=tn("font"),g$=Na("collection","ttc"),x$=Na("otf","otf"),w$=Na("sfnt"),v$=Na("ttf","ttf"),F$=Na("woff","woff"),A$=Na("woff2","woff2");var Xg={};pr(Xg,{Image_Aces:()=>b$,Image_Apng:()=>S$,Image_Avci:()=>y$,Image_Avcs:()=>T$,Image_Avif:()=>E$,Image_Bmp:()=>_$,Image_Cgm:()=>M$,Image_Dicom_Rle:()=>k$,Image_EXR:()=>P$,Image_Emf:()=>C$,Image_Example:()=>D$,Image_Fits:()=>L$,Image_G3fax:()=>I$,Image_Gif:()=>R$,Image_Heic:()=>B$,Image_Heic_Sequence:()=>V$,Image_Heif:()=>O$,Image_Heif_Sequence:()=>N$,Image_Hej2k:()=>H$,Image_Hsj2:()=>W$,Image_Ief:()=>U$,Image_Jls:()=>z$,Image_Jp2:()=>j$,Image_Jpeg:()=>ji,Image_Jph:()=>G$,Image_Jphc:()=>X$,Image_Jpm:()=>q$,Image_Jpx:()=>K$,Image_Jxr:()=>Y$,Image_JxrA:()=>J$,Image_JxrS:()=>Q$,Image_Jxs:()=>$$,Image_Jxsc:()=>Z$,Image_Jxsi:()=>eZ,Image_Jxss:()=>tZ,Image_Ktx:()=>nZ,Image_Naplps:()=>rZ,Image_Pjpeg:()=>iZ,Image_Png:()=>Gi,Image_PrsBtif:()=>oZ,Image_PrsPti:()=>sZ,Image_Pwg_Raster:()=>aZ,Image_Raw:()=>lZ,Image_Sgi:()=>cZ,Image_SvgXml:()=>uZ,Image_T38:()=>pZ,Image_Tiff:()=>dZ,Image_Tiff_Fx:()=>hZ,Image_Vendor_AdobePhotoshop:()=>mZ,Image_Vendor_AirzipAcceleratorAzv:()=>fZ,Image_Vendor_CnsInf2:()=>gZ,Image_Vendor_DeceGraphic:()=>xZ,Image_Vendor_Djvu:()=>wZ,Image_Vendor_DvbSubtitle:()=>vZ,Image_Vendor_Dwg:()=>FZ,Image_Vendor_Dxf:()=>AZ,Image_Vendor_Fastbidsheet:()=>bZ,Image_Vendor_Fpx:()=>SZ,Image_Vendor_Fst:()=>yZ,Image_Vendor_FujixeroxEdmics_Mmr:()=>TZ,Image_Vendor_FujixeroxEdmics_Rlc:()=>EZ,Image_Vendor_GlobalgraphicsPgb:()=>_Z,Image_Vendor_MicrosoftIcon:()=>MZ,Image_Vendor_Mix:()=>kZ,Image_Vendor_MozillaApng:()=>CZ,Image_Vendor_Ms_Dds:()=>DZ,Image_Vendor_Ms_Modi:()=>PZ,Image_Vendor_Ms_Photo:()=>LZ,Image_Vendor_Net_Fpx:()=>IZ,Image_Vendor_Radiance:()=>RZ,Image_Vendor_SealedPng:()=>OZ,Image_Vendor_SealedmediaSoftsealGif:()=>BZ,Image_Vendor_SealedmediaSoftsealJpg:()=>VZ,Image_Vendor_Svf:()=>NZ,Image_Vendor_TencentTap:()=>HZ,Image_Vendor_ValveSourceTexture:()=>WZ,Image_Vendor_WapWbmp:()=>UZ,Image_Vendor_Xiff:()=>zZ,Image_Vendor_ZbrushPcx:()=>jZ,Image_Webp:()=>GZ,Image_Wmf:()=>XZ,Image_X_3ds:()=>qZ,Image_X_Cmu_Raster:()=>KZ,Image_X_Cmx:()=>YZ,Image_X_Emf:()=>JZ,Image_X_Freehand:()=>QZ,Image_X_Icon:()=>$Z,Image_X_Mrsid_Image:()=>ZZ,Image_X_Ms_Bmp:()=>eee,Image_X_Pcx:()=>tee,Image_X_Pict:()=>nee,Image_X_Portable_Anymap:()=>ree,Image_X_Portable_Bitmap:()=>iee,Image_X_Portable_Graymap:()=>oee,Image_X_Portable_Pixmap:()=>see,Image_X_Rgb:()=>aee,Image_X_Tga:()=>lee,Image_X_Wmf:()=>cee,Image_X_Xbitmap:()=>uee,Image_X_Xcf:()=>pee,Image_X_Xpixmap:()=>dee,Image_X_Xwindowdump:()=>hee});var Le=tn("image"),b$=Le("aces"),S$=Le("apng","apng"),y$=Le("avci"),T$=Le("avcs"),E$=Le("avif","avif"),_$=Le("bmp","bmp"),M$=Le("cgm","cgm"),k$=Le("dicom-rle"),C$=Le("emf"),D$=Le("example"),P$=Le("x-exr","exr"),L$=Le("fits"),I$=Le("g3fax","g3"),R$=Le("gif","gif"),B$=Le("heic"),V$=Le("heic-sequence"),O$=Le("heif"),N$=Le("heif-sequence"),H$=Le("hej2k"),W$=Le("hsj2"),U$=Le("ief","ief"),z$=Le("jls"),j$=Le("jp2"),ji=Le("jpeg","jpeg","jpg","jpe"),G$=Le("jph"),X$=Le("jphc"),q$=Le("jpm"),K$=Le("jpx"),Y$=Le("jxr"),J$=Le("jxra"),Q$=Le("jxrs"),$$=Le("jxs"),Z$=Le("jxsc"),eZ=Le("jxsi"),tZ=Le("jxss"),nZ=Le("ktx","ktx"),rZ=Le("naplps"),iZ=Le("pjpeg"),Gi=Le("png","png"),oZ=Le("prs.btif","btif"),sZ=Le("prs.pti"),aZ=Le("pwg-raster"),lZ=Le("x-raw","raw"),cZ=Le("sgi","sgi"),uZ=Le("svg+xml","svg","svgz"),pZ=Le("t38"),dZ=Le("tiff","tiff","tif"),hZ=Le("tiff-fx"),mZ=Le("vnd.adobe.photoshop","psd"),fZ=Le("vnd.airzip.accelerator.azv"),gZ=Le("vnd.cns.inf2"),xZ=Le("vnd.dece.graphic","uvi","uvvi","uvg","uvvg"),wZ=Le("vnd.djvu","djvu","djv"),vZ=Le("vnd.dvb.subtitle","sub"),FZ=Le("vnd.dwg","dwg"),AZ=Le("vnd.dxf","dxf"),bZ=Le("vnd.fastbidsheet","fbs"),SZ=Le("vnd.fpx","fpx"),yZ=Le("vnd.fst","fst"),TZ=Le("vnd.fujixerox.edmics-mmr","mmr"),EZ=Le("vnd.fujixerox.edmics-rlc","rlc"),_Z=Le("vnd.globalgraphics.pgb"),MZ=Le("vnd.microsoft.icon"),kZ=Le("vnd.mix"),CZ=Le("vnd.mozilla.apng"),DZ=Le("vnd.ms-dds","dds"),PZ=Le("vnd.ms-modi","mdi"),LZ=Le("vnd.ms-photo","wdp"),IZ=Le("vnd.net-fpx","npx"),RZ=Le("vnd.radiance"),BZ=Le("vnd.sealedmedia.softseal.gif"),VZ=Le("vnd.sealedmedia.softseal.jpg"),OZ=Le("vnd.sealed.png"),NZ=Le("vnd.svf"),HZ=Le("vnd.tencent.tap"),WZ=Le("vnd.valve.source.texture"),UZ=Le("vnd.wap.wbmp","wbmp"),zZ=Le("vnd.xiff","xif"),jZ=Le("vnd.zbrush.pcx"),GZ=Le("webp","webp"),XZ=Le("wmf"),qZ=Le("x-3ds","3ds"),KZ=Le("x-cmu-raster","ras"),YZ=Le("x-cmx","cmx"),JZ=Le("x-emf").deprecate("in favor of image/emf"),QZ=Le("x-freehand","fh","fhc","fh4","fh5","fh7"),$Z=Le("x-icon","ico"),ZZ=Le("x-mrsid-image","sid"),eee=Le("x-ms-bmp"),tee=Le("x-pcx","pcx"),nee=Le("x-pict","pic","pct"),ree=Le("x-portable-anymap","pnm"),iee=Le("x-portable-bitmap","pbm"),oee=Le("x-portable-graymap","pgm"),see=Le("x-portable-pixmap","ppm"),aee=Le("x-rgb","rgb"),lee=Le("x-tga","tga"),cee=Le("x-wmf").deprecate("in favor of image/wmf"),uee=Le("x-xbitmap","xbm"),pee=Le("x-xcf"),dee=Le("x-xpixmap","xpm"),hee=Le("x-xwindowdump","xwd");var qg={};pr(qg,{Message_CPIM:()=>mee,Message_Delivery_Status:()=>fee,Message_Disposition_Notification:()=>gee,Message_Example:()=>xee,Message_External_Body:()=>wee,Message_Feedback_Report:()=>vee,Message_Global:()=>Fee,Message_Global_Delivery_Status:()=>Aee,Message_Global_Disposition_Notification:()=>bee,Message_Global_Headers:()=>See,Message_Http:()=>yee,Message_ImdnXml:()=>Tee,Message_News:()=>Eee,Message_Partial:()=>_ee,Message_Rfc822:()=>Mee,Message_S_Http:()=>kee,Message_Sip:()=>Cee,Message_Sipfrag:()=>Dee,Message_Tracking_Status:()=>Pee,Message_Vendor_SiSimp:()=>Lee,Message_Vendor_WfaWsc:()=>Iee});var Cn=tn("message"),mee=Cn("cpim"),fee=Cn("delivery-status"),gee=Cn("disposition-notification"),xee=Cn("example"),wee=Cn("external-body"),vee=Cn("feedback-report"),Fee=Cn("global"),Aee=Cn("global-delivery-status"),bee=Cn("global-disposition-notification"),See=Cn("global-headers"),yee=Cn("http"),Tee=Cn("imdn+xml","xml"),Eee=Cn("news").deprecate("by RFC5537"),_ee=Cn("partial"),Mee=Cn("rfc822","eml","mime"),kee=Cn("s-http"),Cee=Cn("sip"),Dee=Cn("sipfrag"),Pee=Cn("tracking-status"),Lee=Cn("vnd.si.simp").deprecate("by request"),Iee=Cn("vnd.wfa.wsc");var Kg={};pr(Kg,{Model_Example:()=>Ree,Model_Gltf_Binary:()=>Xi,Model_Gltf_Json:()=>Gc,Model_Iges:()=>Bee,Model_Mesh:()=>Vee,Model_Stl:()=>Oee,Model_Vendor_3mf:()=>Nee,Model_Vendor_ColladaXml:()=>Hee,Model_Vendor_Dwf:()=>Wee,Model_Vendor_Flatland3dml:()=>Uee,Model_Vendor_Gdl:()=>zee,Model_Vendor_GsGdl:()=>Gee,Model_Vendor_Gs_Gdl:()=>jee,Model_Vendor_Gtw:()=>Xee,Model_Vendor_MomlXml:()=>qee,Model_Vendor_Mts:()=>Kee,Model_Vendor_Opengex:()=>Yee,Model_Vendor_ParasolidTransmitBinary:()=>Jee,Model_Vendor_ParasolidTransmitText:()=>Qee,Model_Vendor_RosetteAnnotated_Data_Model:()=>$ee,Model_Vendor_UsdzZip:()=>Zee,Model_Vendor_ValveSourceCompiled_Map:()=>ete,Model_Vendor_Vtu:()=>tte,Model_Vrml:()=>nte,Model_X3dBinary:()=>ite,Model_X3dFastinfoset:()=>ote,Model_X3dVrml:()=>ste,Model_X3dXml:()=>ate,Model_X3d_Vrml:()=>rte});var Kt=tn("model"),Ree=Kt("example"),Xi=Kt("gltf-binary","glb"),Gc=Kt("gltf+json","gltf"),Bee=Kt("iges","igs","iges"),Vee=Kt("mesh","msh","mesh","silo"),Oee=Kt("stl"),Nee=Kt("3mf"),Hee=Kt("vnd.collada+xml","dae"),Wee=Kt("vnd.dwf","dwf"),Uee=Kt("vnd.flatland.3dml"),zee=Kt("vnd.gdl","gdl"),jee=Kt("vnd.gs-gdl"),Gee=Kt("vnd.gs.gdl"),Xee=Kt("vnd.gtw","gtw"),qee=Kt("vnd.moml+xml","xml"),Kee=Kt("vnd.mts","mts"),Yee=Kt("vnd.opengex"),Jee=Kt("vnd.parasolid.transmit.binary"),Qee=Kt("vnd.parasolid.transmit.text"),$ee=Kt("vnd.rosette.annotated-data-model"),Zee=Kt("vnd.usdz+zip","zip"),ete=Kt("vnd.valve.source.compiled-map"),tte=Kt("vnd.vtu","vtu"),nte=Kt("vrml","wrl","vrml"),rte=Kt("x3d-vrml"),ite=Kt("x3d+binary","x3db","x3dbz"),ote=Kt("x3d+fastinfoset","fastinfoset"),ste=Kt("x3d+vrml","x3dv","x3dvz"),ate=Kt("x3d+xml","x3d","x3dz");var Yg={};pr(Yg,{MultipartAlternative:()=>lte,MultipartAppledouble:()=>cte,MultipartByteranges:()=>ute,MultipartDigest:()=>pte,MultipartEncrypted:()=>dte,MultipartExample:()=>hte,MultipartForm_Data:()=>mte,MultipartHeader_Set:()=>fte,MultipartMixed:()=>gte,MultipartMultilingual:()=>xte,MultipartParallel:()=>wte,MultipartRelated:()=>vte,MultipartReport:()=>Fte,MultipartSigned:()=>Ate,MultipartVendorBintMed_Plus:()=>bte,MultipartVoice_Message:()=>Ste,MultipartX_Mixed_Replace:()=>yte});var rr=tn("multipart"),lte=rr("alternative"),cte=rr("appledouble"),ute=rr("byteranges"),pte=rr("digest"),dte=rr("encrypted"),hte=rr("example"),mte=rr("form-data"),fte=rr("header-set"),gte=rr("mixed"),xte=rr("multilingual"),wte=rr("parallel"),vte=rr("related"),Fte=rr("report"),Ate=rr("signed"),bte=rr("vnd.bint.med-plus"),Ste=rr("voice-message"),yte=rr("x-mixed-replace");var $g={};pr($g,{Text_Cache_Manifest:()=>Tte,Text_Calendar:()=>Ete,Text_Calender:()=>_te,Text_Cmd:()=>Mte,Text_Coffeescript:()=>kte,Text_Css:()=>Xc,Text_Csv:()=>Cte,Text_Csv_Schema:()=>Dte,Text_Directory:()=>Pte,Text_Dns:()=>Lte,Text_Ecmascript:()=>Ite,Text_Encaprtp:()=>Rte,Text_Enriched:()=>Bte,Text_Event_Stream:()=>Vte,Text_Example:()=>Ote,Text_Flexfec:()=>Nte,Text_Fwdred:()=>Hte,Text_Grammar_Ref_List:()=>Wte,Text_Html:()=>Jg,Text_Jade:()=>Ute,Text_Javascript:()=>zte,Text_Jcr_Cnd:()=>jte,Text_Jsx:()=>Gte,Text_Less:()=>Xte,Text_Markdown:()=>qte,Text_Mdx:()=>Kte,Text_Mizar:()=>Yte,Text_N3:()=>Jte,Text_Parameters:()=>Qte,Text_Parityfec:()=>$te,Text_Plain:()=>Bs,Text_PlainUTF8:()=>Zte,Text_Provenance_Notation:()=>ene,Text_PrsFallensteinRst:()=>tne,Text_PrsLinesTag:()=>nne,Text_PrsPropLogic:()=>rne,Text_RED:()=>one,Text_Raptorfec:()=>ine,Text_Rfc822_Headers:()=>sne,Text_Richtext:()=>ane,Text_Rtf:()=>lne,Text_Rtp_Enc_Aescm128:()=>cne,Text_Rtploopback:()=>une,Text_Rtx:()=>pne,Text_Sgml:()=>dne,Text_Shex:()=>hne,Text_Slim:()=>mne,Text_Strings:()=>fne,Text_Stylus:()=>gne,Text_T140:()=>xne,Text_Tab_Separated_Values:()=>wne,Text_Troff:()=>vne,Text_Turtle:()=>Fne,Text_Ulpfec:()=>Ane,Text_Uri_List:()=>bne,Text_Vcard:()=>Sne,Text_Vendor_1d_Interleaved_Parityfec:()=>yne,Text_Vendor_A:()=>Tne,Text_Vendor_Abc:()=>Ene,Text_Vendor_Ascii_Art:()=>_ne,Text_Vendor_Curl:()=>Mne,Text_Vendor_CurlDcurl:()=>kne,Text_Vendor_CurlMcurl:()=>Cne,Text_Vendor_CurlScurl:()=>Dne,Text_Vendor_DMClientScript:()=>Lne,Text_Vendor_DebianCopyright:()=>Pne,Text_Vendor_DvbSubtitle:()=>Ine,Text_Vendor_EsmertecTheme_Descriptor:()=>Rne,Text_Vendor_FiclabFlt:()=>Bne,Text_Vendor_Fly:()=>Vne,Text_Vendor_FmiFlexstor:()=>One,Text_Vendor_Gml:()=>Nne,Text_Vendor_Graphviz:()=>Hne,Text_Vendor_Hgl:()=>Wne,Text_Vendor_IPTCNITF:()=>Gne,Text_Vendor_IPTCNewsML:()=>jne,Text_Vendor_In3d3dml:()=>Une,Text_Vendor_In3dSpot:()=>zne,Text_Vendor_Latex_Z:()=>Xne,Text_Vendor_MotorolaReflex:()=>qne,Text_Vendor_Ms_Mediapackage:()=>Kne,Text_Vendor_Net2phoneCommcenterCommand:()=>Yne,Text_Vendor_RadisysMsml_Basic_Layout:()=>Jne,Text_Vendor_SenxWarpscript:()=>Qne,Text_Vendor_SiUricatalogue:()=>$ne,Text_Vendor_Sosi:()=>Zne,Text_Vendor_SunJ2meApp_Descriptor:()=>ere,Text_Vendor_TrolltechLinguist:()=>tre,Text_Vendor_WapSi:()=>nre,Text_Vendor_WapSl:()=>rre,Text_Vendor_WapWml:()=>ire,Text_Vendor_WapWmlscript:()=>ore,Text_Vtt:()=>sre,Text_X_Asm:()=>are,Text_X_C:()=>lre,Text_X_Fortran:()=>cre,Text_X_Gwt_Rpc:()=>ure,Text_X_Handlebars_Template:()=>pre,Text_X_Java_Source:()=>dre,Text_X_Jquery_Tmpl:()=>hre,Text_X_Lua:()=>mre,Text_X_Markdown:()=>fre,Text_X_Nfo:()=>gre,Text_X_Opml:()=>xre,Text_X_Org:()=>wre,Text_X_Pascal:()=>vre,Text_X_Processing:()=>Fre,Text_X_Sass:()=>Are,Text_X_Scss:()=>bre,Text_X_Setext:()=>Sre,Text_X_Sfv:()=>yre,Text_X_Suse_Ymp:()=>Tre,Text_X_Uuencode:()=>Ere,Text_X_Vcalendar:()=>_re,Text_X_Vcard:()=>Mre,Text_Xml:()=>Qg,Text_Xml_External_Parsed_Entity:()=>kre,Text_Yaml:()=>Cre});var ye=tn("text"),Tte=ye("cache-manifest","appcache"),Ete=ye("calendar","ics","ifb"),_te=ye("calender"),Mte=ye("cmd"),kte=ye("coffeescript","coffee","litcoffee"),Xc=ye("css","css"),Cte=ye("csv","csv"),Dte=ye("csv-schema"),Pte=ye("directory").deprecate("by RFC6350"),Lte=ye("dns"),Ite=ye("ecmascript").deprecate("in favor of application/ecmascript"),Rte=ye("encaprtp"),Bte=ye("enriched"),Vte=ye("event-stream"),Ote=ye("example"),Nte=ye("flexfec"),Hte=ye("fwdred"),Wte=ye("grammar-ref-list"),Jg=ye("html","html","htm"),Ute=ye("jade","jade"),zte=ye("javascript").deprecate("in favor of application/javascript"),jte=ye("jcr-cnd"),Gte=ye("jsx","jsx"),Xte=ye("less","less"),qte=ye("markdown"),Kte=ye("mdx","mdx"),Yte=ye("mizar"),Jte=ye("n3","n3"),Qte=ye("parameters"),$te=ye("parityfec"),Bs=ye("plain","txt","text","conf","def","list","log","in"),Zte=ye("plain; charset=UTF-8","txt","text","conf","def","list","log","in"),ene=ye("provenance-notation"),tne=ye("prs.fallenstein.rst"),nne=ye("prs.lines.tag","dsc"),rne=ye("prs.prop.logic"),ine=ye("raptorfec"),one=ye("red"),sne=ye("rfc822-headers"),ane=ye("richtext","rtx"),lne=ye("rtf"),cne=ye("rtp-enc-aescm128"),une=ye("rtploopback"),pne=ye("rtx"),dne=ye("sgml","sgml","sgm"),hne=ye("shex","shex"),mne=ye("slim","slim","slm"),fne=ye("strings"),gne=ye("stylus","stylus","styl"),xne=ye("t140"),wne=ye("tab-separated-values","tsv"),vne=ye("troff","t","tr","roff","man","me","ms"),Fne=ye("turtle","ttl"),Ane=ye("ulpfec"),bne=ye("uri-list","uri","uris","urls"),Sne=ye("vcard","vcard"),yne=ye("1d-interleaved-parityfec"),Tne=ye("vnd.a"),Ene=ye("vnd.abc"),_ne=ye("vnd.ascii-art"),Mne=ye("vnd.curl","curl"),kne=ye("vnd.curl.dcurl","dcurl"),Cne=ye("vnd.curl.mcurl","mcurl"),Dne=ye("vnd.curl.scurl","scurl"),Pne=ye("vnd.debian.copyright"),Lne=ye("vnd.dmclientscript"),Ine=ye("vnd.dvb.subtitle","sub"),Rne=ye("vnd.esmertec.theme-descriptor"),Bne=ye("vnd.ficlab.flt"),Vne=ye("vnd.fly","fly"),One=ye("vnd.fmi.flexstor","flx"),Nne=ye("vnd.gml"),Hne=ye("vnd.graphviz","gv"),Wne=ye("vnd.hgl"),Une=ye("vnd.in3d.3dml","3dml"),zne=ye("vnd.in3d.spot","spot"),jne=ye("vnd.iptc.newsml"),Gne=ye("vnd.iptc.nitf"),Xne=ye("vnd.latex-z"),qne=ye("vnd.motorola.reflex"),Kne=ye("vnd.ms-mediapackage"),Yne=ye("vnd.net2phone.commcenter.command"),Jne=ye("vnd.radisys.msml-basic-layout"),Qne=ye("vnd.senx.warpscript"),$ne=ye("vnd.si.uricatalogue").deprecate("by request"),Zne=ye("vnd.sosi"),ere=ye("vnd.sun.j2me.app-descriptor","jad"),tre=ye("vnd.trolltech.linguist"),nre=ye("vnd.wap.si"),rre=ye("vnd.wap.sl"),ire=ye("vnd.wap.wml","wml"),ore=ye("vnd.wap.wmlscript","wmls"),sre=ye("vtt"),are=ye("x-asm","s","asm"),lre=ye("x-c","c","cc","cxx","cpp","h","hh","dic"),cre=ye("x-fortran","f","for","f77","f90"),ure=ye("x-gwt-rpc"),pre=ye("x-handlebars-template","hbs"),dre=ye("x-java-source","java"),hre=ye("x-jquery-tmpl"),mre=ye("x-lua","lua"),fre=ye("x-markdown","mkd"),gre=ye("x-nfo","nfo"),xre=ye("x-opml","opml"),wre=ye("x-org","org"),vre=ye("x-pascal","p","pas"),Fre=ye("x-processing","pde"),Are=ye("x-sass","sass"),bre=ye("x-scss","scss"),Sre=ye("x-setext","etx"),yre=ye("x-sfv","sfv"),Tre=ye("x-suse-ymp","ymp"),Ere=ye("x-uuencode","uu"),_re=ye("x-vcalendar","vcs"),Mre=ye("x-vcard","vcf"),Qg=ye("xml"),kre=ye("xml-external-parsed-entity"),Cre=ye("yaml","yaml","yml");var rx={};pr(rx,{Video_BMPEG:()=>Dre,Video_BT656:()=>Pre,Video_CelB:()=>Lre,Video_DV:()=>Ire,Video_Encaprtp:()=>Rre,Video_Example:()=>Bre,Video_Flexfec:()=>Vre,Video_H261:()=>Ore,Video_H263:()=>Nre,Video_H263_1998:()=>Hre,Video_H263_2000:()=>Wre,Video_H264:()=>Ure,Video_H264_RCDO:()=>zre,Video_H264_SVC:()=>jre,Video_H265:()=>Gre,Video_IsoSegment:()=>Xre,Video_JPEG:()=>qre,Video_Jpeg2000:()=>Kre,Video_Jpm:()=>Yre,Video_MP1S:()=>Qre,Video_MP2P:()=>$re,Video_MP2T:()=>Zre,Video_MP4V_ES:()=>eie,Video_MPV:()=>nie,Video_Mj2:()=>Jre,Video_Mp4:()=>Zg,Video_Mpeg:()=>ex,Video_Mpeg4_Generic:()=>tie,Video_Nv:()=>rie,Video_Ogg:()=>iie,Video_Parityfec:()=>oie,Video_Pointer:()=>sie,Video_Quicktime:()=>aie,Video_Raptorfec:()=>lie,Video_Raw:()=>cie,Video_Rtp_Enc_Aescm128:()=>uie,Video_Rtploopback:()=>pie,Video_Rtx:()=>die,Video_SMPTE292M:()=>mie,Video_Smpte291:()=>hie,Video_Ulpfec:()=>fie,Video_VP8:()=>ioe,Video_Vc1:()=>gie,Video_Vc2:()=>xie,Video_Vendor_1d_Interleaved_Parityfec:()=>wie,Video_Vendor_3gpp:()=>vie,Video_Vendor_3gpp2:()=>Aie,Video_Vendor_3gpp_Tt:()=>Fie,Video_Vendor_CCTV:()=>bie,Video_Vendor_DeceHd:()=>Sie,Video_Vendor_DeceMobile:()=>yie,Video_Vendor_DeceMp4:()=>Tie,Video_Vendor_DecePd:()=>Eie,Video_Vendor_DeceSd:()=>_ie,Video_Vendor_DeceVideo:()=>Mie,Video_Vendor_DirectvMpeg:()=>kie,Video_Vendor_DirectvMpeg_Tts:()=>Cie,Video_Vendor_DlnaMpeg_Tts:()=>Die,Video_Vendor_DvbFile:()=>Pie,Video_Vendor_Fvt:()=>Lie,Video_Vendor_HnsVideo:()=>Iie,Video_Vendor_Iptvforum1dparityfec_1010:()=>Rie,Video_Vendor_Iptvforum1dparityfec_2005:()=>Bie,Video_Vendor_Iptvforum2dparityfec_1010:()=>Vie,Video_Vendor_Iptvforum2dparityfec_2005:()=>Oie,Video_Vendor_IptvforumTtsavc:()=>Nie,Video_Vendor_IptvforumTtsmpeg2:()=>Hie,Video_Vendor_MotorolaVideo:()=>Wie,Video_Vendor_MotorolaVideop:()=>Uie,Video_Vendor_Mpeg_Dash_Mpd:()=>tx,Video_Vendor_Mpegurl:()=>zie,Video_Vendor_Ms_PlayreadyMediaPyv:()=>jie,Video_Vendor_NokiaInterleaved_Multimedia:()=>Gie,Video_Vendor_NokiaMp4vr:()=>Xie,Video_Vendor_NokiaVideovoip:()=>qie,Video_Vendor_Objectvideo:()=>Kie,Video_Vendor_RadgamettoolsBink:()=>Yie,Video_Vendor_RadgamettoolsSmacker:()=>Jie,Video_Vendor_SealedMpeg1:()=>$ie,Video_Vendor_SealedMpeg4:()=>Zie,Video_Vendor_SealedSwf:()=>eoe,Video_Vendor_SealedmediaSoftsealMov:()=>Qie,Video_Vendor_UvvuMp4:()=>toe,Video_Vendor_Vivo:()=>noe,Video_Vendor_YoutubeYt:()=>roe,Video_Webm:()=>nx,Video_X_F4v:()=>ooe,Video_X_Fli:()=>soe,Video_X_Flv:()=>aoe,Video_X_M4v:()=>loe,Video_X_Matroska:()=>coe,Video_X_Mng:()=>uoe,Video_X_Ms_Asf:()=>poe,Video_X_Ms_Vob:()=>doe,Video_X_Ms_Wm:()=>hoe,Video_X_Ms_Wmv:()=>moe,Video_X_Ms_Wmx:()=>foe,Video_X_Ms_Wvx:()=>goe,Video_X_Msvideo:()=>xoe,Video_X_Sgi_Movie:()=>woe,Video_X_Smv:()=>voe});var Re=tn("video"),Dre=Re("bmpeg"),Pre=Re("bt656"),Lre=Re("celb"),Ire=Re("dv"),Rre=Re("encaprtp"),Bre=Re("example"),Vre=Re("flexfec"),Ore=Re("h261","h261"),Nre=Re("h263","h263"),Hre=Re("h263-1998"),Wre=Re("h263-2000"),Ure=Re("h264","h264"),zre=Re("h264-rcdo"),jre=Re("h264-svc"),Gre=Re("h265"),Xre=Re("iso.segment"),qre=Re("jpeg","jpgv"),Kre=Re("jpeg2000"),Yre=Re("jpm","jpm","jpgm"),Jre=Re("mj2","mj2","mjp2"),Qre=Re("mp1s"),$re=Re("mp2p"),Zre=Re("mp2t"),Zg=Re("mp4","mp4","mp4v","mpg4"),eie=Re("mp4v-es"),ex=Re("mpeg","mpeg","mpg","mpe","m1v","m2v"),tie=Re("mpeg4-generic"),nie=Re("mpv"),rie=Re("nv"),iie=Re("ogg","ogv"),oie=Re("parityfec"),sie=Re("pointer"),aie=Re("quicktime","qt","mov"),lie=Re("raptorfec"),cie=Re("raw"),uie=Re("rtp-enc-aescm128"),pie=Re("rtploopback"),die=Re("rtx"),hie=Re("smpte291"),mie=Re("smpte292m"),fie=Re("ulpfec"),gie=Re("vc1"),xie=Re("vc2"),wie=Re("1d-interleaved-parityfec"),vie=Re("3gpp","3gp"),Fie=Re("3gpp-tt"),Aie=Re("3gpp2","3g2"),bie=Re("vnd.cctv"),Sie=Re("vnd.dece.hd","uvh","uvvh"),yie=Re("vnd.dece.mobile","uvm","uvvm"),Tie=Re("vnd.dece.mp4"),Eie=Re("vnd.dece.pd","uvp","uvvp"),_ie=Re("vnd.dece.sd","uvs","uvvs"),Mie=Re("vnd.dece.video","uvv","uvvv"),kie=Re("vnd.directv.mpeg"),Cie=Re("vnd.directv.mpeg-tts"),Die=Re("vnd.dlna.mpeg-tts"),Pie=Re("vnd.dvb.file","dvb"),Lie=Re("vnd.fvt","fvt"),Iie=Re("vnd.hns.video"),Rie=Re("vnd.iptvforum.1dparityfec-1010"),Bie=Re("vnd.iptvforum.1dparityfec-2005"),Vie=Re("vnd.iptvforum.2dparityfec-1010"),Oie=Re("vnd.iptvforum.2dparityfec-2005"),Nie=Re("vnd.iptvforum.ttsavc"),Hie=Re("vnd.iptvforum.ttsmpeg2"),Wie=Re("vnd.motorola.video"),Uie=Re("vnd.motorola.videop"),zie=Re("vnd.mpegurl","mxu","m4u"),jie=Re("vnd.ms-playready.media.pyv","pyv"),Gie=Re("vnd.nokia.interleaved-multimedia"),Xie=Re("vnd.nokia.mp4vr"),qie=Re("vnd.nokia.videovoip"),Kie=Re("vnd.objectvideo"),Yie=Re("vnd.radgamettools.bink"),Jie=Re("vnd.radgamettools.smacker"),Qie=Re("vnd.sealedmedia.softseal.mov"),$ie=Re("vnd.sealed.mpeg1"),Zie=Re("vnd.sealed.mpeg4"),eoe=Re("vnd.sealed.swf"),toe=Re("vnd.uvvu.mp4","uvu","uvvu"),noe=Re("vnd.vivo","viv"),roe=Re("vnd.youtube.yt"),tx=Re("vnd.mpeg.dash.mpd","mpd"),ioe=Re("vp8"),nx=Re("webm","webm"),ooe=Re("x-f4v","f4v"),soe=Re("x-fli","fli"),aoe=Re("x-flv","flv"),loe=Re("x-m4v","m4v"),coe=Re("x-matroska","mkv","mk3d","mks"),uoe=Re("x-mng","mng"),poe=Re("x-ms-asf","asf","asx"),doe=Re("x-ms-vob","vob"),hoe=Re("x-ms-wm","wm"),moe=Re("x-ms-wmv","wmv"),foe=Re("x-ms-wmx","wmx"),goe=Re("x-ms-wvx","wvx"),xoe=Re("x-msvideo","avi"),woe=Re("x-sgi-movie","movie"),voe=Re("x-smv","smv");var ix={};pr(ix,{XConference_XCooltalk:()=>Aoe});var Foe=tn("xconference"),Aoe=Foe("x-cooltalk","ice");var ox={};pr(ox,{XShader_XFragment:()=>Soe,XShader_XVertex:()=>boe});var fF=tn("x-shader"),boe=fF("x-vertex","vert","vs","glsl"),Soe=fF("x-fragment","frag","fs","glsl");function gF(r){if(r.status>=400)throw new Error("Resource could not be retrieved: "+r.requestPath);return r}function tt(r){let{content:t}=gF(r);return t}function Vs(r){return T(r)&&ht(r.then)&&ht(r.catch)&&ht(r.finally)&&ht(r.fetch)&&ht(r.getSize)}var qc=class{constructor(t,e){this.path=t;this.type=e;this._result=null;this._error=null;this._started=!1;this._finished=!1;this.resolve=null;this.reject=null;this.promise=new Promise((n,i)=>{this.resolve=o=>{this._result=o,this._finished=!0,n(o)},this.reject=o=>{this._error=o,this._finished=!0,i(o)}})}get result(){if(T(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}async getSize(t){try{let{contentLength:e}=await t.head(this.path).accept(this.type).exec();return[this,e||1]}catch(e){return console.warn(e),[this,1]}}async fetch(t,e){try{let n=await this.getResult(t,e);this.resolve(n)}catch(n){this.reject(n)}}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};var Ha=class extends qc{constructor(e,n,i){let o;dr(n)?i=n:o=n;super(e,o);this.useCache=!!i}getResult(e,n){return this.getRequest(e,n).then(tt)}getRequest(e,n){let i=e.get(this.path).useCache(this.useCache).progress(n);return this.getResponse(i)}};var _i=class extends Ha{getResponse(t){return t.file(this.type)}},jp=class extends Ha{getResponse(t){return t.image(this.type)}};function sx(r,...t){if(!bi(r))return!1;r=r;for(let e of t){if(!(e in r))return!1;let n=r[e];if(!ht(n))return!1}return!0}function yoe(r){return sx(r,"dispose")}function Toe(r){return sx(r,"destroy")}function Eoe(r){return sx(r,"close")}function zt(r){yoe(r)&&r.dispose(),Eoe(r)&&r.close(),Toe(r)&&r.destroy()}function xF(r,t){try{return t(r)}finally{zt(r)}}var Kc="HTMLCanvasElement"in globalThis,Whe="HTMLImageElement"in globalThis,ax=!1,Os=!ax&&"OffscreenCanvas"in globalThis,_oe=!ax&&"createImageBitmap"in globalThis;function si(r){return Kc&&r instanceof HTMLCanvasElement}function Gp(r){return Os&&r instanceof OffscreenCanvas}function Xp(r){return _oe&&r instanceof ImageBitmap}function wF(r){return r instanceof ImageData}function qp(r){return si(r)||Gp(r)}function vF(r,t){let e=r.getContext("2d");if(fe(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function FF(r,t){let e=r.getContext("2d");if(fe(e))throw new Error("Could not create 2d context for canvas");e.putImageData(t,0,0)}function Moe(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var lx=Os&&Moe(),Mi=lx&&Yc||Kc&&Ns||null,Kp=Kc?Ns:Mi;function koe(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var Uhe=Os&&koe();function Yc(r,t){return new OffscreenCanvas(r,t)}function Ns(r,t){return Ca(P0(r),T0(t))}function Coe(r){let t=Yc(r.width,r.height);return vF(t,r),t}function Doe(r){let t=Ns(r.width,r.height);return vF(t,r),t}var AF=lx&&Coe||Kc&&Doe||null;function Poe(r){let t=Yc(r.width,r.height);return FF(t,r),t}function Loe(r){let t=Ns(r.width,r.height);return FF(t,r),t}var bF=lx&&Poe||Kc&&Loe||null;function Yp(r,t){let e=r.getContext("2d");if(fe(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function Jp(r){let t=Ns(r.width,r.height);return Yp(t,r),t}async function Wa(r){let t=tr(Zn(r));return await dn(t,"load","error"),t}function cx(r,t,e,n=1){return t=Math.floor(t*n),e=Math.floor(e*n),r.width!=t||r.height!=e?(r.width=t,r.height=e,!0):!1}function Ioe(r){return T(r.textBaseline)}function Roe(r,t,e,n=1){let i=r.imageSmoothingEnabled,o=r.textBaseline,s=r.textAlign,l=r.font,c=cx(r.canvas,t,e,n);return c&&(r.imageSmoothingEnabled=i,r.textBaseline=o,r.textAlign=s,r.font=l),c}function Jc(r,t,e,n=1){return Ioe(r)?Roe(r,t,e,n):cx(r.canvas,t,e,n)}function ux(r,t=1){return cx(r,r.clientWidth,r.clientHeight,t)}function Fo(r,t,e){if(t instanceof Ti&&(t=t.value),Gp(r))return r.convertToBlob({type:t,quality:e});if(si(r)){let n=new mt;return r.toBlob(n.resolve,t,e),n}else throw new Error("Cannot save image from canvas")}function $o(r){qp(r)?r.width=r.height=0:zt(r)}function SF(r){let t=new mt,e=setInterval(()=>{r()&&(clearInterval(e),t.resolve())},100);return t}async function ln(r,t){let{status:e,requestPath:n,responsePath:i,content:o,contentType:s,contentLength:l,fileName:c,headers:u,date:p}=r;return{status:e,requestPath:n,responsePath:i,content:T(t)?await t(o):void 0,contentType:s,contentLength:l,fileName:c,headers:u,date:p}}var px=null;function yF(r){return px===null&&(px=new Audio),px.canPlayType(r)!==""}var Qp=class{constructor(t,e,n,i=!1){this.fetcher=t;this.method=e;this.path=n;this.useBLOBs=i;this.prog=null;this.request={method:e,path:this.path.href,body:null,headers:null,timeout:null,withCredentials:!1,useCache:!1,retryCount:3}}retries(t){return this.request.retryCount=t,this}query(t,e){return this.path.searchParams.set(t,e),this.request.path=this.path.href,this}header(t,e){return this.request.headers===null&&(this.request.headers=new Map),this.request.headers.set(t.toLowerCase(),e),this}headers(t){for(let[e,n]of t.entries())this.header(e,n);return this}timeout(t){return this.request.timeout=t,this}progress(t){return this.prog=t,this}body(t,e){if(T(t)){let n=new Set,i=new Array;i.push(t);let o=!1;for(;!o&&i.length>0;){let s=i.shift();if(s&&!n.has(s))if(n.add(s),s instanceof Blob){o=!0;break}else et(s)||i.push(...Object.values(s))}if(o){let s=new FormData,l=new Map,c=new Set;for(let[u,p]of Object.entries(t))if(p instanceof Blob){let f=u+".name",w=t[f];et(w)&&(l.set(p,w),c.add(f))}for(let[u,p]of Object.entries(t))c.has(u)||(p instanceof Blob?s.append(u,p,l.get(p)):et(p)?s.append(u,p):T(p)&&ht(p.toString)?s.append(u,p.toString()):console.warn("Can't serialize value to formdata",u,p));t=s,e=void 0}this.request.body=t,this.content(e)}return this}withCredentials(){return this.request.withCredentials=!0,this}useCache(t=!0){return this.request.useCache=t,this}media(t,e){T(e)&&(et(e)||(e=e.value),this.header(t,e))}content(t){this.media("content-type",t)}accept(t){return this.media("accept",t),this}blob(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBlob(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBlob(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ot(this.method)}buffer(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBuffer(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBuffer(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ot(this.method)}async file(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return await this.fetcher.sendObjectGetFile(this.request,this.prog);if(this.method==="GET"){if(this.useBLOBs)return await this.fetcher.sendNothingGetFile(this.request,this.prog);{let e=await this.fetcher.sendNothingGetNothing(this.request);return ln(e,()=>this.request.path)}}else{if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ot(this.method)}}text(t){if(this.accept(t||Bs),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetText(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetText(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ot(this.method)}object(t){if(this.accept(t||Oa),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetObject(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetObject(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ot(this.method)}xml(t){if(this.accept(t||Qg),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetXml(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetXml(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ot(this.method)}imageBitmap(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetImageBitmap(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetImageBitmap(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ot(this.method)}exec(){if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetNothing(this.request,this.prog);if(this.method==="GET")throw new un("GET requests should expect a response type");if(this.method==="HEAD"||this.method==="OPTIONS")return this.fetcher.sendNothingGetNothing(this.request);Ot(this.method)}async audioBlob(t){if(T(t)&&(et(t)||(t=t.value),!yF(t)))throw new Error(`Probably can't play file of type "${t}" at path: ${this.request.path}`);let e=await this.blob(t);if(yF(e.contentType))return e;throw new Error(`Cannot play file of type "${e.contentType}" at path: ${this.request.path}`)}async audioBuffer(t,e){return ln(await this.audioBlob(e),async n=>await t.decodeAudioData(await n.arrayBuffer()))}async htmlElement(t,e,n){let i=await this.file(n),o=dn(t,e,"error");return t instanceof HTMLLinkElement?t.href=i.content:t.src=i.content,await o,await ln(i,()=>t)}image(t){return this.htmlElement(tr(),"load",t)}async htmlCanvas(t){let e=Ns(1,1);if(this.method==="GET")if(Os){this.accept(t);let n=await this.fetcher.drawImageToCanvas(this.request,e.transferControlToOffscreen(),this.prog);return await ln(n,()=>e)}else{let n=await this.image(t);return await ln(n,i=>(e.width=i.width,e.height=i.height,Yp(e,i),zt(i),e))}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ot(this.method)}}canvas(t){return Os?this.offscreenCanvas(t):this.htmlCanvas(t)}async offscreenCanvas(t){if(!Os)throw new Error("This system does not support OffscreenCanvas");if(this.method==="GET"){let e=await this.image(t);return await ln(e,n=>{let i=Yc(n.width,n.height);return Yp(i,n),zt(n),i})}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Ot(this.method)}}async style(){let t=eF(Kr(Xc),M0("stylesheet"));document.head.append(t);let e=await this.htmlElement(t,"load",Xc);return ln(e)}async getScript(){let t=nF(Kr(Ei));document.head.append(t);let e=await this.htmlElement(t,"load",Ei);return ln(e)}async script(t){let e=null,n=this.request.path;if(!t)e=await this.getScript();else if(!t()){let i=SF(t);e=await this.getScript(),await i}return this.prog&&this.prog.end(n),e}async module(){let t=this.request.path,e=await this.file(Ei),n=await import(e.content);return this.prog&&this.prog.end(t),ln(e,()=>n)}async wasm(t){let e=await this.buffer(zp);if(!zp.matches(e.contentType))throw new Error(`Server did not respond with WASM file. Was: ${e.contentType}`);let n=await WebAssembly.compile(e.content),i=await WebAssembly.instantiate(n,t);return ln(e,()=>i.exports)}async worker(t="module"){let e=this.request.path,n=await this.file(Ei);this.prog=null,this.request.timeout=null;let i=new Worker(n.content,{type:t});return this.prog&&this.prog.end(e),ln(n,()=>i)}};var $p=class{constructor(t,e=!1){this.service=t;this.useBLOBs=e;{let n=O0("input[name=__RequestVerificationToken]");n&&this.service.setRequestVerificationToken(n.value)}}clearCache(){return this.service.clearCache()}evict(t,e){return this.service.evict(new URL(t,e||location.href).href)}request(t,e,n){return new Qp(this.service,t,new URL(e,n||location.href),this.useBLOBs)}head(t,e){return this.request("HEAD",t,e)}options(t,e){return this.request("OPTIONS",t,e)}get(t,e){return this.request("GET",t,e)}post(t,e){return this.request("POST",t,e)}put(t,e){return this.request("PUT",t,e)}patch(t,e){return this.request("PATCH",t,e)}delete(t,e){return this.request("DELETE",t,e)}async assets(t,e,...n){fe(n)&&(n=[]),n.unshift(e);let i;Vs(t)?n.unshift(t):T(t)&&(i=t),n=n.filter(T);let o=await Promise.all(n.map(l=>l.getSize(this))),s=new Map(o);await Uc(i,n.map(l=>[s.get(l),c=>l.fetch(this,c)]))}};var Zp=class{constructor(t){this.impl=t;this.defaultPostHeaders=new Map}setRequestVerificationToken(t){this.defaultPostHeaders.set("RequestVerificationToken",t)}clearCache(){return this.impl.clearCache()}evict(t){return this.impl.evict(t)}sendNothingGetNothing(t){return this.impl.sendNothingGetNothing(t)}sendNothingGetBlob(t,e){return this.impl.sendNothingGetSomething("blob",t,e)}sendObjectGetBlob(t,e){return this.impl.sendSomethingGetSomething("blob",t,this.defaultPostHeaders,e)}sendNothingGetBuffer(t,e){return this.impl.sendNothingGetSomething("arraybuffer",t,e)}sendObjectGetBuffer(t,e){return this.impl.sendSomethingGetSomething("arraybuffer",t,this.defaultPostHeaders,e)}sendNothingGetText(t,e){return this.impl.sendNothingGetSomething("text",t,e)}sendObjectGetText(t,e){return this.impl.sendSomethingGetSomething("text",t,this.defaultPostHeaders,e)}sendNothingGetObject(t,e){return this.impl.sendNothingGetSomething("json",t,e)}sendObjectGetObject(t,e){return this.impl.sendSomethingGetSomething("json",t,this.defaultPostHeaders,e)}sendObjectGetNothing(t,e){return this.impl.sendSomethingGetSomething("",t,this.defaultPostHeaders,e)}drawImageToCanvas(t,e,n){return this.impl.drawImageToCanvas(t,e,n)}async sendNothingGetFile(t,e){return ln(await this.sendNothingGetBlob(t,e),URL.createObjectURL)}async sendObjectGetFile(t,e){return ln(await this.sendObjectGetBlob(t,e),URL.createObjectURL)}async sendNothingGetXml(t,e){return ln(await this.impl.sendNothingGetSomething("document",t,e),n=>n.documentElement)}async sendObjectGetXml(t,e){return ln(await this.impl.sendSomethingGetSomething("document",t,this.defaultPostHeaders,e),n=>n.documentElement)}async sendNothingGetImageBitmap(t,e){return ln(await this.sendNothingGetBlob(t,e),createImageBitmap)}async sendObjectGetImageBitmap(t,e){return ln(await this.sendObjectGetBlob(t,e),createImageBitmap)}};function ed(r,t,e){return new Map(r.map(n=>[t(n),e(n)]))}function Ua(r,t){return ed(r,t,Rr)}var gn=class{constructor(t){this.items=new Map;this.defaultItems=new Array;if(T(t))for(let[e,n]of t)this.add(e,n)}add(t,...e){for(let n of e)if(fe(t))this.defaultItems.push(n);else{let i=this.items.get(t);fe(i)&&this.items.set(t,i=[]),i.push(n)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let t of this.defaultItems)yield t;for(let t of this.items.values())for(let e of t)yield e}has(t){return T(t)?this.items.has(t):this.defaultItems.length>0}get(t){return fe(t)?this.defaultItems:this.items.get(t)||[]}count(t){if(fe(t))return this.defaultItems.length;let e=this.get(t);return T(e)?e.length:0}get size(){let t=this.defaultItems.length;for(let e of this.items.values())t+=e.length;return t}delete(t){return fe(t)?ct(this.defaultItems).length>0:this.items.delete(t)}remove(t,e){if(fe(t))Wt(this.defaultItems,e);else{let n=this.items.get(t);T(n)&&(Wt(n,e),n.length===0&&this.items.delete(t))}}clear(){this.items.clear(),ct(this.defaultItems)}};var Yn=class{constructor(t){this.items=new Map;if(T(t))for(let[e,n,i]of t)this.add(e,n,i)}add(t,e,n){let i=this.items.get(t);return fe(i)&&this.items.set(t,i=new Map),i.set(e,n),this}*entries(){for(let[t,e]of this.items)for(let[n,i]of e)yield[t,n,i]}keys(t){return fe(t)?this.items.keys():this.items.get(t).keys()}*values(){for(let t of this.items.values())for(let e of t.values())yield e}has(t,e){return this.items.has(t)&&(fe(e)||this.items.get(t).has(e))}get(t,e){return fe(e)?this.items.get(t):this.items.has(t)?this.items.get(t).get(e):null}count(t){return this.items.has(t)?this.items.get(t).size:null}get size(){let t=0;for(let e of this.items.values())t+=e.size;return t}delete(t,e){if(fe(e))return this.items.delete(t);if(this.items.has(t)){let n=this.items.get(t),i=n.delete(e);return n.size===0&&this.items.delete(t),i}else return!1}clear(){this.items.clear()}};var za=class{constructor(t){this.db=t}static delete(t){let e=indexedDB.deleteDatabase(t),n=dn(e,"success","error","blocked");return Si(n)}static async open(t,...e){let n=Ua(e,k=>k.name),i=new Yn(e.filter(k=>T(k.indexes)).flatMap(k=>k.indexes.map(E=>[k.name,E.name,E]))),o=new Array,s=new Array,l=new Array,c=new gn,u=new gn,p=null,f=indexedDB.open(t);if(await Si(dn(f,"success","error","blocked"))){let k=f.result;p=k.version;let E=new Array;for(let b of k.objectStoreNames)n.has(b)||s.push(b);for(let b of n.keys())k.objectStoreNames.contains(b)?E.push(b):o.push(b);if(E.length>0){let b=k.transaction(E),g=dn(b,"complete","error","abort"),v=Si(g);for(let y of E){let V=b.objectStore(y),B=n.get(y);T(B.options)&&V.keyPath!==B.options.keyPath&&(s.push(y),o.push(y));for(let D of V.indexNames)i.has(y,D)||(l.indexOf(y)===-1&&l.push(y),u.add(y,D));if(i.has(y))for(let D of i.get(y).keys())if(!V.indexNames.contains(D))l.indexOf(y)===-1&&l.push(y),c.add(y,D);else{let L=i.get(y,D),J=V.index(D);(et(L.keyPath)!==et(J.keyPath)||et(L.keyPath)&&et(J.keyPath)&&L.keyPath!==J.keyPath||hr(L.keyPath)&&hr(J.keyPath)&&kp(L.keyPath,J.keyPath))&&(l.indexOf(y)===-1&&l.push(y),u.add(y,D),c.add(y,D))}}b.commit(),await v}zt(k)}else{p=0,o.push(...n.keys());for(let k of e)if(T(k.indexes))for(let E of k.indexes)c.add(k.name,E.name)}(o.length>0||s.length>0||c.size>0||u.size>0)&&++p;let w=new mt,A=T(p)?indexedDB.open(t,p):indexedDB.open(t),m=dn(A,"success","error","blocked"),d=Si(w),h=Si(m),M=w.resolver(!1);if(A.addEventListener("success",M),A.addEventListener("upgradeneeded",()=>{let k=dn(A.transaction,"complete","error","abort"),E=A.result;for(let g of s)E.deleteObjectStore(g);let b=new Map;for(let g of o){let v=n.get(g),y=E.createObjectStore(g,v.options);b.set(g,y)}for(let g of l){let v=A.transaction.objectStore(g);b.set(g,v)}for(let[g,v]of b){for(let y of u.get(g))v.deleteIndex(y);for(let y of c.get(g)){let V=i.get(g,y);v.createIndex(y,V.keyPath,V.options)}}Si(k).then(w.resolve).catch(w.reject).finally(()=>A.removeEventListener("success",M))}),!await d)throw w.error;if(!await h)throw m.error;return new za(A.result)}dispose(){zt(this.db)}get name(){return this.db.name}get version(){return this.db.version}get storeNames(){return Array.from(this.db.objectStoreNames)}getStore(t){return new dx(this.db,t)}},dx=class{constructor(t,e){this.db=t;this.storeName=e}async request(t,e){let n=this.db.transaction(this.storeName,e),i=dn(n,"complete","error"),o=n.objectStore(this.storeName),s=t(o),l=dn(s,"success","error");if(!await Si(l))throw n.abort(),l.error;if(n.commit(),!await Si(i))throw i.error;return s.result}add(t,e){return this.request(n=>n.add(t,e),"readwrite")}clear(){return this.request(t=>t.clear(),"readwrite")}getCount(t){return this.request(e=>e.count(t),"readonly")}async has(t){return await this.getCount(t)>0}delete(t){return this.request(e=>e.delete(t),"readwrite")}get(t){return this.request(e=>e.get(t),"readonly")}getAll(){return this.request(t=>t.getAll(),"readonly")}getAllKeys(){return this.request(t=>t.getAllKeys(),"readonly")}getKey(t){return this.request(e=>e.getKey(t),"readonly")}openCursor(t,e){return this.request(n=>n.openCursor(t,e),"readonly")}openKeyCursor(t,e){return this.request(n=>n.openKeyCursor(t,e),"readonly")}put(t,e){return this.request(n=>n.put(t,e),"readwrite")}};function TF(r,...t){for(let e of t)if(T(e))for(let[n,i]of e)r.set(n,i);return r}var hx=class extends mt{constructor(e){super(!1);this.milliseconds=e;this._timer=null}start(){super.start(),this._timer=setTimeout(()=>{this._timer=null,this.resolve()},this.milliseconds)}reset(){super.reset(),T(this._timer)&&(clearTimeout(this._timer),this._timer=null)}};function EF(r){let t=new hx(r);return t.start(),t}function td(r,t){return async()=>{let e=null,n=500;for(let i=0;i<=r;++i)try{return i>0&&(await EF(n),n*=2),await t()}catch(o){e=o}throw e}}function Boe(r){return et(r)||Y1(r)||r instanceof Blob||r instanceof FormData||J1(r)||"Document"in globalThis&&r instanceof Document}function nd(r,t,e,n,i,o){let s=!o;o&&o.then(()=>s=!0);let l=!1,c=i,u=new mt;e.addEventListener("loadstart",()=>{s&&!l&&n&&n.start(r)}),e.addEventListener("progress",f=>{if(s&&!l){let w=f;n&&n.report(w.loaded,Math.max(w.loaded,w.total),r),w.loaded===w.total&&(c=!0,l&&u.resolve())}}),e.addEventListener("load",()=>{s&&!l&&(n&&n.end(r),l=!0,c&&u.resolve())});let p=f=>()=>{s&&u.reject(`${f} (${t.status})`)};return e.addEventListener("error",p("error")),e.addEventListener("abort",p("abort")),e.addEventListener("timeout",p("timeout")),u}function mx(r,t,e,n,i,o){if(r.open(t,e),r.responseType="blob",r.timeout=n,i)for(let[s,l]of i)r.setRequestHeader(s,l);T(o)?r.send(o):r.send()}function rd(r,t,e){if(!r.has(t))return null;let n=r.get(t);try{let i=e(n);return r.delete(t),i}catch(i){console.warn(t,i)}return null}var Voe=/filename=\"(.+)\"(;|$)/,Ooe="Juniper:Fetcher:Cache",id=class{constructor(){this.cache=null;this.store=null;this.tasks=new Yn;this.cacheReady=this.openCache()}async drawImageToCanvas(t,e,n){let i=await this.sendNothingGetSomething("blob",t,n),o=i.content;return xF(await createImageBitmap(o,{imageOrientation:"from-image"}),s=>(e.width=s.width,e.height=s.height,e.getContext("2d").drawImage(s,0,0),ln(i)))}async openCache(){let t={keyPath:"requestPath"};this.cache=await za.open(Ooe,{name:"files",options:t}),this.store=await this.cache.getStore("files")}async clearCache(){await this.cacheReady,await this.store.clear()}async evict(t){await this.cacheReady,this.store.has(t)&&await this.store.delete(t)}async readResponseHeaders(t,e){let n=e.getAllResponseHeaders().split(/[\r\n]+/).map(w=>w.trim()).filter(w=>w.length>0).map(w=>{let A=w.split(": "),m=A.shift().toLowerCase(),d=A.join(": ");return[m,d]}),i=new gn(n),o=Array.from(i.keys()).map(w=>[w,i.get(w).join(", ")]),s=new Map(o),l=rd(s,"content-type",Rr),c=rd(s,"content-length",parseFloat),u=rd(s,"date",w=>new Date(w)),p=rd(s,"content-disposition",w=>{if(T(w)){let A=w.match(Voe);if(T(A))return A[1]}return null});return{status:e.status,requestPath:t,responsePath:e.responseURL,content:void 0,contentType:l,contentLength:c,fileName:p,date:u,headers:s}}async readResponse(t,e){let{responsePath:n,status:i,contentType:o,contentLength:s,fileName:l,date:c,headers:u}=await this.readResponseHeaders(t,e),p={requestPath:t,responsePath:n,status:i,contentType:o,contentLength:s,fileName:l,date:c,headers:u,content:e.response};return T(p.content)&&(p.contentType=p.contentType||p.content.type,p.contentLength=p.contentLength||p.content.size),p}async decodeContent(t,e){return ln(e,async n=>{if(t==="")return null;if(fe(e.contentType)){let i=Array.from(e.headers.entries()).map(o=>o.join(": ")).join(`
  `);throw new Error(`No content type found in headers: 
  `+i)}else{if(t==="blob")return n;if(t==="arraybuffer")return await n.arrayBuffer();if(t==="json"){let i=await n.text();return i.length>0?JSON.parse(i):null}else if(t==="document"){let i=new DOMParser;if(e.contentType==="application/xhtml+xml"||e.contentType==="text/html"||e.contentType==="application/xml"||e.contentType==="image/svg+xml"||e.contentType==="text/xml")return i.parseFromString(await n.text(),e.contentType);throw new Error("Couldn't parse document")}else{if(t==="text")return await n.text();Ot(t)}}})}async withCachedTask(t,e){return t.method!=="GET"&&t.method!=="HEAD"&&t.method!=="OPTIONS"?await e():(this.tasks.has(t.method,t.path)||this.tasks.add(t.method,t.path,e().finally(()=>this.tasks.delete(t.method,t.path))),this.tasks.get(t.method,t.path))}sendNothingGetNothing(t){return this.withCachedTask(t,td(t.retryCount,async()=>{let e=new XMLHttpRequest,n=nd(`requesting: ${t.path}`,e,e,null,!0);return mx(e,t.method,t.path,t.timeout,t.headers),await n,await this.readResponseHeaders(t.path,e)}))}sendNothingGetSomething(t,e,n){return this.withCachedTask(e,td(e.retryCount,async()=>{let i=null,o=e.useCache&&e.method==="GET";o&&(T(n)&&n.start(),await this.cacheReady,i=await this.store.get(e.path));let s=fe(i);if(s){let c=new XMLHttpRequest,u=nd(`requesting: ${e.path}`,c,c,n,!0);mx(c,e.method,e.path,e.timeout,e.headers),await u,i=await this.readResponse(e.path,c),o&&await this.store.add(i)}let l=await this.decodeContent(t,i);return s&&T(n)&&n.end(),l}))}sendSomethingGetSomething(t,e,n,i){let o=null,s=TF(new Map,n,e.headers);if(e.body instanceof FormData&&T(s)){let w=new Array;for(let A of s.keys())A.toLowerCase()==="content-type"&&w.push(A);for(let A of w)s.delete(A)}Boe(e.body)&&!et(e.body)?o=e.body:T(e.body)&&(o=JSON.stringify(e.body));let l=T(o),c=Up(i,l?2:1),[u,p]=c,f=async()=>{let w=new XMLHttpRequest,A=l?nd("uploading",w,w.upload,u,!1):Promise.resolve(),m=nd("saving",w,w,p,!0,A);mx(w,e.method,e.path,e.timeout,s,o),await A,await m;let d=await this.readResponse(e.path,w);return await this.decodeContent(t,d)};return td(e.retryCount,f)()}};var Qc=class extends qe{constructor(e,n){super();this.scriptPath=e.scriptPath;let i=-1,o=e.workers,s=null;if(Rt(o)?i=o:T(o)?(this.taskCounter=o.curTaskCounter,s=o.workers,i=s.length):i=navigator.hardwareConcurrency||4,i<1)throw new Error("Worker pool size must be a postive integer greater than 0");if(this.workers=new Array(i),fe(s)){this.taskCounter=0;for(let l=0;l<i;++l)this.workers[l]=new n(new Worker(this.scriptPath,{type:"module"}))}else for(let l=0;l<i;++l)this.workers[l]=new n(s[l]);for(let l of this.workers)l.addBubbler(this)}dispose(){this.workers.forEach(zt),ct(this.workers)}nextWorker(){let e=this.peekWorker();return this.taskCounter++,e}peekWorker(){return this.workers[this.taskCounter%this.workers.length]}};function fx(r){return T(r)&&ht(r.report)&&ht(r.attach)&&ht(r.end)}function _F(){return"chrome"in globalThis&&!navigator.userAgent.match("CriOS")}function sd(){return"InstallTrigger"in globalThis}function MF(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function Noe(){return/^mac/i.test(navigator.platform)}function ja(){return/iP(ad|hone|od)/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||Noe()&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>2}function Ao(){return/Mobile VR/.test(navigator.userAgent)||/Pico Neo 3 Link/.test(navigator.userAgent)||bo}function ad(){return"xr"in navigator&&"isSessionSupported"in navigator.xr}function gx(){return"getVRDisplays"in navigator}function ld(){return ad()||gx()}function $c(){return/Android/.test(navigator.userAgent)||/BlackBerry/.test(navigator.userAgent)||/(UC Browser |UCWEB)/.test(navigator.userAgent)||ja()||Ao()}function Ga(){return!$c()}var Hoe=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,od=navigator.userAgent.match(Hoe),bo=!!od,kF=bo&&{major:parseFloat(od[1]),minor:parseFloat(od[2]),patch:parseFloat(od[3])},ufe=bo&&/pacific/i.test(navigator.userAgent),pfe=bo&&/quest/i.test(navigator.userAgent),dfe=bo&&/quest 2/i.test(navigator.userAgent);var xx="Worker"in globalThis;var Zc=class extends qe{constructor(e){super();this.worker=e;this.invocations=new Map;this.tasks=new Array;this.taskCounter=0;xx||console.warn("Workers are not supported on this system."),this.worker.addEventListener("message",n=>{let i=n.data;switch(i.type){case"event":this.propogateEvent(i);break;case"progress":this.progressReport(i);break;case"return":this.methodReturned(i);break;case"error":this.invocationError(i);break;default:Ot(i)}})}postMessage(e,n){e.type!=="methodCall"&&Ot(e.type),n?this.worker.postMessage(e,n):this.worker.postMessage(e)}dispose(){this.worker.terminate()}progressReport(e){let n=this.invocations.get(e.taskID);if(n){let{prog:i}=n;i&&i.report(e.soFar,e.total,e.msg,e.est)}}methodReturned(e){let n=this.removeInvocation(e.taskID),{task:i}=n;i.resolve(e.returnValue)}invocationError(e){let n=this.removeInvocation(e.taskID),{task:i,methodName:o}=n;i.reject(new Error(`${o} failed. Reason: ${e.errorMessage}`))}removeInvocation(e){let n=this.invocations.get(e);return this.invocations.delete(e),n}callMethod(e,n,i,o){if(!xx)return Promise.reject(new Error("Workers are not supported on this system."));let s=null,l=null;fx(n)&&(o=n,n=null,i=null),fx(i)&&!o&&(o=i,i=null),hr(n)&&(s=n),hr(i)&&(l=i);let c=this.taskCounter++,u=Mn(this.tasks,w=>w.finished);u?u.reset():(u=new mt,this.tasks.push(u));let p={methodName:e,task:u,prog:o};this.invocations.set(c,p);let f=null;return T(n)?f={type:"methodCall",taskID:c,methodName:e,params:s}:f={type:"methodCall",taskID:c,methodName:e},this.postMessage(f,l),u}};var CF=new URL(globalThis.location.href),eu=CF.searchParams.has("DEBUG")&&!CF.searchParams.has("RELEASE");function _r(r,t){let e=globalThis,n=e[r];if(fe(n)){if(fe(t))throw new Error(`No value ${r} found`);n=t(),e[r]=n}return n}var Rfe=_r("juniper::loadedFonts",()=>[]);function cd(r){let t=[];return r.fontStyle&&r.fontStyle!=="normal"&&t.push(r.fontStyle),r.fontVariant&&r.fontVariant!=="normal"&&t.push(r.fontVariant),r.fontWeight&&r.fontWeight!=="normal"&&t.push(r.fontWeight),t.push(yr(r.fontSize)),t.push(r.fontFamily),t.join(" ")}function An(...r){return Promise.all(r)}var Woe="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function xr(r,t){if(r<0)throw new Error("Length must be greater than 0");fe(t)&&(t=Woe);let e="";for(let n=0;n<r;++n){let i=Math.floor(Math.random()*t.length);e+=t[i]}return e}var DF="3.7.24";var ud=class{constructor(t){this.log=t}error(t,e,n){console.error(t,e,n),this.log("error",{page:t,operation:e,exception:n})}};var zoe=eu?xr(10):DF;var PF=!1;var So=50,wx=12,LF=So*wx;var pd={fontFamily:"Lato",fontSize:20};var Xa=Tr(30,67,136),IF=Tr(78,77,77),RF={fontFamily:pd.fontFamily,fontSize:pd.fontSize,textFillColor:"white"},BF=Object.assign({},RF,{bgFillColor:Tr(0,120,215),bgStrokeColor:"black",bgStrokeSize:.02,padding:{top:.025,left:.05,bottom:.025,right:.05},minHeight:.2,maxHeight:.2,scale:300}),nge=Object.assign({},RF,{textStrokeColor:"black",textStrokeSize:.01,minHeight:.25,maxHeight:.25});function VF(){let r=new gn([["arrow","arrow-up"],["arrow","arrow-down"],["arrow","arrow-left"],["arrow","arrow-right"],["chat","user"],["chat","chat"],["ui","menu"],["ui","settings"],["ui","quit"],["ui","lobby"],["zoom","zoom-in"],["zoom","zoom-out"],["zoom","zoom-info"],["environment-audio","environment-audio-mute"],["environment-audio","environment-audio-unmute"],["headphones","headphones-unmuted"],["headphones","headphones-muted"],["microphone","microphone-mute"],["microphone","microphone-unmute"],["volume","volume-muted"],["volume","volume-low"],["volume","volume-medium"],["volume","volume-high"],["media","media-pause"],["media","media-play"],["media","media-stop"],["media","media-replay"],["ar","ar-enter"],["ar","ar-exit"],["vr","vr-enter"],["vr","vr-exit"],["fullscreen","fullscreen-enter"],["fullscreen","fullscreen-exit"]]),t=new Yn;for(let[e,n]of r.entries())for(let i of n)t.add(e,i.replace(e+"-",""),`/images/ui/${i}.png`);return t}var joe=eu?".js":".min.js";function Goe(r,t){return`/js/${t}/index${r}?v=${zoe}`}function Hs(r){return Goe(joe,r)}function OF(r){return Hs("vr-apps/"+r)}function NF(r){return Hs("workers/"+r)}function HF(r){return Hs("libs/"+r)}function WF(r){let t=null,e=Promise.resolve(),n=async(i,o)=>{t=await r.post("/").body({reportID:t,key:i,value:o},wo).object().then(tt)};return new ud((i,o)=>{e=e.then(()=>n(i,o))})}function dd(r=!0){let t=new Zp(new id);return new $p(t,!eu)}var gt=class{constructor(t,e,n=null){this.value=t;this.desc=e;this.value=t,this.desc=e,this.props=n||{}}contains(t){return t instanceof gt?this.contains(t.value):this.value.indexOf(t)>=0}changeStyle(t,e){let n=this.value;return n.endsWith(t)&&(n=n.substring(0,n.length-t.length)),n+=e,n}get textStyle(){return this.changeStyle("\uFE0F","\uFE0E")}get emojiStyle(){return this.changeStyle("\uFE0E","\uFE0F")}};var yo=new gt("\u2B50","Star");var UF=new gt("\u2BC1","Black Diamond Centred");var zF=new gt("\u{1F503}\uFE0F","Clockwise Vertical Arrows");var jF=new gt("\u2B06\uFE0F","Up Arrow"),GF=new gt("\u2B06\uFE0E","Up Arrow: Text");var tu=new gt("\u2BC6","Black Medium Down-Pointing Triangle Centered");var hd=new gt("\u2BC8","Black Medium Right-Pointing Triangle Centered");var XF=new gt("0\uFE0F\u20E3","Keycap Digit Zero"),qF=new gt("1\uFE0F\u20E3","Keycap Digit One"),KF=new gt("2\uFE0F\u20E3","Keycap Digit Two"),YF=new gt("3\uFE0F\u20E3","Keycap Digit Three"),JF=new gt("4\uFE0F\u20E3","Keycap Digit Four"),QF=new gt("5\uFE0F\u20E3","Keycap Digit Five"),$F=new gt("6\uFE0F\u20E3","Keycap Digit Six"),ZF=new gt("7\uFE0F\u20E3","Keycap Digit Seven"),eA=new gt("8\uFE0F\u20E3","Keycap Digit Eight"),tA=new gt("9\uFE0F\u20E3","Keycap Digit Nine");var nA=new gt("\u{1F51F}","Keycap: 10");var rA=new gt("\u{E007F}","Cancel Tag");var iA=new gt("\u2795","Plus");var vx=new gt("\u{1F30E}","Globe Showing Americas");var oA=new gt("\u{1F4E3}","Megaphone");var sA=new gt("\u{1F4F9}","Video Camera");var aA=new gt("\u{1F50A}","Speaker High Volume");var lA=new gt("\u{1F510}","Locked with Key");var cA=new gt("\u{1F579}\uFE0F","Joystick");var uA=new gt("\u{1F5D1}","Wastebasket");var pA=new gt("\u{1F4DC}","Scroll"),dA=new gt("\u{1F4DD}","Memo");var hA=new gt("\u26A0\uFE0F","Warning");var mA=new gt("\u{1F5BC}\uFE0F","Framed Picture");var fA=new gt("\u{1F5FA}\uFE0F","World Map");var Fx=new gt("\u2753","Question Mark");function ki(r){return fe(r)?null:{lat:r.lat,lng:r.lng}}function qi(r){return fe(r)?null:r instanceof google.maps.LatLng?{lat:r.lat(),lng:r.lng()}:{lat:r.lat,lng:r.lng}}function To(r){return!(r.shiftKey||r.altKey||r.ctrlKey||r.metaKey)}function md(r){return t=>{let e=t;To(e)&&e.key==="Enter"&&r(e)}}var Ax=class{constructor(t,e,n){this.name=t;this.callback=e;if(!ht(e))throw new Error("A function instance is required for this parameter");this.opts=n,Object.freeze(this)}applyToElement(t){this.add(t)}add(t){t.addEventListener(this.name,this.callback,this.opts)}remove(t){t.removeEventListener(this.name,this.callback)}};function Mr(r,t,e){return new Ax(r,t,e)}function pt(r,t){return Mr("click",r,t)}function fd(r,t){return Mr("contextmenu",r,t)}function gA(r,t){return Mr("dblclick",r,t)}function qa(r,t){return Mr("dragend",r,t)}function xA(r,t){return Mr("dragleave",r,t)}function Ka(r,t){return Mr("dragover",r,t)}function gd(r,t){return Mr("dragstart",r,t)}function xd(r,t){return Mr("drop",r,t)}function Je(r,t){return Mr("input",r,t)}function wA(r,t){return Mr("keydown",r,t)}function bx(r,t){return Mr("keyup",r,t)}function vA(r,t){return bx(e=>{e.key==="Enter"&&r(e)},t)}function FA(r,t){return Mr("play",r,t)}function AA(r,t){return Mr("toggle",r,t)}var wr=1e-6,Dn=typeof Float32Array<"u"?Float32Array:Array,Ki=Math.random;var Sge=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});function bA(){var r=new Dn(9);return Dn!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}var Ya={};pr(Ya,{add:()=>qse,calculateW:()=>Bse,clone:()=>zse,conjugate:()=>Hse,copy:()=>Gse,create:()=>Tx,dot:()=>YA,equals:()=>Zse,exactEquals:()=>$se,exp:()=>GA,fromEuler:()=>Wse,fromMat3:()=>qA,fromValues:()=>jse,getAngle:()=>Pse,getAxisAngle:()=>Dse,identity:()=>Cse,invert:()=>Nse,len:()=>Jse,length:()=>JA,lerp:()=>Yse,ln:()=>XA,mul:()=>Kse,multiply:()=>jA,normalize:()=>Ex,pow:()=>Vse,random:()=>Ose,rotateX:()=>Lse,rotateY:()=>Ise,rotateZ:()=>Rse,rotationTo:()=>eae,scale:()=>KA,set:()=>Xse,setAxes:()=>nae,setAxisAngle:()=>zA,slerp:()=>Ad,sqlerp:()=>tae,sqrLen:()=>Qse,squaredLength:()=>QA,str:()=>Use});var Qt={};pr(Qt,{add:()=>Joe,angle:()=>gse,bezier:()=>lse,ceil:()=>Qoe,clone:()=>qoe,copy:()=>Koe,create:()=>wd,cross:()=>ru,dist:()=>yse,distance:()=>_A,div:()=>Sse,divide:()=>EA,dot:()=>Fd,equals:()=>Fse,exactEquals:()=>vse,floor:()=>$oe,forEach:()=>_se,fromValues:()=>vd,hermite:()=>ase,inverse:()=>ose,len:()=>yx,length:()=>SA,lerp:()=>sse,max:()=>ese,min:()=>Zoe,mul:()=>bse,multiply:()=>TA,negate:()=>ise,normalize:()=>Sx,random:()=>cse,rotateX:()=>hse,rotateY:()=>mse,rotateZ:()=>fse,round:()=>tse,scale:()=>nse,scaleAndAdd:()=>rse,set:()=>Yoe,sqrDist:()=>Tse,sqrLen:()=>Ese,squaredDistance:()=>MA,squaredLength:()=>kA,str:()=>wse,sub:()=>Ase,subtract:()=>yA,transformMat3:()=>pse,transformMat4:()=>use,transformQuat:()=>dse,zero:()=>xse});function wd(){var r=new Dn(3);return Dn!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function qoe(r){var t=new Dn(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t}function SA(r){var t=r[0],e=r[1],n=r[2];return Math.hypot(t,e,n)}function vd(r,t,e){var n=new Dn(3);return n[0]=r,n[1]=t,n[2]=e,n}function Koe(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r}function Yoe(r,t,e,n){return r[0]=t,r[1]=e,r[2]=n,r}function Joe(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function yA(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function TA(r,t,e){return r[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r}function EA(r,t,e){return r[0]=t[0]/e[0],r[1]=t[1]/e[1],r[2]=t[2]/e[2],r}function Qoe(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r[2]=Math.ceil(t[2]),r}function $oe(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r[2]=Math.floor(t[2]),r}function Zoe(r,t,e){return r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.min(t[2],e[2]),r}function ese(r,t,e){return r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r}function tse(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r[2]=Math.round(t[2]),r}function nse(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r}function rse(r,t,e,n){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function _A(r,t){var e=t[0]-r[0],n=t[1]-r[1],i=t[2]-r[2];return Math.hypot(e,n,i)}function MA(r,t){var e=t[0]-r[0],n=t[1]-r[1],i=t[2]-r[2];return e*e+n*n+i*i}function kA(r){var t=r[0],e=r[1],n=r[2];return t*t+e*e+n*n}function ise(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r}function ose(r,t){return r[0]=1/t[0],r[1]=1/t[1],r[2]=1/t[2],r}function Sx(r,t){var e=t[0],n=t[1],i=t[2],o=e*e+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r}function Fd(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function ru(r,t,e){var n=t[0],i=t[1],o=t[2],s=e[0],l=e[1],c=e[2];return r[0]=i*c-o*l,r[1]=o*s-n*c,r[2]=n*l-i*s,r}function sse(r,t,e,n){var i=t[0],o=t[1],s=t[2];return r[0]=i+n*(e[0]-i),r[1]=o+n*(e[1]-o),r[2]=s+n*(e[2]-s),r}function ase(r,t,e,n,i,o){var s=o*o,l=s*(2*o-3)+1,c=s*(o-2)+o,u=s*(o-1),p=s*(3-2*o);return r[0]=t[0]*l+e[0]*c+n[0]*u+i[0]*p,r[1]=t[1]*l+e[1]*c+n[1]*u+i[1]*p,r[2]=t[2]*l+e[2]*c+n[2]*u+i[2]*p,r}function lse(r,t,e,n,i,o){var s=1-o,l=s*s,c=o*o,u=l*s,p=3*o*l,f=3*c*s,w=c*o;return r[0]=t[0]*u+e[0]*p+n[0]*f+i[0]*w,r[1]=t[1]*u+e[1]*p+n[1]*f+i[1]*w,r[2]=t[2]*u+e[2]*p+n[2]*f+i[2]*w,r}function cse(r,t){t=t||1;var e=Ki()*2*Math.PI,n=Ki()*2-1,i=Math.sqrt(1-n*n)*t;return r[0]=Math.cos(e)*i,r[1]=Math.sin(e)*i,r[2]=n*t,r}function use(r,t,e){var n=t[0],i=t[1],o=t[2],s=e[3]*n+e[7]*i+e[11]*o+e[15];return s=s||1,r[0]=(e[0]*n+e[4]*i+e[8]*o+e[12])/s,r[1]=(e[1]*n+e[5]*i+e[9]*o+e[13])/s,r[2]=(e[2]*n+e[6]*i+e[10]*o+e[14])/s,r}function pse(r,t,e){var n=t[0],i=t[1],o=t[2];return r[0]=n*e[0]+i*e[3]+o*e[6],r[1]=n*e[1]+i*e[4]+o*e[7],r[2]=n*e[2]+i*e[5]+o*e[8],r}function dse(r,t,e){var n=e[0],i=e[1],o=e[2],s=e[3],l=t[0],c=t[1],u=t[2],p=i*u-o*c,f=o*l-n*u,w=n*c-i*l,A=i*w-o*f,m=o*p-n*w,d=n*f-i*p,h=s*2;return p*=h,f*=h,w*=h,A*=2,m*=2,d*=2,r[0]=l+p+A,r[1]=c+f+m,r[2]=u+w+d,r}function hse(r,t,e,n){var i=[],o=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=o[0]+e[0],r[1]=o[1]+e[1],r[2]=o[2]+e[2],r}function mse(r,t,e,n){var i=[],o=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=o[0]+e[0],r[1]=o[1]+e[1],r[2]=o[2]+e[2],r}function fse(r,t,e,n){var i=[],o=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],r[0]=o[0]+e[0],r[1]=o[1]+e[1],r[2]=o[2]+e[2],r}function gse(r,t){var e=r[0],n=r[1],i=r[2],o=t[0],s=t[1],l=t[2],c=Math.sqrt(e*e+n*n+i*i),u=Math.sqrt(o*o+s*s+l*l),p=c*u,f=p&&Fd(r,t)/p;return Math.acos(Math.min(Math.max(f,-1),1))}function xse(r){return r[0]=0,r[1]=0,r[2]=0,r}function wse(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"}function vse(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]}function Fse(r,t){var e=r[0],n=r[1],i=r[2],o=t[0],s=t[1],l=t[2];return Math.abs(e-o)<=wr*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(n-s)<=wr*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=wr*Math.max(1,Math.abs(i),Math.abs(l))}var Ase=yA,bse=TA,Sse=EA,yse=_A,Tse=MA,yx=SA,Ese=kA,_se=function(){var r=wd();return function(t,e,n,i,o,s){var l,c;for(e||(e=3),n||(n=0),i?c=Math.min(i*e+n,t.length):c=t.length,l=n;l<c;l+=e)r[0]=t[l],r[1]=t[l+1],r[2]=t[l+2],o(r,r,s),t[l]=r[0],t[l+1]=r[1],t[l+2]=r[2];return t}}();function Mse(){var r=new Dn(4);return Dn!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function CA(r){var t=new Dn(4);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t}function DA(r,t,e,n){var i=new Dn(4);return i[0]=r,i[1]=t,i[2]=e,i[3]=n,i}function PA(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r}function LA(r,t,e,n,i){return r[0]=t,r[1]=e,r[2]=n,r[3]=i,r}function IA(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r}function RA(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r}function BA(r){var t=r[0],e=r[1],n=r[2],i=r[3];return Math.hypot(t,e,n,i)}function VA(r){var t=r[0],e=r[1],n=r[2],i=r[3];return t*t+e*e+n*n+i*i}function OA(r,t){var e=t[0],n=t[1],i=t[2],o=t[3],s=e*e+n*n+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),r[0]=e*s,r[1]=n*s,r[2]=i*s,r[3]=o*s,r}function NA(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]}function HA(r,t,e,n){var i=t[0],o=t[1],s=t[2],l=t[3];return r[0]=i+n*(e[0]-i),r[1]=o+n*(e[1]-o),r[2]=s+n*(e[2]-s),r[3]=l+n*(e[3]-l),r}function WA(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]}function UA(r,t){var e=r[0],n=r[1],i=r[2],o=r[3],s=t[0],l=t[1],c=t[2],u=t[3];return Math.abs(e-s)<=wr*Math.max(1,Math.abs(e),Math.abs(s))&&Math.abs(n-l)<=wr*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=wr*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(o-u)<=wr*Math.max(1,Math.abs(o),Math.abs(u))}var yge=function(){var r=Mse();return function(t,e,n,i,o,s){var l,c;for(e||(e=4),n||(n=0),i?c=Math.min(i*e+n,t.length):c=t.length,l=n;l<c;l+=e)r[0]=t[l],r[1]=t[l+1],r[2]=t[l+2],r[3]=t[l+3],o(r,r,s),t[l]=r[0],t[l+1]=r[1],t[l+2]=r[2],t[l+3]=r[3];return t}}();function Tx(){var r=new Dn(4);return Dn!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Cse(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function zA(r,t,e){e=e*.5;var n=Math.sin(e);return r[0]=n*t[0],r[1]=n*t[1],r[2]=n*t[2],r[3]=Math.cos(e),r}function Dse(r,t){var e=Math.acos(t[3])*2,n=Math.sin(e/2);return n>wr?(r[0]=t[0]/n,r[1]=t[1]/n,r[2]=t[2]/n):(r[0]=1,r[1]=0,r[2]=0),e}function Pse(r,t){var e=YA(r,t);return Math.acos(2*e*e-1)}function jA(r,t,e){var n=t[0],i=t[1],o=t[2],s=t[3],l=e[0],c=e[1],u=e[2],p=e[3];return r[0]=n*p+s*l+i*u-o*c,r[1]=i*p+s*c+o*l-n*u,r[2]=o*p+s*u+n*c-i*l,r[3]=s*p-n*l-i*c-o*u,r}function Lse(r,t,e){e*=.5;var n=t[0],i=t[1],o=t[2],s=t[3],l=Math.sin(e),c=Math.cos(e);return r[0]=n*c+s*l,r[1]=i*c+o*l,r[2]=o*c-i*l,r[3]=s*c-n*l,r}function Ise(r,t,e){e*=.5;var n=t[0],i=t[1],o=t[2],s=t[3],l=Math.sin(e),c=Math.cos(e);return r[0]=n*c-o*l,r[1]=i*c+s*l,r[2]=o*c+n*l,r[3]=s*c-i*l,r}function Rse(r,t,e){e*=.5;var n=t[0],i=t[1],o=t[2],s=t[3],l=Math.sin(e),c=Math.cos(e);return r[0]=n*c+i*l,r[1]=i*c-n*l,r[2]=o*c+s*l,r[3]=s*c-o*l,r}function Bse(r,t){var e=t[0],n=t[1],i=t[2];return r[0]=e,r[1]=n,r[2]=i,r[3]=Math.sqrt(Math.abs(1-e*e-n*n-i*i)),r}function GA(r,t){var e=t[0],n=t[1],i=t[2],o=t[3],s=Math.sqrt(e*e+n*n+i*i),l=Math.exp(o),c=s>0?l*Math.sin(s)/s:0;return r[0]=e*c,r[1]=n*c,r[2]=i*c,r[3]=l*Math.cos(s),r}function XA(r,t){var e=t[0],n=t[1],i=t[2],o=t[3],s=Math.sqrt(e*e+n*n+i*i),l=s>0?Math.atan2(s,o)/s:0;return r[0]=e*l,r[1]=n*l,r[2]=i*l,r[3]=.5*Math.log(e*e+n*n+i*i+o*o),r}function Vse(r,t,e){return XA(r,t),KA(r,r,e),GA(r,r),r}function Ad(r,t,e,n){var i=t[0],o=t[1],s=t[2],l=t[3],c=e[0],u=e[1],p=e[2],f=e[3],w,A,m,d,h;return A=i*c+o*u+s*p+l*f,A<0&&(A=-A,c=-c,u=-u,p=-p,f=-f),1-A>wr?(w=Math.acos(A),m=Math.sin(w),d=Math.sin((1-n)*w)/m,h=Math.sin(n*w)/m):(d=1-n,h=n),r[0]=d*i+h*c,r[1]=d*o+h*u,r[2]=d*s+h*p,r[3]=d*l+h*f,r}function Ose(r){var t=Ki(),e=Ki(),n=Ki(),i=Math.sqrt(1-t),o=Math.sqrt(t);return r[0]=i*Math.sin(2*Math.PI*e),r[1]=i*Math.cos(2*Math.PI*e),r[2]=o*Math.sin(2*Math.PI*n),r[3]=o*Math.cos(2*Math.PI*n),r}function Nse(r,t){var e=t[0],n=t[1],i=t[2],o=t[3],s=e*e+n*n+i*i+o*o,l=s?1/s:0;return r[0]=-e*l,r[1]=-n*l,r[2]=-i*l,r[3]=o*l,r}function Hse(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r}function qA(r,t){var e=t[0]+t[4]+t[8],n;if(e>0)n=Math.sqrt(e+1),r[3]=.5*n,n=.5/n,r[0]=(t[5]-t[7])*n,r[1]=(t[6]-t[2])*n,r[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var o=(i+1)%3,s=(i+2)%3;n=Math.sqrt(t[i*3+i]-t[o*3+o]-t[s*3+s]+1),r[i]=.5*n,n=.5/n,r[3]=(t[o*3+s]-t[s*3+o])*n,r[o]=(t[o*3+i]+t[i*3+o])*n,r[s]=(t[s*3+i]+t[i*3+s])*n}return r}function Wse(r,t,e,n){var i=.5*Math.PI/180;t*=i,e*=i,n*=i;var o=Math.sin(t),s=Math.cos(t),l=Math.sin(e),c=Math.cos(e),u=Math.sin(n),p=Math.cos(n);return r[0]=o*c*p-s*l*u,r[1]=s*l*p+o*c*u,r[2]=s*c*u-o*l*p,r[3]=s*c*p+o*l*u,r}function Use(r){return"quat("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}var zse=CA,jse=DA,Gse=PA,Xse=LA,qse=IA,Kse=jA,KA=RA,YA=NA,Yse=HA,JA=BA,Jse=JA,QA=VA,Qse=QA,Ex=OA,$se=WA,Zse=UA,eae=function(){var r=wd(),t=vd(1,0,0),e=vd(0,1,0);return function(n,i,o){var s=Fd(i,o);return s<-.999999?(ru(r,t,i),yx(r)<1e-6&&ru(r,e,i),Sx(r,r),zA(n,r,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(ru(r,i,o),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=1+s,Ex(n,n))}}(),tae=function(){var r=Tx(),t=Tx();return function(e,n,i,o,s,l){return Ad(r,n,s,l),Ad(t,i,o,l),Ad(e,r,t,2*l*(1-l)),e}}(),nae=function(){var r=bA();return function(t,e,n,i){return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-e[0],r[5]=-e[1],r[8]=-e[2],Ex(t,qA(t,r))}}();var At={};pr(At,{add:()=>aae,angle:()=>_ae,ceil:()=>lae,clone:()=>rae,copy:()=>oae,create:()=>$A,cross:()=>vae,dist:()=>Bae,distance:()=>nb,div:()=>Rae,divide:()=>tb,dot:()=>wae,equals:()=>Dae,exactEquals:()=>Cae,floor:()=>cae,forEach:()=>Nae,fromValues:()=>iae,inverse:()=>gae,len:()=>Pae,length:()=>ib,lerp:()=>Fae,max:()=>pae,min:()=>uae,mul:()=>Iae,multiply:()=>eb,negate:()=>fae,normalize:()=>xae,random:()=>Aae,rotate:()=>Eae,round:()=>dae,scale:()=>hae,scaleAndAdd:()=>mae,set:()=>sae,sqrDist:()=>Vae,sqrLen:()=>Oae,squaredDistance:()=>rb,squaredLength:()=>ob,str:()=>kae,sub:()=>Lae,subtract:()=>ZA,transformMat2:()=>bae,transformMat2d:()=>Sae,transformMat3:()=>yae,transformMat4:()=>Tae,zero:()=>Mae});function $A(){var r=new Dn(2);return Dn!=Float32Array&&(r[0]=0,r[1]=0),r}function rae(r){var t=new Dn(2);return t[0]=r[0],t[1]=r[1],t}function iae(r,t){var e=new Dn(2);return e[0]=r,e[1]=t,e}function oae(r,t){return r[0]=t[0],r[1]=t[1],r}function sae(r,t,e){return r[0]=t,r[1]=e,r}function aae(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r}function ZA(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r}function eb(r,t,e){return r[0]=t[0]*e[0],r[1]=t[1]*e[1],r}function tb(r,t,e){return r[0]=t[0]/e[0],r[1]=t[1]/e[1],r}function lae(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r}function cae(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r}function uae(r,t,e){return r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r}function pae(r,t,e){return r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r}function dae(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r}function hae(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r}function mae(r,t,e,n){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r}function nb(r,t){var e=t[0]-r[0],n=t[1]-r[1];return Math.hypot(e,n)}function rb(r,t){var e=t[0]-r[0],n=t[1]-r[1];return e*e+n*n}function ib(r){var t=r[0],e=r[1];return Math.hypot(t,e)}function ob(r){var t=r[0],e=r[1];return t*t+e*e}function fae(r,t){return r[0]=-t[0],r[1]=-t[1],r}function gae(r,t){return r[0]=1/t[0],r[1]=1/t[1],r}function xae(r,t){var e=t[0],n=t[1],i=e*e+n*n;return i>0&&(i=1/Math.sqrt(i)),r[0]=t[0]*i,r[1]=t[1]*i,r}function wae(r,t){return r[0]*t[0]+r[1]*t[1]}function vae(r,t,e){var n=t[0]*e[1]-t[1]*e[0];return r[0]=r[1]=0,r[2]=n,r}function Fae(r,t,e,n){var i=t[0],o=t[1];return r[0]=i+n*(e[0]-i),r[1]=o+n*(e[1]-o),r}function Aae(r,t){t=t||1;var e=Ki()*2*Math.PI;return r[0]=Math.cos(e)*t,r[1]=Math.sin(e)*t,r}function bae(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i,r[1]=e[1]*n+e[3]*i,r}function Sae(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[2]*i+e[4],r[1]=e[1]*n+e[3]*i+e[5],r}function yae(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[3]*i+e[6],r[1]=e[1]*n+e[4]*i+e[7],r}function Tae(r,t,e){var n=t[0],i=t[1];return r[0]=e[0]*n+e[4]*i+e[12],r[1]=e[1]*n+e[5]*i+e[13],r}function Eae(r,t,e,n){var i=t[0]-e[0],o=t[1]-e[1],s=Math.sin(n),l=Math.cos(n);return r[0]=i*l-o*s+e[0],r[1]=i*s+o*l+e[1],r}function _ae(r,t){var e=r[0],n=r[1],i=t[0],o=t[1],s=Math.sqrt(e*e+n*n)*Math.sqrt(i*i+o*o),l=s&&(e*i+n*o)/s;return Math.acos(Math.min(Math.max(l,-1),1))}function Mae(r){return r[0]=0,r[1]=0,r}function kae(r){return"vec2("+r[0]+", "+r[1]+")"}function Cae(r,t){return r[0]===t[0]&&r[1]===t[1]}function Dae(r,t){var e=r[0],n=r[1],i=t[0],o=t[1];return Math.abs(e-i)<=wr*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(n-o)<=wr*Math.max(1,Math.abs(n),Math.abs(o))}var Pae=ib,Lae=ZA,Iae=eb,Rae=tb,Bae=nb,Vae=rb,Oae=ob,Nae=function(){var r=$A();return function(t,e,n,i,o,s){var l,c;for(e||(e=2),n||(n=0),i?c=Math.min(i*e+n,t.length):c=t.length,l=n;l<c;l+=e)r[0]=t[l],r[1]=t[l+1],o(r,r,s),t[l]=r[0],t[l+1]=r[1];return t}}();var xn=Math.PI,bn=.5*xn,Jn=2*xn;var Hae=864e13,_ge=-Hae;function Zo(r){return(r%Jn+Jn)%Jn}function vr(r,t,e){return Math.min(e,Math.max(t,r))}function at(r){return r*Jn/360}function Yt(r){return r*360/Jn}function sb(...r){let t=Number.MAX_VALUE;for(let e of r)Math.abs(e)<t&&(t=e);return t}function iu(r,t,e){let n=e-t;return n===0?0:(r-t)/n}function Wae(r,t,e){return r*(e-t)+t}function $t(r,t=0){return Rt(r)?r.toFixed(t):""}function nn(r){return/\d+/.test(r)?parseFloat(r):null}function bd(r){return Rt(r)?vr(Wae(r,0,100),0,100).toFixed(0):""}function Sd(r){return/\d+/.test(r)?vr(iu(parseInt(r,10),0,100),0,1):null}function ab(r,t,e){return(1-e)*r+e*t}function _x(r){return Math.pow(2,Math.ceil(Math.log2(r)))}function lb(r){return Math.abs(r)>1e-4?r:0}var{ACESFilmicToneMapping:kge,AddEquation:Cge,AddOperation:Dge,AdditiveAnimationBlendMode:Pge,AdditiveBlending:Lge,AlphaFormat:Ige,AlwaysDepth:Rge,AlwaysStencilFunc:Bge,AmbientLight:yd,AmbientLightProbe:Vge,AnimationClip:cb,AnimationLoader:Oge,AnimationMixer:Nge,AnimationObjectGroup:Hge,AnimationUtils:Wge,ArcCurve:Uge,ArrayCamera:zge,ArrowHelper:jge,Audio:Gge,AudioAnalyser:Xge,AudioContext:qge,AudioListener:Kge,AudioLoader:Yge,AxesHelper:Jge,BackSide:ub,BasicDepthPacking:Qge,BasicShadowMap:$ge,Bone:pb,BooleanKeyframeTrack:Zge,Box2:exe,Box3:Ws,Box3Helper:txe,BoxBufferGeometry:nxe,BoxGeometry:Td,BoxHelper:rxe,BufferAttribute:Eo,BufferGeometry:ou,BufferGeometryLoader:ixe,ByteType:oxe,Cache:sxe,Camera:axe,CameraHelper:lxe,CanvasTexture:db,CapsuleBufferGeometry:cxe,CapsuleGeometry:uxe,CatmullRomCurve3:pxe,CineonToneMapping:dxe,CircleBufferGeometry:hxe,CircleGeometry:mxe,ClampToEdgeWrapping:hb,Clock:fxe,Color:Vn,ColorKeyframeTrack:gxe,ColorManagement:Mx,CompressedArrayTexture:xxe,CompressedTexture:wxe,CompressedTextureLoader:vxe,ConeBufferGeometry:Fxe,ConeGeometry:mb,CubeCamera:fb,CubeReflectionMapping:Axe,CubeRefractionMapping:bxe,CubeTexture:gb,CubeTextureLoader:Sxe,CubeUVReflectionMapping:yxe,CubicBezierCurve:Txe,CubicBezierCurve3:Exe,CubicInterpolant:_xe,CullFaceBack:Mxe,CullFaceFront:kxe,CullFaceFrontBack:Cxe,CullFaceNone:Dxe,Curve:Pxe,CurvePath:Lxe,CustomBlending:Ixe,CustomToneMapping:Rxe,CylinderBufferGeometry:Bxe,CylinderGeometry:xb,Cylindrical:Vxe,Data3DTexture:Oxe,DataArrayTexture:Nxe,DataTexture:Hxe,DataTextureLoader:Wxe,DataUtils:Uxe,DecrementStencilOp:zxe,DecrementWrapStencilOp:jxe,DefaultLoadingManager:Gxe,DepthFormat:Xxe,DepthStencilFormat:qxe,DepthTexture:Kxe,DirectionalLight:Ed,DirectionalLightHelper:Yxe,DiscreteInterpolant:Jxe,DisplayP3ColorSpace:Qxe,DodecahedronBufferGeometry:$xe,DodecahedronGeometry:Zxe,DoubleSide:_d,DstAlphaFactor:ewe,DstColorFactor:twe,DynamicCopyUsage:nwe,DynamicDrawUsage:wb,DynamicReadUsage:rwe,EdgesGeometry:iwe,EllipseCurve:owe,EqualDepth:swe,EqualStencilFunc:awe,EquirectangularReflectionMapping:lwe,EquirectangularRefractionMapping:cwe,Euler:Yi,EventDispatcher:uwe,ExtrudeBufferGeometry:pwe,ExtrudeGeometry:vb,FileLoader:kx,Float16BufferAttribute:dwe,Float32BufferAttribute:Md,Float64BufferAttribute:hwe,FloatType:mwe,Fog:fwe,FogExp2:gwe,FramebufferTexture:xwe,FrontSide:Us,Frustum:wwe,GLBufferAttribute:vwe,GLSL1:Fwe,GLSL3:Awe,GreaterDepth:bwe,GreaterEqualDepth:Swe,GreaterEqualStencilFunc:ywe,GreaterStencilFunc:Twe,GridHelper:Fb,Group:Ja,HalfFloatType:Ewe,HemisphereLight:_we,HemisphereLightHelper:Mwe,HemisphereLightProbe:kwe,IcosahedronBufferGeometry:Cwe,IcosahedronGeometry:Dwe,ImageBitmapLoader:Ab,ImageLoader:Pwe,ImageUtils:Lwe,IncrementStencilOp:Iwe,IncrementWrapStencilOp:Rwe,InstancedBufferAttribute:Uae,InstancedBufferGeometry:bb,InstancedInterleavedBuffer:su,InstancedMesh:kd,Int16BufferAttribute:Bwe,Int32BufferAttribute:Vwe,Int8BufferAttribute:Owe,IntType:Nwe,InterleavedBuffer:Cx,InterleavedBufferAttribute:Ci,Interpolant:Sb,InterpolateDiscrete:yb,InterpolateLinear:Dx,InterpolateSmooth:Hwe,InvertStencilOp:Wwe,KeepStencilOp:Uwe,KeyframeTrack:zwe,LOD:jwe,LatheBufferGeometry:Gwe,LatheGeometry:Xwe,Layers:qwe,LessDepth:Kwe,LessEqualDepth:Ywe,LessEqualStencilFunc:Jwe,LessStencilFunc:Qwe,Light:$we,LightProbe:Zwe,Line:Tb,Line3:Eb,LineBasicMaterial:Px,LineCurve:eve,LineCurve3:tve,LineDashedMaterial:nve,LineLoop:_b,LineSegments:Mb,LinearEncoding:kb,LinearFilter:Lx,LinearInterpolant:rve,LinearMipMapLinearFilter:ive,LinearMipMapNearestFilter:ove,LinearMipmapLinearFilter:Ix,LinearMipmapNearestFilter:Cb,LinearSRGBColorSpace:sve,LinearToneMapping:ave,Loader:Db,LoaderUtils:Cd,LoadingManager:lve,LoopOnce:cve,LoopPingPong:uve,LoopRepeat:pve,LuminanceAlphaFormat:dve,LuminanceFormat:hve,MOUSE:mve,Material:Dd,MaterialLoader:fve,MathUtils:Pd,Matrix3:gve,Matrix4:Vt,MaxEquation:xve,Mesh:kr,MeshBasicMaterial:ir,MeshDepthMaterial:wve,MeshDistanceMaterial:vve,MeshLambertMaterial:Fve,MeshMatcapMaterial:Ave,MeshNormalMaterial:bve,MeshPhongMaterial:zs,MeshPhysicalMaterial:es,MeshStandardMaterial:Rx,MeshToonMaterial:Sve,MinEquation:yve,MirroredRepeatWrapping:Pb,MixOperation:Tve,MultiplyBlending:Eve,MultiplyOperation:_ve,NearestFilter:Lb,NearestMipMapLinearFilter:Mve,NearestMipMapNearestFilter:kve,NearestMipmapLinearFilter:Ib,NearestMipmapNearestFilter:Rb,NeverDepth:Cve,NeverStencilFunc:Dve,NoBlending:Pve,NoColorSpace:Lve,NoToneMapping:Ive,NormalAnimationBlendMode:Rve,NormalBlending:Bve,NotEqualDepth:Vve,NotEqualStencilFunc:Ove,NumberKeyframeTrack:Bb,Object3D:Et,ObjectLoader:Nve,ObjectSpaceNormalMap:Hve,OctahedronBufferGeometry:Wve,OctahedronGeometry:Uve,OneFactor:zve,OneMinusDstAlphaFactor:jve,OneMinusDstColorFactor:Gve,OneMinusSrcAlphaFactor:Xve,OneMinusSrcColorFactor:qve,OrthographicCamera:Vb,PCFShadowMap:Kve,PCFSoftShadowMap:Yve,PMREMGenerator:Jve,Path:Qve,PerspectiveCamera:js,Plane:$ve,PlaneBufferGeometry:Zve,PlaneGeometry:Qa,PlaneHelper:e1e,PointLight:Ob,PointLightHelper:t1e,Points:Nb,PointsMaterial:Hb,PolarGridHelper:n1e,PolyhedronBufferGeometry:r1e,PolyhedronGeometry:i1e,PositionalAudio:o1e,PropertyBinding:Wb,PropertyMixer:s1e,QuadraticBezierCurve:a1e,QuadraticBezierCurve3:l1e,Quaternion:xt,QuaternionKeyframeTrack:Bx,QuaternionLinearInterpolant:c1e,RED_GREEN_RGTC2_Format:u1e,RED_RGTC1_Format:p1e,REVISION:d1e,RGBADepthPacking:h1e,RGBAFormat:m1e,RGBAIntegerFormat:f1e,RGBA_ASTC_10x10_Format:g1e,RGBA_ASTC_10x5_Format:x1e,RGBA_ASTC_10x6_Format:w1e,RGBA_ASTC_10x8_Format:v1e,RGBA_ASTC_12x10_Format:F1e,RGBA_ASTC_12x12_Format:A1e,RGBA_ASTC_4x4_Format:b1e,RGBA_ASTC_5x4_Format:S1e,RGBA_ASTC_5x5_Format:y1e,RGBA_ASTC_6x5_Format:T1e,RGBA_ASTC_6x6_Format:E1e,RGBA_ASTC_8x5_Format:_1e,RGBA_ASTC_8x6_Format:M1e,RGBA_ASTC_8x8_Format:k1e,RGBA_BPTC_Format:C1e,RGBA_ETC2_EAC_Format:D1e,RGBA_PVRTC_2BPPV1_Format:P1e,RGBA_PVRTC_4BPPV1_Format:L1e,RGBA_S3TC_DXT1_Format:I1e,RGBA_S3TC_DXT3_Format:R1e,RGBA_S3TC_DXT5_Format:B1e,RGB_ETC1_Format:V1e,RGB_ETC2_Format:O1e,RGB_PVRTC_2BPPV1_Format:N1e,RGB_PVRTC_4BPPV1_Format:H1e,RGB_S3TC_DXT1_Format:W1e,RGFormat:U1e,RGIntegerFormat:z1e,RawShaderMaterial:j1e,Ray:G1e,Raycaster:Ub,RectAreaLight:X1e,RedFormat:q1e,RedIntegerFormat:K1e,ReinhardToneMapping:Y1e,RepeatWrapping:Ld,ReplaceStencilOp:J1e,ReverseSubtractEquation:Q1e,RingBufferGeometry:$1e,RingGeometry:Z1e,SIGNED_RED_GREEN_RGTC2_Format:e0e,SIGNED_RED_RGTC1_Format:t0e,SRGBColorSpace:$a,Scene:Za,ShaderChunk:n0e,ShaderLib:au,ShaderMaterial:zb,ShadowMaterial:r0e,Shape:jb,ShapeBufferGeometry:i0e,ShapeGeometry:o0e,ShapePath:s0e,ShapeUtils:a0e,ShortType:l0e,Skeleton:Gb,SkeletonHelper:c0e,SkinnedMesh:Xb,Source:u0e,Sphere:el,SphereBufferGeometry:p0e,SphereGeometry:tl,Spherical:d0e,SphericalHarmonics3:h0e,SplineCurve:m0e,SpotLight:qb,SpotLightHelper:f0e,Sprite:g0e,SpriteMaterial:zae,SrcAlphaFactor:x0e,SrcAlphaSaturateFactor:w0e,SrcColorFactor:v0e,StaticCopyUsage:F0e,StaticDrawUsage:A0e,StaticReadUsage:b0e,StereoCamera:S0e,StreamCopyUsage:y0e,StreamDrawUsage:T0e,StreamReadUsage:E0e,StringKeyframeTrack:_0e,SubtractEquation:M0e,SubtractiveBlending:k0e,TOUCH:C0e,TangentSpaceNormalMap:D0e,TetrahedronBufferGeometry:P0e,TetrahedronGeometry:L0e,Texture:Gs,TextureLoader:Kb,TorusBufferGeometry:I0e,TorusGeometry:R0e,TorusKnotBufferGeometry:B0e,TorusKnotGeometry:V0e,Triangle:O0e,TriangleFanDrawMode:lu,TriangleStripDrawMode:Id,TrianglesDrawMode:Yb,TubeBufferGeometry:N0e,TubeGeometry:H0e,TwoPassDoubleSide:W0e,UVMapping:U0e,Uint16BufferAttribute:z0e,Uint32BufferAttribute:j0e,Uint8BufferAttribute:G0e,Uint8ClampedBufferAttribute:X0e,Uniform:q0e,UniformsGroup:K0e,UniformsLib:cu,UniformsUtils:Vx,UnsignedByteType:Y0e,UnsignedInt248Type:J0e,UnsignedIntType:Q0e,UnsignedShort4444Type:$0e,UnsignedShort5551Type:Z0e,UnsignedShortType:eFe,VSMShadowMap:tFe,Vector2:Sn,Vector3:Ie,Vector4:Ji,VectorKeyframeTrack:Jb,VideoTexture:Qb,WebGL1Renderer:nFe,WebGL3DRenderTarget:rFe,WebGLArrayRenderTarget:iFe,WebGLCubeRenderTarget:$b,WebGLMultipleRenderTargets:oFe,WebGLRenderTarget:sFe,WebGLRenderer:Rd,WebGLUtils:aFe,WireframeGeometry:Zb,WrapAroundEnding:lFe,ZeroCurvatureEnding:cFe,ZeroFactor:uFe,ZeroSlopeEnding:pFe,ZeroStencilOp:dFe,_SRGBAFormat:hFe,sRGBEncoding:eS}=THREE;var Bd=new mb(1,1,10,5);Bd.name="ConeGeom";Bd.computeBoundingBox();Bd.computeBoundingSphere();var Ox=class extends kr{constructor(t,e,n,i){super(Bd,i),this.scale.set(t,e,n)}};function Nx(r,t,e,n,i){let o=new Ox(t,e,n,i);return o.name=r,o}function Vd(r){let t=r.attributes.position,e=r.attributes.normal,n=r.attributes.uv;for(let i=0;i<e.count;++i){let o=i*e.itemSize,s=i*e.itemSize+1,l=i*e.itemSize+2,c=e.array[o],u=e.array[s],p=e.array[l],f=Math.abs(c),w=Math.abs(u),A=Math.abs(p),m=t.array[o],d=t.array[s],h=t.array[l],M=Math.abs(m),k=Math.abs(d),E=Math.abs(h),b=i*n.itemSize,g=i*n.itemSize+1,v=n.array[b],y=n.array[g],V=0,B=f,D=M;w>B&&(V=1,B=w,D=k),A>B&&(V=2,B=A,D=E),V===0?m<0?(v=-h,y=d):(v=h,y=d):V===1?d<0?(v=m,y=-h):(v=m,y=h):h<0?(v=m,y=d):(v=-m,y=d),v=(v/D+1)/8,y=(y/D+1)/6,V===0?m<0?(v+=0,y+=1/3):(v+=.5,y+=1/3):V===1?d<0?(v+=.25,y+=0):(v+=.25,y+=2/3):h<0?(v+=.25,y+=1/3):(v+=.75,y+=1/3);let L=n.array;L[b]=v,L[g]=y}}var uu=new Td(1,1,1,1,1,1);uu.name="CubeGeom";uu.computeBoundingBox();uu.computeBoundingSphere();var tS=uu.clone();tS.name="InvertedCubeGeom";Vd(tS);var Nr=class extends kr{constructor(t,e,n,i){super(uu,i),this.scale.set(t,e,n)}};function pu(r,t,e,n,i){let o=new Nr(t,e,n,i);return o.name=r,o}function or(r){return T(r)&&r.isMesh}function Hx(r){return T(r)&&r.isMaterial}function Od(r,t){return Hx(t)&&t.type===r}function nS(r){return Od("MeshBasicMaterial",r)}function du(r){return Od("MeshStandardMaterial",r)}function hu(r){return Od("MeshPhongMaterial",r)}function mu(r){return Od("MeshPhysicalMaterial",r)}function Wx(r){return T(r)&&r.isObject3D}function rS(r){return T(r)&&r.isQuaternion}function iS(r){return T(r)&&r.isEuler}function Xs(r){return T(r)&&Wx(r.object)}function oS(r){return Xs(r)||Wx(r)}function Gn(r){return Xs(r)?r.object:r}function wn(r,t){return r=Gn(r),r.visible=t,t}function nl(r){return r=Gn(r),r.visible}function Nd(r){if(!r)return!1;for(r=Gn(r);r;){if(!r.visible)return!1;r=r.parent}return!0}function je(r,...t){let e=t.filter(T).map(Gn);return e.length>0&&Gn(r).add(...e),r}function sS(r){r=Gn(r),T(r)&&r.removeFromParent()}function Dt(r,...t){let e=new Et;return e.name=r,je(e,...t),e}function Hd(r,t){r=Gn(r),Jo(r)&&(r.disabled=!t)}function aS(r,t){r=Gn(r);let e=r.parent;r.removeFromParent(),r.position.copy(t),T(e)&&e.attach(r)}function Di(r,t,e){let n=new kr(t,e);return n.name=r,n}var Wd="Juniper:ThreeJS:EventSystem:RayTarget",sr=class extends qe{constructor(e){super();this.object=e;this.meshes=new Array;this._disabled=!1;this._clickable=!1;this._draggable=!1;this._navigable=!1;this.object.userData[Wd]=this}addMesh(e){return e.userData[Wd]=this,this.meshes.push(e),this}removeMesh(e){return Wt(this.meshes,e)&&delete e.userData[Wd],this}addMeshes(...e){for(let n of e)this.addMesh(n);return this}removeMeshes(...e){for(let n of e)this.removeMesh(n);return this}get disabled(){return this._disabled}set disabled(e){this._disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get clickable(){return this._clickable}set clickable(e){this._clickable=e}get draggable(){return this._draggable}set draggable(e){this._draggable=e}get navigable(){return this._navigable}set navigable(e){this._navigable=e}};function jae(r){return r instanceof sr}function ts(r){let t=null;return r&&(jae(r)?t=r:(r=Gn(r),r&&(t=r.userData[Wd])),t&&!Nd(t)&&(t=null)),t}cu.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Sn(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};au.line={uniforms:Vx.merge([cu.common,cu.fog,cu.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var _o=class extends zb{constructor(t){super({type:"LineMaterial",uniforms:Vx.clone(au.line.uniforms),vertexShader:au.line.vertexShader,fragmentShader:au.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(e){!!e!="USE_DASH"in this.defines&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(e){!!e!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(t)}};_o.prototype.isLineMaterial=!0;var Ux=_r("Juniper:Three:Materials",()=>new Map);function Gae(r,t){t in r&&delete r[t]}function fu(r,t,e){let n=`${r}_${Object.keys(e).map(i=>`${i}:${e[i]}`).join(",")}`;return Ux.has(n)||(Gae(e,"name"),Ux.set(n,new t(e))),Ux.get(n)}function lS(r){return Object.assign(r,{transparent:!0})}function zx(r){return fu("solid",ir,r)}function rl(r){return fu("solidTransparent",ir,lS(r))}function jx(r){return fu("lit",zs,r)}function Ud(r){return fu("litTransparent",zs,lS(r))}function cS(r){return fu("line2",_o,r)}function qs(r,t){let e=new Set;r.traverse(n=>{if(or(n)&&Hx(n.material)){let i=n.material,o=t(i);i!==o&&(e.add(i),n.material=o)}});for(let n of e)$o(n)}function uS(r){if(r.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let t={alphaMap:r.alphaMap,alphaTest:r.alphaTest,alphaToCoverage:r.alphaToCoverage,aoMap:r.aoMap,aoMapIntensity:r.aoMapIntensity,blendDst:r.blendDst,blendDstAlpha:r.blendDstAlpha,blendEquation:r.blendEquation,blendEquationAlpha:r.blendEquationAlpha,blending:r.blending,blendSrc:r.blendSrc,blendSrcAlpha:r.blendSrcAlpha,clipIntersection:r.clipIntersection,clippingPlanes:r.clippingPlanes,clipShadows:r.clipShadows,color:r.color,colorWrite:r.colorWrite,depthFunc:r.depthFunc,depthTest:r.depthTest,depthWrite:r.depthWrite,dithering:r.dithering,envMap:r.envMap,fog:r.fog,lightMap:r.lightMap,lightMapIntensity:r.lightMapIntensity,map:r.emissiveMap||r.map,name:r.name+"-Standard-To-Basic",opacity:r.opacity,polygonOffset:r.polygonOffset,polygonOffsetFactor:r.polygonOffsetFactor,polygonOffsetUnits:r.polygonOffsetUnits,precision:r.precision,premultipliedAlpha:r.premultipliedAlpha,shadowSide:r.shadowSide,side:r.side,stencilFail:r.stencilFail,stencilFunc:r.stencilFunc,stencilFuncMask:r.stencilFuncMask,stencilRef:r.stencilRef,stencilWrite:r.stencilWrite,stencilWriteMask:r.stencilWriteMask,stencilZFail:r.stencilZFail,stencilZPass:r.stencilZPass,toneMapped:r.toneMapped,transparent:r.transparent,userData:r.userData,vertexColors:r.vertexColors,visible:r.visible,wireframe:r.wireframe,wireframeLinecap:r.wireframeLinecap,wireframeLinejoin:r.wireframeLinejoin,wireframeLinewidth:r.wireframeLinewidth};for(let[e,n]of Object.entries(t))fe(n)&&delete t[e];return new ir(t)}function Ks(r){if(r.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let t={alphaMap:r.alphaMap,alphaTest:r.alphaTest,alphaToCoverage:r.alphaToCoverage,aoMap:r.aoMap,aoMapIntensity:r.aoMapIntensity,blendDst:r.blendDst,blendDstAlpha:r.blendDstAlpha,blendEquation:r.blendEquation,blendEquationAlpha:r.blendEquationAlpha,blending:r.blending,blendSrc:r.blendSrc,blendSrcAlpha:r.blendSrcAlpha,bumpMap:r.bumpMap,bumpScale:r.bumpScale,clipIntersection:r.clipIntersection,clippingPlanes:r.clippingPlanes,clipShadows:r.clipShadows,color:r.color,colorWrite:r.colorWrite,depthFunc:r.depthFunc,depthTest:r.depthTest,depthWrite:r.depthWrite,displacementBias:r.displacementBias,displacementMap:r.displacementMap,displacementScale:r.displacementScale,dithering:r.dithering,emissive:r.emissive,emissiveIntensity:r.emissiveIntensity,emissiveMap:r.emissiveMap,envMap:r.envMap,flatShading:r.flatShading,fog:r.fog,lightMap:r.lightMap,lightMapIntensity:r.lightMapIntensity,map:r.map,name:r.name+"-Standard-To-Phong",normalMap:r.normalMap,normalMapType:r.normalMapType,normalScale:r.normalScale,opacity:r.opacity,polygonOffset:r.polygonOffset,polygonOffsetFactor:r.polygonOffsetFactor,polygonOffsetUnits:r.polygonOffsetUnits,precision:r.precision,premultipliedAlpha:r.premultipliedAlpha,shadowSide:r.shadowSide,side:r.side,stencilFail:r.stencilFail,stencilFunc:r.stencilFunc,stencilFuncMask:r.stencilFuncMask,stencilRef:r.stencilRef,stencilWrite:r.stencilWrite,stencilWriteMask:r.stencilWriteMask,stencilZFail:r.stencilZFail,stencilZPass:r.stencilZPass,toneMapped:r.toneMapped,transparent:r.transparent,userData:r.userData,vertexColors:r.vertexColors,visible:r.visible,wireframe:r.wireframe,wireframeLinecap:r.wireframeLinecap,wireframeLinejoin:r.wireframeLinejoin,wireframeLinewidth:r.wireframeLinewidth};for(let[e,n]of Object.entries(t))fe(n)&&delete t[e];return new zs(t)}function pS(r){if(r.type!=="MeshPhysicalMaterial")throw new Error("Input material is not MeshPhysicalMaterial");let t={alphaMap:r.alphaMap,alphaTest:r.alphaTest,alphaToCoverage:r.alphaToCoverage,aoMap:r.aoMap,aoMapIntensity:r.aoMapIntensity,blendDst:r.blendDst,blendDstAlpha:r.blendDstAlpha,blendEquation:r.blendEquation,blendEquationAlpha:r.blendEquationAlpha,blending:r.blending,blendSrc:r.blendSrc,blendSrcAlpha:r.blendSrcAlpha,bumpMap:r.bumpMap,bumpScale:r.bumpScale,clipIntersection:r.clipIntersection,clippingPlanes:r.clippingPlanes,clipShadows:r.clipShadows,color:r.color,colorWrite:r.colorWrite,depthFunc:r.depthFunc,depthTest:r.depthTest,depthWrite:r.depthWrite,displacementBias:r.displacementBias,displacementMap:r.displacementMap,displacementScale:r.displacementScale,dithering:r.dithering,emissive:r.emissive,emissiveIntensity:r.emissiveIntensity,emissiveMap:r.emissiveMap,envMap:r.envMap,flatShading:r.flatShading,fog:r.fog,lightMap:r.lightMap,lightMapIntensity:r.lightMapIntensity,map:r.map,name:r.name+"-Standard-To-Phong",normalMap:r.normalMap,normalMapType:r.normalMapType,normalScale:r.normalScale,opacity:r.opacity,polygonOffset:r.polygonOffset,polygonOffsetFactor:r.polygonOffsetFactor,polygonOffsetUnits:r.polygonOffsetUnits,precision:r.precision,premultipliedAlpha:r.premultipliedAlpha,reflectivity:r.reflectivity,shadowSide:r.shadowSide,shininess:r.sheen,side:r.side,specular:r.specularColor,specularMap:r.specularColorMap,stencilFail:r.stencilFail,stencilFunc:r.stencilFunc,stencilFuncMask:r.stencilFuncMask,stencilRef:r.stencilRef,stencilWrite:r.stencilWrite,stencilWriteMask:r.stencilWriteMask,stencilZFail:r.stencilZFail,stencilZPass:r.stencilZPass,toneMapped:r.toneMapped,transparent:r.transparent,userData:r.userData,vertexColors:r.vertexColors,visible:r.visible,wireframe:r.wireframe,wireframeLinecap:r.wireframeLinecap,wireframeLinejoin:r.wireframeLinejoin,wireframeLinewidth:r.wireframeLinewidth};for(let[e,n]of Object.entries(t))fe(n)&&delete t[e];return new zs(t)}var dS=255,Gx=65280;var hS=16711680;var Xae=12632256,zd=16777215;var jd=zx({color:zd});var Xx=jx({color:Xae}),mS=jx({color:zd});var gu=new tl(.5);gu.name="SphereGeom";gu.computeBoundingBox();gu.computeBoundingSphere();var fS=gu.clone();fS.name="InvertedSphereGeom";Vd(fS);var qx=class extends kr{constructor(t,e){super(gu,e),this.scale.setScalar(.5*t)}};function Kx(r,t,e){let n=new qx(t,e);return n.name=r,n}var qae=["View Rotate","View Move","Resize","Orbit","Object Rotate","Object Move","Global Rotate","Global Move"],xu=["x","y","z"],Ys=.1,Kae=new Map([[1,new xt().setFromEuler(new Yi(0,-bn,0))],[-1,new xt().setFromEuler(new Yi(0,bn,0))]]),Xd=class extends qe{constructor(e){super();this.env=e;this.buttons=new Map;this.movingEvt=new Ae("moving");this.movedEvt=new Ae("moved");this.dragging=!1;this.rotationAxisWorld=new Ie;this.startWorld=new Ie;this.endWorld=new Ie;this.startLocal=new Ie;this.endLocal=new Ie;this.lookDirectionWorld=new Ie;this.deltaPosition=new Ie;this.deltaQuaternion=new xt;this.motionAxisWorld=new Ie;this.testObj=new Et;this._mode=null;this._target=null;this.modes=new Array;this.prioritizeTransformerSort=(e,n)=>{let i=ts(e),o=ts(n),s=T(i)&&this.translators.indexOf(i)>=0,l=T(o)&&this.translators.indexOf(o)>=0;return s===l?e.distance-n.distance:s?-1:1};this.object=Dt("Translator",...this.translators=[this.setTranslator("x","x",hS),this.setTranslator("y","y",Gx),this.setTranslator("z","x",dS)]),wn(this,!1),e.timer.addTickHandler(()=>this.refresh()),this.modeButtons=qae.map(n=>{let i=Ma(n,pt(()=>this.mode=i.classList.contains("btn-secondary")?n:"None"));return this.buttons.set(n,i),st(i,!1),i})}get target(){return this._target}setTarget(e,n){if(e=Gn(e),e!==this.target){this._target=e;let i=T(this.target);wn(this,i),this.refresh()}if(T(e)&&T(n)){Un(this.modes,...n);for(let[i,o]of this.buttons)st(o,this.modes.indexOf(i)!==-1);this.modes.indexOf(this.mode)===-1&&(this.mode="None")}}get mode(){return this._mode}set mode(e){if(e!==this.mode){this._mode=e,this.mode==="None"?this.env.eventSys.sortFunction=null:this.env.eventSys.sortFunction=this.prioritizeTransformerSort;for(let n of this.translators)n.mode=e;this.translators[2].object.visible=this.mode!=="None"&&this.mode!=="Resize";for(let[n,i]of this.buttons)jn(i,n===this.mode,"btn-primary"),jn(i,n!==this.mode,"btn-secondary");this.refresh()}}setTranslator(e,n,i){let o=new Gd(e,n,i);return o.addEventListener("down",s=>{s.pointer.isPressed(0)&&(this.dragging=!0,this.startWorld.copy(s.point),this.mode!=="Object Move"&&this.mode!=="Global Move"&&this.mode!=="View Move"&&this.mode!=="Orbit"&&(this.env.avatar.lockMovement=!0),T(s.hit)?o.selected=s.hit.object:o.selected=null)}),o.addEventListener("move",s=>{if(this.dragging&&s.point){if(this.endWorld.copy(s.point),this.startWorld.manhattanDistanceTo(this.endWorld)>0){if(this.object.worldToLocal(this.startLocal.copy(this.startWorld)),this.object.worldToLocal(this.endLocal.copy(this.endWorld)),this.mode==="Resize"){let l=this.startLocal.length(),c=this.endLocal.length();this.target.scale.addScalar(c-l)}else if(this.mode==="Object Rotate"||this.mode==="Global Rotate"||this.mode==="View Rotate"){this.startLocal.normalize(),this.endLocal.normalize();let l=this.startLocal.dot(this.endLocal);if(-1<=l&&l<=1){let c=this.startLocal.cross(this.endLocal).dot(o.rotationAxisLocal),u=Math.sign(c)*Math.acos(l);this.rotationAxisWorld.copy(o.rotationAxisLocal).applyQuaternion(this.object.quaternion),this.deltaQuaternion.setFromAxisAngle(this.rotationAxisWorld,u),this.target.quaternion.premultiply(this.deltaQuaternion)}}else{this.motionAxisWorld.copy(o.motionAxisLocal).applyQuaternion(this.object.quaternion),this.lookDirectionWorld.copy(this.env.avatar.worldPos).sub(this.object.position).normalize(),this.deltaPosition.copy(this.endWorld).sub(this.startWorld);let l=this.lookDirectionWorld.dot(this.motionAxisWorld);if(Math.abs(l)>.7){let u=Math.abs(l)<.98&&Math.sign(this.lookDirectionWorld.cross(this.motionAxisWorld).y)||1;this.deltaPosition.applyQuaternion(Kae.get(Math.sign(l)*u))}let c=this.size*this.deltaPosition.dot(this.motionAxisWorld);this.deltaPosition.copy(this.motionAxisWorld).multiplyScalar(c),this.mode==="Orbit"?(this.target.parent.add(this.testObj),this.testObj.position.copy(this.target.position),this.testObj.lookAt(this.env.avatar.worldPos),this.testObj.attach(this.target),this.testObj.position.add(this.deltaPosition),this.testObj.lookAt(this.env.avatar.worldPos),this.testObj.parent.attach(this.target),this.testObj.removeFromParent()):this.target.position.add(this.deltaPosition)}this.refresh(),this.dispatchEvent(this.movingEvt)}this.startWorld.copy(this.endWorld)}}),o.addEventListener("up",s=>{s.pointer.isPressed(0)||(this.dragging=!1,this.mode!=="Object Move"&&this.mode!=="Global Move"&&this.mode!=="View Move"&&this.mode!=="Orbit"&&(this.env.avatar.lockMovement=!1),o.selected=null,this.dispatchEvent(this.movedEvt))}),o}get size(){return this.object.scale.x}set size(e){this.object.scale.setScalar(e)}refresh(){if(this.target){this.target.getWorldPosition(this.object.position);let e=this.object.position.distanceTo(this.env.avatar.worldPos);this.size=.5*e,this.mode==="Object Move"||this.mode==="Object Rotate"?this.target.getWorldQuaternion(this.object.quaternion):this.mode==="Global Rotate"||this.mode==="Global Move"?this.object.quaternion.identity():this.object.lookAt(this.env.avatar.worldPos);for(let n of this.translators)n.refresh(this.object.position,this.env.avatar.worldPos)}}},gS=new Array,xS=new Array;for(let r=5;r<=85;r+=5){let t=at(r);gS.push(new Sn(.5*Math.cos(t),.5*Math.sin(t))),xS.unshift(new Sn(.48*Math.cos(t),.48*Math.sin(t)))}var Yae=[...gS,...xS],Jae=new jb(Yae),il=new vb(Jae,{steps:1,depth:.02,bevelEnabled:!1});il.computeBoundingBox();il.computeBoundingSphere();var Yx=class extends sr{constructor(e,n,i){let o=xu.indexOf(e),s=(o+2)%xu.length,l=xu[s],c=xu.length-o-1,u=xu[c],p=Ud({color:i,depthTest:!1,opacity:.75}),f=Ud({color:i,depthTest:!1,opacity:.25}),w=Ud({color:i,depthTest:!1,opacity:1}),A=[pu(`Bar_${e}1`,1,1,1,p),pu(`Bar_${e}1`,1,1,1,p)],m=[Kx(`ScalePad_${e}1`,1,p),Kx(`ScalePad_${e}2`,1,p)],d=[Nx(`TranslatePad_${e}1`,1,1,1,p),Nx(`TranslatePad_${e}2`,1,1,1,p)],h=[Di(`RotatePad_${e}1`,il,p),Di(`RotatePad_${e}2`,il,p),Di(`RotatePad_${e}3`,il,p),Di(`RotatePad_${e}4`,il,p)];super(Dt(`Transformer_${e}`,...A,...m,...d,...h));this.worldPos=new Ie;this.worldQuat=new xt;this.center=new Ie;this.interactionAxisLocal=new Ie;this.motionAxisLocal=new Ie;this.rotationAxisLocal=new Ie;this._mode=null;this.selected=null;this.delta=new Ie;for(let g of this.object.children)or(g)&&(g.renderOrder=Number.MAX_SAFE_INTEGER);this.bars=A,this.spherePads=m,this.conePads=d,this.arcPads=h,this.interactionAxisLocal[n]=1,this.motionAxisLocal[e]=1,this.rotationAxisLocal[l]=1,this.materialFront=p,this.materialBack=f,this.materialSelected=w,this.enabled=!0,this.draggable=!0;for(let g=0;g<this.spherePads.length;++g){let v=2*g-1;this.spherePads[g].scale.setScalar(Ys*.4),this.spherePads[g].position.copy(this.motionAxisLocal).multiplyScalar(v*Ys*1.5)}let M=new Ie;for(let g=0;g<this.conePads.length;++g){let v=2*g-1;M.copy(this.conePads[g].up).multiplyScalar(v),this.conePads[g].quaternion.setFromUnitVectors(M,this.motionAxisLocal),this.conePads[g].position.copy(this.motionAxisLocal).multiplyScalar(v*Ys*1.5),this.conePads[g].scale.set(.2,.4,.2).multiplyScalar(Ys)}for(let g=0;g<this.bars.length;++g){let v=2*g-1;this.bars[g].scale.copy(this.motionAxisLocal).multiplyScalar(1.2).add(Yx.small).multiplyScalar(Ys),this.bars[g].position.copy(this.motionAxisLocal).multiplyScalar(v*Ys*.7)}let k=new xt,E=new Ie(0,0,-1),b=new Ie;b[u]=1;for(let g=0;g<this.arcPads.length;++g){let v=g*Math.PI/2;k.setFromAxisAngle(E,v),this.arcPads[g].quaternion.setFromAxisAngle(b,Math.PI/2).multiply(k),this.arcPads[g].scale.setScalar(Ys*4)}this.addMeshes(...this.bars,...this.spherePads,...this.conePads,...this.arcPads)}get mode(){return this._mode}set mode(e){if(e!==this.mode){this._mode=e;let n=this.mode==="Object Rotate"||this.mode==="Global Rotate"||this.mode==="View Rotate",i=this.mode!=="None"&&!n;for(let o of this.arcPads)o.visible=n;for(let o of this.bars)o.visible=i;for(let o of this.spherePads)o.visible=this.mode==="Resize";for(let o of this.conePads)o.visible=this.mode!=="Resize"&&i;for(let o of this.meshes)o.visible!==T(o.parent)&&(o.visible?this.object.add(o):o.removeFromParent())}}refresh(e,n){this.delta.subVectors(n,e),this.checkMeshes(e,this.bars),this.checkMeshes(e,this.spherePads),this.checkMeshes(e,this.conePads),this.checkMeshes(e,this.arcPads)}checkMeshes(e,n){for(let i of n)if(i===this.selected)i.material=this.materialSelected;else{i.getWorldPosition(this.worldPos),i.getWorldQuaternion(this.worldQuat),i.geometry.boundingBox.getCenter(this.center),this.center.add(i.position),i.localToWorld(this.center),this.center.sub(e);let o=this.center.dot(this.delta);i.material=o<0?this.materialBack:this.materialFront}}},Gd=Yx;Gd.small=new Ie(.1,.1,.1);var wS=["change","click","contextmenu","dblclick","mouseup","pointerup","reset","submit","touchend"];function Qi(r,t=!1){let e=async n=>{if(n.isTrusted){if(!t)for(let i of wS)window.removeEventListener(i,e);r()}};for(let n of wS)window.addEventListener(n,e)}function ol(...r){let t=[];for(let e of r)T(e)&&e.length>0&&t.indexOf(e)===-1&&t.push(e);return t.join("-")}function wu(r){return T(r)&&"_resolveInput"in r}function vu(r){return wu(r)&&"_resolveOutput"in r}var sl=class extends qe{constructor(e,n){super();this.nodeType=e;this.context=n;this._name=null;this.disposed=!1}get name(){return this._name}set name(e){this._name=e,this.context._name(this,e)}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){}isConnected(e,n,i){return this.context._isConnected(this,e,n,i)}resolveOutput(e){let n={source:this,output:e};for(;vu(n.source);)n=n.source._resolveOutput(n.output);return n}resolveInput(e){let n={destination:this,input:e};for(;wu(n.destination);)n=n.destination._resolveInput(n.input);return n}toggle(e,n,i){this._toggle(e,n,i)}_toggle(e,n,i){if(this.isConnected(e,n,i))this._disconnect(e,n,i);else return this._connect(e,n,i)}connect(e,n,i){return this._connect(e,n,i)}_connect(e,n,i){return this.context._connect(this,e,n,i)}disconnect(e,n,i){this._disconnect(e,n,i)}_disconnect(e,n,i){this.context._disconnect(this,e,n,i)}};var ar=class extends sl{constructor(e,n,i,o,s){super(e,n);i=i||[],s=s||[];let l=o||i;this.inputs=i;let c=i.filter(vu).map(u=>u);this.outputs=l.filter(vu).map(u=>u),this.allNodes=Array.from(new Set([...c,...this.outputs,...s]))}get exemplar(){return this.allNodes[0]}add(e){this.allNodes.push(e),this.context._parent(this,e)}remove(e){Wt(this.allNodes,e),this.context._unparent(this,e)}onDisposing(){this.allNodes.forEach(zt),super.onDisposing()}get channelCount(){return this.exemplar.channelCount}set channelCount(e){this.allNodes.forEach(n=>n.channelCount=e)}get channelCountMode(){return this.exemplar.channelCountMode}set channelCountMode(e){this.allNodes.forEach(n=>n.channelCountMode=e)}get channelInterpretation(){return this.exemplar.channelInterpretation}set channelInterpretation(e){this.allNodes.forEach(n=>n.channelInterpretation=e)}get numberOfInputs(){return this.inputs.length}get numberOfOutputs(){return this.outputs.length}static resolve(e,n){return n=n||0,n<0||e.length<=n?null:e[n]}_resolveInput(e){return{destination:ar.resolve(this.inputs,e)}}_resolveOutput(e){return{source:ar.resolve(this.outputs,e)}}};function Qae(r){return r[0]}function $ae(r){return r.shift()}function Zae(r){return r[r.length-1]}function ele(r){return r.pop()}var al=class{constructor(t){this.value=t;this._forward=new Array;this._reverse=new Array}connectSorted(t,e){T(e)?(ri(this._forward,t,n=>e(n.value)),ri(t._reverse,this,n=>e(n.value))):this.connectTo(t)}connectTo(t){this.connectAt(t,this._forward.length)}connectAt(t,e){Xo(this._forward,t,e),t._reverse.push(this)}disconnectFrom(t){Wt(this._forward,t),Wt(t._reverse,this)}isConnectedTo(t){return this._forward.indexOf(t)>=0||this._reverse.indexOf(t)>=0}flatten(){let t=new Set,e=[this];for(;e.length>0;){let n=e.shift();T(n)&&!t.has(n)&&(t.add(n),e.push(...n._forward))}return Array.from(t)}*traverse(t){let e=new Set,n=[this],i=t?Qae:Zae,o=t?$ae:ele;for(;n.length>0;){let s=i(n);e.has(s)?t||(o(n),yield s):(e.add(s),t&&(o(n),yield s),s._forward.length>0&&n.push(...s._forward))}}breadthFirst(){return this.traverse(!0)}depthFirst(){return this.traverse(!1)}search(t,e=!0){for(let n of this.traverse(e))if(t(n))return n;return null}*searchAll(t,e=!0){for(let n of this.traverse(e))t(n)&&(yield n)}find(t,e=!0){return this.search(n=>n.value===t,e)}findAll(t,e=!0){return this.searchAll(n=>n.value===t,e)}contains(t,e=!0){for(let n of this.traverse(e))if(n===t)return!0;return!1}containsValue(t,e=!0){for(let n of this.traverse(e))if(n.value===t)return!0;return!1}get _isEntryPoint(){return this._reverse.length===0}get _isExitPoint(){return this._forward.length===0}get isDisconnected(){return this._isEntryPoint&&this._isExitPoint}get isConnected(){return!this._isExitPoint||!this._isEntryPoint}get isTerminus(){return this._isEntryPoint||this._isExitPoint}get isInternal(){return!this._isEntryPoint&&!this._isExitPoint}};var Kd=class extends al{get connections(){return this._forward}get isEntryPoint(){return this._isEntryPoint}get isExitPoint(){return this._isExitPoint}};var wt=class extends sl{constructor(e,n,i){super(e,n);this._node=i;this.context._init(this._node,this.nodeType)}onDisposing(){this.disconnect(),this.context._dispose(this._node),super.onDisposing()}parent(e){this.context._parent(this,e)}get channelCount(){return this._node.channelCount}set channelCount(e){this._node.channelCount=e}get channelCountMode(){return this._node.channelCountMode}set channelCountMode(e){this._node.channelCountMode=e}get channelInterpretation(){return this._node.channelInterpretation}set channelInterpretation(e){this._node.channelInterpretation=e}get numberOfInputs(){return this._node.numberOfInputs}get numberOfOutputs(){return this._node.numberOfOutputs}_resolveInput(e){return{destination:this._node,input:e}}_resolveOutput(e){return{source:this._node,output:e}}};var ll=class extends wt{constructor(t,e){super("analyser",t,new AnalyserNode(t,e))}get fftSize(){return this._node.fftSize}set fftSize(t){this._node.fftSize=t}get frequencyBinCount(){return this._node.frequencyBinCount}get maxDecibels(){return this._node.maxDecibels}set maxDecibels(t){this._node.maxDecibels=t}get minDecibels(){return this._node.minDecibels}set minDecibels(t){this._node.minDecibels=t}get smoothingTimeConstant(){return this._node.smoothingTimeConstant}set smoothingTimeConstant(t){this._node.smoothingTimeConstant=t}getByteFrequencyData(t){this._node.getByteFrequencyData(t)}getByteTimeDomainData(t){this._node.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._node.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._node.getFloatTimeDomainData(t)}};var Lt=class{constructor(t,e,n){this.nodeType=t;this.context=e;this.param=n;this._name=null;this.disposed=!1;this.context._init(this.param,this.nodeType)}get name(){return this._name}set name(t){this._name=t,this.context._name(this,t)}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){this.context._dispose(this.param)}get automationRate(){return this.param.automationRate}set automationRate(t){this.param.automationRate=t}get defaultValue(){return this.param.defaultValue}get maxValue(){return this.param.maxValue}get minValue(){return this.param.minValue}get value(){return this.param.value}set value(t){this.param.value=t}cancelAndHoldAtTime(t){return this.param.cancelAndHoldAtTime(t),this}cancelScheduledValues(t){return this.param.cancelScheduledValues(t),this}exponentialRampToValueAtTime(t,e){return this.param.exponentialRampToValueAtTime(t,e),this}linearRampToValueAtTime(t,e){return this.param.linearRampToValueAtTime(t,e),this}setTargetAtTime(t,e,n){return this.param.setTargetAtTime(t,e,n),this}setValueAtTime(t,e){return this.param.setValueAtTime(t,e),this}setValueCurveAtTime(t,e,n){return this.param.setValueCurveAtTime(t,e,n),this}_resolveInput(){return{destination:this.param}}resolveInput(){return this._resolveInput()}};var Yd=class extends wt{constructor(e,n){super("audio-buffer-source",e,new AudioBufferSourceNode(e,n));this._node.addEventListener("ended",()=>this.dispatchEvent(new Ae("ended"))),this.parent(this.playbackRate=new Lt("playbackRate",e,this._node.playbackRate)),this.parent(this.detune=new Lt("detune",e,this._node.detune))}get buffer(){return this._node.buffer}set buffer(e){this._node.buffer=e}get loop(){return this._node.loop}set loop(e){this._node.loop=e}get loopEnd(){return this._node.loopEnd}set loopEnd(e){this._node.loopEnd=e}get loopStart(){return this._node.loopStart}set loopStart(e){this._node.loopStart=e}get onended(){return this._node.onended}set onended(e){this._node.onended=e}start(e,n,i){this._node.start(e,n,i)}stop(e){this._node.stop(e)}};var Jd=class extends wt{constructor(t,e){super("destination",t,e)}get maxChannelCount(){return this._node.maxChannelCount}};var $i=class extends wt{constructor(e,n){super("biquad-filter",e,new BiquadFilterNode(e,n));this.parent(this.Q=new Lt("Q",this.context,this._node.Q)),this.parent(this.detune=new Lt("detune",this.context,this._node.detune)),this.parent(this.frequency=new Lt("frequency",this.context,this._node.frequency)),this.parent(this.gain=new Lt("gain",this.context,this._node.gain))}get type(){return this._node.type}set type(e){this._node.type=e}getFrequencyResponse(e,n,i){this._node.getFrequencyResponse(e,n,i)}};var Qd=class extends wt{constructor(t,e){super("channel-merger",t,new ChannelMergerNode(t,e))}};var $d=class extends wt{constructor(t,e){super("channel-splitter",t,new ChannelSplitterNode(t,e))}};var Zd=class extends wt{constructor(e,n){super("constant-source",e,new ConstantSourceNode(e,n));this._node.addEventListener("ended",()=>this.dispatchEvent(new Ae("ended"))),this.parent(this.offset=new Lt("offset",this.context,this._node.offset))}get onended(){return this._node.onended}set onended(e){this._node.onended=e}start(e){this._node.start(e)}stop(e){this._node.stop(e)}};var eh=class extends wt{constructor(t,e){super("convolver",t,new ConvolverNode(t,e))}get buffer(){return this._node.buffer}set buffer(t){this._node.buffer=t}get normalize(){return this._node.normalize}set normalize(t){this._node.normalize=t}};var th=class extends wt{constructor(e,n){super("delay",e,new DelayNode(e,n));this.parent(this.delayTime=new Lt("delay",this.context,this._node.delayTime))}};var cl=class extends wt{constructor(e,n){super("dynamics-compressor",e,new DynamicsCompressorNode(e,n));this.parent(this.attack=new Lt("attack",this.context,this._node.attack)),this.parent(this.knee=new Lt("knee",this.context,this._node.knee)),this.parent(this.ratio=new Lt("ratio",this.context,this._node.ratio)),this.parent(this.release=new Lt("release",this.context,this._node.release)),this.parent(this.threshold=new Lt("threshold",this.context,this._node.threshold))}get reduction(){return this._node.reduction}};var ai=class extends wt{constructor(e,n){super("gain",e,new GainNode(e,n));this.parent(this.gain=new Lt("gain",this.context,this._node.gain))}};var nh=class extends wt{constructor(t,e){super("iir-filter",t,new IIRFilterNode(t,e))}getFrequencyResponse(t,e,n){this._node.getFrequencyResponse(t,e,n)}};var Pi=class extends wt{constructor(t,e){super("media-element-audio-source",t,new MediaElementAudioSourceNode(t,e))}get mediaElement(){return this._node.mediaElement}};var ns=class extends wt{constructor(t,e){super("media-stream-audio-destination",t,new MediaStreamAudioDestinationNode(t,e))}get stream(){return this._node.stream}};var tle="AudioContext"in globalThis,vS=tle&&"AudioListener"in globalThis,FS=vS&&"setPosition"in AudioListener.prototype,Fu=vS&&"positionX"in AudioListener.prototype,Jx="createMediaStreamSource"in AudioContext.prototype,Vbe=ht(HTMLMediaElement.prototype.captureStream)||ht(HTMLMediaElement.prototype.mozCaptureStream);var rs=class extends wt{constructor(e,n){let i=ii(Br(!1),Lp(Jx),xo(!0),Ko(!1),fn("none"),Vc(n.mediaStream)),o;Jx?o=new MediaStreamAudioSourceNode(e,n):o=new MediaElementAudioSourceNode(e,{mediaElement:i});super("media-stream-audio-source",e,o);this._stream=n.mediaStream,this._element=i}onDisposing(){this._element.pause(),super.onDisposing()}get mediaStream(){return this._stream}};var rh=class extends wt{constructor(e,n){super("oscillator",e,new OscillatorNode(e,n));this._node.addEventListener("ended",()=>this.dispatchEvent(new Ae("ended"))),this.parent(this.detune=new Lt("detune",this.context,this._node.detune)),this.parent(this.frequency=new Lt("frequency",this.context,this._node.frequency))}get type(){return this._node.type}set type(e){this._node.type=e}get onended(){return this._node.onended}set onended(e){this._node.onended=e}setPeriodicWave(e){this._node.setPeriodicWave(e)}start(e){this._node.start(e)}stop(e){this._node.stop(e)}};var ul=class extends wt{constructor(e,n){super("panner",e,new PannerNode(e,n));this.parent(this.positionX=new Lt("positionX",this.context,this._node.positionX)),this.parent(this.positionY=new Lt("positionY",this.context,this._node.positionY)),this.parent(this.positionZ=new Lt("positionZ",this.context,this._node.positionZ)),this.parent(this.orientationX=new Lt("orientationX",this.context,this._node.orientationX)),this.parent(this.orientationY=new Lt("orientationY",this.context,this._node.orientationY)),this.parent(this.orientationZ=new Lt("orientationZ",this.context,this._node.orientationZ))}get coneInnerAngle(){return this._node.coneInnerAngle}set coneInnerAngle(e){this._node.coneInnerAngle=e}get coneOuterAngle(){return this._node.coneOuterAngle}set coneOuterAngle(e){this._node.coneOuterAngle=e}get coneOuterGain(){return this._node.coneOuterGain}set coneOuterGain(e){this._node.coneOuterGain=e}get distanceModel(){return this._node.distanceModel}set distanceModel(e){this._node.distanceModel=e}get maxDistance(){return this._node.maxDistance}set maxDistance(e){this._node.maxDistance=e}get panningModel(){return this._node.panningModel}set panningModel(e){this._node.panningModel=e}get refDistance(){return this._node.refDistance}set refDistance(e){this._node.refDistance=e}get rolloffFactor(){return this._node.rolloffFactor}set rolloffFactor(e){this._node.rolloffFactor=e}setOrientation(e,n,i){this._node.setOrientation(e,n,i)}setPosition(e,n,i){this._node.setPosition(e,n,i)}};var ih=class extends wt{constructor(e,n){super("stereo-panner",e,new StereoPannerNode(e,n));this.parent(this.pan=new Lt("pan",this.context,this._node.pan))}};var oh=class extends wt{constructor(t,e){super("wave-shaper",t,new WaveShaperNode(t,e))}get curve(){return this._node.curve}set curve(t){this._node.curve=t}get oversample(){return this._node.oversample}set oversample(t){this._node.oversample=t}};!("AudioContext"in globalThis)&&"webkitAudioContext"in globalThis&&(globalThis.AudioContext=globalThis.webkitAudioContext);!("OfflineAudioContext"in globalThis)&&"webkitOfflineAudioContext"in globalThis&&(globalThis.OfflineAudioContext=globalThis.webkitOfflineAudioContext);var Qx=class{constructor(t,e){this.type=t;this.name=e;this.connections=new Set}};function sh(r,t,e,n,i){return r.type===t&&(fe(e)||e===r.destination)&&(fe(n)||n===r.output)&&(fe(i)||i===r.input)}function pl(r,t){let e=null,n=null;return T(r)&&({destination:e,input:n}=r.resolveInput(t)),{destination:e,input:n}}var dl=class extends AudioContext{constructor(e){super(e);this.counters=new Map;this.nodes=new Map;this._ready=new mt;this._destination=new Jd(this,super.destination),this.state==="running"?this._ready.resolve():this.state==="closed"?this.resume().then(()=>this._ready.resolve()):Qi(()=>this.resume().then(()=>this._ready.resolve())),this.ready.then(()=>console.log("Audio is now ready"))}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}_init(e,n){if(!this.nodes.has(e)){this.counters.has(n)||this.counters.set(n,0);let i=this.counters.get(n),o=`${n}-${i}`;this.nodes.set(e,new Qx(n,o)),wu(e)&&(e.name=o),this.counters.set(n,i+1)}}_name(e,n){let{destination:i}=pl(e);if(this.nodes.has(i)){let o=this.nodes.get(i);o.name=`${n}-${o.type}`}}_dispose(e){this.nodes.delete(e)}_isConnected(e,n,i,o){let{source:s,output:l}=e.resolveOutput(i),{destination:c,input:u}=pl(n,o);if(fe(s)||!this.nodes.has(s))return null;{let p=this.nodes.get(s);for(let f of p.connections)if(sh(f,"conn",c,l,u))return!0;return!1}}_parent(e,n){let{source:i}=e.resolveOutput(),{destination:o}=pl(n);this.nodes.has(i)&&this.nodes.get(i).connections.add({type:"parent",src:e,dest:n,destination:o,source:i})}_unparent(e,n){let{source:i}=e.resolveOutput(),{destination:o}=pl(n);if(this.nodes.has(i)){let s=this.nodes.get(i).connections,l=new Set;for(let c of s)sh(c,"parent",o)&&l.add(c);for(let c of l)s.delete(c)}}_getConnections(e){return this.nodes.has(e)?this.nodes.get(e).connections:null}_connect(e,n,i,o){let{source:s,output:l}=e.resolveOutput(i),{destination:c,input:u}=pl(n,o);if(this.nodes.has(s)){let p=this.nodes.get(s).connections,f=!1;for(let w of p)sh(w,"conn",c,l,u)&&(f=!0);f||p.add({type:"conn",src:e,dest:n,outp:i,inp:o,source:s,destination:c,output:l,input:u})}if(c instanceof AudioNode)return n=n,T(u)?(s.connect(c,l,u),n):T(l)?(s.connect(c,l),n):(s.connect(c),n);c instanceof AudioParam?T(l)?s.connect(c,l):T(c)?s.connect(c):Ot(c):Ot(c)}_disconnect(e,n,i,o){let s;Rt(n)?(s=void 0,i=n):s=n;let{source:l,output:c}=e.resolveOutput(i),{destination:u,input:p}=pl(s,o);if(this.nodes.has(l)){let f=this.nodes.get(l).connections,w=new Set;for(let A of f)sh(A,"conn",u,c,p)&&w.add(A);for(let A of w)f.delete(A)}u instanceof AudioNode?T(o)?l.disconnect(u,i,o):T(i)?l.disconnect(u,i):T(u)?l.disconnect(u):l.disconnect():T(i)?l.disconnect(u,i):T(u)?l.disconnect(u):l.disconnect()}getAudioGraph(e){let n=new Map;for(let[i,o]of this.nodes){let s=i instanceof AudioNode?"node":i instanceof AudioParam?"param":"unknown";(e||s!=="param")&&n.set(i,new Kd({name:o.name,type:o.type,nodeClass:s}))}for(let[i,o]of this.nodes){let s=n.get(i);for(let l of o.connections){let c=l.destination;if(n.has(c)){let u=n.get(c);s.connectTo(u),u.connectTo(s)}}}return Array.from(n.values())}get destination(){return this._destination}createAnalyser(){return new ll(this)}createBiquadFilter(){return new $i(this)}createBufferSource(){return new Yd(this)}createChannelMerger(e){return new Qd(this,{numberOfInputs:e})}createChannelSplitter(e){return new $d(this,{numberOfOutputs:e})}createConstantSource(){return new Zd(this)}createConvolver(){return new eh(this)}createDelay(e){return new th(this,{maxDelayTime:e})}createDynamicsCompressor(){return new cl(this)}createGain(){return new ai(this)}createIIRFilter(e,n){return new nh(this,{feedforward:e,feedback:n})}createMediaElementSource(e){return new Pi(this,{mediaElement:e})}createMediaStreamDestination(){return new ns(this)}createMediaStreamSource(e){return new rs(this,{mediaStream:e})}createOscillator(){return new rh(this)}createPanner(){return new ul(this)}createStereoPanner(){return new ih(this)}createWaveShaper(){return new oh(this)}createScriptProcessor(){throw new Error("Script processor nodes are deprecated")}};var ah=class{constructor(t,e){this.type=t;this.context=e}};var hl=Qt.create(),ml=Qt.create(),fl=class extends ah{get listener(){return this.context.listener}readPose(t){let{p:e,q:n}=t;Qt.set(hl,0,0,-1),Qt.transformQuat(hl,hl,n),Qt.set(ml,0,1,0),Qt.transformQuat(ml,ml,n),this.setPosition(e[0],e[1],e[2]),this.setOrientation(hl[0],hl[1],hl[2],ml[0],ml[1],ml[2])}};var lh=class extends fl{constructor(t){if(!Fu)throw new Error("Latest WebAudio Listener API is not supported");super("web-audio-listener-new",t),Object.seal(this)}setPosition(t,e,n){let i=this.context.currentTime;this.listener.positionX.setValueAtTime(t,i),this.listener.positionY.setValueAtTime(e,i),this.listener.positionZ.setValueAtTime(n,i)}setOrientation(t,e,n,i,o,s){let l=this.context.currentTime;this.listener.forwardX.setValueAtTime(t,l),this.listener.forwardY.setValueAtTime(e,l),this.listener.forwardZ.setValueAtTime(n,l),this.listener.upX.setValueAtTime(i,l),this.listener.upY.setValueAtTime(o,l),this.listener.upZ.setValueAtTime(s,l)}};var ch=class extends fl{constructor(t){if(!FS)throw new Error("WebAudio Listener API is not supported");super("web-audio-listener-old",t),Object.seal(this)}setPosition(t,e,n){this.listener.setPosition(t,e,n)}setOrientation(t,e,n,i,o,s){this.listener.setOrientation(t,e,n,i,o,s)}};var gl=class{constructor(){this.p=Qt.create();this.q=Ya.create();Object.seal(this)}set(t,e,n,i,o,s,l){this.setPosition(t,e,n),this.setOrientation(i,o,s,l)}setPosition(t,e,n){Qt.set(this.p,t,e,n)}setOrientation(t,e,n,i){Ya.set(this.q,t,e,n,i)}copy(t){Qt.copy(this.p,t.p),Ya.copy(this.q,t.q)}};var xl=class extends ar{constructor(e,n,i,o,s,l){super(e,n,o,s,l);this.spatialized=i;this._minDistance=1;this._maxDistance=10;this._algorithm="inverse"}get minDistance(){return this._minDistance}get maxDistance(){return this._maxDistance}get algorithm(){return this._algorithm}setAudioProperties(e,n,i){this._minDistance=e,this._maxDistance=n,this._algorithm=i}};var Au=Qt.create(),wl=class extends xl{constructor(e,n){let i=new ul(n,{panningModel:"HRTF",distanceModel:"inverse",coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:0});super(e,n,!0,[i]);this.lpx=0;this.lpy=0;this.lpz=0;this.lqx=0;this.lqy=0;this.lqz=0;this.lqw=0;this.panner=i}setAudioProperties(e,n,i){super.setAudioProperties(e,n,i),this.panner.refDistance=this.minDistance,this.panner.distanceModel=i,i==="linear"?this.panner.rolloffFactor=1:this.maxDistance<=0?this.panner.rolloffFactor=1/0:i==="inverse"?this.panner.rolloffFactor=1/this.maxDistance:this.panner.rolloffFactor=Math.pow(this.maxDistance,-.2)}readPose(e){let{p:n,q:i}=e,[o,s,l]=n,[c,u,p,f]=i;(o!==this.lpx||s!==this.lpy||l!==this.lpz)&&(this.lpx=o,this.lpy=s,this.lpz=l,this.setPosition(o,s,l,this.context.currentTime)),(c!==this.lqx||u!==this.lqy||p!==this.lqz||f!==this.lqw)&&(this.lqx=c,this.lqy=u,this.lqz=p,this.lqw=f,Qt.transformQuat(Au,Qt.set(Au,0,0,-1),i),this.setOrientation(Au[0],Au[1],Au[2],this.context.currentTime))}getGainAtDistance(e){let{rolloffFactor:n,refDistance:i,maxDistance:o,distanceModel:s}=this.panner;if(e<=i)return 1;{let l=e-i,c=o-i;if(s==="linear")return 1-n*l/c;if(s==="inverse")return i/(i+n*l);if(s==="exponential")return Math.pow(e/i,-n);Ot(s)}}};var uh=class extends wl{constructor(t){super("web-audio-panner-new",t),Object.seal(this)}setPosition(t,e,n,i){Ir(t)&&Ir(e)&&Ir(n)&&(vp(i)&&(i=0),this.panner.positionX.setValueAtTime(t,i),this.panner.positionY.setValueAtTime(e,i),this.panner.positionZ.setValueAtTime(n,i))}setOrientation(t,e,n,i){Ir(t)&&Ir(e)&&Ir(n)&&(vp(i)&&(i=0),this.panner.orientationX.setValueAtTime(-t,i),this.panner.orientationY.setValueAtTime(-e,i),this.panner.orientationZ.setValueAtTime(-n,i))}};var ph=class extends wl{constructor(t){super("web-audio-panner-old",t),Object.seal(this)}setPosition(t,e,n){this.panner.setPosition(t,e,n)}setOrientation(t,e,n){this.panner.setOrientation(t,e,n)}};var dh=class extends ar{constructor(e){let n=Fu?new lh(e):new ch(e),i=new ai(e);i.name="remote-user-input";let o=new ai(e);o.name="spatialized-input";let s=new ai(e);s.name="non-spatialized-input";let l=new ns(e),c=new mt,u=ii(Ct("Audio-Device-Manager"),fn("none"),xo(!0),Br(!0),Vc(l.stream),FA(()=>c.resolve()));Qi(()=>u.play());super("web-audio-destination",e,[s,o,i],[],[l]);this.pose=new gl;this._ready=c,this.listener=n,this.remoteUserInput=i,this.spatializedInput=o,this.nonSpatializedInput=s,this.volumeControl=s,this.destination=l,this.element=u,i.connect(o).connect(this.volumeControl).connect(l)}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}createSpatializer(e){let n=e?this.remoteUserInput:this.spatializedInput,i=Fu?new uh(this.context):new ph(this.context);return i.connect(n),i}setPosition(e,n,i){this.pose.setPosition(e,n,i),this.listener.readPose(this.pose)}setOrientation(e,n,i,o){this.pose.setOrientation(e,n,i,o),this.listener.readPose(this.pose)}set(e,n,i,o,s,l,c){this.pose.set(e,n,i,o,s,l,c),this.listener.readPose(this.pose)}get stream(){return this.destination.stream}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}};var $x=class extends ar{constructor(t){let e=new $i(t,{type:"bandpass",frequency:2500,Q:4.5}),n=new ai(t,{gain:10});e.connect(n),super("radio-effect",t,[e],[n])}};function AS(r,t){let e=new $x(t);return e.name=`${r}-radio-effect`,e}function bS(r,t){let e=new $i(t,{type:"bandpass",frequency:400,Q:4.5});return e.name=`${r}-wall-effect`,e}var hh=new Map([["Radio",AS],["Wall",bS]]);var Zi=class extends ar{constructor(e,n,i,o,s){let l=new ai(n);l.name="volume-control",s=s||[];super(e,n,[],[i],s);this.spatializer=i;this.effects=new Array;this.pose=new gl;this.volumeControl=l,this.setEffects(...o)}onDisposing(){ct(this.effects),super.onDisposing()}setEffects(...e){this.disable();for(let i of this.effects)this.remove(i),zt(i);ct(this.effects);let n=this.volumeControl;for(let i of e)if(T(i)){let o=hh.get(i);if(T(o)){let s=o(i,this.context);this.add(s),this.effects.push(s),n=n.connect(s)}}this.enable()}get spatialized(){return this.spatializer.spatialized}get lastInternal(){return this.effects[this.effects.length-1]||this.volumeControl}enable(){this.lastInternal.isConnected()||this.lastInternal.connect(this.spatializer)}disable(){this.lastInternal.isConnected()&&this.lastInternal.disconnect()}tog(){this.lastInternal.isConnected()?this.disable():this.enable()}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}get minDistance(){return T(this.spatializer)?this.spatializer.minDistance:null}get maxDistance(){return T(this.spatializer)?this.spatializer.maxDistance:null}get algorithm(){return T(this.spatializer)?this.spatializer.algorithm:null}setPosition(e,n,i){T(this.spatializer)&&(this.pose.setPosition(e,n,i),this.spatializer.readPose(this.pose))}setOrientation(e,n,i,o){T(this.spatializer)&&(this.pose.setOrientation(e,n,i,o),this.spatializer.readPose(this.pose))}set(e,n,i,o,s,l,c){T(this.spatializer)&&(this.pose.set(e,n,i,o,s,l,c),this.spatializer.readPose(this.pose))}setAudioProperties(e,n,i){T(this.spatializer)&&this.spatializer.setAudioProperties(e,n,i)}};var eo=class extends Ae{constructor(e,n){super(e);this.source=n}},is=class extends eo{constructor(t){super("loaded",t)}},mh=class extends eo{constructor(e,n){super("errored",e);this.error=n}},os=class extends eo{constructor(t){super("played",t)}},ss=class extends eo{constructor(t){super("paused",t)}},as=class extends eo{constructor(t){super("stopped",t)}},ls=class extends eo{constructor(e){super("progress",e);this.value=0;this.total=0}};var nle=new Ae("disposing"),fh=class extends Zi{constructor(e,n,i,o,s,...l){super("audio-element-source",e,s,l);n.connect(this.volumeControl),this.audio=n.mediaElement,this.disable(),this.loadEvt=new is(this),this.playEvt=new os(this),this.pauseEvt=new ss(this),this.stopEvt=new as(this),this.progEvt=new ls(this);let c=u=>{this.audio.currentTime===0||u.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};this.audio.addEventListener("ended",c),this.audio.addEventListener("pause",c),i&&this.audio.addEventListener("play",()=>{if(this.audio.loop&&this.audio.duration>1){let u=this.audio.duration*Math.random();this.audio.currentTime=u}}),o&&(n.mediaElement.preservesPitch=!1,this.audio.addEventListener("play",()=>{n.mediaElement.playbackRate=1+.1*(2*Math.random()-1)})),this.audio.addEventListener("play",()=>{this.dispatchEvent(this.playEvt)}),this.audio.addEventListener("timeupdate",()=>{this.progEvt.value=this.audio.currentTime,this.progEvt.total=this.audio.duration,this.dispatchEvent(this.progEvt)}),this.audio.autoplay&&this.play().catch(()=>Qi(()=>this.play())),W0(this.audio).then(u=>this.dispatchEvent(u?this.loadEvt:new mh(this,this.audio.error)))}onDisposing(){this.dispatchEvent(nle),super.onDisposing()}get playbackState(){return this.audio.error?"errored":this.audio.ended||this.audio.paused&&this.audio.currentTime===0?"stopped":this.audio.paused?"paused":"playing"}async play(){this.enable(),await this.context.ready,await this.audio.play()}async playThrough(){let e=dn(this,"stopped");await this.play(),await e}pause(){this.disable(),this.audio.pause()}stop(){this.audio.currentTime=0,this.pause()}restart(){return this.stop(),this.play()}};var Zx=class extends Ae{constructor(e){super("sourceadded");this.source=e}},gh=class extends Zi{constructor(e,n,...i){super("audio-stream-source",e,n,i);this._stream=null;this._node=null}get stream(){return this._stream}set stream(e){e!==this.stream&&(T(this.stream)&&(this.remove(this._node),zt(this._node),this._node=null),T(e)&&(this._node=new rs(this.context,{mediaStream:e}),this._node.name=ol("media-stream-source",e.id),this._node.connect(this.volumeControl),this.add(this._node),this.dispatchEvent(new Zx(this))))}};var vl=class extends xl{constructor(t){super("no-spatializer",t.context,!1,[t],[t])}readPose(t){}getGainAtDistance(t){return 1}};function xh(r){let t=[];for(let e=0;e<r.length;++e){let n=r[e],i=!1;for(let o=0;o<t.length&&!i;++o){let s=t[o];i=n.kind===s.kind&&s.label.indexOf(n.label)>0}i||t.push(n)}return t}var to=ht(HTMLAudioElement.prototype.setSinkId),ew=class extends Ae{constructor(e){super("audiooutputchanged");this.device=e}},SS="calla:preferredAudioOutputID",wh=class extends qe{constructor(e){super();this.element=e;this._hasAudioPermission=!1;this._ready=new mt;this.start(),Object.seal(this)}get hasAudioPermission(){return this._hasAudioPermission}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}async start(){if(to){let e=await navigator.mediaDevices.enumerateDevices(),n=Mn(e,i=>i.kind==="audiooutput"&&i.label.length>0);if(T(n)){this._hasAudioPermission=!0;let i=await this.getPreferredAudioOutput();i&&await this.setAudioOutputDevice(i)}}this._ready.resolve()}get preferredAudioOutputID(){return to?localStorage.getItem(SS):null}async getAudioOutputDevices(e=!1){return to?await this.getAvailableDevices(e)||[]:[]}async getAudioOutputDevice(){if(!to)return null;let e=this.element&&this.element.sinkId;if(fe(e))return null;let n=await this.getAudioOutputDevices();return Mn(n,o=>o.deviceId===e)}async getPreferredAudioOutput(){if(!to)return null;let e=await this.getAudioOutputDevices();return Mn(e,i=>i.deviceId===this.preferredAudioOutputID,i=>i.deviceId==="default",i=>i.deviceId.length>0)}async setAudioOutputDevice(e){if(to){if(T(e)&&e.kind!=="audiooutput")throw new Error(`Device is not an audio output device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(SS,e&&e.deviceId||null);let n=this.element,i=n&&n.sinkId;this.preferredAudioOutputID!==i&&(T(this.preferredAudioOutputID)&&await this.element.setSinkId(this.preferredAudioOutputID),this.dispatchEvent(new ew(e)))}}async getAvailableDevices(e=!1){let n=null,i=null;for(let o=0;o<3;++o){n=await navigator.mediaDevices.enumerateDevices();for(let s of n)s.deviceId.length>0&&(this.hasAudioPermission||(this._hasAudioPermission=s.kind==="audioinput"&&s.label.length>0));if(this.hasAudioPermission)break;try{i=await this.startStream()}catch(s){console.warn(s)}}if(i)for(let o of i.getTracks())o.stop();return n=ya(n||[],o=>o.label),e&&(n=xh(n)),to?n.filter(o=>o.kind==="audiooutput"):[]}startStream(){return navigator.mediaDevices.getUserMedia({audio:!0})}};var yS="juniper::useHeadphones",rle=new Ae("useheadphonestoggled"),TS=10,Fl=new Ae("released"),ES="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",vh=class extends ar{constructor(e,n){let i=new dl;"THREE"in globalThis&&globalThis.THREE.AudioContext.setContext(i);let o=new dh(i),s=new vl(o.nonSpatializedInput),l=new wh(o.element);super("audio-manager",i,null,null,[s,o]);this.fetcher=e;this.users=new Map;this.clips=new Map;this.pendingAudio=new Array;this.audioPool=new Array;this.elements=new Map;this.elementCounts=new Map;this._minDistance=.25;this._maxDistance=100;this._algorithm="inverse";this._useHeadphones=!1;this.destination=null;this._ready=new mt;this.localUserID=null;this.destination=o,this.noSpatializer=s,this.speakers=l,An(this.context.ready,this.destination.ready,this.speakers.ready).then(()=>this._ready.resolve()),this.setLocalUserID(n);let c=localStorage.getItem(yS);T(c)?this._useHeadphones=c==="true":this._useHeadphones=Ao(),this.enpool(),ja()&&Qi(()=>{let u=[...this.pendingAudio];ct(this.pendingAudio);for(let p of u)p()},!0),Object.seal(this)}get algorithm(){return this._algorithm}get element(){return this.destination.element}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}enpool(){for(let e=0;e<TS;++e){let n=new mt,i=ii(Zn(ES),Br(!1),Mr("released",()=>{i.pause(),i.src=ES}));this.audioPool.push(n),ja()?this.pendingAudio.push(()=>{i.play(),n.resolve(i)}):n.resolve(i)}}preparePool(e){for(;this.audioPool.length<e;)this.enpool()}async getPooledAudio(...e){if(this.audioPool.length===0)throw new un("Audio pool exhausted!");let n=this.audioPool.shift();this.audioPool.length<=TS/2&&this.enpool();let i=await n;return i.pause(),We(i,...e),i}async getPooledSource(e,n,i){if(!this.elements.has(e)){let s=await this.getPooledAudio(Zn(n),Ko(i&&!ja()));ja()&&i&&s.addEventListener("ended",()=>s.play());let l=new Pi(this.context,{mediaElement:s});l.name=ol("media-element-source",e),this.elements.set(e,l),this.elementCounts.set(e,0)}let o=this.elements.get(e);return this.elementCounts.set(e,this.elementCounts.get(e)+1),o}releasePooledSource(e){let n=this.elements.get(e);this.elementCounts.set(e,this.elementCounts.get(e)-1),this.elementCounts.get(e)===0&&(n.mediaElement.dispatchEvent(Fl),this.elementCounts.delete(e),this.elements.delete(e))}get useHeadphones(){return this._useHeadphones}set useHeadphones(e){e!==this.useHeadphones&&(this._useHeadphones=e,localStorage.setItem(yS,this.useHeadphones.toString()),this.dispatchEvent(rle))}onDisposing(){this.context.suspend();for(let e of this.users.keys())this.removeUser(e);for(let e of this.clips.keys())this.removeClip(e);super.onDisposing()}get currentTime(){return this.context.currentTime}createSpatializer(e,n){if(e){let i=this.destination.createSpatializer(n);return i.setAudioProperties(this._minDistance,this._maxDistance,this._algorithm),i}else return this.noSpatializer}createUser(e,n){if(!this.users.has(e)){let i=new gh(this.context,this.createSpatializer(!0,!0));i.name=ol(n,e),this.users.set(e,i)}return this.users.get(e)}setLocalUserID(e){return this.destination&&(this.localUserID=e),this.destination}createBasicClip(e,n,i){return this.createClip(e,n,!1,!1,!1,!0,i,[])}hasClip(e){return this.clips.has(e)}async createClip(e,n,i,o,s,l,c,u,p){await this.ready;let f,w;et(n)?(f=n,w=await this.fetcher.get(n).progress(p).file().then(tt)):(f=n.path,w=n.result);let A=await this.getPooledSource(f,w,i),m=new fh(this.context,A,s,l,this.createSpatializer(o,!1),...u);return m.addEventListener("disposing",()=>this.releasePooledSource(f)),m.name=ol("audio-clip-element",e),m.volume=c,this.clips.set(e,m),m}async playClip(e){this.hasClip(e)&&await this.clips.get(e).play()}async playClipThrough(e){this.hasClip(e)&&await this.clips.get(e).playThrough()}stopClip(e){this.hasClip(e)&&this.clips.get(e).stop()}getUser(e){return this.users.get(e)}getClip(e){return this.clips.get(e)}removeSource(e,n){let i=e.get(n);return T(i)&&(e.delete(n),zt(i)),i}removeUser(e){let n=this.removeSource(this.users,e);T(n.stream)&&(n.stream=null)}removeClip(e){let n=this.removeSource(this.clips,e);return zt(n),n}setUserStream(e,n){if(this.users.has(e)){let i=this.users.get(e);i.stream=n}}setAudioProperties(e,n,i){this._minDistance=e,this._maxDistance=n,this._algorithm=i;for(let o of this.users.values())o.setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let o of this.clips.values())o.setAudioProperties(o.minDistance,o.maxDistance,this.algorithm)}withPoser(e,n,i){let s=e.get(n)||this.destination;return i(s)}withUser(e,n){return this.withPoser(this.users,e,n)}withClip(e,n){return this.withPoser(this.clips,e,n)}setUserPose(e,n,i,o,s,l,c,u){this.withUser(e,p=>{p.set(n,i,o,s,l,c,u)})}setUserPosition(e,n,i,o){this.withUser(e,s=>{s.setPosition(n,i,o)})}setUserOrientation(e,n,i,o,s){this.withUser(e,l=>{l.setOrientation(n,i,o,s)})}setClipPose(e,n,i,o,s,l,c,u){this.withClip(e,p=>{p.set(n,i,o,s,l,c,u)})}setClipPosition(e,n,i,o){this.withClip(e,s=>{s.setPosition(n,i,o)})}setClipOrientation(e,n,i,o,s){this.withClip(e,l=>{l.setOrientation(n,i,o,s)})}};var Al=class extends Ae{constructor(){super("devicesettingschanged")}},Fh=class{constructor(...t){this.permissed=new Set;this.managers=t}get hasPermissions(){for(let t of this.managers)if(!this.permissed.has(t))return!1;return!0}async init(){if(!this.hasPermissions){let t=await this.getDevices();await Promise.all(this.managers.map(e=>e.setDevice(Mn(t,n=>n.kind===e.deviceKind&&n.deviceId===e.preferredDeviceID,n=>n.kind===e.deviceKind&&n.deviceId==="default",n=>n.kind===e.deviceKind&&n.deviceId.length>0))))}}async getDevices(t=!1){let e=null,n=null;for(let i=0;i<3;++i)if(e=await navigator.mediaDevices.enumerateDevices(),!this.hasPermissions){let o={};for(let s of this.managers)if(!this.permissed.has(s)){for(let l of e)if(l.kind===s.deviceKind&&l.deviceId.length>0&&l.label.length>0){this.permissed.add(s);break}this.permissed.has(s)||(o[s.mediaType]=!0)}if(!this.hasPermissions)try{n=await navigator.mediaDevices.getUserMedia(o)}catch(s){console.warn(s)}}if(n)for(let i of n.getTracks())i.stop();return e=ya(e||[],i=>i.label),t&&(e=xh(e)),e}get outStreams(){return this.managers.map(t=>t.outStream)}};var bl=class extends Ae{constructor(e,n){super("streamchanged");this.oldStream=e;this.newStream=n}};var _S="calla:preferredAudioInputID",Ah=class extends ar{constructor(e){let n=e.createGain();n.name="local-mic-user-gain";let i=e.createGain();i.name="local-mic-auto-gain";let o=new $i(e,{type:"bandpass",frequency:1500,Q:.25});o.name="local-mic-filter";let s=new cl(e,{threshold:-15,knee:40,ratio:17});s.name="local-mic-compressor";let l=new ns(e);l.name="local-mic-destination";super("local-user-microphone",e,[],[s],[n,o,l]);this.localStreamNode=null;this._hasPermission=!1;this._usingHeadphones=!1;this._device=null;this._enabled=!1;this.volume=n,this.autoGainNode=i,this.compressor=s,this.output=l,n.connect(i).connect(o).connect(s).connect(l),Object.seal(this)}get mediaType(){return"audio"}get deviceKind(){return`${this.mediaType}input`}get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.onChange())}get hasPermission(){return this._hasPermission}get preferredDeviceID(){return localStorage.getItem(_S)}get device(){return this._device}async setDevice(e){if(T(e)&&e.kind!==this.deviceKind)throw new Error(`Device is not an audio input device. Was: ${e.kind}. Label: ${e.label}`);let n=this.device&&this.device.deviceId||null,i=e&&e.deviceId||null;i!==n&&(this._device=e,localStorage.setItem(_S,i),this.onChange())}get inStream(){return this.localStreamNode&&this.localStreamNode.mediaStream||null}set inStream(e){e!==this.inStream&&(this.localStreamNode&&(this.remove(this.localStreamNode),zt(this.localStreamNode),this.localStreamNode=null),e&&(this.localStreamNode=new rs(this.context,{mediaStream:e}),this.add(this.localStreamNode),this.localStreamNode.connect(this.volume)))}get outStream(){return this.output.stream}get gain(){return this.volume.gain}get muted(){return this.compressor.isConnected(this.output)}set muted(e){e!==this.muted&&(e?this.compressor.connect(this.output):this.compressor.disconnect(this.output))}get usingHeadphones(){return this._usingHeadphones}set usingHeadphones(e){e!==this.usingHeadphones&&(this._usingHeadphones=e,this.onChange())}async onChange(){this.dispatchEvent(new Al);let e=this.inStream;this.device&&this.enabled?this.inStream=await navigator.mediaDevices.getUserMedia({audio:{deviceId:this.device.deviceId,echoCancellation:!this.usingHeadphones,autoGainControl:!0,noiseSuppression:!0}}):this.inStream=null,this.inStream!==e&&this.dispatchEvent(new bl(e,this.outStream))}};function tw(r){return T(r)&&r.length>0?parseFloat(r):null}var li=class{constructor(t,e){this._url=null;this._base=void 0;this._protocol=null;this._host=null;this._hostName=null;this._userName=null;this._password=null;this._port=null;this._pathName=null;this._hash=null;this._query=new Map;t!==void 0&&(this._url=new URL(t,e),this.rehydrate())}rehydrate(){T(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),T(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),T(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),T(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),T(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),T(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),T(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),T(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[t,e]of this._query)this._url.searchParams.set(t,e);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=tw(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((t,e)=>this._query.set(e,t))}refresh(){if(this._url===null){if(T(this._protocol)&&(T(this._host)||T(this._hostName))){if(T(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=tw(this._url.port),this.rehydrate(),!1;if(T(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(T(this._pathName)&&T(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return T(this._url)}base(t){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=t,this.refresh(),this}protocol(t){return this._protocol=t,this.refresh()&&(this._url.protocol=t),this}host(t){return this._host=t,this.refresh()&&(this._url.host=t,this._hostName=this._url.hostname,this._port=tw(this._url.port)),this}hostName(t){return this._hostName=t,this.refresh()&&(this._url.hostname=t,this._host=`${this._url.hostname}:${this._url.port}`),this}port(t){return this._port=t,this.refresh()&&(this._url.port=t.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(t){return this._userName=t,this.refresh()&&(this._url.username=t),this}password(t){return this._password=t,this.refresh()&&(this._url.password=t),this}path(t){return this._pathName=t,this.refresh()&&(this._url.pathname=t),this}pathPop(t){return t=t||/\/[^/]+\/?$/,this.path(this._pathName.replace(t,""))}pathPush(t){let e=this._pathName;return e.endsWith("/")||(e+="/"),e+=t,this.path(e)}query(t,e){return this._query.set(t,e),this.refresh()&&this._url.searchParams.set(t,e),this}hash(t){return this._hash=t,this.refresh()&&(this._url.hash=t),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};var nw=class extends eo{constructor(t,e){super(t,e)}},Sl=class extends nw{constructor(t){super("loading",t)}};var yl=class extends Zi{constructor(e,n){let i=ii(xo(!1),Ko(!1),Br(!0)),o=new Pi(e,{mediaElement:i});o.name="JuniperAudioPlayer-Input";super("audio-player",e,n,[],[o]);this.cacheBustSources=new Map;this._data=null;this._loaded=!1;this.sourcesByURL=new Map;this.sources=new Array;this.potatoes=new Array;o.connect(this.volumeControl),this.element=i,this.loadingEvt=new Sl(this),this.loadEvt=new is(this),this.playEvt=new os(this),this.pauseEvt=new ss(this),this.stopEvt=new as(this),this.progEvt=new ls(this),this.onPlay=async()=>{this.enable(),this.dispatchEvent(this.playEvt)},this.onPause=s=>{this.disable(),this.element.currentTime===0||s.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)},this.onTimeUpdate=async()=>{this.progEvt.value=this.element.currentTime,this.progEvt.total=this.element.duration,this.dispatchEvent(this.progEvt)},this.onError=()=>this.loadAudio(),this.element.addEventListener("play",this.onPlay),this.element.addEventListener("pause",this.onPause),this.element.addEventListener("ended",this.onPause),this.element.addEventListener("error",this.onError),this.element.addEventListener("waiting",this.onWaiting),this.element.addEventListener("canplay",this.onCanPlay),this.element.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{audioPlayer:this})}get data(){return this._data}get loaded(){return this._loaded}get title(){return this.element.title}setTitle(e){this.element.title=e}get hasAudio(){let e=this.sourcesByURL.get(this.element.src);return T(e)&&e.acodec!=="none"||T(this.element.audioTracks)&&this.element.audioTracks.length>0||T(this.element.webkitAudioDecodedByteCount)&&this.element.webkitAudioDecodedByteCount>0||T(this.element.mozHasAudio)&&this.element.mozHasAudio}onDisposing(){super.onDisposing(),this.clear(),this.element.removeEventListener("play",this.onPlay),this.element.removeEventListener("pause",this.onPause),this.element.removeEventListener("ended",this.onPause),this.element.removeEventListener("error",this.onError),this.element.removeEventListener("waiting",this.onWaiting),this.element.removeEventListener("canplay",this.onCanPlay),this.element.removeEventListener("timeupdate",this.onTimeUpdate),this.element.dispatchEvent(Fl)}clear(){this.stop(),this.sourcesByURL.clear(),ct(this.sources),ct(this.potatoes),this.element.src="",this._data=null,this._loaded=!1}cacheBust(e){let n=this.cacheBustSources.get(e)||0;this.cacheBustSources.set(e,n+1)}async load(e,n){this.clear(),this._data=e,et(e)?(this.setTitle(e),this.potatoes.push(e)):(this.setTitle(e.title),Ds(e.audios,i=>-i.resolution),Un(this.sources,...e.audios));for(let i of this.sources)this.sourcesByURL.set(i.url,i);if(!this.hasSources)throw new Error("No audio sources");if(this.dispatchEvent(this.loadingEvt),await this.loadAudio(n),!this.hasSources)throw new Error("No audio sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}async getMediaCapabilities(e){let n={type:"file",audio:{contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr}};try{return await navigator.mediaCapabilities.decodingInfo(n)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:n}}}get hasSources(){return this.sources.length>0||this.potatoes.length>0}async loadAudio(e){for(T(e)&&e.start(),this.element.removeEventListener("error",this.onError);this.hasSources;){let n=null,i=this.sources.shift();if(T(i)){let s=await this.getMediaCapabilities(i);if(!s.smooth||!s.powerEfficient){this.potatoes.push(i.url);continue}else n=i.url}else n=this.potatoes.shift();let o=this.cacheBustSources.get(this.data);if(T(o)){let s=new li(n,location.href);s.query("v",o.toString()),n=s.toString()}if(this.element.src=n,this.element.load(),await Vp(this.element)){T(i)?this.sources.unshift(i):this.potatoes.unshift(n),this.element.addEventListener("error",this.onError),T(e)&&e.end();return}}}get playbackState(){return fe(this.data)?"empty":this.loaded?this.element.error?"errored":this.element.ended||this.element.paused&&this.element.currentTime===0?"stopped":this.element.paused?"paused":"playing":"loading"}async play(){await this.context.ready,await this.element.play()}async playThrough(){let e=dn(this,"stopped");await this.play(),await e}pause(){this.element.pause()}stop(){this.pause(),this.element.currentTime=0}restart(){return this.stop(),this.play()}};var no=class extends qe{constructor(e,n,i){super();this._scale=250;this._visible=!0;this.wasVisible=null;this.redrawnEvt=new Ae("redrawn");this.element=null;T(i)&&T(i.scale)&&(this._scale=i.scale),this._canvas=Kp(e,n),this._g=this.canvas.getContext("2d"),si(this._canvas)&&(this.element=this._canvas)}fillRect(e,n,i,o,s,l){this.g.fillStyle=e,this.g.fillRect(n+l,i+l,o-2*l,s-2*l)}drawText(e,n,i,o){this.g.textAlign=o,this.g.strokeText(e,n,i),this.g.fillText(e,n,i)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}onClear(){this.g.clearRect(0,0,this.canvas.width,this.canvas.height)}clear(){this.onClear(),this.dispatchEvent(this.redrawnEvt)}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(e){this.scale!==e&&(this._scale=e,this.redraw())}get visible(){return this._visible}set visible(e){this.visible!==e&&(this.wasVisible=this._visible,this._visible=e,this.redraw())}};var bh=class extends no{constructor(){super(128,128);this._pitchDegrees=0;this._headingDegrees=0;this.redraw()}get pitchDegrees(){return this._pitchDegrees}set pitchDegrees(e){e!==this.pitchDegrees&&(this._pitchDegrees=e,this.redraw())}get headingDegrees(){return this._headingDegrees}set headingDegrees(e){e!==this.headingDegrees&&(this._headingDegrees=e,this.redraw())}setPitchAndHeading(e,n){(e!==this.pitchDegrees||n!==this.headingDegrees)&&(this._pitchDegrees=e,this._headingDegrees=n,this.redraw())}onRedraw(){let e=at(this.pitchDegrees),n=at(this.headingDegrees-180),i=5,o=this.canvas.width-2*i,s=this.canvas.height-2*i,l=.5*o,c=.5*s,u=Math.sin(e),p=this.g;return p.save(),p.clearRect(0,0,this.canvas.width,this.canvas.height),p.translate(i,i),p.scale(l,c),p.translate(1,1),p.fillStyle="gray",p.beginPath(),p.arc(0,0,1,0,Jn),p.fill(),p.fillStyle="lightgrey",p.beginPath(),p.arc(0,0,1,0,xn,!0),p.fill(),p.save(),p.scale(1,Math.abs(u)),u<0&&(p.fillStyle="gray"),p.beginPath(),p.arc(0,0,1,0,xn,u<0),p.fill(),p.restore(),p.save(),p.shadowColor=Tr(64,64,64),p.shadowBlur=4,p.shadowOffsetX=3,p.shadowOffsetY=3,p.rotate(n),p.fillStyle="red",p.beginPath(),p.moveTo(-.1,0),p.lineTo(0,-.667),p.lineTo(.1,0),p.closePath(),p.fill(),p.fillStyle="white",p.beginPath(),p.moveTo(-.1,0),p.lineTo(0,.667),p.lineTo(.1,0),p.closePath(),p.fill(),p.restore(),p.beginPath(),p.strokeStyle="black",p.lineWidth=.1,p.arc(0,0,1,0,Jn),p.stroke(),p.restore(),!0}};function MS(r,t){return ed(r,Rr,t)}var bu=class extends Ae{constructor(){super("update");this.t=0;this.dt=0;this.sdt=0;this.fps=0}set(e,n){this.t=e,this.dt=n,this.sdt=ab(this.sdt,n,.01),n>0&&(this.fps=1e3/n)}},Sh=class extends bu{constructor(){super(),Object.seal(this)}};var Tl=class{constructor(t){this.timer=null;this.lt=-1;this.tickHandlers=new Array;this._targetFPS=null;this.targetFPS=t;let e=new Sh,n=0;this.onTick=i=>{this.lt>=0&&(n=i-this.lt,e.set(i,n),this.tick(e)),this.lt=i}}get targetFPS(){return this._targetFPS}set targetFPS(t){this._targetFPS=t}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){Wt(this.tickHandlers,t)}tick(t){for(let e of this.tickHandlers)e(t)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};var yh=class extends Tl{constructor(){super()}start(){if(!this.isRunning){let t=e=>{this.timer=requestAnimationFrame(t),this.onTick(e)};this.timer=requestAnimationFrame(t)}}stop(){this.isRunning&&(cancelAnimationFrame(this.timer),super.stop())}};var Hr=class{constructor(t){this.task=new mt(!1);this.element=De(Xe("dialog"),fn("none"),kn("dialogname",t),this.container=De(Xe("dialog-container"),this.titleElement=J0(Xe("title-bar"),t),this.contentArea=De(Xe("dialog-content")),De(Xe("dialog-controls"),this.confirmButton=yi("Confirm",Ne("confirm-button")),this.cancelButton=Ma("Cancel",Ne("cancel-button"))))),this.confirmButton.addEventListener("click",this.task.resolver(!0)),this.cancelButton.addEventListener("click",this.task.resolver(!1)),We(document.body,this)}get title(){return this._title}set title(t){Ye(this.titleElement,this._title=t)}async onShowing(){}onShown(){}async onConfirm(){}onCancel(){}async onClosing(){}onClosed(){}show(t){st(this,t)}get isOpen(){return zn(this)}hide(){this.show(!1)}async toggle(){this.isOpen?this.hide():this.showDialog()}async showDialog(){return await this.onShowing(),this.show(!0),this.onShown(),this.task.restart(),await this.task?await this.onConfirm():this.onCancel(),await this.onClosing(),this.show(!1),this.onClosed(),this.task.result}};var ui=20,Th=ui/2,ci=At.create();function kS(r,t){return r<0?0:r>t?t:Number.isFinite(r)?r:(console.trace("To infinity... and beyond!"),t)}var Eh=class extends Hr{constructor(e,n,i,o){super(e);this.getNodeName=n;this.getNodeColor=i;this.getWeightMod=o;this.timer=new yh;this.positions=new Map;this.forces=new Map;this.wasGrabbed=new Set;this.mousePoint=At.create();this.grabbed=null;this.graph=null;this.cancelButton.style.display="none";let s=xr(5);We(this.container,Kn(on(100)),go(on(100))),We(this.contentArea,De(fn("grid"),Cs("repeat(11, auto)",Go(1)),bp(yr(5)),Z1("center"),...Pa("limit"+s,"Limit",this.t=Vr(Ft(0),vt(1e3),ft(.1),hn(5))),...Pa("cooling"+s,"Cooling",this.cooling=nr()),...Pa("attract"+s,"Attract",this.attract=Vr(Ft(-100),vt(100),ft(.1),hn(1))),...Pa("repel"+s,"Repel",this.repel=Vr(Ft(-100),vt(100),ft(.1),hn(1))),...Pa("hideBare"+s,"Hide bare nodes",this.hideBare=nr(Dp(!0)))),this.canvas=Ca(fn("block"),Kn(on(100)),go(`calc(${on(100)} - ${mr(2)})`))),this.g=this.canvas.getContext("2d"),this.g.textAlign="center",this.g.textBaseline="middle",this.timer.addTickHandler(()=>{ux(this.canvas),this.fr91(),this.draw()});let l=At.create();this.canvas.addEventListener("mousedown",c=>{this.setMouse(c),this.grabbed=null;let u=.7071067811865475*ui;for(let p of this.graph){let f=this.positions.get(p);At.sub(l,f,this.mousePoint);let w=At.length(l);w<u&&(this.grabbed=p,this.wasGrabbed.has(p)?this.wasGrabbed.delete(p):this.wasGrabbed.add(p),u=w)}}),this.canvas.addEventListener("mousemove",c=>{this.setMouse(c)}),this.canvas.addEventListener("mouseup",()=>{this.grabbed=null})}get w(){return this.canvas.width-2*ui-200}get h(){return this.canvas.height-2*ui}setMouse(e){let n=e.offsetX*this.canvas.width/this.canvas.clientWidth-ui,i=e.offsetY*this.canvas.height/this.canvas.clientHeight-ui;At.set(this.mousePoint,n,i)}draw(){this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.g.fillStyle="black",this.g.strokeStyle="black",this.g.save(),this.g.translate(ui,ui);for(let e of this.graph){let n=this.positions.get(e);for(let i of e.connections){let o=this.positions.get(i);this.g.beginPath(),this.g.moveTo(n[0],n[1]),this.g.lineTo(o[0],o[1]),this.g.stroke()}}this.g.strokeStyle="lightgrey",this.g.save(),this.g.translate(-Th,-Th);for(let e of this.graph)if(e.isConnected||!this.hideBare.checked){this.g.fillStyle=Tr(243,243,243);let n=this.positions.get(e);this.g.fillStyle=this.getNodeColor(e.value),this.g.fillRect(n[0],n[1],ui,ui),this.g.strokeRect(n[0],n[1],ui,ui),this.g.fillStyle="black",this.g.fillText(this.getNodeName(e.value),n[0]+Th,n[1]+Th)}this.g.restore(),this.g.restore()}applyForces(e,n){let i=MS(this.graph,()=>At.create());for(let o of this.graph){let s=this.positions.get(o);if(o===this.grabbed)At.copy(s,this.mousePoint);else if(!this.wasGrabbed.has(o)){let l=i.get(o),c=this.forces.get(o);c&&At.add(l,l,c),At.set(ci,this.w,this.h),At.scaleAndAdd(ci,s,ci,-.5);let u=At.length(ci);if(u>0){At.normalize(ci,ci);let p=-1e4*u;p=Math.sign(p)*Math.pow(Math.abs(p),.2),At.scaleAndAdd(l,l,ci,p)}for(let p of this.graph)if(o!==p){let f=this.positions.get(p);At.sub(ci,f,s);let w=At.length(ci);if(w>0){At.normalize(ci,ci);let A=o.isConnectedTo(p),m=this.getWeightMod(o.value,p.value,A),d=2-m,h=m*this.attract.valueAsNumber*e(A,w)-d*this.repel.valueAsNumber*n(A,w);At.scaleAndAdd(l,l,ci,h)}}}}for(let o of this.graph){let s=i.get(o);s[1]*=this.h/this.w;let l=At.length(s);if(l>0){At.scale(s,s,Math.min(this.t.valueAsNumber,l)/l);let c=this.positions.get(o);At.add(c,c,s),c[0]=kS(c[0],this.w),c[1]=kS(c[1],this.h)}}this.cooling.checked&&(this.t.valueAsNumber*=.975)}fr91(){let e=this.w*this.h*.1,n=1,i=1.5,o=.1,s=n*Math.sqrt(e/this.graph.length);for(let l=0;l<2;++l)this.applyForces((c,u)=>c?i*Math.sqrt(u)*u/s:0,(c,u)=>o*s*s/u)}onShown(){super.onShown(),this.refreshData(),this.t.valueAsNumber=5,ux(this.canvas),this.timer.isRunning||this.timer.start()}refreshData(){this.positions.clear(),this.forces.clear(),this.wasGrabbed.clear();let e=Math.min(this.w,this.h)/2;for(let n=0;n<this.graph.length;++n){let i=this.graph[n],o=Jn*n/this.graph.length,s=e,l=s*Math.cos(o)+this.w/2,c=s*Math.sin(o)+this.h/2;this.positions.set(i,At.fromValues(l,c))}}setGraph(e){this.graph=e}onClosed(){this.timer.stop(),super.onClosed()}};function ile(r){return r.name}function ole(r){if(r.nodeClass==="node")return"lightgreen";if(r.nodeClass==="param")return"lightyellow";if(r.nodeClass==="unknown")return"pink";Ot(r.nodeClass)}function sle(r,t,e){return!e||r.nodeClass===t.nodeClass?1:1.8}var _h=class extends Eh{constructor(e){super("Audio graph",ile,ole,sle);this.context=e}refreshData(){let e=this.context.getAudioGraph(!1);this.setGraph(e),super.refreshData()}};function CS(r){return"getBattery"in r}var ale=["","N/A","charging"],El=class extends no{constructor(){super(256,128);this.battery=null;this.lastChargeDirection=null;this.lastLevel=null;this.chargeDirection=0;this.level=.5;CS(navigator)?this.readBattery(navigator):this.redraw()}onRedraw(){this.battery?(this.chargeDirection=this.battery.charging?1:-1,this.level=this.battery.level):(this.level+=.1,this.level>1&&(this.level=0));let e=this.chargeDirection!==this.lastChargeDirection,n=this.level!==this.lastLevel;if(!e&&!n)return!1;this.lastChargeDirection=this.chargeDirection,this.lastLevel=this.level;let i=this.level<.1?"red":"silver",o=7,s=.7,l=(1-s)/2,c=this.canvas.width-2*o,u=c-4*o,p=this.canvas.height-4*o,f=c/2,w=this.canvas.height/2,A=ale[this.chargeDirection+1];return this.g.clearRect(0,0,c,this.canvas.height),this.g.save(),this.g.translate(l*this.canvas.width,l*this.canvas.height),this.g.globalAlpha=.75,this.g.scale(s,s),this.fillRect("silver",0,0,c,this.canvas.height,0),this.fillRect("silver",c,w-2*o-10,o+10,4*o+20,0),this.g.clearRect(o,o,c-2*o,this.canvas.height-2*o),this.fillRect("black",o,o,c-2*o,this.canvas.height-2*o,0),this.g.clearRect(2*o,2*o,u*this.level,p),this.fillRect(i,2*o,2*o,u*this.level,p,0),this.g.fillStyle="white",this.g.strokeStyle="black",this.g.lineWidth=4,this.g.textBaseline="middle",this.g.font=cd({fontSize:p/2,fontFamily:"Lato"}),this.drawText(A,f,w,"center"),this.g.restore(),!0}async readBattery(e){let n=this.redraw.bind(this);n(),this.battery=await e.getBattery(),this.battery.addEventListener("chargingchange",n),this.battery.addEventListener("levelchange",n),setInterval(n,1e3),n()}};El.isAvailable=CS(navigator);var Li=class extends no{constructor(e){super(10,10,e);this.trueWidth=null;this.trueHeight=null;this.trueFontSize=null;this.dx=null;this._minWidth=null;this._maxWidth=null;this._minHeight=null;this._maxHeight=null;this._freezeDimensions=!1;this._dimensionsFrozen=!1;this._bgFillColor=null;this._bgStrokeColor=null;this._bgStrokeSize=null;this._textStrokeColor=null;this._textStrokeSize=null;this._textFillColor="black";this._textDirection="horizontal";this._fontStyle="normal";this._fontVariant="normal";this._fontWeight="normal";this._fontFamily="sans-serif";this._fontSize=20;this._value=null;this.lastValue=null;T(e)&&(T(e.minWidth)&&(this._minWidth=e.minWidth),T(e.maxWidth)&&(this._maxWidth=e.maxWidth),T(e.minHeight)&&(this._minHeight=e.minHeight),T(e.maxHeight)&&(this._maxHeight=e.maxHeight),T(e.freezeDimensions)&&(this._freezeDimensions=e.freezeDimensions),T(e.textStrokeColor)&&(this._textStrokeColor=e.textStrokeColor),T(e.textStrokeSize)&&(this._textStrokeSize=e.textStrokeSize),T(e.bgFillColor)&&(this._bgFillColor=e.bgFillColor),T(e.bgStrokeColor)&&(this._bgStrokeColor=e.bgStrokeColor),T(e.bgStrokeSize)&&(this._bgStrokeSize=e.bgStrokeSize),T(e.value)&&(this._value=e.value),T(e.textFillColor)&&(this._textFillColor=e.textFillColor),T(e.textDirection)&&(this._textDirection=e.textDirection),T(e.fontStyle)&&(this._fontStyle=e.fontStyle),T(e.fontVariant)&&(this._fontVariant=e.fontVariant),T(e.fontWeight)&&(this._fontWeight=e.fontWeight),T(e.fontFamily)&&(this._fontFamily=e.fontFamily),T(e.fontSize)&&(this._fontSize=e.fontSize),T(e.padding)&&(Rt(e.padding)?this._padding={left:e.padding,right:e.padding,top:e.padding,bottom:e.padding}:this._padding=e.padding)),fe(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(e){this.minWidth!==e&&(this._minWidth=e,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(e){this.maxWidth!==e&&(this._maxWidth=e,this.redraw())}get minHeight(){return this._minHeight}set minHeight(e){this.minHeight!==e&&(this._minHeight=e,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(e){this.maxHeight!==e&&(this._maxHeight=e,this.redraw())}get padding(){return this._padding}set padding(e){if(e instanceof Array)throw new Error("Invalid padding");(this.padding.top!==e.top||this.padding.right!=e.right||this.padding.bottom!=e.bottom||this.padding.left!=e.left)&&(this._padding=e,this.redraw())}get textDirection(){return this._textDirection}set textDirection(e){this.textDirection!==e&&(this._textDirection=e,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(e){this.fontStyle!==e&&(this._fontStyle=e,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(e){this.fontVariant!==e&&(this._fontVariant=e,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(e){this.fontWeight!==e&&(this._fontWeight=e,this.redraw())}get fontSize(){return this._fontSize}set fontSize(e){this.fontSize!==e&&(this._fontSize=e,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(e){this.textFillColor!==e&&(this._textFillColor=e,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(e){this.textStrokeColor!==e&&(this._textStrokeColor=e,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(e){this.textStrokeSize!==e&&(this._textStrokeSize=e,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(e){this.bgFillColor!==e&&(this._bgFillColor=e,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(e){this.bgStrokeColor!==e&&(this._bgStrokeColor=e,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(e){this.bgStrokeSize!==e&&(this._bgStrokeSize=e,this.redraw())}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.redraw())}split(e){return e.replace(/\r\n/g,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.onClear(),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value&&this.value!==this.lastValue){let e=this.split(this.value),n=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let o=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,s=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,l=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,c=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,u=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,p=n?c:s,f=n?u:l,w=n?s:c,A=n?l:u,m=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let d=!1,h=!1,M=1e4,k=0;this.trueFontSize=vr(this.fontSize*this.scale,k,M);let E=null,b=Number.MAX_VALUE;do{let y=this.fontSize;this._fontSize=this.trueFontSize;let V=cd(this);this._fontSize=y,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=V,this.trueWidth=0,this.trueHeight=0;for(let B of e){let D=this.g.measureText(B);this.trueWidth=Math.max(this.trueWidth,D.width),this.trueHeight+=this.trueFontSize,Rt(D.actualBoundingBoxLeft)&&Rt(D.actualBoundingBoxRight)&&Rt(D.actualBoundingBoxAscent)&&Rt(D.actualBoundingBoxDescent)&&(o||(this.trueWidth=D.actualBoundingBoxLeft+D.actualBoundingBoxRight,this.trueHeight=D.actualBoundingBoxAscent+D.actualBoundingBoxDescent,this.dx=(D.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(o){let B=this.trueWidth-p,D=this.trueWidth-f,L=this.trueHeight-w,J=this.trueHeight-A,ae=Math.abs(B),Q=Math.abs(D),ee=Math.abs(L),K=Math.abs(J);d=D>1||J>1,h=B<-1&&L<-1;let $=Math.min(ae,Math.min(Q,Math.min(ee,K)));$<b&&(b=$,E=this.g.font),(d||h)&&m.indexOf(this.g.font)>-1&&E&&(this.g.font=E,d=!1,h=!1),d?(M=this.trueFontSize,this.trueFontSize=(k+this.trueFontSize)/2):h&&(k=this.trueFontSize,this.trueFontSize=(this.trueFontSize+M)/2)}m.push(this.g.font)}while(d||h);o&&(this.trueWidth<p?this.trueWidth=p:this.trueWidth>f&&(this.trueWidth=f),this.trueHeight<w?this.trueHeight=w:this.trueHeight>A&&(this.trueHeight=A));let g=this.trueWidth+this.scale*(this.padding.right+this.padding.left),v=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{Jc(this.g,g,v)}catch(y){throw console.error(y),y}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let i=.5*(e.length-1);for(let o=0;o<e.length;++o){let s=e[o],l=(o-i)*this.trueFontSize,c=this.dx+this.trueWidth/2+this.scale*this.padding.left,u=l+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(s,c,u),this.textFillColor&&this.g.fillText(s,c,u)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let o=this.bgStrokeSize/2;this.g.strokeRect(o,o,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(n){let o=Mi(this.canvas.height,this.canvas.width),s=o.getContext("2d");s?(s.translate(o.width/2,o.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?s.rotate(bn):this.textDirection==="vertical-right"&&s.rotate(-bn),s.translate(-this.canvas.width/2,-this.canvas.height/2),s.drawImage(this.canvas,0,0),Jc(this.g,o.width,o.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(o,0,0)}return this.lastValue=this.value,!0}else{let e=this.value!==this.lastValue;return this.lastValue=this.value,e}}};var Mh=class extends Li{constructor(){super({textFillColor:"white",textStrokeColor:Tr(0,0,0,.5),textStrokeSize:.025,fontFamily:ba(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,freezeDimensions:!0});let t=this.update.bind(this);setInterval(t,500),t()}update(){let e=new Date().toLocaleTimeString();(fe(this.value)||e.length!==this.value.length)&&this.unfreeze(),this.value=e}};var kh=class extends Li{constructor(){super({textFillColor:"white",textStrokeColor:Tr(0,0,0,.5),textStrokeSize:.025,fontFamily:ba(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,freezeDimensions:!0});this.fps=null;this.drawCalls=null;this.triangles=null}setStats(e,n,i){this.fps=e,this.drawCalls=n,this.triangles=i;let o=` ${Math.round(this.fps).toFixed(0)}hz ${this.drawCalls}c ${this.triangles}t`;(fe(this.value)||o.length!==this.value.length)&&this.unfreeze(),this.value=o}};var DS="calla:preferredVideoInputID",Ch=class extends qe{constructor(){super();this.element=Is(Lp(!0));this._hasPermission=!1;this._device=null;this._enabled=!1;Object.seal(this)}get mediaType(){return"video"}get deviceKind(){return`${this.mediaType}input`}get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.onChange())}get hasPermission(){return this._hasPermission}get preferredDeviceID(){return localStorage.getItem(DS)}get device(){return this._device}checkDevices(e){if(!this.hasPermission){for(let n of e)if(n.kind===this.deviceKind&&n.deviceId.length>0&&n.label.length>0){this._hasPermission=!0;break}}}async setDevice(e){if(T(e)&&e.kind!==this.deviceKind)throw new Error(`Device is not an vide input device. Was: ${e.kind}. Label: ${e.label}`);let n=this.device&&this.device.deviceId||null,i=e&&e.deviceId||null;i!==n&&(this._device=e,localStorage.setItem(DS,i),await this.onChange())}async onChange(){this.dispatchEvent(new Al);let e=this.inStream;this.device&&this.enabled?this.inStream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.device.deviceId,autoGainControl:!0,height:640,noiseSuppression:!0}}):this.inStream=null,this.inStream!==e&&this.dispatchEvent(new bl(e,this.outStream))}get inStream(){return this.element.srcObject}set inStream(e){e!==this.inStream&&(this.inStream&&this.element.pause(),this.element.srcObject=e,this.inStream&&this.element.play())}get outStream(){return this.inStream}stop(){this.inStream=null}};var PS="local-user";function LS(r,t){return r==="click"&&t&&(r="error"),`InteractionAudio-${r}`}var Dh=class{constructor(t,e){this.audio=t;this.eventSys=e;let n=i=>{if(i.pointer.type!=="nose"&&i.rayTarget&&i.rayTarget.clickable){let o=LS(i.type,!i.rayTarget.enabled);if(this.audio.hasClip(o)){let{x:s,y:l,z:c}=i.point;this.audio.setClipPosition(o,s,l,c),this.audio.playClip(o)}}};this.eventSys.addEventListener("enter",n),this.eventSys.addEventListener("exit",n),this.eventSys.addEventListener("click",n)}create(t,e,n){return this.audio.createClip(LS(t,!1),e,!1,!0,!1,!0,n,[])}};var Su=(i=>(i.None="None",i.Fullscreen="Fullscreen",i.VR="VR",i.AR="AR",i))(Su||{});var Ph=class{constructor(t){_r("Juniper.ThreeJS.ScreenUI.ButtonFillColor",()=>dF($1("#appContainer > .row > .cell > .btn",e0(t)))),this.elements=[this.topLeft=De(Ne("cell","top","left")),this.topCenter=De(Ne("cell","top","center")),this.topRight=De(Ne("cell","top","right")),this.middleLeft=De(Ne("cell","middle","left")),this.middleCenter=De(Ne("cell","middle","center")),this.middleRight=De(Ne("cell","middle","right")),this.bottomLeft=De(Ne("cell","bottom","left")),this.bottomCenter=De(Ne("cell","bottom","center")),this.bottomRight=De(Ne("cell","bottom","right"))],this.cells=[[this.topLeft,this.topCenter,this.topRight],[this.middleLeft,this.middleCenter,this.middleRight],[this.bottomLeft,this.bottomCenter,this.bottomRight]],this.hide()}show(){this.elements.forEach(t=>t.style.removeProperty("display"))}hide(){this.elements.forEach(t=>t.style.display="none")}};function IS(r){return"height"in r}function RS(r){return"width"in r}var lle=1.25,cle=at(30),ule=at(32),Lh=class extends Et{constructor(){super(),this.name="SpaceUI",this.position.y=-.25}addItem(t,e){t=Gn(t),je(this,t),t.rotation.set(e.y*ule,-e.x*cle,0,"YXZ"),t.position.set(0,0,-lle).applyEuler(t.rotation),IS(e)&&RS(e)?t.scale.set(e.width,e.height,1):IS(e)?t.scale.multiplyScalar(e.height/t.scale.y):RS(e)?t.scale.multiplyScalar(e.width/t.scale.x):t.scale.setScalar(e.scale),t.scale.z=1}};function BS(r){return et(r.vcodec)}var Mo=class extends Zi{constructor(e,n,i){let o=Mo.createMediaElement(Is,Br(!0)),s=Mo.createMediaElement(ii,Br(!1)),l=new Pi(n,{mediaElement:o});l.name=`${e}-video`;let c=new Pi(n,{mediaElement:s});c.name=`${e}-audio`;super(e,n,i,[],[l,c]);this.onTimeUpdate=null;this.wasUsingAudioElement=!1;this.nextStartTime=null;this._data=null;this._loaded=!1;this.onError=new Map;this.sourcesByURL=new Map;this.sources=new gn;this.potatoes=new gn;l.connect(this.volumeControl),c.connect(this.volumeControl),this.video=o,this.audio=s,this.loadingEvt=new Sl(this),this.loadEvt=new is(this),this.playEvt=new os(this),this.pauseEvt=new ss(this),this.stopEvt=new as(this),this.progEvt=new ls(this),this.onSeeked=()=>{this.useAudioElement&&(this.audio.currentTime=this.video.currentTime)},this.onPlay=async()=>{this.onSeeked(),this.useAudioElement&&(await this.context.ready,await this.audio.play()),this.dispatchEvent(this.playEvt)},this.onPause=p=>{this.useAudioElement&&(this.onSeeked(),this.audio.pause()),this.video.currentTime===0||p.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};let u=!1;this.onWaiting=()=>{this.useAudioElement&&(u=!0,this.audio.pause())},this.onCanPlay=async()=>{this.useAudioElement&&u&&(await this.context.ready,await this.audio.play(),u=!1)},this.wasUsingAudioElement=!1,this.onTimeUpdate=async()=>{if(this.video.getVideoPlaybackQuality().totalVideoFrames===0){let f=this.onError.get(this.video);T(f)&&await f()}else if(this.useAudioElement){this.wasUsingAudioElement=!1;let f=this.video.currentTime-this.audio.currentTime;Math.abs(f)>.25&&(this.audio.currentTime=this.video.currentTime)}else this.wasUsingAudioElement||(this.wasUsingAudioElement=!0,this.audio.pause());this.progEvt.value=this.video.currentTime,this.progEvt.total=this.video.duration,this.dispatchEvent(this.progEvt)},this.video.addEventListener("seeked",this.onSeeked),this.video.addEventListener("play",this.onPlay),this.video.addEventListener("pause",this.onPause),this.video.addEventListener("ended",this.onPause),this.video.addEventListener("waiting",this.onWaiting),this.video.addEventListener("canplay",this.onCanPlay),this.video.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{videoPlayer:this})}get data(){return this._data}get loaded(){return this._loaded}get title(){return this.video.title}setTitle(e){this.video.title=e,this.audio.title=e}elementHasAudio(e){let n=this.sourcesByURL.get(e.src);return T(n)&&n.acodec!=="none"||T(e.audioTracks)&&e.audioTracks.length>0||T(e.webkitAudioDecodedByteCount)&&e.webkitAudioDecodedByteCount>0||T(e.mozHasAudio)&&e.mozHasAudio}get useAudioElement(){return!this.elementHasAudio(this.video)&&this.elementHasAudio(this.audio)}onDisposing(){this.clear(),this.video.removeEventListener("seeked",this.onSeeked),this.video.removeEventListener("play",this.onPlay),this.video.removeEventListener("pause",this.onPause),this.video.removeEventListener("ended",this.onPause),this.video.removeEventListener("waiting",this.onWaiting),this.video.removeEventListener("canplay",this.onCanPlay),this.video.removeEventListener("timeupdate",this.onTimeUpdate),super.onDisposing(),this.audio.dispatchEvent(Fl),this.video.dispatchEvent(Fl)}clear(){this.stop();for(let[e,n]of this.onError)e.removeEventListener("error",n);this.onError.clear(),this.sourcesByURL.clear(),this.sources.clear(),this.potatoes.clear(),this.video.src="",this.audio.src="",this.wasUsingAudioElement=!1,this._data=null,this._loaded=!1}async load(e,n){if(this.clear(),this._data=e,et(e)?(this.setTitle(e),this.potatoes.add(this.video,e)):(this.setTitle(e.title),this.fillSources(this.video,e.videos),this.fillSources(this.audio,e.audios)),!this.hasSources(this.video))throw new Error("No video sources found");if(this.dispatchEvent(this.loadingEvt),await hF(n,i=>this.loadMediaElement(this.audio,i),i=>this.loadMediaElement(this.video,i)),et(e)?this.nextStartTime=null:this.nextStartTime=e.startTime,!this.hasSources(this.video))throw new Error("No video playable sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}fillSources(e,n){Ds(n,i=>-i.resolution);for(let i of n)tx.matches(i.contentType)||(this.sources.add(e,i),this.sourcesByURL.set(i.url,i))}static createMediaElement(e,...n){return e(xo(!1),Ko(!1),...n)}async getMediaCapabilities(e){let n={type:"file"};BS(e)?n.video={contentType:e.contentType,bitrate:e.vbr*1024,framerate:e.fps,width:e.width,height:e.height}:e.acodec!=="none"&&(n.audio={contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr});try{return await navigator.mediaCapabilities.decodingInfo(n)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:n}}}hasSources(e){return this.sources.get(e).length>0||this.potatoes.count(e)>0}async loadMediaElement(e,n){for(T(n)&&n.start(),this.onError.has(e)&&(e.removeEventListener("error",this.onError.get(e)),this.onError.delete(e));this.hasSources(e);){let i=null,o=this.sources.get(e).shift();if(T(o)){let s=await this.getMediaCapabilities(o);if(!s.smooth||!s.powerEfficient){this.potatoes.add(e,o.url);continue}else i=o.url}else i=this.potatoes.get(e).shift();if(e.src=i,e.load(),await Vp(e)){T(o)?this.sources.get(e).unshift(o):this.potatoes.get(e).unshift(i);let s=()=>this.loadMediaElement(e,n);e.addEventListener("error",s),this.onError.set(e,s),this.wasUsingAudioElement=this.wasUsingAudioElement,T(n)&&n.end();return}}}get width(){return this.video.videoWidth}get height(){return this.video.videoHeight}get playbackState(){return fe(this.data)?"empty":this.loaded?this.video.error?"errored":this.video.ended||this.video.paused&&this.video.currentTime===0?"stopped":this.video.paused?"paused":"playing":"loading"}async play(){await this.context.ready,T(this.nextStartTime)&&this.nextStartTime>0&&(this.video.pause(),this.video.currentTime=this.nextStartTime,this.nextStartTime=null),await this.video.play()}async playThrough(){let e=dn(this,"stopped");await this.play(),await e}pause(){this.video.pause()}stop(){this.pause(),this.video.currentTime=0}restart(){return this.stop(),this.play()}};function VS(r,t){let e=r*xn;return .5*(1-Math.cos(e))-t*Math.sin(2*e)}function OS(r,t){let e=(r-.5)*xn;return r*r+t*Math.cos(e)}var Js=_r("Juniper:ScaledItems",()=>new Map),NS=1,ple=1.1,dle=.005,rw=class{constructor(t){this.target=t;this.obj=Gn(this.target),this.base=this.obj.scale.clone(),this.p=0,this.dir=0,this.running=!1,this.wasDisabled=this.disabled,this.target.addScopedEventListener(this,"enter",e=>{e.pointer.type!=="nose"&&this.run(1)}),this.target.addScopedEventListener(this,"exit",e=>{e.pointer.type!=="nose"&&this.run(-1)}),this.obj.traverse(e=>{or(e)&&this.target.addMesh(e)})}get disabled(){return this.target.disabled}run(t){(!this.disabled||t===-1||this.p>0)&&(this.dir=t,this.running=!0)}updateScaling(t){if(this.disabled!==this.wasDisabled&&(this.wasDisabled=this.disabled,this.disabled&&this.run(-1)),this.running){this.p+=this.dir*t,(this.dir>0&&this.p>=1||this.dir<0&&this.p<0)&&(this.p=Math.max(0,Math.min(1,this.p)),this.running=!1);let e=VS(this.p,1.1);this.obj.scale.copy(this.base).multiplyScalar(e*(ple-NS)+NS)}}dispose(){this.target.removeScope(this)}};function HS(r){r*=dle;for(let t of Js.values())t.updateScaling(r)}function WS(r){let t=Js.get(r);t&&(Js.delete(r),zt(t))}function Ih(r,t){let e=Js.has(r);if(t!=e)if(t)Js.set(r,new rw(r));else{let n=Js.get(r);zt(n),Js.delete(r)}}function St(r){let t=new Array,e=new Set;for(t.push(r);t.length>0;){let n=t.shift();n&&!e.has(n)&&(e.add(n),n.isMesh&&t.push(n.material,n.geometry),n.isMaterial&&t.push(...Object.values(n)),n.isObject3D&&(t.push(...n.children),n.clear(),WS(n)),hr(n)&&t.push(...n),$o(n))}e.clear()}function hle(r){return[zS([r[1],r[0],r[2]]),zS([r[2],r[0],r[3]])]}function GS(r){return r.map(hle).flat()}var iw=new Ie,US=new Ie,Rh=new Ie;function zS(r){let t=[[r[0][0],r[0][1],r[0][2]],[r[1][0],r[1][1],r[1][2]],[r[2][0],r[2][1],r[2][2]]],e=[[r[0][3],r[0][4]],[r[1][3],r[1][4]],[r[2][3],r[2][4]]];Rh.fromArray(t[0]),iw.fromArray(t[1]).sub(Rh),Rh.fromArray(t[2]),US.fromArray(t[1]).sub(Rh),iw.cross(US);let n=iw.toArray();return{positions:t,uvs:e,normal:n}}function XS(r){let t=r.map(o=>o.positions).flat(2),e=r.map(o=>o.uvs).flat(2),n=r.flatMap(o=>o.normal),i=new ou;return i.setAttribute("position",new Eo(new Float32Array(t),3,!1)),i.setAttribute("uv",new Eo(new Float32Array(e),2,!1)),i.setAttribute("normal",new Eo(new Float32Array(n),3,!0)),i}function Ii(...r){let t=GS(r);return XS(t)}function _l(r,...t){let e=mle(t);for(let i=0;i<r;++i)e=gle(e);t=fle(e);let n=GS(t);return XS(n)}function mle(r){return r.map(t=>{let e=Number.MAX_VALUE,n=Number.MIN_VALUE,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(let c of t){let u=c[3],p=c[4];e=Math.min(e,u),n=Math.max(n,u),i=Math.min(i,p),o=Math.max(o,p)}let s=[e,i],l=[n-e,o-i];return{minUV:s,deltaUV:l,verts:[Bh(s,l,t[0]),Bh(s,l,t[1]),Bh(s,l,t[2]),Bh(s,l,t[3])]}})}function Bh(r,t,e){return{pos:[e[0],e[1],e[2]],uv:[e[3],e[4]],pUV:[(e[3]-r[0])/t[0],(e[4]-r[1])/t[1]]}}function fle(r){return r.map(t=>[Vh(t,0),Vh(t,1),Vh(t,2),Vh(t,3)])}function Vh(r,t){let e=r.verts[t];return[e.pos[0],e.pos[1],e.pos[2],e.uv[0],e.uv[1]]}function gle(r){return r.flatMap(t=>{let e=yu(t,t.verts[0],t.verts[1]),n=yu(t,t.verts[2],t.verts[3]),i=yu(t,t.verts[0],t.verts[3]),o=yu(t,t.verts[1],t.verts[2]),s=yu(t,e,n);return[{minUV:t.minUV,deltaUV:t.deltaUV,verts:[t.verts[0],e,s,i]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[e,t.verts[1],o,s]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[s,o,t.verts[2],n]},{minUV:t.minUV,deltaUV:t.deltaUV,verts:[i,s,n,t.verts[3]]}]})}function yu(r,t,e){let n=e.pos[0]-t.pos[0],i=e.pos[1]-t.pos[1],o=e.pos[2]-t.pos[2],s=t.pos[0]+.5*n,l=t.pos[1]+.5*i,c=t.pos[2]+.5*o,u=e.pUV[0]-t.pUV[0],p=e.pUV[1]-t.pUV[1],f=t.pUV[0]+.5*u,w=t.pUV[1]+.5*p,A=jS(f-.5)+.5,m=jS(w-.5)+.5,d=A*r.deltaUV[0]+r.minUV[0],h=m*r.deltaUV[1]+r.minUV[1];return{pos:[s,l,c],pUV:[f,w],uv:[d,h]}}function jS(r){return Math.atan(2*r)/bn}var qS=304.79999999999995,BMe=qS*3,ow=10*100,xle=qS*16.5,wle=xle*40,VMe=ow*1e3,OMe=wle*8,KS=2.54*4,YS=KS*3,NMe=YS*3,vle=YS*16.5,Fle=vle*40,HMe=100*1e3,WMe=Fle*8,sw=4*3,Ale=sw*3,Tu=100/2.54,ble=sw*16.5,Sle=ble*40,UMe=Tu*1e3,zMe=Sle*8,jMe=3*3,yle=100/KS,Tle=3*16.5,Ele=Tle*40,GMe=yle*1e3,XMe=Ele*8,aw=Tu/sw,_le=16.5*40,qMe=aw*1e3,KMe=_le*8,Mle=Tu/Ale,kle=16.5/3,Cle=kle*40,YMe=Mle*1e3,JMe=Cle*8,JS=16.5/aw,QS=JS*40,QMe=QS*8,$Me=1e3/JS,ZMe=40*8,Dle=1e3/QS,e2e=8/Dle;function $S(r){return r/aw}function cs(r){return r/Tu}function Oh(r){return r*ow}function ZS(r){return r*Tu}function Nh(r){return r/ow}var Ple=new Vt,Hh=new Ie,ey=new Ji,ty=new xt;function lw(r,t,e){return Ple.copy(r.matrixWorld).invert().multiply(t.matrixWorld).decompose(Hh,ty,e),ey.set(Hh.x,Hh.y,Hh.z,1),new XRRigidTransform(ey,ty)}var cw=new Qa(1,1,1,1);cw.name="PlaneGeom";var Ml=new Ie,Lle=0,Ri=class extends Et{constructor(e,n,i,o=null){super();this.webXRLayerType=i;this.lastMatrixWorld=new Vt;this._imageWidth=0;this._imageHeight=0;this.forceUpdate=!1;this.wasUsingLayer=!1;this.layer=null;this.curImage=null;this.lastImage=null;this.lastWidth=null;this.lastHeight=null;this.env=null;this.mesh=null;this.stereoLayoutName="mono";this.sizeMode="none";if(e){this.setEnvAndName(e,n);let s=nS(o)?o:rl(Object.assign({},o,{name:this.name}));je(this,this.mesh=Di(n+"-Mesh",cw,s))}}copy(e,n=!0){return super.copy(e,n),this.webXRLayerType=e.webXRLayerType,this.setImageSize(e.imageWidth,e.imageHeight),this.setEnvAndName(e.env,e.name+ ++Lle),this.mesh=Mn(this.children,or),fe(this.mesh)&&(this.mesh=e.mesh.clone(),je(this,this.mesh)),this.setTextureMap(e.curImage),this}dispose(){this.env.removeScope(this),this.disposeImage(),St(this.mesh)}disposeImage(){this.removeWebXRLayer(),St(this.mesh.material.map),this.curImage=null}setImageSize(e,n){if(e!==this.imageWidth||n!==this.imageHeight){let{objectWidth:i,objectHeight:o}=this;this._imageWidth=e,this._imageHeight=n,this.sizeMode!=="none"&&(this.sizeMode==="fixed-width"?this.objectWidth=i:this.objectHeight=o)}}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get imageAspectRatio(){return this.imageWidth/this.imageHeight}get objectWidth(){return this.scale.x}set objectWidth(e){this.scale.set(e,this.scale.y=e/this.imageAspectRatio,1)}get objectHeight(){return this.scale.y}set objectHeight(e){this.scale.set(this.imageAspectRatio*e,e,1)}get pixelDensity(){let e=ZS(this.objectWidth);return this.imageWidth/e}set pixelDensity(e){let n=this.imageWidth/e,i=cs(n);this.objectWidth=i}setEnvAndName(e,n){this.env=e,this.name=n,this.env.addScopedEventListener(this,"update",i=>this.checkWebXRLayer(i.frame))}get needsLayer(){return!Nd(this)||fe(this.mesh.material.map)||fe(this.curImage)?!1:this.curImage instanceof HTMLVideoElement?!this.curImage.paused||this.curImage.currentTime>0:!0}removeWebXRLayer(){if(T(this.layer)){this.wasUsingLayer=!1,this.env.removeWebXRLayer(this.layer),this.mesh.visible=!0;let e=this.layer;this.layer=null,setTimeout(()=>$o(e),100)}}setTextureMap(e){this.curImage&&this.disposeImage(),e&&(Xp(e)?e=AF(e):wF(e)&&(e=bF(e)),Gp(e)&&(e=e),this.curImage=e,e instanceof HTMLVideoElement?(this.setImageSize(e.videoWidth,e.videoHeight),this.mesh.material.map=new Qb(e)):(this.setImageSize(e.width,e.height),this.mesh.material.map=new Gs(e),this.mesh.material.map.needsUpdate=!0)),this.mesh.material.needsUpdate=!0}get isVideo(){return this.curImage instanceof HTMLVideoElement}updateTexture(){if(T(this.curImage)){let e=this.curImage,n=this.isVideo?e.videoWidth:this.curImage.width,i=this.isVideo?e.videoHeight:this.curImage.height;if(this.imageWidth!==n||this.imageHeight!==i){let o=this.curImage;this.disposeImage(),this.setTextureMap(o)}else this.mesh.material.map.needsUpdate=this.forceUpdate=!0}}checkWebXRLayer(e){if(this.mesh.material.map&&this.curImage){let i=this.webXRLayerType!=="none"&&this.env.hasXRCompositionLayers&&this.env.showWebXRLayers&&T(e)&&(this.isVideo&&T(this.env.xrMediaBinding)||!this.isVideo&&T(this.env.xrBinding))&&this.needsLayer,o=i!==this.wasUsingLayer,s=this.curImage!==this.lastImage||this.mesh.material.needsUpdate||this.mesh.material.map.needsUpdate||this.forceUpdate,l=this.imageWidth!==this.lastWidth||this.imageHeight!==this.lastHeight;if(this.wasUsingLayer=i,this.lastImage=this.curImage,this.lastWidth=this.imageWidth,this.lastHeight=this.imageHeight,(o||l)&&((!i||l)&&this.layer&&this.removeWebXRLayer(),i)){let c=this.env.referenceSpace,u=lw(this.env.stage,this.mesh,Ml);this.lastMatrixWorld.copy(this.matrixWorld);let p=Ml.x/2,f=Ml.y/2,w=this.stereoLayoutName==="mono"?"mono":this.stereoLayoutName==="left-right"||this.stereoLayoutName==="right-left"?"stereo-left-right":"stereo-top-bottom";if(this.isVideo){let A=this.stereoLayoutName==="right-left"||this.stereoLayoutName==="bottom-top";this.layer=this.env.xrMediaBinding.createQuadLayer(this.curImage,{space:c,layout:w,invertStereo:A,transform:u,width:p,height:f})}else this.layer=this.env.xrBinding.createQuadLayer({space:c,layout:w,textureType:"texture",isStatic:this.webXRLayerType==="static",viewPixelWidth:this.curImage.width,viewPixelHeight:this.curImage.height,transform:u,width:p,height:f});this.env.addWebXRLayer(this.layer,500),this.mesh.visible=!1}if(this.layer){if(s||this.layer.needsRedraw){let c=this.env.gl,u=this.env.xrBinding.getSubImage(this.layer,e);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!0),c.bindTexture(c.TEXTURE_2D,u.colorTexture),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.curImage),c.generateMipmap(c.TEXTURE_2D),c.bindTexture(c.TEXTURE_2D,null),this.forceUpdate=!1}kp(this.matrixWorld.elements,this.lastMatrixWorld.elements)>=0&&(this.layer.transform=lw(this.env.stage,this.mesh,Ml),this.lastMatrixWorld.copy(this.matrixWorld),this.layer.width=Ml.x/2,this.layer.height=Ml.y/2)}else this.forceUpdate=!1}}};var ry=["N/A","Cubemap","Cubemap Strips","Equi-Angular Cubemap (YouTube)","Equirectangular","Half Equirectangular","Panoramic"],iy=["mono","left-right","right-left","top-bottom","bottom-top"],Uh=class extends Mo{constructor(e,n,i){super("video-player-3d",n,i);this.material=rl({name:"videoPlayer-material"}),this.vidMeshes=[];for(let o=0;o<2;++o){let s=new Ri(e,`videoPlayer-view${o+1}`,"none",this.material);s.setTextureMap(this.video),s.mesh.renderOrder=4,o>0?s.mesh.layers.disable(0):s.mesh.layers.enable(0),this.vidMeshes.push(s)}this.object=Dt("videoPlayer",...this.vidMeshes)}get meshes(){return this.vidMeshes.map(e=>e.mesh)}onDisposing(){super.onDisposing(),St(this.object),ct(this.vidMeshes)}isSupported(e,n){return n.split("-").map(i=>ny.has(e,i)).reduce(g0,!0)}setStereoParameters(e,n){if(!this.isSupported(e,n))throw new Error(`Not supported [encoding: ${e}, layout: ${n}]`);for(let s=0;s<this.vidMeshes.length;++s){let l=this.vidMeshes[s];l.webXRLayerType="none",l.mesh.layers.disable(1),l.mesh.layers.disable(2),n==="left-right"||n==="top-bottom"?l.mesh.layers.enable(this.vidMeshes.length-s):n!=="mono"&&l.mesh.layers.enable(s+1)}let i=this.height/this.width;e!=="N/A"?this.vidMeshes[0].scale.setScalar(100):n==="mono"?this.vidMeshes[0].scale.set(1,i,1):n==="left-right"||n==="right-left"?this.vidMeshes[0].scale.set(1,2*i,1):this.vidMeshes[0].scale.set(1,.5*i,1);for(let s=1;s<this.vidMeshes.length;++s)this.vidMeshes[s].scale.copy(this.vidMeshes[0].scale);let o=n.split("-");for(let s=0;s<o.length;++s){let l=o[s],c=ny.get(e,l),u=this.vidMeshes[s];u.webXRLayerType="dynamic",u.visible=!0,u.mesh.geometry!==c&&(St(u.mesh.geometry),u.mesh.geometry=c)}}},Ile=Ii([[-1/2,1/2,0,0,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,0,0]]),oy=[[-1/2,1/2,0,0,1],[1/2,1/2,0,.5,1],[1/2,-1/2,0,.5,0],[-1/2,-1/2,0,0,0]],sy=[[-1/2,1/2,0,.5,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,.5,0]],ay=[[[-1/2,1/2,-1/2,1/3,1],[1/2,1/2,-1/2,2/3,1],[1/2,-1/2,-1/2,2/3,1/2],[-1/2,-1/2,-1/2,1/3,1/2]],[[1/2,1/2,-1/2,2/3,1],[1/2,1/2,1/2,1,1],[1/2,-1/2,1/2,1,1/2],[1/2,-1/2,-1/2,2/3,1/2]],[[-1/2,1/2,1/2,0,1],[-1/2,1/2,-1/2,1/3,1],[-1/2,-1/2,-1/2,1/3,1/2],[-1/2,-1/2,1/2,0,1/2]],[[1/2,1/2,1/2,2/3,1/2],[-1/2,1/2,1/2,2/3,0],[-1/2,-1/2,1/2,1/3,0],[1/2,-1/2,1/2,1/3,1/2]],[[1/2,1/2,-1/2,1,1/2],[-1/2,1/2,-1/2,1,0],[-1/2,1/2,1/2,2/3,0],[1/2,1/2,1/2,2/3,1/2]],[[1/2,-1/2,1/2,1/3,1/2],[-1/2,-1/2,1/2,1/3,0],[-1/2,-1/2,-1/2,0,0],[1/2,-1/2,-1/2,0,1/2]]],uw=[[[-1/2,1/2,-1/2,0,1/3],[1/2,1/2,-1/2,0,2/3],[1/2,-1/2,-1/2,1/4,2/3],[-1/2,-1/2,-1/2,1/4,1/3]],[[1/2,1/2,-1/2,0,2/3],[1/2,1/2,1/2,0,1],[1/2,-1/2,1/2,1/4,1],[1/2,-1/2,-1/2,1/4,2/3]],[[-1/2,1/2,1/2,0,0],[-1/2,1/2,-1/2,0,1/3],[-1/2,-1/2,-1/2,1/4,1/3],[-1/2,-1/2,1/2,1/4,0]],[[1/2,1/2,1/2,1/4,2/3],[-1/2,1/2,1/2,1/2,2/3],[-1/2,-1/2,1/2,1/2,1/3],[1/2,-1/2,1/2,1/4,1/3]],[[1/2,1/2,-1/2,1/4,1],[-1/2,1/2,-1/2,1/2,1],[-1/2,1/2,1/2,1/2,2/3],[1/2,1/2,1/2,1/4,2/3]],[[1/2,-1/2,1/2,1/4,1/3],[-1/2,-1/2,1/2,1/2,1/3],[-1/2,-1/2,-1/2,1/2,0],[1/2,-1/2,-1/2,1/4,0]]],pw=[[[-1/2,1/2,-1/2,1/2,1/3],[1/2,1/2,-1/2,1/2,2/3],[1/2,-1/2,-1/2,3/4,2/3],[-1/2,-1/2,-1/2,3/4,1/3]],[[1/2,1/2,-1/2,1/2,2/3],[1/2,1/2,1/2,1/2,1],[1/2,-1/2,1/2,3/4,1],[1/2,-1/2,-1/2,3/4,2/3]],[[-1/2,1/2,1/2,1/2,0],[-1/2,1/2,-1/2,1/2,1/3],[-1/2,-1/2,-1/2,3/4,1/3],[-1/2,-1/2,1/2,3/4,0]],[[1/2,1/2,1/2,3/4,2/3],[-1/2,1/2,1/2,1,2/3],[-1/2,-1/2,1/2,1,1/3],[1/2,-1/2,1/2,3/4,1/3]],[[1/2,1/2,-1/2,3/4,1],[-1/2,1/2,-1/2,1,1],[-1/2,1/2,1/2,1,2/3],[1/2,1/2,1/2,3/4,2/3]],[[1/2,-1/2,1/2,3/4,1/3],[-1/2,-1/2,1/2,1,1/3],[-1/2,-1/2,-1/2,1,0],[1/2,-1/2,-1/2,3/4,0]]],Rle=Ii(oy),Ble=Ii(sy),Vle=Ii(dw(oy)),Ole=Ii(dw(sy)),ly=uy(uw),cy=uy(pw),Nle=Ii(...ay),Hle=Ii(...uw),Wle=Ii(...pw),Ule=Ii(...ly),zle=Ii(...cy),Eu=4,jle=_l(Eu,...ay),Gle=_l(Eu,...uw),Xle=_l(Eu,...pw),qle=_l(Eu,...ly),Kle=_l(Eu,...cy),ny=new Yn([["N/A","mono",Ile],["N/A","left",Rle],["N/A","right",Ble],["N/A","top",Vle],["N/A","bottom",Ole],["Cubemap Strips","mono",Nle],["Cubemap Strips","left",Hle],["Cubemap Strips","right",Wle],["Cubemap Strips","top",Ule],["Cubemap Strips","bottom",zle],["Equi-Angular Cubemap (YouTube)","mono",jle],["Equi-Angular Cubemap (YouTube)","left",Gle],["Equi-Angular Cubemap (YouTube)","right",Xle],["Equi-Angular Cubemap (YouTube)","top",qle],["Equi-Angular Cubemap (YouTube)","bottom",Kle]]);function Wh(r){return[r[0],r[1],r[2],r[4],1-r[3]]}function dw(r){return[Wh(r[0]),Wh(r[1]),Wh(r[2]),Wh(r[3])]}function uy(r){return r.map(dw)}var ko=class extends Ha{constructor(e,n,i,o){if(!Xi.matches(i)&&!Gc.matches(i))throw new Error("Only GLTF model types are currently supported");super(n,i,o);this.env=e}async getResponse(e){let n=await e.file();return ln(n,i=>this.env.loadGltf(i))}};function py(r,t){let e=[r];for(;e.length>0;){let n=e.shift();if(t(n))return n;n.children.length>0&&e.push(...n.children)}return null}var zh=class{constructor(t,e){this.disposed=!1;this.asset=new ko(t,e,Xi,!t.DEBUG),this.asset.then(()=>{this._model=py(this.asset.result.scene,or);let c=this._model.material.roughnessMap;qs(this._model,Ks),this._model.material.specularMap=c,t.timer.addTickHandler(l)});function n(c){return c.enabled&&(c.grip.visible||c.hand.visible&&c.hand.joints.wrist&&c.hand.joints.wrist.visible)}let i=t.DEBUG,o=t.xrUI.visible,s=0,l=()=>{let c=t.xrUI.visible,u=0;for(let p of t.eventSys.hands)n(p)&&++u;if(c!==o||u!==s||i!==t.DEBUG){if(t.clockImage.isVisible=c||t.DEBUG,c&&u>0){let p=null;for(let w of t.eventSys.hands)n(w)&&(fe(p)||w.handedness==="left")&&(p=w);let f=p.grip.visible?p.grip:p.hand.joints.wrist;if(f!==t.clockImage.object.parent){je(f,je(this,t.clockImage,t.batteryImage));let w=p.handedness==="left"?1:0;f===p.grip?(this.object.rotation.set(0,w*xn,-bn,"XYZ"),this.object.position.set(0,0,.07)):(this.object.rotation.set(0,w*xn,0,"XYZ"),this.object.position.set(0,0,0)),t.clockImage.scale.setScalar(.0175),t.clockImage.position.set(0,.029,0),t.clockImage.rotation.set(-bn,0,-bn),T(t.batteryImage)&&(t.batteryImage.scale.set(2,1,1).multiplyScalar(.008),t.batteryImage.position.set(.0075,.029,0),t.batteryImage.rotation.set(-bn,0,-bn))}}else t.xrUI.addItem(t.clockImage,{x:-1,y:1,height:.1}),T(t.batteryImage)&&t.xrUI.addItem(t.batteryImage,{x:.75,y:-1,width:.2,height:.1});o=c,s=u,i=t.DEBUG}}}get object(){return this._model}dispose(){this.disposed||(T(this.object)&&(this.object.removeFromParent(),St(this.object),this._model=null),this.disposed=!0)}};var jh=class extends sr{constructor(e,n,i,o,s){e=e+xr(16);super(Dt(e));this.enabledMaterial=i;this.disabledMaterial=o;this.mesh=Di(`Mesh-${e}-enabled`,n,i),this.size=s,je(this,this.mesh),this.addMesh(this.mesh),this.clickable=!0,this.disabled=this.disabled,Ih(this,!0)}get size(){return this.mesh.scale.x}set size(e){this.mesh.scale.setScalar(e)}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.mesh.material=e?this.disabledMaterial:this.enabledMaterial}};var Gh=class{constructor(t,e,n,i,o){this.imagePaths=t;this.padding=e;this.buttonFillColor=n;this.labelFillColor=i;this.uvDescrips=new Yn;this.geoms=new Yn;this.canvas=null;this.texture=null;this.enabledMaterial=null;this.disabledMaterial=null;this.assetSets=new Yn(Array.from(this.imagePaths.entries()).map(([s,l,c])=>[s,l,new jp(c,Gi,!o)])),this.assets=Array.from(this.assetSets.values()),this.ready=Promise.all(this.assets).then(()=>{let s=this.assets.map(y=>y.result),l=Math.max(...s.map(y=>y.width)),c=Math.max(...s.map(y=>y.height)),u=l*c*s.length,p=Math.sqrt(u),f=Math.floor(p/l),w=Math.ceil(s.length/f),A=f*l,m=w*c,d=_x(A),h=_x(m),M=A/d,k=m/h,E=l/d,b=c/h;this.canvas=Kp(d,h);let g=this.canvas.getContext("2d",{alpha:!1});g.fillStyle=this.buttonFillColor,g.fillRect(0,0,d,h);let v=0;for(let[y,V,B]of this.assetSets.entries()){let D=B.result,L=v%f,J=(v-L)/f,ae=M*(L*l/A),Q=k*(1-J/w)-b,ee=L*l,K=J*c+h-m,$=l-2*this.padding,te=c-2*this.padding;g.drawImage(D,0,0,D.width,D.height,ee+this.padding,K+this.padding,$,te),this.uvDescrips.add(y,V,{u:ae,v:Q,du:E,dv:b}),++v}this.texture=new db(this.canvas),this.enabledMaterial=new ir({map:this.texture}),this.enabledMaterial.needsUpdate=!0,this.disabledMaterial=new ir({map:this.texture,transparent:!0,opacity:.5}),this.disabledMaterial.needsUpdate=!0})}getImageSrc(t,e){let n=this.imagePaths.get(t),i=n&&n.get(e);if(!i)throw new un(`Button ${t}/${e} does not exist`,this.uvDescrips);return i}async getMeshButton(t,e,n){await this.ready;let i=this.uvDescrips.get(t),o=i&&i.get(e);if(!i||!o)throw new un(`Button ${t}/${e} does not exist`,this.uvDescrips);let s=this.geoms.get(t,e);if(!s){s=new Qa(1,1,1,1),s.name=`Geometry:${t}/${e}`,this.geoms.add(t,e,s);let c=s.getAttribute("uv");for(let u=0;u<c.count;++u){let p=c.getX(u)*o.du+o.u,f=c.getY(u)*o.dv+o.v;c.setX(u,p),c.setY(u,f)}}return new jh(e,s,this.enabledMaterial,this.disabledMaterial,n)}};function dy(r,t){r.element instanceof HTMLButtonElement&&(r.element.disabled=!t),Hd(r,t)}function hy(r,...t){We(r,...t.filter(I0)),je(r,...t.filter(oS))}function Xh(r){V0(r),sS(r)}var us=class{constructor(t,e,n){this.element=t;this.object=e;this.displayType=n}get name(){return this.object.name}addEventListener(t,e,n){this.element.addEventListener(t,e,n)}dispatchEvent(t){return this.element.dispatchEvent(t)}removeEventListener(t,e,n){this.element.removeEventListener(t,e,n)}click(){this.element.click()}get visible(){return zn(this)}set visible(t){st(this,t,this.displayType),this.object.visible=t}};var kl=class extends us{constructor(e,n,i){let o=Er(`${n} ${i}`);super(yi(o,tr(o,Zn(e.getImageSrc(n,i)))),Dt(`${name}-button`),"inline-block");this.mesh=null;this.load(e,n,i)}async load(e,n,i){this.mesh=await e.getMeshButton(n,i,.2),this.mesh.disabled=this.disabled,je(this,this.mesh),this.mesh.object.visible=this.visible,this.mesh.addEventListener("click",()=>{this.element.click()})}get disabled(){return this.element.disabled}set disabled(e){this.element.disabled=e,this.mesh&&(this.mesh.disabled=e)}get visible(){return super.visible}set visible(e){super.visible=e,this.mesh&&wn(this.mesh,e)}};var Yle={type:"redrawn"},ps=class extends Ri{constructor(e,n,i,o,s){super(e,n,i,s);this._image=null;this.image=o}get object(){return this}get element(){return si(this.image.canvas)?this.image.canvas:null}onRedrawn(){this.updateTexture(),this.dispatchEvent(Yle)}get image(){return this._image}set image(e){this.image&&this.image.removeScope(this),this._image=e,this.image&&(this.image.addScopedEventListener(this,"redrawn",()=>this.onRedrawn()),this.setTextureMap(this.image.canvas),this.onRedrawn())}get imageWidth(){return this.image.width}get imageHeight(){return this.image.height}copy(e,n=!0){return super.copy(e,n),this.image=e.image,this}get isVisible(){return zn(this)}set isVisible(e){st(this,e,"inline-block"),wn(this,e),wn(this.mesh,e),this.image.visible=e}};function my(r){return!r.started||r.finished}var hw=class extends mt{constructor(){super(!1);this.time=0;this.duration=0;this.onTick=null}begin(e,n,i){this.restart(),this.time=-e,this.duration=n,this.onTick=i,this.onTick(0)}update(e){my(this)||(this.time+=e/this.duration,this.time>=1?(this.onTick(1),this.resolve()):this.time>=0&&this.onTick(this.time))}},qh=class{constructor(){this.animations=new Array}update(t){t=.001*t;for(let e of this.animations)e.update(t)}clear(){for(let t of this.animations)t.resolve()}start(t,e,n){let i=Mn(this.animations,my);return i||this.animations.push(i=new hw),i.begin(t,e,n),i}};var Cr=class extends ps{constructor(t,e,n,i,o){let s;i instanceof Li?s=i:s=new Li(i),super(t,e,n,s,o)}onRedrawn(){this.objectHeight=this.imageHeight,super.onRedrawn()}};var Qs=class extends sr{constructor(e,n,i,o){super(Dt(n));this.env=e;if(T(i)){o=Object.assign({textFillColor:"white",fontFamily:"Segoe UI Emoji",fontSize:20,minHeight:.25,maxHeight:.25},o,{value:i}),this.image=new Li(o);let s=xr(16);this.enabledImage=this.createImage(`${s}-enabled`,1),this.disabledImage=this.createImage(`${s}-disabled`,.5),this.disabledImage.visible=!1,je(this,this.enabledImage,this.disabledImage)}this.addMesh(this.enabledImage.mesh),this.addMesh(this.disabledImage.mesh),this.clickable=!0,T(i)&&Ih(this,!0)}createImage(e,n){return new Cr(this.env,`text-${e}`,"none",this.image,{side:Us,opacity:n})}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.enabledImage.visible=!e,this.disabledImage.visible=e}};var fy={bgStrokeColor:"black",bgStrokeSize:.04,textFillColor:"white",scale:150},gy=Object.assign({},fy,{padding:{left:.1,right:.1,top:.025,bottom:.025},fontSize:20,minHeight:.5,maxHeight:.5}),Jle=Object.assign({},gy,{bgFillColor:Tr(0,117,215)}),Qle=Object.assign({},gy,{bgFillColor:Tr(117,0,0)}),$le=Object.assign({},fy,{bgFillColor:"white",textFillColor:"black",padding:{top:.1,left:.1,bottom:.4,right:.1},fontSize:25,minHeight:1,maxHeight:1}),Zle=.9;function mw(r,t){return Object.assign({},r,{fontFamily:t})}var Kh=class extends Hr{constructor(e,n){super("Confirm action");this.env=e;this.object=Dt("ConfirmationDialog");this.root=Dt("Root");this.animator=new qh;this.a=0;this.b=0;this.confirmButton.innerText="Yes",this.cancelButton.innerText="No",this.mesh=new Cr(this.env,"confirmationDialogLabel","none",mw($le,n)),this.confirmButton3D=new Qs(this.env,"confirmationDialogConfirmButton","Yes",mw(Jle,n)),this.confirmButton3D.addEventListener("click",()=>this.confirmButton.click()),this.confirmButton3D.object.position.set(1,-.5,.5),this.cancelButton3D=new Qs(this.env,"confirmationDialogCancelButton","No",mw(Qle,n)),this.cancelButton3D.addEventListener("click",()=>this.cancelButton.click()),this.cancelButton3D.object.position.set(2,-.5,.5),We(this.container,Tp(`calc(${on(100)} - ${mr(2)})`),Kn("max-content")),We(this.contentArea,i0(Q1(18)),u0("center"),Sa(mr(1))),je(this,je(this.root,this.mesh,this.confirmButton3D,this.cancelButton3D)),wn(this.root,!1),this.root.scale.setScalar(0),this.onTick=i=>{let o=OS(this.a+this.b*i,Zle);this.root.scale.set(o,o,.01)}}get name(){return this.object.name}get visible(){return zn(this)}set visible(e){st(this,e,"inline-block"),this.mesh.visible=e}update(e){this.animator.update(e)}async showHide(e,n){this.a=e,this.b=n,await this.animator.start(0,.25,this.onTick),this.animator.clear()}get use3D(){return this.env.renderer.xr.isPresenting||this.env.testSpaceLayout}async onShowing(){await super.onShowing(),this.use3D&&(this.root.visible=!0,await this.showHide(0,1))}onShown(){this.use3D&&(this.element.style.display="none")}async onClosing(){this.use3D&&(await this.showHide(1,-1),this.root.visible=!1),await super.onClosing()}prompt(e,n){return this.title=e,Ye(this.contentArea,n),this.mesh.image.value=n,this.showDialog()}};var ds=class extends us{constructor(e,n,i,o){super(yi(),Dt(`${n}-button`),"inline-block");this.buttons=e;this.setName=n;this.activeName=i;this.inactiveName=o;this.enterButton=null;this.exitButton=null;this._isAvailable=!0;this._isEnabled=!0;this._isActive=!1;We(this,this.btnImage=tr()),this.load()}async load(){let[e,n]=await An(this.buttons.getMeshButton(this.setName,this.activeName,.2),this.buttons.getMeshButton(this.setName,this.inactiveName,.2));je(this.object,this.enterButton=e,this.exitButton=n),this.enterButton.addEventListener("click",()=>this.element.click()),this.exitButton.addEventListener("click",()=>this.element.click()),this.refreshState()}get mesh(){return this.active?this.enterButton:this.exitButton}get available(){return this._isAvailable}set available(e){this._isAvailable=e,this.refreshState()}get active(){return this._isActive}set active(e){this._isActive=e,this.refreshState()}get enabled(){return this._isEnabled}set enabled(e){this._isEnabled=e,this.refreshState()}get visible(){return super.visible}set visible(e){super.visible=e,this.refreshState()}refreshState(){let e=this.active?this.inactiveName:this.activeName,n=`${e} ${this.setName}`;if(this.element.title=this.btnImage.title=n,this.btnImage.src=this.buttons.getImageSrc(this.setName,e),this.element.disabled=!this.available||!this.visible||!this.enabled,st(this,this.available&&this.visible,"inline-block"),this.enterButton&&this.exitButton){Hd(this,this.available&&this.visible&&this.enabled);let i=wn(this.object,this.available&&this.visible);wn(this.enterButton,i&&!this.active),wn(this.exitButton,i&&this.active)}}};var Cl=class extends ds{constructor(e,n){let i=Su[n];super(e,i.toLowerCase(),"enter","exit");this.mode=n}};function xy(r){return new fw(r)}var fw=class extends Ra{pop(t){return this.addSubProgress(t)}};var _u=class extends Ae{constructor(e,n){super(e);this.appName=n}},gw=class extends _u{constructor(e,n){super("apploading",e);this.appLoadParams=n}},xw=class extends _u{constructor(e,n){super("apploaded",e);this.app=n}},ww=class extends _u{constructor(e,n){super("appshown",e);this.app=n}},vw=class{constructor(t,e){this.loader=t;this.name=e;this.params=new Map}param(t,e){return this.params.set(t,e),this}load(t){return this.loader(this.name,this.params,t)}},Yh=class extends qe{constructor(e,n){super();this.env=e;this.getAppUrl=n;this.loadedModules=new Map;this.loadingApps=new Map;this.currentApps=new Map;this.cacheBustString=null}[Symbol.iterator](){return this.currentApps.values()}isLoaded(e){return this.currentApps.has(e)}get(e){return this.currentApps.get(e)}waitFor(e){if(this.isLoaded(e))return Promise.resolve(this.get(e));let n=new mt;return this.addScopedEventListener(this,"apploaded",i=>{i.appName===e&&(this.removeScope(this),n.resolve(i.app))}),n}async loadAppConstructor(e,n){if(this.loadedModules.has(e))T(n)&&n.end();else{let o=this.getAppUrl(e);if(T(this.cacheBustString)){let l=new li(o,location.href);l.query("v",this.cacheBustString),o=l.toString()}let s=this.env.fetcher.get(o).progress(n).useCache(!this.env.DEBUG).module().then(tt);this.loadedModules.set(e,s)}let{default:i}=await this.loadedModules.get(e);return i}app(e){return new vw(this.loadApp.bind(this),e)}loadApp(e,n,i){let o=null;n instanceof Map?o=n:i=n,i=i||this.env.loadingBar;let s=new gw(e,o);if(this.dispatchEvent(s),!this.loadingApps.has(e)){let l=xy(i),c=this.loadAppInstance(this.env,e,o,l.pop(10));this.loadingApps.set(e,c),i=l.pop(1)}return this.loadingApps.get(e)}async loadAppInstance(e,n,i,o){if(!this.currentApps.has(n)){let[s,l]=Gt(o,[1,10]),c=await this.loadAppConstructor(n,s),u=new c(e);u.addEventListener("quit",()=>this.unloadApp(n)),u.addEventListener("shown",()=>this.dispatchEvent(new ww(n,u))),T(i)&&await u.init(i),await u.load(l),this.currentApps.set(n,u),this.dispatchEvent(new xw(n,u))}return T(o)&&o.end(),this.currentApps.get(n)}unloadApp(e){let n=this.currentApps.get(e);setTimeout(()=>n.clearEventListeners(),100),zt(n),this.currentApps.delete(e),this.loadingApps.delete(e)}};var Mu=new Ie;function ku(r){return Mu.copy(r),Mu.y=0,Mu.normalize(),Zo(Math.atan2(Mu.x,Mu.z))}function wy(r){return Zo(Math.asin(r.y))}function $s(r,t){return r.xr.isPresenting?r.xr.getCamera():t}function vy(r,t,e,n){let i=r.elements;t.set(i[4],i[5],i[6]),e.set(-i[8],-i[9],-i[10]),n.set(i[12],i[13],i[14]),t.normalize(),e.normalize()}function ece(r){return r===DeviceOrientationEvent&&"requestPermission"in r&&ht(r.requestPermission)}var Fw=class extends Ae{constructor(){super("avatarreset")}},Jh=class extends qe{constructor(e,n){super();this.env=e;this.avatarResetEvt=new Fw;this.controlMode="none";this.snapTurnRadians=at(30);this.sensitivities=new Map([["mousedrag",100],["mousefirstperson",-100],["touchswipe",50],["gamepad",1]]);this.B=new Ie(0,0,1);this.F=new Ie;this.U=new Ie;this.P=new Ie;this.M=new Vt;this.E=new Yi;this.Q1=new xt;this.Q2=new xt;this.Q3=new xt(-Math.sqrt(.5),0,0,Math.sqrt(.5));this.Q4=new xt;this.motion=new Sn;this.rotStage=new Vt;this.axisControl=new Sn(0,0);this.deviceQ=new xt().identity();this.uv=new Sn;this.duv=new Sn;this.move=new Ie;this.move2=new Ie;this.radialAcceleration=new Sn(1.5,1.5);this.radialSpeed=new Sn(1,1);this.radialEdgeFactor=3/4;this.minFOVDegrees=15;this.maxFOVDegrees=120;this.minPitchRadians=at(-85);this.maxPitchRadians=at(85);this.followers=new Array;this.dz=0;this._headingRadians=0;this._pitchRadians=0;this._rollRadians=0;this.headX=0;this.headZ=0;this._worldHeadingRadians=0;this._worldPitchRadians=0;this.fwrd=!1;this.back=!1;this.left=!1;this.rght=!1;this.fwrd2=!1;this.back2=!1;this.left2=!1;this.rght2=!1;this.up=!1;this.down=!1;this.grow=!1;this.shrk=!1;this._keyboardControlEnabled=!1;this.worldPos=new Ie;this.worldQuat=new xt;this.lockMovement=!1;this.fovZoomEnabled=!0;this.deviceOrientation=null;this.screenOrientation=0;this.alphaOffset=0;this.onDeviceOrientationChangeEvent=null;this.onScreenOrientationChangeEvent=null;this.motionEnabled=!1;this.pointersToSend=new Array;this.disableHorizontal=!1,this.disableVertical=!1,this.invertHorizontal=!1,this.invertVertical=!0,this._height=this.env.defaultAvatarHeight,this.head=Dt("Head",n);let i=!1,o=(s,l)=>{if(s==="w"&&(this.fwrd=l),s==="s"&&(this.back=l),s==="a"&&(this.left=l),s==="d"&&(this.rght=l),s==="e"&&(this.up=l),s==="q"&&(this.down=l),s==="ArrowUp"&&(this.fwrd2=l),s==="ArrowDown"&&(this.back2=l),s==="ArrowLeft"&&(this.left2=l),s==="ArrowRight"&&(this.rght2=l),s==="r"&&(this.grow=l),s==="f"&&(this.shrk=l),s==="Home"){let c=i;i=l,c&&!i&&(this.reset(),this.dispatchEvent(this.avatarResetEvt))}};this.onKeyDown=s=>o(s.key,To(s)),this.onKeyUp=s=>o(s.key,!1),this.keyboardControlEnabled=!0,matchMedia("(pointer: coarse)").matches?this.controlMode="touchswipe":matchMedia("(pointer: fine)").matches&&(this.controlMode="mousedrag"),globalThis.isSecureContext&&$c()&&!Ao()&&(this.onDeviceOrientationChangeEvent=s=>{this.deviceOrientation=s},this.onScreenOrientationChangeEvent=()=>{"screen"in globalThis&&"orientation"in screen?this.screenOrientation=screen.orientation.angle:"window"in globalThis&&"orientation"in globalThis.window&&(this.screenOrientation=globalThis.window.orientation||0)},MF?Qi(()=>this.startMotionControl()):this.startMotionControl())}set disableVertical(e){this._disableVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set invertVertical(e){this._invertVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set disableHorizontal(e){this._disableHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}set invertHorizontal(e){this._invertHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}get height(){return this.head.position.y}get object(){return this.head}get worldHeadingRadians(){return this._worldHeadingRadians}get worldPitchRadians(){return this._worldPitchRadians}get fov(){return this.env.camera.fov}set fov(e){e!==this.fov&&(this.env.camera.fov=e,this.env.camera.updateProjectionMatrix())}get stage(){return this.head.parent}snapTurn(e){this.setHeading(this.headingRadians-this.snapTurnRadians*e)}get keyboardControlEnabled(){return this._keyboardControlEnabled}set keyboardControlEnabled(e){this._keyboardControlEnabled!==e&&(this._keyboardControlEnabled=e,this._keyboardControlEnabled?(this.env.renderer.domElement.addEventListener("keydown",this.onKeyDown),this.env.renderer.domElement.addEventListener("keyup",this.onKeyUp)):(this.env.renderer.domElement.removeEventListener("keydown",this.onKeyDown),this.env.renderer.domElement.removeEventListener("keyup",this.onKeyUp)))}addFollower(e){this.followers.push(e)}onMove(e,n,i){this.setMode(e),e.canMoveView&&this.controlMode!=="none"&&this.gestureSatisfied(e)&&(this.uv.copy(n),this.duv.copy(i))}setMode(e){e.type==="remote"||e.type==="nose"||(e.type==="hand"?this.controlMode="none":e.type==="gamepad"?this.controlMode="gamepad":e.rayTarget&&e.rayTarget.draggable&&!this.env.eventSys.mouse.isPointerLocked&&e.isPressed(0)?this.controlMode="mouseedge":e.type==="touch"||e.type==="pen"?this.controlMode="touchswipe":e.type==="mouse"?this.controlMode=this.env.eventSys.mouse.isPointerLocked?"mousefirstperson":"mousedrag":Ot(e.type))}gestureSatisfied(e){return this.controlMode==="none"?!1:this.controlMode==="gamepad"||this.controlMode==="mousefirstperson"||this.controlMode==="mouseedge"||e.isPressed(0)}get name(){return this.object.name}set name(e){this.object.name=e}get headingRadians(){return this._headingRadians}setHeading(e){this._headingRadians=Zo(e)}get pitchRadians(){return this._pitchRadians}setPitch(e,n,i){this._pitchRadians=Zo(e+xn)-xn,this._pitchRadians=vr(this._pitchRadians,n,i)}get rollRadians(){return this._rollRadians}setRoll(e){this._rollRadians=Zo(e)}setHeadingImmediate(e){this.setHeading(e),this.updateOrientation(),this.resetFollowers()}setOrientationImmediate(e,n){this.setHeading(e),this._pitchRadians=Zo(n),this.updateOrientation()}zoom(e){this.dz=e}update(e){e*=.001;let n=this.deviceOrientation;if(n&&Ir(n.alpha)&&Ir(n.beta)&&Ir(n.gamma)){let i=at(n.alpha)+this.alphaOffset,o=at(n.beta),s=at(n.gamma),l=this.screenOrientation?at(this.screenOrientation):0;this.E.set(o,i,-s,"YXZ"),this.Q2.setFromAxisAngle(this.B,-l),this.Q4.setFromEuler(this.E).multiply(this.Q3).multiply(this.Q2),this.deviceQ.slerp(this.Q4,.8)}if(!this.lockMovement){if(this.fovZoomEnabled&&Math.abs(this.dz)>0){let o=Math.pow(.95,5e3*e);this.dz=lb(o*this.dz),this.fov=vr(this.env.camera.fov-this.dz,this.minFOVDegrees,this.maxFOVDegrees)}if(this.controlMode==="mouseedge")this.uv.manhattanLength()>0&&(this.motion.set(this.scaleRadialComponent(-this.uv.x,this.radialSpeed.x,this.radialAcceleration.x),this.scaleRadialComponent(this.uv.y,this.radialSpeed.y,this.radialAcceleration.y)).multiplyScalar(e),this.setHeading(this.headingRadians+this.motion.x),this.setPitch(this.pitchRadians+this.motion.y,this.minPitchRadians,this.maxPitchRadians),this.setRoll(0));else if(this.sensitivities.has(this.controlMode)&&this.duv.manhattanLength()>0){let o=this.sensitivities.get(this.controlMode)||1;this.motion.copy(this.duv).multiplyScalar(o*e).multiply(this.axisControl),this.setHeading(this.headingRadians+this.motion.x),this.setPitch(this.pitchRadians+this.motion.y,this.minPitchRadians,this.maxPitchRadians),this.setRoll(0)}if(this.Q1.setFromAxisAngle(this.stage.up,this.worldHeadingRadians),this.fwrd||this.back||this.left||this.rght||this.up||this.down){let o=(this.left?1:0)+(this.rght?-1:0),s=(this.down?1:0)+(this.up?-1:0),l=(this.fwrd?1:0)+(this.back?-1:0);this.move.set(o,s,l);let c=this.move.length();c>0&&(this.move.multiplyScalar(e/c).applyQuaternion(this.Q1),this.stage.position.add(this.move))}if(this.fwrd2||this.back2||this.left2||this.rght2){let o=(this.left2?1:0)+(this.rght2?-1:0),s=(this.fwrd2?1:0)+(this.back2?-1:0);this.move2.set(o,0,s);let l=this.move2.length();l>0&&(this.move2.multiplyScalar(e/l).applyQuaternion(this.Q1),this.headX+=this.move2.x,this.headZ+=this.move2.z)}if(this.grow||this.shrk){let o=(this.shrk?-1:0)+(this.grow?1:0);this._height+=o*e,this._height=vr(this._height,1,2)}this.updateOrientation();let i=Math.pow(.95,100*e);this.duv.multiplyScalar(i),this.duv.manhattanLength()<=1e-4&&this.duv.setScalar(0)}}scaleRadialComponent(e,n,i){let o=Math.abs(e);return Math.sign(e)*Math.pow(Math.max(0,o-this.radialEdgeFactor)/(1-this.radialEdgeFactor),i)*n}lookAt(e){e.getWorldPosition(this.P),this.P.sub(this.worldPos);let n=3*bn-Math.atan2(this.P.z,this.P.x),i=Math.atan2(this.P.y,this.P.length());this.setOrientationImmediate(n,i)}updateOrientation(){let e=$s(this.env.renderer,this.env.camera);this.rotStage.makeRotationY(this._headingRadians),this.stage.matrix.makeTranslation(this.stage.position.x,this.stage.position.y,this.stage.position.z).multiply(this.rotStage),this.stage.matrix.decompose(this.stage.position,this.stage.quaternion,this.stage.scale),this.env.renderer.xr.isPresenting?(this.M.copy(this.stage.matrixWorld).invert(),this.head.position.copy(e.position).applyMatrix4(this.M),this.head.quaternion.copy(this.stage.quaternion).invert().multiply(e.quaternion)):(this.head.position.set(this.headX,this._height,this.headZ),this.E.set(this._pitchRadians,0,this._rollRadians,"XYZ"),this.head.quaternion.setFromEuler(this.E).premultiply(this.deviceQ)),this.env.camera.position.copy(this.head.position),this.env.camera.quaternion.copy(this.head.quaternion),this.head.getWorldPosition(this.worldPos),this.head.getWorldQuaternion(this.worldQuat),this.F.set(0,0,-1).applyQuaternion(this.worldQuat),this._worldHeadingRadians=ku(this.F),this._worldPitchRadians=wy(this.F),vy(this.head.matrixWorld,this.U,this.F,this.P)}reset(){this.stage.position.setScalar(0),this.setHeadingImmediate(0)}resetFollowers(){for(let e of this.followers)e.reset(this.height,this.worldPos,this.worldHeadingRadians)}async getPermission(){return"DeviceOrientationEvent"in window?ece(DeviceOrientationEvent)?await DeviceOrientationEvent.requestPermission():"granted":"not-supported"}async startMotionControl(){if(!this.motionEnabled){this.onScreenOrientationChangeEvent();let e=await this.getPermission();this.motionEnabled=e==="granted",this.motionEnabled&&("ScreenOrientation"in window?screen.orientation.addEventListener("change",this.onScreenOrientationChangeEvent):window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}}stopMotionControl(){this.motionEnabled&&("ScreenOrientation"in window?screen.orientation.removeEventListener("change",this.onScreenOrientationChangeEvent):window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.motionEnabled=!1)}dispose(){this.stopMotionControl()}get bufferSize(){return 133}writeState(e){ct(this.pointersToSend);let n=this.env.avatar.bufferSize;for(let i of this.env.eventSys.pointers)i.canSend&&(n+=i.bufferSize,this.pointersToSend.push(i));e.length=n,e.position=0,e.writeFloat32(this.height),e.writeMatrix512(this.stage.matrix),e.writeMatrix512(this.head.matrixWorld),e.writeUint8(this.pointersToSend.length);for(let i of this.pointersToSend)i.writeState(e)}};var Qh=class{constructor(t,e=.15){this.opacity=1;this.direction=0;this.task=new mt(!1);this.material=rl({name:"FaderMaterial",color:0,side:ub}),this.object=pu(t,1,1,1,this.material),this.object.renderOrder=Number.MAX_SAFE_INTEGER,this.speed=1/e,this.object.layers.enableAll()}async start(t){this.direction=t,this.task.restart(),await this.task}async fadeOut(){this.direction!=1&&await this.start(1)}async fadeIn(){this.direction!=-1&&await this.start(-1)}update(t){if(this.direction!==0){let e=this.direction*this.speed*t/1e3;0<=this.opacity&&this.opacity<=1&&(this.opacity+=e),(this.direction===1&&this.opacity>=1||this.direction===-1&&this.opacity<=0)&&(this.opacity=vr(this.opacity,0,1),this.direction=0,this.task.resolve())}this.material.opacity=this.opacity,this.material.transparent=this.opacity<1,this.material.needsUpdate=!0}};var $h=0;var Dl=3;function Fy(r,t){r=Gn(r),r.traverse(e=>e.layers.set(t))}function Ay(r,t){r=Gn(r),r.traverse(e=>e.layers.enable(t))}function pi(r,t,e,n,i,o){let s=new Nr(n,i,o,mS);return s.position.set(r,t,e),s}var tce=.1,Zh=class extends Yr{constructor(){super();this.value=0;this.targetValue=0;this.object=Dt("LoadingBar");this._enabled=!0;this.valueBar=new Nr(0,1,1,Xx),this.valueBar.scale.set(0,1,1);let e=Dt("ValueBarContainer");e.scale.set(1,.1,.1),je(this,je(e,this.valueBar),pi(-.5,0,-.05,.01,.1,.01),pi(-.5,0,.05,.01,.1,.01),pi(.5,0,-.05,.01,.1,.01),pi(.5,0,.05,.01,.1,.01),pi(-.5,-.05,0,.01,.01,.1),pi(.5,-.05,0,.01,.01,.1),pi(-.5,.05,0,.01,.01,.1),pi(.5,.05,0,.01,.01,.1),pi(0,-.05,-.05,1,.01,.01),pi(0,.05,-.05,1,.01,.01),pi(0,-.05,.05,1,.01,.01),pi(0,.05,.05,1,.01,.01)),Fy(this,Dl)}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,wn(this,nl(this)||this.enabled))}report(e,n,i){super.report(e,n,i),this.targetValue=this.p}update(e){this.object.parent.visible&&(this.value=Math.min(this.targetValue,this.value+tce*e),this.valueBar.scale.set(this.value,1,1),this.valueBar.position.x=this.value/2-.5,wn(this,this.enabled&&this.value>0))}};if(!Aw()){let r=Element.prototype,t=Document.prototype;"webkitRequestFullscreen"in r?(r.requestFullscreen=r.webkitRequestFullscreen,t.exitFullscreen=t.webkitRequestFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.webkitFullscreenEnabled}},fullscreenElement:{get:function(){return this.webkitFullscreenElement}}})):"mozRequestFullScreen"in r?(r.requestFullscreen=r.mozRequestFullScreen,t.exitFullscreen=t.mozCancelFullScreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.mozFullScreenEnabled}},fullscreenElement:{get:function(){return this.mozFullScreenElement}}})):"msRequestFullscreen"in r&&(r.requestFullscreen=r.msRequestFullscreen,t.exitFullscreen=t.msExitFullscreen,Object.defineProperties(t,{fullscreenEnabled:{get:function(){return this.msFullscreenEnabled}},fullscreenElement:{get:function(){return this.msFullscreenElement}}}))}function Aw(){return"requestFullscreen"in HTMLElement.prototype}var nce=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},em=nce;var Cu=Symbol("@@webxr-polyfill/EventTarget"),Co=class{constructor(){this[Cu]={listeners:new Map}}addEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let n=this[Cu].listeners.get(t)||[];n.push(e),this[Cu].listeners.set(t,n)}removeEventListener(t,e){if(typeof t!="string")throw new Error("`type` must be a string");if(typeof e!="function")throw new Error("`listener` must be a function");let n=this[Cu].listeners.get(t)||[];for(let i=n.length;i>=0;i--)n[i]===e&&n.pop()}dispatchEvent(t,e){let n=this[Cu].listeners.get(t)||[],i=[];for(let o=0;o<n.length;o++)i[o]=n[o];for(let o of i)o(e);typeof this[`on${t}`]=="function"&&this[`on${t}`](e)}};var Xn=typeof Float32Array<"u"?Float32Array:Array;var gDe=Math.PI/180;function ro(){let r=new Xn(16);return Xn!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function by(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function hs(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Zs(r,t){let e=t[0],n=t[1],i=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],p=t[8],f=t[9],w=t[10],A=t[11],m=t[12],d=t[13],h=t[14],M=t[15],k=e*l-n*s,E=e*c-i*s,b=e*u-o*s,g=n*c-i*l,v=n*u-o*l,y=i*u-o*c,V=p*d-f*m,B=p*h-w*m,D=p*M-A*m,L=f*h-w*d,J=f*M-A*d,ae=w*M-A*h,Q=k*ae-E*J+b*L+g*D-v*B+y*V;return Q?(Q=1/Q,r[0]=(l*ae-c*J+u*L)*Q,r[1]=(i*J-n*ae-o*L)*Q,r[2]=(d*y-h*v+M*g)*Q,r[3]=(w*v-f*y-A*g)*Q,r[4]=(c*D-s*ae-u*B)*Q,r[5]=(e*ae-i*D+o*B)*Q,r[6]=(h*b-m*y-M*E)*Q,r[7]=(p*y-w*b+A*E)*Q,r[8]=(s*J-l*D+u*V)*Q,r[9]=(n*D-e*J-o*V)*Q,r[10]=(m*v-d*b+M*k)*Q,r[11]=(f*b-p*v-A*k)*Q,r[12]=(l*B-s*L-c*V)*Q,r[13]=(e*L-n*B+i*V)*Q,r[14]=(d*E-m*g-h*k)*Q,r[15]=(p*g-f*E+w*k)*Q,r):null}function Do(r,t,e){let n=t[0],i=t[1],o=t[2],s=t[3],l=t[4],c=t[5],u=t[6],p=t[7],f=t[8],w=t[9],A=t[10],m=t[11],d=t[12],h=t[13],M=t[14],k=t[15],E=e[0],b=e[1],g=e[2],v=e[3];return r[0]=E*n+b*l+g*f+v*d,r[1]=E*i+b*c+g*w+v*h,r[2]=E*o+b*u+g*A+v*M,r[3]=E*s+b*p+g*m+v*k,E=e[4],b=e[5],g=e[6],v=e[7],r[4]=E*n+b*l+g*f+v*d,r[5]=E*i+b*c+g*w+v*h,r[6]=E*o+b*u+g*A+v*M,r[7]=E*s+b*p+g*m+v*k,E=e[8],b=e[9],g=e[10],v=e[11],r[8]=E*n+b*l+g*f+v*d,r[9]=E*i+b*c+g*w+v*h,r[10]=E*o+b*u+g*A+v*M,r[11]=E*s+b*p+g*m+v*k,E=e[12],b=e[13],g=e[14],v=e[15],r[12]=E*n+b*l+g*f+v*d,r[13]=E*i+b*c+g*w+v*h,r[14]=E*o+b*u+g*A+v*M,r[15]=E*s+b*p+g*m+v*k,r}function ms(r,t,e){let n=t[0],i=t[1],o=t[2],s=t[3],l=n+n,c=i+i,u=o+o,p=n*l,f=n*c,w=n*u,A=i*c,m=i*u,d=o*u,h=s*l,M=s*c,k=s*u;return r[0]=1-(A+d),r[1]=f+k,r[2]=w-M,r[3]=0,r[4]=f-k,r[5]=1-(p+d),r[6]=m+h,r[7]=0,r[8]=w+M,r[9]=m-h,r[10]=1-(p+A),r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function tm(r,t){return r[0]=t[12],r[1]=t[13],r[2]=t[14],r}function nm(r,t){let e=t[0]+t[5]+t[10],n=0;return e>0?(n=Math.sqrt(e+1)*2,r[3]=.25*n,r[0]=(t[6]-t[9])/n,r[1]=(t[8]-t[2])/n,r[2]=(t[1]-t[4])/n):t[0]>t[5]&&t[0]>t[10]?(n=Math.sqrt(1+t[0]-t[5]-t[10])*2,r[3]=(t[6]-t[9])/n,r[0]=.25*n,r[1]=(t[1]+t[4])/n,r[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=Math.sqrt(1+t[5]-t[0]-t[10])*2,r[3]=(t[8]-t[2])/n,r[0]=(t[1]+t[4])/n,r[1]=.25*n,r[2]=(t[6]+t[9])/n):(n=Math.sqrt(1+t[10]-t[0]-t[5])*2,r[3]=(t[1]-t[4])/n,r[0]=(t[8]+t[2])/n,r[1]=(t[6]+t[9])/n,r[2]=.25*n),r}function rm(r,t,e,n,i){let o=1/Math.tan(t/2),s;return r[0]=o/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(s=1/(n-i),r[10]=(i+n)*s,r[14]=2*i*n*s):(r[10]=-1,r[14]=-2*n),r}function Jr(){let r=new Xn(3);return Xn!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function bw(r){var t=new Xn(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t}function rce(r){let t=r[0],e=r[1],n=r[2];return Math.sqrt(t*t+e*e+n*n)}function Wr(r,t,e){let n=new Xn(3);return n[0]=r,n[1]=t,n[2]=e,n}function Sw(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r}function Pl(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function yw(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r}function im(r,t){let e=t[0],n=t[1],i=t[2],o=e*e+n*n+i*i;return o>0&&(o=1/Math.sqrt(o),r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o),r}function Lu(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function om(r,t,e){let n=t[0],i=t[1],o=t[2],s=e[0],l=e[1],c=e[2];return r[0]=i*c-o*l,r[1]=o*s-n*c,r[2]=n*l-i*s,r}function ta(r,t,e){let n=e[0],i=e[1],o=e[2],s=e[3],l=t[0],c=t[1],u=t[2],p=i*u-o*c,f=o*l-n*u,w=n*c-i*l,A=i*w-o*f,m=o*p-n*w,d=n*f-i*p,h=s*2;return p*=h,f*=h,w*=h,A*=2,m*=2,d*=2,r[0]=l+p+A,r[1]=c+f+m,r[2]=u+w+d,r}function yy(r,t){let e=Wr(r[0],r[1],r[2]),n=Wr(t[0],t[1],t[2]);im(e,e),im(n,n);let i=Lu(e,n);return i>1?0:i<-1?Math.PI:Math.acos(i)}var Ty=rce;var xDe=function(){let r=Jr();return function(t,e,n,i,o,s){let l,c;for(e||(e=3),n||(n=0),i?c=Math.min(i*e+n,t.length):c=t.length,l=n;l<c;l+=e)r[0]=t[l],r[1]=t[l+1],r[2]=t[l+2],o(r,r,s),t[l]=r[0],t[l+1]=r[1],t[l+2]=r[2];return t}}();function Ey(){let r=new Xn(9);return Xn!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function oce(){let r=new Xn(4);return Xn!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function _y(r){let t=new Xn(4);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t}function My(r,t,e,n){let i=new Xn(4);return i[0]=r,i[1]=t,i[2]=e,i[3]=n,i}function ky(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r}function Cy(r,t){let e=t[0],n=t[1],i=t[2],o=t[3],s=e*e+n*n+i*i+o*o;return s>0&&(s=1/Math.sqrt(s),r[0]=e*s,r[1]=n*s,r[2]=i*s,r[3]=o*s),r}var wDe=function(){let r=oce();return function(t,e,n,i,o,s){let l,c;for(e||(e=4),n||(n=0),i?c=Math.min(i*e+n,t.length):c=t.length,l=n;l<c;l+=e)r[0]=t[l],r[1]=t[l+1],r[2]=t[l+2],r[3]=t[l+3],o(r,r,s),t[l]=r[0],t[l+1]=r[1],t[l+2]=r[2],t[l+3]=r[3];return t}}();function Qr(){let r=new Xn(4);return Xn!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function ace(r,t,e){e=e*.5;let n=Math.sin(e);return r[0]=n*t[0],r[1]=n*t[1],r[2]=n*t[2],r[3]=Math.cos(e),r}function Tw(r,t,e){let n=t[0],i=t[1],o=t[2],s=t[3],l=e[0],c=e[1],u=e[2],p=e[3];return r[0]=n*p+s*l+i*u-o*c,r[1]=i*p+s*c+o*l-n*u,r[2]=o*p+s*u+n*c-i*l,r[3]=s*p-n*l-i*c-o*u,r}function Ll(r,t,e,n){let i=t[0],o=t[1],s=t[2],l=t[3],c=e[0],u=e[1],p=e[2],f=e[3],w,A,m,d,h;return A=i*c+o*u+s*p+l*f,A<0&&(A=-A,c=-c,u=-u,p=-p,f=-f),1-A>1e-6?(w=Math.acos(A),m=Math.sin(w),d=Math.sin((1-n)*w)/m,h=Math.sin(n*w)/m):(d=1-n,h=n),r[0]=d*i+h*c,r[1]=d*o+h*u,r[2]=d*s+h*p,r[3]=d*l+h*f,r}function Ew(r,t){let e=t[0],n=t[1],i=t[2],o=t[3],s=e*e+n*n+i*i+o*o,l=s?1/s:0;return r[0]=-e*l,r[1]=-n*l,r[2]=-i*l,r[3]=o*l,r}function lce(r,t){let e=t[0]+t[4]+t[8],n;if(e>0)n=Math.sqrt(e+1),r[3]=.5*n,n=.5/n,r[0]=(t[5]-t[7])*n,r[1]=(t[6]-t[2])*n,r[2]=(t[1]-t[3])*n;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);let o=(i+1)%3,s=(i+2)%3;n=Math.sqrt(t[i*3+i]-t[o*3+o]-t[s*3+s]+1),r[i]=.5*n,n=.5/n,r[3]=(t[o*3+s]-t[s*3+o])*n,r[o]=(t[o*3+i]+t[i*3+o])*n,r[s]=(t[s*3+i]+t[i*3+s])*n}return r}function Dy(r,t,e,n){let i=.5*Math.PI/180;t*=i,e*=i,n*=i;let o=Math.sin(t),s=Math.cos(t),l=Math.sin(e),c=Math.cos(e),u=Math.sin(n),p=Math.cos(n);return r[0]=o*c*p-s*l*u,r[1]=s*l*p+o*c*u,r[2]=s*c*u-o*l*p,r[3]=s*c*p+o*l*u,r}var _w=_y,Py=My,am=ky;var Iu=Cy;var MDe=function(){let r=Jr(),t=Wr(1,0,0),e=Wr(0,1,0);return function(n,i,o){let s=Lu(i,o);return s<-.999999?(om(r,t,i),Ty(r)<1e-6&&om(r,e,i),im(r,r),ace(n,r,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(om(r,i,o),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=1+s,Iu(n,n))}}(),kDe=function(){let r=Qr(),t=Qr();return function(e,n,i,o,s,l){return Ll(r,n,s,l),Ll(t,i,o,l),Ll(e,r,t,2*l*(1-l)),e}}(),CDe=function(){let r=Ey();return function(t,e,n,i){return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-e[0],r[5]=-e[1],r[8]=-e[2],Iu(t,lce(t,r))}}();var Xt=Symbol("@@webxr-polyfill/XRRigidTransform"),Po=class{constructor(){if(this[Xt]={matrix:null,position:null,orientation:null,inverse:null},arguments.length===0)this[Xt].matrix=hs(new Float32Array(16));else if(arguments.length===1)arguments[0]instanceof Float32Array?this[Xt].matrix=arguments[0]:(this[Xt].position=this._getPoint(arguments[0]),this[Xt].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(arguments.length===2)this[Xt].position=this._getPoint(arguments[0]),this[Xt].orientation=this._getPoint(arguments[1]);else throw new Error("Too many arguments!");if(this[Xt].matrix){let t=Jr();tm(t,this[Xt].matrix),this[Xt].position=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2]});let e=Qr();nm(e,this[Xt].matrix),this[Xt].orientation=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2],w:e[3]})}else this[Xt].matrix=hs(new Float32Array(16)),ms(this[Xt].matrix,Py(this[Xt].orientation.x,this[Xt].orientation.y,this[Xt].orientation.z,this[Xt].orientation.w),Wr(this[Xt].position.x,this[Xt].position.y,this[Xt].position.z))}_getPoint(t){return t instanceof DOMPointReadOnly?t:DOMPointReadOnly.fromPoint(t)}get matrix(){return this[Xt].matrix}get position(){return this[Xt].position}get orientation(){return this[Xt].orientation}get inverse(){if(this[Xt].inverse===null){let t=hs(new Float32Array(16));Zs(t,this[Xt].matrix),this[Xt].inverse=new Po(t),this[Xt].inverse[Xt].inverse=this}return this[Xt].inverse}};var yn=Symbol("@@webxr-polyfill/XRSpace");var di=class{constructor(t=null,e=null){this[yn]={specialType:t,inputSource:e,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[yn].specialType}get _inputSource(){return this[yn].inputSource}_ensurePoseUpdated(t,e){e!=this[yn].lastFrameId&&(this[yn].lastFrameId=e,this._onPoseUpdate(t))}_onPoseUpdate(t){this[yn].specialType=="viewer"&&(this._baseMatrix=t.getBasePoseMatrix())}set _baseMatrix(t){this[yn].baseMatrix=t,this[yn].inverseBaseMatrix=null}get _baseMatrix(){return this[yn].baseMatrix||this[yn].inverseBaseMatrix&&(this[yn].baseMatrix=new Float32Array(16),Zs(this[yn].baseMatrix,this[yn].inverseBaseMatrix)),this[yn].baseMatrix}set _inverseBaseMatrix(t){this[yn].inverseBaseMatrix=t,this[yn].baseMatrix=null}get _inverseBaseMatrix(){return this[yn].inverseBaseMatrix||this[yn].baseMatrix&&(this[yn].inverseBaseMatrix=new Float32Array(16),Zs(this[yn].inverseBaseMatrix,this[yn].baseMatrix)),this[yn].inverseBaseMatrix}_getSpaceRelativeTransform(t){if(!this._inverseBaseMatrix||!t._baseMatrix)return null;let e=new Float32Array(16);return Do(e,this._inverseBaseMatrix,t._baseMatrix),new Po(e)}};var cce=1.6,fs=Symbol("@@webxr-polyfill/XRReferenceSpace"),Ru=["viewer","local","local-floor","bounded-floor","unbounded"];function uce(r){return r==="bounded-floor"||r==="local-floor"}var io=class extends di{constructor(t,e=null){if(!Ru.includes(t))throw new Error(`XRReferenceSpaceType must be one of ${Ru}`);if(super(t),t==="bounded-floor"&&!e)throw new Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");uce(t)&&!e&&(e=hs(new Float32Array(16)),e[13]=cce),this._inverseBaseMatrix=e||hs(new Float32Array(16)),this[fs]={type:t,transform:e,originOffset:hs(new Float32Array(16))}}_transformBasePoseMatrix(t,e){Do(t,this._inverseBaseMatrix,e)}_originOffsetMatrix(){return this[fs].originOffset}_adjustForOriginOffset(t){let e=new Float32Array(16);Zs(e,this[fs].originOffset),Do(t,e,t)}_getSpaceRelativeTransform(t){let e=super._getSpaceRelativeTransform(t);return this._adjustForOriginOffset(e.matrix),new XRRigidTransform(e.matrix)}getOffsetReferenceSpace(t){let e=new io(this[fs].type,this[fs].transform,this[fs].bounds);return Do(e[fs].originOffset,this[fs].originOffset,t.matrix),e}};var Dr=Symbol("@@webxr-polyfill/XR"),pce=["inline","immersive-vr","immersive-ar"],dce={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},hce=`Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode
or navigator.xr.requestSession('inline') prior to requesting an immersive
session. This is a limitation specific to the WebXR Polyfill and does not apply
to native implementations of the API.`,Bu=class extends Co{constructor(t){super(),this[Dr]={device:null,devicePromise:t,immersiveSession:null,inlineSessions:new Set},t.then(e=>{this[Dr].device=e})}async isSessionSupported(t){return this[Dr].device||await this[Dr].devicePromise,t!="inline"?Promise.resolve(this[Dr].device.isSessionSupported(t)):Promise.resolve(!0)}async requestSession(t,e){if(!this[Dr].device){if(t!="inline")throw new Error(hce);await this[Dr].devicePromise}if(!pce.includes(t))throw new TypeError(`The provided value '${t}' is not a valid enum value of type XRSessionMode`);let n=dce[t],i=n.requiredFeatures.concat(e&&e.requiredFeatures?e.requiredFeatures:[]),o=n.optionalFeatures.concat(e&&e.optionalFeatures?e.optionalFeatures:[]),s=new Set,l=!1;for(let f of i)this[Dr].device.isFeatureSupported(f)?s.add(f):(console.error(`The required feature '${f}' is not supported`),l=!0);if(l)throw new DOMException("Session does not support some required features","NotSupportedError");for(let f of o)this[Dr].device.isFeatureSupported(f)?s.add(f):console.log(`The optional feature '${f}' is not supported`);let c=await this[Dr].device.requestSession(t,s),u=new XRSession(this[Dr].device,t,c);t=="inline"?this[Dr].inlineSessions.add(u):this[Dr].immersiveSession=u;let p=()=>{t=="inline"?this[Dr].inlineSessions.delete(u):this[Dr].immersiveSession=null,u.removeEventListener("end",p)};return u.addEventListener("end",p),u}};var kw;if("performance"in em)kw=()=>performance.now();else{let r=Date.now();kw=()=>Date.now()-r}var lm=kw;var Cw=Symbol("@@webxr-polyfill/XRPose"),na=class{constructor(t,e){this[Cw]={transform:t,emulatedPosition:e}}get transform(){return this[Cw].transform}get emulatedPosition(){return this[Cw].emulatedPosition}};var Ly=Symbol("@@webxr-polyfill/XRViewerPose"),ra=class extends na{constructor(t,e,n=!1){super(t,n),this[Ly]={views:e}}get views(){return this[Ly].views}};var Vu=Symbol("@@webxr-polyfill/XRViewport"),ia=class{constructor(t){this[Vu]={target:t}}get x(){return this[Vu].target.x}get y(){return this[Vu].target.y}get width(){return this[Vu].target.width}get height(){return this[Vu].target.height}};var Iy=["left","right","none"],gs=Symbol("@@webxr-polyfill/XRView"),oa=class{constructor(t,e,n,i){if(!Iy.includes(n))throw new Error(`XREye must be one of: ${Iy}`);let o=Object.create(null),s=new ia(o);this[gs]={device:t,eye:n,viewport:s,temp:o,sessionId:i,transform:e}}get eye(){return this[gs].eye}get projectionMatrix(){return this[gs].device.getProjectionMatrix(this.eye)}get transform(){return this[gs].transform}_getViewport(t){if(this[gs].device.getViewport(this[gs].sessionId,this.eye,t,this[gs].temp))return this[gs].viewport}};var On=Symbol("@@webxr-polyfill/XRFrame"),Ry="XRFrame access outside the callback that produced it is invalid.",mce="getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.",fce=0,xs=class{constructor(t,e,n){this[On]={id:++fce,active:!1,animationFrame:!1,device:t,session:e,sessionId:n}}get session(){return this[On].session}getViewerPose(t){if(!this[On].animationFrame)throw new DOMException(mce,"InvalidStateError");if(!this[On].active)throw new DOMException(Ry,"InvalidStateError");let e=this[On].device,n=this[On].session;n[Te].viewerSpace._ensurePoseUpdated(e,this[On].id),t._ensurePoseUpdated(e,this[On].id);let i=t._getSpaceRelativeTransform(n[Te].viewerSpace),o=[];for(let l of n[Te].viewSpaces){l._ensurePoseUpdated(e,this[On].id);let c=t._getSpaceRelativeTransform(l),u=new oa(e,c,l.eye,this[On].sessionId);o.push(u)}return new ra(i,o,!1)}getPose(t,e){if(!this[On].active)throw new DOMException(Ry,"InvalidStateError");let n=this[On].device;if(t._specialType==="target-ray"||t._specialType==="grip")return n.getInputPose(t._inputSource,e,t._specialType);{t._ensurePoseUpdated(n,this[On].id),e._ensurePoseUpdated(n,this[On].id);let i=e._getSpaceRelativeTransform(t);return i?new XRPose(i,!1):null}return null}};var Ou=Symbol("@@webxr-polyfill/XRRenderState"),gce=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null}),ws=class{constructor(t={}){let e=Object.assign({},gce,t);this[Ou]={config:e}}get depthNear(){return this[Ou].config.depthNear}get depthFar(){return this[Ou].config.depthFar}get inlineVerticalFieldOfView(){return this[Ou].config.inlineVerticalFieldOfView}get baseLayer(){return this[Ou].config.baseLayer}};var cm=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),Nu=Symbol("@@webxr-polyfill/xr-compatible");var sa=Symbol("@@webxr-polyfill/XRWebGLLayer"),xce=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),Hu=class{constructor(t,e,n={}){let i=Object.assign({},xce,n);if(!(t instanceof aa))throw new Error("session must be a XRSession");if(t.ended)throw new Error("InvalidStateError");if(e[cm]&&e[Nu]!==!0)throw new Error("InvalidStateError");let o=e.getParameter(e.FRAMEBUFFER_BINDING);this[sa]={context:e,config:i,framebuffer:o,session:t}}get context(){return this[sa].context}get antialias(){return this[sa].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return this[sa].framebuffer}get framebufferWidth(){return this[sa].context.drawingBufferWidth}get framebufferHeight(){return this[sa].context.drawingBufferHeight}get _session(){return this[sa].session}getViewport(t){return t._getViewport(this)}static getNativeFramebufferScaleFactor(t){if(!t)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return t[Te].ended?0:1}};var Dw=Symbol("@@webxr-polyfill/XRInputSourceEvent"),Lo=class extends Event{constructor(t,e){super(t,e),this[Dw]={frame:e.frame,inputSource:e.inputSource},Object.setPrototypeOf(this,Lo.prototype)}get frame(){return this[Dw].frame}get inputSource(){return this[Dw].inputSource}};var By=Symbol("@@webxr-polyfill/XRSessionEvent"),oo=class extends Event{constructor(t,e){super(t,e),this[By]={session:e.session},Object.setPrototypeOf(this,oo.prototype)}get session(){return this[By].session}};var um=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),Io=class extends Event{constructor(t,e){super(t,e),this[um]={session:e.session,added:e.added,removed:e.removed},Object.setPrototypeOf(this,Io.prototype)}get session(){return this[um].session}get added(){return this[um].added}get removed(){return this[um].removed}};var Te=Symbol("@@webxr-polyfill/XRSession"),Wu=class extends di{constructor(t){super(t)}get eye(){return this._specialType}_onPoseUpdate(t){this._inverseBaseMatrix=t.getBaseViewMatrix(this._specialType)}},aa=class extends Co{constructor(t,e,n){super();let i=e!="inline",o=new ws({inlineVerticalFieldOfView:i?null:Math.PI*.5});this[Te]={device:t,mode:e,immersive:i,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:n,activeRenderState:o,pendingRenderState:null,viewerSpace:new io("viewer"),viewSpaces:[],currentInputSources:[]},i?this[Te].viewSpaces.push(new Wu("left"),new Wu("right")):this[Te].viewSpaces.push(new Wu("none")),this[Te].onDeviceFrame=()=>{if(this[Te].ended||this[Te].suspended||(this[Te].deviceFrameHandle=null,this[Te].startDeviceFrameLoop(),this[Te].pendingRenderState!==null&&(this[Te].activeRenderState=new ws(this[Te].pendingRenderState),this[Te].pendingRenderState=null,this[Te].activeRenderState.baseLayer&&this[Te].device.onBaseLayerSet(this[Te].id,this[Te].activeRenderState.baseLayer)),this[Te].activeRenderState.baseLayer===null))return;let s=new xs(t,this,this[Te].id),l=this[Te].currentFrameCallbacks=this[Te].frameCallbacks;this[Te].frameCallbacks=[],s[On].active=!0,s[On].animationFrame=!0,this[Te].device.onFrameStart(this[Te].id,this[Te].activeRenderState),this._checkInputSourcesChange();let c=lm();for(let u=0;u<l.length;u++)try{!l[u].cancelled&&typeof l[u].callback=="function"&&l[u].callback(c,s)}catch(p){console.error(p)}this[Te].currentFrameCallbacks=null,s[On].active=!1,this[Te].device.onFrameEnd(this[Te].id)},this[Te].startDeviceFrameLoop=()=>{this[Te].deviceFrameHandle===null&&(this[Te].deviceFrameHandle=this[Te].device.requestAnimationFrame(this[Te].onDeviceFrame))},this[Te].stopDeviceFrameLoop=()=>{let s=this[Te].deviceFrameHandle;s!==null&&(this[Te].device.cancelAnimationFrame(s),this[Te].deviceFrameHandle=null)},this[Te].onPresentationEnd=s=>{if(s!==this[Te].id){this[Te].suspended=!1,this[Te].startDeviceFrameLoop(),this.dispatchEvent("focus",{session:this});return}this[Te].ended=!0,this[Te].stopDeviceFrameLoop(),t.removeEventListener("@@webxr-polyfill/vr-present-end",this[Te].onPresentationEnd),t.removeEventListener("@@webxr-polyfill/vr-present-start",this[Te].onPresentationStart),t.removeEventListener("@@webxr-polyfill/input-select-start",this[Te].onSelectStart),t.removeEventListener("@@webxr-polyfill/input-select-end",this[Te].onSelectEnd),this.dispatchEvent("end",new oo("end",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-end",this[Te].onPresentationEnd),this[Te].onPresentationStart=s=>{s!==this[Te].id&&(this[Te].suspended=!0,this[Te].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},t.addEventListener("@@webxr-polyfill/vr-present-start",this[Te].onPresentationStart),this[Te].onSelectStart=s=>{s.sessionId===this[Te].id&&this[Te].dispatchInputSourceEvent("selectstart",s.inputSource)},t.addEventListener("@@webxr-polyfill/input-select-start",this[Te].onSelectStart),this[Te].onSelectEnd=s=>{s.sessionId===this[Te].id&&(this[Te].dispatchInputSourceEvent("selectend",s.inputSource),this[Te].dispatchInputSourceEvent("select",s.inputSource))},t.addEventListener("@@webxr-polyfill/input-select-end",this[Te].onSelectEnd),this[Te].onSqueezeStart=s=>{s.sessionId===this[Te].id&&this[Te].dispatchInputSourceEvent("squeezestart",s.inputSource)},t.addEventListener("@@webxr-polyfill/input-squeeze-start",this[Te].onSqueezeStart),this[Te].onSqueezeEnd=s=>{s.sessionId===this[Te].id&&(this[Te].dispatchInputSourceEvent("squeezeend",s.inputSource),this[Te].dispatchInputSourceEvent("squeeze",s.inputSource))},t.addEventListener("@@webxr-polyfill/input-squeeze-end",this[Te].onSqueezeEnd),this[Te].dispatchInputSourceEvent=(s,l)=>{let c=new xs(t,this,this[Te].id),u=new Lo(s,{frame:c,inputSource:l});c[On].active=!0,this.dispatchEvent(s,u),c[On].active=!1},this[Te].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[Te].activeRenderState}get environmentBlendMode(){return this[Te].device.environmentBlendMode||"opaque"}async requestReferenceSpace(t){if(this[Te].ended)return;if(!Ru.includes(t))throw new TypeError(`XRReferenceSpaceType must be one of ${Ru}`);if(!this[Te].device.doesSessionSupportReferenceSpace(this[Te].id,t))throw new DOMException(`The ${t} reference space is not supported by this session.`,"NotSupportedError");if(t==="viewer")return this[Te].viewerSpace;let e=await this[Te].device.requestFrameOfReferenceTransform(t);if(t==="bounded-floor")throw e?this[Te].device.requestStageBounds()?new DOMException(`The WebXR polyfill does not support the ${t} reference space yet.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError"):new DOMException(`${t} XRReferenceSpace not supported by this device.`,"NotSupportedError");return new io(t,e)}requestAnimationFrame(t){if(this[Te].ended)return;let e=++this[Te].frameHandle;return this[Te].frameCallbacks.push({handle:e,callback:t,cancelled:!1}),e}cancelAnimationFrame(t){let e=this[Te].frameCallbacks,n=e.findIndex(i=>i&&i.handle===t);n>-1&&(e[n].cancelled=!0,e.splice(n,1)),e=this[Te].currentFrameCallbacks,e&&(n=e.findIndex(i=>i&&i.handle===t),n>-1&&(e[n].cancelled=!0))}get inputSources(){return this[Te].device.getInputSources()}async end(){if(!this[Te].ended)return this[Te].immersive&&(this[Te].ended=!0,this[Te].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[Te].onPresentationStart),this[Te].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[Te].onPresentationEnd),this[Te].device.removeEventListener("@@webxr-polyfill/input-select-start",this[Te].onSelectStart),this[Te].device.removeEventListener("@@webxr-polyfill/input-select-end",this[Te].onSelectEnd),this.dispatchEvent("end",new oo("end",{session:this}))),this[Te].stopDeviceFrameLoop(),this[Te].device.endSession(this[Te].id)}updateRenderState(t){if(this[Te].ended){let n="Can't call updateRenderState on an XRSession that has already ended.";throw new Error(n)}if(t.baseLayer&&t.baseLayer._session!==this){let n="Called updateRenderState with a base layer that was created by a different session.";throw new Error(n)}if(t.inlineVerticalFieldOfView!==null&&t.inlineVerticalFieldOfView!==void 0)if(this[Te].immersive){let n="inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.";throw new Error(n)}else t.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,t.inlineVerticalFieldOfView));if(this[Te].pendingRenderState===null){let n=this[Te].activeRenderState;this[Te].pendingRenderState={depthNear:n.depthNear,depthFar:n.depthFar,inlineVerticalFieldOfView:n.inlineVerticalFieldOfView,baseLayer:n.baseLayer}}Object.assign(this[Te].pendingRenderState,t)}_checkInputSourcesChange(){let t=[],e=[],n=this.inputSources,i=this[Te].currentInputSources;for(let o of n)i.includes(o)||t.push(o);for(let o of i)n.includes(o)||e.push(o);(t.length>0||e.length>0)&&this.dispatchEvent("inputsourceschange",new Io("inputsourceschange",{session:this,added:t,removed:e})),this[Te].currentInputSources.length=0;for(let o of n)this[Te].currentInputSources.push(o)}};var vs=Symbol("@@webxr-polyfill/XRInputSource"),la=class{constructor(t){this[vs]={impl:t,gripSpace:new di("grip",this),targetRaySpace:new di("target-ray",this)}}get handedness(){return this[vs].impl.handedness}get targetRayMode(){return this[vs].impl.targetRayMode}get gripSpace(){let t=this[vs].impl.targetRayMode;return t==="gaze"||t==="screen"?null:this[vs].gripSpace}get targetRaySpace(){return this[vs].targetRaySpace}get profiles(){return this[vs].impl.profiles}get gamepad(){return this[vs].impl.gamepad}};var Pw=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),ca=class extends Event{constructor(t,e){super(t,e),this[Pw]={referenceSpace:e.referenceSpace,transform:e.transform||null},Object.setPrototypeOf(this,ca.prototype)}get referenceSpace(){return this[Pw].referenceSpace}get transform(){return this[Pw].transform}};var pm={XRSystem:Bu,XRSession:aa,XRSessionEvent:oo,XRFrame:xs,XRView:oa,XRViewport:ia,XRViewerPose:ra,XRWebGLLayer:Hu,XRSpace:di,XRReferenceSpace:io,XRReferenceSpaceEvent:ca,XRInputSource:la,XRInputSourceEvent:Lo,XRInputSourcesChangeEvent:Io,XRRenderState:ws,XRRigidTransform:Po,XRPose:na};var Lw=r=>typeof r.prototype.makeXRCompatible=="function"?!1:(r.prototype.makeXRCompatible=function(){return this[Nu]=!0,Promise.resolve()},!0),Iw=r=>{let t=r.prototype.getContext;r.prototype.getContext=function(e,n){let i=t.call(this,e,n);return i&&(i[cm]=!0,n&&"xrCompatible"in n&&(i[Nu]=n.xrCompatible)),i}};var Vy=r=>!!(r.ImageBitmapRenderingContext&&r.createImageBitmap),Oy=r=>{var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(r.navigator.userAgent||r.navigator.vendor||r.opera),t},Ny=r=>{r.style.display="block",r.style.position="absolute",r.style.width=r.style.height="1px",r.style.top=r.style.left="0px"};var Jy=K1(Hy());var ua=class extends Co{constructor(t){super(),this.global=t,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(t,e){throw new Error("Not implemented")}isSessionSupported(t){throw new Error("Not implemented")}isFeatureSupported(t){throw new Error("Not implemented")}async requestSession(t,e){throw new Error("Not implemented")}requestAnimationFrame(t){throw new Error("Not implemented")}onFrameStart(t){throw new Error("Not implemented")}onFrameEnd(t){throw new Error("Not implemented")}doesSessionSupportReferenceSpace(t,e){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(t,e){}cancelAnimationFrame(t){throw new Error("Not implemented")}endSession(t){throw new Error("Not implemented")}getViewport(t,e,n,i){throw new Error("Not implemented")}getProjectionMatrix(t){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(t){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(t,e,n){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}};var wce={mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},vce={mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},Fce={mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},Wy={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},Ace={mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[Math.PI*-.08,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},bce={mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},Sce={mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},Vw={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},yce={"Daydream Controller":wce,"Gear VR Controller":bce,"HTC Vive Focus Controller":vce,"Oculus Go Controller":Fce,"Oculus Touch (Right)":Wy,"Oculus Touch (Left)":Wy,"OpenVR Gamepad":Ace,"Spatial Controller (Spatial Interaction Source) 045E-065A":Vw,"Spatial Controller (Spatial Interaction Source) 045E-065D":Sce,"Windows Mixed Reality (Right)":Vw,"Windows Mixed Reality (Left)":Vw},Uy=yce;var zy=Wr(.155,-.465,-.15),Tce=Wr(-.155,-.465,-.15),Ece=Wr(0,0,-.25),_ce=Wr(0,0,.05),jy=Wr(-.08,.14,.08),Gy=.4,Mce=.4,kce=.61,Cce=.175,Dce=.12,Pce=.87,Xy=180/Math.PI;function Lce(r,t,e){function n(c,u,p){return c<u?u:c>p?p:c}var i=t[0]*t[0],o=t[1]*t[1],s=t[2]*t[2],l=t[3]*t[3];if(e==="XYZ")r[0]=Math.atan2(2*(t[0]*t[3]-t[1]*t[2]),l-i-o+s),r[1]=Math.asin(n(2*(t[0]*t[2]+t[1]*t[3]),-1,1)),r[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),l+i-o-s);else if(e==="YXZ")r[0]=Math.asin(n(2*(t[0]*t[3]-t[1]*t[2]),-1,1)),r[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),l-i-o+s),r[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),l-i+o-s);else if(e==="ZXY")r[0]=Math.asin(n(2*(t[0]*t[3]+t[1]*t[2]),-1,1)),r[1]=Math.atan2(2*(t[1]*t[3]-t[2]*t[0]),l-i-o+s),r[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),l-i+o-s);else if(e==="ZYX")r[0]=Math.atan2(2*(t[0]*t[3]+t[2]*t[1]),l-i-o+s),r[1]=Math.asin(n(2*(t[1]*t[3]-t[0]*t[2]),-1,1)),r[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),l+i-o-s);else if(e==="YZX")r[0]=Math.atan2(2*(t[0]*t[3]-t[2]*t[1]),l-i+o-s),r[1]=Math.atan2(2*(t[1]*t[3]-t[0]*t[2]),l+i-o-s),r[2]=Math.asin(n(2*(t[0]*t[1]+t[2]*t[3]),-1,1));else if(e==="XZY")r[0]=Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),l-i+o-s),r[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),l+i-o-s),r[2]=Math.asin(n(2*(t[2]*t[3]-t[0]*t[1]),-1,1));else{console.log("No order given for quaternion to euler conversion.");return}}var Uu=class{constructor(){this.hand="right",this.headElbowOffset=zy,this.controllerQ=Qr(),this.lastControllerQ=Qr(),this.headQ=Qr(),this.headPos=Jr(),this.elbowPos=Jr(),this.wristPos=Jr(),this.time=null,this.lastTime=null,this.rootQ=Qr(),this.position=Jr()}setHandedness(t){this.hand!=t&&(this.hand=t,this.hand=="left"?this.headElbowOffset=Tce:this.headElbowOffset=zy)}update(t,e){this.time=lm(),t&&(am(this.lastControllerQ,this.controllerQ),am(this.controllerQ,t)),e&&(tm(this.headPos,e),nm(this.headQ,e));let n=this.getHeadYawOrientation_(),i=this.quatAngle_(this.lastControllerQ,this.controllerQ),o=(this.time-this.lastTime)/1e3;i/o>kce?Ll(this.rootQ,this.rootQ,n,Math.min(i/Cce,1)):am(this.rootQ,n);let l=Wr(0,0,-1);ta(l,l,this.controllerQ);let c=Lu(l,[0,1,0]),u=this.clamp_((c-Dce)/Pce,0,1),p=_w(this.rootQ);Ew(p,p),Tw(p,p,this.controllerQ);let f=this.elbowPos;Sw(f,this.headPos),Pl(f,f,this.headElbowOffset);let w=bw(jy);yw(w,w,u),Pl(f,f,w);let m=this.quatAngle_(p,Qr())*Xy,d=1-Math.pow(m/180,4);sssss;let h=Gy,M=1-Gy,k=d*(h+M*u*Mce),E=Qr();Ll(E,E,p,k);let b=Ew(Qr(),E),g=_w(p);Tw(g,g,b);let v=this.wristPos;Sw(v,_ce),ta(v,v,E),Pl(v,v,Ece),ta(v,v,g),Pl(v,v,f);let y=bw(jy);yw(y,y,u),Pl(this.position,this.wristPos,y),ta(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let t=Jr();return Lce(t,this.headQ,"YXZ"),Dy(Qr(),0,t[1]*Xy,0)}clamp_(t,e,n){return Math.min(Math.max(t,e),n)}quatAngle_(t,e){let n=[0,0,-1],i=[0,0,-1];return ta(n,n,t),ta(i,i,e),yy(n,i)}};var Fr=Symbol("@@webxr-polyfill/XRRemappedGamepad"),qy={pressed:!1,touched:!1,value:0};Object.freeze(qy);var Ow=class{constructor(t,e,n){if(n||(n={}),n.userAgentOverrides){for(let u in n.userAgentOverrides)if(navigator.userAgent.includes(u)){let p=n.userAgentOverrides[u];for(let f in p)f in n?Object.assign(n[f],p[f]):n[f]=p[f];break}}let i=new Array(n.axes&&n.axes.length?n.axes.length:t.axes.length),o=new Array(n.buttons&&n.buttons.length?n.buttons.length:t.buttons.length),s=null;if(n.gripTransform){let u=n.gripTransform.orientation||[0,0,0,1];s=ro(),ms(s,Iu(u,u),n.gripTransform.position||[0,0,0])}let l=null;if(n.targetRayTransform){let u=n.targetRayTransform.orientation||[0,0,0,1];l=ro(),ms(l,Iu(u,u),n.targetRayTransform.position||[0,0,0])}let c=n.profiles;n.displayProfiles&&e.displayName in n.displayProfiles&&(c=n.displayProfiles[e.displayName]),this[Fr]={gamepad:t,map:n,profiles:c||[t.id],mapping:n.mapping||t.mapping,axes:i,buttons:o,gripTransform:s,targetRayTransform:l},this._update()}_update(){let t=this[Fr].gamepad,e=this[Fr].map,n=this[Fr].axes;for(let o=0;o<n.length;++o)e.axes&&o in e.axes?e.axes[o]===null?n[o]=0:n[o]=t.axes[e.axes[o]]:n[o]=t.axes[o];if(e.axes&&e.axes.invert)for(let o of e.axes.invert)o<n.length&&(n[o]*=-1);let i=this[Fr].buttons;for(let o=0;o<i.length;++o)e.buttons&&o in e.buttons?e.buttons[o]===null?i[o]=qy:i[o]=t.buttons[e.buttons[o]]:i[o]=t.buttons[o]}get id(){return""}get _profiles(){return this[Fr].profiles}get index(){return-1}get connected(){return this[Fr].gamepad.connected}get timestamp(){return this[Fr].gamepad.timestamp}get mapping(){return this[Fr].mapping}get axes(){return this[Fr].axes}get buttons(){return this[Fr].buttons}get hapticActuators(){return this[Fr].gamepad.hapticActuators}},zu=class{constructor(t,e,n=0,i=-1){this.polyfill=t,this.display=e,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new la(this),this.lastPosition=Jr(),this.emulatedPosition=!1,this.basePoseMatrix=ro(),this.outputMatrix=ro(),this.primaryButtonIndex=n,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=i,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(t){this.nativeGamepad!==t&&(this.nativeGamepad=t,t?this.gamepad=new Ow(t,this.display,Uy[t.id]):this.gamepad=null),this.handedness=t.hand===""?"none":t.hand,this.gamepad&&this.gamepad._update(),t.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!t.pose.hasPosition):t.hand===""&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let t=this.nativeGamepad.pose,e=t.position,n=t.orientation;if(!e&&!n)return;e?(this.lastPosition[0]=e[0],this.lastPosition[1]=e[1],this.lastPosition[2]=e[2]):t.hasPosition?e=this.lastPosition:(this.armModel||(this.armModel=new Uu),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(n,this.polyfill.getBasePoseMatrix()),e=this.armModel.getPosition()),ms(this.basePoseMatrix,n,e)}else by(this.basePoseMatrix,this.polyfill.getBasePoseMatrix());return this.basePoseMatrix}getXRPose(t,e){switch(this.updateBasePoseMatrix(),e){case"target-ray":t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[Fr].targetRayTransform&&Do(this.outputMatrix,this.outputMatrix,this.gamepad[Fr].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;t._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[Fr].gripTransform&&Do(this.outputMatrix,this.outputMatrix,this.gamepad[Fr].gripTransform);break;default:return null}return t._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}};var iLe=Symbol("@@webxr-polyfill/WebVRDevice"),ju=!1,Ky={highRefreshRate:!0},Yy={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},Ice=0,Nw=class{constructor(t,e,n={}){if(this.mode=t,this.enabledFeatures=e,this.outputContext=null,this.immersive=t=="immersive-vr"||t=="immersive-ar",this.ended=null,this.baseLayer=null,this.id=++Ice,this.modifiedCanvasLayer=!1,this.outputContext&&!ju){let i=n.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(i)}}},pa=class extends ua{constructor(t,e){let{canPresent:n}=e.capabilities;super(t),this.display=e,this.frame=new t.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=n,this.baseModelMatrix=ro(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),t.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=t.navigator&&"getGamepads"in t.navigator,this.HAS_BITMAP_SUPPORT=Vy(t)}get depthNear(){return this.display.depthNear}set depthNear(t){this.display.depthNear=t}get depthFar(){return this.display.depthFar}set depthFar(t){this.display.depthFar=t}onBaseLayerSet(t,e){let n=this.sessions.get(t),i=e.context.canvas;if(n.immersive){let o=this.display.getEyeParameters("left"),s=this.display.getEyeParameters("right");i.width=Math.max(o.renderWidth,s.renderWidth)*2,i.height=Math.max(o.renderHeight,s.renderHeight),this.display.requestPresent([{source:i,attributes:Ky}]).then(()=>{!ju&&!this.global.document.body.contains(i)&&(n.modifiedCanvasLayer=!0,this.global.document.body.appendChild(i),Ny(i)),n.baseLayer=e})}else n.baseLayer=e}isSessionSupported(t){return!(t=="immersive-ar"||t=="immersive-vr"&&this.canPresent===!1)}isFeatureSupported(t){switch(t){case"viewer":return!0;case"local":return!0;case"local-floor":return!0;case"bounded":return!1;case"unbounded":return!1;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let n=t=="immersive-vr";if(n){let o=this.global.document.createElement("canvas");if(!ju){let s=o.getContext("webgl")}await this.display.requestPresent([{source:o,attributes:Ky}])}let i=new Nw(t,e,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(i.id,i),n&&(this.immersiveSession=i,this.dispatchEvent("@@webxr-polyfill/vr-present-start",i.id)),Promise.resolve(i.id)}requestAnimationFrame(t){return this.display.requestAnimationFrame(t)}getPrimaryButtonIndex(t){let e=0,n=t.id.toLowerCase();for(let i in Yy)if(n.includes(i)){e=Yy[i];break}return Math.min(e,t.buttons.length-1)}onFrameStart(t,e){this.display.depthNear=e.depthNear,this.display.depthFar=e.depthFar,this.display.getFrameData(this.frame);let n=this.sessions.get(t);if(n.immersive&&this.CAN_USE_GAMEPAD){let i=this.gamepadInputSources;this.gamepadInputSources={};let o=this.global.navigator.getGamepads();for(let s=0;s<o.length;++s){let l=o[s];if(l&&l.displayId>0){let c=i[s];if(c||(c=new zu(this,this.display,this.getPrimaryButtonIndex(l))),c.updateFromGamepad(l),this.gamepadInputSources[s]=c,c.primaryButtonIndex!=-1){let u=l.buttons[c.primaryButtonIndex].pressed;u&&!c.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:n.id,inputSource:c.inputSource}):!u&&c.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:n.id,inputSource:c.inputSource}),c.primaryActionPressed=u}if(c.primarySqueezeButtonIndex!=-1){let u=l.buttons[c.primarySqueezeButtonIndex].pressed;u&&!c.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:n.id,inputSource:c.inputSource}):!u&&c.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:n.id,inputSource:c.inputSource}),c.primarySqueezeActionPressed=u}}}}if(!ju&&!n.immersive&&n.baseLayer){let i=n.baseLayer.context.canvas;rm(this.frame.leftProjectionMatrix,e.inlineVerticalFieldOfView,i.width/i.height,e.depthNear,e.depthFar)}}onFrameEnd(t){let e=this.sessions.get(t);if(!(e.ended||!e.baseLayer)){if(e.outputContext&&!(e.immersive&&!this.display.capabilities.hasExternalDisplay)){let n=e.immersive&&this.display.capabilities.hasExternalDisplay,i=e.baseLayer.context.canvas,o=n?i.width/2:i.width,s=i.height;if(!ju){let l=e.outputContext.canvas,c=l.width,u=l.height,p=e.renderContext;this.HAS_BITMAP_SUPPORT?i.transferToImageBitmap?p.transferFromImageBitmap(i.transferToImageBitmap()):this.global.createImageBitmap(i,0,0,o,s,{resizeWidth:c,resizeHeight:u}).then(f=>p.transferFromImageBitmap(f)):p.drawImage(i,0,0,o,s,0,0,c,u)}}e.immersive&&e.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(t){this.display.cancelAnimationFrame(t)}async endSession(t){let e=this.sessions.get(t);if(!e.ended){if(e.immersive)return this.display.exitPresent();e.ended=!0}}doesSessionSupportReferenceSpace(t,e){let n=this.sessions.get(t);return n.ended?!1:n.enabledFeatures.has(e)}requestStageBounds(){if(this.display.stageParameters){let t=this.display.stageParameters.sizeX,e=this.display.stageParameters.sizeZ,n=[];return n.push(-t/2),n.push(-e/2),n.push(t/2),n.push(-e/2),n.push(t/2),n.push(e/2),n.push(-t/2),n.push(e/2),n}return null}async requestFrameOfReferenceTransform(t,e){return(t==="local-floor"||t==="bounded-floor")&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(t){if(t==="left")return this.frame.leftProjectionMatrix;if(t==="right")return this.frame.rightProjectionMatrix;if(t==="none")return this.frame.leftProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(t,e,n,i){let o=this.sessions.get(t),{width:s,height:l}=n.context.canvas;if(!o.immersive)return i.x=i.y=0,i.width=s,i.height=l,!0;if(e==="left"||e==="none")i.x=0;else if(e==="right")i.x=s/2;else return!1;return i.y=0,i.width=s/2,i.height=l,!0}getBasePoseMatrix(){let{position:t,orientation:e}=this.frame.pose;return!t&&!e?this.baseModelMatrix:(t||(t=this.tempVec3,t[0]=t[1]=t[2]=0),ms(this.baseModelMatrix,e,t),this.baseModelMatrix)}getBaseViewMatrix(t){if(t==="left"||t==="none")return this.frame.leftViewMatrix;if(t==="right")return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let t=[];for(let e in this.gamepadInputSources)t.push(this.gamepadInputSources[e].inputSource);return t}getInputPose(t,e,n){if(!e)return null;for(let i in this.gamepadInputSources){let o=this.gamepadInputSources[i];if(o.inputSource===t)return o.getXRPose(e,n)}return null}onWindowResize(){}onVRDisplayPresentChange(t){this.display.isPresenting||this.sessions.forEach(e=>{if(e.immersive&&!e.ended){if(e.modifiedCanvasLayer){let n=e.baseLayer.context.canvas;document.body.removeChild(n),n.setAttribute("style","")}this.immersiveSession===e&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",e.id)}})}};var Gu=class extends pa{constructor(t,e){let n=new Jy.default(e||{});super(t,n),this.display=n,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}};var Rce=!1,Bce=0,Hw=class{constructor(t,e){this.mode=t,this.enabledFeatures=e,this.ended=null,this.baseLayer=null,this.id=++Bce}},Xu=class extends ua{constructor(t){super(t),this.sessions=new Map,this.projectionMatrix=ro(),this.identityMatrix=ro()}onBaseLayerSet(t,e){let n=this.sessions.get(t);n.baseLayer=e}isSessionSupported(t){return t=="inline"}isFeatureSupported(t){switch(t){case"viewer":return!0;default:return!1}}async requestSession(t,e){if(!this.isSessionSupported(t))return Promise.reject();let n=new Hw(t,e);return this.sessions.set(n.id,n),Promise.resolve(n.id)}requestAnimationFrame(t){return window.requestAnimationFrame(t)}cancelAnimationFrame(t){window.cancelAnimationFrame(t)}onFrameStart(t,e){if(Rce)return;let n=this.sessions.get(t);if(n.baseLayer){let i=n.baseLayer.context.canvas;rm(this.projectionMatrix,e.inlineVerticalFieldOfView,i.width/i.height,e.depthNear,e.depthFar)}}onFrameEnd(t){}async endSession(t){let e=this.sessions.get(t);e.ended=!0}doesSessionSupportReferenceSpace(t,e){let n=this.sessions.get(t);return n.ended?!1:n.enabledFeatures.has(e)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(t,e){return null}getProjectionMatrix(t){return this.projectionMatrix}getViewport(t,e,n,i){let o=this.sessions.get(t),{width:s,height:l}=n.context.canvas;return i.x=i.y=0,i.width=s,i.height=l,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(t){return this.identityMatrix}getInputSources(){return[]}getInputPose(t,e,n){return null}onWindowResize(){}};var Vce=async function(r){let t=null;if("getVRDisplays"in r.navigator)try{let e=await r.navigator.getVRDisplays();e&&e.length&&(t=new pa(r,e[0]))}catch{}return t},Qy=async function(r,t){if(t.webvr){let n=await Vce(r);if(n)return n}let e=Oy(r);return e&&t.cardboard||!e&&t.allowCardboardOnDesktop?(r.VRFrameData||(r.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new Gu(r,t.cardboardConfig)):new Xu(r)};var Oce={global:em,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},dm=["navigator","HTMLCanvasElement","WebGLRenderingContext"],qu=class{constructor(t={}){this.config=Object.freeze(Object.assign({},Oce,t)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}_injectPolyfill(t){if(!dm.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${dm}`);for(let e of Object.keys(pm))t[e]!==void 0?console.warn(`${e} already defined on global.`):t[e]=pm[e];Lw(t.WebGLRenderingContext)&&(Iw(t.HTMLCanvasElement),t.OffscreenCanvas&&Iw(t.OffscreenCanvas),t.WebGL2RenderingContext&&Lw(t.WebGL2RenderingContext),window.isSecureContext||console.warn(`WebXR Polyfill Warning:
This page is not running in a secure context (https:// or localhost)!
This means that although the page may be able to use the WebXR Polyfill it will
not be able to use native WebXR implementations, and as such will not be able to
access dedicated VR or AR hardware, and will not be able to take advantage of
any performance improvements a native WebXR implementation may offer. Please
host this content on a secure origin for the best user experience.
`)),this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let t=Qy(this.global,this.config);this.xr=new pm.XRSystem(t),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(t){if(!dm.every(e=>!!t[e]))throw new Error(`Global must have the following attributes : ${dm}`);if(t.navigator.xr&&"supportsSession"in t.navigator.xr&&!("isSessionSupported"in t.navigator.xr)){let e=t.navigator.xr.supportsSession;t.navigator.xr.isSessionSupported=function(n){return e.call(this,n).then(()=>!0).catch(()=>!1)},t.navigator.xr.supportsSession=function(n){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),e.call(this,n)}}}};navigator.xr||(console.info("Polyfilling WebXR API"),new qu);var mm=class extends Ae{constructor(e,n,i,o,s){super(e);this.mode=n;this.session=i;this.referenceSpaceType=o;this.sessionMode=s}},fm=class extends mm{constructor(t,e,n,i){super("sessionstarted",t,e,n,i)}},gm=class extends mm{constructor(t,e,n,i){super("sessionstopped",t,e,n,i)}},hm=new Map([["VR",{referenceSpaceType:"local-floor",sessionMode:"immersive-vr"}],["AR",{referenceSpaceType:"local-floor",sessionMode:"immersive-ar"}]]),xm=class extends qe{constructor(e,n,i,o){super();this.renderer=e;this.camera=n;this.fullscreenElement=i;this.enableFullResolution=o;this._currentMode="None";this.buttons=new Map;this.currentSession=null;this.screenUI=null;this.wasVisible=new Map;this.lastFOV=50;this.addEventListener("sessionstarted",s=>{s.sessionMode==="inline"&&(this.lastFOV=this.camera.fov,this.camera.fov=Yt(s.session.renderState.inlineVerticalFieldOfView))}),this.addEventListener("sessionstopped",s=>{s.sessionMode==="inline"&&(this.camera.fov=this.lastFOV)}),this.renderer.xr.addEventListener("sessionstart",()=>this.onSessionStarted()),this.renderer.xr.addEventListener("sessionend",()=>this.onSessionEnded()),this.refresh()}setUI(e,n,i,o){this.screenUI=e,this.buttons.set(n.mode,n),this.buttons.set(i.mode,i),this.buttons.set(o.mode,o);for(let s of this.buttons.values())this.wasVisible.set(s,s.visible),s.addEventListener("click",this.toggleMode.bind(this,s.mode));n.available=!Ao()&&Aw(),i.available=ld(),o.available=ad(),this.refresh()}get visible(){return zn(this.renderer.domElement)}set visible(e){st(this.renderer.domElement,e),this.screenUI&&(e?this.screenUI.show():this.screenUI.hide())}get currentMode(){return this._currentMode}resize(){if(!this.renderer.xr.isPresenting){let{clientWidth:e,clientHeight:n,width:i,height:o}=this.renderer.domElement,s=Math.floor(e*devicePixelRatio),l=Math.floor(n*devicePixelRatio);e>0&&n>0&&(i!==s||o!==l)&&(this.renderer.setPixelRatio(devicePixelRatio),this.renderer.setSize(e,n,!1),this.camera.aspect=e/n,this.camera.updateProjectionMatrix())}}getMetrics(){let e=this.renderer.domElement.clientWidth,n=this.renderer.domElement.clientHeight,i=this.renderer.getPixelRatio(),o=this.camera.fov;return{width:e,height:n,pixelRatio:i,fov:o}}setMetrics(e,n,i,o){this.renderer.setPixelRatio(i),this.renderer.setSize(e,n,!1),this.camera.aspect=e/n,this.camera.fov=o,this.camera.updateProjectionMatrix()}async refresh(){let e=Array.from(this.buttons.values()).filter(n=>n.available&&n.mode!=="Fullscreen");await Promise.all(e.map(async n=>{let i=hm.get(n.mode);if(n.available=T(i),n.available){let o=navigator.xr&&await navigator.xr.isSessionSupported(i.sessionMode),s=!ad()&&gx()&&i.sessionMode==="immersive-vr"&&i.referenceSpaceType==="local-floor";n.available=o||s}}))}async toggleMode(e){e==="Fullscreen"?await this.toggleFullscreen():e!=="None"&&await this.toggleXR(e)}async start(e){e!==this.currentMode&&(await this.toggleMode(this.currentMode),await this.toggleMode(e))}async stop(){await this.toggleMode(this.currentMode)}get isFullscreen(){return document.fullscreen}async startFullscreen(){this.isFullscreen||(await this.fullscreenElement.requestFullscreen({navigationUI:"show"}),this.setActive("Fullscreen"),this.dispatchEvent(new fm("Fullscreen",null,null,null)))}async stopFullscreen(){this.isFullscreen&&(await document.exitFullscreen(),this.setActive("None"),this.dispatchEvent(new gm("Fullscreen",null,null,null)))}async toggleFullscreen(){this.isFullscreen?await this.stopFullscreen():await this.startFullscreen()}async toggleXR(e){let n=hm.get(e);if(T(n)){if(this.currentSession)this.currentSession.end();else if(navigator.xr){this.camera.position.setScalar(0),this.camera.quaternion.identity();try{let i=await navigator.xr.requestSession(n.sessionMode,{optionalFeatures:["local-floor","bounded-floor","high-refresh-rate","hand-tracking","layers"]});if(this.setActive(e),this.currentSession=i,this.renderer.xr.setReferenceSpaceType(n.referenceSpaceType),this.enableFullResolution&&"XRWebGLLayer"in window&&"getNativeFramebufferScaleFactor"in XRWebGLLayer){let o=XRWebGLLayer.getNativeFramebufferScaleFactor(i);this.renderer.xr.setFramebufferScaleFactor(o)}this.renderer.xr.setSession(i)}catch(i){console.error(`Couldn't start session type '${n.sessionMode}'. Reason: ${i&&i.message||i||"UNKNOWN"}`)}}}}onSessionStarted(){let e=this.currentMode,n=hm.get(this.currentMode),i=this.currentSession;if(i.supportedFrameRates){let o=Math.max(...i.supportedFrameRates);console.log("Changing framerate to",o),i.updateTargetFrameRate(o)}this.dispatchEvent(new fm(e,i,n.referenceSpaceType,n.sessionMode))}onSessionEnded(){let e=this.currentMode,n=hm.get(this.currentMode),i=this.currentSession;this.currentSession=null,this.renderer.xr.setSession(null),this.setActive("None"),this.dispatchEvent(new gm(e,i,n.referenceSpaceType,n.sessionMode))}setActive(e){for(let n of this.buttons.values())n.active=n.mode===e,n.visible=this.wasVisible.get(n)&&(e==="None"||e==="Fullscreen"||n.mode===e);this._currentMode=e}};var $y=new Ie(0,1,0),Pr=2048,Il=Pr/2,Nce=[1,0,2,3,4,5],Bi={rows:3,columns:4,indices:[[-1,2,-1,-1],[0,5,1,4],[-1,3,-1,-1]],rotations:[[0,xn,0,0],[0,0,0,0],[0,xn,0,0]]},wm=new Vn(0),vm=class{constructor(t){this.env=t;this.rt=new $b(Pr);this.rtScene=new Za;this.rtCamera=new fb(.01,10,this.rt);this._rotation=new xt;this.layerRotation=new xt().identity();this.stageRotation=new xt().identity();this.canvases=new Array(6);this.contexts=new Array(6);this.layerOrientation=null;this.images=null;this.curImagePath=null;this.layer=null;this.wasVisible=!1;this.stageHeading=0;this.rotationNeedsUpdate=!1;this.imageNeedsUpdate=!1;this.useWebXRLayers=!0;this.wasWebXRLayerAvailable=null;this.visible=!0;this.onNeedsRedraw=()=>this.imageNeedsUpdate=!0,this.env.scene.background=wm;for(let e=0;e<this.canvases.length;++e){let n=this.canvases[e]=Mi(Pr,Pr);this.contexts[e]=n.getContext("2d",{alpha:!1})}for(let e=0;e<Bi.rows;++e){let n=Bi.indices[e],i=Bi.rotations[e];for(let o=0;o<Bi.columns;++o){let s=n[o];if(s>-1){let l=this.contexts[s],c=i[o];c>0&&(c%2,l.translate(Il,Il),l.rotate(c),l.translate(-Il,-Il))}}}this.rt.texture.name="SkyboxOutput",this.rtScene.add(this.rtCamera),this.flipped=Mi(Pr,Pr),this.flipper=this.flipped.getContext("2d",{alpha:!1}),this.flipper.fillStyle=wm.getHexString(),this.flipper.scale(-1,1),this.flipper.translate(-Pr,0),this.setImages("",this.canvases),this.env.addScopedEventListener(this,"update",e=>this.checkWebXRLayer(e.frame)),Object.seal(this)}get envMap(){return this._cube}clear(){this.setImage(null,null)}setImage(t,e){return t!==this.curImagePath?T(e)?(this.sliceImage(e),this.setImages(t,this.canvases)):this.setImages(t,null):null}sliceImage(t){let e=t.width/Bi.columns,n=t.height/Bi.rows;for(let i=0;i<Bi.rows;++i){let o=Bi.indices[i];for(let s=0;s<Bi.columns;++s){let l=o[s];l>-1&&this.contexts[l].drawImage(t,s*e,i*n,e,n,0,0,Pr,Pr)}}return this.canvases}setImages(t,e){if((t!==this.curImagePath||e!==this.images)&&(this.curImagePath=t,e!==this.images)){if(T(this._cube)&&(St(this._cube),this._cube=null),T(this.images))for(let n of this.images)St(n);this.images=e,T(this.images)?(this.rtScene.background=this._cube=new gb(this.images),this._cube.name="SkyboxInput"):this.rtScene.background=wm}return this.updateImages(),this._cube}updateImages(){this._cube.needsUpdate=!0,this.imageNeedsUpdate=!0}get rotation(){return this._rotation}set rotation(t){let{x:e,y:n,z:i,w:o}=this._rotation;if(rS(t))this._rotation.copy(t);else if(iS(t))this._rotation.setFromEuler(t);else if(hr(t))if(t.length===4&&Rt(t[0])&&Rt(t[1])&&Rt(t[2])&&Rt(t[3]))this._rotation.fromArray(t);else throw new Error("Skybox rotation was not a valid array format. Needs an array of 4 numbers.");else Ir(t)?this._rotation.setFromAxisAngle($y,t):(T(t)&&console.warn("Skybox rotation must be a THREE.Quaternion, THREE.Euler, number[] (representing a Quaternion), or a number (representing rotation about the Y-axis)."),this._rotation.identity());this.rotationNeedsUpdate=this._rotation.x!==e||this._rotation.y!==n||this._rotation.z!==i||this._rotation.w!==o}checkWebXRLayer(t){if(this._cube){let e=this.useWebXRLayers&&this.env.hasXRCompositionLayers&&T(t)&&T(this.env.xrBinding),n=e!==this.wasWebXRLayerAvailable;if(n){if(e){let i=this.env.renderer.xr.getReferenceSpace();this.layer=this.env.xrBinding.createCubeLayer({space:i,layout:"mono",isStatic:!1,viewPixelWidth:Pr,viewPixelHeight:Pr,orientation:this.layerOrientation}),this.layer.addEventListener("redraw",this.onNeedsRedraw),this.env.addWebXRLayer(this.layer,Number.MAX_VALUE)}else this.layer&&(this.env.removeWebXRLayer(this.layer),this.layer.removeEventListener("redraw",this.onNeedsRedraw),$o(this.layer),this.layer=null);this.imageNeedsUpdate=!0}if(!this.layer||!n){let i=this.visible!==this.wasVisible,o=this.env.avatar.headingRadians!==this.stageHeading;if(this.imageNeedsUpdate=this.imageNeedsUpdate||i||this.layer&&this.layer.needsRedraw,this.rotationNeedsUpdate=this.rotationNeedsUpdate||o,this.env.scene.background=this.layer?null:this.visible?this.rt.texture:wm,this.rotationNeedsUpdate&&(this.layerRotation.copy(this.rotation).invert(),this.stageRotation.setFromAxisAngle($y,this.env.avatar.headingRadians).premultiply(this.layerRotation),this.layerOrientation=new DOMPointReadOnly(this.stageRotation.x,this.stageRotation.y,this.stageRotation.z,this.stageRotation.w),this.layer?this.layer.orientation=this.layerOrientation:(this.rtCamera.quaternion.copy(this.layerRotation),this.imageNeedsUpdate=!0)),this.imageNeedsUpdate)if(this.layer){let s=this.env.renderer.getContext(),l=this.env.xrBinding.getSubImage(this.layer,t),c=this._cube.images;this.flipper.fillRect(0,0,Pr,Pr),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.bindTexture(s.TEXTURE_CUBE_MAP,l.colorTexture);for(let u=0;u<c.length;++u){if(this.visible){let p=c[Nce[u]];this.flipper.drawImage(p,0,0,p.width,p.height,0,0,Pr,Pr)}s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.flipped)}s.bindTexture(s.TEXTURE_CUBE_MAP,null)}else this.rtCamera.update(this.env.renderer,this.rtScene);this.stageHeading=this.env.avatar.headingRadians,this.imageNeedsUpdate=!1,this.rotationNeedsUpdate=!1,this.wasVisible=this.visible}this.wasWebXRLayerAvailable=e}}};var Rl=new Ie,Zy=0,Hce=new Ie,Fm=new Ie,Ww=new Ie,Am=new xt,eT=0,Wce=0;function Uce(r,t){let e=r-t,n=e+Jn,i=e-Jn;return sb(e,n,i)}var Ku=class extends Et{constructor(e,n,i,o,s=1){super();this.minDistance=n;this.heightOffset=o;this.speed=s;this.name=e,this.lerp=this.minHeadingRadians>0||this.minDistance>0,this.maxDistance=this.minDistance*5,this.minHeadingRadians=at(i),this.maxHeadingRadians=xn-this.minHeadingRadians,Object.seal(this)}copy(e,n=!0){return super.copy(e,n),this.name=e.name+ ++Wce,this.lerp=e.lerp,this.maxDistance=e.maxDistance,this.minHeadingRadians=e.minHeadingRadians,this.maxHeadingRadians=e.maxHeadingRadians,this}update(e,n,i,o){o*=.001,this.clampTo(this.lerp,e,n,this.minDistance,this.maxDistance,i,this.minHeadingRadians,this.maxHeadingRadians,o)}reset(e,n,i){this.clampTo(!1,e,n,0,0,i,0,0,0)}clampTo(e,n,i,o,s,l,c,u,p){Rl.copy(i),Rl.y-=this.heightOffset*n,Zy=l,this.getWorldPosition(Fm),this.getWorldDirection(Ww),Ww.negate(),eT=ku(Ww),Am.identity();let f=!e,w=!e;if(e){let A=Hce.copy(Rl).sub(Fm).length();o<A&&(A<s&&Rl.lerpVectors(Fm,Rl,this.speed*p),f=!0);let m=Uce(Zy,eT),d=Math.abs(m);c<d&&(d<u?Am.setFromAxisAngle(this.up,m*this.speed*p):Am.setFromAxisAngle(this.up,m),w=!0)}(f||w)&&(f&&this.position.add(Rl.sub(Fm)),w&&this.quaternion.multiply(Am))}};var bm=class extends Ae{constructor(e,n){super(e);this.button=n}},Uw=class extends bm{constructor(t){super("gamepadbuttonup",t)}},zw=class extends bm{constructor(t){super("gamepadbuttondown",t)}},jw=class extends Ae{constructor(e,n,i){super(e);this.axis=n;this.value=i}},Gw=class extends jw{constructor(t,e){super("gamepadaxismaxed",t,e)}},Sm=class extends qe{constructor(){super();this.lastAxisValues=new Array;this.btnDownEvts=new Array;this.btnUpEvts=new Array;this.wasPressed=new Array;this.axisMaxEvts=new Array;this.wasAxisMaxed=new Array;this.sticks=new Array;this.axisThresholdMax=.9;this.axisThresholdMin=.1;this._pad=null;Object.seal(this)}get displayId(){if("displayId"in this.pad)return this.pad.displayId}get pad(){return this._pad}set pad(e){if(this._pad=e,this.pad){if(this.btnUpEvts.length===0){for(let n=0;n<e.buttons.length;++n)this.btnDownEvts[n]=new zw(n),this.btnUpEvts[n]=new Uw(n),this.wasPressed[n]=!1;for(let n=0;n<e.axes.length;++n)this.axisMaxEvts[n]=new Gw(n,0),this.wasAxisMaxed[n]=!1,n%2===0&&n<e.axes.length-1&&(this.sticks[n/2]={x:0,y:0}),this.lastAxisValues[n]=e.axes[n]}for(let n=0;n<this.pad.buttons.length;++n){let i=this.wasPressed[n],o=this.pad.buttons[n].pressed;o!==i&&(this.wasPressed[n]=o,this.dispatchEvent((o?this.btnDownEvts:this.btnUpEvts)[n]))}for(let n=0;n<this.pad.axes.length;++n){let i=this.wasAxisMaxed[n],o=this.pad.axes[n],s=Math.sign(o),l=Math.abs(o),c=l>=this.axisThresholdMax,u=l<=this.axisThresholdMin,p=s*(c?1:u?0:l);c&&!i&&(this.axisMaxEvts[n].value=p,this.dispatchEvent(this.axisMaxEvts[n])),this.wasAxisMaxed[n]=c,this.lastAxisValues[n]=p}for(let n=0;n<this.axes.length-1;n+=2){let i=this.sticks[n/2];i.x=this.axes[n],i.y=this.axes[n+1]}}}get id(){return this.pad?this.pad.id:null}get index(){return this.pad?this.pad.index:null}get connected(){return this.pad&&this.pad.connected}get mapping(){return this.pad?this.pad.mapping:null}get timestamp(){return this.pad?this.pad.timestamp:null}get hand(){return this.pad?this.pad.hand:null}get pose(){return this.pad?this.pad.pose:null}get buttons(){return this.pad?this.pad.buttons:null}get axes(){return this.pad?this.pad.axes:null}get hapticActuators(){return this.pad?this.pad.hapticActuators:null}};var ym=class extends Tl{constructor(t){super(t)}start(){this.timer=setInterval(()=>this.onTick(performance.now()),this.targetFrameTime)}stop(){this.timer&&(clearInterval(this.timer),super.stop())}get targetFPS(){return super.targetFPS}set targetFPS(t){super.targetFPS=t,this.isRunning&&this.restart()}};var Xw=class extends Ae{constructor(){super("activity");this.level=0}},Yu=class extends ll{constructor(e){super(e,{fftSize:32,minDecibels:-70});this._level=0;this.maxLevel=0;this.activityEvt=new Xw;this.timer=new ym(30);let n=new Uint8Array(this.frequencyBinCount);this.timer.addTickHandler(()=>{this.getByteFrequencyData(n),this._level=Math.max(...n),isFinite(this._level)&&(this.maxLevel=Math.max(this.maxLevel,this._level),this.maxLevel>0&&(this._level/=this.maxLevel)),this.activityEvt.level=this.level,this.dispatchEvent(this.activityEvt)})}get level(){return this._level}start(){this.timer.start()}stop(){this.timer.stop()}};var Bl=new Ie;function qw(r,t,e,n){Bl.crossVectors(t,r),r.crossVectors(Bl,t),Bl.normalize(),r.normalize(),t.normalize(),n.set(Bl.x,r.x,-t.x,e.x,Bl.y,r.y,-t.y,e.y,Bl.z,r.z,-t.z,e.z,0,0,0,1)}var Vl=class{constructor(){this._visible=!0;this._style="default"}get style(){return this._style}set style(t){this._style=t}get visible(){return this._visible}set visible(t){this._visible=t}};var Fs=class extends Vl{constructor(e){super();this.env=e;this._object=null;this.T=new Ie;this.V=new Ie;this.Q=new xt;this._side=-1;this.f=new Ie;this.up=new Ie;this.right=new Ie}get side(){return this._side}set side(e){this._side=e}get object(){return this._object}set object(e){this._object=e}get position(){return this.object.position}update(e,n,i,o,s,l,c,u,p,f,w){i&&i.face?(this.position.copy(i.point),i.object.getWorldQuaternion(this.Q),this.T.copy(i.face.normal).applyQuaternion(this.Q),this.V.copy(this.T).multiplyScalar(.02),this.position.add(this.V),this.V.copy(this.T).multiplyScalar(10).add(this.position)):(l?this.position.copy(f).multiplyScalar(2).add(p).sub(this.env.avatar.worldPos).normalize().multiplyScalar(s).add(this.env.avatar.worldPos):(this.V.copy(p).add(n).sub(e).multiplyScalar(2),this.position.copy(f).multiplyScalar(s).add(this.V).add(this.env.avatar.worldPos)),this.V.copy(this.env.avatar.worldPos)),this.lookAt(this.position,this.V),this.style=!o||o.navigable&&!u?c?w?"grabbing":"grab":"default":o.enabled?o.draggable?w?"grabbing":"move":o.navigable?"cell":o.clickable?"pointer":"default":"not-allowed"}lookAt(e,n){this.f.copy(n).sub(e).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat),this.right.crossVectors(this.up,this.f),this.up.crossVectors(this.f,this.right),qw(this.up,this.f,e,this.object.matrixWorld),this.object.matrix.copy(this.object.parent.matrixWorld).invert().multiply(this.object.matrixWorld),this.object.matrix.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.scale.x*=this.side,this.object.matrix.compose(this.object.position,this.object.quaternion,this.object.scale)}};var da=class extends Fs{constructor(e){super(e);this.material=zx({name:"CursorMat",color:16776960}),this.object=new Nr(.01,.01,.01,this.material)}get style(){return this._currentStyle}set style(e){if(this._currentStyle=e,or(this.object)&&!hr(this.object.material))switch(this._currentStyle){case"pointer":this.material.color=new Vn(65280),this.material.needsUpdate=!0;break;case"not-allowed":this.material.color=new Vn(16711680),this.material.needsUpdate=!0;break;case"move":this.material.color=new Vn(255),this.material.needsUpdate=!0;break;case"grab":this.material.color=new Vn(16711935),this.material.needsUpdate=!0;break;case"grabbing":this.material.color=new Vn(65535),this.material.needsUpdate=!0;break;default:this._currentStyle="default",this.material.color=new Vn(16776960),this.material.needsUpdate=!0;break}}get visible(){return nl(this)}set visible(e){wn(this,e)}};var tT=new Ws,Tm=new Ie,ha=class extends bb{constructor(){super(),this.type="LineSegmentsGeometry";let t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n),this.setAttribute("position",new Md(t,3)),this.setAttribute("uv",new Md(e,2))}applyMatrix4(t){let e=this.attributes.instanceStart,n=this.attributes.instanceEnd;return e!==void 0&&(e.applyMatrix4(t),n.applyMatrix4(t),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let n=new su(e,6,1);return this.setAttribute("instanceStart",new Ci(n,3,0)),this.setAttribute("instanceEnd",new Ci(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));let n=new su(e,6,1);return this.setAttribute("instanceColorStart",new Ci(n,3,0)),this.setAttribute("instanceColorEnd",new Ci(n,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new Zb(t.geometry)),this}fromLineSegments(t){let e=t.geometry;if(e.isGeometry){console.error("LineSegmentsGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ws);let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;t!==void 0&&e!==void 0&&(this.boundingBox.setFromBufferAttribute(t),tT.setFromBufferAttribute(e),this.boundingBox.union(tT))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new el),this.boundingBox===null&&this.computeBoundingBox();let t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(t!==void 0&&e!==void 0){let n=this.boundingSphere.center;this.boundingBox.getCenter(n);let i=0;for(let o=0,s=t.count;o<s;o++)Tm.fromBufferAttribute(t,o),i=Math.max(i,n.distanceToSquared(Tm)),Tm.fromBufferAttribute(e,o),i=Math.max(i,n.distanceToSquared(Tm));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(t){return console.warn("LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}};ha.prototype.isLineSegmentsGeometry=!0;var nT=new Ie,rT=new Ie,lr=new Ji,cr=new Ji,so=new Ji,Kw=new Ie,Yw=new Vt,hi=new Eb,iT=new Ie,Ro=new Ws,Em=new el,ao=new Ji;function oT(r,t,e,n){return ao.set(0,0,-t,1).applyMatrix4(r.projectionMatrix),ao.multiplyScalar(1/ao.w),ao.x=e/n.width,ao.y=e/n.height,ao.applyMatrix4(r.projectionMatrixInverse),ao.multiplyScalar(1/ao.w),Math.abs(Math.max(ao.x,ao.y))}var Ju=class extends kr{constructor(t=new ha,e=new _o({color:Math.random()*16777215})){super(t,e),this.type="LineSegments2"}computeLineDistances(){let t=this.geometry,e=t.attributes.instanceStart,n=t.attributes.instanceEnd,i=new Float32Array(2*e.count);for(let s=0,l=0,c=e.count;s<c;s++,l+=2)nT.fromBufferAttribute(e,s),rT.fromBufferAttribute(n,s),i[l]=l===0?0:i[l-1],i[l+1]=i[l]+nT.distanceTo(rT);let o=new su(i,2,1);return t.setAttribute("instanceDistanceStart",new Ci(o,1,0)),t.setAttribute("instanceDistanceEnd",new Ci(o,1,1)),this}raycast(t,e){t.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');let n=t.params.Line2!==void 0&&t.params.Line2.threshold||0,i=t.ray,o=t.camera,s=o.projectionMatrix,l=this.matrixWorld,c=this.geometry,u=this.material,p=u.resolution,f=u.linewidth+n,w=c.attributes.instanceStart,A=c.attributes.instanceEnd,m=-o.near;c.boundingSphere===null&&c.computeBoundingSphere(),Em.copy(c.boundingSphere).applyMatrix4(l);let d=Math.max(o.near,Em.distanceToPoint(i.origin)),h=oT(o,d,f,p);if(Em.radius+=h,t.ray.intersectsSphere(Em)===!1)return;c.boundingBox===null&&c.computeBoundingBox(),Ro.copy(c.boundingBox).applyMatrix4(l);let M=Math.max(o.near,Ro.distanceToPoint(i.origin)),k=oT(o,M,f,p);if(Ro.max.x+=k,Ro.max.y+=k,Ro.max.z+=k,Ro.min.x-=k,Ro.min.y-=k,Ro.min.z-=k,t.ray.intersectsBox(Ro)!==!1){i.at(1,so),so.w=1,so.applyMatrix4(o.matrixWorldInverse),so.applyMatrix4(s),so.multiplyScalar(1/so.w),so.x*=p.x/2,so.y*=p.y/2,so.z=0,Kw.copy(so),Yw.multiplyMatrices(o.matrixWorldInverse,l);for(let b=0,g=w.count;b<g;b++){lr.fromBufferAttribute(w,b),cr.fromBufferAttribute(A,b),lr.w=1,cr.w=1,lr.applyMatrix4(Yw),cr.applyMatrix4(Yw);var E=lr.z>m&&cr.z>m;if(E)continue;if(lr.z>m){let D=lr.z-cr.z,L=(lr.z-m)/D;lr.lerp(cr,L)}else if(cr.z>m){let D=cr.z-lr.z,L=(cr.z-m)/D;cr.lerp(lr,L)}lr.applyMatrix4(s),cr.applyMatrix4(s),lr.multiplyScalar(1/lr.w),cr.multiplyScalar(1/cr.w),lr.x*=p.x/2,lr.y*=p.y/2,cr.x*=p.x/2,cr.y*=p.y/2,hi.start.copy(lr),hi.start.z=0,hi.end.copy(cr),hi.end.z=0;let v=hi.closestPointToPointParameter(Kw,!0);hi.at(v,iT);let y=Pd.lerp(lr.z,cr.z,v),V=y>=-1&&y<=1,B=Kw.distanceTo(iT)<f*.5;if(V&&B){hi.start.fromBufferAttribute(w,b),hi.end.fromBufferAttribute(A,b),hi.start.applyMatrix4(l),hi.end.applyMatrix4(l);let D=new Ie,L=new Ie;i.distanceSqToSegment(hi.start,hi.end,L,D),e.push({point:L,pointOnLine:D,distance:i.origin.distanceTo(L),object:this,face:null,faceIndex:b,uv:null,uv2:null})}}}}};Ju.prototype.isLineSegments2=!0;var ma=class extends ha{constructor(){super(),this.type="LineGeometry"}setPositions(t){for(var e=t.length-3,n=new Float32Array(2*e),i=0;i<e;i+=3)n[2*i]=t[i],n[2*i+1]=t[i+1],n[2*i+2]=t[i+2],n[2*i+3]=t[i+3],n[2*i+4]=t[i+4],n[2*i+5]=t[i+5];return super.setPositions(n),this}setColors(t){for(var e=t.length-3,n=new Float32Array(2*e),i=0;i<e;i+=3)n[2*i]=t[i],n[2*i+1]=t[i+1],n[2*i+2]=t[i+2],n[2*i+3]=t[i+3],n[2*i+4]=t[i+4],n[2*i+5]=t[i+5];return super.setColors(n),this}fromLine(t){var e=t.geometry;if(e.isGeometry){console.error("LineGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else e.isBufferGeometry&&this.setPositions(e.attributes.position.array);return this}};ma.prototype.isLineGeometry=!0;var Qu=class extends Ju{constructor(t=new ma,e=new _o({color:Math.random()*16777215})){super(t,e),this.type="Line2"}};Qu.prototype.isLine2=!0;var sT=new ma;sT.setPositions([0,0,0,0,0,-1]);var $u=class extends Et{constructor(e,n,i){super();this._length=1;this.line=new Qu(sT,cS({color:e,transparent:n<1,opacity:n,linewidth:i})),this.line.computeLineDistances(),je(this,this.line)}get length(){return this._length}set length(e){this._length=e,this.line.scale.set(1,1,e)}};var lo=(p=>(p[p.LocalUser=0]="LocalUser",p[p.Mouse=1]="Mouse",p[p.Pen=2]="Pen",p[p.Touch=3]="Touch",p[p.Gamepad=4]="Gamepad",p[p.MotionController=5]="MotionController",p[p.MotionControllerLeft=6]="MotionControllerLeft",p[p.MotionControllerRight=7]="MotionControllerRight",p[p.Nose=8]="Nose",p[p.RemoteUser=9]="RemoteUser",p))(lo||{});var _m=class extends Vl{constructor(e){super();this.element=e;this._hidden=!1;this.visible=!0,this.style="default",document.addEventListener("pointerlockchange",()=>{this._hidden=!!document.pointerLockElement,this.refresh()})}get style(){return super.style}set style(e){super.style=e,this.refresh()}get visible(){return super.visible&&!this._hidden}set visible(e){super.visible=e,this.refresh()}refresh(){this.element.style.cursor=this.visible?this.style:"none"}};var Ol=class extends Fs{constructor(e){super(e);this.xr=e.cursor3D&&e.cursor3D.clone()||new da(this.env),this.system=new _m(this.env.renderer.domElement),this.xr.side=this.side,this.visible=!1,Object.seal(this)}get object(){return this.xr.object}get side(){return this.xr.side}set side(e){this.xr.side=e}get cursor(){return this.xr}set cursor(e){this.xr=e,this._refresh()}get style(){return this.system.style}get visible(){return super.visible}set visible(e){super.visible=e,this._refresh()}set style(e){this.system.style=e,this.xr.style=e,this._refresh()}_refresh(){let e=this.env.eventSys&&this.env.eventSys.mouse&&this.env.eventSys.mouse.isPointerLocked,n=this.env.renderer.xr.isPresenting||e;wn(this.xr,this.visible&&n),this.system.visible=this.visible&&!n}lookAt(e,n){this.xr.lookAt(e,n)}};var Mm=class extends Ae{constructor(e,n){super(e);this.pointer=n;this._hit=null;this._point=null;this._distance=Number.POSITIVE_INFINITY;this._rayTarget=null;Object.seal(this)}set(e,n){e!==this.hit&&(this._hit=e,e?(this._point=e.point,this._distance=e.distance):(this._point=null,this._distance=Number.POSITIVE_INFINITY)),this._rayTarget=n}get hit(){return this._hit}get rayTarget(){return this._rayTarget}get point(){return this._point}get distance(){return this._distance}};var zce=5,jce=new Ie,Bo=class extends qe{constructor(e,n,i,o){super();this.type=e;this.id=n;this.env=i;this.origin=new Ie;this.direction=new Ie;this.up=new Ie(0,1,0);this.canMoveView=!1;this.mayTeleport=!1;this.buttons=0;this._isActive=!1;this.moveDistance=0;this.pointerEvents=new Map;this.lastButtons=0;this.canClick=!1;this.dragDistance=0;this._enabled=!1;this._cursor=null;this._curHit=null;this._curTarget=null;this._hoveredHit=null;this._hoveredTarget=null;this._cursor=o,this.cursor&&(this.cursor.visible=!1)}get isActive(){return this._isActive}get canSend(){return this.enabled&&this.isActive}get curHit(){return this._curHit}get curTarget(){return this._curTarget}get hoveredHit(){return this._hoveredHit}set hoveredHit(e){if(e!==this.hoveredHit){let n=ts(e);this._hoveredHit=e,this._hoveredTarget=n}}get name(){return lo[this.id]}get rayTarget(){return this._hoveredTarget}get cursor(){return this._cursor}set cursor(e){if(e!==this.cursor){let n=this.cursor,i=this.cursor&&this.cursor.object&&this.cursor.object.name||"cursor",o=n&&n.object&&n.object.parent;o&&n.object.removeFromParent(),e&&(e.object.name=i,n instanceof Ol?(n.cursor=e,o&&je(o,n)):(this._cursor=e,n&&(o&&je(o,e),e.style=n.style,e.visible=n.visible)))}}get needsUpdate(){return this.enabled&&this._isActive}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.cursor&&(this.cursor.visible=e)}setButton(e,n){this.lastButtons=this.buttons;let i=1<<e;if(n?this.buttons|=i:this.buttons&=~i,n)this.canClick=!0,this.dragDistance=0,this.env.avatar.setMode(this),this.setEventState("down");else{if(this.canClick){let o=this.buttons;this.buttons=this.lastButtons,this.setEventState("click"),this.buttons=o}this.setEventState("up")}}isPressed(e){let n=1<<e;return(this.buttons&n)!==0}wasPressed(e){let n=1<<e;return(this.lastButtons&n)!==0}fireRay(e,n){let i=this.env.eventSys.fireRay(e,n);if(i!==this.curHit){let o=ts(i);this._curHit=i,this._curTarget=o}}getEvent(e){this.pointerEvents.has(e)||this.pointerEvents.set(e,new Mm(e,this));let n=this.pointerEvents.get(e);if(this.hoveredHit?n.set(this.hoveredHit,this.rayTarget):this.curHit?n.set(this.curHit,this.curTarget):n.set(null,null),n.hit){let i=this.curHit||this.hoveredHit;i&&n.hit!==i&&(n.hit.uv=i.uv)}return n}update(){this.needsUpdate&&this.onUpdate()}onUpdate(){this.updatePointerOrientation();let e=this.isPressed(0);(this.moveDistance>0||e)&&(e&&(this.dragDistance+=this.moveDistance,this.dragDistance>zce&&(this.canClick=!1)),this.setEventState("move")),this.moveDistance=0}setEventState(e){if(this.fireRay(this.origin,this.direction),this.curTarget===this.rayTarget)this.hoveredHit=this.curHit;else{let i=this.isPressed(0),o=this.wasPressed(0);if(e==="move"&&!i||e==="down"&&i&&!o||e==="up"&&!i&&o){if(this.rayTarget){let u=this.getEvent("up");this.rayTarget.dispatchEvent(u);let p=this.getEvent("exit");this.dispatchEvent(p),this.rayTarget.dispatchEvent(p)}if(this.hoveredHit=this.curHit,this.rayTarget){let u=this.getEvent("enter");this.dispatchEvent(u),this.rayTarget.dispatchEvent(u)}}this.hoveredHit&&this.hoveredHit.point.copy(this.direction).multiplyScalar(this.hoveredHit.distance).add(this.origin)}let n=this.getEvent(e);this.dispatchEvent(n),n.rayTarget&&(e!=="click"||n.rayTarget.clickable||n.rayTarget.navigable)&&(e==="click"&&n.rayTarget.clickable&&this.vibrate(),n.rayTarget.enabled&&n.rayTarget.dispatchEvent(n)),this.updateCursor(this.env.avatar.worldPos,jce,!0,2)}get canDragView(){return this.canMoveView}get canTeleport(){return this.mayTeleport}updateCursor(e,n,i,o){this.cursor&&this.cursor.update(e,n,this.hoveredHit||this.curHit,this.rayTarget||this.curTarget,o,i,this.canDragView,this.canTeleport,this.origin,this.direction,this.isPressed(0))}get bufferSize(){return 37}writeState(e){e.writeUint8(this.id),e.writeVector48(this.origin),e.writeVector48(this.direction),e.writeVector48(this.up)}};var Gce=.2,CIe=.5*Gce-.025;var eRe={fontFamily:ba(),fontSize:20,fontWeight:"bold",textFillColor:"white",textStrokeColor:"black",textStrokeSize:.01,padding:{top:.025,right:.05,bottom:.025,left:.05},maxHeight:.2};var Jw=["none","right","left"];function Qw(r,t){if(t===Yb)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),r;if(t===lu||t===Id){let e=r.getIndex();if(e===null){let s=[],l=r.getAttribute("position");if(l!==void 0){for(let c=0;c<l.count;c++)s.push(c);r.setIndex(s),e=r.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),r}let n=e.count-2,i=[];if(t===lu)for(let s=1;s<=n;s++)i.push(e.getX(0)),i.push(e.getX(s)),i.push(e.getX(s+1));else for(let s=0;s<n;s++)s%2===0?(i.push(e.getX(s)),i.push(e.getX(s+1)),i.push(e.getX(s+2))):(i.push(e.getX(s+2)),i.push(e.getX(s+1)),i.push(e.getX(s)));i.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let o=r.clone();return o.setIndex(i),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),r}var Ss=class extends Db{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new iv(e)}),this.register(function(e){return new pv(e)}),this.register(function(e){return new dv(e)}),this.register(function(e){return new hv(e)}),this.register(function(e){return new sv(e)}),this.register(function(e){return new av(e)}),this.register(function(e){return new lv(e)}),this.register(function(e){return new cv(e)}),this.register(function(e){return new rv(e)}),this.register(function(e){return new uv(e)}),this.register(function(e){return new ov(e)}),this.register(function(e){return new tv(e)}),this.register(function(e){return new mv(e)}),this.register(function(e){return new fv(e)})}load(t,e,n,i){let o=this,s;this.resourcePath!==""?s=this.resourcePath:this.path!==""?s=this.path:s=Cd.extractUrlBase(t),this.manager.itemStart(t);let l=function(u){i?i(u):console.error(u),o.manager.itemError(t),o.manager.itemEnd(t)},c=new kx(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,function(u){try{o.parse(u,s,function(p){e(p),o.manager.itemEnd(t)},l)}catch(p){l(p)}},n,l)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,n,i){let o,s={},l={},c=new TextDecoder;if(typeof t=="string")o=JSON.parse(t);else if(t instanceof ArrayBuffer)if(c.decode(new Uint8Array(t,0,4))===pT){try{s[It.KHR_BINARY_GLTF]=new gv(t)}catch(f){i&&i(f);return}o=JSON.parse(s[It.KHR_BINARY_GLTF].content)}else o=JSON.parse(c.decode(t));else o=t;if(o.asset===void 0||o.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let u=new Sv(o,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let p=0;p<this.pluginCallbacks.length;p++){let f=this.pluginCallbacks[p](u);l[f.name]=f,s[f.name]=!0}if(o.extensionsUsed)for(let p=0;p<o.extensionsUsed.length;++p){let f=o.extensionsUsed[p],w=o.extensionsRequired||[];switch(f){case It.KHR_MATERIALS_UNLIT:s[f]=new nv;break;case It.KHR_DRACO_MESH_COMPRESSION:s[f]=new xv(o,this.dracoLoader);break;case It.KHR_TEXTURE_TRANSFORM:s[f]=new wv;break;case It.KHR_MESH_QUANTIZATION:s[f]=new vv;break;default:w.indexOf(f)>=0&&l[f]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}u.setExtensions(s),u.setPlugins(l),u.parse(n,i)}parseAsync(t,e){let n=this;return new Promise(function(i,o){n.parse(t,e,i,o)})}};function qce(){let r={};return{get:function(t){return r[t]},add:function(t,e){r[t]=e},remove:function(t){delete r[t]},removeAll:function(){r={}}}}var It={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"},tv=class{constructor(t){this.parser=t,this.name=It.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let t=this.parser,e=this.parser.json.nodes||[];for(let n=0,i=e.length;n<i;n++){let o=e[n];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(t){let e=this.parser,n="light:"+t,i=e.cache.get(n);if(i)return i;let o=e.json,c=((o.extensions&&o.extensions[this.name]||{}).lights||[])[t],u,p=new Vn(16777215);c.color!==void 0&&p.fromArray(c.color);let f=c.range!==void 0?c.range:0;switch(c.type){case"directional":u=new Ed(p),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new Ob(p),u.distance=f;break;case"spot":u=new qb(p),u.distance=f,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,u.angle=c.spot.outerConeAngle,u.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return u.position.set(0,0,0),u.decay=2,bs(u,c),c.intensity!==void 0&&(u.intensity=c.intensity),u.name=e.createUniqueName(c.name||"light_"+t),i=Promise.resolve(u),e.cache.add(n,i),i}getDependency(t,e){if(t==="light")return this._loadLight(e)}createNodeAttachment(t){let e=this,n=this.parser,o=n.json.nodes[t],l=(o.extensions&&o.extensions[this.name]||{}).light;return l===void 0?null:this._loadLight(l).then(function(c){return n._getNodeRef(e.cache,l,c)})}},nv=class{constructor(){this.name=It.KHR_MATERIALS_UNLIT}getMaterialType(){return ir}extendParams(t,e,n){let i=[];t.color=new Vn(1,1,1),t.opacity=1;let o=e.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){let s=o.baseColorFactor;t.color.fromArray(s),t.opacity=s[3]}o.baseColorTexture!==void 0&&i.push(n.assignTexture(t,"map",o.baseColorTexture,$a))}return Promise.all(i)}},rv=class{constructor(t){this.parser=t,this.name=It.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){let i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=i.extensions[this.name].emissiveStrength;return o!==void 0&&(e.emissiveIntensity=o),Promise.resolve()}},iv=class{constructor(t){this.parser=t,this.name=It.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:es}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];if(s.clearcoatFactor!==void 0&&(e.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&o.push(n.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&o.push(n.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(o.push(n.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){let l=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Sn(l,l)}return Promise.all(o)}},ov=class{constructor(t){this.parser=t,this.name=It.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:es}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];return s.iridescenceFactor!==void 0&&(e.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&o.push(n.assignTexture(e,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(e.iridescenceIOR=s.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&o.push(n.assignTexture(e,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(o)}},sv=class{constructor(t){this.parser=t,this.name=It.KHR_MATERIALS_SHEEN}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:es}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[];e.sheenColor=new Vn(0,0,0),e.sheenRoughness=0,e.sheen=1;let s=i.extensions[this.name];return s.sheenColorFactor!==void 0&&e.sheenColor.fromArray(s.sheenColorFactor),s.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&o.push(n.assignTexture(e,"sheenColorMap",s.sheenColorTexture,$a)),s.sheenRoughnessTexture!==void 0&&o.push(n.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(o)}},av=class{constructor(t){this.parser=t,this.name=It.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:es}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];return s.transmissionFactor!==void 0&&(e.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&o.push(n.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(o)}},lv=class{constructor(t){this.parser=t,this.name=It.KHR_MATERIALS_VOLUME}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:es}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];e.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&o.push(n.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||1/0;let l=s.attenuationColor||[1,1,1];return e.attenuationColor=new Vn(l[0],l[1],l[2]),Promise.all(o)}},cv=class{constructor(t){this.parser=t,this.name=It.KHR_MATERIALS_IOR}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:es}extendMaterialParams(t,e){let i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=i.extensions[this.name];return e.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}},uv=class{constructor(t){this.parser=t,this.name=It.KHR_MATERIALS_SPECULAR}getMaterialType(t){let n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:es}extendMaterialParams(t,e){let n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let o=[],s=i.extensions[this.name];e.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&o.push(n.assignTexture(e,"specularIntensityMap",s.specularTexture));let l=s.specularColorFactor||[1,1,1];return e.specularColor=new Vn(l[0],l[1],l[2]),s.specularColorTexture!==void 0&&o.push(n.assignTexture(e,"specularColorMap",s.specularColorTexture,$a)),Promise.all(o)}},pv=class{constructor(t){this.parser=t,this.name=It.KHR_TEXTURE_BASISU}loadTexture(t){let e=this.parser,n=e.json,i=n.textures[t];if(!i.extensions||!i.extensions[this.name])return null;let o=i.extensions[this.name],s=e.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,o.source,s)}},dv=class{constructor(t){this.parser=t,this.name=It.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){let e=this.name,n=this.parser,i=n.json,o=i.textures[t];if(!o.extensions||!o.extensions[e])return null;let s=o.extensions[e],l=i.images[s.source],c=n.textureLoader;if(l.uri){let u=n.options.manager.getHandler(l.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(t,s.source,c);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){let e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}},hv=class{constructor(t){this.parser=t,this.name=It.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){let e=this.name,n=this.parser,i=n.json,o=i.textures[t];if(!o.extensions||!o.extensions[e])return null;let s=o.extensions[e],l=i.images[s.source],c=n.textureLoader;if(l.uri){let u=n.options.manager.getHandler(l.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(t,s.source,c);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){let e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}},mv=class{constructor(t){this.name=It.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){let e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){let i=n.extensions[this.name],o=this.parser.getDependency("buffer",i.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(l){let c=i.byteOffset||0,u=i.byteLength||0,p=i.count,f=i.byteStride,w=new Uint8Array(l,c,u);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(p,f,w,i.mode,i.filter).then(function(A){return A.buffer}):s.ready.then(function(){let A=new ArrayBuffer(p*f);return s.decodeGltfBuffer(new Uint8Array(A),p,f,w,i.mode,i.filter),A})})}else return null}},fv=class{constructor(t){this.name=It.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){let e=this.parser.json,n=e.nodes[t];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;let i=e.meshes[n.mesh];for(let u of i.primitives)if(u.mode!==mi.TRIANGLES&&u.mode!==mi.TRIANGLE_STRIP&&u.mode!==mi.TRIANGLE_FAN&&u.mode!==void 0)return null;let s=n.extensions[this.name].attributes,l=[],c={};for(let u in s)l.push(this.parser.getDependency("accessor",s[u]).then(p=>(c[u]=p,c[u])));return l.length<1?null:(l.push(this.parser.createNodeMesh(t)),Promise.all(l).then(u=>{let p=u.pop(),f=p.isGroup?p.children:[p],w=u[0].count,A=[];for(let m of f){let d=new Vt,h=new Ie,M=new xt,k=new Ie(1,1,1),E=new kd(m.geometry,m.material,w);for(let b=0;b<w;b++)c.TRANSLATION&&h.fromBufferAttribute(c.TRANSLATION,b),c.ROTATION&&M.fromBufferAttribute(c.ROTATION,b),c.SCALE&&k.fromBufferAttribute(c.SCALE,b),E.setMatrixAt(b,d.compose(h,M,k));for(let b in c)b!=="TRANSLATION"&&b!=="ROTATION"&&b!=="SCALE"&&m.geometry.setAttribute(b,c[b]);Et.prototype.copy.call(E,m),this.parser.assignFinalMaterial(E),A.push(E)}return p.isGroup?(p.clear(),p.add(...A),p):A[0]}))}},pT="glTF",Zu=12,aT={JSON:1313821514,BIN:5130562},gv=class{constructor(t){this.name=It.KHR_BINARY_GLTF,this.content=null,this.body=null;let e=new DataView(t,0,Zu),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==pT)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let i=this.header.length-Zu,o=new DataView(t,Zu),s=0;for(;s<i;){let l=o.getUint32(s,!0);s+=4;let c=o.getUint32(s,!0);if(s+=4,c===aT.JSON){let u=new Uint8Array(t,Zu+s,l);this.content=n.decode(u)}else if(c===aT.BIN){let u=Zu+s;this.body=t.slice(u,u+l)}s+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},xv=class{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=It.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){let n=this.json,i=this.dracoLoader,o=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,l={},c={},u={};for(let p in s){let f=Av[p]||p.toLowerCase();l[f]=s[p]}for(let p in t.attributes){let f=Av[p]||p.toLowerCase();if(s[p]!==void 0){let w=n.accessors[t.attributes[p]],A=Nl[w.componentType];u[f]=A.name,c[f]=w.normalized===!0}}return e.getDependency("bufferView",o).then(function(p){return new Promise(function(f){i.decodeDracoFile(p,function(w){for(let A in w.attributes){let m=w.attributes[A],d=c[A];d!==void 0&&(m.normalized=d)}f(w)},l,u)})})}},wv=class{constructor(){this.name=It.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return(e.texCoord===void 0||e.texCoord===t.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.texCoord!==void 0&&(t.channel=e.texCoord),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}},vv=class{constructor(){this.name=It.KHR_MESH_QUANTIZATION}},km=class extends Sb{constructor(t,e,n,i){super(t,e,n,i)}copySampleValue_(t){let e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=t*i*3+i;for(let s=0;s!==i;s++)e[s]=n[o+s];return e}interpolate_(t,e,n,i){let o=this.resultBuffer,s=this.sampleValues,l=this.valueSize,c=l*2,u=l*3,p=i-e,f=(n-e)/p,w=f*f,A=w*f,m=t*u,d=m-u,h=-2*A+3*w,M=A-w,k=1-h,E=M-w+f;for(let b=0;b!==l;b++){let g=s[d+b+l],v=s[d+b+c]*p,y=s[m+b+l],V=s[m+b]*p;o[b]=k*g+E*v+h*y+M*V}return o}},Kce=new xt,Fv=class extends km{interpolate_(t,e,n,i){let o=super.interpolate_(t,e,n,i);return Kce.fromArray(o).normalize().toArray(o),o}},mi={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Nl={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},lT={9728:Lb,9729:Lx,9984:Rb,9985:Cb,9986:Ib,9987:Ix},cT={33071:hb,33648:Pb,10497:Ld},$w={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Av={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},As={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Yce={CUBICSPLINE:void 0,LINEAR:Dx,STEP:yb},Zw={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Jce(r){return r.DefaultMaterial===void 0&&(r.DefaultMaterial=new Rx({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Us})),r.DefaultMaterial}function fa(r,t,e){for(let n in e.extensions)r[n]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=e.extensions[n])}function bs(r,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(r.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Qce(r,t,e){let n=!1,i=!1,o=!1;for(let u=0,p=t.length;u<p;u++){let f=t[u];if(f.POSITION!==void 0&&(n=!0),f.NORMAL!==void 0&&(i=!0),f.COLOR_0!==void 0&&(o=!0),n&&i&&o)break}if(!n&&!i&&!o)return Promise.resolve(r);let s=[],l=[],c=[];for(let u=0,p=t.length;u<p;u++){let f=t[u];if(n){let w=f.POSITION!==void 0?e.getDependency("accessor",f.POSITION):r.attributes.position;s.push(w)}if(i){let w=f.NORMAL!==void 0?e.getDependency("accessor",f.NORMAL):r.attributes.normal;l.push(w)}if(o){let w=f.COLOR_0!==void 0?e.getDependency("accessor",f.COLOR_0):r.attributes.color;c.push(w)}}return Promise.all([Promise.all(s),Promise.all(l),Promise.all(c)]).then(function(u){let p=u[0],f=u[1],w=u[2];return n&&(r.morphAttributes.position=p),i&&(r.morphAttributes.normal=f),o&&(r.morphAttributes.color=w),r.morphTargetsRelative=!0,r})}function $ce(r,t){if(r.updateMorphTargets(),t.weights!==void 0)for(let e=0,n=t.weights.length;e<n;e++)r.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){let e=t.extras.targetNames;if(r.morphTargetInfluences.length===e.length){r.morphTargetDictionary={};for(let n=0,i=e.length;n<i;n++)r.morphTargetDictionary[e[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Zce(r){let t,e=r.extensions&&r.extensions[It.KHR_DRACO_MESH_COMPRESSION];if(e?t="draco:"+e.bufferView+":"+e.indices+":"+ev(e.attributes):t=r.indices+":"+ev(r.attributes)+":"+r.mode,r.targets!==void 0)for(let n=0,i=r.targets.length;n<i;n++)t+=":"+ev(r.targets[n]);return t}function ev(r){let t="",e=Object.keys(r).sort();for(let n=0,i=e.length;n<i;n++)t+=e[n]+":"+r[e[n]]+";";return t}function bv(r){switch(r){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function eue(r){return r.search(/\.jpe?g($|\?)/i)>0||r.search(/^data\:image\/jpeg/)===0?"image/jpeg":r.search(/\.webp($|\?)/i)>0||r.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}var tue=new Vt,Sv=class{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new qce,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,o=-1;typeof navigator<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,o=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||i&&o<98?this.textureLoader=new Kb(this.options.manager):this.textureLoader=new Ab(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new kx(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){let n=this,i=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(s){let l={scene:s[0][i.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:i.asset,parser:n,userData:{}};fa(o,l,i),bs(l,i),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(l)})).then(function(){t(l)})}).catch(e)}_markDefs(){let t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[];for(let i=0,o=e.length;i<o;i++){let s=e[i].joints;for(let l=0,c=s.length;l<c;l++)t[s[l]].isBone=!0}for(let i=0,o=t.length;i<o;i++){let s=t[i];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(n[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,n){if(t.refs[e]<=1)return n;let i=n.clone(),o=(s,l)=>{let c=this.associations.get(s);c!=null&&this.associations.set(l,c);for(let[u,p]of s.children.entries())o(p,l.children[u])};return o(n,i),i.name+="_instance_"+t.uses[e]++,i}_invokeOne(t){let e=Object.values(this.plugins);e.push(this);for(let n=0;n<e.length;n++){let i=t(e[n]);if(i)return i}return null}_invokeAll(t){let e=Object.values(this.plugins);e.unshift(this);let n=[];for(let i=0;i<e.length;i++){let o=t(e[i]);o&&n.push(o)}return n}getDependency(t,e){let n=t+":"+e,i=this.cache.get(n);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this._invokeOne(function(o){return o.loadNode&&o.loadNode(e)});break;case"mesh":i=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(e)});break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(e)});break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(e)});break;case"texture":i=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(e)});break;case"skin":i=this.loadSkin(e);break;case"animation":i=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(e)});break;case"camera":i=this.loadCamera(e);break;default:if(i=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(t,e)}),!i)throw new Error("Unknown type: "+t);break}this.cache.add(n,i)}return i}getDependencies(t){let e=this.cache.get(t);if(!e){let n=this,i=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(i.map(function(o,s){return n.getDependency(t,s)})),this.cache.add(t,e)}return e}loadBuffer(t){let e=this.json.buffers[t],n=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[It.KHR_BINARY_GLTF].body);let i=this.options;return new Promise(function(o,s){n.load(Cd.resolveURL(e.uri,i.path),o,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){let e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(n){let i=e.byteLength||0,o=e.byteOffset||0;return n.slice(o,o+i)})}loadAccessor(t){let e=this,n=this.json,i=this.json.accessors[t];if(i.bufferView===void 0&&i.sparse===void 0){let s=$w[i.type],l=Nl[i.componentType],c=i.normalized===!0,u=new l(i.count*s);return Promise.resolve(new Eo(u,s,c))}let o=[];return i.bufferView!==void 0?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),i.sparse!==void 0&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then(function(s){let l=s[0],c=$w[i.type],u=Nl[i.componentType],p=u.BYTES_PER_ELEMENT,f=p*c,w=i.byteOffset||0,A=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,m=i.normalized===!0,d,h;if(A&&A!==f){let M=Math.floor(w/A),k="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+M+":"+i.count,E=e.cache.get(k);E||(d=new u(l,M*A,i.count*A/p),E=new Cx(d,A/p),e.cache.add(k,E)),h=new Ci(E,c,w%A/p,m)}else l===null?d=new u(i.count*c):d=new u(l,w,i.count*c),h=new Eo(d,c,m);if(i.sparse!==void 0){let M=$w.SCALAR,k=Nl[i.sparse.indices.componentType],E=i.sparse.indices.byteOffset||0,b=i.sparse.values.byteOffset||0,g=new k(s[1],E,i.sparse.count*M),v=new u(s[2],b,i.sparse.count*c);l!==null&&(h=new Eo(h.array.slice(),h.itemSize,h.normalized));for(let y=0,V=g.length;y<V;y++){let B=g[y];if(h.setX(B,v[y*c]),c>=2&&h.setY(B,v[y*c+1]),c>=3&&h.setZ(B,v[y*c+2]),c>=4&&h.setW(B,v[y*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return h})}loadTexture(t){let e=this.json,n=this.options,o=e.textures[t].source,s=e.images[o],l=this.textureLoader;if(s.uri){let c=n.manager.getHandler(s.uri);c!==null&&(l=c)}return this.loadTextureImage(t,o,l)}loadTextureImage(t,e,n){let i=this,o=this.json,s=o.textures[t],l=o.images[e],c=(l.uri||l.bufferView)+":"+s.sampler;if(this.textureCache[c])return this.textureCache[c];let u=this.loadImageSource(e,n).then(function(p){p.flipY=!1,p.name=s.name||l.name||"",p.name===""&&typeof l.uri=="string"&&l.uri.startsWith("data:image/")===!1&&(p.name=l.uri);let w=(o.samplers||{})[s.sampler]||{};return p.magFilter=lT[w.magFilter]||Lx,p.minFilter=lT[w.minFilter]||Ix,p.wrapS=cT[w.wrapS]||Ld,p.wrapT=cT[w.wrapT]||Ld,i.associations.set(p,{textures:t}),p}).catch(function(){return null});return this.textureCache[c]=u,u}loadImageSource(t,e){let n=this,i=this.json,o=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(f=>f.clone());let s=i.images[t],l=self.URL||self.webkitURL,c=s.uri||"",u=!1;if(s.bufferView!==void 0)c=n.getDependency("bufferView",s.bufferView).then(function(f){u=!0;let w=new Blob([f],{type:s.mimeType});return c=l.createObjectURL(w),c});else if(s.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");let p=Promise.resolve(c).then(function(f){return new Promise(function(w,A){let m=w;e.isImageBitmapLoader===!0&&(m=function(d){let h=new Gs(d);h.needsUpdate=!0,w(h)}),e.load(Cd.resolveURL(f,o.path),m,void 0,A)})}).then(function(f){return u===!0&&l.revokeObjectURL(c),f.userData.mimeType=s.mimeType||eue(s.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),f});return this.sourceCache[t]=p,p}assignTexture(t,e,n,i){let o=this;return this.getDependency("texture",n.index).then(function(s){if(!s)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(s=s.clone(),s.channel=n.texCoord),o.extensions[It.KHR_TEXTURE_TRANSFORM]){let l=n.extensions!==void 0?n.extensions[It.KHR_TEXTURE_TRANSFORM]:void 0;if(l){let c=o.associations.get(s);s=o.extensions[It.KHR_TEXTURE_TRANSFORM].extendTexture(s,l),o.associations.set(s,c)}}return i!==void 0&&(s.colorSpace=i),t[e]=s,s})}assignFinalMaterial(t){let e=t.geometry,n=t.material,i=e.attributes.tangent===void 0,o=e.attributes.color!==void 0,s=e.attributes.normal===void 0;if(t.isPoints){let l="PointsMaterial:"+n.uuid,c=this.cache.get(l);c||(c=new Hb,Dd.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(l,c)),n=c}else if(t.isLine){let l="LineBasicMaterial:"+n.uuid,c=this.cache.get(l);c||(c=new Px,Dd.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,this.cache.add(l,c)),n=c}if(i||o||s){let l="ClonedMaterial:"+n.uuid+":";i&&(l+="derivative-tangents:"),o&&(l+="vertex-colors:"),s&&(l+="flat-shading:");let c=this.cache.get(l);c||(c=n.clone(),o&&(c.vertexColors=!0),s&&(c.flatShading=!0),i&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(l,c),this.associations.set(c,this.associations.get(n))),n=c}t.material=n}getMaterialType(){return Rx}loadMaterial(t){let e=this,n=this.json,i=this.extensions,o=n.materials[t],s,l={},c=o.extensions||{},u=[];if(c[It.KHR_MATERIALS_UNLIT]){let f=i[It.KHR_MATERIALS_UNLIT];s=f.getMaterialType(),u.push(f.extendParams(l,o,e))}else{let f=o.pbrMetallicRoughness||{};if(l.color=new Vn(1,1,1),l.opacity=1,Array.isArray(f.baseColorFactor)){let w=f.baseColorFactor;l.color.fromArray(w),l.opacity=w[3]}f.baseColorTexture!==void 0&&u.push(e.assignTexture(l,"map",f.baseColorTexture,$a)),l.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,l.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(u.push(e.assignTexture(l,"metalnessMap",f.metallicRoughnessTexture)),u.push(e.assignTexture(l,"roughnessMap",f.metallicRoughnessTexture))),s=this._invokeOne(function(w){return w.getMaterialType&&w.getMaterialType(t)}),u.push(Promise.all(this._invokeAll(function(w){return w.extendMaterialParams&&w.extendMaterialParams(t,l)})))}o.doubleSided===!0&&(l.side=_d);let p=o.alphaMode||Zw.OPAQUE;if(p===Zw.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,p===Zw.MASK&&(l.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&s!==ir&&(u.push(e.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new Sn(1,1),o.normalTexture.scale!==void 0)){let f=o.normalTexture.scale;l.normalScale.set(f,f)}return o.occlusionTexture!==void 0&&s!==ir&&(u.push(e.assignTexture(l,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&s!==ir&&(l.emissive=new Vn().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&s!==ir&&u.push(e.assignTexture(l,"emissiveMap",o.emissiveTexture,$a)),Promise.all(u).then(function(){let f=new s(l);return o.name&&(f.name=o.name),bs(f,o),e.associations.set(f,{materials:t}),o.extensions&&fa(i,f,o),f})}createUniqueName(t){let e=Wb.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){let e=this,n=this.extensions,i=this.primitiveCache;function o(l){return n[It.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,e).then(function(c){return uT(c,l,e)})}let s=[];for(let l=0,c=t.length;l<c;l++){let u=t[l],p=Zce(u),f=i[p];if(f)s.push(f.promise);else{let w;u.extensions&&u.extensions[It.KHR_DRACO_MESH_COMPRESSION]?w=o(u):w=uT(new ou,u,e),i[p]={primitive:u,promise:w},s.push(w)}}return Promise.all(s)}loadMesh(t){let e=this,n=this.json,i=this.extensions,o=n.meshes[t],s=o.primitives,l=[];for(let c=0,u=s.length;c<u;c++){let p=s[c].material===void 0?Jce(this.cache):this.getDependency("material",s[c].material);l.push(p)}return l.push(e.loadGeometries(s)),Promise.all(l).then(function(c){let u=c.slice(0,c.length-1),p=c[c.length-1],f=[];for(let A=0,m=p.length;A<m;A++){let d=p[A],h=s[A],M,k=u[A];if(h.mode===mi.TRIANGLES||h.mode===mi.TRIANGLE_STRIP||h.mode===mi.TRIANGLE_FAN||h.mode===void 0)M=o.isSkinnedMesh===!0?new Xb(d,k):new kr(d,k),M.isSkinnedMesh===!0&&M.normalizeSkinWeights(),h.mode===mi.TRIANGLE_STRIP?M.geometry=Qw(M.geometry,Id):h.mode===mi.TRIANGLE_FAN&&(M.geometry=Qw(M.geometry,lu));else if(h.mode===mi.LINES)M=new Mb(d,k);else if(h.mode===mi.LINE_STRIP)M=new Tb(d,k);else if(h.mode===mi.LINE_LOOP)M=new _b(d,k);else if(h.mode===mi.POINTS)M=new Nb(d,k);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);Object.keys(M.geometry.morphAttributes).length>0&&$ce(M,o),M.name=e.createUniqueName(o.name||"mesh_"+t),bs(M,o),h.extensions&&fa(i,M,h),e.assignFinalMaterial(M),f.push(M)}for(let A=0,m=f.length;A<m;A++)e.associations.set(f[A],{meshes:t,primitives:A});if(f.length===1)return o.extensions&&fa(i,f[0],o),f[0];let w=new Ja;o.extensions&&fa(i,w,o),e.associations.set(w,{meshes:t});for(let A=0,m=f.length;A<m;A++)w.add(f[A]);return w})}loadCamera(t){let e,n=this.json.cameras[t],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?e=new js(Pd.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(e=new Vb(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),bs(e,n),Promise.resolve(e)}loadSkin(t){let e=this.json.skins[t],n=[];for(let i=0,o=e.joints.length;i<o;i++)n.push(this._loadNodeShallow(e.joints[i]));return e.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",e.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(i){let o=i.pop(),s=i,l=[],c=[];for(let u=0,p=s.length;u<p;u++){let f=s[u];if(f){l.push(f);let w=new Vt;o!==null&&w.fromArray(o.array,u*16),c.push(w)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[u])}return new Gb(l,c)})}loadAnimation(t){let n=this.json.animations[t],i=n.name?n.name:"animation_"+t,o=[],s=[],l=[],c=[],u=[];for(let p=0,f=n.channels.length;p<f;p++){let w=n.channels[p],A=n.samplers[w.sampler],m=w.target,d=m.node,h=n.parameters!==void 0?n.parameters[A.input]:A.input,M=n.parameters!==void 0?n.parameters[A.output]:A.output;m.node!==void 0&&(o.push(this.getDependency("node",d)),s.push(this.getDependency("accessor",h)),l.push(this.getDependency("accessor",M)),c.push(A),u.push(m))}return Promise.all([Promise.all(o),Promise.all(s),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(p){let f=p[0],w=p[1],A=p[2],m=p[3],d=p[4],h=[];for(let M=0,k=f.length;M<k;M++){let E=f[M],b=w[M],g=A[M],v=m[M],y=d[M];if(E===void 0)continue;E.updateMatrix();let V;switch(As[y.path]){case As.weights:V=Bb;break;case As.rotation:V=Bx;break;case As.position:case As.scale:default:V=Jb;break}let B=E.name?E.name:E.uuid,D=v.interpolation!==void 0?Yce[v.interpolation]:Dx,L=[];As[y.path]===As.weights?E.traverse(function(ae){ae.morphTargetInfluences&&L.push(ae.name?ae.name:ae.uuid)}):L.push(B);let J=g.array;if(g.normalized){let ae=bv(J.constructor),Q=new Float32Array(J.length);for(let ee=0,K=J.length;ee<K;ee++)Q[ee]=J[ee]*ae;J=Q}for(let ae=0,Q=L.length;ae<Q;ae++){let ee=new V(L[ae]+"."+As[y.path],b.array,J,D);v.interpolation==="CUBICSPLINE"&&(ee.createInterpolant=function($){let te=this instanceof Bx?Fv:km;return new te(this.times,this.values,this.getValueSize()/3,$)},ee.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),h.push(ee)}}return new cb(i,void 0,h)})}createNodeMesh(t){let e=this.json,n=this,i=e.nodes[t];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(o){let s=n._getNodeRef(n.meshCache,i.mesh,o);return i.weights!==void 0&&s.traverse(function(l){if(l.isMesh)for(let c=0,u=i.weights.length;c<u;c++)l.morphTargetInfluences[c]=i.weights[c]}),s})}loadNode(t){let e=this.json,n=this,i=e.nodes[t],o=n._loadNodeShallow(t),s=[],l=i.children||[];for(let u=0,p=l.length;u<p;u++)s.push(n.getDependency("node",l[u]));let c=i.skin===void 0?Promise.resolve(null):n.getDependency("skin",i.skin);return Promise.all([o,Promise.all(s),c]).then(function(u){let p=u[0],f=u[1],w=u[2];w!==null&&p.traverse(function(A){A.isSkinnedMesh&&A.bind(w,tue)});for(let A=0,m=f.length;A<m;A++)p.add(f[A]);return p})}_loadNodeShallow(t){let e=this.json,n=this.extensions,i=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];let o=e.nodes[t],s=o.name?i.createUniqueName(o.name):"",l=[],c=i._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(t)});return c&&l.push(c),o.camera!==void 0&&l.push(i.getDependency("camera",o.camera).then(function(u){return i._getNodeRef(i.cameraCache,o.camera,u)})),i._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(t)}).forEach(function(u){l.push(u)}),this.nodeCache[t]=Promise.all(l).then(function(u){let p;if(o.isBone===!0?p=new pb:u.length>1?p=new Ja:u.length===1?p=u[0]:p=new Et,p!==u[0])for(let f=0,w=u.length;f<w;f++)p.add(u[f]);if(o.name&&(p.userData.name=o.name,p.name=s),bs(p,o),o.extensions&&fa(n,p,o),o.matrix!==void 0){let f=new Vt;f.fromArray(o.matrix),p.applyMatrix4(f)}else o.translation!==void 0&&p.position.fromArray(o.translation),o.rotation!==void 0&&p.quaternion.fromArray(o.rotation),o.scale!==void 0&&p.scale.fromArray(o.scale);return i.associations.has(p)||i.associations.set(p,{}),i.associations.get(p).nodes=t,p}),this.nodeCache[t]}loadScene(t){let e=this.extensions,n=this.json.scenes[t],i=this,o=new Ja;n.name&&(o.name=i.createUniqueName(n.name)),bs(o,n),n.extensions&&fa(e,o,n);let s=n.nodes||[],l=[];for(let c=0,u=s.length;c<u;c++)l.push(i.getDependency("node",s[c]));return Promise.all(l).then(function(c){for(let p=0,f=c.length;p<f;p++)o.add(c[p]);let u=p=>{let f=new Map;for(let[w,A]of i.associations)(w instanceof Dd||w instanceof Gs)&&f.set(w,A);return p.traverse(w=>{let A=i.associations.get(w);A!=null&&f.set(w,A)}),f};return i.associations=u(o),o})}};function nue(r,t,e){let n=t.attributes,i=new Ws;if(n.POSITION!==void 0){let l=e.json.accessors[n.POSITION],c=l.min,u=l.max;if(c!==void 0&&u!==void 0){if(i.set(new Ie(c[0],c[1],c[2]),new Ie(u[0],u[1],u[2])),l.normalized){let p=bv(Nl[l.componentType]);i.min.multiplyScalar(p),i.max.multiplyScalar(p)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let o=t.targets;if(o!==void 0){let l=new Ie,c=new Ie;for(let u=0,p=o.length;u<p;u++){let f=o[u];if(f.POSITION!==void 0){let w=e.json.accessors[f.POSITION],A=w.min,m=w.max;if(A!==void 0&&m!==void 0){if(c.setX(Math.max(Math.abs(A[0]),Math.abs(m[0]))),c.setY(Math.max(Math.abs(A[1]),Math.abs(m[1]))),c.setZ(Math.max(Math.abs(A[2]),Math.abs(m[2]))),w.normalized){let d=bv(Nl[w.componentType]);c.multiplyScalar(d)}l.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(l)}r.boundingBox=i;let s=new el;i.getCenter(s.center),s.radius=i.min.distanceTo(i.max)/2,r.boundingSphere=s}function uT(r,t,e){let n=t.attributes,i=[];function o(s,l){return e.getDependency("accessor",s).then(function(c){r.setAttribute(l,c)})}for(let s in n){let l=Av[s]||s.toLowerCase();l in r.attributes||i.push(o(n[s],l))}if(t.indices!==void 0&&!r.index){let s=e.getDependency("accessor",t.indices).then(function(l){r.setIndex(l)});i.push(s)}return bs(r,t),nue(r,t,e),Promise.all(i).then(function(){return t.targets!==void 0?Qce(r,t.targets,e):r})}var Pn={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function dT(r){let t=await fetch(r);if(t.ok)return t.json();throw new Error(t.statusText)}async function rue(r){if(!r)throw new Error("No basePath supplied");return await dT(`${r}/profilesList.json`)}async function hT(r,t,e=null,n=!0){if(!r)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");let i=await rue(t),o;if(r.profiles.some(c=>{let u=i[c];return u&&(o={profileId:c,profilePath:`${t}/${u.path}`,deprecated:!!u.deprecated}),!!o}),!o){if(!e)throw new Error("No matching profile name found");let c=i[e];if(!c)throw new Error(`No matching profile name found and default profile "${e}" missing.`);o={profileId:e,profilePath:`${t}/${c.path}`,deprecated:!!c.deprecated}}let s=await dT(o.profilePath),l;if(n){let c;if(r.handedness==="any"?c=s.layouts[Object.keys(s.layouts)[0]]:c=s.layouts[r.handedness],!c)throw new Error(`No matching handedness, ${r.handedness}, in profile ${o.profileId}`);c.assetPath&&(l=o.profilePath.replace("profile.json",c.assetPath))}return{profile:s,assetPath:l}}var iue={xAxis:0,yAxis:0,button:0,state:Pn.ComponentState.DEFAULT};function oue(r=0,t=0){let e=r,n=t;if(Math.sqrt(r*r+t*t)>1){let s=Math.atan2(t,r);e=Math.cos(s),n=Math.sin(s)}return{normalizedXAxis:e*.5+.5,normalizedYAxis:n*.5+.5}}var yv=class{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===Pn.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(iue)}updateFromComponent({xAxis:t,yAxis:e,button:n,state:i}){let{normalizedXAxis:o,normalizedYAxis:s}=oue(t,e);switch(this.componentProperty){case Pn.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?o:.5;break;case Pn.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?s:.5;break;case Pn.ComponentProperty.BUTTON:this.value=this.states.includes(i)?n:0;break;case Pn.ComponentProperty.STATE:this.valueNodeProperty===Pn.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},Tv=class{constructor(t,e){if(!t||!e||!e.visualResponses||!e.gamepadIndices||Object.keys(e.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach(n=>{let i=new yv(e.visualResponses[n]);this.visualResponses[n]=i}),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:Pn.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(t){if(this.values.state=Pn.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&t.buttons.length>this.gamepadIndices.button){let e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||this.values.button===1?this.values.state=Pn.ComponentState.PRESSED:(e.touched||this.values.button>Pn.ButtonTouchThreshold)&&(this.values.state=Pn.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Pn.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Pn.AxisTouchThreshold&&(this.values.state=Pn.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Pn.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Pn.AxisTouchThreshold&&(this.values.state=Pn.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}},Cm=class{constructor(t,e,n){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=n,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(i=>{let o=this.layoutDescription.components[i];this.components[i]=new Tv(i,o)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let t=[];return Object.values(this.components).forEach(e=>{t.push(e.data)}),t}updateFromGamepad(){Object.values(this.components).forEach(t=>{t.updateFromGamepad(this.xrInputSource.gamepad)})}};var sue="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",aue="generic-trigger",Ev=class extends Et{constructor(){super(...arguments);this.envMap=null;this.motionController=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(n=>{or(n)&&(du(n.material)||hu(n.material)||mu(n.material))&&(n.material.envMap=this.envMap,n.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(n=>{Object.values(n.visualResponses).forEach(i=>{let{valueNode:o,minNode:s,maxNode:l}=i;o&&(lue(i)?o.visible=i.value:cue(i)&&(o.quaternion.slerpQuaternions(s.quaternion,l.quaternion,i.value),o.position.lerpVectors(s.position,l.position,i.value)))})}))}};function fT(r,t){return r&&r.valueNodeProperty===t}function lue(r){return fT(r,"visibility")}function cue(r){return fT(r,"transform")}function uue(r,t){Object.values(r.components).forEach(e=>{let{type:n,touchPointNodeName:i,visualResponses:o}=e;if(n===Pn.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(i),e.touchPointNode){let s=new tl(.001),l=new ir({color:255}),c=new kr(s,l);e.touchPointNode.add(c)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(o).forEach(s=>{let{valueNodeName:l,minNodeName:c,maxNodeName:u,valueNodeProperty:p}=s;if(p===Pn.VisualResponseProperty.TRANSFORM){if(s.minNode=t.getObjectByName(c),s.maxNode=t.getObjectByName(u),!s.minNode){console.warn(`Could not find ${c} in the model`);return}if(!s.maxNode){console.warn(`Could not find ${u} in the model`);return}}s.valueNode=t.getObjectByName(l),s.valueNode||console.warn(`Could not find ${l} in the model`)})})}function mT(r,t){uue(r.motionController,t),r.envMap&&t.traverse(e=>{or(e)&&(du(e.material)||hu(e.material)||mu(e.material))&&(e.material.envMap=r.envMap,e.material.needsUpdate=!0)}),r.add(t)}var Dm=class{constructor(t=null){this.gltfLoader=t||new Ss,this.path=sue,this._assetCache={}}createControllerModel(t,e=null){let n=new Ev,i=null;return t.addEventListener("connected",async o=>{let s=o.data;if(!(s.targetRayMode!=="tracked-pointer"||!s.gamepad))try{let{profile:l,assetPath:c}=await hT(s,this.path,e||aue);n.motionController=new Cm(s,l,c);let u=this._assetCache[n.motionController.assetUrl];if(u)i=u.scene.clone(),mT(n,i);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(n.motionController.assetUrl,p=>{this._assetCache[n.motionController.assetUrl]=p,i=p.scene.clone(),mT(n,i)},null,()=>{throw new Error(`Asset ${n.motionController.assetUrl} missing or malformed.`)})}}catch(l){console.warn(l)}}),t.addEventListener("disconnected",()=>{St(n.motionController),n.motionController=null,St(i),i=null}),n}};var pue=new Dm,due=new Vt().makeRotationX(-7*xn/9),gT=new Vt,xT=new Map([["none",5],["left",6],["right",7]]);var wT=new Map([[5,2],[4,3]]),Pm=class extends Bo{constructor(e,n){super("hand",5,e,new da(e));this.laser=new $u(zd,.75,.002);this._isHand=!1;this.inputSource=null;this._gamepad=new Sm;this.delta=new Ie;this.newOrigin=new Ie;this.quaternion=new xt;this.newQuat=new xt;this.useHaptics=!0;if(this.mayTeleport=!0,this.object=Dt("PointerHand"+n),this.quaternion.identity(),je(this,je(this.controller=this.env.renderer.xr.getController(n),this.laser),je(this.grip=this.env.renderer.xr.getControllerGrip(n),this.gripModel=pue.createControllerModel(this.controller)),je(this.hand=this.env.renderer.xr.getHand(n),this.handModel=this.env.handModelFactory.createHandModel(this.hand))),Ga()&&_F()&&!bo){let s=!1;this.controller.traverse(l=>{l.name.toLocaleLowerCase().indexOf("oculus")>=0&&(s=!0)}),s&&this.laser.matrix.copy(due)}this.gamepad.addEventListener("gamepadaxismaxed",s=>{s.axis===2&&this.env.avatar.snapTurn(s.value)});let i=s=>l=>{wT.has(l.button)&&this.setButton(wT.get(l.button),s)};this.gamepad.addEventListener("gamepadbuttondown",i(!0)),this.gamepad.addEventListener("gamepadbuttonup",i(!1));let o=(s,l)=>()=>this.setButton(s,l);this.controller.addEventListener("selectstart",o(0,!0)),this.controller.addEventListener("selectend",o(0,!1)),this.controller.addEventListener("squeezestart",o(1,!0)),this.controller.addEventListener("squeezeend",o(1,!1)),this.controller.addEventListener("connected",s=>{s.target===this.controller&&(this.inputSource=s.data,this.gamepad.pad=this.inputSource.gamepad,this._isHand=T(this.inputSource.hand),this.id=xT.get(this.handedness),this.grip.visible=!this.isHand,this.controller.visible=!this.isHand,this.hand.visible=this.isHand,this.enabled=!0,this._isActive=!0,this.env.eventSys.checkXRMouse(),this.updateCursorSide())}),this.controller.addEventListener("disconnected",s=>{s.target===this.controller&&(this.inputSource=null,this.gamepad.pad=null,this._isHand=!1,this.id=xT.get(this.handedness),this.grip.visible=!1,this.controller.visible=!1,this.hand.visible=!1,this.enabled=!1,this._isActive=!1,this.env.eventSys.checkXRMouse(),this.updateCursorSide())}),Object.seal(this)}vibrate(){this._vibrate()}async _vibrate(){if(this.useHaptics&&this.gamepad.hapticActuators)try{await Promise.all(this.gamepad.hapticActuators.map(e=>e.pulse(.25,125)))}catch{this.useHaptics=!1}}get gamepad(){return this._gamepad}get handedness(){return fe(this.inputSource)?null:this.inputSource.handedness}get isHand(){return this._isHand}get cursor(){return super.cursor}set cursor(e){super.cursor=e,this.updateCursorSide()}updateCursorSide(){this.cursor.side=this.handedness==="left"?1:-1}updatePointerOrientation(){this.laser.getWorldPosition(this.newOrigin),this.laser.getWorldQuaternion(this.newQuat),this.origin.lerp(this.newOrigin,.9),this.quaternion.slerp(this.newQuat,.9),this.delta.copy(this.origin).add(this.direction),this.direction.set(0,0,-1).applyQuaternion(this.quaternion),this.up.set(0,1,0).applyQuaternion(this.quaternion),this.delta.sub(this.direction).sub(this.origin),this.moveDistance+=50*this.delta.length()}onUpdate(){this.gamepad.pad=this.inputSource&&this.inputSource.gamepad||null,super.onUpdate()}get bufferSize(){return super.bufferSize+2+this.handModel.count*64}writeState(e){if(super.writeState(e),e.writeEnum8(this.handedness,Jw),e.writeUint8(this.handModel.count),this.handModel.isTracking)for(let n=0;n<this.handModel.count;++n)this.handModel.getMatrixAt(n,gT),e.writeMatrix512(gT)}};var Hl=class extends Bo{constructor(e,n,i,o){super(e,n,i,o);this.position=new Sn;this.motion=new Sn;this.uv=new Sn;this.duv=new Sn;this.uvComp=new Sn(1,-1);this.uvOff=new Sn(-1,1);this.canMoveView=!0;let s=l=>{this._isActive=this.onCheckEvent(l),this._isActive&&this.onReadEvent(l)};this.element=this.env.renderer.domElement,this.element.addEventListener("pointerdown",s),this.element.addEventListener("pointermove",s),this.element.addEventListener("pointerup",s),this.element.addEventListener("pointercancel",s)}onCheckEvent(e){return e.pointerType===this.type}onReadEvent(e){this.updatePointerOrientation()}updatePointerOrientation(){this.element.clientWidth>0&&this.element.clientHeight>0&&(this.uv.copy(this.position),this.uv.x/=this.element.clientWidth,this.uv.y/=this.element.clientHeight,this.uv.multiplyScalar(2).multiply(this.uvComp).add(this.uvOff),this.duv.copy(this.motion),this.duv.x/=this.element.clientWidth,this.duv.y/=this.element.clientHeight,this.duv.multiplyScalar(2).multiply(this.uvComp),this.moveDistance=200*this.duv.length());let e=$s(this.env.renderer,this.env.camera);this.origin.setFromMatrixPosition(e.matrixWorld),this.direction.set(this.uv.x,this.uv.y,.5).unproject(e).sub(this.origin).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat)}onUpdate(){this.env.avatar.onMove(this,this.uv,this.duv),super.onUpdate(),this.motion.setScalar(0),this.duv.setScalar(0)}};var Wl=class extends Hl{constructor(e,n,i){let o=c=>{c.pointerType===e&&this.pointerID==null&&(this.pointerID=c.pointerId)},s=c=>{c.pointerType===e&&this.pointerID!=null&&(this.pointerID=null)},l=i.renderer.domElement;l.addEventListener("pointerdown",o),l.addEventListener("pointermove",o);super(e,n,i,new Ol(i));this.pointerID=null;this.lastX=null;this.lastY=null;l.addEventListener("pointerup",s),l.addEventListener("pointercancel",s)}onCheckEvent(e){return super.onCheckEvent(e)&&e.pointerId===this.pointerID}onReadEvent(e){this.position.set(e.offsetX,e.offsetY),e.type==="pointerdown"?this.motion.setScalar(0):(this.motion.x+=e.offsetX-this.lastX,this.motion.y+=e.offsetY-this.lastY),this.lastX=e.offsetX,this.lastY=e.offsetY,super.onReadEvent(e),(e.type==="pointerdown"||e.type==="pointerup"||e.type==="pointercancel")&&this.setButton(e.button,e.type==="pointerdown")}};var Lm=class extends Wl{constructor(e){super("mouse",1,e);this.allowPointerLock=!1;this.dz=0;this.keyMap=new Map([["`",3],["ContextMenu",2]]);this.element.addEventListener("wheel",n=>{n.preventDefault(),this.dz+=-n.deltaY*.1},{passive:!1}),this.element.addEventListener("contextmenu",n=>{n.preventDefault()}),this.element.addEventListener("pointerdown",n=>{this.onCheckEvent(n)&&(this.allowPointerLock&&!this.isPointerLocked?this.lockPointer():!this.allowPointerLock&&!this.isPointerCaptured&&this.capturePointer())}),this.element.addEventListener("pointerup",n=>{this.onCheckEvent(n)&&(this.allowPointerLock&&this.isPointerLocked?this.unlockPointer():!this.allowPointerLock&&this.isPointerCaptured&&this.releaseCapture())},!0),document.addEventListener("pointerlockchange",()=>{this.cursor.visible=!0}),window.addEventListener("keydown",n=>{this._isActive&&this.keyMap.has(n.key)&&this.setButton(this.keyMap.get(n.key),To(n))}),window.addEventListener("keyup",n=>{this.keyMap.has(n.key)&&this.setButton(this.keyMap.get(n.key),!1)}),this.mayTeleport=!0,Object.seal(this)}updatePointerOrientation(){this.isPointerLocked&&this.position.set(this.env.renderer.domElement.clientWidth,this.env.renderer.domElement.clientHeight).multiplyScalar(.5),super.updatePointerOrientation()}onUpdate(){super.onUpdate(),this.env.avatar.zoom(this.dz),this.dz=0}get isPointerLocked(){return document.pointerLockElement!=null}get isPointerCaptured(){return this.element.hasPointerCapture(this.pointerID)}get canDragView(){return super.canDragView&&!this.isPointerLocked}get canTeleport(){return super.canTeleport&&this.isPointerLocked}lockPointer(){this.element.requestPointerLock()}unlockPointer(){document.exitPointerLock()}capturePointer(){this.element.setPointerCapture(this.pointerID)}releaseCapture(){this.element.releasePointerCapture(this.pointerID)}vibrate(){}};var Im=class extends Bo{constructor(e){super("nose",8,e,null);this.point=new Ie;this.lastPoint=new Ie;this.mayTeleport=!1,this.enabled=!0,this._isActive=!0,this.updatePointerOrientation(),this.moveDistance=0,Object.seal(this)}vibrate(){}get canSend(){return!1}updatePointerOrientation(){let e=this.env.camera;e.getWorldPosition(this.origin),e.getWorldDirection(this.direction),this.up.copy(e.up),this.point.copy(this.direction).add(this.origin),this.moveDistance=this.point.distanceTo(this.lastPoint),this.lastPoint.copy(this.point)}};var Rm=class extends Wl{constructor(t){super("pen",2,t),Object.seal(this)}vibrate(){}};function hue(r){return r.pointerId}var Bm=class extends Hl{constructor(e){super("touch",3,e,null);this.dz=0;this.lastZ=0;this.points=new Array;this.lastXs=new Map;this.lastYs=new Map;this._canVibrate=null;Object.seal(this)}get enabled(){return super.enabled}set enabled(e){super.enabled=e,ct(this.points)}onReadEvent(e){x0(this.points,e.pointerId,hue);let n=e.type==="pointerdown"||e.type==="pointermove";if(n&&this.points.push(e),this.points.length===2){let o=this.points[0],s=this.points[1],l=s.offsetX-o.offsetX,c=s.offsetY-o.offsetY,u=5*Math.sqrt(l*l+c*c),p=u-this.lastZ;e.type==="pointermove"&&(this.dz+=p),this.lastZ=u}let i=1/this.points.length;if(n){this.position.setScalar(0);for(let o of this.points)if(this.position.x+=i*o.offsetX,this.position.y+=i*o.offsetY,this.lastXs.has(o.pointerId)){let s=this.lastXs.get(o.pointerId),l=this.lastYs.get(o.pointerId),c=o.offsetX-s,u=o.offsetY-l;this.motion.x+=i*c,this.motion.y+=i*u}}if(n?(this.lastXs.set(e.pointerId,e.offsetX),this.lastYs.set(e.pointerId,e.offsetY)):(this.lastXs.delete(e.pointerId),this.lastYs.delete(e.pointerId)),super.onReadEvent(e),e.type!=="pointermove"){let o=0;for(let s=0;s<this.points.length;++s){let l=this.points[s],c=1<<s;l.buttons!==0?o|=c:o&=~c}for(let s=0;s<10;++s){let l=this.isPressed(s),c=1<<s,u=(o&c)!==0;u!==l&&this.setButton(s,u)}e.type==="pointerup"&&setTimeout(()=>this._isActive=!1,10)}}onUpdate(){this.env.avatar.zoom(this.dz),super.onUpdate(),this.dz=0}get canVibrate(){return this._canVibrate===null&&(this._canVibrate="vibrate"in navigator&&ht(navigator.vibrate)),this._canVibrate}vibrate(){this.canVibrate&&navigator.vibrate(125)}};var mue=(r,t)=>r.distance-t.distance,Vm=class extends qe{constructor(e){super();this.env=e;this.raycaster=new Ub;this.hands=new Array;this.hits=new Array;this.queue=new Array;this.targetsFound=new Set;this.targets=new Array;this.customSortFunction=null;this.raycaster.camera=this.env.camera,this.raycaster.layers.set($h),this.mouse=new Lm(this.env),this.pen=new Rm(this.env),this.touches=new Bm(this.env),this.nose=new Im(this.env);for(let n=0;n<2;++n)this.hands[n]=new Pm(this.env,n);this.pointers=[this.mouse,this.pen,this.touches,this.nose,...this.hands];for(let n of this.pointers)n.addBubbler(this),n.cursor&&je(this.env.stage,n.cursor);this.checkXRMouse(),Object.seal(this)}set sortFunction(e){this.customSortFunction=e}get sortFunction(){return this.customSortFunction||mue}checkXRMouse(){let e=0;for(let i of this.hands.values())i.enabled&&++e;let n=e===0;this.mouse.enabled=n,this.pen.enabled=n,this.touches.enabled=n}refreshCursors(){for(let e of this.pointers)e.cursor&&(e.cursor=this.env.cursor3D.clone())}fireRay(e,n){return ct(this.hits),this.raycaster.ray.origin.copy(e),this.raycaster.ray.direction.copy(n),this.raycaster.intersectObjects(this.targets,!1,this.hits),this.hits.sort(this.sortFunction),this.hits[0]||null}update(){for(this.targetsFound.clear(),ct(this.targets),this.queue.push(this.env.scene);this.queue.length>0;){let e=this.queue.shift();e.children.length>0&&this.queue.push(...e.children);let n=ts(e);n&&!this.targetsFound.has(n)&&(this.targetsFound.add(n),this.targets.push(...n.meshes))}for(let e of this.pointers)e.update()}};var Ul=class extends Fs{constructor(e,n){super(e);this.cursorSystem=null;this.object=Dt("Cursor3D"),this.cursorSystem=n,this.object.matrixAutoUpdate=!1}add(e,n){je(this,n),Ay(n,Dl),n.visible=e==="default"}get style(){for(let e of this.object.children)if(e.visible)return e.name;return null}set style(e){for(let n of this.object.children)n.visible=n.name===e;if(this.style==null&&this.object.children.length>0){let n=Mn(this.object.children,i=>i.name==="default",i=>i!=null);n!=null&&(n.visible=!0)}this.cursorSystem&&(this.cursorSystem.style="none")}get visible(){return nl(this)}set visible(e){wn(this,e)}clone(){let e=new Ul(this.env);for(let n of this.object.children)e.add(n.name,n.clone());return e}};var _v=new xt().identity(),vT=new xt().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(_v.setFromAxisAngle(new Ie(0,1,0),Math.PI/2),vT.setFromAxisAngle(new Ie(1,0,0),Math.PI).premultiply(_v));var fue="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/",Om=class extends Et{constructor(e,n,i){super();this.controller=e;this.handedness=n;this.bones=new Map;this.root=null;this.instanceMatrix={needsUpdate:!1};this.oculusBrowserV14Correction=this.handedness==="left"?vT:_v;let o=new Ss;o.setPath(fue),o.load(`${this.handedness}.glb`,s=>{this.root=s.scene.children[0],this.add(this.root);let l=this.root.getObjectByProperty("type","SkinnedMesh");l.frustumCulled=!1,l.castShadow=!0,l.receiveShadow=!0,mu(l.material)?l.material=pS(l.material):du(l.material)&&(l.material=Ks(l.material)),hu(l.material)&&(l.material.color=i,l.material.shininess=.1),ys.forEach(c=>this.addBone(c))})}addBone(e){if(this.root){let n=this.root.getObjectByName(e);n&&this.bones.set(e,n)}}get count(){return this.bones.size}set count(e){}getMatrixAt(e,n){if(0<=e&&e<ys.length){let i=ys[e];this.bones.has(i)&&n.copy(this.bones.get(i).matrix)}}setMatrixAt(e,n){if(0<=e&&e<ys.length){let i=ys[e];if(this.bones.has(i)){let o=this.bones.get(i);o.matrix.copy(n),o.matrix.decompose(o.position,o.quaternion,o.scale)}}}updateMesh(){if(this.controller)for(let[e,n]of this.bones){let i=this.controller.joints[e];i&&i.visible&&(n.position.copy(i.position),n.quaternion.copy(i.quaternion).multiply(this.oculusBrowserV14Correction))}}};var gue=.008,Mv=new Vt,FT=new Ie,AT=new Vt().identity(),bT=new Vt().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(AT.makeRotationY(Math.PI/2),bT.makeRotationY(-Math.PI/2));var Nm=class extends kd{constructor(e,n,i,o){let s;o==="boxes"?s=new Td(1,1,1):o==="bones"?s=new xb(.5,.75,2.25,10,1).rotateX(-Math.PI/2):s=new tl(1,10,10);let l=new zs({color:i,shininess:.1});super(s,l,30);this.controller=e;this.instanceMatrix.setUsage(wb),this.castShadow=!0,this.receiveShadow=!0,this.oculusBrowserV14Correction=n==="left"?bT:AT}updateMesh(){if(this.controller){let e=0;for(let n of ys){let i=this.controller.joints[n];i&&i.visible&&(FT.setScalar(i.jointRadius||gue),Mv.compose(i.position,i.quaternion,FT),Mv.multiply(this.oculusBrowserV14Correction),this.setMatrixAt(e,Mv),e++)}this.count=e}this.instanceMatrix.needsUpdate=!0}};var ys=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],kv=class extends Et{constructor(e,n,i){super();this.controllerOrHandedness=e;this.color=n;this.profile=i;this.impl=null;let o=null,s=null;et(e)?s=e:o=e;let l=()=>this.add(this.impl=this.createModel(o,s));o?(o.addEventListener("connected",c=>{let u=c.data;u.hand&&!this.impl&&(s=u.handedness,l())}),o.addEventListener("disconnected",()=>{let c=this.impl;this.impl=null,s=null,c.removeFromParent(),St(c)})):s&&l()}get isTracking(){return!!this.impl}createModel(e,n){return this.profile==="mesh"?new Om(e,n,this.color):new Nm(e,n,this.color,this.profile)}get count(){return this.impl?this.impl.count:0}set count(e){this.impl&&(this.impl.count=e)}getMatrixAt(e,n){this.impl&&this.impl.getMatrixAt(e,n)}setMatrixAt(e,n){this.impl&&this.impl.setMatrixAt(e,n)}updateMesh(){this.impl&&this.impl.updateMesh()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.impl&&this.impl.updateMesh()}},Hm=class{constructor(t,e){this.color=t;this.profile=e}createHandModel(t){return new kv(t,this.color,this.profile)}};var Cv=class extends bu{constructor(){super();this.frame=null;Object.seal(this)}set(e,n,i){super.set(e,n),this.frame=i}},Wm=class{constructor(t){this.renderer=t;this.tickHandlers=new Array;this.lt=-1;this._isRunning=!1;let e=new Cv,n=0;this._onTick=(i,o)=>{this.lt>=0&&(n=i-this.lt,e.set(i,n,o),this.tick(e)),this.lt=i}}get isRunning(){return this._isRunning}restart(){this.stop(),this.start()}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){Wt(this.tickHandlers,t)}setAnimationLoop(t){this.renderer.setAnimationLoop(t),this._isRunning=T(t)}start(){this.isRunning||this.setAnimationLoop(this._onTick)}stop(){this.isRunning&&(this.setAnimationLoop(null),this.lt=-1)}tick(t){for(let e of this.tickHandlers)e(t)}};var ST=15,xue=$S(ST),Um=class extends qe{constructor(e,n,i,o,s=null,l=null,c=null){super();this.styleSheetPath=n;this.fetcher=i;this.layers=new Array;this.layerSortOrder=new Map;this.spectator=new js;this.lastViewport=new Ji;this.curViewport=new Ji;this.gltfLoader=new Ss;this.fadeDepth=0;this.scene=new Za;this.stage=Dt("Stage");this.ambient=new yd(16777215,.5);this.sun=new Ed(16777215,.75);this.ground=new Fb(xue,ST,12632256,8421504);this.foreground=Dt("Foreground");this.loadingBar=new Zh;this.handModelFactory=new Hm(new Vn(12044521),"mesh");this.screenControl=null;this.enableSpectator=!1;this._xrBinding=null;this._xrMediaBinding=null;this._hasXRMediaLayers=null;this._hasXRCompositionLayers=null;if(this.DEBUG=s||!1,this.defaultAvatarHeight=l||1.75,c=c||60,this.camera=new js(c,1,.01,1e3),this.cursor3D=new Ul(this),si(e)&&(e.style.backgroundColor="black",fe(e.parentElement)))throw new Error("The provided canvas must be included in a parent element before constructing the environment.");this.renderer=new Rd({canvas:e,powerPreference:"high-performance",precision:"lowp",antialias:!0,alpha:!0,premultipliedAlpha:!0,depth:!0,logarithmicDepthBuffer:!0,stencil:!1,preserveDrawingBuffer:!1}),this.renderer.domElement.setAttribute("touch-action","none"),this.renderer.domElement.tabIndex=1,this.useNewColorModel=!1,si(e)&&(this.screenControl=new xm(this.renderer,this.camera,this.renderer.domElement.parentElement,o)),this.fader=new Qh("ViewFader"),this.worldUISpace=new Ku("WorldUISpace",.2,20,.125),this.avatar=new Jh(this,this.fader),this.eventSys=new Vm(this),this.timer=new Wm(this.renderer),this.skybox=new vm(this),this.renderer.xr.enabled=!0,this.sun.name="Sun",this.sun.position.set(0,1,1),this.sun.lookAt(0,0,0),this.sun.layers.enableAll();let u=()=>{this.ground.visible=this.renderer.xr.isPresenting};this.screenControl.addEventListener("sessionstarted",u),this.screenControl.addEventListener("sessionstopped",u),u(),this.ambient.name="Fill",this.ambient.layers.enableAll(),this.loadingBar.object.name="MainLoadingBar",this.loadingBar.object.position.set(0,-.25,-2),this.scene.layers.enableAll(),this.avatar.addFollower(this.worldUISpace),je(this.scene,this.sun,this.ambient,je(this.stage,this.ground,this.camera,this.avatar,...this.eventSys.hands),this.foreground,je(this.worldUISpace,this.loadingBar)),this.timer.addTickHandler(p=>this.update(p)),this._start(),globalThis.env=this}get useNewColorModel(){return Mx.enabled}set useNewColorModel(e){Mx.enabled=e,this.renderer.outputEncoding=e?eS:kb}async _start(){T(this.styleSheetPath)&&await this.fetcher.get(this.styleSheetPath).style(),this.timer.start()}get gl(){return this.renderer.getContext()}get referenceSpace(){return this.renderer.xr.getReferenceSpace()}update(e){if(this.dispatchEvent(e),this.screenControl.visible){let n=this.xrSession;this._xrBinding=this.renderer.xr.getBinding(),this.hasXRMediaLayers&&this._xrMediaBinding===null===this.renderer.xr.isPresenting&&(this._xrMediaBinding===null&&T(n)?this._xrMediaBinding=new XRMediaBinding(n):this._xrMediaBinding=null);let i=n&&this.renderer.xr.getBaseLayer();i!==this.baseLayer&&(T(this.baseLayer)&&(this.removeWebXRLayer(this.baseLayer),this.baseLayer=null),T(i)&&(this.baseLayer=i,this.addWebXRLayer(i,0))),this.screenControl.resize(),this.eventSys.update(),this.avatar.update(e.dt),this.worldUISpace.update(this.avatar.height,this.avatar.worldPos,this.avatar.worldHeadingRadians,e.dt),this.fader.update(e.dt),HS(e.dt),this.loadingBar.update(e.sdt),this.preRender(e);let o=$s(this.renderer,this.camera);if(o!==this.camera){let s=o;s.layers.mask=this.camera.layers.mask;for(let l=0;l<s.cameras.length;++l){let c=s.cameras[l];c.layers.mask=this.camera.layers.mask,c.layers.enable(l+1),s.layers.enable(l+1)}}this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.enableSpectator&&(this.renderer.xr.isPresenting?Ga()&&!sd()&&this.drawSnapshot():(this.lastViewport.copy(this.curViewport),this.renderer.getViewport(this.curViewport)))}}drawSnapshot(){let e=this.renderer.xr.isPresenting,n=null;if(e){let i=$s(this.renderer,this.camera);this.spectator.projectionMatrix.copy(this.camera.projectionMatrix),this.spectator.position.copy(i.position),this.spectator.quaternion.copy(i.quaternion),n=this.renderer.getRenderTarget(),this.renderer.xr.isPresenting=!1,this.renderer.setRenderTarget(null),this.renderer.setViewport(this.lastViewport)}this.renderer.clear(),this.renderer.render(this.scene,e?this.spectator:this.camera),e&&(this.renderer.setViewport(this.curViewport),this.renderer.setRenderTarget(n),this.renderer.xr.isPresenting=!0)}preRender(e){}async onQuitting(){this.dispatchEvent(new Ae("quitting")),window.location.href="/"}get hasAlpha(){return this.renderer.getContextAttributes().alpha}get xrSession(){return this.renderer.xr.getSession()}get xrBinding(){return this._xrBinding}get xrMediaBinding(){return this._xrMediaBinding}get isReadyForLayers(){return this.hasAlpha&&(!bo||kF.major>=15)}get hasXRMediaLayers(){return this._hasXRMediaLayers===null&&(this._hasXRMediaLayers=this.isReadyForLayers&&"XRMediaBinding"in globalThis&&ht(XRMediaBinding.prototype.createQuadLayer)),this._hasXRMediaLayers}get hasXRCompositionLayers(){return this._hasXRCompositionLayers===null&&(this._hasXRCompositionLayers=this.isReadyForLayers&&"XRWebGLBinding"in globalThis&&ht(XRWebGLBinding.prototype.createCubeLayer)),this._hasXRCompositionLayers}addWebXRLayer(e,n){this.layers.push(e),this.layerSortOrder.set(e,n),Ds(this.layers,i=>-this.layerSortOrder.get(i)),this.updateLayers()}removeWebXRLayer(e){this.layerSortOrder.delete(e),Wt(this.layers,e),this.updateLayers()}updateLayers(){let e=this.xrSession;T(e)&&e.updateRenderState({layers:this.layers})}clearScene(){this.dispatchEvent(new Ae("sceneclearing")),St(this.foreground),this.dispatchEvent(new Ae("scenecleared"))}async fadeOut(){++this.fadeDepth,this.fadeDepth===1&&(await this.fader.fadeOut(),this.skybox.visible=!1,this.camera.layers.set(Dl),this.loadingBar.start(),await this.fader.fadeIn())}async fadeIn(){this.fadeDepth===1&&(await this.fader.fadeOut(),this.camera.layers.set($h),this.skybox.visible=!0,await this.fader.fadeIn()),--this.fadeDepth}async withFade(e){try{return await this.fadeOut(),await e()}finally{await this.fadeIn()}}get showWebXRLayers(){return this.fadeDepth===0}set3DCursor(e){let n=e.children.slice(0);for(let i of n)this.cursor3D.add(i.name,i);this.eventSys.refreshCursors(),this.dispatchEvent(new Ae("newcursorloaded"))}async load(e,...n){let i=null;Vs(e)?n.push(e):i=e;let o=new ko(this,"/models/Cursors.glb",Xi,!this.DEBUG);n.push(o),await this.fetcher.assets(i,...n),qs(o.result.scene,uS),this.set3DCursor(o.result.scene)}loadGltf(e){return this.gltfLoader.loadAsync(e)}};var Pt=class extends qe{constructor(...e){super();this.element=De(Xe("input-range-with-number"),this.rangeInput=uF(Je(()=>{this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.dispatchEvent(new Ae("input"))}),...e),this.numberInput=Vr(Je(()=>{this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber,this.rangeInput.dispatchEvent(new Event("input"))}))),this.numberInput.min=this.rangeInput.min,this.numberInput.max=this.rangeInput.max,this.numberInput.step=this.rangeInput.step,this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.numberInput.disabled=this.rangeInput.disabled,this.numberInput.placeholder=this.rangeInput.placeholder}get value(){return this.rangeInput.value}set value(e){this.rangeInput.value=this.numberInput.value=e}get valueAsNumber(){return this.rangeInput.valueAsNumber}set valueAsNumber(e){this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber=e}get disabled(){return this.rangeInput.disabled}set disabled(e){this.rangeInput.disabled=this.numberInput.disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}};var ep=class{constructor(t,...e){this.name=t;this.properties=e}};function Ts(r,...t){return new ep(r,...t)}var Dv="DefaultPropertyGroup"+xr(16),wue=Xe("single-item");function yT(r){return r.flatMap(t=>vue(t).flatMap(Rr))}function vue(r){let t=Dv,e=new Array;return r instanceof ep?(t=r.name,e.push(...r.properties.map(n=>TT(t,n)))):e.push(TT(t,r)),e}function TT(r,t){let e=r===Dv?null:kn("groupname",r);if(hr(t)){let[n,...i]=t,o=Hc(n);for(let s of i)if(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement||s instanceof HTMLSelectElement){s.id.length===0&&(s.id=xr(10)),o.htmlFor=s.id;break}return[Y0(e,o),Ng(e,...i)]}else return(et(t)||Rt(t)||dr(t)||jo(t))&&(t=Np(t)),[Ng(e,t)]}function Fue(r){return T(r)&&!Cg(r)&&!Rg(r)}var Ar=class{constructor(t){this.element=t;this.groups=new gn;this.controls=new Array;this._disabled=!1;let e=[...t.children];for(;e.length>0;){let n=e.shift();Jo(n)&&this.controls.push(n),n instanceof HTMLElement&&(this.checkGroup(n),e.push(...n.children))}}static find(){return Array.from(Ar._find())}static*_find(){for(let t of Bp(".properties"))yield new Ar(t)}static create(...t){let e=t.filter(Fue),n=t.filter(Cg),i=t.filter(Rg),o=F0(i,"properties"),s=yT(e);return new Ar(K0(Ne(...o),...n,...i,...s))}append(...t){let e=yT(t);We(this.element,...e);for(let n of t){let i=n instanceof ep?n.properties:[n];for(let o of i)if(!et(o)){let[s,...l]=hr(o)?o:[null,o];for(let c of l)Jo(c)&&this.controls.push(c)}}for(let n of e)this.checkGroup(n)}checkGroup(t){let e=sn(t),n=e.dataset.groupname;n!==Dv&&this.groups.add(n,t),e.parentElement===this.element&&e.tagName==="DD"&&(!e.previousElementSibling||e.previousElementSibling.tagName!=="DT")&&wue.applyToElement(e)}get disabled(){return this._disabled}set disabled(t){if(t!==this.disabled){this._disabled=t,jn(this,t,"disabled");for(let e of this.controls)e.disabled=t}}get enabled(){return!this.disabled}set enabled(t){this.disabled=!t}setGroupVisible(t,e){let n=this.groups.get(t);if(n)for(let i of n)st(i,e)}getGroupVisible(t){let e=this.groups.get(t);if(e)for(let n of e)return zn(n);return!1}};var zm="micFields"+xr(8),Pv="camFields"+xr(8);function ET(r,t,e){Bt(r),We(r,Bn(hn(""),"NONE"),...t.map(n=>Bn(C0(e&&n.deviceId===e.deviceId),hn(n.deviceId),n.label)))}var jm=class extends Hr{constructor(e,n,i,o,s,l=!1){super("Configure devices");this.devices=n;this.audio=i;this.microphones=o;this.webcams=s;this.micLookup=null;this.camLookup=null;this.spkrLookup=null;this.spkrVolumeControl=null;this.speakers=null;this.cancelButton.style.display="none";let c=new _i("/audio/test-clip.mp3",Or,!l),u=e.assets(c).then(()=>this.audio.createBasicClip("test-audio",c,.5));We(this.contentArea,l0("2em"),this.properties=Ar.create(Ts(Pv,["Webcams",this.webcamSelector=fr(Je(async()=>{let p=this.webcamSelector.value,f=this.camLookup.get(p);await this.webcams.setDevice(f)}))]),Ts(zm,["Microphones",this.microphoneSelector=fr(fn("inline-block"),Je(async()=>{let p=this.microphoneSelector.value,f=this.micLookup.get(p);await this.microphones.setDevice(f)}))],["Volume",this.micVolumeControl=new Pt(Ft(0),vt(100),ft(1),hn(0),Je(()=>{this.microphones.gain.setValueAtTime(this.micVolumeControl.valueAsNumber/100,0)}))],["Levels",this.micLevels=tF(fn("inline-block"))]))),to&&(this.properties.append(["Speakers",this.speakers=fr(Je(async()=>{let p=this.speakers.value,f=this.spkrLookup.get(p);await this.audio.speakers.setAudioOutputDevice(f)}))]),this.audio.speakers.addEventListener("audiooutputchanged",p=>{this.speakers.value=p.device&&p.device.deviceId||""})),this.properties.append(["Volume",this.spkrVolumeControl=new Pt(Ft(0),vt(100),ft(1),hn(0),Je(()=>this.audio.destination.volume=this.spkrVolumeControl.valueAsNumber/100))],["",this.testSpkrButton=Ma("Test",Er("Test audio"),yp(mr(.5)),pt(async()=>{this.testSpkrButton.disabled=!0,await u,await this.audio.playClipThrough("test-audio"),this.testSpkrButton.disabled=!1}))],["Using headphones",this.useHeadphones=nr(Dp(this.audio.useHeadphones),Je(()=>{this.audio.useHeadphones=this.useHeadphones.checked,st(this.headphoneWarning,!this.audio.useHeadphones,"inline-block")}))],this.headphoneWarning=De(Xe("alert alert-warning"),"\u{1F3A7}\u{1F399}\uFE0F This site has a voice chat feature. Voice chat is best experienced using headphones.")),this.activity=new Yu(this.audio.context),this.activity.name="device-settings-dialog-activity",this.activity.addEventListener("activity",p=>{this.isOpen&&(this.micLevels.value=p.level)}),this.microphones.connect(this.activity),this.activity.start(),this.properties.setGroupVisible(zm,!1),Object.seal(this)}get showWebcams(){return this.properties.getGroupVisible(Pv)}set showWebcams(e){this.properties.setGroupVisible(Pv,e)}get showMicrophones(){return this.properties.getGroupVisible(zm)}set showMicrophones(e){this.properties.setGroupVisible(zm,e)}async onShowing(){if(this.showWebcams||this.showMicrophones){await this.devices.init();let e=await this.devices.getDevices();if(this.showWebcams){let n=e.filter(i=>i.kind==="videoinput");this.camLookup=Ua(n,i=>i.deviceId),ET(this.webcamSelector,n,this.webcams.device)}if(this.showMicrophones){let n=e.filter(i=>i.kind==="audioinput");this.micLookup=Ua(n,i=>i.deviceId),ET(this.microphoneSelector,n,this.microphones.device),this.microphones.usingHeadphones=this.useHeadphones.checked,this.microphones.enabled=!0,this.micVolumeControl.valueAsNumber=this.microphones.gain.value*100}}if(to){await this.audio.speakers.ready;let e=await this.audio.speakers.getAudioOutputDevices();this.spkrLookup=Ua(e,i=>i.deviceId),Bt(this.speakers),We(this.speakers,...e.map(i=>Bn(hn(i.deviceId),i.label)));let n=await this.audio.speakers.getAudioOutputDevice();n||(n=await this.audio.speakers.getPreferredAudioOutput(),await this.audio.speakers.setAudioOutputDevice(n)),this.speakers.value=n&&n.deviceId||""}this.spkrVolumeControl.valueAsNumber=this.audio.destination.volume*100,this.useHeadphones.checked=this.audio.useHeadphones,st(this.headphoneWarning,!this.audio.useHeadphones,"inline-block"),await super.onShowing()}};var Lv=class extends Ae{constructor(e){super("roomjoined");this.roomName=e}},Iv=class extends Ae{constructor(e){super("dialogshowing");this.showing=e}},Gm=class extends Um{constructor(e){if(fe(e))throw new un("Options are now required");if(fe(e.canvas))throw new un("options.canvas is required");if(fe(e.fetcher))throw new un("options.fetcher is required");if(fe(e.dialogFontFamily))throw new un("options.dialogFontFamily is required");if(fe(e.getAppUrl))throw new un("options.getAppUrl is required");if(fe(e.uiImagePaths))throw new un("options.uiImagePaths is required");if(fe(e.buttonFillColor))throw new un("options.buttonFillColor is required");if(fe(e.labelFillColor))throw new un("options.labelFillColor is required");super(e.canvas,e.styleSheetPath,e.fetcher,e.enableFullResolution,e.DEBUG,e.defaultAvatarHeight,e.defaultFOV);this.envAudioToggleEvt=new Ae("environmentaudiotoggled");this._currentRoom=null;this._testSpaceLayout=!1;this.countTick=0;this.fpses=new Array;this.avgFPS=0;this.screenUISpace=new Ph(e.buttonFillColor),this.compassImage=new bh,this.clockImage=new ps(this,"Clock","none",new Mh),this.clockImage.sizeMode="fixed-height",this.clockImage.mesh.renderOrder=5,this.statsImage=new ps(this,"Stats","none",new kh),this.statsImage.sizeMode="fixed-height",this.statsImage.mesh.renderOrder=5,this.infoLabel=new Cr(this,"InfoLabel","none",{minHeight:.1,maxHeight:.1,padding:.02,scale:1e3,bgFillColor:e.labelFillColor,textFillColor:"white"}),this.apps=new Yh(this,e.getAppUrl),this.apps.addEventListener("apploaded",n=>{n.app.addEventListener("joinroom",i=>{i.roomName!==this._currentRoom&&(this._currentRoom=i.roomName,this.dispatchEvent(new Lv(i.roomName)))})}),this.audio=new vh(e.fetcher,PS),this.graph=new _h(this.audio.context),si(e.canvas)&&e.canvas.addEventListener("keypress",n=>{To(n)&&n.key==="`"&&this.graph.showDialog()}),this.audioPlayer=new yl(this.audio.context,this.audio.createSpatializer(!1,!1)),this.videoPlayer=new Uh(this,this.audio.context,this.audio.createSpatializer(!1,!1)),this.videoPlayer.object.visible=!1,this.interactionAudio=new Dh(this.audio,this.eventSys),this.microphones=new Ah(this.audio.context),this.webcams=new Ch,this.devices=new Fh(this.microphones,this.webcams),this.confirmationDialog=new Kh(this,e.dialogFontFamily),this.devicesDialog=new jm(this.fetcher,this.devices,this.audio,this.microphones,this.webcams,this.DEBUG),this.uiButtons=new Gh(e.uiImagePaths,20,e.buttonFillColor,e.labelFillColor,this.DEBUG),this.menuButton=new kl(this.uiButtons,"ui","menu"),this.settingsButton=new kl(this.uiButtons,"ui","settings"),this.quitButton=new kl(this.uiButtons,"ui","quit"),this.muteMicButton=new ds(this.uiButtons,"microphone","mute","unmute"),this.muteCamButton=new ds(this.uiButtons,"media","play","pause"),this.muteEnvAudioButton=new ds(this.uiButtons,"environment-audio","mute","unmute"),this.muteEnvAudioButton.active=!0,this.audio.ready.then(()=>this.muteEnvAudioButton.active=!1),this.vrButton=new Cl(this.uiButtons,"VR"),this.fullscreenButton=new Cl(this.uiButtons,"Fullscreen"),this.arButton=new Cl(this.uiButtons,"AR"),El.isAvailable&&$c()&&(this.batteryImage=new ps(this,"Battery","none",new El),this.batteryImage.sizeMode="fixed-height"),this.xrUI=new Lh,this.subMenu=new us(De(Ct("juniperSubMenu")),Dt("sub-menu"),"flex"),this.createMenu(),this.screenControl.setUI(this.screenUISpace,this.fullscreenButton,this.vrButton,this.arButton),T(this.screenControl)&&this.screenControl.addEventListener("sessionstarted",n=>{n.mode==="Fullscreen"&&this.confirmationDialog.element.parentElement!==this.screenControl.fullscreenElement&&We(this.screenControl.fullscreenElement,this.devicesDialog,this.confirmationDialog)}),T(e.watchModelPath)&&(this.watch=new zh(this,e.watchModelPath)),this.microphones.addEventListener("devicesettingschanged",()=>{this.muteMicButton.active=this.microphones.enabled&&!this.microphones.muted}),this.webcams.addEventListener("devicesettingschanged",()=>{this.muteCamButton.active=this.webcams.enabled}),this.muteMicButton.addEventListener("click",()=>{this.microphones.muted=this.microphones.enabled&&!this.microphones.muted,this.muteMicButton.active=!this.microphones.muted}),this.muteCamButton.addEventListener("click",()=>{this.webcams.enabled=!this.webcams.enabled,this.muteCamButton.active=this.webcams.enabled}),this.muteMicButton.active=this.microphones.enabled&&!this.microphones.muted,this.muteCamButton.active=this.webcams.enabled,ht(e.createSpeechRecognizer)&&(this.speech=e.createSpeechRecognizer(this.fetcher,this.devicesDialog.activity,this.microphones),this.speech.continuous=!0)}get currentRoom(){return this._currentRoom}get testSpaceLayout(){return this._testSpaceLayout}set testSpaceLayout(e){e!==this.testSpaceLayout&&(this._testSpaceLayout=e)}createMenu(){T(this.batteryImage)&&(this.xrUI.addItem(this.batteryImage,{x:.75,y:-1,width:.2,height:.1}),We(this.screenUISpace.topRight,this.batteryImage)),this.xrUI.addItem(this.clockImage,{x:-1,y:1,height:.1}),this.xrUI.addItem(this.statsImage,{x:-1,y:.95,height:.1}),this.xrUI.addItem(this.confirmationDialog,{x:0,y:0,scale:.25}),this.xrUI.addItem(this.menuButton,{x:-1,y:-1,scale:.5}),this.xrUI.addItem(this.infoLabel,{x:0,y:-1.125,scale:.5}),this.xrUI.addItem(this.vrButton,{x:1,y:-1,scale:.5}),this.xrUI.addItem(this.arButton,{x:1,y:-1,scale:.5}),je(this.menuButton,this.subMenu),je(this.worldUISpace,this.xrUI),We(this.screenUISpace.topLeft,c0("none"),We(this.webcams,fn("inline-block"),Kn(on(50)),h0("scaleX(-1)"))),We(this.screenUISpace.topRight,this.compassImage,this.statsImage),We(this.screenUISpace.bottomCenter,this.infoLabel),We(this.screenUISpace.bottomRight,this.vrButton,this.arButton,this.fullscreenButton),We(this.screenUISpace.bottomLeft,De(this.menuButton,fn("flex"),r0("column-reverse"),o0(mr(.25)),this.subMenu)),hy(this.subMenu,this.settingsButton,this.muteCamButton,this.muteMicButton,this.muteEnvAudioButton,this.quitButton),this.settingsButton.addEventListener("click",async()=>{let e=this.screenControl.currentMode,n=this.renderer.xr.isPresenting;n&&await this.screenControl.stop(),await this.devicesDialog.showDialog(),n&&await this.screenControl.start(e)}),this.muteEnvAudioButton.addEventListener("click",()=>{this.muteEnvAudioButton.active=!this.muteEnvAudioButton.active,this.dispatchEvent(this.envAudioToggleEvt)}),this.quitButton.addEventListener("click",()=>this.withConfirmation("Confirm quit","Are you sure you want to quit?",async()=>{this.renderer.xr.isPresenting&&this.screenControl.stop(),await this.onQuitting()})),this.menuButton.addEventListener("click",()=>this.subMenu.visible=!this.subMenu.visible),[this.settingsButton,this.muteCamButton,this.muteMicButton,this.muteEnvAudioButton,this.quitButton].forEach(e=>e.addEventListener("click",()=>this.subMenu.visible=!1)),this.subMenu.visible=!1,this.vrButton.visible=Ga()&&ld()||Ao(),this.arButton.visible=!1,this.muteCamButton.visible=!1,this.muteMicButton.visible=!1}layoutMenu(){let e=0;for(let n of this.subMenu.object.children)n.visible&&n.position.set(0,++e*.25,0)}preRender(e){super.preRender(e);let{worldPos:n,worldQuat:i}=this.avatar;if(this.audio.setUserPose(this.audio.localUserID,n.x,n.y,n.z,i.x,i.y,i.z,i.w),this.xrUI.visible=this.renderer.xr.isPresenting||this.testSpaceLayout,this.statsImage.isVisible=this.xrUI.visible&&this.DEBUG,this.renderer.xr.isPresenting||this.compassImage.setPitchAndHeading(Yt(this.avatar.worldPitchRadians),Yt(this.avatar.worldHeadingRadians)),this.layoutMenu(),this.DEBUG){let o=Math.round(e.fps);if(this.avgFPS+=o/100,this.fpses.push(o),this.fpses.length>100){let s=this.fpses.shift();this.avgFPS-=s/100}++this.countTick%100===0&&this.statsImage.image.setStats(this.avgFPS,this.renderer.info.render.calls,this.renderer.info.render.triangles)}this.confirmationDialog.update(e.dt)}get environmentAudioMuted(){return this.muteEnvAudioButton.active}async withConfirmation(e,n,i){this.onConfirmationShowing(!0),await this.confirmationDialog.prompt(e,n)&&i(),this.onConfirmationShowing(!1)}onConfirmationShowing(e){dy(this.quitButton,!e),this.dispatchEvent(new Iv(e))}async load(e,...n){let i=null;Vs(e)?(n.push(e),i=this.loadingBar):i=e,si(this.renderer.domElement)&&We(this.renderer.domElement.parentElement,this.renderer.domElement,...this.screenUISpace.elements);let o=new _i("/audio/footsteps.mp3",Or,!this.DEBUG),s=new _i("/audio/basic_enter.mp3",Or,!this.DEBUG),l=new _i("/audio/basic_exit.mp3",Or,!this.DEBUG),c=new _i("/audio/basic_error.mp3",Or,!this.DEBUG),u=new _i("/audio/vintage_radio_button_pressed.mp3",Or,!this.DEBUG);n.push(...this.uiButtons.assets,o,s,l,c,u),T(this.watch)&&n.push(this.watch.asset),await super.load(i,...n),await An(this.audio.createBasicClip("footsteps",o,.5),this.interactionAudio.create("enter",s,.25),this.interactionAudio.create("exit",l,.25),this.interactionAudio.create("error",c,.25),this.interactionAudio.create("click",u,1)),this.screenUISpace.show()}};var Xm=class{constructor(){this.mouseX=0;this.mouseY=0;this.element=De(Xe("context-menu")),st(this.element,!1),window.addEventListener("mousemove",t=>{this.mouseX=t.clientX,this.mouseY=t.clientY})}async cancel(){T(this.currentTask)&&(this.currentTask.resolve("cancel"),await this.currentTask,this.currentTask=null)}async show(t,...e){let n;t instanceof Map?n=t:(n=new Map,e.unshift(t)),T(this.currentTask)&&await this.cancel();let i=new mt;this.currentTask=i,Bt(this.element),We(this.element,a0(yr(this.mouseX)),d0(yr(this.mouseY)),...e.map(s=>s instanceof HTMLHRElement?(s.style.width=on(100),s):oi(n.has(s)?n.get(s):s.toString(),pt(this.currentTask.resolver(s),!0)))),st(this.element,!0,"grid"),this.mouseY=Math.min(this.mouseY,window.innerHeight-this.element.clientHeight-50),this.element.style.top=yr(this.mouseY);let o=this.currentTask.resolver("cancel");return addEventListener("click",o),this.currentTask.finally(()=>{st(this.element,!1),removeEventListener("click",o)}),await i}};var tp="proportion",DT="index";function Qm(r,...t){return De(Ne("dock",r),...t)}function _T(r){return r instanceof ot&&r.key===tp}var zl=class{constructor(t,e){this.type=t;this.value=e}};function PT(r){return new zl("resizable",r)}function LT(r){return new zl("rearrangeable",r)}function IT(r,t){return t instanceof zl&&t.type===r}function Aue(r){return IT("resizable",r)}function bue(r){return IT("rearrangeable",r)}function Sue(r){return!(r instanceof zl)}function RT(r,...t){let e=Ig(t,Aue),n=Ig(t,bue),i=e&&e.value,o=n&&n.value,s=t.filter(Sue),l=[];i&&l.push("resizable"),o&&l.push("rearrangeable");let c=null,u=null,p=null,f=null,w=Qm("panel",Ct(r),Ne(...l),gd(L=>{let J=A(L.target);(o&&Ym(J)||i&&fi(J))&&M(J,L.clientX,L.clientY)}),Ka(L=>{if(T(c)){let J=A(L.target);i&&p==="sep"?(L.preventDefault(),b(u,c,L.clientX,L.clientY)):o&&p==="cell"&&fi(J)&&(L.preventDefault(),k(J))}}),qa(L=>{A(L.target)===c&&Ym(c)&&fi(f)&&E(u,f),c&&(c.classList.remove("dragging"),c=null,u=null,p=null),f&&(f.classList.remove("targeting"),f=null)}),...s);function A(L){let J=L;for(;T(J)&&!J.classList.contains("dock");)J=J.parentElement;return J}let m=At.create(),d=At.create(),h=At.create();function M(L,J,ae){c=L,u=c.parentElement,p=Eue(c),c.classList.add("dragging"),fi(c)&&At.set(m,J,ae)}function k(L){f&&(f.classList.remove("targeting"),f=null),f=L,f.classList.add("targeting")}function E(L,J){let ae=J.parentElement,Q=qm(ae)===qm(J),ee=MT(J);if(!Q){let $=CT(ae);ae=Og(ae,te=>Rv($,te))}let K=ae.children[ee];K!==c.nextElementSibling&&(Wi(ae,L,K),V(!1))}function b(L,J,ae,Q){At.set(d,ae,Q),At.sub(h,d,m);let ee=Jm(L),K=h[ee?0:1];if(K!==0){At.copy(m,d);let $=ee?"clientWidth":"clientHeight",te=0,xe=0;L.querySelectorAll(":scope > .dock.group").forEach(C=>{Km(C)||(++xe,te+=C[$])});let be=te/xe,Ue=MT(J),Y=g(L,Ue,-1),P=g(L,Ue,1);if(T(Y)&&T(P)){let C=Y[$]+K,N=P[$]-K,j=C/be,z=N/be;y(Y,j),y(P,z),V(!0)}}}function g(L,J,ae){ae===-1&&--J;let Q=L.children[J];for(;T(Q)&&!fi(Q)&&Km(Q);)J+=ae,Q=L.children[J];return fi(Q)&&(Q=null),Q}function v(L){if(!fi(L)){let J=localStorage.getItem(r+"."+L.id+":"+tp)||Vg(L,tp);return parseFloat(J)||1}return null}function y(L,J){if(!fi(L)){let ae=J.toString();localStorage.setItem(r+"."+L.id+":"+tp,ae),kn(tp,ae).applyToElement(L)}}function V(L){L||(w.querySelectorAll(".dock.sep").forEach(J=>J.remove()),w.querySelectorAll(".dock.cell").forEach(J=>{J.parentElement.childElementCount>1&&Og(J,ae=>$m(ae))})),Array.from(w.querySelectorAll(".dock.group")).reverse().forEach(J=>{J.childElementCount===0?J.remove():J.childElementCount===1&&Bv(J.parentElement)&&J.parentElement.childElementCount===1?J.replaceWith(...J.children):B(J,L)})}function B(L,J){L.childElementCount===1&&Vv(L)&&(L.classList.remove("column"),L.classList.add("row"));let ae=qm(L.parentElement),Q=qm(L),ee=CT(L),K=Jm(L),$=K?Dg:Pg,te=K?Pg:Dg,xe=K?Cs:Lg,be=K?Lg:Cs,Ue=o?1:0,Y=$(2,-2),P=te(2,-2),C=[];L.querySelectorAll(":scope > .dock:not(.sep)").forEach((z,X)=>{let oe=z,se=2*X+Ue+1;$(se,se+1).applyToElement(oe),P.applyToElement(oe),Km(oe)?C.push("auto"):C.push(`${v(oe)}fr`)});for(let z=C.length+Ue-1;z>=1-Ue;--z)Xo(C,"min-content",z);let N=xe(...C),j=o?be("min-content",Go(1),"min-content"):be("auto");if(We(L,N,j),!J){for(let z=L.childElementCount,X=0;X<=z;++X){let oe=2*X+Ue,se=X===0||X===z;(!se||o&&Q!==ae)&&We(L,kT(Q,X,se,$(oe,oe+1),P))}if(o&&ee!==ae)for(let z=0;z<2;++z){let X=2*z+1;We(L,kT(ee,z,!0,te(X,X+1),Y))}}}let D=0;return w.querySelectorAll(".dock.group").forEach(L=>{L.id="G"+ ++D,y(L,v(L))}),V(!1),w.querySelectorAll(".dock.cell").forEach(L=>{L.querySelector(":scope > .header").draggable=o,L.addEventListener("regrid",()=>V(!1))}),w}function Rv(r,...t){return Qm("group",Ne(r),...t)}function BT(...r){return Rv("column",...r)}function $m(...r){return Rv("row",...r)}function MT(r){if(fi(r)){let t=Vg(r,DT);return fe(t)?null:parseFloat(t)}return null}function yue(r,t){fi(r)&&kn(DT,t.toFixed(0)).applyToElement(r)}function kT(r,t,e,...n){let i=[r];e&&i.push("edge");let o=Qm("sep",Ne(...i),Bc(!e),...n);return yue(o,t),o}function np(r,...t){(et(r)||jo(r)||Rt(r)||dr(r))&&(r=Q0(r));let e=t.filter(_T);t=t.filter(s=>!_T(s));let n=De(Ne("content"),...t),i=Ps(Ne("closer"),tu.emojiStyle,pt(()=>{B0(n,"grid");let s=zn(n);Ye(i,s?tu.emojiStyle:hd.emojiStyle),o.classList.toggle("closed",!s),o.dispatchEvent(new Event("regrid"))})),o=Qm("cell",...e,i,We(r,Bc(!0),Ne("header")),n);return $m(o)}function Zm(r,t){return T(t)&&t.classList.contains(r)}function Tue(r){return Zm("panel",r)}function fi(r){return Zm("sep",r)}function Ym(r){return Zm("cell",r)}function Bv(r){return Zm("group",r)}function Eue(r){return Tue(r)?"panel":fi(r)?"sep":Ym(r)?"cell":Bv(r)?"group":null}function Km(r){if(Ym(r))return r.classList.contains("closed");if(Bv(r)){for(let t=0;t<r.childElementCount;++t)if(!Km(r.children[t]))return!1;return!0}else return!!fi(r)}function VT(r,t){return T(t)&&t.classList.contains(r)}function Vv(r){return VT("column",r)}function Jm(r){return VT("row",r)}function qm(r){return Jm(r)?"row":Vv(r)?"column":null}function CT(r){return Jm(r)?"column":Vv(r)?"row":null}var Ov=class extends Ae{constructor(e){super("tabselected");this.tabname=e}};function OT(r){return r instanceof Tt||r instanceof ot}function _ue(r){return!OT(r)}var co=class extends qe{constructor(e){super();this.element=e;this.views=new Map;this.curTab=null;this._disabled=!1;let n=0,i=[...e.querySelectorAll(".tabs > button")].map(l=>[l.dataset.panelname||`tab${++n}`,l]),o=new Map(i);n=0;let s=new Map([...e.querySelectorAll(".panels > *")].map(l=>[l.id||`tab${++n}`,l]));for(let[l,c]of o){let u=s.get(l);c.addEventListener("click",()=>{this.select(l),this.dispatchEvent(new Ov(l))});let p=u.style.display;(p="none")&&(p=null),this.views.set(l,{button:c,displayType:p,panel:u})}i.length>0&&this.select(i[0][0])}static find(){return Array.from(co._find())}static*_find(){for(let e of Bp(".tab-panel"))yield new co(e)}static create(...e){let n=e.filter(OT),i=e.filter(_ue),o=new Map,s=null;for(let c of i){let[u,p,f]=c,w=kn("panelname",u);fe(s)&&(s=u);let m=sn(f).style.display;We(f,Ct(u)),o.set(u,{panel:f,displayType:m,button:Ps(p,w)})}let l=Array.from(o.values());return new co(De(Xe("tab-panel"),...n,De(Xe("tabs"),...l.map(c=>c.button)),De(Xe("panels"),...l.map(c=>c.panel))))}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get disabled(){return this._disabled}set disabled(e){this._disabled=e;for(let[n,i]of this.views)if(i.button.disabled=e||n===this.curTab,jn(i.panel,e,"disabled"),Jo(i.panel))i.panel.disabled=e;else{let o=sn(i.panel);Jo(o)&&(o.disabled=e)}}isSelected(e){return this.curTab===e}select(e){if(this.views.has(e)){this.curTab=e;for(let[n,i]of this.views){let o=n===this.curTab;i.button.disabled=o||this.disabled,st(i.panel,o,i.displayType)}}}};var jl=class extends Ae{constructor(){super("refresh")}};var Nv=class{constructor(t="controls progress"){let e=De(Xe("progress-bar"),k0("progressbar"),S0(0),b0(0),A0(1),Kn(0));this.element=De(Xe(t),e),this.progress=new Hv(e)}clear(){this.progress.clear()}report(t,e,n,i){this.progress.report(t,e,n,i)}attach(t){this.progress.attach(t)}start(t){this.progress.start(t)}end(t){this.progress.end(t)}},Hv=class extends Yr{constructor(e,n=!0){super();this.progressBar=e;this.showMessage=n}report(e,n,i,o){if(super.report(e,n,i,o),e===0)this.progressBar.style.width="0",this.progressBar.setAttribute("aria-valuenow","0");else{let s=(100*this.p).toFixed(1);this.progressBar.style.width=`${s}%`,this.progressBar.setAttribute("aria-valuenow",s)}this.showMessage&&Ye(this.progressBar,i||"")}};function ef(r="controls progress"){return new Nv(r)}var Gl=class{constructor(t=.25){this.debounceSeconds=t;this.timer=null;this.curTask=null;this.nextTask=null}throttle(t){T(this.curTask)?this.nextTask=t:(T(this.timer)&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(async()=>{this.timer=null,this.run(t)},this.debounceSeconds*1e3))}async run(t){this.curTask=t(),await this.curTask;let e=this.nextTask;T(e)?(this.nextTask=null,this.run(e)):this.curTask=null}};function NT(r){return T(r)&&T(r.location)}function HT(r){return T(r)&&T(r.transformID)}var Es=tn("video")("vnd.dlsdc.ytdlp+json","ytdlp.json","ytdlp","json"),tf=tn("image")("vnd.google.streetview.pano");function nf(r){return r.hostname==="www.youtube.com"||r.hostname==="youtube.com"||r.hostname==="youtu.be"}var Mue=new Map([["vp9","vp09.00.10.08"]]);function kue(r){return fe(r.vcodec)||r.vcodec==="none"?"audio":"video"}function WT(r,t){let e=[r];if(T(t)&&t.length>0&&t!=="none"&&(t=Mue.get(t)||t),T(t)&&t.length>0&&t!=="none"){let n=encodeURI(t)!==t?"*":"";e.push(`codecs${n}="${t}"`)}return e.join(";")}var Xl=class{constructor(t,e){this.fetcher=t;this.makeProxyURL=e}makeVideoRecord(t){let{content_type:e,acodec:n,vcodec:i}=t;return{contentType:WT(e,i),url:this.makeProxyURL(t.url).href,acodec:n,abr:t.abr*1024,asr:t.asr,vcodec:i,vbr:t.vbr*1024,fps:t.fps,width:t.width,height:t.height,resolution:t.width*t.height}}makeAudioRecord(t){let{content_type:e,acodec:n}=t;return{contentType:WT(e,n),url:this.makeProxyURL(t.url).href,acodec:n,abr:t.abr*1024,asr:t.asr,resolution:t.abr}}makeImageRecord(t){let{content_type:e,url:n,width:i,height:o}=t;return{contentType:e,url:this.makeProxyURL(n).href,width:i,height:o,resolution:i*o}}async loadData(t,e){if(fe(t))throw new Error("must provide a YouTube URL or a YTMetadata object");T(e)&&e.start();let n=null;et(t)?n=await this.fetcher.get(t).progress(e).object().then(tt):(T(e)&&e.end(t.title),n=t);let i=0;if(T(n.original_url)){let w=new URL(n.original_url);nf(w)&&w.searchParams.has("t")&&(i=parseFloat(w.searchParams.get("t")))}let o=new gn((await Promise.all(n.formats)).map(w=>[kue(w),w])),s=n.title,l=n.thumbnails||[],c=n.thumbnail&&this.makeImageRecord(Mn(l,w=>w.url===n.thumbnail)),u=o.get("video").map(w=>this.makeVideoRecord(w)),p=o.get("audio").map(w=>this.makeAudioRecord(w));return{title:s,thumbnail:c,videos:u,audios:p,startTime:i}}};function Wv(r){return fe(r)?null:(et(r)&&(r=new URL(r,location.href)),r)}function UT(r){return fe(r)?!1:(r=Wv(r),nf(r))}function Uv(r){if(fe(r))throw new Error("URL is undefined");if(r=Wv(r),nf(r)){let t=Array.from(r.searchParams.keys()).filter(e=>e!=="v"&&e!=="t");for(let e of t)r.searchParams.delete(e)}return r}function _s(r){if(r=Wv(r),fe(r))throw new Error("URL is undefined");return r=Uv(r),new li("/vr/link",location.href).query("q",r.href).toURL()}var ql=class extends Ae{constructor(){super("selecting")}},rf=class extends Ae{constructor(e){super("urlselected");this.file=e}},Kl=class extends Ae{constructor(e){super("filedataselected");this.file=e}},of=class extends Ae{constructor(e,n){super("fileselected");this.file=e;this.mediaType=n}};var zv=class extends Ae{constructor(e){super("tagschanged");this.tags=e}},sf=Kn(on(100)),Yl=class extends qe{constructor(e,n,i,o){super();this._tags=new Array;this.element=De(fn("grid"),s0("row"),Kn(mr(10))),et(e)?(this.newTagName=gr(Ct("newTagName"),Pp(e),sf),this.addTagButton=yi(Ct("addTagButton"),sf,"Add"),this.removeTagButton=j0(Ct("removeTagButton"),sf,"Remove"),this.tagsList=fr(Ct("tagsList"),E0(!0),sf)):(this.newTagName=e,this.addTagButton=n,this.removeTagButton=i,this.tagsList=o,this.newTagName.replaceWith(this.element)),We(this.element,this.newTagName,this.addTagButton,this.tagsList,this.removeTagButton),this.addTagButton.disabled=!0,this.removeTagButton.disabled=!0,this.newTagName.addEventListener("input",()=>{this.addTagButton.disabled=this.newTagName.value.length===0});let s=()=>{this.newTagName.value.length>0&&this.updateTags(this.newTagName.value.toLocaleLowerCase(),null)};this.addTagButton.addEventListener("click",s),this.newTagName.addEventListener("keydown",md(s)),this.tagsList.addEventListener("input",()=>{this.removeTagButton.disabled=this.tagsList.selectedIndex===-1}),this.removeTagButton.addEventListener("click",()=>{if(this.tagsList.selectedIndex>-1){let l=this.tagsList.selectedOptions[0].value;this.updateTags(null,l)}})}updateTags(e,n){let i=new Array;e!==null&&(e=e.trim().toLocaleLowerCase(),e.length>0&&ri(i,e,!1));for(let o=0;o<this.tagsList.options.length;++o){let s=this.tagsList.options[o].value;s!==n&&ri(i,s,!1)}this.tags=i,this.dispatchEvent(new zv(i))}get tags(){return this._tags}set tags(e){Un(this._tags,...e),this._tags.sort(),Bt(this.tagsList),this.tagsList.append(...e.map(n=>Bn(hn(n),n))),this.newTagName.value="",this.addTagButton.disabled=this.removeTagButton.disabled=!0}};function Cue(r){return new Blob([r.href],{type:zc.value})}var af=class extends qe{constructor(e,n){super();this.fetcher=e;this.selectedType=null;this.selectedURL=null;this.typeFilters=new Array;this.accept=null;this.selectedName=null;this.checkingURL=!1;this.element=De(Ar.create(["File",this.urlInput=pF(Ut("Paste in URL to file"),Yo(!0)),this.loadingIndicator=Ui(fn("none"),zF.emojiStyle),this.selectionMessage=De()],["Copyright",this.copyrightInput=gr(Ct("copyright"),Ta("copyright"),Yo(!0))],["Copyright date",this.copyrightDateInput=Wp(Ct("copyrightDate"),Ta("copyrightDate"),Yo(!0))],["Tags",this.tagPicker=new Yl(n)]),this.uploadProgress=ef("progress"));let i=()=>this.refresh();this.urlInput.addEventListener("input",i),this.copyrightInput.addEventListener("input",i),this.copyrightDateInput.addEventListener("input",i);let o=new Gl(1);this.urlInput.addEventListener("input",()=>{if(this.urlInput.value.length>0&&!/^[a-z]+:\/\//.test(this.urlInput.value)){let{selectionStart:s,selectionEnd:l,selectionDirection:c}=this.urlInput,u="https://";this.urlInput.value=u+this.urlInput.value,this.urlInput.setSelectionRange(s+u.length,l+u.length,c)}this.hasURL&&(this.checkingURL=!0,st(this.loadingIndicator,!0,"inline-block"),o.throttle(async()=>{try{if(this.dispatchEvent(new ql),this.selectedURL=new URL(this.urlInput.value),UT(this.selectedURL)){this.selectedURL=Uv(this.selectedURL),this.urlInput.value=this.selectedURL.href;let s=this.selectedType=Es.value,l=_s(this.selectedURL),c=await this.fetcher.get(l).object().then(tt),u=this.selectedName=c.title,p=this.copyrightInput.value=c.uploader,f=c.upload_date.substring(0,4),w=c.upload_date.substring(4,6),A=c.upload_date.substring(6,8),m=this.copyrightDateInput.valueAsDate=new Date(`${f}/${w}/${A}`),d={filePath:l.href,mediaType:s,name:u,copyright:p,copyrightDate:m,size:null,sizeString:"--",id:null,tagsString:null,metadata:c};this.dispatchEvent(new Kl(d))}else{let s=await this.fetcher.head(_s(this.selectedURL)).exec(),l=this.selectedURL.pathname.split("/");this.copyrightInput.value=this.selectedURL.hostname,this.copyrightDateInput.valueAsDate=s.date,this.selectedName=s.fileName||l[l.length-1],this.selectedType=s.contentType,this.dispatchEvent(new rf(this.selectedURL))}this.checkingURL=!1,this.refresh()}catch{this.selectedType=null,this.checkingURL=!1,this.refresh("Not a valid target")}})),this.refresh()})}clearFileSelection(e){this.uploadProgress.clear(),this.selectedType=null,this.urlInput.value=null,this.copyrightInput.value=null,this.copyrightDateInput.value=null,this.tagPicker.tags=e,this.refresh()}addMessage(e){We(this.selectionMessage,De(e))}refresh(e){Bt(this.selectionMessage),et(e)?this.addMessage(e):this.hasURL&&!this.checkingURL&&!this.hasType?this.addMessage("No file found at give location"):this.hasType&&!this.hasCorrectType&&this.addMessage(`Unexpected file type: ${this.selectedType}. Expected: ${this.accept}`),this.hasCopyright||this.addMessage("Copyright holder is required"),this.hasCopyrightDate||this.addMessage("Copyright date is required"),st(this.loadingIndicator,this.checkingURL),this.dispatchEvent(new jl)}setTypeFilters(...e){Un(this.typeFilters,...e),this.accept=Ba(e)}isExpectedType(e){return fe(e)?!1:this.typeFilters.length===0?!0:this.typeFilters.map(n=>n.matches(e)).reduce((n,i)=>n||i,!1)}get tagString(){return this.tagPicker.tags.join()}get hasURL(){return this.urlInput.validity.valid}get hasFile(){return T(this.selectedURL)}get hasType(){return T(this.selectedType)}get hasCorrectType(){return this.isExpectedType(this.selectedType)}get hasCopyright(){return this.copyrightInput.value.length>0}get hasCopyrightDate(){return this.copyrightDateInput.validity.valid}get requirementsMet(){return this.hasURL&&this.hasFile&&this.hasCorrectType&&this.hasCopyright&&this.hasCopyrightDate}async upload(){try{let e=new FormData,n=Cue(this.selectedURL);return e.set("FormFile",n,this.selectedName),e.set("AltContentType",this.selectedType),e.set("Copyright",this.copyrightInput.value),e.set("CopyrightDate",this.copyrightDateInput.valueAsDate.toDateString()),e.set("TagString",this.tagString),await this.fetcher.post("/editor/files/create").body(e).progress(this.uploadProgress).object().then(tt)}catch(e){throw console.error(e),e}}};function ga(r){let t=r;for(;t&&t.tagName!=="TD"&&t.tagName!=="TH";)t=t.parentElement;if(t){let e=t.parentElement,n=0;for(let i of e.children){if(i===t)return n;i instanceof HTMLTableCellElement&&(n+=i.colSpan)}}return-1}function Jl(r,t){let e=0;Rt(r)?e=r:t=r;let n=!0;return(...i)=>{n&&(n=!1,setTimeout(()=>{n=!0,t(...i)},e))}}function XT(r){if(/^\d{4}-\d\d?-\d\d?$/.test(r)){var t=r.split("-"),e=t.shift();t.push(e),r=t.join("/")}return new Date(r)}function zT(r){return r.classList.contains("range-start")}function Due(r){return r.classList.contains("range-end")}function jv(r,t){return r instanceof HTMLInputElement&&(r.type.startsWith("date")||r.type.startsWith("time")||r.type.startsWith("month")||r.type.startsWith("week"))?t&&XT(t)||null:r instanceof HTMLInputElement&&(r.type==="number"||r.type==="range")?t&&parseFloat(t)||null:t&&t.toLocaleLowerCase()||null}function jT(r,t){let e=Array.from(r.querySelectorAll("input"));if(e.length===0){let n=r.textContent.trim();return[jv(t,n)]}else return e.map(n=>jv(n,n.value))}var GT=[10,25,50,100],Ql=class{constructor(t){this.element=t;this.ranges=new Map;this.valueCache=new Map;this.resetButton=null;this.cellMappers=new Map;this.pageSizes=[0,...GT];this.update=Jl(this._update.bind(this)),this.resourceName=this.element.dataset.resourcename,this.pageIndexKey=`${this.resourceName}-page-index`,this.pageSizeKey=`${this.resourceName}-page-size`,this.rows=Array.from(this.element.querySelectorAll("tbody > tr")),this.ranges=new Map,this.element.tHead?(this.filterElements=[...this.element.tHead.querySelectorAll("input,select")],this.resetButton=this.element.tHead.querySelector("button[type=reset]")):this.filterElements=[],this.colCount=Math.max(...Array.from(this.element.querySelectorAll("tr")).map(e=>e.children.length)),this.noContentMessageElement=Ia(Hp(Bg(this.colCount),"No content")),this.paginator=Hp(Bg(this.colCount),Ne("multi")),this.columnIndices=new Map,this.resetButton&&this.resetButton.addEventListener("click",()=>{this.valueCache.clear();for(let e of this.filterElements)this.deleteValue(e),e.value="";this.update()}),this.element.tFoot||(this.element.tFoot=sF()),We(this.element.tFoot,this.noContentMessageElement,...this.element.tFoot.children,Ia(this.paginator));for(let e of this.filterElements){let n=ga(e);if(this.columnIndices.set(e,n),e.addEventListener("input",this.update.bind(null,e)),this.restoreValue(e),zT(e)||Due(e)){this.ranges.has(n)||this.ranges.set(n,[null,null]);let i=this.ranges.get(n),o=zT(e)?0:1;i[o]=e}}for(let e of this.element.querySelectorAll("input"))e.classList.add("form-control","form-control-sm");for(let e of this.element.querySelectorAll("select"))e.classList.add("custom-select","custom-select-sm");if(this.pageIndex=parseFloat(localStorage.getItem(this.pageIndexKey)||"0"),this.pageSize=parseFloat(localStorage.getItem(this.pageSizeKey)||"10"),T(this.element.dataset.pagesizes)&&this.element.dataset.pagesizes.length>0){let e=this.element.dataset.pagesizes.split(",").map(n=>parseFloat(n.trim())).filter(Rr);this.setPageSizes(e)}else this.update()}static create(t){let e=Ia(),n=Ia(),i=0,o=0;for(let c of t.columns){let u=null;if(i>0)--i;else{let p=Hc(c.header);c.filter&&(u=xr(10),p.htmlFor=u);let f=La(p);T(c.headerColSpan)&&(f.colSpan=c.headerColSpan,i=c.headerColSpan-1),e.appendChild(f)}if(o>0)--o;else if(c.filter){let p=c.filter;u&&(p.id=u),c.header&&p instanceof HTMLInputElement&&(p.placeholder="Filter by "+c.header);let f=La(p);T(c.filterColSpan)&&(f.colSpan=c.filterColSpan,o=c.filterColSpan-1),n.appendChild(f)}}let s=ga(e.lastElementChild)-1;for(;ga(n.lastElementChild)<s;)n.appendChild(La());for(n.appendChild(La(G0(Ne("btn","btn-secondary"),"Reset"))),s=ga(n.lastElementChild);s>ga(e.lastElementChild);)e.appendChild(La());let l=new Ql(iF(Ne("table","table-responsive","table-hover","table-striped","summary"),kn("resourcename",t.resourceName),aF(e,n),oF()));return t.columns.forEach((c,u)=>l.setCellMapper(u,c.getCellValue)),l.setPageSizes(t.pageSizes||GT),l}get pageIndex(){return this._pageIndex}set pageIndex(t){this._pageIndex=t,localStorage.setItem(this.pageIndexKey,t.toString())}get pageSize(){return this._pageSize}set pageSize(t){this._pageSize=t,localStorage.setItem(this.pageSizeKey,t.toString())}setPageSizes(t){if(fe(t)||t.length===0)throw new un("Need at least one page size");Un(this.pageSizes,0,...t),this.pageSize=this.pageSizes[1],this.update()}setCellMapper(t,e){this.cellMappers.set(t,e)}clear(){ct(this.rows);for(let t of this.element.tBodies)Bt(t);this._update()}setValues(...t){let e=t.map(n=>{let i=Ia();for(let o=0;o<this.colCount;++o){let s=Hp();this.cellMappers.has(o)&&We(s,this.cellMappers.get(o)(n,i)),i.appendChild(s)}return this.rows.push(i),i});Un(this.rows,...e);for(let n of this.element.tBodies)Bt(n);We(this.contentRoot,...this.rows),this._update()}select(t){let e=null;for(let n=0;n<this.rows.length;++n){let i=this.rows[n],o=i===t;jn(i,o,"selected"),o&&(e=n)}e!==null&&(this.pageIndex=Math.floor(e/this.pageSize)*this.pageSize,this.update())}get noContentMessage(){return N0(this.noContentMessageElement)}set noContentMessage(t){Ye(this.noContentMessageElement,t)}get contentRoot(){return this.element.tBodies[0]}makeKey(t){return`yarrow:${this.resourceName}:${t.id}`}saveValue(t,e){let n=this.makeKey(t);e?localStorage.setItem(n,e.toString()):localStorage.removeItem(n)}deleteValue(t){let e=this.makeKey(t);localStorage.removeItem(e)}restoreValue(t){let e=this.makeKey(t),n=localStorage.getItem(e);if(!T(n))t.value="";else if(t instanceof HTMLSelectElement)t.value=n,this.valueCache.set(t,t.value);else if(t.type.startsWith("date")){let i=XT(n);t.valueAsDate=i,this.valueCache.set(t,i)}else if(t.type==="number"||t.type==="range"){let i=parseFloat(n);t.valueAsNumber=i,this.valueCache.set(t,i)}else t.value=n,this.valueCache.set(t,t.value)}isRange(t){let e=ga(t);return this.ranges.has(e)}_update(t=null){if(T(t)){let E=jv(t,t.value);this.saveValue(t,E),E?this.valueCache.set(t,E):this.valueCache.delete(t)}this.resetButton&&(Qo(this.resetButton,this.valueCache.size>0,"Reset","Clear out filters"),jn(this.resetButton,this.valueCache.size>0,"btn-secondary"),jn(this.resetButton,this.valueCache.size===0,"btn-outline-secondary"));let e=0;for(let E=0;E<this.rows.length;++E){let b=this.rows[E],g=!0;for(let v=0;v<this.filterElements.length&&g;++v){let y=this.filterElements[v],V=this.columnIndices.get(y);if(this.isRange(y)){let[B,D]=this.ranges.get(V),L=this.valueCache.get(B),J=this.valueCache.get(D),ae=b.children[V],Q=jT(ae,B),ee=null;if(T(L)&&T(J)?ee=Q.map(K=>L<=K&&K<=J):T(L)?ee=Q.map(K=>L<=K):T(J)&&(ee=Q.map(K=>K<=J)),ee){let K=ee.reduce(($,te)=>$||te,!1);g&&=K}}else{let B=this.valueCache.get(y);if(B){let D=b.children[V],ae=jT(D,y).map(Q=>fe(Q)?!0:jo(Q)?B.getTime()===Q.getTime():Rt(Q)?Q===B:B==="XXX_NONE_XXX"?Q.length===0||Q==="NONE":y.classList.contains("exact")?Q.toLocaleLowerCase()===B:Q.toLocaleLowerCase().indexOf(B)>-1).reduce((Q,ee)=>Q||ee,!1);g&&=ae}}}g&&++e,b.style.display=g?"":"none"}let n=Math.ceil(e/this.pageSize),i=Math.max(0,n-1),o=Math.min(i,Math.floor(this.pageIndex/this.pageSize));this.pageIndex=o*this.pageSize;let s=Math.min(i,o+1),l=Math.max(0,o-1),c=o*this.pageSize,u=c+this.pageSize,p=this.rows.filter(E=>E.style.display!=="none");for(let E=0;E<p.length;++E)(E<c||u<=E)&&(p[E].style.display="none");this.noContentMessageElement.style.display=e===0?"":"none",Bt(this.paginator);let f=[],w=E=>ri(f,E,!1);w(0),w(o),w(l),w(s),w(i);let A=i*this.pageSize,m=Math.max(0,this.pageIndex-this.pageSize),d=(E,b)=>{let g;return b?g=z0(E):g=Ui(Sa(yr(5),yr(10)),E),this.paginator.append(g),g},h=(E,b)=>{let g=0<=b&&b<=A&&b!==this.pageIndex,v=d(E,g);g&&v.addEventListener("click",()=>{this.pageIndex=b,this.update()})},M=E=>{let b=E!==this.pageSize,g=d(E.toString(),b);b&&g.addEventListener("click",()=>{this.pageSize=E,this.update()})};h("<",m);let k=-1;for(let E of f){let b=E-k;k=E,b>1&&d("...",!1),h((E+1).toFixed(0),E*this.pageSize)}if(h(">",u),d("|",!1),d(`${e} filtered items of ${this.rows.length} results`,!1),this.pageSizes.length>2){d("|",!1),d("Items per page:",!1);for(let E=1;E<this.pageSizes.length;++E)this.rows.length>this.pageSizes[E-1]&&M(this.pageSizes[E])}}};var Gv=class extends Ae{constructor(){super("searching")}},Xv=class extends Ae{constructor(){super("searchcomplete")}},lf=class extends qe{constructor(e,n){super();this.fetcher=e;this.typeFilters=new Array;this.selectors=new Array;this.rows=new Map;this._selectedFile=null;this.tagFilter=null;this.typeFilter=null;this.table=Ql.create({resourceName:"file-picker",columns:[{header:"ID",filter:Vr(),getCellValue:i=>i.id.toFixed(0)},{header:"Name",filter:gr(),getCellValue:i=>i.name},{header:"Type",filter:this.typeSelector=fr(),getCellValue:i=>i.mediaType},{header:"Tags",filter:gr(Pp(n)),getCellValue:i=>i.tagsString},{header:"Size",getCellValue:i=>i.sizeString},{getCellValue:(i,o)=>{let s=er("Select",pt(()=>this.selectFile(s,i)));return this.selectors.push(s),this.rows.set(s,o),s}}]})}get element(){return this.table.element}get selectedFile(){return this._selectedFile}get hasFile(){return T(this._selectedFile)}upload(){return Promise.resolve(this.selectedFile)}get requirementsMet(){return this.hasFile}setTypeFilters(...e){Un(this.typeFilters,...e),this.typeFilter=Ba(this.typeFilters),Bt(this.typeSelector),We(this.typeSelector,Bn(hn(""),"--"),...this.typeFilters.map(n=>Bn(hn(n.value),n.value)))}clearFileSelection(e){this.tagFilter=e.join(),this.selectFile(null,null)}search(e){return this.tagFilter=e,this.update()}async update(){this.dispatchEvent(new Gv),ct(this.selectors),this.rows.clear();let e={typeFilter:this.typeFilter,tagFilter:this.tagFilter};this.table.noContentMessage="Searching...",this.table.clear();let n=await this.fetcher.post("/Editor/Files/Search").body(e,wo).object().then(tt);this.table.noContentMessage="No content.",this.table.setValues(...n),this.dispatchEvent(new Xv)}selectFile(e,n){this._selectedFile=n;for(let i of this.selectors){let o=this.rows.get(i),s=e===i;jn(o,s,"selected"),i.disabled=s}this._selectedFile&&(this.dispatchEvent(new ql),this.dispatchEvent(new Kl(this._selectedFile)))}};var cf=_r("Juniper:TSLib:MediaTypeDB",()=>{let r=new Map;function t(s){if(!s)return console.warn("Couldn't guess media type. Must provide a valid fileName."),[];let l=s.lastIndexOf(".");if(l===-1)return console.warn("Couldn't guess media type. FileName has no extension."),[];let c=s.substring(l);return c?c[0]=="."&&(c=c.substring(1)):c="unknown",r.has(c)?r.get(c):[new Ti("unknown",c,[c])]}function e(s,l){if(!l&&s.indexOf(".")>-1){let c=t(s);c.length>0&&(l=c[0].value)}return l}function n(s){let l=!1,c=s.__getValueUnsafe();if(s=_r("Juniper.MediaTypes:"+c,()=>(l=!0,s)),l)for(let u of s.__getExtensionsUnsafe()){r.has(u)||r.set(u,new Array);let p=r.get(u);p.indexOf(s)<0&&p.push(s)}return s}let i={normalizeFileType:e};function o(s){Object.values(s).forEach(n)}return o(Ug),o(zg),o(jg),o(Gg),o(Xg),o(qg),o(Kg),o(Yg),o($g),o(rx),o(ix),o(ox),i});var qv=class extends Ae{constructor(e){super("input");this.files=e}},uf=class extends qe{constructor(e,n,i,o=null){super();this.file=i;this.typeFilters=new Array;this.element=null;this._dragTarget=null;let s=u=>Array.from(u).filter(p=>this.typeFilters.length===0||this.typeFilters.filter(f=>f.matches(p.type)).length>0),l=u=>Array.from(u).filter(p=>p.kind=="file"&&(this.typeFilters.length===0||this.typeFilters.filter(f=>f.matches(p.type)).length>0));this.onDragOver=u=>{this.enabled&&(l(u.dataTransfer.items).length>0?Ye(this.element,"Drop file..."):Ye(this.element,"No files matching expected type(s)")),u.preventDefault()},this.onDragEnd=u=>{this.enabled&&Ye(this.element,e),u.preventDefault()},this.onDrop=u=>{this.enabled&&c(u.dataTransfer.files),this.onDragEnd(u)};let c=u=>{let p=s(u);p.length>0&&this.dispatchEvent(new qv(p))};this.file.style.display="none",this.file.insertAdjacentElement("afterend",this.element=oi(Ne("btn",`btn-${n}`),pt(()=>this.show()),e)),this.dragTarget=o||this.element,this.file.addEventListener("input",()=>c(this.file.files)),this.setTypeFilters(),this.enabled=!0}get dragTarget(){return this._dragTarget}set dragTarget(e){e!==this.dragTarget&&(this.dragTarget&&(this.dragTarget.removeEventListener("dragover",this.onDragOver),this.dragTarget.removeEventListener("dragend",this.onDragEnd),this.dragTarget.removeEventListener("dragleave",this.onDragEnd),this.dragTarget.removeEventListener("drop",this.onDrop)),this._dragTarget=e,this.dragTarget&&We(this.dragTarget,Ka(this.onDragOver),xA(this.onDragEnd),qa(this.onDragEnd),xd(this.onDrop)))}show(){this.file.showPicker?this.file.showPicker():this.file.click()}setTypeFilters(...e){Un(this.typeFilters,...e),this.file.accept=Ba(e)}isExpectedType(e){return fe(e)?!1:this.typeFilters.length===0?!0:this.typeFilters.map(n=>n.matches(e)).reduce((n,i)=>n||i,!1)}get accept(){return this.file.accept}get enabled(){return!this.file.disabled}set enabled(e){this.file.disabled=!e,this.element.disabled=!e}get disabled(){return!this.enabled}set disabled(e){this.enabled=!e}get files(){return this.file.files}clear(){this.file.value=null}};var pf=class extends qe{constructor(e,n){super();this.fetcher=e;this.selectedFile=null;this.selectedType=null;this.element=De(Ar.create(["File",this.picker=new uf("Upload new file","primary",cF(Yo(!0))),this.selectionMessage=De()],["Copyright",this.copyrightInput=gr(Ct("copyright"),Ta("copyright"),Yo(!0))],["Copyright date",this.copyrightDateInput=Wp(Ct("copyrightDate"),Ta("copyrightDate"),Yo(!0))],["Tags",this.tagPicker=new Yl(n)]),this.uploadProgress=ef("progress")),this.picker.dragTarget=this.element,this.picker.addEventListener("input",async o=>{o.files.length>0&&(this.selectedFile=o.files[0],this.selectedType=this.selectedFile.type,(fe(this.selectedType)||this.selectedType.length===0)&&(this.selectedType=cf.normalizeFileType(this.selectedFile.name,this.selectedType)),this.refresh(),this.dispatchEvent(new of(this.selectedFile,this.selectedType)))});let i=this.refresh.bind(this);this.copyrightInput.addEventListener("input",i),this.copyrightDateInput.addEventListener("input",i)}setTypeFilters(...e){this.picker.setTypeFilters(...e)}get accept(){return this.picker.accept}addMessage(e){We(this.selectionMessage,De(e))}refresh(){Bt(this.selectionMessage),this.hasType&&!this.hasCorrectType&&this.addMessage(`Unexpected file type: ${this.selectedType}. Expected: ${this.picker.accept}`),this.hasCopyright||this.addMessage("Copyright holder is required"),this.hasCopyrightDate||this.addMessage("Copyright date is required"),this.dispatchEvent(new jl)}clearFileSelection(e){this.uploadProgress.clear(),this.selectedType=null,this.picker.clear(),this.copyrightInput.value=null,this.copyrightDateInput.value=null,this.tagPicker.tags=e,this.refresh()}get tagString(){return this.tagPicker.tags.join(",")}get hasFile(){return T(this.selectedFile)}get hasType(){return T(this.selectedType)}get hasCorrectType(){return this.picker.isExpectedType(this.selectedType)}get hasCopyright(){return this.copyrightInput.value.length>0}get hasCopyrightDate(){return this.copyrightDateInput.validity.valid}get requirementsMet(){return this.hasFile&&this.hasCorrectType&&this.hasCopyright&&this.hasCopyrightDate}upload(){let e=new FormData;return e.set("FormFile",this.selectedFile,this.selectedFile.name),e.set("Copyright",this.copyrightInput.value),e.set("CopyrightDate",this.copyrightDateInput.valueAsDate.toDateString()),e.set("TagString",this.tagString),this.fetcher.post("/editor/files/create").body(e).progress(this.uploadProgress).object().then(tt)}};var h1=K1(wE(),1);var d1="2.16.105";var op=class extends un{constructor(){super("Cancellation!")}},Vo=class{constructor(){this._cancelled=!1}get cancelled(){return this._cancelled}check(){if(this.cancelled)throw new op}cancel(){this._cancelled=!0}dispose(){throw new Error("Method not implemented.")}};var sp=_r("Juniper:PdfReady",()=>new mt(!1)),Vi=class extends no{constructor(e,n){super(1,1);this.viewportParams=n;this.pdf=null;this._curPageIndex=null;this.ready=this.load(e)}static async prepare(e,n,i,o,s){let l=null;if(o instanceof Vo?l=o:s=o,l=l||new Vo,!sp.started){sp.start(),console.info(`PDF.js v${d1}`);let c=new li(e,location.href);c.query("v",d1),e=c.toString(),h1.default.GlobalWorkerOptions.workerSrc=await n.get(e).useCache(!i).progress(s).file().then(tt),l.check(),sp.resolve()}await sp,l.check()}get curPageIndex(){return this._curPageIndex}get curPageNumber(){return this.curPageIndex+1}get canGoBack(){return this._curPageIndex>0}get canGoForward(){return this._curPageIndex<this.numPages-1}async load(e){await sp;let n=h1.default.getDocument(e);if(this.pdf=await n.promise,this.pdf.numPages===0)throw new Error("No pages found in PDF")}async getPage(e){if(await this.ready,e=vr(e,0,this.pdf.numPages-1),e!==this._curPageIndex){this._curPageIndex=e;let n=await this.pdf.getPage(e+1),i=n.getViewport(this.viewportParams);Jc(this.g,i.width,i.height),await n.render({canvasContext:this.g,viewport:i,intent:"print"}).promise,this.dispatchEvent(this.redrawnEvt)}}get numPages(){return this.pdf?this.pdf.numPages:null}onRedraw(){return!1}};function ap(r){return new URL(URL.createObjectURL(r))}function m1(r){let t=new Map;for(let[e,n]of r)t.set(n,e);return t}function Lue(r){return r!=="B"&&r[1]==="i"}function vE(r){return r!=="B"&&!vE(r)}var FE=new Map([[1,"KiB"],[2,"MiB"],[3,"GiB"],[4,"TiB"]]),AE=new Map([[1,"KB"],[2,"MB"],[3,"GB"],[4,"TB"]]),Iue=m1(FE),Rue=m1(AE),Bue=new Map([[2,FE],[10,AE]]);function bE(r,t=10){let e=r<0;r=Math.abs(r);let n=t===2?1024:1e3,i=Math.min(4,Math.floor(Math.log(r)/Math.log(n))),o=Math.pow(n,i);2*r>=n*o&&i<4&&(i++,o*=n);let s;i===0?s="B":(s=Bue.get(t).get(i),r/=o);let l=r%1===0;return`${e?"-":""}${r.toFixed(l?0:2)} ${s}`}function SE(r,t){if(t==="B")return r;{let e,n;Lue(t)?(e=1024,n=Iue.get(t)):vE(t)?(e=1e3,n=Rue.get(t)):Ot(t);let i=Math.pow(e,n);return r*i}}var yE="wait",Vue="pointer",Oue="not-allowed",lp=class extends Mo{constructor(e,n){super("video-player",e,n);this.element=De(fn("inline-block"),this.thumbnail=tr(Sp(yE)),this.video,this.audio),this.thumbnail.addEventListener("click",()=>{this.loaded&&this.play()}),this.addEventListener("played",()=>this.showVideo(!0)),this.addEventListener("stopped",()=>this.showVideo(!1)),this.showVideo(!1)}onDisposing(){super.onDisposing(),T(this.element.parentElement)&&this.element.remove()}showVideo(e){st(this.video,e,"inline-block"),st(this.thumbnail,!e,"inline-block")}async load(e,n){try{We(this.thumbnail,Ep(.5),Sp(yE));let i=Gt(n,[1,10]);return await An(super.load(e,i.shift()),this.loadThumbnail(e,i.shift())),this}finally{We(this.thumbnail,Ep(1),Sp(this.loaded?Vue:Oue))}}clear(){super.clear(),this.thumbnail.src=""}setTitle(e){super.setTitle(e),this.thumbnail.title=e}async loadThumbnail(e,n){if(n.start(),T(e)){We(this.thumbnail,Zn(e.thumbnail.url),Ep(.5));let i=dn(this.thumbnail,"load","error");await Si(i)}n.end()}};function Nue(r,t){st(po,!0,"block"),st(_E,!t,"block"),st(ME,t,"block");let e=r.src.match(/\/file\/(\d+)$/);if(t&&e){let n=parseInt(e[1],10);ME.src=`/Editor/PhotosphereViewer?FileID=${n}`}else _E.src=r.src}function TE(){po.style.display="none"}var EE=new WeakSet;function kE(){let r=Array.from(document.querySelectorAll(".thumbnail"));for(let t of r)EE.has(t)||(t.addEventListener("click",()=>Nue(t,t.classList.contains("photosphere"))),EE.add(t))}var CE="33D0371F-B096-473D-AEE3-B17F5392CCEC",po=document.getElementById(CE);po||(po=De(Ct(CE),Xe("thumbnail-view"),fn("none"),tr(Er("Thumbnail")),Da(Er("Preview"))));var _E=po.querySelector("img"),ME=po.querySelector("iframe");po.parentElement||(We(document.body,po),po.addEventListener("pointerleave",TE),po.addEventListener("click",TE));var Hue=Va("audio","*"),Wue=Va("image","*"),Uue=Va("text","*"),zue=Va("video","*"),xf=class{constructor(t,e,n){this.element=t;this.fetcher=e;this.audioSys=n;Vi.prepare(Hs("pdfjs"),e,!0),this.yt=new Xl(this.fetcher,_s);let i=this.audioSys;if(i instanceof dl){let s=new vl(i.destination);this.vid=new lp(i,s),this.aud=new yl(i,s)}else this.vid=new lp(i.audio.context,i.audio.noSpatializer),this.aud=i.audioPlayer,i=i.audio.context;let o=this.element.dataset.json;if(T(o)){let s=JSON.parse(o);this.setFile(s,...s.tagsString.split(",").map(l=>l.trim().toLowerCase()))}}get hasFile(){return this._hasFile}showLoading(){this.setElement(De("Loading"),"Loading","Loading",null)}async setFile(t,...e){this.showLoading();let n=null,i=null,o=null,s=null,l=null;if(t instanceof URL){let u=await this.fetcher.get(_s(t)).file();n=u.content,o=u.fileName??t.href,i=u.contentType,s=u.contentLength}else t instanceof File?(n=URL.createObjectURL(t),o=t.name,i=t.type,s=t.size):(n=t.filePath,o=t.name,i=t.mediaType,s=t.size,l=t.metadata);(fe(i)||i.length===0)&&(i=cf.normalizeFileType(o,i));let c=null;if(Es.matches(i)){let u=await this.yt.loadData(l||n);fe(u.videos)||u.videos.length===0?c=await this.aud.load(u):c=await this.vid.load(u)}else Jg.matches(i)||zc.matches(i)?c=this.makeIFrame(n):vo.matches(i)?c=await this.makePDF(n):Hue.matches(i)?c=this.makeAudio(n):zue.matches(i)?c=this.makeVideo(n):Wue.matches(i)?c=this.makeImage(n):Uue.matches(i)||Oa.matches(i)||Ei.matches(i)?c=await this.makeText(n):c=await this.makeUnknown(n);this.setElement(c,i,o,s,...e)}clear(){Bt(this),this._hasFile=!1}makeAudio(t){return ii(Br(!0),Zn(t))}makeVideo(t){return Is(Br(!0),Zn(t))}async makeText(t){let e=await this.fetcher.get(t).text().then(tt);return zi(e)}async makePDF(t){let e=new Vi(t,{scale:1.44});await e.getPage(0);let n=await Fo(e.canvas,Gi),i=ap(n);return tr(Ne("thumbnail","image"),Zn(i))}makeImage(t){return tr(Ne("thumbnail","image"),Zn(t))}makeUnknown(t){return De(`Cannot preview file at path: ${t}`)}makeIFrame(t){return Da(Zn(t))}setElement(t,e,n,i,...o){t=sn(t),this._hasFile=t.tagName!=="DIV",Bt(this),We(this,Np(n),De(i&&`${e}: ${bE(i)}`||""),We(t,Ne(...o))),(t.tagName==="IMG"||t.tagName==="CANVAS")&&kE()}};var wf="existingTags",vf=class extends Hr{constructor(e,n){super("File Upload");this.fetcher=e;this.tags=new Array;this._selectedFile=null;this.element.classList.add("file-picker"),this.preview=new xf(De(Xe("preview")),this.fetcher,n),We(this.contentArea,this.existingTags=X0(Ct(wf)),this.tabs=co.create(["upload-file","Upload new file",this.uploadTab=new pf(this.fetcher,wf)],["link-file","Link to file",this.linkTab=new af(this.fetcher,wf)],["pick-file","Pick existing file",this.selectTab=new lf(this.fetcher,wf)]),this.preview);let i=()=>this.refresh(),o=()=>this.preview.showLoading(),s=l=>this.preview.setFile(l.file,...this.tags);this.uploadTab.addEventListener("refresh",i),this.linkTab.addEventListener("refresh",i),this.linkTab.addEventListener("selecting",o),this.selectTab.addEventListener("selecting",o),this.uploadTab.addEventListener("fileselected",s),this.linkTab.addEventListener("filedataselected",s),this.linkTab.addEventListener("urlselected",s),this.selectTab.addEventListener("filedataselected",l=>{i(),s(l)}),this.selectTab.addEventListener("searching",()=>{this.confirmButton.disabled=!0,this.cancelButton.disabled=!0}),this.selectTab.addEventListener("searchcomplete",()=>{this.confirmButton.disabled=!this.canConfirm,this.cancelButton.disabled=!1}),this.tabs.addEventListener("tabselected",this.clearFileSelection.bind(this)),this.getTags()}get selectedFile(){return this._selectedFile}setTags(...e){Un(this.tags,...e),this.tags.sort()}setTypeFilters(...e){this.uploadTab.setTypeFilters(...e),this.linkTab.setTypeFilters(...e),this.selectTab.setTypeFilters(...e)}async getTags(){let e=await this.fetcher.get("/editor/files/tags").object().then(tt);Bt(this.existingTags),this.existingTags.append(...e.map(n=>Bn(hn(n),n)))}clearFileSelection(){this.preview.clear(),this.uploadTab.clearFileSelection(this.tags),this.linkTab.clearFileSelection(this.tags),this.selectTab.clearFileSelection(this.tags)}onShown(){super.onShown(),this.clearFileSelection(),this.tabs.select("upload-file"),this.selectTab.search(this.tags.join())}async onConfirm(){this.confirmButton.disabled=!0,this._selectedFile=await this.currentTab.upload(),super.onConfirm()}onClosed(){this.clearFileSelection(),this.preview.clear(),this.getTags(),super.onClosed()}get isUploading(){return this.tabs.isSelected("upload-file")}get isLinking(){return this.tabs.isSelected("link-file")}get isSelecting(){return this.tabs.isSelected("pick-file")}get currentTab(){return this.isUploading&&this.uploadTab||this.isLinking&&this.linkTab||this.isSelecting&&this.selectTab}get canConfirm(){return this.currentTab.requirementsMet}refresh(){let e=this.canConfirm?"Confirm":this.isUploading?"Upload requirements not met":this.isLinking?"Link requirements not met":"No file choice made";Qo(this.confirmButton,this.canConfirm,e,e)}};var gi=class extends Et{constructor(e){super();this.M=new Vt;this.data=e,this.name=e.name,this.M.fromArray(e.matrix),this.M.decompose(this.position,this.quaternion,this.scale)}get transformID(){return this.data.id}};var f1=class extends Ae{constructor(e,n){super("itemevicted");this.key=e;this.value=n}},Ff=class extends qe{constructor(e){super();this.size=e;this.map=new Map;this.usage=new Array;this.removed=new Map}set(e,n){for(this.usage.push(e);this.usage.length>this.size;){let i=this.usage.shift();T(i)&&(this.removed.set(i,this.map.get(i)),this.map.delete(i))}this.removed.delete(e);for(let[i,o]of this.removed)this.dispatchEvent(new f1(i,o));return this.removed.clear(),this.map.set(e,n)}has(e){return this.map.has(e)}get(e){return this.map.get(e)}delete(e){return this.map.has(e)?(Wt(this.usage,e),this.map.delete(e)):!1}clear(){ct(this.usage),this.map.clear()}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}};function Oo(r,t,e){let n=t.map(()=>1),i=Gt(r,n);return Promise.all(t.map(async(o,s)=>{let l=i[s];l.start();let c=await e(o,l,s);return l.end(),c}))}var cp=2,ec=2048,tc=new Yi;var jue=new Map([[90,4],[60,8],[45,3],[30,2]]),DE=[[bn,0,0,1],[-bn,0,2,1],[0,bn,1,0],[0,-bn,1,2],[xn,0,3,1],[0,0,1,1]],Af=class{constructor(t,e){this.fetcher=t;this.fixWatermarks=e;this.baseURL=null;this.isDebug=!1;this.disposed=!1;this.canvas=Mi(ec,ec),this.renderer=new Rd({canvas:this.canvas,alpha:!1,antialias:!1,depth:!0,logarithmicDepthBuffer:!1,powerPreference:"low-power",precision:"lowp",stencil:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1}),this.camera=new js(90),this.photosphere=new Ja,this.scene=je(new Za,new yd(16777215,1),this.camera,this.photosphere),this.geometry=new Qa(1,1,1,1)}init(t,e){this.baseURL=t,this.isDebug=e}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){for(let t of this.scene.children)St(t);zt(this.renderer)}async renderFaces(t,e,n){this.clear(),await this.loadFrames(e,n,t);let i=await Promise.all(DE.map(async([o,s,l,c])=>{let u=Bi.rotations[c][l];tc.set(s,o,u,"YXZ"),this.camera.setRotationFromEuler(tc),this.renderer.render(this.scene,this.camera);let p=await Fo(this.renderer.domElement,ji.value,1);return URL.createObjectURL(p)}));return this.clear(),i}async renderCubeMap(t,e,n){this.clear();let i=Mi(ec*4,ec*3),o=i.getContext("2d",{alpha:!1});await this.loadFrames(e,n,t);for(let[c,u,p,f]of DE)tc.set(u,c,0,"YXZ"),this.camera.setRotationFromEuler(tc),this.renderer.render(this.scene,this.camera),o.drawImage(this.renderer.domElement,p*ec,f*ec);let s=await Fo(i,ji.value,1),l=URL.createObjectURL(s);return this.clear(),l}getImageAngles(t){let e=new Array,n=t,i=this.fixWatermarks?jue.get(n):0;for(let o=-90+n;o<90;o+=n)for(let s=-180;s<180;s+=n)e.push([s,o,n+i,cp]);return e.push([0,-90,n+i,cp]),e.push([0,90,n+i,cp]),this.fixWatermarks&&(e.push([0,-90,n,.5*cp]),e.push([0,90,n,.5*cp])),e}async loadFrames(t,e,n){let i=this.getImageAngles(t);await Oo(e,i,(o,s)=>this.loadFrame(n,...o,s))}async loadFrame(t,e,n,i,o,s){let l=.5*at(i),c=Math.tan(l),u=.5*o/c,p=t(i,e,n),f=await this.fetcher.get(p,this.baseURL).progress(s).useCache(!this.isDebug).canvas().then(tt),w=new Gs(f),A=new ir({map:w,side:_d}),m=Di(`frame-${i}-${e}-${n}`,this.geometry,A);w.needsUpdate=!0,A.needsUpdate=!0,tc.set(at(n),-at(e),0,"YXZ"),m.scale.setScalar(o),m.quaternion.setFromEuler(tc),m.position.set(0,0,-u).applyQuaternion(m.quaternion),je(this.photosphere,m)}clear(){for(let t of this.photosphere.children)St(t);this.photosphere.clear()}};var bf=class extends qe{constructor(){super();this.event=new Ae("quitting");let e=()=>this.dispatchEvent(this.event);window.addEventListener("beforeunload",e),window.addEventListener("unload",e),window.addEventListener("pagehide",e)}};var Gue=298.257223563,PE=6378137,Xue=.9996,que=5e5,Sf=1/Gue,yf=1-Sf,Nt=Sf/(2-Sf),Kue=PE/(1+Nt)*(1+Nt*Nt/4+Nt*Nt*Nt*Nt/64),up=Math.sqrt(1-yf*yf),Zr=1-yf*yf,Yue=up*up/(1-up*up),Jue=1-Zr*(.25+Zr*(3/64+5*Zr/256)),Que=Zr*(3/8+Zr*(3/32+45*Zr/1024)),$ue=Zr*Zr*(15/256+Zr*45/1024),Zue=Zr*Zr*Zr*(35/3072),epe=[Nt/2-2*Nt*Nt/3+37*Nt*Nt*Nt/96,Nt*Nt/48+Nt*Nt*Nt/15,17*Nt*Nt*Nt/480],tpe=[2*Nt-2*Nt*Nt/3,7*Nt*Nt/3-8*Nt*Nt*Nt/5,56*Nt*Nt*Nt/15],Zt={FalseNorthing:1e7,equatorialRadius:PE,pointScaleFactor:Xue,E0:que,A:Kue,flattening:Sf,e:up,esq:Zr,e0sq:Yue,alpha1:Jue,alpha2:Que,alpha3:$ue,alpha4:Zue,beta:epe,delta:tpe};var xi=class{static centroid(t){let e=new Map;t.forEach(l=>e.set(l.zone,(e.get(l.zone)||0)+1));let n=0,i=0;for(let[l,c]of e)c>i&&(n=l,i=c);let o=1/t.length,s=t.map(l=>l.rezone(n).toVec3()).reduce((l,c)=>Qt.scaleAndAdd(l,l,c,o),Qt.create());return new xi().fromVec3(s,n).toLatLng().toUTM()}get easting(){return this._easting}get northing(){return this._northing}get altitude(){return this._altitude}get zone(){return this._zone}get hemisphere(){return this.northing>=0?"northern":"southern"}constructor(t,e,n,i){bi(t)?(this._easting=t.easting,this._northing=t.northing,this._altitude=t.altitude,this._zone=t.zone):(this._easting=t||0,this._northing=e||0,this._altitude=n||0,this._zone=i||0)}toJSON(){return JSON.stringify({easting:this.easting,northing:this.northing,altitude:this.altitude,zone:this.zone,hemisphere:this.hemisphere})}toString(){return`(${this.easting}, ${this.northing}, ${this.altitude}) zone ${this.zone}`}equals(t){return T(t)&&this.hemisphere==t.hemisphere&&this.easting==t.easting&&this.northing==t.northing&&this.altitude==t.altitude&&this.zone==t.zone}static A(t,e,n){let i=3+6*(n-1)-180;return at(e-i)*t}static getZoneWidthAtLatitude(t){let e=at(t),n=Math.sin(e),i=Math.cos(e),o=n/i,s=Zt.e*n,l=Zt.equatorialRadius/Math.sqrt(1-s*s),c=o*o,u=Zt.e0sq*i*i,p=c*c,f=at(3)*i,w=f*f,A=1-c+u,m=5-18*c+p+72*u-58*Zt.e0sq,d=A/6+w*m/120,h=1+w*d;return 2*Zt.pointScaleFactor*l*f*h}fromLatLng(t){let e=at(t.lat),n=Math.sin(e),i=Math.cos(e),o=2*i,s=o*n,l=o*i-1,c=2*l,u=c*s,p=c*l-1,f=u*l+p*s,w=n/i,A=Zt.e*n,m=Zt.equatorialRadius/Math.sqrt(1-A*A),d=Zt.equatorialRadius*(e*Zt.alpha1-s*Zt.alpha2+u*Zt.alpha3-f*Zt.alpha4),h=1+(t.lng+180)/6|0,M=xi.A(i,t.lng,h),k=M*M,E=w*w,b=Zt.e0sq*i*i,g=E*E,v=1-E+b,y=5-18*E+g+72*b-58*Zt.e0sq,V=k*y/120,B=v/6+V,D=1+k*B,L=Zt.pointScaleFactor*m*M*D+Zt.E0,J=5-E+9*b+4*b*b,ae=61-58*E+g+600*b-330*Zt.e0sq,Q=J/24+k*ae/720,ee=.5+k*Q,K=d+m*w*k*ee,$=Zt.pointScaleFactor*K;return this._easting=L,this._northing=$,this._altitude=t.alt,this._zone=h,this}rezone(t){if(!(1<=t&&t<=60))throw new Error(`Zones must be on the range [1, 60]. Given: ${t}`);if(t!==this.zone){let e=t-this.zone,n=this.toLatLng(),i=xi.getZoneWidthAtLatitude(n.lat);return new xi(this.easting-i*e,this.northing,this.altitude,t)}else return this}toLatLng(){return new en().fromUTM(this)}toVec2(){let t=At.create();return At.set(t,this.easting,-this.northing),t}fromVec2(t,e){return this._easting=t[0],this._northing=-t[1],this._altitude=0,this._zone=e,this}toVec3(){let t=Qt.create();return Qt.set(t,this.easting,this.altitude,-this.northing),t}fromVec3(t,e){return this._easting=t[0],this._altitude=t[1],this._northing=-t[2],this._zone=e,this}copy(t){return this._easting=t.easting,this._northing=t.northing,this._altitude=t.altitude,this._zone=t.zone,this}clone(){return new xi(this)}};var en=class{static centroid(t){let e=1/t.length,n=t.map(i=>i.toVec3()).reduce((i,o)=>Qt.scaleAndAdd(i,i,o,e),Qt.create());return new en().fromVec3(n)}get alt(){return this._alt}get lat(){return this._lat}get lng(){return this._lng}constructor(t,e,n){bi(t)?(this._lat=t.lat,this._lng=t.lng,this._alt=t.alt):(this._lat=t||0,this._lng=e||0,this._alt=n)}toJSON(){return JSON.stringify({lat:this.lat,lng:this.lng,alt:this.alt})}static parseDMS(t){let e=t.split(" ");if(e.length==3){let n=e[0],i=parseInt(e[1],10),o=parseFloat(e[2]);if((n=="N"||n=="S"||n=="E"||n=="W")&&Number.isInteger(i)&&Number.isFinite(o)){let s=i+o/60;return(n=="S"||n=="W")&&(s*=-1),s}}return Number.NaN}static parseDMSPair(t){let e=t.split(",");if(e.length==2){let n=en.parseDMS(e[0]),i=en.parseDMS(e[1]);if(!Number.isNaN(n)&&!Number.isNaN(i))return new en(n,i)}return null}static parseDecimal(t){let e=t.split(",");if(e.length==2){let n=parseFloat(e[0].trim()),i=parseFloat(e[1].trim());if(Number.isFinite(n)&&Number.isFinite(i))return new en(n,i)}return null}static parse(t){let e=en.parseDecimal(t),n=en.parseDMSPair(t);return e||n}toDMS(t,e=!0){let n=en.toDMS(this.lat,"S","N",t),i=en.toDMS(this.lng,"W","E",t);if(this.alt&&e){let o=`${this.alt.toFixed(t)}m`;return`<${n}, ${i}> alt ${o}`}else return`<${n}, ${i}>`}toDMSArray(t,e=!1){let n=[en.toDMS(this.lat,"S","N",t),en.toDMS(this.lng,"W","E",t)];return this.alt&&e&&n.push(`${this.alt.toFixed(t)}m`),n}static toDMS(t,e,n,i){let o=t<0?e:n;t=Math.abs(t);let s=Math.floor(t),l=(t-s)*60,c=Math.floor(l),p=((l-c)*60).toFixed(i);for(;p.indexOf(".")<=1;)p=`0${p}`;return`${o} ${s.toFixed(0)}\xB0 ${c.toFixed(0)}' ${p}"`}toString(t){return t=t||6,`(${this.lat.toFixed(t)}\xB0, ${this.lng.toFixed(t)}\xB0)`}equals(t){return bi(t)&&this.lat==t.lat&&this.lng==t.lng&&this.alt==t.alt}compareTo(t){if(fe(t))return-1;{let e=this.lat-t.lat,n=this.lng-t.lng,i=(this.alt||0)-(t.alt||0);return e==0&&n==0?i:e==0?n:e}}distance(t){let e=this.toUTM(),n=t.toUTM().rezone(e.zone),i=n.easting-e.easting,o=n.northing-e.northing;return Math.sqrt(i*i+o*o)}fromUTM(t){let e=t.hemisphere==="southern"&&t.northing>=0?Zt.FalseNorthing:0,n=(t.northing-e)/(Zt.pointScaleFactor*Zt.A),i=(t.easting-Zt.E0)/(Zt.pointScaleFactor*Zt.A),o=n,s=i;for(let f=1;f<=3;++f){let w=Zt.beta[f-1],A=2*f*n,m=2*f*i,d=Math.sin(A),h=Math.cosh(m),M=Math.cos(A),k=Math.sinh(m);o-=w*d*h,s-=w*M*k}let l=Math.asin(Math.sin(o)/Math.cosh(s)),c=l;for(let f=1;f<=3;++f)c+=Zt.delta[f-1]*Math.sin(2*f*l);let u=t.zone*6-183,p=Math.atan(Math.sinh(s)/Math.cos(o));for(this._lat=Yt(c),this._lng=u+Yt(p);this._lng<-180;)this._lng+=360;for(;this._lng>180;)this._lng-=360;return this._alt=t.altitude,this}toUTM(){return new xi().fromLatLng(this)}toVec2(){let t=At.create();return At.set(t,this.lng,this.lat),t}fromVec2(t){return this._lng=t[0],this._lat=t[1],this._alt=void 0,this}toVec3(){let t=Qt.create();return Qt.set(t,this.lng,this.alt,this.lat),t}fromVec3(t){return this._lng=t[0],this._alt=t[1],this._lat=t[2],this}toArray(){return[this._lng,this._alt,this._lat]}fromArray(t){return this.fromVec3(t)}copy(t){return this._lat=t.lat,this._lng=t.lng,this._alt=t.alt,this}clone(){return new en(this)}};var nc=class extends gt{constructor(e,n,...i){super(e,n);this.width=null;this.alts=i}random(){let e=Math.floor(Math.random()*this.alts.length);if(e<0)return null;let n=this.alts[e];return n instanceof nc?n.random():n}contains(e){if(super.contains(e))return!0;for(let n of this.alts)if(n.contains(e))return!0;return!1}};var LE=new nc("Keycap Digits","Keycap Digits",XF,qF,KF,YF,JF,QF,$F,ZF,eA,tA,nA);var npe=new Ae("play"),rpe=new Ae("stop"),br=.1,IE=new Map(LE.alts.map((r,t)=>[r.value,t.toString()])),rc=class extends Yr{constructor(e,n,i,o,s,l,c){super();this.data=i;this.volume=l;this.player=c;this.playButton=null;this.pauseButton=null;this.stopButton=null;this.replayButton=null;this.clickPlay=null;this.disposed=!1;s=IE.get(s)||s||"",this.object=Dt(`playback-${o}`),this.textLabel=new Cr(e,`playback-${o}-label`,"none",{minHeight:br,minWidth:4*br,maxWidth:4*br,padding:.02,scale:1e3,bgFillColor:n.labelFillColor,textFillColor:"white"}),this.textLabel.image.value=s,this.textLabel.image.addEventListener("redrawn",()=>this.repositionLabel()),this.progressBar=new Nr(4*br,.025,.01,jd),this.progressBar.visible=!1,this.clickPlay=async()=>{this.player.data!==this.data&&await this.player.load(this.data,this),this.player.volume=this.volume,await this.player.play()},this.load(n,c)}dispose(){this.disposed||(this.data===this.player.data&&this.player.clear(),St(this.object),this.disposed=!0)}repositionLabel(){this.textLabel.position.y=-(br+this.textLabel.objectHeight)/2}async load(e,n){let[i,o,s,l]=await An(e.getMeshButton("media","play",br),e.getMeshButton("media","pause",br),e.getMeshButton("media","stop",br),e.getMeshButton("media","replay",br));je(this,this.playButton=i,this.pauseButton=o,this.stopButton=s,this.replayButton=l,this.progressBar,this.textLabel),this.playButton.object.position.x=-1.5*br,this.pauseButton.object.position.x=-.5*br,this.stopButton.object.position.x=.5*br,this.replayButton.object.position.x=1.5*br,this.progressBar.position.y=-br/2,this.progressBar.position.z=.01,this.repositionLabel();let c=()=>{let w=n.data===this.data;this.playButton.disabled=w&&(n.playbackState==="loading"||n.playbackState==="playing"||n.playbackState==="errored")||!w&&n.playbackState==="loading",this.pauseButton.disabled=!w||n.playbackState==="loading"||n.playbackState!=="playing",this.replayButton.disabled=this.stopButton.disabled=!w||n.playbackState==="loading"||n.playbackState==="stopped"||n.playbackState==="errored",(!w||n.playbackState==="loading"||n.playbackState==="stopped")&&(this.progressBar.visible=!1)};c();let u=w=>A=>{A.source.data===this.data&&w(A)},p=u(c);n.addEventListener("loading",c),n.addEventListener("loaded",p),n.addEventListener("played",p),n.addEventListener("paused",p),n.addEventListener("stopped",c),n.addEventListener("progress",u(w=>this.report(w.value,w.total))),n.addEventListener("played",u(()=>this.dispatchEvent(npe))),n.addEventListener("stopped",u(()=>this.dispatchEvent(rpe)));let f=(w,A)=>{w.addEventListener("click",A)};f(this.playButton,this.clickPlay),f(this.pauseButton,()=>n.pause()),f(this.stopButton,()=>n.stop()),f(this.replayButton,()=>n.restart())}get label(){return T(this.textLabel.image)?this.textLabel.image.value:null}set label(e){e=IE.get(e)||e,this.textLabel.image.value=e}report(e,n,i,o){super.report(e,n,i,o);let s=this.p*4*br;this.progressBar.position.x=.5*(s-4*br),this.progressBar.scale.x=s,this.progressBar.visible=e>0}};var Tf=new Ie,ic=class{constructor(t,e,n,i){this.scenario=t;this.parent=e;this.player=n;this.clip=null;this.controls=null;this.error=null;this.disposed=!1;this.zone=i.zone,this.minDistance=i.minDistance,this.maxDistance=i.maxDistance,this.spatialize=i.spatialize,this.effect=i.effect,this.label=i.label,this.volume=i.volume,this.enabled=i.enabled,this.transformID=i.transformID,this.key=i.key,this.scenarioID=i.scenarioID,this.fileID=i.fileID,this.fileName=i.fileName,this.filePath=i.filePath,this.fileTagString=i.fileTagString,this.mediaType=i.mediaType,this.trueMediaType=i.trueMediaType,this.copyright=i.copyright,this.copyrightDate=i.copyrightDate}get effects(){return fe(this.effect)?[]:this.effect.split(",").map(t=>t.trim()).filter(t=>t.length>0)}async load(t){if(T(this.error))return Promise.resolve();this.disposed=!1;try{this.spatialize?(this.clip=await this.scenario.env.audio.createClip(this.transformID.toString(),this.filePath,this.spatialize,this.spatialize,this.spatialize,this.spatialize,this.volume,this.effects,t),this.clip.spatializer.setAudioProperties(this.minDistance,this.maxDistance,this.scenario.env.audio.algorithm),this.updateAudioPosition()):(je(this.parent,this.controls=new rc(this.scenario.env,this.scenario.env.uiButtons,this.filePath,`${this.fileName}(${this.transformID})`,this.label,this.volume,this.player)),this.controls.addScopedEventListener(this,"play",()=>{this.scenario.log("play audio",{id:this.transformID})}),this.controls.addScopedEventListener(this,"stop",()=>{this.scenario.log("stop audio",{id:this.transformID})}))}catch(e){this.error=e,this.dispose()}}async reload(t){let e=this.clip&&this.clip.playbackState==="playing";this.dispose(),this.player.cacheBust(this.filePath),await this.load(t),e&&this.clip.play()}updateAudioPosition(){this.parent.getWorldPosition(Tf),this.scenario.env.audio.setClipPosition(this.transformID.toString(),Tf.x,Tf.y,Tf.z)}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){T(this.clip)&&(this.scenario.env.audio.removeClip(this.transformID.toString()),this.clip=null),T(this.controls)&&(this.controls.removeScope(this),this.controls.object.removeFromParent(),this.controls.dispose(),this.controls=null)}play(){return T(this.error)?Promise.resolve():T(this.clip)?this.clip.play():this.controls.clickPlay()}reset(){T(this.error)||(T(this.clip)?this.clip.stop():this.player.stop())}};var RE=` ${GF.textStyle} `,ipe=new Et,xa=class extends Yr{constructor(e,n,i,o,s){super();this.env=e;this.transform=n;this.from=i;this.to=o;s=s||RE,this.icon=new Qs(this.env,"navButton",s,BF),this.icon.addEventListener("click",l=>{this.enabled&&this.dispatchEvent(l)}),this.transform.scale.setScalar(.5),this.progressBar=new Nr(this.icon.image.width,.025,.01,jd),this.progressBar.position.y=-this.icon.image.height/2,this.progressBar.position.z=.01,je(this.transform,je(this.icon,this.progressBar))}get object(){return this.transform}get fromStationID(){return this.from.transformID}get toStationID(){return this.to.transformID}get transformID(){return this.transform&&this.transform.transformID}report(e,n,i,o){super.report(e,n,i,o);let s=this.icon.image.width*this.p;this.progressBar.position.x=.5*(s-this.icon.image.width),this.progressBar.scale.x=s}get label(){return this.icon.image.value}set label(e){this.icon.image.value=this.icon.image.value=e||RE}get enabled(){return!this.icon.disabled}set enabled(e){this.icon.disabled=!e,this.progressBar.visible=!e}static calcMatrix(e,n,i,o=null){o=o||ipe;let s=o.parent;return s&&s.remove(o),o.position.copy(n.position),o.position.sub(e.position),o.position.y=0,o.position.normalize(),o.position.multiplyScalar(1.5),o.position.y+=1,o.lookAt(0,i,0),o.updateMatrix(),s&&je(s,o),o.matrix}resetPosition(){xa.calcMatrix(this.from,this.to,this.env.defaultAvatarHeight,this.object)}};function BE(r,t,e,n){return`/Editor/Google/StreetView/Image/${r}/${t}/${e}/${n}/`}var Ef=class extends Af{constructor(t){super(t,!0)}loadFiles(t,e,n){return this.renderFaces(BE.bind(null,t),e,n)}loadFile(t,e,n){return this.renderCubeMap(BE.bind(null,t),e,n)}async loadImages(t,e,n){let i=await this.loadFiles(t,e,n);return await Promise.all(i.map(Wa))}async loadCanvas(t,e,n){let i=await this.loadFile(t,e,n),o=await Wa(i);return Jp(o)}};var _f=class extends Zc{init(e,n){this.callMethod("init",[e,n])}propogateEvent(e){Ot(e.eventName)}loadFiles(e,n,i){return this.callMethod("loadFiles",[e,n],i)}loadFile(e,n,i){return this.callMethod("loadFile",[e,n],i)}async loadImages(e,n,i){let o=await this.loadFiles(e,n,i);return await Promise.all(o.map(Wa))}async loadCanvas(e,n,i){let o=await this.loadFile(e,n,i),s=await Wa(o);return Jp(s)}};var Mf=class extends Qc{constructor(t,e){t.workers!==1&&(t.workers=1),super(t,e)}get canvases(){return this.peekWorker().canvases}init(t,e){for(let n of this.workers)n.init(t,e)}loadImages(t,e,n){return this.nextWorker().loadImages(t,e,n)}loadCanvas(t,e,n){return this.nextWorker().loadCanvas(t,e,n)}};async function VE(r,t,e){let n=null;if(dr(t)?e=t:n=t,n=n||new Vo,!sd()&&e){let i=await r.get(HF("three")).text().then(tt);n.check();let o=await r.get(NF("photosphere-capture")).text().then(tt);n.check();let s=i+o,l=new Blob([s],{type:Ei.value}),c=URL.createObjectURL(l);return new Mf({scriptPath:c},_f)}else return r=r||dd(!1),new Ef(r)}var g1=class extends Ae{constructor(e){super("dwell");this.dwellTimeSeconds=e}},ho=class extends qe{constructor(e=1,n=.25){super();this.minTimeSeconds=e;this.graceTimeSeconds=n;this.startTime=null;this.graceTimer=null;Object.seal(this)}start(){this.stopGrace(),this.startTime===null&&(this.startTime=performance.now())}stopGrace(){this.graceTimer!==null&&(clearTimeout(this.graceTimer),this.graceTimer=null)}stop(){this.startTime!==null&&(this.graceTimer=setTimeout(()=>{this.graceTimer=null;let e=(performance.now()-this.startTime)/1e3;this.startTime=null,e>this.minTimeSeconds&&this.dispatchEvent(new g1(e))},this.graceTimeSeconds*1e3))}};var OE=_r("Yarrow:Model:modelTemplateTasks",()=>new Map),oc=class extends Et{constructor(e,n,i){super();this.scenario=e;this.model=null;this.error=null;this.disposed=!1;this.name=`model-${n.fileName}`,this.key=n.key,this.scenarioID=n.scenarioID,this.fileID=n.fileID,this.fileName=n.fileName,this.filePath=n.filePath,this.fileTagString=n.fileTagString,this.transformID=n.transformID,this.mediaType=n.mediaType,this.trueMediaType=n.trueMediaType,this.copyright=n.copyright,this.copyrightDate=n.copyrightDate,this.target=new sr(this),je(i,this),Object.seal(this)}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){T(this.model)&&(this.model.removeFromParent(),St(this.model),this.model=null)}async load(e){if(T(this.error))return Promise.resolve();this.disposed=!1;let n=OE.get(this.filePath);if(!n){let s=new ko(this.scenario.env,this.filePath,this.mediaType,!this.scenario.env.DEBUG);n=s.then(l=>{try{qs(l.scene,Ks)}catch(c){this.error=c}return l}),OE.set(this.filePath,n),this.scenario.env.fetcher.assets(e,s)}let i=await n,o=new ho;o.addEventListener("dwell",s=>{this.scenario.log("model viewed",{id:this.transformID,time:s.dwellTimeSeconds})}),this.model=i.scene.clone(!0),this.model.traverse(s=>{or(s)&&this.target.addMesh(s)}),this.target.addEventListener("enter",s=>{s.pointer.type==="nose"&&o.start()}),this.target.addEventListener("exit",s=>{s.pointer.type==="nose"&&o.stop()}),je(this,this.model)}async reload(e){this.dispose(),this.error=null,await this.load(e)}get size(){return this.parent.scale.x}set size(e){this.parent.scale.setScalar(e)}get rotationX(){return Yt(this.parent.rotation.x)}get rotationY(){return Yt(this.parent.rotation.y)}get rotationZ(){return Yt(this.parent.rotation.z)}};var HE=1e3,ope=1e3/HE,NE=new Ie,x1=.15,w1=.1,spe={minHeight:w1,maxHeight:w1,minWidth:w1,padding:.02,scale:1e3,bgFillColor:Xa,textFillColor:"white"},v1=class extends Et{constructor(e,n,i){super();this.scenario=e;this.originPoint=new Ie;this.originRotation=new xt;this._isCallout=!1;this.wasCallout=null;this._alwaysVisible=!1;this.wasAlwaysVisible=null;this.opacity=1;this.lastOpacity=null;this.file=null;this.pdf=null;this.zoomInButton=null;this.zoomOutButton=null;this.prevButton=null;this.pageLabel=null;this.nextButton=null;this.error=null;this.disposed=!1;this.invMatrix=new Vt;this.dumpScale=new Ie;this.followObj=this.scenario.env.worldUISpace,this.onClick=()=>this.toggle(),this.key=n.key,this.scenarioID=n.scenarioID,this.fileID=n.fileID,this.fileName=n.fileName,this.filePath=n.filePath,this.fileTagString=n.fileTagString,this.mediaType=n.mediaType,this.trueMediaType=n.trueMediaType,this.copyright=n.copyright,this.copyrightDate=n.copyrightDate,this.transformID=n.transformID,this.name=`sign-${n.fileName}`,this.originPoint.copy(this.position),this.originRotation.copy(this.quaternion),je(i,this),this._alwaysVisible=n.alwaysVisible,this._isCallout=n.isCallout,this.start=-1,this.end=0,this.t=1,this.direction=-1,this.target=new sr(this),this.scenario.addScopedEventListener(this,"present",o=>{this.direction!==-1&&o.source!==this&&this.toggle()})}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){this.scenario.removeScope(this),T(this.image)&&(this.image.dispose(),this.image=null),this.removeButton(this.zoomInButton),this.zoomInButton=null,this.removeButton(this.zoomOutButton),this.zoomOutButton=null,this.removeButton(this.prevButton),this.prevButton=null,this.removeButton(this.nextButton),this.nextButton=null,this.removeButton(this.pageLabel),this.pageLabel=null,this.pdf=null}removeButton(e){T(e)&&(e instanceof qe&&e.removeScope(this),Xs(e)&&(e.object.removeFromParent(),St(e)))}async load(e){if(T(this.error))return Promise.resolve();this.disposed=!1;try{let[n,i,o]=await An(this.scenario.env.fetcher.get(this.filePath).progress(e).file(),this.scenario.env.uiButtons.getMeshButton("zoom","in",x1),this.scenario.env.uiButtons.getMeshButton("zoom","out",x1));if(this.file=n,this.zoomInButton=i,this.zoomInButton.addScopedEventListener(this,"click",this.onClick),this.zoomInButton.object.visible=this.isCallout,this.zoomOutButton=o,this.zoomOutButton.addScopedEventListener(this,"click",this.onClick),this.zoomOutButton.object.visible=!1,je(this,this.zoomInButton,this.zoomOutButton),vo.matches(this.file.contentType)){this.pdf=new Vi(this.file.content,{scale:2});let[l,c]=await An(this.scenario.env.uiButtons.getMeshButton("arrow","left",.1),this.scenario.env.uiButtons.getMeshButton("arrow","right",.1));je(this,this.prevButton=l,this.pageLabel=new Cr(this.scenario.env,"label-"+this.transformID,"none",spe,{side:Us}),this.nextButton=c),this.prevButton.addScopedEventListener(this,"click",()=>this.loadImage(this.pdf.curPageIndex-1)),this.nextButton.addScopedEventListener(this,"click",()=>this.loadImage(this.pdf.curPageIndex+1))}je(this,this.image=new Ri(this.scenario.env,`Sign(${this.key}) ${n.fileName}`,"dynamic"));let s=new ho;s.addEventListener("dwell",l=>{this.scenario.log("sign viewed",{id:this.transformID,time:l.dwellTimeSeconds})}),this.target.clickable=!0,this.target.addEventListener("click",this.onClick),this.target.addEventListener("enter",l=>{l.pointer.type==="nose"&&s.start()}),this.target.addEventListener("exit",l=>{l.pointer.type==="nose"&&s.stop()}),await this.loadImage(0)}catch(n){this.error=n,this.dispose()}}async reload(e){this.dispose(),this.error=null,await this.load(e)}async loadImage(e){this.pdf&&(this.prevButton.disabled=!0,this.nextButton.disabled=!0);let n=await this.getFrame(e);if(this.image.setTextureMap(n),this.image.objectWidth=1,this.pdf){let i=this.image.objectHeight/2;this.prevButton.object.visible=this.pageLabel.object.visible=this.nextButton.object.visible=this.hasPages,this.hasPages&&(this.prevButton.object.position.set(-.5,-i,.1),this.pageLabel.position.set(0,-i,.1),this.nextButton.object.position.set(.5,-i,.1),this.prevButton.disabled=!this.pdf.canGoBack,this.pageLabel.image.value=`${this.pdf.curPageNumber} of ${this.pdf.numPages}`,this.nextButton.disabled=!this.pdf.canGoForward)}}async getFrame(e){return this.pdf?(this.scenario.log("view sign page",{id:this.transformID,page:e}),await this.pdf.getPage(e),this.pdf.canvas):await this.scenario.env.fetcher.get(this.file.content).image().then(tt)}get isCallout(){return this._isCallout}set isCallout(e){this._isCallout=e,this.update(0)}get hasPages(){return this.pdf&&this.pdf.numPages>1}get alwaysVisible(){return this._alwaysVisible}set alwaysVisible(e){this._alwaysVisible=e,this.update(0)}get isClickable(){return this.isCallout||!this.alwaysVisible}get showZoomIn(){return this.isClickable&&this.direction===-1&&this.t>=this.end}get showZoomOut(){return this.isClickable&&this.direction===1&&this.t>=this.end}toggle(){if(!T(this.error)&&this.isClickable){if(this.direction!==1){this.scenario.log("expand sign",{id:this.transformID}),this.target.addMesh(this.image.mesh),this.direction=1;let n=new sc(this);this.scenario.dispatchEvent(n)}else this.target.removeMesh(this.image.mesh),this.direction=-1;let e=Math.max(0,this.end-this.t);this.start=performance.now(),this.end=this.start+HE,this.t=this.start+e}}reset(){T(this.error)||(this.isClickable&&(this.start=-1,this.t=0,this.end=0,this.direction=-1),T(this.image)&&this.image.removeWebXRLayer())}update(e){if(T(this.error)||!T(this.parent))return;if(T(this.zoomInButton)&&(this.zoomInButton.object.visible=this.showZoomIn,this.zoomOutButton.object.visible=this.showZoomOut,this.isCallout!==this.wasCallout||this.alwaysVisible!==this.wasAlwaysVisible)){let s=this.image.objectWidth/2,l=this.image.objectHeight/2;this.zoomInButton.object.visible=this.isClickable,this.zoomOutButton.object.visible=!1,this.alwaysVisible?this.zoomInButton.object.position.set(s,l,.1):this.zoomInButton.object.position.set(0,0,0),this.zoomOutButton.object.position.set(s,l,.1),this.wasCallout=this.isCallout,this.wasAlwaysVisible=this.alwaysVisible}this.t+=ope*e;let n=iu(this.t,this.start,this.end),i=vr(n,0,1),o=this.direction===1?1-i:i;this.isCallout&&(this.invMatrix.copy(this.parent.matrixWorld).invert().multiply(this.followObj.matrixWorld).multiply(v1.offsetMatrix).decompose(this.position,this.quaternion,this.dumpScale),this.position.lerp(this.originPoint,o),this.quaternion.slerp(this.originRotation,o)),T(this.zoomInButton)&&(this.zoomInButton.object.lookAt(this.scenario.env.avatar.worldPos),this.zoomInButton.object.getWorldPosition(NE),this.zoomInButton.size=this.zoomOutButton.size=x1*NE.sub(this.scenario.env.avatar.worldPos).length()/(3*this.size),this.zoomOutButton.object.matrix.copy(this.zoomInButton.object.matrix)),this.alwaysVisible?this.opacity=1:this.opacity=this.alwaysVisible?1:1-o,this.opacity!==this.lastOpacity&&(this.image.mesh.material.opacity=this.opacity,this.image.mesh.material.transparent=this.opacity<1,this.image.mesh.material.needsUpdate=!0,this.image.mesh.visible=0<this.opacity&&this.opacity<1||!(this.scenario.env.showWebXRLayers&&this.scenario.env.hasXRCompositionLayers),this.image.webXRLayerType=this.opacity===1?"dynamic":"none",T(this.pdf)&&(this.prevButton.object.visible=this.pageLabel.object.visible=this.nextButton.object.visible=this.hasPages&&this.opacity===1),this.lastOpacity=this.opacity)}get size(){return this.parent.scale.x}set size(e){this.parent.scale.setScalar(e)}get rotationX(){return Yt(this.parent.rotation.x)}get rotationY(){return Yt(this.parent.rotation.y)}get rotationZ(){return Yt(this.parent.rotation.z)}},wa=v1;wa.offsetMatrix=new Vt().makeTranslation(0,0,-1.5);var ac=class{constructor(t,e){this.scenario=t;this.key=e.key,this.scenarioID=e.scenarioID,this.transformID=e.transformID,this.fileID=e.fileID,this.fileName=e.fileName,this.filePath=e.filePath,this.fileTagString=e.fileTagString,this.mediaType=e.mediaType,this.trueMediaType=e.trueMediaType,this.copyright=e.copyright,this.copyrightDate=e.copyrightDate,this.location=e.location,this.zone=e.zone,this.label=e.label,this.rotation=e.rotation}async reload(t){this.scenario.evict(this),this.scenario.curStation===this&&await this.scenario.env.withFade(async()=>{this.scenario.env.skybox.clear(),await this.scenario.showStation(this,!1,t)})}};var zE=1e3,ape=1e3/zE,WE=new Ie,UE=.15,F1=.2,lpe={minHeight:F1,maxHeight:F1,minWidth:F1,padding:.04,scale:1e3,bgFillColor:"white",textFillColor:"black",bgStrokeColor:Xa,bgStrokeSize:.01},A1=class extends Et{constructor(e,n,i){super();this.scenario=e;this.originPoint=new Ie;this.originRotation=new xt;this._isCallout=!1;this.wasCallout=null;this._alwaysVisible=!1;this.wasAlwaysVisible=null;this.opacity=1;this.lastOpacity=null;this.zoomInButton=null;this.error=null;this.disposed=!1;this.invMatrix=new Vt;this.dumpScale=new Ie;this.followObj=this.scenario.env.worldUISpace,this.onClick=()=>this.toggle(),this.key=n.key,this.scenarioID=n.scenarioID,this.fileID=n.fileID,this.fileName=n.fileName,this.filePath=n.filePath,this.fileTagString=n.fileTagString,this.mediaType=n.mediaType,this.trueMediaType=n.trueMediaType,this.copyright=n.copyright,this.copyrightDate=n.copyrightDate,this.transformID=n.transformID,this.name=`text-${n.fileName}`,this.originPoint.copy(this.position),this.originRotation.copy(this.quaternion),je(i,this),this._alwaysVisible=n.alwaysVisible,this._isCallout=n.isCallout,this.start=-1,this.end=0,this.t=1,this.direction=-1,this.target=new sr(this),this.scenario.addScopedEventListener(this,"present",o=>{this.direction!==-1&&o.source!==this&&this.toggle()})}get text(){return this.image.image.value}set text(e){this.image.image.value=e}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){this.scenario.removeScope(this),T(this.image)&&(this.image.dispose(),this.image=null),this.removeButton(this.zoomInButton),this.zoomInButton=null}removeButton(e){T(e)&&(e instanceof qe&&e.removeScope(this),Xs(e)&&(e.object.removeFromParent(),St(e)))}async load(e){if(T(this.error))return Promise.resolve();this.disposed=!1;try{let[n,i]=await An(this.scenario.env.fetcher.get(this.filePath).progress(e).text(),this.scenario.env.uiButtons.getMeshButton("zoom","info",UE));this.zoomInButton=i,this.zoomInButton.addScopedEventListener(this,"click",this.onClick),this.zoomInButton.object.visible=this.isCallout,je(this,this.zoomInButton),je(this,this.image=new Cr(this.scenario.env,`Text(${this.key}) ${n.fileName}`,"dynamic",lpe));let o=new ho;o.addEventListener("dwell",s=>{this.scenario.log("text viewed",{id:this.transformID,time:s.dwellTimeSeconds})}),this.target.clickable=!0,this.target.addEventListener("click",this.onClick),this.target.addEventListener("enter",s=>{s.pointer.type==="nose"&&o.start()}),this.target.addEventListener("exit",s=>{s.pointer.type==="nose"&&o.stop()}),this.image.image.value=n.content}catch(n){this.error=n,this.dispose()}}async reload(e){this.dispose(),this.error=null,await this.load(e)}get isCallout(){return this._isCallout}set isCallout(e){this._isCallout=e,this.update(0)}get alwaysVisible(){return this._alwaysVisible}set alwaysVisible(e){this._alwaysVisible=e,this.update(0)}get isClickable(){return this.isCallout||!this.alwaysVisible}get showZoomIn(){return this.isClickable&&this.direction===-1&&this.t>=this.end}toggle(){if(!T(this.error)&&this.isClickable){if(this.direction!==1){this.scenario.log("expand text",{id:this.transformID}),this.target.addMesh(this.image.mesh),this.direction=1;let n=new sc(this);this.scenario.dispatchEvent(n)}else this.target.removeMesh(this.image.mesh),this.direction=-1;let e=Math.max(0,this.end-this.t);this.start=performance.now(),this.end=this.start+zE,this.t=this.start+e}}reset(){T(this.error)||(this.isClickable&&(this.start=-1,this.t=0,this.end=0,this.direction=-1),T(this.image)&&this.image.removeWebXRLayer())}update(e){if(T(this.error)||!T(this.parent))return;if(T(this.zoomInButton)&&(this.zoomInButton.object.visible=this.showZoomIn,this.isCallout!==this.wasCallout||this.alwaysVisible!==this.wasAlwaysVisible)){let s=this.image.objectWidth/2,l=this.image.objectHeight/2;this.zoomInButton.object.visible=this.isClickable,this.alwaysVisible?this.zoomInButton.object.position.set(s,l,.1):this.zoomInButton.object.position.set(0,0,0),this.wasCallout=this.isCallout,this.wasAlwaysVisible=this.alwaysVisible}this.t+=ape*e;let n=iu(this.t,this.start,this.end),i=vr(n,0,1),o=this.direction===1?1-i:i;this.isCallout&&(this.invMatrix.copy(this.parent.matrixWorld).invert().multiply(this.followObj.matrixWorld).multiply(A1.offsetMatrix).decompose(this.position,this.quaternion,this.dumpScale),this.position.lerp(this.originPoint,o),this.quaternion.slerp(this.originRotation,o)),T(this.zoomInButton)&&(this.zoomInButton.object.lookAt(this.scenario.env.avatar.worldPos),this.zoomInButton.object.getWorldPosition(WE),this.zoomInButton.size=UE*WE.sub(this.scenario.env.avatar.worldPos).length()/(3*this.size)),this.alwaysVisible?this.opacity=1:this.opacity=this.alwaysVisible?1:1-o,this.opacity!==this.lastOpacity&&(this.image.mesh.material.opacity=this.opacity,this.image.mesh.material.transparent=this.opacity<1,this.image.mesh.material.needsUpdate=!0,this.image.mesh.visible=0<this.opacity&&this.opacity<1||!(this.scenario.env.showWebXRLayers&&this.scenario.env.hasXRCompositionLayers),this.image.webXRLayerType=this.opacity===1?"dynamic":"none",this.lastOpacity=this.opacity)}get size(){return this.parent.scale.x}set size(e){this.parent.scale.setScalar(e)}get rotationX(){return Yt(this.parent.rotation.x)}get rotationY(){return Yt(this.parent.rotation.y)}get rotationZ(){return Yt(this.parent.rotation.z)}},va=A1;va.offsetMatrix=new Vt().makeTranslation(0,0,-1.5);var lc=class extends Et{constructor(e,n,i,o,s){super();this.scenario=e;this.proxy=n;this.player=o;this.controls=null;this.data=null;this.error=null;this.disposed=!1;this.label=s.label,this.volume=s.volume,this.enabled=s.enabled,this.transformID=s.transformID,this.key=s.key,this.scenarioID=s.scenarioID,this.fileID=s.fileID,this.fileName=s.fileName,this.filePath=s.filePath,this.fileTagString=s.fileTagString,this.mediaType=s.mediaType,this.trueMediaType=s.trueMediaType,this.copyright=s.copyright,this.copyrightDate=s.copyrightDate,this.sphereEncodingName=s.sphereEncodingName,this.stereoLayoutName=s.stereoLayoutName,this.name="video-"+s.fileName,je(i,je(this,this.thumbnail=new Ri(this.scenario.env,"thumbnail-"+s.fileName,"static"))),this.size=i.scale.x,i.scale.setScalar(1),this.target=new sr(this),Object.seal(this)}dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){T(this.thumbnail)&&this.thumbnail.dispose(),T(this.controls)&&(this.controls.removeScope(this),this.controls.dispose())}async load(e){if(T(this.error))return Promise.resolve();try{let n=Gt(e,[10,1]);if(Es.matches(this.mediaType)){this.data=await this.proxy.loadData(this.filePath,n.shift());let l=await this.scenario.env.fetcher.get(this.data.thumbnail.url).image(this.data.thumbnail.contentType).then(tt);this.thumbnail.setTextureMap(l),this.thumbnail.objectWidth=1,this.thumbnail.mesh.renderOrder=4}let i=this.label||this.data&&this.data.title&&this.data.title.substring(0,25)||this.fileName;je(this,je(this.controls=new rc(this.scenario.env,this.scenario.env.uiButtons,this.data||this.filePath,this.filePath,i,this.volume,this.player))),this.controls.object.renderOrder=5,this.controls.object.position.y=-this.thumbnail.objectHeight/2,this.controls.object.position.z=.01;let o=l=>()=>{this.thumbnail.visible=!l,this.player.object.visible=l,l?(this.scenario.log("play video",{id:this.transformID}),je(this,this.player),this.player.setStereoParameters(this.sphereEncodingName,this.stereoLayoutName),this.player.object.position.set(0,0,0),this.player.object.quaternion.identity(),this.target.addMeshes(...this.player.meshes)):(this.scenario.log("stop video",{id:this.transformID}),this.target.removeMeshes(...this.player.meshes))};this.controls.addScopedEventListener(this,"play",o(!0)),this.controls.addScopedEventListener(this,"stop",o(!1));let s=new ho;s.addEventListener("dwell",l=>{this.scenario.log("video viewed",{id:this.transformID,time:l.dwellTimeSeconds})}),this.target.addEventListener("enter",l=>{l.pointer.type==="nose"&&s.start()}),this.target.addEventListener("exit",l=>{l.pointer.type==="nose"&&s.stop()}),this.disposed=!1}catch(n){this.error=n,this.dispose()}}async reload(e){this.dispose(),await this.load(e)}reset(){T(this.error)||(this.player.stop(),T(this.thumbnail)&&this.thumbnail.removeWebXRLayer())}get size(){return this.scale.x}set size(e){this.scale.x=this.scale.y=e}get rotationX(){return Yt(this.parent.rotation.x)}get rotationY(){return Yt(this.parent.rotation.y)}get rotationZ(){return Yt(this.parent.rotation.z)}};var b1=class extends Ae{constructor(e){super("navigate");this.station=e}},sc=class extends Event{constructor(e){super("present");this.source=e,Object.seal(this)}},pp=class extends qe{constructor(e,n,i){super();this.env=e;this.dataLogger=n;this.data=i;this.stations=new Array;this.signs=new Array;this.videos=new Array;this.texts=new Array;this.audios=new Array;this.models=new Array;this.signsByStation=new gn;this.videosByStation=new gn;this.textsByStation=new gn;this.audiosByStation=new gn;this.modelsByStation=new gn;this.curConnections=new Yn;this.transformsByTransformID=new Map;this.zonedClips=new gn;this.playbackButtons=new Map;this.videosReady=null;this.cancellationToken=null;this.curStationID=null;this.curZone=null;this.rootTransformID=null;this.__originLL=null;this._originUTM=null;this.windowQuitter=new bf;this.disposed=!1;this._muteEnvAudio=!1;this.imgCache=new Ff(10);this.imgTasks=new Map;this.imgCache.addEventListener("itemevicted",l=>{Xp(l.value)&&l.value.close()}),this.yt=new Xl(this.env.fetcher,_s),T(i.origin)&&(this._originLL=new en(i.origin)),this.startStationID=i.startStationID,this.startRotation=i.startRotation,this.transforms=i.transforms,this.connections=i.connections,this.env.addScopedEventListener(this,"environmentaudiotoggled",()=>{this.environmentAudioMuted=e.environmentAudioMuted});let o=!1,s=()=>{o||(o=!0,this.logLeaveStation(),this.log("leave scenario",{id:this.id}))};this.env.addScopedEventListener(this,"quitting",s),this.windowQuitter.addScopedEventListener(this,"quitting",s),this.env.addScopedEventListener(this,"sceneclearing",()=>{this.pauseCurrentAudioZone(),this.curZone=null}),this.env.avatar.addScopedEventListener(this,"avatarreset",()=>{this.moveToStation(this.curStation)})}get isEmpty(){return this.stations.length===0&&this.connections.length===0&&this.signs.length===0&&this.videos.length===0&&this.texts.length===0&&this.audios.length===0&&this.models.length===0}get rootTransform(){return this.transformsByTransformID.get(this.rootTransformID)}get _originLL(){return this.__originLL}set _originLL(e){this.__originLL=e,T(e)?this._originUTM=this.originLL.toUTM():this._originUTM=null}get originLL(){return this._originLL}get originUTM(){return this._originUTM}get id(){return this.data.id}get name(){return this.data.name}get version(){return this.data.version}get published(){return this.data.published}get roomName(){return this.data.roomName}async loadAssets(e){this.cancellationToken=new Vo,this.clearCache(),this.rig=await VE(this.env.fetcher,this.cancellationToken),this.rig.init(location.href,this.env.DEBUG),e=e||this.env.loadingBar;let[n,i]=Gt(e,[1,100]);await Vi.prepare(Hs("pdfjs"),this.env.fetcher,this.env.DEBUG,n);for(let l of this.data.transforms)this.addTransformData(l);for(let l of this.data.transforms)if(l.parentTransformID===0)this.rootTransformID=l.id;else{let c=this.getTransform(l.parentTransformID),u=this.getTransform(l.id);c.attach(u)}let[o,s]=Gt(i,[10,1]);this.videosReady=Oo(s,this.data.videoClips,(l,c)=>this.createVideo(l,c).catch(u=>{if(u instanceof op)console.warn("Late load cancellation occured");else throw u})).then(()=>null),await Uc(o,[[this.data.stations.length,l=>Oo(l,this.data.stations,(c,u)=>this.createStation(c,u))],[this.data.signs.length,l=>Oo(l,this.data.signs,(c,u)=>this.createSign(c,u))],[this.data.models.length,l=>Oo(l,this.data.models,(c,u)=>this.createModel(c,u))],[this.data.audioTracks.length,l=>Oo(l,this.data.audioTracks,(c,u)=>this.createAudio(c,u))],[this.data.texts.length,l=>Oo(l,this.data.texts,(c,u)=>this.createText(c,u))]]);for(let l of this.data.connections)this.createConnection(l);this.env.addScopedEventListener(this,"update",l=>this.update(l))}dispose(){if(!this.disposed){this.cancellationToken&&this.cancellationToken.cancel(),this.env.infoLabel.image.clear(),this.pauseCurrentAudioZone(),this.env.removeScope(this),this.env.avatar.removeScope(this);for(let n of this.audios)n.dispose();for(let n of this.signs)n.dispose();for(let n of this.models)n.dispose();for(let n of this.videos)n.dispose();for(let n of this.texts)n.dispose();let e=this.transformsByTransformID.get(this.rootTransformID);e.removeFromParent(),St(e),this.transformsByTransformID.clear(),this.signsByStation.clear(),this.audiosByStation.clear(),this.videosByStation.clear(),this.textsByStation.clear(),this.modelsByStation.clear(),this.zonedClips.clear(),ct(this.audios),ct(this.videos),ct(this.texts),ct(this.signs),ct(this.models),this.windowQuitter.removeScope(this),this.disposed=!0}}get avatarHeightOffset(){return this.env.avatar.height-this.env.defaultAvatarHeight}update(e){let n=this.signsByStation.get(this.curStation);for(let o of n)o.update(e.dt);let i=this.textsByStation.get(this.curStation);for(let o of i)o.update(e.dt)}get environmentAudioMuted(){return this._muteEnvAudio}set environmentAudioMuted(e){e!==this.environmentAudioMuted&&(this._muteEnvAudio=e,this.environmentAudioMuted?this.pauseCurrentAudioZone():this.playCurrentAudioZone())}addTransformData(e){let n=new gi(e);return this.transformsByTransformID.set(n.transformID,n),n}getTransform(e){return this.transformsByTransformID.get(e)}getStation(e){return Mn(this.stations,n=>n.transformID===e)}get curStation(){return this.getStation(this.curStationID)}get startStation(){return this.getStation(this.startStationID)}async createStation(e,n){n&&n.end();let i=new ac(this,e);return this.stations.push(i),i}async createConnection(e){try{let n=this.getStation(e.fromStationID),i=this.getStation(e.toStationID),o=this.getTransform(n.transformID),s=this.getTransform(i.transformID),l=this.getTransform(e.transformID);if(fe(l)){e.transformID=-this.transforms.length;let u={id:e.transformID,name:`nav-icon-from-${o.name}-to-${s.name}`,matrix:xa.calcMatrix(o,s,this.env.defaultAvatarHeight).toArray(),parentTransformID:n.transformID};this.transforms.push(u),l=this.addTransformData(u),je(o,l)}let c=new xa(this.env,l,o,s,e.label);return c.addEventListener("click",()=>{this.dispatchEvent(new b1(i)),this.showStation(i,!0,this.env.loadingBar)}),this.curConnections.add(n,i,c),c}catch(n){return console.error({task:"createConnection",err:n,data:e}),null}}async createSign(e,n){let i=this.getTransform(e.transformID),o=new wa(this,e,i);this.signs.push(o),await o.load(n),this.cancellationToken.check();let s=this.findStation(o);return this.signsByStation.add(s,o),o}async createModel(e,n){let i=this.getTransform(e.transformID),o=new oc(this,e,i);this.models.push(o),await o.load(n),this.cancellationToken.check();let s=this.findStation(o);return this.modelsByStation.add(s,o),o}async createAudio(e,n){let i=this.getTransform(e.transformID),o=new ic(this,i,this.env.audioPlayer,e);this.audios.push(o);let s=this.findStation(o.parent);return this.audiosByStation.add(s,o),await o.load(n),this.cancellationToken.check(),T(o.controls)&&(this.playbackButtons.set(o.parent,o.controls),fe(o.error)&&(o.controls.addEventListener("play",()=>this.pauseCurrentAudioZone()),o.controls.addEventListener("stop",()=>this.playCurrentAudioZone()))),T(o.clip)&&this.zonedClips.add(o.zone,o.clip),o}async createVideo(e,n){let i=this.getTransform(e.transformID),o=new lc(this,this.yt,i,this.env.videoPlayer,e);this.videos.push(o),await o.load(n),this.cancellationToken.check(),this.playbackButtons.set(o.parent,o.controls);let s=this.findStation(o.parent);return this.videosByStation.add(s,o),fe(o.error)&&(o.controls.addEventListener("play",()=>this.pauseCurrentAudioZone()),o.controls.addEventListener("stop",()=>this.playCurrentAudioZone())),o}async createText(e,n){let i=this.getTransform(e.transformID),o=new va(this,e,i);this.texts.push(o),await o.load(n),this.cancellationToken.check();let s=this.findStation(o);return this.textsByStation.add(s,o),o}getConnectionLabel(e,n){if(fe(e)||fe(n))return null;for(let i of this.connections)if(i.fromStationID===e.transformID&&i.toStationID===n.transformID)return i.label;return null}getStationByObject(e){return e instanceof gi?this.getStation(e.transformID):null}findStation(e){let n=this.getStationByObject(e);for(;!n&&e!=null;)e=e.parent,n=this.getStationByObject(e);return n}getStationCenter(e){let n=new Ie,i=this.getTransform(e.transformID);return i&&i.getWorldPosition(n),n.y+=this.env.defaultAvatarHeight,n}get visible(){return T(this.rootTransform.parent)}set visible(e){if(e!==this.visible)if(e){if(this.curStationID=null,this.rootTransform==null)throw new Error("No root transform");je(this.env.foreground,this.rootTransform);for(let n of this.stations){let i=this.getTransform(n.transformID);i.visible=!1}}else this.env.foreground.remove(this.rootTransform)}async showStart(e){if(this.visible=!0,this.startStationID==null)throw new Error("Scenario has no starting point");this.log("start scenario",{id:this.id}),await this.showStation(this.startStation,!1,e),this.env.avatar.setHeadingImmediate(this.startRotation)}async showStation(e,n,i){if(this.logLeaveStation(),this.log("show station",{id:e.transformID}),this.curStationID){let l=this.getStation(this.curStationID);this.resetStationAssets(l)}i=i||this.env.loadingBar,this.curStationID=e.transformID;let o=n?this.env.audio.playClipThrough("footsteps"):Promise.resolve(),s=await this.isCached(e.filePath);this.env.loadingBar.enabled=!s,await this.env.withFade(async()=>{this.env.skybox.rotation=e.rotation;let l=await this.getImage(e.filePath,i);l.length===6?await this.env.skybox.setImages(e.filePath,l):await this.env.skybox.setImage(e.filePath,l[0]),this.moveToStation(e);for(let p of this.stations){let f=this.getTransform(p.transformID);f.visible=p.transformID===e.transformID}let c=this.curConnections.get(e),u=this.getConnectedStations(e);for(let p of u)this.prefetchConnectedStation(c,p);this.resetStationAssets(e),this.env.infoLabel.image.value=e.label||e.fileName,await An(this.playAudioZone(e.zone),o)}),this.env.loadingBar.enabled=!1}logLeaveStation(){this.curStationID&&this.log("leave station",{id:this.curStationID})}moveToStation(e){T(e)&&(this.getTransform(e.transformID).getWorldPosition(this.env.stage.position),this.env.stage.position.y-=this.avatarHeightOffset)}resetStationAssets(e){let n=this.signsByStation.get(e);for(let l of n)l.reset();let i=this.audiosByStation.get(e);for(let l of i)l.reset();let o=this.videosByStation.get(e);for(let l of o)l.reset();let s=this.textsByStation.get(e);for(let l of s)l.reset()}evict(e){this.imgCache.delete(e.filePath),this.imgTasks.delete(e.filePath)}async prefetchConnectedStation(e,n){let i=e.get(n);i.enabled=!1,this.imgCache.has(n.filePath)||await this.getImage(n.filePath,i),i.enabled=!0}getImage(e,n){if(this.imgCache.has(e))return Promise.resolve(this.imgCache.get(e));if(this.imgTasks.has(e))return this.imgTasks.get(e);let i=this.getImages(e,n).then(o=>(this.imgCache.set(e,o),this.imgTasks.delete(e),o));return this.imgTasks.set(e,i),i}async getImages(e,n){let{contentType:i}=await this.env.fetcher.head(e).exec();if(i===tf.value){let o=await this.env.fetcher.get(e).text().then(tt);return await this.rig.loadImages(o,45,n)}else return[await this.env.fetcher.get(e).useCache(!this.env.DEBUG).image().then(tt)]}async isCached(e){return await this.imgCache.has(e)}clearCache(){this.imgCache.clear()}getConnectedStations(e){return e&&this.connections.filter(n=>n.fromStationID===e.transformID).map(n=>this.getStation(n.toStationID))}async playAudioZone(e){if(e!==this.curZone){let n=new Map,i=new Map;for(let o of this.zonedClips.get(this.curZone))n.set(o.audio,o),o.disable();for(let o of this.zonedClips.get(e))n.has(o.audio)?n.delete(o.audio):i.set(o.audio,o),o.enable();for(let o of n.values())o.pause();await Promise.all(Array.from(i.values()).map(o=>o.play())),this.curZone=e}}pauseCurrentAudioZone(){let e=this.zonedClips.get(this.curZone),n=new Map;for(let i of e)n.set(i.audio,i),i.disable();for(let i of n.values())i.pause()}async playCurrentAudioZone(){if(!this.environmentAudioMuted){let e=this.zonedClips.get(this.curZone),n=new Map;for(let i of e)i.enable(),n.set(i.audio,i);await Promise.all(Array.from(n.values()).map(i=>i.play()))}}log(e,n){this.dataLogger.log(e,n)}error(e,n,i){this.dataLogger.error(e,n,i)}};var kf=class extends qc{constructor(t){super(t,wo)}async getResult(t,e){let[n,i]=Gt(e,[1,89]);return await t.get(this.path).progress(n).object().then(tt).then(async o=>{let s=this.createScenario(o);return await s.loadAssets(i),s})}};var Cf=1e-6,dp=typeof Float32Array<"u"?Float32Array:Array,S1=Math.random;var rze=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var Ms={};pr(Ms,{add:()=>fpe,angle:()=>Vpe,bezier:()=>kpe,ceil:()=>gpe,clone:()=>ppe,copy:()=>hpe,create:()=>jE,cross:()=>Epe,dist:()=>Gpe,distance:()=>YE,div:()=>jpe,divide:()=>KE,dot:()=>$E,equals:()=>Wpe,exactEquals:()=>Hpe,floor:()=>xpe,forEach:()=>Ype,fromValues:()=>dpe,hermite:()=>Mpe,inverse:()=>ype,len:()=>qpe,length:()=>GE,lerp:()=>_pe,max:()=>vpe,min:()=>wpe,mul:()=>zpe,multiply:()=>qE,negate:()=>Spe,normalize:()=>Tpe,random:()=>Cpe,rotateX:()=>Ipe,rotateY:()=>Rpe,rotateZ:()=>Bpe,round:()=>Fpe,scale:()=>Ape,scaleAndAdd:()=>bpe,set:()=>mpe,sqrDist:()=>Xpe,sqrLen:()=>Kpe,squaredDistance:()=>JE,squaredLength:()=>QE,str:()=>Npe,sub:()=>Upe,subtract:()=>XE,transformMat3:()=>Ppe,transformMat4:()=>Dpe,transformQuat:()=>Lpe,zero:()=>Ope});function jE(){var r=new dp(3);return dp!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function ppe(r){var t=new dp(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t}function GE(r){var t=r[0],e=r[1],n=r[2];return Math.hypot(t,e,n)}function dpe(r,t,e){var n=new dp(3);return n[0]=r,n[1]=t,n[2]=e,n}function hpe(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r}function mpe(r,t,e,n){return r[0]=t,r[1]=e,r[2]=n,r}function fpe(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function XE(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function qE(r,t,e){return r[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r}function KE(r,t,e){return r[0]=t[0]/e[0],r[1]=t[1]/e[1],r[2]=t[2]/e[2],r}function gpe(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r[2]=Math.ceil(t[2]),r}function xpe(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r[2]=Math.floor(t[2]),r}function wpe(r,t,e){return r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.min(t[2],e[2]),r}function vpe(r,t,e){return r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r}function Fpe(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r[2]=Math.round(t[2]),r}function Ape(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r}function bpe(r,t,e,n){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function YE(r,t){var e=t[0]-r[0],n=t[1]-r[1],i=t[2]-r[2];return Math.hypot(e,n,i)}function JE(r,t){var e=t[0]-r[0],n=t[1]-r[1],i=t[2]-r[2];return e*e+n*n+i*i}function QE(r){var t=r[0],e=r[1],n=r[2];return t*t+e*e+n*n}function Spe(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r}function ype(r,t){return r[0]=1/t[0],r[1]=1/t[1],r[2]=1/t[2],r}function Tpe(r,t){var e=t[0],n=t[1],i=t[2],o=e*e+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r}function $E(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function Epe(r,t,e){var n=t[0],i=t[1],o=t[2],s=e[0],l=e[1],c=e[2];return r[0]=i*c-o*l,r[1]=o*s-n*c,r[2]=n*l-i*s,r}function _pe(r,t,e,n){var i=t[0],o=t[1],s=t[2];return r[0]=i+n*(e[0]-i),r[1]=o+n*(e[1]-o),r[2]=s+n*(e[2]-s),r}function Mpe(r,t,e,n,i,o){var s=o*o,l=s*(2*o-3)+1,c=s*(o-2)+o,u=s*(o-1),p=s*(3-2*o);return r[0]=t[0]*l+e[0]*c+n[0]*u+i[0]*p,r[1]=t[1]*l+e[1]*c+n[1]*u+i[1]*p,r[2]=t[2]*l+e[2]*c+n[2]*u+i[2]*p,r}function kpe(r,t,e,n,i,o){var s=1-o,l=s*s,c=o*o,u=l*s,p=3*o*l,f=3*c*s,w=c*o;return r[0]=t[0]*u+e[0]*p+n[0]*f+i[0]*w,r[1]=t[1]*u+e[1]*p+n[1]*f+i[1]*w,r[2]=t[2]*u+e[2]*p+n[2]*f+i[2]*w,r}function Cpe(r,t){t=t||1;var e=S1()*2*Math.PI,n=S1()*2-1,i=Math.sqrt(1-n*n)*t;return r[0]=Math.cos(e)*i,r[1]=Math.sin(e)*i,r[2]=n*t,r}function Dpe(r,t,e){var n=t[0],i=t[1],o=t[2],s=e[3]*n+e[7]*i+e[11]*o+e[15];return s=s||1,r[0]=(e[0]*n+e[4]*i+e[8]*o+e[12])/s,r[1]=(e[1]*n+e[5]*i+e[9]*o+e[13])/s,r[2]=(e[2]*n+e[6]*i+e[10]*o+e[14])/s,r}function Ppe(r,t,e){var n=t[0],i=t[1],o=t[2];return r[0]=n*e[0]+i*e[3]+o*e[6],r[1]=n*e[1]+i*e[4]+o*e[7],r[2]=n*e[2]+i*e[5]+o*e[8],r}function Lpe(r,t,e){var n=e[0],i=e[1],o=e[2],s=e[3],l=t[0],c=t[1],u=t[2],p=i*u-o*c,f=o*l-n*u,w=n*c-i*l,A=i*w-o*f,m=o*p-n*w,d=n*f-i*p,h=s*2;return p*=h,f*=h,w*=h,A*=2,m*=2,d*=2,r[0]=l+p+A,r[1]=c+f+m,r[2]=u+w+d,r}function Ipe(r,t,e,n){var i=[],o=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=o[0]+e[0],r[1]=o[1]+e[1],r[2]=o[2]+e[2],r}function Rpe(r,t,e,n){var i=[],o=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=o[0]+e[0],r[1]=o[1]+e[1],r[2]=o[2]+e[2],r}function Bpe(r,t,e,n){var i=[],o=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],r[0]=o[0]+e[0],r[1]=o[1]+e[1],r[2]=o[2]+e[2],r}function Vpe(r,t){var e=r[0],n=r[1],i=r[2],o=t[0],s=t[1],l=t[2],c=Math.sqrt(e*e+n*n+i*i),u=Math.sqrt(o*o+s*s+l*l),p=c*u,f=p&&$E(r,t)/p;return Math.acos(Math.min(Math.max(f,-1),1))}function Ope(r){return r[0]=0,r[1]=0,r[2]=0,r}function Npe(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"}function Hpe(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]}function Wpe(r,t){var e=r[0],n=r[1],i=r[2],o=t[0],s=t[1],l=t[2];return Math.abs(e-o)<=Cf*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(n-s)<=Cf*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=Cf*Math.max(1,Math.abs(i),Math.abs(l))}var Upe=XE,zpe=qE,jpe=KE,Gpe=YE,Xpe=JE,qpe=GE,Kpe=QE,Ype=function(){var r=jE();return function(t,e,n,i,o,s){var l,c;for(e||(e=3),n||(n=0),i?c=Math.min(i*e+n,t.length):c=t.length,l=n;l<c;l+=e)r[0]=t[l],r[1]=t[l+1],r[2]=t[l+2],o(r,r,s),t[l]=r[0],t[l+1]=r[1],t[l+2]=r[2];return t}}();function wi(r,t,e,...n){for(let i of n)(!(i in t)||r)&&(t[i]=e[i])}function cc(r){return r instanceof oc}function uc(r){return r instanceof wa}function pc(r){return r instanceof lc}function dc(r){return r instanceof va}function hc(r){return r instanceof ic}function No(r){return hc(r)&&r.spatialize}function y1(r){return hc(r)&&!r.spatialize}function Ln(r){return et(r)}function ei(r){return r instanceof fc}function qt(r){return T(r)&&r instanceof ac}function Oi(r){return T(r)&&!cc(r)&&!uc(r)&&!pc(r)&&!dc(r)&&!hc(r)&&!qt(r)&&!Ln(r)&&!ei(r)&&T(r.fromStationID)&&T(r.toStationID)}function Ho(r){if(fe(r))return null;if(Ln(r))return"zone";if(qt(r))return"station";if(hc(r))return r.spatialize?"ambientAudio":"audio";if(pc(r))return"video";if(dc(r))return"text";if(uc(r))return"sign";if(cc(r))return"model";if(Oi(r))return"connection";if(ei(r))return"scenario";Ot(r)}var ks=class extends Ae{constructor(e,n){super(e);this.asset=n}},Qn=class extends ks{constructor(e,n){super("assetselected",e);this.isContextMenu=n}},Fa=class extends ks{constructor(t){super("assetupdated",t)}},Df=class extends ks{constructor(e,n){super("assetrename",e);this.newName=n}},Pf=class extends ks{constructor(t){super("assetdelete",t)}},Lf=class extends ks{constructor(t){super("assetreset",t)}},If=class extends ks{constructor(t){super("assetviewfile",t)}},Rf=new Map([["scenario",pA.emojiStyle],["zone",fA.emojiStyle],["station",vx.emojiStyle],["ambientAudio",oA.emojiStyle],["connection",jF.emojiStyle],["sign",mA.emojiStyle],["audio",aA.emojiStyle],["video",sA.emojiStyle],["text",dA.emojiStyle],["model",cA.emojiStyle]]),mc=new Map([["zone","Zone"],["station","Station"],["ambientAudio","Environment Audio"],["sign","Sign"],["audio","Voice Over"],["video","Video Clip"],["text","Text"],["model","3D Model"],["connection","Station Connection"]]),Wo=new Map([["delete",uA.emojiStyle+" Delete"],["readonly",rA.emojiStyle+" Cannot edit published scenario"]]);for(let[r,t]of mc)Wo.set(r,Rf.get(r)+" "+t);var gze=Array.from(Rf.keys()),ZE=Array.from(mc.keys());function Bf(r){return`/images/markers/${r}.png`}var hp=class extends Ae{constructor(e,n){super("transformmoved");this.object=e;this.transform=n}},vi=class extends qe{constructor(e,n,i,o){super();this.scenario=e;this.assets=n;this.assetsByStation=i;this.assetName=o}saveTransformThrottled(e,n){this.scenario.transformAdapter.saveMatrixThrottled(n),this.dispatchEvent(new hp(e,n))}async saveTransform(e,n){await this.scenario.transformAdapter.saveMatrix(n),this.dispatchEvent(new hp(e,n))}async createTransformAndSaveAsset(e,n,i){let o=await this.scenario.postFor("Create",this.assetName,e,n).then(tt),s=this.scenario.addTransformData(o.transform);this.scenario.getTransform(o.transform.parentTransformID).attach(s);let c=await this.createAsset(o,i);return i.end(),c}async createEditorAssets(e){if(!this.scenario.fileMarkers.has(e.transformID)){let n=this.scenario.getTransform(e.transformID),i=T(e.error)?"error-":"",o=await this.scenario.createMarker(e,e.transformID,e.fileName,Bf(i+this.getMarkerImagePath(e)));T(o)&&(o.addListener("click",()=>this.onMarkerSelected(e,!1)),o.addListener("contextmenu",()=>this.onMarkerSelected(e,!0)),this.scenario.published||(o.setDraggable(!0),o.setCursor("move"),o.addListener("dragend",s=>{let l=this.scenario.getTransformPosition(e.transformID);this.moveTransformThrottled(e,n,s.latLng.lat(),s.latLng.lng(),l.alt),this.scenario.dispatchEvent(new Fa(e))})))}}onTransformMoved(e,n){this.scenario.transformAdapter.updateMarker(n,e),this.scenario.dispatchEvent(new Fa(e)),this.dispatchEvent(new hp(e,n))}moveTransformThrottled(e,n,i,o,s){this.scenario.moveTransformByGeoThrottled(n,i,o,s),this.onTransformMoved(e,n)}async moveTransform(e,n,i,o,s){await this.scenario.moveTransformByGeo(n,i,o,s),this.onTransformMoved(e,n)}resetThrottled(e,n){let i=this.scenario.getTransform(e.transformID);i.position.set(0,n,-2),i.quaternion.identity(),this.saveTransformThrottled(e,i),this.scenario.transformAdapter.updateMarker(i,e)}async reset(e,n){let i=this.scenario.getTransform(e.transformID);i.position.set(0,n,-2),i.quaternion.identity(),await this.saveTransform(e,i),this.scenario.transformAdapter.updateMarker(i,e)}async delete(e){let n=this.scenario.fileMarkers.get(e.transformID),i=this.scenario.getTransform(e.transformID),o=i&&this.scenario.findStation(i);await this.scenario.post("Delete",this.assetName,e.key),Wt(this.assets,e),this.assetsByStation.remove(o,e),T(i)&&await this.scenario.removeTransform(i),T(n)&&(n.setMap(null),this.scenario.fileMarkers.delete(e.transformID)),e.dispose()}};function e_(r){let t=null,e=r.getLabel();return et(e)?t=e:t=e.text,t}var Vf=class{constructor(t){this.scenario=t}async create(t,e,n,i,o,s){let l=new en(n,i,o);await this.scenario.resolveOrigin(l);let c=this.scenario.latLngToVector(l),u=new Vt().makeTranslation(c.x,c.y,c.z),p=await this.scenario.transformAdapter.create(this.scenario.rootTransform.transformID,e,u.toArray()),f=this.scenario.addTransformData(p);this.scenario.rootTransform.attach(f);let w={transformID:f.transformID,fileID:t,rotation:[0,0,0,1],latitude:n,longitude:i,altitude:o},[A,m]=Up(s,2),d=await this.scenario.postFor("Add","Stations",w,A).then(tt),h=await this.scenario.createStation(d,m);return fe(this.scenario.startStationID)&&(this.scenario.startStationID=h.transformID),this.scenario.stations.push(h),h}async markStart(t){let e=this.scenario.startStation,n=e&&this.scenario.fileMarkers.get(e.transformID);await this.scenario.post("MarkStart","Stations",t.transformID),this.scenario.startStationID=t.transformID,e=this.scenario.startStation;let i=e&&this.scenario.fileMarkers.get(this.scenario.startStation.transformID);if(T(n)){let o=e_(n);o=o.substring(yo.emojiStyle.length),n.setLabel(o)}if(T(i)){let o=e_(i);o=yo.emojiStyle+o,i.setLabel(o)}}setStartRotation(t,e){this.scenario.startStation===t&&(this.scenario.startRotation=e,this.scenario.throttle(`updateScenarioStartRotation::${this.scenario.id}`,()=>this.scenario.post("SetStartRotation","Stations",e)))}async createEditorAssets(t){await this.createMarker(t)}async createMarker(t){let e=this.scenario.fileMarkers.get(t.transformID);e&&e.setMap(null);let n=t.fileName;t.transformID===this.scenario.startStationID&&(n=yo.emojiStyle+n),e=await this.scenario.createMarker(t,t.transformID,n,Bf(Jpe)),T(e)&&(e.addListener("click",()=>this.onMarkerSelected(t,!1)),e.addListener("contextmenu",()=>this.onMarkerSelected(t,!0)),this.scenario.published||(e.setDraggable(!0),e.setCursor("move"),e.addListener("drag",i=>{for(let[o,s,l]of this.scenario.lines.entries())if(o===t.transformID||s===t.transformID){let c=l.getPath(),u=o===t.transformID?0:1;c.setAt(u,i.latLng)}}),e.addListener("dragend",async i=>{this.scenario.dispatchEvent(new T1(t,qi(i.latLng))),this.scenario.dispatchEvent(new Fa(t))})))}onMarkerSelected(t,e){this.scenario.dispatchEvent(new mp(t)),this.scenario.dispatchEvent(new Qn(t,e))}moveThrottled(t,e,n,i,o){let s=this.setMoveData(o,t,e,n,i);this.scenario.moveTransformByGeoThrottled(s,e,n,i),this.getMoveData(t,s)}async move(t,e,n,i,o){let s=this.setMoveData(o,t,e,n,i);await this.scenario.moveTransformByGeo(s,e,n,i),this.getMoveData(t,s)}getMoveData(t,e){t.transformID===this.scenario.curStationID&&e.getWorldPosition(this.scenario.env.stage.position)}setMoveData(t,e,n,i,o){return t?this.updateThrottled(e,{latitude:n,longitude:i,altitude:o,rotation:[0,0,0,1]}):this.updateThrottled(e,{latitude:n,longitude:i,altitude:o}),this.scenario.getTransform(e.transformID)}updateThrottled(t,e){this.setUpdateData(e,t),this.scenario.throttle(`updateStation::${t.transformID}`,()=>this.scenario.post("Update","Stations",e)),this.getUpdateData(t,e)}async update(t,e){this.setUpdateData(e,t),await this.scenario.post("Update","Stations",e),this.getUpdateData(t,e)}copy(t,e,n){wi(t,e,n,"fileName","zone","rotation","label")}setUpdateData(t,e){t.stationID=e.key,this.copy(!1,t,e),"latitude"in t||(t.latitude=e.location.lat),"longitude"in t||(t.longitude=e.location.lng),"altitude"in t||(t.altitude=e.location.alt)}getUpdateData(t,e){this.copy(!0,t,e),t.location.lat=e.latitude,t.location.lng=e.longitude,t.location.alt=e.altitude,this.scenario.fileMarkers.get(t.transformID).setLabel(e.fileName),this.scenario.refreshZones(),this.scenario.env.skybox.rotation=t.rotation,this.scenario.curStation===t&&(this.scenario.env.infoLabel.image.value=t.label||t.fileName)}async delete(t){let e=this.scenario.getTransform(t.transformID),n=this.scenario.fileMarkers.get(t.transformID),i=this.scenario.connections.filter(s=>s.fromStationID===t.transformID||s.toStationID===t.transformID),o=this.scenario.startStationID;if(this.scenario.startStationID=await this.scenario.postFor("Delete","Stations",t.transformID).then(tt),this.scenario.startStationID!==o&&this.scenario.startStationID){let s=this.scenario.startStation,l=this.scenario.fileMarkers.get(s.transformID);T(l)&&l.setLabel(yo.emojiStyle+s.fileName)}t.transformID===this.scenario.curStationID&&(this.scenario.curStationID=null);for(let s of i){let l=this.scenario.getStation(s.fromStationID),c=this.scenario.getStation(s.toStationID);await this.scenario.connectionAdapter.disconnect(l,c)}n.setMap(null),this.scenario.fileMarkers.delete(t.transformID),Wt(this.scenario.stations,t),await this.scenario.removeTransform(e)}},Jpe="globe",mp=class extends Ae{constructor(e){super("stationselected");this.station=e}},T1=class extends Ae{constructor(e,n){super("stationmarkermoved");this.station=e;this.latLng=n}};var Fi=class extends Ae{constructor(e,n){super(`${e}selected`);this.subType=e;this.object=n}};var Qpe="sound",$pe="disc",E1=class extends Fi{constructor(e){super("audio",e);this.audio=e}},Of=class extends vi{constructor(t){super(t,t.audios,t.audiosByStation,"AudioTracks"),this.addEventListener("transformmoved",e=>{e.object.spatialize&&e.object.updateAudioPosition()})}createAsset(t,e){return this.scenario.createAudio(t.audioTrack,e)}create(t,e,n){let[i,o]=Gt(n,[2,1]),s=t||this.scenario.rootTransform,l={fileID:e.id,spatialize:s!==t,parentTransformID:s.transformID};return this.createTransformAndSaveAsset(l,i,o)}getMarkerImagePath(t){return t.spatialize?$pe:Qpe}onMarkerSelected(t,e){this.scenario.dispatchEvent(new E1(t)),this.scenario.dispatchEvent(new Qn(t,e))}changeElevationThrottled(t,e){let{transform:n,latLng:i}=this.setChangeElevationData(t);this.moveTransformThrottled(t,n,i.lat(),i.lng(),e)}async changeElevation(t,e){let{transform:n,latLng:i}=this.setChangeElevationData(t);await this.moveTransform(t,n,i.lat(),i.lng(),e)}setChangeElevationData(t){let n=this.scenario.fileMarkers.get(t.transformID).getPosition();return{transform:this.scenario.getTransform(t.transformID),latLng:n}}async createEditorAssets(t){await super.createEditorAssets(t),t.spatialize&&t.zone===this.scenario.curZone&&t.play()}resetThrottled(t,e){let n=t.spatialize?0:e;super.resetThrottled(t,n)}async reset(t,e){let n=t.spatialize?0:e;await super.reset(t,n)}updateThrottled(t,e){this.setUpdateData(e,t),this.scenario.throttle(`updateAudioTrack::${e.id}`,()=>this.scenario.post("Update","AudioTracks",e)),this.getUpdateData(t,e)}async update(t,e){this.setUpdateData(e,t),await this.scenario.post("Update","AudioTracks",e),this.getUpdateData(t,e)}copy(t,e,n){wi(t,e,n,"fileName","enabled","label","minDistance","maxDistance","volume","zone","effect")}setUpdateData(t,e){t.id=e.key,this.copy(!1,t,e)}getUpdateData(t,e){this.copy(!0,t,e),T(t.controls)&&(t.controls.volume=e.volume,t.controls.label=e.label);let n=this.scenario.env.audio.getClip(t.transformID.toString());T(n)&&(n.volume=e.volume,n.spatializer.setAudioProperties(e.minDistance,e.maxDistance,this.scenario.env.audio.algorithm),n.setEffects(e.effect),e.enabled&&e.zone===this.scenario.curZone?n.playbackState!=="playing"&&n.play():n.playbackState!=="stopped"&&n.stop())}getStation(t){let e=t&&this.scenario.getTransform(t.transformID);return e&&this.scenario.findStation(e)}async delete(t){let{zone:e,clip:n}=t;await super.delete(t),t.spatialize&&this.scenario.zonedClips.remove(e,n)}};var Nf=class{constructor(t){this.scenario=t}async createEditorAssets(t){if(t.transformID<0){let s=this.scenario.getTransform(t.transformID),l=s.data,c=await this.scenario.transformAdapter.create(l.parentTransformID,l.name,l.matrix);this.scenario.transformsByTransformID.delete(l.id),this.scenario.transformsByTransformID.set(c.id,s),t.transformID=c.id,s.data.id=c.id,await this.update(t,t.label),await this.reset(t)}let e=this.scenario.getStation(t.fromStationID),n=this.scenario.getStation(t.toStationID),i=[e,n].map(s=>s.location),o=this.scenario.createLine(i);this.scenario.lines.add(e.transformID,n.transformID,o)}getConnectableStations(t){let e=t&&this.scenario.connections.filter(n=>n.fromStationID===t.transformID).map(n=>n.toStationID);return t&&this.scenario.stations.filter(n=>n.transformID!==t.transformID&&e.indexOf(n.transformID)===-1)}findConnection(t,e){for(let n of this.scenario.connections)if(n.fromStationID==t.transformID&&n.toStationID==e.transformID)return n;return null}async create(t,e){let n={fromStationID:t.transformID,toStationID:e.transformID},i={fromStationID:e.transformID,toStationID:t.transformID};await An(this.createConnectionHalf(n),this.createConnectionHalf(i))}async createConnectionHalf(t){await this.scenario.post("Create","Connections",t);let e=await this.scenario.createConnection(t);this.scenario.connections.push(t),await this.scenario.transformAdapter.saveMatrix(e.transform)}async reset(t){let e=this.scenario.getStation(t.fromStationID),n=this.scenario.getStation(t.toStationID),o=this.scenario.curConnections.get(e).get(n);o.resetPosition(),await this.scenario.transformAdapter.saveMatrix(o.transform)}updateThrottled(t,e){let n=this.setConnectionUpdateData(t,e);this.scenario.throttle(`updateConnectionLabel::${t.fromStationID} -> ${t.toStationID}`,()=>this.scenario.post("Update","Connections",n))}async update(t,e){let n=this.setConnectionUpdateData(t,e);await this.scenario.post("Update","Connections",n)}setConnectionUpdateData(t,e){t.label=e;let n=this.scenario.getStation(t.fromStationID),i=this.scenario.curConnections.get(n);if(i){let o=this.scenario.getStation(t.toStationID),s=i.get(o);s.label=e}return{transformID:t.transformID,fromStationID:t.fromStationID,toStationID:t.toStationID,label:e}}async disconnect(t,e){await An(this.scenario.post("Delete","Connections",{fromStationID:t.transformID,toStationID:e.transformID}),this.removeConnection(t,e),this.removeConnection(e,t))}async removeConnection(t,e){let n=this.findConnection(t,e);Wt(this.scenario.connections,n);let i=this.scenario.lines.get(t.transformID,e.transformID);i&&(i.setMap(null),this.scenario.lines.delete(e.transformID,e.transformID));let o=this.scenario.curConnections.get(t,e);o&&(await this.scenario.removeTransform(o.transform),this.scenario.curConnections.delete(t,e),St(o))}};var Zpe="joy",_1=class extends Fi{constructor(t){super("model",t)}},Hf=class extends vi{constructor(t){super(t,t.models,t.modelsByStation,"Models")}createAsset(t,e){return this.scenario.createModel(t.model,e)}create(t,e,n){let[i,o]=Gt(n,[2,1]),s=t||this.scenario.rootTransform,l={fileID:e.id,parentTransformID:s.transformID};return this.createTransformAndSaveAsset(l,i,o)}getMarkerImagePath(){return Zpe}onMarkerSelected(t,e){this.scenario.dispatchEvent(new _1(t)),this.scenario.dispatchEvent(new Qn(t,e))}setSize(t,e){let n=this.scenario.getTransform(t.transformID);t.size=e,this.saveTransformThrottled(t,n)}setRotation(t,e,n,i){let o=this.scenario.getTransform(t.transformID);o.rotation.set(at(e),at(n),at(i),"XYZ"),this.saveTransformThrottled(t,o)}getStation(t){let e=t&&this.scenario.getTransform(t.transformID);return e&&this.scenario.findStation(e)}async update(t,e){this.setUpdateData(e,t),await this.scenario.post("Update","Models",e),this.getUpdateData(t,e)}updateThrottled(t,e){this.setUpdateData(e,t),this.scenario.throttle(`updateModel::${e.id}`,()=>this.scenario.post("Update","Models",e)),this.getUpdateData(t,e)}copy(t,e,n){wi(t,e,n,"fileName")}getUpdateData(t,e){this.copy(!0,t,e)}setUpdateData(t,e){t.id=e.key,this.copy(!1,t,e)}};var ede="painting",M1=class extends Fi{constructor(t){super("sign",t)}},Wf=class extends vi{constructor(t){super(t,t.signs,t.signsByStation,"Signs")}async loadSignImage(t,e){let n=await this.scenario.env.fetcher.get(t.filePath).progress(e).file();if(vo.matches(n.contentType)){let i=new Vi(n.content,{scale:2});return await i.getPage(0),i.canvas}else return await this.scenario.env.fetcher.get(n.content).image().then(tt)}createAsset(t,e){return this.scenario.createSign(t.sign,e)}async create(t,e,n){let[i,o,s]=Gt(n,[1,2,1]),l=await this.loadSignImage(e,i),c={parentTransformID:(t||this.scenario.rootTransform).transformID,fileID:e.id,imageWidth:l.width,imageHeight:l.height};return await this.createTransformAndSaveAsset(c,o,s)}getMarkerImagePath(){return ede}onMarkerSelected(t,e){this.scenario.dispatchEvent(new M1(t)),this.scenario.dispatchEvent(new Qn(t,e))}resetThrottled(t,e){let n=t.image.imageWidth/So,i=cs(n);t.size=i,super.resetThrottled(t,e)}async reset(t,e){let n=t.image.imageWidth/So,i=cs(n);t.size=i,await super.resetThrottled(t,e)}async update(t,e){this.setUpdateData(e,t),await this.scenario.post("Update","Signs",e),this.getUpdateData(t,e)}updateThrottled(t,e){this.setUpdateData(e,t),this.scenario.throttle(`updateSign::${e.id}`,()=>this.scenario.post("Update","Signs",e)),this.getUpdateData(t,e)}copy(t,e,n){wi(t,e,n,"fileName","isCallout","alwaysVisible")}setUpdateData(t,e){t.id=e.key,this.copy(!1,t,e)}getUpdateData(t,e){this.copy(!0,t,e)}setSize(t,e){t.size=e;let n=this.scenario.getTransform(t.transformID);this.saveTransformThrottled(t,n)}setRotation(t,e,n,i){let o=this.scenario.getTransform(t.transformID);o.rotation.set(at(e),at(n),at(i),"XYZ"),this.saveTransformThrottled(t,o)}getStation(t){let e=t&&this.scenario.getTransform(t.transformID);return e&&this.scenario.findStation(e)}};var tde="pad",k1=class extends Fi{constructor(t){super("text",t)}},Uf=class extends vi{constructor(t){super(t,t.texts,t.textsByStation,"Texts")}createAsset(t,e){return this.scenario.createText(t.text,e)}async create(t,e,n){let[i,o]=Gt(n,[1,1]),s={parentTransformID:(t||this.scenario.rootTransform).transformID,fileID:e.id};return await this.createTransformAndSaveAsset(s,i,o)}getMarkerImagePath(){return tde}onMarkerSelected(t,e){this.scenario.dispatchEvent(new k1(t)),this.scenario.dispatchEvent(new Qn(t,e))}resetThrottled(t,e){let n=t.image.imageWidth/So,i=cs(n);t.size=i,super.resetThrottled(t,e)}async reset(t,e){let n=t.image.imageWidth/So,i=cs(n);t.size=i,await super.resetThrottled(t,e)}async update(t,e){this.setUpdateData(e,t),await this.scenario.post("Update","Texts",e),this.getUpdateData(t,e)}updateThrottled(t,e){this.setUpdateData(e,t),this.scenario.throttle(`updateText::${e.id}`,()=>this.scenario.post("Update","Texts",e)),this.getUpdateData(t,e)}copy(t,e,n){wi(t,e,n,"text","fileName","isCallout","alwaysVisible")}setUpdateData(t,e){t.id=e.key,this.copy(!1,t,e)}getUpdateData(t,e){this.copy(!0,t,e)}setSize(t,e){t.size=e;let n=this.scenario.getTransform(t.transformID);this.saveTransformThrottled(t,n)}setRotation(t,e,n,i){let o=this.scenario.getTransform(t.transformID);o.rotation.set(at(e),at(n),at(i),"XYZ"),this.saveTransformThrottled(t,o)}getStation(t){let e=t&&this.scenario.getTransform(t.transformID);return e&&this.scenario.findStation(e)}};var zf=class extends Ae{constructor(e){super("objectmoved");this.object=e}};var jf=class{constructor(t){this.scenario=t}async create(t,e,n){let i={parentTransformID:t,name:e,matrix:n};return await this.scenario.postFor("Create","Transforms",i).then(tt)}getChangedMatrices(t){let e=[t];return t.traverse(n=>{n instanceof gi&&(n.updateMatrixWorld(),e.push(n))}),e.map(n=>({transformID:n.transformID,matrix:n.matrixWorld.toArray()}))}saveMatrixThrottled(t){let e=this.getChangedMatrices(t);for(let n of e)this.scenario.throttle(`saveTransformPosition::${n.transformID}`,()=>this.scenario.post("Move","Transforms",n))}async saveMatrix(t){let e=this.getChangedMatrices(t);await Promise.all(e.map(n=>this.scenario.post("Move","Transforms",n)))}updateMarker(t,e){if(T(e)){let n=this.scenario.getTransformPosition(t.transformID);this.scenario.fileMarkers.get(t.transformID).setPosition(ki(n)),this.scenario.dispatchEvent(new zf(e))}}};var nde="clapper",C1=class extends Fi{constructor(t){super("video",t)}},Gf=class extends vi{constructor(t){super(t,t.videos,t.videosByStation,"VideoClips")}createAsset(t,e){return this.scenario.createVideo(t.videoClip,e)}create(t,e,n){let[i,o]=Gt(n,[2,1]),s={fileID:e.id,parentTransformID:t.transformID};return this.createTransformAndSaveAsset(s,i,o)}getMarkerImagePath(){return nde}onMarkerSelected(t,e){this.scenario.dispatchEvent(new C1(t)),this.scenario.dispatchEvent(new Qn(t,e))}saveTransformThrottled(t,e){e.scale.setScalar(t.size),super.saveTransformThrottled(t,e),e.scale.setScalar(1)}setSphereEncodingAndLayout(t,e,n){return this.scenario.env.videoPlayer.isSupported(e,n)?(this.updateThrottled(t,{sphereEncodingName:e,stereoLayoutName:n}),!0):!1}setSize(t,e){t.size=e;let n=this.scenario.getTransform(t.transformID);this.saveTransformThrottled(t,n)}setRotation(t,e,n,i){let o=this.scenario.getTransform(t.transformID);o.rotation.set(at(e),at(n),at(i),"XYZ"),this.saveTransformThrottled(t,o)}updateThrottled(t,e){this.setUpdateData(e,t),this.scenario.throttle(`updateVideo::${e.id}`,()=>this.scenario.post("Update","VideoClips",e)),this.getUpdateData(t,e)}async update(t,e){this.setUpdateData(e,t),await this.scenario.post("Update","VideoClips",e),this.getUpdateData(t,e)}copy(t,e,n){wi(t,e,n,"fileName","sphereEncodingName","stereoLayoutName","enabled","label","volume")}setUpdateData(t,e){t.id=e.key,this.copy(!1,t,e)}getUpdateData(t,e){this.copy(!0,t,e),T(t.controls)&&(t.controls.volume=e.volume,t.controls.label=e.label);let n=this.scenario.env.audio.getClip(t.transformID.toString());T(n)&&(n.volume=e.volume)}getStation(t){let e=t&&this.scenario.getTransform(t.transformID);return e&&this.scenario.findStation(e)}};var fc=class extends pp{constructor(e,n,i,o){super(e,i,n);this.map=o;this.throttlers=new Map;this.fileMarkers=new Map;this.lines=new Yn;this.zones=new Array;this.transformAdapter=new jf(this);this.stationAdapter=new Vf(this);this.connectionAdapter=new Nf(this);this.signAdapter=new Wf(this);this.audioAdapter=new Of(this);this.videoAdapter=new Gf(this);this.textAdapter=new Uf(this);this.modelAdapter=new Hf(this);this.versions=n.versions}dispose(){for(let e of this.fileMarkers.values())e.setMap(null);this.fileMarkers.clear();for(let e of this.lines.values())e.setMap(null);this.lines.clear(),super.dispose()}throttle(e,n){this.throttlers.has(e)||this.throttlers.set(e,new Gl),this.throttlers.get(e).throttle(n)}refreshZones(){let e=new Array;for(let i of this.stations)T(i.zone)&&ri(e,i.zone,!1);for(let i of this.audios)T(i.zone)&&ri(e,i.zone,!1);let n=e.length!==this.zones.length||!e.every((i,o)=>i===this.zones[o]);Un(this.zones,...e),n&&this.dispatchEvent(new Ae("zonesupdated"))}async loadAssets(e){await super.loadAssets(e),this.refreshZones()}toggleMarkers(){for(let e of this.fileMarkers.values())e.setVisible(!e.getVisible())}makeOnlyStationsSelectable(e){let n=e.map(i=>i.key);for(let[i,o]of this.fileMarkers.entries()){let s=n.indexOf(i)>-1;o.setOpacity(s?1:.5),o.setClickable(s)}}makeAllMarkersSelectable(){for(let e of this.fileMarkers.values())e.setOpacity(1),e.setClickable(!0)}async createStation(e,n){let i=await super.createStation(e,n);return this.cancellationToken.check(),T(i)&&(await this.stationAdapter.createEditorAssets(i),this.cancellationToken.check()),i}async createConnection(e){let n=super.createConnection(e);return T(n)&&(await this.connectionAdapter.createEditorAssets(e),this.cancellationToken.check()),n}async createAudio(e,n){let i=await super.createAudio(e,n);return this.cancellationToken.check(),T(i)&&(await this.audioAdapter.createEditorAssets(i),this.cancellationToken.check()),i}async createSign(e,n){let i=await super.createSign(e,n);return this.cancellationToken.check(),T(i)&&(await this.signAdapter.createEditorAssets(i),this.cancellationToken.check()),i}async createVideo(e,n){let i=await super.createVideo(e,n);return this.cancellationToken.check(),T(i)&&(await this.videoAdapter.createEditorAssets(i),this.cancellationToken.check()),i}async createText(e,n){let i=await super.createText(e,n);return this.cancellationToken.check(),T(i)&&(await this.textAdapter.createEditorAssets(i),this.cancellationToken.check()),i}async createModel(e,n){let i=await super.createModel(e,n);return this.cancellationToken.check(),T(i)&&(await this.modelAdapter.createEditorAssets(i),this.cancellationToken.check()),i}makePost(e,n,i,o){return this.env.fetcher.post(`/Editor/Scenarios/${n}/${this.id}`).query("handler",e).body(i,wo).progress(o)}postFor(e,n,i,o){return this.makePost(e,n,i,o).object()}post(e,n,i,o){return this.makePost(e,n,i,o).exec()}async publish(){await this.post("Publish","Layout"),this.data.published=!0}fork(){return this.postFor("Fork","Layout")}async resolveOrigin(e){fe(this._originLL)&&await this.setOrigin(e)}async setOrigin(e){fe(e)?(this._originLL=null,await this.post("SetOrigin","Layout",null)):(this._originLL=new en(e),await this.post("SetOrigin","Layout",{lat:this._originLL.lat,lng:this._originLL.lng,alt:this._originLL.alt}))}vectorToLatLng(e){let n=this.originUTM.toVec3(),i=Ms.fromValues(e.x,e.y,e.z),o=Ms.add(Ms.create(),n,i);return new xi().fromVec3(o,this.originUTM.zone).toLatLng()}latLngToVector(e){let n=this.originUTM.toVec3(),o=e.toUTM().rezone(this.originUTM.zone).toVec3(),s=Ms.sub(Ms.create(),o,n);return new Ie().fromArray(s)}moveTransformByGeoThrottled(e,n,i,o){this.setMoveTransforByGeoData(n,i,o,e),this.transformAdapter.saveMatrixThrottled(e)}async moveTransformByGeo(e,n,i,o){this.setMoveTransforByGeoData(n,i,o,e),await this.transformAdapter.saveMatrix(e)}setMoveTransforByGeoData(e,n,i,o){let s=new en(e,n,i),l=this.latLngToVector(s);aS(o,l)}async createMarker(e,n,i,o){if(fe(this.map))return null;let s=null;NT(e)?s=e.location:HT(e)&&(s=this.getTransformPosition(e.transformID));let l=await this.map.createMarker(s,i,o);return l.addListener("click",()=>this.map.setTarget(qi(l.getPosition()))),this.fileMarkers.set(n,l),l}createLine(e){return fe(this.map)?null:this.map.createLine(e)}getTransformPosition(e){let n=this.getTransform(e);if(fe(n))throw new Error("Couldn't find transform");let i=n.getWorldPosition(new Ie);return this.vectorToLatLng(i)}findAssetForTransform(e,n){for(let i of n)if(i.transformID===e)return i;return null}getAssetForTransform(e){return this.findAssetForTransform(e.transformID,this.stations)||this.findAssetForTransform(e.transformID,this.audios)||this.findAssetForTransform(e.transformID,this.videos)||this.findAssetForTransform(e.transformID,this.texts)||this.findAssetForTransform(e.transformID,this.signs)||this.findAssetForTransform(e.transformID,this.models)||this.findAssetForTransform(e.transformID,this.connections)}async removeTransform(e){e.parent.remove(e),St(e);let n=new Array(e);e.traverse(i=>{i instanceof gi&&n.push(i)});for(let i of n){let o=i.transformID;this.transformsByTransformID.delete(o);let s=this.getStation(o);if(s){this.signsByStation.delete(s),this.modelsByStation.delete(s),this.audiosByStation.delete(s),this.videosByStation.delete(s),this.textsByStation.delete(s),this.curConnections.delete(s);let l=new Array;for(let[c,u]of this.curConnections.entries())u===s&&l.push(c);for(let c of l)this.curConnections.delete(c,s)}}T(this.originLL)&&this.isEmpty&&await this.setOrigin(null)}async showStation(e,n,i){await super.showStation(e,n,i),this.dispatchEvent(new Qn(e,!1))}async showStationNow(e){this.visible=!0,this.curStation!==e&&(await this.showStation(e,!1),this.dispatchEvent(new mp(e)))}log(){}};var Xf=class extends kf{constructor(e,n,i,o){super(`/editor/scenarios/layout/${o}`);this.env=e;this.dataLogger=n;this.map=i}createScenario(e){return new fc(this.env,e,this.dataLogger,this.map)}};function qf(r,t,e){let n=s=>T(s)&&T(e)&&e(s),i=new gc(null),o=new Map;for(let s of r){let l=new gc(s);o.set(s,l)}for(let s of o.values()){let l=t(s.value);(l!=null&&o.has(l)?o.get(l):i).connectSorted(s,n)}return i}var gc=class extends al{get depth(){let t=0,e=this.parent;for(;T(e);)++t,e=e.parent;return t}removeFromParent(){for(;this.parent;)this.parent.disconnectFrom(this)}connectTo(t){t.removeFromParent(),super.connectTo(t)}connectAt(t,e){t.removeFromParent(),super.connectAt(t,e)}connectSorted(t,e){t.removeFromParent(),super.connectSorted(t,e)}get parent(){return this._reverse.length===0?null:this._reverse[0]}get children(){return this._forward}get isRoot(){return this._isEntryPoint}get isChild(){return!this._isEntryPoint}get isLeaf(){return this._isExitPoint}get hasChildren(){return!this._isExitPoint}};var D1=class extends Ae{constructor(e){super("click");this.node=e}},Aa=class extends Ae{constructor(e){super("select");this.node=e}},Kf=class extends Ae{constructor(e,n){super(e);this.parent=n;this._finished=new mt}get finished(){return this._finished}complete(){this._finished.resolve()}},P1=class extends Kf{constructor(t){super("add",t)}},fp=class extends Kf{constructor(t){super("contextmenu",t)}},Yf=class extends qe{constructor(e,n,i,o,s,l,c,u){super();this.node=e;this.defaultLabel=n;this._getLabel=i;this._getDescription=o;this._canChangeOrder=s;this._getChildDescription=l;this._canHaveChildren=c;this.createElement=u;this.refresh=Jl(()=>this.onRefresh());let p=f=>pt(w=>{this.enabled&&(w.preventDefault(),w.cancelBubble=!0,f(w))});this.element=De(Xe("tree-view-node"),this.upper=De(Xe("drag-buffer top")),this.infoView=De(Xe("tree-view-node-label"),Bc(this.canChangeOrder),p(()=>{this.selected||this._select(!0)}),gA(f=>{this.enabled&&this.canHaveChildren&&(f.preventDefault(),f.cancelBubble=!0,this.isOpen=!this.isOpen)}),this.collapser=Ps(Xe("tree-view-node-collapser"),pt(f=>{this.canHaveChildren?(f.preventDefault(),f.cancelBubble=!0,this.isOpen=!this.isOpen):this._select(!0)})),this.labeler=Ui(this.label,fd(async f=>{this.enabled&&await this._launchMenu(f,new fp(this))}))),this.subView=De(Xe("tree-view-node-children"),this.children=De(),this.adder=Ps(Xe("tree-view-node-adder"),Er(this.adderTitle),p(async f=>{this.canHaveChildren&&await this._launchMenu(f,new P1(this))}),iA.emojiStyle)),this.lower=De(Xe("drag-buffer bottom"))),this.refresh(),this.isOpen=e.isRoot}async _launchMenu(e,n){e.preventDefault(),e.cancelBubble=!0,this.adder.disabled=!0;try{this.dispatchEvent(n),await n.finished}catch{n.complete()}finally{this.adder.disabled=!1}}onRefresh(){this.node.isRoot!==(this.adder.parentElement===this.subView)&&(this.node.isRoot?this.subView.append(this.adder):this.infoView.append(this.adder));let e=this.canHaveChildren&&this.node.hasChildren&&this.node.isChild;_a(this.collapser,this.collapserTitle),Ye(this.collapser,e?this.isOpen?tu.emojiStyle:hd.emojiStyle:UF.emojiStyle),this.collapser.style.opacity=e?"1":"0",Ye(this.labeler,this.label),_a(this.adder,this.adderTitle),st(this.adder,this.canHaveChildren,"inline-block"),st(this.upper,this.node.isChild&&this.canChangeOrder&&fe(this.element.previousSibling)),st(this.lower,this.node.isChild&&this.canChangeOrder),this.collapser.disabled=this.disabled&&!this.specialSelectMode||this.node.isRoot,this.adder.disabled=this.disabled||this.specialSelectMode}get specialSelectMode(){return this.adder.classList.contains("disabled")}set specialSelectMode(e){e!==this.specialSelectMode&&(this.adder.classList.toggle("disabled"),this.refresh())}get canHaveChildren(){return this._canHaveChildren(this.node)}get label(){return T(this.node.value)?this._getLabel(this.node.value):this.defaultLabel}get description(){return T(this.node.value)?this._getDescription(this.node.value):null}get childDescription(){return T(this.node.value)?this._getChildDescription(this.node.value):null}get canChangeOrder(){return T(this.node.value)&&this._canChangeOrder(this.node.value)}get collapserTitle(){return this.canHaveChildren?this.isOpen?"Collapse "+this.description:"Expand "+this.description:"Select "+this.description}get adderTitle(){return"Add "+this.childDescription}get disabled(){return this.element.classList.contains("disabled")}set disabled(e){e!==this.disabled&&(this.element.classList.toggle("disabled"),this.refresh())}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get filtered(){return this.element.classList.contains("filtered")}set _filtered(e){e!==this.filtered&&this.element.classList.toggle("filtered")}get selected(){return this.element.classList.contains("selected")}set _selected(e){e!==this.selected&&this.element.classList.toggle("selected")}get highlighted(){return this.element.classList.contains("highlighted")?0:this.upper.classList.contains("highlighted")?-1:this.lower.classList.contains("highlighted")?1:null}set highlighted(e){e!==this.highlighted&&(this.element.classList.remove("highlighted"),this.upper.classList.remove("highlighted"),this.lower.classList.remove("highlighted"),e===0?this.element.classList.add("highlighted"):e===-1?this.upper.classList.add("highlighted"):e===1&&this.lower.classList.add("highlighted"))}get isOpen(){return zn(this.subView)}set isOpen(e){e!==this.isOpen&&(st(this.subView,e),this.refresh())}add(e){this.isOpen=!0;let n=new gc(e);this.node.connectTo(n),this.createElement(n),this.refresh()}_select(e){if(this.dispatchEvent(new D1(this.node)),!this.selected){let n=new Aa(this.node);n.cancelBubble=!e,this.dispatchEvent(n)}}scrollIntoView(){this.element.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}};function Jf(r,t=null){return e=>{try{return r(e)}catch{return t}}}var L1=class extends Ae{constructor(e){super("itemselected");this.item=e}},Qf=class extends qe{constructor(e,n,i,o){super();this.element=fr(Ne("custom-select"));this.itemToOption=new Map;this.optionToItem=new Map;this._emptySelectionEnabled=!1;this._values=null;this.makeID=Jf(e),this.makeLabel=Jf(n,"None"),this.getSortKey=Jf(i),this.noSelection=Bn(o),this.emptySelectionEnabled=!fe(o),this.element.addEventListener("input",()=>this.dispatchEvent(new L1(this.selectedValue))),Object.seal(this)}get disabled(){return this.element.disabled}set disabled(e){this.element.disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get count(){return this._values&&this._values.length||0}get emptySelectionEnabled(){return this._emptySelectionEnabled}set emptySelectionEnabled(e){e!==this.emptySelectionEnabled&&(this._emptySelectionEnabled=e,this.render())}get values(){return this._values||[]}set values(e){if(e=e||null,e!==this._values){let n=this.selectedValue;this._values=e,this.render(),this.selectedValue=n}}get selectedOption(){return this.element.selectedOptions.item(0)}set selectedOption(e){for(let n=0;n<this.element.options.length;++n){let i=this.element.options[n];i.selected=i===e}}get selectedValue(){return this.optionToItem.get(this.selectedOption)}set selectedValue(e){this.selectedOption=this.itemToOption.get(this.makeID(e))}refresh(){this.render()}render(){if(Bt(this),this.itemToOption.clear(),this.optionToItem.clear(),(this.count===0||this.emptySelectionEnabled)&&this.append(null,this.noSelection),this.count>0){let e=ya(this.values,this.getSortKey);for(let n of e){let i=this.makeOption(n);this.append(n,i)}}}makeOption(e){let n=Bn(hn(this.makeID(e)),this.makeLabel(e));return this.itemToOption.set(this.makeID(e),n),this.optionToItem.set(n,e),n}append(e,n){this.element.append(n),this.itemToOption.set(this.makeID(e),n),this.optionToItem.set(n,e)}};var gp=class extends Ae{constructor(e,n){super(e);this.node=n}},I1=class extends gp{constructor(t){super("delete",t)}},R1=class extends gp{constructor(e,n){super("moved",e);this.newIndex=n}},B1=class extends gp{constructor(e,n){super("reparented",e);this.newParent=n}},$f=class extends qe{constructor(e,...n){super();this.filterTypeInput=null;this.elements=new Array;this.nodes2Elements=new Map;this.htmlElements2Nodes=new Map;this.htmlElements2Elements=new Map;this._rootNode=null;this.locked=!1;this._disabled=!1;this.typeFilter=null;this.nameFilter=null;this.readonly=!1;this.createElement=this.createElement.bind(this),this.options=Object.assign({defaultLabel:null,getOrder:null,replaceElement:null,canReorder:Mp,additionalProperties:[]},e);let i=this.options.canReorder;if(T(i)&&(this.options.canReorder=o=>!this.readonly&&i(o)),fe(this.options.canParent)&&(this.options.canParent=this.options.canHaveChildren),this._canChangeOrder=ht(this.options.getOrder),this.element=De(Xe("tree-view"),...n,this.filters=Ar.create(Xe("tree-view-controls"),...this.options.additionalProperties),De(Xe("tree-view-controls"),this.collapseButton=er(pt(()=>this.collapseAll()),"Collapse all"),this.expandButton=er(pt(()=>this.expandAll()),"Expand all")),De(Xe("tree-view-inner"),D0(0),fd(async o=>{if(!this.disabled){let s=this.nodes2Elements.get(this.rootNode);await s._launchMenu(o,new fp(s))}}),pt(o=>{if(!this.disabled&&!o.defaultPrevented){for(let s of this.elements)if(s.selected){this.selectedNode=null,this.dispatchEvent(new Aa(null));return}}}),wA(o=>{if(To(o)){let s=this.selectedElement;if(s){if(o.key==="Delete")this.dispatchEvent(new I1(s.node));else if(o.key==="ArrowUp"){let l=Nc(s);if(l>0){let c=s.element.parentElement.children[l-1];this.htmlElements2Elements.get(c)._select(!0)}else if(s.node.isChild&&s.node.parent.isChild){let c=s.node.parent;this.nodes2Elements.get(c)._select(!0)}}else if(o.key==="ArrowDown"){let l=Nc(s);if(l<s.element.parentElement.childElementCount-1){let c=s.element.parentElement.children[l+1];this.htmlElements2Elements.get(c)._select(!0)}else if(s.node.isChild){let c=s.node.parent,u=this.nodes2Elements.get(c),p=Nc(u),f=u.element.parentElement.children[p+1];f&&this.htmlElements2Elements.get(f)._select(!0)}}else if(o.key==="ArrowRight"){if(s.node.hasChildren)if(s.isOpen){let l=s.children.children[0];l&&this.htmlElements2Elements.get(l)._select(!0)}else s.isOpen=!0}else if(o.key==="ArrowLeft"){let l=this.selectedElement;l.isOpen?l.isOpen=!1:l.node.isChild&&l.node.parent.isChild&&this.nodes2Elements.get(l.node.parent)._select(!0)}}else if(this.children.children.length>0){let l=this.nodes2Elements.get(this.rootNode),c=null;o.key==="ArrowUp"?c=l.children.children[l.children.children.length-1]:o.key==="ArrowDown"&&(c=l.children.children[0]),c&&this.htmlElements2Elements.get(c)._select(!0)}}}),this.children=De(Xe("tree-view-children")))),(this.options.showNameFilter||T(this.options.typeFilters))&&(this.options.showNameFilter&&this.filters.append(["Name",this.filterNameInput=gr(Ne("form-control"),Ut("Filter by name"),qo(!1),Je(()=>{this.nameFilter=this.filterNameInput.value.toLocaleLowerCase(),this.nameFilter.length===0&&(this.nameFilter=null),this.refreshFilter()}))]),T(this.options.typeFilters)&&(this.filters.append(["Type",this.filterTypeInput=new Qf(Rr,this.options.typeFilters.getTypeLabel,this.options.typeFilters.getTypeLabel,"Filter by type")]),this.filterTypeInput.values=this.options.typeFilters.getTypes(),this.filterTypeInput.addEventListener("itemselected",o=>{this.typeFilter=o.item,this.refreshFilter()})),this.filters.append(ka("Clear filter",pt(()=>this.clearFilter())))),this.canChangeOrder){let o=null,s=null,l=null,c=0,u=null,p=()=>{l&&clearTimeout(l),u=null,s&&(s.highlighted=null,s=null),c=0};We(this.children,gd(f=>{p(),o=this.findElement(f.target),o.element.style.opacity="0.5"}),Ka(f=>{let w=f.target,A=w!==u,m=this.findElement(w);A&&(p(),u=w),m&&this.canReparent(m,o,w)&&(s=m,w===m.upper?c=-1:w===m.lower?c=1:c=0,s.highlighted=c,A&&c===0&&!m.isOpen&&(l=setTimeout(()=>m.isOpen=!0,1e3)),f.preventDefault())}),xd(f=>{this.canReparent(s,o,u)&&(f.preventDefault(),this.reparentNode(o.node,s.node,c)),p()}),qa(()=>{o&&(o.element.style.opacity="1"),p()}))}this.options.replaceElement&&Ip(this.options.replaceElement,this)}clearFilter(){T(this.filterNameInput)&&(this.filterNameInput.value="",this.nameFilter=null),T(this.filterTypeInput)&&(this.filterTypeInput.selectedValue=null,this.typeFilter=null),this.refreshFilter()}refreshFilter(){let e=new Set;for(let n of this.rootNode.depthFirst()){let i=fe(this.nameFilter)||this.options.getLabel(n.value).toLocaleLowerCase().indexOf(this.nameFilter)>=0,o=fe(this.typeFilter)||this.options.typeFilters.getTypeFor(n.value)===this.typeFilter,s=i&&o,l=s||e.has(n),c=this.nodes2Elements.get(n);st(c,l,"block"),c._filtered=e.has(n)&&!s,c.isOpen=!0,l&&T(n.parent)&&e.add(n.parent)}T(this.selectedElement)&&this.selectedElement.scrollIntoView()}canReparent(e,n,i){return!this.readonly&&T(e)&&T(n)&&(e.canHaveChildren&&this.options.canParent(e.node,n.node)||i===e.upper||i===e.lower)&&!n.node.contains(e.node)&&n.node.parent!==e.node}get canChangeOrder(){return!this.readonly&&this._canChangeOrder}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get disabled(){return this._disabled}set disabled(e){this.expandButton.disabled=this.collapseButton.disabled=this.filters.disabled=this._disabled=e;for(let n of this.elements)n.disabled=e}async withLock(e){let n=this.enabled;if(this.enabled)try{await e()}finally{this.enabled=n}}findAll(e){return Array.from(this.rootNode.searchAll(n=>e(n.value)))}enableOnlyValues(e){for(let n of this.elements)n.disabled=e.indexOf(n.node.value)===-1,n.specialSelectMode=!0}enableAllElements(){for(let e of this.elements)e.enabled=!0,e.specialSelectMode=!1}get values(){return this.rootNode.children.flatMap(e=>Array.from(e.breadthFirst())).map(e=>e.value)}set values(e){this.rootNode=qf(e,this.options.getParent,this.options.getOrder)}get rootNode(){return this._rootNode}set rootNode(e){if(e!==this.rootNode){this.locked=!0;for(let n of this.elements)n.removeScope(this),n.removeBubbler(this);if(Bt(this.children),ct(this.elements),this.nodes2Elements.clear(),this.htmlElements2Nodes.clear(),this.htmlElements2Elements.clear(),this._rootNode=e,this.rootNode){for(let i of this.rootNode.breadthFirst())this.createElement(i);let n=this.nodes2Elements.get(this.rootNode);We(this.children,n)}this.locked=!1;for(let n of this.elements)n.canHaveChildren&&this.reorderChildren(n);this.rootNode&&this.nodes2Elements.get(this.rootNode).refresh()}}clear(){this.rootNode=null}get selectedValue(){let e=this.selectedNode;return e?e.value:null}findNode(e){return this.rootNode.find(e)}set selectedValue(e){e!==this.selectedValue&&(this.selectedNode=this.rootNode.find(e))}get selectedNode(){let e=this.selectedElement;return e?e.node:null}set selectedNode(e){e!==this.selectedNode&&(this.selectedElement=this.nodes2Elements.get(e))}get selectedElement(){for(let e of this.elements)if(e.selected)return e;return null}set selectedElement(e){if(T(e)){e._select(!1);let n=e;for(;T(n);)n.isOpen=!0,n=this.nodes2Elements.get(n.node.parent);e.scrollIntoView()}else e=this.selectedElement,T(e)&&(e._selected=!1),this.dispatchEvent(new Aa(null))}findElement(e){let n=e;for(;n!==null;){let i=this.htmlElements2Elements.get(n);if(T(i))return i;if(n=n.parentElement,n===this.children)return null}return null}reorderChildren(e){if(!this.locked&&this.canChangeOrder){let n=e.children.children.length;for(let i=0;i<n;++i){let o=e.children.children[i],s=this.htmlElements2Nodes.get(o),l=this.nodes2Elements.get(s);this.options.getOrder(s.value)!==i&&this.dispatchEvent(new R1(s,i)),l.refresh()}e.refresh()}}createElement(e){let n=new Yf(e,this.options.defaultLabel,this.options.getLabel,this.options.getDescription,this.options.canReorder,this.options.getChildDescription,this.options.canHaveChildren,this.createElement);n.addScopedEventListener(this,"select",o=>{for(let s of this.elements)s._selected=s.node===o.node}),n.addBubbler(this),this.elements.push(n),this.nodes2Elements.set(e,n),this.htmlElements2Nodes.set(n.element,e),this.htmlElements2Elements.set(n.element,n);let i=e.parent;if(i){let o=this.nodes2Elements.get(i);if(o)if(!this.canChangeOrder)We(o.children,n);else{let s=this.options.getOrder(e.value),l=Number.MAX_SAFE_INTEGER,c=null;for(let p of i.children)if(p!==e){let f=this.options.getOrder(p.value);f>s&&f<l&&(c=p,l=f)}let u=this.nodes2Elements.has(c)&&this.nodes2Elements.get(c).element||null;Wi(o.children,n,u),this.reorderChildren(o)}}return n}addValue(e){let n=this.options.getParent(e),i=fe(n)?this.rootNode:this.rootNode.find(n);this.nodes2Elements.get(i).add(e)}updateNode(e){let n=this.nodes2Elements.get(e);n&&n.refresh()}reparentNode(e,n,i){let o=e.parent,s=this.nodes2Elements.get(e),l=this.nodes2Elements.get(o),c=this.nodes2Elements.get(n),u=null;if(i!==0){if(u=c,n=n.parent,c=this.nodes2Elements.get(n),i===1){let p=Nc(u)+1,f=c.children.children[p];u=this.htmlElements2Elements.get(f)}}else if(this.canChangeOrder){let p=this.options.getOrder(e.value);for(let f=0;f<n.children.length&&u===null;++f){let w=n.children[f];this.options.getOrder(w.value)>p&&(u=this.nodes2Elements.get(w))}}Wi(c.children,s,u),c!==l?(n.connectTo(e),this.reorderChildren(l),this.reorderChildren(c),this.dispatchEvent(new B1(e,n))):this.reorderChildren(l),c.isOpen=!0}removeValue(e){this.removeNode(this.rootNode.find(e))}removeNode(e){let n=this.nodes2Elements.get(e);n.selected&&this.dispatchEvent(new Aa(null));let i=this.nodes2Elements.get(e.parent);n.removeScope(this),n.removeBubbler(this),n.element.remove(),e.removeFromParent(),Wt(this.elements,n),this.nodes2Elements.delete(e),this.htmlElements2Nodes.delete(n.element),this.htmlElements2Elements.delete(n.element),this.reorderChildren(i)}collapseAll(){for(let e of this.elements)e.node.isChild&&e.canHaveChildren&&(e.isOpen=!1)}expandAll(e=null){for(let n of this.elements)n.node.isChild&&n.canHaveChildren&&(fe(e)||n.node.depth<=e)&&(n.isOpen=!0)}};var Zf=class extends $f{constructor(...e){super({showNameFilter:!0,typeFilters:{getTypes:()=>ZE,getTypeLabel:n=>mc.get(n),getTypeFor:n=>Ho(n)},getLabel:n=>{let i=Ho(n),o=this.getAssetName(n);if(fe(o))return Fx.emojiStyle+"N/A";let s=Rf.get(i);return this.isStartStation(n)&&(s+=yo.emojiStyle),s+" "+o},getParent:n=>this.getAssetParent(n),getOrder:n=>this.getAssetOrder(n),getDescription:n=>Ho(n)||"N/A",canReorder:n=>Ln(n)||qt(n)||No(n),getChildDescription:n=>fe(n)&&"scenario"||ei(n)&&"zone"||Ln(n)&&"station/ambient audio"||qt(n)&&"connection/sign/audio/video/text/model",canHaveChildren:n=>ei(n.value)||Ln(n.value)||qt(n.value),canParent:(n,i)=>ei(n.value)&&Ln(i.value)||Ln(n.value)&&(qt(i.value)||No(i.value))||qt(n.value)&&(y1(i.value)||pc(i.value)||uc(i.value)||dc(i.value)||cc(i.value)||Oi(i.value))},...e);this._scenario=null}getAssetName(e){let n=Ho(e);if(fe(n))return null;let i="";if(ei(e))i+=e.name;else if(Ln(e))i+=e||"Default",e===""&&(i+=lA.emojiStyle);else if(qt(e)||No(e)||uc(e)||hc(e)||pc(e)||dc(e)||cc(e))i+=e.fileName;else if(Oi(e)){if(e.label&&e.label!==" \u2B06\uFE0E\uFE0E ")i+=e.label;else if(this.scenario){let o=this.scenario.getStation(e.toStationID);o?i+=o.fileName:i+="XXX BROKEN CONNECTION XXX"}}return i}get scenario(){return this._scenario}set scenario(e){if(e!==this.scenario&&(this.clear(),this._scenario=e,this.readonly=!this.scenario||this.scenario.published,T(this.scenario))){let n=[this.scenario,...this.scenario.zones.map(o=>o||""),...this.scenario.stations,...this.scenario.audios,...this.scenario.videos,...this.scenario.texts,...this.scenario.signs,...this.scenario.models,...this.scenario.connections];this.scenario.zones.length===0&&Xo(n,"",0);let i=qf(n,o=>this.getAssetParent(o),o=>this.getAssetOrder(o)).children[0];i.removeFromParent(),this.rootNode=i,this.expandAll(1)}}getAssetParent(e){if(fe(e)||ei(e))return null;if(Ln(e))return this.scenario;if(qt(e)||No(e))return e.zone;{let n=this.scenario.getTransform(e.transformID);return this.scenario.findStation(n)}}getAssetOrder(e){return ei(e)&&-1||Ln(e)&&(e===""?0:1)||qt(e)&&(this.isStartStation(e)?2:3)||No(e)&&4||y1(e)&&5||uc(e)&&6||pc(e)&&7||dc(e)&&8||cc(e)&&9}isStartStation(e){return qt(e)&&T(this.scenario)&&this.scenario.startStationID===e.transformID}};var eg=class extends Hr{constructor(){super("File detail");st(this.cancelButton,!1),Ye(this.confirmButton,"Close"),We(this.contentArea,this.iframe=Da(t0("none"),Kn(mr(40)),go(mr(50)),Er("File detail")))}async showFile(e){this.iframe.src=`/Editor/Files/Detail/${e}?hideBanner`,await this.showDialog()}};function t_(r){return r instanceof Tt||r instanceof ot}function rde(r){return!t_(r)}var tg=class{constructor(...t){let e=t.filter(t_),n=t.filter(rde);this.element=De(Xe("scroll-panel"),...e,De(Xe("scroll-panel-inner"),...n))}};var ng=class{constructor(t,...e){let n=`Juniper:Widgets:TipBox:${t}`;this.element=q0(Ct(t),Xe("tip"),rF("Tips:"),_0(localStorage.getItem(n)!=="closed"),lF(...e.map(i=>Z0(i))),AA(()=>localStorage.setItem(n,this.element.open?"open":"closed")))}};var xc=class extends qe{constructor(){super();this._element=null;this._enabled=!0;this.refresh=Jl(()=>this.onRefresh())}get visible(){return zn(this.element)}set visible(e){st(this.element,e)}get element(){return this._element}get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.refresh())}get disabled(){return!this.enabled}set disabled(e){this.enabled=!e}};var wc=class extends xc{constructor(e,n){super();this.title=e;this._scenario=null;this._element=De(Xe("section"),this.scrollPanel=new tg(this.properties=Ar.create()),this.assetControls=De(Xe("controls"))),T(n)&&n.length>0&&Wi(this.element,new ng(e+"Tips",...n),this.scrollPanel)}addProperties(...e){this.properties.append(...e)}addAssetControls(...e){for(let n=e.length-1;n>=0;--n)Wi(this.assetControls,e[n],this.assetControls.children[0])}get scenario(){return this._scenario}set scenario(e){if(e!==this.scenario){let n=this.scenario;this._scenario=e,this.onScenarioChanged(n)}}get hasScenario(){return!!this.scenario}get canEdit(){return this.enabled&&this.hasScenario}onRefresh(){let e=new Array;for(let n=0;n<this.element.childElementCount;++n)this.element.children[n]===this.scrollPanel.element?e.push(Go(1)):e.push("auto");this.element.style.gridTemplateRows=e.join(" "),this.properties.disabled=!this.canEdit}};var V1="renameWarning",vc=class extends wc{constructor(e,n,i=!0){super(e,n);this._value=null;this.addProperties(["Name",this.nameInput=gr(Ne("form-control"),Ut(e+" name"))],Ts(V1,De(Xe("alert alert-warning"),`Cannot rename ${e} to `,this.renameWarningText=Ui()))),this.addAssetControls(this.deleteButton=Op("Delete "+e,pt(()=>this.dispatchEvent(new Pf(this.value)))));let o=()=>{this.refresh(),this.canRename&&this.dispatchEvent(new Df(this.value,this.nameInput.value))};i?this.nameInput.addEventListener("input",o):(this.nameInput.addEventListener("change",o),vA(o).applyToElement(this.nameInput)),this.properties.setGroupVisible(V1,!1)}onScenarioChanged(e){this._value=null,this.refreshValues()}get value(){return this._value}set value(e){e!==this.value&&(this._value=e,this.refreshValues())}get hasValue(){return T(this.value)}get canEdit(){return super.canEdit&&this.hasValue&&this.hasScenario&&!this.scenario.published}get canDelete(){return this.canEdit}get name(){return this.nameInput.value}get nameChanged(){return this.getValueName(this.value)!==this.name}get canRename(){return this.canEdit&&this.nameChanged&&this.name.trim().length>0}onValueChanged(){this.hasValue?this.nameInput.value=this.getValueName(this.value):this.nameInput.value=null}refreshValues(){this.onValueChanged(),this.refresh()}onRefresh(){super.onRefresh(),Ye(this.renameWarningText,`'${this.name}'`),this.properties.setGroupVisible(V1,this.canEdit&&this.nameChanged&&!this.canRename),this.nameInput.disabled=!this.canEdit,this.deleteButton.disabled=!this.canDelete}};var Fc=class extends vc{constructor(e,n,i){super(e,i);this.addAssetControls(this.resetButton=Op(n,pt(()=>this.dispatchEvent(new Lf(this.value))))),We(this.element)}onRefresh(){super.onRefresh(),this.resetButton.disabled=!this.canEdit}getTransformModes(e){return["Orbit","Global Rotate","Object Rotate","View Rotate","Resize","Global Move","Object Move","View Move"]}updateTransformView(e){if(e===this.value&&this.refreshValues(),!Oi(e)){let n=this.scenario.getTransform(e.transformID);this.scenario.transformAdapter.updateMarker(n,e)}}saveTransform(e){let n=this.scenario.getTransform(e.transformID);return this.scenario.transformAdapter.saveMatrix(n)}};var Sr=class extends Fc{constructor(e,n,i,o,s,l){super(e,n,l);this.filePicker=i;this.fileTypes=o;this.fileTags=s;this.addAssetControls(this.detailButton=er("View File Detail",pt(()=>this.dispatchEvent(new If(this.value)))))}async reloadFile(){await this.scenario.env.fetcher.evict(this.value.filePath),await this.value.reload(this.scenario.env.loadingBar)}onRefresh(){super.onRefresh(),this.detailButton.disabled=!this.canEdit}async createValue(e,n){if(!this.validateParent(e))throw new Error("Incorrect parent type.");let i=await this.getFile(e);return T(i)?await this.onFileSelection(e,i,n):null}async getFile(e){return this.filePicker.setTypeFilters(...this.fileTypes),this.filePicker.setTags(...this.fileTags),await this.filePicker.showDialog()&&T(this.filePicker.selectedFile)?this.filePicker.selectedFile:null}};var rg=class extends Sr{constructor(e){super("Audio","Reset Audio",e,[Or,jc],["voiceover"],["Upload MP3 or WEBA files"]);let n=()=>{this.scenario.audioAdapter.updateThrottled(this.value,{enabled:this.trackEnabled,label:this.label,volume:this.volume})};this.addProperties(["Enabled",this.enabledInput=nr(Je(n))],["Label",this.labelInput=zi(Ut("Enter label"),Ne("form-control"),Ea("soft"),qo(!1),kn("lpignore","true"),Je(n))],["Volume",this.volumeInput=new Pt(Ne("form-control"),Ft(0),vt(100),ft(1),Ut("Volume"),Je(n))]),Object.seal(this),this.refreshValues()}getValueName(e){return e.fileName}renameValue(e,n){this.scenario.audioAdapter.updateThrottled(e,{fileName:n})}async resetValue(e){await this.scenario.audioAdapter.reset(e,this.scenario.env.defaultAvatarHeight)}deleteValue(e){return this.scenario.audioAdapter.delete(e)}validateParent(e){return qt(e)}onFileSelection(e,n,i){return this.scenario.audioAdapter.create(e,n,i)}get canEdit(){return super.canEdit&&fe(this.value.error)}get label(){return this.labelInput.value}set label(e){this.labelInput.value=e}get volume(){return Sd(this.volumeInput.value)}set volume(e){this.volumeInput.value=bd(e)}get trackEnabled(){return this.enabledInput.indeterminate?null:this.enabledInput.checked}set trackEnabled(e){this.enabledInput.indeterminate=fe(e),this.enabledInput.checked=T(e)&&e}onValueChanged(){super.onValueChanged(),this.hasValue?(this.label=this.value.label,this.volume=this.value.volume,this.trackEnabled=this.value.enabled):(this.label="",this.volume=null,this.trackEnabled=null)}onRefresh(){super.onRefresh(),this.labelInput.disabled=this.volumeInput.disabled=this.enabledInput.disabled=!this.canEdit}};var Ai=class{constructor(...t){let n=t.filter(R0).map((i,o)=>o===0?Go(1):"auto");this.element=De(Xe("group-panel"),Cs(...n),...t),Object.seal(this)}};var O1=class extends Ae{constructor(e){super("connectionstarted");this.connectables=e}},ig=class extends Fc{constructor(){super("Connection","Reset Connection");this.toStationSelection=new mt(!1);this.fromStation=null;this.toStation=null;this.addProperties(["To Station",new Ai(bp(yr(5)),this.toStationName=an(),this.selectStationButton=ka("Select",pt(()=>this.dispatchEvent(new Qn(this.toStation,!1)))))]),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.cancelConnection()}),Object.seal(this),this.refreshValues()}getValueName(e){return e.label||""}renameValue(e,n){this.scenario.connectionAdapter.updateThrottled(e,n)}async resetValue(e){await this.scenario.connectionAdapter.reset(e)}get isConnecting(){return this.toStationSelection.running}connectTo(e){this.isConnecting&&this.toStationSelection.resolve(e)}cancelConnection(){this.isConnecting&&this.toStationSelection.resolve(null)}async createValue(e){this.toStationSelection.restart();let n=this.scenario.connectionAdapter.getConnectableStations(e);this.dispatchEvent(new O1(n));let i=await this.toStationSelection;return this.dispatchEvent(new Ae("connectionending")),fe(i)?(console.warn("Station connection selection cancelled"),null):n.indexOf(i)===-1?(console.warn(`Invalid connection: "${e.fileName}" -> "${i.fileName}"`),null):(await this.scenario.connectionAdapter.create(e,i),this.scenario.connectionAdapter.findConnection(e,i))}async deleteValue(e){let n=this.scenario.getStation(e.fromStationID),i=this.scenario.getStation(e.toStationID);await this.scenario.connectionAdapter.disconnect(n,i)}get hasFromStation(){return!!this.fromStation}get hasToStation(){return!!this.toStation}get canEdit(){return super.canEdit&&this.hasFromStation&&this.hasToStation}onValueChanged(){super.onValueChanged(),this.hasValue?(this.fromStation=this.scenario.getStation(this.value.fromStationID),this.toStation=this.scenario.getStation(this.value.toStationID)):(this.fromStation=null,this.toStation=null),Ye(this.toStationName,this.hasToStation?this.toStation.fileName:"N/A")}onRefresh(){super.onRefresh(),this.selectStationButton.disabled=this.disabled||!this.hasToStation}};function r_(r){return r*.01}function i_(r){return r*100}var og=class extends Sr{constructor(e,n){super("Environment Audio","Reset",e,[Or,jc],["ambient"],["Center the map on an empty space","Upload MP3 or WEBA files"]);this.mapView=n;this.rangeOverlay=null;this.lock=!1;let i=()=>{this.scenario.audioAdapter.updateThrottled(this.value,{enabled:this.trackEnabled,volume:this.volume,effect:this.effect,minDistance:this.minDistance,maxDistance:this.maxDistance}),this.refreshOverlay()};this.addProperties(["Enabled",this.enabledInput=nr(Je(i))],["Latitude",this.latitudeBox=an()],["Longitude",this.longitudeBox=an()],["Elevation",new Ai(this.elevationInput=Vr(Ne("form-control"),Je(()=>this.scenario.audioAdapter.changeElevationThrottled(this.value,this.elevation)),Ut("Elevation"),ft(.001)),this.resetButton)],["Volume",this.volumeInput=new Pt(Ne("form-control"),Ft(0),vt(500),Ut("Volume"),Je(i))],["Effect",this.effectInput=fr(Ne("custom-select"),Je(i))],["Min dist",this.minDistanceInput=Vr(Ne("form-control"),Ft(0),vt(1e3),ft(.01),Ut("Minimum distance"),Je(i))],["Max dist",this.maxDistanceInput=Vr(Ne("form-control"),Ft(0),vt(1e3),ft(.01),Ut("Maximum distance"),Je(i))]),We(this.effectInput,Bn("NONE"),...Array.from(hh.keys()).map(o=>Bn(o,hn(o)))),Object.seal(this),this.refreshValues()}getTransformModes(){return["Global Move","Object Move","View Move","Global Rotate","Object Rotate","View Rotate"]}updateTransformView(e){super.updateTransformView(e),e.updateAudioPosition()}getValueName(e){return e.fileName}renameValue(e,n){this.scenario.audioAdapter.updateThrottled(e,{fileName:n})}async resetValue(e){let i=this.scenario.fileMarkers.get(e.transformID).getPosition(),o=await this.mapView.getElevation(qi(i));await this.scenario.audioAdapter.changeElevation(e,o)}deleteValue(e){return this.scenario.audioAdapter.delete(e)}validateParent(e){return Ln(e)}async onFileSelection(e,n,i){let o=await this.mapView.getCenter();await this.scenario.resolveOrigin(o);let s=await this.scenario.audioAdapter.create(null,n,i);await this.scenario.audioAdapter.update(s,{zone:e});let l=this.scenario.getTransform(s.transformID);return await this.scenario.moveTransformByGeo(l,o.lat,o.lng,o.alt),this.scenario.transformAdapter.updateMarker(l,s),s}get canEdit(){return super.canEdit&&fe(this.value.error)}get elevation(){return this.hasValue?this.elevationInput.valueAsNumber:null}set elevation(e){T(e)&&(e=Nh(Math.round(Oh(e)))),e!==this.elevation&&T(e)&&(this.elevationInput.valueAsNumber=e)}get volume(){return r_(this.volumeInput.valueAsNumber)}set volume(e){this.volumeInput.valueAsNumber=Math.round(i_(e))}get minDistance(){return nn(this.minDistanceInput.value)}set minDistance(e){this.minDistanceInput.value=$t(e,2)}get maxDistance(){return nn(this.maxDistanceInput.value)}set maxDistance(e){this.maxDistanceInput.value=$t(e,2)}get effect(){return this.effectInput.selectedIndex===0?null:this.effectInput.value}set effect(e){e?this.effectInput.value=e:this.effectInput.selectedIndex=0}get trackEnabled(){return this.enabledInput.indeterminate?null:this.enabledInput.checked}set trackEnabled(e){this.enabledInput.indeterminate=fe(e),this.enabledInput.checked=T(e)&&e}get canMove(){return this.canEdit&&this.scenario.stations.length>0}onValueChanged(){if(super.onValueChanged(),this.hasValue){let e=this.scenario.getTransformPosition(this.value.transformID),[n,i]=new en(e).toDMSArray(2);Ye(this.latitudeBox,n),Ye(this.longitudeBox,i),this.elevation=e.alt,this.trackEnabled=this.value.enabled,this.volume=this.value.volume,this.minDistance=this.value.minDistance,this.maxDistance=this.value.maxDistance,this.effect=this.value.effect}else Ye(this.latitudeBox,"N/A"),Ye(this.longitudeBox,"N/A"),this.elevation=null,this.trackEnabled=null,this.volume=null,this.minDistance=null,this.maxDistance=null,this.effect=null;this.refreshOverlay()}async refreshOverlay(){if(!this.lock){if(this.lock=!0,T(this.rangeOverlay)&&this.rangeOverlay.setMap(null),this.hasValue){let{maxDistance:e,minDistance:n}=this.value,i=this.scenario.getTransformPosition(this.value.transformID),o=500,s=o/5,l=Mi(2*o,2*o),c=10*e,u=n*o/c,p=e*o/c,f=l.getContext("2d"),w=f.createRadialGradient(o,o,0,o,o,o);for(let A=0;A<=s;++A){let m=A/s,d=m*c,M=this.value.clip.spatializer.getGainAtDistance(d)*this.value.volume,k=Ap(Fp(30),on(100),on(50),M);w.addColorStop(m,k)}f.fillStyle=w,f.beginPath(),f.arc(o,o,o,0,Jn),f.fill(),f.lineWidth=1,f.strokeStyle=Ap(Fp(30),on(100),on(37.5),1),f.beginPath(),f.arc(o,o,u,0,Jn),f.stroke(),f.lineWidth=2,f.strokeStyle=Ap(Fp(30),on(100),on(25),1),f.beginPath(),f.arc(o,o,p,0,Jn),f.stroke(),this.rangeOverlay=await this.mapView.createOverlay(i,c,c,l)}this.lock=!1}}onRefresh(){super.onRefresh(),this.volumeInput.disabled=this.minDistanceInput.disabled=this.maxDistanceInput.disabled=this.enabledInput.disabled=this.effectInput.disabled=!this.canEdit,this.elevationInput.disabled=!this.canMove}};var ide=function r(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,i,o;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(i=n;i--!==0;)if(!r(t[i],e[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===e.toString();if(o=Object.keys(t),n=o.length,n!==Object.keys(e).length)return!1;for(i=n;i--!==0;)if(!Object.prototype.hasOwnProperty.call(e,o[i]))return!1;for(i=n;i--!==0;){var s=o[i];if(!r(t[s],e[s]))return!1}return!0}return t!==t&&e!==e},o_="__googleMapsScriptId",Ac;(function(r){r[r.INITIALIZED=0]="INITIALIZED",r[r.LOADING=1]="LOADING",r[r.SUCCESS=2]="SUCCESS",r[r.FAILURE=3]="FAILURE"})(Ac||(Ac={}));var mo=class{constructor({apiKey:t,authReferrerPolicy:e,channel:n,client:i,id:o=o_,language:s,libraries:l=[],mapIds:c,nonce:u,region:p,retries:f=3,url:w="https://maps.googleapis.com/maps/api/js",version:A}){if(this.CALLBACK="__googleMapsCallback",this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=t,this.authReferrerPolicy=e,this.channel=n,this.client=i,this.id=o||o_,this.language=s,this.libraries=l,this.mapIds=c,this.nonce=u,this.region=p,this.retries=f,this.url=w,this.version=A,mo.instance){if(!ide(this.options,mo.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(mo.instance.options)}`);return mo.instance}mo.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?Ac.FAILURE:this.done?Ac.SUCCESS:this.loading?Ac.LOADING:Ac.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let t=this.url;return t+=`?callback=${this.CALLBACK}`,this.apiKey&&(t+=`&key=${this.apiKey}`),this.channel&&(t+=`&channel=${this.channel}`),this.client&&(t+=`&client=${this.client}`),this.libraries.length>0&&(t+=`&libraries=${this.libraries.join(",")}`),this.language&&(t+=`&language=${this.language}`),this.region&&(t+=`&region=${this.region}`),this.version&&(t+=`&v=${this.version}`),this.mapIds&&(t+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(t+=`&auth_referrer_policy=${this.authReferrerPolicy}`),t}deleteScript(){let t=document.getElementById(this.id);t&&t.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((t,e)=>{this.loadCallback(n=>{n?e(n.error):t(window.google)})})}loadCallback(t){this.callbacks.push(t),this.execute()}setScript(){if(document.getElementById(this.id)){this.callback();return}let t=this.createUrl(),e=document.createElement("script");e.id=this.id,e.type="text/javascript",e.src=t,e.onerror=this.loadErrorCallback.bind(this),e.defer=!0,e.async=!0,this.nonce&&(e.nonce=this.nonce),document.head.appendChild(e)}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(t){if(this.errors.push(t),this.errors.length<=this.retries){let e=this.errors.length*Math.pow(2,this.errors.length);console.log(`Failed to load Google Maps script, retrying in ${e} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},e)}else this.onerrorEvent=t,this.callback()}setCallback(){window.__googleMapsCallback=this.callback.bind(this)}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(t=>{t(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader.This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading||(this.loading=!0,this.setCallback(),this.setScript())}}};var bc=class{constructor(t,e,n){this.callback=null;this.promise=new Promise((i,o)=>{this.callback=(...s)=>{t(...s)?i(e(...s)):o(n(...s))}})}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};var N1=(r,t)=>t===google.maps.places.PlacesServiceStatus.OK,H1=(r,t)=>r,W1=(r,t)=>t,sg=class{constructor(t){this.places=t}nearbySearch(t){let e=new bc(N1,H1,W1);return this.places.nearbySearch(t,e.callback),e}textSearch(t){let e=new bc(N1,H1,W1);return this.places.textSearch(t,e.callback),e}findPlaceFromQuery(t){let e=new bc(N1,H1,W1);return this.places.findPlaceFromQuery(t,e.callback),e}};var ag=class extends qe{constructor(e){super();this.streetView=e;this.publicChangedEvt=new Ae("positionchanged");this.privateChangedEvt=new Ae("_positionchanged");this.firePublicEvt=!0;this.streetView.addListener("position_changed",()=>{this.dispatchEvent(this.privateChangedEvt),this.firePublicEvt&&(this.visible=!0,this.dispatchEvent(this.publicChangedEvt))})}async hasChanged(e){let n=dn(this,"_positionchanged",3e3);this.streetView.setPano(e),await n}async searchPano(e){let n=e!==this.streetView.getPano();await this.setPano(e),n&&this.dispatchEvent(this.publicChangedEvt)}async setPano(e){if(this.firePublicEvt=!1,e=e||null,this.visible=!!e,e!==this.streetView.getPano()&&e)try{await this.hasChanged(e)}catch{console.warn("TIMEOUT"),this.visible=!1}this.firePublicEvt=!0}close(){this.streetView.setPano(null),this.visible=!1}getPano(){return this.visible?this.streetView.getPano():null}getLocation(){return this.streetView.getLocation()}get visible(){return this.streetView.getVisible()}set visible(e){this.streetView.setVisible(e)}};var lg=class{constructor(t){this.fetcher=t}getGSV(t){return this.fetcher.get(`/Editor/Photospheres/${t.toFixed(0)}`).object()}searchGSV(t){return this.fetcher.get(`/Editor/Photospheres/Search/${t}`).object()}requestGSV(t){return this.fetcher.get(`/Editor/Google/StreetView/Metadata/${t}/`).object()}async uploadGSV(t,e,n,i,o,s,l,c){let u=new FormData;return u.append("FormFile",t,e),u.append("Pano",n),u.append("Latitude",i.toFixed(10)),u.append("Longitude",o.toFixed(10)),u.append("Copyright",s),u.append("Date",l),await this.fetcher.post("/Editor/Photospheres/Create/").body(u).progress(c).object()}async replaceGSV(t,e,n,i,o,s,l,c,u){let p=new FormData;p.append("FormFile",e,n),p.append("Pano",i),p.append("Latitude",o.toFixed(10)),p.append("Longitude",s.toFixed(10)),p.append("Copyright",l),p.append("Date",c);let f=await this.fetcher.post(`/Editor/Photospheres/Update/${t}`).body(p).progress(u).exec();return ln(f,()=>t)}};var cg=class extends Hr{constructor(){super("Map results");this.element.classList.add("places-results"),st(this.confirmButton,!1),We(this.contentArea,De(Xe("table"),De(Xe("table-head"),De(Xe("table-row"),De(Xe("table-cell")),De(Xe("table-cell"),"Name"),De(Xe("table-cell"),"Address"),De(Xe("table-cell")))),this.results=De(Xe("table-body"),De(Xe("table-row"),De(Xe("table-cell"),"Searching...")))))}async selectResult(e){let n=null;return Bt(this.results),We(this.results,...e.map(i=>De(Xe("table-row"),De(Xe("table-cell"),tr(Xe("thumbnail"),Er("Place icon"),Zn(i.icon))),De(Xe("table-cell"),i.name),De(Xe("table-cell"),i.formatted_address),De(Xe("table-cell"),er("Select",pt(()=>{n=i,this.confirmButton.click()})))))),await this.showDialog()?n:null}};var ode=SE(9,"MiB"),U1=class extends Ae{constructor(){super("capturestart")}},ug=class extends Ae{constructor(e){super("capturecomplete");this.metadata=e}},pg=class extends xc{constructor(e,n,i){super();this.fetcher=e;this.streetViewContainer=n;this.env=i;this.resultsDialog=new cg;this.map=null;this.elevation=null;this.places=null;this.targetMarker=null;this.markersVisible=!0;this._scenario=null;this._metadata=null;this.streetView=null;this.files=new lg(this.fetcher),this._element=De(Xe("map"),Kn(on(100)),go(on(100)),new Ai(this.searchBox=gr(Ct("mapSearch"),Ne("form-control"),Ut("Search map and Street View"),bx(md(()=>this.search(this.searchBox.value,!0))),Je(()=>this.searchButton.disabled=this.searchBox.value.length===0)),this.searchButton=er($0("search-location"),Er("Search"),pt(()=>this.search(this.searchBox.value,!0))),this.toggleMarkersButton=ka("Hide Labels",pt(()=>{this.markersVisible=!this.markersVisible,Ye(this.toggleMarkersButton,this.markersVisible?"Hide Labels":"Show Labels"),this.scenario.toggleMarkers()}))),new Ai(this.sphereNameInput=gr(Ct("sphereName"),Ne("form-control"),Ut("Enter station name"),Je(()=>this.refresh())),this.copyrightLabel=an(Ct("streetViewCopyright"),Sa(yr(5))),this.addButton=er("Add",pt(()=>this.addStreetView())),this.captureButton=er(Ct("streetViewCaptureButton"),"Capture",pt(()=>this.captureStreetView(!1)))),this.mapContainer=De(Xe("detail"),Ct("mapView"))),Object.seal(this)}get zoom(){return this.map&&this.map.getZoom()}set zoom(e){this.map&&this.map.setZoom(e)}async getCenter(){if(fe(this.map))return;let e=qi(this.map.getCenter());return T(e)&&(e.alt=await this.getElevation(e)),e}async getElevation(e){let n=await this.elevation.getElevationForLocations({locations:[ki(e)]});return n.results.length>0?n.results[0].elevation:0}setTarget(e){if(this.map&&this.targetMarker)if(e){let n=ki(e);this.targetMarker.setMap(this.map),this.targetMarker.setPosition(n),this.panTo(n)}else this.targetMarker.setMap(null)}panTo(e){this.map&&(e instanceof google.maps.LatLng&&(e=qi(e)),this.map.panTo(e))}fitBounds(...e){let n=new google.maps.LatLngBounds;e.map(ki).forEach(i=>n.extend(i)),this.map.fitBounds(n)}async load(e){e&&e.start();let n=await this.fetcher.get("/Editor/Google/APIKey/").object().then(tt);await new mo({apiKey:n,version:"weekly",libraries:["drawing","places"]}).load(),this.map=new google.maps.Map(this.mapContainer,{zoom:12,streetView:new google.maps.StreetViewPanorama(this.streetViewContainer,{addressControl:!1,clickToGo:!0,fullscreenControl:!0,motionTracking:!1})}),this.elevation=new google.maps.ElevationService,this.streetView=new ag(this.map.getStreetView()),this.streetView.addEventListener("positionchanged",()=>{this.search(this.streetView.getPano(),!1)}),this.places=new sg(new google.maps.places.PlacesService(this.map)),this.targetMarker=new google.maps.Marker({icon:{url:"/images/markers/up-arrow.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(16,0)},clickable:!1,draggable:!1,optimized:!1}),e&&e.end()}closeStreetView(){this.streetView.close()}async search(e,n){if(this.map&&this.places&&this.streetView){this.enabled=!1;try{let i=await this.files.searchGSV(e).then(tt)||await this.files.requestGSV(e).then(tt);if(T(i)&&i.status!=="ZERO_RESULTS")await this.setMetadata(i);else{let o=await this.places.textSearch({query:e,bounds:this.map.getBounds()}),s=await this.selectResult(o);if(s)this.setTarget(qi(s.geometry.location));else throw"No results"}}catch(i){let o=`ERROR: ${i}`;n&&(this.searchBox.value=o)}this.enabled=!0}}async selectResult(e){return e.length===0?null:e.length===1?e[0]:await this.resultsDialog.selectResult(e)}async createOverlay(e,n,i,o){if(qp(o)){let w=await Fo(o,Gi);o=ap(w)}o instanceof URL&&(o=o.href);let s=new google.maps.LatLng(ki(e)),l=google.maps.geometry.spherical.computeOffset(s,i,0),c=google.maps.geometry.spherical.computeOffset(s,n,90),u=google.maps.geometry.spherical.computeOffset(s,i,180),p=google.maps.geometry.spherical.computeOffset(s,n,270),f={north:l.lat(),east:c.lng(),south:u.lat(),west:p.lng()};return new google.maps.GroundOverlay(o,f,{map:this.map})}async createMarker(e,n,i){if(qp(i)){let s=await Fo(i,Gi);i=ap(s)}i instanceof URL&&(i=i.href);let o={map:this.map,position:ki(e),label:n,icon:i};return new google.maps.Marker(o)}createLine(e){return new google.maps.Polyline({map:this.map,path:e.map(ki),geodesic:!0,strokeColor:"red",strokeOpacity:1,strokeWeight:2})}async loadMetadataForFile(e){await this.setMetadata(await this.getMetadataForFile(e))}getMetadataForFile(e){return this.files.getGSV(e).then(tt)}get pano(){return this.metadata&&this.metadata.pano_id||null}get hasPano(){return this.pano&&this.pano.length>0}get metadata(){return this._metadata}async setMetadata(e){if(e!==this.metadata){this._metadata=e,await this.streetView.setPano(this.pano),this.dispatchEvent(new Ae("streetviewopened"));let n=this.hasPano&&this.streetView.getLocation(),i=n&&(n.shortDescription||n.description),o=e&&e.fileName;this.sphereName=i||o||null,this.searchBox.value=this.hasPano?this.metadata.pano_id:"";let s="";if(this.hasMetadata){let l=new Date(this.metadata.date);s=`${this.metadata.copyright}, ${l.toLocaleDateString()}`}Ye(this.copyrightLabel,s),this.refresh()}}get scenario(){return this._scenario}set scenario(e){this._scenario=e,this.refresh()}get hasScenario(){return T(this.scenario)}get sphereName(){return this.sphereNameInput.value}set sphereName(e){e!==this.sphereName&&(this.sphereNameInput.value=e,this.refresh())}get enabled(){return super.enabled&&this.hasScenario&&!this.scenario.published}set enabled(e){super.enabled=e}get canCapture(){return this.enabled&&this.hasPano&&this.sphereNameInput.value.length>0}get hasMetadata(){return T(this.metadata)}get isCaptured(){return this.hasMetadata&&this.metadata.fileID>0}get canAdd(){return this.enabled&&this.isCaptured&&this.scenario.stations.filter(e=>e.fileID===this.metadata.fileID).length===0}get canSetName(){return this.enabled&&this.hasPano&&!this.isCaptured}addStreetView(){this.canAdd&&this.dispatchEvent(new ug(this.metadata))}async captureStreetView(e){this.canCapture&&(this.dispatchEvent(new U1),await this.env.withFade(async()=>{let n,i;if(e)i=new Blob([this.pano],{type:tf.value}),n=this.env.loadingBar;else{let[s,l,c]=Gt(this.env.loadingBar,[15,1,5]);n=c;let u=await this.scenario.rig.loadCanvas(this.pano,45,s);for(let p=1;p>=.5&&(l.report(2*(1-p),1,"encoding"),i=await Fo(u,ji,p),!(i.size<=ode));p-=.05);l.end("encoding")}let o=this.isCaptured?this.files.replaceGSV.bind(this.files,this.metadata.fileID):this.files.uploadGSV.bind(this.files);this.metadata.fileName=this.sphereName,this.metadata.fileID=await o(i,this.metadata.fileName,this.metadata.pano_id,this.metadata.location.lat,this.metadata.location.lng,this.metadata.copyright,this.metadata.date,n).then(tt),this.metadata.filePath=`/vr/file/${this.metadata.fileID.toFixed(0)}`,this.scenario.clearCache(),this.env.loadingBar.end("done")}),this.dispatchEvent(new ug(this.metadata)))}onRefresh(){this.searchButton.disabled=this.disabled||this.searchBox.value.length===0,this.searchBox.disabled=this.disabled,this.sphereNameInput.disabled=!this.canSetName,this.addButton.disabled=!this.canAdd,jn(this.captureButton,this.isCaptured,"btn-danger"),jn(this.captureButton,!this.isCaptured,"btn-primary"),Qo(this.captureButton,this.canCapture,this.isCaptured?"Recapture":"Capture",this.isCaptured?"Download photosphere again and replace it":"Download photosphere")}};var dg=class extends Sr{constructor(e){super("Model","Reset Model",e,[Xi,Gc],["model"],["Upload GLTF or GLB files","Make sure 3D models are authored in units of meters"]);let n=async()=>this.scenario.modelAdapter.setRotation(this.value,this.rotationX,this.rotationY,this.rotationZ);this.addProperties(["Size",this.sizeInput=new Pt(Ne("form-control"),Ft(0),vt(10),ft(.1),Ut("Size"),Je(()=>this.scenario.modelAdapter.setSize(this.value,this.size)))],["Pitch",this.rotationXInput=new Pt(Ne("form-control"),Ft(-180),vt(180),ft(.1),Je(n))],["Yaw",this.rotationYInput=new Pt(Ne("form-control"),Ft(-180),vt(180),ft(.1),Je(n))],["Roll",this.rotationZInput=new Pt(Ft(-180),vt(180),ft(.1),Je(n))]),Object.seal(this),this.refreshValues()}getValueName(e){return e.fileName}renameValue(e,n){this.scenario.modelAdapter.updateThrottled(e,{fileName:n})}async resetValue(e){await this.scenario.modelAdapter.reset(e,this.scenario.env.defaultAvatarHeight)}deleteValue(e){return this.scenario.modelAdapter.delete(e)}validateParent(e){return qt(e)}onFileSelection(e,n,i){return this.scenario.modelAdapter.create(e,n,i)}get canEdit(){return super.canEdit&&fe(this.value.error)}get size(){return nn(this.sizeInput.value)}set size(e){this.sizeInput.value=$t(e,3)}get rotationX(){return nn(this.rotationXInput.value)}set rotationX(e){this.rotationXInput.value=$t(e)}get rotationY(){return nn(this.rotationYInput.value)}set rotationY(e){this.rotationYInput.value=$t(e)}get rotationZ(){return nn(this.rotationZInput.value)}set rotationZ(e){this.rotationZInput.value=$t(e)}onValueChanged(){super.onValueChanged(),this.hasValue?(this.size=this.value.size,this.rotationX=this.value.rotationX,this.rotationY=this.value.rotationY,this.rotationZ=this.value.rotationZ):(this.size=null,this.rotationX=null,this.rotationY=null,this.rotationZ=null)}onRefresh(){super.onRefresh(),this.sizeInput.disabled=this.rotationXInput.disabled=this.rotationYInput.disabled=this.rotationZInput.disabled=!this.canEdit}};var z1=class extends Ae{constructor(e){super("loadscenario");this.scenarioID=e}},j1=class extends Ae{constructor(e){super("forkscenario");this.scenarioID=e}},G1=class extends Ae{constructor(e){super("publishscenario");this.scenarioID=e}},hg=class extends wc{constructor(){super("Scenario");this.addProperties(["Name",this.nameBox=an()],["Version",this.versionBox=an()],["Published",this.isPublishedBox=an()],["Latitude",this.latitudeBox=an()],["Longitude",this.longitudeBox=an()],["Zones",this.zonesCountBox=an()],["Stations",this.stationsCountBox=an()],["Voice overs",this.voiceOversCountBox=an()],["Videos",this.videosCountBox=an()],["Texts",this.textsCountBox=an()],["Signs",this.signsCountBox=an()],["3D Models",this.modelsCountBox=an()],["Connections",this.connectionsCountBox=an()],["",this.editOrPublishButton=yi("",pt(()=>{this.hasScenario&&(this.scenario.published?this.dispatchEvent(new j1(this.scenario.id)):this.dispatchEvent(new G1(this.scenario.id)))}))],["Other versions",this.previousVersionsBox=an()]),Object.seal(this),Object.assign(window,{scenarios:this}),this.refresh()}onScenarioChanged(e){let n=this.hasScenario?this.scenario.published?"Create new version":"Publish":"No scenario available",i=this.hasScenario&&this.scenario.published,o=this.hasScenario&&!this.scenario.published;Qo(this.editOrPublishButton,this.hasScenario,n,n),jn(this.editOrPublishButton,i,"btn-danger"),jn(this.editOrPublishButton,o,"btn-primary"),Bt(this.previousVersionsBox),this.hasScenario?(Ye(this.nameBox,this.scenario.name),Ye(this.versionBox,this.scenario.version.toFixed(0)),Ye(this.isPublishedBox,this.scenario.published?"Yes":"No"),We(this.previousVersionsBox,...this.scenario.versions.filter(s=>s.version!==this.scenario.version).map(s=>yi(`${s.version} (${s.published?"Published":"Not published"})`,pt(()=>this.dispatchEvent(new z1(s.id))))))):(Ye(this.nameBox,"N/A"),Ye(this.versionBox,"N/A"),Ye(this.isPublishedBox,"N/A")),this.previousVersionsBox.childElementCount===0&&Ye(this.previousVersionsBox,"N/A")}get value(){return this.scenario}set value(e){this.scenario=e}get hasValue(){return this.hasScenario}onRefresh(){if(super.onRefresh(),this.hasScenario)if(Ye(this.zonesCountBox,this.value.zones.length.toFixed(0)),Ye(this.stationsCountBox,this.value.stations.length.toFixed(0)),Ye(this.voiceOversCountBox,this.value.audios.filter(e=>!e.spatialize).length.toFixed(0)),Ye(this.videosCountBox,this.value.videos.length.toFixed(0)),Ye(this.textsCountBox,this.value.texts.length.toFixed(0)),Ye(this.signsCountBox,this.value.signs.length.toFixed(0)),Ye(this.modelsCountBox,this.value.models.length.toFixed(0)),Ye(this.connectionsCountBox,(this.value.connections.length/2).toFixed(0)),T(this.value.originLL)){let[e,n]=this.value.originLL.toDMSArray(2);Ye(this.latitudeBox,e),Ye(this.longitudeBox,n)}else Ye(this.latitudeBox,"???"),Ye(this.longitudeBox,"???");else Ye(this.zonesCountBox,"N/A"),Ye(this.stationsCountBox,"N/A"),Ye(this.voiceOversCountBox,"N/A"),Ye(this.videosCountBox,"N/A"),Ye(this.textsCountBox,"N/A"),Ye(this.signsCountBox,"N/A"),Ye(this.modelsCountBox,"N/A"),Ye(this.connectionsCountBox,"N/A"),Ye(this.latitudeBox,"N/A"),Ye(this.longitudeBox,"N/A")}};var mg=class extends Sr{constructor(e){super("Sign","Reset Sign",e,[ji,Gi,vo],["sign"],["Upload PNG, JPEG, or PDF files","Signs should be authored at the dimensions they would appear in the real world.",`PNG or JPEG files should be authored at ${So} pixels per inch, e.g. a ${wx} in wide sign should be ${LF} px wide.`,"Callout signs will not be visible in the app until the user clicks on the expand icon."]);let n=async()=>this.scenario.signAdapter.setRotation(this.value,this.rotationX,this.rotationY,this.rotationZ);this.addProperties(["Width",this.sizeInput=new Pt(Ne("form-control"),Ft(0),vt(10),ft(.1),Ut("Size"),Je(()=>this.scenario.signAdapter.setSize(this.value,this.size)))],["Is Callout",this.isCalloutInput=nr(Je(async()=>{await this.scenario.signAdapter.update(this.value,{isCallout:this.isCalloutInput.checked}),this.refreshValues()}))],["Always Visible",this.alwaysVisibleInput=nr(Je(async()=>{await this.scenario.signAdapter.update(this.value,{alwaysVisible:this.alwaysVisibleInput.checked}),this.refreshValues()}))],["Pitch",this.rotationXInput=new Pt(Ne("form-control"),Ft(-180),vt(180),ft(.1),Je(n))],["Yaw",this.rotationYInput=new Pt(Ne("form-control"),Ft(-180),vt(180),ft(.1),Je(n))],["Roll",this.rotationZInput=new Pt(Ne("form-control"),Ft(-180),vt(180),ft(.1),Je(n))]),Object.seal(this),this.refresh()}getValueName(e){return e.fileName}renameValue(e,n){this.scenario.signAdapter.updateThrottled(e,{fileName:n})}async resetValue(e){await this.scenario.signAdapter.reset(e,this.scenario.env.defaultAvatarHeight)}deleteValue(e){return this.scenario.signAdapter.delete(e)}validateParent(e){return qt(e)}onFileSelection(e,n,i){return this.scenario.signAdapter.create(e,n,i)}get canEdit(){return super.canEdit&&fe(this.value.error)}get size(){return nn(this.sizeInput.value)}set size(e){this.sizeInput.value=$t(e,3)}get isCallout(){return this.isCalloutInput.indeterminate?null:this.isCalloutInput.checked}set isCallout(e){this.isCalloutInput.indeterminate=fe(e),this.isCalloutInput.checked=T(e)&&e}get alwaysVisible(){return this.alwaysVisibleInput.indeterminate?null:this.alwaysVisibleInput.checked}set alwaysVisible(e){this.alwaysVisibleInput.indeterminate=fe(e),this.alwaysVisibleInput.checked=T(e)&&e}get rotationX(){return nn(this.rotationXInput.value)}set rotationX(e){this.rotationXInput.value=$t(e)}get rotationY(){return nn(this.rotationYInput.value)}set rotationY(e){this.rotationYInput.value=$t(e)}get rotationZ(){return nn(this.rotationZInput.value)}set rotationZ(e){this.rotationZInput.value=$t(e)}onValueChanged(){super.onValueChanged(),this.hasValue?(this.size=this.value.size,this.isCallout=this.value.isCallout,this.alwaysVisible=this.value.alwaysVisible,this.rotationX=this.value.rotationX,this.rotationY=this.value.rotationY,this.rotationZ=this.value.rotationZ):(this.size=null,this.isCallout=null,this.alwaysVisible=null,this.rotationX=null,this.rotationY=null,this.rotationZ=null)}onRefresh(){super.onRefresh(),this.sizeInput.disabled=this.isCalloutInput.disabled=this.alwaysVisibleInput.disabled=this.rotationXInput.disabled=this.rotationYInput.disabled=this.rotationZInput.disabled=!this.canEdit}};var fg=class extends Ae{constructor(e,n){super(e);this.station=n}},X1=class extends fg{constructor(t){super("stationmarkstart",t)}},q1=class extends fg{constructor(t){super("createconnection",t)}},s_="googleMetadataGroup",a_="startStationRotationGroup",gg=class extends Sr{constructor(e,n){super("Station","Reset",e,[ji],["photosphere"],["Avoid crowded areas","Avoid photospheres with objects in arms-reach"]);this.mapView=n;this.stationTransformDummy=new Et;this._metadata=null;let i=()=>{this.stationTransformDummy.quaternion.copy(this.rotationQuat),this.saveRotation()};this.addProperties(Ts(s_,["Google Pano ID",new Ai(this.googlePanoIDBox=an(_p("hidden"),m0("nowrap"),p0("ellipsis"),Tp(mr(10))),this.viewStreetViewButton=er("View",pt(()=>{this.mapView.setMetadata(this.metadata)})))]),Ts(a_,["Start rotation",this.startRotationBox=new Pt(Ne("form-control"),Ft(0),vt(360),ft(.1),Ut("degrees"),Je(()=>{this.isStartStation&&(this.scenario.stationAdapter.setStartRotation(this.value,at(this.startRotationBox.valueAsNumber)),this.scenario.env.avatar.setHeadingImmediate(this.scenario.startRotation))}))]),["Label",this.labelInput=zi(Ne("form-control"),Ut("Enter label"),Ea("soft"),qo(!1),kn("lpignore","true"),Je(()=>this.scenario.stationAdapter.updateThrottled(this.value,{label:this.label})))],["Latitude",this.latitudeBox=an()],["Longitude",this.longitudeBox=an()],["Elevation",new Ai(this.elevationInput=Vr("Reset",Ne("form-control"),Je(()=>this.scenario.stationAdapter.moveThrottled(this.value,this.value.location.lat,this.value.location.lng,this.elevation,!1)),Ut("Elevation"),ft(.001)),this.resetButton)],["Pitch",this.rotationXInput=new Pt(Ne("form-control"),Ft(-180),vt(180),ft(.1),Je(i))],["Yaw",this.rotationYInput=new Pt(Ne("form-control"),Ft(-180),vt(180),ft(.1),Je(i))],["Roll",this.rotationZInput=new Pt(Ne("form-control"),Ft(-180),vt(180),ft(.1),Je(i))]),Wi(this.element,De(Xe("controls"),this.markStartButton=er("Mark Start",pt(()=>this.dispatchEvent(new X1(this.value)))),this.connectButton=er("Connect",pt(()=>this.dispatchEvent(new q1(this.value))))),this.scrollPanel),Object.seal(this),this.refreshValues()}updateRotationFromTransformer(){this.rotationQuat=this.scenario.env.skybox.rotation=this.stationTransformDummy.quaternion}saveRotation(){this.scenario.stationAdapter.updateThrottled(this.value,{rotation:this.rotationArray})}getTransformModes(){return["View Rotate","Global Rotate","Object Rotate"]}onScenarioChanged(e){T(e)&&(this.stationTransformDummy.removeFromParent(),e.removeScope(this)),T(this.scenario)&&(this.scenario.env.worldUISpace.add(this.stationTransformDummy),this.stationTransformDummy.position.z=-3,this.scenario.addScopedEventListener(this,"stationmarkermoved",async n=>{let i=await this.mapView.getElevation(n.latLng);await this.scenario.stationAdapter.move(n.station,n.latLng.lat,n.latLng.lng,i,!1),n.station===this.value&&this.refreshValues()}))}getValueName(e){return e.fileName}renameValue(e,n){this.scenario.stationAdapter.updateThrottled(e,{fileName:n})}async resetValue(e){let n=await this.mapView.getElevation(e.location);await this.scenario.stationAdapter.move(e,e.location.lat,e.location.lng,n,!0)}deleteValue(e){return this.scenario.stationAdapter.delete(e)}validateParent(e){return Ln(e)}async onFileSelection(e,n,i){let o=await this.mapView.getCenter();await this.scenario.resolveOrigin(o);let s=await this.scenario.stationAdapter.create(n.id,n.name,o.lat,o.lng,o.alt,i);return await this.scenario.stationAdapter.update(s,{zone:e}),s}get metadata(){return this._metadata}set metadata(e){e!==this.metadata&&(this._metadata=e,this.refresh())}get hasMetadata(){return T(this.metadata)}get label(){return this.hasValue?this.labelInput.value:null}set label(e){this.labelInput.value=e}get elevation(){return this.hasValue?this.elevationInput.valueAsNumber:null}set elevation(e){T(e)&&(e=Nh(Math.round(Oh(e)))),e!==this.elevation&&(this.elevationInput.valueAsNumber=e)}get rotationEuler(){return new Yi().set(at(this.rotationX),at(this.rotationY),at(this.rotationZ),"XYZ")}set rotationEuler(e){this.rotationX=Yt(e.x),this.rotationY=Yt(e.y),this.rotationZ=Yt(e.z)}get rotationQuat(){return new xt().setFromEuler(this.rotationEuler)}set rotationQuat(e){this.rotationEuler=new Yi().setFromQuaternion(e)}get rotationArray(){return this.rotationQuat.toArray()}set rotationArray(e){this.rotationQuat=new xt().fromArray(e)}get rotationX(){return nn(this.rotationXInput.value)}set rotationX(e){this.rotationXInput.value=$t(e)}get rotationY(){return nn(this.rotationYInput.value)}set rotationY(e){this.rotationYInput.value=$t(e)}get rotationZ(){return nn(this.rotationZInput.value)}set rotationZ(e){this.rotationZInput.value=$t(e)}get isStartStation(){return this.hasScenario&&this.hasValue&&this.scenario.startStation===this.value}get canMarkStartStation(){return this.canEdit&&!this.isStartStation}onValueChanged(){if(super.onValueChanged(),this.hasValue){let[e,n]=new en(this.value.location).toDMSArray(2);Ye(this.latitudeBox,e),Ye(this.longitudeBox,n),this.label=this.value.label,this.elevation=this.value.location.alt,this.rotationArray=this.value.rotation,this.mapView.getMetadataForFile(this.value.fileID).then(i=>this.metadata=i)}else Ye(this.latitudeBox,"N/A"),Ye(this.longitudeBox,"N/A"),this.label=null,this.elevation=null,this.rotationX=null,this.rotationY=null,this.rotationZ=null,this.metadata=null}onRefresh(){super.onRefresh(),this.properties.setGroupVisible(s_,this.hasMetadata),this.hasMetadata&&(Ye(this.googlePanoIDBox,this.metadata.pano_id),_a(this.googlePanoIDBox,this.metadata.pano_id)),this.properties.setGroupVisible(a_,this.isStartStation),this.isStartStation&&(this.startRotationBox.value=$t(Yt(this.scenario.startRotation),1)),this.markStartButton.disabled=!this.canMarkStartStation,this.viewStreetViewButton.disabled=this.startRotationBox.disabled=this.labelInput.disabled=this.elevationInput.disabled=this.rotationXInput.disabled=this.rotationYInput.disabled=this.rotationZInput.disabled=this.connectButton.disabled=!this.canEdit}};var xg=class extends Sr{constructor(e){super("Text","Reset Text",e,[Bs],["text"],["Upload TXT files","Text item will not be visible in the app until the user clicks on the expand icon."]);let n=async()=>this.scenario.textAdapter.setRotation(this.value,this.rotationX,this.rotationY,this.rotationZ);this.addProperties(["Text",this.textInput=zi(Je(async()=>{this.hasValue&&(await this.scenario.textAdapter.updateThrottled(this.value,{text:this.textInput.value}),this.refreshValues())}))],["Width",this.sizeInput=new Pt(Ne("form-control"),Ft(0),vt(10),ft(.1),Ut("Size"),Je(()=>this.scenario.textAdapter.setSize(this.value,this.size)))],["Is Callout",this.isCalloutInput=nr(Je(async()=>{await this.scenario.textAdapter.update(this.value,{isCallout:this.isCalloutInput.checked}),this.refreshValues()}))],["Always Visible",this.alwaysVisibleInput=nr(Je(async()=>{await this.scenario.textAdapter.update(this.value,{alwaysVisible:this.alwaysVisibleInput.checked}),this.refreshValues()}))],["Pitch",this.rotationXInput=new Pt(Ne("form-control"),Ft(-180),vt(180),ft(.1),Je(n))],["Yaw",this.rotationYInput=new Pt(Ne("form-control"),Ft(-180),vt(180),ft(.1),Je(n))],["Roll",this.rotationZInput=new Pt(Ne("form-control"),Ft(-180),vt(180),ft(.1),Je(n))]),Object.seal(this),this.refresh()}getValueName(e){return e.fileName}renameValue(e,n){this.scenario.textAdapter.updateThrottled(e,{fileName:n})}async resetValue(e){await this.scenario.textAdapter.reset(e,this.scenario.env.defaultAvatarHeight)}deleteValue(e){return this.scenario.textAdapter.delete(e)}validateParent(e){return qt(e)}async getFile(e){let n=new FormData,i=this.scenario.textsByStation.get(e)||[],o=new Set(i.map(c=>c.fileName)),s=null;for(let c=0;s===null;++c)s=`Text Label ${c}`,o.has(s)&&(s=null);s=Bs.addExtension(s);let l=new File(["<Enter text>"],s,{type:Bs.value});return n.set("FormFile",l,s),n.set("Copyright","Diplomatic Language Services"),n.set("CopyrightDate",new Date(Date.now()).toDateString()),n.set("TagString","text"),this.scenario.env.fetcher.post("/editor/files/create").body(n).object().then(tt)}onFileSelection(e,n,i){return this.scenario.textAdapter.create(e,n,i)}get canEdit(){return super.canEdit&&fe(this.value.error)}get text(){return this.textInput.value}set text(e){this.textInput.value=e}get size(){return nn(this.sizeInput.value)}set size(e){this.sizeInput.value=$t(e,3)}get isCallout(){return this.isCalloutInput.indeterminate?null:this.isCalloutInput.checked}set isCallout(e){this.isCalloutInput.indeterminate=fe(e),this.isCalloutInput.checked=T(e)&&e}get alwaysVisible(){return this.alwaysVisibleInput.indeterminate?null:this.alwaysVisibleInput.checked}set alwaysVisible(e){this.alwaysVisibleInput.indeterminate=fe(e),this.alwaysVisibleInput.checked=T(e)&&e}get rotationX(){return nn(this.rotationXInput.value)}set rotationX(e){this.rotationXInput.value=$t(e)}get rotationY(){return nn(this.rotationYInput.value)}set rotationY(e){this.rotationYInput.value=$t(e)}get rotationZ(){return nn(this.rotationZInput.value)}set rotationZ(e){this.rotationZInput.value=$t(e)}onValueChanged(){super.onValueChanged(),this.hasValue?(this.text=this.value.text,this.size=this.value.size,this.isCallout=this.value.isCallout,this.alwaysVisible=this.value.alwaysVisible,this.rotationX=this.value.rotationX,this.rotationY=this.value.rotationY,this.rotationZ=this.value.rotationZ):(this.text=null,this.size=null,this.isCallout=null,this.alwaysVisible=null,this.rotationX=null,this.rotationY=null,this.rotationZ=null)}onRefresh(){super.onRefresh(),this.textInput.disabled=this.sizeInput.disabled=this.isCalloutInput.disabled=this.alwaysVisibleInput.disabled=this.rotationXInput.disabled=this.rotationYInput.disabled=this.rotationZInput.disabled=!this.canEdit}};var wg=class extends Sr{constructor(e){super("Video","Reset Video",e,[Zg,ex,nx,Es],["video"],["Link to videos hosted on YouTube, or","Upload WEBM, MP4, or MPG files."]);let n=()=>{this.scenario.videoAdapter.setSphereEncodingAndLayout(this.value,this.sphereEncoding,this.stereoLayout)||(this.sphereEncoding=this.value.sphereEncodingName,this.stereoLayout=this.value.stereoLayoutName)},i=()=>{this.scenario.videoAdapter.updateThrottled(this.value,{enabled:this.clipEnabled,label:this.label,volume:this.volume})},o=()=>{this.scenario.videoAdapter.setRotation(this.value,this.rotationX,this.rotationY,this.rotationZ)};this.addProperties(["Enabled",this.enabledInput=nr(Je(i))],["Label",this.labelInput=zi(Ne("form-control"),Ut("Enter label"),Ea("soft"),qo(!1),kn("lpignore","true"),Je(i))],["Volume",this.volumeInput=new Pt(Ne("form-control"),Ft(0),vt(100),ft(1),Ut("Volume"),Je(i))],["Type",this.sphereEncodingInput=fr(Ne("custom-select"),Je(n),...ry.map(s=>Bn(s,hn(s))))],["Layout",this.stereoLayoutInput=fr(Ne("custom-select"),Je(n),...iy.map(s=>Bn(s,hn(s))))],["Width",this.sizeInput=new Pt(Ne("form-control"),Ft(0),vt(10),ft(.1),Ut("Size"),Je(()=>this.scenario.videoAdapter.setSize(this.value,this.size)))],["Pitch",this.rotationXInput=new Pt(Ne("form-control"),Ft(-180),vt(180),ft(.1),Je(o))],["Yaw",this.rotationYInput=new Pt(Ne("form-control"),Ft(-180),vt(180),ft(.1),Je(o))],["Roll",this.rotationZInput=new Pt(Ne("form-control"),Ft(-180),vt(180),ft(.1),Je(o))]),Object.seal(this),this.refreshValues()}getValueName(e){return e.fileName}renameValue(e,n){this.scenario.videoAdapter.updateThrottled(e,{fileName:n})}async resetValue(e){await this.scenario.videoAdapter.reset(e,this.scenario.env.defaultAvatarHeight)}deleteValue(e){return this.scenario.videoAdapter.delete(e)}validateParent(e){return qt(e)}onFileSelection(e,n,i){return this.scenario.videoAdapter.create(e,n,i)}get canEdit(){return super.canEdit&&fe(this.value.error)}get clipEnabled(){return this.enabledInput.indeterminate?null:this.enabledInput.checked}set clipEnabled(e){this.enabledInput.indeterminate=fe(e),this.enabledInput.checked=T(e)&&e}get label(){return this.labelInput.value}set label(e){this.labelInput.value=e}get volume(){return Sd(this.volumeInput.value)}set volume(e){this.volumeInput.value=bd(e)}get sphereEncoding(){return this.sphereEncodingInput.value}set sphereEncoding(e){this.sphereEncodingInput.value=e}get stereoLayout(){return this.stereoLayoutInput.value}set stereoLayout(e){this.stereoLayoutInput.value=e}get size(){return nn(this.sizeInput.value)}set size(e){this.sizeInput.value=$t(e,3)}get rotationX(){return nn(this.rotationXInput.value)}set rotationX(e){this.rotationXInput.value=$t(e)}get rotationY(){return nn(this.rotationYInput.value)}set rotationY(e){this.rotationYInput.value=$t(e)}get rotationZ(){return nn(this.rotationZInput.value)}set rotationZ(e){this.rotationZInput.value=$t(e)}onValueChanged(){super.onValueChanged(),this.hasValue?(this.clipEnabled=this.value.enabled,this.label=this.value.label,this.volume=this.value.volume,this.sphereEncoding=this.value.sphereEncodingName,this.stereoLayout=this.value.stereoLayoutName,this.size=this.value.size,this.rotationX=this.value.rotationX,this.rotationY=this.value.rotationY,this.rotationZ=this.value.rotationZ):(this.clipEnabled=null,this.label=null,this.volume=null,this.sphereEncoding=null,this.stereoLayout=null,this.size=null,this.rotationX=null,this.rotationY=null,this.rotationZ=null)}onRefresh(){super.onRefresh(),this.sizeInput.disabled=this.rotationXInput.disabled=this.rotationYInput.disabled=this.rotationZInput.disabled=this.sphereEncodingInput.disabled=this.stereoLayoutInput.disabled=!this.canEdit}};function l_(r){return/^default$/i.test(r)}var vg=class extends vc{constructor(){super("Zone",["Use zones to group environment audio and stations","Environment audio will only be played when the user is in a station grouped in the same zone as the audio","The Default zone cannot be renamed or deleted","Empty zones won't be saved"],!1),Object.seal(this),Object.assign(window,{zones:this}),this.refreshValues()}getValueName(t){return t||"Default"}deleteValue(t){return this.renameValue(t,""),Promise.resolve()}renameValue(t,e){this.scenario.audios.filter(n=>n.spatialize&&n.zone===t).forEach(n=>this.scenario.audioAdapter.updateThrottled(n,{zone:e})),this.scenario.stations.filter(n=>n.zone===t).forEach(n=>this.scenario.stationAdapter.updateThrottled(n,{zone:e})),this.scenario.refreshZones()}createValue(){let t=0,e=null;do e=t===0?"New Zone":`New Zone - ${t}`,++t;while(this.scenario.zones.indexOf(e)>-1);return this.scenario.zones.push(e),Promise.resolve(e)}get canEdit(){return super.canEdit&&!l_(this.getValueName(this.value))}get canRename(){return super.canRename&&this.name.length>0&&!l_(this.name.toLowerCase())}};var sde=/\/\d+\/?$/,Fg=class{constructor(t,e){this.logger=e;this.fileDetailDialog=new eg;this._scenario=null;this._disabled=!1;this.selecting=!1;let n=Ca(Ct("frontBuffer")),i=De(Ct("appContainer"),n);this.env=new Gm({canvas:n,fetcher:t,dialogFontFamily:pd.fontFamily,getAppUrl:OF,uiImagePaths:VF(),buttonFillColor:Xa,labelFillColor:IF,defaultFOV:75,enableFullResolution:PF,DEBUG:!0,watchModelPath:"/models/watch1.glb"}),this.transformer=new Xd(this.env),this.transformer.addEventListener("moving",()=>{if(this.transformer.target===this.stationView.stationTransformDummy)this.stationView.updateRotationFromTransformer();else if(this.transformer.target instanceof gi){let d=this.scenario.getAssetForTransform(this.transformer.target);T(d)&&this.getViewFor(d).updateTransformView(d)}}),this.transformer.addEventListener("moved",()=>{if(this.transformer.target===this.stationView.stationTransformDummy)this.stationView.updateRotationFromTransformer(),this.stationView.saveRotation();else if(this.transformer.target instanceof gi){let d=this.scenario.getAssetForTransform(this.transformer.target);if(T(d)){let h=this.getViewFor(d);this.withLock(()=>h.saveTransform(d))}}}),We(this.env.subMenu,...this.transformer.modeButtons),this.env.foreground.add(this.transformer.object);let o=De(Ct("streetViewPreview"));this.mapView=new pg(t,o,this.env);let s=new vf(t,this.env);this.stationView=new gg(s,this.mapView);let l=new Map([["station",this.stationView],["ambientAudio",new og(s,this.mapView)],["audio",new rg(s)],["video",new wg(s)],["text",new xg(s)],["sign",new mg(s)],["model",new dg(s)]]),c=new Map([...Array.from(l.entries()),["connection",this.connectionView=new ig]]),u=new Map([...Array.from(c.entries()),["zone",new vg]]);this.propertyViews=new Map([...Array.from(u.entries()),["scenario",this.scenarioView=new hg]]),this.scenarioView.addEventListener("loadscenario",d=>this.withLock(async()=>{this.scenario=null,await this.loadScenario(d.scenarioID)})),this.scenarioView.addEventListener("forkscenario",()=>this.withLock(async()=>{let d=this.scenario;this.scenario=null;let h=await d.fork().then(tt);await this.loadScenario(h)})),this.scenarioView.addEventListener("publishscenario",d=>this.withLock(async()=>{let h=this.scenario;this.scenario=null,await h.publish(),await this.loadScenario(d.scenarioID)}));let p=d=>{this.withLock(async()=>{let h=d.asset,M=this.getViewFor(h);await this.fileDetailDialog.showFile(h.fileID),await M.reloadFile()})};for(let d of l.values())d.addEventListener("assetviewfile",p);let f=d=>{this.withLock(async()=>{let h=Ho(d.asset),M=c.get(h);await M.resetValue(d.asset),M.refreshValues()})};for(let d of c.values())d.addEventListener("assetreset",f);let w=d=>{this.deleteAsset(d.asset)},A=d=>{let{newName:h,asset:M}=d;if(h!==M)if(this.getViewFor(M).renameValue(M,h),Ln(M)){let E=this.assetsList.findNode(M),b=this.assetsList.findNode(h);fe(b)&&(this.assetsList.addValue(h),b=this.assetsList.findNode(h)),this.moveZoneChildren(E,b),this.assetsList.removeNode(E)}else{let E=this.assetsList.findNode(M);this.assetsList.updateNode(E)}};for(let d of u.values())d.addEventListener("assetdelete",w),d.addEventListener("assetrename",A);We(document.body,this.contextMenu=new Xm),this.element=RT("Yarrow.Editor2",PT(!0),LT(!0),Ne("editor"),$m(BT(kn("proportion",2),np("Assets",this.assetsList=new Zf),np("Properties",...this.propertyViews.values())),np("Map",kn("proportion",3),this.mapView),np(Ui(".",n0("transparent")),_p("visible"),kn("proportion",6),this.viewTabs=co.create(["appContainer","Preview",i],["streetview","Google StreetView",o]))));for(let d of this.propertyViews.values())d.visible=!1;this.scenarioView.visible=!0,this.assetsList.addEventListener("select",d=>{this.selectValue(T(d.node)&&T(d.node.value)?d.node.value:this.scenario)}),Xh(this.env.quitButton),Xh(this.env.settingsButton),Xh(this.env.muteEnvAudioButton);let m=async d=>{await this.onMenu(d.parent.node,d.type==="contextmenu"),d.complete()};this.assetsList.addEventListener("add",m),this.assetsList.addEventListener("contextmenu",m),this.assetsList.addEventListener("delete",d=>{this.deleteAsset(d.node.value)}),this.assetsList.addEventListener("reparented",d=>{d.node.parent&&Ln(d.node.parent.value)&&(No(d.node.value)?this.scenario.audioAdapter.updateThrottled(d.node.value,{zone:d.node.parent.value}):qt(d.node.value)&&this.scenario.stationAdapter.updateThrottled(d.node.value,{zone:d.node.parent.value}))}),this.stationView.addEventListener("stationmarkstart",d=>{this.withLock(async()=>{let h=this.scenario.startStation;await this.scenario.stationAdapter.markStart(d.station);let M=this.assetsList.findNode(h),k=this.assetsList.findNode(d.station);this.assetsList.updateNode(M),this.assetsList.updateNode(k)})}),this.stationView.addEventListener("createconnection",d=>{this.withLock(()=>this.createAsset("connection",d.station))}),this.connectionView.addEventListener("assetselected",d=>{d.isContextMenu||this.selectValue(d.asset)}),this.connectionView.addEventListener("connectionstarted",d=>{this.assetsList.enabled=!0,this.assetsList.enableOnlyValues(d.connectables),this.scenario.makeOnlyStationsSelectable(d.connectables)}),this.connectionView.addEventListener("connectionending",()=>{this.scenario.makeAllMarkersSelectable(),this.assetsList.enableAllElements(),this.assetsList.enabled=!1}),this.mapView.addEventListener("capturestart",()=>{this.disabled=!0,this.viewTabs.select("appContainer")}),this.mapView.addEventListener("capturecomplete",d=>{this.withLock(async()=>{let h=await this.mapView.getElevation(d.metadata.location),M=await this.scenario.stationAdapter.create(d.metadata.fileID,d.metadata.fileName,d.metadata.location.lat,d.metadata.location.lng,h);this.assetsList.addValue(M),await this.selectValue(M)})}),this.mapView.addEventListener("streetviewopened",()=>{this.viewTabs.select("streetview")}),this.viewTabs.addEventListener("tabselected",d=>{d.tabname!=="streetview"&&this.mapView.closeStreetView()}),this.withLock(()=>this.load())}moveZoneChildren(t,e){for(let n of t.children)this.assetsList.reparentNode(n,e,0)}deleteAsset(t){return ei(t)?Promise.reject("Can't delete the scenario"):this.withLock(async()=>{let e=Ho(t),n=this.getView(e),i=this.assetsList.findNode(t),o=i.parent,s=mc.get(e);if(await this.env.confirmationDialog.prompt(hA.emojiStyle+" Confirm Delete",`Are you sure you want to delete ${s}: ${this.assetsList.getAssetName(t)}`)){if(n.value=null,Ln(t)){let c=this.assetsList.findNode("");this.moveZoneChildren(i,c)}else if(qt(t)){let c=this.assetsList.findAll(u=>Oi(u)&&u.toStationID===t.transformID);for(let u of c)this.assetsList.removeNode(u)}else if(Oi(t)){let c=this.assetsList.findAll(u=>Oi(u)&&u.toStationID===t.fromStationID&&u.fromStationID==t.toStationID);for(let u of c)this.assetsList.removeNode(u)}let l=this.assetsList.selectedNode===i;this.assetsList.removeNode(i),await n.deleteValue(t),l&&await this.selectNode(o)}})}async getSelection(t,e){if(this.connectionView.cancelConnection(),this.scenario.published)return await this.contextMenu.show(Wo,"readonly");{let n=t.value;return t.isRoot||ei(n)?e?await this.contextMenu.show(Wo,"zone"):"zone":Ln(n)?e&&n!==""?await this.contextMenu.show(Wo,"ambientAudio","station",Hg(),"delete"):await this.contextMenu.show(Wo,"ambientAudio","station"):qt(n)?e?await this.contextMenu.show(Wo,"audio","sign","video","text","model","connection",Hg(),"delete"):await this.contextMenu.show(Wo,"audio","sign","video","text","model","connection"):e?await this.contextMenu.show(Wo,"delete"):"cancel"}}async onMenu(t,e){await this.contextMenu.cancel(),await this.withLock(async()=>{let n=await this.getSelection(t,e),i=t.value;n==="cancel"||n==="readonly"?console.warn("Cancelled"):n==="delete"?await this.deleteAsset(i):await this.createAsset(n,i)})}async createAsset(t,e){t==="connection"&&await this.selectValue(e);let i=await this.getView(t).createValue(e,this.env.loadingBar);if(T(i))if(this.assetsList.addValue(i),Oi(i)){if(!qt(e))throw new Error("Connections must be created for Stations only");let o=this.scenario.getStation(i.toStationID),s=this.scenario.connectionAdapter.findConnection(o,e);this.assetsList.addValue(s),await this.selectValue(o)}else await this.selectValue(i)}async load(){let t=document.location.pathname.split("/");if(t.length===0)throw new Error("Illegal path");let e=t[t.length-1];if(!/^\d+$/.test(e))throw new Error("Illegal ID");let n=Gt(this.env.loadingBar,[1,9]),i=parseFloat(e);await this.mapView.load(n[0]),await this.loadScenario(i,n[1])}async loadScenario(t,e){e=e||this.env.loadingBar;let n=new li(location.href).pathPop(sde).pathPush(t.toString()).toString();history.replaceState(null,null,n);let i=new Xf(this.env,this.logger,this.mapView,t);await this.env.load(e,i),this.scenario=i.result,this.env.menuButton.disabled=this.scenario.published}get scenario(){return this._scenario}set scenario(t){let e=this.scenario;T(e)&&e.removeScope(this),this.assetsList.scenario=this.mapView.scenario=this._scenario=t;for(let n of this.propertyViews.values())n.scenario=t;T(e)&&e.dispose(),T(this.scenario)&&(this.scenario.addScopedEventListener(this,"assetselected",async n=>{if(n.isContextMenu){let i=this.assetsList.findNode(n.asset);await this.onMenu(i,!0)}else this.selectValue(n.asset)}),this.scenario.addScopedEventListener(this,"assetupdated",n=>{n.asset===this.assetsList.selectedValue&&this.getViewFor(n.asset).refreshValues()}),this.showScenario())}showScenario(){this.scenario.stations.length>1?this.mapView.fitBounds(...this.scenario.stations.map(t=>t.location)):T(this.scenario.originLL)?this.mapView.panTo(ki(this.scenario.originLL)):this.scenario.stations.length>0?(this.mapView.zoom=15,this.scenario.startStation?this.mapView.panTo(this.scenario.startStation.location):this.mapView.panTo(this.scenario.stations[0].location)):this.withLock(async()=>{await this.mapView.search(this.scenario.name,!1)})}get disabled(){return this._disabled}set disabled(t){this._disabled=t,this.mapView.disabled=this.assetsList.disabled=t;for(let e of this.propertyViews.values())e.disabled=t}async withLock(t){this.disabled=!0;try{await t()}finally{this.disabled=!1}}getView(t){return this.propertyViews.get(t)}getViewFor(t){let e=Ho(t);return this.getView(e)}async selectValue(t){let e=this.assetsList.findNode(t);await this.selectNode(e)}async selectNode(t){if(this.connectionView.isConnecting)T(t)&&qt(t.value)&&this.connectionView.connectTo(t.value);else if(!this.selecting){this.selecting=!0;try{await this.withLock(async()=>{this.transformer.setTarget(null),this.assetsList.selectedNode=t;for(let e of this.propertyViews.values())e.visible=!1;if(T(t)&&T(t.value)){let e=t.value,n=this.getViewFor(e);if(n.visible=!0,n.value=e,ei(e))this.showScenario();else if(Ln(e))this.transformer.setTarget(null),this.mapView.setTarget(null);else{let i=this.scenario.getTransform(e.transformID);if(!No(e)){let s=this.scenario.findStation(i);this.viewTabs.select("appContainer"),this.mapView.closeStreetView(),await this.scenario.showStationNow(s);let l=this.getViewFor(e);qt(e)?(this.stationView.stationTransformDummy.quaternion.fromArray(s.rotation),this.transformer.setTarget(this.stationView.stationTransformDummy,l.getTransformModes(e))):this.transformer.setTarget(i,l.getTransformModes(e))}let o=this.scenario.getTransformPosition(e.transformID);this.mapView.setTarget(o),qt(e)||this.env.avatar.lookAt(i)}}})}finally{this.selecting=!1}}}};var c_=dd(),ade=WF(c_),u_=new Fg(c_,ade);We(Rp("#layoutForm"),Kn(on(100)),go(on(100)),u_);Object.assign(window,{editor:u_});
