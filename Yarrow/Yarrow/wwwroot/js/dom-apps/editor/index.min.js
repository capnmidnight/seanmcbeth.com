var GT=Object.create;var Ag=Object.defineProperty;var XT=Object.getOwnPropertyDescriptor;var qT=Object.getOwnPropertyNames;var YT=Object.getPrototypeOf,KT=Object.prototype.hasOwnProperty;var vg=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')});var So=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),ti=(n,e)=>{for(var t in e)Ag(n,t,{get:e[t],enumerable:!0})},QT=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of qT(e))!KT.call(n,r)&&r!==t&&Ag(n,r,{get:()=>e[r],enumerable:!(i=XT(e,r))||i.enumerable});return n};var D0=(n,e,t)=>(t=n!=null?GT(YT(n)):{},QT(e||!n||!n.__esModule?Ag(t,"default",{value:n,enumerable:!0}):t,n));var V_=So((Rw,Iw)=>{(function(n,e){typeof Rw=="object"&&typeof Iw<"u"?Iw.exports=e():typeof define=="function"&&define.amd?define(e):n.CardboardVRDisplay=e()})(Rw,function(){"use strict";var n=function(){function f(E){this.value=E}function w(E){var D,U;function Q(we,le){return new Promise(function(pe,Te){var Re={key:we,arg:le,resolve:pe,reject:Te,next:null};U?U=U.next=Re:(D=U=Re,te(we,le))})}function te(we,le){try{var pe=E[we](le),Te=pe.value;Te instanceof f?Promise.resolve(Te.value).then(function(Re){te("next",Re)},function(Re){te("throw",Re)}):ve(pe.done?"return":"normal",pe.value)}catch(Re){ve("throw",Re)}}function ve(we,le){switch(we){case"return":D.resolve({value:le,done:!0});break;case"throw":D.reject(le);break;default:D.resolve({value:le,done:!1});break}D=D.next,D?te(D.key,D.arg):U=null}this._invoke=Q,typeof E.return!="function"&&(this.return=void 0)}return typeof Symbol=="function"&&Symbol.asyncIterator&&(w.prototype[Symbol.asyncIterator]=function(){return this}),w.prototype.next=function(E){return this._invoke("next",E)},w.prototype.throw=function(E){return this._invoke("throw",E)},w.prototype.return=function(E){return this._invoke("return",E)},{wrap:function(E){return function(){return new w(E.apply(this,arguments))}},await:function(E){return new f(E)}}}(),e=function(f,w){if(!(f instanceof w))throw new TypeError("Cannot call a class as a function")},t=function(){function f(w,E){for(var D=0;D<E.length;D++){var U=E[D];U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(w,U.key,U)}}return function(w,E,D){return E&&f(w.prototype,E),D&&f(w,D),w}}(),i=function(){function f(w,E){var D=[],U=!0,Q=!1,te=void 0;try{for(var ve=w[Symbol.iterator](),we;!(U=(we=ve.next()).done)&&(D.push(we.value),!(E&&D.length===E));U=!0);}catch(le){Q=!0,te=le}finally{try{!U&&ve.return&&ve.return()}finally{if(Q)throw te}}return D}return function(w,E){if(Array.isArray(w))return w;if(Symbol.iterator in Object(w))return f(w,E);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=.001,o=1,s=function(w,E){return"data:"+w+","+encodeURIComponent(E)},l=function(w,E,D){return w+(E-w)*D},c=function(){var f=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return f}}(),u=function(){var f=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return f}}(),p=function(){var f=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return f}}(),d=function(){var f=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return f}}(),h=function(){var f=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),w=f?parseInt(f[1],10):null;return function(){return w}}(),A=function(){var f=!1;return f=c()&&p()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return f}}(),g=function(){var f=!1;if(h()===65){var w=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(w){var E=w[1].split("."),D=i(E,4),U=D[0],Q=D[1],te=D[2],ve=D[3];f=parseInt(te,10)===3325&&parseInt(ve,10)<148}}return function(){return f}}(),F=function(){var f=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return f}}(),b=function(){var w=window.orientation==90||window.orientation==-90;return F()?!w:w},R=function(w){return!(isNaN(w)||w<=r||w>o)},P=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},L=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},S=function(w){if(u())return!1;if(w.requestFullscreen)w.requestFullscreen();else if(w.webkitRequestFullscreen)w.webkitRequestFullscreen();else if(w.mozRequestFullScreen)w.mozRequestFullScreen();else if(w.msRequestFullscreen)w.msRequestFullscreen();else return!1;return!0},x=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},v=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},M=function(w,E,D,U){var Q=w.createShader(w.VERTEX_SHADER);w.shaderSource(Q,E),w.compileShader(Q);var te=w.createShader(w.FRAGMENT_SHADER);w.shaderSource(te,D),w.compileShader(te);var ve=w.createProgram();w.attachShader(ve,Q),w.attachShader(ve,te);for(var we in U)w.bindAttribLocation(ve,U[we],we);return w.linkProgram(ve),w.deleteShader(Q),w.deleteShader(te),ve},O=function(w,E){for(var D={},U=w.getProgramParameter(E,w.ACTIVE_UNIFORMS),Q="",te=0;te<U;te++){var ve=w.getActiveUniform(E,te);Q=ve.name.replace("[0]",""),D[Q]=w.getUniformLocation(E,Q)}return D},B=function(w,E,D,U,Q,te,ve){var we=1/(E-D),le=1/(U-Q),pe=1/(te-ve);return w[0]=-2*we,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*le,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=2*pe,w[11]=0,w[12]=(E+D)*we,w[13]=(Q+U)*le,w[14]=(ve+te)*pe,w[15]=1,w},X=function(){var w=!1;return function(E){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(E)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(E.substr(0,4)))&&(w=!0)}(navigator.userAgent||navigator.vendor||window.opera),w},V=function(w,E){for(var D in E)E.hasOwnProperty(D)&&(w[D]=E[D]);return w},J=function(w){if(c()){var E=w.style.width,D=w.style.height;w.style.width=parseInt(E)+1+"px",w.style.height=parseInt(D)+"px",setTimeout(function(){w.style.width=E,w.style.height=D},100)}window.canvas=w},ce=function(){var f=Math.PI/180,w=Math.PI*.25;function E(le,pe,Te,Re){var He=Math.tan(pe?pe.upDegrees*f:w),Ge=Math.tan(pe?pe.downDegrees*f:w),ht=Math.tan(pe?pe.leftDegrees*f:w),Ze=Math.tan(pe?pe.rightDegrees*f:w),$e=2/(ht+Ze),Gt=2/(He+Ge);return le[0]=$e,le[1]=0,le[2]=0,le[3]=0,le[4]=0,le[5]=Gt,le[6]=0,le[7]=0,le[8]=-((ht-Ze)*$e*.5),le[9]=(He-Ge)*Gt*.5,le[10]=Re/(Te-Re),le[11]=-1,le[12]=0,le[13]=0,le[14]=Re*Te/(Te-Re),le[15]=0,le}function D(le,pe,Te){var Re=pe[0],He=pe[1],Ge=pe[2],ht=pe[3],Ze=Re+Re,$e=He+He,Gt=Ge+Ge,An=Re*Ze,Cn=Re*$e,on=Re*Gt,ei=He*$e,Ci=He*Gt,Li=Ge*Gt,Pi=ht*Ze,Ri=ht*$e,bo=ht*Gt;return le[0]=1-(ei+Li),le[1]=Cn+bo,le[2]=on-Ri,le[3]=0,le[4]=Cn-bo,le[5]=1-(An+Li),le[6]=Ci+Pi,le[7]=0,le[8]=on+Ri,le[9]=Ci-Pi,le[10]=1-(An+ei),le[11]=0,le[12]=Te[0],le[13]=Te[1],le[14]=Te[2],le[15]=1,le}function U(le,pe,Te){var Re=Te[0],He=Te[1],Ge=Te[2],ht,Ze,$e,Gt,An,Cn,on,ei,Ci,Li,Pi,Ri;return pe===le?(le[12]=pe[0]*Re+pe[4]*He+pe[8]*Ge+pe[12],le[13]=pe[1]*Re+pe[5]*He+pe[9]*Ge+pe[13],le[14]=pe[2]*Re+pe[6]*He+pe[10]*Ge+pe[14],le[15]=pe[3]*Re+pe[7]*He+pe[11]*Ge+pe[15]):(ht=pe[0],Ze=pe[1],$e=pe[2],Gt=pe[3],An=pe[4],Cn=pe[5],on=pe[6],ei=pe[7],Ci=pe[8],Li=pe[9],Pi=pe[10],Ri=pe[11],le[0]=ht,le[1]=Ze,le[2]=$e,le[3]=Gt,le[4]=An,le[5]=Cn,le[6]=on,le[7]=ei,le[8]=Ci,le[9]=Li,le[10]=Pi,le[11]=Ri,le[12]=ht*Re+An*He+Ci*Ge+pe[12],le[13]=Ze*Re+Cn*He+Li*Ge+pe[13],le[14]=$e*Re+on*He+Pi*Ge+pe[14],le[15]=Gt*Re+ei*He+Ri*Ge+pe[15]),le}function Q(le,pe){var Te=pe[0],Re=pe[1],He=pe[2],Ge=pe[3],ht=pe[4],Ze=pe[5],$e=pe[6],Gt=pe[7],An=pe[8],Cn=pe[9],on=pe[10],ei=pe[11],Ci=pe[12],Li=pe[13],Pi=pe[14],Ri=pe[15],bo=Te*Ze-Re*ht,fc=Te*$e-He*ht,gc=Te*Gt-Ge*ht,xc=Re*$e-He*Ze,wc=Re*Gt-Ge*Ze,Fc=He*Gt-Ge*$e,Ac=An*Li-Cn*Ci,vc=An*Pi-on*Ci,bc=An*Ri-ei*Ci,Sc=Cn*Pi-on*Li,_c=Cn*Ri-ei*Li,yc=on*Ri-ei*Pi,Tn=bo*yc-fc*_c+gc*Sc+xc*bc-wc*vc+Fc*Ac;return Tn?(Tn=1/Tn,le[0]=(Ze*yc-$e*_c+Gt*Sc)*Tn,le[1]=(He*_c-Re*yc-Ge*Sc)*Tn,le[2]=(Li*Fc-Pi*wc+Ri*xc)*Tn,le[3]=(on*wc-Cn*Fc-ei*xc)*Tn,le[4]=($e*bc-ht*yc-Gt*vc)*Tn,le[5]=(Te*yc-He*bc+Ge*vc)*Tn,le[6]=(Pi*gc-Ci*Fc-Ri*fc)*Tn,le[7]=(An*Fc-on*gc+ei*fc)*Tn,le[8]=(ht*_c-Ze*bc+Gt*Ac)*Tn,le[9]=(Re*bc-Te*_c-Ge*Ac)*Tn,le[10]=(Ci*wc-Li*gc+Ri*bo)*Tn,le[11]=(Cn*gc-An*wc-ei*bo)*Tn,le[12]=(Ze*vc-ht*Sc-$e*Ac)*Tn,le[13]=(Te*Sc-Re*vc+He*Ac)*Tn,le[14]=(Li*fc-Ci*xc-Pi*bo)*Tn,le[15]=(An*xc-Cn*fc+on*bo)*Tn,le):null}var te=new Float32Array([0,0,0,1]),ve=new Float32Array([0,0,0]);function we(le,pe,Te,Re,He,Ge){E(le,Re||null,Ge.depthNear,Ge.depthFar);var ht=Te.orientation||te,Ze=Te.position||ve;D(pe,ht,Ze),He&&U(pe,pe,He),Q(pe,pe)}return function(le,pe,Te){return!le||!pe?!1:(le.pose=pe,le.timestamp=pe.timestamp,we(le.leftProjectionMatrix,le.leftViewMatrix,pe,Te._getFieldOfView("left"),Te._getEyeOffset("left"),Te),we(le.rightProjectionMatrix,le.rightViewMatrix,pe,Te._getFieldOfView("right"),Te._getEyeOffset("right"),Te),!0)}}(),G=function(){var w=window.self!==window.top,E=Y(document.referrer),D=Y(window.location.href);return w&&E!==D},Y=function(w){var E,D=w.indexOf("://");D!==-1?E=D+3:E=0;var U=w.indexOf("/",E);return U===-1&&(U=w.length),w.substring(0,U)},K=function(w){if(w.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var E=2*Math.acos(w.w);return E},se=function(){var f={};return function(w,E){f[w]===void 0&&(console.warn("webvr-polyfill: "+E),f[w]=!0)}}(),$=function(w,E){var D=E?"Please use "+E+" instead.":"";se(w,w+" has been deprecated. This may not work on native WebVR displays. "+D)};function z(f,w,E){if(!w){E(f);return}for(var D=[],U=null,Q=0;Q<w.length;++Q){var te=w[Q];switch(te){case f.TEXTURE_BINDING_2D:case f.TEXTURE_BINDING_CUBE_MAP:var ve=w[++Q];if(ve<f.TEXTURE0||ve>f.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),D.push(null,null);break}U||(U=f.getParameter(f.ACTIVE_TEXTURE)),f.activeTexture(ve),D.push(f.getParameter(te),null);break;case f.ACTIVE_TEXTURE:U=f.getParameter(f.ACTIVE_TEXTURE),D.push(null);break;default:D.push(f.getParameter(te));break}}E(f);for(var Q=0;Q<w.length;++Q){var te=w[Q],we=D[Q];switch(te){case f.ACTIVE_TEXTURE:break;case f.ARRAY_BUFFER_BINDING:f.bindBuffer(f.ARRAY_BUFFER,we);break;case f.COLOR_CLEAR_VALUE:f.clearColor(we[0],we[1],we[2],we[3]);break;case f.COLOR_WRITEMASK:f.colorMask(we[0],we[1],we[2],we[3]);break;case f.CURRENT_PROGRAM:f.useProgram(we);break;case f.ELEMENT_ARRAY_BUFFER_BINDING:f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,we);break;case f.FRAMEBUFFER_BINDING:f.bindFramebuffer(f.FRAMEBUFFER,we);break;case f.RENDERBUFFER_BINDING:f.bindRenderbuffer(f.RENDERBUFFER,we);break;case f.TEXTURE_BINDING_2D:var ve=w[++Q];if(ve<f.TEXTURE0||ve>f.TEXTURE31)break;f.activeTexture(ve),f.bindTexture(f.TEXTURE_2D,we);break;case f.TEXTURE_BINDING_CUBE_MAP:var ve=w[++Q];if(ve<f.TEXTURE0||ve>f.TEXTURE31)break;f.activeTexture(ve),f.bindTexture(f.TEXTURE_CUBE_MAP,we);break;case f.VIEWPORT:f.viewport(we[0],we[1],we[2],we[3]);break;case f.BLEND:case f.CULL_FACE:case f.DEPTH_TEST:case f.SCISSOR_TEST:case f.STENCIL_TEST:we?f.enable(te):f.disable(te);break;default:console.log("No GL restore behavior for 0x"+te.toString(16));break}U&&f.activeTexture(U)}}var k=z,T=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),N=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function W(f,w,E,D){this.gl=f,this.cardboardUI=w,this.bufferScale=E,this.dirtySubmitFrameBindings=D,this.ctxAttribs=f.getContextAttributes(),this.instanceExt=f.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=f.drawingBufferWidth,this.bufferHeight=f.drawingBufferHeight,this.realBindFramebuffer=f.bindFramebuffer,this.realEnable=f.enable,this.realDisable=f.disable,this.realColorMask=f.colorMask,this.realClearColor=f.clearColor,this.realViewport=f.viewport,c()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(f.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(f.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=M(f,T,N,this.attribs),this.uniforms=O(f,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=f.createBuffer(),this.indexBuffer=f.createBuffer(),this.indexCount=0,this.renderTarget=f.createTexture(),this.framebuffer=f.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=f.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=f.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=f.createRenderbuffer()),this.patch(),this.onResize()}W.prototype.destroy=function(){var f=this.gl;this.unpatch(),f.deleteProgram(this.program),f.deleteBuffer(this.vertexBuffer),f.deleteBuffer(this.indexBuffer),f.deleteTexture(this.renderTarget),f.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&f.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&f.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&f.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},W.prototype.onResize=function(){var f=this.gl,w=this,E=[f.RENDERBUFFER_BINDING,f.TEXTURE_BINDING_2D,f.TEXTURE0];k(f,E,function(D){w.realBindFramebuffer.call(D,D.FRAMEBUFFER,null),w.scissorTest&&w.realDisable.call(D,D.SCISSOR_TEST),w.realColorMask.call(D,!0,!0,!0,!0),w.realViewport.call(D,0,0,D.drawingBufferWidth,D.drawingBufferHeight),w.realClearColor.call(D,0,0,0,1),D.clear(D.COLOR_BUFFER_BIT),w.realBindFramebuffer.call(D,D.FRAMEBUFFER,w.framebuffer),D.bindTexture(D.TEXTURE_2D,w.renderTarget),D.texImage2D(D.TEXTURE_2D,0,w.ctxAttribs.alpha?D.RGBA:D.RGB,w.bufferWidth,w.bufferHeight,0,w.ctxAttribs.alpha?D.RGBA:D.RGB,D.UNSIGNED_BYTE,null),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_2D,w.renderTarget,0),w.ctxAttribs.depth&&w.ctxAttribs.stencil?(D.bindRenderbuffer(D.RENDERBUFFER,w.depthStencilBuffer),D.renderbufferStorage(D.RENDERBUFFER,D.DEPTH_STENCIL,w.bufferWidth,w.bufferHeight),D.framebufferRenderbuffer(D.FRAMEBUFFER,D.DEPTH_STENCIL_ATTACHMENT,D.RENDERBUFFER,w.depthStencilBuffer)):w.ctxAttribs.depth?(D.bindRenderbuffer(D.RENDERBUFFER,w.depthBuffer),D.renderbufferStorage(D.RENDERBUFFER,D.DEPTH_COMPONENT16,w.bufferWidth,w.bufferHeight),D.framebufferRenderbuffer(D.FRAMEBUFFER,D.DEPTH_ATTACHMENT,D.RENDERBUFFER,w.depthBuffer)):w.ctxAttribs.stencil&&(D.bindRenderbuffer(D.RENDERBUFFER,w.stencilBuffer),D.renderbufferStorage(D.RENDERBUFFER,D.STENCIL_INDEX8,w.bufferWidth,w.bufferHeight),D.framebufferRenderbuffer(D.FRAMEBUFFER,D.STENCIL_ATTACHMENT,D.RENDERBUFFER,w.stencilBuffer)),!D.checkFramebufferStatus(D.FRAMEBUFFER)===D.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),w.realBindFramebuffer.call(D,D.FRAMEBUFFER,w.lastBoundFramebuffer),w.scissorTest&&w.realEnable.call(D,D.SCISSOR_TEST),w.realColorMask.apply(D,w.colorMask),w.realViewport.apply(D,w.viewport),w.realClearColor.apply(D,w.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},W.prototype.patch=function(){if(!this.isPatched){var f=this,w=this.gl.canvas,E=this.gl;c()||(w.width=P()*this.bufferScale,w.height=L()*this.bufferScale,Object.defineProperty(w,"width",{configurable:!0,enumerable:!0,get:function(){return f.bufferWidth},set:function(U){f.bufferWidth=U,f.realCanvasWidth.set.call(w,U),f.onResize()}}),Object.defineProperty(w,"height",{configurable:!0,enumerable:!0,get:function(){return f.bufferHeight},set:function(U){f.bufferHeight=U,f.realCanvasHeight.set.call(w,U),f.onResize()}})),this.lastBoundFramebuffer=E.getParameter(E.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(E.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(D,U){f.lastBoundFramebuffer=U||f.framebuffer,f.realBindFramebuffer.call(E,D,f.lastBoundFramebuffer)},this.cullFace=E.getParameter(E.CULL_FACE),this.depthTest=E.getParameter(E.DEPTH_TEST),this.blend=E.getParameter(E.BLEND),this.scissorTest=E.getParameter(E.SCISSOR_TEST),this.stencilTest=E.getParameter(E.STENCIL_TEST),E.enable=function(D){switch(D){case E.CULL_FACE:f.cullFace=!0;break;case E.DEPTH_TEST:f.depthTest=!0;break;case E.BLEND:f.blend=!0;break;case E.SCISSOR_TEST:f.scissorTest=!0;break;case E.STENCIL_TEST:f.stencilTest=!0;break}f.realEnable.call(E,D)},E.disable=function(D){switch(D){case E.CULL_FACE:f.cullFace=!1;break;case E.DEPTH_TEST:f.depthTest=!1;break;case E.BLEND:f.blend=!1;break;case E.SCISSOR_TEST:f.scissorTest=!1;break;case E.STENCIL_TEST:f.stencilTest=!1;break}f.realDisable.call(E,D)},this.colorMask=E.getParameter(E.COLOR_WRITEMASK),E.colorMask=function(D,U,Q,te){f.colorMask[0]=D,f.colorMask[1]=U,f.colorMask[2]=Q,f.colorMask[3]=te,f.realColorMask.call(E,D,U,Q,te)},this.clearColor=E.getParameter(E.COLOR_CLEAR_VALUE),E.clearColor=function(D,U,Q,te){f.clearColor[0]=D,f.clearColor[1]=U,f.clearColor[2]=Q,f.clearColor[3]=te,f.realClearColor.call(E,D,U,Q,te)},this.viewport=E.getParameter(E.VIEWPORT),E.viewport=function(D,U,Q,te){f.viewport[0]=D,f.viewport[1]=U,f.viewport[2]=Q,f.viewport[3]=te,f.realViewport.call(E,D,U,Q,te)},this.isPatched=!0,J(w)}},W.prototype.unpatch=function(){if(this.isPatched){var f=this.gl,w=this.gl.canvas;c()||(Object.defineProperty(w,"width",this.realCanvasWidth),Object.defineProperty(w,"height",this.realCanvasHeight)),w.width=this.bufferWidth,w.height=this.bufferHeight,f.bindFramebuffer=this.realBindFramebuffer,f.enable=this.realEnable,f.disable=this.realDisable,f.colorMask=this.realColorMask,f.clearColor=this.realClearColor,f.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&f.bindFramebuffer(f.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){J(w)},1)}},W.prototype.setTextureBounds=function(f,w){f||(f=[0,0,.5,1]),w||(w=[.5,0,.5,1]),this.viewportOffsetScale[0]=f[0],this.viewportOffsetScale[1]=f[1],this.viewportOffsetScale[2]=f[2],this.viewportOffsetScale[3]=f[3],this.viewportOffsetScale[4]=w[0],this.viewportOffsetScale[5]=w[1],this.viewportOffsetScale[6]=w[2],this.viewportOffsetScale[7]=w[3]},W.prototype.submitFrame=function(){var f=this.gl,w=this,E=[];if(this.dirtySubmitFrameBindings||E.push(f.CURRENT_PROGRAM,f.ARRAY_BUFFER_BINDING,f.ELEMENT_ARRAY_BUFFER_BINDING,f.TEXTURE_BINDING_2D,f.TEXTURE0),k(f,E,function(U){w.realBindFramebuffer.call(U,U.FRAMEBUFFER,null);var Q=0,te=0;w.instanceExt&&(Q=U.getVertexAttrib(w.attribs.position,w.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),te=U.getVertexAttrib(w.attribs.texCoord,w.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),w.cullFace&&w.realDisable.call(U,U.CULL_FACE),w.depthTest&&w.realDisable.call(U,U.DEPTH_TEST),w.blend&&w.realDisable.call(U,U.BLEND),w.scissorTest&&w.realDisable.call(U,U.SCISSOR_TEST),w.stencilTest&&w.realDisable.call(U,U.STENCIL_TEST),w.realColorMask.call(U,!0,!0,!0,!0),w.realViewport.call(U,0,0,U.drawingBufferWidth,U.drawingBufferHeight),(w.ctxAttribs.alpha||c())&&(w.realClearColor.call(U,0,0,0,1),U.clear(U.COLOR_BUFFER_BIT)),U.useProgram(w.program),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,w.indexBuffer),U.bindBuffer(U.ARRAY_BUFFER,w.vertexBuffer),U.enableVertexAttribArray(w.attribs.position),U.enableVertexAttribArray(w.attribs.texCoord),U.vertexAttribPointer(w.attribs.position,2,U.FLOAT,!1,20,0),U.vertexAttribPointer(w.attribs.texCoord,3,U.FLOAT,!1,20,8),w.instanceExt&&(Q!=0&&w.instanceExt.vertexAttribDivisorANGLE(w.attribs.position,0),te!=0&&w.instanceExt.vertexAttribDivisorANGLE(w.attribs.texCoord,0)),U.activeTexture(U.TEXTURE0),U.uniform1i(w.uniforms.diffuse,0),U.bindTexture(U.TEXTURE_2D,w.renderTarget),U.uniform4fv(w.uniforms.viewportOffsetScale,w.viewportOffsetScale),U.drawElements(U.TRIANGLES,w.indexCount,U.UNSIGNED_SHORT,0),w.cardboardUI&&w.cardboardUI.renderNoState(),w.realBindFramebuffer.call(w.gl,U.FRAMEBUFFER,w.framebuffer),w.ctxAttribs.preserveDrawingBuffer||(w.realClearColor.call(U,0,0,0,0),U.clear(U.COLOR_BUFFER_BIT)),w.dirtySubmitFrameBindings||w.realBindFramebuffer.call(U,U.FRAMEBUFFER,w.lastBoundFramebuffer),w.cullFace&&w.realEnable.call(U,U.CULL_FACE),w.depthTest&&w.realEnable.call(U,U.DEPTH_TEST),w.blend&&w.realEnable.call(U,U.BLEND),w.scissorTest&&w.realEnable.call(U,U.SCISSOR_TEST),w.stencilTest&&w.realEnable.call(U,U.STENCIL_TEST),w.realColorMask.apply(U,w.colorMask),w.realViewport.apply(U,w.viewport),(w.ctxAttribs.alpha||!w.ctxAttribs.preserveDrawingBuffer)&&w.realClearColor.apply(U,w.clearColor),w.instanceExt&&(Q!=0&&w.instanceExt.vertexAttribDivisorANGLE(w.attribs.position,Q),te!=0&&w.instanceExt.vertexAttribDivisorANGLE(w.attribs.texCoord,te))}),c()){var D=f.canvas;(D.width!=w.bufferWidth||D.height!=w.bufferHeight)&&(w.bufferWidth=D.width,w.bufferHeight=D.height,w.onResize())}},W.prototype.updateDeviceInfo=function(f){var w=this.gl,E=this,D=[w.ARRAY_BUFFER_BINDING,w.ELEMENT_ARRAY_BUFFER_BINDING];k(w,D,function(U){var Q=E.computeMeshVertices_(E.meshWidth,E.meshHeight,f);if(U.bindBuffer(U.ARRAY_BUFFER,E.vertexBuffer),U.bufferData(U.ARRAY_BUFFER,Q,U.STATIC_DRAW),!E.indexCount){var te=E.computeMeshIndices_(E.meshWidth,E.meshHeight);U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,E.indexBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,te,U.STATIC_DRAW),E.indexCount=te.length}})},W.prototype.computeMeshVertices_=function(f,w,E){for(var D=new Float32Array(2*f*w*5),U=E.getLeftEyeVisibleTanAngles(),Q=E.getLeftEyeNoLensTanAngles(),te=E.getLeftEyeVisibleScreenRect(Q),ve=0,we=0;we<2;we++){for(var le=0;le<w;le++)for(var pe=0;pe<f;pe++,ve++){var Te=pe/(f-1),Re=le/(w-1),He=Te,Ge=Re,ht=l(U[0],U[2],Te),Ze=l(U[3],U[1],Re),$e=Math.sqrt(ht*ht+Ze*Ze),Gt=E.distortion.distortInverse($e),An=ht*Gt/$e,Cn=Ze*Gt/$e;Te=(An-Q[0])/(Q[2]-Q[0]),Re=(Cn-Q[3])/(Q[1]-Q[3]),Te=(te.x+Te*te.width-.5)*2,Re=(te.y+Re*te.height-.5)*2,D[ve*5+0]=Te,D[ve*5+1]=Re,D[ve*5+2]=He,D[ve*5+3]=Ge,D[ve*5+4]=we}var on=U[2]-U[0];U[0]=-(on+U[0]),U[2]=on-U[2],on=Q[2]-Q[0],Q[0]=-(on+Q[0]),Q[2]=on-Q[2],te.x=1-(te.x+te.width)}return D},W.prototype.computeMeshIndices_=function(f,w){for(var E=new Uint16Array(2*(f-1)*(w-1)*6),D=f/2,U=w/2,Q=0,te=0,ve=0;ve<2;ve++)for(var we=0;we<w;we++)for(var le=0;le<f;le++,Q++)le==0||we==0||(le<=D==we<=U?(E[te++]=Q,E[te++]=Q-f-1,E[te++]=Q-f,E[te++]=Q-f-1,E[te++]=Q,E[te++]=Q-1):(E[te++]=Q-1,E[te++]=Q-f,E[te++]=Q,E[te++]=Q-f,E[te++]=Q-1,E[te++]=Q-f-1));return E},W.prototype.getOwnPropertyDescriptor_=function(f,w){var E=Object.getOwnPropertyDescriptor(f,w);return(E.get===void 0||E.set===void 0)&&(E.configurable=!0,E.enumerable=!0,E.get=function(){return this.getAttribute(w)},E.set=function(D){this.setAttribute(w,D)}),E};var m=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),_=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),C=Math.PI/180,I=60,H=12,j=20,q=1,Z=.75,ae=.3125,ee=4,ue=28,_e=1.5;function he(f){this.gl=f,this.attribs={position:0},this.program=M(f,m,_,this.attribs),this.uniforms=O(f,this.program),this.vertexBuffer=f.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}he.prototype.destroy=function(){var f=this.gl;this.listener&&f.canvas.removeEventListener("click",this.listener,!1),f.deleteProgram(this.program),f.deleteBuffer(this.vertexBuffer)},he.prototype.listen=function(f,w){var E=this.gl.canvas;this.listener=function(D){var U=E.clientWidth/2,Q=ue*_e;D.clientX>U-Q&&D.clientX<U+Q&&D.clientY>E.clientHeight-Q?f(D):D.clientX<Q&&D.clientY<Q&&w(D)},E.addEventListener("click",this.listener,!1)},he.prototype.onResize=function(){var f=this.gl,w=this,E=[f.ARRAY_BUFFER_BINDING];k(f,E,function(D){var U=[],Q=D.drawingBufferWidth/2,te=Math.max(screen.width,screen.height)*window.devicePixelRatio,ve=D.drawingBufferWidth/te,we=ve*window.devicePixelRatio,le=ee*we/2,pe=ue*_e*we,Te=ue*we/2,Re=(ue*_e-ue)*we;U.push(Q-le,pe),U.push(Q-le,D.drawingBufferHeight),U.push(Q+le,pe),U.push(Q+le,D.drawingBufferHeight),w.gearOffset=U.length/2;function He(Gt,An){var Cn=(90-Gt)*C,on=Math.cos(Cn),ei=Math.sin(Cn);U.push(ae*on*Te+Q,ae*ei*Te+Te),U.push(An*on*Te+Q,An*ei*Te+Te)}for(var Ge=0;Ge<=6;Ge++){var ht=Ge*I;He(ht,q),He(ht+H,q),He(ht+j,Z),He(ht+(I-j),Z),He(ht+(I-H),q)}w.gearVertexCount=U.length/2-w.gearOffset,w.arrowOffset=U.length/2;function Ze(Gt,An){U.push(Re+Gt,D.drawingBufferHeight-Re-An)}var $e=le/Math.sin(45*C);Ze(0,Te),Ze(Te,0),Ze(Te+$e,$e),Ze($e,Te+$e),Ze($e,Te-$e),Ze(0,Te),Ze(Te,Te*2),Ze(Te+$e,Te*2-$e),Ze($e,Te-$e),Ze(0,Te),Ze($e,Te-le),Ze(ue*we,Te-le),Ze($e,Te+le),Ze(ue*we,Te+le),w.arrowVertexCount=U.length/2-w.arrowOffset,D.bindBuffer(D.ARRAY_BUFFER,w.vertexBuffer),D.bufferData(D.ARRAY_BUFFER,new Float32Array(U),D.STATIC_DRAW)})},he.prototype.render=function(){var f=this.gl,w=this,E=[f.CULL_FACE,f.DEPTH_TEST,f.BLEND,f.SCISSOR_TEST,f.STENCIL_TEST,f.COLOR_WRITEMASK,f.VIEWPORT,f.CURRENT_PROGRAM,f.ARRAY_BUFFER_BINDING];k(f,E,function(D){D.disable(D.CULL_FACE),D.disable(D.DEPTH_TEST),D.disable(D.BLEND),D.disable(D.SCISSOR_TEST),D.disable(D.STENCIL_TEST),D.colorMask(!0,!0,!0,!0),D.viewport(0,0,D.drawingBufferWidth,D.drawingBufferHeight),w.renderNoState()})},he.prototype.renderNoState=function(){var f=this.gl;f.useProgram(this.program),f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer),f.enableVertexAttribArray(this.attribs.position),f.vertexAttribPointer(this.attribs.position,2,f.FLOAT,!1,8,0),f.uniform4f(this.uniforms.color,1,1,1,1),B(this.projMat,0,f.drawingBufferWidth,0,f.drawingBufferHeight,.1,1024),f.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),f.drawArrays(f.TRIANGLE_STRIP,0,4),f.drawArrays(f.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),f.drawArrays(f.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function ke(f){this.coefficients=f}ke.prototype.distortInverse=function(f){for(var w=0,E=1,D=f-this.distort(w);Math.abs(E-w)>1e-4;){var U=f-this.distort(E),Q=E-U*((E-w)/(U-D));w=E,E=Q,D=U}return E},ke.prototype.distort=function(f){for(var w=f*f,E=0,D=0;D<this.coefficients.length;D++)E=w*(E+this.coefficients[D]);return(E+1)*f};var Me=Math.PI/180,Ce=180/Math.PI,Le=function(w,E,D){this.x=w||0,this.y=E||0,this.z=D||0};Le.prototype={constructor:Le,set:function(w,E,D){return this.x=w,this.y=E,this.z=D,this},copy:function(w){return this.x=w.x,this.y=w.y,this.z=w.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var w=this.length();if(w!==0){var E=1/w;this.multiplyScalar(E)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(w){this.x*=w,this.y*=w,this.z*=w},applyQuaternion:function(w){var E=this.x,D=this.y,U=this.z,Q=w.x,te=w.y,ve=w.z,we=w.w,le=we*E+te*U-ve*D,pe=we*D+ve*E-Q*U,Te=we*U+Q*D-te*E,Re=-Q*E-te*D-ve*U;return this.x=le*we+Re*-Q+pe*-ve-Te*-te,this.y=pe*we+Re*-te+Te*-Q-le*-ve,this.z=Te*we+Re*-ve+le*-te-pe*-Q,this},dot:function(w){return this.x*w.x+this.y*w.y+this.z*w.z},crossVectors:function(w,E){var D=w.x,U=w.y,Q=w.z,te=E.x,ve=E.y,we=E.z;return this.x=U*we-Q*ve,this.y=Q*te-D*we,this.z=D*ve-U*te,this}};var Fe=function(w,E,D,U){this.x=w||0,this.y=E||0,this.z=D||0,this.w=U!==void 0?U:1};Fe.prototype={constructor:Fe,set:function(w,E,D,U){return this.x=w,this.y=E,this.z=D,this.w=U,this},copy:function(w){return this.x=w.x,this.y=w.y,this.z=w.z,this.w=w.w,this},setFromEulerXYZ:function(w,E,D){var U=Math.cos(w/2),Q=Math.cos(E/2),te=Math.cos(D/2),ve=Math.sin(w/2),we=Math.sin(E/2),le=Math.sin(D/2);return this.x=ve*Q*te+U*we*le,this.y=U*we*te-ve*Q*le,this.z=U*Q*le+ve*we*te,this.w=U*Q*te-ve*we*le,this},setFromEulerYXZ:function(w,E,D){var U=Math.cos(w/2),Q=Math.cos(E/2),te=Math.cos(D/2),ve=Math.sin(w/2),we=Math.sin(E/2),le=Math.sin(D/2);return this.x=ve*Q*te+U*we*le,this.y=U*we*te-ve*Q*le,this.z=U*Q*le-ve*we*te,this.w=U*Q*te+ve*we*le,this},setFromAxisAngle:function(w,E){var D=E/2,U=Math.sin(D);return this.x=w.x*U,this.y=w.y*U,this.z=w.z*U,this.w=Math.cos(D),this},multiply:function(w){return this.multiplyQuaternions(this,w)},multiplyQuaternions:function(w,E){var D=w.x,U=w.y,Q=w.z,te=w.w,ve=E.x,we=E.y,le=E.z,pe=E.w;return this.x=D*pe+te*ve+U*le-Q*we,this.y=U*pe+te*we+Q*ve-D*le,this.z=Q*pe+te*le+D*we-U*ve,this.w=te*pe-D*ve-U*we-Q*le,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var w=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return w===0?(this.x=0,this.y=0,this.z=0,this.w=1):(w=1/w,this.x=this.x*w,this.y=this.y*w,this.z=this.z*w,this.w=this.w*w),this},slerp:function(w,E){if(E===0)return this;if(E===1)return this.copy(w);var D=this.x,U=this.y,Q=this.z,te=this.w,ve=te*w.w+D*w.x+U*w.y+Q*w.z;if(ve<0?(this.w=-w.w,this.x=-w.x,this.y=-w.y,this.z=-w.z,ve=-ve):this.copy(w),ve>=1)return this.w=te,this.x=D,this.y=U,this.z=Q,this;var we=Math.acos(ve),le=Math.sqrt(1-ve*ve);if(Math.abs(le)<.001)return this.w=.5*(te+this.w),this.x=.5*(D+this.x),this.y=.5*(U+this.y),this.z=.5*(Q+this.z),this;var pe=Math.sin((1-E)*we)/le,Te=Math.sin(E*we)/le;return this.w=te*pe+this.w*Te,this.x=D*pe+this.x*Te,this.y=U*pe+this.y*Te,this.z=Q*pe+this.z*Te,this},setFromUnitVectors:function(){var f,w,E=1e-6;return function(D,U){return f===void 0&&(f=new Le),w=D.dot(U)+1,w<E?(w=0,Math.abs(D.x)>Math.abs(D.z)?f.set(-D.y,D.x,0):f.set(0,-D.z,D.y)):f.crossVectors(D,U),this.x=f.x,this.y=f.y,this.z=f.z,this.w=w,this.normalize(),this}}()};function jt(f){this.width=f.width||P(),this.height=f.height||L(),this.widthMeters=f.widthMeters,this.heightMeters=f.heightMeters,this.bevelMeters=f.bevelMeters}var xn=new jt({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),ze=new jt({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),Vt={CardboardV1:new Zn({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new Zn({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function ot(f,w){this.viewer=Vt.CardboardV2,this.updateDeviceParams(f),this.distortion=new ke(this.viewer.distortionCoefficients);for(var E=0;E<w.length;E++){var D=w[E];Vt[D.id]=new Zn(D)}}ot.prototype.updateDeviceParams=function(f){this.device=this.determineDevice_(f)||this.device},ot.prototype.getDevice=function(){return this.device},ot.prototype.setViewer=function(f){this.viewer=f,this.distortion=new ke(this.viewer.distortionCoefficients)},ot.prototype.determineDevice_=function(f){if(!f)return c()?(console.warn("Using fallback iOS device measurements."),ze):(console.warn("Using fallback Android device measurements."),xn);var w=.0254,E=w/f.xdpi,D=w/f.ydpi,U=P(),Q=L();return new jt({widthMeters:E*U,heightMeters:D*Q,bevelMeters:f.bevelMm*.001})},ot.prototype.getDistortedFieldOfViewLeftEye=function(){var f=this.viewer,w=this.device,E=this.distortion,D=f.screenLensDistance,U=(w.widthMeters-f.interLensDistance)/2,Q=f.interLensDistance/2,te=f.baselineLensDistance-w.bevelMeters,ve=w.heightMeters-te,we=Ce*Math.atan(E.distort(U/D)),le=Ce*Math.atan(E.distort(Q/D)),pe=Ce*Math.atan(E.distort(te/D)),Te=Ce*Math.atan(E.distort(ve/D));return{leftDegrees:Math.min(we,f.fov),rightDegrees:Math.min(le,f.fov),downDegrees:Math.min(pe,f.fov),upDegrees:Math.min(Te,f.fov)}},ot.prototype.getLeftEyeVisibleTanAngles=function(){var f=this.viewer,w=this.device,E=this.distortion,D=Math.tan(-Me*f.fov),U=Math.tan(Me*f.fov),Q=Math.tan(Me*f.fov),te=Math.tan(-Me*f.fov),ve=w.widthMeters/4,we=w.heightMeters/2,le=f.baselineLensDistance-w.bevelMeters-we,pe=f.interLensDistance/2-ve,Te=-le,Re=f.screenLensDistance,He=E.distort((pe-ve)/Re),Ge=E.distort((Te+we)/Re),ht=E.distort((pe+ve)/Re),Ze=E.distort((Te-we)/Re),$e=new Float32Array(4);return $e[0]=Math.max(D,He),$e[1]=Math.min(U,Ge),$e[2]=Math.min(Q,ht),$e[3]=Math.max(te,Ze),$e},ot.prototype.getLeftEyeNoLensTanAngles=function(){var f=this.viewer,w=this.device,E=this.distortion,D=new Float32Array(4),U=E.distortInverse(Math.tan(-Me*f.fov)),Q=E.distortInverse(Math.tan(Me*f.fov)),te=E.distortInverse(Math.tan(Me*f.fov)),ve=E.distortInverse(Math.tan(-Me*f.fov)),we=w.widthMeters/4,le=w.heightMeters/2,pe=f.baselineLensDistance-w.bevelMeters-le,Te=f.interLensDistance/2-we,Re=-pe,He=f.screenLensDistance,Ge=(Te-we)/He,ht=(Re+le)/He,Ze=(Te+we)/He,$e=(Re-le)/He;return D[0]=Math.max(U,Ge),D[1]=Math.min(Q,ht),D[2]=Math.min(te,Ze),D[3]=Math.max(ve,$e),D},ot.prototype.getLeftEyeVisibleScreenRect=function(f){var w=this.viewer,E=this.device,D=w.screenLensDistance,U=(E.widthMeters-w.interLensDistance)/2,Q=w.baselineLensDistance-E.bevelMeters,te=(f[0]*D+U)/E.widthMeters,ve=(f[1]*D+Q)/E.heightMeters,we=(f[2]*D+U)/E.widthMeters,le=(f[3]*D+Q)/E.heightMeters;return{x:te,y:le,width:we-te,height:ve-le}},ot.prototype.getFieldOfViewLeftEye=function(f){return f?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},ot.prototype.getFieldOfViewRightEye=function(f){var w=this.getFieldOfViewLeftEye(f);return{leftDegrees:w.rightDegrees,rightDegrees:w.leftDegrees,upDegrees:w.upDegrees,downDegrees:w.downDegrees}},ot.prototype.getUndistortedFieldOfViewLeftEye=function(){var f=this.getUndistortedParams_();return{leftDegrees:Ce*Math.atan(f.outerDist),rightDegrees:Ce*Math.atan(f.innerDist),downDegrees:Ce*Math.atan(f.bottomDist),upDegrees:Ce*Math.atan(f.topDist)}},ot.prototype.getUndistortedViewportLeftEye=function(){var f=this.getUndistortedParams_(),w=this.viewer,E=this.device,D=w.screenLensDistance,U=E.widthMeters/D,Q=E.heightMeters/D,te=E.width/U,ve=E.height/Q,we=Math.round((f.eyePosX-f.outerDist)*te),le=Math.round((f.eyePosY-f.bottomDist)*ve);return{x:we,y:le,width:Math.round((f.eyePosX+f.innerDist)*te)-we,height:Math.round((f.eyePosY+f.topDist)*ve)-le}},ot.prototype.getUndistortedParams_=function(){var f=this.viewer,w=this.device,E=this.distortion,D=f.screenLensDistance,U=f.interLensDistance/2/D,Q=w.widthMeters/D,te=w.heightMeters/D,ve=Q/2-U,we=(f.baselineLensDistance-w.bevelMeters)/D,le=f.fov,pe=E.distortInverse(Math.tan(Me*le)),Te=Math.min(ve,pe),Re=Math.min(U,pe),He=Math.min(we,pe),Ge=Math.min(te-we,pe);return{outerDist:Te,innerDist:Re,topDist:Ge,bottomDist:He,eyePosX:ve,eyePosY:we}};function Zn(f){this.id=f.id,this.label=f.label,this.fov=f.fov,this.interLensDistance=f.interLensDistance,this.baselineLensDistance=f.baselineLensDistance,this.screenLensDistance=f.screenLensDistance,this.distortionCoefficients=f.distortionCoefficients,this.inverseCoefficients=f.inverseCoefficients}ot.Viewers=Vt;var Nn=1,Yr="2019-11-09T17:36:14Z",wn=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],rn={format:Nn,last_updated:Yr,devices:wn};function vr(f,w){if(this.dpdb=rn,this.recalculateDeviceParams_(),f){this.onDeviceParamsUpdated=w;var E=new XMLHttpRequest,D=this;E.open("GET",f,!0),E.addEventListener("load",function(){D.loading=!1,E.status>=200&&E.status<=299?(D.dpdb=JSON.parse(E.response),D.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),E.send()}}vr.prototype.getDeviceParams=function(){return this.deviceParams},vr.prototype.recalculateDeviceParams_=function(){var f=this.calcDeviceParams_();f?(this.deviceParams=f,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},vr.prototype.calcDeviceParams_=function(){var f=this.dpdb;if(!f)return console.error("DPDB not available."),null;if(f.format!=1)return console.error("DPDB has unexpected format version."),null;if(!f.devices||!f.devices.length)return console.error("DPDB does not have a devices section."),null;var w=navigator.userAgent||navigator.vendor||window.opera,E=P(),D=L();if(!f.devices)return console.error("DPDB has no devices section."),null;for(var U=0;U<f.devices.length;U++){var Q=f.devices[U];if(!Q.rules){console.warn("Device["+U+"] has no rules section.");continue}if(Q.type!="ios"&&Q.type!="android"){console.warn("Device["+U+"] has invalid type.");continue}if(c()==(Q.type=="ios")){for(var te=!1,ve=0;ve<Q.rules.length;ve++){var we=Q.rules[ve];if(this.ruleMatches_(we,w,E,D)){te=!0;break}}if(te){var le=Q.dpi[0]||Q.dpi,pe=Q.dpi[1]||Q.dpi;return new Fg({xdpi:le,ydpi:pe,bevelMm:Q.bw})}}}return console.warn("No DPDB device match."),null},vr.prototype.ruleMatches_=function(f,w,E,D){if(!f.ua&&!f.res||(f.ua&&f.ua.substring(0,2)==="SM"&&(f.ua=f.ua.substring(0,7)),f.ua&&w.indexOf(f.ua)<0))return!1;if(f.res){if(!f.res[0]||!f.res[1])return!1;var U=f.res[0],Q=f.res[1];if(Math.min(E,D)!=Math.min(U,Q)||Math.max(E,D)!=Math.max(U,Q))return!1}return!0};function Fg(f){this.xdpi=f.xdpi,this.ydpi=f.ydpi,this.bevelMm=f.bevelMm}function xs(f,w){this.set(f,w)}xs.prototype.set=function(f,w){this.sample=f,this.timestampS=w},xs.prototype.copy=function(f){this.set(f.sample,f.timestampS)};function Kr(f,w){this.kFilter=f,this.isDebug=w,this.currentAccelMeasurement=new xs,this.currentGyroMeasurement=new xs,this.previousGyroMeasurement=new xs,c()?this.filterQ=new Fe(-1,0,0,1):this.filterQ=new Fe(1,0,0,1),this.previousFilterQ=new Fe,this.previousFilterQ.copy(this.filterQ),this.accelQ=new Fe,this.isOrientationInitialized=!1,this.estimatedGravity=new Le,this.measuredGravity=new Le,this.gyroIntegralQ=new Fe}Kr.prototype.addAccelMeasurement=function(f,w){this.currentAccelMeasurement.set(f,w)},Kr.prototype.addGyroMeasurement=function(f,w){this.currentGyroMeasurement.set(f,w);var E=w-this.previousGyroMeasurement.timestampS;R(E)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},Kr.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var f=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,w=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,f);this.gyroIntegralQ.multiply(w),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(w);var E=new Fe;E.copy(this.filterQ),E.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(E),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var D=new Fe;D.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),D.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",Ce*K(D),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var U=new Fe;U.copy(this.filterQ),U.multiply(D),this.filterQ.slerp(U,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},Kr.prototype.getOrientation=function(){return this.filterQ},Kr.prototype.accelToQuaternion_=function(f){var w=new Le;w.copy(f),w.normalize();var E=new Fe;return E.setFromUnitVectors(new Le(0,0,-1),w),E.inverse(),E},Kr.prototype.gyroToQuaternionDelta_=function(f,w){var E=new Fe,D=new Le;return D.copy(f),D.normalize(),E.setFromAxisAngle(D,f.length()*w),E};function up(f,w){this.predictionTimeS=f,this.isDebug=w,this.previousQ=new Fe,this.previousTimestampS=null,this.deltaQ=new Fe,this.outQ=new Fe}up.prototype.getPrediction=function(f,w,E){if(!this.previousTimestampS)return this.previousQ.copy(f),this.previousTimestampS=E,f;var D=new Le;D.copy(w),D.normalize();var U=w.length();if(U<Me*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(Ce*U).toFixed(1)),this.outQ.copy(f),this.previousQ.copy(f),this.outQ;var Q=U*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(D,Q),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(f),this.previousTimestampS=E,this.outQ};function Fi(f,w,E,D){this.yawOnly=E,this.accelerometer=new Le,this.gyroscope=new Le,this.filter=new Kr(f,D),this.posePredictor=new up(w,D),this.isFirefoxAndroid=d(),this.isIOS=c();var U=h();this.isDeviceMotionInRadians=!this.isIOS&&U&&U<66,this.isWithoutDeviceMotion=g()||A(),this.filterToWorldQ=new Fe,c()?this.filterToWorldQ.setFromAxisAngle(new Le(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new Le(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new Fe,this.worldToScreenQ=new Fe,this.originalPoseAdjustQ=new Fe,this.originalPoseAdjustQ.setFromAxisAngle(new Le(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),b()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new Fe,this.orientationOut_=new Float32Array(4),this.start()}Fi.prototype.getPosition=function(){return null},Fi.prototype.getOrientation=function(){var f=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var U=new Fe().setFromAxisAngle(new Le(0,0,-1),0),Q=new Fe;return window.orientation===-90?Q.setFromAxisAngle(new Le(0,1,0),Math.PI/-2):Q.setFromAxisAngle(new Le(0,1,0),Math.PI/2),U.multiply(Q)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var U=new Fe;return U.setFromAxisAngle(new Le(1,0,0),-Math.PI/2),U}(),f=this._deviceOrientationQ;var E=new Fe;return E.copy(f),E.multiply(this.deviceOrientationFilterToWorldQ),E.multiply(this.resetQ),E.multiply(this.worldToScreenQ),E.multiplyQuaternions(this.deviceOrientationFixQ,E),this.yawOnly&&(E.x=0,E.z=0,E.normalize()),this.orientationOut_[0]=E.x,this.orientationOut_[1]=E.y,this.orientationOut_[2]=E.z,this.orientationOut_[3]=E.w,this.orientationOut_}else{var w=this.filter.getOrientation();f=this.posePredictor.getPrediction(w,this.gyroscope,this.previousTimestampS)}var E=new Fe;return E.copy(this.filterToWorldQ),E.multiply(this.resetQ),E.multiply(f),E.multiply(this.worldToScreenQ),this.yawOnly&&(E.x=0,E.z=0,E.normalize()),this.orientationOut_[0]=E.x,this.orientationOut_[1]=E.y,this.orientationOut_[2]=E.z,this.orientationOut_[3]=E.w,this.orientationOut_},Fi.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),b()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},Fi.prototype.onDeviceOrientation_=function(f){this._deviceOrientationQ=this._deviceOrientationQ||new Fe;var w=f.alpha,E=f.beta,D=f.gamma;w=(w||0)*Math.PI/180,E=(E||0)*Math.PI/180,D=(D||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(E,w,-D)},Fi.prototype.onDeviceMotion_=function(f){this.updateDeviceMotion_(f)},Fi.prototype.updateDeviceMotion_=function(f){var w=f.accelerationIncludingGravity,E=f.rotationRate,D=f.timeStamp/1e3,U=D-this.previousTimestampS;if(U<0){se("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=D;return}else if(U<=r||U>o){se("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=D;return}this.accelerometer.set(-w.x,-w.y,-w.z),E&&(F()?this.gyroscope.set(-E.beta,E.alpha,E.gamma):this.gyroscope.set(E.alpha,E.beta,E.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,D)),this.filter.addAccelMeasurement(this.accelerometer,D),this.previousTimestampS=D},Fi.prototype.onOrientationChange_=function(f){this.setScreenTransform_()},Fi.prototype.onMessage_=function(f){var w=f.data;if(!(!w||!w.type)){var E=w.type.toLowerCase();E==="devicemotion"&&this.updateDeviceMotion_(w.deviceMotionEvent)}},Fi.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new Le(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new Le(0,0,1),Math.PI/2);break;case 180:break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},Fi.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),c()&&G()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},Fi.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var me=60,ie=new Le(1,0,0),re=new Le(0,0,1),Pe=new Fe;Pe.setFromAxisAngle(ie,-Math.PI/2),Pe.multiply(new Fe().setFromAxisAngle(re,Math.PI/2));var Xe=function(){function f(w){e(this,f),this.config=w,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new Fe,this._outQ=new Fe,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return t(f,[{key:"init",value:function(){var E=null;try{E=new RelativeOrientationSensor({frequency:me,referenceFrame:"screen"}),E.addEventListener("error",this._onSensorError)}catch(D){this.errors.push(D),D.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):D.name==="ReferenceError"?this.useDeviceMotion():console.error(D)}E&&(this.api="sensor",this.sensor=E,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new Fi(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var E=this.sensor.quaternion;this._sensorQ.set(E[0],E[1],E[2],E[3]);var D=this._outQ;return D.copy(Pe),D.multiply(this._sensorQ),this.config.YAW_ONLY&&(D.x=D.z=0,D.normalize()),this._out[0]=D.x,this._out[1]=D.y,this._out[2]=D.z,this._out[3]=D.w,this._out}},{key:"_onSensorError",value:function(E){this.errors.push(E.error),E.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):E.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(E.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),f}(),Ot="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function xt(){this.loadIcon_();var f=document.createElement("div"),te=f.style;te.position="fixed",te.top=0,te.right=0,te.bottom=0,te.left=0,te.backgroundColor="gray",te.fontFamily="sans-serif",te.zIndex=1e6;var w=document.createElement("img");w.src=this.icon;var te=w.style;te.marginLeft="25%",te.marginTop="25%",te.width="50%",f.appendChild(w);var E=document.createElement("div"),te=E.style;te.textAlign="center",te.fontSize="16px",te.lineHeight="24px",te.margin="24px 25%",te.width="50%",E.innerHTML="Place your phone into your Cardboard viewer.",f.appendChild(E);var D=document.createElement("div"),te=D.style;te.backgroundColor="#CFD8DC",te.position="fixed",te.bottom=0,te.width="100%",te.height="48px",te.padding="14px 24px",te.boxSizing="border-box",te.color="#656A6B",f.appendChild(D);var U=document.createElement("div");U.style.float="left",U.innerHTML="No Cardboard viewer?";var Q=document.createElement("a");Q.href="https://www.google.com/get/cardboard/get-cardboard/",Q.innerHTML="get one",Q.target="_blank";var te=Q.style;te.float="right",te.fontWeight=600,te.textTransform="uppercase",te.borderLeft="1px solid gray",te.paddingLeft="24px",te.textDecoration="none",te.color="#656A6B",D.appendChild(U),D.appendChild(Q),this.overlay=f,this.text=E,this.hide()}xt.prototype.show=function(f){!f&&!this.overlay.parentElement?document.body.appendChild(this.overlay):f&&(this.overlay.parentElement&&this.overlay.parentElement!=f&&this.overlay.parentElement.removeChild(this.overlay),f.appendChild(this.overlay)),this.overlay.style.display="block";var w=this.overlay.querySelector("img"),E=w.style;b()?(E.width="20%",E.marginLeft="40%",E.marginTop="3%"):(E.width="50%",E.marginLeft="25%",E.marginTop="25%")},xt.prototype.hide=function(){this.overlay.style.display="none"},xt.prototype.showTemporarily=function(f,w){this.show(w),this.timer=setTimeout(this.hide.bind(this),f)},xt.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},xt.prototype.update=function(){this.disableShowTemporarily(),!b()&&X()?this.show():this.hide()},xt.prototype.loadIcon_=function(){this.icon=s("image/svg+xml",Ot)};var br="CardboardV1",Qr="WEBVR_CARDBOARD_VIEWER",$r="webvr-polyfill-viewer-selector";function Nt(f){try{this.selectedKey=localStorage.getItem(Qr)}catch(w){console.error("Failed to load viewer profile: %s",w)}this.selectedKey||(this.selectedKey=f||br),this.dialog=this.createDialog_(ot.Viewers),this.root=null,this.onChangeCallbacks_=[]}Nt.prototype.show=function(f){this.root=f,f.appendChild(this.dialog);var w=this.dialog.querySelector("#"+this.selectedKey);w.checked=!0,this.dialog.style.display="block"},Nt.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},Nt.prototype.getCurrentViewer=function(){return ot.Viewers[this.selectedKey]},Nt.prototype.getSelectedKey_=function(){var f=this.dialog.querySelector("input[name=field]:checked");return f?f.id:null},Nt.prototype.onChange=function(f){this.onChangeCallbacks_.push(f)},Nt.prototype.fireOnChange_=function(f){for(var w=0;w<this.onChangeCallbacks_.length;w++)this.onChangeCallbacks_[w](f)},Nt.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!ot.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(ot.Viewers[this.selectedKey]);try{localStorage.setItem(Qr,this.selectedKey)}catch(f){console.error("Failed to save viewer profile: %s",f)}this.hide()},Nt.prototype.createDialog_=function(f){var w=document.createElement("div");w.classList.add($r),w.style.display="none";var E=document.createElement("div"),Q=E.style;Q.position="fixed",Q.left=0,Q.top=0,Q.width="100%",Q.height="100%",Q.background="rgba(0, 0, 0, 0.3)",E.addEventListener("click",this.hide.bind(this));var D=280,U=document.createElement("div"),Q=U.style;Q.boxSizing="border-box",Q.position="fixed",Q.top="24px",Q.left="50%",Q.marginLeft=-D/2+"px",Q.width=D+"px",Q.padding="24px",Q.overflow="hidden",Q.background="#fafafa",Q.fontFamily="'Roboto', sans-serif",Q.boxShadow="0px 5px 20px #666",U.appendChild(this.createH1_("Select your viewer"));for(var te in f)U.appendChild(this.createChoice_(te,f[te].label));return U.appendChild(this.createButton_("Save",this.onSave_.bind(this))),w.appendChild(E),w.appendChild(U),w},Nt.prototype.createH1_=function(f){var w=document.createElement("h1"),E=w.style;return E.color="black",E.fontSize="20px",E.fontWeight="bold",E.marginTop=0,E.marginBottom="24px",w.innerHTML=f,w},Nt.prototype.createChoice_=function(f,w){var E=document.createElement("div");E.style.marginTop="8px",E.style.color="black";var D=document.createElement("input");D.style.fontSize="30px",D.setAttribute("id",f),D.setAttribute("type","radio"),D.setAttribute("value",f),D.setAttribute("name","field");var U=document.createElement("label");return U.style.marginLeft="4px",U.setAttribute("for",f),U.innerHTML=w,E.appendChild(D),E.appendChild(U),E},Nt.prototype.createButton_=function(f,w){var E=document.createElement("button");E.innerHTML=f;var D=E.style;return D.float="right",D.textTransform="uppercase",D.color="#1094f7",D.fontSize="14px",D.letterSpacing=0,D.border=0,D.background="none",D.marginTop="16px",E.addEventListener("click",w),E};var vo=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Sr(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}function fa(f,w){return w={exports:{}},f(w,w.exports),w.exports}var Fn=fa(function(f,w){(function(D,U){f.exports=U()})(vo,function(){return function(E){var D={};function U(Q){if(D[Q])return D[Q].exports;var te=D[Q]={i:Q,l:!1,exports:{}};return E[Q].call(te.exports,te,te.exports,U),te.l=!0,te.exports}return U.m=E,U.c=D,U.d=function(Q,te,ve){U.o(Q,te)||Object.defineProperty(Q,te,{configurable:!1,enumerable:!0,get:ve})},U.n=function(Q){var te=Q&&Q.__esModule?function(){return Q.default}:function(){return Q};return U.d(te,"a",te),te},U.o=function(Q,te){return Object.prototype.hasOwnProperty.call(Q,te)},U.p="",U(U.s=0)}([function(E,D,U){"use strict";var Q=function(){function pe(Te,Re){for(var He=0;He<Re.length;He++){var Ge=Re[He];Ge.enumerable=Ge.enumerable||!1,Ge.configurable=!0,"value"in Ge&&(Ge.writable=!0),Object.defineProperty(Te,Ge.key,Ge)}}return function(Te,Re,He){return Re&&pe(Te.prototype,Re),He&&pe(Te,He),Te}}();function te(pe,Te){if(!(pe instanceof Te))throw new TypeError("Cannot call a class as a function")}var ve=U(1),we=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,le=function(){function pe(){te(this,pe),we?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",ve),this.noSleepVideo.addEventListener("timeupdate",function(Te){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return Q(pe,[{key:"enable",value:function(){we?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){we?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),pe}();E.exports=le},function(E,D,U){"use strict";E.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),ga=Sr(Fn),xa=1e3,hc=[0,0,.5,1],mc=[.5,0,.5,1],ws=window.requestAnimationFrame,li=window.cancelAnimationFrame;function Fs(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function wa(f){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:f.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:f.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:f.canPresent},maxLayers:{writable:!1,enumerable:!0,value:f.maxLayers},hasOrientation:{enumerable:!0,get:function(){return $("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),f.hasOrientation}}})}function Yt(f){f=f||{};var w="wakelock"in f?f.wakelock:!0;this.isPolyfilled=!0,this.displayId=xa++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return $("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new wa({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,w&&X()&&(this.wakelock_=new ga)}Yt.prototype.getFrameData=function(f){return ce(f,this._getPose(),this)},Yt.prototype.getPose=function(){return $("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},Yt.prototype.resetPose=function(){return $("VRDisplay.prototype.resetPose"),this._resetPose()},Yt.prototype.getImmediatePose=function(){return $("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},Yt.prototype.requestAnimationFrame=function(f){return ws(f)},Yt.prototype.cancelAnimationFrame=function(f){return li(f)},Yt.prototype.wrapForFullscreen=function(f){if(c())return f;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var w=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",w.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==f)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=f,this.originalParent_=f.parentElement,this.originalParent_||document.body.appendChild(f),!this.fullscreenWrapper_.parentElement){var E=this.fullscreenElement_.parentElement;E.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),E.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var D=this;function U(){if(D.fullscreenElement_){var Q=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];D.fullscreenElement_.setAttribute("style",Q.join("; ")+";")}}return U(),this.fullscreenWrapper_},Yt.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var f=this.fullscreenElement_;this.fullscreenElementCachedStyle_?f.setAttribute("style",this.fullscreenElementCachedStyle_):f.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var w=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(f),this.originalParent_===w?w.insertBefore(f,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(f),w.removeChild(this.fullscreenWrapper_),f}},Yt.prototype.requestPresent=function(f){var w=this.isPresenting,E=this;return f instanceof Array||($("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),f=[f]),new Promise(function(D,U){if(!E.capabilities.canPresent){U(new Error("VRDisplay is not capable of presenting."));return}if(f.length==0||f.length>E.capabilities.maxLayers){U(new Error("Invalid number of layers."));return}var Q=f[0];if(!Q.source){D();return}var te=Q.leftBounds||hc,ve=Q.rightBounds||mc;if(w){var we=E.layer_;we.source!==Q.source&&(we.source=Q.source);for(var le=0;le<4;le++)we.leftBounds[le]=te[le],we.rightBounds[le]=ve[le];E.wrapForFullscreen(E.layer_.source),E.updatePresent_(),D();return}if(E.layer_={predistorted:Q.predistorted,source:Q.source,leftBounds:te.slice(0),rightBounds:ve.slice(0)},E.waitingForPresent_=!1,E.layer_&&E.layer_.source){var pe=E.wrapForFullscreen(E.layer_.source),Te=function(){var Ge=v();E.isPresenting=pe===Ge,E.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(ht){console.error("screen.orientation.lock() failed due to",ht.message)}),E.waitingForPresent_=!1,E.beginPresent_(),D()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),E.removeFullscreenWrapper(),E.disableWakeLock(),E.endPresent_(),E.removeFullscreenListeners_()),E.fireVRDisplayPresentChange_()},Re=function(){E.waitingForPresent_&&(E.removeFullscreenWrapper(),E.removeFullscreenListeners_(),E.disableWakeLock(),E.waitingForPresent_=!1,E.isPresenting=!1,U(new Error("Unable to present.")))};E.addFullscreenListeners_(pe,Te,Re),S(pe)?(E.enableWakeLock(),E.waitingForPresent_=!0):(c()||u())&&(E.enableWakeLock(),E.isPresenting=!0,E.beginPresent_(),E.fireVRDisplayPresentChange_(),D())}!E.waitingForPresent_&&!c()&&(x(),U(new Error("Unable to present.")))})},Yt.prototype.exitPresent=function(){var f=this.isPresenting,w=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(E,D){f?(!x()&&c()&&(w.endPresent_(),w.fireVRDisplayPresentChange_()),u()&&(w.removeFullscreenWrapper(),w.removeFullscreenListeners_(),w.endPresent_(),w.fireVRDisplayPresentChange_()),E()):D(new Error("Was not presenting to VRDisplay."))})},Yt.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},Yt.prototype.fireVRDisplayPresentChange_=function(){var f=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(f)},Yt.prototype.fireVRDisplayConnect_=function(){var f=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(f)},Yt.prototype.addFullscreenListeners_=function(f,w,E){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=f,this.fullscreenChangeHandler_=w,this.fullscreenErrorHandler_=E,w&&(document.fullscreenEnabled?f.addEventListener("fullscreenchange",w,!1):document.webkitFullscreenEnabled?f.addEventListener("webkitfullscreenchange",w,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",w,!1):document.msFullscreenEnabled&&f.addEventListener("msfullscreenchange",w,!1)),E&&(document.fullscreenEnabled?f.addEventListener("fullscreenerror",E,!1):document.webkitFullscreenEnabled?f.addEventListener("webkitfullscreenerror",E,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",E,!1):document.msFullscreenEnabled&&f.addEventListener("msfullscreenerror",E,!1))},Yt.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var f=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var w=this.fullscreenChangeHandler_;f.removeEventListener("fullscreenchange",w,!1),f.removeEventListener("webkitfullscreenchange",w,!1),document.removeEventListener("mozfullscreenchange",w,!1),f.removeEventListener("msfullscreenchange",w,!1)}if(this.fullscreenErrorHandler_){var E=this.fullscreenErrorHandler_;f.removeEventListener("fullscreenerror",E,!1),f.removeEventListener("webkitfullscreenerror",E,!1),document.removeEventListener("mozfullscreenerror",E,!1),f.removeEventListener("msfullscreenerror",E,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},Yt.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},Yt.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},Yt.prototype.beginPresent_=function(){},Yt.prototype.endPresent_=function(){},Yt.prototype.submitFrame=function(f){},Yt.prototype.getEyeParameters=function(f){return null};var jT={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},pp={LEFT:"left",RIGHT:"right"};function yn(f){var w=V({},jT);f=V(w,f||{}),Yt.call(this,{wakelock:f.MOBILE_WAKE_LOCK}),this.config=f,this.displayName="Cardboard VRDisplay",this.capabilities=new wa({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new Xe(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new vr(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new ot(this.dpdb_.getDeviceParams(),f.ADDITIONAL_VIEWERS),this.viewerSelector_=new Nt(f.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new xt),c()&&window.addEventListener("resize",this.onResize_.bind(this))}return yn.prototype=Object.create(Yt.prototype),yn.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},yn.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},yn.prototype._getFieldOfView=function(f){var w;if(f==pp.LEFT)w=this.deviceInfo_.getFieldOfViewLeftEye();else if(f==pp.RIGHT)w=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",f),null;return w},yn.prototype._getEyeOffset=function(f){var w;if(f==pp.LEFT)w=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(f==pp.RIGHT)w=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",f),null;return w},yn.prototype.getEyeParameters=function(f){var w=this._getEyeOffset(f),E=this._getFieldOfView(f),D={offset:w,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(D,"fieldOfView",{enumerable:!0,get:function(){return $("VRFieldOfView","VRFrameData's projection matrices"),E}}),D},yn.prototype.onDeviceParamsUpdated_=function(f){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(f),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},yn.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},yn.prototype.beginPresent_=function(){var f=this.layer_.source.getContext("webgl");f||(f=this.layer_.source.getContext("experimental-webgl")),f||(f=this.layer_.source.getContext("webgl2")),f&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(f.canvas.width=P()*this.bufferScale_,f.canvas.height=L()*this.bufferScale_,this.cardboardUI_=new he(f)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new he(f)),this.distorter_=new W(f,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(w){this.viewerSelector_.show(this.layer_.source.parentElement),w.stopPropagation(),w.preventDefault()}.bind(this),function(w){this.exitPresent(),w.stopPropagation(),w.preventDefault()}.bind(this)),this.rotateInstructions_&&(b()&&X()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},yn.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},yn.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},yn.prototype.submitFrame=function(f){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var w=this.layer_.source.getContext("webgl");w||(w=this.layer_.source.getContext("experimental-webgl")),w||(w=this.layer_.source.getContext("webgl2"));var E=w.canvas;(E.width!=this.lastWidth||E.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=E.width,this.lastHeight=E.height,this.cardboardUI_.render()}},yn.prototype.onOrientationChange_=function(f){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},yn.prototype.onResize_=function(f){if(this.layer_){var w=this.layer_.source.getContext("webgl");w||(w=this.layer_.source.getContext("experimental-webgl")),w||(w=this.layer_.source.getContext("webgl2"));var E=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];w.canvas.setAttribute("style",E.join("; ")+";"),J(w.canvas)}},yn.prototype.onViewerChanged_=function(f){this.deviceInfo_.setViewer(f),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},yn.prototype.fireVRDisplayDeviceParamsChange_=function(){var f=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(f)},yn.VRFrameData=Fs,yn.VRDisplay=Yt,yn})});var Y1=So(()=>{});var Uy=So(()=>{});var zy=So(()=>{});var jy=So(()=>{});var Gy=So(()=>{});var Xy=So(()=>{});var qy=So((exports,module)=>{(function(e,t){typeof exports=="object"&&typeof module=="object"?module.exports=t():typeof define=="function"&&define.amd?define("pdfjs-dist/build/pdf",[],t):typeof exports=="object"?exports["pdfjs-dist/build/pdf"]=t():e["pdfjs-dist/build/pdf"]=e.pdfjsLib=t()})(globalThis,()=>(()=>{"use strict";var __webpack_modules__=[,(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VerbosityLevel=e.Util=e.UnknownErrorException=e.UnexpectedResponseException=e.UNSUPPORTED_FEATURES=e.TextRenderingMode=e.StreamType=e.RenderingIntentFlag=e.PermissionFlag=e.PasswordResponses=e.PasswordException=e.PageActionEventType=e.OPS=e.MissingPDFException=e.LINE_FACTOR=e.LINE_DESCENT_FACTOR=e.InvalidPDFException=e.ImageKind=e.IDENTITY_MATRIX=e.FormatError=e.FontType=e.FeatureTest=e.FONT_IDENTITY_MATRIX=e.DocumentActionEventType=e.CMapCompressionType=e.BaseException=e.AnnotationType=e.AnnotationStateModelType=e.AnnotationReviewState=e.AnnotationReplyType=e.AnnotationMode=e.AnnotationMarkedState=e.AnnotationFlag=e.AnnotationFieldFlag=e.AnnotationEditorType=e.AnnotationEditorPrefix=e.AnnotationEditorParamsType=e.AnnotationBorderStyleType=e.AnnotationActionEventType=e.AbortException=void 0,e.arrayByteLength=ke,e.arraysToBytes=Me,e.assert=W,e.bytesToString=_e,e.createPromiseCapability=Fi,e.createValidAbsoluteUrl=_,e.escapeString=Yr,e.getModificationDate=up,e.getVerbosityLevel=z,e.info=k,e.isArrayBuffer=xs,e.isArrayEqual=Kr,e.isAscii=wn,e.objectFromMap=Fe,e.objectSize=Le,e.setVerbosityLevel=$,e.shadow=C,e.string32=Ce,e.stringToBytes=he,e.stringToPDFString=Nn,e.stringToUTF16BEString=rn,e.stringToUTF8String=vr,e.unreachable=N,e.utf8StringToString=Fg,e.warn=T,t(2);let i=[1,0,0,1,0,0];e.IDENTITY_MATRIX=i;let r=[.001,0,0,.001,0,0];e.FONT_IDENTITY_MATRIX=r;let o=1.35;e.LINE_FACTOR=o;let s=.35;e.LINE_DESCENT_FACTOR=s;let l={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};e.RenderingIntentFlag=l;let c={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};e.AnnotationMode=c;let u="pdfjs_internal_editor_";e.AnnotationEditorPrefix=u;let p={DISABLE:-1,NONE:0,FREETEXT:3,INK:15};e.AnnotationEditorType=p;let d={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13};e.AnnotationEditorParamsType=d;let h={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};e.PermissionFlag=h;let A={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};e.TextRenderingMode=A;let g={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};e.ImageKind=g;let F={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};e.AnnotationType=F;let b={MARKED:"Marked",REVIEW:"Review"};e.AnnotationStateModelType=b;let R={MARKED:"Marked",UNMARKED:"Unmarked"};e.AnnotationMarkedState=R;let P={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"};e.AnnotationReviewState=P;let L={GROUP:"Group",REPLY:"R"};e.AnnotationReplyType=L;let S={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};e.AnnotationFlag=S;let x={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};e.AnnotationFieldFlag=x;let v={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};e.AnnotationBorderStyleType=v;let M={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};e.AnnotationActionEventType=M;let O={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};e.DocumentActionEventType=O;let B={O:"PageOpen",C:"PageClose"};e.PageActionEventType=B;let X={UNKNOWN:"UNKNOWN",FLATE:"FLATE",LZW:"LZW",DCT:"DCT",JPX:"JPX",JBIG:"JBIG",A85:"A85",AHX:"AHX",CCF:"CCF",RLX:"RLX"};e.StreamType=X;let V={UNKNOWN:"UNKNOWN",TYPE1:"TYPE1",TYPE1STANDARD:"TYPE1STANDARD",TYPE1C:"TYPE1C",CIDFONTTYPE0:"CIDFONTTYPE0",CIDFONTTYPE0C:"CIDFONTTYPE0C",TRUETYPE:"TRUETYPE",CIDFONTTYPE2:"CIDFONTTYPE2",TYPE3:"TYPE3",OPENTYPE:"OPENTYPE",TYPE0:"TYPE0",MMTYPE1:"MMTYPE1"};e.FontType=V;let J={ERRORS:0,WARNINGS:1,INFOS:5};e.VerbosityLevel=J;let ce={NONE:0,BINARY:1,STREAM:2};e.CMapCompressionType=ce;let G={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};e.OPS=G;let Y={unknown:"unknown",forms:"forms",javaScript:"javaScript",signatures:"signatures",smask:"smask",shadingPattern:"shadingPattern",font:"font",errorTilingPattern:"errorTilingPattern",errorExtGState:"errorExtGState",errorXObject:"errorXObject",errorFontLoadType3:"errorFontLoadType3",errorFontState:"errorFontState",errorFontMissing:"errorFontMissing",errorFontTranslate:"errorFontTranslate",errorColorSpace:"errorColorSpace",errorOperatorList:"errorOperatorList",errorFontToUnicode:"errorFontToUnicode",errorFontLoadNative:"errorFontLoadNative",errorFontBuildPath:"errorFontBuildPath",errorFontGetPath:"errorFontGetPath",errorMarkedContent:"errorMarkedContent",errorContentSubStream:"errorContentSubStream"};e.UNSUPPORTED_FEATURES=Y;let K={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};e.PasswordResponses=K;let se=J.WARNINGS;function $(me){Number.isInteger(me)&&(se=me)}function z(){return se}function k(me){se>=J.INFOS&&console.log(`Info: ${me}`)}function T(me){se>=J.WARNINGS&&console.log(`Warning: ${me}`)}function N(me){throw new Error(me)}function W(me,ie){me||N(ie)}function m(me){if(!me)return!1;switch(me.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function _(me,ie=null,re=null){if(!me)return null;try{if(re&&typeof me=="string"){if(re.addDefaultProtocol&&me.startsWith("www.")){let Xe=me.match(/\./g);Xe&&Xe.length>=2&&(me=`http://${me}`)}if(re.tryConvertEncoding)try{me=vr(me)}catch{}}let Pe=ie?new URL(me,ie):new URL(me);if(m(Pe))return Pe}catch{}return null}function C(me,ie,re){return Object.defineProperty(me,ie,{value:re,enumerable:!0,configurable:!0,writable:!1}),re}let I=function(){function ie(re,Pe){this.constructor===ie&&N("Cannot initialize BaseException."),this.message=re,this.name=Pe}return ie.prototype=new Error,ie.constructor=ie,ie}();e.BaseException=I;class H extends I{constructor(ie,re){super(ie,"PasswordException"),this.code=re}}e.PasswordException=H;class j extends I{constructor(ie,re){super(ie,"UnknownErrorException"),this.details=re}}e.UnknownErrorException=j;class q extends I{constructor(ie){super(ie,"InvalidPDFException")}}e.InvalidPDFException=q;class Z extends I{constructor(ie){super(ie,"MissingPDFException")}}e.MissingPDFException=Z;class ae extends I{constructor(ie,re){super(ie,"UnexpectedResponseException"),this.status=re}}e.UnexpectedResponseException=ae;class ee extends I{constructor(ie){super(ie,"FormatError")}}e.FormatError=ee;class ue extends I{constructor(ie){super(ie,"AbortException")}}e.AbortException=ue;function _e(me){(typeof me!="object"||me===null||me.length===void 0)&&N("Invalid argument for bytesToString");let ie=me.length,re=8192;if(ie<re)return String.fromCharCode.apply(null,me);let Pe=[];for(let Xe=0;Xe<ie;Xe+=re){let Ot=Math.min(Xe+re,ie),xt=me.subarray(Xe,Ot);Pe.push(String.fromCharCode.apply(null,xt))}return Pe.join("")}function he(me){typeof me!="string"&&N("Invalid argument for stringToBytes");let ie=me.length,re=new Uint8Array(ie);for(let Pe=0;Pe<ie;++Pe)re[Pe]=me.charCodeAt(Pe)&255;return re}function ke(me){if(me.length!==void 0)return me.length;if(me.byteLength!==void 0)return me.byteLength;N("Invalid argument for arrayByteLength")}function Me(me){let ie=me.length;if(ie===1&&me[0]instanceof Uint8Array)return me[0];let re=0;for(let Ot=0;Ot<ie;Ot++)re+=ke(me[Ot]);let Pe=0,Xe=new Uint8Array(re);for(let Ot=0;Ot<ie;Ot++){let xt=me[Ot];xt instanceof Uint8Array||(typeof xt=="string"?xt=he(xt):xt=new Uint8Array(xt));let br=xt.byteLength;Xe.set(xt,Pe),Pe+=br}return Xe}function Ce(me){return String.fromCharCode(me>>24&255,me>>16&255,me>>8&255,me&255)}function Le(me){return Object.keys(me).length}function Fe(me){let ie=Object.create(null);for(let[re,Pe]of me)ie[re]=Pe;return ie}function jt(){let me=new Uint8Array(4);return me[0]=1,new Uint32Array(me.buffer,0,1)[0]===1}function xn(){try{return new Function(""),!0}catch{return!1}}class ze{static get isLittleEndian(){return C(this,"isLittleEndian",jt())}static get isEvalSupported(){return C(this,"isEvalSupported",xn())}static get isOffscreenCanvasSupported(){return C(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}}e.FeatureTest=ze;let Vt=[...Array(256).keys()].map(me=>me.toString(16).padStart(2,"0"));class ot{static makeHexColor(ie,re,Pe){return`#${Vt[ie]}${Vt[re]}${Vt[Pe]}`}static scaleMinMax(ie,re){let Pe;ie[0]?(ie[0]<0&&(Pe=re[0],re[0]=re[1],re[1]=Pe),re[0]*=ie[0],re[1]*=ie[0],ie[3]<0&&(Pe=re[2],re[2]=re[3],re[3]=Pe),re[2]*=ie[3],re[3]*=ie[3]):(Pe=re[0],re[0]=re[2],re[2]=Pe,Pe=re[1],re[1]=re[3],re[3]=Pe,ie[1]<0&&(Pe=re[2],re[2]=re[3],re[3]=Pe),re[2]*=ie[1],re[3]*=ie[1],ie[2]<0&&(Pe=re[0],re[0]=re[1],re[1]=Pe),re[0]*=ie[2],re[1]*=ie[2]),re[0]+=ie[4],re[1]+=ie[4],re[2]+=ie[5],re[3]+=ie[5]}static transform(ie,re){return[ie[0]*re[0]+ie[2]*re[1],ie[1]*re[0]+ie[3]*re[1],ie[0]*re[2]+ie[2]*re[3],ie[1]*re[2]+ie[3]*re[3],ie[0]*re[4]+ie[2]*re[5]+ie[4],ie[1]*re[4]+ie[3]*re[5]+ie[5]]}static applyTransform(ie,re){let Pe=ie[0]*re[0]+ie[1]*re[2]+re[4],Xe=ie[0]*re[1]+ie[1]*re[3]+re[5];return[Pe,Xe]}static applyInverseTransform(ie,re){let Pe=re[0]*re[3]-re[1]*re[2],Xe=(ie[0]*re[3]-ie[1]*re[2]+re[2]*re[5]-re[4]*re[3])/Pe,Ot=(-ie[0]*re[1]+ie[1]*re[0]+re[4]*re[1]-re[5]*re[0])/Pe;return[Xe,Ot]}static getAxialAlignedBoundingBox(ie,re){let Pe=ot.applyTransform(ie,re),Xe=ot.applyTransform(ie.slice(2,4),re),Ot=ot.applyTransform([ie[0],ie[3]],re),xt=ot.applyTransform([ie[2],ie[1]],re);return[Math.min(Pe[0],Xe[0],Ot[0],xt[0]),Math.min(Pe[1],Xe[1],Ot[1],xt[1]),Math.max(Pe[0],Xe[0],Ot[0],xt[0]),Math.max(Pe[1],Xe[1],Ot[1],xt[1])]}static inverseTransform(ie){let re=ie[0]*ie[3]-ie[1]*ie[2];return[ie[3]/re,-ie[1]/re,-ie[2]/re,ie[0]/re,(ie[2]*ie[5]-ie[4]*ie[3])/re,(ie[4]*ie[1]-ie[5]*ie[0])/re]}static apply3dTransform(ie,re){return[ie[0]*re[0]+ie[1]*re[1]+ie[2]*re[2],ie[3]*re[0]+ie[4]*re[1]+ie[5]*re[2],ie[6]*re[0]+ie[7]*re[1]+ie[8]*re[2]]}static singularValueDecompose2dScale(ie){let re=[ie[0],ie[2],ie[1],ie[3]],Pe=ie[0]*re[0]+ie[1]*re[2],Xe=ie[0]*re[1]+ie[1]*re[3],Ot=ie[2]*re[0]+ie[3]*re[2],xt=ie[2]*re[1]+ie[3]*re[3],br=(Pe+xt)/2,Qr=Math.sqrt((Pe+xt)**2-4*(Pe*xt-Ot*Xe))/2,$r=br+Qr||1,Nt=br-Qr||1;return[Math.sqrt($r),Math.sqrt(Nt)]}static normalizeRect(ie){let re=ie.slice(0);return ie[0]>ie[2]&&(re[0]=ie[2],re[2]=ie[0]),ie[1]>ie[3]&&(re[1]=ie[3],re[3]=ie[1]),re}static intersect(ie,re){let Pe=Math.max(Math.min(ie[0],ie[2]),Math.min(re[0],re[2])),Xe=Math.min(Math.max(ie[0],ie[2]),Math.max(re[0],re[2]));if(Pe>Xe)return null;let Ot=Math.max(Math.min(ie[1],ie[3]),Math.min(re[1],re[3])),xt=Math.min(Math.max(ie[1],ie[3]),Math.max(re[1],re[3]));return Ot>xt?null:[Pe,Ot,Xe,xt]}static bezierBoundingBox(ie,re,Pe,Xe,Ot,xt,br,Qr){let $r=[],Nt=[[],[]],vo,Sr,fa,Fn,ga,xa,hc,mc;for(let wa=0;wa<2;++wa){if(wa===0?(Sr=6*ie-12*Pe+6*Ot,vo=-3*ie+9*Pe-9*Ot+3*br,fa=3*Pe-3*ie):(Sr=6*re-12*Xe+6*xt,vo=-3*re+9*Xe-9*xt+3*Qr,fa=3*Xe-3*re),Math.abs(vo)<1e-12){if(Math.abs(Sr)<1e-12)continue;Fn=-fa/Sr,0<Fn&&Fn<1&&$r.push(Fn);continue}hc=Sr*Sr-4*fa*vo,mc=Math.sqrt(hc),!(hc<0)&&(ga=(-Sr+mc)/(2*vo),0<ga&&ga<1&&$r.push(ga),xa=(-Sr-mc)/(2*vo),0<xa&&xa<1&&$r.push(xa))}let ws=$r.length,li,Fs=ws;for(;ws--;)Fn=$r[ws],li=1-Fn,Nt[0][ws]=li*li*li*ie+3*li*li*Fn*Pe+3*li*Fn*Fn*Ot+Fn*Fn*Fn*br,Nt[1][ws]=li*li*li*re+3*li*li*Fn*Xe+3*li*Fn*Fn*xt+Fn*Fn*Fn*Qr;return Nt[0][Fs]=ie,Nt[1][Fs]=re,Nt[0][Fs+1]=br,Nt[1][Fs+1]=Qr,Nt[0].length=Nt[1].length=Fs+2,[Math.min(...Nt[0]),Math.min(...Nt[1]),Math.max(...Nt[0]),Math.max(...Nt[1])]}}e.Util=ot;let Zn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function Nn(me){if(me[0]>="\xEF"){let re;if(me[0]==="\xFE"&&me[1]==="\xFF"?re="utf-16be":me[0]==="\xFF"&&me[1]==="\xFE"?re="utf-16le":me[0]==="\xEF"&&me[1]==="\xBB"&&me[2]==="\xBF"&&(re="utf-8"),re)try{let Pe=new TextDecoder(re,{fatal:!0}),Xe=he(me);return Pe.decode(Xe)}catch(Pe){T(`stringToPDFString: "${Pe}".`)}}let ie=[];for(let re=0,Pe=me.length;re<Pe;re++){let Xe=Zn[me.charCodeAt(re)];ie.push(Xe?String.fromCharCode(Xe):me.charAt(re))}return ie.join("")}function Yr(me){return me.replace(/([()\\\n\r])/g,ie=>ie===`
`?"\\n":ie==="\r"?"\\r":`\\${ie}`)}function wn(me){return/^[\x00-\x7F]*$/.test(me)}function rn(me){let ie=["\xFE\xFF"];for(let re=0,Pe=me.length;re<Pe;re++){let Xe=me.charCodeAt(re);ie.push(String.fromCharCode(Xe>>8&255),String.fromCharCode(Xe&255))}return ie.join("")}function vr(me){return decodeURIComponent(escape(me))}function Fg(me){return unescape(encodeURIComponent(me))}function xs(me){return typeof me=="object"&&me!==null&&me.byteLength!==void 0}function Kr(me,ie){if(me.length!==ie.length)return!1;for(let re=0,Pe=me.length;re<Pe;re++)if(me[re]!==ie[re])return!1;return!0}function up(me=new Date){return[me.getUTCFullYear().toString(),(me.getUTCMonth()+1).toString().padStart(2,"0"),me.getUTCDate().toString().padStart(2,"0"),me.getUTCHours().toString().padStart(2,"0"),me.getUTCMinutes().toString().padStart(2,"0"),me.getUTCSeconds().toString().padStart(2,"0")].join("")}function Fi(){let me=Object.create(null),ie=!1;return Object.defineProperty(me,"settled",{get(){return ie}}),me.promise=new Promise(function(re,Pe){me.resolve=function(Xe){ie=!0,re(Xe)},me.reject=function(Xe){ie=!0,Pe(Xe)}}),me}},(n,e,t)=>{var i=t(3)},(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isNodeJS=void 0;let t=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");e.isNodeJS=t},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.setPDFNetworkStreamFactory=setPDFNetworkStreamFactory,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(5),_display_utils=__w_pdfjs_require__(8),_font_loader=__w_pdfjs_require__(11),_canvas=__w_pdfjs_require__(12),_worker_options=__w_pdfjs_require__(15),_is_node=__w_pdfjs_require__(3),_message_handler=__w_pdfjs_require__(16),_metadata=__w_pdfjs_require__(17),_optional_content_config=__w_pdfjs_require__(18),_transport_stream=__w_pdfjs_require__(19),_xfa_text=__w_pdfjs_require__(20);let DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DefaultCanvasFactory=_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultStandardFontDataFactory=_display_utils.DOMStandardFontDataFactory;if(exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){let{NodeCanvasFactory:n,NodeCMapReaderFactory:e,NodeStandardFontDataFactory:t}=__w_pdfjs_require__(21);exports.DefaultCanvasFactory=DefaultCanvasFactory=n,exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory=e,exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory=t}let createPDFNetworkStream;function setPDFNetworkStreamFactory(n){createPDFNetworkStream=n}function getDocument(n){let e=new PDFDocumentLoadingTask,t;if(typeof n=="string"||n instanceof URL)t={url:n};else if((0,_util.isArrayBuffer)(n))t={data:n};else if(n instanceof PDFDataRangeTransport)t={range:n};else{if(typeof n!="object")throw new Error("Invalid parameter in getDocument, need either string, URL, TypedArray, or parameter object.");if(!n.url&&!n.data&&!n.range)throw new Error("Invalid parameter object: need either .data, .range or .url");t=n}let i=Object.create(null),r=null,o=null;for(let l in t){let c=t[l];switch(l){case"url":if(typeof window<"u")try{i[l]=new URL(c,window.location).href;continue}catch(u){(0,_util.warn)(`Cannot create valid URL: "${u}".`)}else if(typeof c=="string"||c instanceof URL){i[l]=c.toString();continue}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.");case"range":r=c;continue;case"worker":o=c;continue;case"data":if(_is_node.isNodeJS&&typeof Buffer<"u"&&c instanceof Buffer)i[l]=new Uint8Array(c);else{if(c instanceof Uint8Array)break;if(typeof c=="string")i[l]=(0,_util.stringToBytes)(c);else if(typeof c=="object"&&c!==null&&!isNaN(c.length))i[l]=new Uint8Array(c);else if((0,_util.isArrayBuffer)(c))i[l]=new Uint8Array(c);else throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}continue}i[l]=c}if(i.CMapReaderFactory=i.CMapReaderFactory||DefaultCMapReaderFactory,i.StandardFontDataFactory=i.StandardFontDataFactory||DefaultStandardFontDataFactory,i.ignoreErrors=i.stopAtErrors!==!0,i.fontExtraProperties=i.fontExtraProperties===!0,i.pdfBug=i.pdfBug===!0,i.enableXfa=i.enableXfa===!0,(!Number.isInteger(i.rangeChunkSize)||i.rangeChunkSize<1)&&(i.rangeChunkSize=DEFAULT_RANGE_CHUNK_SIZE),(typeof i.docBaseUrl!="string"||(0,_display_utils.isDataScheme)(i.docBaseUrl))&&(i.docBaseUrl=null),(!Number.isInteger(i.maxImageSize)||i.maxImageSize<-1)&&(i.maxImageSize=-1),typeof i.cMapUrl!="string"&&(i.cMapUrl=null),typeof i.standardFontDataUrl!="string"&&(i.standardFontDataUrl=null),typeof i.useWorkerFetch!="boolean"&&(i.useWorkerFetch=i.CMapReaderFactory===_display_utils.DOMCMapReaderFactory&&i.StandardFontDataFactory===_display_utils.DOMStandardFontDataFactory),typeof i.isEvalSupported!="boolean"&&(i.isEvalSupported=!0),typeof i.disableFontFace!="boolean"&&(i.disableFontFace=_is_node.isNodeJS),typeof i.useSystemFonts!="boolean"&&(i.useSystemFonts=!_is_node.isNodeJS&&!i.disableFontFace),(typeof i.ownerDocument!="object"||i.ownerDocument===null)&&(i.ownerDocument=globalThis.document),typeof i.disableRange!="boolean"&&(i.disableRange=!1),typeof i.disableStream!="boolean"&&(i.disableStream=!1),typeof i.disableAutoFetch!="boolean"&&(i.disableAutoFetch=!1),(0,_util.setVerbosityLevel)(i.verbosity),!o){let l={verbosity:i.verbosity,port:_worker_options.GlobalWorkerOptions.workerPort};o=l.port?PDFWorker.fromPort(l):new PDFWorker(l),e._worker=o}let s=e.docId;return o.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");let l=_fetchDocument(o,i,r,s),c=new Promise(function(u){let p;r?p=new _transport_stream.PDFDataTransportStream({length:i.length,initialData:i.initialData,progressiveDone:i.progressiveDone,contentDispositionFilename:i.contentDispositionFilename,disableRange:i.disableRange,disableStream:i.disableStream},r):i.data||(p=createPDFNetworkStream({url:i.url,length:i.length,httpHeaders:i.httpHeaders,withCredentials:i.withCredentials,rangeChunkSize:i.rangeChunkSize,disableRange:i.disableRange,disableStream:i.disableStream})),u(p)});return Promise.all([l,c]).then(function([u,p]){if(e.destroyed)throw new Error("Loading aborted");let d=new _message_handler.MessageHandler(s,u,o.port),h=new WorkerTransport(d,e,p,i);e._transport=h,d.send("Ready",null)})}).catch(e._capability.reject),e}async function _fetchDocument(n,e,t,i){if(n.destroyed)throw new Error("Worker was destroyed");t&&(e.length=t.length,e.initialData=t.initialData,e.progressiveDone=t.progressiveDone,e.contentDispositionFilename=t.contentDispositionFilename);let r=await n.messageHandler.sendWithPromise("GetDocRequest",{docId:i,apiVersion:"2.16.105",source:{data:e.data,url:e.url,password:e.password,disableAutoFetch:e.disableAutoFetch,rangeChunkSize:e.rangeChunkSize,length:e.length},maxImageSize:e.maxImageSize,disableFontFace:e.disableFontFace,docBaseUrl:e.docBaseUrl,ignoreErrors:e.ignoreErrors,isEvalSupported:e.isEvalSupported,fontExtraProperties:e.fontExtraProperties,enableXfa:e.enableXfa,useSystemFonts:e.useSystemFonts,cMapUrl:e.useWorkerFetch?e.cMapUrl:null,standardFontDataUrl:e.useWorkerFetch?e.standardFontDataUrl:null});if(e.data&&(e.data=null),n.destroyed)throw new Error("Worker was destroyed");return r}class PDFDocumentLoadingTask{static#e=0;constructor(){this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId=`d${PDFDocumentLoadingTask.#e++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null,this.onUnsupportedFeature=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0,await this._transport?.destroy(),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(e,t,i=!1,r=null){this.length=e,this.initialData=t,this.progressiveDone=i,this.contentDispositionFilename=r,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(let i of this._rangeListeners)i(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(let i of this._progressListeners)i(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(let t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(e,t){this._pdfInfo=e,this._transport=t,Object.defineProperty(this,"fingerprint",{get(){return(0,_display_utils.deprecated)("`PDFDocumentProxy.fingerprint`, please use `PDFDocumentProxy.fingerprints` instead."),this.fingerprints[0]}}),Object.defineProperty(this,"getStats",{value:async()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getStats`, please use the `PDFDocumentProxy.stats`-getter instead."),this.stats||{streamTypes:{},fontTypes:{}})})}get annotationStorage(){return this._transport.annotationStorage}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get stats(){return this._transport.stats}get isPureXfa(){return!!this._transport._htmlForXfa}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}saveDocument(){return this._transport.annotationStorage.size<=0&&(0,_display_utils.deprecated)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead."),this._transport.saveDocument()}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(e,t,i,r,o=!1){this._pageIndex=e,this._pageInfo=t,this._ownerDocument=r,this._transport=i,this._stats=o?new _display_utils.StatTimer:null,this._pdfBug=o,this.commonObjs=i.commonObjs,this.objs=new PDFObjects,this._bitmaps=new Set,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this._annotationPromises=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:i=0,offsetY:r=0,dontFlip:o=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:e,rotation:t,offsetX:i,offsetY:r,dontFlip:o})}getAnnotations({intent:e="display"}={}){let t=this._transport.getRenderingIntent(e),i=this._annotationPromises.get(t.cacheKey);return i||(i=this._transport.getAnnotations(this._pageIndex,t.renderingIntent),this._annotationPromises.set(t.cacheKey,i),i=i.then(r=>{for(let o of r)o.titleObj!==void 0&&Object.defineProperty(o,"title",{get(){return(0,_display_utils.deprecated)("`title`-property on annotation, please use `titleObj` instead."),o.titleObj.str}}),o.contentsObj!==void 0&&Object.defineProperty(o,"contents",{get(){return(0,_display_utils.deprecated)("`contents`-property on annotation, please use `contentsObj` instead."),o.contentsObj.str}});return r})),i}getJSActions(){return this._jsActionsPromise||=this._transport.getPageJSActions(this._pageIndex)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,viewport:t,intent:i="display",annotationMode:r=_util.AnnotationMode.ENABLE,transform:o=null,imageLayer:s=null,canvasFactory:l=null,background:c=null,optionalContentConfigPromise:u=null,annotationCanvasMap:p=null,pageColors:d=null,printAnnotationStorage:h=null}){arguments[0]?.renderInteractiveForms!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `renderInteractiveForms`-option, please use the `annotationMode`-option instead."),arguments[0].renderInteractiveForms===!0&&r===_util.AnnotationMode.ENABLE&&(r=_util.AnnotationMode.ENABLE_FORMS)),arguments[0]?.includeAnnotationStorage!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `includeAnnotationStorage`-option, please use the `annotationMode`-option instead."),arguments[0].includeAnnotationStorage===!0&&r===_util.AnnotationMode.ENABLE&&(r=_util.AnnotationMode.ENABLE_STORAGE)),this._stats&&this._stats.time("Overall");let A=this._transport.getRenderingIntent(i,r,h);this.pendingCleanup=!1,u||(u=this._transport.getOptionalContentConfig());let g=this._intentStates.get(A.cacheKey);g||(g=Object.create(null),this._intentStates.set(A.cacheKey,g)),g.streamReaderCancelTimeout&&(clearTimeout(g.streamReaderCancelTimeout),g.streamReaderCancelTimeout=null);let F=l||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),b=!!(A.renderingIntent&_util.RenderingIntentFlag.PRINT);g.displayReadyCapability||(g.displayReadyCapability=(0,_util.createPromiseCapability)(),g.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(A));let R=S=>{g.renderTasks.delete(P),(this.cleanupAfterRender||b)&&(this.pendingCleanup=!0),this._tryCleanup(),S?(P.capability.reject(S),this._abortOperatorList({intentState:g,reason:S instanceof Error?S:new Error(S)})):P.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"))},P=new InternalRenderTask({callback:R,params:{canvasContext:e,viewport:t,transform:o,imageLayer:s,background:c},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:p,operatorList:g.operatorList,pageIndex:this._pageIndex,canvasFactory:F,useRequestAnimationFrame:!b,pdfBug:this._pdfBug,pageColors:d});(g.renderTasks||=new Set).add(P);let L=P.task;return Promise.all([g.displayReadyCapability.promise,u]).then(([S,x])=>{if(this.pendingCleanup){R();return}this._stats&&this._stats.time("Rendering"),P.initializeGraphics({transparency:S,optionalContentConfig:x}),P.operatorListChanged()}).catch(R),L}getOperatorList({intent:e="display",annotationMode:t=_util.AnnotationMode.ENABLE,printAnnotationStorage:i=null}={}){function r(){s.operatorList.lastChunk&&(s.opListReadCapability.resolve(s.operatorList),s.renderTasks.delete(l))}let o=this._transport.getRenderingIntent(e,t,i,!0),s=this._intentStates.get(o.cacheKey);s||(s=Object.create(null),this._intentStates.set(o.cacheKey,s));let l;return s.opListReadCapability||(l=Object.create(null),l.operatorListChanged=r,s.opListReadCapability=(0,_util.createPromiseCapability)(),(s.renderTasks||=new Set).add(l),s.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(o)),s.opListReadCapability.promise}streamTextContent({disableCombineTextItems:e=!1,includeMarkedContent:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,combineTextItems:e!==!0,includeMarkedContent:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>_xfa_text.XfaText.textContent(i));let t=this.streamTextContent(e);return new Promise(function(i,r){function o(){s.read().then(function({value:c,done:u}){if(u){i(l);return}Object.assign(l.styles,c.styles),l.items.push(...c.items),o()},r)}let s=t.getReader(),l={items:[],styles:Object.create(null)};o()})}getStructTree(){return this._structTreePromise||=this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(let i of t.renderTasks)e.push(i.completed),i.cancel();this.objs.clear();for(let t of this._bitmaps)t.close();return this._bitmaps.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,this.pendingCleanup=!1,Promise.all(e)}cleanup(e=!1){return this.pendingCleanup=!0,this._tryCleanup(e)}_tryCleanup(e=!1){if(!this.pendingCleanup)return!1;for(let{renderTasks:t,operatorList:i}of this._intentStates.values())if(t.size>0||!i.lastChunk)return!1;this._intentStates.clear(),this.objs.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,e&&this._stats&&(this._stats=new _display_utils.StatTimer);for(let t of this._bitmaps)t.close();return this._bitmaps.clear(),this.pendingCleanup=!1,!0}_startRenderPage(e,t){let i=this._intentStates.get(t);i&&(this._stats&&this._stats.timeEnd("Page Request"),i.displayReadyCapability&&i.displayReadyCapability.resolve(e))}_renderPageChunk(e,t){for(let i=0,r=e.length;i<r;i++)t.operatorList.fnArray.push(e.fnArray[i]),t.operatorList.argsArray.push(e.argsArray[i]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let i of t.renderTasks)i.operatorListChanged();e.lastChunk&&this._tryCleanup()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageMap:i}){let o=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:i}).getReader(),s=this._intentStates.get(t);s.streamReader=o;let l=()=>{o.read().then(({value:c,done:u})=>{if(u){s.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(c,s),l())},c=>{if(s.streamReader=null,!this._transport.destroyed){if(s.operatorList){s.operatorList.lastChunk=!0;for(let u of s.renderTasks)u.operatorListChanged();this._tryCleanup()}if(s.displayReadyCapability)s.displayReadyCapability.reject(c);else if(s.opListReadCapability)s.opListReadCapability.reject(c);else throw c}})};l()}_abortOperatorList({intentState:e,reason:t,force:i=!1}){if(e.streamReader){if(!i){if(e.renderTasks.size>0)return;if(t instanceof _display_utils.RenderingCancelledException){e.streamReaderCancelTimeout=setTimeout(()=>{this._abortOperatorList({intentState:e,reason:t,force:!0}),e.streamReaderCancelTimeout=null},RENDERING_CANCELLED_TIMEOUT);return}}if(e.streamReader.cancel(new _util.AbortException(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(let[r,o]of this._intentStates)if(o===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){this._listeners=[],this._deferred=Promise.resolve()}postMessage(e,t){let i={data:structuredClone(e,t)};this._deferred.then(()=>{for(let r of this._listeners)r.call(this,i)})}addEventListener(e,t){this._listeners.push(t)}removeEventListener(e,t){let i=this._listeners.indexOf(t);this._listeners.splice(i,1)}terminate(){this._listeners.length=0}}exports.LoopbackPort=LoopbackPort;let PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_is_node.isNodeJS&&typeof vg=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){let n=document?.currentScript?.src;n&&(PDFWorkerUtil.fallbackWorkerSrc=n.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(n,e){let t;try{if(t=new URL(n),!t.origin||t.origin==="null")return!1}catch{return!1}let i=new URL(e,t);return t.origin===i.origin},PDFWorkerUtil.createCDNWrapper=function(n){let e=`importScripts("${n}");`;return URL.createObjectURL(new Blob([e]))}}class PDFWorker{static#workerPorts=new WeakMap;constructor({name:n=null,port:e=null,verbosity:t=(0,_util.getVerbosityLevel)()}={}){if(e&&PDFWorker.#workerPorts.has(e))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=n,this.destroyed=!1,this.verbosity=t,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,e){PDFWorker.#workerPorts.set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(n){this._port=n,this._messageHandler=new _message_handler.MessageHandler("main","worker",n),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve()}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:n}=PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,n)||(n=PDFWorkerUtil.createCDNWrapper(new URL(n,window.location).href));let e=new Worker(n),t=new _message_handler.MessageHandler("main","worker",e),i=()=>{e.removeEventListener("error",r),t.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=()=>{this._webWorker||i()};e.addEventListener("error",r),t.on("test",s=>{if(e.removeEventListener("error",r),this.destroyed){i();return}s?(this._messageHandler=t,this._port=e,this._webWorker=e,this._readyCapability.resolve(),t.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),t.destroy(),e.terminate())}),t.on("ready",s=>{if(e.removeEventListener("error",r),this.destroyed){i();return}try{o()}catch{this._setupFakeWorker()}});let o=()=>{let s=new Uint8Array;t.send("test",s,[s.buffer])};o();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then(n=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let e=new LoopbackPort;this._port=e;let t=`fake${PDFWorkerUtil.fakeWorkerId++}`,i=new _message_handler.MessageHandler(t+"_worker",t,e);n.setup(i,e);let r=new _message_handler.MessageHandler(t,t+"_worker",e);this._messageHandler=r,this._readyCapability.resolve(),r.send("configure",{verbosity:this.verbosity})}).catch(n=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${n.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),PDFWorker.#workerPorts.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(n){if(!n?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return this.#workerPorts.has(n.port)?this.#workerPorts.get(n.port):new PDFWorker(n)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){let loader=async()=>{let mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&typeof vg=="function"){let worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}}exports.PDFWorker=PDFWorker,PDFWorker.getWorkerSrc=function(){return(0,_display_utils.deprecated)("`PDFWorker.getWorkerSrc()`, please use `PDFWorker.workerSrc` instead."),this.workerSrc};class WorkerTransport{#e=null;#t=new Map;#r=new Map;#n=null;constructor(e,t,i,r){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({docId:t.docId,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this._params=r,r.useWorkerFetch||(this.CMapReaderFactory=new r.CMapReaderFactory({baseUrl:r.cMapUrl,isCompressed:r.cMapPacked}),this.StandardFontDataFactory=new r.StandardFontDataFactory({baseUrl:r.standardFontDataUrl})),this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}get stats(){return this.#e}getRenderingIntent(e,t=_util.AnnotationMode.ENABLE,i=null,r=!1){let o=_util.RenderingIntentFlag.DISPLAY,s=null;switch(e){case"any":o=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":o=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${e}`)}switch(t){case _util.AnnotationMode.DISABLE:o+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:o+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:o+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,s=(o&_util.RenderingIntentFlag.PRINT&&i instanceof _annotation_storage.PrintAnnotationStorage?i:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${t}`)}return r&&(o+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:o,cacheKey:`${o}_${_annotation_storage.AnnotationStorage.getHash(s)}`,annotationStorageMap:s}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));let e=[];for(let i of this.#t.values())e.push(i._destroy());this.#t.clear(),this.#r.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#n=null,this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null,this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(i,r)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=o=>{this._lastProgress={loaded:o.loaded,total:o.total}},r.onPull=()=>{this._fullReader.read().then(function({value:o,done:s}){if(s){r.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(o),"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{r.error(o)})},r.onCancel=o=>{this._fullReader.cancel(o),r.ready.catch(s=>{if(!this.destroyed)throw s})}}),e.on("ReaderHeadersReady",i=>{let r=(0,_util.createPromiseCapability)(),o=this._fullReader;return o.headersReady.then(()=>{(!o.isStreamingSupported||!o.isRangeSupported)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),o.onProgress=s=>{t.onProgress?.({loaded:s.loaded,total:s.total})}),r.resolve({isStreamingSupported:o.isStreamingSupported,isRangeSupported:o.isRangeSupported,contentLength:o.contentLength})},r.reject),r.promise}),e.on("GetRangeReader",(i,r)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let o=this._networkStream.getRangeReader(i.begin,i.end);if(!o){r.close();return}r.onPull=()=>{o.read().then(function({value:s,done:l}){if(l){r.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(s),"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(s),1,[s])}).catch(s=>{r.error(s)})},r.onCancel=s=>{o.cancel(s),r.ready.catch(l=>{if(!this.destroyed)throw l})}}),e.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,t._capability.resolve(new PDFDocumentProxy(i,this))}),e.on("DocException",function(i){let r;switch(i.name){case"PasswordException":r=new _util.PasswordException(i.message,i.code);break;case"InvalidPDFException":r=new _util.InvalidPDFException(i.message);break;case"MissingPDFException":r=new _util.MissingPDFException(i.message);break;case"UnexpectedResponseException":r=new _util.UnexpectedResponseException(i.message,i.status);break;case"UnknownErrorException":r=new _util.UnknownErrorException(i.message,i.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}t._capability.reject(r)}),e.on("PasswordRequest",i=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),t.onPassword){let r=o=>{o instanceof Error?this._passwordCapability.reject(o):this._passwordCapability.resolve({password:o})};try{t.onPassword(r,i.code)}catch(o){this._passwordCapability.reject(o)}}else this._passwordCapability.reject(new _util.PasswordException(i.message,i.code));return this._passwordCapability.promise}),e.on("DataLoaded",i=>{t.onProgress?.({loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),e.on("StartRenderPage",i=>{if(this.destroyed)return;this.#t.get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),e.on("commonobj",([i,r,o])=>{if(!this.destroyed&&!this.commonObjs.has(i))switch(r){case"Font":let s=this._params;if("error"in o){let u=o.error;(0,_util.warn)(`Error during font loading: ${u}`),this.commonObjs.resolve(i,u);break}let l=null;s.pdfBug&&globalThis.FontInspector?.enabled&&(l={registerFont(u,p){globalThis.FontInspector.fontAdded(u,p)}});let c=new _font_loader.FontFaceObject(o,{isEvalSupported:s.isEvalSupported,disableFontFace:s.disableFontFace,ignoreErrors:s.ignoreErrors,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),fontRegistry:l});this.fontLoader.bind(c).catch(u=>e.sendWithPromise("FontFallback",{id:i})).finally(()=>{!s.fontExtraProperties&&c.data&&(c.data=null),this.commonObjs.resolve(i,c)});break;case"FontPath":case"Image":this.commonObjs.resolve(i,o);break;default:throw new Error(`Got unknown common object type ${r}`)}}),e.on("obj",([i,r,o,s])=>{if(this.destroyed)return;let l=this.#t.get(r);if(!l.objs.has(i))switch(o){case"Image":l.objs.resolve(i,s);let c=8e6;if(s){let u;if(s.bitmap){let{bitmap:p,width:d,height:h}=s;u=d*h*4,l._bitmaps.add(p)}else u=s.data?.length||0;u>c&&(l.cleanupAfterRender=!0)}break;case"Pattern":l.objs.resolve(i,s);break;default:throw new Error(`Got unknown object type ${o}`)}}),e.on("DocProgress",i=>{this.destroyed||t.onProgress?.({loaded:i.loaded,total:i.total})}),e.on("DocStats",i=>{this.destroyed||(this.#e=Object.freeze({streamTypes:Object.freeze(i.streamTypes),fontTypes:Object.freeze(i.fontTypes)}))}),e.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),e.on("FetchBuiltInCMap",i=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.CMapReaderFactory?this.CMapReaderFactory.fetch(i):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),e.on("FetchStandardFontData",i=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.StandardFontDataFactory?this.StandardFontDataFactory.fetch(i):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}_onUnsupportedFeature({featureId:e}){this.destroyed||this.loadingTask.onUnsupportedFeature?.(e)}getData(){return this.messageHandler.sendWithPromise("GetData",null)}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));let t=e-1,i=this.#r.get(t);if(i)return i;let r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(o=>{if(this.destroyed)throw new Error("Transport destroyed");let s=new PDFPageProxy(t,o,this,this._params.ownerDocument,this._params.pdfBug);return this.#t.set(t,s),s});return this.#r.set(t,r),r}getPageIndex(e){return typeof e!="object"||e===null||!Number.isInteger(e.num)||e.num<0||!Number.isInteger(e.gen)||e.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen})}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}saveDocument(){return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:this.annotationStorage.serializable,filename:this._fullReader?.filename??null}).finally(()=>{this.annotationStorage.resetModified()})}getFieldObjects(){return this._getFieldObjectsPromise||=this.messageHandler.sendWithPromise("GetFieldObjects",null)}hasJSActions(){return this._hasJSActionsPromise||=this.messageHandler.sendWithPromise("HasJSActions",null)}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(e=>new _optional_content_config.OptionalContentConfig(e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){return this.#n||=this.messageHandler.sendWithPromise("GetMetadata",null).then(e=>({info:e[0],metadata:e[1]?new _metadata.Metadata(e[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}))}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(await this.messageHandler.sendWithPromise("Cleanup",null),!this.destroyed){for(let t of this.#t.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#n=null,this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null}}get loadingParams(){let e=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:e.disableAutoFetch,enableXfa:e.enableXfa})}}class PDFObjects{#e=Object.create(null);#t(e){let t=this.#e[e];return t||(this.#e[e]={capability:(0,_util.createPromiseCapability)(),data:null})}get(e,t=null){if(t){let r=this.#t(e);return r.capability.promise.then(()=>t(r.data)),null}let i=this.#e[e];if(!i?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return i.data}has(e){return this.#e[e]?.capability.settled||!1}resolve(e,t=null){let i=this.#t(e);i.data=t,i.capability.resolve()}clear(){this.#e=Object.create(null)}}class RenderTask{#e=null;constructor(e){this.#e=e,this.onContinue=null}get promise(){return this.#e.capability.promise}cancel(){this.#e.cancel()}get separateAnnots(){let{separateAnnots:e}=this.#e.operatorList;if(!e)return!1;let{annotationCanvasMap:t}=this.#e;return e.form||e.canvas&&t?.size>0}}exports.RenderTask=RenderTask;class InternalRenderTask{static#e=new WeakSet;constructor({callback:e,params:t,objs:i,commonObjs:r,annotationCanvasMap:o,operatorList:s,pageIndex:l,canvasFactory:c,useRequestAnimationFrame:u=!1,pdfBug:p=!1,pageColors:d=null}){this.callback=e,this.params=t,this.objs=i,this.commonObjs=r,this.annotationCanvasMap=o,this.operatorListIdx=null,this.operatorList=s,this._pageIndex=l,this.canvasFactory=c,this._pdfBug=p,this.pageColors=d,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=u===!0&&typeof window<"u",this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(InternalRenderTask.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");InternalRenderTask.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:i,viewport:r,transform:o,imageLayer:s,background:l}=this.params;this.gfx=new _canvas.CanvasGraphics(i,this.commonObjs,this.objs,this.canvasFactory,s,t,this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:o,viewport:r,transparency:e,background:l}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}cancel(e=null){this.running=!1,this.cancelled=!0,this.gfx&&this.gfx.endDrawing(),this._canvas&&InternalRenderTask.#e.delete(this._canvas),this.callback(e||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas"))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}this.stepper&&this.stepper.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&InternalRenderTask.#e.delete(this._canvas),this.callback())))}}let version="2.16.105";exports.version=version;let build="172ccdbe5";exports.build=build},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PrintAnnotationStorage=e.AnnotationStorage=void 0;var i=t(1),r=t(6),o=t(10);class s{constructor(){this._storage=new Map,this._modified=!1,this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(u,p){let d=this._storage.get(u);return d===void 0?p:Object.assign(p,d)}getRawValue(u){return this._storage.get(u)}remove(u){if(this._storage.delete(u),this._storage.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let p of this._storage.values())if(p instanceof r.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(u,p){let d=this._storage.get(u),h=!1;if(d!==void 0)for(let[A,g]of Object.entries(p))d[A]!==g&&(h=!0,d[A]=g);else h=!0,this._storage.set(u,p);h&&this.#e(),p instanceof r.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(p.constructor._type)}has(u){return this._storage.has(u)}getAll(){return this._storage.size>0?(0,i.objectFromMap)(this._storage):null}get size(){return this._storage.size}#e(){this._modified||(this._modified=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this._modified&&(this._modified=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new l(this)}get serializable(){if(this._storage.size===0)return null;let u=new Map;for(let[p,d]of this._storage){let h=d instanceof r.AnnotationEditor?d.serialize():d;h&&u.set(p,h)}return u}static getHash(u){if(!u)return"";let p=new o.MurmurHash3_64;for(let[d,h]of u)p.update(`${d}:${JSON.stringify(h)}`);return p.hexdigest()}}e.AnnotationStorage=s;class l extends s{#e=null;constructor(u){super(),this.#e=structuredClone(u.serializable)}get print(){(0,i.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}}e.PrintAnnotationStorage=l},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditor=void 0;var i=t(7),r=t(1);class o{#e=this.focusin.bind(this);#t=this.focusout.bind(this);#r=!1;#n=!1;#o=!1;#u=o._zIndex++;static _colorManager=new i.ColorManager;static _zIndex=1;constructor(l){this.constructor===o&&(0,r.unreachable)("Cannot initialize AnnotationEditor."),this.parent=l.parent,this.id=l.id,this.width=this.height=null,this.pageIndex=l.parent.pageIndex,this.name=l.name,this.div=null;let[c,u]=this.parent.viewportBaseDimensions;this.x=l.x/c,this.y=l.y/u,this.rotation=this.parent.viewport.rotation,this.isAttachedToDOM=!1}static get _defaultLineColor(){return(0,r.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#u}focusin(l){this.#r?this.#r=!1:this.parent.setSelected(this)}focusout(l){!this.isAttachedToDOM||l.relatedTarget?.closest(`#${this.id}`)||(l.preventDefault(),this.parent.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.parent.addToAnnotationStorage(this)}dragstart(l){let c=this.parent.div.getBoundingClientRect();this.startX=l.clientX-c.x,this.startY=l.clientY-c.y,l.dataTransfer.setData("text/plain",this.id),l.dataTransfer.effectAllowed="move"}setAt(l,c,u,p){let[d,h]=this.parent.viewportBaseDimensions;[u,p]=this.screenToPageTranslation(u,p),this.x=(l+u)/d,this.y=(c+p)/h,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}translate(l,c){let[u,p]=this.parent.viewportBaseDimensions;[l,c]=this.screenToPageTranslation(l,c),this.x+=l/u,this.y+=c/p,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}screenToPageTranslation(l,c){let{rotation:u}=this.parent.viewport;switch(u){case 90:return[c,-l];case 180:return[-l,-c];case 270:return[-c,l];default:return[l,c]}}setDims(l,c){let[u,p]=this.parent.viewportBaseDimensions;this.div.style.width=`${100*l/u}%`,this.div.style.height=`${100*c/p}%`}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#e),this.div.addEventListener("focusout",this.#t);let[l,c]=this.getInitialTranslation();return this.translate(l,c),(0,i.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(l){let c=i.KeyboardManager.platform.isMac;if(l.button!==0||l.ctrlKey&&c){l.preventDefault();return}l.ctrlKey&&!c||l.shiftKey||l.metaKey&&c?this.parent.toggleSelected(this):this.parent.setSelected(this),this.#r=!0}getRect(l,c){let[u,p]=this.parent.viewportBaseDimensions,[d,h]=this.parent.pageDimensions,A=d*l/u,g=h*c/p,F=this.x*d,b=this.y*h,R=this.width*d,P=this.height*h;switch(this.rotation){case 0:return[F+A,h-b-g-P,F+A+R,h-b-g];case 90:return[F+g,h-b+A,F+g+P,h-b+A+R];case 180:return[F-A-R,h-b+g,F-A,h-b+g+P];case 270:return[F-g-P,h-b-A-R,F-g,h-b-A];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(l,c){let[u,p,d,h]=l,A=d-u,g=h-p;switch(this.rotation){case 0:return[u,c-h,A,g];case 90:return[u,c-p,g,A];case 180:return[d,c-p,A,g];case 270:return[d,c-h,g,A];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#o=!0}disableEditMode(){this.#o=!1}isInEditMode(){return this.#o}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#e)}serialize(){(0,r.unreachable)("An editor must be serializable")}static deserialize(l,c){let u=new this.prototype.constructor({parent:c,id:c.getNextId()});u.rotation=l.rotation;let[p,d]=c.pageDimensions,[h,A,g,F]=u.getRectInCurrentCoords(l.rect,d);return u.x=h/p,u.y=A/d,u.width=g/p,u.height=F/d,u}remove(){this.div.removeEventListener("focusin",this.#e),this.div.removeEventListener("focusout",this.#t),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){this.div?.classList.add("selectedEditor")}unselect(){this.div?.classList.remove("selectedEditor")}updateParams(l,c){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return this.#n}set isEditing(l){this.#n=l,l?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}}e.AnnotationEditor=o},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.KeyboardManager=e.CommandManager=e.ColorManager=e.AnnotationEditorUIManager=void 0,e.bindEvents=o,e.opacityToHex=s;var i=t(1),r=t(8);function o(A,g,F){for(let b of F)g.addEventListener(b,A[b].bind(A))}function s(A){return Math.round(Math.min(255,Math.max(1,255*A))).toString(16).padStart(2,"0")}class l{#e=0;getId(){return`${i.AnnotationEditorPrefix}${this.#e++}`}}class c{#e=[];#t=!1;#r;#n=-1;constructor(g=128){this.#r=g}add({cmd:g,undo:F,mustExec:b,type:R=NaN,overwriteIfSameType:P=!1,keepUndo:L=!1}){if(b&&g(),this.#t)return;let S={cmd:g,undo:F,type:R};if(this.#n===-1){this.#e.length>0&&(this.#e.length=0),this.#n=0,this.#e.push(S);return}if(P&&this.#e[this.#n].type===R){L&&(S.undo=this.#e[this.#n].undo),this.#e[this.#n]=S;return}let x=this.#n+1;x===this.#r?this.#e.splice(0,1):(this.#n=x,x<this.#e.length&&this.#e.splice(x)),this.#e.push(S)}undo(){this.#n!==-1&&(this.#t=!0,this.#e[this.#n].undo(),this.#t=!1,this.#n-=1)}redo(){this.#n<this.#e.length-1&&(this.#n+=1,this.#t=!0,this.#e[this.#n].cmd(),this.#t=!1)}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#e.length-1}destroy(){this.#e=null}}e.CommandManager=c;class u{constructor(g){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let F=u.platform.isMac;for(let[b,R]of g)for(let P of b){let L=P.startsWith("mac+");F&&L?(this.callbacks.set(P.slice(4),R),this.allKeys.add(P.split("+").at(-1))):!F&&!L&&(this.callbacks.set(P,R),this.allKeys.add(P.split("+").at(-1)))}}static get platform(){let g=typeof navigator<"u"?navigator.platform:"";return(0,i.shadow)(this,"platform",{isWin:g.includes("Win"),isMac:g.includes("Mac")})}#e(g){g.altKey&&this.buffer.push("alt"),g.ctrlKey&&this.buffer.push("ctrl"),g.metaKey&&this.buffer.push("meta"),g.shiftKey&&this.buffer.push("shift"),this.buffer.push(g.key);let F=this.buffer.join("+");return this.buffer.length=0,F}exec(g,F){if(!this.allKeys.has(F.key))return;let b=this.callbacks.get(this.#e(F));b&&(b.bind(g)(),F.stopPropagation(),F.preventDefault())}}e.KeyboardManager=u;class p{#e=null;copy(g){g&&(Array.isArray(g)?this.#e=g.map(F=>F.serialize()):this.#e=[g.serialize()],this.#e=this.#e.filter(F=>!!F),this.#e.length===0&&(this.#e=null))}paste(){return this.#e}isEmpty(){return this.#e===null}destroy(){this.#e=null}}class d{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){let g=new Map([["CanvasText",null],["Canvas",null]]);return(0,r.getColorValues)(g),(0,i.shadow)(this,"_colors",g)}convert(g){let F=(0,r.getRGB)(g);if(!window.matchMedia("(forced-colors: active)").matches)return F;for(let[b,R]of this._colors)if(R.every((P,L)=>P===F[L]))return d._colorsMapping.get(b);return F}getHexCode(g){let F=this._colors.get(g);return F?i.Util.makeHexColor(...F):g}}e.ColorManager=d;class h{#e=null;#t=new Map;#r=new Map;#n=new p;#o=new c;#u=0;#a=null;#i=null;#d=new l;#l=!1;#c=i.AnnotationEditorType.NONE;#s=new Set;#g=this.keydown.bind(this);#m=this.onEditingAction.bind(this);#_=this.onPageChanging.bind(this);#y={isEditing:!1,isEmpty:!0,hasEmptyClipboard:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#w=null;static _keyboardManager=new u([[["ctrl+a","mac+meta+a"],h.prototype.selectAll],[["ctrl+c","mac+meta+c"],h.prototype.copy],[["ctrl+v","mac+meta+v"],h.prototype.paste],[["ctrl+x","mac+meta+x"],h.prototype.cut],[["ctrl+z","mac+meta+z"],h.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],h.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],h.prototype.delete],[["Escape","mac+Escape"],h.prototype.unselectAll]]);constructor(g,F){this.#w=g,this.#i=F,this.#i._on("editingaction",this.#m),this.#i._on("pagechanging",this.#_)}destroy(){this.#A(),this.#i._off("editingaction",this.#m),this.#i._off("pagechanging",this.#_);for(let g of this.#r.values())g.destroy();this.#r.clear(),this.#t.clear(),this.#e=null,this.#s.clear(),this.#n.destroy(),this.#o.destroy()}onPageChanging({pageNumber:g}){this.#u=g-1}focusMainContainer(){this.#w.focus()}#T(){this.#w.addEventListener("keydown",this.#g)}#A(){this.#w.removeEventListener("keydown",this.#g)}keydown(g){this.getActive()?.shouldGetKeyboardEvents()||h._keyboardManager.exec(this,g)}onEditingAction(g){["undo","redo","cut","copy","paste","delete","selectAll"].includes(g.name)&&this[g.name]()}#p(g){Object.entries(g).some(([b,R])=>this.#y[b]!==R)&&this.#i.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#y,g)})}#F(g){this.#i.dispatch("annotationeditorparamschanged",{source:this,details:g})}setEditingState(g){g?(this.#T(),this.#p({isEditing:this.#c!==i.AnnotationEditorType.NONE,isEmpty:this.#f(),hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:this.#o.hasSomethingToRedo(),hasSelectedEditor:!1,hasEmptyClipboard:this.#n.isEmpty()})):(this.#A(),this.#p({isEditing:!1}))}registerEditorTypes(g){this.#a=g;for(let F of this.#a)this.#F(F.defaultPropertiesToUpdate)}getId(){return this.#d.getId()}addLayer(g){this.#r.set(g.pageIndex,g),this.#l?g.enable():g.disable()}removeLayer(g){this.#r.delete(g.pageIndex)}updateMode(g){if(this.#c=g,g===i.AnnotationEditorType.NONE)this.setEditingState(!1),this.#h();else{this.setEditingState(!0),this.#E();for(let F of this.#r.values())F.updateMode(g)}}updateToolbar(g){g!==this.#c&&this.#i.dispatch("switchannotationeditormode",{source:this,mode:g})}updateParams(g,F){for(let b of this.#s)b.updateParams(g,F);for(let b of this.#a)b.updateDefaultParams(g,F)}#E(){if(!this.#l){this.#l=!0;for(let g of this.#r.values())g.enable()}}#h(){if(this.unselectAll(),this.#l){this.#l=!1;for(let g of this.#r.values())g.disable()}}getEditors(g){let F=[];for(let b of this.#t.values())b.pageIndex===g&&F.push(b);return F}getEditor(g){return this.#t.get(g)}addEditor(g){this.#t.set(g.id,g)}removeEditor(g){this.#t.delete(g.id),this.unselect(g)}#v(g){let F=this.#r.get(g.pageIndex);F?F.addOrRebuild(g):this.addEditor(g)}setActiveEditor(g){this.#e!==g&&(this.#e=g,g&&this.#F(g.propertiesToUpdate))}toggleSelected(g){if(this.#s.has(g)){this.#s.delete(g),g.unselect(),this.#p({hasSelectedEditor:this.hasSelection});return}this.#s.add(g),g.select(),this.#F(g.propertiesToUpdate),this.#p({hasSelectedEditor:!0})}setSelected(g){for(let F of this.#s)F!==g&&F.unselect();this.#s.clear(),this.#s.add(g),g.select(),this.#F(g.propertiesToUpdate),this.#p({hasSelectedEditor:!0})}isSelected(g){return this.#s.has(g)}unselect(g){g.unselect(),this.#s.delete(g),this.#p({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#s.size!==0}undo(){this.#o.undo(),this.#p({hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#f()})}redo(){this.#o.redo(),this.#p({hasSomethingToUndo:!0,hasSomethingToRedo:this.#o.hasSomethingToRedo(),isEmpty:this.#f()})}addCommands(g){this.#o.add(g),this.#p({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#f()})}#f(){if(this.#t.size===0)return!0;if(this.#t.size===1)for(let g of this.#t.values())return g.isEmpty();return!1}delete(){if(this.#e&&this.#e.commitOrRemove(),!this.hasSelection)return;let g=[...this.#s],F=()=>{for(let R of g)R.remove()},b=()=>{for(let R of g)this.#v(R)};this.addCommands({cmd:F,undo:b,mustExec:!0})}copy(){if(this.#e&&this.#e.commitOrRemove(),this.hasSelection){let g=[];for(let F of this.#s)F.isEmpty()||g.push(F);if(g.length===0)return;this.#n.copy(g),this.#p({hasEmptyClipboard:!1})}}cut(){this.copy(),this.delete()}paste(){if(this.#n.isEmpty())return;this.unselectAll();let g=this.#r.get(this.#u),F=this.#n.paste().map(P=>g.deserialize(P)),b=()=>{for(let P of F)this.#v(P);this.#x(F)},R=()=>{for(let P of F)P.remove()};this.addCommands({cmd:b,undo:R,mustExec:!0})}#x(g){this.#s.clear();for(let F of g)F.isEmpty()||(this.#s.add(F),F.select());this.#p({hasSelectedEditor:!0})}selectAll(){for(let g of this.#s)g.commit();this.#x(this.#t.values())}unselectAll(){if(this.#e){this.#e.commitOrRemove();return}if(this.#x.size!==0){for(let g of this.#s)g.unselect();this.#s.clear(),this.#p({hasSelectedEditor:!1})}}isActive(g){return this.#e===g}getActive(){return this.#e}getMode(){return this.#c}}e.AnnotationEditorUIManager=h},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StatTimer=e.RenderingCancelledException=e.PixelsPerInch=e.PageViewport=e.PDFDateString=e.DOMStandardFontDataFactory=e.DOMSVGFactory=e.DOMCanvasFactory=e.DOMCMapReaderFactory=e.AnnotationPrefix=void 0,e.deprecated=v,e.getColorValues=V,e.getCurrentTransform=J,e.getCurrentTransformInverse=ce,e.getFilenameFromUrl=R,e.getPdfFilenameFromUrl=P,e.getRGB=X,e.getXfaPageViewport=B,e.isDataScheme=F,e.isPdfFile=b,e.isValidFetchUrl=S,e.loadScript=x;var i=t(9),r=t(1);let o="http://www.w3.org/2000/svg",s="pdfjs_internal_id_";e.AnnotationPrefix=s;class l{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}e.PixelsPerInch=l;class c extends i.BaseCanvasFactory{constructor({ownerDocument:Y=globalThis.document}={}){super(),this._document=Y}_createCanvas(Y,K){let se=this._document.createElement("canvas");return se.width=Y,se.height=K,se}}e.DOMCanvasFactory=c;async function u(G,Y=!1){if(S(G,document.baseURI)){let K=await fetch(G);if(!K.ok)throw new Error(K.statusText);return Y?new Uint8Array(await K.arrayBuffer()):(0,r.stringToBytes)(await K.text())}return new Promise((K,se)=>{let $=new XMLHttpRequest;$.open("GET",G,!0),Y&&($.responseType="arraybuffer"),$.onreadystatechange=()=>{if($.readyState===XMLHttpRequest.DONE){if($.status===200||$.status===0){let z;if(Y&&$.response?z=new Uint8Array($.response):!Y&&$.responseText&&(z=(0,r.stringToBytes)($.responseText)),z){K(z);return}}se(new Error($.statusText))}},$.send(null)})}class p extends i.BaseCMapReaderFactory{_fetchData(Y,K){return u(Y,this.isCompressed).then(se=>({cMapData:se,compressionType:K}))}}e.DOMCMapReaderFactory=p;class d extends i.BaseStandardFontDataFactory{_fetchData(Y){return u(Y,!0)}}e.DOMStandardFontDataFactory=d;class h extends i.BaseSVGFactory{_createSVG(Y){return document.createElementNS(o,Y)}}e.DOMSVGFactory=h;class A{constructor({viewBox:Y,scale:K,rotation:se,offsetX:$=0,offsetY:z=0,dontFlip:k=!1}){this.viewBox=Y,this.scale=K,this.rotation=se,this.offsetX=$,this.offsetY=z;let T=(Y[2]+Y[0])/2,N=(Y[3]+Y[1])/2,W,m,_,C;switch(se%=360,se<0&&(se+=360),se){case 180:W=-1,m=0,_=0,C=1;break;case 90:W=0,m=1,_=1,C=0;break;case 270:W=0,m=-1,_=-1,C=0;break;case 0:W=1,m=0,_=0,C=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}k&&(_=-_,C=-C);let I,H,j,q;W===0?(I=Math.abs(N-Y[1])*K+$,H=Math.abs(T-Y[0])*K+z,j=Math.abs(Y[3]-Y[1])*K,q=Math.abs(Y[2]-Y[0])*K):(I=Math.abs(T-Y[0])*K+$,H=Math.abs(N-Y[1])*K+z,j=Math.abs(Y[2]-Y[0])*K,q=Math.abs(Y[3]-Y[1])*K),this.transform=[W*K,m*K,_*K,C*K,I-W*K*T-_*K*N,H-m*K*T-C*K*N],this.width=j,this.height=q}clone({scale:Y=this.scale,rotation:K=this.rotation,offsetX:se=this.offsetX,offsetY:$=this.offsetY,dontFlip:z=!1}={}){return new A({viewBox:this.viewBox.slice(),scale:Y,rotation:K,offsetX:se,offsetY:$,dontFlip:z})}convertToViewportPoint(Y,K){return r.Util.applyTransform([Y,K],this.transform)}convertToViewportRectangle(Y){let K=r.Util.applyTransform([Y[0],Y[1]],this.transform),se=r.Util.applyTransform([Y[2],Y[3]],this.transform);return[K[0],K[1],se[0],se[1]]}convertToPdfPoint(Y,K){return r.Util.applyInverseTransform([Y,K],this.transform)}}e.PageViewport=A;class g extends r.BaseException{constructor(Y,K){super(Y,"RenderingCancelledException"),this.type=K}}e.RenderingCancelledException=g;function F(G){let Y=G.length,K=0;for(;K<Y&&G[K].trim()==="";)K++;return G.substring(K,K+5).toLowerCase()==="data:"}function b(G){return typeof G=="string"&&/\.pdf$/i.test(G)}function R(G){let Y=G.indexOf("#"),K=G.indexOf("?"),se=Math.min(Y>0?Y:G.length,K>0?K:G.length);return G.substring(G.lastIndexOf("/",se)+1,se)}function P(G,Y="document.pdf"){if(typeof G!="string")return Y;if(F(G))return(0,r.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),Y;let K=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,se=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,$=K.exec(G),z=se.exec($[1])||se.exec($[2])||se.exec($[3]);if(z&&(z=z[0],z.includes("%")))try{z=se.exec(decodeURIComponent(z))[0]}catch{}return z||Y}class L{constructor(){this.started=Object.create(null),this.times=[]}time(Y){Y in this.started&&(0,r.warn)(`Timer is already running for ${Y}`),this.started[Y]=Date.now()}timeEnd(Y){Y in this.started||(0,r.warn)(`Timer has not been started for ${Y}`),this.times.push({name:Y,start:this.started[Y],end:Date.now()}),delete this.started[Y]}toString(){let Y=[],K=0;for(let se of this.times){let $=se.name;$.length>K&&(K=$.length)}for(let se of this.times){let $=se.end-se.start;Y.push(`${se.name.padEnd(K)} ${$}ms
`)}return Y.join("")}}e.StatTimer=L;function S(G,Y){try{let{protocol:K}=Y?new URL(G,Y):new URL(G);return K==="http:"||K==="https:"}catch{return!1}}function x(G,Y=!1){return new Promise((K,se)=>{let $=document.createElement("script");$.src=G,$.onload=function(z){Y&&$.remove(),K(z)},$.onerror=function(){se(new Error(`Cannot load script at: ${$.src}`))},(document.head||document.documentElement).append($)})}function v(G){console.log("Deprecated API usage: "+G)}let M;class O{static toDateObject(Y){if(!Y||typeof Y!="string")return null;M||(M=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));let K=M.exec(Y);if(!K)return null;let se=parseInt(K[1],10),$=parseInt(K[2],10);$=$>=1&&$<=12?$-1:0;let z=parseInt(K[3],10);z=z>=1&&z<=31?z:1;let k=parseInt(K[4],10);k=k>=0&&k<=23?k:0;let T=parseInt(K[5],10);T=T>=0&&T<=59?T:0;let N=parseInt(K[6],10);N=N>=0&&N<=59?N:0;let W=K[7]||"Z",m=parseInt(K[8],10);m=m>=0&&m<=23?m:0;let _=parseInt(K[9],10)||0;return _=_>=0&&_<=59?_:0,W==="-"?(k+=m,T+=_):W==="+"&&(k-=m,T-=_),new Date(Date.UTC(se,$,z,k,T,N))}}e.PDFDateString=O;function B(G,{scale:Y=1,rotation:K=0}){let{width:se,height:$}=G.attributes.style,z=[0,0,parseInt(se),parseInt($)];return new A({viewBox:z,scale:Y,rotation:K})}function X(G){if(G.startsWith("#")){let Y=parseInt(G.slice(1),16);return[(Y&16711680)>>16,(Y&65280)>>8,Y&255]}return G.startsWith("rgb(")?G.slice(4,-1).split(",").map(Y=>parseInt(Y)):G.startsWith("rgba(")?G.slice(5,-1).split(",").map(Y=>parseInt(Y)).slice(0,3):((0,r.warn)(`Not a valid color format: "${G}"`),[0,0,0])}function V(G){let Y=document.createElement("span");Y.style.visibility="hidden",document.body.append(Y);for(let K of G.keys()){Y.style.color=K;let se=window.getComputedStyle(Y).color;G.set(K,X(se))}Y.remove()}function J(G){let{a:Y,b:K,c:se,d:$,e:z,f:k}=G.getTransform();return[Y,K,se,$,z,k]}function ce(G){let{a:Y,b:K,c:se,d:$,e:z,f:k}=G.getTransform().invertSelf();return[Y,K,se,$,z,k]}},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseStandardFontDataFactory=e.BaseSVGFactory=e.BaseCanvasFactory=e.BaseCMapReaderFactory=void 0;var i=t(1);class r{constructor(){this.constructor===r&&(0,i.unreachable)("Cannot initialize BaseCanvasFactory.")}create(u,p){if(u<=0||p<=0)throw new Error("Invalid canvas size");let d=this._createCanvas(u,p);return{canvas:d,context:d.getContext("2d")}}reset(u,p,d){if(!u.canvas)throw new Error("Canvas is not specified");if(p<=0||d<=0)throw new Error("Invalid canvas size");u.canvas.width=p,u.canvas.height=d}destroy(u){if(!u.canvas)throw new Error("Canvas is not specified");u.canvas.width=0,u.canvas.height=0,u.canvas=null,u.context=null}_createCanvas(u,p){(0,i.unreachable)("Abstract method `_createCanvas` called.")}}e.BaseCanvasFactory=r;class o{constructor({baseUrl:u=null,isCompressed:p=!1}){this.constructor===o&&(0,i.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=u,this.isCompressed=p}async fetch({name:u}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!u)throw new Error("CMap name must be specified.");let p=this.baseUrl+u+(this.isCompressed?".bcmap":""),d=this.isCompressed?i.CMapCompressionType.BINARY:i.CMapCompressionType.NONE;return this._fetchData(p,d).catch(h=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${p}`)})}_fetchData(u,p){(0,i.unreachable)("Abstract method `_fetchData` called.")}}e.BaseCMapReaderFactory=o;class s{constructor({baseUrl:u=null}){this.constructor===s&&(0,i.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=u}async fetch({filename:u}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!u)throw new Error("Font filename must be specified.");let p=`${this.baseUrl}${u}`;return this._fetchData(p).catch(d=>{throw new Error(`Unable to load font data at: ${p}`)})}_fetchData(u){(0,i.unreachable)("Abstract method `_fetchData` called.")}}e.BaseStandardFontDataFactory=s;class l{constructor(){this.constructor===l&&(0,i.unreachable)("Cannot initialize BaseSVGFactory.")}create(u,p,d=!1){if(u<=0||p<=0)throw new Error("Invalid SVG dimensions");let h=this._createSVG("svg:svg");return h.setAttribute("version","1.1"),d||(h.setAttribute("width",`${u}px`),h.setAttribute("height",`${p}px`)),h.setAttribute("preserveAspectRatio","none"),h.setAttribute("viewBox",`0 0 ${u} ${p}`),h}createElement(u){if(typeof u!="string")throw new Error("Invalid SVG element type");return this._createSVG(u)}_createSVG(u){(0,i.unreachable)("Abstract method `_createSVG` called.")}}e.BaseSVGFactory=l},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MurmurHash3_64=void 0;var i=t(1);let r=3285377520,o=4294901760,s=65535;class l{constructor(u){this.h1=u?u&4294967295:r,this.h2=u?u&4294967295:r}update(u){let p,d;if(typeof u=="string"){p=new Uint8Array(u.length*2),d=0;for(let M=0,O=u.length;M<O;M++){let B=u.charCodeAt(M);B<=255?p[d++]=B:(p[d++]=B>>>8,p[d++]=B&255)}}else if((0,i.isArrayBuffer)(u))p=u.slice(),d=p.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");let h=d>>2,A=d-h*4,g=new Uint32Array(p.buffer,0,h),F=0,b=0,R=this.h1,P=this.h2,L=3432918353,S=461845907,x=L&s,v=S&s;for(let M=0;M<h;M++)M&1?(F=g[M],F=F*L&o|F*x&s,F=F<<15|F>>>17,F=F*S&o|F*v&s,R^=F,R=R<<13|R>>>19,R=R*5+3864292196):(b=g[M],b=b*L&o|b*x&s,b=b<<15|b>>>17,b=b*S&o|b*v&s,P^=b,P=P<<13|P>>>19,P=P*5+3864292196);switch(F=0,A){case 3:F^=p[h*4+2]<<16;case 2:F^=p[h*4+1]<<8;case 1:F^=p[h*4],F=F*L&o|F*x&s,F=F<<15|F>>>17,F=F*S&o|F*v&s,h&1?R^=F:P^=F}this.h1=R,this.h2=P}hexdigest(){let u=this.h1,p=this.h2;u^=p>>>1,u=u*3981806797&o|u*36045&s,p=p*4283543511&o|((p<<16|u>>>16)*2950163797&o)>>>16,u^=p>>>1,u=u*444984403&o|u*60499&s,p=p*3301882366&o|((p<<16|u>>>16)*3120437893&o)>>>16,u^=p>>>1;let d=(u>>>0).toString(16),h=(p>>>0).toString(16);return d.padStart(8,"0")+h.padStart(8,"0")}}e.MurmurHash3_64=l},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FontLoader=e.FontFaceObject=void 0;var i=t(1);class r{constructor({docId:c,onUnsupportedFeature:u,ownerDocument:p=globalThis.document,styleElement:d=null}){this.constructor===r&&(0,i.unreachable)("Cannot initialize BaseFontLoader."),this.docId=c,this._onUnsupportedFeature=u,this._document=p,this.nativeFontFaces=[],this.styleElement=null}addNativeFontFace(c){this.nativeFontFaces.push(c),this._document.fonts.add(c)}insertRule(c){let u=this.styleElement;u||(u=this.styleElement=this._document.createElement("style"),u.id=`PDFJS_FONT_STYLE_TAG_${this.docId}`,this._document.documentElement.getElementsByTagName("head")[0].append(u));let p=u.sheet;p.insertRule(c,p.cssRules.length)}clear(){for(let c of this.nativeFontFaces)this._document.fonts.delete(c);this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(c){if(c.attached||c.missingFile)return;if(c.attached=!0,this.isFontLoadingAPISupported){let p=c.createNativeFontFace();if(p){this.addNativeFontFace(p);try{await p.loaded}catch(d){throw this._onUnsupportedFeature({featureId:i.UNSUPPORTED_FEATURES.errorFontLoadNative}),(0,i.warn)(`Failed to load font '${p.family}': '${d}'.`),c.disableFontFace=!0,d}}return}let u=c.createFontFaceRule();if(u){if(this.insertRule(u),this.isSyncFontLoadingSupported)return;await new Promise(p=>{let d=this._queueLoadingCallback(p);this._prepareFontLoadEvent([u],[c],d)})}}_queueLoadingCallback(c){(0,i.unreachable)("Abstract method `_queueLoadingCallback`.")}get isFontLoadingAPISupported(){let c=!!this._document?.fonts;return(0,i.shadow)(this,"isFontLoadingAPISupported",c)}get isSyncFontLoadingSupported(){(0,i.unreachable)("Abstract method `isSyncFontLoadingSupported`.")}get _loadTestFont(){(0,i.unreachable)("Abstract method `_loadTestFont`.")}_prepareFontLoadEvent(c,u,p){(0,i.unreachable)("Abstract method `_prepareFontLoadEvent`.")}}let o;e.FontLoader=o,e.FontLoader=o=class extends r{constructor(c){super(c),this.loadingContext={requests:[],nextRequestId:0},this.loadTestFontId=0}get isSyncFontLoadingSupported(){let c=!1;return(typeof navigator>"u"||/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(navigator.userAgent)?.[1]>=14)&&(c=!0),(0,i.shadow)(this,"isSyncFontLoadingSupported",c)}_queueLoadingCallback(c){function u(){for((0,i.assert)(!d.done,"completeRequest() cannot be called twice."),d.done=!0;p.requests.length>0&&p.requests[0].done;){let h=p.requests.shift();setTimeout(h.callback,0)}}let p=this.loadingContext,d={id:`pdfjs-font-loading-${p.nextRequestId++}`,done:!1,complete:u,callback:c};return p.requests.push(d),d}get _loadTestFont(){let c=function(){return atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==")};return(0,i.shadow)(this,"_loadTestFont",c())}_prepareFontLoadEvent(c,u,p){function d(ce,G){return ce.charCodeAt(G)<<24|ce.charCodeAt(G+1)<<16|ce.charCodeAt(G+2)<<8|ce.charCodeAt(G+3)&255}function h(ce,G,Y,K){let se=ce.substring(0,G),$=ce.substring(G+Y);return se+K+$}let A,g,F=this._document.createElement("canvas");F.width=1,F.height=1;let b=F.getContext("2d"),R=0;function P(ce,G){if(R++,R>30){(0,i.warn)("Load test font never loaded."),G();return}if(b.font="30px "+ce,b.fillText(".",0,20),b.getImageData(0,0,1,1).data[3]>0){G();return}setTimeout(P.bind(null,ce,G))}let L=`lt${Date.now()}${this.loadTestFontId++}`,S=this._loadTestFont;S=h(S,976,L.length,L);let v=16,M=1482184792,O=d(S,v);for(A=0,g=L.length-3;A<g;A+=4)O=O-M+d(L,A)|0;A<L.length&&(O=O-M+d(L+"XXX",A)|0),S=h(S,v,4,(0,i.string32)(O));let B=`url(data:font/opentype;base64,${btoa(S)});`,X=`@font-face {font-family:"${L}";src:${B}}`;this.insertRule(X);let V=[];for(let ce of u)V.push(ce.loadedName);V.push(L);let J=this._document.createElement("div");J.style.visibility="hidden",J.style.width=J.style.height="10px",J.style.position="absolute",J.style.top=J.style.left="0px";for(let ce of V){let G=this._document.createElement("span");G.textContent="Hi",G.style.fontFamily=ce,J.append(G)}this._document.body.append(J),P(L,()=>{J.remove(),p.complete()})}};class s{constructor(c,{isEvalSupported:u=!0,disableFontFace:p=!1,ignoreErrors:d=!1,onUnsupportedFeature:h,fontRegistry:A=null}){this.compiledGlyphs=Object.create(null);for(let g in c)this[g]=c[g];this.isEvalSupported=u!==!1,this.disableFontFace=p===!0,this.ignoreErrors=d===!0,this._onUnsupportedFeature=h,this.fontRegistry=A}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let c;if(!this.cssFontInfo)c=new FontFace(this.loadedName,this.data,{});else{let u={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(u.style=`oblique ${this.cssFontInfo.italicAngle}deg`),c=new FontFace(this.cssFontInfo.fontFamily,this.data,u)}return this.fontRegistry&&this.fontRegistry.registerFont(this),c}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;let c=(0,i.bytesToString)(this.data),u=`url(data:${this.mimetype};base64,${btoa(c)});`,p;if(!this.cssFontInfo)p=`@font-face {font-family:"${this.loadedName}";src:${u}}`;else{let d=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(d+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),p=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${d}src:${u}}`}return this.fontRegistry&&this.fontRegistry.registerFont(this,u),p}getPathGenerator(c,u){if(this.compiledGlyphs[u]!==void 0)return this.compiledGlyphs[u];let p;try{p=c.get(this.loadedName+"_path_"+u)}catch(d){if(!this.ignoreErrors)throw d;return this._onUnsupportedFeature({featureId:i.UNSUPPORTED_FEATURES.errorFontGetPath}),(0,i.warn)(`getPathGenerator - ignoring character: "${d}".`),this.compiledGlyphs[u]=function(h,A){}}if(this.isEvalSupported&&i.FeatureTest.isEvalSupported){let d=[];for(let h of p){let A=h.args!==void 0?h.args.join(","):"";d.push("c.",h.cmd,"(",A,`);
`)}return this.compiledGlyphs[u]=new Function("c","size",d.join(""))}return this.compiledGlyphs[u]=function(d,h){for(let A of p)A.cmd==="scale"&&(A.args=[h,-h]),d[A.cmd].apply(d,A.args)}}}e.FontFaceObject=s},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasGraphics=void 0;var i=t(8),r=t(1),o=t(13),s=t(14),l=t(3);let c=16,u=100,p=4096,d=15,h=10,A=l.isNodeJS&&typeof Path2D>"u"?-1:1e3,g=16;function F(z,k){if(z._removeMirroring)throw new Error("Context is already forwarding operations.");z.__originalSave=z.save,z.__originalRestore=z.restore,z.__originalRotate=z.rotate,z.__originalScale=z.scale,z.__originalTranslate=z.translate,z.__originalTransform=z.transform,z.__originalSetTransform=z.setTransform,z.__originalResetTransform=z.resetTransform,z.__originalClip=z.clip,z.__originalMoveTo=z.moveTo,z.__originalLineTo=z.lineTo,z.__originalBezierCurveTo=z.bezierCurveTo,z.__originalRect=z.rect,z.__originalClosePath=z.closePath,z.__originalBeginPath=z.beginPath,z._removeMirroring=()=>{z.save=z.__originalSave,z.restore=z.__originalRestore,z.rotate=z.__originalRotate,z.scale=z.__originalScale,z.translate=z.__originalTranslate,z.transform=z.__originalTransform,z.setTransform=z.__originalSetTransform,z.resetTransform=z.__originalResetTransform,z.clip=z.__originalClip,z.moveTo=z.__originalMoveTo,z.lineTo=z.__originalLineTo,z.bezierCurveTo=z.__originalBezierCurveTo,z.rect=z.__originalRect,z.closePath=z.__originalClosePath,z.beginPath=z.__originalBeginPath,delete z._removeMirroring},z.save=function(){k.save(),this.__originalSave()},z.restore=function(){k.restore(),this.__originalRestore()},z.translate=function(N,W){k.translate(N,W),this.__originalTranslate(N,W)},z.scale=function(N,W){k.scale(N,W),this.__originalScale(N,W)},z.transform=function(N,W,m,_,C,I){k.transform(N,W,m,_,C,I),this.__originalTransform(N,W,m,_,C,I)},z.setTransform=function(N,W,m,_,C,I){k.setTransform(N,W,m,_,C,I),this.__originalSetTransform(N,W,m,_,C,I)},z.resetTransform=function(){k.resetTransform(),this.__originalResetTransform()},z.rotate=function(N){k.rotate(N),this.__originalRotate(N)},z.clip=function(N){k.clip(N),this.__originalClip(N)},z.moveTo=function(T,N){k.moveTo(T,N),this.__originalMoveTo(T,N)},z.lineTo=function(T,N){k.lineTo(T,N),this.__originalLineTo(T,N)},z.bezierCurveTo=function(T,N,W,m,_,C){k.bezierCurveTo(T,N,W,m,_,C),this.__originalBezierCurveTo(T,N,W,m,_,C)},z.rect=function(T,N,W,m){k.rect(T,N,W,m),this.__originalRect(T,N,W,m)},z.closePath=function(){k.closePath(),this.__originalClosePath()},z.beginPath=function(){k.beginPath(),this.__originalBeginPath()}}class b{constructor(k){this.canvasFactory=k,this.cache=Object.create(null)}getCanvas(k,T,N){let W;return this.cache[k]!==void 0?(W=this.cache[k],this.canvasFactory.reset(W,T,N)):(W=this.canvasFactory.create(T,N),this.cache[k]=W),W}delete(k){delete this.cache[k]}clear(){for(let k in this.cache){let T=this.cache[k];this.canvasFactory.destroy(T),delete this.cache[k]}}}function R(z,k,T,N,W,m,_,C,I,H){let[j,q,Z,ae,ee,ue]=(0,i.getCurrentTransform)(z);if(q===0&&Z===0){let ke=_*j+ee,Me=Math.round(ke),Ce=C*ae+ue,Le=Math.round(Ce),Fe=(_+I)*j+ee,jt=Math.abs(Math.round(Fe)-Me)||1,xn=(C+H)*ae+ue,ze=Math.abs(Math.round(xn)-Le)||1;return z.setTransform(Math.sign(j),0,0,Math.sign(ae),Me,Le),z.drawImage(k,T,N,W,m,0,0,jt,ze),z.setTransform(j,q,Z,ae,ee,ue),[jt,ze]}if(j===0&&ae===0){let ke=C*Z+ee,Me=Math.round(ke),Ce=_*q+ue,Le=Math.round(Ce),Fe=(C+H)*Z+ee,jt=Math.abs(Math.round(Fe)-Me)||1,xn=(_+I)*q+ue,ze=Math.abs(Math.round(xn)-Le)||1;return z.setTransform(0,Math.sign(q),Math.sign(Z),0,Me,Le),z.drawImage(k,T,N,W,m,0,0,ze,jt),z.setTransform(j,q,Z,ae,ee,ue),[ze,jt]}z.drawImage(k,T,N,W,m,_,C,I,H);let _e=Math.hypot(j,q),he=Math.hypot(Z,ae);return[_e*I,he*H]}function P(z){let{width:k,height:T}=z;if(k>A||T>A)return null;let N=1e3,W=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),m=k+1,_=new Uint8Array(m*(T+1)),C,I,H,j=k+7&-8,q=new Uint8Array(j*T),Z=0;for(let he of z.data){let ke=128;for(;ke>0;)q[Z++]=he&ke?0:255,ke>>=1}let ae=0;for(Z=0,q[Z]!==0&&(_[0]=1,++ae),I=1;I<k;I++)q[Z]!==q[Z+1]&&(_[I]=q[Z]?2:1,++ae),Z++;for(q[Z]!==0&&(_[I]=2,++ae),C=1;C<T;C++){Z=C*j,H=C*m,q[Z-j]!==q[Z]&&(_[H]=q[Z]?1:8,++ae);let he=(q[Z]?4:0)+(q[Z-j]?8:0);for(I=1;I<k;I++)he=(he>>2)+(q[Z+1]?4:0)+(q[Z-j+1]?8:0),W[he]&&(_[H+I]=W[he],++ae),Z++;if(q[Z-j]!==q[Z]&&(_[H+I]=q[Z]?2:4,++ae),ae>N)return null}for(Z=j*(T-1),H=C*m,q[Z]!==0&&(_[H]=8,++ae),I=1;I<k;I++)q[Z]!==q[Z+1]&&(_[H+I]=q[Z]?4:8,++ae),Z++;if(q[Z]!==0&&(_[H+I]=4,++ae),ae>N)return null;let ee=new Int32Array([0,m,-1,0,-m,0,0,0,1]),ue=new Path2D;for(C=0;ae&&C<=T;C++){let he=C*m,ke=he+k;for(;he<ke&&!_[he];)he++;if(he===ke)continue;ue.moveTo(he%m,C);let Me=he,Ce=_[he];do{let Le=ee[Ce];do he+=Le;while(!_[he]);let Fe=_[he];Fe!==5&&Fe!==10?(Ce=Fe,_[he]=0):(Ce=Fe&51*Ce>>4,_[he]&=Ce>>2|Ce<<2),ue.lineTo(he%m,he/m|0),_[he]||--ae}while(Me!==he);--C}return q=null,_=null,function(he){he.save(),he.scale(1/k,-1/T),he.translate(0,-T),he.fill(ue),he.beginPath(),he.restore()}}class L{constructor(k,T){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=r.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=r.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps=null,this.startNewPathAndClipBox([0,0,k,T])}clone(){let k=Object.create(this);return k.clipBox=this.clipBox.slice(),k}setCurrentPoint(k,T){this.x=k,this.y=T}updatePathMinMax(k,T,N){[T,N]=r.Util.applyTransform([T,N],k),this.minX=Math.min(this.minX,T),this.minY=Math.min(this.minY,N),this.maxX=Math.max(this.maxX,T),this.maxY=Math.max(this.maxY,N)}updateRectMinMax(k,T){let N=r.Util.applyTransform(T,k),W=r.Util.applyTransform(T.slice(2),k);this.minX=Math.min(this.minX,N[0],W[0]),this.minY=Math.min(this.minY,N[1],W[1]),this.maxX=Math.max(this.maxX,N[0],W[0]),this.maxY=Math.max(this.maxY,N[1],W[1])}updateScalingPathMinMax(k,T){r.Util.scaleMinMax(k,T),this.minX=Math.min(this.minX,T[0]),this.maxX=Math.max(this.maxX,T[1]),this.minY=Math.min(this.minY,T[2]),this.maxY=Math.max(this.maxY,T[3])}updateCurvePathMinMax(k,T,N,W,m,_,C,I,H,j){let q=r.Util.bezierBoundingBox(T,N,W,m,_,C,I,H);if(j){j[0]=Math.min(j[0],q[0],q[2]),j[1]=Math.max(j[1],q[0],q[2]),j[2]=Math.min(j[2],q[1],q[3]),j[3]=Math.max(j[3],q[1],q[3]);return}this.updateRectMinMax(k,q)}getPathBoundingBox(k=o.PathType.FILL,T=null){let N=[this.minX,this.minY,this.maxX,this.maxY];if(k===o.PathType.STROKE){T||(0,r.unreachable)("Stroke bounding box must include transform.");let W=r.Util.singularValueDecompose2dScale(T),m=W[0]*this.lineWidth/2,_=W[1]*this.lineWidth/2;N[0]-=m,N[1]-=_,N[2]+=m,N[3]+=_}return N}updateClipFromPath(){let k=r.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(k||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(k){this.clipBox=k,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(k=o.PathType.FILL,T=null){return r.Util.intersect(this.clipBox,this.getPathBoundingBox(k,T))}}function S(z,k,T=null){if(typeof ImageData<"u"&&k instanceof ImageData){z.putImageData(k,0,0);return}let N=k.height,W=k.width,m=N%g,_=(N-m)/g,C=m===0?_:_+1,I=z.createImageData(W,g),H=0,j,q=k.data,Z=I.data,ae,ee,ue,_e,he,ke,Me,Ce;if(T)switch(T.length){case 1:he=T[0],ke=T[0],Me=T[0],Ce=T[0];break;case 4:he=T[0],ke=T[1],Me=T[2],Ce=T[3];break}if(k.kind===r.ImageKind.GRAYSCALE_1BPP){let Le=q.byteLength,Fe=new Uint32Array(Z.buffer,0,Z.byteLength>>2),jt=Fe.length,xn=W+7>>3,ze=4294967295,Vt=r.FeatureTest.isLittleEndian?4278190080:255;for(Ce&&Ce[0]===255&&Ce[255]===0&&([ze,Vt]=[Vt,ze]),ae=0;ae<C;ae++){for(ue=ae<_?g:m,j=0,ee=0;ee<ue;ee++){let ot=Le-H,Zn=0,Nn=ot>xn?W:ot*8-7,Yr=Nn&-8,wn=0,rn=0;for(;Zn<Yr;Zn+=8)rn=q[H++],Fe[j++]=rn&128?ze:Vt,Fe[j++]=rn&64?ze:Vt,Fe[j++]=rn&32?ze:Vt,Fe[j++]=rn&16?ze:Vt,Fe[j++]=rn&8?ze:Vt,Fe[j++]=rn&4?ze:Vt,Fe[j++]=rn&2?ze:Vt,Fe[j++]=rn&1?ze:Vt;for(;Zn<Nn;Zn++)wn===0&&(rn=q[H++],wn=128),Fe[j++]=rn&wn?ze:Vt,wn>>=1}for(;j<jt;)Fe[j++]=0;z.putImageData(I,0,ae*g)}}else if(k.kind===r.ImageKind.RGBA_32BPP){let Le=!!(he||ke||Me);for(ee=0,_e=W*g*4,ae=0;ae<_;ae++){if(Z.set(q.subarray(H,H+_e)),H+=_e,Le)for(let Fe=0;Fe<_e;Fe+=4)he&&(Z[Fe+0]=he[Z[Fe+0]]),ke&&(Z[Fe+1]=ke[Z[Fe+1]]),Me&&(Z[Fe+2]=Me[Z[Fe+2]]);z.putImageData(I,0,ee),ee+=g}if(ae<C){if(_e=W*m*4,Z.set(q.subarray(H,H+_e)),Le)for(let Fe=0;Fe<_e;Fe+=4)he&&(Z[Fe+0]=he[Z[Fe+0]]),ke&&(Z[Fe+1]=ke[Z[Fe+1]]),Me&&(Z[Fe+2]=Me[Z[Fe+2]]);z.putImageData(I,0,ee)}}else if(k.kind===r.ImageKind.RGB_24BPP){let Le=!!(he||ke||Me);for(ue=g,_e=W*ue,ae=0;ae<C;ae++){for(ae>=_&&(ue=m,_e=W*ue),j=0,ee=_e;ee--;)Z[j++]=q[H++],Z[j++]=q[H++],Z[j++]=q[H++],Z[j++]=255;if(Le)for(let Fe=0;Fe<j;Fe+=4)he&&(Z[Fe+0]=he[Z[Fe+0]]),ke&&(Z[Fe+1]=ke[Z[Fe+1]]),Me&&(Z[Fe+2]=Me[Z[Fe+2]]);z.putImageData(I,0,ae*g)}}else throw new Error(`bad image kind: ${k.kind}`)}function x(z,k){if(k.bitmap){z.drawImage(k.bitmap,0,0);return}let T=k.height,N=k.width,W=T%g,m=(T-W)/g,_=W===0?m:m+1,C=z.createImageData(N,g),I=0,H=k.data,j=C.data;for(let q=0;q<_;q++){let Z=q<m?g:W;({srcPos:I}=(0,s.applyMaskImageData)({src:H,srcPos:I,dest:j,width:N,height:Z})),z.putImageData(C,0,q*g)}}function v(z,k){let T=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"];for(let N=0,W=T.length;N<W;N++){let m=T[N];z[m]!==void 0&&(k[m]=z[m])}z.setLineDash!==void 0&&(k.setLineDash(z.getLineDash()),k.lineDashOffset=z.lineDashOffset)}function M(z,k){z.strokeStyle=z.fillStyle=k||"#000000",z.fillRule="nonzero",z.globalAlpha=1,z.lineWidth=1,z.lineCap="butt",z.lineJoin="miter",z.miterLimit=10,z.globalCompositeOperation="source-over",z.font="10px sans-serif",z.setLineDash!==void 0&&(z.setLineDash([]),z.lineDashOffset=0)}function O(z,k,T,N){let W=z.length;for(let m=3;m<W;m+=4){let _=z[m];if(_===0)z[m-3]=k,z[m-2]=T,z[m-1]=N;else if(_<255){let C=255-_;z[m-3]=z[m-3]*_+k*C>>8,z[m-2]=z[m-2]*_+T*C>>8,z[m-1]=z[m-1]*_+N*C>>8}}}function B(z,k,T){let N=z.length,W=1/255;for(let m=3;m<N;m+=4){let _=T?T[z[m]]:z[m];k[m]=k[m]*_*W|0}}function X(z,k,T){let N=z.length;for(let W=3;W<N;W+=4){let m=z[W-3]*77+z[W-2]*152+z[W-1]*28;k[W]=T?k[W]*T[m>>8]>>8:k[W]*m>>16}}function V(z,k,T,N,W,m,_,C,I,H,j){let q=!!m,Z=q?m[0]:0,ae=q?m[1]:0,ee=q?m[2]:0,ue;W==="Luminosity"?ue=X:ue=B;let he=Math.min(N,Math.ceil(1048576/T));for(let ke=0;ke<N;ke+=he){let Me=Math.min(he,N-ke),Ce=z.getImageData(C-H,ke+(I-j),T,Me),Le=k.getImageData(C,ke+I,T,Me);q&&O(Ce.data,Z,ae,ee),ue(Ce.data,Le.data,_),k.putImageData(Le,C,ke+I)}}function J(z,k,T,N){let W=N[0],m=N[1],_=N[2]-W,C=N[3]-m;_===0||C===0||(V(k.context,T,_,C,k.subtype,k.backdrop,k.transferMap,W,m,k.offsetX,k.offsetY),z.save(),z.globalAlpha=1,z.globalCompositeOperation="source-over",z.setTransform(1,0,0,1,0,0),z.drawImage(T.canvas,0,0),z.restore())}function ce(z,k){let T=r.Util.singularValueDecompose2dScale(z);T[0]=Math.fround(T[0]),T[1]=Math.fround(T[1]);let N=Math.fround((globalThis.devicePixelRatio||1)*i.PixelsPerInch.PDF_TO_CSS_UNITS);return k!==void 0?k:T[0]<=N||T[1]<=N}let G=["butt","round","square"],Y=["miter","round","bevel"],K={},se={};class ${constructor(k,T,N,W,m,_,C,I){this.ctx=k,this.current=new L(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=T,this.objs=N,this.canvasFactory=W,this.imageLayer=m,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=[],this.optionalContentConfig=_,this.cachedCanvases=new b(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=C,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.backgroundColor=I?.background||null,this.foregroundColor=I?.foreground||null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(k,T=null){return typeof k=="string"?k.startsWith("g_")?this.commonObjs.get(k):this.objs.get(k):T}beginDrawing({transform:k,viewport:T,transparency:N=!1,background:W=null}){let m=this.ctx.canvas.width,_=this.ctx.canvas.height,C=W||"#ffffff";if(this.ctx.save(),this.foregroundColor&&this.backgroundColor){this.ctx.fillStyle=this.foregroundColor;let I=this.foregroundColor=this.ctx.fillStyle;this.ctx.fillStyle=this.backgroundColor;let H=this.backgroundColor=this.ctx.fillStyle,j=!0,q=C;if(this.ctx.fillStyle=C,q=this.ctx.fillStyle,j=typeof q=="string"&&/^#[0-9A-Fa-f]{6}$/.test(q),I==="#000000"&&H==="#ffffff"||I===H||!j)this.foregroundColor=this.backgroundColor=null;else{let[Z,ae,ee]=(0,i.getRGB)(q),ue=he=>(he/=255,he<=.03928?he/12.92:((he+.055)/1.055)**2.4),_e=Math.round(.2126*ue(Z)+.7152*ue(ae)+.0722*ue(ee));this.selectColor=(he,ke,Me)=>{let Ce=.2126*ue(he)+.7152*ue(ke)+.0722*ue(Me);return Math.round(Ce)===_e?H:I}}}if(this.ctx.fillStyle=this.backgroundColor||C,this.ctx.fillRect(0,0,m,_),this.ctx.restore(),N){let I=this.cachedCanvases.getCanvas("transparent",m,_);this.compositeCtx=this.ctx,this.transparentCanvas=I.canvas,this.ctx=I.context,this.ctx.save(),this.ctx.transform(...(0,i.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),M(this.ctx,this.foregroundColor),k&&(this.ctx.transform(...k),this.outputScaleX=k[0],this.outputScaleY=k[0]),this.ctx.transform(...T.transform),this.viewportScale=T.scale,this.baseTransform=(0,i.getCurrentTransform)(this.ctx),this.imageLayer&&((0,i.deprecated)("The `imageLayer` functionality will be removed in the future."),this.imageLayer.beginLayout())}executeOperatorList(k,T,N,W){let m=k.argsArray,_=k.fnArray,C=T||0,I=m.length;if(I===C)return C;let H=I-C>h&&typeof N=="function",j=H?Date.now()+d:0,q=0,Z=this.commonObjs,ae=this.objs,ee;for(;;){if(W!==void 0&&C===W.nextBreakPoint)return W.breakIt(C,N),C;if(ee=_[C],ee!==r.OPS.dependency)this[ee].apply(this,m[C]);else for(let ue of m[C]){let _e=ue.startsWith("g_")?Z:ae;if(!_e.has(ue))return _e.get(ue,N),C}if(C++,C===I)return C;if(H&&++q>h){if(Date.now()>j)return N(),C;q=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let k of this._cachedBitmapsMap.values()){for(let T of k.values())typeof HTMLCanvasElement<"u"&&T instanceof HTMLCanvasElement&&(T.width=T.height=0);k.clear()}this._cachedBitmapsMap.clear(),this.imageLayer&&this.imageLayer.endLayout()}_scaleImage(k,T){let N=k.width,W=k.height,m=Math.max(Math.hypot(T[0],T[1]),1),_=Math.max(Math.hypot(T[2],T[3]),1),C=N,I=W,H="prescale1",j,q;for(;m>2&&C>1||_>2&&I>1;){let Z=C,ae=I;m>2&&C>1&&(Z=Math.ceil(C/2),m/=C/Z),_>2&&I>1&&(ae=Math.ceil(I/2),_/=I/ae),j=this.cachedCanvases.getCanvas(H,Z,ae),q=j.context,q.clearRect(0,0,Z,ae),q.drawImage(k,0,0,C,I,0,0,Z,ae),k=j.canvas,C=Z,I=ae,H=H==="prescale1"?"prescale2":"prescale1"}return{img:k,paintWidth:C,paintHeight:I}}_createMaskCanvas(k){let T=this.ctx,{width:N,height:W}=k,m=this.current.fillColor,_=this.current.patternFill,C=(0,i.getCurrentTransform)(T),I,H,j,q;if((k.bitmap||k.data)&&k.count>1){let jt=k.bitmap||k.data.buffer,xn=C.slice(0,4);H=JSON.stringify(_?xn:[xn,m]),I=this._cachedBitmapsMap.get(jt),I||(I=new Map,this._cachedBitmapsMap.set(jt,I));let ze=I.get(H);if(ze&&!_){let Vt=Math.round(Math.min(C[0],C[2])+C[4]),ot=Math.round(Math.min(C[1],C[3])+C[5]);return{canvas:ze,offsetX:Vt,offsetY:ot}}j=ze}j||(q=this.cachedCanvases.getCanvas("maskCanvas",N,W),x(q.context,k));let Z=r.Util.transform(C,[1/N,0,0,-1/W,0,0]);Z=r.Util.transform(Z,[1,0,0,1,0,-W]);let ae=r.Util.applyTransform([0,0],Z),ee=r.Util.applyTransform([N,W],Z),ue=r.Util.normalizeRect([ae[0],ae[1],ee[0],ee[1]]),_e=Math.round(ue[2]-ue[0])||1,he=Math.round(ue[3]-ue[1])||1,ke=this.cachedCanvases.getCanvas("fillCanvas",_e,he),Me=ke.context,Ce=Math.min(ae[0],ee[0]),Le=Math.min(ae[1],ee[1]);Me.translate(-Ce,-Le),Me.transform(...Z),j||(j=this._scaleImage(q.canvas,(0,i.getCurrentTransformInverse)(Me)),j=j.img,I&&_&&I.set(H,j)),Me.imageSmoothingEnabled=ce((0,i.getCurrentTransform)(Me),k.interpolate),R(Me,j,0,0,j.width,j.height,0,0,N,W),Me.globalCompositeOperation="source-in";let Fe=r.Util.transform((0,i.getCurrentTransformInverse)(Me),[1,0,0,1,-Ce,-Le]);return Me.fillStyle=_?m.getPattern(T,this,Fe,o.PathType.FILL):m,Me.fillRect(0,0,N,W),I&&!_&&(this.cachedCanvases.delete("fillCanvas"),I.set(H,ke.canvas)),{canvas:ke.canvas,offsetX:Math.round(Ce),offsetY:Math.round(Le)}}setLineWidth(k){k!==this.current.lineWidth&&(this._cachedScaleForStroking=null),this.current.lineWidth=k,this.ctx.lineWidth=k}setLineCap(k){this.ctx.lineCap=G[k]}setLineJoin(k){this.ctx.lineJoin=Y[k]}setMiterLimit(k){this.ctx.miterLimit=k}setDash(k,T){let N=this.ctx;N.setLineDash!==void 0&&(N.setLineDash(k),N.lineDashOffset=T)}setRenderingIntent(k){}setFlatness(k){}setGState(k){for(let T=0,N=k.length;T<N;T++){let W=k[T],m=W[0],_=W[1];switch(m){case"LW":this.setLineWidth(_);break;case"LC":this.setLineCap(_);break;case"LJ":this.setLineJoin(_);break;case"ML":this.setMiterLimit(_);break;case"D":this.setDash(_[0],_[1]);break;case"RI":this.setRenderingIntent(_);break;case"FL":this.setFlatness(_);break;case"Font":this.setFont(_[0],_[1]);break;case"CA":this.current.strokeAlpha=W[1];break;case"ca":this.current.fillAlpha=W[1],this.ctx.globalAlpha=W[1];break;case"BM":this.ctx.globalCompositeOperation=_;break;case"SMask":this.current.activeSMask=_?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.current.transferMaps=_}}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let k=this.inSMaskMode;this.current.activeSMask&&!k?this.beginSMaskMode():!this.current.activeSMask&&k&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let k=this.ctx.canvas.width,T=this.ctx.canvas.height,N="smaskGroupAt"+this.groupLevel,W=this.cachedCanvases.getCanvas(N,k,T);this.suspendedCtx=this.ctx,this.ctx=W.context;let m=this.ctx;m.setTransform(...(0,i.getCurrentTransform)(this.suspendedCtx)),v(this.suspendedCtx,m),F(m,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),v(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(k){if(!this.current.activeSMask)return;k?(k[0]=Math.floor(k[0]),k[1]=Math.floor(k[1]),k[2]=Math.ceil(k[2]),k[3]=Math.ceil(k[3])):k=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let T=this.current.activeSMask,N=this.suspendedCtx;J(N,T,this.ctx,k),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(v(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let k=this.current;this.stateStack.push(k),this.current=k.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),v(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null)}transform(k,T,N,W,m,_){this.ctx.transform(k,T,N,W,m,_),this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null}constructPath(k,T,N){let W=this.ctx,m=this.current,_=m.x,C=m.y,I,H,j=(0,i.getCurrentTransform)(W),q=j[0]===0&&j[3]===0||j[1]===0&&j[2]===0,Z=q?N.slice(0):null;for(let ae=0,ee=0,ue=k.length;ae<ue;ae++)switch(k[ae]|0){case r.OPS.rectangle:_=T[ee++],C=T[ee++];let _e=T[ee++],he=T[ee++],ke=_+_e,Me=C+he;W.moveTo(_,C),_e===0||he===0?W.lineTo(ke,Me):(W.lineTo(ke,C),W.lineTo(ke,Me),W.lineTo(_,Me)),q||m.updateRectMinMax(j,[_,C,ke,Me]),W.closePath();break;case r.OPS.moveTo:_=T[ee++],C=T[ee++],W.moveTo(_,C),q||m.updatePathMinMax(j,_,C);break;case r.OPS.lineTo:_=T[ee++],C=T[ee++],W.lineTo(_,C),q||m.updatePathMinMax(j,_,C);break;case r.OPS.curveTo:I=_,H=C,_=T[ee+4],C=T[ee+5],W.bezierCurveTo(T[ee],T[ee+1],T[ee+2],T[ee+3],_,C),m.updateCurvePathMinMax(j,I,H,T[ee],T[ee+1],T[ee+2],T[ee+3],_,C,Z),ee+=6;break;case r.OPS.curveTo2:I=_,H=C,W.bezierCurveTo(_,C,T[ee],T[ee+1],T[ee+2],T[ee+3]),m.updateCurvePathMinMax(j,I,H,_,C,T[ee],T[ee+1],T[ee+2],T[ee+3],Z),_=T[ee+2],C=T[ee+3],ee+=4;break;case r.OPS.curveTo3:I=_,H=C,_=T[ee+2],C=T[ee+3],W.bezierCurveTo(T[ee],T[ee+1],_,C,_,C),m.updateCurvePathMinMax(j,I,H,T[ee],T[ee+1],_,C,_,C,Z),ee+=4;break;case r.OPS.closePath:W.closePath();break}q&&m.updateScalingPathMinMax(j,Z),m.setCurrentPoint(_,C)}closePath(){this.ctx.closePath()}stroke(k){k=typeof k<"u"?k:!0;let T=this.ctx,N=this.current.strokeColor;T.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof N=="object"&&N?.getPattern?(T.save(),T.strokeStyle=N.getPattern(T,this,(0,i.getCurrentTransformInverse)(T),o.PathType.STROKE),this.rescaleAndStroke(!1),T.restore()):this.rescaleAndStroke(!0)),k&&this.consumePath(this.current.getClippedPathBoundingBox()),T.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(k){k=typeof k<"u"?k:!0;let T=this.ctx,N=this.current.fillColor,W=this.current.patternFill,m=!1;W&&(T.save(),T.fillStyle=N.getPattern(T,this,(0,i.getCurrentTransformInverse)(T),o.PathType.FILL),m=!0);let _=this.current.getClippedPathBoundingBox();this.contentVisible&&_!==null&&(this.pendingEOFill?(T.fill("evenodd"),this.pendingEOFill=!1):T.fill()),m&&T.restore(),k&&this.consumePath(_)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=K}eoClip(){this.pendingClip=se}beginText(){this.current.textMatrix=r.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let k=this.pendingTextPaths,T=this.ctx;if(k===void 0){T.beginPath();return}T.save(),T.beginPath();for(let N of k)T.setTransform(...N.transform),T.translate(N.x,N.y),N.addToPath(T,N.fontSize);T.restore(),T.clip(),T.beginPath(),delete this.pendingTextPaths}setCharSpacing(k){this.current.charSpacing=k}setWordSpacing(k){this.current.wordSpacing=k}setHScale(k){this.current.textHScale=k/100}setLeading(k){this.current.leading=-k}setFont(k,T){let N=this.commonObjs.get(k),W=this.current;if(!N)throw new Error(`Can't find font for ${k}`);if(W.fontMatrix=N.fontMatrix||r.FONT_IDENTITY_MATRIX,(W.fontMatrix[0]===0||W.fontMatrix[3]===0)&&(0,r.warn)("Invalid font matrix for font "+k),T<0?(T=-T,W.fontDirection=-1):W.fontDirection=1,this.current.font=N,this.current.fontSize=T,N.isType3Font)return;let m=N.loadedName||"sans-serif",_="normal";N.black?_="900":N.bold&&(_="bold");let C=N.italic?"italic":"normal",I=`"${m}", ${N.fallbackName}`,H=T;T<c?H=c:T>u&&(H=u),this.current.fontSizeScale=T/H,this.ctx.font=`${C} ${_} ${H}px ${I}`}setTextRenderingMode(k){this.current.textRenderingMode=k}setTextRise(k){this.current.textRise=k}moveText(k,T){this.current.x=this.current.lineX+=k,this.current.y=this.current.lineY+=T}setLeadingMoveText(k,T){this.setLeading(-T),this.moveText(k,T)}setTextMatrix(k,T,N,W,m,_){this.current.textMatrix=[k,T,N,W,m,_],this.current.textMatrixScale=Math.hypot(k,T),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(k,T,N,W){let m=this.ctx,_=this.current,C=_.font,I=_.textRenderingMode,H=_.fontSize/_.fontSizeScale,j=I&r.TextRenderingMode.FILL_STROKE_MASK,q=!!(I&r.TextRenderingMode.ADD_TO_PATH_FLAG),Z=_.patternFill&&!C.missingFile,ae;(C.disableFontFace||q||Z)&&(ae=C.getPathGenerator(this.commonObjs,k)),C.disableFontFace||Z?(m.save(),m.translate(T,N),m.beginPath(),ae(m,H),W&&m.setTransform(...W),(j===r.TextRenderingMode.FILL||j===r.TextRenderingMode.FILL_STROKE)&&m.fill(),(j===r.TextRenderingMode.STROKE||j===r.TextRenderingMode.FILL_STROKE)&&m.stroke(),m.restore()):((j===r.TextRenderingMode.FILL||j===r.TextRenderingMode.FILL_STROKE)&&m.fillText(k,T,N),(j===r.TextRenderingMode.STROKE||j===r.TextRenderingMode.FILL_STROKE)&&m.strokeText(k,T,N)),q&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,i.getCurrentTransform)(m),x:T,y:N,fontSize:H,addToPath:ae})}get isFontSubpixelAAEnabled(){let{context:k}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);k.scale(1.5,1),k.fillText("I",0,10);let T=k.getImageData(0,0,10,10).data,N=!1;for(let W=3;W<T.length;W+=4)if(T[W]>0&&T[W]<255){N=!0;break}return(0,r.shadow)(this,"isFontSubpixelAAEnabled",N)}showText(k){let T=this.current,N=T.font;if(N.isType3Font)return this.showType3Text(k);let W=T.fontSize;if(W===0)return;let m=this.ctx,_=T.fontSizeScale,C=T.charSpacing,I=T.wordSpacing,H=T.fontDirection,j=T.textHScale*H,q=k.length,Z=N.vertical,ae=Z?1:-1,ee=N.defaultVMetrics,ue=W*T.fontMatrix[0],_e=T.textRenderingMode===r.TextRenderingMode.FILL&&!N.disableFontFace&&!T.patternFill;m.save(),m.transform(...T.textMatrix),m.translate(T.x,T.y+T.textRise),H>0?m.scale(j,-1):m.scale(j,1);let he;if(T.patternFill){m.save();let Fe=T.fillColor.getPattern(m,this,(0,i.getCurrentTransformInverse)(m),o.PathType.FILL);he=(0,i.getCurrentTransform)(m),m.restore(),m.fillStyle=Fe}let ke=T.lineWidth,Me=T.textMatrixScale;if(Me===0||ke===0){let Fe=T.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;(Fe===r.TextRenderingMode.STROKE||Fe===r.TextRenderingMode.FILL_STROKE)&&(ke=this.getSinglePixelWidth())}else ke/=Me;_!==1&&(m.scale(_,_),ke/=_),m.lineWidth=ke;let Ce=0,Le;for(Le=0;Le<q;++Le){let Fe=k[Le];if(typeof Fe=="number"){Ce+=ae*Fe*W/1e3;continue}let jt=!1,xn=(Fe.isSpace?I:0)+C,ze=Fe.fontChar,Vt=Fe.accent,ot,Zn,Nn=Fe.width;if(Z){let wn=Fe.vmetric||ee,rn=-(Fe.vmetric?wn[1]:Nn*.5)*ue,vr=wn[2]*ue;Nn=wn?-wn[0]:Nn,ot=rn/_,Zn=(Ce+vr)/_}else ot=Ce/_,Zn=0;if(N.remeasure&&Nn>0){let wn=m.measureText(ze).width*1e3/W*_;if(Nn<wn&&this.isFontSubpixelAAEnabled){let rn=Nn/wn;jt=!0,m.save(),m.scale(rn,1),ot/=rn}else Nn!==wn&&(ot+=(Nn-wn)/2e3*W/_)}if(this.contentVisible&&(Fe.isInFont||N.missingFile)){if(_e&&!Vt)m.fillText(ze,ot,Zn);else if(this.paintChar(ze,ot,Zn,he),Vt){let wn=ot+W*Vt.offset.x/_,rn=Zn-W*Vt.offset.y/_;this.paintChar(Vt.fontChar,wn,rn,he)}}let Yr;Z?Yr=Nn*ue-xn*H:Yr=Nn*ue+xn*H,Ce+=Yr,jt&&m.restore()}Z?T.y-=Ce:T.x+=Ce*j,m.restore(),this.compose()}showType3Text(k){let T=this.ctx,N=this.current,W=N.font,m=N.fontSize,_=N.fontDirection,C=W.vertical?1:-1,I=N.charSpacing,H=N.wordSpacing,j=N.textHScale*_,q=N.fontMatrix||r.FONT_IDENTITY_MATRIX,Z=k.length,ae=N.textRenderingMode===r.TextRenderingMode.INVISIBLE,ee,ue,_e,he;if(!(ae||m===0)){for(this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,T.save(),T.transform(...N.textMatrix),T.translate(N.x,N.y),T.scale(j,_),ee=0;ee<Z;++ee){if(ue=k[ee],typeof ue=="number"){he=C*ue*m/1e3,this.ctx.translate(he,0),N.x+=he*j;continue}let ke=(ue.isSpace?H:0)+I,Me=W.charProcOperatorList[ue.operatorListId];if(!Me){(0,r.warn)(`Type3 character "${ue.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=ue,this.save(),T.scale(m,m),T.transform(...q),this.executeOperatorList(Me),this.restore()),_e=r.Util.applyTransform([ue.width,0],q)[0]*m+ke,T.translate(_e,0),N.x+=_e*j}T.restore(),this.processingType3=null}}setCharWidth(k,T){}setCharWidthAndBounds(k,T,N,W,m,_){this.ctx.rect(N,W,m-N,_-W),this.ctx.clip(),this.endPath()}getColorN_Pattern(k){let T;if(k[0]==="TilingPattern"){let N=k[1],W=this.baseTransform||(0,i.getCurrentTransform)(this.ctx),m={createCanvasGraphics:_=>new $(_,this.commonObjs,this.objs,this.canvasFactory)};T=new o.TilingPattern(k,N,this.ctx,m,W)}else T=this._getPattern(k[1],k[2]);return T}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(k,T,N){let W=this.selectColor?.(k,T,N)||r.Util.makeHexColor(k,T,N);this.ctx.strokeStyle=W,this.current.strokeColor=W}setFillRGBColor(k,T,N){let W=this.selectColor?.(k,T,N)||r.Util.makeHexColor(k,T,N);this.ctx.fillStyle=W,this.current.fillColor=W,this.current.patternFill=!1}_getPattern(k,T=null){let N;return this.cachedPatterns.has(k)?N=this.cachedPatterns.get(k):(N=(0,o.getShadingPattern)(this.objs.get(k)),this.cachedPatterns.set(k,N)),T&&(N.matrix=T),N}shadingFill(k){if(!this.contentVisible)return;let T=this.ctx;this.save();let N=this._getPattern(k);T.fillStyle=N.getPattern(T,this,(0,i.getCurrentTransformInverse)(T),o.PathType.SHADING);let W=(0,i.getCurrentTransformInverse)(T);if(W){let m=T.canvas,_=m.width,C=m.height,I=r.Util.applyTransform([0,0],W),H=r.Util.applyTransform([0,C],W),j=r.Util.applyTransform([_,0],W),q=r.Util.applyTransform([_,C],W),Z=Math.min(I[0],H[0],j[0],q[0]),ae=Math.min(I[1],H[1],j[1],q[1]),ee=Math.max(I[0],H[0],j[0],q[0]),ue=Math.max(I[1],H[1],j[1],q[1]);this.ctx.fillRect(Z,ae,ee-Z,ue-ae)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,r.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,r.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(k,T){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(k)&&k.length===6&&this.transform(...k),this.baseTransform=(0,i.getCurrentTransform)(this.ctx),T)){let N=T[2]-T[0],W=T[3]-T[1];this.ctx.rect(T[0],T[1],N,W),this.current.updateRectMinMax((0,i.getCurrentTransform)(this.ctx),T),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(k){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let T=this.ctx;k.isolated||(0,r.info)("TODO: Support non-isolated groups."),k.knockout&&(0,r.warn)("Knockout groups not supported.");let N=(0,i.getCurrentTransform)(T);if(k.matrix&&T.transform(...k.matrix),!k.bbox)throw new Error("Bounding box is required.");let W=r.Util.getAxialAlignedBoundingBox(k.bbox,(0,i.getCurrentTransform)(T)),m=[0,0,T.canvas.width,T.canvas.height];W=r.Util.intersect(W,m)||[0,0,0,0];let _=Math.floor(W[0]),C=Math.floor(W[1]),I=Math.max(Math.ceil(W[2])-_,1),H=Math.max(Math.ceil(W[3])-C,1),j=1,q=1;I>p&&(j=I/p,I=p),H>p&&(q=H/p,H=p),this.current.startNewPathAndClipBox([0,0,I,H]);let Z="groupAt"+this.groupLevel;k.smask&&(Z+="_smask_"+this.smaskCounter++%2);let ae=this.cachedCanvases.getCanvas(Z,I,H),ee=ae.context;ee.scale(1/j,1/q),ee.translate(-_,-C),ee.transform(...N),k.smask?this.smaskStack.push({canvas:ae.canvas,context:ee,offsetX:_,offsetY:C,scaleX:j,scaleY:q,subtype:k.smask.subtype,backdrop:k.smask.backdrop,transferMap:k.smask.transferMap||null,startTransformInverse:null}):(T.setTransform(1,0,0,1,0,0),T.translate(_,C),T.scale(j,q),T.save()),v(T,ee),this.ctx=ee,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(T),this.groupLevel++}endGroup(k){if(!this.contentVisible)return;this.groupLevel--;let T=this.ctx,N=this.groupStack.pop();if(this.ctx=N,this.ctx.imageSmoothingEnabled=!1,k.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let W=(0,i.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...W);let m=r.Util.getAxialAlignedBoundingBox([0,0,T.canvas.width,T.canvas.height],W);this.ctx.drawImage(T.canvas,0,0),this.ctx.restore(),this.compose(m)}}beginAnnotation(k,T,N,W,m){if(this.#e(),M(this.ctx,this.foregroundColor),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(T)&&T.length===4){let _=T[2]-T[0],C=T[3]-T[1];if(m&&this.annotationCanvasMap){N=N.slice(),N[4]-=T[0],N[5]-=T[1],T=T.slice(),T[0]=T[1]=0,T[2]=_,T[3]=C;let[I,H]=r.Util.singularValueDecompose2dScale((0,i.getCurrentTransform)(this.ctx)),{viewportScale:j}=this,q=Math.ceil(_*this.outputScaleX*j),Z=Math.ceil(C*this.outputScaleY*j);this.annotationCanvas=this.canvasFactory.create(q,Z);let{canvas:ae,context:ee}=this.annotationCanvas;this.annotationCanvasMap.set(k,ae),this.annotationCanvas.savedCtx=this.ctx,this.ctx=ee,this.ctx.setTransform(I,0,0,-H,0,C*H),M(this.ctx,this.foregroundColor)}else M(this.ctx,this.foregroundColor),this.ctx.rect(T[0],T[1],_,C),this.ctx.clip(),this.endPath()}this.current=new L(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...N),this.transform(...W)}endAnnotation(){this.annotationCanvas&&(this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(k){if(!this.contentVisible)return;let T=k.count;k=this.getObject(k.data,k),k.count=T;let N=this.ctx,W=this.processingType3;if(W&&(W.compiled===void 0&&(W.compiled=P(k)),W.compiled)){W.compiled(N);return}let m=this._createMaskCanvas(k),_=m.canvas;N.save(),N.setTransform(1,0,0,1,0,0),N.drawImage(_,m.offsetX,m.offsetY),N.restore(),this.compose()}paintImageMaskXObjectRepeat(k,T,N=0,W=0,m,_){if(!this.contentVisible)return;k=this.getObject(k.data,k);let C=this.ctx;C.save();let I=(0,i.getCurrentTransform)(C);C.transform(T,N,W,m,0,0);let H=this._createMaskCanvas(k);C.setTransform(1,0,0,1,0,0);for(let j=0,q=_.length;j<q;j+=2){let Z=r.Util.transform(I,[T,N,W,m,_[j],_[j+1]]),[ae,ee]=r.Util.applyTransform([0,0],Z);C.drawImage(H.canvas,ae,ee)}C.restore(),this.compose()}paintImageMaskXObjectGroup(k){if(!this.contentVisible)return;let T=this.ctx,N=this.current.fillColor,W=this.current.patternFill;for(let m of k){let{data:_,width:C,height:I,transform:H}=m,j=this.cachedCanvases.getCanvas("maskCanvas",C,I),q=j.context;q.save();let Z=this.getObject(_,m);x(q,Z),q.globalCompositeOperation="source-in",q.fillStyle=W?N.getPattern(q,this,(0,i.getCurrentTransformInverse)(T),o.PathType.FILL):N,q.fillRect(0,0,C,I),q.restore(),T.save(),T.transform(...H),T.scale(1,-1),R(T,j.canvas,0,0,C,I,0,-1,1,1),T.restore()}this.compose()}paintImageXObject(k){if(!this.contentVisible)return;let T=this.getObject(k);if(!T){(0,r.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(T)}paintImageXObjectRepeat(k,T,N,W){if(!this.contentVisible)return;let m=this.getObject(k);if(!m){(0,r.warn)("Dependent image isn't ready yet");return}let _=m.width,C=m.height,I=[];for(let H=0,j=W.length;H<j;H+=2)I.push({transform:[T,0,0,N,W[H],W[H+1]],x:0,y:0,w:_,h:C});this.paintInlineImageXObjectGroup(m,I)}paintInlineImageXObject(k){if(!this.contentVisible)return;let T=k.width,N=k.height,W=this.ctx;this.save(),W.scale(1/T,-1/N);let m;if(typeof HTMLElement=="function"&&k instanceof HTMLElement||!k.data)m=k;else{let H=this.cachedCanvases.getCanvas("inlineImage",T,N),j=H.context;S(j,k,this.current.transferMaps),m=H.canvas}let _=this._scaleImage(m,(0,i.getCurrentTransformInverse)(W));W.imageSmoothingEnabled=ce((0,i.getCurrentTransform)(W),k.interpolate);let[C,I]=R(W,_.img,0,0,_.paintWidth,_.paintHeight,0,-N,T,N);if(this.imageLayer){let[H,j]=r.Util.applyTransform([0,-N],(0,i.getCurrentTransform)(this.ctx));this.imageLayer.appendImage({imgData:k,left:H,top:j,width:C,height:I})}this.compose(),this.restore()}paintInlineImageXObjectGroup(k,T){if(!this.contentVisible)return;let N=this.ctx,W=k.width,m=k.height,_=this.cachedCanvases.getCanvas("inlineImage",W,m),C=_.context;S(C,k,this.current.transferMaps);for(let I of T){if(N.save(),N.transform(...I.transform),N.scale(1,-1),R(N,_.canvas,I.x,I.y,I.w,I.h,0,-1,1,1),this.imageLayer){let[H,j]=r.Util.applyTransform([I.x,I.y],(0,i.getCurrentTransform)(this.ctx));this.imageLayer.appendImage({imgData:k,left:H,top:j,width:W,height:m})}N.restore()}this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(k){}markPointProps(k,T){}beginMarkedContent(k){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(k,T){k==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(T)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(k){let T=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(k);let N=this.ctx;this.pendingClip&&(T||(this.pendingClip===se?N.clip("evenodd"):N.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),N.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let k=(0,i.getCurrentTransform)(this.ctx);if(k[1]===0&&k[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(k[0]),Math.abs(k[3]));else{let T=Math.abs(k[0]*k[3]-k[2]*k[1]),N=Math.hypot(k[0],k[2]),W=Math.hypot(k[1],k[3]);this._cachedGetSinglePixelWidth=Math.max(N,W)/T}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(!this._cachedScaleForStroking){let{lineWidth:k}=this.current,T=(0,i.getCurrentTransform)(this.ctx),N,W;if(T[1]===0&&T[2]===0){let m=Math.abs(T[0]),_=Math.abs(T[3]);if(k===0)N=1/m,W=1/_;else{let C=m*k,I=_*k;N=C<1?1/C:1,W=I<1?1/I:1}}else{let m=Math.abs(T[0]*T[3]-T[2]*T[1]),_=Math.hypot(T[0],T[1]),C=Math.hypot(T[2],T[3]);if(k===0)N=C/m,W=_/m;else{let I=k*m;N=C>I?C/I:1,W=_>I?_/I:1}}this._cachedScaleForStroking=[N,W]}return this._cachedScaleForStroking}rescaleAndStroke(k){let{ctx:T}=this,{lineWidth:N}=this.current,[W,m]=this.getScaleForStroking();if(T.lineWidth=N||1,W===1&&m===1){T.stroke();return}let _,C,I;k&&(_=(0,i.getCurrentTransform)(T),C=T.getLineDash().slice(),I=T.lineDashOffset),T.scale(W,m);let H=Math.max(W,m);T.setLineDash(T.getLineDash().map(j=>j/H)),T.lineDashOffset/=H,T.stroke(),k&&(T.setTransform(..._),T.setLineDash(C),T.lineDashOffset=I)}isContentVisible(){for(let k=this.markedContentStack.length-1;k>=0;k--)if(!this.markedContentStack[k].visible)return!1;return!0}}e.CanvasGraphics=$;for(let z in r.OPS)$.prototype[z]!==void 0&&($.prototype[r.OPS[z]]=$.prototype[z])},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TilingPattern=e.PathType=void 0,e.getShadingPattern=g;var i=t(1),r=t(8),o=t(3);let s={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};e.PathType=s;function l(R,P){if(!P||o.isNodeJS)return;let L=P[2]-P[0],S=P[3]-P[1],x=new Path2D;x.rect(P[0],P[1],L,S),R.clip(x)}class c{constructor(){this.constructor===c&&(0,i.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,i.unreachable)("Abstract method `getPattern` called.")}}class u extends c{constructor(P){super(),this._type=P[1],this._bbox=P[2],this._colorStops=P[3],this._p0=P[4],this._p1=P[5],this._r0=P[6],this._r1=P[7],this.matrix=null}_createGradient(P){let L;this._type==="axial"?L=P.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(L=P.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let S of this._colorStops)L.addColorStop(S[0],S[1]);return L}getPattern(P,L,S,x){let v;if(x===s.STROKE||x===s.FILL){let M=L.current.getClippedPathBoundingBox(x,(0,r.getCurrentTransform)(P))||[0,0,0,0],O=Math.ceil(M[2]-M[0])||1,B=Math.ceil(M[3]-M[1])||1,X=L.cachedCanvases.getCanvas("pattern",O,B,!0),V=X.context;V.clearRect(0,0,V.canvas.width,V.canvas.height),V.beginPath(),V.rect(0,0,V.canvas.width,V.canvas.height),V.translate(-M[0],-M[1]),S=i.Util.transform(S,[1,0,0,1,M[0],M[1]]),V.transform(...L.baseTransform),this.matrix&&V.transform(...this.matrix),l(V,this._bbox),V.fillStyle=this._createGradient(V),V.fill(),v=P.createPattern(X.canvas,"no-repeat");let J=new DOMMatrix(S);try{v.setTransform(J)}catch(ce){(0,i.warn)(`RadialAxialShadingPattern.getPattern: "${ce?.message}".`)}}else l(P,this._bbox),v=this._createGradient(P);return v}}function p(R,P,L,S,x,v,M,O){let B=P.coords,X=P.colors,V=R.data,J=R.width*4,ce;B[L+1]>B[S+1]&&(ce=L,L=S,S=ce,ce=v,v=M,M=ce),B[S+1]>B[x+1]&&(ce=S,S=x,x=ce,ce=M,M=O,O=ce),B[L+1]>B[S+1]&&(ce=L,L=S,S=ce,ce=v,v=M,M=ce);let G=(B[L]+P.offsetX)*P.scaleX,Y=(B[L+1]+P.offsetY)*P.scaleY,K=(B[S]+P.offsetX)*P.scaleX,se=(B[S+1]+P.offsetY)*P.scaleY,$=(B[x]+P.offsetX)*P.scaleX,z=(B[x+1]+P.offsetY)*P.scaleY;if(Y>=z)return;let k=X[v],T=X[v+1],N=X[v+2],W=X[M],m=X[M+1],_=X[M+2],C=X[O],I=X[O+1],H=X[O+2],j=Math.round(Y),q=Math.round(z),Z,ae,ee,ue,_e,he,ke,Me;for(let Ce=j;Ce<=q;Ce++){if(Ce<se){let ze;Ce<Y?ze=0:ze=(Y-Ce)/(Y-se),Z=G-(G-K)*ze,ae=k-(k-W)*ze,ee=T-(T-m)*ze,ue=N-(N-_)*ze}else{let ze;Ce>z?ze=1:se===z?ze=0:ze=(se-Ce)/(se-z),Z=K-(K-$)*ze,ae=W-(W-C)*ze,ee=m-(m-I)*ze,ue=_-(_-H)*ze}let Le;Ce<Y?Le=0:Ce>z?Le=1:Le=(Y-Ce)/(Y-z),_e=G-(G-$)*Le,he=k-(k-C)*Le,ke=T-(T-I)*Le,Me=N-(N-H)*Le;let Fe=Math.round(Math.min(Z,_e)),jt=Math.round(Math.max(Z,_e)),xn=J*Ce+Fe*4;for(let ze=Fe;ze<=jt;ze++)Le=(Z-ze)/(Z-_e),Le<0?Le=0:Le>1&&(Le=1),V[xn++]=ae-(ae-he)*Le|0,V[xn++]=ee-(ee-ke)*Le|0,V[xn++]=ue-(ue-Me)*Le|0,V[xn++]=255}}function d(R,P,L){let S=P.coords,x=P.colors,v,M;switch(P.type){case"lattice":let O=P.verticesPerRow,B=Math.floor(S.length/O)-1,X=O-1;for(v=0;v<B;v++){let V=v*O;for(let J=0;J<X;J++,V++)p(R,L,S[V],S[V+1],S[V+O],x[V],x[V+1],x[V+O]),p(R,L,S[V+O+1],S[V+1],S[V+O],x[V+O+1],x[V+1],x[V+O])}break;case"triangles":for(v=0,M=S.length;v<M;v+=3)p(R,L,S[v],S[v+1],S[v+2],x[v],x[v+1],x[v+2]);break;default:throw new Error("illegal figure")}}class h extends c{constructor(P){super(),this._coords=P[2],this._colors=P[3],this._figures=P[4],this._bounds=P[5],this._bbox=P[7],this._background=P[8],this.matrix=null}_createMeshCanvas(P,L,S){let O=Math.floor(this._bounds[0]),B=Math.floor(this._bounds[1]),X=Math.ceil(this._bounds[2])-O,V=Math.ceil(this._bounds[3])-B,J=Math.min(Math.ceil(Math.abs(X*P[0]*1.1)),3e3),ce=Math.min(Math.ceil(Math.abs(V*P[1]*1.1)),3e3),G=X/J,Y=V/ce,K={coords:this._coords,colors:this._colors,offsetX:-O,offsetY:-B,scaleX:1/G,scaleY:1/Y},se=J+2*2,$=ce+2*2,z=S.getCanvas("mesh",se,$,!1),k=z.context,T=k.createImageData(J,ce);if(L){let W=T.data;for(let m=0,_=W.length;m<_;m+=4)W[m]=L[0],W[m+1]=L[1],W[m+2]=L[2],W[m+3]=255}for(let W of this._figures)d(T,W,K);return k.putImageData(T,2,2),{canvas:z.canvas,offsetX:O-2*G,offsetY:B-2*Y,scaleX:G,scaleY:Y}}getPattern(P,L,S,x){l(P,this._bbox);let v;if(x===s.SHADING)v=i.Util.singularValueDecompose2dScale((0,r.getCurrentTransform)(P));else if(v=i.Util.singularValueDecompose2dScale(L.baseTransform),this.matrix){let O=i.Util.singularValueDecompose2dScale(this.matrix);v=[v[0]*O[0],v[1]*O[1]]}let M=this._createMeshCanvas(v,x===s.SHADING?null:this._background,L.cachedCanvases);return x!==s.SHADING&&(P.setTransform(...L.baseTransform),this.matrix&&P.transform(...this.matrix)),P.translate(M.offsetX,M.offsetY),P.scale(M.scaleX,M.scaleY),P.createPattern(M.canvas,"no-repeat")}}class A extends c{getPattern(){return"hotpink"}}function g(R){switch(R[0]){case"RadialAxial":return new u(R);case"Mesh":return new h(R);case"Dummy":return new A}throw new Error(`Unknown IR type: ${R[0]}`)}let F={COLORED:1,UNCOLORED:2};class b{static get MAX_PATTERN_SIZE(){return(0,i.shadow)(this,"MAX_PATTERN_SIZE",3e3)}constructor(P,L,S,x,v){this.operatorList=P[2],this.matrix=P[3]||[1,0,0,1,0,0],this.bbox=P[4],this.xstep=P[5],this.ystep=P[6],this.paintType=P[7],this.tilingType=P[8],this.color=L,this.ctx=S,this.canvasGraphicsFactory=x,this.baseTransform=v}createPatternCanvas(P){let L=this.operatorList,S=this.bbox,x=this.xstep,v=this.ystep,M=this.paintType,O=this.tilingType,B=this.color,X=this.canvasGraphicsFactory;(0,i.info)("TilingType: "+O);let V=S[0],J=S[1],ce=S[2],G=S[3],Y=i.Util.singularValueDecompose2dScale(this.matrix),K=i.Util.singularValueDecompose2dScale(this.baseTransform),se=[Y[0]*K[0],Y[1]*K[1]],$=this.getSizeAndScale(x,this.ctx.canvas.width,se[0]),z=this.getSizeAndScale(v,this.ctx.canvas.height,se[1]),k=P.cachedCanvases.getCanvas("pattern",$.size,z.size,!0),T=k.context,N=X.createCanvasGraphics(T);N.groupLevel=P.groupLevel,this.setFillAndStrokeStyleToContext(N,M,B);let W=V,m=J,_=ce,C=G;return V<0&&(W=0,_+=Math.abs(V)),J<0&&(m=0,C+=Math.abs(J)),T.translate(-($.scale*W),-(z.scale*m)),N.transform($.scale,0,0,z.scale,0,0),T.save(),this.clipBbox(N,W,m,_,C),N.baseTransform=(0,r.getCurrentTransform)(N.ctx),N.executeOperatorList(L),N.endDrawing(),{canvas:k.canvas,scaleX:$.scale,scaleY:z.scale,offsetX:W,offsetY:m}}getSizeAndScale(P,L,S){P=Math.abs(P);let x=Math.max(b.MAX_PATTERN_SIZE,L),v=Math.ceil(P*S);return v>=x?v=x:S=v/P,{scale:S,size:v}}clipBbox(P,L,S,x,v){let M=x-L,O=v-S;P.ctx.rect(L,S,M,O),P.current.updateRectMinMax((0,r.getCurrentTransform)(P.ctx),[L,S,x,v]),P.clip(),P.endPath()}setFillAndStrokeStyleToContext(P,L,S){let x=P.ctx,v=P.current;switch(L){case F.COLORED:let M=this.ctx;x.fillStyle=M.fillStyle,x.strokeStyle=M.strokeStyle,v.fillColor=M.fillStyle,v.strokeColor=M.strokeStyle;break;case F.UNCOLORED:let O=i.Util.makeHexColor(S[0],S[1],S[2]);x.fillStyle=O,x.strokeStyle=O,v.fillColor=O,v.strokeColor=O;break;default:throw new i.FormatError(`Unsupported paint type: ${L}`)}}getPattern(P,L,S,x){let v=S;x!==s.SHADING&&(v=i.Util.transform(v,L.baseTransform),this.matrix&&(v=i.Util.transform(v,this.matrix)));let M=this.createPatternCanvas(L),O=new DOMMatrix(v);O=O.translate(M.offsetX,M.offsetY),O=O.scale(1/M.scaleX,1/M.scaleY);let B=P.createPattern(M.canvas,"repeat");try{B.setTransform(O)}catch(X){(0,i.warn)(`TilingPattern.getPattern: "${X?.message}".`)}return B}}e.TilingPattern=b},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.applyMaskImageData=r;var i=t(1);function r({src:o,srcPos:s=0,dest:l,destPos:c=0,width:u,height:p,inverseDecode:d=!1}){let h=i.FeatureTest.isLittleEndian?4278190080:255,[A,g]=d?[0,h]:[h,0],F=u>>3,b=u&7,R=o.length;l=new Uint32Array(l.buffer);for(let P=0;P<p;P++){for(let S=s+F;s<S;s++){let x=s<R?o[s]:255;l[c++]=x&128?g:A,l[c++]=x&64?g:A,l[c++]=x&32?g:A,l[c++]=x&16?g:A,l[c++]=x&8?g:A,l[c++]=x&4?g:A,l[c++]=x&2?g:A,l[c++]=x&1?g:A}if(b===0)continue;let L=s<R?o[s++]:255;for(let S=0;S<b;S++)l[c++]=L&1<<7-S?g:A}return{srcPos:s,destPos:c}}},(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalWorkerOptions=void 0;let t=Object.create(null);e.GlobalWorkerOptions=t,t.workerPort=t.workerPort===void 0?null:t.workerPort,t.workerSrc=t.workerSrc===void 0?"":t.workerSrc},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MessageHandler=void 0;var i=t(1);let r={UNKNOWN:0,DATA:1,ERROR:2},o={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function s(c){switch(c instanceof Error||typeof c=="object"&&c!==null||(0,i.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),c.name){case"AbortException":return new i.AbortException(c.message);case"MissingPDFException":return new i.MissingPDFException(c.message);case"PasswordException":return new i.PasswordException(c.message,c.code);case"UnexpectedResponseException":return new i.UnexpectedResponseException(c.message,c.status);case"UnknownErrorException":return new i.UnknownErrorException(c.message,c.details);default:return new i.UnknownErrorException(c.message,c.toString())}}class l{constructor(u,p,d){this.sourceName=u,this.targetName=p,this.comObj=d,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=h=>{let A=h.data;if(A.targetName!==this.sourceName)return;if(A.stream){this._processStreamMessage(A);return}if(A.callback){let F=A.callbackId,b=this.callbackCapabilities[F];if(!b)throw new Error(`Cannot resolve callback ${F}`);if(delete this.callbackCapabilities[F],A.callback===r.DATA)b.resolve(A.data);else if(A.callback===r.ERROR)b.reject(s(A.reason));else throw new Error("Unexpected callback case");return}let g=this.actionHandler[A.action];if(!g)throw new Error(`Unknown action from worker: ${A.action}`);if(A.callbackId){let F=this.sourceName,b=A.sourceName;new Promise(function(R){R(g(A.data))}).then(function(R){d.postMessage({sourceName:F,targetName:b,callback:r.DATA,callbackId:A.callbackId,data:R})},function(R){d.postMessage({sourceName:F,targetName:b,callback:r.ERROR,callbackId:A.callbackId,reason:s(R)})});return}if(A.streamId){this._createStreamSink(A);return}g(A.data)},d.addEventListener("message",this._onComObjOnMessage)}on(u,p){let d=this.actionHandler;if(d[u])throw new Error(`There is already an actionName called "${u}"`);d[u]=p}send(u,p,d){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:u,data:p},d)}sendWithPromise(u,p,d){let h=this.callbackId++,A=(0,i.createPromiseCapability)();this.callbackCapabilities[h]=A;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:u,callbackId:h,data:p},d)}catch(g){A.reject(g)}return A.promise}sendWithStream(u,p,d,h){let A=this.streamId++,g=this.sourceName,F=this.targetName,b=this.comObj;return new ReadableStream({start:R=>{let P=(0,i.createPromiseCapability)();return this.streamControllers[A]={controller:R,startCall:P,pullCall:null,cancelCall:null,isClosed:!1},b.postMessage({sourceName:g,targetName:F,action:u,streamId:A,data:p,desiredSize:R.desiredSize},h),P.promise},pull:R=>{let P=(0,i.createPromiseCapability)();return this.streamControllers[A].pullCall=P,b.postMessage({sourceName:g,targetName:F,stream:o.PULL,streamId:A,desiredSize:R.desiredSize}),P.promise},cancel:R=>{(0,i.assert)(R instanceof Error,"cancel must have a valid reason");let P=(0,i.createPromiseCapability)();return this.streamControllers[A].cancelCall=P,this.streamControllers[A].isClosed=!0,b.postMessage({sourceName:g,targetName:F,stream:o.CANCEL,streamId:A,reason:s(R)}),P.promise}},d)}_createStreamSink(u){let p=u.streamId,d=this.sourceName,h=u.sourceName,A=this.comObj,g=this,F=this.actionHandler[u.action],b={enqueue(R,P=1,L){if(this.isCancelled)return;let S=this.desiredSize;this.desiredSize-=P,S>0&&this.desiredSize<=0&&(this.sinkCapability=(0,i.createPromiseCapability)(),this.ready=this.sinkCapability.promise),A.postMessage({sourceName:d,targetName:h,stream:o.ENQUEUE,streamId:p,chunk:R},L)},close(){this.isCancelled||(this.isCancelled=!0,A.postMessage({sourceName:d,targetName:h,stream:o.CLOSE,streamId:p}),delete g.streamSinks[p])},error(R){(0,i.assert)(R instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,A.postMessage({sourceName:d,targetName:h,stream:o.ERROR,streamId:p,reason:s(R)}))},sinkCapability:(0,i.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:u.desiredSize,ready:null};b.sinkCapability.resolve(),b.ready=b.sinkCapability.promise,this.streamSinks[p]=b,new Promise(function(R){R(F(u.data,b))}).then(function(){A.postMessage({sourceName:d,targetName:h,stream:o.START_COMPLETE,streamId:p,success:!0})},function(R){A.postMessage({sourceName:d,targetName:h,stream:o.START_COMPLETE,streamId:p,reason:s(R)})})}_processStreamMessage(u){let p=u.streamId,d=this.sourceName,h=u.sourceName,A=this.comObj,g=this.streamControllers[p],F=this.streamSinks[p];switch(u.stream){case o.START_COMPLETE:u.success?g.startCall.resolve():g.startCall.reject(s(u.reason));break;case o.PULL_COMPLETE:u.success?g.pullCall.resolve():g.pullCall.reject(s(u.reason));break;case o.PULL:if(!F){A.postMessage({sourceName:d,targetName:h,stream:o.PULL_COMPLETE,streamId:p,success:!0});break}F.desiredSize<=0&&u.desiredSize>0&&F.sinkCapability.resolve(),F.desiredSize=u.desiredSize,new Promise(function(b){b(F.onPull&&F.onPull())}).then(function(){A.postMessage({sourceName:d,targetName:h,stream:o.PULL_COMPLETE,streamId:p,success:!0})},function(b){A.postMessage({sourceName:d,targetName:h,stream:o.PULL_COMPLETE,streamId:p,reason:s(b)})});break;case o.ENQUEUE:if((0,i.assert)(g,"enqueue should have stream controller"),g.isClosed)break;g.controller.enqueue(u.chunk);break;case o.CLOSE:if((0,i.assert)(g,"close should have stream controller"),g.isClosed)break;g.isClosed=!0,g.controller.close(),this._deleteStreamController(g,p);break;case o.ERROR:(0,i.assert)(g,"error should have stream controller"),g.controller.error(s(u.reason)),this._deleteStreamController(g,p);break;case o.CANCEL_COMPLETE:u.success?g.cancelCall.resolve():g.cancelCall.reject(s(u.reason)),this._deleteStreamController(g,p);break;case o.CANCEL:if(!F)break;new Promise(function(b){b(F.onCancel&&F.onCancel(s(u.reason)))}).then(function(){A.postMessage({sourceName:d,targetName:h,stream:o.CANCEL_COMPLETE,streamId:p,success:!0})},function(b){A.postMessage({sourceName:d,targetName:h,stream:o.CANCEL_COMPLETE,streamId:p,reason:s(b)})}),F.sinkCapability.reject(s(u.reason)),F.isCancelled=!0,delete this.streamSinks[p];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(u,p){await Promise.allSettled([u.startCall&&u.startCall.promise,u.pullCall&&u.pullCall.promise,u.cancelCall&&u.cancelCall.promise]),delete this.streamControllers[p]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}e.MessageHandler=l},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var i=t(1);class r{#e;#t;constructor({parsedData:s,rawData:l}){this.#e=s,this.#t=l}getRaw(){return this.#t}get(s){return this.#e.get(s)??null}getAll(){return(0,i.objectFromMap)(this.#e)}has(s){return this.#e.has(s)}}e.Metadata=r},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OptionalContentConfig=void 0;var i=t(1);let r=Symbol("INTERNAL");class o{#e=!0;constructor(c,u){this.name=c,this.intent=u}get visible(){return this.#e}_setVisible(c,u){c!==r&&(0,i.unreachable)("Internal method `_setVisible` called."),this.#e=u}}class s{#e=!0;#t=new Map;#r=null;#n=null;constructor(c){if(this.name=null,this.creator=null,c!==null){this.name=c.name,this.creator=c.creator,this.#n=c.order;for(let u of c.groups)this.#t.set(u.id,new o(u.name,u.intent));if(c.baseState==="OFF")for(let u of this.#t.values())u._setVisible(r,!1);for(let u of c.on)this.#t.get(u)._setVisible(r,!0);for(let u of c.off)this.#t.get(u)._setVisible(r,!1);this.#r=new Map;for(let[u,p]of this.#t)this.#r.set(u,p.visible)}}#o(c){let u=c.length;if(u<2)return!0;let p=c[0];for(let d=1;d<u;d++){let h=c[d],A;if(Array.isArray(h))A=this.#o(h);else if(this.#t.has(h))A=this.#t.get(h).visible;else return(0,i.warn)(`Optional content group not found: ${h}`),!0;switch(p){case"And":if(!A)return!1;break;case"Or":if(A)return!0;break;case"Not":return!A;default:return!0}}return p==="And"}isVisible(c){if(this.#t.size===0)return!0;if(!c)return(0,i.warn)("Optional content group not defined."),!0;if(c.type==="OCG")return this.#t.has(c.id)?this.#t.get(c.id).visible:((0,i.warn)(`Optional content group not found: ${c.id}`),!0);if(c.type==="OCMD"){if(c.expression)return this.#o(c.expression);if(!c.policy||c.policy==="AnyOn"){for(let u of c.ids){if(!this.#t.has(u))return(0,i.warn)(`Optional content group not found: ${u}`),!0;if(this.#t.get(u).visible)return!0}return!1}else if(c.policy==="AllOn"){for(let u of c.ids){if(!this.#t.has(u))return(0,i.warn)(`Optional content group not found: ${u}`),!0;if(!this.#t.get(u).visible)return!1}return!0}else if(c.policy==="AnyOff"){for(let u of c.ids){if(!this.#t.has(u))return(0,i.warn)(`Optional content group not found: ${u}`),!0;if(!this.#t.get(u).visible)return!0}return!1}else if(c.policy==="AllOff"){for(let u of c.ids){if(!this.#t.has(u))return(0,i.warn)(`Optional content group not found: ${u}`),!0;if(this.#t.get(u).visible)return!1}return!0}return(0,i.warn)(`Unknown optional content policy ${c.policy}.`),!0}return(0,i.warn)(`Unknown group type ${c.type}.`),!0}setVisibility(c,u=!0){if(!this.#t.has(c)){(0,i.warn)(`Optional content group not found: ${c}`);return}this.#t.get(c)._setVisible(r,!!u),this.#e=null}get hasInitialVisibility(){if(this.#e!==null)return this.#e;for(let[c,u]of this.#t){let p=this.#r.get(c);if(u.visible!==p)return this.#e=!1}return this.#e=!0}getOrder(){return this.#t.size?this.#n?this.#n.slice():[...this.#t.keys()]:null}getGroups(){return this.#t.size>0?(0,i.objectFromMap)(this.#t):null}getGroup(c){return this.#t.get(c)||null}}e.OptionalContentConfig=s},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFDataTransportStream=void 0;var i=t(1),r=t(8);class o{constructor(u,p){(0,i.assert)(p,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=u.progressiveDone||!1,this._contentDispositionFilename=u.contentDispositionFilename||null;let d=u.initialData;if(d?.length>0){let h=new Uint8Array(d).buffer;this._queuedChunks.push(h)}this._pdfDataRangeTransport=p,this._isStreamingSupported=!u.disableStream,this._isRangeSupported=!u.disableRange,this._contentLength=u.length,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((h,A)=>{this._onReceiveData({begin:h,chunk:A})}),this._pdfDataRangeTransport.addProgressListener((h,A)=>{this._onProgress({loaded:h,total:A})}),this._pdfDataRangeTransport.addProgressiveReadListener(h=>{this._onReceiveData({chunk:h})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData(u){let p=new Uint8Array(u.chunk).buffer;if(u.begin===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(p):this._queuedChunks.push(p);else{let d=this._rangeReaders.some(function(h){return h._begin!==u.begin?!1:(h._enqueue(p),!0)});(0,i.assert)(d,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(u){if(u.total===void 0){let p=this._rangeReaders[0];p?.onProgress&&p.onProgress({loaded:u.loaded})}else{let p=this._fullRequestReader;p?.onProgress&&p.onProgress({loaded:u.loaded,total:u.total})}}_onProgressiveDone(){this._fullRequestReader&&this._fullRequestReader.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(u){let p=this._rangeReaders.indexOf(u);p>=0&&this._rangeReaders.splice(p,1)}getFullReader(){(0,i.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let u=this._queuedChunks;return this._queuedChunks=null,new s(this,u,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(u,p){if(p<=this._progressiveDataLength)return null;let d=new l(this,u,p);return this._pdfDataRangeTransport.requestDataRange(u,p),this._rangeReaders.push(d),d}cancelAllRequests(u){this._fullRequestReader&&this._fullRequestReader.cancel(u);for(let p of this._rangeReaders.slice(0))p.cancel(u);this._pdfDataRangeTransport.abort()}}e.PDFDataTransportStream=o;class s{constructor(u,p,d=!1,h=null){this._stream=u,this._done=d||!1,this._filename=(0,r.isPdfFile)(h)?h:null,this._queuedChunks=p||[],this._loaded=0;for(let A of this._queuedChunks)this._loaded+=A.byteLength;this._requests=[],this._headersReady=Promise.resolve(),u._fullRequestReader=this,this.onProgress=null}_enqueue(u){this._done||(this._requests.length>0?this._requests.shift().resolve({value:u,done:!1}):this._queuedChunks.push(u),this._loaded+=u.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let u=(0,i.createPromiseCapability)();return this._requests.push(u),u.promise}cancel(u){this._done=!0;for(let p of this._requests)p.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class l{constructor(u,p,d){this._stream=u,this._begin=p,this._end=d,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(u){if(!this._done){if(this._requests.length===0)this._queuedChunk=u;else{this._requests.shift().resolve({value:u,done:!1});for(let d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let p=this._queuedChunk;return this._queuedChunk=null,{value:p,done:!1}}if(this._done)return{value:void 0,done:!0};let u=(0,i.createPromiseCapability)();return this._requests.push(u),u.promise}cancel(u){this._done=!0;for(let p of this._requests)p.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaText=void 0;class t{static textContent(r){let o=[],s={items:o,styles:Object.create(null)};function l(c){if(!c)return;let u=null,p=c.name;if(p==="#text")u=c.value;else if(t.shouldBuildText(p))c?.attributes?.textContent?u=c.attributes.textContent:c.value&&(u=c.value);else return;if(u!==null&&o.push({str:u}),!!c.children)for(let d of c.children)l(d)}return l(r),s}static shouldBuildText(r){return!(r==="textarea"||r==="input"||r==="option"||r==="select")}}e.XfaText=t},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NodeStandardFontDataFactory=e.NodeCanvasFactory=e.NodeCMapReaderFactory=void 0;var i=t(9);let r=function(c){return new Promise((u,p)=>{Y1().readFile(c,(h,A)=>{if(h||!A){p(new Error(h));return}u(new Uint8Array(A))})})};class o extends i.BaseCanvasFactory{_createCanvas(u,p){return Uy().createCanvas(u,p)}}e.NodeCanvasFactory=o;class s extends i.BaseCMapReaderFactory{_fetchData(u,p){return r(u).then(d=>({cMapData:d,compressionType:p}))}}e.NodeCMapReaderFactory=s;class l extends i.BaseStandardFontDataFactory{_fetchData(u){return r(u)}}e.NodeStandardFontDataFactory=l},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditorLayer=void 0;var i=t(7),r=t(1),o=t(23),s=t(24);class l{#e;#t=!1;#r=this.pointerup.bind(this);#n=this.pointerdown.bind(this);#o=new Map;#u=!1;#a=!1;#i;static _initialized=!1;constructor(u){l._initialized||(l._initialized=!0,o.FreeTextEditor.initialize(u.l10n),s.InkEditor.initialize(u.l10n),u.uiManager.registerEditorTypes([o.FreeTextEditor,s.InkEditor])),this.#i=u.uiManager,this.annotationStorage=u.annotationStorage,this.pageIndex=u.pageIndex,this.div=u.div,this.#e=u.accessibilityManager,this.#i.addLayer(this)}updateToolbar(u){this.#i.updateToolbar(u)}updateMode(u=this.#i.getMode()){this.#s(),u===r.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),this.#i.unselectAll()}addInkEditorIfNeeded(u){if(!u&&this.#i.getMode()!==r.AnnotationEditorType.INK)return;if(!u){for(let d of this.#o.values())if(d.isEmpty()){d.setInBackground();return}}this.#c({offsetX:0,offsetY:0}).setInBackground()}setEditingState(u){this.#i.setEditingState(u)}addCommands(u){this.#i.addCommands(u)}enable(){this.div.style.pointerEvents="auto";for(let u of this.#o.values())u.enableEditing()}disable(){this.div.style.pointerEvents="none";for(let u of this.#o.values())u.disableEditing()}setActiveEditor(u){this.#i.getActive()!==u&&this.#i.setActiveEditor(u)}enableClick(){this.div.addEventListener("pointerdown",this.#n),this.div.addEventListener("pointerup",this.#r)}disableClick(){this.div.removeEventListener("pointerdown",this.#n),this.div.removeEventListener("pointerup",this.#r)}attach(u){this.#o.set(u.id,u)}detach(u){this.#o.delete(u.id),this.#e?.removePointerInTextLayer(u.contentDiv)}remove(u){this.#i.removeEditor(u),this.detach(u),this.annotationStorage.remove(u.id),u.div.style.display="none",setTimeout(()=>{u.div.style.display="",u.div.remove(),u.isAttachedToDOM=!1,document.activeElement===document.body&&this.#i.focusMainContainer()},0),this.#a||this.addInkEditorIfNeeded(!1)}#d(u){u.parent!==this&&(this.attach(u),u.pageIndex=this.pageIndex,u.parent?.detach(u),u.parent=this,u.div&&u.isAttachedToDOM&&(u.div.remove(),this.div.append(u.div)))}add(u){if(this.#d(u),this.#i.addEditor(u),this.attach(u),!u.isAttachedToDOM){let p=u.render();this.div.append(p),u.isAttachedToDOM=!0}this.moveEditorInDOM(u),u.onceAdded(),this.addToAnnotationStorage(u)}moveEditorInDOM(u){this.#e?.moveElementInDOM(this.div,u.div,u.contentDiv,!0)}addToAnnotationStorage(u){!u.isEmpty()&&!this.annotationStorage.has(u.id)&&this.annotationStorage.setValue(u.id,u)}addOrRebuild(u){u.needsToBeRebuilt()?u.rebuild():this.add(u)}addANewEditor(u){let p=()=>{this.addOrRebuild(u)},d=()=>{u.remove()};this.addCommands({cmd:p,undo:d,mustExec:!0})}addUndoableEditor(u){let p=()=>{this.addOrRebuild(u)},d=()=>{u.remove()};this.addCommands({cmd:p,undo:d,mustExec:!1})}getNextId(){return this.#i.getId()}#l(u){switch(this.#i.getMode()){case r.AnnotationEditorType.FREETEXT:return new o.FreeTextEditor(u);case r.AnnotationEditorType.INK:return new s.InkEditor(u)}return null}deserialize(u){switch(u.annotationType){case r.AnnotationEditorType.FREETEXT:return o.FreeTextEditor.deserialize(u,this);case r.AnnotationEditorType.INK:return s.InkEditor.deserialize(u,this)}return null}#c(u){let p=this.getNextId(),d=this.#l({parent:this,id:p,x:u.offsetX,y:u.offsetY});return d&&this.add(d),d}setSelected(u){this.#i.setSelected(u)}toggleSelected(u){this.#i.toggleSelected(u)}isSelected(u){return this.#i.isSelected(u)}unselect(u){this.#i.unselect(u)}pointerup(u){let p=i.KeyboardManager.platform.isMac;if(!(u.button!==0||u.ctrlKey&&p)&&u.target===this.div&&this.#u){if(this.#u=!1,!this.#t){this.#t=!0;return}this.#c(u)}}pointerdown(u){let p=i.KeyboardManager.platform.isMac;if(u.button!==0||u.ctrlKey&&p||u.target!==this.div)return;this.#u=!0;let d=this.#i.getActive();this.#t=!d||d.isEmpty()}drop(u){let p=u.dataTransfer.getData("text/plain"),d=this.#i.getEditor(p);if(!d)return;u.preventDefault(),u.dataTransfer.dropEffect="move",this.#d(d);let h=this.div.getBoundingClientRect(),A=u.clientX-h.x,g=u.clientY-h.y;d.translate(A-d.startX,g-d.startY),this.moveEditorInDOM(d),d.div.focus()}dragover(u){u.preventDefault()}destroy(){this.#i.getActive()?.parent===this&&this.#i.setActiveEditor(null);for(let u of this.#o.values())this.#e?.removePointerInTextLayer(u.contentDiv),u.isAttachedToDOM=!1,u.div.remove(),u.parent=null;this.div=null,this.#o.clear(),this.#i.removeLayer(this)}#s(){this.#a=!0;for(let u of this.#o.values())u.isEmpty()&&u.remove();this.#a=!1}render(u){this.viewport=u.viewport,(0,i.bindEvents)(this,this.div,["dragover","drop"]),this.setDimensions();for(let p of this.#i.getEditors(this.pageIndex))this.add(p);this.updateMode()}update(u){this.viewport=u.viewport,this.setDimensions(),this.updateMode()}get scaleFactor(){return this.viewport.scale}get pageDimensions(){let[u,p,d,h]=this.viewport.viewBox,A=d-u,g=h-p;return[A,g]}get viewportBaseDimensions(){let{width:u,height:p,rotation:d}=this.viewport;return d%180===0?[u,p]:[p,u]}setDimensions(){let{width:u,height:p,rotation:d}=this.viewport,h=d%180!==0,A=Math.floor(u)+"px",g=Math.floor(p)+"px";this.div.style.width=h?g:A,this.div.style.height=h?A:g,this.div.setAttribute("data-main-rotation",d)}}e.AnnotationEditorLayer=l},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FreeTextEditor=void 0;var i=t(1),r=t(7),o=t(6);class s extends o.AnnotationEditor{#e=this.editorDivBlur.bind(this);#t=this.editorDivFocus.bind(this);#r=this.editorDivKeydown.bind(this);#n;#o="";#u=!1;#a;static _freeTextDefaultContent="";static _l10nPromise;static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static _keyboardManager=new r.KeyboardManager([[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],s.prototype.commitOrRemove]]);static _type="freetext";constructor(c){super({...c,name:"freeTextEditor"}),this.#n=c.color||s._defaultColor||o.AnnotationEditor._defaultLineColor,this.#a=c.fontSize||s._defaultFontSize}static initialize(c){this._l10nPromise=new Map(["free_text_default_content","editor_free_text_aria_label"].map(p=>[p,c.get(p)]));let u=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(u.getPropertyValue("--freetext-padding"))}static updateDefaultParams(c,u){switch(c){case i.AnnotationEditorParamsType.FREETEXT_SIZE:s._defaultFontSize=u;break;case i.AnnotationEditorParamsType.FREETEXT_COLOR:s._defaultColor=u;break}}updateParams(c,u){switch(c){case i.AnnotationEditorParamsType.FREETEXT_SIZE:this.#i(u);break;case i.AnnotationEditorParamsType.FREETEXT_COLOR:this.#d(u);break}}static get defaultPropertiesToUpdate(){return[[i.AnnotationEditorParamsType.FREETEXT_SIZE,s._defaultFontSize],[i.AnnotationEditorParamsType.FREETEXT_COLOR,s._defaultColor||o.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[i.AnnotationEditorParamsType.FREETEXT_SIZE,this.#a],[i.AnnotationEditorParamsType.FREETEXT_COLOR,this.#n]]}#i(c){let u=d=>{this.editorDiv.style.fontSize=`calc(${d}px * var(--scale-factor))`,this.translate(0,-(d-this.#a)*this.parent.scaleFactor),this.#a=d,this.#c()},p=this.#a;this.parent.addCommands({cmd:()=>{u(c)},undo:()=>{u(p)},mustExec:!0,type:i.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#d(c){let u=this.#n;this.parent.addCommands({cmd:()=>{this.#n=c,this.editorDiv.style.color=c},undo:()=>{this.#n=u,this.editorDiv.style.color=u},mustExec:!0,type:i.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}getInitialTranslation(){return[-s._internalPadding*this.parent.scaleFactor,-(s._internalPadding+this.#a)*this.parent.scaleFactor]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(i.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.enableEditing(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.editorDiv.addEventListener("keydown",this.#r),this.editorDiv.addEventListener("focus",this.#t),this.editorDiv.addEventListener("blur",this.#e))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.disableEditing(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",this.#r),this.editorDiv.removeEventListener("focus",this.#t),this.editorDiv.removeEventListener("blur",this.#e),this.div.focus(),this.isEditing=!1)}focusin(c){super.focusin(c),c.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus())}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent.setEditingState(!0),super.remove()}#l(){let c=this.editorDiv.getElementsByTagName("div");if(c.length===0)return this.editorDiv.innerText;let u=[];for(let p=0,d=c.length;p<d;p++){let A=c[p].firstChild;A?.nodeName==="#text"?u.push(A.data):u.push("")}return u.join(`
`)}#c(){let[c,u]=this.parent.viewportBaseDimensions,p=this.div.getBoundingClientRect();this.width=p.width/c,this.height=p.height/u}commit(){super.commit(),this.#u||(this.#u=!0,this.parent.addUndoableEditor(this)),this.disableEditMode(),this.#o=this.#l().trimEnd(),this.#c()}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(c){this.enableEditMode(),this.editorDiv.focus()}keydown(c){c.target===this.div&&c.key==="Enter"&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(c){s._keyboardManager.exec(this,c)}editorDivFocus(c){this.isEditing=!0}editorDivBlur(c){this.isEditing=!1}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let c,u;this.width&&(c=this.x,u=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",`${this.id}-editor`),this.enableEditing(),s._l10nPromise.get("editor_free_text_aria_label").then(d=>this.editorDiv?.setAttribute("aria-label",d)),s._l10nPromise.get("free_text_default_content").then(d=>this.editorDiv?.setAttribute("default-content",d)),this.editorDiv.contentEditable=!0;let{style:p}=this.editorDiv;if(p.fontSize=`calc(${this.#a}px * var(--scale-factor))`,p.color=this.#n,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,r.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){let[d,h]=this.parent.viewportBaseDimensions;this.setAt(c*d,u*h,this.width*d,this.height*h);for(let A of this.#o.split(`
`)){let g=document.createElement("div");g.append(A?document.createTextNode(A):document.createElement("br")),this.editorDiv.append(g)}this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(c,u){let p=super.deserialize(c,u);return p.#a=c.fontSize,p.#n=i.Util.makeHexColor(...c.color),p.#o=c.value,p}serialize(){if(this.isEmpty())return null;let c=s._internalPadding*this.parent.scaleFactor,u=this.getRect(c,c),p=o.AnnotationEditor._colorManager.convert(getComputedStyle(this.editorDiv).color);return{annotationType:i.AnnotationEditorType.FREETEXT,color:p,fontSize:this.#a,value:this.#o,pageIndex:this.parent.pageIndex,rect:u,rotation:this.rotation}}}e.FreeTextEditor=s},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InkEditor=void 0,Object.defineProperty(e,"fitCurve",{enumerable:!0,get:function(){return o.fitCurve}});var i=t(1),r=t(6),o=t(25),s=t(7);let l=16;class c extends r.AnnotationEditor{#e=0;#t=0;#r=0;#n=this.canvasPointermove.bind(this);#o=this.canvasPointerleave.bind(this);#u=this.canvasPointerup.bind(this);#a=this.canvasPointerdown.bind(this);#i=!1;#d=!1;#l=null;#c=null;#s=0;#g=0;#m=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _l10nPromise;static _type="ink";constructor(p){super({...p,name:"inkEditor"}),this.color=p.color||null,this.thickness=p.thickness||null,this.opacity=p.opacity||null,this.paths=[],this.bezierPath2D=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(p){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink_aria_label"].map(d=>[d,p.get(d)]))}static updateDefaultParams(p,d){switch(p){case i.AnnotationEditorParamsType.INK_THICKNESS:c._defaultThickness=d;break;case i.AnnotationEditorParamsType.INK_COLOR:c._defaultColor=d;break;case i.AnnotationEditorParamsType.INK_OPACITY:c._defaultOpacity=d/100;break}}updateParams(p,d){switch(p){case i.AnnotationEditorParamsType.INK_THICKNESS:this.#_(d);break;case i.AnnotationEditorParamsType.INK_COLOR:this.#y(d);break;case i.AnnotationEditorParamsType.INK_OPACITY:this.#w(d);break}}static get defaultPropertiesToUpdate(){return[[i.AnnotationEditorParamsType.INK_THICKNESS,c._defaultThickness],[i.AnnotationEditorParamsType.INK_COLOR,c._defaultColor||r.AnnotationEditor._defaultLineColor],[i.AnnotationEditorParamsType.INK_OPACITY,Math.round(c._defaultOpacity*100)]]}get propertiesToUpdate(){return[[i.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||c._defaultThickness],[i.AnnotationEditorParamsType.INK_COLOR,this.color||c._defaultColor||r.AnnotationEditor._defaultLineColor],[i.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??c._defaultOpacity))]]}#_(p){let d=this.thickness;this.parent.addCommands({cmd:()=>{this.thickness=p,this.#S()},undo:()=>{this.thickness=d,this.#S()},mustExec:!0,type:i.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#y(p){let d=this.color;this.parent.addCommands({cmd:()=>{this.color=p,this.#h()},undo:()=>{this.color=d,this.#h()},mustExec:!0,type:i.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#w(p){p/=100;let d=this.opacity;this.parent.addCommands({cmd:()=>{this.opacity=p,this.#h()},undo:()=>{this.opacity=d,this.#h()},mustExec:!0,type:i.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(this.#f(),this.#x()),this.isAttachedToDOM||(this.parent.add(this),this.#b()),this.#S())}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#c.disconnect(),this.#c=null,super.remove())}enableEditMode(){this.#i||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",this.#a),this.canvas.addEventListener("pointerup",this.#u))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#a),this.canvas.removeEventListener("pointerup",this.#u))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#T(){let{width:p,height:d,rotation:h}=this.parent.viewport;switch(h){case 90:return[0,p,p,d];case 180:return[p,d,p,d];case 270:return[d,0,p,d];default:return[0,0,p,d]}}#A(){this.ctx.lineWidth=this.thickness*this.parent.scaleFactor/this.scaleFactor,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.miterLimit=10,this.ctx.strokeStyle=`${this.color}${(0,s.opacityToHex)(this.opacity)}`}#p(p,d){this.isEditing=!0,this.#d||(this.#d=!0,this.#b(),this.thickness||=c._defaultThickness,this.color||=c._defaultColor||r.AnnotationEditor._defaultLineColor,this.opacity??=c._defaultOpacity),this.currentPath.push([p,d]),this.#l=null,this.#A(),this.ctx.beginPath(),this.ctx.moveTo(p,d),this.#m=()=>{this.#m&&(this.#l&&(this.isEmpty()?(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)):this.#h(),this.ctx.lineTo(...this.#l),this.#l=null,this.ctx.stroke()),window.requestAnimationFrame(this.#m))},window.requestAnimationFrame(this.#m)}#F(p,d){let[h,A]=this.currentPath.at(-1);p===h&&d===A||(this.currentPath.push([p,d]),this.#l=[p,d])}#E(p,d){this.ctx.closePath(),this.#m=null,p=Math.min(Math.max(p,0),this.canvas.width),d=Math.min(Math.max(d,0),this.canvas.height);let[h,A]=this.currentPath.at(-1);(p!==h||d!==A)&&this.currentPath.push([p,d]);let g;if(this.currentPath.length!==1)g=(0,o.fitCurve)(this.currentPath,30,null);else{let P=[p,d];g=[[P,P.slice(),P.slice(),P]]}let F=c.#C(g);this.currentPath.length=0;let b=()=>{this.paths.push(g),this.bezierPath2D.push(F),this.rebuild()},R=()=>{this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#f(),this.#x()),this.#S())};this.parent.addCommands({cmd:b,undo:R,mustExec:!0})}#h(){if(this.isEmpty()){this.#k();return}this.#A();let{canvas:p,ctx:d}=this;d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,p.width,p.height),this.#k();for(let h of this.bezierPath2D)d.stroke(h)}commit(){this.#i||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#i=!0,this.div.classList.add("disabled"),this.#S(!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus())}focusin(p){super.focusin(p),this.enableEditMode()}canvasPointerdown(p){p.button!==0||!this.isInEditMode()||this.#i||(this.setInForeground(),p.type!=="mouse"&&this.div.focus(),p.stopPropagation(),this.canvas.addEventListener("pointerleave",this.#o),this.canvas.addEventListener("pointermove",this.#n),this.#p(p.offsetX,p.offsetY))}canvasPointermove(p){p.stopPropagation(),this.#F(p.offsetX,p.offsetY)}canvasPointerup(p){p.button===0&&this.isInEditMode()&&this.currentPath.length!==0&&(p.stopPropagation(),this.#v(p),this.setInBackground())}canvasPointerleave(p){this.#v(p),this.setInBackground()}#v(p){this.#E(p.offsetX,p.offsetY),this.canvas.removeEventListener("pointerleave",this.#o),this.canvas.removeEventListener("pointermove",this.#n),this.parent.addToAnnotationStorage(this)}#f(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",c._l10nPromise.get("editor_ink_canvas_aria_label").then(p=>this.canvas?.setAttribute("aria-label",p)),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#x(){this.#c=new ResizeObserver(p=>{let d=p[0].contentRect;d.width&&d.height&&this.setDimensions(d.width,d.height)}),this.#c.observe(this.div)}render(){if(this.div)return this.div;let p,d;this.width&&(p=this.x,d=this.y),super.render(),c._l10nPromise.get("editor_ink_aria_label").then(b=>this.div?.setAttribute("aria-label",b));let[h,A,g,F]=this.#T();if(this.setAt(h,A,0,0),this.setDims(g,F),this.#f(),this.width){let[b,R]=this.parent.viewportBaseDimensions;this.setAt(p*b,d*R,this.width*b,this.height*R),this.#d=!0,this.#b(),this.setDims(this.width*b,this.height*R),this.#h(),this.#P(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#x(),this.div}#b(){if(!this.#d)return;let[p,d]=this.parent.viewportBaseDimensions;this.canvas.width=Math.ceil(this.width*p),this.canvas.height=Math.ceil(this.height*d),this.#k()}setDimensions(p,d){let h=Math.round(p),A=Math.round(d);if(this.#s===h&&this.#g===A)return;this.#s=h,this.#g=A,this.canvas.style.visibility="hidden",this.#e&&Math.abs(this.#e-p/d)>.01&&(d=Math.ceil(p/this.#e),this.setDims(p,d));let[g,F]=this.parent.viewportBaseDimensions;this.width=p/g,this.height=d/F,this.#i&&this.#D(p,d),this.#b(),this.#h(),this.canvas.style.visibility="visible"}#D(p,d){let h=this.#M(),A=(p-h)/this.#r,g=(d-h)/this.#t;this.scaleFactor=Math.min(A,g)}#k(){let p=this.#M()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+p,this.translationY*this.scaleFactor+p)}static#C(p){let d=new Path2D;for(let h=0,A=p.length;h<A;h++){let[g,F,b,R]=p[h];h===0&&d.moveTo(...g),d.bezierCurveTo(F[0],F[1],b[0],b[1],R[0],R[1])}return d}#R(p,d,h,A){let F=[],b=this.thickness/2,R,P;for(let L of this.paths){R=[],P=[];for(let S=0,x=L.length;S<x;S++){let[v,M,O,B]=L[S],X=p*(v[0]+d)+b,V=A-p*(v[1]+h)-b,J=p*(M[0]+d)+b,ce=A-p*(M[1]+h)-b,G=p*(O[0]+d)+b,Y=A-p*(O[1]+h)-b,K=p*(B[0]+d)+b,se=A-p*(B[1]+h)-b;S===0&&(R.push(X,V),P.push(X,V)),R.push(J,ce,G,Y,K,se),this.#I(X,V,J,ce,G,Y,K,se,4,P)}F.push({bezier:R,points:P})}return F}#I(p,d,h,A,g,F,b,R,P,L){if(this.#B(p,d,h,A,g,F,b,R)){L.push(b,R);return}for(let S=1;S<P-1;S++){let x=S/P,v=1-x,M=x*p+v*h,O=x*d+v*A,B=x*h+v*g,X=x*A+v*F,V=x*g+v*b,J=x*F+v*R;M=x*M+v*B,O=x*O+v*X,B=x*B+v*V,X=x*X+v*J,M=x*M+v*B,O=x*O+v*X,L.push(M,O)}L.push(b,R)}#B(p,d,h,A,g,F,b,R){let L=(3*h-2*p-b)**2,S=(3*A-2*d-R)**2,x=(3*g-p-2*b)**2,v=(3*F-d-2*R)**2;return Math.max(L,x)+Math.max(S,v)<=10}#L(){let p=1/0,d=-1/0,h=1/0,A=-1/0;for(let g of this.paths)for(let[F,b,R,P]of g){let L=i.Util.bezierBoundingBox(...F,...b,...R,...P);p=Math.min(p,L[0]),h=Math.min(h,L[1]),d=Math.max(d,L[2]),A=Math.max(A,L[3])}return[p,h,d,A]}#M(){return this.#i?Math.ceil(this.thickness*this.parent.scaleFactor):0}#S(p=!1){if(this.isEmpty())return;if(!this.#i){this.#h();return}let d=this.#L(),h=this.#M();this.#r=Math.max(l,d[2]-d[0]),this.#t=Math.max(l,d[3]-d[1]);let A=Math.ceil(h+this.#r*this.scaleFactor),g=Math.ceil(h+this.#t*this.scaleFactor),[F,b]=this.parent.viewportBaseDimensions;this.width=A/F,this.height=g/b,this.#e=A/g,this.#P();let R=this.translationX,P=this.translationY;this.translationX=-d[0],this.translationY=-d[1],this.#b(),this.#h(),this.#s=A,this.#g=g,this.setDims(A,g);let L=p?h/this.scaleFactor/2:0;this.translate(R-this.translationX-L,P-this.translationY-L)}#P(){let{style:p}=this.div;this.#e>=1?(p.minHeight=`${l}px`,p.minWidth=`${Math.round(this.#e*l)}px`):(p.minWidth=`${l}px`,p.minHeight=`${Math.round(l/this.#e)}px`)}static deserialize(p,d){let h=super.deserialize(p,d);h.thickness=p.thickness,h.color=i.Util.makeHexColor(...p.color),h.opacity=p.opacity;let[A,g]=d.pageDimensions,F=h.width*A,b=h.height*g,R=d.scaleFactor,P=p.thickness/2;h.#e=F/b,h.#i=!0,h.#s=Math.round(F),h.#g=Math.round(b);for(let{bezier:S}of p.paths){let x=[];h.paths.push(x);let v=R*(S[0]-P),M=R*(b-S[1]-P);for(let B=2,X=S.length;B<X;B+=6){let V=R*(S[B]-P),J=R*(b-S[B+1]-P),ce=R*(S[B+2]-P),G=R*(b-S[B+3]-P),Y=R*(S[B+4]-P),K=R*(b-S[B+5]-P);x.push([[v,M],[V,J],[ce,G],[Y,K]]),v=Y,M=K}let O=this.#C(x);h.bezierPath2D.push(O)}let L=h.#L();return h.#r=Math.max(l,L[2]-L[0]),h.#t=Math.max(l,L[3]-L[1]),h.#D(F,b),h}serialize(){if(this.isEmpty())return null;let p=this.getRect(0,0),d=this.rotation%180===0?p[3]-p[1]:p[2]-p[0],h=r.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:i.AnnotationEditorType.INK,color:h,thickness:this.thickness,opacity:this.opacity,paths:this.#R(this.scaleFactor/this.parent.scaleFactor,this.translationX,this.translationY,d),pageIndex:this.parent.pageIndex,rect:p,rotation:this.rotation}}}e.InkEditor=c},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.fitCurve=void 0;let i=t(26);e.fitCurve=i},n=>{function e(g,F,b){if(!Array.isArray(g))throw new TypeError("First argument should be an array");if(g.forEach(S=>{if(!Array.isArray(S)||S.some(x=>typeof x!="number")||S.length!==g[0].length)throw Error("Each point should be an array of numbers. Each point should have the same amount of numbers.")}),g=g.filter((S,x)=>x===0||!S.every((v,M)=>v===g[x-1][M])),g.length<2)return[];let R=g.length,P=d(g[1],g[0]),L=d(g[R-2],g[R-1]);return t(g,P,L,F,b)}function t(g,F,b,R,P){var S,x,v,M,O,B,X,V,J,ce,G,Y,K;if(g.length===2)return Y=h.vectorLen(h.subtract(g[0],g[1]))/3,S=[g[0],h.addArrays(g[0],h.mulItems(F,Y)),h.addArrays(g[1],h.mulItems(b,Y)),g[1]],[S];if(x=l(g),[S,M,B]=i(g,x,x,F,b,P),M===0||M<R)return[S];if(M<R*R)for(v=x,O=M,X=B,K=0;K<20;K++){if(v=o(S,g,v),[S,M,B]=i(g,x,v,F,b,P),M<R)return[S];if(B===X){let se=M/O;if(se>.9999&&se<1.0001)break}O=M,X=B}return G=[],V=h.subtract(g[B-1],g[B+1]),V.every(se=>se===0)&&(V=h.subtract(g[B-1],g[B]),[V[0],V[1]]=[-V[1],V[0]]),J=h.normalize(V),ce=h.mulItems(J,-1),G=G.concat(t(g.slice(0,B+1),F,J,R,P)),G=G.concat(t(g.slice(B),ce,b,R,P)),G}function i(g,F,b,R,P,L){var S,x,v;return S=r(g,b,R,P,L),[x,v]=c(g,S,F),L&&L({bez:S,points:g,params:F,maxErr:x,maxPoint:v}),[S,x,v]}function r(g,F,b,R){var P,L,S,x,v,M,O,B,X,V,J,ce,G,Y,K,se,$,z=g[0],k=g[g.length-1];for(P=[z,null,null,k],L=h.zeros_Xx2x2(F.length),G=0,Y=F.length;G<Y;G++)se=F[G],$=1-se,S=L[G],S[0]=h.mulItems(b,3*se*($*$)),S[1]=h.mulItems(R,3*$*(se*se));for(x=[[0,0],[0,0]],v=[0,0],G=0,Y=g.length;G<Y;G++)se=F[G],S=L[G],x[0][0]+=h.dot(S[0],S[0]),x[0][1]+=h.dot(S[0],S[1]),x[1][0]+=h.dot(S[0],S[1]),x[1][1]+=h.dot(S[1],S[1]),K=h.subtract(g[G],A.q([z,z,k,k],se)),v[0]+=h.dot(S[0],K),v[1]+=h.dot(S[1],K);return M=x[0][0]*x[1][1]-x[1][0]*x[0][1],O=x[0][0]*v[1]-x[1][0]*v[0],B=v[0]*x[1][1]-v[1]*x[0][1],X=M===0?0:B/M,V=M===0?0:O/M,ce=h.vectorLen(h.subtract(z,k)),J=1e-6*ce,X<J||V<J?(P[1]=h.addArrays(z,h.mulItems(b,ce/3)),P[2]=h.addArrays(k,h.mulItems(R,ce/3))):(P[1]=h.addArrays(z,h.mulItems(b,X)),P[2]=h.addArrays(k,h.mulItems(R,V))),P}function o(g,F,b){return b.map((R,P)=>s(g,F[P],R))}function s(g,F,b){var R=h.subtract(A.q(g,b),F),P=A.qprime(g,b),L=h.mulMatrix(R,P),S=h.sum(h.squareItems(P))+2*h.mulMatrix(R,A.qprimeprime(g,b));return S===0?b:b-L/S}function l(g){var F=[],b,R,P;return g.forEach((L,S)=>{b=S?R+h.vectorLen(h.subtract(L,P)):0,F.push(b),R=b,P=L}),F=F.map(L=>L/R),F}function c(g,F,b){var R,P,L,S,x,v,M,O;P=0,L=Math.floor(g.length/2);let B=u(F,10);for(x=0,v=g.length;x<v;x++)M=g[x],O=p(F,b[x],B,10),S=h.subtract(A.q(F,O),M),R=S[0]*S[0]+S[1]*S[1],R>P&&(P=R,L=x);return[P,L]}var u=function(g,F){for(var b,R=[0],P=g[0],L=0,S=1;S<=F;S++)b=A.q(g,S/F),L+=h.vectorLen(h.subtract(b,P)),R.push(L),P=b;return R=R.map(x=>x/L),R};function p(g,F,b,R){if(F<0)return 0;if(F>1)return 1;for(var P,L,S,x,v,M=1;M<=R;M++)if(F<=b[M]){x=(M-1)/R,S=M/R,L=b[M-1],P=b[M],v=(F-L)/(P-L)*(S-x)+x;break}return v}function d(g,F){return h.normalize(h.subtract(g,F))}class h{static zeros_Xx2x2(F){for(var b=[];F--;)b.push([0,0]);return b}static mulItems(F,b){return F.map(R=>R*b)}static mulMatrix(F,b){return F.reduce((R,P,L)=>R+P*b[L],0)}static subtract(F,b){return F.map((R,P)=>R-b[P])}static addArrays(F,b){return F.map((R,P)=>R+b[P])}static addItems(F,b){return F.map(R=>R+b)}static sum(F){return F.reduce((b,R)=>b+R)}static dot(F,b){return h.mulMatrix(F,b)}static vectorLen(F){return Math.hypot(...F)}static divItems(F,b){return F.map(R=>R/b)}static squareItems(F){return F.map(b=>b*b)}static normalize(F){return this.divItems(F,this.vectorLen(F))}}class A{static q(F,b){var R=1-b,P=h.mulItems(F[0],R*R*R),L=h.mulItems(F[1],3*R*R*b),S=h.mulItems(F[2],3*R*b*b),x=h.mulItems(F[3],b*b*b);return h.addArrays(h.addArrays(P,L),h.addArrays(S,x))}static qprime(F,b){var R=1-b,P=h.mulItems(h.subtract(F[1],F[0]),3*R*R),L=h.mulItems(h.subtract(F[2],F[1]),6*R*b),S=h.mulItems(h.subtract(F[3],F[2]),3*b*b);return h.addArrays(h.addArrays(P,L),S)}static qprimeprime(F,b){return h.addArrays(h.mulItems(h.addArrays(h.subtract(F[2],h.mulItems(F[1],2)),F[0]),6*(1-b)),h.mulItems(h.addArrays(h.subtract(F[3],h.mulItems(F[2],2)),F[1]),6*b))}}n.exports=e,n.exports.fitCubic=t,n.exports.createTangent=d},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationLayer=void 0;var i=t(1),r=t(8),o=t(5),s=t(28),l=t(29);let c=1e3,u=9,p=new WeakSet;function d(W){return{width:W[2]-W[0],height:W[3]-W[1]}}class h{static create(m){switch(m.data.annotationType){case i.AnnotationType.LINK:return new g(m);case i.AnnotationType.TEXT:return new F(m);case i.AnnotationType.WIDGET:switch(m.data.fieldType){case"Tx":return new R(m);case"Btn":return m.data.radioButton?new L(m):m.data.checkBox?new P(m):new S(m);case"Ch":return new x(m)}return new b(m);case i.AnnotationType.POPUP:return new v(m);case i.AnnotationType.FREETEXT:return new O(m);case i.AnnotationType.LINE:return new B(m);case i.AnnotationType.SQUARE:return new X(m);case i.AnnotationType.CIRCLE:return new V(m);case i.AnnotationType.POLYLINE:return new J(m);case i.AnnotationType.CARET:return new G(m);case i.AnnotationType.INK:return new Y(m);case i.AnnotationType.POLYGON:return new ce(m);case i.AnnotationType.HIGHLIGHT:return new K(m);case i.AnnotationType.UNDERLINE:return new se(m);case i.AnnotationType.SQUIGGLY:return new $(m);case i.AnnotationType.STRIKEOUT:return new z(m);case i.AnnotationType.STAMP:return new k(m);case i.AnnotationType.FILEATTACHMENT:return new T(m);default:return new A(m)}}}class A{constructor(m,{isRenderable:_=!1,ignoreBorder:C=!1,createQuadrilaterals:I=!1}={}){this.isRenderable=_,this.data=m.data,this.layer=m.layer,this.page=m.page,this.viewport=m.viewport,this.linkService=m.linkService,this.downloadManager=m.downloadManager,this.imageResourcesPath=m.imageResourcesPath,this.renderForms=m.renderForms,this.svgFactory=m.svgFactory,this.annotationStorage=m.annotationStorage,this.enableScripting=m.enableScripting,this.hasJSActions=m.hasJSActions,this._fieldObjects=m.fieldObjects,this._mouseState=m.mouseState,_&&(this.container=this._createContainer(C)),I&&(this.quadrilaterals=this._createQuadrilaterals(C))}_createContainer(m=!1){let _=this.data,C=this.page,I=this.viewport,H=document.createElement("section"),{width:j,height:q}=d(_.rect),[Z,ae,ee,ue]=I.viewBox,_e=ee-Z,he=ue-ae;H.setAttribute("data-annotation-id",_.id);let ke=i.Util.normalizeRect([_.rect[0],C.view[3]-_.rect[1]+C.view[1],_.rect[2],C.view[3]-_.rect[3]+C.view[1]]);if(!m&&_.borderStyle.width>0){H.style.borderWidth=`${_.borderStyle.width}px`;let Ce=_.borderStyle.horizontalCornerRadius,Le=_.borderStyle.verticalCornerRadius;if(Ce>0||Le>0){let jt=`calc(${Ce}px * var(--scale-factor)) / calc(${Le}px * var(--scale-factor))`;H.style.borderRadius=jt}else if(this instanceof L){let jt=`calc(${j}px * var(--scale-factor)) / calc(${q}px * var(--scale-factor))`;H.style.borderRadius=jt}switch(_.borderStyle.style){case i.AnnotationBorderStyleType.SOLID:H.style.borderStyle="solid";break;case i.AnnotationBorderStyleType.DASHED:H.style.borderStyle="dashed";break;case i.AnnotationBorderStyleType.BEVELED:(0,i.warn)("Unimplemented border style: beveled");break;case i.AnnotationBorderStyleType.INSET:(0,i.warn)("Unimplemented border style: inset");break;case i.AnnotationBorderStyleType.UNDERLINE:H.style.borderBottomStyle="solid";break;default:break}let Fe=_.borderColor||null;Fe?H.style.borderColor=i.Util.makeHexColor(Fe[0]|0,Fe[1]|0,Fe[2]|0):H.style.borderWidth=0}H.style.left=`${100*(ke[0]-Z)/_e}%`,H.style.top=`${100*(ke[1]-ae)/he}%`;let{rotation:Me}=_;return _.hasOwnCanvas||Me===0?(H.style.width=`${100*j/_e}%`,H.style.height=`${100*q/he}%`):this.setRotation(Me,H),H}setRotation(m,_=this.container){let[C,I,H,j]=this.viewport.viewBox,q=H-C,Z=j-I,{width:ae,height:ee}=d(this.data.rect),ue,_e;m%180===0?(ue=100*ae/q,_e=100*ee/Z):(ue=100*ee/q,_e=100*ae/Z),_.style.width=`${ue}%`,_.style.height=`${_e}%`,_.setAttribute("data-main-rotation",(360-m)%360)}get _commonActions(){let m=(_,C,I)=>{let H=I.detail[_];I.target.style[C]=s.ColorConverters[`${H[0]}_HTML`](H.slice(1))};return(0,i.shadow)(this,"_commonActions",{display:_=>{let C=_.detail.display%2===1;this.container.style.visibility=C?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:C,print:_.detail.display===0||_.detail.display===3})},print:_=>{this.annotationStorage.setValue(this.data.id,{print:_.detail.print})},hidden:_=>{this.container.style.visibility=_.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:_.detail.hidden})},focus:_=>{setTimeout(()=>_.target.focus({preventScroll:!1}),0)},userName:_=>{_.target.title=_.detail.userName},readonly:_=>{_.detail.readonly?_.target.setAttribute("readonly",""):_.target.removeAttribute("readonly")},required:_=>{this._setRequired(_.target,_.detail.required)},bgColor:_=>{m("bgColor","backgroundColor",_)},fillColor:_=>{m("fillColor","backgroundColor",_)},fgColor:_=>{m("fgColor","color",_)},textColor:_=>{m("textColor","color",_)},borderColor:_=>{m("borderColor","borderColor",_)},strokeColor:_=>{m("strokeColor","borderColor",_)},rotation:_=>{let C=_.detail.rotation;this.setRotation(C),this.annotationStorage.setValue(this.data.id,{rotation:C})}})}_dispatchEventFromSandbox(m,_){let C=this._commonActions;for(let I of Object.keys(_.detail)){let H=m[I]||C[I];H&&H(_)}}_setDefaultPropertiesFromJS(m){if(!this.enableScripting)return;let _=this.annotationStorage.getRawValue(this.data.id);if(!_)return;let C=this._commonActions;for(let[I,H]of Object.entries(_)){let j=C[I];if(j){let q={detail:{[I]:H},target:m};j(q),delete _[I]}}}_createQuadrilaterals(m=!1){if(!this.data.quadPoints)return null;let _=[],C=this.data.rect;for(let I of this.data.quadPoints)this.data.rect=[I[2].x,I[2].y,I[1].x,I[1].y],_.push(this._createContainer(m));return this.data.rect=C,_}_createPopup(m,_){let C=this.container;this.quadrilaterals&&(m=m||this.quadrilaterals,C=this.quadrilaterals[0]),m||(m=document.createElement("div"),m.className="popupTriggerArea",C.append(m));let H=new M({container:C,trigger:m,color:_.color,titleObj:_.titleObj,modificationDate:_.modificationDate,contentsObj:_.contentsObj,richText:_.richText,hideWrapper:!0}).render();H.style.left="100%",C.append(H)}_renderQuadrilaterals(m){for(let _ of this.quadrilaterals)_.className=m;return this.quadrilaterals}render(){(0,i.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(m,_=null){let C=[];if(this._fieldObjects){let I=this._fieldObjects[m];if(I)for(let{page:H,id:j,exportValues:q}of I){if(H===-1||j===_)continue;let Z=typeof q=="string"?q:null,ae=document.querySelector(`[data-element-id="${j}"]`);if(ae&&!p.has(ae)){(0,i.warn)(`_getElementsByName - element not allowed: ${j}`);continue}C.push({id:j,exportValue:Z,domElement:ae})}return C}for(let I of document.getElementsByName(m)){let{id:H,exportValue:j}=I;H!==_&&p.has(I)&&C.push({id:H,exportValue:j,domElement:I})}return C}static get platform(){let m=typeof navigator<"u"?navigator.platform:"";return(0,i.shadow)(this,"platform",{isWin:m.includes("Win"),isMac:m.includes("Mac")})}}class g extends A{constructor(m,_=null){super(m,{isRenderable:!0,ignoreBorder:!!_?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=m.data.isTooltipOnly}render(){let{data:m,linkService:_}=this,C=document.createElement("a");C.setAttribute("data-element-id",m.id);let I=!1;return m.url?(_.addLinkAttributes(C,m.url,m.newWindow),I=!0):m.action?(this._bindNamedAction(C,m.action),I=!0):m.dest?(this._bindLink(C,m.dest),I=!0):(m.actions&&(m.actions.Action||m.actions["Mouse Up"]||m.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(C,m),I=!0),m.resetForm?(this._bindResetFormAction(C,m.resetForm),I=!0):this.isTooltipOnly&&!I&&(this._bindLink(C,""),I=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((H,j)=>{let q=j===0?C:C.cloneNode();return H.append(q),H}):(this.container.className="linkAnnotation",I&&this.container.append(C),this.container)}_bindLink(m,_){m.href=this.linkService.getDestinationHash(_),m.onclick=()=>(_&&this.linkService.goToDestination(_),!1),(_||_==="")&&(m.className="internalLink")}_bindNamedAction(m,_){m.href=this.linkService.getAnchorUrl(""),m.onclick=()=>(this.linkService.executeNamedAction(_),!1),m.className="internalLink"}_bindJSAction(m,_){m.href=this.linkService.getAnchorUrl("");let C=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let I of Object.keys(_.actions)){let H=C.get(I);H&&(m[H]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:_.id,name:I}}),!1))}m.onclick||(m.onclick=()=>!1),m.className="internalLink"}_bindResetFormAction(m,_){let C=m.onclick;if(C||(m.href=this.linkService.getAnchorUrl("")),m.className="internalLink",!this._fieldObjects){(0,i.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),C||(m.onclick=()=>!1);return}m.onclick=()=>{C&&C();let{fields:I,refs:H,include:j}=_,q=[];if(I.length!==0||H.length!==0){let ee=new Set(H);for(let ue of I){let _e=this._fieldObjects[ue]||[];for(let{id:he}of _e)ee.add(he)}for(let ue of Object.values(this._fieldObjects))for(let _e of ue)ee.has(_e.id)===j&&q.push(_e)}else for(let ee of Object.values(this._fieldObjects))q.push(...ee);let Z=this.annotationStorage,ae=[];for(let ee of q){let{id:ue}=ee;switch(ae.push(ue),ee.type){case"text":{let he=ee.defaultValue||"";Z.setValue(ue,{value:he});break}case"checkbox":case"radiobutton":{let he=ee.defaultValue===ee.exportValues;Z.setValue(ue,{value:he});break}case"combobox":case"listbox":{let he=ee.defaultValue||"";Z.setValue(ue,{value:he});break}default:continue}let _e=document.querySelector(`[data-element-id="${ue}"]`);if(_e){if(!p.has(_e)){(0,i.warn)(`_bindResetFormAction - element not allowed: ${ue}`);continue}}else continue;_e.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:ae,name:"ResetForm"}}),!1}}}class F extends A{constructor(m){let _=!!(m.data.hasPopup||m.data.titleObj?.str||m.data.contentsObj?.str||m.data.richText?.str);super(m,{isRenderable:_})}render(){this.container.className="textAnnotation";let m=document.createElement("img");return m.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",m.alt="[{{type}} Annotation]",m.dataset.l10nId="text_annotation_type",m.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(m,this.data),this.container.append(m),this.container}}class b extends A{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(m){let{isWin:_,isMac:C}=A.platform;return _&&m.ctrlKey||C&&m.metaKey}_setEventListener(m,_,C,I){_.includes("mouse")?m.addEventListener(_,H=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:C,value:I(H),shift:H.shiftKey,modifier:this._getKeyModifier(H)}})}):m.addEventListener(_,H=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:C,value:I(H)}})})}_setEventListeners(m,_,C){for(let[I,H]of _)(H==="Action"||this.data.actions?.[H])&&this._setEventListener(m,I,H,C)}_setBackgroundColor(m){let _=this.data.backgroundColor||null;m.style.backgroundColor=_===null?"transparent":i.Util.makeHexColor(_[0],_[1],_[2])}_setTextStyle(m){let _=["left","center","right"],{fontColor:C}=this.data.defaultAppearanceData,I=this.data.defaultAppearanceData.fontSize||u,H=m.style,j;if(this.data.multiLine){let q=Math.abs(this.data.rect[3]-this.data.rect[1]),Z=Math.round(q/(i.LINE_FACTOR*I))||1,ae=q/Z;j=Math.min(I,Math.round(ae/i.LINE_FACTOR))}else{let q=Math.abs(this.data.rect[3]-this.data.rect[1]);j=Math.min(I,Math.round(q/i.LINE_FACTOR))}H.fontSize=`calc(${j}px * var(--scale-factor))`,H.color=i.Util.makeHexColor(C[0],C[1],C[2]),this.data.textAlignment!==null&&(H.textAlign=_[this.data.textAlignment])}_setRequired(m,_){_?m.setAttribute("required",!0):m.removeAttribute("required"),m.setAttribute("aria-required",_)}}class R extends b{constructor(m){let _=m.renderForms||!m.data.hasAppearance&&!!m.data.fieldValue;super(m,{isRenderable:_})}setPropertyOnSiblings(m,_,C,I){let H=this.annotationStorage;for(let j of this._getElementsByName(m.name,m.id))j.domElement&&(j.domElement[_]=C),H.setValue(j.id,{[I]:C})}render(){let m=this.annotationStorage,_=this.data.id;this.container.className="textWidgetAnnotation";let C=null;if(this.renderForms){let I=m.getValue(_,{value:this.data.fieldValue}),H=I.formattedValue||I.value||"",j=m.getValue(_,{charLimit:this.data.maxLen}).charLimit;j&&H.length>j&&(H=H.slice(0,j));let q={userValue:H,formattedValue:null,valueOnFocus:""};this.data.multiLine?(C=document.createElement("textarea"),C.textContent=H,this.data.doNotScroll&&(C.style.overflowY="hidden")):(C=document.createElement("input"),C.type="text",C.setAttribute("value",H),this.data.doNotScroll&&(C.style.overflowX="hidden")),p.add(C),C.setAttribute("data-element-id",_),C.disabled=this.data.readOnly,C.name=this.data.fieldName,C.tabIndex=c,this._setRequired(C,this.data.required),j&&(C.maxLength=j),C.addEventListener("input",ae=>{m.setValue(_,{value:ae.target.value}),this.setPropertyOnSiblings(C,"value",ae.target.value,"value")}),C.addEventListener("resetform",ae=>{let ee=this.data.defaultFieldValue??"";C.value=q.userValue=ee,q.formattedValue=null});let Z=ae=>{let{formattedValue:ee}=q;ee!=null&&(ae.target.value=ee),ae.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){C.addEventListener("focus",ee=>{q.userValue&&(ee.target.value=q.userValue),q.valueOnFocus=ee.target.value}),C.addEventListener("updatefromsandbox",ee=>{let ue={value(_e){q.userValue=_e.detail.value??"",m.setValue(_,{value:q.userValue.toString()}),_e.target.value=q.userValue},formattedValue(_e){let{formattedValue:he}=_e.detail;q.formattedValue=he,he!=null&&_e.target!==document.activeElement&&(_e.target.value=he),m.setValue(_,{formattedValue:he})},selRange(_e){_e.target.setSelectionRange(..._e.detail.selRange)},charLimit:_e=>{let{charLimit:he}=_e.detail,{target:ke}=_e;if(he===0){ke.removeAttribute("maxLength");return}ke.setAttribute("maxLength",he);let Me=q.userValue;!Me||Me.length<=he||(Me=Me.slice(0,he),ke.value=q.userValue=Me,m.setValue(_,{value:Me}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:_,name:"Keystroke",value:Me,willCommit:!0,commitKey:1,selStart:ke.selectionStart,selEnd:ke.selectionEnd}}))}};this._dispatchEventFromSandbox(ue,ee)}),C.addEventListener("keydown",ee=>{let ue=-1;if(ee.key==="Escape"?ue=0:ee.key==="Enter"?ue=2:ee.key==="Tab"&&(ue=3),ue===-1)return;let{value:_e}=ee.target;q.valueOnFocus!==_e&&(q.userValue=_e,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:_,name:"Keystroke",value:_e,willCommit:!0,commitKey:ue,selStart:ee.target.selectionStart,selEnd:ee.target.selectionEnd}}))});let ae=Z;Z=null,C.addEventListener("blur",ee=>{let{value:ue}=ee.target;q.userValue=ue,this._mouseState.isDown&&q.valueOnFocus!==ue&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:_,name:"Keystroke",value:ue,willCommit:!0,commitKey:1,selStart:ee.target.selectionStart,selEnd:ee.target.selectionEnd}}),ae(ee)}),this.data.actions?.Keystroke&&C.addEventListener("beforeinput",ee=>{let{data:ue,target:_e}=ee,{value:he,selectionStart:ke,selectionEnd:Me}=_e,Ce=ke,Le=Me;switch(ee.inputType){case"deleteWordBackward":{let Fe=he.substring(0,ke).match(/\w*[^\w]*$/);Fe&&(Ce-=Fe[0].length);break}case"deleteWordForward":{let Fe=he.substring(ke).match(/^[^\w]*\w*/);Fe&&(Le+=Fe[0].length);break}case"deleteContentBackward":ke===Me&&(Ce-=1);break;case"deleteContentForward":ke===Me&&(Le+=1);break}ee.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:_,name:"Keystroke",value:he,change:ue||"",willCommit:!1,selStart:Ce,selEnd:Le}})}),this._setEventListeners(C,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ee=>ee.target.value)}if(Z&&C.addEventListener("blur",Z),this.data.comb){let ee=(this.data.rect[2]-this.data.rect[0])/j;C.classList.add("comb"),C.style.letterSpacing=`calc(${ee}px * var(--scale-factor) - 1ch)`}}else C=document.createElement("div"),C.textContent=this.data.fieldValue,C.style.verticalAlign="middle",C.style.display="table-cell";return this._setTextStyle(C),this._setBackgroundColor(C),this._setDefaultPropertiesFromJS(C),this.container.append(C),this.container}}class P extends b{constructor(m){super(m,{isRenderable:m.renderForms})}render(){let m=this.annotationStorage,_=this.data,C=_.id,I=m.getValue(C,{value:_.exportValue===_.fieldValue}).value;typeof I=="string"&&(I=I!=="Off",m.setValue(C,{value:I})),this.container.className="buttonWidgetAnnotation checkBox";let H=document.createElement("input");return p.add(H),H.setAttribute("data-element-id",C),H.disabled=_.readOnly,this._setRequired(H,this.data.required),H.type="checkbox",H.name=_.fieldName,I&&H.setAttribute("checked",!0),H.setAttribute("exportValue",_.exportValue),H.tabIndex=c,H.addEventListener("change",j=>{let{name:q,checked:Z}=j.target;for(let ae of this._getElementsByName(q,C)){let ee=Z&&ae.exportValue===_.exportValue;ae.domElement&&(ae.domElement.checked=ee),m.setValue(ae.id,{value:ee})}m.setValue(C,{value:Z})}),H.addEventListener("resetform",j=>{let q=_.defaultFieldValue||"Off";j.target.checked=q===_.exportValue}),this.enableScripting&&this.hasJSActions&&(H.addEventListener("updatefromsandbox",j=>{let q={value(Z){Z.target.checked=Z.detail.value!=="Off",m.setValue(C,{value:Z.target.checked})}};this._dispatchEventFromSandbox(q,j)}),this._setEventListeners(H,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],j=>j.target.checked)),this._setBackgroundColor(H),this._setDefaultPropertiesFromJS(H),this.container.append(H),this.container}}class L extends b{constructor(m){super(m,{isRenderable:m.renderForms})}render(){this.container.className="buttonWidgetAnnotation radioButton";let m=this.annotationStorage,_=this.data,C=_.id,I=m.getValue(C,{value:_.fieldValue===_.buttonValue}).value;typeof I=="string"&&(I=I!==_.buttonValue,m.setValue(C,{value:I}));let H=document.createElement("input");if(p.add(H),H.setAttribute("data-element-id",C),H.disabled=_.readOnly,this._setRequired(H,this.data.required),H.type="radio",H.name=_.fieldName,I&&H.setAttribute("checked",!0),H.tabIndex=c,H.addEventListener("change",j=>{let{name:q,checked:Z}=j.target;for(let ae of this._getElementsByName(q,C))m.setValue(ae.id,{value:!1});m.setValue(C,{value:Z})}),H.addEventListener("resetform",j=>{let q=_.defaultFieldValue;j.target.checked=q!=null&&q===_.buttonValue}),this.enableScripting&&this.hasJSActions){let j=_.buttonValue;H.addEventListener("updatefromsandbox",q=>{let Z={value:ae=>{let ee=j===ae.detail.value;for(let ue of this._getElementsByName(ae.target.name)){let _e=ee&&ue.id===C;ue.domElement&&(ue.domElement.checked=_e),m.setValue(ue.id,{value:_e})}}};this._dispatchEventFromSandbox(Z,q)}),this._setEventListeners(H,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],q=>q.target.checked)}return this._setBackgroundColor(H),this._setDefaultPropertiesFromJS(H),this.container.append(H),this.container}}class S extends g{constructor(m){super(m,{ignoreBorder:m.data.hasAppearance})}render(){let m=super.render();m.className="buttonWidgetAnnotation pushButton",this.data.alternativeText&&(m.title=this.data.alternativeText);let _=m.lastChild;return this.enableScripting&&this.hasJSActions&&_&&(this._setDefaultPropertiesFromJS(_),_.addEventListener("updatefromsandbox",C=>{this._dispatchEventFromSandbox({},C)})),m}}class x extends b{constructor(m){super(m,{isRenderable:m.renderForms})}render(){this.container.className="choiceWidgetAnnotation";let m=this.annotationStorage,_=this.data.id,C=m.getValue(_,{value:this.data.fieldValue}),I=document.createElement("select");p.add(I),I.setAttribute("data-element-id",_),I.disabled=this.data.readOnly,this._setRequired(I,this.data.required),I.name=this.data.fieldName,I.tabIndex=c;let H=this.data.combo&&this.data.options.length>0;this.data.combo||(I.size=this.data.options.length,this.data.multiSelect&&(I.multiple=!0)),I.addEventListener("resetform",ae=>{let ee=this.data.defaultFieldValue;for(let ue of I.options)ue.selected=ue.value===ee});for(let ae of this.data.options){let ee=document.createElement("option");ee.textContent=ae.displayValue,ee.value=ae.exportValue,C.value.includes(ae.exportValue)&&(ee.setAttribute("selected",!0),H=!1),I.append(ee)}let j=null;if(H){let ae=document.createElement("option");ae.value=" ",ae.setAttribute("hidden",!0),ae.setAttribute("selected",!0),I.prepend(ae),j=()=>{ae.remove(),I.removeEventListener("input",j),j=null},I.addEventListener("input",j)}let q=(ae,ee)=>{let ue=ee?"value":"textContent",_e=ae.target.options;return ae.target.multiple?Array.prototype.filter.call(_e,he=>he.selected).map(he=>he[ue]):_e.selectedIndex===-1?null:_e[_e.selectedIndex][ue]},Z=ae=>{let ee=ae.target.options;return Array.prototype.map.call(ee,ue=>({displayValue:ue.textContent,exportValue:ue.value}))};return this.enableScripting&&this.hasJSActions?(I.addEventListener("updatefromsandbox",ae=>{let ee={value(ue){j?.();let _e=ue.detail.value,he=new Set(Array.isArray(_e)?_e:[_e]);for(let ke of I.options)ke.selected=he.has(ke.value);m.setValue(_,{value:q(ue,!0)})},multipleSelection(ue){I.multiple=!0},remove(ue){let _e=I.options,he=ue.detail.remove;_e[he].selected=!1,I.remove(he),_e.length>0&&Array.prototype.findIndex.call(_e,Me=>Me.selected)===-1&&(_e[0].selected=!0),m.setValue(_,{value:q(ue,!0),items:Z(ue)})},clear(ue){for(;I.length!==0;)I.remove(0);m.setValue(_,{value:null,items:[]})},insert(ue){let{index:_e,displayValue:he,exportValue:ke}=ue.detail.insert,Me=I.children[_e],Ce=document.createElement("option");Ce.textContent=he,Ce.value=ke,Me?Me.before(Ce):I.append(Ce),m.setValue(_,{value:q(ue,!0),items:Z(ue)})},items(ue){let{items:_e}=ue.detail;for(;I.length!==0;)I.remove(0);for(let he of _e){let{displayValue:ke,exportValue:Me}=he,Ce=document.createElement("option");Ce.textContent=ke,Ce.value=Me,I.append(Ce)}I.options.length>0&&(I.options[0].selected=!0),m.setValue(_,{value:q(ue,!0),items:Z(ue)})},indices(ue){let _e=new Set(ue.detail.indices);for(let he of ue.target.options)he.selected=_e.has(he.index);m.setValue(_,{value:q(ue,!0)})},editable(ue){ue.target.disabled=!ue.detail.editable}};this._dispatchEventFromSandbox(ee,ae)}),I.addEventListener("input",ae=>{let ee=q(ae,!0),ue=q(ae,!1);m.setValue(_,{value:ee}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:_,name:"Keystroke",value:ue,changeEx:ee,willCommit:!0,commitKey:1,keyDown:!1}})}),this._setEventListeners(I,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"]],ae=>ae.target.checked)):I.addEventListener("input",function(ae){m.setValue(_,{value:q(ae,!0)})}),this.data.combo&&this._setTextStyle(I),this._setBackgroundColor(I),this._setDefaultPropertiesFromJS(I),this.container.append(I),this.container}}class v extends A{constructor(m){let _=!!(m.data.titleObj?.str||m.data.contentsObj?.str||m.data.richText?.str);super(m,{isRenderable:_})}render(){let m=["Line","Square","Circle","PolyLine","Polygon","Ink"];if(this.container.className="popupAnnotation",m.includes(this.data.parentType))return this.container;let _=`[data-annotation-id="${this.data.parentId}"]`,C=this.layer.querySelectorAll(_);if(C.length===0)return this.container;let I=new M({container:this.container,trigger:Array.from(C),color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText}),H=this.page,j=i.Util.normalizeRect([this.data.parentRect[0],H.view[3]-this.data.parentRect[1]+H.view[1],this.data.parentRect[2],H.view[3]-this.data.parentRect[3]+H.view[1]]),q=j[0]+this.data.parentRect[2]-this.data.parentRect[0],Z=j[1],[ae,ee,ue,_e]=this.viewport.viewBox,he=ue-ae,ke=_e-ee;return this.container.style.left=`${100*(q-ae)/he}%`,this.container.style.top=`${100*(Z-ee)/ke}%`,this.container.append(I.render()),this.container}}class M{constructor(m){this.container=m.container,this.trigger=m.trigger,this.color=m.color,this.titleObj=m.titleObj,this.modificationDate=m.modificationDate,this.contentsObj=m.contentsObj,this.richText=m.richText,this.hideWrapper=m.hideWrapper||!1,this.pinned=!1}render(){let _=document.createElement("div");_.className="popupWrapper",this.hideElement=this.hideWrapper?_:this.container,this.hideElement.hidden=!0;let C=document.createElement("div");C.className="popup";let I=this.color;if(I){let q=.7*(255-I[0])+I[0],Z=.7*(255-I[1])+I[1],ae=.7*(255-I[2])+I[2];C.style.backgroundColor=i.Util.makeHexColor(q|0,Z|0,ae|0)}let H=document.createElement("h1");H.dir=this.titleObj.dir,H.textContent=this.titleObj.str,C.append(H);let j=r.PDFDateString.toDateObject(this.modificationDate);if(j){let q=document.createElement("span");q.className="popupDate",q.textContent="{{date}}, {{time}}",q.dataset.l10nId="annotation_date_string",q.dataset.l10nArgs=JSON.stringify({date:j.toLocaleDateString(),time:j.toLocaleTimeString()}),C.append(q)}if(this.richText?.str&&(!this.contentsObj?.str||this.contentsObj.str===this.richText.str))l.XfaLayer.render({xfaHtml:this.richText.html,intent:"richText",div:C}),C.lastChild.className="richText popupContent";else{let q=this._formatContents(this.contentsObj);C.append(q)}Array.isArray(this.trigger)||(this.trigger=[this.trigger]);for(let q of this.trigger)q.addEventListener("click",this._toggle.bind(this)),q.addEventListener("mouseover",this._show.bind(this,!1)),q.addEventListener("mouseout",this._hide.bind(this,!1));return C.addEventListener("click",this._hide.bind(this,!0)),_.append(C),_}_formatContents({str:m,dir:_}){let C=document.createElement("p");C.className="popupContent",C.dir=_;let I=m.split(/(?:\r\n?|\n)/);for(let H=0,j=I.length;H<j;++H){let q=I[H];C.append(document.createTextNode(q)),H<j-1&&C.append(document.createElement("br"))}return C}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(m=!1){m&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex=parseInt(this.container.style.zIndex)+1e3)}_hide(m=!0){m&&(this.pinned=!1),!this.hideElement.hidden&&!this.pinned&&(this.hideElement.hidden=!0,this.container.style.zIndex=parseInt(this.container.style.zIndex)-1e3)}}class O extends A{constructor(m){let _=!!(m.data.hasPopup||m.data.titleObj?.str||m.data.contentsObj?.str||m.data.richText?.str);super(m,{isRenderable:_,ignoreBorder:!0}),this.textContent=m.data.textContent}render(){if(this.container.className="freeTextAnnotation",this.textContent){let m=document.createElement("div");m.className="annotationTextContent",m.setAttribute("role","comment");for(let _ of this.textContent){let C=document.createElement("span");C.textContent=_,m.append(C)}this.container.append(m)}return this.data.hasPopup||this._createPopup(null,this.data),this.container}}class B extends A{constructor(m){let _=!!(m.data.hasPopup||m.data.titleObj?.str||m.data.contentsObj?.str||m.data.richText?.str);super(m,{isRenderable:_,ignoreBorder:!0})}render(){this.container.className="lineAnnotation";let m=this.data,{width:_,height:C}=d(m.rect),I=this.svgFactory.create(_,C,!0),H=this.svgFactory.createElement("svg:line");return H.setAttribute("x1",m.rect[2]-m.lineCoordinates[0]),H.setAttribute("y1",m.rect[3]-m.lineCoordinates[1]),H.setAttribute("x2",m.rect[2]-m.lineCoordinates[2]),H.setAttribute("y2",m.rect[3]-m.lineCoordinates[3]),H.setAttribute("stroke-width",m.borderStyle.width||1),H.setAttribute("stroke","transparent"),H.setAttribute("fill","transparent"),I.append(H),this.container.append(I),this._createPopup(H,m),this.container}}class X extends A{constructor(m){let _=!!(m.data.hasPopup||m.data.titleObj?.str||m.data.contentsObj?.str||m.data.richText?.str);super(m,{isRenderable:_,ignoreBorder:!0})}render(){this.container.className="squareAnnotation";let m=this.data,{width:_,height:C}=d(m.rect),I=this.svgFactory.create(_,C,!0),H=m.borderStyle.width,j=this.svgFactory.createElement("svg:rect");return j.setAttribute("x",H/2),j.setAttribute("y",H/2),j.setAttribute("width",_-H),j.setAttribute("height",C-H),j.setAttribute("stroke-width",H||1),j.setAttribute("stroke","transparent"),j.setAttribute("fill","transparent"),I.append(j),this.container.append(I),this._createPopup(j,m),this.container}}class V extends A{constructor(m){let _=!!(m.data.hasPopup||m.data.titleObj?.str||m.data.contentsObj?.str||m.data.richText?.str);super(m,{isRenderable:_,ignoreBorder:!0})}render(){this.container.className="circleAnnotation";let m=this.data,{width:_,height:C}=d(m.rect),I=this.svgFactory.create(_,C,!0),H=m.borderStyle.width,j=this.svgFactory.createElement("svg:ellipse");return j.setAttribute("cx",_/2),j.setAttribute("cy",C/2),j.setAttribute("rx",_/2-H/2),j.setAttribute("ry",C/2-H/2),j.setAttribute("stroke-width",H||1),j.setAttribute("stroke","transparent"),j.setAttribute("fill","transparent"),I.append(j),this.container.append(I),this._createPopup(j,m),this.container}}class J extends A{constructor(m){let _=!!(m.data.hasPopup||m.data.titleObj?.str||m.data.contentsObj?.str||m.data.richText?.str);super(m,{isRenderable:_,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;let m=this.data,{width:_,height:C}=d(m.rect),I=this.svgFactory.create(_,C,!0),H=[];for(let q of m.vertices){let Z=q.x-m.rect[0],ae=m.rect[3]-q.y;H.push(Z+","+ae)}H=H.join(" ");let j=this.svgFactory.createElement(this.svgElementName);return j.setAttribute("points",H),j.setAttribute("stroke-width",m.borderStyle.width||1),j.setAttribute("stroke","transparent"),j.setAttribute("fill","transparent"),I.append(j),this.container.append(I),this._createPopup(j,m),this.container}}class ce extends J{constructor(m){super(m),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class G extends A{constructor(m){let _=!!(m.data.hasPopup||m.data.titleObj?.str||m.data.contentsObj?.str||m.data.richText?.str);super(m,{isRenderable:_,ignoreBorder:!0})}render(){return this.container.className="caretAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class Y extends A{constructor(m){let _=!!(m.data.hasPopup||m.data.titleObj?.str||m.data.contentsObj?.str||m.data.richText?.str);super(m,{isRenderable:_,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;let m=this.data,{width:_,height:C}=d(m.rect),I=this.svgFactory.create(_,C,!0);for(let H of m.inkLists){let j=[];for(let Z of H){let ae=Z.x-m.rect[0],ee=m.rect[3]-Z.y;j.push(`${ae},${ee}`)}j=j.join(" ");let q=this.svgFactory.createElement(this.svgElementName);q.setAttribute("points",j),q.setAttribute("stroke-width",m.borderStyle.width||1),q.setAttribute("stroke","transparent"),q.setAttribute("fill","transparent"),this._createPopup(q,m),I.append(q)}return this.container.append(I),this.container}}class K extends A{constructor(m){let _=!!(m.data.hasPopup||m.data.titleObj?.str||m.data.contentsObj?.str||m.data.richText?.str);super(m,{isRenderable:_,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.className="highlightAnnotation",this.container)}}class se extends A{constructor(m){let _=!!(m.data.hasPopup||m.data.titleObj?.str||m.data.contentsObj?.str||m.data.richText?.str);super(m,{isRenderable:_,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.className="underlineAnnotation",this.container)}}class $ extends A{constructor(m){let _=!!(m.data.hasPopup||m.data.titleObj?.str||m.data.contentsObj?.str||m.data.richText?.str);super(m,{isRenderable:_,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.className="squigglyAnnotation",this.container)}}class z extends A{constructor(m){let _=!!(m.data.hasPopup||m.data.titleObj?.str||m.data.contentsObj?.str||m.data.richText?.str);super(m,{isRenderable:_,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.className="strikeoutAnnotation",this.container)}}class k extends A{constructor(m){let _=!!(m.data.hasPopup||m.data.titleObj?.str||m.data.contentsObj?.str||m.data.richText?.str);super(m,{isRenderable:_,ignoreBorder:!0})}render(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class T extends A{constructor(m){super(m,{isRenderable:!0});let{filename:_,content:C}=this.data.file;this.filename=(0,r.getFilenameFromUrl)(_),this.content=C,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:_,content:C})}render(){this.container.className="fileAttachmentAnnotation";let m=document.createElement("div");return m.className="popupTriggerArea",m.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&(this.data.titleObj?.str||this.data.contentsObj?.str||this.data.richText)&&this._createPopup(m,this.data),this.container.append(m),this.container}_download(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)}}class N{static#e(m,_,C,I){let H=m.firstChild||m;H.id=`${r.AnnotationPrefix}${_}`,C.append(m),I?.moveElementInDOM(C,m,H,!1)}static render(m){let{annotations:_,div:C,viewport:I,accessibilityManager:H}=m;this.#t(C,I);let j=0;for(let q of _){if(q.annotationType!==i.AnnotationType.POPUP){let{width:ae,height:ee}=d(q.rect);if(ae<=0||ee<=0)continue}let Z=h.create({data:q,layer:C,page:m.page,viewport:I,linkService:m.linkService,downloadManager:m.downloadManager,imageResourcesPath:m.imageResourcesPath||"",renderForms:m.renderForms!==!1,svgFactory:new r.DOMSVGFactory,annotationStorage:m.annotationStorage||new o.AnnotationStorage,enableScripting:m.enableScripting,hasJSActions:m.hasJSActions,fieldObjects:m.fieldObjects,mouseState:m.mouseState||{isDown:!1}});if(Z.isRenderable){let ae=Z.render();if(q.hidden&&(ae.style.visibility="hidden"),Array.isArray(ae))for(let ee of ae)ee.style.zIndex=j++,N.#e(ee,q.id,C,H);else ae.style.zIndex=j++,Z instanceof v?C.prepend(ae):N.#e(ae,q.id,C,H)}}this.#r(C,m.annotationCanvasMap)}static update(m){let{annotationCanvasMap:_,div:C,viewport:I}=m;this.#t(C,I),this.#r(C,_),C.hidden=!1}static#t(m,{width:_,height:C,rotation:I}){let{style:H}=m,j=I%180!==0,q=Math.floor(_)+"px",Z=Math.floor(C)+"px";H.width=j?Z:q,H.height=j?q:Z,m.setAttribute("data-main-rotation",I)}static#r(m,_){if(_){for(let[C,I]of _){let H=m.querySelector(`[data-annotation-id="${C}"]`);if(!H)continue;let{firstChild:j}=H;j?j.nodeName==="CANVAS"?j.replaceWith(I):j.before(I):H.append(I)}_.clear()}}}e.AnnotationLayer=N},(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorConverters=void 0;function t(r){return Math.floor(Math.max(0,Math.min(1,r))*255).toString(16).padStart(2,"0")}class i{static CMYK_G([o,s,l,c]){return["G",1-Math.min(1,.3*o+.59*l+.11*s+c)]}static G_CMYK([o]){return["CMYK",0,0,0,1-o]}static G_RGB([o]){return["RGB",o,o,o]}static G_HTML([o]){let s=t(o);return`#${s}${s}${s}`}static RGB_G([o,s,l]){return["G",.3*o+.59*s+.11*l]}static RGB_HTML([o,s,l]){let c=t(o),u=t(s),p=t(l);return`#${c}${u}${p}`}static T_HTML(){return"#00000000"}static CMYK_RGB([o,s,l,c]){return["RGB",1-Math.min(1,o+c),1-Math.min(1,l+c),1-Math.min(1,s+c)]}static CMYK_HTML(o){let s=this.CMYK_RGB(o).slice(1);return this.RGB_HTML(s)}static RGB_CMYK([o,s,l]){let c=1-o,u=1-s,p=1-l,d=Math.min(c,u,p);return["CMYK",c,u,p,d]}}e.ColorConverters=i},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaLayer=void 0;var i=t(20);class r{static setupStorage(s,l,c,u,p){let d=u.getValue(l,{value:null});switch(c.name){case"textarea":if(d.value!==null&&(s.textContent=d.value),p==="print")break;s.addEventListener("input",h=>{u.setValue(l,{value:h.target.value})});break;case"input":if(c.attributes.type==="radio"||c.attributes.type==="checkbox"){if(d.value===c.attributes.xfaOn?s.setAttribute("checked",!0):d.value===c.attributes.xfaOff&&s.removeAttribute("checked"),p==="print")break;s.addEventListener("change",h=>{u.setValue(l,{value:h.target.checked?h.target.getAttribute("xfaOn"):h.target.getAttribute("xfaOff")})})}else{if(d.value!==null&&s.setAttribute("value",d.value),p==="print")break;s.addEventListener("input",h=>{u.setValue(l,{value:h.target.value})})}break;case"select":if(d.value!==null)for(let h of c.children)h.attributes.value===d.value&&(h.attributes.selected=!0);s.addEventListener("input",h=>{let A=h.target.options,g=A.selectedIndex===-1?"":A[A.selectedIndex].value;u.setValue(l,{value:g})});break}}static setAttributes({html:s,element:l,storage:c=null,intent:u,linkService:p}){let{attributes:d}=l,h=s instanceof HTMLAnchorElement;d.type==="radio"&&(d.name=`${d.name}-${u}`);for(let[A,g]of Object.entries(d))if(g!=null)switch(A){case"class":g.length&&s.setAttribute(A,g.join(" "));break;case"dataId":break;case"id":s.setAttribute("data-element-id",g);break;case"style":Object.assign(s.style,g);break;case"textContent":s.textContent=g;break;default:(!h||A!=="href"&&A!=="newWindow")&&s.setAttribute(A,g)}h&&p.addLinkAttributes(s,d.href,d.newWindow),c&&d.dataId&&this.setupStorage(s,d.dataId,l,c)}static render(s){let l=s.annotationStorage,c=s.linkService,u=s.xfaHtml,p=s.intent||"display",d=document.createElement(u.name);u.attributes&&this.setAttributes({html:d,element:u,intent:p,linkService:c});let h=[[u,-1,d]],A=s.div;if(A.append(d),s.viewport){let F=`matrix(${s.viewport.transform.join(",")})`;A.style.transform=F}p!=="richText"&&A.setAttribute("class","xfaLayer xfaFont");let g=[];for(;h.length>0;){let[F,b,R]=h.at(-1);if(b+1===F.children.length){h.pop();continue}let P=F.children[++h.at(-1)[1]];if(P===null)continue;let{name:L}=P;if(L==="#text"){let x=document.createTextNode(P.value);g.push(x),R.append(x);continue}let S;if(P?.attributes?.xmlns?S=document.createElementNS(P.attributes.xmlns,L):S=document.createElement(L),R.append(S),P.attributes&&this.setAttributes({html:S,element:P,storage:l,intent:p,linkService:c}),P.children&&P.children.length>0)h.push([P,-1,S]);else if(P.value){let x=document.createTextNode(P.value);i.XfaText.shouldBuildText(L)&&g.push(x),S.append(x)}}for(let F of A.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))F.setAttribute("readOnly",!0);return{textDivs:g}}static update(s){let l=`matrix(${s.viewport.transform.join(",")})`;s.div.style.transform=l,s.div.hidden=!1}}e.XfaLayer=r},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TextLayerRenderTask=void 0,e.renderTextLayer=P;var i=t(1),r=t(8);let o=1e5,s=30,l=.8,c=new Map,u=/^\s+$/g;function p(L,S){let x=c.get(L);if(x)return x;S.save(),S.font=`${s}px ${L}`;let v=S.measureText(""),M=v.fontBoundingBoxAscent,O=Math.abs(v.fontBoundingBoxDescent);if(M){S.restore();let X=M/(M+O);return c.set(L,X),X}S.strokeStyle="red",S.clearRect(0,0,s,s),S.strokeText("g",0,0);let B=S.getImageData(0,0,s,s).data;O=0;for(let X=B.length-1-3;X>=0;X-=4)if(B[X]>0){O=Math.ceil(X/4/s);break}S.clearRect(0,0,s,s),S.strokeText("A",0,s),B=S.getImageData(0,0,s,s).data,M=0;for(let X=0,V=B.length;X<V;X+=4)if(B[X]>0){M=s-Math.floor(X/4/s);break}if(S.restore(),M){let X=M/(M+O);return c.set(L,X),X}return c.set(L,l),l}function d(L,S,x,v){let M=document.createElement("span"),O=L._enhanceTextSelection?{angle:0,canvasWidth:0,hasText:S.str!=="",hasEOL:S.hasEOL,originalTransform:null,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,scale:1,fontSize:0}:{angle:0,canvasWidth:0,hasText:S.str!=="",hasEOL:S.hasEOL,fontSize:0};L._textDivs.push(M);let B=i.Util.transform(L._viewport.transform,S.transform),X=Math.atan2(B[1],B[0]),V=x[S.fontName];V.vertical&&(X+=Math.PI/2);let J=Math.hypot(B[2],B[3]),ce=J*p(V.fontFamily,v),G,Y;X===0?(G=B[4],Y=B[5]-ce):(G=B[4]+ce*Math.sin(X),Y=B[5]-ce*Math.cos(X)),M.style.left=`${G}px`,M.style.top=`${Y}px`,M.style.fontSize=`${J}px`,M.style.fontFamily=V.fontFamily,O.fontSize=J,M.setAttribute("role","presentation"),M.textContent=S.str,M.dir=S.dir,L._fontInspectorEnabled&&(M.dataset.fontName=S.fontName),X!==0&&(O.angle=X*(180/Math.PI));let K=!1;if(S.str.length>1||L._enhanceTextSelection&&u.test(S.str))K=!0;else if(S.str!==" "&&S.transform[0]!==S.transform[3]){let se=Math.abs(S.transform[0]),$=Math.abs(S.transform[3]);se!==$&&Math.max(se,$)/Math.min(se,$)>1.5&&(K=!0)}if(K&&(V.vertical?O.canvasWidth=S.height*L._viewport.scale:O.canvasWidth=S.width*L._viewport.scale),L._textDivProperties.set(M,O),L._textContentStream&&L._layoutText(M),L._enhanceTextSelection&&O.hasText){let se=1,$=0;X!==0&&(se=Math.cos(X),$=Math.sin(X));let z=(V.vertical?S.height:S.width)*L._viewport.scale,k=J,T,N;X!==0?(T=[se,$,-$,se,G,Y],N=i.Util.getAxialAlignedBoundingBox([0,0,z,k],T)):N=[G,Y,G+z,Y+k],L._bounds.push({left:N[0],top:N[1],right:N[2],bottom:N[3],div:M,size:[z,k],m:T})}}function h(L){if(L._canceled)return;let S=L._textDivs,x=L._capability,v=S.length;if(v>o){L._renderingDone=!0,x.resolve();return}if(!L._textContentStream)for(let M=0;M<v;M++)L._layoutText(S[M]);L._renderingDone=!0,x.resolve()}function A(L,S,x){let v=0;for(let M=0;M<x;M++){let O=L[S++];O>0&&(v=v?Math.min(O,v):O)}return v}function g(L){let S=L._bounds,x=L._viewport,v=F(x.width,x.height,S);for(let M=0;M<v.length;M++){let O=S[M].div,B=L._textDivProperties.get(O);if(B.angle===0){B.paddingLeft=S[M].left-v[M].left,B.paddingTop=S[M].top-v[M].top,B.paddingRight=v[M].right-S[M].right,B.paddingBottom=v[M].bottom-S[M].bottom,L._textDivProperties.set(O,B);continue}let X=v[M],V=S[M],J=V.m,ce=J[0],G=J[1],Y=[[0,0],[0,V.size[1]],[V.size[0],0],V.size],K=new Float64Array(64);for(let $=0,z=Y.length;$<z;$++){let k=i.Util.applyTransform(Y[$],J);K[$+0]=ce&&(X.left-k[0])/ce,K[$+4]=G&&(X.top-k[1])/G,K[$+8]=ce&&(X.right-k[0])/ce,K[$+12]=G&&(X.bottom-k[1])/G,K[$+16]=G&&(X.left-k[0])/-G,K[$+20]=ce&&(X.top-k[1])/ce,K[$+24]=G&&(X.right-k[0])/-G,K[$+28]=ce&&(X.bottom-k[1])/ce,K[$+32]=ce&&(X.left-k[0])/-ce,K[$+36]=G&&(X.top-k[1])/-G,K[$+40]=ce&&(X.right-k[0])/-ce,K[$+44]=G&&(X.bottom-k[1])/-G,K[$+48]=G&&(X.left-k[0])/G,K[$+52]=ce&&(X.top-k[1])/-ce,K[$+56]=G&&(X.right-k[0])/G,K[$+60]=ce&&(X.bottom-k[1])/-ce}let se=1+Math.min(Math.abs(ce),Math.abs(G));B.paddingLeft=A(K,32,16)/se,B.paddingTop=A(K,48,16)/se,B.paddingRight=A(K,0,16)/se,B.paddingBottom=A(K,16,16)/se,L._textDivProperties.set(O,B)}}function F(L,S,x){let v=x.map(function(O,B){return{x1:O.left,y1:O.top,x2:O.right,y2:O.bottom,index:B,x1New:void 0,x2New:void 0}});b(L,v);let M=new Array(x.length);for(let O of v){let B=O.index;M[B]={left:O.x1New,top:0,right:O.x2New,bottom:0}}x.map(function(O,B){let X=M[B],V=v[B];V.x1=O.top,V.y1=L-X.right,V.x2=O.bottom,V.y2=L-X.left,V.index=B,V.x1New=void 0,V.x2New=void 0}),b(S,v);for(let O of v){let B=O.index;M[B].top=O.x1New,M[B].bottom=O.x2New}return M}function b(L,S){S.sort(function(M,O){return M.x1-O.x1||M.index-O.index});let v=[{start:-1/0,end:1/0,boundary:{x1:-1/0,y1:-1/0,x2:0,y2:1/0,index:-1,x1New:0,x2New:0}}];for(let M of S){let O=0;for(;O<v.length&&v[O].end<=M.y1;)O++;let B=v.length-1;for(;B>=0&&v[B].start>=M.y2;)B--;let X,V,J,ce,G=-1/0;for(J=O;J<=B;J++){X=v[J],V=X.boundary;let se;V.x2>M.x1?se=V.index>M.index?V.x1New:M.x1:V.x2New===void 0?se=(V.x2+M.x1)/2:se=V.x2New,se>G&&(G=se)}for(M.x1New=G,J=O;J<=B;J++)X=v[J],V=X.boundary,V.x2New===void 0?V.x2>M.x1?V.index>M.index&&(V.x2New=V.x2):V.x2New=G:V.x2New>G&&(V.x2New=Math.max(G,V.x2));let Y=[],K=null;for(J=O;J<=B;J++){X=v[J],V=X.boundary;let se=V.x2>M.x2?V:M;K===se?Y.at(-1).end=X.end:(Y.push({start:X.start,end:X.end,boundary:se}),K=se)}for(v[O].start<M.y1&&(Y[0].start=M.y1,Y.unshift({start:v[O].start,end:M.y1,boundary:v[O].boundary})),M.y2<v[B].end&&(Y.at(-1).end=M.y2,Y.push({start:M.y2,end:v[B].end,boundary:v[B].boundary})),J=O;J<=B;J++){if(X=v[J],V=X.boundary,V.x2New!==void 0)continue;let se=!1;for(ce=O-1;!se&&ce>=0&&v[ce].start>=V.y1;ce--)se=v[ce].boundary===V;for(ce=B+1;!se&&ce<v.length&&v[ce].end<=V.y2;ce++)se=v[ce].boundary===V;for(ce=0;!se&&ce<Y.length;ce++)se=Y[ce].boundary===V;se||(V.x2New=G)}Array.prototype.splice.apply(v,[O,B-O+1,...Y])}for(let M of v){let O=M.boundary;O.x2New===void 0&&(O.x2New=Math.max(L,O.x2))}}class R{constructor({textContent:S,textContentStream:x,container:v,viewport:M,textDivs:O,textContentItemsStr:B,enhanceTextSelection:X}){X&&(0,r.deprecated)("The `enhanceTextSelection` functionality will be removed in the future."),this._textContent=S,this._textContentStream=x,this._container=v,this._document=v.ownerDocument,this._viewport=M,this._textDivs=O||[],this._textContentItemsStr=B||[],this._enhanceTextSelection=!!X,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._layoutTextLastFontSize=null,this._layoutTextLastFontFamily=null,this._layoutTextCtx=null,this._textDivProperties=new WeakMap,this._renderingDone=!1,this._canceled=!1,this._capability=(0,i.createPromiseCapability)(),this._renderTimer=null,this._bounds=[],this._devicePixelRatio=globalThis.devicePixelRatio||1,this._capability.promise.finally(()=>{this._enhanceTextSelection||(this._textDivProperties=null),this._layoutTextCtx&&(this._layoutTextCtx.canvas.width=0,this._layoutTextCtx.canvas.height=0,this._layoutTextCtx=null)}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new i.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._renderTimer!==null&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._capability.reject(new Error("TextLayer task cancelled."))}_processItems(S,x){for(let v=0,M=S.length;v<M;v++){if(S[v].str===void 0){if(S[v].type==="beginMarkedContentProps"||S[v].type==="beginMarkedContent"){let O=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),S[v].id!==null&&this._container.setAttribute("id",`${S[v].id}`),O.append(this._container)}else S[v].type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(S[v].str),d(this,S[v],x,this._layoutTextCtx)}}_layoutText(S){let x=this._textDivProperties.get(S),v="";if(x.canvasWidth!==0&&x.hasText){let{fontFamily:M}=S.style,{fontSize:O}=x;(O!==this._layoutTextLastFontSize||M!==this._layoutTextLastFontFamily)&&(this._layoutTextCtx.font=`${O*this._devicePixelRatio}px ${M}`,this._layoutTextLastFontSize=O,this._layoutTextLastFontFamily=M);let{width:B}=this._layoutTextCtx.measureText(S.textContent);if(B>0){let X=this._devicePixelRatio*x.canvasWidth/B;this._enhanceTextSelection&&(x.scale=X),v=`scaleX(${X})`}}if(x.angle!==0&&(v=`rotate(${x.angle}deg) ${v}`),v.length>0&&(this._enhanceTextSelection&&(x.originalTransform=v),S.style.transform=v),x.hasText&&this._container.append(S),x.hasEOL){let M=document.createElement("br");M.setAttribute("role","presentation"),this._container.append(M)}}_render(S=0){let x=(0,i.createPromiseCapability)(),v=Object.create(null),M=this._document.createElement("canvas");if(M.height=M.width=s,this._layoutTextCtx=M.getContext("2d",{alpha:!1}),this._textContent){let O=this._textContent.items,B=this._textContent.styles;this._processItems(O,B),x.resolve()}else if(this._textContentStream){let O=()=>{this._reader.read().then(({value:B,done:X})=>{if(X){x.resolve();return}Object.assign(v,B.styles),this._processItems(B.items,v),O()},x.reject)};this._reader=this._textContentStream.getReader(),O()}else throw new Error('Neither "textContent" nor "textContentStream" parameters specified.');x.promise.then(()=>{v=null,S?this._renderTimer=setTimeout(()=>{h(this),this._renderTimer=null},S):h(this)},this._capability.reject)}expandTextDivs(S=!1){if(!this._enhanceTextSelection||!this._renderingDone)return;this._bounds!==null&&(g(this),this._bounds=null);let x=[],v=[];for(let M=0,O=this._textDivs.length;M<O;M++){let B=this._textDivs[M],X=this._textDivProperties.get(B);X.hasText&&(S?(x.length=0,v.length=0,X.originalTransform&&x.push(X.originalTransform),X.paddingTop>0?(v.push(`${X.paddingTop}px`),x.push(`translateY(${-X.paddingTop}px)`)):v.push(0),X.paddingRight>0?v.push(`${X.paddingRight/X.scale}px`):v.push(0),X.paddingBottom>0?v.push(`${X.paddingBottom}px`):v.push(0),X.paddingLeft>0?(v.push(`${X.paddingLeft/X.scale}px`),x.push(`translateX(${-X.paddingLeft/X.scale}px)`)):v.push(0),B.style.padding=v.join(" "),x.length&&(B.style.transform=x.join(" "))):(B.style.padding=null,B.style.transform=X.originalTransform))}}}e.TextLayerRenderTask=R;function P(L){let S=new R({textContent:L.textContent,textContentStream:L.textContentStream,container:L.container,viewport:L.viewport,textDivs:L.textDivs,textContentItemsStr:L.textContentItemsStr,enhanceTextSelection:L.enhanceTextSelection});return S._render(L.timeout),S}},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SVGGraphics=void 0;var i=t(8),r=t(1),o=t(3);let s=class{constructor(){(0,r.unreachable)("Not implemented: SVGGraphics")}};e.SVGGraphics=s;{let F=function(x){let v=[],M=[];for(let O of x){if(O.fn==="save"){v.push({fnId:92,fn:"group",items:[]}),M.push(v),v=v.at(-1).items;continue}O.fn==="restore"?v=M.pop():v.push(O)}return v},b=function(x){if(Number.isInteger(x))return x.toString();let v=x.toFixed(10),M=v.length-1;if(v[M]!=="0")return v;do M--;while(v[M]==="0");return v.substring(0,v[M]==="."?M:M+1)},R=function(x){if(x[4]===0&&x[5]===0){if(x[1]===0&&x[2]===0)return x[0]===1&&x[3]===1?"":`scale(${b(x[0])} ${b(x[3])})`;if(x[0]===x[3]&&x[1]===-x[2]){let v=Math.acos(x[0])*180/Math.PI;return`rotate(${b(v)})`}}else if(x[0]===1&&x[1]===0&&x[2]===0&&x[3]===1)return`translate(${b(x[4])} ${b(x[5])})`;return`matrix(${b(x[0])} ${b(x[1])} ${b(x[2])} ${b(x[3])} ${b(x[4])} ${b(x[5])})`},l={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},c="http://www.w3.org/XML/1998/namespace",u="http://www.w3.org/1999/xlink",p=["butt","round","square"],d=["miter","round","bevel"],h=function(x,v="",M=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!M)return URL.createObjectURL(new Blob([x],{type:v}));let O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",B=`data:${v};base64,`;for(let X=0,V=x.length;X<V;X+=3){let J=x[X]&255,ce=x[X+1]&255,G=x[X+2]&255,Y=J>>2,K=(J&3)<<4|ce>>4,se=X+1<V?(ce&15)<<2|G>>6:64,$=X+2<V?G&63:64;B+=O[Y]+O[K]+O[se]+O[$]}return B},A=function(){let x=new Uint8Array([137,80,78,71,13,10,26,10]),v=12,M=new Int32Array(256);for(let G=0;G<256;G++){let Y=G;for(let K=0;K<8;K++)Y&1?Y=3988292384^Y>>1&2147483647:Y=Y>>1&2147483647;M[G]=Y}function O(G,Y,K){let se=-1;for(let $=Y;$<K;$++){let z=(se^G[$])&255,k=M[z];se=se>>>8^k}return se^-1}function B(G,Y,K,se){let $=se,z=Y.length;K[$]=z>>24&255,K[$+1]=z>>16&255,K[$+2]=z>>8&255,K[$+3]=z&255,$+=4,K[$]=G.charCodeAt(0)&255,K[$+1]=G.charCodeAt(1)&255,K[$+2]=G.charCodeAt(2)&255,K[$+3]=G.charCodeAt(3)&255,$+=4,K.set(Y,$),$+=Y.length;let k=O(K,se+4,$);K[$]=k>>24&255,K[$+1]=k>>16&255,K[$+2]=k>>8&255,K[$+3]=k&255}function X(G,Y,K){let se=1,$=0;for(let z=Y;z<K;++z)se=(se+(G[z]&255))%65521,$=($+se)%65521;return $<<16|se}function V(G){if(!o.isNodeJS)return J(G);try{let Y;parseInt(process.versions.node)>=8?Y=G:Y=Buffer.from(G);let K=zy().deflateSync(Y,{level:9});return K instanceof Uint8Array?K:new Uint8Array(K)}catch(Y){(0,r.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+Y)}return J(G)}function J(G){let Y=G.length,K=65535,se=Math.ceil(Y/K),$=new Uint8Array(2+Y+se*5+4),z=0;$[z++]=120,$[z++]=156;let k=0;for(;Y>K;)$[z++]=0,$[z++]=255,$[z++]=255,$[z++]=0,$[z++]=0,$.set(G.subarray(k,k+K),z),z+=K,k+=K,Y-=K;$[z++]=1,$[z++]=Y&255,$[z++]=Y>>8&255,$[z++]=~Y&65535&255,$[z++]=(~Y&65535)>>8&255,$.set(G.subarray(k),z),z+=G.length-k;let T=X(G,0,G.length);return $[z++]=T>>24&255,$[z++]=T>>16&255,$[z++]=T>>8&255,$[z++]=T&255,$}function ce(G,Y,K,se){let $=G.width,z=G.height,k,T,N,W=G.data;switch(Y){case r.ImageKind.GRAYSCALE_1BPP:T=0,k=1,N=$+7>>3;break;case r.ImageKind.RGB_24BPP:T=2,k=8,N=$*3;break;case r.ImageKind.RGBA_32BPP:T=6,k=8,N=$*4;break;default:throw new Error("invalid format")}let m=new Uint8Array((1+N)*z),_=0,C=0;for(let ae=0;ae<z;++ae)m[_++]=0,m.set(W.subarray(C,C+N),_),C+=N,_+=N;if(Y===r.ImageKind.GRAYSCALE_1BPP&&se){_=0;for(let ae=0;ae<z;ae++){_++;for(let ee=0;ee<N;ee++)m[_++]^=255}}let I=new Uint8Array([$>>24&255,$>>16&255,$>>8&255,$&255,z>>24&255,z>>16&255,z>>8&255,z&255,k,T,0,0,0]),H=V(m),j=x.length+v*3+I.length+H.length,q=new Uint8Array(j),Z=0;return q.set(x,Z),Z+=x.length,B("IHDR",I,q,Z),Z+=v+I.length,B("IDATA",H,q,Z),Z+=v+H.length,B("IEND",new Uint8Array(0),q,Z),h(q,"image/png",K)}return function(Y,K,se){let $=Y.kind===void 0?r.ImageKind.GRAYSCALE_1BPP:Y.kind;return ce(Y,$,K,se)}}();class g{constructor(){this.fontSizeScale=1,this.fontWeight=l.fontWeight,this.fontSize=0,this.textMatrix=r.IDENTITY_MATRIX,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=r.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=l.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(v,M){this.x=v,this.y=M}}let P=0,L=0,S=0;e.SVGGraphics=s=class{constructor(x,v,M=!1){(0,i.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new i.DOMSVGFactory,this.current=new g,this.transformMatrix=r.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=x,this.objs=v,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!M,this._operatorIdMapping=[];for(let O in r.OPS)this._operatorIdMapping[r.OPS[O]]=O}save(){this.transformStack.push(this.transformMatrix);let x=this.current;this.extraStack.push(x),this.current=x.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(x){this.save(),this.executeOpTree(x),this.restore()}loadDependencies(x){let v=x.fnArray,M=x.argsArray;for(let O=0,B=v.length;O<B;O++)if(v[O]===r.OPS.dependency)for(let X of M[O]){let V=X.startsWith("g_")?this.commonObjs:this.objs,J=new Promise(ce=>{V.get(X,ce)});this.current.dependencies.push(J)}return Promise.all(this.current.dependencies)}transform(x,v,M,O,B,X){let V=[x,v,M,O,B,X];this.transformMatrix=r.Util.transform(this.transformMatrix,V),this.tgrp=null}getSVG(x,v){this.viewport=v;let M=this._initialize(v);return this.loadDependencies(x).then(()=>(this.transformMatrix=r.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(x)),M))}convertOpList(x){let v=this._operatorIdMapping,M=x.argsArray,O=x.fnArray,B=[];for(let X=0,V=O.length;X<V;X++){let J=O[X];B.push({fnId:J,fn:v[J],args:M[X]})}return F(B)}executeOpTree(x){for(let v of x){let M=v.fn,O=v.fnId,B=v.args;switch(O|0){case r.OPS.beginText:this.beginText();break;case r.OPS.dependency:break;case r.OPS.setLeading:this.setLeading(B);break;case r.OPS.setLeadingMoveText:this.setLeadingMoveText(B[0],B[1]);break;case r.OPS.setFont:this.setFont(B);break;case r.OPS.showText:this.showText(B[0]);break;case r.OPS.showSpacedText:this.showText(B[0]);break;case r.OPS.endText:this.endText();break;case r.OPS.moveText:this.moveText(B[0],B[1]);break;case r.OPS.setCharSpacing:this.setCharSpacing(B[0]);break;case r.OPS.setWordSpacing:this.setWordSpacing(B[0]);break;case r.OPS.setHScale:this.setHScale(B[0]);break;case r.OPS.setTextMatrix:this.setTextMatrix(B[0],B[1],B[2],B[3],B[4],B[5]);break;case r.OPS.setTextRise:this.setTextRise(B[0]);break;case r.OPS.setTextRenderingMode:this.setTextRenderingMode(B[0]);break;case r.OPS.setLineWidth:this.setLineWidth(B[0]);break;case r.OPS.setLineJoin:this.setLineJoin(B[0]);break;case r.OPS.setLineCap:this.setLineCap(B[0]);break;case r.OPS.setMiterLimit:this.setMiterLimit(B[0]);break;case r.OPS.setFillRGBColor:this.setFillRGBColor(B[0],B[1],B[2]);break;case r.OPS.setStrokeRGBColor:this.setStrokeRGBColor(B[0],B[1],B[2]);break;case r.OPS.setStrokeColorN:this.setStrokeColorN(B);break;case r.OPS.setFillColorN:this.setFillColorN(B);break;case r.OPS.shadingFill:this.shadingFill(B[0]);break;case r.OPS.setDash:this.setDash(B[0],B[1]);break;case r.OPS.setRenderingIntent:this.setRenderingIntent(B[0]);break;case r.OPS.setFlatness:this.setFlatness(B[0]);break;case r.OPS.setGState:this.setGState(B[0]);break;case r.OPS.fill:this.fill();break;case r.OPS.eoFill:this.eoFill();break;case r.OPS.stroke:this.stroke();break;case r.OPS.fillStroke:this.fillStroke();break;case r.OPS.eoFillStroke:this.eoFillStroke();break;case r.OPS.clip:this.clip("nonzero");break;case r.OPS.eoClip:this.clip("evenodd");break;case r.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case r.OPS.paintImageXObject:this.paintImageXObject(B[0]);break;case r.OPS.paintInlineImageXObject:this.paintInlineImageXObject(B[0]);break;case r.OPS.paintImageMaskXObject:this.paintImageMaskXObject(B[0]);break;case r.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(B[0],B[1]);break;case r.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case r.OPS.closePath:this.closePath();break;case r.OPS.closeStroke:this.closeStroke();break;case r.OPS.closeFillStroke:this.closeFillStroke();break;case r.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case r.OPS.nextLine:this.nextLine();break;case r.OPS.transform:this.transform(B[0],B[1],B[2],B[3],B[4],B[5]);break;case r.OPS.constructPath:this.constructPath(B[0],B[1]);break;case r.OPS.endPath:this.endPath();break;case 92:this.group(v.items);break;default:(0,r.warn)(`Unimplemented operator ${M}`);break}}}setWordSpacing(x){this.current.wordSpacing=x}setCharSpacing(x){this.current.charSpacing=x}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(x,v,M,O,B,X){let V=this.current;V.textMatrix=V.lineMatrix=[x,v,M,O,B,X],V.textMatrixScale=Math.hypot(x,v),V.x=V.lineX=0,V.y=V.lineY=0,V.xcoords=[],V.ycoords=[],V.tspan=this.svgFactory.createElement("svg:tspan"),V.tspan.setAttributeNS(null,"font-family",V.fontFamily),V.tspan.setAttributeNS(null,"font-size",`${b(V.fontSize)}px`),V.tspan.setAttributeNS(null,"y",b(-V.y)),V.txtElement=this.svgFactory.createElement("svg:text"),V.txtElement.append(V.tspan)}beginText(){let x=this.current;x.x=x.lineX=0,x.y=x.lineY=0,x.textMatrix=r.IDENTITY_MATRIX,x.lineMatrix=r.IDENTITY_MATRIX,x.textMatrixScale=1,x.tspan=this.svgFactory.createElement("svg:tspan"),x.txtElement=this.svgFactory.createElement("svg:text"),x.txtgrp=this.svgFactory.createElement("svg:g"),x.xcoords=[],x.ycoords=[]}moveText(x,v){let M=this.current;M.x=M.lineX+=x,M.y=M.lineY+=v,M.xcoords=[],M.ycoords=[],M.tspan=this.svgFactory.createElement("svg:tspan"),M.tspan.setAttributeNS(null,"font-family",M.fontFamily),M.tspan.setAttributeNS(null,"font-size",`${b(M.fontSize)}px`),M.tspan.setAttributeNS(null,"y",b(-M.y))}showText(x){let v=this.current,M=v.font,O=v.fontSize;if(O===0)return;let B=v.fontSizeScale,X=v.charSpacing,V=v.wordSpacing,J=v.fontDirection,ce=v.textHScale*J,G=M.vertical,Y=G?1:-1,K=M.defaultVMetrics,se=O*v.fontMatrix[0],$=0;for(let T of x){if(T===null){$+=J*V;continue}else if(typeof T=="number"){$+=Y*T*O/1e3;continue}let N=(T.isSpace?V:0)+X,W=T.fontChar,m,_,C=T.width;if(G){let H,j=T.vmetric||K;H=T.vmetric?j[1]:C*.5,H=-H*se;let q=j[2]*se;C=j?-j[0]:C,m=H/B,_=($+q)/B}else m=$/B,_=0;(T.isInFont||M.missingFile)&&(v.xcoords.push(v.x+m),G&&v.ycoords.push(-v.y+_),v.tspan.textContent+=W);let I;G?I=C*se-N*J:I=C*se+N*J,$+=I}v.tspan.setAttributeNS(null,"x",v.xcoords.map(b).join(" ")),G?v.tspan.setAttributeNS(null,"y",v.ycoords.map(b).join(" ")):v.tspan.setAttributeNS(null,"y",b(-v.y)),G?v.y-=$:v.x+=$*ce,v.tspan.setAttributeNS(null,"font-family",v.fontFamily),v.tspan.setAttributeNS(null,"font-size",`${b(v.fontSize)}px`),v.fontStyle!==l.fontStyle&&v.tspan.setAttributeNS(null,"font-style",v.fontStyle),v.fontWeight!==l.fontWeight&&v.tspan.setAttributeNS(null,"font-weight",v.fontWeight);let z=v.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;if(z===r.TextRenderingMode.FILL||z===r.TextRenderingMode.FILL_STROKE?(v.fillColor!==l.fillColor&&v.tspan.setAttributeNS(null,"fill",v.fillColor),v.fillAlpha<1&&v.tspan.setAttributeNS(null,"fill-opacity",v.fillAlpha)):v.textRenderingMode===r.TextRenderingMode.ADD_TO_PATH?v.tspan.setAttributeNS(null,"fill","transparent"):v.tspan.setAttributeNS(null,"fill","none"),z===r.TextRenderingMode.STROKE||z===r.TextRenderingMode.FILL_STROKE){let T=1/(v.textMatrixScale||1);this._setStrokeAttributes(v.tspan,T)}let k=v.textMatrix;v.textRise!==0&&(k=k.slice(),k[5]+=v.textRise),v.txtElement.setAttributeNS(null,"transform",`${R(k)} scale(${b(ce)}, -1)`),v.txtElement.setAttributeNS(c,"xml:space","preserve"),v.txtElement.append(v.tspan),v.txtgrp.append(v.txtElement),this._ensureTransformGroup().append(v.txtElement)}setLeadingMoveText(x,v){this.setLeading(-v),this.moveText(x,v)}addFontStyle(x){if(!x.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));let v=h(x.data,x.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${x.loadedName}"; src: url(${v}); }
`}setFont(x){let v=this.current,M=this.commonObjs.get(x[0]),O=x[1];v.font=M,this.embedFonts&&!M.missingFile&&!this.embeddedFonts[M.loadedName]&&(this.addFontStyle(M),this.embeddedFonts[M.loadedName]=M),v.fontMatrix=M.fontMatrix||r.FONT_IDENTITY_MATRIX;let B="normal";M.black?B="900":M.bold&&(B="bold");let X=M.italic?"italic":"normal";O<0?(O=-O,v.fontDirection=-1):v.fontDirection=1,v.fontSize=O,v.fontFamily=M.loadedName,v.fontWeight=B,v.fontStyle=X,v.tspan=this.svgFactory.createElement("svg:tspan"),v.tspan.setAttributeNS(null,"y",b(-v.y)),v.xcoords=[],v.ycoords=[]}endText(){let x=this.current;x.textRenderingMode&r.TextRenderingMode.ADD_TO_PATH_FLAG&&x.txtElement?.hasChildNodes()&&(x.element=x.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(x){x>0&&(this.current.lineWidth=x)}setLineCap(x){this.current.lineCap=p[x]}setLineJoin(x){this.current.lineJoin=d[x]}setMiterLimit(x){this.current.miterLimit=x}setStrokeAlpha(x){this.current.strokeAlpha=x}setStrokeRGBColor(x,v,M){this.current.strokeColor=r.Util.makeHexColor(x,v,M)}setFillAlpha(x){this.current.fillAlpha=x}setFillRGBColor(x,v,M){this.current.fillColor=r.Util.makeHexColor(x,v,M),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(x){this.current.strokeColor=this._makeColorN_Pattern(x)}setFillColorN(x){this.current.fillColor=this._makeColorN_Pattern(x)}shadingFill(x){let v=this.viewport.width,M=this.viewport.height,O=r.Util.inverseTransform(this.transformMatrix),B=r.Util.applyTransform([0,0],O),X=r.Util.applyTransform([0,M],O),V=r.Util.applyTransform([v,0],O),J=r.Util.applyTransform([v,M],O),ce=Math.min(B[0],X[0],V[0],J[0]),G=Math.min(B[1],X[1],V[1],J[1]),Y=Math.max(B[0],X[0],V[0],J[0]),K=Math.max(B[1],X[1],V[1],J[1]),se=this.svgFactory.createElement("svg:rect");se.setAttributeNS(null,"x",ce),se.setAttributeNS(null,"y",G),se.setAttributeNS(null,"width",Y-ce),se.setAttributeNS(null,"height",K-G),se.setAttributeNS(null,"fill",this._makeShadingPattern(x)),this.current.fillAlpha<1&&se.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(se)}_makeColorN_Pattern(x){return x[0]==="TilingPattern"?this._makeTilingPattern(x):this._makeShadingPattern(x)}_makeTilingPattern(x){let v=x[1],M=x[2],O=x[3]||r.IDENTITY_MATRIX,[B,X,V,J]=x[4],ce=x[5],G=x[6],Y=x[7],K=`shading${S++}`,[se,$,z,k]=r.Util.normalizeRect([...r.Util.applyTransform([B,X],O),...r.Util.applyTransform([V,J],O)]),[T,N]=r.Util.singularValueDecompose2dScale(O),W=ce*T,m=G*N,_=this.svgFactory.createElement("svg:pattern");_.setAttributeNS(null,"id",K),_.setAttributeNS(null,"patternUnits","userSpaceOnUse"),_.setAttributeNS(null,"width",W),_.setAttributeNS(null,"height",m),_.setAttributeNS(null,"x",`${se}`),_.setAttributeNS(null,"y",`${$}`);let C=this.svg,I=this.transformMatrix,H=this.current.fillColor,j=this.current.strokeColor,q=this.svgFactory.create(z-se,k-$);if(this.svg=q,this.transformMatrix=O,Y===2){let Z=r.Util.makeHexColor(...v);this.current.fillColor=Z,this.current.strokeColor=Z}return this.executeOpTree(this.convertOpList(M)),this.svg=C,this.transformMatrix=I,this.current.fillColor=H,this.current.strokeColor=j,_.append(q.childNodes[0]),this.defs.append(_),`url(#${K})`}_makeShadingPattern(x){switch(typeof x=="string"&&(x=this.objs.get(x)),x[0]){case"RadialAxial":let v=`shading${S++}`,M=x[3],O;switch(x[1]){case"axial":let B=x[4],X=x[5];O=this.svgFactory.createElement("svg:linearGradient"),O.setAttributeNS(null,"id",v),O.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),O.setAttributeNS(null,"x1",B[0]),O.setAttributeNS(null,"y1",B[1]),O.setAttributeNS(null,"x2",X[0]),O.setAttributeNS(null,"y2",X[1]);break;case"radial":let V=x[4],J=x[5],ce=x[6],G=x[7];O=this.svgFactory.createElement("svg:radialGradient"),O.setAttributeNS(null,"id",v),O.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),O.setAttributeNS(null,"cx",J[0]),O.setAttributeNS(null,"cy",J[1]),O.setAttributeNS(null,"r",G),O.setAttributeNS(null,"fx",V[0]),O.setAttributeNS(null,"fy",V[1]),O.setAttributeNS(null,"fr",ce);break;default:throw new Error(`Unknown RadialAxial type: ${x[1]}`)}for(let B of M){let X=this.svgFactory.createElement("svg:stop");X.setAttributeNS(null,"offset",B[0]),X.setAttributeNS(null,"stop-color",B[1]),O.append(X)}return this.defs.append(O),`url(#${v})`;case"Mesh":return(0,r.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${x[0]}`)}}setDash(x,v){this.current.dashArray=x,this.current.dashPhase=v}constructPath(x,v){let M=this.current,O=M.x,B=M.y,X=[],V=0;for(let J of x)switch(J|0){case r.OPS.rectangle:O=v[V++],B=v[V++];let ce=v[V++],G=v[V++],Y=O+ce,K=B+G;X.push("M",b(O),b(B),"L",b(Y),b(B),"L",b(Y),b(K),"L",b(O),b(K),"Z");break;case r.OPS.moveTo:O=v[V++],B=v[V++],X.push("M",b(O),b(B));break;case r.OPS.lineTo:O=v[V++],B=v[V++],X.push("L",b(O),b(B));break;case r.OPS.curveTo:O=v[V+4],B=v[V+5],X.push("C",b(v[V]),b(v[V+1]),b(v[V+2]),b(v[V+3]),b(O),b(B)),V+=6;break;case r.OPS.curveTo2:X.push("C",b(O),b(B),b(v[V]),b(v[V+1]),b(v[V+2]),b(v[V+3])),O=v[V+2],B=v[V+3],V+=4;break;case r.OPS.curveTo3:O=v[V+2],B=v[V+3],X.push("C",b(v[V]),b(v[V+1]),b(O),b(B),b(O),b(B)),V+=4;break;case r.OPS.closePath:X.push("Z");break}X=X.join(" "),M.path&&x.length>0&&x[0]!==r.OPS.rectangle&&x[0]!==r.OPS.moveTo?X=M.path.getAttributeNS(null,"d")+X:(M.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(M.path)),M.path.setAttributeNS(null,"d",X),M.path.setAttributeNS(null,"fill","none"),M.element=M.path,M.setCurrentPoint(O,B)}endPath(){let x=this.current;if(x.path=null,!this.pendingClip)return;if(!x.element){this.pendingClip=null;return}let v=`clippath${P++}`,M=this.svgFactory.createElement("svg:clipPath");M.setAttributeNS(null,"id",v),M.setAttributeNS(null,"transform",R(this.transformMatrix));let O=x.element.cloneNode(!0);if(this.pendingClip==="evenodd"?O.setAttributeNS(null,"clip-rule","evenodd"):O.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,M.append(O),this.defs.append(M),x.activeClipUrl){x.clipGroup=null;for(let B of this.extraStack)B.clipGroup=null;M.setAttributeNS(null,"clip-path",x.activeClipUrl)}x.activeClipUrl=`url(#${v})`,this.tgrp=null}clip(x){this.pendingClip=x}closePath(){let x=this.current;if(x.path){let v=`${x.path.getAttributeNS(null,"d")}Z`;x.path.setAttributeNS(null,"d",v)}}setLeading(x){this.current.leading=-x}setTextRise(x){this.current.textRise=x}setTextRenderingMode(x){this.current.textRenderingMode=x}setHScale(x){this.current.textHScale=x/100}setRenderingIntent(x){}setFlatness(x){}setGState(x){for(let[v,M]of x)switch(v){case"LW":this.setLineWidth(M);break;case"LC":this.setLineCap(M);break;case"LJ":this.setLineJoin(M);break;case"ML":this.setMiterLimit(M);break;case"D":this.setDash(M[0],M[1]);break;case"RI":this.setRenderingIntent(M);break;case"FL":this.setFlatness(M);break;case"Font":this.setFont(M);break;case"CA":this.setStrokeAlpha(M);break;case"ca":this.setFillAlpha(M);break;default:(0,r.warn)(`Unimplemented graphic state operator ${v}`);break}}fill(){let x=this.current;x.element&&(x.element.setAttributeNS(null,"fill",x.fillColor),x.element.setAttributeNS(null,"fill-opacity",x.fillAlpha),this.endPath())}stroke(){let x=this.current;x.element&&(this._setStrokeAttributes(x.element),x.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(x,v=1){let M=this.current,O=M.dashArray;v!==1&&O.length>0&&(O=O.map(function(B){return v*B})),x.setAttributeNS(null,"stroke",M.strokeColor),x.setAttributeNS(null,"stroke-opacity",M.strokeAlpha),x.setAttributeNS(null,"stroke-miterlimit",b(M.miterLimit)),x.setAttributeNS(null,"stroke-linecap",M.lineCap),x.setAttributeNS(null,"stroke-linejoin",M.lineJoin),x.setAttributeNS(null,"stroke-width",b(v*M.lineWidth)+"px"),x.setAttributeNS(null,"stroke-dasharray",O.map(b).join(" ")),x.setAttributeNS(null,"stroke-dashoffset",b(v*M.dashPhase)+"px")}eoFill(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){let x=this.svgFactory.createElement("svg:rect");x.setAttributeNS(null,"x","0"),x.setAttributeNS(null,"y","0"),x.setAttributeNS(null,"width","1px"),x.setAttributeNS(null,"height","1px"),x.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(x)}paintImageXObject(x){let v=x.startsWith("g_")?this.commonObjs.get(x):this.objs.get(x);if(!v){(0,r.warn)(`Dependent image with object ID ${x} is not ready yet`);return}this.paintInlineImageXObject(v)}paintInlineImageXObject(x,v){let M=x.width,O=x.height,B=A(x,this.forceDataSchema,!!v),X=this.svgFactory.createElement("svg:rect");X.setAttributeNS(null,"x","0"),X.setAttributeNS(null,"y","0"),X.setAttributeNS(null,"width",b(M)),X.setAttributeNS(null,"height",b(O)),this.current.element=X,this.clip("nonzero");let V=this.svgFactory.createElement("svg:image");V.setAttributeNS(u,"xlink:href",B),V.setAttributeNS(null,"x","0"),V.setAttributeNS(null,"y",b(-O)),V.setAttributeNS(null,"width",b(M)+"px"),V.setAttributeNS(null,"height",b(O)+"px"),V.setAttributeNS(null,"transform",`scale(${b(1/M)} ${b(-1/O)})`),v?v.append(V):this._ensureTransformGroup().append(V)}paintImageMaskXObject(x){let v=this.current,M=x.width,O=x.height,B=v.fillColor;v.maskId=`mask${L++}`;let X=this.svgFactory.createElement("svg:mask");X.setAttributeNS(null,"id",v.maskId);let V=this.svgFactory.createElement("svg:rect");V.setAttributeNS(null,"x","0"),V.setAttributeNS(null,"y","0"),V.setAttributeNS(null,"width",b(M)),V.setAttributeNS(null,"height",b(O)),V.setAttributeNS(null,"fill",B),V.setAttributeNS(null,"mask",`url(#${v.maskId})`),this.defs.append(X),this._ensureTransformGroup().append(V),this.paintInlineImageXObject(x,X)}paintFormXObjectBegin(x,v){if(Array.isArray(x)&&x.length===6&&this.transform(x[0],x[1],x[2],x[3],x[4],x[5]),v){let M=v[2]-v[0],O=v[3]-v[1],B=this.svgFactory.createElement("svg:rect");B.setAttributeNS(null,"x",v[0]),B.setAttributeNS(null,"y",v[1]),B.setAttributeNS(null,"width",b(M)),B.setAttributeNS(null,"height",b(O)),this.current.element=B,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(x){let v=this.svgFactory.create(x.width,x.height),M=this.svgFactory.createElement("svg:defs");v.append(M),this.defs=M;let O=this.svgFactory.createElement("svg:g");return O.setAttributeNS(null,"transform",R(x.transform)),v.append(O),this.svg=O,v}_ensureClipGroup(){if(!this.current.clipGroup){let x=this.svgFactory.createElement("svg:g");x.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(x),this.current.clipGroup=x}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",R(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}}},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNodeStream=void 0;var i=t(1),r=t(33);let o=Y1(),s=jy(),l=Gy(),c=Xy(),u=/^file:\/\/\/[a-zA-Z]:\//;function p(L){let S=c.parse(L);return S.protocol==="file:"||S.host?S:/^[a-z]:[/\\]/i.test(L)?c.parse(`file:///${L}`):(S.host||(S.protocol="file:"),S)}class d{constructor(S){this.source=S,this.url=p(S.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&S.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new R(this):new F(this),this._fullRequestReader}getRangeReader(S,x){if(x<=this._progressiveDataLength)return null;let v=this.isFsUrl?new P(this,S,x):new b(this,S,x);return this._rangeRequestReaders.push(v),v}cancelAllRequests(S){this._fullRequestReader&&this._fullRequestReader.cancel(S);for(let x of this._rangeRequestReaders.slice(0))x.cancel(S)}}e.PDFNodeStream=d;class h{constructor(S){this._url=S.url,this._done=!1,this._storedError=null,this.onProgress=null;let x=S.source;this._contentLength=x.length,this._loaded=0,this._filename=null,this._disableRange=x.disableRange||!1,this._rangeChunkSize=x.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!x.disableStream,this._isRangeSupported=!x.disableRange,this._readableStream=null,this._readCapability=(0,i.createPromiseCapability)(),this._headersCapability=(0,i.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let S=this._readableStream.read();return S===null?(this._readCapability=(0,i.createPromiseCapability)(),this.read()):(this._loaded+=S.length,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(S).buffer,done:!1})}cancel(S){if(!this._readableStream){this._error(S);return}this._readableStream.destroy(S)}_error(S){this._storedError=S,this._readCapability.resolve()}_setReadableStream(S){this._readableStream=S,S.on("readable",()=>{this._readCapability.resolve()}),S.on("end",()=>{S.destroy(),this._done=!0,this._readCapability.resolve()}),S.on("error",x=>{this._error(x)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new i.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class A{constructor(S){this._url=S.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,i.createPromiseCapability)();let x=S.source;this._isStreamingSupported=!x.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let S=this._readableStream.read();return S===null?(this._readCapability=(0,i.createPromiseCapability)(),this.read()):(this._loaded+=S.length,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(S).buffer,done:!1})}cancel(S){if(!this._readableStream){this._error(S);return}this._readableStream.destroy(S)}_error(S){this._storedError=S,this._readCapability.resolve()}_setReadableStream(S){this._readableStream=S,S.on("readable",()=>{this._readCapability.resolve()}),S.on("end",()=>{S.destroy(),this._done=!0,this._readCapability.resolve()}),S.on("error",x=>{this._error(x)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function g(L,S){return{protocol:L.protocol,auth:L.auth,host:L.hostname,port:L.port,path:L.path,method:"GET",headers:S}}class F extends h{constructor(S){super(S);let x=v=>{if(v.statusCode===404){let X=new i.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=X,this._headersCapability.reject(X);return}this._headersCapability.resolve(),this._setReadableStream(v);let M=X=>this._readableStream.headers[X.toLowerCase()],{allowRangeRequests:O,suggestedLength:B}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:M,isHttp:S.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=O,this._contentLength=B||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(M)};this._request=null,this._url.protocol==="http:"?this._request=s.request(g(this._url,S.httpHeaders),x):this._request=l.request(g(this._url,S.httpHeaders),x),this._request.on("error",v=>{this._storedError=v,this._headersCapability.reject(v)}),this._request.end()}}class b extends A{constructor(S,x,v){super(S),this._httpHeaders={};for(let O in S.httpHeaders){let B=S.httpHeaders[O];typeof B>"u"||(this._httpHeaders[O]=B)}this._httpHeaders.Range=`bytes=${x}-${v-1}`;let M=O=>{if(O.statusCode===404){let B=new i.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=B;return}this._setReadableStream(O)};this._request=null,this._url.protocol==="http:"?this._request=s.request(g(this._url,this._httpHeaders),M):this._request=l.request(g(this._url,this._httpHeaders),M),this._request.on("error",O=>{this._storedError=O}),this._request.end()}}class R extends h{constructor(S){super(S);let x=decodeURIComponent(this._url.path);u.test(this._url.href)&&(x=x.replace(/^\//,"")),o.lstat(x,(v,M)=>{if(v){v.code==="ENOENT"&&(v=new i.MissingPDFException(`Missing PDF "${x}".`)),this._storedError=v,this._headersCapability.reject(v);return}this._contentLength=M.size,this._setReadableStream(o.createReadStream(x)),this._headersCapability.resolve()})}}class P extends A{constructor(S,x,v){super(S);let M=decodeURIComponent(this._url.path);u.test(this._url.href)&&(M=M.replace(/^\//,"")),this._setReadableStream(o.createReadStream(M,{start:x,end:v-1}))}}},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createResponseStatusError=c,e.extractFilenameFromHeader=l,e.validateRangeRequestCapabilities=s,e.validateResponseStatus=u;var i=t(1),r=t(34),o=t(8);function s({getResponseHeader:p,isHttp:d,rangeChunkSize:h,disableRange:A}){let g={allowRangeRequests:!1,suggestedLength:void 0},F=parseInt(p("Content-Length"),10);return!Number.isInteger(F)||(g.suggestedLength=F,F<=2*h)||A||!d||p("Accept-Ranges")!=="bytes"||(p("Content-Encoding")||"identity")!=="identity"||(g.allowRangeRequests=!0),g}function l(p){let d=p("Content-Disposition");if(d){let h=(0,r.getFilenameFromContentDispositionHeader)(d);if(h.includes("%"))try{h=decodeURIComponent(h)}catch{}if((0,o.isPdfFile)(h))return h}return null}function c(p,d){return p===404||p===0&&d.startsWith("file:")?new i.MissingPDFException('Missing PDF "'+d+'".'):new i.UnexpectedResponseException(`Unexpected server response (${p}) while retrieving PDF "${d}".`,p)}function u(p){return p===200||p===206}},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getFilenameFromContentDispositionHeader=r;var i=t(1);function r(o){let s=!0,l=c("filename\\*","i").exec(o);if(l){l=l[1];let F=h(l);return F=unescape(F),F=A(F),F=g(F),p(F)}if(l=d(o),l){let F=g(l);return p(F)}if(l=c("filename","i").exec(o),l){l=l[1];let F=h(l);return F=g(F),p(F)}function c(F,b){return new RegExp("(?:^|;)\\s*"+F+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',b)}function u(F,b){if(F){if(!/^[\x00-\xFF]+$/.test(b))return b;try{let R=new TextDecoder(F,{fatal:!0}),P=(0,i.stringToBytes)(b);b=R.decode(P),s=!1}catch{}}return b}function p(F){return s&&/[\x80-\xff]/.test(F)&&(F=u("utf-8",F),s&&(F=u("iso-8859-1",F))),F}function d(F){let b=[],R,P=c("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(R=P.exec(F))!==null;){let[,S,x,v]=R;if(S=parseInt(S,10),S in b){if(S===0)break;continue}b[S]=[x,v]}let L=[];for(let S=0;S<b.length&&S in b;++S){let[x,v]=b[S];v=h(v),x&&(v=unescape(v),S===0&&(v=A(v))),L.push(v)}return L.join("")}function h(F){if(F.startsWith('"')){let b=F.slice(1).split('\\"');for(let R=0;R<b.length;++R){let P=b[R].indexOf('"');P!==-1&&(b[R]=b[R].slice(0,P),b.length=R+1),b[R]=b[R].replace(/\\(.)/g,"$1")}F=b.join('"')}return F}function A(F){let b=F.indexOf("'");if(b===-1)return F;let R=F.slice(0,b),L=F.slice(b+1).replace(/^[^']*'/,"");return u(R,L)}function g(F){return!F.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(F)?F:F.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(b,R,P,L){if(P==="q"||P==="Q")return L=L.replace(/_/g," "),L=L.replace(/=([0-9a-fA-F]{2})/g,function(S,x){return String.fromCharCode(parseInt(x,16))}),u(R,L);try{L=atob(L)}catch{}return u(R,L)})}return""}},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNetworkStream=void 0;var i=t(1),r=t(33);let o=200,s=206;function l(h){let A=h.response;return typeof A!="string"?A:(0,i.stringToBytes)(A).buffer}class c{constructor(A,g={}){this.url=A,this.isHttp=/^https?:/i.test(A),this.httpHeaders=this.isHttp&&g.httpHeaders||Object.create(null),this.withCredentials=g.withCredentials||!1,this.getXhr=g.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(A,g,F){let b={begin:A,end:g};for(let R in F)b[R]=F[R];return this.request(b)}requestFull(A){return this.request(A)}request(A){let g=this.getXhr(),F=this.currXhrId++,b=this.pendingRequests[F]={xhr:g};g.open("GET",this.url),g.withCredentials=this.withCredentials;for(let R in this.httpHeaders){let P=this.httpHeaders[R];typeof P>"u"||g.setRequestHeader(R,P)}return this.isHttp&&"begin"in A&&"end"in A?(g.setRequestHeader("Range",`bytes=${A.begin}-${A.end-1}`),b.expectedStatus=s):b.expectedStatus=o,g.responseType="arraybuffer",A.onError&&(g.onerror=function(R){A.onError(g.status)}),g.onreadystatechange=this.onStateChange.bind(this,F),g.onprogress=this.onProgress.bind(this,F),b.onHeadersReceived=A.onHeadersReceived,b.onDone=A.onDone,b.onError=A.onError,b.onProgress=A.onProgress,g.send(null),F}onProgress(A,g){let F=this.pendingRequests[A];F&&F.onProgress?.(g)}onStateChange(A,g){let F=this.pendingRequests[A];if(!F)return;let b=F.xhr;if(b.readyState>=2&&F.onHeadersReceived&&(F.onHeadersReceived(),delete F.onHeadersReceived),b.readyState!==4||!(A in this.pendingRequests))return;if(delete this.pendingRequests[A],b.status===0&&this.isHttp){F.onError?.(b.status);return}let R=b.status||o;if(!(R===o&&F.expectedStatus===s)&&R!==F.expectedStatus){F.onError?.(b.status);return}let L=l(b);if(R===s){let S=b.getResponseHeader("Content-Range"),x=/bytes (\d+)-(\d+)\/(\d+)/.exec(S);F.onDone({begin:parseInt(x[1],10),chunk:L})}else L?F.onDone({begin:0,chunk:L}):F.onError?.(b.status)}getRequestXhr(A){return this.pendingRequests[A].xhr}isPendingRequest(A){return A in this.pendingRequests}abortRequest(A){let g=this.pendingRequests[A].xhr;delete this.pendingRequests[A],g.abort()}}class u{constructor(A){this._source=A,this._manager=new c(A.url,{httpHeaders:A.httpHeaders,withCredentials:A.withCredentials}),this._rangeChunkSize=A.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(A){let g=this._rangeRequestReaders.indexOf(A);g>=0&&this._rangeRequestReaders.splice(g,1)}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new p(this._manager,this._source),this._fullRequestReader}getRangeReader(A,g){let F=new d(this._manager,A,g);return F.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(F),F}cancelAllRequests(A){this._fullRequestReader?.cancel(A);for(let g of this._rangeRequestReaders.slice(0))g.cancel(A)}}e.PDFNetworkStream=u;class p{constructor(A,g){this._manager=A;let F={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=g.url,this._fullRequestId=A.requestFull(F),this._headersReceivedCapability=(0,i.createPromiseCapability)(),this._disableRange=g.disableRange||!1,this._contentLength=g.length,this._rangeChunkSize=g.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let A=this._fullRequestId,g=this._manager.getRequestXhr(A),F=P=>g.getResponseHeader(P),{allowRangeRequests:b,suggestedLength:R}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:F,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});b&&(this._isRangeSupported=!0),this._contentLength=R||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(F),this._isRangeSupported&&this._manager.abortRequest(A),this._headersReceivedCapability.resolve()}_onDone(A){if(A&&(this._requests.length>0?this._requests.shift().resolve({value:A.chunk,done:!1}):this._cachedChunks.push(A.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(A){this._storedError=(0,r.createResponseStatusError)(A,this._url),this._headersReceivedCapability.reject(this._storedError);for(let g of this._requests)g.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(A){this.onProgress?.({loaded:A.loaded,total:A.lengthComputable?A.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let A=(0,i.createPromiseCapability)();return this._requests.push(A),A.promise}cancel(A){this._done=!0,this._headersReceivedCapability.reject(A);for(let g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class d{constructor(A,g,F){this._manager=A;let b={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=A.url,this._requestId=A.requestRange(g,F,b),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(A){let g=A.chunk;this._requests.length>0?this._requests.shift().resolve({value:g,done:!1}):this._queuedChunk=g,this._done=!0;for(let F of this._requests)F.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(A){this._storedError=(0,r.createResponseStatusError)(A,this._url);for(let g of this._requests)g.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(A){this.isStreamingSupported||this.onProgress?.({loaded:A.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let g=this._queuedChunk;return this._queuedChunk=null,{value:g,done:!1}}if(this._done)return{value:void 0,done:!0};let A=(0,i.createPromiseCapability)();return this._requests.push(A),A.promise}cancel(A){this._done=!0;for(let g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFFetchStream=void 0;var i=t(1),r=t(33);function o(p,d,h){return{method:"GET",headers:p,signal:h.signal,mode:"cors",credentials:d?"include":"same-origin",redirect:"follow"}}function s(p){let d=new Headers;for(let h in p){let A=p[h];typeof A>"u"||d.append(h,A)}return d}class l{constructor(d){this.source=d,this.isHttp=/^https?:/i.test(d.url),this.httpHeaders=this.isHttp&&d.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new c(this),this._fullRequestReader}getRangeReader(d,h){if(h<=this._progressiveDataLength)return null;let A=new u(this,d,h);return this._rangeRequestReaders.push(A),A}cancelAllRequests(d){this._fullRequestReader&&this._fullRequestReader.cancel(d);for(let h of this._rangeRequestReaders.slice(0))h.cancel(d)}}e.PDFFetchStream=l;class c{constructor(d){this._stream=d,this._reader=null,this._loaded=0,this._filename=null;let h=d.source;this._withCredentials=h.withCredentials||!1,this._contentLength=h.length,this._headersCapability=(0,i.createPromiseCapability)(),this._disableRange=h.disableRange||!1,this._rangeChunkSize=h.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!h.disableStream,this._isRangeSupported=!h.disableRange,this._headers=s(this._stream.httpHeaders);let A=h.url;fetch(A,o(this._headers,this._withCredentials,this._abortController)).then(g=>{if(!(0,r.validateResponseStatus)(g.status))throw(0,r.createResponseStatusError)(g.status,A);this._reader=g.body.getReader(),this._headersCapability.resolve();let F=P=>g.headers.get(P),{allowRangeRequests:b,suggestedLength:R}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:F,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=b,this._contentLength=R||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(F),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new i.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;let{value:d,done:h}=await this._reader.read();return h?{value:d,done:h}:(this._loaded+=d.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(d).buffer,done:!1})}cancel(d){this._reader&&this._reader.cancel(d),this._abortController.abort()}}class u{constructor(d,h,A){this._stream=d,this._reader=null,this._loaded=0;let g=d.source;this._withCredentials=g.withCredentials||!1,this._readCapability=(0,i.createPromiseCapability)(),this._isStreamingSupported=!g.disableStream,this._abortController=new AbortController,this._headers=s(this._stream.httpHeaders),this._headers.append("Range",`bytes=${h}-${A-1}`);let F=g.url;fetch(F,o(this._headers,this._withCredentials,this._abortController)).then(b=>{if(!(0,r.validateResponseStatus)(b.status))throw(0,r.createResponseStatusError)(b.status,F);this._readCapability.resolve(),this._reader=b.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;let{value:d,done:h}=await this._reader.read();return h?{value:d,done:h}:(this._loaded+=d.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(d).buffer,done:!1})}cancel(d){this._reader&&this._reader.cancel(d),this._abortController.abort()}}}],__webpack_module_cache__={};function __w_pdfjs_require__(n){var e=__webpack_module_cache__[n];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[n]={exports:{}};return __webpack_modules__[n](t,t.exports,__w_pdfjs_require__),t.exports}var __webpack_exports__={};return(()=>{var n=__webpack_exports__;Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"AnnotationEditorLayer",{enumerable:!0,get:function(){return r.AnnotationEditorLayer}}),Object.defineProperty(n,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return e.AnnotationEditorParamsType}}),Object.defineProperty(n,"AnnotationEditorType",{enumerable:!0,get:function(){return e.AnnotationEditorType}}),Object.defineProperty(n,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return o.AnnotationEditorUIManager}}),Object.defineProperty(n,"AnnotationLayer",{enumerable:!0,get:function(){return s.AnnotationLayer}}),Object.defineProperty(n,"AnnotationMode",{enumerable:!0,get:function(){return e.AnnotationMode}}),Object.defineProperty(n,"CMapCompressionType",{enumerable:!0,get:function(){return e.CMapCompressionType}}),Object.defineProperty(n,"GlobalWorkerOptions",{enumerable:!0,get:function(){return l.GlobalWorkerOptions}}),Object.defineProperty(n,"InvalidPDFException",{enumerable:!0,get:function(){return e.InvalidPDFException}}),Object.defineProperty(n,"LoopbackPort",{enumerable:!0,get:function(){return t.LoopbackPort}}),Object.defineProperty(n,"MissingPDFException",{enumerable:!0,get:function(){return e.MissingPDFException}}),Object.defineProperty(n,"OPS",{enumerable:!0,get:function(){return e.OPS}}),Object.defineProperty(n,"PDFDataRangeTransport",{enumerable:!0,get:function(){return t.PDFDataRangeTransport}}),Object.defineProperty(n,"PDFDateString",{enumerable:!0,get:function(){return i.PDFDateString}}),Object.defineProperty(n,"PDFWorker",{enumerable:!0,get:function(){return t.PDFWorker}}),Object.defineProperty(n,"PasswordResponses",{enumerable:!0,get:function(){return e.PasswordResponses}}),Object.defineProperty(n,"PermissionFlag",{enumerable:!0,get:function(){return e.PermissionFlag}}),Object.defineProperty(n,"PixelsPerInch",{enumerable:!0,get:function(){return i.PixelsPerInch}}),Object.defineProperty(n,"RenderingCancelledException",{enumerable:!0,get:function(){return i.RenderingCancelledException}}),Object.defineProperty(n,"SVGGraphics",{enumerable:!0,get:function(){return p.SVGGraphics}}),Object.defineProperty(n,"UNSUPPORTED_FEATURES",{enumerable:!0,get:function(){return e.UNSUPPORTED_FEATURES}}),Object.defineProperty(n,"UnexpectedResponseException",{enumerable:!0,get:function(){return e.UnexpectedResponseException}}),Object.defineProperty(n,"Util",{enumerable:!0,get:function(){return e.Util}}),Object.defineProperty(n,"VerbosityLevel",{enumerable:!0,get:function(){return e.VerbosityLevel}}),Object.defineProperty(n,"XfaLayer",{enumerable:!0,get:function(){return d.XfaLayer}}),Object.defineProperty(n,"build",{enumerable:!0,get:function(){return t.build}}),Object.defineProperty(n,"createPromiseCapability",{enumerable:!0,get:function(){return e.createPromiseCapability}}),Object.defineProperty(n,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return e.createValidAbsoluteUrl}}),Object.defineProperty(n,"getDocument",{enumerable:!0,get:function(){return t.getDocument}}),Object.defineProperty(n,"getFilenameFromUrl",{enumerable:!0,get:function(){return i.getFilenameFromUrl}}),Object.defineProperty(n,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return i.getPdfFilenameFromUrl}}),Object.defineProperty(n,"getXfaPageViewport",{enumerable:!0,get:function(){return i.getXfaPageViewport}}),Object.defineProperty(n,"isPdfFile",{enumerable:!0,get:function(){return i.isPdfFile}}),Object.defineProperty(n,"loadScript",{enumerable:!0,get:function(){return i.loadScript}}),Object.defineProperty(n,"renderTextLayer",{enumerable:!0,get:function(){return u.renderTextLayer}}),Object.defineProperty(n,"shadow",{enumerable:!0,get:function(){return e.shadow}}),Object.defineProperty(n,"version",{enumerable:!0,get:function(){return t.version}});var e=__w_pdfjs_require__(1),t=__w_pdfjs_require__(4),i=__w_pdfjs_require__(8),r=__w_pdfjs_require__(22),o=__w_pdfjs_require__(7),s=__w_pdfjs_require__(27),l=__w_pdfjs_require__(15),c=__w_pdfjs_require__(3),u=__w_pdfjs_require__(30),p=__w_pdfjs_require__(31),d=__w_pdfjs_require__(29);let h="2.16.105",A="172ccdbe5";if(c.isNodeJS){let{PDFNodeStream:g}=__w_pdfjs_require__(32);(0,t.setPDFNetworkStreamFactory)(F=>new g(F))}else{let{PDFNetworkStream:g}=__w_pdfjs_require__(35),{PDFFetchStream:F}=__w_pdfjs_require__(36);(0,t.setPDFNetworkStreamFactory)(b=>(0,i.isValidFetchUrl)(b.url)?new F(b):new g(b))}})(),__webpack_exports__})())});function Tc(n,e,t){return typeof n===e||n instanceof t}function Ke(n){return Tc(n,"function",Function)}function Ve(n){return Tc(n,"string",String)}function Ln(n){return Tc(n,"boolean",Boolean)}function mt(n){return Tc(n,"number",Number)}function dp(n){return oe(n)||!Number.isFinite(n)||Number.isNaN(n)}function Ai(n){return mt(n)&&!dp(n)}function ci(n){return y(n)&&Tc(n,"object",Object)}function _o(n){return n instanceof Date}function Wn(n){return n instanceof Array}function yt(n,e){throw new Error((e||"Unexpected object: ")+n)}function oe(n){return n==null}function y(n){return!oe(n)}function C0(n){return n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Int8Array||n instanceof Uint16Array||n instanceof Int16Array||n instanceof Uint32Array||n instanceof Int32Array||n instanceof Float32Array||n instanceof Float64Array||"BigUint64Array"in globalThis&&n instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&n instanceof globalThis.BigInt64Array}function L0(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Xt(n){return`${n}%`}function hp(n){return`${n}deg`}function vi(n){return`${n}em`}function ui(n){return`${n}px`}function P0(n){return`${n}pt`}function yo(n){return`${n}fr`}function pi(...n){return`rgb(${n.join(", ")})`}function mp(...n){return`hsla(${n.join(", ")})`}function Fa(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}var bg=class{constructor(e){this._value=e}get value(){return this._value}toString(){return this.value}},Sg=class{constructor(e,t,i){this.pre=e,this.props=t,this.post=i}get value(){return this.pre+this.props.map(e=>e.toString()).join(`
`)+this.post}toString(){return this.value}applyToSheet(e){e.insertRule(this.toString(),e.cssRules.length)}},_g=class extends bg{constructor(e,t,i){super(i),this._name=e,this.sep=t}get name(){return this._name}toString(){return this.name+this.sep+this.value+";"}},yg=class extends Sg{constructor(e,t){super(e+` {
`,t,`
}
`)}},Tg=class extends _g{constructor(e,t){super(e,": ",t)}},dt=class extends Tg{constructor(e,t){super(e.replace(/[A-Z]/g,i=>`-${i.toLocaleLowerCase()}`),t.toString()),this.key=e,this.priority=""}applyToElement(e){e.style[this.key]=this.value+this.priority}important(){return this.priority=" !important",this}get value(){return super.value+this.priority}};function kg(n){return n instanceof dt}var Eg=class extends yg{constructor(e,t){super(e,t)}};function R0(n,...e){return new Eg(n,e)}function I0(n){return new dt("alignItems",n)}function B0(n){return new dt("backgroundColor",n)}function V0(n){return new dt("border",n)}function O0(n){return new dt("color",n)}function fp(n){return new dt("columnGap",n)}function gp(n){return new dt("cursor",n)}function Jt(n){return new dt("display",n)}function N0(n){return new dt("flexDirection",n)}function W0(n){return new dt("fontSize",n)}function H0(...n){return new dt("gap",n.join(" "))}function U0(n){return new dt("gridAutoFlow",n)}function Mg(n,e){return Ve(n)||(n=[n,e].filter(y).join("/")),new dt("gridColumn",n)}function Dg(n,e){return Ve(n)||(n=[n,e].filter(y).join("/")),new dt("gridRow",n)}function As(...n){return new dt("gridTemplateColumns",n.join(" "))}function Cg(...n){return new dt("gridTemplateRows",n.join(" "))}function To(n){return new dt("height",n)}function z0(n){return new dt("left",n)}function xp(...n){return new dt("margin",n.join(" "))}function wp(n){return new dt("maxWidth",n)}function j0(n){return new dt("minHeight",n)}function Fp(n){return new dt("opacity",n)}function Ap(...n){return new dt("overflow",n.join(" "))}function Aa(...n){return new dt("padding",n.join(" "))}function G0(n){return new dt("paddingRight",n)}function X0(n){return new dt("pointerEvents",n)}function q0(n){return new dt("textAlign",n)}function Y0(n){return new dt("textOverflow",n)}function K0(n){return new dt("top",n)}function Q0(...n){return new dt("transform",n.join(" "))}function $0(n){return new dt("whiteSpace",n)}function Pn(n){return new dt("width",n)}function J0(n){return ci(n)&&"compareTo"in n&&Ke(n.compareTo)}function vn(n,...e){let t=null;Ve(n)?t=n:(t="ascending",e.unshift(n));let i=t==="ascending"?1:-1;return Object.assign((o,s)=>{if(o===s)return 0;for(let l of e){let c=oe(o)?null:l(o),u=oe(s)?null:l(s),p=c===u?0:Ve(c)&&Ve(u)?i*c.localeCompare(u):J0(c)&&J0(u)?i*c.compareTo(u):t==="ascending"&&c>u||t==="descending"&&c<u?1:-1;if(p!==0)return p}return 0},{direction:t})}function vp(n,e,t,i="search"){let r=0,o=n.length-1;for(;r<=o;){let s=r+o>>1,l=t(n[s],e);if(l===0){if(i!=="search"){let c=i==="append"?1:-1;for(c>0&&(s+=c);0<=s&&s<n.length&&(l=t(n[s],e))===0;)s+=c;c<0&&(s-=c)}return s}else l<0?r=s-l:o=s-l}return-r-1}function bi(n,e,t,i="search"){let r=i!=="set";i==="set"&&(i="search");let o=null;if(mt(t)?o=t:o=vp(n,e,t,i),o<0)o=-o-1;else if(!r)return-1;return vs(n,e,o),o}function Z0(n,e,t){let i=vp(n,e,t);return i>=0?(va(n,i),i):-1}function qe(n){return n.splice(0)}function bp(n,e){for(let t=0;t<n.length;++t)if(n[t]!==e[t])return t;return-1}function vs(n,e,t){n.splice(t,0,e)}function Pt(n,e){let t=n.indexOf(e);return t>-1?(va(n,t),!0):!1}function $T(n,e){for(let t=n.length-1;t>=0;--t)if(e(n[t]))return va(n,t);return null}function eF(n,e,t){return $T(n,i=>t(i)===e)}function va(n,e){return n.splice(e,1)[0]}function un(n,...e){n.splice(0,n.length,...e)}function tF(n,e,t){let i=n?0:e.length-1,r=n?e.length:-1,o=n?1:-1;for(let s of t)for(let l=i;l!=r;l+=o){let c=e[l];if(s(c))return c}return null}function Rn(n,...e){return tF(!0,n,e)}function Lg(n,...e){return tF(!1,n,e)}function pn(n){return n}function nF(){return!0}function Sp(){return!1}function iF(n,e){return n&&e}var ba=class{constructor(){this.listeners=new Map,this.listenerOptions=new Map,this.bubblers=new Set,this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addScopedEventListener(e,t,i,r){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([t,i]),this.addEventListener(t,i,r)}removeScope(e){let t=this.scopes.get(e);if(t){this.scopes.delete(e);for(let[i,r]of t)this.removeEventListener(i,r)}}addEventListener(e,t,i){let r=this.listeners.get(e);r||(r=new Array,this.listeners.set(e,r)),r.find(o=>o===t)||(r.push(t),i&&this.listenerOptions.set(t,i))}removeEventListener(e,t){let i=this.listeners.get(e);i&&this.removeListener(i,t)}clearEventListeners(e){for(let[t,i]of this.listeners)if(oe(e)||e===t){for(let r of i)this.removeEventListener(e,r);qe(i),this.listeners.delete(t)}}removeListener(e,t){let i=e.findIndex(r=>r===t);i>=0&&(va(e,i),this.listenerOptions.has(t)&&this.listenerOptions.delete(t))}dispatchEvent(e){let t=this.listeners.get(e.type);if(t)for(let i of t){let r=this.listenerOptions.get(i);y(r)&&!Ln(r)&&r.once&&this.removeListener(t,i),Ke(i)?i.call(this,e):i.handleEvent(e)}if(e.defaultPrevented)return!1;for(let i of this.bubblers)if(!i.dispatchEvent(e))return!1;return!0}},_r=class{constructor(e,t,i){this._addEventListener=e,this._removeEventListener=t,this._dispatchEvent=i,this.listeners=new Map,this.listenerOptions=new Map,this.bubblers=new Set,this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addScopedEventListener(e,t,i,r){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([t,i]),this.addEventListener(t,i,r)}removeScope(e){let t=this.scopes.get(e);if(t){this.scopes.delete(e);for(let[i,r]of t)this.removeEventListener(i,r)}}addEventListener(e,t,i){let r=this.listeners.get(e);r||(r=new Array,this.listeners.set(e,r)),r.find(o=>o===t)||(r.push(t),i&&this.listenerOptions.set(t,i)),this._addEventListener(e,t,i)}removeEventListener(e,t){let i=this.listeners.get(e);i&&this.removeListener(i,t),this._removeEventListener(e,t)}removeListener(e,t){let i=e.findIndex(r=>r===t);i>=0&&(va(e,i),this.listenerOptions.has(t)&&this.listenerOptions.delete(t))}clearEventListeners(e){for(let[t,i]of this.listeners)if(oe(e)||e===t){for(let r of i)this.removeEventListener(e,r);qe(i),this.listeners.delete(t)}}dispatchEvent(e){let t=this._dispatchEvent(e),i=this.listeners.get(e.type);if(i)for(let r of i){let o=this.listenerOptions.get(r);y(o)&&!Ln(o)&&o.once&&this.removeListener(i,r)}if(!t)return!1;for(let r of this.bubblers)if(!r.dispatchEvent(e))return!1;return!0}};var et=class{constructor(e=!0){this.autoStart=e,this.onThens=new Array,this.onCatches=new Array,this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",this.resolve=t=>{if(this.running){this._result=t,this._resultState="resolved";for(let i of this.onThens)i(t);this.clear(),this._executionState="finished"}},this.reject=t=>{if(this.running){this._error=t,this._resultState="errored";for(let i of this.onCatches)i(t);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){qe(this.onThens),qe(this.onCatches)}start(){this._executionState="running"}resolver(e){return()=>this.resolve(e)}resolveOn(e,t,i){let r=this.resolver(i);e.addEventListener(t,r),this.finally(()=>e.removeEventListener(t,r))}get result(){if(y(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((e,t)=>{this.finished?this.errored?t(this.error):e(this.result):(this.onThens.push(e),this.onCatches.push(t))})}then(e,t){return this.project().then(e,t)}catch(e){return this.project().catch(e)}finally(e){return this.project().finally(e)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(e){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",e&&this.start()}};function rF(n,e){return"on"+e in n}function Kt(n,e,t,...i){oe(i)&&(i=[]);let r;if(Ve(t)?i.unshift(t):mt(t)&&(r=t),!(n instanceof ba)){if(!rF(n,e))throw new Error(`Target does not have a ${e} rejection event`);for(let c of i)if(!rF(n,c))throw new Error(`Target does not have a ${c} rejection event`)}let o=new et;if(mt(r)){let c=setTimeout(o.reject,r,`'${e}' has timed out.`);o.finally(clearTimeout.bind(globalThis,c))}let s=(c,u)=>{n.addEventListener(c,u),o.finally(()=>n.removeEventListener(c,u))};s(e,c=>o.resolve(c));let l=c=>o.reject(c);for(let c of i)s(c,l);return o}function or(n){return n.then(nF).catch(Sp)}var Pg={};ti(Pg,{Application_A2L:()=>ZT,Application_AML:()=>d2,Application_ATF:()=>g2,Application_ATFX:()=>x2,Application_ATXML:()=>E2,Application_Activemessage:()=>e2,Application_Alto_CostmapJson:()=>i2,Application_Alto_CostmapfilterJson:()=>n2,Application_Alto_DirectoryJson:()=>r2,Application_Alto_EndpointcostJson:()=>o2,Application_Alto_EndpointcostparamsJson:()=>s2,Application_Alto_EndpointpropJson:()=>a2,Application_Alto_EndpointpropparamsJson:()=>l2,Application_Alto_ErrorJson:()=>c2,Application_Alto_NetworkmapJson:()=>p2,Application_Alto_NetworkmapfilterJson:()=>u2,Application_Andrew_Inset:()=>h2,Application_Applefile:()=>m2,Application_Applixware:()=>f2,Application_AtomXml:()=>b2,Application_AtomcatXml:()=>w2,Application_AtomdeletedXml:()=>F2,Application_Atomicmail:()=>A2,Application_AtomsvcXml:()=>v2,Application_Atsc_DwdXml:()=>S2,Application_Atsc_HeldXml:()=>_2,Application_Atsc_RdtJson:()=>y2,Application_Atsc_RsatXml:()=>T2,Application_Auth_PolicyXml:()=>k2,Application_Bacnet_XddZip:()=>M2,Application_Batch_SMTP:()=>D2,Application_Bdoc:()=>C2,Application_BeepXml:()=>L2,Application_CALS_1840:()=>B2,Application_CDFXXML:()=>U2,Application_CEA:()=>K2,Application_CSTAdataXml:()=>dE,Application_CalendarJson:()=>P2,Application_CalendarXml:()=>R2,Application_Call_Completion:()=>I2,Application_Cbor:()=>V2,Application_Cbor_Seq:()=>O2,Application_Cccex:()=>N2,Application_CcmpXml:()=>W2,Application_CcxmlXml:()=>H2,Application_Cdmi_Capability:()=>z2,Application_Cdmi_Container:()=>j2,Application_Cdmi_Domain:()=>G2,Application_Cdmi_Object:()=>X2,Application_Cdmi_Queue:()=>q2,Application_Cdni:()=>Y2,Application_Cea_2018Xml:()=>Q2,Application_CellmlXml:()=>$2,Application_Cfw:()=>J2,Application_ClueXml:()=>eE,Application_Clue_infoXml:()=>Z2,Application_Cms:()=>tE,Application_CnrpXml:()=>nE,Application_Coap_GroupJson:()=>iE,Application_Coap_Payload:()=>rE,Application_Commonground:()=>oE,Application_Conference_InfoXml:()=>sE,Application_Cose:()=>aE,Application_Cose_Key:()=>lE,Application_Cose_Key_Set:()=>cE,Application_CplXml:()=>uE,Application_Csrattrs:()=>pE,Application_CstaXml:()=>hE,Application_CsvmJson:()=>mE,Application_Cu_Seeme:()=>fE,Application_Cwt:()=>gE,Application_Cybercash:()=>xE,Application_DCD:()=>SE,Application_DII:()=>ME,Application_DIT:()=>DE,Application_Dart:()=>wE,Application_DashXml:()=>AE,Application_Dashdelta:()=>FE,Application_DavmountXml:()=>vE,Application_Dca_Rft:()=>bE,Application_Dec_Dx:()=>_E,Application_Dialog_InfoXml:()=>yE,Application_Dicom:()=>TE,Application_DicomJson:()=>EE,Application_DicomXml:()=>kE,Application_Dns:()=>CE,Application_DnsJson:()=>PE,Application_Dns_Message:()=>LE,Application_DocbookXml:()=>RE,Application_DotsCbor:()=>IE,Application_DskppXml:()=>BE,Application_DsscDer:()=>VE,Application_DsscXml:()=>OE,Application_Dvcs:()=>NE,Application_EDIFACT:()=>zE,Application_EDI_Consent:()=>HE,Application_EDI_X12:()=>UE,Application_Ecmascript:()=>WE,Application_Efi:()=>jE,Application_EmergencyCallDataCommentXml:()=>GE,Application_EmergencyCallDataControlXml:()=>XE,Application_EmergencyCallDataDeviceInfoXml:()=>qE,Application_EmergencyCallDataECallMSD:()=>YE,Application_EmergencyCallDataProviderInfoXml:()=>KE,Application_EmergencyCallDataServiceInfoXml:()=>QE,Application_EmergencyCallDataSubscriberInfoXml:()=>$E,Application_EmergencyCallDataVEDSXml:()=>JE,Application_EmmaXml:()=>ZE,Application_EmotionmlXml:()=>ek,Application_Encaprtp:()=>tk,Application_EppXml:()=>nk,Application_EpubZip:()=>ik,Application_Eshop:()=>rk,Application_Example:()=>ok,Application_Exi:()=>sk,Application_Expect_Ct_ReportJson:()=>ak,Application_Fastinfoset:()=>lk,Application_Fastsoap:()=>ck,Application_FdtXml:()=>uk,Application_FhirJson:()=>pk,Application_FhirXml:()=>dk,Application_Fido_TrustedAppsJson:()=>hk,Application_Fits:()=>mk,Application_Flexfec:()=>fk,Application_Font_Sfnt:()=>gk,Application_Font_Tdpfr:()=>xk,Application_Font_Woff:()=>wk,Application_Framework_AttributesXml:()=>Fk,Application_GeoJson:()=>Ak,Application_GeoJson_Seq:()=>vk,Application_GeopackageSqlite3:()=>bk,Application_GeoxacmlXml:()=>Sk,Application_Gltf_Buffer:()=>_k,Application_GmlXml:()=>yk,Application_GpxXml:()=>Tk,Application_Gxf:()=>Ek,Application_Gzip:()=>kk,Application_H224:()=>Mk,Application_HeldXml:()=>Dk,Application_Hjson:()=>Ck,Application_Http:()=>Lk,Application_Hyperstudio:()=>Pk,Application_IOTP:()=>Gk,Application_ISUP:()=>Yk,Application_Ibe_Key_RequestXml:()=>Rk,Application_Ibe_Pkg_ReplyXml:()=>Ik,Application_Ibe_Pp_Data:()=>Bk,Application_Iges:()=>Vk,Application_Im_IscomposingXml:()=>Ok,Application_Index:()=>Nk,Application_IndexCmd:()=>Wk,Application_IndexObj:()=>Hk,Application_IndexResponse:()=>Uk,Application_IndexVnd:()=>zk,Application_InkmlXml:()=>jk,Application_Ipfix:()=>Xk,Application_Ipp:()=>qk,Application_ItsXml:()=>Kk,Application_Java_Archive:()=>Qk,Application_Java_Serialized_Object:()=>$k,Application_Java_Vm:()=>Jk,Application_Javascript:()=>sr,Application_Jf2feedJson:()=>Zk,Application_Jose:()=>eM,Application_JoseJson:()=>tM,Application_JrdJson:()=>nM,Application_Json:()=>_a,Application_Json5:()=>iM,Application_JsonUTF8:()=>Jr,Application_Json_PatchJson:()=>rM,Application_Json_Seq:()=>oM,Application_JsonmlJson:()=>sM,Application_JwkJson:()=>lM,Application_Jwk_SetJson:()=>aM,Application_Jwt:()=>cM,Application_Kpml_RequestXml:()=>uM,Application_Kpml_ResponseXml:()=>pM,Application_LXF:()=>wM,Application_LdJson:()=>dM,Application_LgrXml:()=>hM,Application_Link_Format:()=>mM,Application_Load_ControlXml:()=>fM,Application_LostXml:()=>xM,Application_LostsyncXml:()=>gM,Application_MF4:()=>KM,Application_Mac_Binhex40:()=>FM,Application_Mac_Compactpro:()=>AM,Application_Macwriteii:()=>vM,Application_MadsXml:()=>bM,Application_ManifestJson:()=>SM,Application_Marc:()=>_M,Application_MarcxmlXml:()=>yM,Application_Mathematica:()=>TM,Application_MathmlXml:()=>MM,Application_Mathml_ContentXml:()=>EM,Application_Mathml_PresentationXml:()=>kM,Application_Mbms_Associated_Procedure_DescriptionXml:()=>DM,Application_Mbms_DeregisterXml:()=>CM,Application_Mbms_EnvelopeXml:()=>LM,Application_Mbms_MskXml:()=>RM,Application_Mbms_Msk_ResponseXml:()=>PM,Application_Mbms_Protection_DescriptionXml:()=>IM,Application_Mbms_Reception_ReportXml:()=>BM,Application_Mbms_RegisterXml:()=>OM,Application_Mbms_Register_ResponseXml:()=>VM,Application_Mbms_ScheduleXml:()=>NM,Application_Mbms_User_Service_DescriptionXml:()=>WM,Application_Mbox:()=>HM,Application_Media_Policy_DatasetXml:()=>zM,Application_Media_controlXml:()=>UM,Application_MediaservercontrolXml:()=>jM,Application_Merge_PatchJson:()=>GM,Application_Metalink4Xml:()=>XM,Application_MetalinkXml:()=>qM,Application_MetsXml:()=>YM,Application_Mikey:()=>QM,Application_Mipc:()=>$M,Application_Mmt_AeiXml:()=>JM,Application_Mmt_UsdXml:()=>ZM,Application_ModsXml:()=>eD,Application_Moss_Keys:()=>tD,Application_Moss_Signature:()=>nD,Application_Mosskey_Data:()=>iD,Application_Mosskey_Request:()=>rD,Application_Mp21:()=>oD,Application_Mp4:()=>sD,Application_Mpeg4_Generic:()=>aD,Application_Mpeg4_Iod:()=>lD,Application_Mpeg4_Iod_Xmt:()=>cD,Application_Mrb_ConsumerXml:()=>uD,Application_Mrb_PublishXml:()=>pD,Application_Msc_IvrXml:()=>dD,Application_Msc_MixerXml:()=>hD,Application_Msword:()=>mD,Application_MudJson:()=>fD,Application_Multipart_Core:()=>gD,Application_Mxf:()=>xD,Application_N_Quads:()=>wD,Application_N_Triples:()=>FD,Application_Nasdata:()=>AD,Application_News_Checkgroups:()=>vD,Application_News_Groupinfo:()=>bD,Application_News_Transmission:()=>SD,Application_NlsmlXml:()=>_D,Application_Node:()=>yD,Application_Nss:()=>TD,Application_ODA:()=>DD,Application_ODX:()=>LD,Application_Ocsp_Request:()=>ED,Application_Ocsp_Response:()=>kD,Application_Octet_Stream:()=>MD,Application_OdmXml:()=>CD,Application_Oebps_PackageXml:()=>PD,Application_Ogg:()=>RD,Application_OmdocXml:()=>ID,Application_Onenote:()=>BD,Application_Oscore:()=>VD,Application_Oxps:()=>OD,Application_P2p_OverlayXml:()=>ND,Application_PDX:()=>zD,Application_Parityfec:()=>WD,Application_Passport:()=>HD,Application_Patch_Ops_ErrorXml:()=>UD,Application_Pdf:()=>Zr,Application_Pem_Certificate_Chain:()=>jD,Application_Pgp_Encrypted:()=>GD,Application_Pgp_Keys:()=>XD,Application_Pgp_Signature:()=>qD,Application_Pics_Rules:()=>YD,Application_PidfXml:()=>QD,Application_Pidf_DiffXml:()=>KD,Application_Pkcs10:()=>$D,Application_Pkcs12:()=>JD,Application_Pkcs7_Mime:()=>ZD,Application_Pkcs7_Signature:()=>eC,Application_Pkcs8:()=>tC,Application_Pkcs8_Encrypted:()=>nC,Application_Pkix_Attr_Cert:()=>iC,Application_Pkix_Cert:()=>rC,Application_Pkix_Crl:()=>oC,Application_Pkix_Pkipath:()=>sC,Application_Pkixcmp:()=>aC,Application_PlsXml:()=>lC,Application_Poc_SettingsXml:()=>cC,Application_Postscript:()=>uC,Application_Ppsp_TrackerJson:()=>pC,Application_ProblemJson:()=>dC,Application_ProblemXml:()=>hC,Application_ProvenanceXml:()=>mC,Application_PrsAlvestrandTitrax_Sheet:()=>fC,Application_PrsCww:()=>gC,Application_PrsHpubZip:()=>xC,Application_PrsNprend:()=>wC,Application_PrsPlucker:()=>FC,Application_PrsRdf_Xml_Crypt:()=>AC,Application_PrsXsfXml:()=>vC,Application_PskcXml:()=>bC,Application_QSIG:()=>SC,Application_RamlYaml:()=>_C,Application_Raptorfec:()=>yC,Application_RdapJson:()=>TC,Application_RdfXml:()=>EC,Application_ReginfoXml:()=>kC,Application_Relax_Ng_Compact_Syntax:()=>MC,Application_Remote_Printing:()=>DC,Application_ReputonJson:()=>CC,Application_Resource_ListsXml:()=>PC,Application_Resource_Lists_DiffXml:()=>LC,Application_RfcXml:()=>RC,Application_Riscos:()=>IC,Application_RlmiXml:()=>BC,Application_Rls_ServicesXml:()=>VC,Application_Route_ApdXml:()=>OC,Application_Route_S_TsidXml:()=>NC,Application_Route_UsdXml:()=>WC,Application_Rpki_Ghostbusters:()=>HC,Application_Rpki_Manifest:()=>UC,Application_Rpki_Publication:()=>zC,Application_Rpki_Roa:()=>jC,Application_Rpki_Updown:()=>GC,Application_RsdXml:()=>XC,Application_RssXml:()=>qC,Application_Rtf:()=>YC,Application_Rtploopback:()=>KC,Application_Rtx:()=>QC,Application_SGML:()=>S3,Application_SamlassertionXml:()=>$C,Application_SamlmetadataXml:()=>JC,Application_SbmlXml:()=>ZC,Application_ScaipXml:()=>e3,Application_ScenarioJson:()=>t2,Application_ScimJson:()=>t3,Application_Scvp_Cv_Request:()=>n3,Application_Scvp_Cv_Response:()=>i3,Application_Scvp_Vp_Request:()=>r3,Application_Scvp_Vp_Response:()=>o3,Application_Sdp:()=>s3,Application_SeceventJwt:()=>a3,Application_SenmlCbor:()=>c3,Application_SenmlJson:()=>u3,Application_SenmlXml:()=>p3,Application_Senml_Exi:()=>l3,Application_SensmlCbor:()=>h3,Application_SensmlJson:()=>m3,Application_SensmlXml:()=>f3,Application_Sensml_Exi:()=>d3,Application_SepXml:()=>x3,Application_Sep_Exi:()=>g3,Application_Session_Info:()=>w3,Application_Set_Payment:()=>F3,Application_Set_Payment_Initiation:()=>A3,Application_Set_Registration:()=>v3,Application_Set_Registration_Initiation:()=>b3,Application_Sgml_Open_Catalog:()=>_3,Application_ShfXml:()=>y3,Application_Sieve:()=>T3,Application_SimpleSymbolContainer:()=>M3,Application_Simple_FilterXml:()=>E3,Application_Simple_Message_Summary:()=>k3,Application_Sipc:()=>D3,Application_Slate:()=>C3,Application_Smil:()=>L3,Application_SmilXml:()=>P3,Application_Smpte336m:()=>R3,Application_SoapFastinfoset:()=>I3,Application_SoapXml:()=>B3,Application_Sparql_Query:()=>V3,Application_Sparql_ResultsXml:()=>O3,Application_Spirits_EventXml:()=>N3,Application_Sql:()=>W3,Application_Srgs:()=>H3,Application_SrgsXml:()=>U3,Application_SruXml:()=>z3,Application_SsdlXml:()=>j3,Application_SsmlXml:()=>G3,Application_StixJson:()=>X3,Application_SwidXml:()=>q3,Application_TETRA_ISI:()=>lL,Application_Tamp_Apex_Update:()=>Y3,Application_Tamp_Apex_Update_Confirm:()=>K3,Application_Tamp_Community_Update:()=>Q3,Application_Tamp_Community_Update_Confirm:()=>$3,Application_Tamp_Error:()=>J3,Application_Tamp_Sequence_Adjust:()=>Z3,Application_Tamp_Sequence_Adjust_Confirm:()=>eL,Application_Tamp_Status_Query:()=>tL,Application_Tamp_Status_Response:()=>nL,Application_Tamp_Update:()=>iL,Application_Tamp_Update_Confirm:()=>rL,Application_Tar:()=>oL,Application_TaxiiJson:()=>sL,Application_TeiXml:()=>aL,Application_ThraudXml:()=>cL,Application_Timestamp_Query:()=>uL,Application_Timestamp_Reply:()=>pL,Application_Timestamped_Data:()=>dL,Application_TlsrptGzip:()=>hL,Application_TlsrptJson:()=>mL,Application_Tnauthlist:()=>fL,Application_Toml:()=>gL,Application_Trickle_Ice_Sdpfrag:()=>xL,Application_Trig:()=>wL,Application_TtmlXml:()=>FL,Application_Tve_Trigger:()=>AL,Application_Tzif:()=>vL,Application_Tzif_Leap:()=>bL,Application_Ubjson:()=>SL,Application_Ulpfec:()=>_L,Application_Urc_GrpsheetXml:()=>yL,Application_Urc_RessheetXml:()=>TL,Application_Urc_TargetdescXml:()=>EL,Application_Urc_UisocketdescXml:()=>kL,Application_VcardJson:()=>ML,Application_VcardXml:()=>DL,Application_Vemmi:()=>CL,Application_Vendor_1000mindsDecision_ModelXml:()=>LL,Application_Vendor_1d_Interleaved_Parityfec:()=>PL,Application_Vendor_3MPost_It_Notes:()=>MP,Application_Vendor_3gpdash_Qoe_ReportXml:()=>RL,Application_Vendor_3gpp2BcmcsinfoXml:()=>NL,Application_Vendor_3gpp2Sms:()=>WL,Application_Vendor_3gpp2Tcap:()=>HL,Application_Vendor_3gppAccess_Transfer_EventsXml:()=>UL,Application_Vendor_3gppBsfXml:()=>zL,Application_Vendor_3gppGMOPXml:()=>jL,Application_Vendor_3gppMc_Signalling_Ear:()=>GL,Application_Vendor_3gppMcdata_Affiliation_CommandXml:()=>XL,Application_Vendor_3gppMcdata_InfoXml:()=>qL,Application_Vendor_3gppMcdata_Payload:()=>YL,Application_Vendor_3gppMcdata_Service_ConfigXml:()=>KL,Application_Vendor_3gppMcdata_Signalling:()=>QL,Application_Vendor_3gppMcdata_Ue_ConfigXml:()=>$L,Application_Vendor_3gppMcdata_User_ProfileXml:()=>JL,Application_Vendor_3gppMcptt_Affiliation_CommandXml:()=>ZL,Application_Vendor_3gppMcptt_Floor_RequestXml:()=>eP,Application_Vendor_3gppMcptt_InfoXml:()=>tP,Application_Vendor_3gppMcptt_Location_InfoXml:()=>nP,Application_Vendor_3gppMcptt_Mbms_Usage_InfoXml:()=>iP,Application_Vendor_3gppMcptt_Service_ConfigXml:()=>rP,Application_Vendor_3gppMcptt_SignedXml:()=>oP,Application_Vendor_3gppMcptt_Ue_ConfigXml:()=>sP,Application_Vendor_3gppMcptt_Ue_Init_ConfigXml:()=>aP,Application_Vendor_3gppMcptt_User_ProfileXml:()=>lP,Application_Vendor_3gppMcvideo_Affiliation_CommandXml:()=>cP,Application_Vendor_3gppMcvideo_Affiliation_InfoXml:()=>uP,Application_Vendor_3gppMcvideo_InfoXml:()=>pP,Application_Vendor_3gppMcvideo_Location_InfoXml:()=>dP,Application_Vendor_3gppMcvideo_Mbms_Usage_InfoXml:()=>hP,Application_Vendor_3gppMcvideo_Service_ConfigXml:()=>mP,Application_Vendor_3gppMcvideo_Transmission_RequestXml:()=>fP,Application_Vendor_3gppMcvideo_Ue_ConfigXml:()=>gP,Application_Vendor_3gppMcvideo_User_ProfileXml:()=>xP,Application_Vendor_3gppMid_CallXml:()=>wP,Application_Vendor_3gppPic_Bw_Large:()=>FP,Application_Vendor_3gppPic_Bw_Small:()=>AP,Application_Vendor_3gppPic_Bw_Var:()=>vP,Application_Vendor_3gppSRVCC_InfoXml:()=>yP,Application_Vendor_3gppSms:()=>bP,Application_Vendor_3gppSmsXml:()=>SP,Application_Vendor_3gppSrvcc_ExtXml:()=>_P,Application_Vendor_3gppState_And_Event_InfoXml:()=>TP,Application_Vendor_3gppUssdXml:()=>EP,Application_Vendor_3gpp_ImsXml:()=>IL,Application_Vendor_3gpp_ProseXml:()=>VL,Application_Vendor_3gpp_Prose_Pc3chXml:()=>BL,Application_Vendor_3gpp_V2x_Local_Service_Information:()=>OL,Application_Vendor_3lightssoftwareImagescal:()=>kP,Application_Vendor_AccpacSimplyAso:()=>DP,Application_Vendor_AccpacSimplyImp:()=>CP,Application_Vendor_Acucobol:()=>LP,Application_Vendor_Acucorp:()=>PP,Application_Vendor_AdobeAir_Application_Installer_PackageZip:()=>RP,Application_Vendor_AdobeFlashMovie:()=>IP,Application_Vendor_AdobeFormscentralFcdt:()=>BP,Application_Vendor_AdobeFxp:()=>VP,Application_Vendor_AdobePartial_Upload:()=>OP,Application_Vendor_AdobeXdpXml:()=>NP,Application_Vendor_AdobeXfdf:()=>WP,Application_Vendor_AetherImp:()=>HP,Application_Vendor_AfpcAfplinedata:()=>UP,Application_Vendor_AfpcAfplinedata_Pagedef:()=>zP,Application_Vendor_AfpcFoca_Charset:()=>jP,Application_Vendor_AfpcFoca_Codedfont:()=>GP,Application_Vendor_AfpcFoca_Codepage:()=>XP,Application_Vendor_AfpcModca:()=>qP,Application_Vendor_AfpcModca_Formdef:()=>YP,Application_Vendor_AfpcModca_Mediummap:()=>KP,Application_Vendor_AfpcModca_Objectcontainer:()=>QP,Application_Vendor_AfpcModca_Overlay:()=>$P,Application_Vendor_AfpcModca_Pagesegment:()=>JP,Application_Vendor_Ah_Barcode:()=>ZP,Application_Vendor_AheadSpace:()=>eR,Application_Vendor_AirzipFilesecureAzf:()=>tR,Application_Vendor_AirzipFilesecureAzs:()=>nR,Application_Vendor_AmadeusJson:()=>iR,Application_Vendor_AmazonEbook:()=>rR,Application_Vendor_AmazonMobi8_Ebook:()=>oR,Application_Vendor_AmericandynamicsAcc:()=>sR,Application_Vendor_AmigaAmi:()=>aR,Application_Vendor_AmundsenMazeXml:()=>lR,Application_Vendor_AndroidOta:()=>cR,Application_Vendor_AndroidPackage_Archive:()=>uR,Application_Vendor_Anki:()=>pR,Application_Vendor_Anser_Web_Certificate_Issue_Initiation:()=>dR,Application_Vendor_Anser_Web_Funds_Transfer_Initiation:()=>hR,Application_Vendor_AntixGame_Component:()=>mR,Application_Vendor_ApacheThriftBinary:()=>fR,Application_Vendor_ApacheThriftCompact:()=>gR,Application_Vendor_ApacheThriftJson:()=>xR,Application_Vendor_ApiJson:()=>wR,Application_Vendor_AplextorWarrpJson:()=>FR,Application_Vendor_ApothekendeReservationJson:()=>AR,Application_Vendor_AppleInstallerXml:()=>vR,Application_Vendor_AppleKeynote:()=>bR,Application_Vendor_AppleMpegurl:()=>SR,Application_Vendor_AppleNumbers:()=>_R,Application_Vendor_ApplePages:()=>yR,Application_Vendor_ApplePkpass:()=>TR,Application_Vendor_ArastraSwi:()=>ER,Application_Vendor_AristanetworksSwi:()=>kR,Application_Vendor_ArtisanJson:()=>MR,Application_Vendor_Artsquare:()=>DR,Application_Vendor_Astraea_SoftwareIota:()=>CR,Application_Vendor_Audiograph:()=>LR,Application_Vendor_Autopackage:()=>PR,Application_Vendor_AvalonJson:()=>RR,Application_Vendor_AvistarXml:()=>IR,Application_Vendor_BalsamiqBmmlXml:()=>BR,Application_Vendor_BalsamiqBmpr:()=>VR,Application_Vendor_Banana_Accounting:()=>OR,Application_Vendor_BbfUspError:()=>NR,Application_Vendor_BbfUspMsg:()=>WR,Application_Vendor_BbfUspMsgJson:()=>HR,Application_Vendor_Bekitzur_StechJson:()=>UR,Application_Vendor_BintMed_Content:()=>zR,Application_Vendor_BiopaxRdfXml:()=>jR,Application_Vendor_Blink_Idb_Value_Wrapper:()=>GR,Application_Vendor_BlueiceMultipass:()=>XR,Application_Vendor_BluetoothEpOob:()=>qR,Application_Vendor_BluetoothLeOob:()=>YR,Application_Vendor_Bmi:()=>KR,Application_Vendor_Bpf:()=>QR,Application_Vendor_Bpf3:()=>$R,Application_Vendor_Businessobjects:()=>JR,Application_Vendor_ByuUapiJson:()=>ZR,Application_Vendor_Cab_Jscript:()=>eI,Application_Vendor_Canon_Cpdl:()=>tI,Application_Vendor_Canon_Lips:()=>nI,Application_Vendor_Capasystems_PgJson:()=>iI,Application_Vendor_CendioThinlincClientconf:()=>rI,Application_Vendor_Century_SystemsTcp_stream:()=>oI,Application_Vendor_ChemdrawXml:()=>sI,Application_Vendor_Chess_Pgn:()=>aI,Application_Vendor_ChipnutsKaraoke_Mmd:()=>lI,Application_Vendor_Ciedi:()=>cI,Application_Vendor_Cinderella:()=>uI,Application_Vendor_CirpackIsdn_Ext:()=>pI,Application_Vendor_CitationstylesStyleXml:()=>dI,Application_Vendor_Claymore:()=>hI,Application_Vendor_CloantoRp9:()=>mI,Application_Vendor_ClonkC4group:()=>fI,Application_Vendor_CluetrustCartomobile_Config:()=>gI,Application_Vendor_CluetrustCartomobile_Config_Pkg:()=>xI,Application_Vendor_Coffeescript:()=>wI,Application_Vendor_CollabioXodocumentsDocument:()=>FI,Application_Vendor_CollabioXodocumentsDocument_Template:()=>AI,Application_Vendor_CollabioXodocumentsPresentation:()=>vI,Application_Vendor_CollabioXodocumentsPresentation_Template:()=>bI,Application_Vendor_CollabioXodocumentsSpreadsheet:()=>SI,Application_Vendor_CollabioXodocumentsSpreadsheet_Template:()=>_I,Application_Vendor_CollectionDocJson:()=>yI,Application_Vendor_CollectionJson:()=>TI,Application_Vendor_CollectionNextJson:()=>EI,Application_Vendor_ComicbookZip:()=>MI,Application_Vendor_Comicbook_Rar:()=>kI,Application_Vendor_Commerce_Battelle:()=>DI,Application_Vendor_Commonspace:()=>CI,Application_Vendor_ContactCmsg:()=>LI,Application_Vendor_CoreosIgnitionJson:()=>PI,Application_Vendor_Cosmocaller:()=>RI,Application_Vendor_CrickClicker:()=>II,Application_Vendor_CrickClickerKeyboard:()=>BI,Application_Vendor_CrickClickerPalette:()=>VI,Application_Vendor_CrickClickerTemplate:()=>OI,Application_Vendor_CrickClickerWordbank:()=>NI,Application_Vendor_CriticaltoolsWbsXml:()=>WI,Application_Vendor_CryptiiPipeJson:()=>HI,Application_Vendor_Crypto_Shade_File:()=>UI,Application_Vendor_Ctc_Posml:()=>zI,Application_Vendor_CtctWsXml:()=>jI,Application_Vendor_Cups_Pdf:()=>GI,Application_Vendor_Cups_Postscript:()=>XI,Application_Vendor_Cups_Ppd:()=>qI,Application_Vendor_Cups_Raster:()=>YI,Application_Vendor_Cups_Raw:()=>KI,Application_Vendor_Curl:()=>QI,Application_Vendor_CurlCar:()=>$I,Application_Vendor_CurlPcurl:()=>JI,Application_Vendor_CyanDeanRootXml:()=>ZI,Application_Vendor_Cybank:()=>eB,Application_Vendor_D2lCoursepackage1p0Zip:()=>tB,Application_Vendor_Dart:()=>nB,Application_Vendor_Data_VisionRdz:()=>iB,Application_Vendor_DatapackageJson:()=>rB,Application_Vendor_DataresourceJson:()=>oB,Application_Vendor_DebianBinary_Package:()=>sB,Application_Vendor_DeceData:()=>aB,Application_Vendor_DeceTtmlXml:()=>lB,Application_Vendor_DeceUnspecified:()=>cB,Application_Vendor_DeceZip:()=>uB,Application_Vendor_DenovoFcselayout_Link:()=>pB,Application_Vendor_DesmumeMovie:()=>dB,Application_Vendor_Dir_BiPlate_Dl_Nosuffix:()=>hB,Application_Vendor_DmDelegationXml:()=>mB,Application_Vendor_Dna:()=>fB,Application_Vendor_DocumentJson:()=>gB,Application_Vendor_DolbyMlp:()=>xB,Application_Vendor_DolbyMobile1:()=>wB,Application_Vendor_DolbyMobile2:()=>FB,Application_Vendor_DoremirScorecloud_Binary_Document:()=>AB,Application_Vendor_Dpgraph:()=>vB,Application_Vendor_Dreamfactory:()=>bB,Application_Vendor_DriveJson:()=>SB,Application_Vendor_Ds_Keypoint:()=>_B,Application_Vendor_DtgLocal:()=>yB,Application_Vendor_DtgLocalFlash:()=>TB,Application_Vendor_DtgLocalHtml:()=>EB,Application_Vendor_DvbAit:()=>kB,Application_Vendor_DvbDvbj:()=>MB,Application_Vendor_DvbEsgcontainer:()=>DB,Application_Vendor_DvbIpdcdftnotifaccess:()=>CB,Application_Vendor_DvbIpdcesgaccess:()=>LB,Application_Vendor_DvbIpdcesgaccess2:()=>PB,Application_Vendor_DvbIpdcesgpdd:()=>RB,Application_Vendor_DvbIpdcroaming:()=>IB,Application_Vendor_DvbIptvAlfec_Base:()=>BB,Application_Vendor_DvbIptvAlfec_Enhancement:()=>VB,Application_Vendor_DvbNotif_Aggregate_RootXml:()=>OB,Application_Vendor_DvbNotif_ContainerXml:()=>NB,Application_Vendor_DvbNotif_GenericXml:()=>WB,Application_Vendor_DvbNotif_Ia_MsglistXml:()=>HB,Application_Vendor_DvbNotif_Ia_Registration_RequestXml:()=>UB,Application_Vendor_DvbNotif_Ia_Registration_ResponseXml:()=>zB,Application_Vendor_DvbNotif_InitXml:()=>jB,Application_Vendor_DvbPfr:()=>GB,Application_Vendor_DvbService:()=>XB,Application_Vendor_Dxr:()=>qB,Application_Vendor_Dynageo:()=>YB,Application_Vendor_Dzr:()=>KB,Application_Vendor_EasykaraokeCdgdownload:()=>QB,Application_Vendor_Ecdis_Update:()=>$B,Application_Vendor_EcipRlp:()=>JB,Application_Vendor_EcowinChart:()=>ZB,Application_Vendor_EcowinFilerequest:()=>e4,Application_Vendor_EcowinFileupdate:()=>t4,Application_Vendor_EcowinSeries:()=>n4,Application_Vendor_EcowinSeriesrequest:()=>i4,Application_Vendor_EcowinSeriesupdate:()=>r4,Application_Vendor_EfiImg:()=>o4,Application_Vendor_EfiIso:()=>s4,Application_Vendor_EmclientAccessrequestXml:()=>a4,Application_Vendor_Enliven:()=>l4,Application_Vendor_EnphaseEnvoy:()=>c4,Application_Vendor_EprintsDataXml:()=>u4,Application_Vendor_EpsonEsf:()=>p4,Application_Vendor_EpsonMsf:()=>d4,Application_Vendor_EpsonQuickanime:()=>h4,Application_Vendor_EpsonSalt:()=>m4,Application_Vendor_EpsonSsf:()=>f4,Application_Vendor_EricssonQuickcall:()=>g4,Application_Vendor_Espass_EspassZip:()=>x4,Application_Vendor_Eszigno3Xml:()=>w4,Application_Vendor_EtsiAocXml:()=>F4,Application_Vendor_EtsiAsic_EZip:()=>A4,Application_Vendor_EtsiAsic_SZip:()=>v4,Application_Vendor_EtsiCugXml:()=>b4,Application_Vendor_EtsiIptvcommandXml:()=>S4,Application_Vendor_EtsiIptvdiscoveryXml:()=>_4,Application_Vendor_EtsiIptvprofileXml:()=>y4,Application_Vendor_EtsiIptvsad_BcXml:()=>T4,Application_Vendor_EtsiIptvsad_CodXml:()=>E4,Application_Vendor_EtsiIptvsad_NpvrXml:()=>k4,Application_Vendor_EtsiIptvserviceXml:()=>M4,Application_Vendor_EtsiIptvsyncXml:()=>D4,Application_Vendor_EtsiIptvueprofileXml:()=>C4,Application_Vendor_EtsiMcidXml:()=>L4,Application_Vendor_EtsiMheg5:()=>P4,Application_Vendor_EtsiOverload_Control_Policy_DatasetXml:()=>R4,Application_Vendor_EtsiPstnXml:()=>I4,Application_Vendor_EtsiSciXml:()=>B4,Application_Vendor_EtsiSimservsXml:()=>V4,Application_Vendor_EtsiTimestamp_Token:()=>O4,Application_Vendor_EtsiTslDer:()=>N4,Application_Vendor_EtsiTslXml:()=>W4,Application_Vendor_EudoraData:()=>H4,Application_Vendor_EvolvEcigProfile:()=>U4,Application_Vendor_EvolvEcigSettings:()=>z4,Application_Vendor_EvolvEcigTheme:()=>j4,Application_Vendor_Exstream_EmpowerZip:()=>G4,Application_Vendor_Exstream_Package:()=>X4,Application_Vendor_Ezpix_Album:()=>q4,Application_Vendor_Ezpix_Package:()=>Y4,Application_Vendor_F_SecureMobile:()=>K4,Application_Vendor_Fastcopy_Disk_Image:()=>Q4,Application_Vendor_Fdf:()=>$4,Application_Vendor_FdsnMseed:()=>J4,Application_Vendor_FdsnSeed:()=>Z4,Application_Vendor_Ffsns:()=>e6,Application_Vendor_FiclabFlbZip:()=>t6,Application_Vendor_FilmitZfc:()=>n6,Application_Vendor_Fints:()=>i6,Application_Vendor_FiremonkeysCloudcell:()=>r6,Application_Vendor_FloGraphIt:()=>o6,Application_Vendor_FluxtimeClip:()=>s6,Application_Vendor_Font_Fontforge_Sfd:()=>a6,Application_Vendor_Framemaker:()=>l6,Application_Vendor_FrogansFnc:()=>c6,Application_Vendor_FrogansLtf:()=>u6,Application_Vendor_FscWeblaunch:()=>p6,Application_Vendor_FujitsuOasys:()=>d6,Application_Vendor_FujitsuOasys2:()=>h6,Application_Vendor_FujitsuOasys3:()=>m6,Application_Vendor_FujitsuOasysgp:()=>f6,Application_Vendor_FujitsuOasysprs:()=>g6,Application_Vendor_FujixeroxART4:()=>w6,Application_Vendor_FujixeroxART_EX:()=>x6,Application_Vendor_FujixeroxDdd:()=>F6,Application_Vendor_FujixeroxDocuworks:()=>A6,Application_Vendor_FujixeroxDocuworksBinder:()=>v6,Application_Vendor_FujixeroxDocuworksContainer:()=>b6,Application_Vendor_FujixeroxHBPL:()=>S6,Application_Vendor_Fut_Misnet:()=>_6,Application_Vendor_FutoinCbor:()=>y6,Application_Vendor_FutoinJson:()=>T6,Application_Vendor_Fuzzysheet:()=>E6,Application_Vendor_GenomatixTuxedo:()=>k6,Application_Vendor_GenticsGrdJson:()=>M6,Application_Vendor_GeoJson:()=>P6,Application_Vendor_GeocubeXml:()=>D6,Application_Vendor_GeogebraFile:()=>C6,Application_Vendor_GeogebraTool:()=>L6,Application_Vendor_Geometry_Explorer:()=>R6,Application_Vendor_Geonext:()=>I6,Application_Vendor_Geoplan:()=>B6,Application_Vendor_Geospace:()=>V6,Application_Vendor_Gerber:()=>O6,Application_Vendor_GlobalplatformCard_Content_Mgt:()=>N6,Application_Vendor_GlobalplatformCard_Content_Mgt_Response:()=>W6,Application_Vendor_Gmx:()=>H6,Application_Vendor_Google_Apps_Document:()=>U6,Application_Vendor_Google_Apps_Presentation:()=>z6,Application_Vendor_Google_Apps_Spreadsheet:()=>j6,Application_Vendor_Google_EarthKmlXml:()=>G6,Application_Vendor_Google_EarthKmz:()=>X6,Application_Vendor_GovSkE_FormXml:()=>q6,Application_Vendor_GovSkE_FormZip:()=>Y6,Application_Vendor_GovSkXmldatacontainerXml:()=>K6,Application_Vendor_Grafeq:()=>Q6,Application_Vendor_Gridmp:()=>$6,Application_Vendor_Groove_Account:()=>J6,Application_Vendor_Groove_Help:()=>Z6,Application_Vendor_Groove_Identity_Message:()=>eV,Application_Vendor_Groove_Injector:()=>tV,Application_Vendor_Groove_Tool_Message:()=>nV,Application_Vendor_Groove_Tool_Template:()=>iV,Application_Vendor_Groove_Vcard:()=>rV,Application_Vendor_HalJson:()=>oV,Application_Vendor_HalXml:()=>sV,Application_Vendor_HandHeld_EntertainmentXml:()=>aV,Application_Vendor_Hbci:()=>lV,Application_Vendor_HcJson:()=>cV,Application_Vendor_Hcl_Bireports:()=>uV,Application_Vendor_Hdt:()=>pV,Application_Vendor_HerokuJson:()=>dV,Application_Vendor_HheLesson_Player:()=>hV,Application_Vendor_Hp_HPGL:()=>mV,Application_Vendor_Hp_Hpid:()=>fV,Application_Vendor_Hp_Hps:()=>gV,Application_Vendor_Hp_Jlyt:()=>xV,Application_Vendor_Hp_PCL:()=>wV,Application_Vendor_Hp_PCLXL:()=>FV,Application_Vendor_Httphone:()=>AV,Application_Vendor_HydrostatixSof_Data:()=>vV,Application_Vendor_HyperJson:()=>_V,Application_Vendor_Hyper_ItemJson:()=>bV,Application_Vendor_HyperdriveJson:()=>SV,Application_Vendor_Hzn_3d_Crossword:()=>yV,Application_Vendor_IbmAfplinedata:()=>TV,Application_Vendor_IbmElectronic_Media:()=>EV,Application_Vendor_IbmMiniPay:()=>kV,Application_Vendor_IbmModcap:()=>MV,Application_Vendor_IbmRights_Management:()=>DV,Application_Vendor_IbmSecure_Container:()=>CV,Application_Vendor_Iccprofile:()=>LV,Application_Vendor_Ieee1905:()=>PV,Application_Vendor_Igloader:()=>RV,Application_Vendor_ImagemeterFolderZip:()=>IV,Application_Vendor_ImagemeterImageZip:()=>BV,Application_Vendor_Immervision_Ivp:()=>VV,Application_Vendor_Immervision_Ivu:()=>OV,Application_Vendor_ImsImsccv1p1:()=>NV,Application_Vendor_ImsImsccv1p2:()=>WV,Application_Vendor_ImsImsccv1p3:()=>HV,Application_Vendor_ImsLisV2ResultJson:()=>UV,Application_Vendor_ImsLtiV2ToolconsumerprofileJson:()=>zV,Application_Vendor_ImsLtiV2ToolproxyIdJson:()=>jV,Application_Vendor_ImsLtiV2ToolproxyJson:()=>GV,Application_Vendor_ImsLtiV2ToolsettingsJson:()=>XV,Application_Vendor_ImsLtiV2ToolsettingsSimpleJson:()=>qV,Application_Vendor_InformedcontrolRmsXml:()=>YV,Application_Vendor_Informix_Visionary:()=>KV,Application_Vendor_InfotechProject:()=>QV,Application_Vendor_InfotechProjectXml:()=>$V,Application_Vendor_InnopathWampNotification:()=>JV,Application_Vendor_InsorsIgm:()=>ZV,Application_Vendor_InterconFormnet:()=>eO,Application_Vendor_Intergeo:()=>tO,Application_Vendor_IntertrustDigibox:()=>nO,Application_Vendor_IntertrustNncp:()=>iO,Application_Vendor_IntuQbo:()=>rO,Application_Vendor_IntuQfx:()=>oO,Application_Vendor_IptcG2CatalogitemXml:()=>sO,Application_Vendor_IptcG2ConceptitemXml:()=>aO,Application_Vendor_IptcG2KnowledgeitemXml:()=>lO,Application_Vendor_IptcG2NewsitemXml:()=>cO,Application_Vendor_IptcG2NewsmessageXml:()=>uO,Application_Vendor_IptcG2PackageitemXml:()=>pO,Application_Vendor_IptcG2PlanningitemXml:()=>dO,Application_Vendor_IpunpluggedRcprofile:()=>hO,Application_Vendor_IrepositoryPackageXml:()=>mO,Application_Vendor_Is_Xpr:()=>fO,Application_Vendor_IsacFcs:()=>gO,Application_Vendor_Iso11783_10Zip:()=>xO,Application_Vendor_Jam:()=>wO,Application_Vendor_Japannet_Directory_Service:()=>FO,Application_Vendor_Japannet_Jpnstore_Wakeup:()=>AO,Application_Vendor_Japannet_Payment_Wakeup:()=>vO,Application_Vendor_Japannet_Registration:()=>bO,Application_Vendor_Japannet_Registration_Wakeup:()=>SO,Application_Vendor_Japannet_Setstore_Wakeup:()=>_O,Application_Vendor_Japannet_Verification:()=>yO,Application_Vendor_Japannet_Verification_Wakeup:()=>TO,Application_Vendor_JcpJavameMidlet_Rms:()=>EO,Application_Vendor_Jisp:()=>kO,Application_Vendor_JoostJoda_Archive:()=>MO,Application_Vendor_JskIsdn_Ngn:()=>DO,Application_Vendor_Kahootz:()=>CO,Application_Vendor_KdeKarbon:()=>LO,Application_Vendor_KdeKchart:()=>PO,Application_Vendor_KdeKformula:()=>RO,Application_Vendor_KdeKivio:()=>IO,Application_Vendor_KdeKontour:()=>BO,Application_Vendor_KdeKpresenter:()=>VO,Application_Vendor_KdeKspread:()=>OO,Application_Vendor_KdeKword:()=>NO,Application_Vendor_Kenameaapp:()=>WO,Application_Vendor_Kidspiration:()=>HO,Application_Vendor_Kinar:()=>UO,Application_Vendor_Koan:()=>zO,Application_Vendor_Kodak_Descriptor:()=>jO,Application_Vendor_Las:()=>GO,Application_Vendor_LasLasJson:()=>XO,Application_Vendor_LasLasXml:()=>qO,Application_Vendor_Laszip:()=>YO,Application_Vendor_LeapJson:()=>KO,Application_Vendor_Liberty_RequestXml:()=>QO,Application_Vendor_LlamagraphicsLife_BalanceDesktop:()=>$O,Application_Vendor_LlamagraphicsLife_BalanceExchangeXml:()=>JO,Application_Vendor_LogipipeCircuitZip:()=>ZO,Application_Vendor_Loom:()=>e5,Application_Vendor_Lotus_1_2_3:()=>t5,Application_Vendor_Lotus_Approach:()=>n5,Application_Vendor_Lotus_Freelance:()=>i5,Application_Vendor_Lotus_Notes:()=>r5,Application_Vendor_Lotus_Organizer:()=>o5,Application_Vendor_Lotus_Screencam:()=>s5,Application_Vendor_Lotus_Wordpro:()=>a5,Application_Vendor_MFER:()=>A5,Application_Vendor_MacportsPortpkg:()=>l5,Application_Vendor_Mapbox_Vector_Tile:()=>c5,Application_Vendor_MarlinDrmActiontokenXml:()=>u5,Application_Vendor_MarlinDrmConftokenXml:()=>p5,Application_Vendor_MarlinDrmLicenseXml:()=>d5,Application_Vendor_MarlinDrmMdcf:()=>h5,Application_Vendor_MasonJson:()=>m5,Application_Vendor_MaxmindMaxmind_Db:()=>f5,Application_Vendor_Mcd:()=>g5,Application_Vendor_Medcalcdata:()=>x5,Application_Vendor_MediastationCdkey:()=>w5,Application_Vendor_Meridian_Slingshot:()=>F5,Application_Vendor_Mfmp:()=>v5,Application_Vendor_MicroJson:()=>_5,Application_Vendor_MicrografxFlo:()=>b5,Application_Vendor_MicrografxIgx:()=>S5,Application_Vendor_MicrosoftPortable_Executable:()=>y5,Application_Vendor_MicrosoftWindowsThumbnail_Cache:()=>T5,Application_Vendor_MieleJson:()=>E5,Application_Vendor_Mif:()=>k5,Application_Vendor_Minisoft_Hp3000_Save:()=>M5,Application_Vendor_MitsubishiMisty_GuardTrustweb:()=>D5,Application_Vendor_MobiusDAF:()=>C5,Application_Vendor_MobiusDIS:()=>L5,Application_Vendor_MobiusMBK:()=>P5,Application_Vendor_MobiusMQY:()=>R5,Application_Vendor_MobiusMSL:()=>I5,Application_Vendor_MobiusPLC:()=>B5,Application_Vendor_MobiusTXF:()=>V5,Application_Vendor_MophunApplication:()=>O5,Application_Vendor_MophunCertificate:()=>N5,Application_Vendor_MotorolaFlexsuite:()=>W5,Application_Vendor_MotorolaFlexsuiteAdsi:()=>H5,Application_Vendor_MotorolaFlexsuiteFis:()=>U5,Application_Vendor_MotorolaFlexsuiteGotap:()=>z5,Application_Vendor_MotorolaFlexsuiteKmr:()=>j5,Application_Vendor_MotorolaFlexsuiteTtc:()=>G5,Application_Vendor_MotorolaFlexsuiteWem:()=>X5,Application_Vendor_MotorolaIprm:()=>q5,Application_Vendor_MozillaXulXml:()=>Y5,Application_Vendor_Ms_3mfdocument:()=>K5,Application_Vendor_Ms_Artgalry:()=>Q5,Application_Vendor_Ms_Asf:()=>$5,Application_Vendor_Ms_Cab_Compressed:()=>J5,Application_Vendor_Ms_ColorIccprofile:()=>Z5,Application_Vendor_Ms_Excel:()=>eN,Application_Vendor_Ms_ExcelAddinMacroEnabled12:()=>tN,Application_Vendor_Ms_ExcelSheetBinaryMacroEnabled12:()=>nN,Application_Vendor_Ms_ExcelSheetMacroEnabled12:()=>iN,Application_Vendor_Ms_ExcelTemplateMacroEnabled12:()=>rN,Application_Vendor_Ms_Fontobject:()=>oN,Application_Vendor_Ms_Htmlhelp:()=>sN,Application_Vendor_Ms_Ims:()=>aN,Application_Vendor_Ms_Lrm:()=>lN,Application_Vendor_Ms_OfficeActiveXXml:()=>cN,Application_Vendor_Ms_Officetheme:()=>uN,Application_Vendor_Ms_Opentype:()=>pN,Application_Vendor_Ms_Outlook:()=>dN,Application_Vendor_Ms_PackageObfuscated_Opentype:()=>hN,Application_Vendor_Ms_PkiSeccat:()=>mN,Application_Vendor_Ms_PkiStl:()=>fN,Application_Vendor_Ms_PlayreadyInitiatorXml:()=>gN,Application_Vendor_Ms_Powerpoint:()=>xN,Application_Vendor_Ms_PowerpointAddinMacroEnabled12:()=>wN,Application_Vendor_Ms_PowerpointPresentationMacroEnabled12:()=>FN,Application_Vendor_Ms_PowerpointSlideMacroEnabled12:()=>AN,Application_Vendor_Ms_PowerpointSlideshowMacroEnabled12:()=>vN,Application_Vendor_Ms_PowerpointTemplateMacroEnabled12:()=>bN,Application_Vendor_Ms_PrintDeviceCapabilitiesXml:()=>SN,Application_Vendor_Ms_PrintSchemaTicketXml:()=>yN,Application_Vendor_Ms_PrintingPrintticketXml:()=>_N,Application_Vendor_Ms_Project:()=>TN,Application_Vendor_Ms_Tnef:()=>EN,Application_Vendor_Ms_WindowsDevicepairing:()=>kN,Application_Vendor_Ms_WindowsNwprintingOob:()=>MN,Application_Vendor_Ms_WindowsPrinterpairing:()=>DN,Application_Vendor_Ms_WindowsWsdOob:()=>CN,Application_Vendor_Ms_WmdrmLic_Chlg_Req:()=>LN,Application_Vendor_Ms_WmdrmLic_Resp:()=>PN,Application_Vendor_Ms_WmdrmMeter_Chlg_Req:()=>RN,Application_Vendor_Ms_WmdrmMeter_Resp:()=>IN,Application_Vendor_Ms_WordDocumentMacroEnabled12:()=>BN,Application_Vendor_Ms_WordTemplateMacroEnabled12:()=>VN,Application_Vendor_Ms_Works:()=>ON,Application_Vendor_Ms_Wpl:()=>NN,Application_Vendor_Ms_Xpsdocument:()=>WN,Application_Vendor_Msa_Disk_Image:()=>HN,Application_Vendor_Mseq:()=>UN,Application_Vendor_Msign:()=>zN,Application_Vendor_MultiadCreator:()=>jN,Application_Vendor_MultiadCreatorCif:()=>GN,Application_Vendor_Music_Niff:()=>XN,Application_Vendor_Musician:()=>qN,Application_Vendor_MuveeStyle:()=>YN,Application_Vendor_Mynfc:()=>KN,Application_Vendor_NcdControl:()=>QN,Application_Vendor_NcdReference:()=>$N,Application_Vendor_NearstInvJson:()=>JN,Application_Vendor_Nervana:()=>ZN,Application_Vendor_Netfpx:()=>e9,Application_Vendor_NeurolanguageNlu:()=>t9,Application_Vendor_Nimn:()=>n9,Application_Vendor_NintendoNitroRom:()=>i9,Application_Vendor_NintendoSnesRom:()=>r9,Application_Vendor_Nitf:()=>o9,Application_Vendor_Noblenet_Directory:()=>s9,Application_Vendor_Noblenet_Sealer:()=>a9,Application_Vendor_Noblenet_Web:()=>l9,Application_Vendor_NokiaCatalogs:()=>c9,Application_Vendor_NokiaConmlWbxml:()=>u9,Application_Vendor_NokiaConmlXml:()=>p9,Application_Vendor_NokiaISDS_Radio_Presets:()=>h9,Application_Vendor_NokiaIptvConfigXml:()=>d9,Application_Vendor_NokiaLandmarkWbxml:()=>f9,Application_Vendor_NokiaLandmarkXml:()=>g9,Application_Vendor_NokiaLandmarkcollectionXml:()=>m9,Application_Vendor_NokiaN_GageAcXml:()=>x9,Application_Vendor_NokiaN_GageData:()=>w9,Application_Vendor_NokiaN_GageSymbianInstall:()=>F9,Application_Vendor_NokiaNcd:()=>A9,Application_Vendor_NokiaPcdWbxml:()=>v9,Application_Vendor_NokiaPcdXml:()=>b9,Application_Vendor_NokiaRadio_Preset:()=>S9,Application_Vendor_NokiaRadio_Presets:()=>_9,Application_Vendor_NovadigmEDM:()=>y9,Application_Vendor_NovadigmEDX:()=>T9,Application_Vendor_NovadigmEXT:()=>E9,Application_Vendor_Ntt_LocalContent_Share:()=>k9,Application_Vendor_Ntt_LocalFile_Transfer:()=>M9,Application_Vendor_Ntt_LocalOgw_remote_Access:()=>D9,Application_Vendor_Ntt_LocalSip_Ta_remote:()=>C9,Application_Vendor_Ntt_LocalSip_Ta_tcp_stream:()=>L9,Application_Vendor_OasisOpendocumentChart:()=>P9,Application_Vendor_OasisOpendocumentChart_Template:()=>R9,Application_Vendor_OasisOpendocumentDatabase:()=>I9,Application_Vendor_OasisOpendocumentFormula:()=>B9,Application_Vendor_OasisOpendocumentFormula_Template:()=>V9,Application_Vendor_OasisOpendocumentGraphics:()=>O9,Application_Vendor_OasisOpendocumentGraphics_Template:()=>N9,Application_Vendor_OasisOpendocumentImage:()=>W9,Application_Vendor_OasisOpendocumentImage_Template:()=>H9,Application_Vendor_OasisOpendocumentPresentation:()=>U9,Application_Vendor_OasisOpendocumentPresentation_Template:()=>z9,Application_Vendor_OasisOpendocumentSpreadsheet:()=>j9,Application_Vendor_OasisOpendocumentSpreadsheet_Template:()=>G9,Application_Vendor_OasisOpendocumentText:()=>X9,Application_Vendor_OasisOpendocumentText_Master:()=>q9,Application_Vendor_OasisOpendocumentText_Template:()=>Y9,Application_Vendor_OasisOpendocumentText_Web:()=>K9,Application_Vendor_Obn:()=>Q9,Application_Vendor_OcfCbor:()=>$9,Application_Vendor_OftnL10nJson:()=>J9,Application_Vendor_OipfContentaccessdownloadXml:()=>Z9,Application_Vendor_OipfContentaccessstreamingXml:()=>e8,Application_Vendor_OipfCspg_Hexbinary:()=>t8,Application_Vendor_OipfDaeSvgXml:()=>n8,Application_Vendor_OipfDaeXhtmlXml:()=>i8,Application_Vendor_OipfMippvcontrolmessageXml:()=>r8,Application_Vendor_OipfPaeGem:()=>o8,Application_Vendor_OipfSpdiscoveryXml:()=>s8,Application_Vendor_OipfSpdlistXml:()=>a8,Application_Vendor_OipfUeprofileXml:()=>l8,Application_Vendor_OipfUserprofileXml:()=>c8,Application_Vendor_Olpc_Sugar:()=>u8,Application_Vendor_OmaBcastAssociated_Procedure_ParameterXml:()=>m8,Application_Vendor_OmaBcastDrm_TriggerXml:()=>f8,Application_Vendor_OmaBcastImdXml:()=>g8,Application_Vendor_OmaBcastLtkm:()=>x8,Application_Vendor_OmaBcastNotificationXml:()=>w8,Application_Vendor_OmaBcastProvisioningtrigger:()=>F8,Application_Vendor_OmaBcastSgboot:()=>A8,Application_Vendor_OmaBcastSgddXml:()=>v8,Application_Vendor_OmaBcastSgdu:()=>b8,Application_Vendor_OmaBcastSimple_Symbol_Container:()=>S8,Application_Vendor_OmaBcastSmartcard_TriggerXml:()=>_8,Application_Vendor_OmaBcastSprovXml:()=>y8,Application_Vendor_OmaBcastStkm:()=>T8,Application_Vendor_OmaCab_Address_BookXml:()=>E8,Application_Vendor_OmaCab_Feature_HandlerXml:()=>k8,Application_Vendor_OmaCab_PccXml:()=>M8,Application_Vendor_OmaCab_Subs_InviteXml:()=>D8,Application_Vendor_OmaCab_User_PrefsXml:()=>C8,Application_Vendor_OmaDcd:()=>L8,Application_Vendor_OmaDcdc:()=>P8,Application_Vendor_OmaDd2Xml:()=>R8,Application_Vendor_OmaDrmRisdXml:()=>I8,Application_Vendor_OmaGroup_Usage_ListXml:()=>N8,Application_Vendor_OmaLwm2mJson:()=>H8,Application_Vendor_OmaLwm2mTlv:()=>U8,Application_Vendor_OmaPalXml:()=>z8,Application_Vendor_OmaPocDetailed_Progress_ReportXml:()=>j8,Application_Vendor_OmaPocFinal_ReportXml:()=>G8,Application_Vendor_OmaPocGroupsXml:()=>X8,Application_Vendor_OmaPocInvocation_DescriptorXml:()=>q8,Application_Vendor_OmaPocOptimized_Progress_ReportXml:()=>Y8,Application_Vendor_OmaPush:()=>K8,Application_Vendor_OmaScidmMessagesXml:()=>Q8,Application_Vendor_OmaXcap_DirectoryXml:()=>$8,Application_Vendor_Oma_Scws_Config:()=>p8,Application_Vendor_Oma_Scws_Http_Request:()=>d8,Application_Vendor_Oma_Scws_Http_Response:()=>h8,Application_Vendor_Omads_EmailXml:()=>B8,Application_Vendor_Omads_FileXml:()=>V8,Application_Vendor_Omads_FolderXml:()=>O8,Application_Vendor_Omaloc_Supl_Init:()=>W8,Application_Vendor_Onepager:()=>J8,Application_Vendor_Onepagertamp:()=>Z8,Application_Vendor_Onepagertamx:()=>eW,Application_Vendor_Onepagertat:()=>tW,Application_Vendor_Onepagertatp:()=>nW,Application_Vendor_Onepagertatx:()=>iW,Application_Vendor_OpenbloxGameXml:()=>oW,Application_Vendor_OpenbloxGame_Binary:()=>rW,Application_Vendor_OpeneyeOeb:()=>sW,Application_Vendor_OpenofficeorgExtension:()=>aW,Application_Vendor_OpenstreetmapDataXml:()=>lW,Application_Vendor_Openxmlformats_OfficedocumentCustomXmlPropertiesXml:()=>uW,Application_Vendor_Openxmlformats_OfficedocumentCustom_PropertiesXml:()=>cW,Application_Vendor_Openxmlformats_OfficedocumentDrawingXml:()=>xW,Application_Vendor_Openxmlformats_OfficedocumentDrawingmlChartXml:()=>dW,Application_Vendor_Openxmlformats_OfficedocumentDrawingmlChartshapesXml:()=>pW,Application_Vendor_Openxmlformats_OfficedocumentDrawingmlDiagramColorsXml:()=>hW,Application_Vendor_Openxmlformats_OfficedocumentDrawingmlDiagramDataXml:()=>mW,Application_Vendor_Openxmlformats_OfficedocumentDrawingmlDiagramLayoutXml:()=>fW,Application_Vendor_Openxmlformats_OfficedocumentDrawingmlDiagramStyleXml:()=>gW,Application_Vendor_Openxmlformats_OfficedocumentExtended_PropertiesXml:()=>wW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlCommentAuthorsXml:()=>FW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlCommentsXml:()=>AW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlHandoutMasterXml:()=>vW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlNotesMasterXml:()=>bW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlNotesSlideXml:()=>SW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlPresPropsXml:()=>TW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlPresentation:()=>_W,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlPresentationMainXml:()=>yW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlSlide:()=>EW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlSlideLayoutXml:()=>kW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlSlideMasterXml:()=>MW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlSlideUpdateInfoXml:()=>LW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlSlideXml:()=>PW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlSlideshow:()=>DW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlSlideshowMainXml:()=>CW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlTableStylesXml:()=>RW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlTagsXml:()=>IW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlTemplate:()=>BW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlTemplateMainXml:()=>VW,Application_Vendor_Openxmlformats_OfficedocumentPresentationmlViewPropsXml:()=>OW,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlCalcChainXml:()=>NW,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlChartsheetXml:()=>WW,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlCommentsXml:()=>HW,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlConnectionsXml:()=>UW,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlDialogsheetXml:()=>zW,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlExternalLinkXml:()=>jW,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlPivotCacheDefinitionXml:()=>GW,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlPivotCacheRecordsXml:()=>XW,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlPivotTableXml:()=>qW,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlQueryTableXml:()=>YW,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlRevisionHeadersXml:()=>KW,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlRevisionLogXml:()=>QW,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlSharedStringsXml:()=>$W,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlSheet:()=>JW,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlSheetMainXml:()=>ZW,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlSheetMetadataXml:()=>e7,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlStylesXml:()=>t7,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlTableSingleCellsXml:()=>n7,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlTableXml:()=>i7,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlTemplate:()=>r7,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlTemplateMainXml:()=>o7,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlUserNamesXml:()=>s7,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlVolatileDependenciesXml:()=>a7,Application_Vendor_Openxmlformats_OfficedocumentSpreadsheetmlWorksheetXml:()=>l7,Application_Vendor_Openxmlformats_OfficedocumentThemeOverrideXml:()=>c7,Application_Vendor_Openxmlformats_OfficedocumentThemeXml:()=>u7,Application_Vendor_Openxmlformats_OfficedocumentVmlDrawing:()=>p7,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlCommentsXml:()=>d7,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlDocument:()=>h7,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlDocumentGlossaryXml:()=>m7,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlDocumentMainXml:()=>f7,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlEndnotesXml:()=>g7,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlFontTableXml:()=>x7,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlFooterXml:()=>w7,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlFootnotesXml:()=>F7,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlNumberingXml:()=>A7,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlSettingsXml:()=>v7,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlStylesXml:()=>b7,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlTemplate:()=>S7,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlTemplateMainXml:()=>_7,Application_Vendor_Openxmlformats_OfficedocumentWordprocessingmlWebSettingsXml:()=>y7,Application_Vendor_Openxmlformats_PackageCore_PropertiesXml:()=>T7,Application_Vendor_Openxmlformats_PackageDigital_Signature_XmlsignatureXml:()=>E7,Application_Vendor_Openxmlformats_PackageRelationshipsXml:()=>k7,Application_Vendor_OracleResourceJson:()=>M7,Application_Vendor_OrangeIndata:()=>D7,Application_Vendor_OsaNetdeploy:()=>C7,Application_Vendor_OsgeoMapguidePackage:()=>L7,Application_Vendor_OsgiBundle:()=>P7,Application_Vendor_OsgiDp:()=>R7,Application_Vendor_OsgiSubsystem:()=>I7,Application_Vendor_OtpsCt_KipXml:()=>B7,Application_Vendor_OxliCountgraph:()=>V7,Application_Vendor_PagerdutyJson:()=>O7,Application_Vendor_Palm:()=>N7,Application_Vendor_Panoply:()=>W7,Application_Vendor_PaosXml:()=>H7,Application_Vendor_Patentdive:()=>U7,Application_Vendor_Patientecommsdoc:()=>z7,Application_Vendor_Pawaafile:()=>j7,Application_Vendor_Pcos:()=>G7,Application_Vendor_PgFormat:()=>X7,Application_Vendor_PgOsasli:()=>q7,Application_Vendor_PiaccessApplication_Licence:()=>Y7,Application_Vendor_Picsel:()=>K7,Application_Vendor_PmiWidget:()=>Q7,Application_Vendor_PocGroup_AdvertisementXml:()=>$7,Application_Vendor_Pocketlearn:()=>J7,Application_Vendor_Powerbuilder6:()=>Z7,Application_Vendor_Powerbuilder6_S:()=>eH,Application_Vendor_Powerbuilder7:()=>tH,Application_Vendor_Powerbuilder75:()=>iH,Application_Vendor_Powerbuilder75_S:()=>rH,Application_Vendor_Powerbuilder7_S:()=>nH,Application_Vendor_Preminet:()=>oH,Application_Vendor_PreviewsystemsBox:()=>sH,Application_Vendor_ProteusMagazine:()=>aH,Application_Vendor_Psfs:()=>lH,Application_Vendor_Publishare_Delta_Tree:()=>cH,Application_Vendor_PviPtid1:()=>uH,Application_Vendor_Pwg_Multiplexed:()=>pH,Application_Vendor_Pwg_Xhtml_PrintXml:()=>dH,Application_Vendor_QualcommBrew_App_Res:()=>hH,Application_Vendor_Quarantainenet:()=>mH,Application_Vendor_QuarkQuarkXPress:()=>fH,Application_Vendor_Quobject_Quoxdocument:()=>gH,Application_Vendor_RadisysMomlXml:()=>xH,Application_Vendor_RadisysMsmlXml:()=>CH,Application_Vendor_RadisysMsml_AuditXml:()=>bH,Application_Vendor_RadisysMsml_Audit_ConfXml:()=>wH,Application_Vendor_RadisysMsml_Audit_ConnXml:()=>FH,Application_Vendor_RadisysMsml_Audit_DialogXml:()=>AH,Application_Vendor_RadisysMsml_Audit_StreamXml:()=>vH,Application_Vendor_RadisysMsml_ConfXml:()=>SH,Application_Vendor_RadisysMsml_DialogXml:()=>DH,Application_Vendor_RadisysMsml_Dialog_BaseXml:()=>_H,Application_Vendor_RadisysMsml_Dialog_Fax_DetectXml:()=>yH,Application_Vendor_RadisysMsml_Dialog_Fax_SendrecvXml:()=>TH,Application_Vendor_RadisysMsml_Dialog_GroupXml:()=>EH,Application_Vendor_RadisysMsml_Dialog_SpeechXml:()=>kH,Application_Vendor_RadisysMsml_Dialog_TransformXml:()=>MH,Application_Vendor_RainstorData:()=>LH,Application_Vendor_Rapid:()=>PH,Application_Vendor_Rar:()=>RH,Application_Vendor_RealvncBed:()=>IH,Application_Vendor_RecordareMusicxml:()=>BH,Application_Vendor_RecordareMusicxmlXml:()=>VH,Application_Vendor_RenLearnRlprint:()=>OH,Application_Vendor_RestfulJson:()=>NH,Application_Vendor_RigCryptonote:()=>WH,Application_Vendor_RimCod:()=>HH,Application_Vendor_Rn_Realmedia:()=>UH,Application_Vendor_Rn_Realmedia_Vbr:()=>zH,Application_Vendor_Route66Link66Xml:()=>jH,Application_Vendor_Rs_274x:()=>GH,Application_Vendor_RuckusDownload:()=>XH,Application_Vendor_S3sms:()=>qH,Application_Vendor_SailingtrackerTrack:()=>YH,Application_Vendor_Sar:()=>KH,Application_Vendor_SbmCid:()=>QH,Application_Vendor_SbmMid2:()=>$H,Application_Vendor_Scribus:()=>JH,Application_Vendor_Sealed3df:()=>ZH,Application_Vendor_SealedCsf:()=>eU,Application_Vendor_SealedDoc:()=>tU,Application_Vendor_SealedEml:()=>nU,Application_Vendor_SealedMht:()=>oU,Application_Vendor_SealedNet:()=>sU,Application_Vendor_SealedPpt:()=>aU,Application_Vendor_SealedTiff:()=>lU,Application_Vendor_SealedXls:()=>cU,Application_Vendor_SealedmediaSoftsealHtml:()=>iU,Application_Vendor_SealedmediaSoftsealPdf:()=>rU,Application_Vendor_Seemail:()=>uU,Application_Vendor_Sema:()=>pU,Application_Vendor_Semd:()=>dU,Application_Vendor_Semf:()=>hU,Application_Vendor_Shade_Save_File:()=>mU,Application_Vendor_ShanaInformedFormdata:()=>fU,Application_Vendor_ShanaInformedFormtemplate:()=>gU,Application_Vendor_ShanaInformedInterchange:()=>xU,Application_Vendor_ShanaInformedPackage:()=>wU,Application_Vendor_ShootproofJson:()=>FU,Application_Vendor_ShopkickJson:()=>AU,Application_Vendor_SigrokSession:()=>vU,Application_Vendor_SimTech_MindMapper:()=>bU,Application_Vendor_SirenJson:()=>SU,Application_Vendor_Smaf:()=>_U,Application_Vendor_SmartNotebook:()=>yU,Application_Vendor_SmartTeacher:()=>TU,Application_Vendor_Software602FillerFormXml:()=>kU,Application_Vendor_Software602FillerForm_Xml_Zip:()=>EU,Application_Vendor_SolentSdkmXml:()=>MU,Application_Vendor_SpotfireDxp:()=>DU,Application_Vendor_SpotfireSfs:()=>CU,Application_Vendor_Sqlite3:()=>LU,Application_Vendor_Sss_Cod:()=>PU,Application_Vendor_Sss_Dtf:()=>RU,Application_Vendor_Sss_Ntf:()=>IU,Application_Vendor_StardivisionCalc:()=>BU,Application_Vendor_StardivisionDraw:()=>VU,Application_Vendor_StardivisionImpress:()=>OU,Application_Vendor_StardivisionMath:()=>NU,Application_Vendor_StardivisionWriter:()=>WU,Application_Vendor_StardivisionWriter_Global:()=>HU,Application_Vendor_StepmaniaPackage:()=>UU,Application_Vendor_StepmaniaStepchart:()=>zU,Application_Vendor_Street_Stream:()=>jU,Application_Vendor_SunWadlXml:()=>GU,Application_Vendor_SunXmlCalc:()=>XU,Application_Vendor_SunXmlCalcTemplate:()=>qU,Application_Vendor_SunXmlDraw:()=>YU,Application_Vendor_SunXmlDrawTemplate:()=>KU,Application_Vendor_SunXmlImpress:()=>QU,Application_Vendor_SunXmlImpressTemplate:()=>$U,Application_Vendor_SunXmlMath:()=>JU,Application_Vendor_SunXmlWriter:()=>ZU,Application_Vendor_SunXmlWriterGlobal:()=>ez,Application_Vendor_SunXmlWriterTemplate:()=>tz,Application_Vendor_Sus_Calendar:()=>nz,Application_Vendor_Svd:()=>iz,Application_Vendor_Swiftview_Ics:()=>rz,Application_Vendor_SymbianInstall:()=>oz,Application_Vendor_SyncmlDmNotification:()=>lz,Application_Vendor_SyncmlDmWbxml:()=>pz,Application_Vendor_SyncmlDmXml:()=>dz,Application_Vendor_SyncmlDmddfWbxml:()=>sz,Application_Vendor_SyncmlDmddfXml:()=>az,Application_Vendor_SyncmlDmtndsWbxml:()=>cz,Application_Vendor_SyncmlDmtndsXml:()=>uz,Application_Vendor_SyncmlDsNotification:()=>hz,Application_Vendor_SyncmlXml:()=>mz,Application_Vendor_TableschemaJson:()=>fz,Application_Vendor_TaoIntent_Module_Archive:()=>gz,Application_Vendor_TcpdumpPcap:()=>xz,Application_Vendor_Think_CellPpttcJson:()=>wz,Application_Vendor_TmdMediaflexApiXml:()=>Fz,Application_Vendor_Tml:()=>Az,Application_Vendor_Tmobile_Livetv:()=>vz,Application_Vendor_TriOnesource:()=>Sz,Application_Vendor_TridTpt:()=>bz,Application_Vendor_TriscapeMxs:()=>_z,Application_Vendor_Trueapp:()=>yz,Application_Vendor_Truedoc:()=>Tz,Application_Vendor_UbisoftWebplayer:()=>Ez,Application_Vendor_Ufdl:()=>kz,Application_Vendor_UiqTheme:()=>Mz,Application_Vendor_Umajin:()=>Dz,Application_Vendor_Unity:()=>Cz,Application_Vendor_UomlXml:()=>Lz,Application_Vendor_UplanetAlert:()=>Pz,Application_Vendor_UplanetAlert_Wbxml:()=>Rz,Application_Vendor_UplanetBearer_Choice:()=>Iz,Application_Vendor_UplanetBearer_Choice_Wbxml:()=>Bz,Application_Vendor_UplanetCacheop:()=>Vz,Application_Vendor_UplanetCacheop_Wbxml:()=>Oz,Application_Vendor_UplanetChannel:()=>Nz,Application_Vendor_UplanetChannel_Wbxml:()=>Wz,Application_Vendor_UplanetList:()=>Hz,Application_Vendor_UplanetList_Wbxml:()=>Uz,Application_Vendor_UplanetListcmd:()=>zz,Application_Vendor_UplanetListcmd_Wbxml:()=>jz,Application_Vendor_UplanetSignal:()=>Gz,Application_Vendor_Uri_Map:()=>Xz,Application_Vendor_ValveSourceMaterial:()=>qz,Application_Vendor_Vcx:()=>Yz,Application_Vendor_Vd_Study:()=>Kz,Application_Vendor_Vectorworks:()=>Qz,Application_Vendor_VelJson:()=>$z,Application_Vendor_VerimatrixVcas:()=>Jz,Application_Vendor_VeryantThin:()=>Zz,Application_Vendor_VesEncrypted:()=>ej,Application_Vendor_VidsoftVidconference:()=>tj,Application_Vendor_Visio:()=>nj,Application_Vendor_Visionary:()=>ij,Application_Vendor_VividenceScriptfile:()=>rj,Application_Vendor_Vsf:()=>oj,Application_Vendor_WapSic:()=>sj,Application_Vendor_WapSlc:()=>aj,Application_Vendor_WapWbxml:()=>lj,Application_Vendor_WapWmlc:()=>cj,Application_Vendor_WapWmlscriptc:()=>uj,Application_Vendor_Webturbo:()=>pj,Application_Vendor_WfaP2p:()=>dj,Application_Vendor_WfaWsc:()=>hj,Application_Vendor_WindowsDevicepairing:()=>mj,Application_Vendor_Wmc:()=>fj,Application_Vendor_WmfBootstrap:()=>gj,Application_Vendor_WolframMathematica:()=>xj,Application_Vendor_WolframMathematicaPackage:()=>wj,Application_Vendor_WolframPlayer:()=>Fj,Application_Vendor_Wordperfect:()=>Aj,Application_Vendor_Wqd:()=>vj,Application_Vendor_Wrq_Hp3000_Labelled:()=>bj,Application_Vendor_WtStf:()=>Sj,Application_Vendor_WvCspWbxml:()=>_j,Application_Vendor_WvCspXml:()=>yj,Application_Vendor_WvSspXml:()=>Tj,Application_Vendor_XacmlJson:()=>Ej,Application_Vendor_Xara:()=>kj,Application_Vendor_Xfdl:()=>Mj,Application_Vendor_XfdlWebform:()=>Dj,Application_Vendor_XmiXml:()=>Cj,Application_Vendor_XmpieCpkg:()=>Lj,Application_Vendor_XmpieDpkg:()=>Pj,Application_Vendor_XmpiePlan:()=>Rj,Application_Vendor_XmpiePpkg:()=>Ij,Application_Vendor_XmpieXlim:()=>Bj,Application_Vendor_YamahaHv_Dic:()=>Vj,Application_Vendor_YamahaHv_Script:()=>Oj,Application_Vendor_YamahaHv_Voice:()=>Nj,Application_Vendor_YamahaOpenscoreformat:()=>Wj,Application_Vendor_YamahaOpenscoreformatOsfpvgXml:()=>Hj,Application_Vendor_YamahaRemote_Setup:()=>Uj,Application_Vendor_YamahaSmaf_Audio:()=>zj,Application_Vendor_YamahaSmaf_Phrase:()=>jj,Application_Vendor_YamahaThrough_Ngn:()=>Gj,Application_Vendor_YamahaTunnel_Udpencap:()=>Xj,Application_Vendor_Yaoweme:()=>qj,Application_Vendor_Yellowriver_Custom_Menu:()=>Yj,Application_Vendor_YoutubeYt:()=>Kj,Application_Vendor_Zul:()=>Qj,Application_Vendor_ZzazzDeckXml:()=>$j,Application_VividenceScriptfile:()=>Jj,Application_VoicexmlXml:()=>Zj,Application_Voucher_CmsJson:()=>eG,Application_Vq_Rtcpxr:()=>tG,Application_Wasm:()=>_p,Application_WatcherinfoXml:()=>nG,Application_Webpush_OptionsJson:()=>iG,Application_Whoispp_Query:()=>rG,Application_Whoispp_Response:()=>oG,Application_Widget:()=>sG,Application_Winhlp:()=>aG,Application_Wita:()=>lG,Application_Wordperfect51:()=>cG,Application_WsdlXml:()=>uG,Application_WspolicyXml:()=>pG,Application_X400_Bp:()=>Nq,Application_X_7z_Compressed:()=>dG,Application_X_Abiword:()=>hG,Application_X_Ace_Compressed:()=>mG,Application_X_Amf:()=>fG,Application_X_Apple_Diskimage:()=>gG,Application_X_Arj:()=>xG,Application_X_Authorware_Bin:()=>wG,Application_X_Authorware_Map:()=>FG,Application_X_Authorware_Seg:()=>AG,Application_X_Bcpio:()=>vG,Application_X_Bdoc:()=>bG,Application_X_Bittorrent:()=>SG,Application_X_Blorb:()=>_G,Application_X_Bzip:()=>yG,Application_X_Bzip2:()=>TG,Application_X_Cbr:()=>EG,Application_X_Cdlink:()=>kG,Application_X_Cfs_Compressed:()=>MG,Application_X_Chat:()=>DG,Application_X_Chess_Pgn:()=>CG,Application_X_Chrome_Extension:()=>LG,Application_X_Compress:()=>RG,Application_X_Conference:()=>IG,Application_X_Cpio:()=>BG,Application_X_Csh:()=>VG,Application_X_Deb:()=>PG,Application_X_Debian_Package:()=>OG,Application_X_Dgc_Compressed:()=>NG,Application_X_Director:()=>WG,Application_X_Doom:()=>HG,Application_X_DtbncxXml:()=>UG,Application_X_DtbookXml:()=>zG,Application_X_DtbresourceXml:()=>jG,Application_X_Dvi:()=>GG,Application_X_Envoy:()=>XG,Application_X_Eva:()=>qG,Application_X_Font_Bdf:()=>YG,Application_X_Font_Dos:()=>KG,Application_X_Font_Framemaker:()=>QG,Application_X_Font_Ghostscript:()=>$G,Application_X_Font_Libgrx:()=>JG,Application_X_Font_Linux_Psf:()=>ZG,Application_X_Font_Pcf:()=>eX,Application_X_Font_Snf:()=>tX,Application_X_Font_Speedo:()=>nX,Application_X_Font_Sunos_News:()=>iX,Application_X_Font_Type1:()=>rX,Application_X_Font_Vfont:()=>oX,Application_X_Freearc:()=>sX,Application_X_Futuresplash:()=>aX,Application_X_Gca_Compressed:()=>lX,Application_X_Glulx:()=>cX,Application_X_Gnumeric:()=>uX,Application_X_Gramps_Xml:()=>pX,Application_X_Gtar:()=>dX,Application_X_Gzip:()=>hX,Application_X_Hdf:()=>mX,Application_X_Httpd_Php:()=>fX,Application_X_Install_Instructions:()=>gX,Application_X_Iso9660_Image:()=>xX,Application_X_Iwork_Keynote_Sffkey:()=>wX,Application_X_Iwork_Numbers_Sffnumbers:()=>FX,Application_X_Iwork_Pages_Sffpages:()=>AX,Application_X_Java_Jnlp_File:()=>vX,Application_X_Javascript:()=>bX,Application_X_Keepass2:()=>SX,Application_X_Latex:()=>_X,Application_X_Lua_Bytecode:()=>yX,Application_X_Lzh_Compressed:()=>TX,Application_X_Mie:()=>EX,Application_X_Mobipocket_Ebook:()=>kX,Application_X_Mpegurl:()=>MX,Application_X_Ms_Application:()=>DX,Application_X_Ms_Shortcut:()=>CX,Application_X_Ms_Wmd:()=>LX,Application_X_Ms_Wmz:()=>PX,Application_X_Ms_Xbap:()=>RX,Application_X_Msaccess:()=>BX,Application_X_Msbinder:()=>VX,Application_X_Mscardfile:()=>OX,Application_X_Msclip:()=>NX,Application_X_Msdos_Program:()=>IX,Application_X_Msdownload:()=>WX,Application_X_Msmediaview:()=>HX,Application_X_Msmetafile:()=>UX,Application_X_Msmoney:()=>zX,Application_X_Mspublisher:()=>jX,Application_X_Msschedule:()=>GX,Application_X_Msterminal:()=>XX,Application_X_Mswrite:()=>qX,Application_X_Netcdf:()=>YX,Application_X_Ns_Proxy_Autoconfig:()=>KX,Application_X_Nzb:()=>QX,Application_X_Pkcs12:()=>$X,Application_X_Pkcs7_Certificates:()=>JX,Application_X_Pkcs7_Certreqresp:()=>ZX,Application_X_Rar_Compressed:()=>eq,Application_X_Research_Info_Systems:()=>tq,Application_X_Sh:()=>nq,Application_X_Shar:()=>iq,Application_X_Shockwave_Flash:()=>rq,Application_X_Silverlight_App:()=>oq,Application_X_Sql:()=>sq,Application_X_Stuffit:()=>aq,Application_X_Stuffitx:()=>lq,Application_X_Subrip:()=>cq,Application_X_Sv4cpio:()=>uq,Application_X_Sv4crc:()=>pq,Application_X_T3vm_Image:()=>dq,Application_X_Tads:()=>hq,Application_X_Tar:()=>mq,Application_X_Tcl:()=>fq,Application_X_Tex:()=>gq,Application_X_Tex_Tfm:()=>xq,Application_X_Texinfo:()=>wq,Application_X_Tgif:()=>Fq,Application_X_Url:()=>Ec,Application_X_Ustar:()=>Aq,Application_X_Virtualbox_Hdd:()=>vq,Application_X_Virtualbox_Ova:()=>bq,Application_X_Virtualbox_Ovf:()=>Sq,Application_X_Virtualbox_Vbox:()=>_q,Application_X_Virtualbox_Vbox_Extpack:()=>yq,Application_X_Virtualbox_Vdi:()=>Tq,Application_X_Virtualbox_Vhd:()=>Eq,Application_X_Virtualbox_Vmdk:()=>kq,Application_X_Wais_Source:()=>Mq,Application_X_Web_App_ManifestJson:()=>Dq,Application_X_Www_Form_Urlencoded:()=>Cq,Application_X_X509_Ca_Cert:()=>Lq,Application_X_Xfig:()=>Pq,Application_X_XliffXml:()=>Rq,Application_X_Xpinstall:()=>Iq,Application_X_Xz:()=>Bq,Application_X_Zip_Compressed:()=>Vq,Application_X_Zmachine:()=>Oq,Application_XacmlXml:()=>Wq,Application_XamlXml:()=>Hq,Application_Xcap_AttXml:()=>Uq,Application_Xcap_CapsXml:()=>zq,Application_Xcap_DiffXml:()=>jq,Application_Xcap_ElXml:()=>Gq,Application_Xcap_ErrorXml:()=>Xq,Application_Xcap_NsXml:()=>qq,Application_Xcon_Conference_InfoXml:()=>Kq,Application_Xcon_Conference_Info_DiffXml:()=>Yq,Application_XencXml:()=>Qq,Application_XhtmlXml:()=>Jq,Application_Xhtml_VoiceXml:()=>$q,Application_XliffXml:()=>Zq,Application_Xml:()=>eY,Application_Xml_Dtd:()=>tY,Application_Xml_External_Parsed_Entity:()=>nY,Application_Xml_PatchXml:()=>iY,Application_XmppXml:()=>rY,Application_XopXml:()=>oY,Application_XprocXml:()=>sY,Application_XsltXml:()=>aY,Application_XspfXml:()=>lY,Application_XvXml:()=>cY,Application_Yang:()=>uY,Application_Yang_DataJson:()=>pY,Application_Yang_DataXml:()=>dY,Application_Yang_PatchJson:()=>hY,Application_Yang_PatchXml:()=>mY,Application_YinXml:()=>fY,Application_Zip:()=>gY,Application_Zlib:()=>xY,Application_Zstd:()=>wY});var oF=/([^\/]+)\/(.+)/,JT=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/;function bs(n){return n.flatMap(e=>e.extensions.map(t=>"."+t)).sort().join(", ")}var Eo=class n{constructor(e,t,i){this._type=e,this._fullSubType=t,this._primaryExtension=null,this.depMessage=null;let r=new Map;this._parameters=r;let o=this._fullSubType.match(JT);this._tree=o[1],this._subType=o[2],this._suffix=o[3];let s=o[4];if(this._value=this._fullValue=this._type+"/",y(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,y(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),y(s)){let l=s.split(";").map(c=>c.trim()).filter(c=>c.length>0).map(c=>c.split("="));for(let[c,...u]of l){let p=u.join("=");r.set(c,p);let d=`; ${c}=${p}`;this._fullValue+=d,c!=="q"&&(this._value+=d)}}this._extensions=i||[],this._primaryExtension=this._extensions[0]||null}static parse(e){if(!e)return null;let t=e.match(oF);if(!t)return null;let i=t[1],r=t[2];return new n(i,r)}deprecate(e){return this.depMessage=e,this}check(){y(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(e){if(oe(e))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let t=null,i=null;if(Ve(e)){let r=e.match(oF);if(!r)return!1;t=r[1],i=r[2]}else t=e.typeName,i=e._fullSubType;return this.typeName===t&&(this._fullSubType==="*"||this._fullSubType===i)}withParameter(e,t){let i=`${this._fullSubType}; ${e}=${t}`;return new n(this.typeName,i,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}toFileSystemAPIAccepts(){return{[this.value]:this.extensions.map(e=>"."+e)}}addExtension(e){if(!e)throw new Error("File name is not defined");return this.primaryExtension&&(e=n.removeExtension(e),e=`${e}.${this.primaryExtension}`),e}static removeExtension(e){let t=e.lastIndexOf(".");return t>-1&&(e=e.substring(0,t)),e}};function Sa(n,e,...t){return new Eo(n,e,t)}function Wt(n){return Sa.bind(null,n)}var a=Wt("application"),ZT=a("a2l"),e2=a("activemessage"),t2=a("activity+json","json"),n2=a("alto-costmapfilter+json","json"),i2=a("alto-costmap+json","json"),r2=a("alto-directory+json","json"),o2=a("alto-endpointcost+json","json"),s2=a("alto-endpointcostparams+json","json"),a2=a("alto-endpointprop+json","json"),l2=a("alto-endpointpropparams+json","json"),c2=a("alto-error+json","json"),u2=a("alto-networkmapfilter+json","json"),p2=a("alto-networkmap+json","json"),d2=a("aml"),h2=a("andrew-inset","ez"),m2=a("applefile"),f2=a("applixware","aw"),g2=a("atf"),x2=a("atfx"),w2=a("atomcat+xml","atomcat"),F2=a("atomdeleted+xml","xml"),A2=a("atomicmail"),v2=a("atomsvc+xml","atomsvc"),b2=a("atom+xml","atom"),S2=a("atsc-dwd+xml","xml"),_2=a("atsc-held+xml","xml"),y2=a("atsc-rdt+json","json"),T2=a("atsc-rsat+xml","xml"),E2=a("atxml"),k2=a("auth-policy+xml","xml"),M2=a("bacnet-xdd+zip","zip"),D2=a("batch-smtp"),C2=a("bdoc","bdoc"),L2=a("beep+xml","xml"),P2=a("calendar+json","json"),R2=a("calendar+xml","xml"),I2=a("call-completion"),B2=a("cals-1840"),V2=a("cbor"),O2=a("cbor-seq"),N2=a("cccex"),W2=a("ccmp+xml","xml"),H2=a("ccxml+xml","ccxml"),U2=a("cdfx+xml","xml"),z2=a("cdmi-capability","cdmia"),j2=a("cdmi-container","cdmic"),G2=a("cdmi-domain","cdmid"),X2=a("cdmi-object","cdmio"),q2=a("cdmi-queue","cdmiq"),Y2=a("cdni"),K2=a("cea"),Q2=a("cea-2018+xml","xml"),$2=a("cellml+xml","xml"),J2=a("cfw"),Z2=a("clue_info+xml","xml"),eE=a("clue+xml","xml"),tE=a("cms"),nE=a("cnrp+xml","xml"),iE=a("coap-group+json","json"),rE=a("coap-payload"),oE=a("commonground"),sE=a("conference-info+xml","xml"),aE=a("cose"),lE=a("cose-key"),cE=a("cose-key-set"),uE=a("cpl+xml","xml"),pE=a("csrattrs"),dE=a("cstadata+xml","xml"),hE=a("csta+xml","xml"),mE=a("csvm+json","json"),fE=a("cu-seeme","cu"),gE=a("cwt"),xE=a("cybercash"),wE=a("dart"),FE=a("dashdelta"),AE=a("dash+xml","xml"),vE=a("davmount+xml","davmount"),bE=a("dca-rft"),SE=a("dcd"),_E=a("dec-dx"),yE=a("dialog-info+xml","xml"),TE=a("dicom"),EE=a("dicom+json","json"),kE=a("dicom+xml","xml"),ME=a("dii"),DE=a("dit"),CE=a("dns"),LE=a("dns-message"),PE=a("dns+json","json"),RE=a("docbook+xml","dbk"),IE=a("dots+cbor","cbor"),BE=a("dskpp+xml","xml"),VE=a("dssc+der","dssc"),OE=a("dssc+xml","xdssc"),NE=a("dvcs"),WE=a("ecmascript","ecma"),HE=a("edi-consent"),UE=a("edi-x12"),zE=a("edifact"),jE=a("efi"),GE=a("emergencycalldata.comment+xml","xml"),XE=a("emergencycalldata.control+xml","xml"),qE=a("emergencycalldata.deviceinfo+xml","xml"),YE=a("emergencycalldata.ecall.msd"),KE=a("emergencycalldata.providerinfo+xml","xml"),QE=a("emergencycalldata.serviceinfo+xml","xml"),$E=a("emergencycalldata.subscriberinfo+xml","xml"),JE=a("emergencycalldata.veds+xml","xml"),ZE=a("emma+xml","emma"),ek=a("emotionml+xml","xml"),tk=a("encaprtp"),nk=a("epp+xml","xml"),ik=a("epub+zip","epub"),rk=a("eshop"),ok=a("example"),sk=a("exi","exi"),ak=a("expect-ct-report+json","json"),lk=a("fastinfoset"),ck=a("fastsoap"),uk=a("fdt+xml","xml"),pk=a("fhir+json","json"),dk=a("fhir+xml","xml"),hk=a("fido.trusted-apps+json"),mk=a("fits"),fk=a("flexfec"),gk=a("font-sfnt").deprecate("in favor of font/sfnt"),xk=a("font-tdpfr","pfr"),wk=a("font-woff").deprecate("in favor of font/woff"),Fk=a("framework-attributes+xml","xml"),Ak=a("geo+json","json","geojson"),vk=a("geo+json-seq","json-seq"),bk=a("geopackage+sqlite3","sqlite3"),Sk=a("geoxacml+xml","xml"),_k=a("gltf-buffer"),yk=a("gml+xml","gml"),Tk=a("gpx+xml","gpx"),Ek=a("gxf","gxf"),kk=a("gzip"),Mk=a("h224"),Dk=a("held+xml","xml"),Ck=a("hjson","hjson"),Lk=a("http"),Pk=a("hyperstudio","stk"),Rk=a("ibe-key-request+xml","xml"),Ik=a("ibe-pkg-reply+xml","xml"),Bk=a("ibe-pp-data"),Vk=a("iges"),Ok=a("im-iscomposing+xml","xml"),Nk=a("index"),Wk=a("index.cmd"),Hk=a("index.obj"),Uk=a("index.response"),zk=a("index.vnd"),jk=a("inkml+xml","ink","inkml"),Gk=a("iotp"),Xk=a("ipfix","ipfix"),qk=a("ipp"),Yk=a("isup"),Kk=a("its+xml","xml"),Qk=a("java-archive","jar"),$k=a("java-serialized-object","ser"),Jk=a("java-vm","class"),sr=a("javascript","js"),Zk=a("jf2feed+json","json"),eM=a("jose"),tM=a("jose+json","json"),nM=a("jrd+json","json"),_a=a("json","json"),iM=a("json5","json5"),Jr=a("json; charset=UTF-8","json"),rM=a("json-patch+json","json"),oM=a("json-seq"),sM=a("jsonml+json","jsonml"),aM=a("jwk-set+json","json"),lM=a("jwk+json","json"),cM=a("jwt"),uM=a("kpml-request+xml","xml"),pM=a("kpml-response+xml","xml"),dM=a("ld+json","json"),hM=a("lgr+xml","xml"),mM=a("link-format"),fM=a("load-control+xml","xml"),gM=a("lostsync+xml","xml"),xM=a("lost+xml","lostxml"),wM=a("lxf"),FM=a("mac-binhex40","hqx"),AM=a("mac-compactpro","cpt"),vM=a("macwriteii"),bM=a("mads+xml","mads"),SM=a("manifest+json","webmanifest"),_M=a("marc","mrc"),yM=a("marcxml+xml","mrcx"),TM=a("mathematica","ma","nb","mb"),EM=a("mathml-content+xml","xml"),kM=a("mathml-presentation+xml","xml"),MM=a("mathml+xml","mathml"),DM=a("mbms-associated-procedure-description+xml","xml"),CM=a("mbms-deregister+xml","xml"),LM=a("mbms-envelope+xml","xml"),PM=a("mbms-msk-response+xml","xml"),RM=a("mbms-msk+xml","xml"),IM=a("mbms-protection-description+xml","xml"),BM=a("mbms-reception-report+xml","xml"),VM=a("mbms-register-response+xml","xml"),OM=a("mbms-register+xml","xml"),NM=a("mbms-schedule+xml","xml"),WM=a("mbms-user-service-description+xml","xml"),HM=a("mbox","mbox"),UM=a("media_control+xml","xml"),zM=a("media-policy-dataset+xml","xml"),jM=a("mediaservercontrol+xml","mscml"),GM=a("merge-patch+json","json"),XM=a("metalink4+xml","meta4"),qM=a("metalink+xml","metalink"),YM=a("mets+xml","mets"),KM=a("mf4"),QM=a("mikey"),$M=a("mipc"),JM=a("mmt-aei+xml","xml"),ZM=a("mmt-usd+xml","xml"),eD=a("mods+xml","mods"),tD=a("moss-keys"),nD=a("moss-signature"),iD=a("mosskey-data"),rD=a("mosskey-request"),oD=a("mp21","m21","mp21"),sD=a("mp4","mp4s"),aD=a("mpeg4-generic"),lD=a("mpeg4-iod"),cD=a("mpeg4-iod-xmt"),uD=a("mrb-consumer+xml","xml"),pD=a("mrb-publish+xml","xml"),dD=a("msc-ivr+xml","xml"),hD=a("msc-mixer+xml","xml"),mD=a("msword","doc","dot"),fD=a("mud+json","json"),gD=a("multipart-core"),xD=a("mxf","mxf"),wD=a("n-quads"),FD=a("n-triples"),AD=a("nasdata"),vD=a("news-checkgroups"),bD=a("news-groupinfo"),SD=a("news-transmission"),_D=a("nlsml+xml","xml"),yD=a("node"),TD=a("nss"),ED=a("ocsp-request"),kD=a("ocsp-response"),MD=a("octet-stream","bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy"),DD=a("oda","oda"),CD=a("odm+xml","xml"),LD=a("odx"),PD=a("oebps-package+xml","opf"),RD=a("ogg","ogx"),ID=a("omdoc+xml","omdoc"),BD=a("onenote","onetoc","onetoc2","onetmp","onepkg"),VD=a("oscore"),OD=a("oxps","oxps"),ND=a("p2p-overlay+xml","xml"),WD=a("parityfec"),HD=a("passport"),UD=a("patch-ops-error+xml","xer"),Zr=a("pdf","pdf"),zD=a("pdx"),jD=a("pem-certificate-chain"),GD=a("pgp-encrypted","pgp"),XD=a("pgp-keys"),qD=a("pgp-signature","asc","sig"),YD=a("pics-rules","prf"),KD=a("pidf-diff+xml","xml"),QD=a("pidf+xml","xml"),$D=a("pkcs10","p10"),JD=a("pkcs12"),ZD=a("pkcs7-mime","p7m","p7c"),eC=a("pkcs7-signature","p7s"),tC=a("pkcs8","p8"),nC=a("pkcs8-encrypted"),iC=a("pkix-attr-cert","ac"),rC=a("pkix-cert","cer"),oC=a("pkix-crl","crl"),sC=a("pkix-pkipath","pkipath"),aC=a("pkixcmp","pki"),lC=a("pls+xml","pls"),cC=a("poc-settings+xml","xml"),uC=a("postscript","ai","eps","ps"),pC=a("ppsp-tracker+json","json"),dC=a("problem+json","json"),hC=a("problem+xml","xml"),mC=a("provenance+xml","xml"),fC=a("prs.alvestrand.titrax-sheet"),gC=a("prs.cww","cww"),xC=a("prs.hpub+zip","zip"),wC=a("prs.nprend"),FC=a("prs.plucker"),AC=a("prs.rdf-xml-crypt"),vC=a("prs.xsf+xml","xml"),bC=a("pskc+xml","pskcxml"),SC=a("qsig"),_C=a("raml+yaml","raml"),yC=a("raptorfec"),TC=a("rdap+json","json"),EC=a("rdf+xml","rdf"),kC=a("reginfo+xml","rif"),MC=a("relax-ng-compact-syntax","rnc"),DC=a("remote-printing"),CC=a("reputon+json","json"),LC=a("resource-lists-diff+xml","rld"),PC=a("resource-lists+xml","rl"),RC=a("rfc+xml","xml"),IC=a("riscos"),BC=a("rlmi+xml","xml"),VC=a("rls-services+xml","rs"),OC=a("route-apd+xml","xml"),NC=a("route-s-tsid+xml","xml"),WC=a("route-usd+xml","xml"),HC=a("rpki-ghostbusters","gbr"),UC=a("rpki-manifest","mft"),zC=a("rpki-publication"),jC=a("rpki-roa","roa"),GC=a("rpki-updown"),XC=a("rsd+xml","rsd"),qC=a("rss+xml","rss"),YC=a("rtf","rtf"),KC=a("rtploopback"),QC=a("rtx"),$C=a("samlassertion+xml","xml"),JC=a("samlmetadata+xml","xml"),ZC=a("sbml+xml","sbml"),e3=a("scaip+xml","xml"),t3=a("scim+json","json"),n3=a("scvp-cv-request","scq"),i3=a("scvp-cv-response","scs"),r3=a("scvp-vp-request","spq"),o3=a("scvp-vp-response","spp"),s3=a("sdp","sdp"),a3=a("secevent+jwt","jwt"),l3=a("senml-exi"),c3=a("senml+cbor","cbor"),u3=a("senml+json","json"),p3=a("senml+xml","xml"),d3=a("sensml-exi"),h3=a("sensml+cbor","cbor"),m3=a("sensml+json","json"),f3=a("sensml+xml","xml"),g3=a("sep-exi"),x3=a("sep+xml","xml"),w3=a("session-info"),F3=a("set-payment"),A3=a("set-payment-initiation","setpay"),v3=a("set-registration"),b3=a("set-registration-initiation","setreg"),S3=a("sgml"),_3=a("sgml-open-catalog"),y3=a("shf+xml","shf"),T3=a("sieve"),E3=a("simple-filter+xml","xml"),k3=a("simple-message-summary"),M3=a("simplesymbolcontainer"),D3=a("sipc"),C3=a("slate"),L3=a("smil").deprecate("in favor of application/smil+xml"),P3=a("smil+xml","smi","smil"),R3=a("smpte336m"),I3=a("soap+fastinfoset","fastinfoset"),B3=a("soap+xml","xml"),V3=a("sparql-query","rq"),O3=a("sparql-results+xml","srx"),N3=a("spirits-event+xml","xml"),W3=a("sql"),H3=a("srgs","gram"),U3=a("srgs+xml","grxml"),z3=a("sru+xml","sru"),j3=a("ssdl+xml","ssdl"),G3=a("ssml+xml","ssml"),X3=a("stix+json","json"),q3=a("swid+xml","xml"),Y3=a("tamp-apex-update"),K3=a("tamp-apex-update-confirm"),Q3=a("tamp-community-update"),$3=a("tamp-community-update-confirm"),J3=a("tamp-error"),Z3=a("tamp-sequence-adjust"),eL=a("tamp-sequence-adjust-confirm"),tL=a("tamp-status-query"),nL=a("tamp-status-response"),iL=a("tamp-update"),rL=a("tamp-update-confirm"),oL=a("tar"),sL=a("taxii+json","json"),aL=a("tei+xml","tei","teicorpus"),lL=a("tetra_isi"),cL=a("thraud+xml","tfi"),uL=a("timestamp-query"),pL=a("timestamp-reply"),dL=a("timestamped-data","tsd"),hL=a("tlsrpt+gzip","gzip"),mL=a("tlsrpt+json","json"),fL=a("tnauthlist"),gL=a("toml","toml"),xL=a("trickle-ice-sdpfrag"),wL=a("trig"),FL=a("ttml+xml","xml"),AL=a("tve-trigger"),vL=a("tzif"),bL=a("tzif-leap"),SL=a("ubjson","ubj"),_L=a("ulpfec"),yL=a("urc-grpsheet+xml","xml"),TL=a("urc-ressheet+xml","xml"),EL=a("urc-targetdesc+xml","xml"),kL=a("urc-uisocketdesc+xml","xml"),ML=a("vcard+json","json"),DL=a("vcard+xml","xml"),CL=a("vemmi"),LL=a("vnd.1000minds.decision-model+xml","xml"),PL=a("1d-interleaved-parityfec"),RL=a("3gpdash-qoe-report+xml","xml"),IL=a("3gpp-ims+xml","xml"),BL=a("vnd.3gpp-prose-pc3ch+xml","xml"),VL=a("vnd.3gpp-prose+xml","xml"),OL=a("vnd.3gpp-v2x-local-service-information"),NL=a("vnd.3gpp2.bcmcsinfo+xml","xml"),WL=a("vnd.3gpp2.sms"),HL=a("vnd.3gpp2.tcap","tcap"),UL=a("vnd.3gpp.access-transfer-events+xml","xml"),zL=a("vnd.3gpp.bsf+xml","xml"),jL=a("vnd.3gpp.gmop+xml","xml"),GL=a("vnd.3gpp.mc-signalling-ear"),XL=a("vnd.3gpp.mcdata-affiliation-command+xml","xml"),qL=a("vnd.3gpp.mcdata-info+xml","xml"),YL=a("vnd.3gpp.mcdata-payload"),KL=a("vnd.3gpp.mcdata-service-config+xml","xml"),QL=a("vnd.3gpp.mcdata-signalling"),$L=a("vnd.3gpp.mcdata-ue-config+xml","xml"),JL=a("vnd.3gpp.mcdata-user-profile+xml","xml"),ZL=a("vnd.3gpp.mcptt-affiliation-command+xml","xml"),eP=a("vnd.3gpp.mcptt-floor-request+xml","xml"),tP=a("vnd.3gpp.mcptt-info+xml","xml"),nP=a("vnd.3gpp.mcptt-location-info+xml","xml"),iP=a("vnd.3gpp.mcptt-mbms-usage-info+xml","xml"),rP=a("vnd.3gpp.mcptt-service-config+xml","xml"),oP=a("vnd.3gpp.mcptt-signed+xml","xml"),sP=a("vnd.3gpp.mcptt-ue-config+xml","xml"),aP=a("vnd.3gpp.mcptt-ue-init-config+xml","xml"),lP=a("vnd.3gpp.mcptt-user-profile+xml","xml"),cP=a("vnd.3gpp.mcvideo-affiliation-command+xml","xml"),uP=a("vnd.3gpp.mcvideo-affiliation-info+xml","xml").deprecate("in favor of application/vnd.3gpp.mcvideo-info+xml"),pP=a("vnd.3gpp.mcvideo-info+xml","xml"),dP=a("vnd.3gpp.mcvideo-location-info+xml","xml"),hP=a("vnd.3gpp.mcvideo-mbms-usage-info+xml","xml"),mP=a("vnd.3gpp.mcvideo-service-config+xml","xml"),fP=a("vnd.3gpp.mcvideo-transmission-request+xml","xml"),gP=a("vnd.3gpp.mcvideo-ue-config+xml","xml"),xP=a("vnd.3gpp.mcvideo-user-profile+xml","xml"),wP=a("vnd.3gpp.mid-call+xml","xml"),FP=a("vnd.3gpp.pic-bw-large","plb"),AP=a("vnd.3gpp.pic-bw-small","psb"),vP=a("vnd.3gpp.pic-bw-var","pvb"),bP=a("vnd.3gpp.sms"),SP=a("vnd.3gpp.sms+xml","xml"),_P=a("vnd.3gpp.srvcc-ext+xml","xml"),yP=a("vnd.3gpp.srvcc-info+xml","xml"),TP=a("vnd.3gpp.state-and-event-info+xml","xml"),EP=a("vnd.3gpp.ussd+xml","xml"),kP=a("vnd.3lightssoftware.imagescal"),MP=a("vnd.3m.post-it-notes","pwn"),DP=a("vnd.accpac.simply.aso","aso"),CP=a("vnd.accpac.simply.imp","imp"),LP=a("vnd.acucobol","acu"),PP=a("vnd.acucorp","atc","acutc"),RP=a("vnd.adobe.air-application-installer-package+zip","air"),IP=a("vnd.adobe.flash.movie"),BP=a("vnd.adobe.formscentral.fcdt","fcdt"),VP=a("vnd.adobe.fxp","fxp","fxpl"),OP=a("vnd.adobe.partial-upload"),NP=a("vnd.adobe.xdp+xml","xdp"),WP=a("vnd.adobe.xfdf","xfdf"),HP=a("vnd.aether.imp"),UP=a("vnd.afpc.afplinedata"),zP=a("vnd.afpc.afplinedata-pagedef"),jP=a("vnd.afpc.foca-charset"),GP=a("vnd.afpc.foca-codedfont"),XP=a("vnd.afpc.foca-codepage"),qP=a("vnd.afpc.modca"),YP=a("vnd.afpc.modca-formdef"),KP=a("vnd.afpc.modca-mediummap"),QP=a("vnd.afpc.modca-objectcontainer"),$P=a("vnd.afpc.modca-overlay"),JP=a("vnd.afpc.modca-pagesegment"),ZP=a("vnd.ah-barcode"),eR=a("vnd.ahead.space","ahead"),tR=a("vnd.airzip.filesecure.azf","azf"),nR=a("vnd.airzip.filesecure.azs","azs"),iR=a("vnd.amadeus+json","json"),rR=a("vnd.amazon.ebook","azw"),oR=a("vnd.amazon.mobi8-ebook"),sR=a("vnd.americandynamics.acc","acc"),aR=a("vnd.amiga.ami","ami"),lR=a("vnd.amundsen.maze+xml","xml"),cR=a("vnd.android.ota"),uR=a("vnd.android.package-archive","apk"),pR=a("vnd.anki"),dR=a("vnd.anser-web-certificate-issue-initiation","cii"),hR=a("vnd.anser-web-funds-transfer-initiation","fti"),mR=a("vnd.antix.game-component","atx"),fR=a("vnd.apache.thrift.binary"),gR=a("vnd.apache.thrift.compact"),xR=a("vnd.apache.thrift.json"),wR=a("vnd.api+json","json"),FR=a("vnd.aplextor.warrp+json","json"),AR=a("vnd.apothekende.reservation+json","json"),vR=a("vnd.apple.installer+xml","mpkg"),bR=a("vnd.apple.keynote"),SR=a("vnd.apple.mpegurl","m3u8"),_R=a("vnd.apple.numbers"),yR=a("vnd.apple.pages"),TR=a("vnd.apple.pkpass","pkpass"),ER=a("vnd.arastra.swi").deprecate("in favor of application/vnd.aristanetworks.swi"),kR=a("vnd.aristanetworks.swi","swi"),MR=a("vnd.artisan+json","json"),DR=a("vnd.artsquare"),CR=a("vnd.astraea-software.iota","iota"),LR=a("vnd.audiograph","aep"),PR=a("vnd.autopackage"),RR=a("vnd.avalon+json","json"),IR=a("vnd.avistar+xml","xml"),BR=a("vnd.balsamiq.bmml+xml","xml"),VR=a("vnd.balsamiq.bmpr"),OR=a("vnd.banana-accounting"),NR=a("vnd.bbf.usp.error"),WR=a("vnd.bbf.usp.msg"),HR=a("vnd.bbf.usp.msg+json","json"),UR=a("vnd.bekitzur-stech+json","json"),zR=a("vnd.bint.med-content"),jR=a("vnd.biopax.rdf+xml","xml"),GR=a("vnd.blink-idb-value-wrapper"),XR=a("vnd.blueice.multipass","mpm"),qR=a("vnd.bluetooth.ep.oob"),YR=a("vnd.bluetooth.le.oob"),KR=a("vnd.bmi","bmi"),QR=a("vnd.bpf"),$R=a("vnd.bpf3"),JR=a("vnd.businessobjects","rep"),ZR=a("vnd.byu.uapi+json","json"),eI=a("vnd.cab-jscript"),tI=a("vnd.canon-cpdl"),nI=a("vnd.canon-lips"),iI=a("vnd.capasystems-pg+json","json"),rI=a("vnd.cendio.thinlinc.clientconf"),oI=a("vnd.century-systems.tcp_stream"),sI=a("vnd.chemdraw+xml","cdxml"),aI=a("vnd.chess-pgn"),lI=a("vnd.chipnuts.karaoke-mmd","mmd"),cI=a("vnd.ciedi"),uI=a("vnd.cinderella","cdy"),pI=a("vnd.cirpack.isdn-ext"),dI=a("vnd.citationstyles.style+xml","xml"),hI=a("vnd.claymore","cla"),mI=a("vnd.cloanto.rp9","rp9"),fI=a("vnd.clonk.c4group","c4g","c4d","c4f","c4p","c4u"),gI=a("vnd.cluetrust.cartomobile-config","c11amc"),xI=a("vnd.cluetrust.cartomobile-config-pkg","c11amz"),wI=a("vnd.coffeescript"),FI=a("vnd.collabio.xodocuments.document"),AI=a("vnd.collabio.xodocuments.document-template"),vI=a("vnd.collabio.xodocuments.presentation"),bI=a("vnd.collabio.xodocuments.presentation-template"),SI=a("vnd.collabio.xodocuments.spreadsheet"),_I=a("vnd.collabio.xodocuments.spreadsheet-template"),yI=a("vnd.collection.doc+json","json"),TI=a("vnd.collection+json","json"),EI=a("vnd.collection.next+json","json"),kI=a("vnd.comicbook-rar"),MI=a("vnd.comicbook+zip","zip"),DI=a("vnd.commerce-battelle"),CI=a("vnd.commonspace","csp"),LI=a("vnd.contact.cmsg","cdbcmsg"),PI=a("vnd.coreos.ignition+json","json"),RI=a("vnd.cosmocaller","cmc"),II=a("vnd.crick.clicker","clkx"),BI=a("vnd.crick.clicker.keyboard","clkk"),VI=a("vnd.crick.clicker.palette","clkp"),OI=a("vnd.crick.clicker.template","clkt"),NI=a("vnd.crick.clicker.wordbank","clkw"),WI=a("vnd.criticaltools.wbs+xml","wbs"),HI=a("vnd.cryptii.pipe+json","json"),UI=a("vnd.crypto-shade-file"),zI=a("vnd.ctc-posml","pml"),jI=a("vnd.ctct.ws+xml","xml"),GI=a("vnd.cups-pdf"),XI=a("vnd.cups-postscript"),qI=a("vnd.cups-ppd","ppd"),YI=a("vnd.cups-raster"),KI=a("vnd.cups-raw"),QI=a("vnd.curl"),$I=a("vnd.curl.car","car"),JI=a("vnd.curl.pcurl","pcurl"),ZI=a("vnd.cyan.dean.root+xml","xml"),eB=a("vnd.cybank"),tB=a("vnd.d2l.coursepackage1p0+zip","zip"),nB=a("vnd.dart","dart"),iB=a("vnd.data-vision.rdz","rdz"),rB=a("vnd.datapackage+json","json"),oB=a("vnd.dataresource+json","json"),sB=a("vnd.debian.binary-package"),aB=a("vnd.dece.data","uvf","uvvf","uvd","uvvd"),lB=a("vnd.dece.ttml+xml","uvt","uvvt"),cB=a("vnd.dece.unspecified","uvx","uvvx"),uB=a("vnd.dece.zip","uvz","uvvz"),pB=a("vnd.denovo.fcselayout-link","fe_launch"),dB=a("vnd.desmume.movie"),hB=a("vnd.dir-bi.plate-dl-nosuffix"),mB=a("vnd.dm.delegation+xml","xml"),fB=a("vnd.dna","dna"),gB=a("vnd.document+json","json"),xB=a("vnd.dolby.mlp","mlp"),wB=a("vnd.dolby.mobile.1"),FB=a("vnd.dolby.mobile.2"),AB=a("vnd.doremir.scorecloud-binary-document"),vB=a("vnd.dpgraph","dpg"),bB=a("vnd.dreamfactory","dfac"),SB=a("vnd.drive+json","json"),_B=a("vnd.ds-keypoint","kpxx"),yB=a("vnd.dtg.local"),TB=a("vnd.dtg.local.flash"),EB=a("vnd.dtg.local.html"),kB=a("vnd.dvb.ait","ait"),MB=a("vnd.dvb.dvbj"),DB=a("vnd.dvb.esgcontainer"),CB=a("vnd.dvb.ipdcdftnotifaccess"),LB=a("vnd.dvb.ipdcesgaccess"),PB=a("vnd.dvb.ipdcesgaccess2"),RB=a("vnd.dvb.ipdcesgpdd"),IB=a("vnd.dvb.ipdcroaming"),BB=a("vnd.dvb.iptv.alfec-base"),VB=a("vnd.dvb.iptv.alfec-enhancement"),OB=a("vnd.dvb.notif-aggregate-root+xml","xml"),NB=a("vnd.dvb.notif-container+xml","xml"),WB=a("vnd.dvb.notif-generic+xml","xml"),HB=a("vnd.dvb.notif-ia-msglist+xml","xml"),UB=a("vnd.dvb.notif-ia-registration-request+xml","xml"),zB=a("vnd.dvb.notif-ia-registration-response+xml","xml"),jB=a("vnd.dvb.notif-init+xml","xml"),GB=a("vnd.dvb.pfr"),XB=a("vnd.dvb.service","svc"),qB=a("vnd.dxr"),YB=a("vnd.dynageo","geo"),KB=a("vnd.dzr"),QB=a("vnd.easykaraoke.cdgdownload"),$B=a("vnd.ecdis-update"),JB=a("vnd.ecip.rlp"),ZB=a("vnd.ecowin.chart","mag"),e4=a("vnd.ecowin.filerequest"),t4=a("vnd.ecowin.fileupdate"),n4=a("vnd.ecowin.series"),i4=a("vnd.ecowin.seriesrequest"),r4=a("vnd.ecowin.seriesupdate"),o4=a("vnd.efi.img"),s4=a("vnd.efi.iso"),a4=a("vnd.emclient.accessrequest+xml","xml"),l4=a("vnd.enliven","nml"),c4=a("vnd.enphase.envoy"),u4=a("vnd.eprints.data+xml","xml"),p4=a("vnd.epson.esf","esf"),d4=a("vnd.epson.msf","msf"),h4=a("vnd.epson.quickanime","qam"),m4=a("vnd.epson.salt","slt"),f4=a("vnd.epson.ssf","ssf"),g4=a("vnd.ericsson.quickcall"),x4=a("vnd.espass-espass+zip","zip"),w4=a("vnd.eszigno3+xml","es3","et3"),F4=a("vnd.etsi.aoc+xml","xml"),A4=a("vnd.etsi.asic-e+zip","zip"),v4=a("vnd.etsi.asic-s+zip","zip"),b4=a("vnd.etsi.cug+xml","xml"),S4=a("vnd.etsi.iptvcommand+xml","xml"),_4=a("vnd.etsi.iptvdiscovery+xml","xml"),y4=a("vnd.etsi.iptvprofile+xml","xml"),T4=a("vnd.etsi.iptvsad-bc+xml","xml"),E4=a("vnd.etsi.iptvsad-cod+xml","xml"),k4=a("vnd.etsi.iptvsad-npvr+xml","xml"),M4=a("vnd.etsi.iptvservice+xml","xml"),D4=a("vnd.etsi.iptvsync+xml","xml"),C4=a("vnd.etsi.iptvueprofile+xml","xml"),L4=a("vnd.etsi.mcid+xml","xml"),P4=a("vnd.etsi.mheg5"),R4=a("vnd.etsi.overload-control-policy-dataset+xml","xml"),I4=a("vnd.etsi.pstn+xml","xml"),B4=a("vnd.etsi.sci+xml","xml"),V4=a("vnd.etsi.simservs+xml","xml"),O4=a("vnd.etsi.timestamp-token"),N4=a("vnd.etsi.tsl.der"),W4=a("vnd.etsi.tsl+xml","xml"),H4=a("vnd.eudora.data"),U4=a("vnd.evolv.ecig.profile"),z4=a("vnd.evolv.ecig.settings"),j4=a("vnd.evolv.ecig.theme"),G4=a("vnd.exstream-empower+zip","zip"),X4=a("vnd.exstream-package"),q4=a("vnd.ezpix-album","ez2"),Y4=a("vnd.ezpix-package","ez3"),K4=a("vnd.f-secure.mobile"),Q4=a("vnd.fastcopy-disk-image"),$4=a("vnd.fdf","fdf"),J4=a("vnd.fdsn.mseed","mseed"),Z4=a("vnd.fdsn.seed","seed","dataless"),e6=a("vnd.ffsns"),t6=a("vnd.ficlab.flb+zip","zip"),n6=a("vnd.filmit.zfc"),i6=a("vnd.fints"),r6=a("vnd.firemonkeys.cloudcell"),o6=a("vnd.flographit","gph"),s6=a("vnd.fluxtime.clip","ftc"),a6=a("vnd.font-fontforge-sfd"),l6=a("vnd.framemaker","fm","frame","maker","book"),c6=a("vnd.frogans.fnc","fnc"),u6=a("vnd.frogans.ltf","ltf"),p6=a("vnd.fsc.weblaunch","fsc"),d6=a("vnd.fujitsu.oasys","oas"),h6=a("vnd.fujitsu.oasys2","oa2"),m6=a("vnd.fujitsu.oasys3","oa3"),f6=a("vnd.fujitsu.oasysgp","fg5"),g6=a("vnd.fujitsu.oasysprs","bh2"),x6=a("vnd.fujixerox.art-ex"),w6=a("vnd.fujixerox.art4"),F6=a("vnd.fujixerox.ddd","ddd"),A6=a("vnd.fujixerox.docuworks","xdw"),v6=a("vnd.fujixerox.docuworks.binder","xbd"),b6=a("vnd.fujixerox.docuworks.container"),S6=a("vnd.fujixerox.hbpl"),_6=a("vnd.fut-misnet"),y6=a("vnd.futoin+cbor","cbor"),T6=a("vnd.futoin+json","json"),E6=a("vnd.fuzzysheet","fzs"),k6=a("vnd.genomatix.tuxedo","txd"),M6=a("vnd.gentics.grd+json","json"),D6=a("vnd.geocube+xml","xml").deprecate("by request"),C6=a("vnd.geogebra.file","ggb"),L6=a("vnd.geogebra.tool","ggt"),P6=a("vnd.geo+json","json").deprecate("in favor of application/geo+json"),R6=a("vnd.geometry-explorer","gex","gre"),I6=a("vnd.geonext","gxt"),B6=a("vnd.geoplan","g2w"),V6=a("vnd.geospace","g3w"),O6=a("vnd.gerber"),N6=a("vnd.globalplatform.card-content-mgt"),W6=a("vnd.globalplatform.card-content-mgt-response"),H6=a("vnd.gmx","gmx").deprecate("with no reason given"),U6=a("vnd.google-apps.document","gdoc"),z6=a("vnd.google-apps.presentation","gslides"),j6=a("vnd.google-apps.spreadsheet","gsheet"),G6=a("vnd.google-earth.kml+xml","kml"),X6=a("vnd.google-earth.kmz","kmz"),q6=a("vnd.gov.sk.e-form+xml","xml"),Y6=a("vnd.gov.sk.e-form+zip","zip"),K6=a("vnd.gov.sk.xmldatacontainer+xml","xml"),Q6=a("vnd.grafeq","gqf","gqs"),$6=a("vnd.gridmp"),J6=a("vnd.groove-account","gac"),Z6=a("vnd.groove-help","ghf"),eV=a("vnd.groove-identity-message","gim"),tV=a("vnd.groove-injector","grv"),nV=a("vnd.groove-tool-message","gtm"),iV=a("vnd.groove-tool-template","tpl"),rV=a("vnd.groove-vcard","vcg"),oV=a("vnd.hal+json","json"),sV=a("vnd.hal+xml","hal"),aV=a("vnd.handheld-entertainment+xml","zmm"),lV=a("vnd.hbci","hbci"),cV=a("vnd.hc+json","json"),uV=a("vnd.hcl-bireports"),pV=a("vnd.hdt"),dV=a("vnd.heroku+json","json"),hV=a("vnd.hhe.lesson-player","les"),mV=a("vnd.hp-hpgl","hpgl"),fV=a("vnd.hp-hpid","hpid"),gV=a("vnd.hp-hps","hps"),xV=a("vnd.hp-jlyt","jlt"),wV=a("vnd.hp-pcl","pcl"),FV=a("vnd.hp-pclxl","pclxl"),AV=a("vnd.httphone"),vV=a("vnd.hydrostatix.sof-data","sfd-hdstx"),bV=a("vnd.hyper-item+json","json"),SV=a("vnd.hyperdrive+json","json"),_V=a("vnd.hyper+json","json"),yV=a("vnd.hzn-3d-crossword"),TV=a("vnd.ibm.afplinedata").deprecate("in favor of vnd.afpc.afplinedata"),EV=a("vnd.ibm.electronic-media"),kV=a("vnd.ibm.minipay","mpy"),MV=a("vnd.ibm.modcap","afp","listafp","list3820").deprecate("in favor of application/vnd.afpc.modca"),DV=a("vnd.ibm.rights-management","irm"),CV=a("vnd.ibm.secure-container","sc"),LV=a("vnd.iccprofile","icc","icm"),PV=a("vnd.ieee.1905"),RV=a("vnd.igloader","igl"),IV=a("vnd.imagemeter.folder+zip","zip"),BV=a("vnd.imagemeter.image+zip","zip"),VV=a("vnd.immervision-ivp","ivp"),OV=a("vnd.immervision-ivu","ivu"),NV=a("vnd.ims.imsccv1p1"),WV=a("vnd.ims.imsccv1p2"),HV=a("vnd.ims.imsccv1p3"),UV=a("vnd.ims.lis.v2.result+json","json"),zV=a("vnd.ims.lti.v2.toolconsumerprofile+json","json"),jV=a("vnd.ims.lti.v2.toolproxy.id+json","json"),GV=a("vnd.ims.lti.v2.toolproxy+json","json"),XV=a("vnd.ims.lti.v2.toolsettings+json","json"),qV=a("vnd.ims.lti.v2.toolsettings.simple+json","json"),YV=a("vnd.informedcontrol.rms+xml","xml"),KV=a("vnd.informix-visionary").deprecate("in favor of application/vnd.visionary"),QV=a("vnd.infotech.project"),$V=a("vnd.infotech.project+xml","xml"),JV=a("vnd.innopath.wamp.notification"),ZV=a("vnd.insors.igm","igm"),eO=a("vnd.intercon.formnet","xpw","xpx"),tO=a("vnd.intergeo","i2g"),nO=a("vnd.intertrust.digibox"),iO=a("vnd.intertrust.nncp"),rO=a("vnd.intu.qbo","qbo"),oO=a("vnd.intu.qfx","qfx"),sO=a("vnd.iptc.g2.catalogitem+xml","xml"),aO=a("vnd.iptc.g2.conceptitem+xml","xml"),lO=a("vnd.iptc.g2.knowledgeitem+xml","xml"),cO=a("vnd.iptc.g2.newsitem+xml","xml"),uO=a("vnd.iptc.g2.newsmessage+xml","xml"),pO=a("vnd.iptc.g2.packageitem+xml","xml"),dO=a("vnd.iptc.g2.planningitem+xml","xml"),hO=a("vnd.ipunplugged.rcprofile","rcprofile"),mO=a("vnd.irepository.package+xml","irp"),fO=a("vnd.is-xpr","xpr"),gO=a("vnd.isac.fcs","fcs"),xO=a("vnd.iso11783-10+zip","zip"),wO=a("vnd.jam","jam"),FO=a("vnd.japannet-directory-service"),AO=a("vnd.japannet-jpnstore-wakeup"),vO=a("vnd.japannet-payment-wakeup"),bO=a("vnd.japannet-registration"),SO=a("vnd.japannet-registration-wakeup"),_O=a("vnd.japannet-setstore-wakeup"),yO=a("vnd.japannet-verification"),TO=a("vnd.japannet-verification-wakeup"),EO=a("vnd.jcp.javame.midlet-rms","rms"),kO=a("vnd.jisp","jisp"),MO=a("vnd.joost.joda-archive","joda"),DO=a("vnd.jsk.isdn-ngn"),CO=a("vnd.kahootz","ktz","ktr"),LO=a("vnd.kde.karbon","karbon"),PO=a("vnd.kde.kchart","chrt"),RO=a("vnd.kde.kformula","kfo"),IO=a("vnd.kde.kivio","flw"),BO=a("vnd.kde.kontour","kon"),VO=a("vnd.kde.kpresenter","kpr","kpt"),OO=a("vnd.kde.kspread","ksp"),NO=a("vnd.kde.kword","kwd","kwt"),WO=a("vnd.kenameaapp","htke"),HO=a("vnd.kidspiration","kia"),UO=a("vnd.kinar","kne","knp"),zO=a("vnd.koan","skp","skd","skt","skm"),jO=a("vnd.kodak-descriptor","sse"),GO=a("vnd.las"),XO=a("vnd.las.las+json","json"),qO=a("vnd.las.las+xml","lasxml"),YO=a("vnd.laszip"),KO=a("vnd.leap+json","json"),QO=a("vnd.liberty-request+xml","xml"),$O=a("vnd.llamagraphics.life-balance.desktop","lbd"),JO=a("vnd.llamagraphics.life-balance.exchange+xml","lbe"),ZO=a("vnd.logipipe.circuit+zip","zip"),e5=a("vnd.loom"),t5=a("vnd.lotus-1-2-3","123"),n5=a("vnd.lotus-approach","apr"),i5=a("vnd.lotus-freelance","pre"),r5=a("vnd.lotus-notes","nsf"),o5=a("vnd.lotus-organizer","org"),s5=a("vnd.lotus-screencam","scm"),a5=a("vnd.lotus-wordpro","lwp"),l5=a("vnd.macports.portpkg","portpkg"),c5=a("vnd.mapbox-vector-tile"),u5=a("vnd.marlin.drm.actiontoken+xml","xml"),p5=a("vnd.marlin.drm.conftoken+xml","xml"),d5=a("vnd.marlin.drm.license+xml","xml"),h5=a("vnd.marlin.drm.mdcf"),m5=a("vnd.mason+json","json"),f5=a("vnd.maxmind.maxmind-db"),g5=a("vnd.mcd","mcd"),x5=a("vnd.medcalcdata","mc1"),w5=a("vnd.mediastation.cdkey","cdkey"),F5=a("vnd.meridian-slingshot"),A5=a("vnd.mfer","mwf"),v5=a("vnd.mfmp","mfm"),b5=a("vnd.micrografx.flo","flo"),S5=a("vnd.micrografx.igx","igx"),_5=a("vnd.micro+json","json"),y5=a("vnd.microsoft.portable-executable"),T5=a("vnd.microsoft.windows.thumbnail-cache"),E5=a("vnd.miele+json","json"),k5=a("vnd.mif","mif"),M5=a("vnd.minisoft-hp3000-save"),D5=a("vnd.mitsubishi.misty-guard.trustweb"),C5=a("vnd.mobius.daf","daf"),L5=a("vnd.mobius.dis","dis"),P5=a("vnd.mobius.mbk","mbk"),R5=a("vnd.mobius.mqy","mqy"),I5=a("vnd.mobius.msl","msl"),B5=a("vnd.mobius.plc","plc"),V5=a("vnd.mobius.txf","txf"),O5=a("vnd.mophun.application","mpn"),N5=a("vnd.mophun.certificate","mpc"),W5=a("vnd.motorola.flexsuite"),H5=a("vnd.motorola.flexsuite.adsi"),U5=a("vnd.motorola.flexsuite.fis"),z5=a("vnd.motorola.flexsuite.gotap"),j5=a("vnd.motorola.flexsuite.kmr"),G5=a("vnd.motorola.flexsuite.ttc"),X5=a("vnd.motorola.flexsuite.wem"),q5=a("vnd.motorola.iprm"),Y5=a("vnd.mozilla.xul+xml","xul"),K5=a("vnd.ms-3mfdocument"),Q5=a("vnd.ms-artgalry","cil"),$5=a("vnd.ms-asf"),J5=a("vnd.ms-cab-compressed","cab"),Z5=a("vnd.ms-color.iccprofile"),eN=a("vnd.ms-excel","xls","xlm","xla","xlc","xlt","xlw"),tN=a("vnd.ms-excel.addin.macroenabled.12","xlam"),nN=a("vnd.ms-excel.sheet.binary.macroenabled.12","xlsb"),iN=a("vnd.ms-excel.sheet.macroenabled.12","xlsm"),rN=a("vnd.ms-excel.template.macroenabled.12","xltm"),oN=a("vnd.ms-fontobject","eot"),sN=a("vnd.ms-htmlhelp","chm"),aN=a("vnd.ms-ims","ims"),lN=a("vnd.ms-lrm","lrm"),cN=a("vnd.ms-office.activex+xml","xml"),uN=a("vnd.ms-officetheme","thmx"),pN=a("vnd.ms-opentype"),dN=a("vnd.ms-outlook","msg"),hN=a("vnd.ms-package.obfuscated-opentype"),mN=a("vnd.ms-pki.seccat","cat"),fN=a("vnd.ms-pki.stl","stl"),gN=a("vnd.ms-playready.initiator+xml","xml"),xN=a("vnd.ms-powerpoint","ppt","pps","pot"),wN=a("vnd.ms-powerpoint.addin.macroenabled.12","ppam"),FN=a("vnd.ms-powerpoint.presentation.macroenabled.12","pptm"),AN=a("vnd.ms-powerpoint.slide.macroenabled.12","sldm"),vN=a("vnd.ms-powerpoint.slideshow.macroenabled.12","ppsm"),bN=a("vnd.ms-powerpoint.template.macroenabled.12","potm"),SN=a("vnd.ms-printdevicecapabilities+xml","xml"),_N=a("vnd.ms-printing.printticket+xml","xml"),yN=a("vnd.ms-printschematicket+xml","xml"),TN=a("vnd.ms-project","mpp","mpt"),EN=a("vnd.ms-tnef"),kN=a("vnd.ms-windows.devicepairing"),MN=a("vnd.ms-windows.nwprinting.oob"),DN=a("vnd.ms-windows.printerpairing"),CN=a("vnd.ms-windows.wsd.oob"),LN=a("vnd.ms-wmdrm.lic-chlg-req"),PN=a("vnd.ms-wmdrm.lic-resp"),RN=a("vnd.ms-wmdrm.meter-chlg-req"),IN=a("vnd.ms-wmdrm.meter-resp"),BN=a("vnd.ms-word.document.macroenabled.12","docm"),VN=a("vnd.ms-word.template.macroenabled.12","dotm"),ON=a("vnd.ms-works","wps","wks","wcm","wdb"),NN=a("vnd.ms-wpl","wpl"),WN=a("vnd.ms-xpsdocument","xps"),HN=a("vnd.msa-disk-image"),UN=a("vnd.mseq","mseq"),zN=a("vnd.msign"),jN=a("vnd.multiad.creator"),GN=a("vnd.multiad.creator.cif"),XN=a("vnd.music-niff"),qN=a("vnd.musician","mus"),YN=a("vnd.muvee.style","msty"),KN=a("vnd.mynfc","taglet"),QN=a("vnd.ncd.control"),$N=a("vnd.ncd.reference"),JN=a("vnd.nearst.inv+json","json"),ZN=a("vnd.nervana"),e9=a("vnd.netfpx"),t9=a("vnd.neurolanguage.nlu","nlu"),n9=a("vnd.nimn"),i9=a("vnd.nintendo.nitro.rom"),r9=a("vnd.nintendo.snes.rom"),o9=a("vnd.nitf","ntf","nitf"),s9=a("vnd.noblenet-directory","nnd"),a9=a("vnd.noblenet-sealer","nns"),l9=a("vnd.noblenet-web","nnw"),c9=a("vnd.nokia.catalogs"),u9=a("vnd.nokia.conml+wbxml","wbxml"),p9=a("vnd.nokia.conml+xml","xml"),d9=a("vnd.nokia.iptv.config+xml","xml"),h9=a("vnd.nokia.isds-radio-presets"),m9=a("vnd.nokia.landmarkcollection+xml","xml"),f9=a("vnd.nokia.landmark+wbxml","wbxml"),g9=a("vnd.nokia.landmark+xml","xml"),x9=a("vnd.nokia.n-gage.ac+xml","xml"),w9=a("vnd.nokia.n-gage.data","ngdat"),F9=a("vnd.nokia.n-gage.symbian.install","n-gage").deprecate("as obsolete with no replacement given"),A9=a("vnd.nokia.ncd"),v9=a("vnd.nokia.pcd+wbxml","wbxml"),b9=a("vnd.nokia.pcd+xml","xml"),S9=a("vnd.nokia.radio-preset","rpst"),_9=a("vnd.nokia.radio-presets","rpss"),y9=a("vnd.novadigm.edm","edm"),T9=a("vnd.novadigm.edx","edx"),E9=a("vnd.novadigm.ext","ext"),k9=a("vnd.ntt-local.content-share"),M9=a("vnd.ntt-local.file-transfer"),D9=a("vnd.ntt-local.ogw_remote-access"),C9=a("vnd.ntt-local.sip-ta_remote"),L9=a("vnd.ntt-local.sip-ta_tcp_stream"),P9=a("vnd.oasis.opendocument.chart","odc"),R9=a("vnd.oasis.opendocument.chart-template","otc"),I9=a("vnd.oasis.opendocument.database","odb"),B9=a("vnd.oasis.opendocument.formula","odf"),V9=a("vnd.oasis.opendocument.formula-template","odft"),O9=a("vnd.oasis.opendocument.graphics","odg"),N9=a("vnd.oasis.opendocument.graphics-template","otg"),W9=a("vnd.oasis.opendocument.image","odi"),H9=a("vnd.oasis.opendocument.image-template","oti"),U9=a("vnd.oasis.opendocument.presentation","odp"),z9=a("vnd.oasis.opendocument.presentation-template","otp"),j9=a("vnd.oasis.opendocument.spreadsheet","ods"),G9=a("vnd.oasis.opendocument.spreadsheet-template","ots"),X9=a("vnd.oasis.opendocument.text","odt"),q9=a("vnd.oasis.opendocument.text-master","odm"),Y9=a("vnd.oasis.opendocument.text-template","ott"),K9=a("vnd.oasis.opendocument.text-web","oth"),Q9=a("vnd.obn"),$9=a("vnd.ocf+cbor","cbor"),J9=a("vnd.oftn.l10n+json","json"),Z9=a("vnd.oipf.contentaccessdownload+xml","xml"),e8=a("vnd.oipf.contentaccessstreaming+xml","xml"),t8=a("vnd.oipf.cspg-hexbinary"),n8=a("vnd.oipf.dae.svg+xml","xml"),i8=a("vnd.oipf.dae.xhtml+xml","xml"),r8=a("vnd.oipf.mippvcontrolmessage+xml","xml"),o8=a("vnd.oipf.pae.gem"),s8=a("vnd.oipf.spdiscovery+xml","xml"),a8=a("vnd.oipf.spdlist+xml","xml"),l8=a("vnd.oipf.ueprofile+xml","xml"),c8=a("vnd.oipf.userprofile+xml","xml"),u8=a("vnd.olpc-sugar","xo"),p8=a("vnd.oma-scws-config"),d8=a("vnd.oma-scws-http-request"),h8=a("vnd.oma-scws-http-response"),m8=a("vnd.oma.bcast.associated-procedure-parameter+xml","xml"),f8=a("vnd.oma.bcast.drm-trigger+xml","xml"),g8=a("vnd.oma.bcast.imd+xml","xml"),x8=a("vnd.oma.bcast.ltkm"),w8=a("vnd.oma.bcast.notification+xml","xml"),F8=a("vnd.oma.bcast.provisioningtrigger"),A8=a("vnd.oma.bcast.sgboot"),v8=a("vnd.oma.bcast.sgdd+xml","xml"),b8=a("vnd.oma.bcast.sgdu"),S8=a("vnd.oma.bcast.simple-symbol-container"),_8=a("vnd.oma.bcast.smartcard-trigger+xml","xml"),y8=a("vnd.oma.bcast.sprov+xml","xml"),T8=a("vnd.oma.bcast.stkm"),E8=a("vnd.oma.cab-address-book+xml","xml"),k8=a("vnd.oma.cab-feature-handler+xml","xml"),M8=a("vnd.oma.cab-pcc+xml","xml"),D8=a("vnd.oma.cab-subs-invite+xml","xml"),C8=a("vnd.oma.cab-user-prefs+xml","xml"),L8=a("vnd.oma.dcd"),P8=a("vnd.oma.dcdc"),R8=a("vnd.oma.dd2+xml","dd2"),I8=a("vnd.oma.drm.risd+xml","xml"),B8=a("vnd.omads-email+xml","xml"),V8=a("vnd.omads-file+xml","xml"),O8=a("vnd.omads-folder+xml","xml"),N8=a("vnd.oma.group-usage-list+xml","xml"),W8=a("vnd.omaloc-supl-init"),H8=a("vnd.oma.lwm2m+json","json"),U8=a("vnd.oma.lwm2m+tlv","tlv"),z8=a("vnd.oma.pal+xml","xml"),j8=a("vnd.oma.poc.detailed-progress-report+xml","xml"),G8=a("vnd.oma.poc.final-report+xml","xml"),X8=a("vnd.oma.poc.groups+xml","xml"),q8=a("vnd.oma.poc.invocation-descriptor+xml","xml"),Y8=a("vnd.oma.poc.optimized-progress-report+xml","xml"),K8=a("vnd.oma.push"),Q8=a("vnd.oma.scidm.messages+xml","xml"),$8=a("vnd.oma.xcap-directory+xml","xml"),J8=a("vnd.onepager"),Z8=a("vnd.onepagertamp"),eW=a("vnd.onepagertamx"),tW=a("vnd.onepagertat"),nW=a("vnd.onepagertatp"),iW=a("vnd.onepagertatx"),rW=a("vnd.openblox.game-binary"),oW=a("vnd.openblox.game+xml","xml"),sW=a("vnd.openeye.oeb"),aW=a("vnd.openofficeorg.extension","oxt"),lW=a("vnd.openstreetmap.data+xml","xml"),cW=a("vnd.openxmlformats-officedocument.custom-properties+xml","xml"),uW=a("vnd.openxmlformats-officedocument.customxmlproperties+xml","xml"),pW=a("vnd.openxmlformats-officedocument.drawingml.chartshapes+xml","xml"),dW=a("vnd.openxmlformats-officedocument.drawingml.chart+xml","xml"),hW=a("vnd.openxmlformats-officedocument.drawingml.diagramcolors+xml","xml"),mW=a("vnd.openxmlformats-officedocument.drawingml.diagramdata+xml","xml"),fW=a("vnd.openxmlformats-officedocument.drawingml.diagramlayout+xml","xml"),gW=a("vnd.openxmlformats-officedocument.drawingml.diagramstyle+xml","xml"),xW=a("vnd.openxmlformats-officedocument.drawing+xml","xml"),wW=a("vnd.openxmlformats-officedocument.extended-properties+xml","xml"),FW=a("vnd.openxmlformats-officedocument.presentationml.commentauthors+xml","xml"),AW=a("vnd.openxmlformats-officedocument.presentationml.comments+xml","xml"),vW=a("vnd.openxmlformats-officedocument.presentationml.handoutmaster+xml","xml"),bW=a("vnd.openxmlformats-officedocument.presentationml.notesmaster+xml","xml"),SW=a("vnd.openxmlformats-officedocument.presentationml.notesslide+xml","xml"),_W=a("vnd.openxmlformats-officedocument.presentationml.presentation","pptx"),yW=a("vnd.openxmlformats-officedocument.presentationml.presentation.main+xml","xml"),TW=a("vnd.openxmlformats-officedocument.presentationml.presprops+xml","xml"),EW=a("vnd.openxmlformats-officedocument.presentationml.slide","sldx"),kW=a("vnd.openxmlformats-officedocument.presentationml.slidelayout+xml","xml"),MW=a("vnd.openxmlformats-officedocument.presentationml.slidemaster+xml","xml"),DW=a("vnd.openxmlformats-officedocument.presentationml.slideshow","ppsx"),CW=a("vnd.openxmlformats-officedocument.presentationml.slideshow.main+xml","xml"),LW=a("vnd.openxmlformats-officedocument.presentationml.slideupdateinfo+xml","xml"),PW=a("vnd.openxmlformats-officedocument.presentationml.slide+xml","xml"),RW=a("vnd.openxmlformats-officedocument.presentationml.tablestyles+xml","xml"),IW=a("vnd.openxmlformats-officedocument.presentationml.tags+xml","xml"),BW=a("vnd.openxmlformats-officedocument.presentationml.template","potx"),VW=a("vnd.openxmlformats-officedocument.presentationml.template.main+xml","xml"),OW=a("vnd.openxmlformats-officedocument.presentationml.viewprops+xml","xml"),NW=a("vnd.openxmlformats-officedocument.spreadsheetml.calcchain+xml","xml"),WW=a("vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml","xml"),HW=a("vnd.openxmlformats-officedocument.spreadsheetml.comments+xml","xml"),UW=a("vnd.openxmlformats-officedocument.spreadsheetml.connections+xml","xml"),zW=a("vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml","xml"),jW=a("vnd.openxmlformats-officedocument.spreadsheetml.externallink+xml","xml"),GW=a("vnd.openxmlformats-officedocument.spreadsheetml.pivotcachedefinition+xml","xml"),XW=a("vnd.openxmlformats-officedocument.spreadsheetml.pivotcacherecords+xml","xml"),qW=a("vnd.openxmlformats-officedocument.spreadsheetml.pivottable+xml","xml"),YW=a("vnd.openxmlformats-officedocument.spreadsheetml.querytable+xml","xml"),KW=a("vnd.openxmlformats-officedocument.spreadsheetml.revisionheaders+xml","xml"),QW=a("vnd.openxmlformats-officedocument.spreadsheetml.revisionlog+xml","xml"),$W=a("vnd.openxmlformats-officedocument.spreadsheetml.sharedstrings+xml","xml"),JW=a("vnd.openxmlformats-officedocument.spreadsheetml.sheet","xlsx"),ZW=a("vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml","xml"),e7=a("vnd.openxmlformats-officedocument.spreadsheetml.sheetmetadata+xml","xml"),t7=a("vnd.openxmlformats-officedocument.spreadsheetml.styles+xml","xml"),n7=a("vnd.openxmlformats-officedocument.spreadsheetml.tablesinglecells+xml","xml"),i7=a("vnd.openxmlformats-officedocument.spreadsheetml.table+xml","xml"),r7=a("vnd.openxmlformats-officedocument.spreadsheetml.template","xltx"),o7=a("vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml","xml"),s7=a("vnd.openxmlformats-officedocument.spreadsheetml.usernames+xml","xml"),a7=a("vnd.openxmlformats-officedocument.spreadsheetml.volatiledependencies+xml","xml"),l7=a("vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml","xml"),c7=a("vnd.openxmlformats-officedocument.themeoverride+xml","xml"),u7=a("vnd.openxmlformats-officedocument.theme+xml","xml"),p7=a("vnd.openxmlformats-officedocument.vmldrawing"),d7=a("vnd.openxmlformats-officedocument.wordprocessingml.comments+xml","xml"),h7=a("vnd.openxmlformats-officedocument.wordprocessingml.document","docx"),m7=a("vnd.openxmlformats-officedocument.wordprocessingml.document.glossary+xml","xml"),f7=a("vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml","xml"),g7=a("vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml","xml"),x7=a("vnd.openxmlformats-officedocument.wordprocessingml.fonttable+xml","xml"),w7=a("vnd.openxmlformats-officedocument.wordprocessingml.footer+xml","xml"),F7=a("vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml","xml"),A7=a("vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml","xml"),v7=a("vnd.openxmlformats-officedocument.wordprocessingml.settings+xml","xml"),b7=a("vnd.openxmlformats-officedocument.wordprocessingml.styles+xml","xml"),S7=a("vnd.openxmlformats-officedocument.wordprocessingml.template","dotx"),_7=a("vnd.openxmlformats-officedocument.wordprocessingml.template.main+xml","xml"),y7=a("vnd.openxmlformats-officedocument.wordprocessingml.websettings+xml","xml"),T7=a("vnd.openxmlformats-package.core-properties+xml","xml"),E7=a("vnd.openxmlformats-package.digital-signature-xmlsignature+xml","xml"),k7=a("vnd.openxmlformats-package.relationships+xml","xml"),M7=a("vnd.oracle.resource+json","json"),D7=a("vnd.orange.indata"),C7=a("vnd.osa.netdeploy"),L7=a("vnd.osgeo.mapguide.package","mgp"),P7=a("vnd.osgi.bundle"),R7=a("vnd.osgi.dp","dp"),I7=a("vnd.osgi.subsystem","esa"),B7=a("vnd.otps.ct-kip+xml","xml"),V7=a("vnd.oxli.countgraph"),O7=a("vnd.pagerduty+json","json"),N7=a("vnd.palm","pdb","pqa","oprc"),W7=a("vnd.panoply"),H7=a("vnd.paos.xml"),U7=a("vnd.patentdive"),z7=a("vnd.patientecommsdoc"),j7=a("vnd.pawaafile","paw"),G7=a("vnd.pcos"),X7=a("vnd.pg.format","str"),q7=a("vnd.pg.osasli","ei6"),Y7=a("vnd.piaccess.application-licence"),K7=a("vnd.picsel","efif"),Q7=a("vnd.pmi.widget","wg"),$7=a("vnd.poc.group-advertisement+xml","xml"),J7=a("vnd.pocketlearn","plf"),Z7=a("vnd.powerbuilder6","pbd"),eH=a("vnd.powerbuilder6-s"),tH=a("vnd.powerbuilder7"),nH=a("vnd.powerbuilder7-s"),iH=a("vnd.powerbuilder75"),rH=a("vnd.powerbuilder75-s"),oH=a("vnd.preminet"),sH=a("vnd.previewsystems.box","box"),aH=a("vnd.proteus.magazine","mgz"),lH=a("vnd.psfs"),cH=a("vnd.publishare-delta-tree","qps"),uH=a("vnd.pvi.ptid1","ptid"),pH=a("vnd.pwg-multiplexed"),dH=a("vnd.pwg-xhtml-print+xml","xml"),hH=a("vnd.qualcomm.brew-app-res"),mH=a("vnd.quarantainenet"),fH=a("vnd.quark.quarkxpress","qxd","qxt","qwd","qwt","qxl","qxb"),gH=a("vnd.quobject-quoxdocument"),xH=a("vnd.radisys.moml+xml","xml"),wH=a("vnd.radisys.msml-audit-conf+xml","xml"),FH=a("vnd.radisys.msml-audit-conn+xml","xml"),AH=a("vnd.radisys.msml-audit-dialog+xml","xml"),vH=a("vnd.radisys.msml-audit-stream+xml","xml"),bH=a("vnd.radisys.msml-audit+xml","xml"),SH=a("vnd.radisys.msml-conf+xml","xml"),_H=a("vnd.radisys.msml-dialog-base+xml","xml"),yH=a("vnd.radisys.msml-dialog-fax-detect+xml","xml"),TH=a("vnd.radisys.msml-dialog-fax-sendrecv+xml","xml"),EH=a("vnd.radisys.msml-dialog-group+xml","xml"),kH=a("vnd.radisys.msml-dialog-speech+xml","xml"),MH=a("vnd.radisys.msml-dialog-transform+xml","xml"),DH=a("vnd.radisys.msml-dialog+xml","xml"),CH=a("vnd.radisys.msml+xml","xml"),LH=a("vnd.rainstor.data"),PH=a("vnd.rapid"),RH=a("vnd.rar"),IH=a("vnd.realvnc.bed","bed"),BH=a("vnd.recordare.musicxml","mxl"),VH=a("vnd.recordare.musicxml+xml","musicxml"),OH=a("vnd.renlearn.rlprint"),NH=a("vnd.restful+json","json"),WH=a("vnd.rig.cryptonote","cryptonote"),HH=a("vnd.rim.cod","cod"),UH=a("vnd.rn-realmedia","rm"),zH=a("vnd.rn-realmedia-vbr","rmvb"),jH=a("vnd.route66.link66+xml","link66"),GH=a("vnd.rs-274x"),XH=a("vnd.ruckus.download"),qH=a("vnd.s3sms"),YH=a("vnd.sailingtracker.track","st"),KH=a("vnd.sar"),QH=a("vnd.sbm.cid"),$H=a("vnd.sbm.mid2"),JH=a("vnd.scribus"),ZH=a("vnd.sealed.3df"),eU=a("vnd.sealed.csf"),tU=a("vnd.sealed.doc"),nU=a("vnd.sealed.eml"),iU=a("vnd.sealedmedia.softseal.html"),rU=a("vnd.sealedmedia.softseal.pdf"),oU=a("vnd.sealed.mht"),sU=a("vnd.sealed.net"),aU=a("vnd.sealed.ppt"),lU=a("vnd.sealed.tiff"),cU=a("vnd.sealed.xls"),uU=a("vnd.seemail","see"),pU=a("vnd.sema","sema"),dU=a("vnd.semd","semd"),hU=a("vnd.semf","semf"),mU=a("vnd.shade-save-file"),fU=a("vnd.shana.informed.formdata","ifm"),gU=a("vnd.shana.informed.formtemplate","itp"),xU=a("vnd.shana.informed.interchange","iif"),wU=a("vnd.shana.informed.package","ipk"),FU=a("vnd.shootproof+json","json"),AU=a("vnd.shopkick+json","json"),vU=a("vnd.sigrok.session"),bU=a("vnd.simtech-mindmapper","twd","twds"),SU=a("vnd.siren+json","json"),_U=a("vnd.smaf","mmf"),yU=a("vnd.smart.notebook"),TU=a("vnd.smart.teacher","teacher"),EU=a("vnd.software602.filler.form-xml-zip"),kU=a("vnd.software602.filler.form+xml","xml"),MU=a("vnd.solent.sdkm+xml","sdkm","sdkd"),DU=a("vnd.spotfire.dxp","dxp"),CU=a("vnd.spotfire.sfs","sfs"),LU=a("vnd.sqlite3"),PU=a("vnd.sss-cod"),RU=a("vnd.sss-dtf"),IU=a("vnd.sss-ntf"),BU=a("vnd.stardivision.calc","sdc"),VU=a("vnd.stardivision.draw","sda"),OU=a("vnd.stardivision.impress","sdd"),NU=a("vnd.stardivision.math","smf"),WU=a("vnd.stardivision.writer","sdw","vor"),HU=a("vnd.stardivision.writer-global","sgl"),UU=a("vnd.stepmania.package","smzip"),zU=a("vnd.stepmania.stepchart","sm"),jU=a("vnd.street-stream"),GU=a("vnd.sun.wadl+xml","xml"),XU=a("vnd.sun.xml.calc","sxc"),qU=a("vnd.sun.xml.calc.template","stc"),YU=a("vnd.sun.xml.draw","sxd"),KU=a("vnd.sun.xml.draw.template","std"),QU=a("vnd.sun.xml.impress","sxi"),$U=a("vnd.sun.xml.impress.template","sti"),JU=a("vnd.sun.xml.math","sxm"),ZU=a("vnd.sun.xml.writer","sxw"),ez=a("vnd.sun.xml.writer.global","sxg"),tz=a("vnd.sun.xml.writer.template","stw"),nz=a("vnd.sus-calendar","sus","susp"),iz=a("vnd.svd","svd"),rz=a("vnd.swiftview-ics"),oz=a("vnd.symbian.install","sis","sisx"),sz=a("vnd.syncml.dmddf+wbxml","wbxml"),az=a("vnd.syncml.dmddf+xml","xml"),lz=a("vnd.syncml.dm.notification"),cz=a("vnd.syncml.dmtnds+wbxml","wbxml"),uz=a("vnd.syncml.dmtnds+xml","xml"),pz=a("vnd.syncml.dm+wbxml","bdm"),dz=a("vnd.syncml.dm+xml","xdm"),hz=a("vnd.syncml.ds.notification"),mz=a("vnd.syncml+xml","xsm"),fz=a("vnd.tableschema+json","json"),gz=a("vnd.tao.intent-module-archive","tao"),xz=a("vnd.tcpdump.pcap","pcap","cap","dmp"),wz=a("vnd.think-cell.ppttc+json","json"),Fz=a("vnd.tmd.mediaflex.api+xml","xml"),Az=a("vnd.tml"),vz=a("vnd.tmobile-livetv","tmo"),bz=a("vnd.trid.tpt","tpt"),Sz=a("vnd.tri.onesource"),_z=a("vnd.triscape.mxs","mxs"),yz=a("vnd.trueapp","tra"),Tz=a("vnd.truedoc"),Ez=a("vnd.ubisoft.webplayer"),kz=a("vnd.ufdl","ufd","ufdl"),Mz=a("vnd.uiq.theme","utz"),Dz=a("vnd.umajin","umj"),Cz=a("vnd.unity","unityweb"),Lz=a("vnd.uoml+xml","uoml"),Pz=a("vnd.uplanet.alert"),Rz=a("vnd.uplanet.alert-wbxml"),Iz=a("vnd.uplanet.bearer-choice"),Bz=a("vnd.uplanet.bearer-choice-wbxml"),Vz=a("vnd.uplanet.cacheop"),Oz=a("vnd.uplanet.cacheop-wbxml"),Nz=a("vnd.uplanet.channel"),Wz=a("vnd.uplanet.channel-wbxml"),Hz=a("vnd.uplanet.list"),Uz=a("vnd.uplanet.list-wbxml"),zz=a("vnd.uplanet.listcmd"),jz=a("vnd.uplanet.listcmd-wbxml"),Gz=a("vnd.uplanet.signal"),Xz=a("vnd.uri-map"),qz=a("vnd.valve.source.material"),Yz=a("vnd.vcx","vcx"),Kz=a("vnd.vd-study"),Qz=a("vnd.vectorworks"),$z=a("vnd.vel+json","json"),Jz=a("vnd.verimatrix.vcas"),Zz=a("vnd.veryant.thin"),ej=a("vnd.ves.encrypted"),tj=a("vnd.vidsoft.vidconference"),nj=a("vnd.visio","vsd","vst","vss","vsw"),ij=a("vnd.visionary","vis"),rj=a("vnd.vividence.scriptfile"),oj=a("vnd.vsf","vsf"),sj=a("vnd.wap.sic"),aj=a("vnd.wap.slc"),lj=a("vnd.wap.wbxml","wbxml"),cj=a("vnd.wap.wmlc","wmlc"),uj=a("vnd.wap.wmlscriptc","wmlsc"),pj=a("vnd.webturbo","wtb"),dj=a("vnd.wfa.p2p"),hj=a("vnd.wfa.wsc"),mj=a("vnd.windows.devicepairing"),fj=a("vnd.wmc"),gj=a("vnd.wmf.bootstrap"),xj=a("vnd.wolfram.mathematica"),wj=a("vnd.wolfram.mathematica.package"),Fj=a("vnd.wolfram.player","nbp"),Aj=a("vnd.wordperfect","wpd"),vj=a("vnd.wqd","wqd"),bj=a("vnd.wrq-hp3000-labelled"),Sj=a("vnd.wt.stf","stf"),_j=a("vnd.wv.csp+wbxml","wbxml"),yj=a("vnd.wv.csp+xml","xml"),Tj=a("vnd.wv.ssp+xml","xml"),Ej=a("vnd.xacml+json","json"),kj=a("vnd.xara","xar"),Mj=a("vnd.xfdl","xfdl"),Dj=a("vnd.xfdl.webform"),Cj=a("vnd.xmi+xml","xml"),Lj=a("vnd.xmpie.cpkg"),Pj=a("vnd.xmpie.dpkg"),Rj=a("vnd.xmpie.plan"),Ij=a("vnd.xmpie.ppkg"),Bj=a("vnd.xmpie.xlim"),Vj=a("vnd.yamaha.hv-dic","hvd"),Oj=a("vnd.yamaha.hv-script","hvs"),Nj=a("vnd.yamaha.hv-voice","hvp"),Wj=a("vnd.yamaha.openscoreformat","osf"),Hj=a("vnd.yamaha.openscoreformat.osfpvg+xml","osfpvg"),Uj=a("vnd.yamaha.remote-setup"),zj=a("vnd.yamaha.smaf-audio","saf"),jj=a("vnd.yamaha.smaf-phrase","spf"),Gj=a("vnd.yamaha.through-ngn"),Xj=a("vnd.yamaha.tunnel-udpencap"),qj=a("vnd.yaoweme"),Yj=a("vnd.yellowriver-custom-menu","cmp"),Kj=a("vnd.youtube.yt").deprecate("in favor of video/vnd.youtube.yt"),Qj=a("vnd.zul","zir","zirz"),$j=a("vnd.zzazz.deck+xml","zaz"),Jj=a("vividence.scriptfile"),Zj=a("voicexml+xml","vxml"),eG=a("voucher-cms+json","json"),tG=a("vq-rtcpxr"),_p=a("wasm","wasm"),nG=a("watcherinfo+xml","xml"),iG=a("webpush-options+json","json"),rG=a("whoispp-query"),oG=a("whoispp-response"),sG=a("widget","wgt"),aG=a("winhlp","hlp"),lG=a("wita"),cG=a("wordperfect5.1"),uG=a("wsdl+xml","wsdl"),pG=a("wspolicy+xml","wspolicy"),dG=a("x-7z-compressed","7z"),hG=a("x-abiword","abw"),mG=a("x-ace-compressed","ace"),fG=a("x-amf"),gG=a("x-apple-diskimage","dmg"),xG=a("x-arj","arj"),wG=a("x-authorware-bin","aab","x32","u32","vox"),FG=a("x-authorware-map","aam"),AG=a("x-authorware-seg","aas"),vG=a("x-bcpio","bcpio"),bG=a("x-bdoc","bdoc"),SG=a("x-bittorrent","torrent"),_G=a("x-blorb","blb","blorb"),yG=a("x-bzip","bz"),TG=a("x-bzip2","bz2","boz"),EG=a("x-cbr","cbr","cba","cbt","cbz","cb7"),kG=a("x-cdlink","vcd"),MG=a("x-cfs-compressed","cfs"),DG=a("x-chat","chat"),CG=a("x-chess-pgn","pgn"),LG=a("x-chrome-extension","crx"),PG=a("x-deb"),RG=a("x-compress"),IG=a("x-conference","nsc"),BG=a("x-cpio","cpio"),VG=a("x-csh","csh"),OG=a("x-debian-package","deb","udeb"),NG=a("x-dgc-compressed","dgc"),WG=a("x-director","dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"),HG=a("x-doom","wad"),UG=a("x-dtbncx+xml","ncx"),zG=a("x-dtbook+xml","dtb"),jG=a("x-dtbresource+xml","res"),GG=a("x-dvi","dvi"),XG=a("x-envoy","evy"),qG=a("x-eva","eva"),YG=a("x-font-bdf","bdf"),KG=a("x-font-dos"),QG=a("x-font-framemaker"),$G=a("x-font-ghostscript","gsf"),JG=a("x-font-libgrx"),ZG=a("x-font-linux-psf","psf"),eX=a("x-font-pcf","pcf"),tX=a("x-font-snf","snf"),nX=a("x-font-speedo"),iX=a("x-font-sunos-news"),rX=a("x-font-type1","pfa","pfb","pfm","afm"),oX=a("x-font-vfont"),sX=a("x-freearc","arc"),aX=a("x-futuresplash","spl"),lX=a("x-gca-compressed","gca"),cX=a("x-glulx","ulx"),uX=a("x-gnumeric","gnumeric"),pX=a("x-gramps-xml","gramps"),dX=a("x-gtar","gtar"),hX=a("x-gzip"),mX=a("x-hdf","hdf"),fX=a("x-httpd-php","php"),gX=a("x-install-instructions","install"),xX=a("x-iso9660-image","iso"),wX=a("x-iwork-keynote-sffkey","key").deprecate("alias for iWorks Keynote file"),FX=a("x-iwork-numbers-sffnumbers","numbers").deprecate("alias for iWorks Numbers file"),AX=a("x-iwork-pages-sffpages","pages").deprecate("alias for iWorks Pages file"),vX=a("x-java-jnlp-file","jnlp"),bX=a("x-javascript"),SX=a("x-keepass2","kdbx"),_X=a("x-latex","latex"),yX=a("x-lua-bytecode","luac"),TX=a("x-lzh-compressed","lzh","lha"),EX=a("x-mie","mie"),kX=a("x-mobipocket-ebook","prc","mobi"),MX=a("x-mpegurl"),DX=a("x-ms-application","application"),CX=a("x-ms-shortcut","lnk"),LX=a("x-ms-wmd","wmd"),PX=a("x-ms-wmz","wmz"),RX=a("x-ms-xbap","xbap"),IX=a("x-msdos-program","exe"),BX=a("x-msaccess","mdb"),VX=a("x-msbinder","obd"),OX=a("x-mscardfile","crd"),NX=a("x-msclip","clp"),WX=a("x-msdownload","exe","dll","com","bat","msi"),HX=a("x-msmediaview","mvb","m13","m14"),UX=a("x-msmetafile","wmf","wmz","emf","emz"),zX=a("x-msmoney","mny"),jX=a("x-mspublisher","pub"),GX=a("x-msschedule","scd"),XX=a("x-msterminal","trm"),qX=a("x-mswrite","wri"),YX=a("x-netcdf","nc","cdf"),KX=a("x-ns-proxy-autoconfig","pac"),QX=a("x-nzb","nzb"),$X=a("x-pkcs12","p12","pfx"),JX=a("x-pkcs7-certificates","p7b","spc"),ZX=a("x-pkcs7-certreqresp","p7r"),eq=a("x-rar-compressed","rar"),tq=a("x-research-info-systems","ris"),nq=a("x-sh","sh"),iq=a("x-shar","shar"),rq=a("x-shockwave-flash","swf"),oq=a("x-silverlight-app","xap"),sq=a("x-sql","sql"),aq=a("x-stuffit","sit"),lq=a("x-stuffitx","sitx"),cq=a("x-subrip","srt"),uq=a("x-sv4cpio","sv4cpio"),pq=a("x-sv4crc","sv4crc"),dq=a("x-t3vm-image","t3"),hq=a("x-tads","gam"),mq=a("x-tar","tar"),fq=a("x-tcl","tcl"),gq=a("x-tex","tex"),xq=a("x-tex-tfm","tfm"),wq=a("x-texinfo","texinfo","texi"),Fq=a("x-tgif","obj"),Ec=a("x-url","url"),Aq=a("x-ustar","ustar"),vq=a("x-virtualbox-hdd","hdd"),bq=a("x-virtualbox-ova","ova"),Sq=a("x-virtualbox-ovf","ovf"),_q=a("x-virtualbox-vbox","vbox"),yq=a("x-virtualbox-vbox-extpack","vbox-extpack"),Tq=a("x-virtualbox-vdi","vdi"),Eq=a("x-virtualbox-vhd","vhd"),kq=a("x-virtualbox-vmdk","vmdk"),Mq=a("x-wais-source","src"),Dq=a("x-web-app-manifest+json","webapp"),Cq=a("x-www-form-urlencoded"),Lq=a("x-x509-ca-cert","der","crt"),Pq=a("x-xfig","fig"),Rq=a("x-xliff+xml","xlf"),Iq=a("x-xpinstall","xpi"),Bq=a("x-xz","xz"),Vq=a("x-zip-compressed","zip"),Oq=a("x-zmachine","z1","z2","z3","z4","z5","z6","z7","z8"),Nq=a("x400-bp"),Wq=a("xacml+xml","xml"),Hq=a("xaml+xml","xaml"),Uq=a("xcap-att+xml","xml"),zq=a("xcap-caps+xml","xml"),jq=a("xcap-diff+xml","xdf"),Gq=a("xcap-el+xml","xml"),Xq=a("xcap-error+xml","xml"),qq=a("xcap-ns+xml","xml"),Yq=a("xcon-conference-info-diff+xml","xml"),Kq=a("xcon-conference-info+xml","xml"),Qq=a("xenc+xml","xenc"),$q=a("xhtml-voice+xml","xml"),Jq=a("xhtml+xml","xhtml","xht"),Zq=a("xliff+xml","xml"),eY=a("xml","xml","xsl"),tY=a("xml-dtd","dtd"),nY=a("xml-external-parsed-entity"),iY=a("xml-patch+xml","xml"),rY=a("xmpp+xml","xml"),oY=a("xop+xml","xop"),sY=a("xproc+xml","xpl"),aY=a("xslt+xml","xslt"),lY=a("xspf+xml","xspf"),cY=a("xv+xml","mxml","xhvml","xvml","xvm"),uY=a("yang","yang"),pY=a("yang-data+json","json"),dY=a("yang-data+xml","xml"),hY=a("yang-patch+json","json"),mY=a("yang-patch+xml","xml"),fY=a("yin+xml","yin"),gY=a("zip","zip"),xY=a("zlib"),wY=a("zstd");var Rg={};ti(Rg,{Audio_AMR:()=>bY,Audio_AMR_WB:()=>SY,Audio_ATRAC3:()=>MY,Audio_ATRAC_ADVANCED_LOSSLESS:()=>EY,Audio_ATRAC_X:()=>kY,Audio_Aac:()=>FY,Audio_Ac3:()=>AY,Audio_Adpcm:()=>vY,Audio_Amr_WbPlus:()=>_Y,Audio_Aptx:()=>yY,Audio_Asc:()=>TY,Audio_BV16:()=>CY,Audio_BV32:()=>LY,Audio_Basic:()=>DY,Audio_CN:()=>RY,Audio_Clearmode:()=>PY,Audio_DAT12:()=>IY,Audio_DV:()=>HY,Audio_DVI4:()=>UY,Audio_Dls:()=>BY,Audio_Dsr_Es201108:()=>VY,Audio_Dsr_Es202050:()=>OY,Audio_Dsr_Es202211:()=>NY,Audio_Dsr_Es202212:()=>WY,Audio_EVRC:()=>GY,Audio_EVRC0:()=>qY,Audio_EVRC1:()=>YY,Audio_EVRCB:()=>KY,Audio_EVRCB0:()=>QY,Audio_EVRCB1:()=>$Y,Audio_EVRCNW:()=>JY,Audio_EVRCNW0:()=>ZY,Audio_EVRCNW1:()=>eK,Audio_EVRCWB:()=>tK,Audio_EVRCWB0:()=>nK,Audio_EVRCWB1:()=>iK,Audio_EVRC_QCP:()=>XY,Audio_EVS:()=>rK,Audio_Eac3:()=>zY,Audio_Encaprtp:()=>jY,Audio_Example:()=>oK,Audio_Flexfec:()=>sK,Audio_Fwdred:()=>aK,Audio_G711_0:()=>lK,Audio_G719:()=>cK,Audio_G722:()=>uK,Audio_G7221:()=>pK,Audio_G723:()=>dK,Audio_G726_16:()=>hK,Audio_G726_24:()=>mK,Audio_G726_32:()=>fK,Audio_G726_40:()=>gK,Audio_G728:()=>xK,Audio_G729:()=>wK,Audio_G7291:()=>FK,Audio_G729D:()=>AK,Audio_G729E:()=>vK,Audio_GSM:()=>bK,Audio_GSM_EFR:()=>SK,Audio_GSM_HR_08:()=>_K,Audio_ILBC:()=>yK,Audio_Ip_Mr_v25:()=>TK,Audio_Isac:()=>EK,Audio_L16:()=>kK,Audio_L20:()=>MK,Audio_L24:()=>DK,Audio_L8:()=>CK,Audio_LPC:()=>LK,Audio_MELP:()=>PK,Audio_MELP1200:()=>RK,Audio_MELP2400:()=>IK,Audio_MELP600:()=>BK,Audio_MP4A_LATM:()=>WK,Audio_MPA:()=>HK,Audio_Midi:()=>VK,Audio_Mobile_Xmf:()=>OK,Audio_Mp4:()=>NK,Audio_Mpa_Robust:()=>UK,Audio_Mpeg:()=>Si,Audio_Mpeg4_Generic:()=>zK,Audio_Musepack:()=>jK,Audio_Ogg:()=>GK,Audio_Opus:()=>XK,Audio_PCMA:()=>YK,Audio_PCMA_WB:()=>KK,Audio_PCMU:()=>QK,Audio_PCMU_WB:()=>$K,Audio_Parityfec:()=>qK,Audio_PrsSid:()=>JK,Audio_Qcelp:()=>ZK,Audio_RED:()=>tQ,Audio_Raptorfec:()=>eQ,Audio_Rtp_Enc_Aescm128:()=>nQ,Audio_Rtp_Midi:()=>iQ,Audio_Rtploopback:()=>rQ,Audio_Rtx:()=>oQ,Audio_S3m:()=>sQ,Audio_SMV:()=>lQ,Audio_SMV0:()=>uQ,Audio_SMV_QCP:()=>cQ,Audio_Silk:()=>aQ,Audio_Sp_Midi:()=>pQ,Audio_Speex:()=>dQ,Audio_T140c:()=>hQ,Audio_T38:()=>mQ,Audio_TETRA_ACELP:()=>gQ,Audio_TETRA_ACELP_BB:()=>xQ,Audio_Telephone_Event:()=>fQ,Audio_Tone:()=>wQ,Audio_UEMCLIP:()=>FQ,Audio_Ulpfec:()=>AQ,Audio_Usac:()=>vQ,Audio_VDVI:()=>bQ,Audio_VMR_WB:()=>f$,Audio_Vendor_1d_Interleaved_Parityfec:()=>SQ,Audio_Vendor_32kadpcm:()=>_Q,Audio_Vendor_3gpp:()=>yQ,Audio_Vendor_3gpp2:()=>TQ,Audio_Vendor_3gppIufp:()=>EQ,Audio_Vendor_4SB:()=>kQ,Audio_Vendor_Audiokoz:()=>MQ,Audio_Vendor_CELP:()=>DQ,Audio_Vendor_CiscoNse:()=>CQ,Audio_Vendor_CmlesRadio_Events:()=>LQ,Audio_Vendor_CnsAnp1:()=>PQ,Audio_Vendor_CnsInf1:()=>RQ,Audio_Vendor_DeceAudio:()=>IQ,Audio_Vendor_Digital_Winds:()=>BQ,Audio_Vendor_DlnaAdts:()=>VQ,Audio_Vendor_DolbyHeaac1:()=>OQ,Audio_Vendor_DolbyHeaac2:()=>NQ,Audio_Vendor_DolbyMlp:()=>WQ,Audio_Vendor_DolbyMps:()=>HQ,Audio_Vendor_DolbyPl2:()=>UQ,Audio_Vendor_DolbyPl2x:()=>zQ,Audio_Vendor_DolbyPl2z:()=>jQ,Audio_Vendor_DolbyPulse1:()=>GQ,Audio_Vendor_Dra:()=>XQ,Audio_Vendor_Dts:()=>qQ,Audio_Vendor_DtsHd:()=>YQ,Audio_Vendor_DtsUhd:()=>KQ,Audio_Vendor_DvbFile:()=>QQ,Audio_Vendor_EveradPlj:()=>$Q,Audio_Vendor_HnsAudio:()=>JQ,Audio_Vendor_LucentVoice:()=>ZQ,Audio_Vendor_Ms_PlayreadyMediaPya:()=>e$,Audio_Vendor_NokiaMobile_Xmf:()=>t$,Audio_Vendor_NortelVbk:()=>n$,Audio_Vendor_NueraEcelp4800:()=>i$,Audio_Vendor_NueraEcelp7470:()=>r$,Audio_Vendor_NueraEcelp9600:()=>o$,Audio_Vendor_OctelSbc:()=>s$,Audio_Vendor_PresonusMultitrack:()=>a$,Audio_Vendor_Qcelp:()=>l$,Audio_Vendor_Rhetorex32kadpcm:()=>c$,Audio_Vendor_Rip:()=>u$,Audio_Vendor_Rn_Realaudio:()=>p$,Audio_Vendor_SealedmediaSoftsealMpeg:()=>d$,Audio_Vendor_VmxCvsd:()=>h$,Audio_Vendor_Wave:()=>m$,Audio_Vorbis:()=>g$,Audio_Vorbis_Config:()=>x$,Audio_Wav:()=>w$,Audio_Wave:()=>F$,Audio_WebMOpus:()=>A$,Audio_Webm:()=>kc,Audio_X_Aac:()=>v$,Audio_X_Aiff:()=>b$,Audio_X_Caf:()=>S$,Audio_X_Flac:()=>_$,Audio_X_Matroska:()=>y$,Audio_X_Mpegurl:()=>T$,Audio_X_Ms_Wax:()=>E$,Audio_X_Ms_Wma:()=>k$,Audio_X_Pn_Realaudio:()=>M$,Audio_X_Pn_Realaudio_Plugin:()=>D$,Audio_X_Tta:()=>C$,Audio_X_Wav:()=>L$,Audio_Xm:()=>P$});var ne=Wt("audio"),FY=ne("aac","aac"),AY=ne("ac3","ac3"),vY=ne("adpcm","adp"),bY=ne("amr","amr"),SY=ne("amr-wb"),_Y=ne("amr-wb+"),yY=ne("aptx"),TY=ne("asc"),EY=ne("atrac-advanced-lossless"),kY=ne("atrac-x"),MY=ne("atrac3"),DY=ne("basic","au","snd"),CY=ne("bv16"),LY=ne("bv32"),PY=ne("clearmode"),RY=ne("cn"),IY=ne("dat12"),BY=ne("dls"),VY=ne("dsr-es201108"),OY=ne("dsr-es202050"),NY=ne("dsr-es202211"),WY=ne("dsr-es202212"),HY=ne("dv"),UY=ne("dvi4"),zY=ne("eac3"),jY=ne("encaprtp"),GY=ne("evrc"),XY=ne("evrc-qcp"),qY=ne("evrc0"),YY=ne("evrc1"),KY=ne("evrcb"),QY=ne("evrcb0"),$Y=ne("evrcb1"),JY=ne("evrcnw"),ZY=ne("evrcnw0"),eK=ne("evrcnw1"),tK=ne("evrcwb"),nK=ne("evrcwb0"),iK=ne("evrcwb1"),rK=ne("evs"),oK=ne("example"),sK=ne("flexfec"),aK=ne("fwdred"),lK=ne("g711-0"),cK=ne("g719"),uK=ne("g722"),pK=ne("g7221"),dK=ne("g723"),hK=ne("g726-16"),mK=ne("g726-24"),fK=ne("g726-32"),gK=ne("g726-40"),xK=ne("g728"),wK=ne("g729"),FK=ne("g7291"),AK=ne("g729d"),vK=ne("g729e"),bK=ne("gsm","gsm"),SK=ne("gsm-efr"),_K=ne("gsm-hr-08"),yK=ne("ilbc"),TK=ne("ip-mr_v2.5"),EK=ne("isac"),kK=ne("l16"),MK=ne("l20"),DK=ne("l24"),CK=ne("l8"),LK=ne("lpc"),PK=ne("melp"),RK=ne("melp1200"),IK=ne("melp2400"),BK=ne("melp600"),VK=ne("midi","mid","midi","kar","rmi"),OK=ne("mobile-xmf"),NK=ne("mp4","m4a","mp4a"),WK=ne("mp4a-latm"),HK=ne("mpa"),UK=ne("mpa-robust"),Si=ne("mpeg","mp3","mp2","mp2a","mpga","m2a","m3a"),zK=ne("mpeg4-generic"),jK=ne("musepack"),GK=ne("ogg","ogg","oga","spx"),XK=ne("opus"),qK=ne("parityfec"),YK=ne("pcma"),KK=ne("pcma-wb"),QK=ne("pcmu"),$K=ne("pcmu-wb"),JK=ne("prs.sid"),ZK=ne("qcelp"),eQ=ne("raptorfec"),tQ=ne("red"),nQ=ne("rtp-enc-aescm128"),iQ=ne("rtp-midi"),rQ=ne("rtploopback"),oQ=ne("rtx"),sQ=ne("s3m","s3m"),aQ=ne("silk","sil"),lQ=ne("smv"),cQ=ne("smv-qcp"),uQ=ne("smv0"),pQ=ne("sp-midi"),dQ=ne("speex"),hQ=ne("t140c"),mQ=ne("t38"),fQ=ne("telephone-event"),gQ=ne("tetra_acelp"),xQ=ne("tetra_acelp_bb"),wQ=ne("tone"),FQ=ne("uemclip"),AQ=ne("ulpfec"),vQ=ne("usac"),bQ=ne("vdvi"),SQ=ne("1d-interleaved-parityfec"),_Q=ne("32kadpcm"),yQ=ne("3gpp"),TQ=ne("3gpp2"),EQ=ne("vnd.3gpp.iufp"),kQ=ne("vnd.4sb"),MQ=ne("vnd.audiokoz"),DQ=ne("vnd.celp"),CQ=ne("vnd.cisco.nse"),LQ=ne("vnd.cmles.radio-events"),PQ=ne("vnd.cns.anp1"),RQ=ne("vnd.cns.inf1"),IQ=ne("vnd.dece.audio","uva","uvva"),BQ=ne("vnd.digital-winds","eol"),VQ=ne("vnd.dlna.adts"),OQ=ne("vnd.dolby.heaac.1"),NQ=ne("vnd.dolby.heaac.2"),WQ=ne("vnd.dolby.mlp"),HQ=ne("vnd.dolby.mps"),UQ=ne("vnd.dolby.pl2"),zQ=ne("vnd.dolby.pl2x"),jQ=ne("vnd.dolby.pl2z"),GQ=ne("vnd.dolby.pulse.1"),XQ=ne("vnd.dra","dra"),qQ=ne("vnd.dts","dts"),YQ=ne("vnd.dts.hd","dtshd"),KQ=ne("vnd.dts.uhd"),QQ=ne("vnd.dvb.file"),$Q=ne("vnd.everad.plj"),JQ=ne("vnd.hns.audio"),ZQ=ne("vnd.lucent.voice","lvp"),e$=ne("vnd.ms-playready.media.pya","pya"),t$=ne("vnd.nokia.mobile-xmf"),n$=ne("vnd.nortel.vbk"),i$=ne("vnd.nuera.ecelp4800","ecelp4800"),r$=ne("vnd.nuera.ecelp7470","ecelp7470"),o$=ne("vnd.nuera.ecelp9600","ecelp9600"),s$=ne("vnd.octel.sbc"),a$=ne("vnd.presonus.multitrack"),l$=ne("vnd.qcelp").deprecate("in favor of audio/qcelp"),c$=ne("vnd.rhetorex.32kadpcm"),u$=ne("vnd.rip","rip"),p$=ne("vnd.rn-realaudio"),d$=ne("vnd.sealedmedia.softseal.mpeg"),h$=ne("vnd.vmx.cvsd"),m$=ne("vnd.wave","wav"),f$=ne("vmr-wb"),g$=ne("vorbis"),x$=ne("vorbis-config"),w$=ne("wav","wav"),F$=ne("wave","wav"),kc=ne("webm","weba","webm"),A$=ne("webm; codec=opus","weba"),v$=ne("x-aac","aac"),b$=ne("x-aiff","aif","aiff","aifc"),S$=ne("x-caf","caf"),_$=ne("x-flac","flac"),y$=ne("x-matroska","mka"),T$=ne("x-mpegurl","m3u"),E$=ne("x-ms-wax","wax"),k$=ne("x-ms-wma","wma"),M$=ne("x-pn-realaudio","ram","ra"),D$=ne("x-pn-realaudio-plugin","rmp"),C$=ne("x-tta"),L$=ne("x-wav","wav"),P$=ne("xm","xm");var Ig={};ti(Ig,{Chemical_X_Cdx:()=>R$,Chemical_X_Cif:()=>I$,Chemical_X_Cmdf:()=>B$,Chemical_X_Cml:()=>V$,Chemical_X_Csml:()=>O$,Chemical_X_Pdb:()=>N$,Chemical_X_Xyz:()=>W$});var Ss=Wt("chemical"),R$=Ss("x-cdx","cdx"),I$=Ss("x-cif","cif"),B$=Ss("x-cmdf","cmdf"),V$=Ss("x-cml","cml"),O$=Ss("x-csml","csml"),N$=Ss("x-pdb"),W$=Ss("x-xyz","xyz");var Bg={};ti(Bg,{Font_Collection:()=>H$,Font_Otf:()=>U$,Font_Sfnt:()=>z$,Font_Ttf:()=>j$,Font_Woff:()=>G$,Font_Woff2:()=>X$});var ya=Wt("font"),H$=ya("collection","ttc"),U$=ya("otf","otf"),z$=ya("sfnt"),j$=ya("ttf","ttf"),G$=ya("woff","woff"),X$=ya("woff2","woff2");var Vg={};ti(Vg,{Image_Aces:()=>q$,Image_Apng:()=>Y$,Image_Avci:()=>K$,Image_Avcs:()=>Q$,Image_Avif:()=>$$,Image_Bmp:()=>J$,Image_Cgm:()=>Z$,Image_Dicom_Rle:()=>eJ,Image_EXR:()=>iJ,Image_Emf:()=>tJ,Image_Example:()=>nJ,Image_Fits:()=>rJ,Image_G3fax:()=>oJ,Image_Gif:()=>sJ,Image_Heic:()=>aJ,Image_Heic_Sequence:()=>lJ,Image_Heif:()=>cJ,Image_Heif_Sequence:()=>uJ,Image_Hej2k:()=>pJ,Image_Hsj2:()=>dJ,Image_Ief:()=>hJ,Image_Jls:()=>mJ,Image_Jp2:()=>fJ,Image_Jpeg:()=>yr,Image_Jph:()=>gJ,Image_Jphc:()=>xJ,Image_Jpm:()=>wJ,Image_Jpx:()=>FJ,Image_Jxr:()=>AJ,Image_JxrA:()=>vJ,Image_JxrS:()=>bJ,Image_Jxs:()=>SJ,Image_Jxsc:()=>_J,Image_Jxsi:()=>yJ,Image_Jxss:()=>TJ,Image_Ktx:()=>EJ,Image_Naplps:()=>kJ,Image_Pjpeg:()=>MJ,Image_Png:()=>Tr,Image_PrsBtif:()=>DJ,Image_PrsPti:()=>CJ,Image_Pwg_Raster:()=>LJ,Image_Raw:()=>PJ,Image_Sgi:()=>RJ,Image_SvgXml:()=>IJ,Image_T38:()=>BJ,Image_Tiff:()=>VJ,Image_Tiff_Fx:()=>OJ,Image_Vendor_AdobePhotoshop:()=>NJ,Image_Vendor_AirzipAcceleratorAzv:()=>WJ,Image_Vendor_CnsInf2:()=>HJ,Image_Vendor_DeceGraphic:()=>UJ,Image_Vendor_Djvu:()=>zJ,Image_Vendor_DvbSubtitle:()=>jJ,Image_Vendor_Dwg:()=>GJ,Image_Vendor_Dxf:()=>XJ,Image_Vendor_Fastbidsheet:()=>qJ,Image_Vendor_Fpx:()=>YJ,Image_Vendor_Fst:()=>KJ,Image_Vendor_FujixeroxEdmics_Mmr:()=>QJ,Image_Vendor_FujixeroxEdmics_Rlc:()=>$J,Image_Vendor_GlobalgraphicsPgb:()=>JJ,Image_Vendor_MicrosoftIcon:()=>ZJ,Image_Vendor_Mix:()=>eZ,Image_Vendor_MozillaApng:()=>tZ,Image_Vendor_Ms_Dds:()=>nZ,Image_Vendor_Ms_Modi:()=>iZ,Image_Vendor_Ms_Photo:()=>rZ,Image_Vendor_Net_Fpx:()=>oZ,Image_Vendor_Radiance:()=>sZ,Image_Vendor_SealedPng:()=>cZ,Image_Vendor_SealedmediaSoftsealGif:()=>aZ,Image_Vendor_SealedmediaSoftsealJpg:()=>lZ,Image_Vendor_Svf:()=>uZ,Image_Vendor_TencentTap:()=>pZ,Image_Vendor_ValveSourceTexture:()=>dZ,Image_Vendor_WapWbmp:()=>hZ,Image_Vendor_Xiff:()=>mZ,Image_Vendor_ZbrushPcx:()=>fZ,Image_Webp:()=>gZ,Image_Wmf:()=>xZ,Image_X_3ds:()=>wZ,Image_X_Cmu_Raster:()=>FZ,Image_X_Cmx:()=>AZ,Image_X_Emf:()=>vZ,Image_X_Freehand:()=>bZ,Image_X_Icon:()=>SZ,Image_X_Mrsid_Image:()=>_Z,Image_X_Ms_Bmp:()=>yZ,Image_X_Pcx:()=>TZ,Image_X_Pict:()=>EZ,Image_X_Portable_Anymap:()=>kZ,Image_X_Portable_Bitmap:()=>MZ,Image_X_Portable_Graymap:()=>DZ,Image_X_Portable_Pixmap:()=>CZ,Image_X_Rgb:()=>LZ,Image_X_Tga:()=>PZ,Image_X_Wmf:()=>RZ,Image_X_Xbitmap:()=>IZ,Image_X_Xcf:()=>BZ,Image_X_Xpixmap:()=>VZ,Image_X_Xwindowdump:()=>OZ});var be=Wt("image"),q$=be("aces"),Y$=be("apng","apng"),K$=be("avci"),Q$=be("avcs"),$$=be("avif","avif"),J$=be("bmp","bmp"),Z$=be("cgm","cgm"),eJ=be("dicom-rle"),tJ=be("emf"),nJ=be("example"),iJ=be("x-exr","exr"),rJ=be("fits"),oJ=be("g3fax","g3"),sJ=be("gif","gif"),aJ=be("heic"),lJ=be("heic-sequence"),cJ=be("heif"),uJ=be("heif-sequence"),pJ=be("hej2k"),dJ=be("hsj2"),hJ=be("ief","ief"),mJ=be("jls"),fJ=be("jp2"),yr=be("jpeg","jpeg","jpg","jpe"),gJ=be("jph"),xJ=be("jphc"),wJ=be("jpm"),FJ=be("jpx"),AJ=be("jxr"),vJ=be("jxra"),bJ=be("jxrs"),SJ=be("jxs"),_J=be("jxsc"),yJ=be("jxsi"),TJ=be("jxss"),EJ=be("ktx","ktx"),kJ=be("naplps"),MJ=be("pjpeg"),Tr=be("png","png"),DJ=be("prs.btif","btif"),CJ=be("prs.pti"),LJ=be("pwg-raster"),PJ=be("x-raw","raw"),RJ=be("sgi","sgi"),IJ=be("svg+xml","svg","svgz"),BJ=be("t38"),VJ=be("tiff","tiff","tif"),OJ=be("tiff-fx"),NJ=be("vnd.adobe.photoshop","psd"),WJ=be("vnd.airzip.accelerator.azv"),HJ=be("vnd.cns.inf2"),UJ=be("vnd.dece.graphic","uvi","uvvi","uvg","uvvg"),zJ=be("vnd.djvu","djvu","djv"),jJ=be("vnd.dvb.subtitle","sub"),GJ=be("vnd.dwg","dwg"),XJ=be("vnd.dxf","dxf"),qJ=be("vnd.fastbidsheet","fbs"),YJ=be("vnd.fpx","fpx"),KJ=be("vnd.fst","fst"),QJ=be("vnd.fujixerox.edmics-mmr","mmr"),$J=be("vnd.fujixerox.edmics-rlc","rlc"),JJ=be("vnd.globalgraphics.pgb"),ZJ=be("vnd.microsoft.icon","ico"),eZ=be("vnd.mix"),tZ=be("vnd.mozilla.apng"),nZ=be("vnd.ms-dds","dds"),iZ=be("vnd.ms-modi","mdi"),rZ=be("vnd.ms-photo","wdp"),oZ=be("vnd.net-fpx","npx"),sZ=be("vnd.radiance"),aZ=be("vnd.sealedmedia.softseal.gif"),lZ=be("vnd.sealedmedia.softseal.jpg"),cZ=be("vnd.sealed.png"),uZ=be("vnd.svf"),pZ=be("vnd.tencent.tap"),dZ=be("vnd.valve.source.texture"),hZ=be("vnd.wap.wbmp","wbmp"),mZ=be("vnd.xiff","xif"),fZ=be("vnd.zbrush.pcx"),gZ=be("webp","webp"),xZ=be("wmf"),wZ=be("x-3ds","3ds"),FZ=be("x-cmu-raster","ras"),AZ=be("x-cmx","cmx"),vZ=be("x-emf").deprecate("in favor of image/emf"),bZ=be("x-freehand","fh","fhc","fh4","fh5","fh7"),SZ=be("x-icon","ico"),_Z=be("x-mrsid-image","sid"),yZ=be("x-ms-bmp"),TZ=be("x-pcx","pcx"),EZ=be("x-pict","pic","pct"),kZ=be("x-portable-anymap","pnm"),MZ=be("x-portable-bitmap","pbm"),DZ=be("x-portable-graymap","pgm"),CZ=be("x-portable-pixmap","ppm"),LZ=be("x-rgb","rgb"),PZ=be("x-tga","tga"),RZ=be("x-wmf").deprecate("in favor of image/wmf"),IZ=be("x-xbitmap","xbm"),BZ=be("x-xcf"),VZ=be("x-xpixmap","xpm"),OZ=be("x-xwindowdump","xwd");var Og={};ti(Og,{Message_CPIM:()=>NZ,Message_Delivery_Status:()=>WZ,Message_Disposition_Notification:()=>HZ,Message_Example:()=>UZ,Message_External_Body:()=>zZ,Message_Feedback_Report:()=>jZ,Message_Global:()=>GZ,Message_Global_Delivery_Status:()=>XZ,Message_Global_Disposition_Notification:()=>qZ,Message_Global_Headers:()=>YZ,Message_Http:()=>KZ,Message_ImdnXml:()=>QZ,Message_News:()=>$Z,Message_Partial:()=>JZ,Message_Rfc822:()=>ZZ,Message_S_Http:()=>eee,Message_Sip:()=>tee,Message_Sipfrag:()=>nee,Message_Tracking_Status:()=>iee,Message_Vendor_SiSimp:()=>ree,Message_Vendor_WfaWsc:()=>oee});var dn=Wt("message"),NZ=dn("cpim"),WZ=dn("delivery-status"),HZ=dn("disposition-notification"),UZ=dn("example"),zZ=dn("external-body"),jZ=dn("feedback-report"),GZ=dn("global"),XZ=dn("global-delivery-status"),qZ=dn("global-disposition-notification"),YZ=dn("global-headers"),KZ=dn("http"),QZ=dn("imdn+xml","xml"),$Z=dn("news").deprecate("by RFC5537"),JZ=dn("partial"),ZZ=dn("rfc822","eml","mime"),eee=dn("s-http"),tee=dn("sip"),nee=dn("sipfrag"),iee=dn("tracking-status"),ree=dn("vnd.si.simp").deprecate("by request"),oee=dn("vnd.wfa.wsc");var Ng={};ti(Ng,{Model_Example:()=>see,Model_Gltf_Binary:()=>Er,Model_Gltf_Json:()=>Mc,Model_Iges:()=>aee,Model_Mesh:()=>lee,Model_Stl:()=>cee,Model_Vendor_3mf:()=>uee,Model_Vendor_ColladaXml:()=>pee,Model_Vendor_Dwf:()=>dee,Model_Vendor_Flatland3dml:()=>hee,Model_Vendor_Gdl:()=>mee,Model_Vendor_GsGdl:()=>gee,Model_Vendor_Gs_Gdl:()=>fee,Model_Vendor_Gtw:()=>xee,Model_Vendor_MomlXml:()=>wee,Model_Vendor_Mts:()=>Fee,Model_Vendor_Opengex:()=>Aee,Model_Vendor_ParasolidTransmitBinary:()=>vee,Model_Vendor_ParasolidTransmitText:()=>bee,Model_Vendor_RosetteAnnotated_Data_Model:()=>See,Model_Vendor_UsdzZip:()=>_ee,Model_Vendor_ValveSourceCompiled_Map:()=>yee,Model_Vendor_Vtu:()=>Tee,Model_Vrml:()=>Eee,Model_X3dBinary:()=>Mee,Model_X3dFastinfoset:()=>Dee,Model_X3dVrml:()=>Cee,Model_X3dXml:()=>Lee,Model_X3d_Vrml:()=>kee});var Dt=Wt("model"),see=Dt("example"),Er=Dt("gltf-binary","glb"),Mc=Dt("gltf+json","gltf"),aee=Dt("iges","igs","iges"),lee=Dt("mesh","msh","mesh","silo"),cee=Dt("stl"),uee=Dt("3mf"),pee=Dt("vnd.collada+xml","dae"),dee=Dt("vnd.dwf","dwf"),hee=Dt("vnd.flatland.3dml"),mee=Dt("vnd.gdl","gdl"),fee=Dt("vnd.gs-gdl"),gee=Dt("vnd.gs.gdl"),xee=Dt("vnd.gtw","gtw"),wee=Dt("vnd.moml+xml","xml"),Fee=Dt("vnd.mts","mts"),Aee=Dt("vnd.opengex"),vee=Dt("vnd.parasolid.transmit.binary"),bee=Dt("vnd.parasolid.transmit.text"),See=Dt("vnd.rosette.annotated-data-model"),_ee=Dt("vnd.usdz+zip","zip"),yee=Dt("vnd.valve.source.compiled-map"),Tee=Dt("vnd.vtu","vtu"),Eee=Dt("vrml","wrl","vrml"),kee=Dt("x3d-vrml"),Mee=Dt("x3d+binary","x3db","x3dbz"),Dee=Dt("x3d+fastinfoset","fastinfoset"),Cee=Dt("x3d+vrml","x3dv","x3dvz"),Lee=Dt("x3d+xml","x3d","x3dz");var Wg={};ti(Wg,{MultipartAlternative:()=>Pee,MultipartAppledouble:()=>Ree,MultipartByteranges:()=>Iee,MultipartDigest:()=>Bee,MultipartEncrypted:()=>Vee,MultipartExample:()=>Oee,MultipartForm_Data:()=>Nee,MultipartHeader_Set:()=>Wee,MultipartMixed:()=>Hee,MultipartMultilingual:()=>Uee,MultipartParallel:()=>zee,MultipartRelated:()=>jee,MultipartReport:()=>Gee,MultipartSigned:()=>Xee,MultipartVendorBintMed_Plus:()=>qee,MultipartVoice_Message:()=>Yee,MultipartX_Mixed_Replace:()=>Kee});var Hn=Wt("multipart"),Pee=Hn("alternative"),Ree=Hn("appledouble"),Iee=Hn("byteranges"),Bee=Hn("digest"),Vee=Hn("encrypted"),Oee=Hn("example"),Nee=Hn("form-data"),Wee=Hn("header-set"),Hee=Hn("mixed"),Uee=Hn("multilingual"),zee=Hn("parallel"),jee=Hn("related"),Gee=Hn("report"),Xee=Hn("signed"),qee=Hn("vnd.bint.med-plus"),Yee=Hn("voice-message"),Kee=Hn("x-mixed-replace");var zg={};ti(zg,{Text_Cache_Manifest:()=>Qee,Text_Calendar:()=>$ee,Text_Calender:()=>Jee,Text_Cmd:()=>Zee,Text_Coffeescript:()=>ete,Text_Css:()=>_s,Text_Csv:()=>tte,Text_Csv_Schema:()=>nte,Text_Directory:()=>ite,Text_Dns:()=>rte,Text_Ecmascript:()=>ote,Text_Encaprtp:()=>ste,Text_Enriched:()=>ate,Text_Event_Stream:()=>lte,Text_Example:()=>cte,Text_Flexfec:()=>ute,Text_Fwdred:()=>pte,Text_Grammar_Ref_List:()=>dte,Text_Html:()=>Hg,Text_Jade:()=>hte,Text_Javascript:()=>mte,Text_Jcr_Cnd:()=>fte,Text_Jsx:()=>gte,Text_Less:()=>xte,Text_Markdown:()=>wte,Text_Mdx:()=>Fte,Text_Mizar:()=>Ate,Text_N3:()=>vte,Text_Parameters:()=>bte,Text_Parityfec:()=>Ste,Text_Plain:()=>eo,Text_PlainUTF8:()=>_te,Text_Provenance_Notation:()=>yte,Text_PrsFallensteinRst:()=>Tte,Text_PrsLinesTag:()=>Ete,Text_PrsPropLogic:()=>kte,Text_RED:()=>Dte,Text_Raptorfec:()=>Mte,Text_Rfc822_Headers:()=>Cte,Text_Richtext:()=>Lte,Text_Rtf:()=>Pte,Text_Rtp_Enc_Aescm128:()=>Rte,Text_Rtploopback:()=>Ite,Text_Rtx:()=>Bte,Text_Sgml:()=>Vte,Text_Shex:()=>Ote,Text_Slim:()=>Nte,Text_Strings:()=>Wte,Text_Stylus:()=>Hte,Text_T140:()=>Ute,Text_Tab_Separated_Values:()=>zte,Text_Troff:()=>jte,Text_Turtle:()=>Gte,Text_Ulpfec:()=>Xte,Text_Uri_List:()=>qte,Text_Vcard:()=>Yte,Text_Vendor_1d_Interleaved_Parityfec:()=>Kte,Text_Vendor_A:()=>Qte,Text_Vendor_Abc:()=>$te,Text_Vendor_Ascii_Art:()=>Jte,Text_Vendor_Curl:()=>Zte,Text_Vendor_CurlDcurl:()=>ene,Text_Vendor_CurlMcurl:()=>tne,Text_Vendor_CurlScurl:()=>nne,Text_Vendor_DMClientScript:()=>rne,Text_Vendor_DebianCopyright:()=>ine,Text_Vendor_DvbSubtitle:()=>one,Text_Vendor_EsmertecTheme_Descriptor:()=>sne,Text_Vendor_FiclabFlt:()=>ane,Text_Vendor_Fly:()=>lne,Text_Vendor_FmiFlexstor:()=>cne,Text_Vendor_Gml:()=>une,Text_Vendor_Graphviz:()=>pne,Text_Vendor_Hgl:()=>dne,Text_Vendor_IPTCNITF:()=>gne,Text_Vendor_IPTCNewsML:()=>fne,Text_Vendor_In3d3dml:()=>hne,Text_Vendor_In3dSpot:()=>mne,Text_Vendor_Latex_Z:()=>xne,Text_Vendor_MotorolaReflex:()=>wne,Text_Vendor_Ms_Mediapackage:()=>Fne,Text_Vendor_Net2phoneCommcenterCommand:()=>Ane,Text_Vendor_RadisysMsml_Basic_Layout:()=>vne,Text_Vendor_SenxWarpscript:()=>bne,Text_Vendor_SiUricatalogue:()=>Sne,Text_Vendor_Sosi:()=>_ne,Text_Vendor_SunJ2meApp_Descriptor:()=>yne,Text_Vendor_TrolltechLinguist:()=>Tne,Text_Vendor_WapSi:()=>Ene,Text_Vendor_WapSl:()=>kne,Text_Vendor_WapWml:()=>Mne,Text_Vendor_WapWmlscript:()=>Dne,Text_Vtt:()=>Cne,Text_X_Asm:()=>Lne,Text_X_C:()=>Pne,Text_X_Fortran:()=>Rne,Text_X_Gwt_Rpc:()=>Ine,Text_X_Handlebars_Template:()=>Bne,Text_X_Java_Source:()=>Vne,Text_X_Jquery_Tmpl:()=>One,Text_X_Lua:()=>Nne,Text_X_Markdown:()=>Wne,Text_X_Nfo:()=>Hne,Text_X_Opml:()=>Une,Text_X_Org:()=>zne,Text_X_Pascal:()=>jne,Text_X_Processing:()=>Gne,Text_X_Sass:()=>Xne,Text_X_Scss:()=>qne,Text_X_Setext:()=>Yne,Text_X_Sfv:()=>Kne,Text_X_Suse_Ymp:()=>Qne,Text_X_Uuencode:()=>$ne,Text_X_Vcalendar:()=>Jne,Text_X_Vcard:()=>Zne,Text_Xml:()=>Ug,Text_Xml_External_Parsed_Entity:()=>eie,Text_Yaml:()=>tie});var fe=Wt("text"),Qee=fe("cache-manifest","appcache"),$ee=fe("calendar","ics","ifb"),Jee=fe("calender"),Zee=fe("cmd"),ete=fe("coffeescript","coffee","litcoffee"),_s=fe("css","css"),tte=fe("csv","csv"),nte=fe("csv-schema"),ite=fe("directory").deprecate("by RFC6350"),rte=fe("dns"),ote=fe("ecmascript").deprecate("in favor of application/ecmascript"),ste=fe("encaprtp"),ate=fe("enriched"),lte=fe("event-stream"),cte=fe("example"),ute=fe("flexfec"),pte=fe("fwdred"),dte=fe("grammar-ref-list"),Hg=fe("html","html","htm"),hte=fe("jade","jade"),mte=fe("javascript").deprecate("in favor of application/javascript"),fte=fe("jcr-cnd"),gte=fe("jsx","jsx"),xte=fe("less","less"),wte=fe("markdown"),Fte=fe("mdx","mdx"),Ate=fe("mizar"),vte=fe("n3","n3"),bte=fe("parameters"),Ste=fe("parityfec"),eo=fe("plain","txt","text","conf","def","list","log","in"),_te=fe("plain; charset=UTF-8","txt","text","conf","def","list","log","in"),yte=fe("provenance-notation"),Tte=fe("prs.fallenstein.rst"),Ete=fe("prs.lines.tag","dsc"),kte=fe("prs.prop.logic"),Mte=fe("raptorfec"),Dte=fe("red"),Cte=fe("rfc822-headers"),Lte=fe("richtext","rtx"),Pte=fe("rtf"),Rte=fe("rtp-enc-aescm128"),Ite=fe("rtploopback"),Bte=fe("rtx"),Vte=fe("sgml","sgml","sgm"),Ote=fe("shex","shex"),Nte=fe("slim","slim","slm"),Wte=fe("strings"),Hte=fe("stylus","stylus","styl"),Ute=fe("t140"),zte=fe("tab-separated-values","tsv"),jte=fe("troff","t","tr","roff","man","me","ms"),Gte=fe("turtle","ttl"),Xte=fe("ulpfec"),qte=fe("uri-list","uri","uris","urls"),Yte=fe("vcard","vcard"),Kte=fe("1d-interleaved-parityfec"),Qte=fe("vnd.a"),$te=fe("vnd.abc"),Jte=fe("vnd.ascii-art"),Zte=fe("vnd.curl","curl"),ene=fe("vnd.curl.dcurl","dcurl"),tne=fe("vnd.curl.mcurl","mcurl"),nne=fe("vnd.curl.scurl","scurl"),ine=fe("vnd.debian.copyright"),rne=fe("vnd.dmclientscript"),one=fe("vnd.dvb.subtitle","sub"),sne=fe("vnd.esmertec.theme-descriptor"),ane=fe("vnd.ficlab.flt"),lne=fe("vnd.fly","fly"),cne=fe("vnd.fmi.flexstor","flx"),une=fe("vnd.gml"),pne=fe("vnd.graphviz","gv"),dne=fe("vnd.hgl"),hne=fe("vnd.in3d.3dml","3dml"),mne=fe("vnd.in3d.spot","spot"),fne=fe("vnd.iptc.newsml"),gne=fe("vnd.iptc.nitf"),xne=fe("vnd.latex-z"),wne=fe("vnd.motorola.reflex"),Fne=fe("vnd.ms-mediapackage"),Ane=fe("vnd.net2phone.commcenter.command"),vne=fe("vnd.radisys.msml-basic-layout"),bne=fe("vnd.senx.warpscript"),Sne=fe("vnd.si.uricatalogue").deprecate("by request"),_ne=fe("vnd.sosi"),yne=fe("vnd.sun.j2me.app-descriptor","jad"),Tne=fe("vnd.trolltech.linguist"),Ene=fe("vnd.wap.si"),kne=fe("vnd.wap.sl"),Mne=fe("vnd.wap.wml","wml"),Dne=fe("vnd.wap.wmlscript","wmls"),Cne=fe("vtt"),Lne=fe("x-asm","s","asm"),Pne=fe("x-c","c","cc","cxx","cpp","h","hh","dic"),Rne=fe("x-fortran","f","for","f77","f90"),Ine=fe("x-gwt-rpc"),Bne=fe("x-handlebars-template","hbs"),Vne=fe("x-java-source","java"),One=fe("x-jquery-tmpl"),Nne=fe("x-lua","lua"),Wne=fe("x-markdown","mkd"),Hne=fe("x-nfo","nfo"),Une=fe("x-opml","opml"),zne=fe("x-org","org"),jne=fe("x-pascal","p","pas"),Gne=fe("x-processing","pde"),Xne=fe("x-sass","sass"),qne=fe("x-scss","scss"),Yne=fe("x-setext","etx"),Kne=fe("x-sfv","sfv"),Qne=fe("x-suse-ymp","ymp"),$ne=fe("x-uuencode","uu"),Jne=fe("x-vcalendar","vcs"),Zne=fe("x-vcard","vcf"),Ug=fe("xml"),eie=fe("xml-external-parsed-entity"),tie=fe("yaml","yaml","yml");var Yg={};ti(Yg,{Video_BMPEG:()=>nie,Video_BT656:()=>iie,Video_CelB:()=>rie,Video_DV:()=>oie,Video_Encaprtp:()=>sie,Video_Example:()=>aie,Video_Flexfec:()=>lie,Video_H261:()=>cie,Video_H263:()=>uie,Video_H263_1998:()=>pie,Video_H263_2000:()=>die,Video_H264:()=>hie,Video_H264_RCDO:()=>mie,Video_H264_SVC:()=>fie,Video_H265:()=>gie,Video_IsoSegment:()=>xie,Video_JPEG:()=>wie,Video_Jpeg2000:()=>Fie,Video_Jpm:()=>Aie,Video_MP1S:()=>bie,Video_MP2P:()=>Sie,Video_MP2T:()=>_ie,Video_MP4V_ES:()=>yie,Video_MPV:()=>Eie,Video_Mj2:()=>vie,Video_Mp4:()=>jg,Video_Mpeg:()=>Gg,Video_Mpeg4_Generic:()=>Tie,Video_Nv:()=>kie,Video_Ogg:()=>Mie,Video_Parityfec:()=>Die,Video_Pointer:()=>Cie,Video_Quicktime:()=>Lie,Video_Raptorfec:()=>Pie,Video_Raw:()=>Rie,Video_Rtp_Enc_Aescm128:()=>Iie,Video_Rtploopback:()=>Bie,Video_Rtx:()=>Vie,Video_SMPTE292M:()=>Nie,Video_Smpte291:()=>Oie,Video_Ulpfec:()=>Wie,Video_VP8:()=>Mre,Video_Vc1:()=>Hie,Video_Vc2:()=>Uie,Video_Vendor_1d_Interleaved_Parityfec:()=>zie,Video_Vendor_3gpp:()=>jie,Video_Vendor_3gpp2:()=>Xie,Video_Vendor_3gpp_Tt:()=>Gie,Video_Vendor_CCTV:()=>qie,Video_Vendor_DeceHd:()=>Yie,Video_Vendor_DeceMobile:()=>Kie,Video_Vendor_DeceMp4:()=>Qie,Video_Vendor_DecePd:()=>$ie,Video_Vendor_DeceSd:()=>Jie,Video_Vendor_DeceVideo:()=>Zie,Video_Vendor_DirectvMpeg:()=>ere,Video_Vendor_DirectvMpeg_Tts:()=>tre,Video_Vendor_DlnaMpeg_Tts:()=>nre,Video_Vendor_DvbFile:()=>ire,Video_Vendor_Fvt:()=>rre,Video_Vendor_HnsVideo:()=>ore,Video_Vendor_Iptvforum1dparityfec_1010:()=>sre,Video_Vendor_Iptvforum1dparityfec_2005:()=>are,Video_Vendor_Iptvforum2dparityfec_1010:()=>lre,Video_Vendor_Iptvforum2dparityfec_2005:()=>cre,Video_Vendor_IptvforumTtsavc:()=>ure,Video_Vendor_IptvforumTtsmpeg2:()=>pre,Video_Vendor_MotorolaVideo:()=>dre,Video_Vendor_MotorolaVideop:()=>hre,Video_Vendor_Mpeg_Dash_Mpd:()=>Xg,Video_Vendor_Mpegurl:()=>mre,Video_Vendor_Ms_PlayreadyMediaPyv:()=>fre,Video_Vendor_NokiaInterleaved_Multimedia:()=>gre,Video_Vendor_NokiaMp4vr:()=>xre,Video_Vendor_NokiaVideovoip:()=>wre,Video_Vendor_Objectvideo:()=>Fre,Video_Vendor_RadgamettoolsBink:()=>Are,Video_Vendor_RadgamettoolsSmacker:()=>vre,Video_Vendor_SealedMpeg1:()=>Sre,Video_Vendor_SealedMpeg4:()=>_re,Video_Vendor_SealedSwf:()=>yre,Video_Vendor_SealedmediaSoftsealMov:()=>bre,Video_Vendor_UvvuMp4:()=>Tre,Video_Vendor_Vivo:()=>Ere,Video_Vendor_YoutubeYt:()=>kre,Video_Webm:()=>qg,Video_X_F4v:()=>Dre,Video_X_Fli:()=>Cre,Video_X_Flv:()=>Lre,Video_X_M4v:()=>Pre,Video_X_Matroska:()=>Rre,Video_X_Mng:()=>Ire,Video_X_Ms_Asf:()=>Bre,Video_X_Ms_Vob:()=>Vre,Video_X_Ms_Wm:()=>Ore,Video_X_Ms_Wmv:()=>Nre,Video_X_Ms_Wmx:()=>Wre,Video_X_Ms_Wvx:()=>Hre,Video_X_Msvideo:()=>Ure,Video_X_Sgi_Movie:()=>zre,Video_X_Smv:()=>jre});var ye=Wt("video"),nie=ye("bmpeg"),iie=ye("bt656"),rie=ye("celb"),oie=ye("dv"),sie=ye("encaprtp"),aie=ye("example"),lie=ye("flexfec"),cie=ye("h261","h261"),uie=ye("h263","h263"),pie=ye("h263-1998"),die=ye("h263-2000"),hie=ye("h264","h264"),mie=ye("h264-rcdo"),fie=ye("h264-svc"),gie=ye("h265"),xie=ye("iso.segment"),wie=ye("jpeg","jpgv"),Fie=ye("jpeg2000"),Aie=ye("jpm","jpm","jpgm"),vie=ye("mj2","mj2","mjp2"),bie=ye("mp1s"),Sie=ye("mp2p"),_ie=ye("mp2t"),jg=ye("mp4","mp4","mp4v","mpg4"),yie=ye("mp4v-es"),Gg=ye("mpeg","mpeg","mpg","mpe","m1v","m2v"),Tie=ye("mpeg4-generic"),Eie=ye("mpv"),kie=ye("nv"),Mie=ye("ogg","ogv"),Die=ye("parityfec"),Cie=ye("pointer"),Lie=ye("quicktime","qt","mov"),Pie=ye("raptorfec"),Rie=ye("raw"),Iie=ye("rtp-enc-aescm128"),Bie=ye("rtploopback"),Vie=ye("rtx"),Oie=ye("smpte291"),Nie=ye("smpte292m"),Wie=ye("ulpfec"),Hie=ye("vc1"),Uie=ye("vc2"),zie=ye("1d-interleaved-parityfec"),jie=ye("3gpp","3gp"),Gie=ye("3gpp-tt"),Xie=ye("3gpp2","3g2"),qie=ye("vnd.cctv"),Yie=ye("vnd.dece.hd","uvh","uvvh"),Kie=ye("vnd.dece.mobile","uvm","uvvm"),Qie=ye("vnd.dece.mp4"),$ie=ye("vnd.dece.pd","uvp","uvvp"),Jie=ye("vnd.dece.sd","uvs","uvvs"),Zie=ye("vnd.dece.video","uvv","uvvv"),ere=ye("vnd.directv.mpeg"),tre=ye("vnd.directv.mpeg-tts"),nre=ye("vnd.dlna.mpeg-tts"),ire=ye("vnd.dvb.file","dvb"),rre=ye("vnd.fvt","fvt"),ore=ye("vnd.hns.video"),sre=ye("vnd.iptvforum.1dparityfec-1010"),are=ye("vnd.iptvforum.1dparityfec-2005"),lre=ye("vnd.iptvforum.2dparityfec-1010"),cre=ye("vnd.iptvforum.2dparityfec-2005"),ure=ye("vnd.iptvforum.ttsavc"),pre=ye("vnd.iptvforum.ttsmpeg2"),dre=ye("vnd.motorola.video"),hre=ye("vnd.motorola.videop"),mre=ye("vnd.mpegurl","mxu","m4u"),fre=ye("vnd.ms-playready.media.pyv","pyv"),gre=ye("vnd.nokia.interleaved-multimedia"),xre=ye("vnd.nokia.mp4vr"),wre=ye("vnd.nokia.videovoip"),Fre=ye("vnd.objectvideo"),Are=ye("vnd.radgamettools.bink"),vre=ye("vnd.radgamettools.smacker"),bre=ye("vnd.sealedmedia.softseal.mov"),Sre=ye("vnd.sealed.mpeg1"),_re=ye("vnd.sealed.mpeg4"),yre=ye("vnd.sealed.swf"),Tre=ye("vnd.uvvu.mp4","uvu","uvvu"),Ere=ye("vnd.vivo","viv"),kre=ye("vnd.youtube.yt"),Xg=ye("vnd.mpeg.dash.mpd","mpd"),Mre=ye("vp8"),qg=ye("webm","webm"),Dre=ye("x-f4v","f4v"),Cre=ye("x-fli","fli"),Lre=ye("x-flv","flv"),Pre=ye("x-m4v","m4v"),Rre=ye("x-matroska","mkv","mk3d","mks"),Ire=ye("x-mng","mng"),Bre=ye("x-ms-asf","asf","asx"),Vre=ye("x-ms-vob","vob"),Ore=ye("x-ms-wm","wm"),Nre=ye("x-ms-wmv","wmv"),Wre=ye("x-ms-wmx","wmx"),Hre=ye("x-ms-wvx","wvx"),Ure=ye("x-msvideo","avi"),zre=ye("x-sgi-movie","movie"),jre=ye("x-smv","smv");var Kg={};ti(Kg,{XConference_XCooltalk:()=>Xre});var Gre=Wt("xconference"),Xre=Gre("x-cooltalk","ice");var Qg={};ti(Qg,{XShader_XFragment:()=>Yre,XShader_XVertex:()=>qre});var sF=Wt("x-shader"),qre=sF("x-vertex","vert","vs","glsl"),Yre=sF("x-fragment","frag","fs","glsl");var Kre="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function In(n,e){if(n<0)throw new Error("Length must be greater than 0");oe(e)&&(e=Kre);let t="";for(let i=0;i<n;++i){let r=Math.floor(Math.random()*e.length);t+=e[r]}return t}var aF=new Map,kr=class{constructor(e,t,i,...r){this.key=e,this.value=t,this.bySetAttribute=i,this.tags=r.map(o=>o.toLocaleUpperCase()),Object.freeze(this)}applyToElement(e){if(this.tags.length>0&&this.tags.indexOf(e.tagName)===-1){let t=aF.get(e.tagName);t||aF.set(e.tagName,t=new Set),t.has(this.key)||(t.add(this.key),console.warn(`Element ${e.tagName} does not support Attribute ${this.key}`))}this.bySetAttribute?e.setAttribute(this.key,this.value.toString()):this.key in e?e[this.key]=this.value:this.value===!1?e.removeAttribute(this.key):this.value===!0?e.setAttribute(this.key,""):Ke(this.value)?this.value(e):e.setAttribute(this.key,this.value.toString())}};function Qe(n,e,t,...i){return new kr(n,e,t,...i)}function Dc(n){return n instanceof kr}function lF(n){return Qe("ariaValueMax",n,!1)}function cF(n){return Qe("ariaValueMin",n,!1)}function uF(n){return Qe("ariaValueNow",n,!1)}function ko(n){return Qe("autocomplete",n,!1,"form","input","select","textarea")}function to(n){return Qe("autoplay",n,!1,"audio","video")}function yp(n){return Qe("checked",n,!1,"command","input")}function Ct(n){return Qe("className",n,!1)}function de(...n){return n=n.filter(pn),Qe("CLASS_LIST",e=>e.classList.add(...n),!1)}function $g(n){return Qe("colspan",n,!1,"td","th")}function _i(n){return Qe("controls",n,!1,"audio","video")}function qt(n,e){return Qe("data-"+n.toLowerCase(),e,!0)}function pF(n){return Qe("disabled",n,!1,"button","command","fieldset","input","keygen","optgroup","option","select","textarea")}function Jg(n){return Qe("draggable",n,!1)}function dF(n){return Qe("htmlFor",n,!1,"label","output")}function hF(n){return Qe("height",n,!1,"canvas","embed","iframe","img","input","object","video")}function mF(n){return Qe("hidden",n,!1)}function fF(n){return n instanceof Blob&&(n=URL.createObjectURL(n)),Qe("href",SF(n),!1,"a","area","base","link")}function At(n){return Qe("id",n,!1)}function gF(n){return Qe("is",n,!1)}function Tp(n){return n instanceof HTMLDataListElement&&(oe(n.id)&&(n.id=In(12)),n.isConnected||document.body.append(n),n=n.id),Qe("list",n,!0,"input")}function Mo(n){return Qe("loop",n,!1,"audio","bgsound","marquee","video")}function st(n){return Qe("max",n,!1,"input","meter","progress")}function at(n){return Qe("min",n,!1,"input","meter")}function xF(n){return Qe("multiple",n,!1,"input","select")}function Ep(n){return Qe("muted",n,!1,"audio","video")}function Do(n){return Qe("name",n,!1,"button","form","fieldset","iframe","input","keygen","map","meta","object","output","param","select","slot","textarea")}function wF(n){return Qe("open",n,!1,"details")}function bt(n){return Qe("placeholder",n,!1,"input","textarea")}function FF(n,e){let t=null;Ve(n)?(t=document,e=n):t=n;let i=t.querySelector(e);return Qe("query",i,!1)}function Co(n,e){let t=null;Ve(n)?(t=document,e=n):t=n;let i=t.querySelectorAll(e);return Array.from(i)}function kp(n){return Qe("rel",n,!1,"a","area","link")}function Lo(n){return Qe("required",n,!1,"input","select","textarea")}function AF(n){return Qe("role",n,!1)}function vF(n){return Qe("selected",n,!1,"option")}function bF(n){return Qe("slot",n,!1)}function SF(n){return n instanceof URL&&(n=n.href),n}function Un(n){return Qe("src",SF(n),!1,"audio","embed","iframe","img","input","script","source","track","video")}function Cc(n){return Qe("srcObject",n,!1,"audio","video")}function nt(n){return Qe("step",n,!1,"input")}function _F(n){return Qe("tabindex",n,!1)}function Ii(n){return Qe("title",n,!1)}function Bi(n){return Ve(n)||(n=n.value),Qe("type",n,!1,"button","input","command","embed","link","object","script","source","style","menu")}function Qt(n){return Qe("value",n,!1,"button","data","input","li","meter","option","progress","param")}function yF(n){return Qe("width",n,!1,"canvas","embed","iframe","img","input","object","video")}function Ta(n){return Qe("wrap",n,!1,"textarea")}function Lc(n){return ci(n)?n.element instanceof Element:!1}function $t(n){return Lc(n)?n.element:Ve(n)?Dp(n):n}function TF(n){return ci(n)&&"applyToElement"in n&&Ke(n.applyToElement)}function EF(n){return n instanceof Element||Lc(n)||TF(n)||Ve(n)||mt(n)||Ln(n)||_o(n)}function kF(n){return Lc(n)||n instanceof Element}function Ue(n,e,t=""){n=$t(n),e?(n.style.removeProperty("display"),getComputedStyle(n).display==="none"&&(n.style.display=t||"block")):n.style.display="none"}function zn(n){return n=$t(n),n.style.display!=="none"}function MF(n,e="block"){Ue(n,!zn(n),e)}function Mr(n,e,t){n=$t(n),e=$t(e),t=$t(t),n&&e&&n.insertBefore(e,t)}function Pc(n){if(n=$t(n),n.parentElement){for(let e=0;e<n.parentElement.childElementCount;++e)if(n.parentElement.children[e]===n)return e}return null}function Zg(n,e){return n=$t(n),n.dataset[e.toLowerCase()]}function Ee(n,...e){let t=n instanceof Element||n instanceof ShadowRoot?n:Ve(n)?document.querySelector(n):n.element,i=t instanceof HTMLTemplateElement?t.content:t;for(let r of e)y(r)&&(r instanceof Node?i.appendChild(r):Lc(r)?i.appendChild($t(r)):TF(r)?t instanceof ShadowRoot||r.applyToElement(t):i.appendChild(document.createTextNode(r.toLocaleString())));return t}function DF(n){n=$t(n),y(n)&&n.remove()}function Mp(n,...e){return n=$t(n),n.replaceWith(...e.map($t)),n}function ex(n,e){let t=Ae(),i=e(t);return Mp(t,Mp(n,i)),i}function Dp(n){return document.querySelector(n)}function CF(n){return Array.from(document.querySelectorAll(n))}function LF(n){return Dp(n)}function Je(n,...e){let t=null,i=e.filter(Dc).filter(r=>r.key==="id"||r.key==="query");for(let r of i)r.key==="query"?(t=r.value,Pt(e,r)):r.key==="id"&&(t=document.getElementById(r.value),t&&Pt(e,r));return t&&t.tagName!==n.toUpperCase()&&console.warn(`Expected a "${n.toUpperCase()}" element but found a "${t.tagName}".`),t||(t=document.createElement(n)),Ee(t,...e),t}function Po(n){return ci(n)&&"disabled"in n&&Ln(n.disabled)}function St(n){for(n=$t(n);n.lastChild;)n.lastChild.remove()}function Ie(n,e){n=$t(n),St(n),n.append($re(e))}function PF(n){return n=$t(n),n.innerText}function Ea(n,e){n=$t(n),n.title=e}function En(n,e,t){n=$t(n);let i=y(t),r=i&&n.classList.contains(t);i&&r!==e&&n.classList.toggle(t)}function Ro(n,e,t,i,r){n=$t(n);let o=null,s=null,l=null;Ln(e)?(s=e,l=t,r=i):(o=e,s=t,l=i),n.disabled=!s,l&&Ie(n,l),r&&Ea(n,r),o&&(n.classList.toggle("btn-"+o,s),n.classList.toggle("btn-outline-"+o,!s))}async function RF(n,e,t){y(t)&&t.start();let i=n==="canplay"?e.HAVE_CURRENT_DATA:e.HAVE_ENOUGH_DATA;if(e.readyState>=i)return!0;try{return await Kt(e,n,"error"),!0}catch(r){return console.warn(e.error,r),!1}finally{y(t)&&t.end()}}function IF(n,e){return RF("canplay",n,e)}function Cp(n,e){return RF("canplaythrough",n,e)}function Ui(...n){return Je("audio",...n)}function BF(...n){return Je("button",...n)}function zi(...n){return BF(...n,Bi("button"))}function ys(...n){return zi(...n,de("btn","btn-sm"))}function ar(...n){return zi(...n,de("btn","btn-primary"))}function jn(...n){return zi(...n,de("btn","btn-sm","btn-primary"))}function ka(...n){return zi(...n,de("btn","btn-secondary"))}function Ma(...n){return zi(...n,de("btn","btn-sm","btn-secondary"))}function VF(...n){return zi(...n,de("btn","btn-sm","btn-outline-secondary"))}function OF(...n){return zi(...n,de("btn","btn-danger"))}function Lp(...n){return zi(...n,de("btn","btn-sm","btn-danger"))}function NF(...n){return BF(...n,Bi("reset"))}function Da(...n){return Je("canvas",...n)}function WF(...n){return Je("datalist",...n)}function tx(...n){return Je("dd",...n)}function nx(...n){return Je("details",...n)}function Ae(...n){return Je("div",...n)}function HF(...n){return Je("dl",...n)}function UF(...n){return Je("dt",...n)}function zF(...n){return Je("h1",...n)}function Pp(...n){return Je("h2",...n)}function jF(...n){return Je("h3",...n)}function ix(...n){return Je("hr",...n)}function Qre(...n){return Je("i",...n)}function GF(n,...e){return Qre(de(`fa fa-${n}`),...e)}function Ca(...n){return Je("iframe",...n)}function Gn(...n){return Je("img",...n)}function Ts(...n){return Je("input",...n)}function Rc(...n){return Je("label",...n)}function La(n,e,t){return $t(t).id=n,[Rc(dF(n),e),t]}function XF(...n){return Je("li",...n)}function rx(...n){return Je("link",...n)}function qF(...n){return Je("meter",...n)}function bn(...n){return Je("option",...n)}function YF(...n){return Je("script",...n)}function Vi(...n){return Je("select",...n)}function KF(...n){return Je("slot",...n)}function Dr(...n){return Je("span",...n)}function QF(...n){return Je("summary",...n)}function $F(...n){return Je("table",...n)}function JF(...n){return Je("tbody",...n)}function Rp(...n){return Je("td",...n)}function ZF(...n){return Je("template",...n)}function Cr(...n){return Je("textarea",...n)}function eA(...n){return Je("tfoot",...n)}function Pa(...n){return Je("th",...n)}function tA(...n){return Je("thead",...n)}function Ra(...n){return Je("tr",...n)}function nA(...n){return Je("ul",...n)}function Es(...n){return Je("video",...n)}function Xn(...n){return Ts(Bi("checkbox"),...n)}function Ip(...n){return Ts(Bi("date"),...n)}function iA(...n){return Ts(Bi("file"),...n)}function yi(...n){return Ts(Bi("number"),...n)}function rA(...n){return Ts(Bi("range"),...n)}function ni(...n){return Ts(Bi("text"),...n)}function oA(...n){return Ts(Bi("url"),...n)}function $re(n){return document.createTextNode(n)}function Ut(...n){return Ae(xp("auto"),...n)}function sA(...n){let e=document.createElement("style");document.head.append(e);for(let t of n)t.applyToSheet(e.sheet);return e}function aA(...n){let e=new Blob(n.map(t=>t.toString()),{type:_s.value});return rx(kp("stylesheet"),fF(e))}var ge=class extends Event{get type(){return super.type}constructor(e,t){super(e,t)}},Be=class extends ba{addBubbler(e){super.addBubbler(e)}removeBubbler(e){super.removeBubbler(e)}addScopedEventListener(e,t,i,r){super.addScopedEventListener(e,t,i,r)}addEventListener(e,t,i){super.addEventListener(e,t,i)}removeEventListener(e,t){super.removeEventListener(e,t)}clearEventListeners(e){return super.clearEventListeners(e)}};var Ti=class extends Be{constructor(){super(...arguments),this.attached=new Array,this.soFar=null,this.total=null,this.msg=null,this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(e,t,i,r){this.soFar=e,this.total=t,this.msg=i,this.est=r;for(let o of this.attached)o.report(e,t,i,r)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(e){this.report(0,1,e||"starting")}end(e){this.report(1,1,e||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,qe(this.attached)}};var Ic=class extends Ti{constructor(e,t){super(),this.i=e,this.prog=t}report(e,t,i,r){super.report(e,t,i,r),this.prog.update(this.i,e,t,i)}};var Ia=class{constructor(e){this.prog=e,this.weightTotal=0,this.subProgressCallbacks=new Array,this.subProgressWeights=new Array,this.subProgressValues=new Array,this.start=performance.now();for(let t=0;t<this.subProgressWeights.length;++t)this.subProgressValues[t]=0,this.subProgressCallbacks[t]=new Ic(t,this)}addSubProgress(e){e=e||1,this.weightTotal+=e,this.subProgressWeights.push(e),this.subProgressValues.push(0);let t=new Ic(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(t),t}update(e,t,i,r){if(this.prog){this.subProgressValues[e]=t/i;let o=0;for(let u=0;u<this.subProgressWeights.length;++u)o+=this.subProgressValues[u]*this.subProgressWeights[u];let s=performance.now(),l=s-this.start,c=this.start-s+l*this.weightTotal/o;this.prog.report(o,this.weightTotal,r,c)}}};function Et(n,e){return new ox(e,n).subProgressCallbacks}function Bp(n,e){let t=new Array(e);for(let i=0;i<e;++i)t[i]=1;return Et(n,t)}var ox=class extends Ia{constructor(e,t){super(t);for(let i of e)this.addSubProgress(i)}};async function Bc(n,e){let t=new Array(e.length),i=new Array(e.length);for(let s=0;s<e.length;++s){let l=e[s];t[s]=l[0],i[s]=l[1]}let r=Et(n,t),o=new Array(e.length);for(let s=0;s<e.length;++s)o[s]=i[s](r[s]);return await Promise.all(o)}function lA(n,...e){let t=e.map(i=>[1,i]);return Bc(n,t)}function cA(n){if(n.status>=400)throw new Error("Resource could not be retrieved: "+n.requestPath);return n}function We(n){let{content:e}=cA(n);return e}function ks(n){return y(n)&&Ke(n.then)&&Ke(n.catch)&&Ke(n.finally)&&Ke(n.fetch)&&Ke(n.getSize)}var Vc=class{get result(){if(y(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}constructor(e,t){this.path=e,this.type=t,this._result=null,this._error=null,this._started=!1,this._finished=!1,this.resolve=null,this.reject=null,this.promise=new Promise((i,r)=>{this.resolve=o=>{this._result=o,this._finished=!0,i(o)},this.reject=o=>{this._error=o,this._finished=!0,r(o)}})}async getSize(e){try{let{contentLength:t}=await e.head(this.path).accept(this.type).exec();return[this,t||1]}catch(t){return console.warn(t),[this,1]}}async fetch(e,t){try{let i=await this.getResult(e,t);this.resolve(i)}catch(i){this.reject(i)}}get[Symbol.toStringTag](){return this.promise.toString()}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}};var Ba=class extends Vc{constructor(e,t,i){let r;Ln(t)?i=t:r=t,super(e,r),this.useCache=!!i}getResult(e,t){return this.getRequest(e,t).then(We)}getRequest(e,t){let i=e.get(this.path).useCache(this.useCache).progress(t);return this.getResponse(i)}};var lr=class extends Ba{getResponse(e){return e.file(this.type)}},Vp=class extends Ba{getResponse(e){return e.image(this.type)}};function sx(n,...e){if(!ci(n))return!1;n=n;for(let t of e){if(!(t in n))return!1;let i=n[t];if(!Ke(i))return!1}return!0}function Jre(n){return sx(n,"dispose")}function Zre(n){return sx(n,"destroy")}function eoe(n){return sx(n,"close")}function Tt(n){Jre(n)&&n.dispose(),eoe(n)&&n.close(),Zre(n)&&n.destroy()}function uA(n,e){try{return e(n)}finally{Tt(n)}}var Oc="HTMLCanvasElement"in globalThis,xhe="HTMLImageElement"in globalThis,ax=!1,Ms=!ax&&"OffscreenCanvas"in globalThis,toe=!ax&&"createImageBitmap"in globalThis;function cr(n){return Oc&&n instanceof HTMLCanvasElement}function Op(n){return Ms&&n instanceof OffscreenCanvas}function Np(n){return toe&&n instanceof ImageBitmap}function pA(n){return n instanceof ImageData}function Wp(n){return cr(n)||Op(n)}function dA(n,e){let t=n.getContext("2d");if(oe(t))throw new Error("Could not create 2d context for canvas");t.drawImage(e,0,0)}function hA(n,e){let t=n.getContext("2d");if(oe(t))throw new Error("Could not create 2d context for canvas");t.putImageData(e,0,0)}function noe(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var lx=Ms&&noe(),ur=lx&&Nc||Oc&&Ds||null,Hp=Oc?Ds:ur;function ioe(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var whe=Ms&&ioe();function Nc(n,e){return new OffscreenCanvas(n,e)}function Ds(n,e){return Da(yF(n),hF(e))}function roe(n){let e=Nc(n.width,n.height);return dA(e,n),e}function ooe(n){let e=Ds(n.width,n.height);return dA(e,n),e}var mA=lx&&roe||Oc&&ooe||null;function soe(n){let e=Nc(n.width,n.height);return hA(e,n),e}function aoe(n){let e=Ds(n.width,n.height);return hA(e,n),e}var fA=lx&&soe||Oc&&aoe||null;function Up(n,e){let t=n.getContext("2d");if(oe(t))throw new Error("Could not create 2d context for canvas");t.drawImage(e,0,0)}function zp(n){let e=Ds(n.width,n.height);return Up(e,n),e}async function Va(n){let e=Gn(Un(n));return await Kt(e,"load","error"),e}function gA(n,e,t,i=1){return e=Math.floor(e*i),t=Math.floor(t*i),n.width!=e||n.height!=t?(n.width=e,n.height=t,!0):!1}function loe(n){return y(n.textBaseline)}function coe(n,e,t,i=1){let r=n.imageSmoothingEnabled,o=n.textBaseline,s=n.textAlign,l=n.font,c=gA(n.canvas,e,t,i);return c&&(n.imageSmoothingEnabled=r,n.textBaseline=o,n.textAlign=s,n.font=l),c}function Oa(n,e,t,i=1){return loe(n)?coe(n,e,t,i):gA(n.canvas,e,t,i)}function xA(n,e=1){return Oa(n,n.canvas.clientWidth,n.canvas.clientHeight,e)}function no(n,e,t){if(e instanceof Eo&&(e=e.value),Op(n))return n.convertToBlob({type:e,quality:t});if(cr(n)){let i=new et;return n.toBlob(i.resolve,e,t),i}else throw new Error("Cannot save image from canvas")}function Io(n){Wp(n)?n.width=n.height=0:Tt(n)}function wA(n){let e=new et,t=setInterval(()=>{n()&&(clearInterval(t),e.resolve())},100);return e}async function zt(n,e){let{status:t,requestPath:i,responsePath:r,content:o,contentType:s,contentLength:l,fileName:c,headers:u,date:p}=n;return{status:t,requestPath:i,responsePath:r,content:y(e)?await e(o):void 0,contentType:s,contentLength:l,fileName:c,headers:u,date:p}}var cx=null;function FA(n){return cx===null&&(cx=new Audio),cx.canPlayType(n)!==""}var jp=class{constructor(e,t,i,r=!1){this.fetcher=e,this.method=t,this.path=i,this.useBLOBs=r,this.prog=null,this.request={method:t,path:this.path.href,body:null,headers:null,timeout:null,withCredentials:!1,useCache:!1,retryCount:3}}retries(e){return this.request.retryCount=e,this}query(e,t){return this.path.searchParams.set(e,t),this.request.path=this.path.href,this}header(e,t){return this.request.headers===null&&(this.request.headers=new Map),this.request.headers.set(e.toLowerCase(),t),this}headers(e){for(let[t,i]of e.entries())this.header(t,i);return this}timeout(e){return this.request.timeout=e,this}progress(e){return this.prog=e,this}body(e,t){if(y(e)){let i=new Set,r=new Array;r.push(e);let o=!1;for(;!o&&r.length>0;){let s=r.shift();if(s&&!i.has(s))if(i.add(s),s instanceof Blob){o=!0;break}else Ve(s)||r.push(...Object.values(s))}if(o){let s=new FormData,l=new Map,c=new Set;for(let[u,p]of Object.entries(e))if(p instanceof Blob){let d=u+".name",h=e[d];Ve(h)&&(l.set(p,h),c.add(d))}for(let[u,p]of Object.entries(e))c.has(u)||(p instanceof Blob?s.append(u,p,l.get(p)):Ve(p)?s.append(u,p):y(p)&&Ke(p.toString)?s.append(u,p.toString()):console.warn("Can't serialize value to formdata",u,p));e=s,t=void 0}this.request.body=e,this.content(t)}return this}withCredentials(){return this.request.withCredentials=!0,this}useCache(e=!0){return this.request.useCache=e,this}media(e,t){y(t)&&(Ve(t)||(t=t.value),this.header(e,t))}content(e){this.media("content-type",e)}accept(e){return this.media("accept",e),this}blob(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBlob(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBlob(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);yt(this.method)}buffer(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBuffer(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBuffer(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);yt(this.method)}async file(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return await this.fetcher.sendObjectGetFile(this.request,this.prog);if(this.method==="GET"){if(this.useBLOBs)return await this.fetcher.sendNothingGetFile(this.request,this.prog);{let t=await this.fetcher.sendNothingGetNothing(this.request);return zt(t,()=>this.request.path)}}else{if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);yt(this.method)}}text(e){if(this.accept(e||eo),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetText(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetText(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);yt(this.method)}object(e){if(this.accept(e||_a),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetObject(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetObject(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);yt(this.method)}xml(e){if(this.accept(e||Ug),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetXml(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetXml(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);yt(this.method)}imageBitmap(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetImageBitmap(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetImageBitmap(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);yt(this.method)}exec(){if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetNothing(this.request,this.prog);if(this.method==="GET")throw new Error("GET requests should expect a response type");if(this.method==="HEAD"||this.method==="OPTIONS")return this.fetcher.sendNothingGetNothing(this.request);yt(this.method)}async audioBlob(e){if(y(e)&&(Ve(e)||(e=e.value),!FA(e)))throw new Error(`Probably can't play file of type "${e}" at path: ${this.request.path}`);let t=await this.blob(e);if(FA(t.contentType))return t;throw new Error(`Cannot play file of type "${t.contentType}" at path: ${this.request.path}`)}async audioBuffer(e,t){return zt(await this.audioBlob(t),async i=>await e.decodeAudioData(await i.arrayBuffer()))}async htmlElement(e,t,i){let r=await this.file(i),o=Kt(e,t,"error");return e instanceof HTMLLinkElement?e.href=r.content:e.src=r.content,await o,await zt(r,()=>e)}image(e){return this.htmlElement(Gn(),"load",e)}async htmlCanvas(e){let t=Ds(1,1);if(this.method==="GET")if(Ms){this.accept(e);let i=await this.fetcher.drawImageToCanvas(this.request,t.transferControlToOffscreen(),this.prog);return await zt(i,()=>t)}else{let i=await this.image(e);return await zt(i,r=>(t.width=r.width,t.height=r.height,Up(t,r),Tt(r),t))}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);yt(this.method)}}canvas(e){return Ms?this.offscreenCanvas(e):this.htmlCanvas(e)}async offscreenCanvas(e){if(!Ms)throw new Error("This system does not support OffscreenCanvas");if(this.method==="GET"){let t=await this.image(e);return await zt(t,i=>{let r=Nc(i.width,i.height);return Up(r,i),Tt(i),r})}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);yt(this.method)}}async style(){let e=rx(Bi(_s),kp("stylesheet"));document.head.append(e);let t=await this.htmlElement(e,"load",_s);return zt(t)}async getScript(){let e=YF(Bi(sr));document.head.append(e);let t=await this.htmlElement(e,"load",sr);return zt(t)}async script(e){let t=null,i=this.request.path;if(!e)t=await this.getScript();else if(!e()){let r=wA(e);t=await this.getScript(),await r}return this.prog&&this.prog.end(i),t}async module(){let e=this.request.path,t=await this.file(sr),i=await import(t.content);return this.prog&&this.prog.end(e),zt(t,()=>i)}async wasm(e){let t=await this.buffer(_p);if(!_p.matches(t.contentType))throw new Error(`Server did not respond with WASM file. Was: ${t.contentType}`);let i=await WebAssembly.compile(t.content),r=await WebAssembly.instantiate(i,e);return zt(t,()=>r.exports)}async worker(e="module"){let t=this.request.path,i=await this.file(sr);this.prog=null,this.request.timeout=null;let r=new Worker(i.content,{type:e});return this.prog&&this.prog.end(t),zt(i,()=>r)}};var Gp=class{constructor(e,t=!1){this.service=e,this.useBLOBs=t;{let i=LF("input[name=__RequestVerificationToken]");i&&this.service.setRequestVerificationToken(i.value)}}clearCache(){return this.service.clearCache()}evict(e,t){return this.service.evict(new URL(e,t||location.href).href)}request(e,t,i){return new jp(this.service,e,new URL(t,i||location.href),this.useBLOBs)}head(e,t){return this.request("HEAD",e,t)}options(e,t){return this.request("OPTIONS",e,t)}get(e,t){return this.request("GET",e,t)}post(e,t){return this.request("POST",e,t)}put(e,t){return this.request("PUT",e,t)}patch(e,t){return this.request("PATCH",e,t)}delete(e,t){return this.request("DELETE",e,t)}async assets(e,t,...i){oe(i)&&(i=[]),i.unshift(t);let r;ks(e)?i.unshift(e):y(e)&&(r=e),i=i.filter(y);let o=await Promise.all(i.map(l=>l.getSize(this))),s=new Map(o);await Bc(r,i.map(l=>[s.get(l),c=>l.fetch(this,c)]))}};var Xp=class{constructor(e){this.impl=e,this.defaultPostHeaders=new Map}setRequestVerificationToken(e){this.defaultPostHeaders.set("RequestVerificationToken",e)}clearCache(){return this.impl.clearCache()}evict(e){return this.impl.evict(e)}sendNothingGetNothing(e){return this.impl.sendNothingGetNothing(e)}sendNothingGetBlob(e,t){return this.impl.sendNothingGetSomething("blob",e,t)}sendObjectGetBlob(e,t){return this.impl.sendSomethingGetSomething("blob",e,this.defaultPostHeaders,t)}sendNothingGetBuffer(e,t){return this.impl.sendNothingGetSomething("arraybuffer",e,t)}sendObjectGetBuffer(e,t){return this.impl.sendSomethingGetSomething("arraybuffer",e,this.defaultPostHeaders,t)}sendNothingGetText(e,t){return this.impl.sendNothingGetSomething("text",e,t)}sendObjectGetText(e,t){return this.impl.sendSomethingGetSomething("text",e,this.defaultPostHeaders,t)}sendNothingGetObject(e,t){return this.impl.sendNothingGetSomething("json",e,t)}sendObjectGetObject(e,t){return this.impl.sendSomethingGetSomething("json",e,this.defaultPostHeaders,t)}sendObjectGetNothing(e,t){return this.impl.sendSomethingGetSomething("",e,this.defaultPostHeaders,t)}drawImageToCanvas(e,t,i){return this.impl.drawImageToCanvas(e,t,i)}async sendNothingGetFile(e,t){return zt(await this.sendNothingGetBlob(e,t),URL.createObjectURL)}async sendObjectGetFile(e,t){return zt(await this.sendObjectGetBlob(e,t),URL.createObjectURL)}async sendNothingGetXml(e,t){return zt(await this.impl.sendNothingGetSomething("document",e,t),i=>i.documentElement)}async sendObjectGetXml(e,t){return zt(await this.impl.sendSomethingGetSomething("document",e,this.defaultPostHeaders,t),i=>i.documentElement)}async sendNothingGetImageBitmap(e,t){return zt(await this.sendNothingGetBlob(e,t),createImageBitmap)}async sendObjectGetImageBitmap(e,t){return zt(await this.sendObjectGetBlob(e,t),createImageBitmap)}};function qp(n,e,t){return new Map(n.map(i=>[e(i),t(i)]))}function Cs(n,e){return qp(n,e,pn)}var Zt=class{constructor(e){if(this.items=new Map,this.defaultItems=new Array,y(e))for(let[t,i]of e)this.add(t,i)}add(e,...t){for(let i of t)if(oe(e))this.defaultItems.push(i);else{let r=this.items.get(e);oe(r)&&this.items.set(e,r=[]),r.push(i)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let e of this.defaultItems)yield e;for(let e of this.items.values())for(let t of e)yield t}has(e){return y(e)?this.items.has(e):this.defaultItems.length>0}get(e){return oe(e)?this.defaultItems:this.items.get(e)||[]}count(e){if(oe(e))return this.defaultItems.length;let t=this.get(e);return y(t)?t.length:0}get size(){let e=this.defaultItems.length;for(let t of this.items.values())e+=t.length;return e}delete(e){return oe(e)?qe(this.defaultItems).length>0:this.items.delete(e)}remove(e,t){if(oe(e))Pt(this.defaultItems,t);else{let i=this.items.get(e);y(i)&&(Pt(i,t),i.length===0&&this.items.delete(e))}}clear(){this.items.clear(),qe(this.defaultItems)}};var Bn=class{constructor(e){if(this.items=new Map,y(e))for(let[t,i,r]of e)this.add(t,i,r)}add(e,t,i){let r=this.items.get(e);return oe(r)&&this.items.set(e,r=new Map),r.set(t,i),this}*entries(){for(let[e,t]of this.items)for(let[i,r]of t)yield[e,i,r]}keys(e){return oe(e)?this.items.keys():this.items.get(e).keys()}*values(){for(let e of this.items.values())for(let t of e.values())yield t}has(e,t){return this.items.has(e)&&(oe(t)||this.items.get(e).has(t))}get(e,t){return oe(t)?this.items.get(e):this.items.has(e)?this.items.get(e).get(t):null}count(e){return this.items.has(e)?this.items.get(e).size:null}get size(){let e=0;for(let t of this.items.values())e+=t.size;return e}delete(e,t){if(oe(t))return this.items.delete(e);if(this.items.has(e)){let i=this.items.get(e),r=i.delete(t);return i.size===0&&this.items.delete(e),r}else return!1}clear(){this.items.clear()}};var Yp=class n{static delete(e){let t=indexedDB.deleteDatabase(e),i=Kt(t,"success","error","blocked");return or(i)}static async open(e,...t){let i=Cs(t,P=>P.name),r=new Bn(t.filter(P=>y(P.indexes)).flatMap(P=>P.indexes.map(L=>[P.name,L.name,L]))),o=new Array,s=new Array,l=new Array,c=new Zt,u=new Zt,p=null,d=indexedDB.open(e);if(await or(Kt(d,"success","error","blocked"))){let P=d.result;p=P.version;let L=new Array;for(let S of P.objectStoreNames)i.has(S)||s.push(S);for(let S of i.keys())P.objectStoreNames.contains(S)?L.push(S):o.push(S);if(L.length>0){let S=P.transaction(L),x=Kt(S,"complete","error","abort"),v=or(x);for(let M of L){let O=S.objectStore(M),B=i.get(M);y(B.options)&&O.keyPath!==B.options.keyPath&&(s.push(M),o.push(M));for(let X of O.indexNames)r.has(M,X)||(l.indexOf(M)===-1&&l.push(M),u.add(M,X));if(r.has(M))for(let X of r.get(M).keys())if(!O.indexNames.contains(X))l.indexOf(M)===-1&&l.push(M),c.add(M,X);else{let V=r.get(M,X),J=O.index(X);(Ve(V.keyPath)!==Ve(J.keyPath)||Ve(V.keyPath)&&Ve(J.keyPath)&&V.keyPath!==J.keyPath||Wn(V.keyPath)&&Wn(J.keyPath)&&bp(V.keyPath,J.keyPath))&&(l.indexOf(M)===-1&&l.push(M),u.add(M,X),c.add(M,X))}}S.commit(),await v}Tt(P)}else{p=0,o.push(...i.keys());for(let P of t)if(y(P.indexes))for(let L of P.indexes)c.add(P.name,L.name)}(o.length>0||s.length>0||c.size>0||u.size>0)&&++p;let h=new et,A=y(p)?indexedDB.open(e,p):indexedDB.open(e),g=Kt(A,"success","error","blocked"),F=or(h),b=or(g),R=h.resolver(!1);if(A.addEventListener("success",R),A.addEventListener("upgradeneeded",()=>{let P=Kt(A.transaction,"complete","error","abort"),L=A.result;for(let x of s)L.deleteObjectStore(x);let S=new Map;for(let x of o){let v=i.get(x),M=L.createObjectStore(x,v.options);S.set(x,M)}for(let x of l){let v=A.transaction.objectStore(x);S.set(x,v)}for(let[x,v]of S){for(let M of u.get(x))v.deleteIndex(M);for(let M of c.get(x)){let O=r.get(x,M);v.createIndex(M,O.keyPath,O.options)}}or(P).then(h.resolve).catch(h.reject).finally(()=>A.removeEventListener("success",R))}),!await F)throw h.error;if(!await b)throw g.error;return new n(A.result)}constructor(e){this.db=e}dispose(){Tt(this.db)}get name(){return this.db.name}get version(){return this.db.version}get storeNames(){return Array.from(this.db.objectStoreNames)}getStore(e){return new ux(this.db,e)}},ux=class{constructor(e,t){this.db=e,this.storeName=t}async request(e,t){let i=this.db.transaction(this.storeName,t),r=Kt(i,"complete","error"),o=i.objectStore(this.storeName),s=e(o),l=Kt(s,"success","error");if(!await or(l))throw i.abort(),l.error;if(i.commit(),!await or(r))throw r.error;return s.result}add(e,t){return this.request(i=>i.add(e,t),"readwrite")}clear(){return this.request(e=>e.clear(),"readwrite")}getCount(e){return this.request(t=>t.count(e),"readonly")}async has(e){return await this.getCount(e)>0}delete(e){return this.request(t=>t.delete(e),"readwrite")}get(e){return this.request(t=>t.get(e),"readonly")}getAll(){return this.request(e=>e.getAll(),"readonly")}getAllKeys(){return this.request(e=>e.getAllKeys(),"readonly")}getKey(e){return this.request(t=>t.getKey(e),"readonly")}openCursor(e,t){return this.request(i=>i.openCursor(e,t),"readonly")}openKeyCursor(e,t){return this.request(i=>i.openKeyCursor(e,t),"readonly")}put(e,t){return this.request(i=>i.put(e,t),"readwrite")}};function AA(n,...e){for(let t of e)if(y(t))for(let[i,r]of t)n.set(i,r);return n}var px=class extends et{constructor(e){super(!1),this.milliseconds=e,this._timer=null}start(){super.start(),this._timer=setTimeout(()=>{this._timer=null,this.resolve()},this.milliseconds)}reset(){super.reset(),y(this._timer)&&(clearTimeout(this._timer),this._timer=null)}};function vA(n){let e=new px(n);return e.start(),e}function Kp(n,e){return async()=>{let t=null,i=500;for(let r=0;r<=n;++r)try{return r>0&&(await vA(i),i*=2),await e()}catch(o){t=o}throw t}}function uoe(n){return Ve(n)||C0(n)||n instanceof Blob||n instanceof FormData||L0(n)||"Document"in globalThis&&n instanceof Document}function Qp(n,e,t,i,r,o){let s=!o;o&&o.then(()=>s=!0);let l=!1,c=r,u=new et;t.addEventListener("loadstart",()=>{s&&!l&&i&&i.start(n)}),t.addEventListener("progress",d=>{if(s&&!l){let h=d;i&&i.report(h.loaded,Math.max(h.loaded,h.total),n),h.loaded===h.total&&(c=!0,l&&u.resolve())}}),t.addEventListener("load",()=>{s&&!l&&(i&&i.end(n),l=!0,c&&u.resolve())});let p=d=>()=>{s&&u.reject(`${d} (${e.status})`)};return t.addEventListener("error",p("error")),t.addEventListener("abort",p("abort")),t.addEventListener("timeout",p("timeout")),u}function dx(n,e,t,i,r,o){if(n.open(e,t),n.responseType="blob",n.timeout=i,r)for(let[s,l]of r)n.setRequestHeader(s,l);y(o)?n.send(o):n.send()}function $p(n,e,t){if(!n.has(e))return null;let i=n.get(e);try{let r=t(i);return n.delete(e),r}catch(r){console.warn(e,r)}return null}var poe=/filename=\"(.+)\"(;|$)/,doe="Juniper:Fetcher:Cache",Jp=class{constructor(){this.cache=null,this.store=null,this.tasks=new Bn,this.cacheReady=this.openCache()}async drawImageToCanvas(e,t,i){let r=await this.sendNothingGetSomething("blob",e,i),o=r.content;return uA(await createImageBitmap(o,{imageOrientation:"from-image"}),s=>(t.width=s.width,t.height=s.height,t.getContext("2d").drawImage(s,0,0),zt(r)))}async openCache(){let e={keyPath:"requestPath"};this.cache=await Yp.open(doe,{name:"files",options:e}),this.store=await this.cache.getStore("files")}async clearCache(){await this.cacheReady,await this.store.clear()}async evict(e){await this.cacheReady,this.store.has(e)&&await this.store.delete(e)}async readResponseHeaders(e,t){let i=t.getAllResponseHeaders().split(/[\r\n]+/).map(h=>h.trim()).filter(h=>h.length>0).map(h=>{let A=h.split(": "),g=A.shift().toLowerCase(),F=A.join(": ");return[g,F]}),r=new Zt(i),o=Array.from(r.keys()).map(h=>[h,r.get(h).join(", ")]),s=new Map(o),l=$p(s,"content-type",pn),c=$p(s,"content-length",parseFloat),u=$p(s,"date",h=>new Date(h)),p=$p(s,"content-disposition",h=>{if(y(h)){let A=h.match(poe);if(y(A))return A[1]}return null});return{status:t.status,requestPath:e,responsePath:t.responseURL,content:void 0,contentType:l,contentLength:c,fileName:p,date:u,headers:s}}async readResponse(e,t){let{responsePath:i,status:r,contentType:o,contentLength:s,fileName:l,date:c,headers:u}=await this.readResponseHeaders(e,t),p={requestPath:e,responsePath:i,status:r,contentType:o,contentLength:s,fileName:l,date:c,headers:u,content:t.response};return y(p.content)&&(p.contentType=p.contentType||p.content.type,p.contentLength=p.contentLength||p.content.size),p}async decodeContent(e,t){return zt(t,async i=>{if(e==="")return null;if(oe(t.contentType)){let r=Array.from(t.headers.entries()).map(o=>o.join(": ")).join(`
  `);throw new Error(`No content type found in headers: 
  `+r)}else{if(e==="blob")return i;if(e==="arraybuffer")return await i.arrayBuffer();if(e==="json"){let r=await i.text();return r.length>0?JSON.parse(r):null}else if(e==="document"){let r=new DOMParser;if(t.contentType==="application/xhtml+xml"||t.contentType==="text/html"||t.contentType==="application/xml"||t.contentType==="image/svg+xml"||t.contentType==="text/xml")return r.parseFromString(await i.text(),t.contentType);throw new Error("Couldn't parse document")}else{if(e==="text")return await i.text();yt(e)}}})}async withCachedTask(e,t){return e.method!=="GET"&&e.method!=="HEAD"&&e.method!=="OPTIONS"?await t():(this.tasks.has(e.method,e.path)||this.tasks.add(e.method,e.path,t().finally(()=>this.tasks.delete(e.method,e.path))),this.tasks.get(e.method,e.path))}sendNothingGetNothing(e){return this.withCachedTask(e,Kp(e.retryCount,async()=>{let t=new XMLHttpRequest,i=Qp(`requesting: ${e.path}`,t,t,null,!0);return dx(t,e.method,e.path,e.timeout,e.headers),await i,await this.readResponseHeaders(e.path,t)}))}sendNothingGetSomething(e,t,i){return this.withCachedTask(t,Kp(t.retryCount,async()=>{let r=null,o=t.useCache&&t.method==="GET";o&&(y(i)&&i.start(),await this.cacheReady,r=await this.store.get(t.path));let s=oe(r);if(s){let c=new XMLHttpRequest,u=Qp(`requesting: ${t.path}`,c,c,i,!0);dx(c,t.method,t.path,t.timeout,t.headers),await u,r=await this.readResponse(t.path,c),o&&await this.store.add(r)}let l=await this.decodeContent(e,r);return s&&y(i)&&i.end(),l}))}sendSomethingGetSomething(e,t,i,r){let o=null,s=AA(new Map,i,t.headers),l=null;if(y(s)){let A=new Array;for(let g of s.keys())g.toLowerCase()==="content-type"&&A.push(g);if(A.length>0){t.body instanceof FormData||(l=s.get(A[0]),A.shift());for(let g of A)s.delete(g)}}uoe(t.body)&&!Ve(t.body)||Ve(t.body)&&eo.matches(l)?o=t.body:y(t.body)&&(o=JSON.stringify(t.body));let c=y(o),u=Bp(r,c?2:1),[p,d]=u,h=async()=>{let A=new XMLHttpRequest,g=c?Qp("uploading",A,A.upload,p,!1):Promise.resolve(),F=Qp("saving",A,A,d,!0,g);dx(A,t.method,t.path,t.timeout,s,o),await g,await F;let b=await this.readResponse(t.path,A);return await this.decodeContent(e,b)};return Kp(t.retryCount,h)()}};function hx(n){return y(n)&&Ke(n.report)&&Ke(n.attach)&&Ke(n.end)}function bA(){return"chrome"in globalThis&&!navigator.userAgent.match("CriOS")}function ed(){return"InstallTrigger"in globalThis}function SA(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function hoe(){return/^mac/i.test(navigator.platform)}function Na(){return/iP(ad|hone|od)/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||hoe()&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>2}function io(){return/Mobile VR/.test(navigator.userAgent)||/Pico Neo 3 Link/.test(navigator.userAgent)||ro}function td(){return"xr"in navigator&&"isSessionSupported"in navigator.xr}function mx(){return"getVRDisplays"in navigator}function nd(){return td()||mx()}function Wc(){return/Android/.test(navigator.userAgent)||/BlackBerry/.test(navigator.userAgent)||/(UC Browser |UCWEB)/.test(navigator.userAgent)||Na()||io()}function Wa(){return!Wc()}var moe=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,Zp=navigator.userAgent.match(moe),ro=!!Zp,_A=ro&&{major:parseFloat(Zp[1]),minor:parseFloat(Zp[2]),patch:parseFloat(Zp[3])},kme=ro&&/pacific/i.test(navigator.userAgent),Mme=ro&&/quest/i.test(navigator.userAgent),Dme=ro&&/quest 2/i.test(navigator.userAgent);var fx="Worker"in globalThis;var Hc=class extends Be{constructor(e){super(),this.worker=e,this.invocations=new Map,this.tasks=new Array,this.taskCounter=0,fx||console.warn("Workers are not supported on this system."),this.worker.addEventListener("message",t=>{let i=t.data;switch(i.type){case"event":this.propogateEvent(i);break;case"progress":this.progressReport(i);break;case"return":this.methodReturned(i);break;case"error":this.invocationError(i);break;default:yt(i)}})}postMessage(e,t){e.type!=="methodCall"&&yt(e.type),t?this.worker.postMessage(e,t):this.worker.postMessage(e)}dispose(){this.worker.terminate()}progressReport(e){let t=this.invocations.get(e.taskID);if(t){let{prog:i}=t;i&&i.report(e.soFar,e.total,e.msg,e.est)}}methodReturned(e){let t=this.removeInvocation(e.taskID),{task:i}=t;i.resolve(e.returnValue)}invocationError(e){let t=this.removeInvocation(e.taskID),{task:i,methodName:r}=t;i.reject(new Error(`${r} failed. Reason: ${e.errorMessage}`))}removeInvocation(e){let t=this.invocations.get(e);return this.invocations.delete(e),t}callMethod(e,t,i,r){if(!fx)return Promise.reject(new Error("Workers are not supported on this system."));let o=null,s=null;hx(t)&&(r=t,t=null,i=null),hx(i)&&!r&&(r=i,i=null),Wn(t)&&(o=t),Wn(i)&&(s=i);let l=this.taskCounter++,c=Rn(this.tasks,d=>d.finished);c?c.reset():(c=new et,this.tasks.push(c));let u={methodName:e,task:c,prog:r};this.invocations.set(l,u);let p=null;return y(t)?p={type:"methodCall",taskID:l,methodName:e,params:o}:p={type:"methodCall",taskID:l,methodName:e},this.postMessage(p,s),c}};var Uc=class extends Be{constructor(e,t){super(),this.scriptPath=e.scriptPath;let i=-1,r=e.workers,o=null;if(mt(r)?i=r:y(r)?(this.taskCounter=r.curTaskCounter,o=r.workers,i=o.length):i=navigator.hardwareConcurrency||4,i<1)throw new Error("Worker pool size must be a postive integer greater than 0");if(this.workers=new Array(i),oe(o)){this.taskCounter=0;for(let s=0;s<i;++s)this.workers[s]=new t(new Worker(this.scriptPath,{type:"module"}))}else for(let s=0;s<i;++s)this.workers[s]=new t(o[s]);for(let s of this.workers)s.addBubbler(this)}dispose(){this.workers.forEach(Tt),qe(this.workers)}nextWorker(){let e=this.peekWorker();return this.taskCounter++,e}peekWorker(){return this.workers[this.taskCounter%this.workers.length]}};var yA=new URL(globalThis.location.href),zc=yA.searchParams.has("DEBUG")&&!yA.searchParams.has("RELEASE");function di(n,e){let t=globalThis,i=t[n];if(oe(i)){if(oe(e))throw new Error(`No value ${n} found`);i=e(),t[n]=i}return i}var pfe=di("juniper::loadedFonts",()=>[]);function id(n){let e=[];return n.fontStyle&&n.fontStyle!=="normal"&&e.push(n.fontStyle),n.fontVariant&&n.fontVariant!=="normal"&&e.push(n.fontVariant),n.fontWeight&&n.fontWeight!=="normal"&&e.push(n.fontWeight),e.push(ui(n.fontSize)),e.push(n.fontFamily),e.join(" ")}function sn(...n){return Promise.all(n)}var TA="3.7.24";var rd=class{constructor(e){this.log=e}error(e,t,i){console.error(e,t,i),this.log("error",{page:e,operation:t,exception:i})}};var goe=zc?In(10):TA;var EA=!1;var oo=50,gx=12,kA=oo*gx;var od={fontFamily:"Lato",fontSize:20};var Ha=pi(30,67,136),MA=pi(78,77,77),DA={fontFamily:od.fontFamily,fontSize:od.fontSize,textFillColor:"white"},CA=Object.assign({},DA,{bgFillColor:pi(0,120,215),bgStrokeColor:"black",bgStrokeSize:.02,padding:{top:.025,left:.05,bottom:.025,right:.05},minHeight:.2,maxHeight:.2,scale:300}),Dfe=Object.assign({},DA,{textStrokeColor:"black",textStrokeSize:.01,minHeight:.25,maxHeight:.25});function LA(){let n=new Zt([["arrow","arrow-up"],["arrow","arrow-down"],["arrow","arrow-left"],["arrow","arrow-right"],["chat","user"],["chat","chat"],["ui","menu"],["ui","settings"],["ui","quit"],["ui","lobby"],["zoom","zoom-in"],["zoom","zoom-out"],["zoom","zoom-info"],["environment-audio","environment-audio-mute"],["environment-audio","environment-audio-unmute"],["headphones","headphones-unmuted"],["headphones","headphones-muted"],["microphone","microphone-mute"],["microphone","microphone-unmute"],["volume","volume-muted"],["volume","volume-low"],["volume","volume-medium"],["volume","volume-high"],["media","media-pause"],["media","media-play"],["media","media-stop"],["media","media-replay"],["ar","ar-enter"],["ar","ar-exit"],["vr","vr-enter"],["vr","vr-exit"],["fullscreen","fullscreen-enter"],["fullscreen","fullscreen-exit"]]),e=new Bn;for(let[t,i]of n.entries())for(let r of i)e.add(t,r.replace(t+"-",""),`/images/ui/${r}.png`);return e}var xoe=zc?".js":".min.js";function woe(n,e){return`/js/${e}/index${n}?v=${goe}`}function Ls(n){return woe(xoe,n)}function PA(n){return Ls("vr-apps/"+n)}function RA(n){return Ls("workers/"+n)}function IA(n){return Ls("libs/"+n)}function BA(n){let e=null,t=Promise.resolve(),i=async(r,o)=>{e=await n.post("/").body({reportID:e,key:r,value:o},Jr).object().then(We)};return new rd((r,o)=>{t=t.then(()=>i(r,o))})}function sd(n=!0){let e=new Xp(new Jp);return new Gp(e,!zc)}var ct=class n{constructor(e,t,i=null){this.value=e,this.desc=t,this.value=e,this.desc=t,this.props=i||{}}contains(e){return e instanceof n?this.contains(e.value):this.value.indexOf(e)>=0}changeStyle(e,t){let i=this.value;return i.endsWith(e)&&(i=i.substring(0,i.length-e.length)),i+=t,i}get textStyle(){return this.changeStyle("\uFE0F","\uFE0E")}get emojiStyle(){return this.changeStyle("\uFE0E","\uFE0F")}};var so=new ct("\u2B50","Star");var VA=new ct("\u2BC1","Black Diamond Centred");var OA=new ct("\u{1F503}\uFE0F","Clockwise Vertical Arrows");var NA=new ct("\u2B06\uFE0F","Up Arrow"),WA=new ct("\u2B06\uFE0E","Up Arrow: Text");var jc=new ct("\u2BC6","Black Medium Down-Pointing Triangle Centered");var ad=new ct("\u2BC8","Black Medium Right-Pointing Triangle Centered");var HA=new ct("0\uFE0F\u20E3","Keycap Digit Zero"),UA=new ct("1\uFE0F\u20E3","Keycap Digit One"),zA=new ct("2\uFE0F\u20E3","Keycap Digit Two"),jA=new ct("3\uFE0F\u20E3","Keycap Digit Three"),GA=new ct("4\uFE0F\u20E3","Keycap Digit Four"),XA=new ct("5\uFE0F\u20E3","Keycap Digit Five"),qA=new ct("6\uFE0F\u20E3","Keycap Digit Six"),YA=new ct("7\uFE0F\u20E3","Keycap Digit Seven"),KA=new ct("8\uFE0F\u20E3","Keycap Digit Eight"),QA=new ct("9\uFE0F\u20E3","Keycap Digit Nine");var $A=new ct("\u{1F51F}","Keycap: 10");var JA=new ct("\u{E007F}","Cancel Tag");var ZA=new ct("\u2795","Plus");var xx=new ct("\u{1F30E}","Globe Showing Americas");var ev=new ct("\u{1F4E3}","Megaphone");var tv=new ct("\u{1F4F9}","Video Camera");var nv=new ct("\u{1F50A}","Speaker High Volume");var iv=new ct("\u{1F510}","Locked with Key");var rv=new ct("\u{1F579}\uFE0F","Joystick");var ov=new ct("\u{1F5D1}","Wastebasket");var sv=new ct("\u{1F4DC}","Scroll"),av=new ct("\u{1F4DD}","Memo");var lv=new ct("\u26A0\uFE0F","Warning");var cv=new ct("\u{1F5BC}\uFE0F","Framed Picture");var uv=new ct("\u{1F5FA}\uFE0F","World Map");var wx=new ct("\u2753","Question Mark");function pr(n){return oe(n)?null:{lat:n.lat,lng:n.lng}}function Lr(n){return oe(n)?null:n instanceof google.maps.LatLng?{lat:n.lat(),lng:n.lng()}:{lat:n.lat,lng:n.lng}}function ao(n){return!(n.shiftKey||n.altKey||n.ctrlKey||n.metaKey)}function cd(n){return e=>{let t=e;ao(t)&&t.key==="Enter"&&n(t)}}var ld=class{constructor(e,t,i){if(this.name=e,this.callback=t,!Ke(t))throw new Error("A function instance is required for this parameter");this.opts=i,Object.freeze(this)}applyToElement(e){this.add(e)}add(e){e.addEventListener(this.name,this.callback,this.opts)}remove(e){e.removeEventListener(this.name,this.callback)}};function hi(n,e,t){return new ld(n,e,t)}function Ye(n,e){return hi("click",n,e)}function ud(n,e){return hi("contextmenu",n,e)}function pv(n,e){return hi("dblclick",n,e)}function Ua(n,e){return hi("dragend",n,e)}function dv(n,e){return hi("dragleave",n,e)}function za(n,e){return hi("dragover",n,e)}function pd(n,e){return hi("dragstart",n,e)}function dd(n,e){return hi("drop",n,e)}function Oe(n,e){return hi("input",n,e)}function hv(n,e){return hi("keydown",n,e)}function Fx(n,e){return hi("keyup",n,e)}function mv(n,e){return Fx(t=>{t.key==="Enter"&&n(t)},e)}function fv(n,e){return hi("play",n,e)}function gv(n,e){return hi("released",n,e)}function xv(n,e){return hi("toggle",n,e)}var ii=1e-6,hn=typeof Float32Array<"u"?Float32Array:Array,Pr=Math.random;var Qfe=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});function wv(){var n=new hn(9);return hn!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}var ja={};ti(ja,{add:()=>Ase,calculateW:()=>cse,clone:()=>gse,conjugate:()=>hse,copy:()=>wse,create:()=>bx,dot:()=>Gv,equals:()=>Tse,exactEquals:()=>yse,exp:()=>Hv,fromEuler:()=>mse,fromMat3:()=>zv,fromValues:()=>xse,getAngle:()=>ose,getAxisAngle:()=>rse,identity:()=>ise,invert:()=>dse,len:()=>Sse,length:()=>Xv,lerp:()=>bse,ln:()=>Uv,mul:()=>vse,multiply:()=>Wv,normalize:()=>Sx,pow:()=>use,random:()=>pse,rotateX:()=>sse,rotateY:()=>ase,rotateZ:()=>lse,rotationTo:()=>Ese,scale:()=>jv,set:()=>Fse,setAxes:()=>Mse,setAxisAngle:()=>Nv,slerp:()=>gd,sqlerp:()=>kse,sqrLen:()=>_se,squaredLength:()=>qv,str:()=>fse});var Rt={};ti(Rt,{add:()=>Soe,angle:()=>zoe,bezier:()=>Ioe,ceil:()=>_oe,clone:()=>Aoe,copy:()=>voe,create:()=>hd,cross:()=>Xc,dist:()=>$oe,distance:()=>Sv,div:()=>Qoe,divide:()=>bv,dot:()=>fd,equals:()=>qoe,exactEquals:()=>Xoe,floor:()=>yoe,forEach:()=>ese,fromValues:()=>md,hermite:()=>Roe,inverse:()=>Loe,len:()=>vx,length:()=>Fv,lerp:()=>Poe,max:()=>Eoe,min:()=>Toe,mul:()=>Koe,multiply:()=>vv,negate:()=>Coe,normalize:()=>Ax,random:()=>Boe,rotateX:()=>Woe,rotateY:()=>Hoe,rotateZ:()=>Uoe,round:()=>koe,scale:()=>Moe,scaleAndAdd:()=>Doe,set:()=>boe,sqrDist:()=>Joe,sqrLen:()=>Zoe,squaredDistance:()=>_v,squaredLength:()=>yv,str:()=>Goe,sub:()=>Yoe,subtract:()=>Av,transformMat3:()=>Ooe,transformMat4:()=>Voe,transformQuat:()=>Noe,zero:()=>joe});function hd(){var n=new hn(3);return hn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Aoe(n){var e=new hn(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Fv(n){var e=n[0],t=n[1],i=n[2];return Math.hypot(e,t,i)}function md(n,e,t){var i=new hn(3);return i[0]=n,i[1]=e,i[2]=t,i}function voe(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function boe(n,e,t,i){return n[0]=e,n[1]=t,n[2]=i,n}function Soe(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function Av(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function vv(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n}function bv(n,e,t){return n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n}function _oe(n,e){return n[0]=Math.ceil(e[0]),n[1]=Math.ceil(e[1]),n[2]=Math.ceil(e[2]),n}function yoe(n,e){return n[0]=Math.floor(e[0]),n[1]=Math.floor(e[1]),n[2]=Math.floor(e[2]),n}function Toe(n,e,t){return n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.min(e[2],t[2]),n}function Eoe(n,e,t){return n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n}function koe(n,e){return n[0]=Math.round(e[0]),n[1]=Math.round(e[1]),n[2]=Math.round(e[2]),n}function Moe(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function Doe(n,e,t,i){return n[0]=e[0]+t[0]*i,n[1]=e[1]+t[1]*i,n[2]=e[2]+t[2]*i,n}function Sv(n,e){var t=e[0]-n[0],i=e[1]-n[1],r=e[2]-n[2];return Math.hypot(t,i,r)}function _v(n,e){var t=e[0]-n[0],i=e[1]-n[1],r=e[2]-n[2];return t*t+i*i+r*r}function yv(n){var e=n[0],t=n[1],i=n[2];return e*e+t*t+i*i}function Coe(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function Loe(n,e){return n[0]=1/e[0],n[1]=1/e[1],n[2]=1/e[2],n}function Ax(n,e){var t=e[0],i=e[1],r=e[2],o=t*t+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n}function fd(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Xc(n,e,t){var i=e[0],r=e[1],o=e[2],s=t[0],l=t[1],c=t[2];return n[0]=r*c-o*l,n[1]=o*s-i*c,n[2]=i*l-r*s,n}function Poe(n,e,t,i){var r=e[0],o=e[1],s=e[2];return n[0]=r+i*(t[0]-r),n[1]=o+i*(t[1]-o),n[2]=s+i*(t[2]-s),n}function Roe(n,e,t,i,r,o){var s=o*o,l=s*(2*o-3)+1,c=s*(o-2)+o,u=s*(o-1),p=s*(3-2*o);return n[0]=e[0]*l+t[0]*c+i[0]*u+r[0]*p,n[1]=e[1]*l+t[1]*c+i[1]*u+r[1]*p,n[2]=e[2]*l+t[2]*c+i[2]*u+r[2]*p,n}function Ioe(n,e,t,i,r,o){var s=1-o,l=s*s,c=o*o,u=l*s,p=3*o*l,d=3*c*s,h=c*o;return n[0]=e[0]*u+t[0]*p+i[0]*d+r[0]*h,n[1]=e[1]*u+t[1]*p+i[1]*d+r[1]*h,n[2]=e[2]*u+t[2]*p+i[2]*d+r[2]*h,n}function Boe(n,e){e=e||1;var t=Pr()*2*Math.PI,i=Pr()*2-1,r=Math.sqrt(1-i*i)*e;return n[0]=Math.cos(t)*r,n[1]=Math.sin(t)*r,n[2]=i*e,n}function Voe(n,e,t){var i=e[0],r=e[1],o=e[2],s=t[3]*i+t[7]*r+t[11]*o+t[15];return s=s||1,n[0]=(t[0]*i+t[4]*r+t[8]*o+t[12])/s,n[1]=(t[1]*i+t[5]*r+t[9]*o+t[13])/s,n[2]=(t[2]*i+t[6]*r+t[10]*o+t[14])/s,n}function Ooe(n,e,t){var i=e[0],r=e[1],o=e[2];return n[0]=i*t[0]+r*t[3]+o*t[6],n[1]=i*t[1]+r*t[4]+o*t[7],n[2]=i*t[2]+r*t[5]+o*t[8],n}function Noe(n,e,t){var i=t[0],r=t[1],o=t[2],s=t[3],l=e[0],c=e[1],u=e[2],p=r*u-o*c,d=o*l-i*u,h=i*c-r*l,A=r*h-o*d,g=o*p-i*h,F=i*d-r*p,b=s*2;return p*=b,d*=b,h*=b,A*=2,g*=2,F*=2,n[0]=l+p+A,n[1]=c+d+g,n[2]=u+h+F,n}function Woe(n,e,t,i){var r=[],o=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function Hoe(n,e,t,i){var r=[],o=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function Uoe(n,e,t,i){var r=[],o=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function zoe(n,e){var t=n[0],i=n[1],r=n[2],o=e[0],s=e[1],l=e[2],c=Math.sqrt(t*t+i*i+r*r),u=Math.sqrt(o*o+s*s+l*l),p=c*u,d=p&&fd(n,e)/p;return Math.acos(Math.min(Math.max(d,-1),1))}function joe(n){return n[0]=0,n[1]=0,n[2]=0,n}function Goe(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function Xoe(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}function qoe(n,e){var t=n[0],i=n[1],r=n[2],o=e[0],s=e[1],l=e[2];return Math.abs(t-o)<=ii*Math.max(1,Math.abs(t),Math.abs(o))&&Math.abs(i-s)<=ii*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-l)<=ii*Math.max(1,Math.abs(r),Math.abs(l))}var Yoe=Av,Koe=vv,Qoe=bv,$oe=Sv,Joe=_v,vx=Fv,Zoe=yv,ese=function(){var n=hd();return function(e,t,i,r,o,s){var l,c;for(t||(t=3),i||(i=0),r?c=Math.min(r*t+i,e.length):c=e.length,l=i;l<c;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],o(n,n,s),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2];return e}}();function tse(){var n=new hn(4);return hn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Tv(n){var e=new hn(4);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function Ev(n,e,t,i){var r=new hn(4);return r[0]=n,r[1]=e,r[2]=t,r[3]=i,r}function kv(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function Mv(n,e,t,i,r){return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function Dv(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n}function Cv(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function Lv(n){var e=n[0],t=n[1],i=n[2],r=n[3];return Math.hypot(e,t,i,r)}function Pv(n){var e=n[0],t=n[1],i=n[2],r=n[3];return e*e+t*t+i*i+r*r}function Rv(n,e){var t=e[0],i=e[1],r=e[2],o=e[3],s=t*t+i*i+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),n[0]=t*s,n[1]=i*s,n[2]=r*s,n[3]=o*s,n}function Iv(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function Bv(n,e,t,i){var r=e[0],o=e[1],s=e[2],l=e[3];return n[0]=r+i*(t[0]-r),n[1]=o+i*(t[1]-o),n[2]=s+i*(t[2]-s),n[3]=l+i*(t[3]-l),n}function Vv(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]}function Ov(n,e){var t=n[0],i=n[1],r=n[2],o=n[3],s=e[0],l=e[1],c=e[2],u=e[3];return Math.abs(t-s)<=ii*Math.max(1,Math.abs(t),Math.abs(s))&&Math.abs(i-l)<=ii*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=ii*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(o-u)<=ii*Math.max(1,Math.abs(o),Math.abs(u))}var $fe=function(){var n=tse();return function(e,t,i,r,o,s){var l,c;for(t||(t=4),i||(i=0),r?c=Math.min(r*t+i,e.length):c=e.length,l=i;l<c;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],n[3]=e[l+3],o(n,n,s),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2],e[l+3]=n[3];return e}}();function bx(){var n=new hn(4);return hn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function ise(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Nv(n,e,t){t=t*.5;var i=Math.sin(t);return n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=Math.cos(t),n}function rse(n,e){var t=Math.acos(e[3])*2,i=Math.sin(t/2);return i>ii?(n[0]=e[0]/i,n[1]=e[1]/i,n[2]=e[2]/i):(n[0]=1,n[1]=0,n[2]=0),t}function ose(n,e){var t=Gv(n,e);return Math.acos(2*t*t-1)}function Wv(n,e,t){var i=e[0],r=e[1],o=e[2],s=e[3],l=t[0],c=t[1],u=t[2],p=t[3];return n[0]=i*p+s*l+r*u-o*c,n[1]=r*p+s*c+o*l-i*u,n[2]=o*p+s*u+i*c-r*l,n[3]=s*p-i*l-r*c-o*u,n}function sse(n,e,t){t*=.5;var i=e[0],r=e[1],o=e[2],s=e[3],l=Math.sin(t),c=Math.cos(t);return n[0]=i*c+s*l,n[1]=r*c+o*l,n[2]=o*c-r*l,n[3]=s*c-i*l,n}function ase(n,e,t){t*=.5;var i=e[0],r=e[1],o=e[2],s=e[3],l=Math.sin(t),c=Math.cos(t);return n[0]=i*c-o*l,n[1]=r*c+s*l,n[2]=o*c+i*l,n[3]=s*c-r*l,n}function lse(n,e,t){t*=.5;var i=e[0],r=e[1],o=e[2],s=e[3],l=Math.sin(t),c=Math.cos(t);return n[0]=i*c+r*l,n[1]=r*c-i*l,n[2]=o*c+s*l,n[3]=s*c-o*l,n}function cse(n,e){var t=e[0],i=e[1],r=e[2];return n[0]=t,n[1]=i,n[2]=r,n[3]=Math.sqrt(Math.abs(1-t*t-i*i-r*r)),n}function Hv(n,e){var t=e[0],i=e[1],r=e[2],o=e[3],s=Math.sqrt(t*t+i*i+r*r),l=Math.exp(o),c=s>0?l*Math.sin(s)/s:0;return n[0]=t*c,n[1]=i*c,n[2]=r*c,n[3]=l*Math.cos(s),n}function Uv(n,e){var t=e[0],i=e[1],r=e[2],o=e[3],s=Math.sqrt(t*t+i*i+r*r),l=s>0?Math.atan2(s,o)/s:0;return n[0]=t*l,n[1]=i*l,n[2]=r*l,n[3]=.5*Math.log(t*t+i*i+r*r+o*o),n}function use(n,e,t){return Uv(n,e),jv(n,n,t),Hv(n,n),n}function gd(n,e,t,i){var r=e[0],o=e[1],s=e[2],l=e[3],c=t[0],u=t[1],p=t[2],d=t[3],h,A,g,F,b;return A=r*c+o*u+s*p+l*d,A<0&&(A=-A,c=-c,u=-u,p=-p,d=-d),1-A>ii?(h=Math.acos(A),g=Math.sin(h),F=Math.sin((1-i)*h)/g,b=Math.sin(i*h)/g):(F=1-i,b=i),n[0]=F*r+b*c,n[1]=F*o+b*u,n[2]=F*s+b*p,n[3]=F*l+b*d,n}function pse(n){var e=Pr(),t=Pr(),i=Pr(),r=Math.sqrt(1-e),o=Math.sqrt(e);return n[0]=r*Math.sin(2*Math.PI*t),n[1]=r*Math.cos(2*Math.PI*t),n[2]=o*Math.sin(2*Math.PI*i),n[3]=o*Math.cos(2*Math.PI*i),n}function dse(n,e){var t=e[0],i=e[1],r=e[2],o=e[3],s=t*t+i*i+r*r+o*o,l=s?1/s:0;return n[0]=-t*l,n[1]=-i*l,n[2]=-r*l,n[3]=o*l,n}function hse(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function zv(n,e){var t=e[0]+e[4]+e[8],i;if(t>0)i=Math.sqrt(t+1),n[3]=.5*i,i=.5/i,n[0]=(e[5]-e[7])*i,n[1]=(e[6]-e[2])*i,n[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);var o=(r+1)%3,s=(r+2)%3;i=Math.sqrt(e[r*3+r]-e[o*3+o]-e[s*3+s]+1),n[r]=.5*i,i=.5/i,n[3]=(e[o*3+s]-e[s*3+o])*i,n[o]=(e[o*3+r]+e[r*3+o])*i,n[s]=(e[s*3+r]+e[r*3+s])*i}return n}function mse(n,e,t,i){var r=.5*Math.PI/180;e*=r,t*=r,i*=r;var o=Math.sin(e),s=Math.cos(e),l=Math.sin(t),c=Math.cos(t),u=Math.sin(i),p=Math.cos(i);return n[0]=o*c*p-s*l*u,n[1]=s*l*p+o*c*u,n[2]=s*c*u-o*l*p,n[3]=s*c*p+o*l*u,n}function fse(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"}var gse=Tv,xse=Ev,wse=kv,Fse=Mv,Ase=Dv,vse=Wv,jv=Cv,Gv=Iv,bse=Bv,Xv=Lv,Sse=Xv,qv=Pv,_se=qv,Sx=Rv,yse=Vv,Tse=Ov,Ese=function(){var n=hd(),e=md(1,0,0),t=md(0,1,0);return function(i,r,o){var s=fd(r,o);return s<-.999999?(Xc(n,e,r),vx(n)<1e-6&&Xc(n,t,r),Ax(n,n),Nv(i,n,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Xc(n,r,o),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=1+s,Sx(i,i))}}(),kse=function(){var n=bx(),e=bx();return function(t,i,r,o,s,l){return gd(n,i,s,l),gd(e,r,o,l),gd(t,n,e,2*l*(1-l)),t}}(),Mse=function(){var n=wv();return function(e,t,i,r){return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],Sx(e,zv(e,n))}}();var lt={};ti(lt,{add:()=>Rse,angle:()=>eae,ceil:()=>Ise,clone:()=>Dse,copy:()=>Lse,create:()=>Yv,cross:()=>Xse,dist:()=>cae,distance:()=>Jv,div:()=>lae,divide:()=>$v,dot:()=>Gse,equals:()=>rae,exactEquals:()=>iae,floor:()=>Bse,forEach:()=>dae,fromValues:()=>Cse,inverse:()=>zse,len:()=>oae,length:()=>eb,lerp:()=>qse,max:()=>Ose,min:()=>Vse,mul:()=>aae,multiply:()=>Qv,negate:()=>Use,normalize:()=>jse,random:()=>Yse,rotate:()=>Zse,round:()=>Nse,scale:()=>Wse,scaleAndAdd:()=>Hse,set:()=>Pse,sqrDist:()=>uae,sqrLen:()=>pae,squaredDistance:()=>Zv,squaredLength:()=>tb,str:()=>nae,sub:()=>sae,subtract:()=>Kv,transformMat2:()=>Kse,transformMat2d:()=>Qse,transformMat3:()=>$se,transformMat4:()=>Jse,zero:()=>tae});function Yv(){var n=new hn(2);return hn!=Float32Array&&(n[0]=0,n[1]=0),n}function Dse(n){var e=new hn(2);return e[0]=n[0],e[1]=n[1],e}function Cse(n,e){var t=new hn(2);return t[0]=n,t[1]=e,t}function Lse(n,e){return n[0]=e[0],n[1]=e[1],n}function Pse(n,e,t){return n[0]=e,n[1]=t,n}function Rse(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function Kv(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}function Qv(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n}function $v(n,e,t){return n[0]=e[0]/t[0],n[1]=e[1]/t[1],n}function Ise(n,e){return n[0]=Math.ceil(e[0]),n[1]=Math.ceil(e[1]),n}function Bse(n,e){return n[0]=Math.floor(e[0]),n[1]=Math.floor(e[1]),n}function Vse(n,e,t){return n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n}function Ose(n,e,t){return n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n}function Nse(n,e){return n[0]=Math.round(e[0]),n[1]=Math.round(e[1]),n}function Wse(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n}function Hse(n,e,t,i){return n[0]=e[0]+t[0]*i,n[1]=e[1]+t[1]*i,n}function Jv(n,e){var t=e[0]-n[0],i=e[1]-n[1];return Math.hypot(t,i)}function Zv(n,e){var t=e[0]-n[0],i=e[1]-n[1];return t*t+i*i}function eb(n){var e=n[0],t=n[1];return Math.hypot(e,t)}function tb(n){var e=n[0],t=n[1];return e*e+t*t}function Use(n,e){return n[0]=-e[0],n[1]=-e[1],n}function zse(n,e){return n[0]=1/e[0],n[1]=1/e[1],n}function jse(n,e){var t=e[0],i=e[1],r=t*t+i*i;return r>0&&(r=1/Math.sqrt(r)),n[0]=e[0]*r,n[1]=e[1]*r,n}function Gse(n,e){return n[0]*e[0]+n[1]*e[1]}function Xse(n,e,t){var i=e[0]*t[1]-e[1]*t[0];return n[0]=n[1]=0,n[2]=i,n}function qse(n,e,t,i){var r=e[0],o=e[1];return n[0]=r+i*(t[0]-r),n[1]=o+i*(t[1]-o),n}function Yse(n,e){e=e||1;var t=Pr()*2*Math.PI;return n[0]=Math.cos(t)*e,n[1]=Math.sin(t)*e,n}function Kse(n,e,t){var i=e[0],r=e[1];return n[0]=t[0]*i+t[2]*r,n[1]=t[1]*i+t[3]*r,n}function Qse(n,e,t){var i=e[0],r=e[1];return n[0]=t[0]*i+t[2]*r+t[4],n[1]=t[1]*i+t[3]*r+t[5],n}function $se(n,e,t){var i=e[0],r=e[1];return n[0]=t[0]*i+t[3]*r+t[6],n[1]=t[1]*i+t[4]*r+t[7],n}function Jse(n,e,t){var i=e[0],r=e[1];return n[0]=t[0]*i+t[4]*r+t[12],n[1]=t[1]*i+t[5]*r+t[13],n}function Zse(n,e,t,i){var r=e[0]-t[0],o=e[1]-t[1],s=Math.sin(i),l=Math.cos(i);return n[0]=r*l-o*s+t[0],n[1]=r*s+o*l+t[1],n}function eae(n,e){var t=n[0],i=n[1],r=e[0],o=e[1],s=Math.sqrt(t*t+i*i)*Math.sqrt(r*r+o*o),l=s&&(t*r+i*o)/s;return Math.acos(Math.min(Math.max(l,-1),1))}function tae(n){return n[0]=0,n[1]=0,n}function nae(n){return"vec2("+n[0]+", "+n[1]+")"}function iae(n,e){return n[0]===e[0]&&n[1]===e[1]}function rae(n,e){var t=n[0],i=n[1],r=e[0],o=e[1];return Math.abs(t-r)<=ii*Math.max(1,Math.abs(t),Math.abs(r))&&Math.abs(i-o)<=ii*Math.max(1,Math.abs(i),Math.abs(o))}var oae=eb,sae=Kv,aae=Qv,lae=$v,cae=Jv,uae=Zv,pae=tb,dae=function(){var n=Yv();return function(e,t,i,r,o,s){var l,c;for(t||(t=2),i||(i=0),r?c=Math.min(r*t+i,e.length):c=e.length,l=i;l<c;l+=t)n[0]=e[l],n[1]=e[l+1],o(n,n,s),e[l]=n[0],e[l+1]=n[1];return e}}();var en=Math.PI,an=.5*en,Vn=2*en;var hae=864e13,ege=-hae;function Bo(n){return(n%Vn+Vn)%Vn}function ri(n,e,t){return Math.min(t,Math.max(e,n))}function je(n){return n*Vn/360}function Lt(n){return n*360/Vn}function nb(...n){let e=Number.MAX_VALUE;for(let t of n)Math.abs(t)<e&&(e=t);return e}function qc(n,e,t){let i=t-e;return i===0?0:(n-e)/i}function mae(n,e,t){return n*(t-e)+e}function It(n,e=0){return mt(n)?n.toFixed(e):""}function Ht(n){return/\d+/.test(n)?parseFloat(n):null}function xd(n){return mt(n)?ri(mae(n,0,100),0,100).toFixed(0):""}function wd(n){return/\d+/.test(n)?ri(qc(parseInt(n,10),0,100),0,1):null}function ib(n,e,t){return(1-t)*n+t*e}function _x(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function rb(n){return Math.abs(n)>1e-4?n:0}var{ACESFilmicToneMapping:nge,AddEquation:ige,AddOperation:rge,AdditiveAnimationBlendMode:oge,AdditiveBlending:sge,AlphaFormat:age,AlwaysDepth:lge,AlwaysStencilFunc:cge,AmbientLight:Fd,AmbientLightProbe:uge,AnimationClip:ob,AnimationLoader:pge,AnimationMixer:dge,AnimationObjectGroup:hge,AnimationUtils:mge,ArcCurve:fge,ArrayCamera:gge,ArrowHelper:xge,Audio:wge,AudioAnalyser:Fge,AudioContext:Age,AudioListener:vge,AudioLoader:bge,AxesHelper:Sge,BackSide:sb,BasicDepthPacking:_ge,BasicShadowMap:yge,Bone:ab,BooleanKeyframeTrack:Tge,Box2:Ege,Box3:Ps,Box3Helper:kge,BoxBufferGeometry:Mge,BoxGeometry:Ad,BoxHelper:Dge,BufferAttribute:lo,BufferGeometry:Yc,BufferGeometryLoader:Cge,ByteType:Lge,Cache:Pge,Camera:Rge,CameraHelper:Ige,CanvasTexture:lb,CapsuleBufferGeometry:Bge,CapsuleGeometry:Vge,CatmullRomCurve3:Oge,CineonToneMapping:Nge,CircleBufferGeometry:Wge,CircleGeometry:Hge,ClampToEdgeWrapping:cb,Clock:Uge,Color:Sn,ColorKeyframeTrack:zge,ColorManagement:yx,CompressedArrayTexture:jge,CompressedTexture:Gge,CompressedTextureLoader:Xge,ConeBufferGeometry:qge,ConeGeometry:ub,CubeCamera:pb,CubeReflectionMapping:Yge,CubeRefractionMapping:Kge,CubeTexture:db,CubeTextureLoader:Qge,CubeUVReflectionMapping:$ge,CubicBezierCurve:Jge,CubicBezierCurve3:Zge,CubicInterpolant:exe,CullFaceBack:txe,CullFaceFront:nxe,CullFaceFrontBack:ixe,CullFaceNone:rxe,Curve:oxe,CurvePath:sxe,CustomBlending:axe,CustomToneMapping:lxe,CylinderBufferGeometry:cxe,CylinderGeometry:hb,Cylindrical:uxe,Data3DTexture:pxe,DataArrayTexture:dxe,DataTexture:hxe,DataTextureLoader:mxe,DataUtils:fxe,DecrementStencilOp:gxe,DecrementWrapStencilOp:xxe,DefaultLoadingManager:wxe,DepthFormat:Fxe,DepthStencilFormat:Axe,DepthTexture:vxe,DirectionalLight:vd,DirectionalLightHelper:bxe,DiscreteInterpolant:Sxe,DisplayP3ColorSpace:_xe,DodecahedronBufferGeometry:yxe,DodecahedronGeometry:Txe,DoubleSide:bd,DstAlphaFactor:Exe,DstColorFactor:kxe,DynamicCopyUsage:Mxe,DynamicDrawUsage:mb,DynamicReadUsage:Dxe,EdgesGeometry:Cxe,EllipseCurve:Lxe,EqualDepth:Pxe,EqualStencilFunc:Rxe,EquirectangularReflectionMapping:Ixe,EquirectangularRefractionMapping:Bxe,Euler:Rr,EventDispatcher:Vxe,ExtrudeBufferGeometry:Oxe,ExtrudeGeometry:fb,FileLoader:Tx,Float16BufferAttribute:Nxe,Float32BufferAttribute:Sd,Float64BufferAttribute:Wxe,FloatType:Hxe,Fog:Uxe,FogExp2:zxe,FramebufferTexture:jxe,FrontSide:Rs,Frustum:Gxe,GLBufferAttribute:Xxe,GLSL1:qxe,GLSL3:Yxe,GreaterDepth:Kxe,GreaterEqualDepth:Qxe,GreaterEqualStencilFunc:$xe,GreaterStencilFunc:Jxe,GridHelper:gb,Group:Ga,HalfFloatType:Zxe,HemisphereLight:ewe,HemisphereLightHelper:twe,HemisphereLightProbe:nwe,IcosahedronBufferGeometry:iwe,IcosahedronGeometry:rwe,ImageBitmapLoader:xb,ImageLoader:owe,ImageUtils:swe,IncrementStencilOp:awe,IncrementWrapStencilOp:lwe,InstancedBufferAttribute:fae,InstancedBufferGeometry:wb,InstancedInterleavedBuffer:Kc,InstancedMesh:_d,Int16BufferAttribute:cwe,Int32BufferAttribute:uwe,Int8BufferAttribute:pwe,IntType:dwe,InterleavedBuffer:Ex,InterleavedBufferAttribute:dr,Interpolant:Fb,InterpolateDiscrete:Ab,InterpolateLinear:kx,InterpolateSmooth:hwe,InvertStencilOp:mwe,KeepStencilOp:fwe,KeyframeTrack:gwe,LOD:xwe,LatheBufferGeometry:wwe,LatheGeometry:Fwe,Layers:Awe,LessDepth:vwe,LessEqualDepth:bwe,LessEqualStencilFunc:Swe,LessStencilFunc:_we,Light:ywe,LightProbe:Twe,Line:vb,Line3:bb,LineBasicMaterial:Mx,LineCurve:Ewe,LineCurve3:kwe,LineDashedMaterial:Mwe,LineLoop:Sb,LineSegments:_b,LinearEncoding:yb,LinearFilter:Qc,LinearInterpolant:Dwe,LinearMipMapLinearFilter:Cwe,LinearMipMapNearestFilter:Lwe,LinearMipmapLinearFilter:Dx,LinearMipmapNearestFilter:Tb,LinearSRGBColorSpace:Pwe,LinearToneMapping:Rwe,Loader:Eb,LoaderUtils:yd,LoadingManager:Iwe,LoopOnce:Bwe,LoopPingPong:Vwe,LoopRepeat:Owe,LuminanceAlphaFormat:Nwe,LuminanceFormat:Wwe,MOUSE:Hwe,Material:Td,MaterialLoader:Uwe,MathUtils:Ed,Matrix3:Cx,Matrix4:vt,MaxEquation:zwe,Mesh:qn,MeshBasicMaterial:Yn,MeshDepthMaterial:jwe,MeshDistanceMaterial:Gwe,MeshLambertMaterial:Xwe,MeshMatcapMaterial:qwe,MeshNormalMaterial:Ywe,MeshPhongMaterial:Is,MeshPhysicalMaterial:Vo,MeshStandardMaterial:Lx,MeshToonMaterial:Kwe,MinEquation:Qwe,MirroredRepeatWrapping:kb,MixOperation:$we,MultiplyBlending:Jwe,MultiplyOperation:Zwe,NearestFilter:kd,NearestMipMapLinearFilter:e1e,NearestMipMapNearestFilter:t1e,NearestMipmapLinearFilter:Mb,NearestMipmapNearestFilter:Db,NeverDepth:n1e,NeverStencilFunc:i1e,NoBlending:r1e,NoColorSpace:o1e,NoToneMapping:s1e,NormalAnimationBlendMode:a1e,NormalBlending:l1e,NotEqualDepth:c1e,NotEqualStencilFunc:u1e,NumberKeyframeTrack:Cb,Object3D:pt,ObjectLoader:p1e,ObjectSpaceNormalMap:d1e,OctahedronBufferGeometry:h1e,OctahedronGeometry:m1e,OneFactor:f1e,OneMinusDstAlphaFactor:g1e,OneMinusDstColorFactor:x1e,OneMinusSrcAlphaFactor:w1e,OneMinusSrcColorFactor:F1e,OrthographicCamera:Md,PCFShadowMap:A1e,PCFSoftShadowMap:v1e,PMREMGenerator:b1e,Path:S1e,PerspectiveCamera:Bs,Plane:_1e,PlaneBufferGeometry:y1e,PlaneGeometry:Oo,PlaneHelper:T1e,PointLight:Lb,PointLightHelper:E1e,Points:Pb,PointsMaterial:Rb,PolarGridHelper:k1e,PolyhedronBufferGeometry:M1e,PolyhedronGeometry:D1e,PositionalAudio:C1e,PropertyBinding:Ib,PropertyMixer:L1e,QuadraticBezierCurve:P1e,QuadraticBezierCurve3:R1e,Quaternion:it,QuaternionKeyframeTrack:Px,QuaternionLinearInterpolant:I1e,RED_GREEN_RGTC2_Format:B1e,RED_RGTC1_Format:V1e,REVISION:O1e,RGBADepthPacking:N1e,RGBAFormat:Bb,RGBAIntegerFormat:W1e,RGBA_ASTC_10x10_Format:H1e,RGBA_ASTC_10x5_Format:U1e,RGBA_ASTC_10x6_Format:z1e,RGBA_ASTC_10x8_Format:j1e,RGBA_ASTC_12x10_Format:G1e,RGBA_ASTC_12x12_Format:X1e,RGBA_ASTC_4x4_Format:q1e,RGBA_ASTC_5x4_Format:Y1e,RGBA_ASTC_5x5_Format:K1e,RGBA_ASTC_6x5_Format:Q1e,RGBA_ASTC_6x6_Format:$1e,RGBA_ASTC_8x5_Format:J1e,RGBA_ASTC_8x6_Format:Z1e,RGBA_ASTC_8x8_Format:e0e,RGBA_BPTC_Format:t0e,RGBA_ETC2_EAC_Format:n0e,RGBA_PVRTC_2BPPV1_Format:i0e,RGBA_PVRTC_4BPPV1_Format:r0e,RGBA_S3TC_DXT1_Format:o0e,RGBA_S3TC_DXT3_Format:s0e,RGBA_S3TC_DXT5_Format:a0e,RGB_ETC1_Format:l0e,RGB_ETC2_Format:c0e,RGB_PVRTC_2BPPV1_Format:u0e,RGB_PVRTC_4BPPV1_Format:p0e,RGB_S3TC_DXT1_Format:d0e,RGFormat:h0e,RGIntegerFormat:m0e,RawShaderMaterial:f0e,Ray:g0e,Raycaster:Vb,RectAreaLight:x0e,RedFormat:w0e,RedIntegerFormat:F0e,ReinhardToneMapping:A0e,RepeatWrapping:Dd,ReplaceStencilOp:v0e,ReverseSubtractEquation:b0e,RingBufferGeometry:S0e,RingGeometry:_0e,SIGNED_RED_GREEN_RGTC2_Format:y0e,SIGNED_RED_RGTC1_Format:T0e,SRGBColorSpace:Xa,Scene:No,ShaderChunk:E0e,ShaderLib:$c,ShaderMaterial:Cd,ShadowMaterial:k0e,Shape:Ob,ShapeBufferGeometry:M0e,ShapeGeometry:D0e,ShapePath:C0e,ShapeUtils:L0e,ShortType:P0e,Skeleton:Nb,SkeletonHelper:R0e,SkinnedMesh:Wb,Source:I0e,Sphere:qa,SphereBufferGeometry:B0e,SphereGeometry:Ya,Spherical:V0e,SphericalHarmonics3:O0e,SplineCurve:N0e,SpotLight:Hb,SpotLightHelper:W0e,Sprite:H0e,SpriteMaterial:gae,SrcAlphaFactor:U0e,SrcAlphaSaturateFactor:z0e,SrcColorFactor:j0e,StaticCopyUsage:G0e,StaticDrawUsage:X0e,StaticReadUsage:q0e,StereoCamera:Ub,StreamCopyUsage:Y0e,StreamDrawUsage:K0e,StreamReadUsage:Q0e,StringKeyframeTrack:$0e,SubtractEquation:J0e,SubtractiveBlending:Z0e,TOUCH:eFe,TangentSpaceNormalMap:tFe,TetrahedronBufferGeometry:nFe,TetrahedronGeometry:iFe,Texture:Vs,TextureLoader:zb,TorusBufferGeometry:rFe,TorusGeometry:oFe,TorusKnotBufferGeometry:sFe,TorusKnotGeometry:aFe,Triangle:lFe,TriangleFanDrawMode:Jc,TriangleStripDrawMode:Ld,TrianglesDrawMode:jb,TubeBufferGeometry:cFe,TubeGeometry:uFe,TwoPassDoubleSide:pFe,UVMapping:dFe,Uint16BufferAttribute:hFe,Uint32BufferAttribute:mFe,Uint8BufferAttribute:fFe,Uint8ClampedBufferAttribute:gFe,Uniform:xFe,UniformsGroup:wFe,UniformsLib:Zc,UniformsUtils:Rx,UnsignedByteType:FFe,UnsignedInt248Type:AFe,UnsignedIntType:vFe,UnsignedShort4444Type:bFe,UnsignedShort5551Type:SFe,UnsignedShortType:_Fe,VSMShadowMap:yFe,Vector2:ln,Vector3:Se,Vector4:Ir,VectorKeyframeTrack:Gb,VideoTexture:Xb,WebGL1Renderer:TFe,WebGL3DRenderTarget:EFe,WebGLArrayRenderTarget:kFe,WebGLCubeRenderTarget:qb,WebGLMultipleRenderTargets:MFe,WebGLRenderTarget:Ix,WebGLRenderer:Pd,WebGLUtils:DFe,WireframeGeometry:Yb,WrapAroundEnding:CFe,ZeroCurvatureEnding:LFe,ZeroFactor:PFe,ZeroSlopeEnding:RFe,ZeroStencilOp:IFe,_SRGBAFormat:BFe,sRGBEncoding:Kb}=THREE;var Rd=new ub(1,1,10,5);Rd.name="ConeGeom";Rd.computeBoundingBox();Rd.computeBoundingSphere();var Bx=class extends qn{constructor(e,t,i,r){super(Rd,r),this.scale.set(e,t,i)}};function Vx(n,e,t,i,r){let o=new Bx(e,t,i,r);return o.name=n,o}function Id(n){let e=n.attributes.position,t=n.attributes.normal,i=n.attributes.uv;for(let r=0;r<t.count;++r){let o=r*t.itemSize,s=r*t.itemSize+1,l=r*t.itemSize+2,c=t.array[o],u=t.array[s],p=t.array[l],d=Math.abs(c),h=Math.abs(u),A=Math.abs(p),g=e.array[o],F=e.array[s],b=e.array[l],R=Math.abs(g),P=Math.abs(F),L=Math.abs(b),S=r*i.itemSize,x=r*i.itemSize+1,v=i.array[S],M=i.array[x],O=0,B=d,X=R;h>B&&(O=1,B=h,X=P),A>B&&(O=2,B=A,X=L),O===0?g<0?(v=-b,M=F):(v=b,M=F):O===1?F<0?(v=g,M=-b):(v=g,M=b):b<0?(v=g,M=F):(v=-g,M=F),v=(v/X+1)/8,M=(M/X+1)/6,O===0?g<0?(v+=0,M+=1/3):(v+=.5,M+=1/3):O===1?F<0?(v+=.25,M+=0):(v+=.25,M+=2/3):b<0?(v+=.25,M+=1/3):(v+=.75,M+=1/3);let V=i.array;V[S]=v,V[x]=M}}var eu=new Ad(1,1,1,1,1,1);eu.name="CubeGeom";eu.computeBoundingBox();eu.computeBoundingSphere();var Qb=eu.clone();Qb.name="InvertedCubeGeom";Id(Qb);var Ei=class extends qn{constructor(e,t,i,r){super(eu,r),this.scale.set(e,t,i)}};function tu(n,e,t,i,r){let o=new Ei(e,t,i,r);return o.name=n,o}var tn;(function(n){n[n.Primary=0]="Primary",n[n.Secondary=1]="Secondary",n[n.Menu=2]="Menu",n[n.Info=3]="Info"})(tn||(tn={}));function Kn(n){return y(n)&&n.isMesh}function Ox(n){return y(n)&&n.isMaterial}function Bd(n,e){return Ox(e)&&e.type===n}function $b(n){return Bd("MeshBasicMaterial",n)}function nu(n){return Bd("MeshStandardMaterial",n)}function iu(n){return Bd("MeshPhongMaterial",n)}function ru(n){return Bd("MeshPhysicalMaterial",n)}function Nx(n){return y(n)&&n.isObject3D}function Jb(n){return y(n)&&n.isQuaternion}function Zb(n){return y(n)&&n.isEuler}function Os(n){return y(n)&&Nx(n.object)}function eS(n){return Os(n)||Nx(n)}function kn(n){return Os(n)?n.object:n}function nn(n,e){return n=kn(n),n.visible=e,e}function Ka(n){return n=kn(n),n.visible}function Vd(n){if(!n)return!1;for(n=kn(n);n;){if(!n.visible)return!1;n=n.parent}return!0}function De(n,...e){let t=e.filter(y).map(kn);return t.length>0&&kn(n).add(...t),n}function tS(n){n=kn(n),y(n)&&n.removeFromParent()}function ft(n,...e){let t=new pt;return t.name=n,De(t,...e),t}function Od(n,e){n=kn(n),Po(n)&&(n.disabled=!e)}function nS(n,e){n=kn(n);let t=n.parent;n.removeFromParent(),n.position.copy(e),y(t)&&t.attach(n)}function hr(n,e,t){let i=new qn(e,t);return i.name=n,i}var Nd="Juniper:ThreeJS:EventSystem:RayTarget",Qn=class extends Be{constructor(e){super(),this.object=e,this.meshes=new Array,this._disabled=!1,this._clickable=!1,this._draggable=!1,this._navigable=!1,this.object.userData[Nd]=this}addMesh(e){return e.userData[Nd]=this,this.meshes.push(e),this}removeMesh(e){return Pt(this.meshes,e)&&delete e.userData[Nd],this}addMeshes(...e){for(let t of e)this.addMesh(t);return this}removeMeshes(...e){for(let t of e)this.removeMesh(t);return this}get disabled(){return this._disabled}set disabled(e){this._disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get clickable(){return this._clickable}set clickable(e){this._clickable=e}get draggable(){return this._draggable}set draggable(e){this._draggable=e}get navigable(){return this._navigable}set navigable(e){this._navigable=e}};function xae(n){return n instanceof Qn}function Wo(n){let e=null;return n&&(xae(n)?e=n:(n=kn(n),n&&(e=n.userData[Nd])),e&&!Vd(e)&&(e=null)),e}Zc.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new ln(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};$c.line={uniforms:Rx.merge([Zc.common,Zc.fog,Zc.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var co=class extends Cd{constructor(e){super({type:"LineMaterial",uniforms:Rx.clone($c.line.uniforms),vertexShader:$c.line.vertexShader,fragmentShader:$c.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}};co.prototype.isLineMaterial=!0;var Wx=di("Juniper:Three:Materials",()=>new Map);function wae(n,e){e in n&&delete n[e]}function ou(n,e,t){let i=`${n}_${Object.keys(t).map(r=>`${r}:${t[r]}`).join(",")}`;return Wx.has(i)||(wae(t,"name"),Wx.set(i,new e(t))),Wx.get(i)}function iS(n){return Object.assign(n,{transparent:!0})}function Hx(n){return ou("solid",Yn,n)}function Qa(n){return ou("solidTransparent",Yn,iS(n))}function Ux(n){return ou("lit",Is,n)}function Wd(n){return ou("litTransparent",Is,iS(n))}function rS(n){return ou("line2",co,n)}function Ns(n,e){let t=new Set;n.traverse(i=>{if(Kn(i)&&Ox(i.material)){let r=i.material,o=e(r);r!==o&&(t.add(r),i.material=o)}});for(let i of t)Io(i)}function oS(n){if(n.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let e={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,dithering:n.dithering,envMap:n.envMap,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.emissiveMap||n.map,name:n.name+"-Standard-To-Basic",opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,shadowSide:n.shadowSide,side:n.side,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[t,i]of Object.entries(e))oe(i)&&delete e[t];return new Yn(e)}function Ws(n){if(n.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let e={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,bumpMap:n.bumpMap,bumpScale:n.bumpScale,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,displacementBias:n.displacementBias,displacementMap:n.displacementMap,displacementScale:n.displacementScale,dithering:n.dithering,emissive:n.emissive,emissiveIntensity:n.emissiveIntensity,emissiveMap:n.emissiveMap,envMap:n.envMap,flatShading:n.flatShading,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.map,name:n.name+"-Standard-To-Phong",normalMap:n.normalMap,normalMapType:n.normalMapType,normalScale:n.normalScale,opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,shadowSide:n.shadowSide,side:n.side,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[t,i]of Object.entries(e))oe(i)&&delete e[t];return new Is(e)}function sS(n){if(n.type!=="MeshPhysicalMaterial")throw new Error("Input material is not MeshPhysicalMaterial");let e={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,bumpMap:n.bumpMap,bumpScale:n.bumpScale,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,displacementBias:n.displacementBias,displacementMap:n.displacementMap,displacementScale:n.displacementScale,dithering:n.dithering,emissive:n.emissive,emissiveIntensity:n.emissiveIntensity,emissiveMap:n.emissiveMap,envMap:n.envMap,flatShading:n.flatShading,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.map,name:n.name+"-Standard-To-Phong",normalMap:n.normalMap,normalMapType:n.normalMapType,normalScale:n.normalScale,opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,reflectivity:n.reflectivity,shadowSide:n.shadowSide,shininess:n.sheen,side:n.side,specular:n.specularColor,specularMap:n.specularColorMap,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[t,i]of Object.entries(e))oe(i)&&delete e[t];return new Is(e)}var aS=255,zx=65280;var lS=16711680;var Fae=12632256,Hd=16777215;var Ud=Hx({color:Hd});var jx=Ux({color:Fae}),cS=Ux({color:Hd});var su=new Ya(.5);su.name="SphereGeom";su.computeBoundingBox();su.computeBoundingSphere();var uS=su.clone();uS.name="InvertedSphereGeom";Id(uS);var Gx=class extends qn{constructor(e,t){super(su,t),this.scale.setScalar(.5*e)}};function Xx(n,e,t){let i=new Gx(e,t);return i.name=n,i}var Ne;(function(n){n.None="None",n.MoveObjectSpace="Object Move",n.MoveGlobalSpace="Global Move",n.MoveViewSpace="View Move",n.Orbit="Orbit",n.RotateObjectSpace="Object Rotate",n.RotateGlobalSpace="Global Rotate",n.RotateViewSpace="View Rotate",n.Resize="Resize"})(Ne||(Ne={}));var Aae=[Ne.RotateViewSpace,Ne.MoveViewSpace,Ne.Resize,Ne.Orbit,Ne.RotateObjectSpace,Ne.MoveObjectSpace,Ne.RotateGlobalSpace,Ne.MoveGlobalSpace],au=["x","y","z"],Hs=.1,vae=new Map([[1,new it().setFromEuler(new Rr(0,-an,0))],[-1,new it().setFromEuler(new Rr(0,an,0))]]),zd=class extends Be{constructor(e){super(),this.env=e,this.buttons=new Map,this.movingEvt=new ge("moving"),this.movedEvt=new ge("moved"),this.dragging=!1,this.rotationAxisWorld=new Se,this.startWorld=new Se,this.endWorld=new Se,this.startLocal=new Se,this.endLocal=new Se,this.lookDirectionWorld=new Se,this.deltaPosition=new Se,this.deltaQuaternion=new it,this.motionAxisWorld=new Se,this.testObj=new pt,this._mode=null,this._target=null,this.modes=new Array,this.prioritizeTransformerSort=(t,i)=>{let r=Wo(t),o=Wo(i),s=y(r)&&this.translators.indexOf(r)>=0,l=y(o)&&this.translators.indexOf(o)>=0;return s===l?t.distance-i.distance:s?-1:1},this.object=ft("Translator",...this.translators=[this.setTranslator("x","x",lS),this.setTranslator("y","y",zx),this.setTranslator("z","x",aS)]),nn(this,!1),e.timer.addTickHandler(()=>this.refresh()),this.modeButtons=Aae.map(t=>{let i=ka(t,Ye(()=>this.mode=i.classList.contains("btn-secondary")?t:Ne.None));return this.buttons.set(t,i),Ue(i,!1),i})}get target(){return this._target}setTarget(e,t){if(e=kn(e),e!==this.target){this._target=e;let i=y(this.target);nn(this,i),this.refresh()}if(y(e)&&y(t)){un(this.modes,...t);for(let[i,r]of this.buttons)Ue(r,this.modes.indexOf(i)!==-1);this.modes.indexOf(this.mode)===-1&&(this.mode=Ne.None)}}get mode(){return this._mode}set mode(e){if(e!==this.mode){this._mode=e,this.mode==="None"?this.env.eventSys.sortFunction=null:this.env.eventSys.sortFunction=this.prioritizeTransformerSort;for(let t of this.translators)t.mode=e;this.translators[2].object.visible=this.mode!==Ne.None&&this.mode!==Ne.Resize;for(let[t,i]of this.buttons)En(i,t===this.mode,"btn-primary"),En(i,t!==this.mode,"btn-secondary");this.refresh()}}setTranslator(e,t,i){let r=new qx(e,t,i);return r.addEventListener("down",o=>{o.pointer.isPressed(tn.Primary)&&(this.dragging=!0,this.startWorld.copy(o.point),this.mode!==Ne.MoveObjectSpace&&this.mode!==Ne.MoveGlobalSpace&&this.mode!==Ne.MoveViewSpace&&this.mode!==Ne.Orbit&&(this.env.avatar.lockMovement=!0),y(o.hit)?r.selected=o.hit.object:r.selected=null)}),r.addEventListener("move",o=>{if(this.dragging&&o.point){if(this.endWorld.copy(o.point),this.startWorld.manhattanDistanceTo(this.endWorld)>0){if(this.object.worldToLocal(this.startLocal.copy(this.startWorld)),this.object.worldToLocal(this.endLocal.copy(this.endWorld)),this.mode===Ne.Resize){let s=this.startLocal.length(),l=this.endLocal.length();this.target.scale.addScalar(l-s)}else if(this.mode===Ne.RotateObjectSpace||this.mode===Ne.RotateGlobalSpace||this.mode===Ne.RotateViewSpace){this.startLocal.normalize(),this.endLocal.normalize();let s=this.startLocal.dot(this.endLocal);if(-1<=s&&s<=1){let l=this.startLocal.cross(this.endLocal).dot(r.rotationAxisLocal),c=Math.sign(l)*Math.acos(s);this.rotationAxisWorld.copy(r.rotationAxisLocal).applyQuaternion(this.object.quaternion),this.deltaQuaternion.setFromAxisAngle(this.rotationAxisWorld,c),this.target.quaternion.premultiply(this.deltaQuaternion)}}else{this.motionAxisWorld.copy(r.motionAxisLocal).applyQuaternion(this.object.quaternion),this.lookDirectionWorld.copy(this.env.avatar.worldPos).sub(this.object.position).normalize(),this.deltaPosition.copy(this.endWorld).sub(this.startWorld);let s=this.lookDirectionWorld.dot(this.motionAxisWorld);if(Math.abs(s)>.7){let c=Math.abs(s)<.98&&Math.sign(this.lookDirectionWorld.cross(this.motionAxisWorld).y)||1;this.deltaPosition.applyQuaternion(vae.get(Math.sign(s)*c))}let l=this.size*this.deltaPosition.dot(this.motionAxisWorld);this.deltaPosition.copy(this.motionAxisWorld).multiplyScalar(l),this.mode===Ne.Orbit?(this.target.parent.add(this.testObj),this.testObj.position.copy(this.target.position),this.testObj.lookAt(this.env.avatar.worldPos),this.testObj.attach(this.target),this.testObj.position.add(this.deltaPosition),this.testObj.lookAt(this.env.avatar.worldPos),this.testObj.parent.attach(this.target),this.testObj.removeFromParent()):this.target.position.add(this.deltaPosition)}this.refresh(),this.dispatchEvent(this.movingEvt)}this.startWorld.copy(this.endWorld)}}),r.addEventListener("up",o=>{o.pointer.isPressed(tn.Primary)||(this.dragging=!1,this.mode!==Ne.MoveObjectSpace&&this.mode!==Ne.MoveGlobalSpace&&this.mode!==Ne.MoveViewSpace&&this.mode!==Ne.Orbit&&(this.env.avatar.lockMovement=!1),r.selected=null,this.dispatchEvent(this.movedEvt))}),r}get size(){return this.object.scale.x}set size(e){this.object.scale.setScalar(e)}refresh(){if(this.target){this.target.getWorldPosition(this.object.position);let e=this.object.position.distanceTo(this.env.avatar.worldPos);this.size=.5*e,this.mode===Ne.MoveObjectSpace||this.mode===Ne.RotateObjectSpace?this.target.getWorldQuaternion(this.object.quaternion):this.mode===Ne.RotateGlobalSpace||this.mode===Ne.MoveGlobalSpace?this.object.quaternion.identity():this.object.lookAt(this.env.avatar.worldPos);for(let t of this.translators)t.refresh(this.object.position,this.env.avatar.worldPos)}}},pS=new Array,dS=new Array;for(let n=5;n<=85;n+=5){let e=je(n);pS.push(new ln(.5*Math.cos(e),.5*Math.sin(e))),dS.unshift(new ln(.48*Math.cos(e),.48*Math.sin(e)))}var bae=[...pS,...dS],Sae=new Ob(bae),$a=new fb(Sae,{steps:1,depth:.02,bevelEnabled:!1});$a.computeBoundingBox();$a.computeBoundingSphere();var qx=class n extends Qn{static{this.small=new Se(.1,.1,.1)}constructor(e,t,i){let r=au.indexOf(e),o=(r+2)%au.length,s=au[o],l=au.length-r-1,c=au[l],u=Wd({color:i,depthTest:!1,opacity:.75}),p=Wd({color:i,depthTest:!1,opacity:.25}),d=Wd({color:i,depthTest:!1,opacity:1}),h=[tu(`Bar_${e}1`,1,1,1,u),tu(`Bar_${e}1`,1,1,1,u)],A=[Xx(`ScalePad_${e}1`,1,u),Xx(`ScalePad_${e}2`,1,u)],g=[Vx(`TranslatePad_${e}1`,1,1,1,u),Vx(`TranslatePad_${e}2`,1,1,1,u)],F=[hr(`RotatePad_${e}1`,$a,u),hr(`RotatePad_${e}2`,$a,u),hr(`RotatePad_${e}3`,$a,u),hr(`RotatePad_${e}4`,$a,u)];super(ft(`Transformer_${e}`,...h,...A,...g,...F)),this.worldPos=new Se,this.worldQuat=new it,this.center=new Se,this.interactionAxisLocal=new Se,this.motionAxisLocal=new Se,this.rotationAxisLocal=new Se,this._mode=null,this.selected=null,this.delta=new Se;for(let S of this.object.children)Kn(S)&&(S.renderOrder=Number.MAX_SAFE_INTEGER);this.bars=h,this.spherePads=A,this.conePads=g,this.arcPads=F,this.interactionAxisLocal[t]=1,this.motionAxisLocal[e]=1,this.rotationAxisLocal[s]=1,this.materialFront=u,this.materialBack=p,this.materialSelected=d,this.enabled=!0,this.draggable=!0;for(let S=0;S<this.spherePads.length;++S){let x=2*S-1;this.spherePads[S].scale.setScalar(Hs*.4),this.spherePads[S].position.copy(this.motionAxisLocal).multiplyScalar(x*Hs*1.5)}let b=new Se;for(let S=0;S<this.conePads.length;++S){let x=2*S-1;b.copy(this.conePads[S].up).multiplyScalar(x),this.conePads[S].quaternion.setFromUnitVectors(b,this.motionAxisLocal),this.conePads[S].position.copy(this.motionAxisLocal).multiplyScalar(x*Hs*1.5),this.conePads[S].scale.set(.2,.4,.2).multiplyScalar(Hs)}for(let S=0;S<this.bars.length;++S){let x=2*S-1;this.bars[S].scale.copy(this.motionAxisLocal).multiplyScalar(1.2).add(n.small).multiplyScalar(Hs),this.bars[S].position.copy(this.motionAxisLocal).multiplyScalar(x*Hs*.7)}let R=new it,P=new Se(0,0,-1),L=new Se;L[c]=1;for(let S=0;S<this.arcPads.length;++S){let x=S*Math.PI/2;R.setFromAxisAngle(P,x),this.arcPads[S].quaternion.setFromAxisAngle(L,Math.PI/2).multiply(R),this.arcPads[S].scale.setScalar(Hs*4)}this.addMeshes(...this.bars,...this.spherePads,...this.conePads,...this.arcPads)}get mode(){return this._mode}set mode(e){if(e!==this.mode){this._mode=e;let t=this.mode===Ne.RotateObjectSpace||this.mode===Ne.RotateGlobalSpace||this.mode===Ne.RotateViewSpace,i=this.mode!==Ne.None&&!t;for(let r of this.arcPads)r.visible=t;for(let r of this.bars)r.visible=i;for(let r of this.spherePads)r.visible=this.mode===Ne.Resize;for(let r of this.conePads)r.visible=this.mode!==Ne.Resize&&i;for(let r of this.meshes)r.visible!==y(r.parent)&&(r.visible?this.object.add(r):r.removeFromParent())}}refresh(e,t){this.delta.subVectors(t,e),this.checkMeshes(e,this.bars),this.checkMeshes(e,this.spherePads),this.checkMeshes(e,this.conePads),this.checkMeshes(e,this.arcPads)}checkMeshes(e,t){for(let i of t)if(i===this.selected)i.material=this.materialSelected;else{i.getWorldPosition(this.worldPos),i.getWorldQuaternion(this.worldQuat),i.geometry.boundingBox.getCenter(this.center),this.center.add(i.position),i.localToWorld(this.center),this.center.sub(e);let r=this.center.dot(this.delta);i.material=r<0?this.materialBack:this.materialFront}}};var hS=["change","click","contextmenu","dblclick","mouseup","pointerup","reset","submit","touchend"];function Br(n,e=!1){let t=async i=>{if(i.isTrusted){if(!e)for(let r of hS)window.removeEventListener(r,t);n()}};for(let i of hS)window.addEventListener(i,t)}function Ja(...n){let e=[];for(let t of n)y(t)&&t.length>0&&e.indexOf(t)===-1&&e.push(t);return e.join("-")}function lu(n){return y(n)&&"_resolveInput"in n}function cu(n){return lu(n)&&"_resolveOutput"in n}var Za=class extends Be{get name(){return this._name}set name(e){this._name=e,this.context._name(this,e)}constructor(e,t){super(),this.nodeType=e,this.context=t,this._name=null,this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){}isConnected(e,t,i){return this.context._isConnected(this,e,t,i)}resolveOutput(e){let t={source:this,output:e};for(;cu(t.source);)t=t.source._resolveOutput(t.output);return t}resolveInput(e){let t={destination:this,input:e};for(;lu(t.destination);)t=t.destination._resolveInput(t.input);return t}toggle(e,t,i){this._toggle(e,t,i)}_toggle(e,t,i){if(this.isConnected(e,t,i))this._disconnect(e,t,i);else return this._connect(e,t,i)}connect(e,t,i){return this._connect(e,t,i)}_connect(e,t,i){return this.context._connect(this,e,t,i)}disconnect(e,t,i){this._disconnect(e,t,i)}_disconnect(e,t,i){this.context._disconnect(this,e,t,i)}};var ki=class n extends Za{get exemplar(){return this.allNodes[0]}constructor(e,t,i,r,o){super(e,t),i=i||[],o=o||[];let s=r||i;this.inputs=i;let l=i.filter(cu).map(c=>c);this.outputs=s.filter(cu).map(c=>c),this.allNodes=Array.from(new Set([...l,...this.outputs,...o]))}add(e){this.allNodes.push(e),this.context._parent(this,e)}remove(e){Pt(this.allNodes,e),this.context._unparent(this,e)}onDisposing(){this.allNodes.forEach(Tt),super.onDisposing()}get channelCount(){return this.exemplar.channelCount}set channelCount(e){this.allNodes.forEach(t=>t.channelCount=e)}get channelCountMode(){return this.exemplar.channelCountMode}set channelCountMode(e){this.allNodes.forEach(t=>t.channelCountMode=e)}get channelInterpretation(){return this.exemplar.channelInterpretation}set channelInterpretation(e){this.allNodes.forEach(t=>t.channelInterpretation=e)}get numberOfInputs(){return this.inputs.length}get numberOfOutputs(){return this.outputs.length}static resolve(e,t){return t=t||0,t<0||e.length<=t?null:e[t]}_resolveInput(e){return{destination:n.resolve(this.inputs,e)}}_resolveOutput(e){return{source:n.resolve(this.outputs,e)}}};function jd(n){let e=[];for(let t=0;t<n.length;++t){let i=n[t],r=!1;for(let o=0;o<e.length&&!r;++o){let s=e[o];r=i.kind===s.kind&&s.label.indexOf(i.label)>0}r||e.push(i)}return e}var el=class extends ge{constructor(){super("devicesettingschanged")}},Gd=class{constructor(...e){this.permissed=new Set,this.managers=e}get hasPermissions(){for(let e of this.managers)if(!this.permissed.has(e))return!1;return!0}async init(){if(!this.hasPermissions){let e=await this.getDevices();await Promise.all(this.managers.map(t=>t.setDevice(Rn(e,i=>i.kind===t.deviceKind&&i.deviceId===t.preferredDeviceID,i=>i.kind===t.deviceKind&&i.deviceId==="default",i=>i.kind===t.deviceKind&&i.deviceId.length>0))))}}async getDevices(e=!1){let t=null,i=null;for(let r=0;r<3;++r)if(t=await navigator.mediaDevices.enumerateDevices(),!this.hasPermissions){let o={};for(let s of this.managers)if(!this.permissed.has(s)){for(let l of t)if(l.kind===s.deviceKind&&l.deviceId.length>0&&l.label.length>0){this.permissed.add(s);break}this.permissed.has(s)||(o[s.mediaType]=!0)}if(!this.hasPermissions)try{i=await navigator.mediaDevices.getUserMedia(o)}catch(s){console.warn(s)}}if(i)for(let r of i.getTracks())r.stop();return t=(t||[]).sort(Yx),e&&(t=jd(t)),t}get outStreams(){return this.managers.map(e=>e.outStream)}},Yx=vn(n=>n.label);var Vr=Ke(HTMLAudioElement.prototype.setSinkId),Kx=class extends ge{constructor(e){super("audiooutputchanged"),this.device=e}},mS="calla:preferredAudioOutputID",Xd=class extends Be{get hasAudioPermission(){return this._hasAudioPermission}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}constructor(e){super(),this.element=e,this._hasAudioPermission=!1,this._ready=new et,this.start(),Object.seal(this)}async start(){if(Vr){let e=await navigator.mediaDevices.enumerateDevices(),t=Rn(e,i=>i.kind==="audiooutput"&&i.label.length>0);if(y(t)){this._hasAudioPermission=!0;let i=await this.getPreferredAudioOutput();i&&await this.setAudioOutputDevice(i)}}this._ready.resolve()}get preferredAudioOutputID(){return Vr?localStorage.getItem(mS):null}async getAudioOutputDevices(e=!1){return Vr?await this.getAvailableDevices(e)||[]:[]}async getAudioOutputDevice(){if(!Vr)return null;let e=this.element&&this.element.sinkId;if(oe(e))return null;let t=await this.getAudioOutputDevices();return Rn(t,r=>r.deviceId===e)}async getPreferredAudioOutput(){if(!Vr)return null;let e=await this.getAudioOutputDevices();return Rn(e,i=>i.deviceId===this.preferredAudioOutputID,i=>i.deviceId==="default",i=>i.deviceId.length>0)}async setAudioOutputDevice(e){if(Vr){if(y(e)&&e.kind!=="audiooutput")throw new Error(`Device is not an audio output device. Was: ${e.kind}. Label: ${e.label}`);localStorage.setItem(mS,e&&e.deviceId||null);let t=this.element,i=t&&t.sinkId;this.preferredAudioOutputID!==i&&(y(this.preferredAudioOutputID)&&await this.element.setSinkId(this.preferredAudioOutputID),this.dispatchEvent(new Kx(e)))}}async getAvailableDevices(e=!1){let t=null,i=null;for(let r=0;r<3;++r){t=await navigator.mediaDevices.enumerateDevices();for(let o of t)o.deviceId.length>0&&(this.hasAudioPermission||(this._hasAudioPermission=o.kind==="audioinput"&&o.label.length>0));if(this.hasAudioPermission)break;try{i=await this.startStream()}catch(o){console.warn(o)}}if(i)for(let r of i.getTracks())r.stop();return t=(t||[]).sort(Yx),e&&(t=jd(t)),Vr?t.filter(r=>r.kind==="audiooutput"):[]}startStream(){return navigator.mediaDevices.getUserMedia({audio:!0})}};function _ae(n){return n[0]}function yae(n){return n.shift()}function Tae(n){return n[n.length-1]}function Eae(n){return n.pop()}var tl=class{constructor(e){this.value=e,this._forward=new Array,this._reverse=new Array}connectSorted(e,t){if(y(t)){let i=vn(r=>t(r.value));bi(this._forward,e,i),bi(e._reverse,this,i)}else this.connectTo(e)}connectTo(e){this.connectAt(e,this._forward.length)}connectAt(e,t){vs(this._forward,e,t),e._reverse.push(this)}disconnectFrom(e){Pt(this._forward,e),Pt(e._reverse,this)}isConnectedTo(e){return this._forward.indexOf(e)>=0||this._reverse.indexOf(e)>=0}flatten(){let e=new Set,t=[this];for(;t.length>0;){let i=t.shift();y(i)&&!e.has(i)&&(e.add(i),t.push(...i._forward))}return Array.from(e)}*traverse(e){let t=new Set,i=[this],r=e?_ae:Tae,o=e?yae:Eae;for(;i.length>0;){let s=r(i);t.has(s)?e||(o(i),yield s):(t.add(s),e&&(o(i),yield s),s._forward.length>0&&i.push(...s._forward))}}breadthFirst(){return this.traverse(!0)}depthFirst(){return this.traverse(!1)}search(e,t=!0){for(let i of this.traverse(t))if(e(i))return i;return null}*searchAll(e,t=!0){for(let i of this.traverse(t))e(i)&&(yield i)}find(e,t=!0){return this.search(i=>i.value===e,t)}findAll(e,t=!0){return this.searchAll(i=>i.value===e,t)}contains(e,t=!0){for(let i of this.traverse(t))if(i===e)return!0;return!1}containsValue(e,t=!0){for(let i of this.traverse(t))if(i.value===e)return!0;return!1}get _isEntryPoint(){return this._reverse.length===0}get _isExitPoint(){return this._forward.length===0}get isDisconnected(){return this._isEntryPoint&&this._isExitPoint}get isConnected(){return!this._isExitPoint||!this._isEntryPoint}get isTerminus(){return this._isEntryPoint||this._isExitPoint}get isInternal(){return!this._isEntryPoint&&!this._isExitPoint}};var qd=class extends tl{get connections(){return this._forward}get isEntryPoint(){return this._isEntryPoint}get isExitPoint(){return this._isExitPoint}};var rt=class extends Za{constructor(e,t,i){super(e,t),this._node=i,this.context._init(this._node,this.nodeType)}onDisposing(){this.disconnect(),this.context._dispose(this._node),super.onDisposing()}parent(e){this.context._parent(this,e)}get channelCount(){return this._node.channelCount}set channelCount(e){this._node.channelCount=e}get channelCountMode(){return this._node.channelCountMode}set channelCountMode(e){this._node.channelCountMode=e}get channelInterpretation(){return this._node.channelInterpretation}set channelInterpretation(e){this._node.channelInterpretation=e}get numberOfInputs(){return this._node.numberOfInputs}get numberOfOutputs(){return this._node.numberOfOutputs}_resolveInput(e){return{destination:this._node,input:e}}_resolveOutput(e){return{source:this._node,output:e}}};var nl=class extends rt{constructor(e,t){super("analyser",e,new AnalyserNode(e,t))}get fftSize(){return this._node.fftSize}set fftSize(e){this._node.fftSize=e}get frequencyBinCount(){return this._node.frequencyBinCount}get maxDecibels(){return this._node.maxDecibels}set maxDecibels(e){this._node.maxDecibels=e}get minDecibels(){return this._node.minDecibels}set minDecibels(e){this._node.minDecibels=e}get smoothingTimeConstant(){return this._node.smoothingTimeConstant}set smoothingTimeConstant(e){this._node.smoothingTimeConstant=e}getByteFrequencyData(e){this._node.getByteFrequencyData(e)}getByteTimeDomainData(e){this._node.getByteTimeDomainData(e)}getFloatFrequencyData(e){this._node.getFloatFrequencyData(e)}getFloatTimeDomainData(e){this._node.getFloatTimeDomainData(e)}};var wt=class{get name(){return this._name}set name(e){this._name=e,this.context._name(this,e)}constructor(e,t,i){this.nodeType=e,this.context=t,this.param=i,this._name=null,this.disposed=!1,this.context._init(this.param,this.nodeType)}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){this.context._dispose(this.param)}get automationRate(){return this.param.automationRate}set automationRate(e){this.param.automationRate=e}get defaultValue(){return this.param.defaultValue}get maxValue(){return this.param.maxValue}get minValue(){return this.param.minValue}get value(){return this.param.value}set value(e){this.param.value=e}cancelAndHoldAtTime(e){return this.param.cancelAndHoldAtTime(e),this}cancelScheduledValues(e){return this.param.cancelScheduledValues(e),this}exponentialRampToValueAtTime(e,t){return this.param.exponentialRampToValueAtTime(e,t),this}linearRampToValueAtTime(e,t){return this.param.linearRampToValueAtTime(e,t),this}setTargetAtTime(e,t,i){return this.param.setTargetAtTime(e,t,i),this}setValueAtTime(e,t){return this.param.setValueAtTime(e,t),this}setValueCurveAtTime(e,t,i){return this.param.setValueCurveAtTime(e,t,i),this}_resolveInput(){return{destination:this.param}}resolveInput(){return this._resolveInput()}};var Yd=class extends rt{constructor(e,t){super("audio-buffer-source",e,new AudioBufferSourceNode(e,t)),this._node.addEventListener("ended",()=>this.dispatchEvent(new ge("ended"))),this.parent(this.playbackRate=new wt("playbackRate",e,this._node.playbackRate)),this.parent(this.detune=new wt("detune",e,this._node.detune))}get buffer(){return this._node.buffer}set buffer(e){this._node.buffer=e}get loop(){return this._node.loop}set loop(e){this._node.loop=e}get loopEnd(){return this._node.loopEnd}set loopEnd(e){this._node.loopEnd=e}get loopStart(){return this._node.loopStart}set loopStart(e){this._node.loopStart=e}get onended(){return this._node.onended}set onended(e){this._node.onended=e}start(e,t,i){this._node.start(e,t,i)}stop(e){this._node.stop(e)}};var Kd=class extends rt{constructor(e,t){super("destination",e,t)}get maxChannelCount(){return this._node.maxChannelCount}};var Or=class extends rt{constructor(e,t){super("biquad-filter",e,new BiquadFilterNode(e,t)),this.parent(this.Q=new wt("Q",this.context,this._node.Q)),this.parent(this.detune=new wt("detune",this.context,this._node.detune)),this.parent(this.frequency=new wt("frequency",this.context,this._node.frequency)),this.parent(this.gain=new wt("gain",this.context,this._node.gain))}get type(){return this._node.type}set type(e){this._node.type=e}getFrequencyResponse(e,t,i){this._node.getFrequencyResponse(e,t,i)}};var Qd=class extends rt{constructor(e,t){super("channel-merger",e,new ChannelMergerNode(e,t))}};var $d=class extends rt{constructor(e,t){super("channel-splitter",e,new ChannelSplitterNode(e,t))}};var Jd=class extends rt{constructor(e,t){super("constant-source",e,new ConstantSourceNode(e,t)),this._node.addEventListener("ended",()=>this.dispatchEvent(new ge("ended"))),this.parent(this.offset=new wt("offset",this.context,this._node.offset))}get onended(){return this._node.onended}set onended(e){this._node.onended=e}start(e){this._node.start(e)}stop(e){this._node.stop(e)}};var Zd=class extends rt{constructor(e,t){super("convolver",e,new ConvolverNode(e,t))}get buffer(){return this._node.buffer}set buffer(e){this._node.buffer=e}get normalize(){return this._node.normalize}set normalize(e){this._node.normalize=e}};var eh=class extends rt{constructor(e,t){super("delay",e,new DelayNode(e,t)),this.parent(this.delayTime=new wt("delay",this.context,this._node.delayTime))}};var il=class extends rt{constructor(e,t){super("dynamics-compressor",e,new DynamicsCompressorNode(e,t)),this.parent(this.attack=new wt("attack",this.context,this._node.attack)),this.parent(this.knee=new wt("knee",this.context,this._node.knee)),this.parent(this.ratio=new wt("ratio",this.context,this._node.ratio)),this.parent(this.release=new wt("release",this.context,this._node.release)),this.parent(this.threshold=new wt("threshold",this.context,this._node.threshold))}get reduction(){return this._node.reduction}};var ji=class extends rt{constructor(e,t){super("gain",e,new GainNode(e,t)),this.parent(this.gain=new wt("gain",this.context,this._node.gain))}};var th=class extends rt{constructor(e,t){super("iir-filter",e,new IIRFilterNode(e,t))}getFrequencyResponse(e,t,i){this._node.getFrequencyResponse(e,t,i)}};var mr=class extends rt{constructor(e,t){super("media-element-audio-source",e,new MediaElementAudioSourceNode(e,t))}get mediaElement(){return this._node.mediaElement}};var Ho=class extends rt{constructor(e,t){super("media-stream-audio-destination",e,new MediaStreamAudioDestinationNode(e,t))}get stream(){return this._node.stream}};var kae="AudioContext"in globalThis,fS=kae&&"AudioListener"in globalThis,gS=fS&&"setPosition"in AudioListener.prototype,uu=fS&&"positionX"in AudioListener.prototype,Qx="createMediaStreamSource"in AudioContext.prototype,Xve=Ke(HTMLMediaElement.prototype.captureStream)||Ke(HTMLMediaElement.prototype.mozCaptureStream);var Uo=class extends rt{constructor(e,t){let i=Ui(_i(!1),Ep(Qx),to(!0),Mo(!1),Jt("none"),Cc(t.mediaStream)),r;Qx?r=new MediaStreamAudioSourceNode(e,t):r=new MediaElementAudioSourceNode(e,{mediaElement:i}),super("media-stream-audio-source",e,r),this._stream=t.mediaStream,this._element=i}onDisposing(){this._element.pause(),super.onDisposing()}get mediaStream(){return this._stream}};var nh=class extends rt{constructor(e,t){super("oscillator",e,new OscillatorNode(e,t)),this._node.addEventListener("ended",()=>this.dispatchEvent(new ge("ended"))),this.parent(this.detune=new wt("detune",this.context,this._node.detune)),this.parent(this.frequency=new wt("frequency",this.context,this._node.frequency))}get type(){return this._node.type}set type(e){this._node.type=e}get onended(){return this._node.onended}set onended(e){this._node.onended=e}setPeriodicWave(e){this._node.setPeriodicWave(e)}start(e){this._node.start(e)}stop(e){this._node.stop(e)}};var rl=class extends rt{constructor(e,t){super("panner",e,new PannerNode(e,t)),this.parent(this.positionX=new wt("positionX",this.context,this._node.positionX)),this.parent(this.positionY=new wt("positionY",this.context,this._node.positionY)),this.parent(this.positionZ=new wt("positionZ",this.context,this._node.positionZ)),this.parent(this.orientationX=new wt("orientationX",this.context,this._node.orientationX)),this.parent(this.orientationY=new wt("orientationY",this.context,this._node.orientationY)),this.parent(this.orientationZ=new wt("orientationZ",this.context,this._node.orientationZ))}get coneInnerAngle(){return this._node.coneInnerAngle}set coneInnerAngle(e){this._node.coneInnerAngle=e}get coneOuterAngle(){return this._node.coneOuterAngle}set coneOuterAngle(e){this._node.coneOuterAngle=e}get coneOuterGain(){return this._node.coneOuterGain}set coneOuterGain(e){this._node.coneOuterGain=e}get distanceModel(){return this._node.distanceModel}set distanceModel(e){this._node.distanceModel=e}get maxDistance(){return this._node.maxDistance}set maxDistance(e){this._node.maxDistance=e}get panningModel(){return this._node.panningModel}set panningModel(e){this._node.panningModel=e}get refDistance(){return this._node.refDistance}set refDistance(e){this._node.refDistance=e}get rolloffFactor(){return this._node.rolloffFactor}set rolloffFactor(e){this._node.rolloffFactor=e}setOrientation(e,t,i){this._node.setOrientation(e,t,i)}setPosition(e,t,i){this._node.setPosition(e,t,i)}};var ih=class extends rt{constructor(e,t){super("stereo-panner",e,new StereoPannerNode(e,t)),this.parent(this.pan=new wt("pan",this.context,this._node.pan))}};var rh=class extends rt{constructor(e,t){super("wave-shaper",e,new WaveShaperNode(e,t))}get curve(){return this._node.curve}set curve(e){this._node.curve=e}get oversample(){return this._node.oversample}set oversample(e){this._node.oversample=e}};!("AudioContext"in globalThis)&&"webkitAudioContext"in globalThis&&(globalThis.AudioContext=globalThis.webkitAudioContext);!("OfflineAudioContext"in globalThis)&&"webkitOfflineAudioContext"in globalThis&&(globalThis.OfflineAudioContext=globalThis.webkitOfflineAudioContext);var $x=class{constructor(e,t){this.type=e,this.name=t,this.connections=new Set}};function oh(n,e,t,i,r){return n.type===e&&(oe(t)||t===n.destination)&&(oe(i)||i===n.output)&&(oe(r)||r===n.input)}function ol(n,e){let t=null,i=null;return y(n)&&({destination:t,input:i}=n.resolveInput(e)),{destination:t,input:i}}var sl=class extends AudioContext{get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}constructor(e){super(e),this.counters=new Map,this.nodes=new Map,this._ready=new et,this._destination=new Kd(this,super.destination),this.state==="running"?this._ready.resolve():this.state==="closed"?this.resume().then(()=>this._ready.resolve()):Br(()=>this.resume().then(()=>this._ready.resolve())),this.ready.then(()=>console.log("Audio is now ready"))}_init(e,t){if(!this.nodes.has(e)){this.counters.has(t)||this.counters.set(t,0);let i=this.counters.get(t),r=`${t}-${i}`;this.nodes.set(e,new $x(t,r)),lu(e)&&(e.name=r),this.counters.set(t,i+1)}}_name(e,t){let{destination:i}=ol(e);if(this.nodes.has(i)){let r=this.nodes.get(i);r.name=`${t}-${r.type}`}}_dispose(e){this.nodes.delete(e)}_isConnected(e,t,i,r){let{source:o,output:s}=e.resolveOutput(i),{destination:l,input:c}=ol(t,r);if(oe(o)||!this.nodes.has(o))return null;{let u=this.nodes.get(o);for(let p of u.connections)if(oh(p,"conn",l,s,c))return!0;return!1}}_parent(e,t){let{source:i}=e.resolveOutput(),{destination:r}=ol(t);this.nodes.has(i)&&this.nodes.get(i).connections.add({type:"parent",src:e,dest:t,destination:r,source:i})}_unparent(e,t){let{source:i}=e.resolveOutput(),{destination:r}=ol(t);if(this.nodes.has(i)){let o=this.nodes.get(i).connections,s=new Set;for(let l of o)oh(l,"parent",r)&&s.add(l);for(let l of s)o.delete(l)}}_getConnections(e){return this.nodes.has(e)?this.nodes.get(e).connections:null}_connect(e,t,i,r){let{source:o,output:s}=e.resolveOutput(i),{destination:l,input:c}=ol(t,r);if(this.nodes.has(o)){let u=this.nodes.get(o).connections,p=!1;for(let d of u)oh(d,"conn",l,s,c)&&(p=!0);p||u.add({type:"conn",src:e,dest:t,outp:i,inp:r,source:o,destination:l,output:s,input:c})}if(l instanceof AudioNode)return t=t,y(c)?(o.connect(l,s,c),t):y(s)?(o.connect(l,s),t):(o.connect(l),t);l instanceof AudioParam?y(s)?o.connect(l,s):y(l)?o.connect(l):yt(l):yt(l)}_disconnect(e,t,i,r){let o;mt(t)?(o=void 0,i=t):o=t;let{source:s,output:l}=e.resolveOutput(i),{destination:c,input:u}=ol(o,r);if(this.nodes.has(s)){let p=this.nodes.get(s).connections,d=new Set;for(let h of p)oh(h,"conn",c,l,u)&&d.add(h);for(let h of d)p.delete(h)}c instanceof AudioNode?y(r)?s.disconnect(c,i,r):y(i)?s.disconnect(c,i):y(c)?s.disconnect(c):s.disconnect():y(i)?s.disconnect(c,i):y(c)?s.disconnect(c):s.disconnect()}getAudioGraph(e){let t=new Map;for(let[i,r]of this.nodes){let o=i instanceof AudioNode?"node":i instanceof AudioParam?"param":"unknown";(e||o!=="param")&&t.set(i,new qd({name:r.name,type:r.type,nodeClass:o}))}for(let[i,r]of this.nodes){let o=t.get(i);for(let s of r.connections){let l=s.destination;if(t.has(l)){let c=t.get(l);o.connectTo(c),c.connectTo(o)}}}return Array.from(t.values())}get destination(){return this._destination}createAnalyser(){return new nl(this)}createBiquadFilter(){return new Or(this)}createBufferSource(){return new Yd(this)}createChannelMerger(e){return new Qd(this,{numberOfInputs:e})}createChannelSplitter(e){return new $d(this,{numberOfOutputs:e})}createConstantSource(){return new Jd(this)}createConvolver(){return new Zd(this)}createDelay(e){return new eh(this,{maxDelayTime:e})}createDynamicsCompressor(){return new il(this)}createGain(){return new ji(this)}createIIRFilter(e,t){return new th(this,{feedforward:e,feedback:t})}createMediaElementSource(e){return new mr(this,{mediaElement:e})}createMediaStreamDestination(){return new Ho(this)}createMediaStreamSource(e){return new Uo(this,{mediaStream:e})}createOscillator(){return new nh(this)}createPanner(){return new rl(this)}createStereoPanner(){return new ih(this)}createWaveShaper(){return new rh(this)}createScriptProcessor(){throw new Error("Script processor nodes are deprecated")}};var al=class{constructor(){this.p=Rt.create(),this.q=ja.create(),Object.seal(this)}set(e,t,i,r,o,s,l){this.setPosition(e,t,i),this.setOrientation(r,o,s,l)}setPosition(e,t,i){Rt.set(this.p,e,t,i)}setOrientation(e,t,i,r){ja.set(this.q,e,t,i,r)}copy(e){Rt.copy(this.p,e.p),ja.copy(this.q,e.q)}};var sh=class{constructor(e,t){this.type=e,this.context=t}};var ll=Rt.create(),cl=Rt.create(),ul=class extends sh{get listener(){return this.context.listener}readPose(e){let{p:t,q:i}=e;Rt.set(ll,0,0,-1),Rt.transformQuat(ll,ll,i),Rt.set(cl,0,1,0),Rt.transformQuat(cl,cl,i),this.setPosition(t[0],t[1],t[2]),this.setOrientation(ll[0],ll[1],ll[2],cl[0],cl[1],cl[2])}};var ah=class extends ul{constructor(e){if(!uu)throw new Error("Latest WebAudio Listener API is not supported");super("web-audio-listener-new",e),Object.seal(this)}setPosition(e,t,i){let r=this.context.currentTime;this.listener.positionX.setValueAtTime(e,r),this.listener.positionY.setValueAtTime(t,r),this.listener.positionZ.setValueAtTime(i,r)}setOrientation(e,t,i,r,o,s){let l=this.context.currentTime;this.listener.forwardX.setValueAtTime(e,l),this.listener.forwardY.setValueAtTime(t,l),this.listener.forwardZ.setValueAtTime(i,l),this.listener.upX.setValueAtTime(r,l),this.listener.upY.setValueAtTime(o,l),this.listener.upZ.setValueAtTime(s,l)}};var lh=class extends ul{constructor(e){if(!gS)throw new Error("WebAudio Listener API is not supported");super("web-audio-listener-old",e),Object.seal(this)}setPosition(e,t,i){this.listener.setPosition(e,t,i)}setOrientation(e,t,i,r,o,s){this.listener.setOrientation(e,t,i,r,o,s)}};var pl=class extends ki{constructor(e,t,i,r,o,s){super(e,t,r,o,s),this.spatialized=i,this._minDistance=1,this._maxDistance=10,this._algorithm="inverse"}get minDistance(){return this._minDistance}get maxDistance(){return this._maxDistance}get algorithm(){return this._algorithm}setAudioProperties(e,t,i){this._minDistance=e,this._maxDistance=t,this._algorithm=i}};var pu=Rt.create(),dl=class extends pl{constructor(e,t){let i=new rl(t,{panningModel:"HRTF",distanceModel:"inverse",coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:0});super(e,t,!0,[i]),this.lpx=0,this.lpy=0,this.lpz=0,this.lqx=0,this.lqy=0,this.lqz=0,this.lqw=0,this.panner=i}setAudioProperties(e,t,i){super.setAudioProperties(e,t,i),this.panner.refDistance=this.minDistance,this.panner.distanceModel=i,i==="linear"?this.panner.rolloffFactor=1:this.maxDistance<=0?this.panner.rolloffFactor=1/0:i==="inverse"?this.panner.rolloffFactor=1/this.maxDistance:this.panner.rolloffFactor=Math.pow(this.maxDistance,-.2)}readPose(e){let{p:t,q:i}=e,[r,o,s]=t,[l,c,u,p]=i;(r!==this.lpx||o!==this.lpy||s!==this.lpz)&&(this.lpx=r,this.lpy=o,this.lpz=s,this.setPosition(r,o,s,this.context.currentTime)),(l!==this.lqx||c!==this.lqy||u!==this.lqz||p!==this.lqw)&&(this.lqx=l,this.lqy=c,this.lqz=u,this.lqw=p,Rt.transformQuat(pu,Rt.set(pu,0,0,-1),i),this.setOrientation(pu[0],pu[1],pu[2],this.context.currentTime))}getGainAtDistance(e){let{rolloffFactor:t,refDistance:i,maxDistance:r,distanceModel:o}=this.panner;if(e<=i)return 1;{let s=e-i,l=r-i;if(o==="linear")return 1-t*s/l;if(o==="inverse")return i/(i+t*s);if(o==="exponential")return Math.pow(e/i,-t);yt(o)}}};var ch=class extends dl{constructor(e){super("web-audio-panner-new",e),Object.seal(this)}setPosition(e,t,i,r){Ai(e)&&Ai(t)&&Ai(i)&&(dp(r)&&(r=0),this.panner.positionX.setValueAtTime(e,r),this.panner.positionY.setValueAtTime(t,r),this.panner.positionZ.setValueAtTime(i,r))}setOrientation(e,t,i,r){Ai(e)&&Ai(t)&&Ai(i)&&(dp(r)&&(r=0),this.panner.orientationX.setValueAtTime(-e,r),this.panner.orientationY.setValueAtTime(-t,r),this.panner.orientationZ.setValueAtTime(-i,r))}};var uh=class extends dl{constructor(e){super("web-audio-panner-old",e),Object.seal(this)}setPosition(e,t,i){this.panner.setPosition(e,t,i)}setOrientation(e,t,i){this.panner.setOrientation(e,t,i)}};var ph=class extends ki{get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}constructor(e){let t=uu?new ah(e):new lh(e),i=new ji(e);i.name="remote-user-input";let r=new ji(e);r.name="spatialized-input";let o=new ji(e);o.name="non-spatialized-input";let s=new Ho(e),l=new et,c=Ui(At("Audio-Device-Manager"),Jt("none"),to(!0),_i(!0),Cc(s.stream),fv(()=>l.resolve()));Br(()=>c.play()),super("web-audio-destination",e,[o,r,i],[],[s]),this.pose=new al,this._ready=l,this.listener=t,this.remoteUserInput=i,this.spatializedInput=r,this.nonSpatializedInput=o,this.volumeControl=o,this.destination=s,this.audioElement=c,i.connect(r).connect(this.volumeControl).connect(s)}createSpatializer(e){let t=e?this.remoteUserInput:this.spatializedInput,i=uu?new ch(this.context):new uh(this.context);return i.connect(t),i}setPosition(e,t,i){this.pose.setPosition(e,t,i),this.listener.readPose(this.pose)}setOrientation(e,t,i,r){this.pose.setOrientation(e,t,i,r),this.listener.readPose(this.pose)}set(e,t,i,r,o,s,l){this.pose.set(e,t,i,r,o,s,l),this.listener.readPose(this.pose)}get stream(){return this.destination.stream}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}};var Jx=class extends ki{constructor(e){let t=new Or(e,{type:"bandpass",frequency:2500,Q:4.5}),i=new ji(e,{gain:10});t.connect(i),super("radio-effect",e,[t],[i])}};function xS(n,e){let t=new Jx(e);return t.name=`${n}-radio-effect`,t}function wS(n,e){let t=new Or(e,{type:"bandpass",frequency:400,Q:4.5});return t.name=`${n}-wall-effect`,t}var dh=new Map([["Radio",xS],["Wall",wS]]);var Nr=class extends ki{constructor(e,t,i,r,o){let s=new ji(t);s.name="volume-control",o=o||[],super(e,t,[],[i],o),this.spatializer=i,this.effects=new Array,this.pose=new al,this.volumeControl=s,this.setEffects(...r)}onDisposing(){qe(this.effects),super.onDisposing()}setEffects(...e){this.disable();for(let i of this.effects)this.remove(i),Tt(i);qe(this.effects);let t=this.volumeControl;for(let i of e)if(y(i)){let r=dh.get(i);if(y(r)){let o=r(i,this.context);this.add(o),this.effects.push(o),t=t.connect(o)}}this.enable()}get spatialized(){return this.spatializer.spatialized}get lastInternal(){return this.effects[this.effects.length-1]||this.volumeControl}enable(){this.lastInternal.isConnected()||this.lastInternal.connect(this.spatializer)}disable(){this.lastInternal.isConnected()&&this.lastInternal.disconnect()}tog(){this.lastInternal.isConnected()?this.disable():this.enable()}get volume(){return this.volumeControl.gain.value}set volume(e){this.volumeControl.gain.value=e}get minDistance(){return y(this.spatializer)?this.spatializer.minDistance:null}get maxDistance(){return y(this.spatializer)?this.spatializer.maxDistance:null}get algorithm(){return y(this.spatializer)?this.spatializer.algorithm:null}setPosition(e,t,i){y(this.spatializer)&&(this.pose.setPosition(e,t,i),this.spatializer.readPose(this.pose))}setOrientation(e,t,i,r){y(this.spatializer)&&(this.pose.setOrientation(e,t,i,r),this.spatializer.readPose(this.pose))}set(e,t,i,r,o,s,l){y(this.spatializer)&&(this.pose.set(e,t,i,r,o,s,l),this.spatializer.readPose(this.pose))}setAudioProperties(e,t,i){y(this.spatializer)&&this.spatializer.setAudioProperties(e,t,i)}};var Wr=class extends ge{constructor(e,t){super(e),this.source=t}},zo=class extends Wr{constructor(e){super("loaded",e)}},hh=class extends Wr{constructor(e,t){super("errored",e),this.error=t}},jo=class extends Wr{constructor(e){super("played",e)}},Go=class extends Wr{constructor(e){super("paused",e)}},Xo=class extends Wr{constructor(e){super("stopped",e)}},qo=class extends Wr{constructor(e){super("progress",e),this.value=0,this.total=0}};var Mae=new ge("disposing"),mh=class extends Nr{constructor(e,t,i,r,o,...s){super("audio-element-source",e,o,s),t.connect(this.volumeControl),this.audio=t.mediaElement,this.disable(),this.loadEvt=new zo(this),this.playEvt=new jo(this),this.pauseEvt=new Go(this),this.stopEvt=new Xo(this),this.progEvt=new qo(this);let l=c=>{this.audio.currentTime===0||c.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};this.audio.addEventListener("ended",l),this.audio.addEventListener("pause",l),i&&this.audio.addEventListener("play",()=>{if(this.audio.loop&&this.audio.duration>1){let c=this.audio.duration*Math.random();this.audio.currentTime=c}}),r&&(t.mediaElement.preservesPitch=!1,this.audio.addEventListener("play",()=>{t.mediaElement.playbackRate=1+.1*(2*Math.random()-1)})),this.audio.addEventListener("play",()=>{this.dispatchEvent(this.playEvt)}),this.audio.addEventListener("timeupdate",()=>{this.progEvt.value=this.audio.currentTime,this.progEvt.total=this.audio.duration,this.dispatchEvent(this.progEvt)}),this.audio.autoplay&&this.play().catch(()=>Br(()=>this.play())),IF(this.audio).then(c=>this.dispatchEvent(c?this.loadEvt:new hh(this,this.audio.error)))}onDisposing(){this.dispatchEvent(Mae),super.onDisposing()}get playbackState(){return this.audio.error?"errored":this.audio.ended||this.audio.paused&&this.audio.currentTime===0?"stopped":this.audio.paused?"paused":"playing"}async play(){this.enable(),await this.context.ready,await this.audio.play()}async playThrough(){let e=Kt(this,"stopped");await this.play(),await e}pause(){this.disable(),this.audio.pause()}stop(){this.audio.currentTime=0,this.pause()}restart(){return this.stop(),this.play()}};var Zx=class extends ge{constructor(e){super("sourceadded"),this.source=e}},fh=class extends Nr{constructor(e,t,...i){super("audio-stream-source",e,t,i),this._stream=null,this._node=null}get stream(){return this._stream}set stream(e){e!==this.stream&&(y(this.stream)&&(this.remove(this._node),Tt(this._node),this._node=null),y(e)&&(this._node=new Uo(this.context,{mediaStream:e}),this._node.name=Ja("media-stream-source",e.id),this._node.connect(this.volumeControl),this.add(this._node),this.dispatchEvent(new Zx(this))))}};var hl=class extends pl{constructor(e){super("no-spatializer",e.context,!1,[e],[e])}readPose(e){}getGainAtDistance(e){return 1}};var FS="juniper::useHeadphones",Dae=new ge("useheadphonestoggled"),AS=10,ml=new ge("released"),vS="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",gh=class extends ki{get algorithm(){return this._algorithm}get ready(){return this._ready}get isReady(){return this._ready.finished&&this._ready.resolved}constructor(e,t){let i=new sl;"THREE"in globalThis&&globalThis.THREE.AudioContext.setContext(i);let r=new ph(i),o=new hl(r.nonSpatializedInput),s=new Xd(r.audioElement);super("audio-manager",i,null,null,[o,r]),this.fetcher=e,this.users=new Map,this.clips=new Map,this.pendingAudio=new Array,this.audioPool=new Array,this.elements=new Map,this.elementCounts=new Map,this._minDistance=.25,this._maxDistance=100,this._algorithm="inverse",this._useHeadphones=!1,this.destination=null,this._ready=new et,this.localUserID=null,this.destination=r,this.noSpatializer=o,this.speakers=s,sn(this.context.ready,this.destination.ready,this.speakers.ready).then(()=>this._ready.resolve()),this.setLocalUserID(t);let l=localStorage.getItem(FS);y(l)?this._useHeadphones=l==="true":this._useHeadphones=io(),this.enpool(),Na()&&Br(()=>{let c=[...this.pendingAudio];qe(this.pendingAudio);for(let u of c)u()},!0),Object.seal(this)}enpool(){for(let e=0;e<AS;++e){let t=new et,i=Ui(Un(vS),_i(!1),gv(()=>{i.pause(),i.src=vS}));this.audioPool.push(t),Na()?this.pendingAudio.push(()=>{i.play(),t.resolve(i)}):t.resolve(i)}}preparePool(e){for(;this.audioPool.length<e;)this.enpool()}async getPooledAudio(...e){if(this.audioPool.length===0)throw new Error("Audio pool exhausted!");let t=this.audioPool.shift();this.audioPool.length<=AS/2&&this.enpool();let i=await t;return i.pause(),Ee(i,...e),i}async getPooledSource(e,t,i){if(!this.elements.has(e)){let o=await this.getPooledAudio(Un(t),Mo(i&&!Na()));Na()&&i&&o.addEventListener("ended",()=>o.play());let s=new mr(this.context,{mediaElement:o});s.name=Ja("media-element-source",e),this.elements.set(e,s),this.elementCounts.set(e,0)}let r=this.elements.get(e);return this.elementCounts.set(e,this.elementCounts.get(e)+1),r}releasePooledSource(e){let t=this.elements.get(e);this.elementCounts.set(e,this.elementCounts.get(e)-1),this.elementCounts.get(e)===0&&(t.mediaElement.dispatchEvent(ml),this.elementCounts.delete(e),this.elements.delete(e))}get useHeadphones(){return this._useHeadphones}set useHeadphones(e){e!==this.useHeadphones&&(this._useHeadphones=e,localStorage.setItem(FS,this.useHeadphones.toString()),this.dispatchEvent(Dae))}onDisposing(){this.context.suspend();for(let e of this.users.keys())this.removeUser(e);for(let e of this.clips.keys())this.removeClip(e);super.onDisposing()}get currentTime(){return this.context.currentTime}createSpatializer(e,t){if(e){let i=this.destination.createSpatializer(t);return i.setAudioProperties(this._minDistance,this._maxDistance,this._algorithm),i}else return this.noSpatializer}createUser(e,t){if(!this.users.has(e)){let i=new fh(this.context,this.createSpatializer(!0,!0));i.name=Ja(t,e),this.users.set(e,i)}return this.users.get(e)}setLocalUserID(e){return this.destination&&(this.localUserID=e),this.destination}createBasicClip(e,t,i){return this.createClip(e,t,!1,!1,!1,!0,i,[])}hasClip(e){return this.clips.has(e)}async createClip(e,t,i,r,o,s,l,c,u){await this.ready;let p,d;Ve(t)?(p=t,d=await this.fetcher.get(t).progress(u).file().then(We)):(p=t.path,d=t.result);let h=await this.getPooledSource(p,d,i),A=new mh(this.context,h,o,s,this.createSpatializer(r,!1),...c);return A.addEventListener("disposing",()=>this.releasePooledSource(p)),A.name=Ja("audio-clip-element",e),A.volume=l,this.clips.set(e,A),A}async playClip(e){this.hasClip(e)&&await this.clips.get(e).play()}async playClipThrough(e){this.hasClip(e)&&await this.clips.get(e).playThrough()}stopClip(e){this.hasClip(e)&&this.clips.get(e).stop()}getUser(e){return this.users.get(e)}getClip(e){return this.clips.get(e)}removeSource(e,t){let i=e.get(t);return y(i)&&(e.delete(t),Tt(i)),i}removeUser(e){let t=this.removeSource(this.users,e);y(t.stream)&&(t.stream=null)}removeClip(e){let t=this.removeSource(this.clips,e);return Tt(t),t}setUserStream(e,t){if(this.users.has(e)){let i=this.users.get(e);i.stream=t}}setAudioProperties(e,t,i){this._minDistance=e,this._maxDistance=t,this._algorithm=i;for(let r of this.users.values())r.setAudioProperties(this._minDistance,this._maxDistance,this.algorithm);for(let r of this.clips.values())r.setAudioProperties(r.minDistance,r.maxDistance,this.algorithm)}withPoser(e,t,i){let o=e.get(t)||this.destination;return i(o)}withUser(e,t){return this.withPoser(this.users,e,t)}withClip(e,t){return this.withPoser(this.clips,e,t)}setUserPose(e,t,i,r,o,s,l,c){this.withUser(e,u=>{u.set(t,i,r,o,s,l,c)})}setUserPosition(e,t,i,r){this.withUser(e,o=>{o.setPosition(t,i,r)})}setUserOrientation(e,t,i,r,o){this.withUser(e,s=>{s.setOrientation(t,i,r,o)})}setClipPose(e,t,i,r,o,s,l,c){this.withClip(e,u=>{u.set(t,i,r,o,s,l,c)})}setClipPosition(e,t,i,r){this.withClip(e,o=>{o.setPosition(t,i,r)})}setClipOrientation(e,t,i,r,o){this.withClip(e,s=>{s.setOrientation(t,i,r,o)})}};var fl=class extends ge{constructor(e,t){super("streamchanged"),this.oldStream=e,this.newStream=t}};var bS="calla:preferredAudioInputID",xh=class extends ki{constructor(e){let t=e.createGain();t.name="local-mic-user-gain";let i=e.createGain();i.name="local-mic-auto-gain";let r=new Or(e,{type:"bandpass",frequency:1500,Q:.25});r.name="local-mic-filter";let o=new il(e,{threshold:-15,knee:40,ratio:17});o.name="local-mic-compressor";let s=new Ho(e);s.name="local-mic-destination",super("local-user-microphone",e,[],[o],[t,r,s]),this.localStreamNode=null,this._hasPermission=!1,this._usingHeadphones=!1,this._device=null,this._enabled=!1,this.volume=t,this.autoGainNode=i,this.compressor=o,this.output=s,t.connect(i).connect(r).connect(o).connect(s),Object.seal(this)}get mediaType(){return"audio"}get deviceKind(){return`${this.mediaType}input`}get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.onChange())}get hasPermission(){return this._hasPermission}get preferredDeviceID(){return localStorage.getItem(bS)}get device(){return this._device}async setDevice(e){if(y(e)&&e.kind!==this.deviceKind)throw new Error(`Device is not an audio input device. Was: ${e.kind}. Label: ${e.label}`);let t=this.device&&this.device.deviceId||null,i=e&&e.deviceId||null;i!==t&&(this._device=e,localStorage.setItem(bS,i),this.onChange())}get inStream(){return this.localStreamNode&&this.localStreamNode.mediaStream||null}set inStream(e){e!==this.inStream&&(this.localStreamNode&&(this.remove(this.localStreamNode),Tt(this.localStreamNode),this.localStreamNode=null),e&&(this.localStreamNode=new Uo(this.context,{mediaStream:e}),this.add(this.localStreamNode),this.localStreamNode.connect(this.volume)))}get outStream(){return this.output.stream}get gain(){return this.volume.gain}get muted(){return this.compressor.isConnected(this.output)}set muted(e){e!==this.muted&&(e?this.compressor.connect(this.output):this.compressor.disconnect(this.output))}get usingHeadphones(){return this._usingHeadphones}set usingHeadphones(e){e!==this.usingHeadphones&&(this._usingHeadphones=e,this.onChange())}async onChange(){this.dispatchEvent(new el);let e=this.inStream;this.device&&this.enabled?this.inStream=await navigator.mediaDevices.getUserMedia({audio:{deviceId:this.device.deviceId,echoCancellation:!this.usingHeadphones,autoGainControl:!0,noiseSuppression:!0}}):this.inStream=null,this.inStream!==e&&this.dispatchEvent(new fl(e,this.outStream))}};function ew(n){return y(n)&&n.length>0?parseFloat(n):null}var Gi=class{constructor(e,t){this._url=null,this._base=void 0,this._protocol=null,this._host=null,this._hostName=null,this._userName=null,this._password=null,this._port=null,this._pathName=null,this._hash=null,this._query=new Map,e!==void 0&&(this._url=new URL(e,t),this.rehydrate())}rehydrate(){y(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),y(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),y(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),y(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),y(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),y(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),y(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),y(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[e,t]of this._query)this._url.searchParams.set(e,t);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=ew(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((e,t)=>this._query.set(t,e))}refresh(){if(this._url===null){if(y(this._protocol)&&(y(this._host)||y(this._hostName))){if(y(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=ew(this._url.port),this.rehydrate(),!1;if(y(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(y(this._pathName)&&y(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return y(this._url)}base(e){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=e,this.refresh(),this}protocol(e){return this._protocol=e,this.refresh()&&(this._url.protocol=e),this}host(e){return this._host=e,this.refresh()&&(this._url.host=e,this._hostName=this._url.hostname,this._port=ew(this._url.port)),this}hostName(e){return this._hostName=e,this.refresh()&&(this._url.hostname=e,this._host=`${this._url.hostname}:${this._url.port}`),this}port(e){return this._port=e,this.refresh()&&(this._url.port=e.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(e){return this._userName=e,this.refresh()&&(this._url.username=e),this}password(e){return this._password=e,this.refresh()&&(this._url.password=e),this}path(e){return this._pathName=e,this.refresh()&&(this._url.pathname=e),this}pathPop(e){return e=e||/\/[^/]+\/?$/,this.path(this._pathName.replace(e,""))}pathPush(e){let t=this._pathName;return t.endsWith("/")||(t+="/"),t+=e,this.path(t)}query(e,t){return this._query.set(e,t),this.refresh()&&this._url.searchParams.set(e,t),this}hash(e){return this._hash=e,this.refresh()&&(this._url.hash=e),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};var wh=vn("descending",n=>n.resolution);var tw=class extends Wr{constructor(e,t){super(e,t)}},gl=class extends tw{constructor(e){super("loading",e)}};var xl=class extends Nr{get data(){return this._data}get loaded(){return this._loaded}get title(){return this.audioElement.title}setTitle(e){this.audioElement.title=e}constructor(e,t){let i=Ui(to(!1),Mo(!1),_i(!0)),r=new mr(e,{mediaElement:i});r.name="JuniperAudioPlayer-Input",super("audio-player",e,t,[],[r]),this.cacheBustSources=new Map,this._data=null,this._loaded=!1,this.sourcesByURL=new Map,this.sources=new Array,this.potatoes=new Array,r.connect(this.volumeControl),this.audioElement=i,this.loadingEvt=new gl(this),this.loadEvt=new zo(this),this.playEvt=new jo(this),this.pauseEvt=new Go(this),this.stopEvt=new Xo(this),this.progEvt=new qo(this),this.onPlay=async()=>{this.enable(),this.dispatchEvent(this.playEvt)},this.onPause=o=>{this.disable(),this.audioElement.currentTime===0||o.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)},this.onTimeUpdate=async()=>{this.progEvt.value=this.audioElement.currentTime,this.progEvt.total=this.audioElement.duration,this.dispatchEvent(this.progEvt)},this.onError=()=>this.loadAudio(),this.audioElement.addEventListener("play",this.onPlay),this.audioElement.addEventListener("pause",this.onPause),this.audioElement.addEventListener("ended",this.onPause),this.audioElement.addEventListener("error",this.onError),this.audioElement.addEventListener("waiting",this.onWaiting),this.audioElement.addEventListener("canplay",this.onCanPlay),this.audioElement.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{audioPlayer:this})}get hasAudio(){let e=this.sourcesByURL.get(this.audioElement.src);return y(e)&&e.acodec!=="none"||y(this.audioElement.audioTracks)&&this.audioElement.audioTracks.length>0||y(this.audioElement.webkitAudioDecodedByteCount)&&this.audioElement.webkitAudioDecodedByteCount>0||y(this.audioElement.mozHasAudio)&&this.audioElement.mozHasAudio}onDisposing(){super.onDisposing(),this.clear(),this.audioElement.removeEventListener("play",this.onPlay),this.audioElement.removeEventListener("pause",this.onPause),this.audioElement.removeEventListener("ended",this.onPause),this.audioElement.removeEventListener("error",this.onError),this.audioElement.removeEventListener("waiting",this.onWaiting),this.audioElement.removeEventListener("canplay",this.onCanPlay),this.audioElement.removeEventListener("timeupdate",this.onTimeUpdate),this.audioElement.dispatchEvent(ml)}clear(){this.stop(),this.sourcesByURL.clear(),qe(this.sources),qe(this.potatoes),this.audioElement.src="",this._data=null,this._loaded=!1}cacheBust(e){let t=this.cacheBustSources.get(e)||0;this.cacheBustSources.set(e,t+1)}async load(e,t){this.clear(),this._data=e,Ve(e)?(this.setTitle(e),this.potatoes.push(e)):(this.setTitle(e.title),e.audios.sort(wh),un(this.sources,...e.audios));for(let i of this.sources)this.sourcesByURL.set(i.url,i);if(!this.hasSources)throw new Error("No audio sources");if(this.dispatchEvent(this.loadingEvt),await this.loadAudio(t),!this.hasSources)throw new Error("No audio sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}async getMediaCapabilities(e){let t={type:"file",audio:{contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr}};try{return await navigator.mediaCapabilities.decodingInfo(t)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:t}}}get hasSources(){return this.sources.length>0||this.potatoes.length>0}async loadAudio(e){for(y(e)&&e.start(),this.audioElement.removeEventListener("error",this.onError);this.hasSources;){let t=null,i=this.sources.shift();if(y(i)){let o=await this.getMediaCapabilities(i);if(!o.smooth||!o.powerEfficient){this.potatoes.push(i.url);continue}else t=i.url}else t=this.potatoes.shift();let r=this.cacheBustSources.get(this.data);if(y(r)){let o=new Gi(t,location.href);o.query("v",r.toString()),t=o.toString()}if(this.audioElement.src=t,this.audioElement.load(),await Cp(this.audioElement)){y(i)?this.sources.unshift(i):this.potatoes.unshift(t),this.audioElement.addEventListener("error",this.onError),y(e)&&e.end();return}}}get playbackState(){return oe(this.data)?"empty":this.loaded?this.audioElement.error?"errored":this.audioElement.ended||this.audioElement.paused&&this.audioElement.currentTime===0?"stopped":this.audioElement.paused?"paused":"playing":"loading"}async play(){await this.context.ready,await this.audioElement.play()}async playThrough(){let e=Kt(this,"stopped");await this.play(),await e}pause(){this.audioElement.pause()}stop(){this.pause(),this.audioElement.currentTime=0}restart(){return this.stop(),this.play()}get element(){return this.audioElement}};var Hr=class extends Be{constructor(e,t,i){super(),this._scale=250,this._visible=!0,this.wasVisible=null,this.redrawnEvt=new ge("redrawn"),y(i)&&y(i.scale)&&(this._scale=i.scale),this._canvas=Hp(e,t),this._g=this.canvas.getContext("2d")}fillRect(e,t,i,r,o,s){this.g.fillStyle=e,this.g.fillRect(t+s,i+s,r-2*s,o-2*s)}drawText(e,t,i,r){this.g.textAlign=r,this.g.strokeText(e,t,i),this.g.fillText(e,t,i)}redraw(){(this.visible||this.wasVisible)&&this.onRedraw()&&(this.wasVisible=this.visible,this.dispatchEvent(this.redrawnEvt))}onClear(){this.g.clearRect(0,0,this.canvas.width,this.canvas.height)}clear(){this.onClear(),this.dispatchEvent(this.redrawnEvt)}get canvas(){return this._canvas}get g(){return this._g}get imageWidth(){return this.canvas.width}get imageHeight(){return this.canvas.height}get aspectRatio(){return this.imageWidth/this.imageHeight}get width(){return this.imageWidth/this.scale}get height(){return this.imageHeight/this.scale}get scale(){return this._scale}set scale(e){this.scale!==e&&(this._scale=e,this.redraw())}get visible(){return this._visible}set visible(e){this.visible!==e&&(this.wasVisible=this._visible,this._visible=e,this.redraw())}};var Fh=class extends Hr{constructor(){super(128,128),this._pitchDegrees=0,this._headingDegrees=0,this.redraw()}get pitchDegrees(){return this._pitchDegrees}set pitchDegrees(e){e!==this.pitchDegrees&&(this._pitchDegrees=e,this.redraw())}get headingDegrees(){return this._headingDegrees}set headingDegrees(e){e!==this.headingDegrees&&(this._headingDegrees=e,this.redraw())}setPitchAndHeading(e,t){(e!==this.pitchDegrees||t!==this.headingDegrees)&&(this._pitchDegrees=e,this._headingDegrees=t,this.redraw())}onRedraw(){let e=je(this.pitchDegrees),t=je(this.headingDegrees-180),i=5,r=this.canvas.width-2*i,o=this.canvas.height-2*i,s=.5*r,l=.5*o,c=Math.sin(e),u=this.g;return u.save(),u.clearRect(0,0,this.canvas.width,this.canvas.height),u.translate(i,i),u.scale(s,l),u.translate(1,1),u.fillStyle="gray",u.beginPath(),u.arc(0,0,1,0,Vn),u.fill(),u.fillStyle="lightgrey",u.beginPath(),u.arc(0,0,1,0,en,!0),u.fill(),u.save(),u.scale(1,Math.abs(c)),c<0&&(u.fillStyle="gray"),u.beginPath(),u.arc(0,0,1,0,en,c<0),u.fill(),u.restore(),u.save(),u.shadowColor=pi(64,64,64),u.shadowBlur=4,u.shadowOffsetX=3,u.shadowOffsetY=3,u.rotate(t),u.fillStyle="red",u.beginPath(),u.moveTo(-.1,0),u.lineTo(0,-.667),u.lineTo(.1,0),u.closePath(),u.fill(),u.fillStyle="white",u.beginPath(),u.moveTo(-.1,0),u.lineTo(0,.667),u.lineTo(.1,0),u.closePath(),u.fill(),u.restore(),u.beginPath(),u.strokeStyle="black",u.lineWidth=.1,u.arc(0,0,1,0,Vn),u.stroke(),u.restore(),!0}};function SS(n,e){return qp(n,pn,e)}var du=class extends ge{constructor(){super("update"),this.t=0,this.dt=0,this.sdt=0,this.fps=0}set(e,t){this.t=e,this.dt=t,this.sdt=ib(this.sdt,t,.01),t>0&&(this.fps=1e3/t)}},Ah=class extends du{constructor(){super(),Object.seal(this)}};var wl=class{constructor(e){this.timer=null,this.lt=-1,this.tickHandlers=new Array,this._targetFPS=null,this.targetFPS=e;let t=new Ah,i=0;this.onTick=r=>{this.lt>=0&&(i=r-this.lt,t.set(r,i),this.tick(t)),this.lt=r}}get targetFPS(){return this._targetFPS}set targetFPS(e){this._targetFPS=e}addTickHandler(e){this.tickHandlers.push(e)}removeTickHandler(e){Pt(this.tickHandlers,e)}tick(e){for(let t of this.tickHandlers)t(e)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};var vh=class extends wl{constructor(){super()}start(){if(!this.isRunning){let e=t=>{this.timer=requestAnimationFrame(e),this.onTick(t)};this.timer=requestAnimationFrame(e)}}stop(){this.isRunning&&(cancelAnimationFrame(this.timer),super.stop())}};var Mi=class{constructor(e){this.task=new et(!1),this.element=Ae(de("dialog"),Jt("none"),qt("dialogname",e),this.container=Ae(de("dialog-container"),this.titleElement=zF(de("title-bar"),e),this.contentArea=Ae(de("dialog-content")),Ae(de("dialog-controls"),this.confirmButton=ar("Confirm",de("confirm-button")),this.cancelButton=ka("Cancel",de("cancel-button"))))),this.confirmButton.addEventListener("click",this.task.resolver(!0)),this.cancelButton.addEventListener("click",this.task.resolver(!1)),Ee(document.body,this)}get title(){return this._title}set title(e){Ie(this.titleElement,this._title=e)}async onShowing(){}onShown(){}async onConfirm(){}onCancel(){}async onClosing(){}onClosed(){}show(e){Ue(this,e)}get isOpen(){return zn(this)}hide(){this.show(!1)}async toggle(){this.isOpen?this.hide():this.showDialog()}async showDialog(){return await this.onShowing(),this.show(!0),this.onShown(),this.task.restart(),await this.task?await this.onConfirm():this.onCancel(),await this.onClosing(),this.show(!1),this.onClosed(),this.task.result}};var qi=20,bh=qi/2,Xi=lt.create();function _S(n,e){return n<0?0:n>e?e:Number.isFinite(n)?n:(console.trace("To infinity... and beyond!"),e)}var Sh=class extends Mi{get w(){return this.canvas.width-2*qi-200}get h(){return this.canvas.height-2*qi}constructor(e,t,i,r){super(e),this.getNodeName=t,this.getNodeColor=i,this.getWeightMod=r,this.timer=new vh,this.positions=new Map,this.forces=new Map,this.wasGrabbed=new Set,this.mousePoint=lt.create(),this.grabbed=null,this.graph=null,this.cancelButton.style.display="none";let o=In(5);Ee(this.container,Pn(Xt(100)),To(Xt(100))),Ee(this.contentArea,Ae(Jt("grid"),As("repeat(11, auto)",yo(1)),fp(ui(5)),I0("center"),...La("limit"+o,"Limit",this.t=yi(at(0),st(1e3),nt(.1),Qt(5))),...La("cooling"+o,"Cooling",this.cooling=Xn()),...La("attract"+o,"Attract",this.attract=yi(at(-100),st(100),nt(.1),Qt(1))),...La("repel"+o,"Repel",this.repel=yi(at(-100),st(100),nt(.1),Qt(1))),...La("hideBare"+o,"Hide bare nodes",this.hideBare=Xn(yp(!0)))),this.canvas=Da(Jt("block"),Pn(Xt(100)),j0("calc(100% - 2em)"))),this.g=this.canvas.getContext("2d"),this.g.textAlign="center",this.g.textBaseline="middle",this.timer.addTickHandler(()=>{this.fr91(),this.draw()}),new ResizeObserver(()=>{xA(this.g)}).observe(this.canvas);let l=lt.create();this.canvas.addEventListener("mousedown",c=>{this.setMouse(c),this.grabbed=null;let u=.7071067811865475*qi;for(let p of this.graph){let d=this.positions.get(p);lt.sub(l,d,this.mousePoint);let h=lt.length(l);h<u&&(this.grabbed=p,this.wasGrabbed.has(p)?this.wasGrabbed.delete(p):this.wasGrabbed.add(p),u=h)}}),this.canvas.addEventListener("mousemove",c=>{this.setMouse(c)}),this.canvas.addEventListener("mouseup",()=>{this.grabbed=null})}setMouse(e){let t=e.offsetX*this.canvas.width/this.canvas.clientWidth-qi,i=e.offsetY*this.canvas.height/this.canvas.clientHeight-qi;lt.set(this.mousePoint,t,i)}draw(){this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.g.fillStyle="black",this.g.strokeStyle="black",this.g.save(),this.g.translate(qi,qi);for(let e of this.graph){let t=this.positions.get(e);for(let i of e.connections){let r=this.positions.get(i);this.g.beginPath(),this.g.moveTo(t[0],t[1]),this.g.lineTo(r[0],r[1]),this.g.stroke()}}this.g.strokeStyle="lightgrey",this.g.save(),this.g.translate(-bh,-bh);for(let e of this.graph)if(e.isConnected||!this.hideBare.checked){this.g.fillStyle=pi(243,243,243);let t=this.positions.get(e);this.g.fillStyle=this.getNodeColor(e.value),this.g.fillRect(t[0],t[1],qi,qi),this.g.strokeRect(t[0],t[1],qi,qi),this.g.fillStyle="black",this.g.fillText(this.getNodeName(e.value),t[0]+bh,t[1]+bh)}this.g.restore(),this.g.restore()}applyForces(e,t){let i=SS(this.graph,()=>lt.create());for(let r of this.graph){let o=this.positions.get(r);if(r===this.grabbed)lt.copy(o,this.mousePoint);else if(!this.wasGrabbed.has(r)){let s=i.get(r),l=this.forces.get(r);l&&lt.add(s,s,l),lt.set(Xi,this.w,this.h),lt.scaleAndAdd(Xi,o,Xi,-.5);let c=lt.length(Xi);if(c>0){lt.normalize(Xi,Xi);let u=-1e4*c;u=Math.sign(u)*Math.pow(Math.abs(u),.2),lt.scaleAndAdd(s,s,Xi,u)}for(let u of this.graph)if(r!==u){let p=this.positions.get(u);lt.sub(Xi,p,o);let d=lt.length(Xi);if(d>0){lt.normalize(Xi,Xi);let h=r.isConnectedTo(u),A=this.getWeightMod(r.value,u.value,h),g=2-A,F=A*this.attract.valueAsNumber*e(h,d)-g*this.repel.valueAsNumber*t(h,d);lt.scaleAndAdd(s,s,Xi,F)}}}}for(let r of this.graph){let o=i.get(r);o[1]*=this.h/this.w;let s=lt.length(o);if(s>0){lt.scale(o,o,Math.min(this.t.valueAsNumber,s)/s);let l=this.positions.get(r);lt.add(l,l,o),l[0]=_S(l[0],this.w),l[1]=_S(l[1],this.h)}}this.cooling.checked&&(this.t.valueAsNumber*=.975)}fr91(){let e=this.w*this.h*.1,t=1,i=1.5,r=.1,o=t*Math.sqrt(e/this.graph.length);for(let s=0;s<2;++s)this.applyForces((l,c)=>l?i*Math.sqrt(c)*c/o:0,(l,c)=>r*o*o/c)}onShown(){super.onShown(),this.refreshData(),this.t.valueAsNumber=5,this.timer.isRunning||this.timer.start()}refreshData(){this.positions.clear(),this.forces.clear(),this.wasGrabbed.clear();let e=Math.min(this.w,this.h)/2;for(let t=0;t<this.graph.length;++t){let i=this.graph[t],r=Vn*t/this.graph.length,o=e,s=o*Math.cos(r)+this.w/2,l=o*Math.sin(r)+this.h/2;this.positions.set(i,lt.fromValues(s,l))}}setGraph(e){this.graph=e}onClosed(){this.timer.stop(),super.onClosed()}};function Cae(n){return n.name}function Lae(n){if(n.nodeClass==="node")return"lightgreen";if(n.nodeClass==="param")return"lightyellow";if(n.nodeClass==="unknown")return"pink";yt(n.nodeClass)}function Pae(n,e,t){return!t||n.nodeClass===e.nodeClass?1:1.8}var _h=class extends Sh{constructor(e){super("Audio graph",Cae,Lae,Pae),this.context=e}refreshData(){let e=this.context.getAudioGraph(!1);this.setGraph(e),super.refreshData()}};function yS(n){return"getBattery"in n}var Rae=["","N/A","charging"],hu=class extends Hr{static{this.isAvailable=yS(navigator)}constructor(){super(256,128),this.battery=null,this.lastChargeDirection=null,this.lastLevel=null,this.chargeDirection=0,this.level=.5,yS(navigator)?this.readBattery(navigator):this.redraw()}onRedraw(){this.battery?(this.chargeDirection=this.battery.charging?1:-1,this.level=this.battery.level):(this.level+=.1,this.level>1&&(this.level=0));let e=this.chargeDirection!==this.lastChargeDirection,t=this.level!==this.lastLevel;if(!e&&!t)return!1;this.lastChargeDirection=this.chargeDirection,this.lastLevel=this.level;let i=this.level<.1?"red":"silver",r=7,o=.7,s=(1-o)/2,l=this.canvas.width-2*r,c=l-4*r,u=this.canvas.height-4*r,p=l/2,d=this.canvas.height/2,h=Rae[this.chargeDirection+1];return this.g.clearRect(0,0,l,this.canvas.height),this.g.save(),this.g.translate(s*this.canvas.width,s*this.canvas.height),this.g.globalAlpha=.75,this.g.scale(o,o),this.fillRect("silver",0,0,l,this.canvas.height,0),this.fillRect("silver",l,d-2*r-10,r+10,4*r+20,0),this.g.clearRect(r,r,l-2*r,this.canvas.height-2*r),this.fillRect("black",r,r,l-2*r,this.canvas.height-2*r,0),this.g.clearRect(2*r,2*r,c*this.level,u),this.fillRect(i,2*r,2*r,c*this.level,u,0),this.g.fillStyle="white",this.g.strokeStyle="black",this.g.lineWidth=4,this.g.textBaseline="middle",this.g.font=id({fontSize:u/2,fontFamily:"Lato"}),this.drawText(h,p,d,"center"),this.g.restore(),!0}async readBattery(e){let t=this.redraw.bind(this);t(),this.battery=await e.getBattery(),this.battery.addEventListener("chargingchange",t),this.battery.addEventListener("levelchange",t),setInterval(t,1e3),t()}};var fr=class extends Hr{constructor(e){super(10,10,e),this.trueWidth=null,this.trueHeight=null,this.trueFontSize=null,this.dx=null,this._minWidth=null,this._maxWidth=null,this._minHeight=null,this._maxHeight=null,this._freezeDimensions=!1,this._dimensionsFrozen=!1,this._bgFillColor=null,this._bgStrokeColor=null,this._bgStrokeSize=null,this._textStrokeColor=null,this._textStrokeSize=null,this._textFillColor="black",this._textDirection="horizontal",this._fontStyle="normal",this._fontVariant="normal",this._fontWeight="normal",this._fontFamily="sans-serif",this._fontSize=20,this._value=null,this.lastValue=null,y(e)&&(y(e.minWidth)&&(this._minWidth=e.minWidth),y(e.maxWidth)&&(this._maxWidth=e.maxWidth),y(e.minHeight)&&(this._minHeight=e.minHeight),y(e.maxHeight)&&(this._maxHeight=e.maxHeight),y(e.freezeDimensions)&&(this._freezeDimensions=e.freezeDimensions),y(e.textStrokeColor)&&(this._textStrokeColor=e.textStrokeColor),y(e.textStrokeSize)&&(this._textStrokeSize=e.textStrokeSize),y(e.bgFillColor)&&(this._bgFillColor=e.bgFillColor),y(e.bgStrokeColor)&&(this._bgStrokeColor=e.bgStrokeColor),y(e.bgStrokeSize)&&(this._bgStrokeSize=e.bgStrokeSize),y(e.value)&&(this._value=e.value),y(e.textFillColor)&&(this._textFillColor=e.textFillColor),y(e.textDirection)&&(this._textDirection=e.textDirection),y(e.fontStyle)&&(this._fontStyle=e.fontStyle),y(e.fontVariant)&&(this._fontVariant=e.fontVariant),y(e.fontWeight)&&(this._fontWeight=e.fontWeight),y(e.fontFamily)&&(this._fontFamily=e.fontFamily),y(e.fontSize)&&(this._fontSize=e.fontSize),y(e.padding)&&(mt(e.padding)?this._padding={left:e.padding,right:e.padding,top:e.padding,bottom:e.padding}:this._padding=e.padding)),oe(this._padding)&&(this._padding={top:0,right:0,bottom:0,left:0}),this.redraw()}get minWidth(){return this._minWidth}set minWidth(e){this.minWidth!==e&&(this._minWidth=e,this.redraw())}get maxWidth(){return this._maxWidth}set maxWidth(e){this.maxWidth!==e&&(this._maxWidth=e,this.redraw())}get minHeight(){return this._minHeight}set minHeight(e){this.minHeight!==e&&(this._minHeight=e,this.redraw())}get maxHeight(){return this._maxHeight}set maxHeight(e){this.maxHeight!==e&&(this._maxHeight=e,this.redraw())}get padding(){return this._padding}set padding(e){if(e instanceof Array)throw new Error("Invalid padding");(this.padding.top!==e.top||this.padding.right!=e.right||this.padding.bottom!=e.bottom||this.padding.left!=e.left)&&(this._padding=e,this.redraw())}get textDirection(){return this._textDirection}set textDirection(e){this.textDirection!==e&&(this._textDirection=e,this.redraw())}get fontStyle(){return this._fontStyle}set fontStyle(e){this.fontStyle!==e&&(this._fontStyle=e,this.redraw())}get fontVariant(){return this._fontVariant}set fontVariant(e){this.fontVariant!==e&&(this._fontVariant=e,this.redraw())}get fontWeight(){return this._fontWeight}set fontWeight(e){this.fontWeight!==e&&(this._fontWeight=e,this.redraw())}get fontSize(){return this._fontSize}set fontSize(e){this.fontSize!==e&&(this._fontSize=e,this.redraw())}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.redraw())}get textFillColor(){return this._textFillColor}set textFillColor(e){this.textFillColor!==e&&(this._textFillColor=e,this.redraw())}get textStrokeColor(){return this._textStrokeColor}set textStrokeColor(e){this.textStrokeColor!==e&&(this._textStrokeColor=e,this.redraw())}get textStrokeSize(){return this._textStrokeSize}set textStrokeSize(e){this.textStrokeSize!==e&&(this._textStrokeSize=e,this.redraw())}get bgFillColor(){return this._bgFillColor}set bgFillColor(e){this.bgFillColor!==e&&(this._bgFillColor=e,this.redraw())}get bgStrokeColor(){return this._bgStrokeColor}set bgStrokeColor(e){this.bgStrokeColor!==e&&(this._bgStrokeColor=e,this.redraw())}get bgStrokeSize(){return this._bgStrokeSize}set bgStrokeSize(e){this.bgStrokeSize!==e&&(this._bgStrokeSize=e,this.redraw())}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.redraw())}split(e){return e.replace(/\r\n/g,`
`).split(`
`)}unfreeze(){this._dimensionsFrozen=!1}onRedraw(){if(this.onClear(),this.visible&&this.fontFamily&&this.fontSize&&(this.textFillColor||this.textStrokeColor&&this.textStrokeSize)&&this.value&&this.value!==this.lastValue){let e=this.split(this.value),t=this.textDirection&&this.textDirection.indexOf("vertical")===0;if(this.trueWidth===null||this.trueHeight===null||this.dx===null||this.trueFontSize===null||!this._dimensionsFrozen){this._dimensionsFrozen=this._freezeDimensions;let r=this.minWidth!=null||this.maxWidth!=null||this.minHeight!=null||this.maxHeight!=null,o=((this.minWidth||0)-this.padding.right-this.padding.left)*this.scale,s=((this.maxWidth||4096)-this.padding.right-this.padding.left)*this.scale,l=((this.minHeight||0)-this.padding.top-this.padding.bottom)*this.scale,c=((this.maxHeight||4096)-this.padding.top-this.padding.bottom)*this.scale,u=t?l:o,p=t?c:s,d=t?o:l,h=t?s:c,A=[];this.trueWidth=0,this.trueHeight=0,this.dx=0;let g=!1,F=!1,b=1e4,R=0;this.trueFontSize=ri(this.fontSize*this.scale,R,b);let P=null,L=Number.MAX_VALUE;do{let v=this.fontSize;this._fontSize=this.trueFontSize;let M=id(this);this._fontSize=v,this.g.textAlign="center",this.g.textBaseline="middle",this.g.font=M,this.trueWidth=0,this.trueHeight=0;for(let O of e){let B=this.g.measureText(O);this.trueWidth=Math.max(this.trueWidth,B.width),this.trueHeight+=this.trueFontSize,mt(B.actualBoundingBoxLeft)&&mt(B.actualBoundingBoxRight)&&mt(B.actualBoundingBoxAscent)&&mt(B.actualBoundingBoxDescent)&&(r||(this.trueWidth=B.actualBoundingBoxLeft+B.actualBoundingBoxRight,this.trueHeight=B.actualBoundingBoxAscent+B.actualBoundingBoxDescent,this.dx=(B.actualBoundingBoxLeft-this.trueWidth/2)/2))}if(r){let O=this.trueWidth-u,B=this.trueWidth-p,X=this.trueHeight-d,V=this.trueHeight-h,J=Math.abs(O),ce=Math.abs(B),G=Math.abs(X),Y=Math.abs(V);g=B>1||V>1,F=O<-1&&X<-1;let K=Math.min(J,Math.min(ce,Math.min(G,Y)));K<L&&(L=K,P=this.g.font),(g||F)&&A.indexOf(this.g.font)>-1&&P&&(this.g.font=P,g=!1,F=!1),g?(b=this.trueFontSize,this.trueFontSize=(R+this.trueFontSize)/2):F&&(R=this.trueFontSize,this.trueFontSize=(this.trueFontSize+b)/2)}A.push(this.g.font)}while(g||F);r&&(this.trueWidth<u?this.trueWidth=u:this.trueWidth>p&&(this.trueWidth=p),this.trueHeight<d?this.trueHeight=d:this.trueHeight>h&&(this.trueHeight=h));let S=this.trueWidth+this.scale*(this.padding.right+this.padding.left),x=this.trueHeight+this.scale*(this.padding.top+this.padding.bottom);try{Oa(this.g,S,x)}catch(v){throw console.error(v),v}}this.bgFillColor?(this.g.fillStyle=this.bgFillColor,this.g.fillRect(0,0,this.canvas.width,this.canvas.height)):this.g.clearRect(0,0,this.canvas.width,this.canvas.height),this.textStrokeColor&&this.textStrokeSize&&(this.g.lineWidth=this.textStrokeSize*this.scale,this.g.strokeStyle=this.textStrokeColor),this.textFillColor&&(this.g.fillStyle=this.textFillColor);let i=.5*(e.length-1);for(let r=0;r<e.length;++r){let o=e[r],s=(r-i)*this.trueFontSize,l=this.dx+this.trueWidth/2+this.scale*this.padding.left,c=s+this.trueHeight/2+this.scale*this.padding.top;this.textStrokeColor&&this.textStrokeSize&&this.g.strokeText(o,l,c),this.textFillColor&&this.g.fillText(o,l,c)}if(this.bgStrokeColor&&this.bgStrokeSize){this.g.strokeStyle=this.bgStrokeColor,this.g.lineWidth=this.bgStrokeSize*this.scale;let r=this.bgStrokeSize/2;this.g.strokeRect(r,r,this.canvas.width-this.bgStrokeSize,this.canvas.height-this.bgStrokeSize)}if(t){let r=ur(this.canvas.height,this.canvas.width),o=r.getContext("2d");o?(o.translate(r.width/2,r.height/2),this.textDirection==="vertical"||this.textDirection==="vertical-left"?o.rotate(an):this.textDirection==="vertical-right"&&o.rotate(-an),o.translate(-this.canvas.width/2,-this.canvas.height/2),o.drawImage(this.canvas,0,0),Oa(this.g,r.width,r.height)):console.warn("Couldn't rotate the TextImage"),this.g.drawImage(r,0,0)}return this.lastValue=this.value,!0}else{let e=this.value!==this.lastValue;return this.lastValue=this.value,e}}};var yh=class extends fr{constructor(){super({textFillColor:"white",textStrokeColor:pi(0,0,0,.5),textStrokeSize:.025,fontFamily:Fa(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,freezeDimensions:!0});let e=this.update.bind(this);setInterval(e,500),e()}update(){let t=new Date().toLocaleTimeString();(oe(this.value)||t.length!==this.value.length)&&this.unfreeze(),this.value=t}};var Th=class extends fr{constructor(){super({textFillColor:"white",textStrokeColor:pi(0,0,0,.5),textStrokeSize:.025,fontFamily:Fa(),fontSize:20,minHeight:1,maxHeight:1,padding:.3,freezeDimensions:!0}),this.fps=null,this.drawCalls=null,this.triangles=null}setStats(e,t,i){this.fps=e,this.drawCalls=t,this.triangles=i;let r=` ${Math.round(this.fps).toFixed(0)}hz ${this.drawCalls}c ${this.triangles}t`;(oe(this.value)||r.length!==this.value.length)&&this.unfreeze(),this.value=r}};function TS(n){return Ve(n.vcodec)}var Fl=class n extends Nr{get data(){return this._data}get loaded(){return this._loaded}get title(){return this.video.title}setTitle(e){this.video.title=e,this.audio.title=e}constructor(e,t,i){let r=n.createMediaElement(Es,_i(!0)),o=n.createMediaElement(Ui,_i(!1)),s=new mr(t,{mediaElement:r});s.name=`${e}-video`;let l=new mr(t,{mediaElement:o});l.name=`${e}-audio`,super(e,t,i,[],[s,l]),this.onTimeUpdate=null,this.wasUsingAudioElement=!1,this.nextStartTime=null,this._data=null,this._loaded=!1,this.onError=new Map,this.sourcesByURL=new Map,this.sources=new Zt,this.potatoes=new Zt,s.connect(this.volumeControl),l.connect(this.volumeControl),this.video=r,this.audio=o,this.loadingEvt=new gl(this),this.loadEvt=new zo(this),this.playEvt=new jo(this),this.pauseEvt=new Go(this),this.stopEvt=new Xo(this),this.progEvt=new qo(this),this.onSeeked=()=>{this.useAudioElement&&(this.audio.currentTime=this.video.currentTime)},this.onPlay=async()=>{this.onSeeked(),this.useAudioElement&&(await this.context.ready,await this.audio.play()),this.dispatchEvent(this.playEvt)},this.onPause=u=>{this.useAudioElement&&(this.onSeeked(),this.audio.pause()),this.video.currentTime===0||u.type==="ended"?this.dispatchEvent(this.stopEvt):this.dispatchEvent(this.pauseEvt)};let c=!1;this.onWaiting=()=>{this.useAudioElement&&(c=!0,this.audio.pause())},this.onCanPlay=async()=>{this.useAudioElement&&c&&(await this.context.ready,await this.audio.play(),c=!1)},this.wasUsingAudioElement=!1,this.onTimeUpdate=async()=>{if(this.video.getVideoPlaybackQuality().totalVideoFrames===0){let p=this.onError.get(this.video);y(p)&&await p()}else if(this.useAudioElement){this.wasUsingAudioElement=!1;let p=this.video.currentTime-this.audio.currentTime;Math.abs(p)>.25&&(this.audio.currentTime=this.video.currentTime)}else this.wasUsingAudioElement||(this.wasUsingAudioElement=!0,this.audio.pause());this.progEvt.value=this.video.currentTime,this.progEvt.total=this.video.duration,this.dispatchEvent(this.progEvt)},this.video.addEventListener("seeked",this.onSeeked),this.video.addEventListener("play",this.onPlay),this.video.addEventListener("pause",this.onPause),this.video.addEventListener("ended",this.onPause),this.video.addEventListener("waiting",this.onWaiting),this.video.addEventListener("canplay",this.onCanPlay),this.video.addEventListener("timeupdate",this.onTimeUpdate),Object.assign(window,{videoPlayer:this})}elementHasAudio(e){let t=this.sourcesByURL.get(e.src);return y(t)&&t.acodec!=="none"||y(e.audioTracks)&&e.audioTracks.length>0||y(e.webkitAudioDecodedByteCount)&&e.webkitAudioDecodedByteCount>0||y(e.mozHasAudio)&&e.mozHasAudio}get useAudioElement(){return!this.elementHasAudio(this.video)&&this.elementHasAudio(this.audio)}onDisposing(){this.clear(),this.video.removeEventListener("seeked",this.onSeeked),this.video.removeEventListener("play",this.onPlay),this.video.removeEventListener("pause",this.onPause),this.video.removeEventListener("ended",this.onPause),this.video.removeEventListener("waiting",this.onWaiting),this.video.removeEventListener("canplay",this.onCanPlay),this.video.removeEventListener("timeupdate",this.onTimeUpdate),super.onDisposing(),this.audio.dispatchEvent(ml),this.video.dispatchEvent(ml)}clear(){this.stop();for(let[e,t]of this.onError)e.removeEventListener("error",t);this.onError.clear(),this.sourcesByURL.clear(),this.sources.clear(),this.potatoes.clear(),this.video.src="",this.audio.src="",this.wasUsingAudioElement=!1,this._data=null,this._loaded=!1}async load(e,t){if(this.clear(),this._data=e,Ve(e)?(this.setTitle(e),this.potatoes.add(this.video,e)):(this.setTitle(e.title),this.fillSources(this.video,e.videos),this.fillSources(this.audio,e.audios)),!this.hasSources(this.video))throw new Error("No video sources found");if(this.dispatchEvent(this.loadingEvt),await lA(t,i=>this.loadMediaElement(this.audio,i),i=>this.loadMediaElement(this.video,i)),Ve(e)?this.nextStartTime=null:this.nextStartTime=e.startTime,!this.hasSources(this.video))throw new Error("No video playable sources");return this._loaded=!0,this.dispatchEvent(this.loadEvt),this}fillSources(e,t){t.sort(wh);for(let i of t)Xg.matches(i.contentType)||(this.sources.add(e,i),this.sourcesByURL.set(i.url,i))}static createMediaElement(e,...t){return e(to(!1),Mo(!1),...t)}async getMediaCapabilities(e){let t={type:"file"};TS(e)?t.video={contentType:e.contentType,bitrate:e.vbr*1024,framerate:e.fps,width:e.width,height:e.height}:e.acodec!=="none"&&(t.audio={contentType:e.contentType,bitrate:e.abr*1024,samplerate:e.asr});try{return await navigator.mediaCapabilities.decodingInfo(t)}catch{return{supported:!0,powerEfficient:!1,smooth:!1,configuration:t}}}hasSources(e){return this.sources.get(e).length>0||this.potatoes.count(e)>0}async loadMediaElement(e,t){for(y(t)&&t.start(),this.onError.has(e)&&(e.removeEventListener("error",this.onError.get(e)),this.onError.delete(e));this.hasSources(e);){let i=null,r=this.sources.get(e).shift();if(y(r)){let o=await this.getMediaCapabilities(r);if(!o.smooth||!o.powerEfficient){this.potatoes.add(e,r.url);continue}else i=r.url}else i=this.potatoes.get(e).shift();if(e.src=i,e.load(),await Cp(e)){y(r)?this.sources.get(e).unshift(r):this.potatoes.get(e).unshift(i);let o=()=>this.loadMediaElement(e,t);e.addEventListener("error",o),this.onError.set(e,o),this.wasUsingAudioElement=this.wasUsingAudioElement,y(t)&&t.end();return}}}get width(){return this.video.videoWidth}get height(){return this.video.videoHeight}get playbackState(){return oe(this.data)?"empty":this.loaded?this.video.error?"errored":this.video.ended||this.video.paused&&this.video.currentTime===0?"stopped":this.video.paused?"paused":"playing":"loading"}async play(){await this.context.ready,y(this.nextStartTime)&&this.nextStartTime>0&&(this.video.pause(),this.video.currentTime=this.nextStartTime,this.nextStartTime=null),await this.video.play()}async playThrough(){let e=Kt(this,"stopped");await this.play(),await e}pause(){this.video.pause()}stop(){this.pause(),this.video.currentTime=0}restart(){return this.stop(),this.play()}};var ES="calla:preferredVideoInputID",Eh=class extends Be{constructor(){super(),this.element=Es(Ep(!0)),this._hasPermission=!1,this._device=null,this._enabled=!1,Object.seal(this)}get mediaType(){return"video"}get deviceKind(){return`${this.mediaType}input`}get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.onChange())}get hasPermission(){return this._hasPermission}get preferredDeviceID(){return localStorage.getItem(ES)}get device(){return this._device}checkDevices(e){if(!this.hasPermission){for(let t of e)if(t.kind===this.deviceKind&&t.deviceId.length>0&&t.label.length>0){this._hasPermission=!0;break}}}async setDevice(e){if(y(e)&&e.kind!==this.deviceKind)throw new Error(`Device is not an vide input device. Was: ${e.kind}. Label: ${e.label}`);let t=this.device&&this.device.deviceId||null,i=e&&e.deviceId||null;i!==t&&(this._device=e,localStorage.setItem(ES,i),await this.onChange())}async onChange(){this.dispatchEvent(new el);let e=this.inStream;this.device&&this.enabled?this.inStream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.device.deviceId,autoGainControl:!0,height:640,noiseSuppression:!0}}):this.inStream=null,this.inStream!==e&&this.dispatchEvent(new fl(e,this.outStream))}get inStream(){return this.element.srcObject}set inStream(e){e!==this.inStream&&(this.inStream&&this.element.pause(),this.element.srcObject=e,this.inStream&&this.element.play())}get outStream(){return this.inStream}stop(){this.inStream=null}};var kS="wait",Iae="pointer",Bae="not-allowed",mu=class extends Fl{constructor(e,t){super("video-player",e,t),this.element=Ae(Jt("inline-block"),this.thumbnail=Gn(gp(kS)),this.video,this.audio),this.thumbnail.addEventListener("click",()=>{this.loaded&&this.play()}),this.addEventListener("played",()=>this.showVideo(!0)),this.addEventListener("stopped",()=>this.showVideo(!1)),this.showVideo(!1)}onDisposing(){super.onDisposing(),y(this.element.parentElement)&&this.element.remove()}showVideo(e){Ue(this.video,e,"inline-block"),Ue(this.thumbnail,!e,"inline-block")}async load(e,t){try{Ee(this.thumbnail,Fp(.5),gp(kS));let i=Et(t,[1,10]);return await sn(super.load(e,i.shift()),this.loadThumbnail(e,i.shift())),this}finally{Ee(this.thumbnail,Fp(1),gp(this.loaded?Iae:Bae))}}clear(){super.clear(),this.thumbnail.src=""}setTitle(e){super.setTitle(e),this.thumbnail.title=e}async loadThumbnail(e,t){if(t.start(),y(e)){Ee(this.thumbnail,Un(e.thumbnail.url),Fp(.5));let i=Kt(this.thumbnail,"load","error");await or(i)}t.end()}};function kh(n){return n.hostname==="www.youtube.com"||n.hostname==="youtube.com"||n.hostname==="youtu.be"}var Vae=new Map([["vp9","vp09.00.10.08"]]);function Oae(n){return oe(n.vcodec)||n.vcodec==="none"?"audio":"video"}function MS(n,e){let t=[n];if(y(e)&&e.length>0&&e!=="none"&&(e=Vae.get(e)||e),y(e)&&e.length>0&&e!=="none"){let i=encodeURI(e)!==e?"*":"";t.push(`codecs${i}="${e}"`)}return t.join(";")}var Al=class{constructor(e,t){this.fetcher=e,this.makeProxyURL=t}makeVideoRecord(e){let{content_type:t,acodec:i,vcodec:r}=e;return{contentType:MS(t,r),url:this.makeProxyURL(e.url).href,acodec:i,abr:e.abr*1024,asr:e.asr,vcodec:r,vbr:e.vbr*1024,fps:e.fps,width:e.width,height:e.height,resolution:e.width*e.height}}makeAudioRecord(e){let{content_type:t,acodec:i}=e;return{contentType:MS(t,i),url:this.makeProxyURL(e.url).href,acodec:i,abr:e.abr*1024,asr:e.asr,resolution:e.abr}}makeImageRecord(e){let{content_type:t,url:i,width:r,height:o}=e;return{contentType:t,url:this.makeProxyURL(i).href,width:r,height:o,resolution:r*o}}async loadData(e,t){if(oe(e))throw new Error("must provide a YouTube URL or a YTMetadata object");y(t)&&t.start();let i=null;Ve(e)?i=await this.fetcher.get(e).progress(t).object().then(We):(y(t)&&t.end(e.title),i=e);let r=0;if(y(i.original_url)){let h=new URL(i.original_url);kh(h)&&h.searchParams.has("t")&&(r=parseFloat(h.searchParams.get("t")))}let o=new Zt((await Promise.all(i.formats)).map(h=>[Oae(h),h])),s=i.title,l=i.thumbnails||[],c=i.thumbnail&&this.makeImageRecord(Rn(l,h=>h.url===i.thumbnail)),u=o.get("video").map(h=>this.makeVideoRecord(h)),p=o.get("audio").map(h=>this.makeAudioRecord(h));return{title:s,thumbnail:c,videos:u,audios:p,startTime:r}}};var DS="local-user";var tt;(function(n){n.None="None",n.Fullscreen="Fullscreen",n.VR="VR",n.AR="AR",n.Anaglyph="Anaglyph",n.FullscreenAnaglyph="FullscreenAnaglyph"})(tt||(tt={}));var Mh=class{constructor(e){di("Juniper.ThreeJS.ScreenUI.ButtonFillColor",()=>sA(R0("#appContainer > .row > .cell > .btn",B0(e)))),this.elements=[this.topLeft=Ae(de("cell","top","left")),this.topCenter=Ae(de("cell","top","center")),this.topRight=Ae(de("cell","top","right")),this.middleLeft=Ae(de("cell","middle","left")),this.middleCenter=Ae(de("cell","middle","center")),this.middleRight=Ae(de("cell","middle","right")),this.bottomLeft=Ae(de("cell","bottom","left")),this.bottomCenter=Ae(de("cell","bottom","center")),this.bottomRight=Ae(de("cell","bottom","right"))],this.cells=[[this.topLeft,this.topCenter,this.topRight],[this.middleLeft,this.middleCenter,this.middleRight],[this.bottomLeft,this.bottomCenter,this.bottomRight]],this.hide()}show(){this.elements.forEach(e=>e.style.removeProperty("display"))}hide(){this.elements.forEach(e=>e.style.display="none")}};function CS(n){return"height"in n}function LS(n){return"width"in n}var Nae=1.25,Wae=je(30),Hae=je(32),Dh=class extends pt{constructor(){super(),this.name="SpaceUI",this.position.y=-.25}addItem(e,t){e=kn(e),De(this,e),e.rotation.set(t.y*Hae,-t.x*Wae,0,"YXZ"),e.position.set(0,0,-Nae).applyEuler(e.rotation),CS(t)&&LS(t)?e.scale.set(t.width,t.height,1):CS(t)?e.scale.multiplyScalar(t.height/e.scale.y):LS(t)?e.scale.multiplyScalar(t.width/e.scale.x):e.scale.setScalar(t.scale),e.scale.z=1}};function Uae(n){return[RS([n[1],n[0],n[2]]),RS([n[2],n[0],n[3]])]}function BS(n){return n.map(Uae).flat()}var nw=new Se,PS=new Se,Ch=new Se;function RS(n){let e=[[n[0][0],n[0][1],n[0][2]],[n[1][0],n[1][1],n[1][2]],[n[2][0],n[2][1],n[2][2]]],t=[[n[0][3],n[0][4]],[n[1][3],n[1][4]],[n[2][3],n[2][4]]];Ch.fromArray(e[0]),nw.fromArray(e[1]).sub(Ch),Ch.fromArray(e[2]),PS.fromArray(e[1]).sub(Ch),nw.cross(PS);let i=nw.toArray();return{positions:e,uvs:t,normal:i}}function VS(n){let e=n.map(o=>o.positions).flat(2),t=n.map(o=>o.uvs).flat(2),i=n.flatMap(o=>o.normal),r=new Yc;return r.setAttribute("position",new lo(new Float32Array(e),3,!1)),r.setAttribute("uv",new lo(new Float32Array(t),2,!1)),r.setAttribute("normal",new lo(new Float32Array(i),3,!0)),r}function gr(...n){let e=BS(n);return VS(e)}function vl(n,...e){let t=zae(e);for(let r=0;r<n;++r)t=Gae(t);e=jae(t);let i=BS(e);return VS(i)}function zae(n){return n.map(e=>{let t=Number.MAX_VALUE,i=Number.MIN_VALUE,r=Number.MAX_VALUE,o=Number.MIN_VALUE;for(let c of e){let u=c[3],p=c[4];t=Math.min(t,u),i=Math.max(i,u),r=Math.min(r,p),o=Math.max(o,p)}let s=[t,r],l=[i-t,o-r];return{minUV:s,deltaUV:l,verts:[Lh(s,l,e[0]),Lh(s,l,e[1]),Lh(s,l,e[2]),Lh(s,l,e[3])]}})}function Lh(n,e,t){return{pos:[t[0],t[1],t[2]],uv:[t[3],t[4]],pUV:[(t[3]-n[0])/e[0],(t[4]-n[1])/e[1]]}}function jae(n){return n.map(e=>[Ph(e,0),Ph(e,1),Ph(e,2),Ph(e,3)])}function Ph(n,e){let t=n.verts[e];return[t.pos[0],t.pos[1],t.pos[2],t.uv[0],t.uv[1]]}function Gae(n){return n.flatMap(e=>{let t=fu(e,e.verts[0],e.verts[1]),i=fu(e,e.verts[2],e.verts[3]),r=fu(e,e.verts[0],e.verts[3]),o=fu(e,e.verts[1],e.verts[2]),s=fu(e,t,i);return[{minUV:e.minUV,deltaUV:e.deltaUV,verts:[e.verts[0],t,s,r]},{minUV:e.minUV,deltaUV:e.deltaUV,verts:[t,e.verts[1],o,s]},{minUV:e.minUV,deltaUV:e.deltaUV,verts:[s,o,e.verts[2],i]},{minUV:e.minUV,deltaUV:e.deltaUV,verts:[r,s,i,e.verts[3]]}]})}function fu(n,e,t){let i=t.pos[0]-e.pos[0],r=t.pos[1]-e.pos[1],o=t.pos[2]-e.pos[2],s=e.pos[0]+.5*i,l=e.pos[1]+.5*r,c=e.pos[2]+.5*o,u=t.pUV[0]-e.pUV[0],p=t.pUV[1]-e.pUV[1],d=e.pUV[0]+.5*u,h=e.pUV[1]+.5*p,A=IS(d-.5)+.5,g=IS(h-.5)+.5,F=A*n.deltaUV[0]+n.minUV[0],b=g*n.deltaUV[1]+n.minUV[1];return{pos:[s,l,c],pUV:[d,h],uv:[F,b]}}function IS(n){return Math.atan(2*n)/an}function OS(n,e){let t=n*en;return .5*(1-Math.cos(t))-e*Math.sin(2*t)}function NS(n,e){let t=(n-.5)*en;return n*n+e*Math.cos(t)}var Us=di("Juniper:ScaledItems",()=>new Map),WS=1,Xae=1.1,qae=.005,iw=class{constructor(e){this.target=e,this.obj=kn(this.target),this.base=this.obj.scale.clone(),this.p=0,this.dir=0,this.running=!1,this.wasDisabled=this.disabled,this.target.addScopedEventListener(this,"enter",t=>{t.pointer.type!=="nose"&&this.run(1)}),this.target.addScopedEventListener(this,"exit",t=>{t.pointer.type!=="nose"&&this.run(-1)}),this.obj.traverse(t=>{Kn(t)&&this.target.addMesh(t)})}get disabled(){return this.target.disabled}run(e){(!this.disabled||e===-1||this.p>0)&&(this.dir=e,this.running=!0)}updateScaling(e){if(this.disabled!==this.wasDisabled&&(this.wasDisabled=this.disabled,this.disabled&&this.run(-1)),this.running){this.p+=this.dir*e,(this.dir>0&&this.p>=1||this.dir<0&&this.p<0)&&(this.p=Math.max(0,Math.min(1,this.p)),this.running=!1);let t=OS(this.p,1.1);this.obj.scale.copy(this.base).multiplyScalar(t*(Xae-WS)+WS)}}dispose(){this.target.removeScope(this)}};function HS(n){n*=qae;for(let e of Us.values())e.updateScaling(n)}function US(n){let e=Us.get(n);e&&(Us.delete(n),Tt(e))}function Rh(n,e){let t=Us.has(n);if(e!=t)if(e)Us.set(n,new iw(n));else{let i=Us.get(n);Tt(i),Us.delete(n)}}function ut(n){let e=new Array,t=new Set;for(e.push(n);e.length>0;){let i=e.shift();i&&!t.has(i)&&(t.add(i),i.isMesh&&e.push(i.material,i.geometry),i.isMaterial&&e.push(...Object.values(i)),i.isObject3D&&(e.push(...i.children),i.clear(),US(i)),Wn(i)&&e.push(...i),Io(i))}t.clear()}function Ih(n){return n instanceof HTMLVideoElement?n.videoWidth:n instanceof VideoFrame?n.displayWidth:n.width}function Bh(n){return n instanceof HTMLVideoElement?n.videoHeight:n instanceof VideoFrame?n.displayHeight:n.height}var zS=304.79999999999995,k2e=zS*3,rw=10*100,Yae=zS*16.5,Kae=Yae*40,M2e=rw*1e3,D2e=Kae*8,jS=2.54*4,GS=jS*3,C2e=GS*3,Qae=GS*16.5,$ae=Qae*40,L2e=100*1e3,P2e=$ae*8,ow=4*3,Jae=ow*3,gu=100/2.54,Zae=ow*16.5,ele=Zae*40,R2e=gu*1e3,I2e=ele*8,B2e=3*3,tle=100/jS,nle=3*16.5,ile=nle*40,V2e=tle*1e3,O2e=ile*8,sw=gu/ow,rle=16.5*40,N2e=sw*1e3,W2e=rle*8,ole=gu/Jae,sle=16.5/3,ale=sle*40,H2e=ole*1e3,U2e=ale*8,XS=16.5/sw,qS=XS*40,z2e=qS*8,j2e=1e3/XS,G2e=40*8,lle=1e3/qS,X2e=8/lle;function YS(n){return n/sw}function Yo(n){return n/gu}function Vh(n){return n*rw}function KS(n){return n*gu}function Oh(n){return n/rw}var aw=new Oo(1,1,1,1);aw.name="PlaneGeom";var cle=new vt,Nh=new Se,QS=new Ir,$S=new it;function lw(n,e,t){return cle.copy(n.matrixWorld).invert().multiply(e.matrixWorld).decompose(Nh,$S,t),QS.set(Nh.x,Nh.y,Nh.z,1),new XRRigidTransform(QS,$S)}var bl=new Se,ule=0,xr=class extends pt{constructor(e,t,i,r=null){if(super(),this.webXRLayerType=i,this.lastMatrixWorld=new vt,this._imageWidth=0,this._imageHeight=0,this.forceUpdate=!1,this.wasUsingLayer=!1,this.layer=null,this.curImage=null,this.lastImage=null,this.lastWidth=null,this.lastHeight=null,this.env=null,this.mesh=null,this.stereoLayoutName="mono",this.sizeMode="none",e){this.setEnvAndName(e,t);let o=$b(r)?r:Qa(Object.assign({},r,{name:this.name}));De(this,this.mesh=hr(t+"-Mesh",aw,o))}}copy(e,t=!0){return super.copy(e,t),this.webXRLayerType=e.webXRLayerType,this.setImageSize(e.imageWidth,e.imageHeight),this.setEnvAndName(e.env,e.name+ ++ule),this.mesh=Rn(this.children,Kn),oe(this.mesh)&&(this.mesh=e.mesh.clone(),De(this,this.mesh)),this.setTextureMap(e.curImage),this}dispose(){this.env.removeScope(this),this.disposeImage(),ut(this.mesh)}disposeImage(){this.removeWebXRLayer(),ut(this.mesh.material.map),this.curImage=null}setImageSize(e,t){if(e!==this.imageWidth||t!==this.imageHeight){let{objectWidth:i,objectHeight:r}=this;this._imageWidth=e,this._imageHeight=t,this.sizeMode!=="none"&&(this.sizeMode==="fixed-width"?this.objectWidth=i:this.objectHeight=r)}}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get imageAspectRatio(){return this.imageWidth/this.imageHeight}get objectWidth(){return this.scale.x}set objectWidth(e){this.scale.set(e,this.scale.y=e/this.imageAspectRatio,1)}get objectHeight(){return this.scale.y}set objectHeight(e){this.scale.set(this.imageAspectRatio*e,e,1)}get pixelDensity(){let e=KS(this.objectWidth);return this.imageWidth/e}set pixelDensity(e){let t=this.imageWidth/e,i=Yo(t);this.objectWidth=i}setEnvAndName(e,t){this.env=e,this.name=t,this.env.addScopedEventListener(this,"update",i=>this.checkWebXRLayer(i.frame))}get needsLayer(){return!Vd(this)||oe(this.mesh.material.map)||oe(this.curImage)?!1:this.curImage instanceof HTMLVideoElement?!this.curImage.paused||this.curImage.currentTime>0:!0}removeWebXRLayer(){if(y(this.layer)){this.wasUsingLayer=!1,this.env.removeWebXRLayer(this.layer),this.mesh.visible=!0;let e=this.layer;this.layer=null,setTimeout(()=>Io(e),100)}}setTextureMap(e){this.curImage&&this.disposeImage(),e&&(Np(e)?e=mA(e):pA(e)&&(e=fA(e)),Op(e)&&(e=e),this.curImage=e,this.setImageSize(Ih(e),Bh(e)),e instanceof HTMLVideoElement?this.mesh.material.map=new Xb(e):(this.mesh.material.map=new Vs(e),this.mesh.material.map.needsUpdate=!0)),this.mesh.material.needsUpdate=!0}get isVideo(){return this.curImage instanceof HTMLVideoElement}updateTexture(){if(y(this.curImage)){let e=Ih(this.curImage),t=Bh(this.curImage);if(this.imageWidth!==e||this.imageHeight!==t){let i=this.curImage;this.disposeImage(),this.setTextureMap(i)}else this.mesh.material.map.needsUpdate=this.forceUpdate=!0}}checkWebXRLayer(e){if(this.mesh.material.map&&this.curImage){let i=this.webXRLayerType!=="none"&&this.env.hasXRCompositionLayers&&this.env.showWebXRLayers&&y(e)&&(this.isVideo&&y(this.env.xrMediaBinding)||!this.isVideo&&y(this.env.xrBinding))&&this.needsLayer,r=i!==this.wasUsingLayer,o=this.curImage!==this.lastImage||this.mesh.material.needsUpdate||this.mesh.material.map.needsUpdate||this.forceUpdate,s=this.imageWidth!==this.lastWidth||this.imageHeight!==this.lastHeight;if(this.wasUsingLayer=i,this.lastImage=this.curImage,this.lastWidth=this.imageWidth,this.lastHeight=this.imageHeight,(r||s)&&((!i||s)&&this.layer&&this.removeWebXRLayer(),i)){let l=this.env.referenceSpace,c=lw(this.env.stage,this.mesh,bl);this.lastMatrixWorld.copy(this.matrixWorld);let u=bl.x/2,p=bl.y/2,d=this.stereoLayoutName==="mono"?"mono":this.stereoLayoutName==="left-right"||this.stereoLayoutName==="right-left"?"stereo-left-right":"stereo-top-bottom";if(this.isVideo){let h=this.stereoLayoutName==="right-left"||this.stereoLayoutName==="bottom-top";this.layer=this.env.xrMediaBinding.createQuadLayer(this.curImage,{space:l,layout:d,invertStereo:h,transform:c,width:u,height:p})}else this.layer=this.env.xrBinding.createQuadLayer({space:l,layout:d,textureType:"texture",isStatic:this.webXRLayerType==="static",viewPixelWidth:Ih(this.curImage),viewPixelHeight:Bh(this.curImage),transform:c,width:u,height:p});this.env.addWebXRLayer(this.layer,500),this.mesh.visible=!1}if(this.layer){if(o||this.layer.needsRedraw){let l=this.env.gl,c=this.env.xrBinding.getSubImage(this.layer,e);l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!0),l.bindTexture(l.TEXTURE_2D,c.colorTexture),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.curImage),l.generateMipmap(l.TEXTURE_2D),l.bindTexture(l.TEXTURE_2D,null),this.forceUpdate=!1}bp(this.matrixWorld.elements,this.lastMatrixWorld.elements)>=0&&(this.layer.transform=lw(this.env.stage,this.mesh,bl),this.lastMatrixWorld.copy(this.matrixWorld),this.layer.width=bl.x/2,this.layer.height=bl.y/2)}else this.forceUpdate=!1}}};var ZS=["N/A","Cubemap","Cubemap Strips","Equi-Angular Cubemap (YouTube)","Equirectangular","Half Equirectangular","Panoramic"],e_=["mono","left-right","right-left","top-bottom","bottom-top"],Hh=class extends Fl{constructor(e,t,i){super("video-player-3d",t,i),this.material=Qa({name:"videoPlayer-material"}),this.vidMeshes=[];for(let r=0;r<2;++r){let o=new xr(e,`videoPlayer-view${r+1}`,"none",this.material);o.setTextureMap(this.video),o.mesh.renderOrder=4,r>0?o.mesh.layers.disable(0):o.mesh.layers.enable(0),this.vidMeshes.push(o)}this.object=ft("videoPlayer",...this.vidMeshes)}get meshes(){return this.vidMeshes.map(e=>e.mesh)}onDisposing(){super.onDisposing(),ut(this.object),qe(this.vidMeshes)}isSupported(e,t){return t.split("-").map(i=>JS.has(e,i)).reduce(iF,!0)}setStereoParameters(e,t){if(!this.isSupported(e,t))throw new Error(`Not supported [encoding: ${e}, layout: ${t}]`);for(let o=0;o<this.vidMeshes.length;++o){let s=this.vidMeshes[o];s.webXRLayerType="none",s.mesh.layers.disable(1),s.mesh.layers.disable(2),t==="left-right"||t==="top-bottom"?s.mesh.layers.enable(this.vidMeshes.length-o):t!=="mono"&&s.mesh.layers.enable(o+1)}let i=this.height/this.width;e!=="N/A"?this.vidMeshes[0].scale.setScalar(100):t==="mono"?this.vidMeshes[0].scale.set(1,i,1):t==="left-right"||t==="right-left"?this.vidMeshes[0].scale.set(1,2*i,1):this.vidMeshes[0].scale.set(1,.5*i,1);for(let o=1;o<this.vidMeshes.length;++o)this.vidMeshes[o].scale.copy(this.vidMeshes[0].scale);let r=t.split("-");for(let o=0;o<r.length;++o){let s=r[o],l=JS.get(e,s),c=this.vidMeshes[o];c.webXRLayerType="dynamic",c.visible=!0,c.mesh.geometry!==l&&(ut(c.mesh.geometry),c.mesh.geometry=l)}}},ple=gr([[-1/2,1/2,0,0,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,0,0]]),t_=[[-1/2,1/2,0,0,1],[1/2,1/2,0,.5,1],[1/2,-1/2,0,.5,0],[-1/2,-1/2,0,0,0]],n_=[[-1/2,1/2,0,.5,1],[1/2,1/2,0,1,1],[1/2,-1/2,0,1,0],[-1/2,-1/2,0,.5,0]],i_=[[[-1/2,1/2,-1/2,1/3,1],[1/2,1/2,-1/2,2/3,1],[1/2,-1/2,-1/2,2/3,1/2],[-1/2,-1/2,-1/2,1/3,1/2]],[[1/2,1/2,-1/2,2/3,1],[1/2,1/2,1/2,1,1],[1/2,-1/2,1/2,1,1/2],[1/2,-1/2,-1/2,2/3,1/2]],[[-1/2,1/2,1/2,0,1],[-1/2,1/2,-1/2,1/3,1],[-1/2,-1/2,-1/2,1/3,1/2],[-1/2,-1/2,1/2,0,1/2]],[[1/2,1/2,1/2,2/3,1/2],[-1/2,1/2,1/2,2/3,0],[-1/2,-1/2,1/2,1/3,0],[1/2,-1/2,1/2,1/3,1/2]],[[1/2,1/2,-1/2,1,1/2],[-1/2,1/2,-1/2,1,0],[-1/2,1/2,1/2,2/3,0],[1/2,1/2,1/2,2/3,1/2]],[[1/2,-1/2,1/2,1/3,1/2],[-1/2,-1/2,1/2,1/3,0],[-1/2,-1/2,-1/2,0,0],[1/2,-1/2,-1/2,0,1/2]]],cw=[[[-1/2,1/2,-1/2,0,1/3],[1/2,1/2,-1/2,0,2/3],[1/2,-1/2,-1/2,1/4,2/3],[-1/2,-1/2,-1/2,1/4,1/3]],[[1/2,1/2,-1/2,0,2/3],[1/2,1/2,1/2,0,1],[1/2,-1/2,1/2,1/4,1],[1/2,-1/2,-1/2,1/4,2/3]],[[-1/2,1/2,1/2,0,0],[-1/2,1/2,-1/2,0,1/3],[-1/2,-1/2,-1/2,1/4,1/3],[-1/2,-1/2,1/2,1/4,0]],[[1/2,1/2,1/2,1/4,2/3],[-1/2,1/2,1/2,1/2,2/3],[-1/2,-1/2,1/2,1/2,1/3],[1/2,-1/2,1/2,1/4,1/3]],[[1/2,1/2,-1/2,1/4,1],[-1/2,1/2,-1/2,1/2,1],[-1/2,1/2,1/2,1/2,2/3],[1/2,1/2,1/2,1/4,2/3]],[[1/2,-1/2,1/2,1/4,1/3],[-1/2,-1/2,1/2,1/2,1/3],[-1/2,-1/2,-1/2,1/2,0],[1/2,-1/2,-1/2,1/4,0]]],uw=[[[-1/2,1/2,-1/2,1/2,1/3],[1/2,1/2,-1/2,1/2,2/3],[1/2,-1/2,-1/2,3/4,2/3],[-1/2,-1/2,-1/2,3/4,1/3]],[[1/2,1/2,-1/2,1/2,2/3],[1/2,1/2,1/2,1/2,1],[1/2,-1/2,1/2,3/4,1],[1/2,-1/2,-1/2,3/4,2/3]],[[-1/2,1/2,1/2,1/2,0],[-1/2,1/2,-1/2,1/2,1/3],[-1/2,-1/2,-1/2,3/4,1/3],[-1/2,-1/2,1/2,3/4,0]],[[1/2,1/2,1/2,3/4,2/3],[-1/2,1/2,1/2,1,2/3],[-1/2,-1/2,1/2,1,1/3],[1/2,-1/2,1/2,3/4,1/3]],[[1/2,1/2,-1/2,3/4,1],[-1/2,1/2,-1/2,1,1],[-1/2,1/2,1/2,1,2/3],[1/2,1/2,1/2,3/4,2/3]],[[1/2,-1/2,1/2,3/4,1/3],[-1/2,-1/2,1/2,1,1/3],[-1/2,-1/2,-1/2,1,0],[1/2,-1/2,-1/2,3/4,0]]],dle=gr(t_),hle=gr(n_),mle=gr(pw(t_)),fle=gr(pw(n_)),r_=s_(cw),o_=s_(uw),gle=gr(...i_),xle=gr(...cw),wle=gr(...uw),Fle=gr(...r_),Ale=gr(...o_),xu=4,vle=vl(xu,...i_),ble=vl(xu,...cw),Sle=vl(xu,...uw),_le=vl(xu,...r_),yle=vl(xu,...o_),JS=new Bn([["N/A","mono",ple],["N/A","left",dle],["N/A","right",hle],["N/A","top",mle],["N/A","bottom",fle],["Cubemap Strips","mono",gle],["Cubemap Strips","left",xle],["Cubemap Strips","right",wle],["Cubemap Strips","top",Fle],["Cubemap Strips","bottom",Ale],["Equi-Angular Cubemap (YouTube)","mono",vle],["Equi-Angular Cubemap (YouTube)","left",ble],["Equi-Angular Cubemap (YouTube)","right",Sle],["Equi-Angular Cubemap (YouTube)","top",_le],["Equi-Angular Cubemap (YouTube)","bottom",yle]]);function Wh(n){return[n[0],n[1],n[2],n[4],1-n[3]]}function pw(n){return[Wh(n[0]),Wh(n[1]),Wh(n[2]),Wh(n[3])]}function s_(n){return n.map(pw)}var uo=class extends Ba{constructor(e,t,i,r){if(!Er.matches(i)&&!Mc.matches(i))throw new Error("Only GLTF model types are currently supported");super(t,i,r),this.env=e}async getResponse(e){let t=await e.file();return zt(t,i=>this.env.loadGltf(i))}};function a_(n,e){let t=[n];for(;t.length>0;){let i=t.shift();if(e(i))return i;i.children.length>0&&t.push(...i.children)}return null}var Uh=class{get object(){return this._model}constructor(e,t){this.disposed=!1,this.asset=new uo(e,t,Er,!e.DEBUG),this.asset.then(()=>{this._model=a_(this.asset.result.scene,Kn);let c=this._model.material.roughnessMap;Ns(this._model,Ws),this._model.material.specularMap=c,e.timer.addTickHandler(l)});function i(c){return c.enabled&&(c.grip.visible||c.hand.visible&&c.hand.joints.wrist&&c.hand.joints.wrist.visible)}let r=e.DEBUG,o=e.xrUI.visible,s=0,l=()=>{let c=e.xrUI.visible,u=0;for(let p of e.eventSys.hands)i(p)&&++u;if(c!==o||u!==s||r!==e.DEBUG){if(e.clockImage.isVisible=c||e.DEBUG,c&&u>0){let p=null;for(let h of e.eventSys.hands)i(h)&&(oe(p)||h.handedness==="left")&&(p=h);let d=p.grip.visible?p.grip:p.hand.joints.wrist;if(d!==e.clockImage.object.parent){De(d,De(this,e.clockImage,e.batteryImage));let h=p.handedness==="left"?1:0;d===p.grip?(this.object.rotation.set(0,h*en,-an,"XYZ"),this.object.position.set(0,0,.07)):(this.object.rotation.set(0,h*en,0,"XYZ"),this.object.position.set(0,0,0)),e.clockImage.scale.setScalar(.0175),e.clockImage.position.set(0,.029,0),e.clockImage.rotation.set(-an,0,-an),y(e.batteryImage)&&(e.batteryImage.scale.set(2,1,1).multiplyScalar(.008),e.batteryImage.position.set(.0075,.029,0),e.batteryImage.rotation.set(-an,0,-an))}}else e.xrUI.addItem(e.clockImage,{x:-1,y:1,height:.1}),y(e.batteryImage)&&e.xrUI.addItem(e.batteryImage,{x:.75,y:-1,width:.2,height:.1});o=c,s=u,r=e.DEBUG}}}dispose(){this.disposed||(y(this.object)&&(this.object.removeFromParent(),ut(this.object),this._model=null),this.disposed=!0)}};function l_(n,e){return n==="click"&&e&&(n="error"),`InteractionAudio-${n}`}var zh=class{constructor(e,t){this.audio=e,this.eventSys=t;let i=r=>{if(r.pointer.type!=="nose"&&r.rayTarget&&r.rayTarget.clickable){let o=l_(r.type,!r.rayTarget.enabled);if(this.audio.hasClip(o)){let{x:s,y:l,z:c}=r.point;this.audio.setClipPosition(o,s,l,c),this.audio.playClip(o)}}};this.eventSys.addEventListener("enter",i),this.eventSys.addEventListener("exit",i),this.eventSys.addEventListener("click",i)}create(e,t,i){return this.audio.createClip(l_(e,!1),t,!1,!0,!1,!0,i,[])}};var zs=class extends Error{constructor(e,t=null){super(e),this.innerError=t}};var jh=class extends Qn{constructor(e,t,i,r,o){e=e+In(16),super(ft(e)),this.enabledMaterial=i,this.disabledMaterial=r,this.mesh=hr(`Mesh-${e}-enabled`,t,i),this.size=o,De(this,this.mesh),this.addMesh(this.mesh),this.clickable=!0,this.disabled=this.disabled,Rh(this,!0)}get size(){return this.mesh.scale.x}set size(e){this.mesh.scale.setScalar(e)}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.mesh.material=e?this.disabledMaterial:this.enabledMaterial}};var Gh=class{constructor(e,t,i,r,o){this.imagePaths=e,this.padding=t,this.buttonFillColor=i,this.labelFillColor=r,this.uvDescrips=new Bn,this.geoms=new Bn,this.canvas=null,this.texture=null,this.enabledMaterial=null,this.disabledMaterial=null,this.assetSets=new Bn(Array.from(this.imagePaths.entries()).map(([s,l,c])=>[s,l,new Vp(c,Tr,!o)])),this.assets=Array.from(this.assetSets.values()),this.ready=Promise.all(this.assets).then(()=>{let s=this.assets.map(M=>M.result),l=Math.max(...s.map(M=>M.width)),c=Math.max(...s.map(M=>M.height)),u=l*c*s.length,p=Math.sqrt(u),d=Math.floor(p/l),h=Math.ceil(s.length/d),A=d*l,g=h*c,F=_x(A),b=_x(g),R=A/F,P=g/b,L=l/F,S=c/b;this.canvas=Hp(F,b);let x=this.canvas.getContext("2d",{alpha:!1});x.fillStyle=this.buttonFillColor,x.fillRect(0,0,F,b);let v=0;for(let[M,O,B]of this.assetSets.entries()){let X=B.result,V=v%d,J=(v-V)/d,ce=R*(V*l/A),G=P*(1-J/h)-S,Y=V*l,K=J*c+b-g,se=l-2*this.padding,$=c-2*this.padding;x.drawImage(X,0,0,X.width,X.height,Y+this.padding,K+this.padding,se,$),this.uvDescrips.add(M,O,{u:ce,v:G,du:L,dv:S}),++v}this.texture=new lb(this.canvas),this.enabledMaterial=new Yn({map:this.texture}),this.enabledMaterial.needsUpdate=!0,this.disabledMaterial=new Yn({map:this.texture,transparent:!0,opacity:.5}),this.disabledMaterial.needsUpdate=!0})}getImageSrc(e,t){let i=this.imagePaths.get(e),r=i&&i.get(t);if(!r)throw new zs(`Button ${e}/${t} does not exist`,this.uvDescrips);return r}async getMeshButton(e,t,i){await this.ready;let r=this.uvDescrips.get(e),o=r&&r.get(t);if(!r||!o)throw new zs(`Button ${e}/${t} does not exist`,this.uvDescrips);let s=this.geoms.get(e,t);if(!s){s=new Oo(1,1,1,1),s.name=`Geometry:${e}/${t}`,this.geoms.add(e,t,s);let c=s.getAttribute("uv");for(let u=0;u<c.count;++u){let p=c.getX(u)*o.du+o.u,d=c.getY(u)*o.dv+o.v;c.setX(u,p),c.setY(u,d)}}return new jh(t,s,this.enabledMaterial,this.disabledMaterial,i)}};function c_(n,e){n.element instanceof HTMLButtonElement&&(n.element.disabled=!e),Od(n,e)}function u_(n,...e){Ee(n,...e.filter(EF)),De(n,...e.filter(eS))}function Xh(n){DF(n),tS(n)}var Ko=class{constructor(e,t,i){this.element=e,this.object=t,this.displayType=i}get name(){return this.object.name}addEventListener(e,t,i){this.element.addEventListener(e,t,i)}dispatchEvent(e){return this.element.dispatchEvent(e)}removeEventListener(e,t,i){this.element.removeEventListener(e,t,i)}click(){this.element.click()}get visible(){return zn(this)}set visible(e){Ue(this,e,this.displayType),this.object.visible=e}};var Sl=class extends Ko{constructor(e,t,i){let r=Ii(`${t} ${i}`);super(ar(r,Gn(r,Un(e.getImageSrc(t,i)))),ft(`${name}-button`),"inline-block"),this.mesh=null,this.load(e,t,i)}async load(e,t,i){this.mesh=await e.getMeshButton(t,i,.2),this.mesh.disabled=this.disabled,De(this,this.mesh),this.mesh.object.visible=this.visible,this.mesh.addEventListener("click",()=>{this.element.click()})}get disabled(){return this.element.disabled}set disabled(e){this.element.disabled=e,this.mesh&&(this.mesh.disabled=e)}get visible(){return super.visible}set visible(e){super.visible=e,this.mesh&&nn(this.mesh,e)}};var Tle={type:"redrawn"},Qo=class extends xr{get object(){return this}get element(){return cr(this.image.canvas)?this.image.canvas:null}get canvas(){return this._image.canvas}constructor(e,t,i,r,o){super(e,t,i,o),this._image=null,this.image=r}onRedrawn(){this.updateTexture(),this.dispatchEvent(Tle)}get image(){return this._image}set image(e){this.image&&this.image.removeScope(this),this._image=e,this.image&&(this.image.addScopedEventListener(this,"redrawn",()=>this.onRedrawn()),this.setTextureMap(this.image.canvas),this.onRedrawn())}get imageWidth(){return this.image.width}get imageHeight(){return this.image.height}copy(e,t=!0){return super.copy(e,t),this.image=e.image,this}get isVisible(){return zn(this)}set isVisible(e){Ue(this,e,"inline-block"),nn(this,e),nn(this.mesh,e),this.image.visible=e}};function p_(n){return!n.started||n.finished}var dw=class extends et{constructor(){super(!1),this.time=0,this.duration=0,this.onTick=null}begin(e,t,i){this.restart(),this.time=-e,this.duration=t,this.onTick=i,this.onTick(0)}update(e){p_(this)||(this.time+=e/this.duration,this.time>=1?(this.onTick(1),this.resolve()):this.time>=0&&this.onTick(this.time))}},qh=class{constructor(){this.animations=new Array}update(e){e=.001*e;for(let t of this.animations)t.update(e)}clear(){for(let e of this.animations)e.resolve()}start(e,t,i){let r=Rn(this.animations,p_);return r||this.animations.push(r=new dw),r.begin(e,t,i),r}};var mi=class extends Qo{constructor(e,t,i,r,o){let s;r instanceof fr?s=r:s=new fr(r),super(e,t,i,s,o)}onRedrawn(){this.objectHeight=this.imageHeight,super.onRedrawn()}};var js=class extends Qn{constructor(e,t,i,r){if(super(ft(t)),this.env=e,y(i)){r=Object.assign({textFillColor:"white",fontFamily:"Segoe UI Emoji",fontSize:20,minHeight:.25,maxHeight:.25},r,{value:i}),this.image=new fr(r);let o=In(16);this.enabledImage=this.createImage(`${o}-enabled`,1),this.disabledImage=this.createImage(`${o}-disabled`,.5),this.disabledImage.visible=!1,De(this,this.enabledImage,this.disabledImage)}this.addMesh(this.enabledImage.mesh),this.addMesh(this.disabledImage.mesh),this.clickable=!0,y(i)&&Rh(this,!0)}createImage(e,t){return new mi(this.env,`text-${e}`,"none",this.image,{side:Rs,opacity:t})}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.enabledImage.visible=!e,this.disabledImage.visible=e}};var d_={bgStrokeColor:"black",bgStrokeSize:.04,textFillColor:"white",scale:150},h_=Object.assign({},d_,{padding:{left:.1,right:.1,top:.025,bottom:.025},fontSize:20,minHeight:.5,maxHeight:.5}),Ele=Object.assign({},h_,{bgFillColor:pi(0,117,215)}),kle=Object.assign({},h_,{bgFillColor:pi(117,0,0)}),Mle=Object.assign({},d_,{bgFillColor:"white",textFillColor:"black",padding:{top:.1,left:.1,bottom:.4,right:.1},fontSize:25,minHeight:1,maxHeight:1}),Dle=.9;function hw(n,e){return Object.assign({},n,{fontFamily:e})}var Yh=class extends Mi{constructor(e,t){super("Confirm action"),this.env=e,this.object=ft("ConfirmationDialog"),this.root=ft("Root"),this.animator=new qh,this.a=0,this.b=0,this.confirmButton.innerText="Yes",this.cancelButton.innerText="No",this.mesh=new mi(this.env,"confirmationDialogLabel","none",hw(Mle,t)),this.confirmButton3D=new js(this.env,"confirmationDialogConfirmButton","Yes",hw(Ele,t)),this.confirmButton3D.addEventListener("click",()=>this.confirmButton.click()),this.confirmButton3D.object.position.set(1,-.5,.5),this.cancelButton3D=new js(this.env,"confirmationDialogCancelButton","No",hw(kle,t)),this.cancelButton3D.addEventListener("click",()=>this.cancelButton.click()),this.cancelButton3D.object.position.set(2,-.5,.5),Ee(this.container,wp(`calc(${Xt(100)} - ${vi(2)})`),Pn("max-content")),Ee(this.contentArea,W0(P0(18)),q0("center"),Aa(vi(1))),De(this,De(this.root,this.mesh,this.confirmButton3D,this.cancelButton3D)),nn(this.root,!1),this.root.scale.setScalar(0),this.onTick=i=>{let r=NS(this.a+this.b*i,Dle);this.root.scale.set(r,r,.01)}}get name(){return this.object.name}get visible(){return zn(this)}set visible(e){Ue(this,e,"inline-block"),this.mesh.visible=e}update(e){this.animator.update(e)}async showHide(e,t){this.a=e,this.b=t,await this.animator.start(0,.25,this.onTick),this.animator.clear()}get use3D(){return this.env.renderer.xr.isPresenting||this.env.testSpaceLayout}async onShowing(){await super.onShowing(),this.use3D&&(this.root.visible=!0,await this.showHide(0,1))}onShown(){this.use3D&&(this.element.style.display="none")}async onClosing(){this.use3D&&(await this.showHide(1,-1),this.root.visible=!1),await super.onClosing()}prompt(e,t){return this.title=e,Ie(this.contentArea,t),this.mesh.image.value=t,this.showDialog()}};var $o=class extends Ko{constructor(e,t,i,r){super(ar(),ft(`${t}-button`),"inline-block"),this.buttons=e,this.setName=t,this.activeName=i,this.inactiveName=r,this.enterButton=null,this.exitButton=null,this._isAvailable=!0,this._isEnabled=!0,this._isActive=!1,Ee(this,this.btnImage=Gn()),this.load()}async load(){let[e,t]=await sn(this.buttons.getMeshButton(this.setName,this.activeName,.2),this.buttons.getMeshButton(this.setName,this.inactiveName,.2));De(this.object,this.enterButton=e,this.exitButton=t),this.enterButton.addEventListener("click",()=>this.element.click()),this.exitButton.addEventListener("click",()=>this.element.click()),this.refreshState()}get mesh(){return this.active?this.enterButton:this.exitButton}get available(){return this._isAvailable}set available(e){this._isAvailable=e,this.refreshState()}get active(){return this._isActive}set active(e){this._isActive=e,this.refreshState()}get enabled(){return this._isEnabled}set enabled(e){this._isEnabled=e,this.refreshState()}get visible(){return super.visible}set visible(e){super.visible=e,this.refreshState()}refreshState(){let e=this.active?this.inactiveName:this.activeName,t=`${e} ${this.setName}`;if(this.element.title=this.btnImage.title=t,this.btnImage.src=this.buttons.getImageSrc(this.setName,e),this.element.disabled=!this.available||!this.visible||!this.enabled,Ue(this,this.available&&this.visible,"inline-block"),this.enterButton&&this.exitButton){Od(this,this.available&&this.visible&&this.enabled);let i=nn(this.object,this.available&&this.visible);nn(this.enterButton,i&&!this.active),nn(this.exitButton,i&&this.active)}}};var Gs=class extends $o{constructor(e,t){let i=tt[t];super(e,i.toLowerCase(),"enter","exit"),this.mode=t}};function m_(n){return new mw(n)}var mw=class extends Ia{pop(e){return this.addSubProgress(e)}};var wu=class extends ge{constructor(e,t){super(e),this.appName=t}},fw=class extends wu{constructor(e,t){super("apploading",e),this.appLoadParams=t}},gw=class extends wu{constructor(e,t){super("apploaded",e),this.app=t}},xw=class extends wu{constructor(e,t){super("appshown",e),this.app=t}},ww=class{constructor(e,t){this.loader=e,this.name=t,this.params=new Map}param(e,t){return this.params.set(e,t),this}load(e){return this.loader(this.name,this.params,e)}},Kh=class extends Be{constructor(e,t){super(),this.env=e,this.getAppUrl=t,this.loadedModules=new Map,this.loadingApps=new Map,this.currentApps=new Map,this.cacheBustString=null}[Symbol.iterator](){return this.currentApps.values()}isLoaded(e){return this.currentApps.has(e)}get(e){return this.currentApps.get(e)}waitFor(e){if(this.isLoaded(e))return Promise.resolve(this.get(e));let t=new et;return this.addScopedEventListener(this,"apploaded",i=>{i.appName===e&&(this.removeScope(this),t.resolve(i.app))}),t}async loadAppConstructor(e,t){if(this.loadedModules.has(e))y(t)&&t.end();else{let r=this.getAppUrl(e);if(y(this.cacheBustString)){let s=new Gi(r,location.href);s.query("v",this.cacheBustString),r=s.toString()}let o=this.env.fetcher.get(r).progress(t).useCache(!this.env.DEBUG).module().then(We);this.loadedModules.set(e,o)}let{default:i}=await this.loadedModules.get(e);return i}app(e){return new ww(this.loadApp.bind(this),e)}loadApp(e,t,i){let r=null;t instanceof Map?r=t:i=t,i=i||this.env.loadingBar;let o=new fw(e,r);if(this.dispatchEvent(o),!this.loadingApps.has(e)){let s=m_(i),l=this.loadAppInstance(this.env,e,r,s.pop(10));this.loadingApps.set(e,l),i=s.pop(1)}return this.loadingApps.get(e)}async loadAppInstance(e,t,i,r){if(!this.currentApps.has(t)){let[o,s]=Et(r,[1,10]),l=await this.loadAppConstructor(t,o),c=new l(e);c.addEventListener("quit",()=>this.unloadApp(t)),c.addEventListener("shown",()=>this.dispatchEvent(new xw(t,c))),y(i)&&await c.init(i),await c.load(s),this.currentApps.set(t,c),this.dispatchEvent(new gw(t,c))}return y(r)&&r.end(),this.currentApps.get(t)}unloadApp(e){let t=this.currentApps.get(e);setTimeout(()=>t.clearEventListeners(),100),Tt(t),this.currentApps.delete(e),this.loadingApps.delete(e)}};var Fu=new Se;function Au(n){return Fu.copy(n),Fu.y=0,Fu.normalize(),Bo(Math.atan2(Fu.x,Fu.z))}function f_(n){return Bo(Math.asin(n.y))}function Xs(n,e){return n.xr.isPresenting?n.xr.getCamera():e}function g_(n,e,t,i){let r=n.elements;e.set(r[4],r[5],r[6]),t.set(-r[8],-r[9],-r[10]),i.set(r[12],r[13],r[14]),e.normalize(),t.normalize()}function Cle(n){return n===DeviceOrientationEvent&&"requestPermission"in n&&Ke(n.requestPermission)}var mn;(function(n){n.None="none",n.MouseFPS="mousefirstperson",n.MouseDrag="mousedrag",n.ScreenEdge="mouseedge",n.Touch="touchswipe",n.Gamepad="gamepad"})(mn||(mn={}));var Fw=class extends ge{constructor(){super("avatarreset")}},Qh=class extends Be{set disableVertical(e){this._disableVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set invertVertical(e){this._invertVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set disableHorizontal(e){this._disableHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}set invertHorizontal(e){this._invertHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}get height(){return this.head.position.y}get object(){return this.head}get worldHeadingRadians(){return this._worldHeadingRadians}get worldPitchRadians(){return this._worldPitchRadians}get fov(){return this.env.camera.fov}set fov(e){e!==this.fov&&(this.env.camera.fov=e,this.env.camera.updateProjectionMatrix())}get stage(){return this.head.parent}constructor(e,t){super(),this.env=e,this.avatarResetEvt=new Fw,this.controlMode=mn.None,this.snapTurnRadians=je(30),this.sensitivities=new Map([[mn.MouseDrag,100],[mn.MouseFPS,-100],[mn.Touch,50],[mn.Gamepad,1]]),this.B=new Se(0,0,1),this.F=new Se,this.U=new Se,this.P=new Se,this.M=new vt,this.E=new Rr,this.Q1=new it,this.Q2=new it,this.Q3=new it(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this.Q4=new it,this.motion=new ln,this.rotStage=new vt,this.axisControl=new ln(0,0),this.deviceQ=new it().identity(),this.uv=new ln,this.duv=new ln,this.move=new Se,this.move2=new Se,this.radialAcceleration=new ln(1.5,1.5),this.radialSpeed=new ln(1,1),this.radialEdgeFactor=3/4,this.minFOVDegrees=15,this.maxFOVDegrees=120,this.minPitchRadians=je(-85),this.maxPitchRadians=je(85),this.followers=new Array,this.dz=0,this._headingRadians=0,this._pitchRadians=0,this._rollRadians=0,this.headX=0,this.headZ=0,this._worldHeadingRadians=0,this._worldPitchRadians=0,this.fwrd=!1,this.back=!1,this.left=!1,this.rght=!1,this.fwrd2=!1,this.back2=!1,this.left2=!1,this.rght2=!1,this.up=!1,this.down=!1,this.grow=!1,this.shrk=!1,this._keyboardControlEnabled=!1,this.worldPos=new Se,this.worldQuat=new it,this.lockMovement=!1,this.fovZoomEnabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.onDeviceOrientationChangeEvent=null,this.onScreenOrientationChangeEvent=null,this.motionEnabled=!1,this.pointersToSend=new Array,this.disableHorizontal=!1,this.disableVertical=!1,this.invertHorizontal=!1,this.invertVertical=!0,this._height=this.env.defaultAvatarHeight,this.head=ft("Head",t);let i=!1,r=(o,s)=>{if(o==="w"&&(this.fwrd=s),o==="s"&&(this.back=s),o==="a"&&(this.left=s),o==="d"&&(this.rght=s),o==="e"&&(this.up=s),o==="q"&&(this.down=s),o==="ArrowUp"&&(this.fwrd2=s),o==="ArrowDown"&&(this.back2=s),o==="ArrowLeft"&&(this.left2=s),o==="ArrowRight"&&(this.rght2=s),o==="r"&&(this.grow=s),o==="f"&&(this.shrk=s),o==="Home"){let l=i;i=s,l&&!i&&(this.reset(),this.dispatchEvent(this.avatarResetEvt))}};this.onKeyDown=o=>r(o.key,ao(o)),this.onKeyUp=o=>r(o.key,!1),this.keyboardControlEnabled=!0,matchMedia("(pointer: coarse)").matches?this.controlMode=mn.Touch:matchMedia("(pointer: fine)").matches&&(this.controlMode=mn.MouseDrag),globalThis.isSecureContext&&Wc()&&!io()&&(this.onDeviceOrientationChangeEvent=o=>{this.deviceOrientation=o},this.onScreenOrientationChangeEvent=()=>{"screen"in globalThis&&"orientation"in screen?this.screenOrientation=screen.orientation.angle:"window"in globalThis&&"orientation"in globalThis.window&&(this.screenOrientation=globalThis.window.orientation||0)},SA?Br(()=>this.startMotionControl()):this.startMotionControl())}snapTurn(e){this.setHeading(this.headingRadians-this.snapTurnRadians*e)}get keyboardControlEnabled(){return this._keyboardControlEnabled}set keyboardControlEnabled(e){this._keyboardControlEnabled!==e&&(this._keyboardControlEnabled=e,this._keyboardControlEnabled?(this.env.renderer.domElement.addEventListener("keydown",this.onKeyDown),this.env.renderer.domElement.addEventListener("keyup",this.onKeyUp)):(this.env.renderer.domElement.removeEventListener("keydown",this.onKeyDown),this.env.renderer.domElement.removeEventListener("keyup",this.onKeyUp)))}addFollower(e){this.followers.push(e)}onMove(e,t,i){this.setMode(e),e.canMoveView&&this.controlMode!==mn.None&&this.gestureSatisfied(e)&&(this.uv.copy(t),this.duv.copy(i))}setMode(e){e.type==="remote"||e.type==="nose"||(e.type==="hand"?this.controlMode=mn.None:e.type==="gamepad"?this.controlMode=mn.Gamepad:e.rayTarget&&e.rayTarget.draggable&&!this.env.eventSys.mouse.isPointerLocked&&e.isPressed(tn.Primary)?this.controlMode=mn.ScreenEdge:e.type==="touch"||e.type==="pen"?this.controlMode=mn.Touch:e.type==="mouse"?this.controlMode=this.env.eventSys.mouse.isPointerLocked?mn.MouseFPS:mn.MouseDrag:yt(e.type))}gestureSatisfied(e){return this.controlMode===mn.None?!1:this.controlMode===mn.Gamepad||this.controlMode===mn.MouseFPS||this.controlMode===mn.ScreenEdge||e.isPressed(tn.Primary)}get name(){return this.object.name}set name(e){this.object.name=e}get headingRadians(){return this._headingRadians}setHeading(e){this._headingRadians=Bo(e)}get pitchRadians(){return this._pitchRadians}setPitch(e,t,i){this._pitchRadians=Bo(e+en)-en,this._pitchRadians=ri(this._pitchRadians,t,i)}get rollRadians(){return this._rollRadians}setRoll(e){this._rollRadians=Bo(e)}setHeadingImmediate(e){this.setHeading(e),this.updateOrientation(),this.resetFollowers()}setOrientationImmediate(e,t){this.setHeading(e),this._pitchRadians=Bo(t),this.updateOrientation()}zoom(e){this.dz=e}update(e){e*=.001;let t=this.deviceOrientation;if(t&&Ai(t.alpha)&&Ai(t.beta)&&Ai(t.gamma)){let i=je(t.alpha)+this.alphaOffset,r=je(t.beta),o=je(t.gamma),s=this.screenOrientation?je(this.screenOrientation):0;this.E.set(r,i,-o,"YXZ"),this.Q2.setFromAxisAngle(this.B,-s),this.Q4.setFromEuler(this.E).multiply(this.Q3).multiply(this.Q2),this.deviceQ.slerp(this.Q4,.8)}if(!this.lockMovement){if(this.fovZoomEnabled&&Math.abs(this.dz)>0){let r=Math.pow(.95,5e3*e);this.dz=rb(r*this.dz),this.fov=ri(this.env.camera.fov-this.dz,this.minFOVDegrees,this.maxFOVDegrees)}if(this.controlMode===mn.ScreenEdge)this.uv.manhattanLength()>0&&(this.motion.set(this.scaleRadialComponent(-this.uv.x,this.radialSpeed.x,this.radialAcceleration.x),this.scaleRadialComponent(this.uv.y,this.radialSpeed.y,this.radialAcceleration.y)).multiplyScalar(e),this.setHeading(this.headingRadians+this.motion.x),this.setPitch(this.pitchRadians+this.motion.y,this.minPitchRadians,this.maxPitchRadians),this.setRoll(0));else if(this.sensitivities.has(this.controlMode)&&this.duv.manhattanLength()>0){let r=this.sensitivities.get(this.controlMode)||1;this.motion.copy(this.duv).multiplyScalar(r*e).multiply(this.axisControl),this.setHeading(this.headingRadians+this.motion.x),this.setPitch(this.pitchRadians+this.motion.y,this.minPitchRadians,this.maxPitchRadians),this.setRoll(0)}if(this.Q1.setFromAxisAngle(this.stage.up,this.worldHeadingRadians),this.fwrd||this.back||this.left||this.rght||this.up||this.down){let r=(this.left?1:0)+(this.rght?-1:0),o=(this.down?1:0)+(this.up?-1:0),s=(this.fwrd?1:0)+(this.back?-1:0);this.move.set(r,o,s);let l=this.move.length();l>0&&(this.move.multiplyScalar(e/l).applyQuaternion(this.Q1),this.stage.position.add(this.move))}if(this.fwrd2||this.back2||this.left2||this.rght2){let r=(this.left2?1:0)+(this.rght2?-1:0),o=(this.fwrd2?1:0)+(this.back2?-1:0);this.move2.set(r,0,o);let s=this.move2.length();s>0&&(this.move2.multiplyScalar(e/s).applyQuaternion(this.Q1),this.headX+=this.move2.x,this.headZ+=this.move2.z)}if(this.grow||this.shrk){let r=(this.shrk?-1:0)+(this.grow?1:0);this._height+=r*e,this._height=ri(this._height,1,2)}this.updateOrientation();let i=Math.pow(.95,100*e);this.duv.multiplyScalar(i),this.duv.manhattanLength()<=1e-4&&this.duv.setScalar(0)}}scaleRadialComponent(e,t,i){let r=Math.abs(e);return Math.sign(e)*Math.pow(Math.max(0,r-this.radialEdgeFactor)/(1-this.radialEdgeFactor),i)*t}lookAt(e){e.getWorldPosition(this.P),this.P.sub(this.worldPos);let t=3*an-Math.atan2(this.P.z,this.P.x),i=Math.atan2(this.P.y,this.P.length());this.setOrientationImmediate(t,i)}updateOrientation(){let e=Xs(this.env.renderer,this.env.camera);this.rotStage.makeRotationY(this._headingRadians),this.stage.matrix.makeTranslation(this.stage.position.x,this.stage.position.y,this.stage.position.z).multiply(this.rotStage),this.stage.matrix.decompose(this.stage.position,this.stage.quaternion,this.stage.scale),this.env.renderer.xr.isPresenting?(this.M.copy(this.stage.matrixWorld).invert(),this.head.position.copy(e.position).applyMatrix4(this.M),this.head.quaternion.copy(this.stage.quaternion).invert().multiply(e.quaternion)):(this.head.position.set(this.headX,this._height,this.headZ),this.E.set(this._pitchRadians,0,this._rollRadians,"XYZ"),this.head.quaternion.setFromEuler(this.E).premultiply(this.deviceQ)),this.env.camera.position.copy(this.head.position),this.env.camera.quaternion.copy(this.head.quaternion),this.head.getWorldPosition(this.worldPos),this.head.getWorldQuaternion(this.worldQuat),this.F.set(0,0,-1).applyQuaternion(this.worldQuat),this._worldHeadingRadians=Au(this.F),this._worldPitchRadians=f_(this.F),g_(this.head.matrixWorld,this.U,this.F,this.P)}reset(){this.stage.position.setScalar(0),this.setHeadingImmediate(0)}resetFollowers(){for(let e of this.followers)e.reset(this.height,this.worldPos,this.worldHeadingRadians)}async getPermission(){return"DeviceOrientationEvent"in window?Cle(DeviceOrientationEvent)?await DeviceOrientationEvent.requestPermission():"granted":"not-supported"}async startMotionControl(){if(!this.motionEnabled){this.onScreenOrientationChangeEvent();let e=await this.getPermission();this.motionEnabled=e==="granted",this.motionEnabled&&("ScreenOrientation"in window?screen.orientation.addEventListener("change",this.onScreenOrientationChangeEvent):window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}}stopMotionControl(){this.motionEnabled&&("ScreenOrientation"in window?screen.orientation.removeEventListener("change",this.onScreenOrientationChangeEvent):window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.motionEnabled=!1)}dispose(){this.stopMotionControl()}get bufferSize(){return 133}writeState(e){qe(this.pointersToSend);let t=this.env.avatar.bufferSize;for(let i of this.env.eventSys.pointers)i.canSend&&(t+=i.bufferSize,this.pointersToSend.push(i));e.length=t,e.position=0,e.writeFloat32(this.height),e.writeMatrix512(this.stage.matrix),e.writeMatrix512(this.head.matrixWorld),e.writeUint8(this.pointersToSend.length);for(let i of this.pointersToSend)i.writeState(e)}};var $h=class{constructor(e,t=.15){this.opacity=1,this.direction=0,this.task=new et(!1),this.material=Qa({name:"FaderMaterial",color:0,side:sb}),this.object=tu(e,1,1,1,this.material),this.object.renderOrder=Number.MAX_SAFE_INTEGER,this.speed=1/t,this.object.layers.enableAll()}async start(e){this.direction=e,this.task.restart(),await this.task}async fadeOut(){this.direction!=1&&await this.start(1)}async fadeIn(){this.direction!=-1&&await this.start(-1)}update(e){if(this.direction!==0){let t=this.direction*this.speed*e/1e3;0<=this.opacity&&this.opacity<=1&&(this.opacity+=t),(this.direction===1&&this.opacity>=1||this.direction===-1&&this.opacity<=0)&&(this.opacity=ri(this.opacity,0,1),this.direction=0,this.task.resolve())}this.material.opacity=this.opacity,this.material.transparent=this.opacity<1,this.material.needsUpdate=!0}};var Jh=0;var _l=3;function x_(n,e){n=kn(n),n.traverse(t=>t.layers.set(e))}function w_(n,e){n=kn(n),n.traverse(t=>t.layers.enable(e))}function Yi(n,e,t,i,r,o){let s=new Ei(i,r,o,cS);return s.position.set(n,e,t),s}var Lle=.1,Zh=class extends Ti{constructor(){super(),this.value=0,this.targetValue=0,this.object=ft("LoadingBar"),this._enabled=!0,this.valueBar=new Ei(0,1,1,jx),this.valueBar.scale.set(0,1,1);let e=ft("ValueBarContainer");e.scale.set(1,.1,.1),De(this,De(e,this.valueBar),Yi(-.5,0,-.05,.01,.1,.01),Yi(-.5,0,.05,.01,.1,.01),Yi(.5,0,-.05,.01,.1,.01),Yi(.5,0,.05,.01,.1,.01),Yi(-.5,-.05,0,.01,.01,.1),Yi(.5,-.05,0,.01,.01,.1),Yi(-.5,.05,0,.01,.01,.1),Yi(.5,.05,0,.01,.01,.1),Yi(0,-.05,-.05,1,.01,.01),Yi(0,.05,-.05,1,.01,.01),Yi(0,-.05,.05,1,.01,.01),Yi(0,.05,.05,1,.01,.01)),x_(this,_l)}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,nn(this,Ka(this)||this.enabled))}report(e,t,i){super.report(e,t,i),this.targetValue=this.p}update(e){this.object.parent.visible&&(this.value=Math.min(this.targetValue,this.value+Lle*e),this.valueBar.scale.set(this.value,1,1),this.valueBar.position.x=this.value/2-.5,nn(this,this.enabled&&this.value>0))}};if(!Aw()){let n=Element.prototype,e=Document.prototype;"webkitRequestFullscreen"in n?(n.requestFullscreen=n.webkitRequestFullscreen,e.exitFullscreen=e.webkitRequestFullscreen,Object.defineProperties(e,{fullscreenEnabled:{get:function(){return this.webkitFullscreenEnabled}},fullscreenElement:{get:function(){return this.webkitFullscreenElement}}})):"mozRequestFullScreen"in n?(n.requestFullscreen=n.mozRequestFullScreen,e.exitFullscreen=e.mozCancelFullScreen,Object.defineProperties(e,{fullscreenEnabled:{get:function(){return this.mozFullScreenEnabled}},fullscreenElement:{get:function(){return this.mozFullScreenElement}}})):"msRequestFullscreen"in n&&(n.requestFullscreen=n.msRequestFullscreen,e.exitFullscreen=e.msExitFullscreen,Object.defineProperties(e,{fullscreenEnabled:{get:function(){return this.msFullscreenEnabled}},fullscreenElement:{get:function(){return this.msFullscreenElement}}}))}function Aw(){return"requestFullscreen"in HTMLElement.prototype}var Ple=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},em=Ple;var vu=Symbol("@@webxr-polyfill/EventTarget"),po=class{constructor(){this[vu]={listeners:new Map}}addEventListener(e,t){if(typeof e!="string")throw new Error("`type` must be a string");if(typeof t!="function")throw new Error("`listener` must be a function");let i=this[vu].listeners.get(e)||[];i.push(t),this[vu].listeners.set(e,i)}removeEventListener(e,t){if(typeof e!="string")throw new Error("`type` must be a string");if(typeof t!="function")throw new Error("`listener` must be a function");let i=this[vu].listeners.get(e)||[];for(let r=i.length;r>=0;r--)i[r]===t&&i.pop()}dispatchEvent(e,t){let i=this[vu].listeners.get(e)||[],r=[];for(let o=0;o<i.length;o++)r[o]=i[o];for(let o of r)o(t);typeof this[`on${e}`]=="function"&&this[`on${e}`](t)}};var Mn=typeof Float32Array<"u"?Float32Array:Array;var WMe=Math.PI/180;function Ur(){let n=new Mn(16);return Mn!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function F_(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Jo(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function qs(n,e){let t=e[0],i=e[1],r=e[2],o=e[3],s=e[4],l=e[5],c=e[6],u=e[7],p=e[8],d=e[9],h=e[10],A=e[11],g=e[12],F=e[13],b=e[14],R=e[15],P=t*l-i*s,L=t*c-r*s,S=t*u-o*s,x=i*c-r*l,v=i*u-o*l,M=r*u-o*c,O=p*F-d*g,B=p*b-h*g,X=p*R-A*g,V=d*b-h*F,J=d*R-A*F,ce=h*R-A*b,G=P*ce-L*J+S*V+x*X-v*B+M*O;return G?(G=1/G,n[0]=(l*ce-c*J+u*V)*G,n[1]=(r*J-i*ce-o*V)*G,n[2]=(F*M-b*v+R*x)*G,n[3]=(h*v-d*M-A*x)*G,n[4]=(c*X-s*ce-u*B)*G,n[5]=(t*ce-r*X+o*B)*G,n[6]=(b*S-g*M-R*L)*G,n[7]=(p*M-h*S+A*L)*G,n[8]=(s*J-l*X+u*O)*G,n[9]=(i*X-t*J-o*O)*G,n[10]=(g*v-F*S+R*P)*G,n[11]=(d*S-p*v-A*P)*G,n[12]=(l*B-s*V-c*O)*G,n[13]=(t*V-i*B+r*O)*G,n[14]=(F*L-g*x-b*P)*G,n[15]=(p*x-d*L+h*P)*G,n):null}function ho(n,e,t){let i=e[0],r=e[1],o=e[2],s=e[3],l=e[4],c=e[5],u=e[6],p=e[7],d=e[8],h=e[9],A=e[10],g=e[11],F=e[12],b=e[13],R=e[14],P=e[15],L=t[0],S=t[1],x=t[2],v=t[3];return n[0]=L*i+S*l+x*d+v*F,n[1]=L*r+S*c+x*h+v*b,n[2]=L*o+S*u+x*A+v*R,n[3]=L*s+S*p+x*g+v*P,L=t[4],S=t[5],x=t[6],v=t[7],n[4]=L*i+S*l+x*d+v*F,n[5]=L*r+S*c+x*h+v*b,n[6]=L*o+S*u+x*A+v*R,n[7]=L*s+S*p+x*g+v*P,L=t[8],S=t[9],x=t[10],v=t[11],n[8]=L*i+S*l+x*d+v*F,n[9]=L*r+S*c+x*h+v*b,n[10]=L*o+S*u+x*A+v*R,n[11]=L*s+S*p+x*g+v*P,L=t[12],S=t[13],x=t[14],v=t[15],n[12]=L*i+S*l+x*d+v*F,n[13]=L*r+S*c+x*h+v*b,n[14]=L*o+S*u+x*A+v*R,n[15]=L*s+S*p+x*g+v*P,n}function Zo(n,e,t){let i=e[0],r=e[1],o=e[2],s=e[3],l=i+i,c=r+r,u=o+o,p=i*l,d=i*c,h=i*u,A=r*c,g=r*u,F=o*u,b=s*l,R=s*c,P=s*u;return n[0]=1-(A+F),n[1]=d+P,n[2]=h-R,n[3]=0,n[4]=d-P,n[5]=1-(p+F),n[6]=g+b,n[7]=0,n[8]=h+R,n[9]=g-b,n[10]=1-(p+A),n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n}function tm(n,e){return n[0]=e[12],n[1]=e[13],n[2]=e[14],n}function nm(n,e){let t=e[0]+e[5]+e[10],i=0;return t>0?(i=Math.sqrt(t+1)*2,n[3]=.25*i,n[0]=(e[6]-e[9])/i,n[1]=(e[8]-e[2])/i,n[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=Math.sqrt(1+e[0]-e[5]-e[10])*2,n[3]=(e[6]-e[9])/i,n[0]=.25*i,n[1]=(e[1]+e[4])/i,n[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=Math.sqrt(1+e[5]-e[0]-e[10])*2,n[3]=(e[8]-e[2])/i,n[0]=(e[1]+e[4])/i,n[1]=.25*i,n[2]=(e[6]+e[9])/i):(i=Math.sqrt(1+e[10]-e[0]-e[5])*2,n[3]=(e[1]-e[4])/i,n[0]=(e[8]+e[2])/i,n[1]=(e[6]+e[9])/i,n[2]=.25*i),n}function im(n,e,t,i,r){let o=1/Math.tan(e/2),s;return n[0]=o/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,r!=null&&r!==1/0?(s=1/(i-r),n[10]=(r+i)*s,n[14]=2*r*i*s):(n[10]=-1,n[14]=-2*i),n}function Oi(){let n=new Mn(3);return Mn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function vw(n){var e=new Mn(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Rle(n){let e=n[0],t=n[1],i=n[2];return Math.sqrt(e*e+t*t+i*i)}function Di(n,e,t){let i=new Mn(3);return i[0]=n,i[1]=e,i[2]=t,i}function bw(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function yl(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function Sw(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function rm(n,e){let t=e[0],i=e[1],r=e[2],o=t*t+i*i+r*r;return o>0&&(o=1/Math.sqrt(o),n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o),n}function _u(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function om(n,e,t){let i=e[0],r=e[1],o=e[2],s=t[0],l=t[1],c=t[2];return n[0]=r*c-o*l,n[1]=o*s-i*c,n[2]=i*l-r*s,n}function Ks(n,e,t){let i=t[0],r=t[1],o=t[2],s=t[3],l=e[0],c=e[1],u=e[2],p=r*u-o*c,d=o*l-i*u,h=i*c-r*l,A=r*h-o*d,g=o*p-i*h,F=i*d-r*p,b=s*2;return p*=b,d*=b,h*=b,A*=2,g*=2,F*=2,n[0]=l+p+A,n[1]=c+d+g,n[2]=u+h+F,n}function v_(n,e){let t=Di(n[0],n[1],n[2]),i=Di(e[0],e[1],e[2]);rm(t,t),rm(i,i);let r=_u(t,i);return r>1?0:r<-1?Math.PI:Math.acos(r)}var b_=Rle;var HMe=function(){let n=Oi();return function(e,t,i,r,o,s){let l,c;for(t||(t=3),i||(i=0),r?c=Math.min(r*t+i,e.length):c=e.length,l=i;l<c;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],o(n,n,s),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2];return e}}();function S_(){let n=new Mn(9);return Mn!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Ble(){let n=new Mn(4);return Mn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function __(n){let e=new Mn(4);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function y_(n,e,t,i){let r=new Mn(4);return r[0]=n,r[1]=e,r[2]=t,r[3]=i,r}function T_(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function E_(n,e){let t=e[0],i=e[1],r=e[2],o=e[3],s=t*t+i*i+r*r+o*o;return s>0&&(s=1/Math.sqrt(s),n[0]=t*s,n[1]=i*s,n[2]=r*s,n[3]=o*s),n}var UMe=function(){let n=Ble();return function(e,t,i,r,o,s){let l,c;for(t||(t=4),i||(i=0),r?c=Math.min(r*t+i,e.length):c=e.length,l=i;l<c;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],n[3]=e[l+3],o(n,n,s),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2],e[l+3]=n[3];return e}}();function Ni(){let n=new Mn(4);return Mn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Ole(n,e,t){t=t*.5;let i=Math.sin(t);return n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=Math.cos(t),n}function _w(n,e,t){let i=e[0],r=e[1],o=e[2],s=e[3],l=t[0],c=t[1],u=t[2],p=t[3];return n[0]=i*p+s*l+r*u-o*c,n[1]=r*p+s*c+o*l-i*u,n[2]=o*p+s*u+i*c-r*l,n[3]=s*p-i*l-r*c-o*u,n}function Tl(n,e,t,i){let r=e[0],o=e[1],s=e[2],l=e[3],c=t[0],u=t[1],p=t[2],d=t[3],h,A,g,F,b;return A=r*c+o*u+s*p+l*d,A<0&&(A=-A,c=-c,u=-u,p=-p,d=-d),1-A>1e-6?(h=Math.acos(A),g=Math.sin(h),F=Math.sin((1-i)*h)/g,b=Math.sin(i*h)/g):(F=1-i,b=i),n[0]=F*r+b*c,n[1]=F*o+b*u,n[2]=F*s+b*p,n[3]=F*l+b*d,n}function yw(n,e){let t=e[0],i=e[1],r=e[2],o=e[3],s=t*t+i*i+r*r+o*o,l=s?1/s:0;return n[0]=-t*l,n[1]=-i*l,n[2]=-r*l,n[3]=o*l,n}function Nle(n,e){let t=e[0]+e[4]+e[8],i;if(t>0)i=Math.sqrt(t+1),n[3]=.5*i,i=.5/i,n[0]=(e[5]-e[7])*i,n[1]=(e[6]-e[2])*i,n[2]=(e[1]-e[3])*i;else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);let o=(r+1)%3,s=(r+2)%3;i=Math.sqrt(e[r*3+r]-e[o*3+o]-e[s*3+s]+1),n[r]=.5*i,i=.5/i,n[3]=(e[o*3+s]-e[s*3+o])*i,n[o]=(e[o*3+r]+e[r*3+o])*i,n[s]=(e[s*3+r]+e[r*3+s])*i}return n}function k_(n,e,t,i){let r=.5*Math.PI/180;e*=r,t*=r,i*=r;let o=Math.sin(e),s=Math.cos(e),l=Math.sin(t),c=Math.cos(t),u=Math.sin(i),p=Math.cos(i);return n[0]=o*c*p-s*l*u,n[1]=s*l*p+o*c*u,n[2]=s*c*u-o*l*p,n[3]=s*c*p+o*l*u,n}var Tw=__,M_=y_,am=T_;var yu=E_;var JMe=function(){let n=Oi(),e=Di(1,0,0),t=Di(0,1,0);return function(i,r,o){let s=_u(r,o);return s<-.999999?(om(n,e,r),b_(n)<1e-6&&om(n,t,r),rm(n,n),Ole(i,n,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(om(n,r,o),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=1+s,yu(i,i))}}(),ZMe=function(){let n=Ni(),e=Ni();return function(t,i,r,o,s,l){return Tl(n,i,s,l),Tl(e,r,o,l),Tl(t,n,e,2*l*(1-l)),t}}(),eDe=function(){let n=S_();return function(e,t,i,r){return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],yu(e,Nle(e,n))}}();var kt=Symbol("@@webxr-polyfill/XRRigidTransform"),Qs=class n{constructor(){if(this[kt]={matrix:null,position:null,orientation:null,inverse:null},arguments.length===0)this[kt].matrix=Jo(new Float32Array(16));else if(arguments.length===1)arguments[0]instanceof Float32Array?this[kt].matrix=arguments[0]:(this[kt].position=this._getPoint(arguments[0]),this[kt].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(arguments.length===2)this[kt].position=this._getPoint(arguments[0]),this[kt].orientation=this._getPoint(arguments[1]);else throw new Error("Too many arguments!");if(this[kt].matrix){let e=Oi();tm(e,this[kt].matrix),this[kt].position=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2]});let t=Ni();nm(t,this[kt].matrix),this[kt].orientation=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2],w:t[3]})}else this[kt].matrix=Jo(new Float32Array(16)),Zo(this[kt].matrix,M_(this[kt].orientation.x,this[kt].orientation.y,this[kt].orientation.z,this[kt].orientation.w),Di(this[kt].position.x,this[kt].position.y,this[kt].position.z))}_getPoint(e){return e instanceof DOMPointReadOnly?e:DOMPointReadOnly.fromPoint(e)}get matrix(){return this[kt].matrix}get position(){return this[kt].position}get orientation(){return this[kt].orientation}get inverse(){if(this[kt].inverse===null){let e=Jo(new Float32Array(16));qs(e,this[kt].matrix),this[kt].inverse=new n(e),this[kt].inverse[kt].inverse=this}return this[kt].inverse}};var cn=Symbol("@@webxr-polyfill/XRSpace");var Ki=class{constructor(e=null,t=null){this[cn]={specialType:e,inputSource:t,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[cn].specialType}get _inputSource(){return this[cn].inputSource}_ensurePoseUpdated(e,t){t!=this[cn].lastFrameId&&(this[cn].lastFrameId=t,this._onPoseUpdate(e))}_onPoseUpdate(e){this[cn].specialType=="viewer"&&(this._baseMatrix=e.getBasePoseMatrix())}set _baseMatrix(e){this[cn].baseMatrix=e,this[cn].inverseBaseMatrix=null}get _baseMatrix(){return this[cn].baseMatrix||this[cn].inverseBaseMatrix&&(this[cn].baseMatrix=new Float32Array(16),qs(this[cn].baseMatrix,this[cn].inverseBaseMatrix)),this[cn].baseMatrix}set _inverseBaseMatrix(e){this[cn].inverseBaseMatrix=e,this[cn].baseMatrix=null}get _inverseBaseMatrix(){return this[cn].inverseBaseMatrix||this[cn].baseMatrix&&(this[cn].inverseBaseMatrix=new Float32Array(16),qs(this[cn].inverseBaseMatrix,this[cn].baseMatrix)),this[cn].inverseBaseMatrix}_getSpaceRelativeTransform(e){if(!this._inverseBaseMatrix||!e._baseMatrix)return null;let t=new Float32Array(16);return ho(t,this._inverseBaseMatrix,e._baseMatrix),new Qs(t)}};var Wle=1.6,es=Symbol("@@webxr-polyfill/XRReferenceSpace"),Tu=["viewer","local","local-floor","bounded-floor","unbounded"];function Hle(n){return n==="bounded-floor"||n==="local-floor"}var ts=class n extends Ki{constructor(e,t=null){if(!Tu.includes(e))throw new Error(`XRReferenceSpaceType must be one of ${Tu}`);if(super(e),e==="bounded-floor"&&!t)throw new Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");Hle(e)&&!t&&(t=Jo(new Float32Array(16)),t[13]=Wle),this._inverseBaseMatrix=t||Jo(new Float32Array(16)),this[es]={type:e,transform:t,originOffset:Jo(new Float32Array(16))}}_transformBasePoseMatrix(e,t){ho(e,this._inverseBaseMatrix,t)}_originOffsetMatrix(){return this[es].originOffset}_adjustForOriginOffset(e){let t=new Float32Array(16);qs(t,this[es].originOffset),ho(e,t,e)}_getSpaceRelativeTransform(e){let t=super._getSpaceRelativeTransform(e);return this._adjustForOriginOffset(t.matrix),new XRRigidTransform(t.matrix)}getOffsetReferenceSpace(e){let t=new n(this[es].type,this[es].transform,this[es].bounds);return ho(t[es].originOffset,this[es].originOffset,e.matrix),t}};var fi=Symbol("@@webxr-polyfill/XR"),Ule=["inline","immersive-vr","immersive-ar"],zle={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},jle=`Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode
or navigator.xr.requestSession('inline') prior to requesting an immersive
session. This is a limitation specific to the WebXR Polyfill and does not apply
to native implementations of the API.`,Eu=class extends po{constructor(e){super(),this[fi]={device:null,devicePromise:e,immersiveSession:null,inlineSessions:new Set},e.then(t=>{this[fi].device=t})}async isSessionSupported(e){return this[fi].device||await this[fi].devicePromise,e!="inline"?Promise.resolve(this[fi].device.isSessionSupported(e)):Promise.resolve(!0)}async requestSession(e,t){if(!this[fi].device){if(e!="inline")throw new Error(jle);await this[fi].devicePromise}if(!Ule.includes(e))throw new TypeError(`The provided value '${e}' is not a valid enum value of type XRSessionMode`);let i=zle[e],r=i.requiredFeatures.concat(t&&t.requiredFeatures?t.requiredFeatures:[]),o=i.optionalFeatures.concat(t&&t.optionalFeatures?t.optionalFeatures:[]),s=new Set,l=!1;for(let d of r)this[fi].device.isFeatureSupported(d)?s.add(d):(console.error(`The required feature '${d}' is not supported`),l=!0);if(l)throw new DOMException("Session does not support some required features","NotSupportedError");for(let d of o)this[fi].device.isFeatureSupported(d)?s.add(d):console.log(`The optional feature '${d}' is not supported`);let c=await this[fi].device.requestSession(e,s),u=new XRSession(this[fi].device,e,c);e=="inline"?this[fi].inlineSessions.add(u):this[fi].immersiveSession=u;let p=()=>{e=="inline"?this[fi].inlineSessions.delete(u):this[fi].immersiveSession=null,u.removeEventListener("end",p)};return u.addEventListener("end",p),u}};var kw;if("performance"in em)kw=()=>performance.now();else{let n=Date.now();kw=()=>Date.now()-n}var lm=kw;var Mw=Symbol("@@webxr-polyfill/XRPose"),$s=class{constructor(e,t){this[Mw]={transform:e,emulatedPosition:t}}get transform(){return this[Mw].transform}get emulatedPosition(){return this[Mw].emulatedPosition}};var D_=Symbol("@@webxr-polyfill/XRViewerPose"),Js=class extends $s{constructor(e,t,i=!1){super(e,i),this[D_]={views:t}}get views(){return this[D_].views}};var ku=Symbol("@@webxr-polyfill/XRViewport"),Zs=class{constructor(e){this[ku]={target:e}}get x(){return this[ku].target.x}get y(){return this[ku].target.y}get width(){return this[ku].target.width}get height(){return this[ku].target.height}};var C_=["left","right","none"],ns=Symbol("@@webxr-polyfill/XRView"),ea=class{constructor(e,t,i,r){if(!C_.includes(i))throw new Error(`XREye must be one of: ${C_}`);let o=Object.create(null),s=new Zs(o);this[ns]={device:e,eye:i,viewport:s,temp:o,sessionId:r,transform:t}}get eye(){return this[ns].eye}get projectionMatrix(){return this[ns].device.getProjectionMatrix(this.eye)}get transform(){return this[ns].transform}_getViewport(e){if(this[ns].device.getViewport(this[ns].sessionId,this.eye,e,this[ns].temp))return this[ns].viewport}};var _n=Symbol("@@webxr-polyfill/XRFrame"),L_="XRFrame access outside the callback that produced it is invalid.",Gle="getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.",Xle=0,is=class{constructor(e,t,i){this[_n]={id:++Xle,active:!1,animationFrame:!1,device:e,session:t,sessionId:i}}get session(){return this[_n].session}getViewerPose(e){if(!this[_n].animationFrame)throw new DOMException(Gle,"InvalidStateError");if(!this[_n].active)throw new DOMException(L_,"InvalidStateError");let t=this[_n].device,i=this[_n].session;i[xe].viewerSpace._ensurePoseUpdated(t,this[_n].id),e._ensurePoseUpdated(t,this[_n].id);let r=e._getSpaceRelativeTransform(i[xe].viewerSpace),o=[];for(let l of i[xe].viewSpaces){l._ensurePoseUpdated(t,this[_n].id);let c=e._getSpaceRelativeTransform(l),u=new ea(t,c,l.eye,this[_n].sessionId);o.push(u)}return new Js(r,o,!1)}getPose(e,t){if(!this[_n].active)throw new DOMException(L_,"InvalidStateError");let i=this[_n].device;if(e._specialType==="target-ray"||e._specialType==="grip")return i.getInputPose(e._inputSource,t,e._specialType);{e._ensurePoseUpdated(i,this[_n].id),t._ensurePoseUpdated(i,this[_n].id);let r=t._getSpaceRelativeTransform(e);return r?new XRPose(r,!1):null}return null}};var Mu=Symbol("@@webxr-polyfill/XRRenderState"),qle=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null}),rs=class{constructor(e={}){let t=Object.assign({},qle,e);this[Mu]={config:t}}get depthNear(){return this[Mu].config.depthNear}get depthFar(){return this[Mu].config.depthFar}get inlineVerticalFieldOfView(){return this[Mu].config.inlineVerticalFieldOfView}get baseLayer(){return this[Mu].config.baseLayer}};var cm=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),Du=Symbol("@@webxr-polyfill/xr-compatible");var ta=Symbol("@@webxr-polyfill/XRWebGLLayer"),Yle=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),Cu=class{constructor(e,t,i={}){let r=Object.assign({},Yle,i);if(!(e instanceof na))throw new Error("session must be a XRSession");if(e.ended)throw new Error("InvalidStateError");if(t[cm]&&t[Du]!==!0)throw new Error("InvalidStateError");let o=t.getParameter(t.FRAMEBUFFER_BINDING);this[ta]={context:t,config:r,framebuffer:o,session:e}}get context(){return this[ta].context}get antialias(){return this[ta].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return this[ta].framebuffer}get framebufferWidth(){return this[ta].context.drawingBufferWidth}get framebufferHeight(){return this[ta].context.drawingBufferHeight}get _session(){return this[ta].session}getViewport(e){return e._getViewport(this)}static getNativeFramebufferScaleFactor(e){if(!e)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return e[xe].ended?0:1}};var Dw=Symbol("@@webxr-polyfill/XRInputSourceEvent"),ia=class n extends Event{constructor(e,t){super(e,t),this[Dw]={frame:t.frame,inputSource:t.inputSource},Object.setPrototypeOf(this,n.prototype)}get frame(){return this[Dw].frame}get inputSource(){return this[Dw].inputSource}};var P_=Symbol("@@webxr-polyfill/XRSessionEvent"),os=class n extends Event{constructor(e,t){super(e,t),this[P_]={session:t.session},Object.setPrototypeOf(this,n.prototype)}get session(){return this[P_].session}};var um=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),ra=class n extends Event{constructor(e,t){super(e,t),this[um]={session:t.session,added:t.added,removed:t.removed},Object.setPrototypeOf(this,n.prototype)}get session(){return this[um].session}get added(){return this[um].added}get removed(){return this[um].removed}};var xe=Symbol("@@webxr-polyfill/XRSession"),Lu=class extends Ki{constructor(e){super(e)}get eye(){return this._specialType}_onPoseUpdate(e){this._inverseBaseMatrix=e.getBaseViewMatrix(this._specialType)}},na=class extends po{constructor(e,t,i){super();let r=t!="inline",o=new rs({inlineVerticalFieldOfView:r?null:Math.PI*.5});this[xe]={device:e,mode:t,immersive:r,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:i,activeRenderState:o,pendingRenderState:null,viewerSpace:new ts("viewer"),viewSpaces:[],currentInputSources:[]},r?this[xe].viewSpaces.push(new Lu("left"),new Lu("right")):this[xe].viewSpaces.push(new Lu("none")),this[xe].onDeviceFrame=()=>{if(this[xe].ended||this[xe].suspended||(this[xe].deviceFrameHandle=null,this[xe].startDeviceFrameLoop(),this[xe].pendingRenderState!==null&&(this[xe].activeRenderState=new rs(this[xe].pendingRenderState),this[xe].pendingRenderState=null,this[xe].activeRenderState.baseLayer&&this[xe].device.onBaseLayerSet(this[xe].id,this[xe].activeRenderState.baseLayer)),this[xe].activeRenderState.baseLayer===null))return;let s=new is(e,this,this[xe].id),l=this[xe].currentFrameCallbacks=this[xe].frameCallbacks;this[xe].frameCallbacks=[],s[_n].active=!0,s[_n].animationFrame=!0,this[xe].device.onFrameStart(this[xe].id,this[xe].activeRenderState),this._checkInputSourcesChange();let c=lm();for(let u=0;u<l.length;u++)try{!l[u].cancelled&&typeof l[u].callback=="function"&&l[u].callback(c,s)}catch(p){console.error(p)}this[xe].currentFrameCallbacks=null,s[_n].active=!1,this[xe].device.onFrameEnd(this[xe].id)},this[xe].startDeviceFrameLoop=()=>{this[xe].deviceFrameHandle===null&&(this[xe].deviceFrameHandle=this[xe].device.requestAnimationFrame(this[xe].onDeviceFrame))},this[xe].stopDeviceFrameLoop=()=>{let s=this[xe].deviceFrameHandle;s!==null&&(this[xe].device.cancelAnimationFrame(s),this[xe].deviceFrameHandle=null)},this[xe].onPresentationEnd=s=>{if(s!==this[xe].id){this[xe].suspended=!1,this[xe].startDeviceFrameLoop(),this.dispatchEvent("focus",{session:this});return}this[xe].ended=!0,this[xe].stopDeviceFrameLoop(),e.removeEventListener("@@webxr-polyfill/vr-present-end",this[xe].onPresentationEnd),e.removeEventListener("@@webxr-polyfill/vr-present-start",this[xe].onPresentationStart),e.removeEventListener("@@webxr-polyfill/input-select-start",this[xe].onSelectStart),e.removeEventListener("@@webxr-polyfill/input-select-end",this[xe].onSelectEnd),this.dispatchEvent("end",new os("end",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-end",this[xe].onPresentationEnd),this[xe].onPresentationStart=s=>{s!==this[xe].id&&(this[xe].suspended=!0,this[xe].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-start",this[xe].onPresentationStart),this[xe].onSelectStart=s=>{s.sessionId===this[xe].id&&this[xe].dispatchInputSourceEvent("selectstart",s.inputSource)},e.addEventListener("@@webxr-polyfill/input-select-start",this[xe].onSelectStart),this[xe].onSelectEnd=s=>{s.sessionId===this[xe].id&&(this[xe].dispatchInputSourceEvent("selectend",s.inputSource),this[xe].dispatchInputSourceEvent("select",s.inputSource))},e.addEventListener("@@webxr-polyfill/input-select-end",this[xe].onSelectEnd),this[xe].onSqueezeStart=s=>{s.sessionId===this[xe].id&&this[xe].dispatchInputSourceEvent("squeezestart",s.inputSource)},e.addEventListener("@@webxr-polyfill/input-squeeze-start",this[xe].onSqueezeStart),this[xe].onSqueezeEnd=s=>{s.sessionId===this[xe].id&&(this[xe].dispatchInputSourceEvent("squeezeend",s.inputSource),this[xe].dispatchInputSourceEvent("squeeze",s.inputSource))},e.addEventListener("@@webxr-polyfill/input-squeeze-end",this[xe].onSqueezeEnd),this[xe].dispatchInputSourceEvent=(s,l)=>{let c=new is(e,this,this[xe].id),u=new ia(s,{frame:c,inputSource:l});c[_n].active=!0,this.dispatchEvent(s,u),c[_n].active=!1},this[xe].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[xe].activeRenderState}get environmentBlendMode(){return this[xe].device.environmentBlendMode||"opaque"}async requestReferenceSpace(e){if(this[xe].ended)return;if(!Tu.includes(e))throw new TypeError(`XRReferenceSpaceType must be one of ${Tu}`);if(!this[xe].device.doesSessionSupportReferenceSpace(this[xe].id,e))throw new DOMException(`The ${e} reference space is not supported by this session.`,"NotSupportedError");if(e==="viewer")return this[xe].viewerSpace;let t=await this[xe].device.requestFrameOfReferenceTransform(e);if(e==="bounded-floor")throw t?this[xe].device.requestStageBounds()?new DOMException(`The WebXR polyfill does not support the ${e} reference space yet.`,"NotSupportedError"):new DOMException(`${e} XRReferenceSpace not supported by this device.`,"NotSupportedError"):new DOMException(`${e} XRReferenceSpace not supported by this device.`,"NotSupportedError");return new ts(e,t)}requestAnimationFrame(e){if(this[xe].ended)return;let t=++this[xe].frameHandle;return this[xe].frameCallbacks.push({handle:t,callback:e,cancelled:!1}),t}cancelAnimationFrame(e){let t=this[xe].frameCallbacks,i=t.findIndex(r=>r&&r.handle===e);i>-1&&(t[i].cancelled=!0,t.splice(i,1)),t=this[xe].currentFrameCallbacks,t&&(i=t.findIndex(r=>r&&r.handle===e),i>-1&&(t[i].cancelled=!0))}get inputSources(){return this[xe].device.getInputSources()}async end(){if(!this[xe].ended)return this[xe].immersive&&(this[xe].ended=!0,this[xe].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[xe].onPresentationStart),this[xe].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[xe].onPresentationEnd),this[xe].device.removeEventListener("@@webxr-polyfill/input-select-start",this[xe].onSelectStart),this[xe].device.removeEventListener("@@webxr-polyfill/input-select-end",this[xe].onSelectEnd),this.dispatchEvent("end",new os("end",{session:this}))),this[xe].stopDeviceFrameLoop(),this[xe].device.endSession(this[xe].id)}updateRenderState(e){if(this[xe].ended){let i="Can't call updateRenderState on an XRSession that has already ended.";throw new Error(i)}if(e.baseLayer&&e.baseLayer._session!==this){let i="Called updateRenderState with a base layer that was created by a different session.";throw new Error(i)}if(e.inlineVerticalFieldOfView!==null&&e.inlineVerticalFieldOfView!==void 0)if(this[xe].immersive){let i="inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.";throw new Error(i)}else e.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,e.inlineVerticalFieldOfView));if(this[xe].pendingRenderState===null){let i=this[xe].activeRenderState;this[xe].pendingRenderState={depthNear:i.depthNear,depthFar:i.depthFar,inlineVerticalFieldOfView:i.inlineVerticalFieldOfView,baseLayer:i.baseLayer}}Object.assign(this[xe].pendingRenderState,e)}_checkInputSourcesChange(){let e=[],t=[],i=this.inputSources,r=this[xe].currentInputSources;for(let o of i)r.includes(o)||e.push(o);for(let o of r)i.includes(o)||t.push(o);(e.length>0||t.length>0)&&this.dispatchEvent("inputsourceschange",new ra("inputsourceschange",{session:this,added:e,removed:t})),this[xe].currentInputSources.length=0;for(let o of i)this[xe].currentInputSources.push(o)}};var ss=Symbol("@@webxr-polyfill/XRInputSource"),oa=class{constructor(e){this[ss]={impl:e,gripSpace:new Ki("grip",this),targetRaySpace:new Ki("target-ray",this)}}get handedness(){return this[ss].impl.handedness}get targetRayMode(){return this[ss].impl.targetRayMode}get gripSpace(){let e=this[ss].impl.targetRayMode;return e==="gaze"||e==="screen"?null:this[ss].gripSpace}get targetRaySpace(){return this[ss].targetRaySpace}get profiles(){return this[ss].impl.profiles}get gamepad(){return this[ss].impl.gamepad}};var Cw=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),Pu=class n extends Event{constructor(e,t){super(e,t),this[Cw]={referenceSpace:t.referenceSpace,transform:t.transform||null},Object.setPrototypeOf(this,n.prototype)}get referenceSpace(){return this[Cw].referenceSpace}get transform(){return this[Cw].transform}};var pm={XRSystem:Eu,XRSession:na,XRSessionEvent:os,XRFrame:is,XRView:ea,XRViewport:Zs,XRViewerPose:Js,XRWebGLLayer:Cu,XRSpace:Ki,XRReferenceSpace:ts,XRReferenceSpaceEvent:Pu,XRInputSource:oa,XRInputSourceEvent:ia,XRInputSourcesChangeEvent:ra,XRRenderState:rs,XRRigidTransform:Qs,XRPose:$s};var Lw=n=>typeof n.prototype.makeXRCompatible=="function"?!1:(n.prototype.makeXRCompatible=function(){return this[Du]=!0,Promise.resolve()},!0),Pw=n=>{let e=n.prototype.getContext;n.prototype.getContext=function(t,i){let r=e.call(this,t,i);return r&&(r[cm]=!0,i&&"xrCompatible"in i&&(r[Du]=i.xrCompatible)),r}};var R_=n=>!!(n.ImageBitmapRenderingContext&&n.createImageBitmap),I_=n=>{var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(n.navigator.userAgent||n.navigator.vendor||n.opera),e},B_=n=>{n.style.display="block",n.style.position="absolute",n.style.width=n.style.height="1px",n.style.top=n.style.left="0px"};var q_=D0(V_());var sa=class extends po{constructor(e){super(),this.global=e,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(e,t){throw new Error("Not implemented")}isSessionSupported(e){throw new Error("Not implemented")}isFeatureSupported(e){throw new Error("Not implemented")}async requestSession(e,t){throw new Error("Not implemented")}requestAnimationFrame(e){throw new Error("Not implemented")}onFrameStart(e){throw new Error("Not implemented")}onFrameEnd(e){throw new Error("Not implemented")}doesSessionSupportReferenceSpace(e,t){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(e,t){}cancelAnimationFrame(e){throw new Error("Not implemented")}endSession(e){throw new Error("Not implemented")}getViewport(e,t,i,r){throw new Error("Not implemented")}getProjectionMatrix(e){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(e){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(e,t,i){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}};var Kle={mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},Qle={mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},$le={mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},O_={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},Jle={mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[Math.PI*-.08,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},Zle={mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},ece={mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},Bw={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},tce={"Daydream Controller":Kle,"Gear VR Controller":Zle,"HTC Vive Focus Controller":Qle,"Oculus Go Controller":$le,"Oculus Touch (Right)":O_,"Oculus Touch (Left)":O_,"OpenVR Gamepad":Jle,"Spatial Controller (Spatial Interaction Source) 045E-065A":Bw,"Spatial Controller (Spatial Interaction Source) 045E-065D":ece,"Windows Mixed Reality (Right)":Bw,"Windows Mixed Reality (Left)":Bw},N_=tce;var W_=Di(.155,-.465,-.15),nce=Di(-.155,-.465,-.15),ice=Di(0,0,-.25),rce=Di(0,0,.05),H_=Di(-.08,.14,.08),U_=.4,oce=.4,sce=.61,ace=.175,lce=.12,cce=.87,z_=180/Math.PI;function uce(n,e,t){function i(c,u,p){return c<u?u:c>p?p:c}var r=e[0]*e[0],o=e[1]*e[1],s=e[2]*e[2],l=e[3]*e[3];if(t==="XYZ")n[0]=Math.atan2(2*(e[0]*e[3]-e[1]*e[2]),l-r-o+s),n[1]=Math.asin(i(2*(e[0]*e[2]+e[1]*e[3]),-1,1)),n[2]=Math.atan2(2*(e[2]*e[3]-e[0]*e[1]),l+r-o-s);else if(t==="YXZ")n[0]=Math.asin(i(2*(e[0]*e[3]-e[1]*e[2]),-1,1)),n[1]=Math.atan2(2*(e[0]*e[2]+e[1]*e[3]),l-r-o+s),n[2]=Math.atan2(2*(e[0]*e[1]+e[2]*e[3]),l-r+o-s);else if(t==="ZXY")n[0]=Math.asin(i(2*(e[0]*e[3]+e[1]*e[2]),-1,1)),n[1]=Math.atan2(2*(e[1]*e[3]-e[2]*e[0]),l-r-o+s),n[2]=Math.atan2(2*(e[2]*e[3]-e[0]*e[1]),l-r+o-s);else if(t==="ZYX")n[0]=Math.atan2(2*(e[0]*e[3]+e[2]*e[1]),l-r-o+s),n[1]=Math.asin(i(2*(e[1]*e[3]-e[0]*e[2]),-1,1)),n[2]=Math.atan2(2*(e[0]*e[1]+e[2]*e[3]),l+r-o-s);else if(t==="YZX")n[0]=Math.atan2(2*(e[0]*e[3]-e[2]*e[1]),l-r+o-s),n[1]=Math.atan2(2*(e[1]*e[3]-e[0]*e[2]),l+r-o-s),n[2]=Math.asin(i(2*(e[0]*e[1]+e[2]*e[3]),-1,1));else if(t==="XZY")n[0]=Math.atan2(2*(e[0]*e[3]+e[1]*e[2]),l-r+o-s),n[1]=Math.atan2(2*(e[0]*e[2]+e[1]*e[3]),l+r-o-s),n[2]=Math.asin(i(2*(e[2]*e[3]-e[0]*e[1]),-1,1));else{console.log("No order given for quaternion to euler conversion.");return}}var Ru=class{constructor(){this.hand="right",this.headElbowOffset=W_,this.controllerQ=Ni(),this.lastControllerQ=Ni(),this.headQ=Ni(),this.headPos=Oi(),this.elbowPos=Oi(),this.wristPos=Oi(),this.time=null,this.lastTime=null,this.rootQ=Ni(),this.position=Oi()}setHandedness(e){this.hand!=e&&(this.hand=e,this.hand=="left"?this.headElbowOffset=nce:this.headElbowOffset=W_)}update(e,t){this.time=lm(),e&&(am(this.lastControllerQ,this.controllerQ),am(this.controllerQ,e)),t&&(tm(this.headPos,t),nm(this.headQ,t));let i=this.getHeadYawOrientation_(),r=this.quatAngle_(this.lastControllerQ,this.controllerQ),o=(this.time-this.lastTime)/1e3;r/o>sce?Tl(this.rootQ,this.rootQ,i,Math.min(r/ace,1)):am(this.rootQ,i);let l=Di(0,0,-1);Ks(l,l,this.controllerQ);let c=_u(l,[0,1,0]),u=this.clamp_((c-lce)/cce,0,1),p=Tw(this.rootQ);yw(p,p),_w(p,p,this.controllerQ);let d=this.elbowPos;bw(d,this.headPos),yl(d,d,this.headElbowOffset);let h=vw(H_);Sw(h,h,u),yl(d,d,h);let g=this.quatAngle_(p,Ni())*z_,F=1-Math.pow(g/180,4);sssss;let b=U_,R=1-U_,P=F*(b+R*u*oce),L=Ni();Tl(L,L,p,P);let S=yw(Ni(),L),x=Tw(p);_w(x,x,S);let v=this.wristPos;bw(v,rce),Ks(v,v,L),yl(v,v,ice),Ks(v,v,x),yl(v,v,d);let M=vw(H_);Sw(M,M,u),yl(this.position,this.wristPos,M),Ks(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let e=Oi();return uce(e,this.headQ,"YXZ"),k_(Ni(),0,e[1]*z_,0)}clamp_(e,t,i){return Math.min(Math.max(e,t),i)}quatAngle_(e,t){let i=[0,0,-1],r=[0,0,-1];return Ks(i,i,e),Ks(r,r,t),v_(i,r)}};var oi=Symbol("@@webxr-polyfill/XRRemappedGamepad"),j_={pressed:!1,touched:!1,value:0};Object.freeze(j_);var Vw=class{constructor(e,t,i){if(i||(i={}),i.userAgentOverrides){for(let u in i.userAgentOverrides)if(navigator.userAgent.includes(u)){let p=i.userAgentOverrides[u];for(let d in p)d in i?Object.assign(i[d],p[d]):i[d]=p[d];break}}let r=new Array(i.axes&&i.axes.length?i.axes.length:e.axes.length),o=new Array(i.buttons&&i.buttons.length?i.buttons.length:e.buttons.length),s=null;if(i.gripTransform){let u=i.gripTransform.orientation||[0,0,0,1];s=Ur(),Zo(s,yu(u,u),i.gripTransform.position||[0,0,0])}let l=null;if(i.targetRayTransform){let u=i.targetRayTransform.orientation||[0,0,0,1];l=Ur(),Zo(l,yu(u,u),i.targetRayTransform.position||[0,0,0])}let c=i.profiles;i.displayProfiles&&t.displayName in i.displayProfiles&&(c=i.displayProfiles[t.displayName]),this[oi]={gamepad:e,map:i,profiles:c||[e.id],mapping:i.mapping||e.mapping,axes:r,buttons:o,gripTransform:s,targetRayTransform:l},this._update()}_update(){let e=this[oi].gamepad,t=this[oi].map,i=this[oi].axes;for(let o=0;o<i.length;++o)t.axes&&o in t.axes?t.axes[o]===null?i[o]=0:i[o]=e.axes[t.axes[o]]:i[o]=e.axes[o];if(t.axes&&t.axes.invert)for(let o of t.axes.invert)o<i.length&&(i[o]*=-1);let r=this[oi].buttons;for(let o=0;o<r.length;++o)t.buttons&&o in t.buttons?t.buttons[o]===null?r[o]=j_:r[o]=e.buttons[t.buttons[o]]:r[o]=e.buttons[o]}get id(){return""}get _profiles(){return this[oi].profiles}get index(){return-1}get connected(){return this[oi].gamepad.connected}get timestamp(){return this[oi].gamepad.timestamp}get mapping(){return this[oi].mapping}get axes(){return this[oi].axes}get buttons(){return this[oi].buttons}get hapticActuators(){return this[oi].gamepad.hapticActuators}},Iu=class{constructor(e,t,i=0,r=-1){this.polyfill=e,this.display=t,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new oa(this),this.lastPosition=Oi(),this.emulatedPosition=!1,this.basePoseMatrix=Ur(),this.outputMatrix=Ur(),this.primaryButtonIndex=i,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=r,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(e){this.nativeGamepad!==e&&(this.nativeGamepad=e,e?this.gamepad=new Vw(e,this.display,N_[e.id]):this.gamepad=null),this.handedness=e.hand===""?"none":e.hand,this.gamepad&&this.gamepad._update(),e.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!e.pose.hasPosition):e.hand===""&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let e=this.nativeGamepad.pose,t=e.position,i=e.orientation;if(!t&&!i)return;t?(this.lastPosition[0]=t[0],this.lastPosition[1]=t[1],this.lastPosition[2]=t[2]):e.hasPosition?t=this.lastPosition:(this.armModel||(this.armModel=new Ru),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(i,this.polyfill.getBasePoseMatrix()),t=this.armModel.getPosition()),Zo(this.basePoseMatrix,i,t)}else F_(this.basePoseMatrix,this.polyfill.getBasePoseMatrix());return this.basePoseMatrix}getXRPose(e,t){switch(this.updateBasePoseMatrix(),t){case"target-ray":e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[oi].targetRayTransform&&ho(this.outputMatrix,this.outputMatrix,this.gamepad[oi].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[oi].gripTransform&&ho(this.outputMatrix,this.outputMatrix,this.gamepad[oi].gripTransform);break;default:return null}return e._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}};var kCe=Symbol("@@webxr-polyfill/WebVRDevice"),Bu=!1,G_={highRefreshRate:!0},X_={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},pce=0,Ow=class{constructor(e,t,i={}){if(this.mode=e,this.enabledFeatures=t,this.outputContext=null,this.immersive=e=="immersive-vr"||e=="immersive-ar",this.ended=null,this.baseLayer=null,this.id=++pce,this.modifiedCanvasLayer=!1,this.outputContext&&!Bu){let r=i.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(r)}}},aa=class extends sa{constructor(e,t){let{canPresent:i}=t.capabilities;super(e),this.display=t,this.frame=new e.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=i,this.baseModelMatrix=Ur(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),e.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=e.navigator&&"getGamepads"in e.navigator,this.HAS_BITMAP_SUPPORT=R_(e)}get depthNear(){return this.display.depthNear}set depthNear(e){this.display.depthNear=e}get depthFar(){return this.display.depthFar}set depthFar(e){this.display.depthFar=e}onBaseLayerSet(e,t){let i=this.sessions.get(e),r=t.context.canvas;if(i.immersive){let o=this.display.getEyeParameters("left"),s=this.display.getEyeParameters("right");r.width=Math.max(o.renderWidth,s.renderWidth)*2,r.height=Math.max(o.renderHeight,s.renderHeight),this.display.requestPresent([{source:r,attributes:G_}]).then(()=>{!Bu&&!this.global.document.body.contains(r)&&(i.modifiedCanvasLayer=!0,this.global.document.body.appendChild(r),B_(r)),i.baseLayer=t})}else i.baseLayer=t}isSessionSupported(e){return!(e=="immersive-ar"||e=="immersive-vr"&&this.canPresent===!1)}isFeatureSupported(e){switch(e){case"viewer":return!0;case"local":return!0;case"local-floor":return!0;case"bounded":return!1;case"unbounded":return!1;default:return!1}}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();let i=e=="immersive-vr";if(i){let o=this.global.document.createElement("canvas");if(!Bu){let s=o.getContext("webgl")}await this.display.requestPresent([{source:o,attributes:G_}])}let r=new Ow(e,t,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(r.id,r),i&&(this.immersiveSession=r,this.dispatchEvent("@@webxr-polyfill/vr-present-start",r.id)),Promise.resolve(r.id)}requestAnimationFrame(e){return this.display.requestAnimationFrame(e)}getPrimaryButtonIndex(e){let t=0,i=e.id.toLowerCase();for(let r in X_)if(i.includes(r)){t=X_[r];break}return Math.min(t,e.buttons.length-1)}onFrameStart(e,t){this.display.depthNear=t.depthNear,this.display.depthFar=t.depthFar,this.display.getFrameData(this.frame);let i=this.sessions.get(e);if(i.immersive&&this.CAN_USE_GAMEPAD){let r=this.gamepadInputSources;this.gamepadInputSources={};let o=this.global.navigator.getGamepads();for(let s=0;s<o.length;++s){let l=o[s];if(l&&l.displayId>0){let c=r[s];if(c||(c=new Iu(this,this.display,this.getPrimaryButtonIndex(l))),c.updateFromGamepad(l),this.gamepadInputSources[s]=c,c.primaryButtonIndex!=-1){let u=l.buttons[c.primaryButtonIndex].pressed;u&&!c.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:i.id,inputSource:c.inputSource}):!u&&c.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:i.id,inputSource:c.inputSource}),c.primaryActionPressed=u}if(c.primarySqueezeButtonIndex!=-1){let u=l.buttons[c.primarySqueezeButtonIndex].pressed;u&&!c.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:i.id,inputSource:c.inputSource}):!u&&c.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:i.id,inputSource:c.inputSource}),c.primarySqueezeActionPressed=u}}}}if(!Bu&&!i.immersive&&i.baseLayer){let r=i.baseLayer.context.canvas;im(this.frame.leftProjectionMatrix,t.inlineVerticalFieldOfView,r.width/r.height,t.depthNear,t.depthFar)}}onFrameEnd(e){let t=this.sessions.get(e);if(!(t.ended||!t.baseLayer)){if(t.outputContext&&!(t.immersive&&!this.display.capabilities.hasExternalDisplay)){let i=t.immersive&&this.display.capabilities.hasExternalDisplay,r=t.baseLayer.context.canvas,o=i?r.width/2:r.width,s=r.height;if(!Bu){let l=t.outputContext.canvas,c=l.width,u=l.height,p=t.renderContext;this.HAS_BITMAP_SUPPORT?r.transferToImageBitmap?p.transferFromImageBitmap(r.transferToImageBitmap()):this.global.createImageBitmap(r,0,0,o,s,{resizeWidth:c,resizeHeight:u}).then(d=>p.transferFromImageBitmap(d)):p.drawImage(r,0,0,o,s,0,0,c,u)}}t.immersive&&t.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(e){this.display.cancelAnimationFrame(e)}async endSession(e){let t=this.sessions.get(e);if(!t.ended){if(t.immersive)return this.display.exitPresent();t.ended=!0}}doesSessionSupportReferenceSpace(e,t){let i=this.sessions.get(e);return i.ended?!1:i.enabledFeatures.has(t)}requestStageBounds(){if(this.display.stageParameters){let e=this.display.stageParameters.sizeX,t=this.display.stageParameters.sizeZ,i=[];return i.push(-e/2),i.push(-t/2),i.push(e/2),i.push(-t/2),i.push(e/2),i.push(t/2),i.push(-e/2),i.push(t/2),i}return null}async requestFrameOfReferenceTransform(e,t){return(e==="local-floor"||e==="bounded-floor")&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(e){if(e==="left")return this.frame.leftProjectionMatrix;if(e==="right")return this.frame.rightProjectionMatrix;if(e==="none")return this.frame.leftProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(e,t,i,r){let o=this.sessions.get(e),{width:s,height:l}=i.context.canvas;if(!o.immersive)return r.x=r.y=0,r.width=s,r.height=l,!0;if(t==="left"||t==="none")r.x=0;else if(t==="right")r.x=s/2;else return!1;return r.y=0,r.width=s/2,r.height=l,!0}getBasePoseMatrix(){let{position:e,orientation:t}=this.frame.pose;return!e&&!t?this.baseModelMatrix:(e||(e=this.tempVec3,e[0]=e[1]=e[2]=0),Zo(this.baseModelMatrix,t,e),this.baseModelMatrix)}getBaseViewMatrix(e){if(e==="left"||e==="none")return this.frame.leftViewMatrix;if(e==="right")return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let e=[];for(let t in this.gamepadInputSources)e.push(this.gamepadInputSources[t].inputSource);return e}getInputPose(e,t,i){if(!t)return null;for(let r in this.gamepadInputSources){let o=this.gamepadInputSources[r];if(o.inputSource===e)return o.getXRPose(t,i)}return null}onWindowResize(){}onVRDisplayPresentChange(e){this.display.isPresenting||this.sessions.forEach(t=>{if(t.immersive&&!t.ended){if(t.modifiedCanvasLayer){let i=t.baseLayer.context.canvas;document.body.removeChild(i),i.setAttribute("style","")}this.immersiveSession===t&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",t.id)}})}};var Vu=class extends aa{constructor(e,t){let i=new q_.default(t||{});super(e,i),this.display=i,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}};var dce=!1,hce=0,Nw=class{constructor(e,t){this.mode=e,this.enabledFeatures=t,this.ended=null,this.baseLayer=null,this.id=++hce}},Ou=class extends sa{constructor(e){super(e),this.sessions=new Map,this.projectionMatrix=Ur(),this.identityMatrix=Ur()}onBaseLayerSet(e,t){let i=this.sessions.get(e);i.baseLayer=t}isSessionSupported(e){return e=="inline"}isFeatureSupported(e){switch(e){case"viewer":return!0;default:return!1}}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();let i=new Nw(e,t);return this.sessions.set(i.id,i),Promise.resolve(i.id)}requestAnimationFrame(e){return window.requestAnimationFrame(e)}cancelAnimationFrame(e){window.cancelAnimationFrame(e)}onFrameStart(e,t){if(dce)return;let i=this.sessions.get(e);if(i.baseLayer){let r=i.baseLayer.context.canvas;im(this.projectionMatrix,t.inlineVerticalFieldOfView,r.width/r.height,t.depthNear,t.depthFar)}}onFrameEnd(e){}async endSession(e){let t=this.sessions.get(e);t.ended=!0}doesSessionSupportReferenceSpace(e,t){let i=this.sessions.get(e);return i.ended?!1:i.enabledFeatures.has(t)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(e,t){return null}getProjectionMatrix(e){return this.projectionMatrix}getViewport(e,t,i,r){let o=this.sessions.get(e),{width:s,height:l}=i.context.canvas;return r.x=r.y=0,r.width=s,r.height=l,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(e){return this.identityMatrix}getInputSources(){return[]}getInputPose(e,t,i){return null}onWindowResize(){}};var mce=async function(n){let e=null;if("getVRDisplays"in n.navigator)try{let t=await n.navigator.getVRDisplays();t&&t.length&&(e=new aa(n,t[0]))}catch{}return e},Y_=async function(n,e){if(e.webvr){let i=await mce(n);if(i)return i}let t=I_(n);return t&&e.cardboard||!t&&e.allowCardboardOnDesktop?(n.VRFrameData||(n.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new Vu(n,e.cardboardConfig)):new Ou(n)};var fce={global:em,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},dm=["navigator","HTMLCanvasElement","WebGLRenderingContext"],Nu=class{constructor(e={}){this.config=Object.freeze(Object.assign({},fce,e)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}_injectPolyfill(e){if(!dm.every(t=>!!e[t]))throw new Error(`Global must have the following attributes : ${dm}`);for(let t of Object.keys(pm))e[t]!==void 0?console.warn(`${t} already defined on global.`):e[t]=pm[t];Lw(e.WebGLRenderingContext)&&(Pw(e.HTMLCanvasElement),e.OffscreenCanvas&&Pw(e.OffscreenCanvas),e.WebGL2RenderingContext&&Lw(e.WebGL2RenderingContext),window.isSecureContext||console.warn(`WebXR Polyfill Warning:
This page is not running in a secure context (https:// or localhost)!
This means that although the page may be able to use the WebXR Polyfill it will
not be able to use native WebXR implementations, and as such will not be able to
access dedicated VR or AR hardware, and will not be able to take advantage of
any performance improvements a native WebXR implementation may offer. Please
host this content on a secure origin for the best user experience.
`)),this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let e=Y_(this.global,this.config);this.xr=new pm.XRSystem(e),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(e){if(!dm.every(t=>!!e[t]))throw new Error(`Global must have the following attributes : ${dm}`);if(e.navigator.xr&&"supportsSession"in e.navigator.xr&&!("isSessionSupported"in e.navigator.xr)){let t=e.navigator.xr.supportsSession;e.navigator.xr.isSessionSupported=function(i){return t.call(this,i).then(()=>!0).catch(()=>!1)},e.navigator.xr.supportsSession=function(i){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),t.call(this,i)}}}};var hm=class{constructor(e,t=512,i=512){this.colorMatrixLeft=new Cx().fromArray([.4561,-.0400822,-.0152161,.500484,-.0378246,-.0205971,.176381,-.0157589,-.00546856]),this.colorMatrixRight=new Cx().fromArray([-.0434706,.378476,-.0721527,-.0879388,.73364,-.112961,-.00155529,-.0184503,1.2264]);let r=new Md(-1,1,1,-1,0,1),o=new No,s=new Ub;s.eyeSep=.07;let l={minFilter:Qc,magFilter:kd,format:Bb},c=new Ix(t,i,l),u=new Ix(t,i,l),p=new Cd({uniforms:{mapLeft:{value:c.texture},mapRight:{value:u.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = vec2( uv.x, uv.y );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;","float lin( float c ) {","	return c <= 0.04045 ? c * 0.0773993808 :","			pow( c * 0.9478672986 + 0.0521327014, 2.4 );","}","vec4 lin( vec4 c ) {","	return vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );","}","float dev( float c ) {","	return c <= 0.0031308 ? c * 12.92","			: pow( c, 0.41666 ) * 1.055 - 0.055;","}","void main() {","	vec2 uv = vUv;","	vec4 colorL = lin( texture2D( mapLeft, uv ) );","	vec4 colorR = lin( texture2D( mapRight, uv ) );","	vec3 color = clamp(","			colorMatrixLeft * colorL.rgb +","			colorMatrixRight * colorR.rgb, 0., 1. );","	gl_FragColor = vec4(","			dev( color.r ), dev( color.g ), dev( color.b ),","			max( colorL.a, colorR.a ) );","}"].join(`
`)}),d=new qn(new Oo(2,2),p);o.add(d),this.setSize=function(h,A){e.setSize(h,A);let g=e.getPixelRatio();c.setSize(h*g,A*g),u.setSize(h*g,A*g)},this.render=function(h,A){let g=e.getRenderTarget();h.matrixWorldAutoUpdate===!0&&h.updateMatrixWorld(),A.parent===null&&A.matrixWorldAutoUpdate===!0&&A.updateMatrixWorld(),s.update(A),e.setRenderTarget(c),e.clear(),e.render(h,s.cameraL),e.setRenderTarget(u),e.clear(),e.render(h,s.cameraR),e.setRenderTarget(null),e.render(o,r),e.setRenderTarget(g)},this.dispose=function(){c.dispose(),u.dispose(),d.geometry.dispose(),d.material.dispose()}}};navigator.xr||(console.info("Polyfilling WebXR API"),new Nu);var fm=class extends ge{constructor(e,t,i,r,o){super(e),this.mode=t,this.session=i,this.referenceSpaceType=r,this.sessionMode=o}},Wu=class extends fm{constructor(e,t,i,r){super("sessionstarted",e,t,i,r)}},Hu=class extends fm{constructor(e,t,i,r){super("sessionstopped",e,t,i,r)}},mm=new Map([[tt.VR,{referenceSpaceType:"local-floor",sessionMode:"immersive-vr"}],[tt.AR,{referenceSpaceType:"local-floor",sessionMode:"immersive-ar"}]]),gm=class extends Be{constructor(e,t,i,r,o){super(),this.renderer=e,this.camera=t,this.fullscreenElement=i,this.enableFullResolution=r,this.enableAnaglyph=o,this._currentMode=tt.None,this.buttons=new Map,this.currentSession=null,this.screenUI=null,this.wasVisible=new Map,this.lastFOV=50,this.addEventListener("sessionstarted",s=>{s.sessionMode==="inline"&&(this.lastFOV=this.camera.fov,this.camera.fov=Lt(s.session.renderState.inlineVerticalFieldOfView))}),this.addEventListener("sessionstopped",s=>{s.sessionMode==="inline"&&(this.camera.fov=this.lastFOV)}),this.renderer.xr.addEventListener("sessionstart",()=>this.onSessionStarted()),this.renderer.xr.addEventListener("sessionend",()=>this.onSessionEnded()),this.anaglyph=new hm(this.renderer),this.refresh()}setUI(e,t,i,r,o){this.screenUI=e;for(let s of[t,i,r,o])s&&this.buttons.set(s.mode,s);for(let s of this.buttons.values())this.wasVisible.set(s,s.visible),s.addEventListener("click",this.toggleMode.bind(this,s.mode));t.available=this.enableAnaglyph,i.available=!io()&&Aw(),r.available=nd(),o.available=td(),this.refresh()}get visible(){return zn(this.renderer.domElement)}set visible(e){Ue(this.renderer.domElement,e),this.screenUI&&(e?this.screenUI.show():this.screenUI.hide())}get currentMode(){return this._currentMode}resize(){if(!this.renderer.xr.isPresenting){this.renderer.domElement.style.width="",this.renderer.domElement.style.height="";let{clientWidth:e,clientHeight:t,width:i,height:r}=this.renderer.domElement,o=Math.floor(e*devicePixelRatio),s=Math.floor(t*devicePixelRatio);e>0&&t>0&&(i!==o||r!==s)&&(this.renderer.setPixelRatio(devicePixelRatio),this.renderer.setSize(e,t,!1),this.anaglyph.setSize(e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix())}}getMetrics(){let e=this.renderer.domElement.clientWidth,t=this.renderer.domElement.clientHeight,i=this.renderer.getPixelRatio(),r=this.camera.fov;return{width:e,height:t,pixelRatio:i,fov:r}}setMetrics(e,t,i,r){this.renderer.setPixelRatio(i),this.renderer.setSize(e,t,!1),this.camera.aspect=e/t,this.camera.fov=r,this.camera.updateProjectionMatrix()}async refresh(){let e=Array.from(this.buttons.values()).filter(t=>t.available&&t.mode!==tt.Fullscreen&&t.mode!==tt.Anaglyph);await Promise.all(e.map(async t=>{let i=mm.get(t.mode);if(t.available=y(i),t.available){let r=navigator.xr&&await navigator.xr.isSessionSupported(i.sessionMode),o=!td()&&mx()&&i.sessionMode==="immersive-vr"&&i.referenceSpaceType==="local-floor";t.available=r||o}}))}async toggleMode(e){if(e===tt.None)throw new Error("Cannot toggle 'None' Screen Mode");if(e===tt.VR||e===tt.AR)await this.toggleXR(e);else{let t=e.indexOf("Fullscreen")>=0,i=e.indexOf("Anaglyph")>=0,r=this.currentMode.indexOf("Fullscreen")>=0,o=this.currentMode.indexOf("Anaglyph")>=0;t?await this.toggleFullscreen(o):this.setActive(i!==o?r?tt.FullscreenAnaglyph:tt.Anaglyph:r?tt.Fullscreen:tt.None)}}async start(e){let t=e;(e===tt.Anaglyph&&this.currentMode===tt.Fullscreen||e===tt.Fullscreen&&this.currentMode===tt.Anaglyph)&&(t=tt.FullscreenAnaglyph),t!==this.currentMode&&(await this.toggleMode(this.currentMode),await this.toggleMode(e))}async stop(){await this.toggleMode(this.currentMode)}get isFullscreen(){return"fullscreenElement"in document&&y(document.fullscreenElement)||"fullscreen"in document&&document.fullscreen}async startFullscreen(e){this.isFullscreen||(await this.fullscreenElement.requestFullscreen({navigationUI:"show"}),e?(this.setActive(tt.FullscreenAnaglyph),this.dispatchEvent(new Wu(tt.FullscreenAnaglyph,null,null,null))):(this.setActive(tt.Fullscreen),this.dispatchEvent(new Wu(tt.Fullscreen,null,null,null))))}async stopFullscreen(e){this.isFullscreen&&(await document.exitFullscreen(),e?(this.setActive(tt.Anaglyph),this.dispatchEvent(new Hu(tt.FullscreenAnaglyph,null,null,null))):(this.setActive(tt.None),this.dispatchEvent(new Hu(tt.Fullscreen,null,null,null))))}async toggleFullscreen(e){this.isFullscreen?await this.stopFullscreen(e):await this.startFullscreen(e)}async toggleXR(e){let t=mm.get(e);if(y(t)){if(this.currentSession)this.currentSession.end();else if(navigator.xr){this.camera.position.setScalar(0),this.camera.quaternion.identity();try{let i=await navigator.xr.requestSession(t.sessionMode,{optionalFeatures:["local-floor","bounded-floor","high-refresh-rate","hand-tracking","layers"]});if(this.setActive(e),this.currentSession=i,this.renderer.xr.setReferenceSpaceType(t.referenceSpaceType),this.enableFullResolution&&"XRWebGLLayer"in window&&"getNativeFramebufferScaleFactor"in XRWebGLLayer){let r=XRWebGLLayer.getNativeFramebufferScaleFactor(i);this.renderer.xr.setFramebufferScaleFactor(r)}this.renderer.xr.setSession(i)}catch(i){console.error(`Couldn't start session type '${t.sessionMode}'. Reason: ${i&&i.message||i||"UNKNOWN"}`)}}}}onSessionStarted(){let e=this.currentMode,t=mm.get(this.currentMode),i=this.currentSession;if(i.supportedFrameRates){let r=Math.max(...i.supportedFrameRates);console.log("Changing framerate to",r),i.updateTargetFrameRate(r)}this.dispatchEvent(new Wu(e,i,t.referenceSpaceType,t.sessionMode))}onSessionEnded(){let e=this.currentMode,t=mm.get(this.currentMode),i=this.currentSession;this.currentSession=null,this.renderer.xr.setSession(null),this.setActive(tt.None),this.dispatchEvent(new Hu(e,i,t.referenceSpaceType,t.sessionMode))}setActive(e){for(let t of this.buttons.values())t.active=t.mode===e,t.visible=this.wasVisible.get(t)&&(e!==tt.VR&&e!==tt.AR||t.mode===e);this._currentMode=e}render(e,t){this.renderer.clear(),this.currentMode===tt.Anaglyph||this.currentMode===tt.FullscreenAnaglyph?this.anaglyph.render(e,t):this.renderer.render(e,t)}};var gi;(function(n){n[n.None=-1]="None",n[n.Left=0]="Left",n[n.Right=1]="Right",n[n.Up=2]="Up",n[n.Down=3]="Down",n[n.Back=4]="Back",n[n.Front=5]="Front"})(gi||(gi={}));var K_=new Se(0,1,0),xi=2048,El=xi/2,gce=[1,0,2,3,4,5],wr={rows:3,columns:4,indices:[[gi.None,gi.Up,gi.None,gi.None],[gi.Left,gi.Front,gi.Right,gi.Back],[gi.None,gi.Down,gi.None,gi.None]],rotations:[[0,en,0,0],[0,0,0,0],[0,en,0,0]]},xm=new Sn(0),wm=class{get envMap(){return this._cube}constructor(e){this.env=e,this.rt=new qb(xi),this.rtScene=new No,this.rtCamera=new pb(.01,10,this.rt),this._rotation=new it,this.layerRotation=new it().identity(),this.stageRotation=new it().identity(),this.canvases=new Array(6),this.contexts=new Array(6),this.layerOrientation=null,this.images=null,this.curImagePath=null,this.layer=null,this.wasVisible=!1,this.stageHeading=0,this.rotationNeedsUpdate=!1,this.imageNeedsUpdate=!1,this.useWebXRLayers=!0,this.wasWebXRLayerAvailable=null,this.visible=!0,this.onNeedsRedraw=()=>this.imageNeedsUpdate=!0,this.env.scene.background=xm;for(let t=0;t<this.canvases.length;++t){let i=this.canvases[t]=ur(xi,xi);this.contexts[t]=i.getContext("2d",{alpha:!1})}for(let t=0;t<wr.rows;++t){let i=wr.indices[t],r=wr.rotations[t];for(let o=0;o<wr.columns;++o){let s=i[o];if(s>-1){let l=this.contexts[s],c=r[o];c>0&&(c%2,l.translate(El,El),l.rotate(c),l.translate(-El,-El))}}}this.rt.texture.name="SkyboxOutput",this.rtScene.add(this.rtCamera),this.flipped=ur(xi,xi),this.flipper=this.flipped.getContext("2d",{alpha:!1}),this.flipper.fillStyle=xm.getHexString(),this.flipper.scale(-1,1),this.flipper.translate(-xi,0),this.setImages("",this.canvases),this.env.addScopedEventListener(this,"update",t=>this.checkWebXRLayer(t.frame)),Object.seal(this)}clear(){this.setImage(null,null)}setImage(e,t){return e!==this.curImagePath?y(t)?(this.sliceImage(t),this.setImages(e,this.canvases)):this.setImages(e,null):null}sliceImage(e){let t=e.width/wr.columns,i=e.height/wr.rows;for(let r=0;r<wr.rows;++r){let o=wr.indices[r];for(let s=0;s<wr.columns;++s){let l=o[s];l>-1&&this.contexts[l].drawImage(e,s*t,r*i,t,i,0,0,xi,xi)}}return this.canvases}setImages(e,t){if((e!==this.curImagePath||t!==this.images)&&(this.curImagePath=e,t!==this.images)){if(y(this._cube)&&(ut(this._cube),this._cube=null),y(this.images))for(let i of this.images)ut(i);this.images=t,y(this.images)?(this.rtScene.background=this._cube=new db(this.images),this._cube.name="SkyboxInput"):this.rtScene.background=xm}return this.updateImages(),this._cube}updateImages(){this._cube.needsUpdate=!0,this.imageNeedsUpdate=!0}get rotation(){return this._rotation}set rotation(e){let{x:t,y:i,z:r,w:o}=this._rotation;if(Jb(e))this._rotation.copy(e);else if(Zb(e))this._rotation.setFromEuler(e);else if(Wn(e))if(e.length===4&&mt(e[0])&&mt(e[1])&&mt(e[2])&&mt(e[3]))this._rotation.fromArray(e);else throw new Error("Skybox rotation was not a valid array format. Needs an array of 4 numbers.");else Ai(e)?this._rotation.setFromAxisAngle(K_,e):(y(e)&&console.warn("Skybox rotation must be a THREE.Quaternion, THREE.Euler, number[] (representing a Quaternion), or a number (representing rotation about the Y-axis)."),this._rotation.identity());this.rotationNeedsUpdate=this._rotation.x!==t||this._rotation.y!==i||this._rotation.z!==r||this._rotation.w!==o}checkWebXRLayer(e){if(this._cube){let t=this.useWebXRLayers&&this.env.hasXRCompositionLayers&&y(e)&&y(this.env.xrBinding),i=t!==this.wasWebXRLayerAvailable;if(i){if(t){let r=this.env.renderer.xr.getReferenceSpace();this.layer=this.env.xrBinding.createCubeLayer({space:r,layout:"mono",isStatic:!1,viewPixelWidth:xi,viewPixelHeight:xi,orientation:this.layerOrientation}),this.layer.addEventListener("redraw",this.onNeedsRedraw),this.env.addWebXRLayer(this.layer,Number.MAX_VALUE)}else this.layer&&(this.env.removeWebXRLayer(this.layer),this.layer.removeEventListener("redraw",this.onNeedsRedraw),Io(this.layer),this.layer=null);this.imageNeedsUpdate=!0}if(!this.layer||!i){let r=this.visible!==this.wasVisible,o=this.env.avatar.headingRadians!==this.stageHeading;if(this.imageNeedsUpdate=this.imageNeedsUpdate||r||this.layer&&this.layer.needsRedraw,this.rotationNeedsUpdate=this.rotationNeedsUpdate||o,this.env.scene.background=this.layer?null:this.visible?this.rt.texture:xm,this.rotationNeedsUpdate&&(this.layerRotation.copy(this.rotation).invert(),this.stageRotation.setFromAxisAngle(K_,this.env.avatar.headingRadians).premultiply(this.layerRotation),this.layerOrientation=new DOMPointReadOnly(this.stageRotation.x,this.stageRotation.y,this.stageRotation.z,this.stageRotation.w),this.layer?this.layer.orientation=this.layerOrientation:(this.rtCamera.quaternion.copy(this.layerRotation),this.imageNeedsUpdate=!0)),this.imageNeedsUpdate)if(this.layer){let s=this.env.renderer.getContext(),l=this.env.xrBinding.getSubImage(this.layer,e),c=this._cube.images;this.flipper.fillRect(0,0,xi,xi),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.bindTexture(s.TEXTURE_CUBE_MAP,l.colorTexture);for(let u=0;u<c.length;++u){if(this.visible){let p=c[gce[u]];this.flipper.drawImage(p,0,0,p.width,p.height,0,0,xi,xi)}s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.flipped)}s.bindTexture(s.TEXTURE_CUBE_MAP,null)}else this.rtCamera.update(this.env.renderer,this.rtScene);this.stageHeading=this.env.avatar.headingRadians,this.imageNeedsUpdate=!1,this.rotationNeedsUpdate=!1,this.wasVisible=this.visible}this.wasWebXRLayerAvailable=t}}};var kl=new Se,Q_=0,xce=new Se,Fm=new Se,Ww=new Se,Am=new it,$_=0,wce=0;function Fce(n,e){let t=n-e,i=t+Vn,r=t-Vn;return nb(t,i,r)}var Uu=class extends pt{constructor(e,t,i,r,o=1){super(),this.minDistance=t,this.heightOffset=r,this.speed=o,this.name=e,this.lerp=this.minHeadingRadians>0||this.minDistance>0,this.maxDistance=this.minDistance*5,this.minHeadingRadians=je(i),this.maxHeadingRadians=en-this.minHeadingRadians,Object.seal(this)}copy(e,t=!0){return super.copy(e,t),this.name=e.name+ ++wce,this.lerp=e.lerp,this.maxDistance=e.maxDistance,this.minHeadingRadians=e.minHeadingRadians,this.maxHeadingRadians=e.maxHeadingRadians,this}update(e,t,i,r){r*=.001,this.clampTo(this.lerp,e,t,this.minDistance,this.maxDistance,i,this.minHeadingRadians,this.maxHeadingRadians,r)}reset(e,t,i){this.clampTo(!1,e,t,0,0,i,0,0,0)}clampTo(e,t,i,r,o,s,l,c,u){kl.copy(i),kl.y-=this.heightOffset*t,Q_=s,this.getWorldPosition(Fm),this.getWorldDirection(Ww),Ww.negate(),$_=Au(Ww),Am.identity();let p=!e,d=!e;if(e){let h=xce.copy(kl).sub(Fm).length();r<h&&(h<o&&kl.lerpVectors(Fm,kl,this.speed*u),p=!0);let A=Fce(Q_,$_),g=Math.abs(A);l<g&&(g<c?Am.setFromAxisAngle(this.up,A*this.speed*u):Am.setFromAxisAngle(this.up,A),d=!0)}(p||d)&&(p&&this.position.add(kl.sub(Fm)),d&&this.quaternion.multiply(Am))}};var vm=class extends ge{constructor(e,t){super(e),this.button=t}},Hw=class extends vm{constructor(e){super("gamepadbuttonup",e)}},Uw=class extends vm{constructor(e){super("gamepadbuttondown",e)}},zw=class extends ge{constructor(e,t,i){super(e),this.axis=t,this.value=i}},jw=class extends zw{constructor(e,t){super("gamepadaxismaxed",e,t)}},bm=class extends Be{constructor(){super(),this.lastAxisValues=new Array,this.btnDownEvts=new Array,this.btnUpEvts=new Array,this.wasPressed=new Array,this.axisMaxEvts=new Array,this.wasAxisMaxed=new Array,this.sticks=new Array,this.axisThresholdMax=.9,this.axisThresholdMin=.1,this._pad=null,Object.seal(this)}get displayId(){if("displayId"in this.pad)return this.pad.displayId}get pad(){return this._pad}set pad(e){if(this._pad=e,this.pad){if(this.btnUpEvts.length===0){for(let t=0;t<e.buttons.length;++t)this.btnDownEvts[t]=new Uw(t),this.btnUpEvts[t]=new Hw(t),this.wasPressed[t]=!1;for(let t=0;t<e.axes.length;++t)this.axisMaxEvts[t]=new jw(t,0),this.wasAxisMaxed[t]=!1,t%2===0&&t<e.axes.length-1&&(this.sticks[t/2]={x:0,y:0}),this.lastAxisValues[t]=e.axes[t]}for(let t=0;t<this.pad.buttons.length;++t){let i=this.wasPressed[t],r=this.pad.buttons[t].pressed;r!==i&&(this.wasPressed[t]=r,this.dispatchEvent((r?this.btnDownEvts:this.btnUpEvts)[t]))}for(let t=0;t<this.pad.axes.length;++t){let i=this.wasAxisMaxed[t],r=this.pad.axes[t],o=Math.sign(r),s=Math.abs(r),l=s>=this.axisThresholdMax,c=s<=this.axisThresholdMin,u=o*(l?1:c?0:s);l&&!i&&(this.axisMaxEvts[t].value=u,this.dispatchEvent(this.axisMaxEvts[t])),this.wasAxisMaxed[t]=l,this.lastAxisValues[t]=u}for(let t=0;t<this.axes.length-1;t+=2){let i=this.sticks[t/2];i.x=this.axes[t],i.y=this.axes[t+1]}}}get id(){return this.pad?this.pad.id:null}get index(){return this.pad?this.pad.index:null}get connected(){return this.pad&&this.pad.connected}get mapping(){return this.pad?this.pad.mapping:null}get timestamp(){return this.pad?this.pad.timestamp:null}get hand(){return this.pad?this.pad.hand:null}get pose(){return this.pad?this.pad.pose:null}get buttons(){return this.pad?this.pad.buttons:null}get axes(){return this.pad?this.pad.axes:null}get hapticActuators(){return this.pad?this.pad.hapticActuators:null}get vibrationActuator(){return this.pad?this.pad.vibrationActuator:null}};var Sm=class extends wl{constructor(e){super(e)}start(){this.timer=setInterval(()=>this.onTick(performance.now()),this.targetFrameTime)}stop(){this.timer&&(clearInterval(this.timer),super.stop())}get targetFPS(){return super.targetFPS}set targetFPS(e){super.targetFPS=e,this.isRunning&&this.restart()}};var Gw=class extends ge{constructor(){super("activity"),this.level=0}},zu=class extends nl{constructor(e){super(e,{fftSize:32,minDecibels:-70}),this._level=0,this.maxLevel=0,this.activityEvt=new Gw,this.timer=new Sm(30);let t=new Uint8Array(this.frequencyBinCount);this.timer.addTickHandler(()=>{this.getByteFrequencyData(t),this._level=Math.max(...t),isFinite(this._level)&&(this.maxLevel=Math.max(this.maxLevel,this._level),this.maxLevel>0&&(this._level/=this.maxLevel)),this.activityEvt.level=this.level,this.dispatchEvent(this.activityEvt)})}get level(){return this._level}start(){this.timer.start()}stop(){this.timer.stop()}};var Dn;(function(n){n[n.LocalUser=0]="LocalUser",n[n.Mouse=1]="Mouse",n[n.Pen=2]="Pen",n[n.Touch=3]="Touch",n[n.Gamepad=4]="Gamepad",n[n.MotionController=5]="MotionController",n[n.MotionControllerLeft=6]="MotionControllerLeft",n[n.MotionControllerRight=7]="MotionControllerRight",n[n.Nose=8]="Nose",n[n.RemoteUser=9]="RemoteUser"})(Dn||(Dn={}));var Ml=new Se;function Xw(n,e,t,i){Ml.crossVectors(e,n),n.crossVectors(Ml,e),Ml.normalize(),n.normalize(),e.normalize(),i.set(Ml.x,n.x,-e.x,t.x,Ml.y,n.y,-e.y,t.y,Ml.z,n.z,-e.z,t.z,0,0,0,1)}var Dl=class{constructor(){this._visible=!0,this._style="default"}get style(){return this._style}set style(e){this._style=e}get visible(){return this._visible}set visible(e){this._visible=e}};var as=class extends Dl{get side(){return this._side}set side(e){this._side=e}get object(){return this._object}set object(e){this._object=e}constructor(e){super(),this.env=e,this._object=null,this.T=new Se,this.V=new Se,this.Q=new it,this._side=-1,this.f=new Se,this.up=new Se,this.right=new Se}get position(){return this.object.position}update(e,t,i,r,o,s,l,c,u,p,d){i&&i.face?(this.position.copy(i.point),i.object.getWorldQuaternion(this.Q),this.T.copy(i.face.normal).applyQuaternion(this.Q),this.V.copy(this.T).multiplyScalar(.02),this.position.add(this.V),this.V.copy(this.T).multiplyScalar(10).add(this.position)):(s?this.position.copy(p).multiplyScalar(2).add(u).sub(this.env.avatar.worldPos).normalize().multiplyScalar(o).add(this.env.avatar.worldPos):(this.V.copy(u).add(t).sub(e).multiplyScalar(2),this.position.copy(p).multiplyScalar(o).add(this.V).add(this.env.avatar.worldPos)),this.V.copy(this.env.avatar.worldPos)),this.lookAt(this.position,this.V),this.style=!r||r.navigable&&!c?l?d?"grabbing":"grab":"default":r.enabled?r.draggable?d?"grabbing":"move":r.navigable?"cell":r.clickable?"pointer":"default":"not-allowed"}lookAt(e,t){this.f.copy(t).sub(e).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat),this.right.crossVectors(this.up,this.f),this.up.crossVectors(this.f,this.right),Xw(this.up,this.f,e,this.object.matrixWorld),this.object.matrix.copy(this.object.parent.matrixWorld).invert().multiply(this.object.matrixWorld),this.object.matrix.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.scale.x*=this.side,this.object.matrix.compose(this.object.position,this.object.quaternion,this.object.scale)}};var la=class extends as{constructor(e){super(e),this.material=Hx({name:"CursorMat",color:16776960}),this.object=new Ei(.01,.01,.01,this.material)}get style(){return this._currentStyle}set style(e){if(this._currentStyle=e,Kn(this.object)&&!Wn(this.object.material))switch(this._currentStyle){case"pointer":this.material.color=new Sn(65280),this.material.needsUpdate=!0;break;case"not-allowed":this.material.color=new Sn(16711680),this.material.needsUpdate=!0;break;case"move":this.material.color=new Sn(255),this.material.needsUpdate=!0;break;case"grab":this.material.color=new Sn(16711935),this.material.needsUpdate=!0;break;case"grabbing":this.material.color=new Sn(65535),this.material.needsUpdate=!0;break;default:this._currentStyle="default",this.material.color=new Sn(16776960),this.material.needsUpdate=!0;break}}get visible(){return Ka(this)}set visible(e){nn(this,e)}};var J_=new Ps,_m=new Se,ca=class extends wb{constructor(){super(),this.type="LineSegmentsGeometry";let e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new Sd(e,3)),this.setAttribute("uv",new Sd(t,2))}applyMatrix4(e){let t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let i=new Kc(t,6,1);return this.setAttribute("instanceStart",new dr(i,3,0)),this.setAttribute("instanceEnd",new dr(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let i=new Kc(t,6,1);return this.setAttribute("instanceColorStart",new dr(i,3,0)),this.setAttribute("instanceColorEnd",new dr(i,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new Yb(e.geometry)),this}fromLineSegments(e){let t=e.geometry;if(t.isGeometry){console.error("LineSegmentsGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else t.isBufferGeometry&&this.setPositions(t.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ps);let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),J_.setFromBufferAttribute(t),this.boundingBox.union(J_))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new qa),this.boundingBox===null&&this.computeBoundingBox();let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){let i=this.boundingSphere.center;this.boundingBox.getCenter(i);let r=0;for(let o=0,s=e.count;o<s;o++)_m.fromBufferAttribute(e,o),r=Math.max(r,i.distanceToSquared(_m)),_m.fromBufferAttribute(t,o),r=Math.max(r,i.distanceToSquared(_m));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}};ca.prototype.isLineSegmentsGeometry=!0;var Z_=new Se,ey=new Se,$n=new Ir,Jn=new Ir,zr=new Ir,qw=new Se,Yw=new vt,Qi=new bb,ty=new Se,mo=new Ps,ym=new qa,jr=new Ir;function ny(n,e,t,i){return jr.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),jr.multiplyScalar(1/jr.w),jr.x=t/i.width,jr.y=t/i.height,jr.applyMatrix4(n.projectionMatrixInverse),jr.multiplyScalar(1/jr.w),Math.abs(Math.max(jr.x,jr.y))}var ju=class extends qn{constructor(e=new ca,t=new co({color:Math.random()*16777215})){super(e,t),this.type="LineSegments2"}computeLineDistances(){let e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let s=0,l=0,c=t.count;s<c;s++,l+=2)Z_.fromBufferAttribute(t,s),ey.fromBufferAttribute(i,s),r[l]=l===0?0:r[l-1],r[l+1]=r[l]+Z_.distanceTo(ey);let o=new Kc(r,2,1);return e.setAttribute("instanceDistanceStart",new dr(o,1,0)),e.setAttribute("instanceDistanceEnd",new dr(o,1,1)),this}raycast(e,t){e.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');let i=e.params.Line2!==void 0&&e.params.Line2.threshold||0,r=e.ray,o=e.camera,s=o.projectionMatrix,l=this.matrixWorld,c=this.geometry,u=this.material,p=u.resolution,d=u.linewidth+i,h=c.attributes.instanceStart,A=c.attributes.instanceEnd,g=-o.near;c.boundingSphere===null&&c.computeBoundingSphere(),ym.copy(c.boundingSphere).applyMatrix4(l);let F=Math.max(o.near,ym.distanceToPoint(r.origin)),b=ny(o,F,d,p);if(ym.radius+=b,e.ray.intersectsSphere(ym)===!1)return;c.boundingBox===null&&c.computeBoundingBox(),mo.copy(c.boundingBox).applyMatrix4(l);let R=Math.max(o.near,mo.distanceToPoint(r.origin)),P=ny(o,R,d,p);if(mo.max.x+=P,mo.max.y+=P,mo.max.z+=P,mo.min.x-=P,mo.min.y-=P,mo.min.z-=P,e.ray.intersectsBox(mo)!==!1){r.at(1,zr),zr.w=1,zr.applyMatrix4(o.matrixWorldInverse),zr.applyMatrix4(s),zr.multiplyScalar(1/zr.w),zr.x*=p.x/2,zr.y*=p.y/2,zr.z=0,qw.copy(zr),Yw.multiplyMatrices(o.matrixWorldInverse,l);for(let S=0,x=h.count;S<x;S++){$n.fromBufferAttribute(h,S),Jn.fromBufferAttribute(A,S),$n.w=1,Jn.w=1,$n.applyMatrix4(Yw),Jn.applyMatrix4(Yw);var L=$n.z>g&&Jn.z>g;if(L)continue;if($n.z>g){let X=$n.z-Jn.z,V=($n.z-g)/X;$n.lerp(Jn,V)}else if(Jn.z>g){let X=Jn.z-$n.z,V=(Jn.z-g)/X;Jn.lerp($n,V)}$n.applyMatrix4(s),Jn.applyMatrix4(s),$n.multiplyScalar(1/$n.w),Jn.multiplyScalar(1/Jn.w),$n.x*=p.x/2,$n.y*=p.y/2,Jn.x*=p.x/2,Jn.y*=p.y/2,Qi.start.copy($n),Qi.start.z=0,Qi.end.copy(Jn),Qi.end.z=0;let v=Qi.closestPointToPointParameter(qw,!0);Qi.at(v,ty);let M=Ed.lerp($n.z,Jn.z,v),O=M>=-1&&M<=1,B=qw.distanceTo(ty)<d*.5;if(O&&B){Qi.start.fromBufferAttribute(h,S),Qi.end.fromBufferAttribute(A,S),Qi.start.applyMatrix4(l),Qi.end.applyMatrix4(l);let X=new Se,V=new Se;r.distanceSqToSegment(Qi.start,Qi.end,V,X),t.push({point:V,pointOnLine:X,distance:r.origin.distanceTo(V),object:this,face:null,faceIndex:S,uv:null,uv2:null})}}}}};ju.prototype.isLineSegments2=!0;var ua=class extends ca{constructor(){super(),this.type="LineGeometry"}setPositions(e){for(var t=e.length-3,i=new Float32Array(2*t),r=0;r<t;r+=3)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];return super.setPositions(i),this}setColors(e){for(var t=e.length-3,i=new Float32Array(2*t),r=0;r<t;r+=3)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];return super.setColors(i),this}fromLine(e){var t=e.geometry;if(t.isGeometry){console.error("LineGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else t.isBufferGeometry&&this.setPositions(t.attributes.position.array);return this}};ua.prototype.isLineGeometry=!0;var Gu=class extends ju{constructor(e=new ua,t=new co({color:Math.random()*16777215})){super(e,t),this.type="Line2"}};Gu.prototype.isLine2=!0;var iy=new ua;iy.setPositions([0,0,0,0,0,-1]);var Xu=class extends pt{constructor(e,t,i){super(),this._length=1,this.line=new Gu(iy,rS({color:e,transparent:t<1,opacity:t,linewidth:i})),this.line.computeLineDistances(),De(this,this.line)}get length(){return this._length}set length(e){this._length=e,this.line.scale.set(1,1,e)}};var Tm=class extends Dl{constructor(e){super(),this.element=e,this._hidden=!1,this.visible=!0,this.style="default",document.addEventListener("pointerlockchange",()=>{this._hidden=!!document.pointerLockElement,this.refresh()})}get style(){return super.style}set style(e){super.style=e,this.refresh()}get visible(){return super.visible&&!this._hidden}set visible(e){super.visible=e,this.refresh()}refresh(){this.element.style.cursor=this.visible?this.style:"none"}};var Cl=class extends as{constructor(e){super(e),this.xr=e.cursor3D&&e.cursor3D.clone()||new la(this.env),this.system=new Tm(this.env.renderer.domElement),this.xr.side=this.side,this.visible=!1,Object.seal(this)}get object(){return this.xr.object}get side(){return this.xr.side}set side(e){this.xr.side=e}get cursor(){return this.xr}set cursor(e){this.xr=e,this._refresh()}get style(){return this.system.style}get visible(){return super.visible}set visible(e){super.visible=e,this._refresh()}set style(e){this.system.style=e,this.xr.style=e,this._refresh()}_refresh(){let e=this.env.eventSys&&this.env.eventSys.mouse&&this.env.eventSys.mouse.isPointerLocked,t=this.env.renderer.xr.isPresenting||e;nn(this.xr,this.visible&&t),this.system.visible=this.visible&&!t}lookAt(e,t){this.xr.lookAt(e,t)}};var Em=class extends ge{constructor(e,t){super(e),this.pointer=t,this._hit=null,this._point=null,this._distance=Number.POSITIVE_INFINITY,this._rayTarget=null,Object.seal(this)}set(e,t){e!==this.hit&&(this._hit=e,e?(this._point=e.point,this._distance=e.distance):(this._point=null,this._distance=Number.POSITIVE_INFINITY)),this._rayTarget=t}get hit(){return this._hit}get rayTarget(){return this._rayTarget}get point(){return this._point}get distance(){return this._distance}};var Ace=5,vce=new Se,fo=class extends Be{constructor(e,t,i,r){super(),this.type=e,this.id=t,this.env=i,this.origin=new Se,this.direction=new Se,this.up=new Se(0,1,0),this.canMoveView=!1,this.mayTeleport=!1,this.buttons=0,this._isActive=!1,this.moveDistance=0,this.pointerEvents=new Map,this.lastButtons=0,this.canClick=!1,this.dragDistance=0,this._enabled=!1,this._cursor=null,this._curHit=null,this._curTarget=null,this._hoveredHit=null,this._hoveredTarget=null,this._cursor=r,this.cursor&&(this.cursor.visible=!1)}get isActive(){return this._isActive}get canSend(){return this.enabled&&this.isActive}get curHit(){return this._curHit}get curTarget(){return this._curTarget}get hoveredHit(){return this._hoveredHit}set hoveredHit(e){if(e!==this.hoveredHit){let t=Wo(e);this._hoveredHit=e,this._hoveredTarget=t}}get name(){return Dn[this.id]}get rayTarget(){return this._hoveredTarget}get cursor(){return this._cursor}set cursor(e){if(e!==this.cursor){let t=this.cursor,i=this.cursor&&this.cursor.object&&this.cursor.object.name||"cursor",r=t&&t.object&&t.object.parent;r&&t.object.removeFromParent(),e&&(e.object.name=i,t instanceof Cl?(t.cursor=e,r&&De(r,t)):(this._cursor=e,t&&(r&&De(r,e),e.style=t.style,e.visible=t.visible)))}}get needsUpdate(){return this.enabled&&this._isActive}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.cursor&&(this.cursor.visible=e)}setButton(e,t){this.lastButtons=this.buttons;let i=1<<e;if(t?this.buttons|=i:this.buttons&=~i,t)this.canClick=!0,this.dragDistance=0,this.env.avatar.setMode(this),this.setEventState("down");else{if(this.canClick){let r=this.buttons;this.buttons=this.lastButtons,this.setEventState("click"),this.buttons=r}this.setEventState("up")}}isPressed(e){let t=1<<e;return(this.buttons&t)!==0}wasPressed(e){let t=1<<e;return(this.lastButtons&t)!==0}fireRay(e,t){let i=this.env.eventSys.fireRay(e,t);if(i!==this.curHit){let r=Wo(i);this._curHit=i,this._curTarget=r}}getEvent(e){this.pointerEvents.has(e)||this.pointerEvents.set(e,new Em(e,this));let t=this.pointerEvents.get(e);if(this.hoveredHit?t.set(this.hoveredHit,this.rayTarget):this.curHit?t.set(this.curHit,this.curTarget):t.set(null,null),t.hit){let i=this.curHit||this.hoveredHit;i&&t.hit!==i&&(t.hit.uv=i.uv)}return t}update(){this.needsUpdate&&this.onUpdate()}onUpdate(){this.updatePointerOrientation();let e=this.isPressed(tn.Primary);(this.moveDistance>0||e)&&(e&&(this.dragDistance+=this.moveDistance,this.dragDistance>Ace&&(this.canClick=!1)),this.setEventState("move")),this.moveDistance=0}setEventState(e){if(this.fireRay(this.origin,this.direction),this.curTarget===this.rayTarget)this.hoveredHit=this.curHit;else{let i=this.isPressed(tn.Primary),r=this.wasPressed(tn.Primary);if(e==="move"&&!i||e==="down"&&i&&!r||e==="up"&&!i&&r){if(this.rayTarget){let c=this.getEvent("up");this.rayTarget.dispatchEvent(c);let u=this.getEvent("exit");this.dispatchEvent(u),this.rayTarget.dispatchEvent(u)}if(this.hoveredHit=this.curHit,this.rayTarget){let c=this.getEvent("enter");this.dispatchEvent(c),this.rayTarget.dispatchEvent(c)}}this.hoveredHit&&this.hoveredHit.point.copy(this.direction).multiplyScalar(this.hoveredHit.distance).add(this.origin)}let t=this.getEvent(e);this.dispatchEvent(t),t.rayTarget&&(e!=="click"||t.rayTarget.clickable||t.rayTarget.navigable)&&(e==="click"&&t.rayTarget.clickable&&this.vibrate(),t.rayTarget.enabled&&t.rayTarget.dispatchEvent(t)),this.updateCursor(this.env.avatar.worldPos,vce,!0,2)}get canDragView(){return this.canMoveView}get canTeleport(){return this.mayTeleport}updateCursor(e,t,i,r){this.cursor&&this.cursor.update(e,t,this.hoveredHit||this.curHit,this.rayTarget||this.curTarget,r,i,this.canDragView,this.canTeleport,this.origin,this.direction,this.isPressed(tn.Primary))}get bufferSize(){return 37}writeState(e){e.writeUint8(this.id),e.writeVector48(this.origin),e.writeVector48(this.direction),e.writeVector48(this.up)}};var bce=.2,ULe=.5*bce-.025;var uPe={fontFamily:Fa(),fontSize:20,fontWeight:"bold",textFillColor:"white",textStrokeColor:"black",textStrokeSize:.01,padding:{top:.025,right:.05,bottom:.025,left:.05},maxHeight:.2};var Kw=["none","right","left"],zPe=vn(pn);function Qw(n,e){if(e===jb)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===Jc||e===Ld){let t=n.getIndex();if(t===null){let s=[],l=n.getAttribute("position");if(l!==void 0){for(let c=0;c<l.count;c++)s.push(c);n.setIndex(s),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}let i=t.count-2,r=[];if(e===Jc)for(let s=1;s<=i;s++)r.push(t.getX(0)),r.push(t.getX(s)),r.push(t.getX(s+1));else for(let s=0;s<i;s++)s%2===0?(r.push(t.getX(s)),r.push(t.getX(s+1)),r.push(t.getX(s+2))):(r.push(t.getX(s+2)),r.push(t.getX(s+1)),r.push(t.getX(s)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let o=n.clone();return o.setIndex(r),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}var us=class extends Eb{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new i1(t)}),this.register(function(t){return new u1(t)}),this.register(function(t){return new p1(t)}),this.register(function(t){return new d1(t)}),this.register(function(t){return new o1(t)}),this.register(function(t){return new s1(t)}),this.register(function(t){return new a1(t)}),this.register(function(t){return new l1(t)}),this.register(function(t){return new n1(t)}),this.register(function(t){return new c1(t)}),this.register(function(t){return new r1(t)}),this.register(function(t){return new e1(t)}),this.register(function(t){return new h1(t)}),this.register(function(t){return new m1(t)})}load(e,t,i,r){let o=this,s;this.resourcePath!==""?s=this.resourcePath:this.path!==""?s=this.path:s=yd.extractUrlBase(e),this.manager.itemStart(e);let l=function(u){r?r(u):console.error(u),o.manager.itemError(e),o.manager.itemEnd(e)},c=new Tx(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(u){try{o.parse(u,s,function(p){t(p),o.manager.itemEnd(e)},l)}catch(p){l(p)}},i,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r){let o,s={},l={},c=new TextDecoder;if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===ly){try{s[Ft.KHR_BINARY_GLTF]=new f1(e)}catch(d){r&&r(d);return}o=JSON.parse(s[Ft.KHR_BINARY_GLTF].content)}else o=JSON.parse(c.decode(e));else o=e;if(o.asset===void 0||o.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let u=new b1(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let p=0;p<this.pluginCallbacks.length;p++){let d=this.pluginCallbacks[p](u);l[d.name]=d,s[d.name]=!0}if(o.extensionsUsed)for(let p=0;p<o.extensionsUsed.length;++p){let d=o.extensionsUsed[p],h=o.extensionsRequired||[];switch(d){case Ft.KHR_MATERIALS_UNLIT:s[d]=new t1;break;case Ft.KHR_DRACO_MESH_COMPRESSION:s[d]=new g1(o,this.dracoLoader);break;case Ft.KHR_TEXTURE_TRANSFORM:s[d]=new x1;break;case Ft.KHR_MESH_QUANTIZATION:s[d]=new w1;break;default:h.indexOf(d)>=0&&l[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}u.setExtensions(s),u.setPlugins(l),u.parse(i,r)}parseAsync(e,t){let i=this;return new Promise(function(r,o){i.parse(e,t,r,o)})}};function _ce(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}var Ft={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"},e1=class{constructor(e){this.parser=e,this.name=Ft.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let i=0,r=t.length;i<r;i++){let o=t[i];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){let t=this.parser,i="light:"+e,r=t.cache.get(i);if(r)return r;let o=t.json,c=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e],u,p=new Sn(16777215);c.color!==void 0&&p.fromArray(c.color);let d=c.range!==void 0?c.range:0;switch(c.type){case"directional":u=new vd(p),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new Lb(p),u.distance=d;break;case"spot":u=new Hb(p),u.distance=d,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,u.angle=c.spot.outerConeAngle,u.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return u.position.set(0,0,0),u.decay=2,cs(u,c),c.intensity!==void 0&&(u.intensity=c.intensity),u.name=t.createUniqueName(c.name||"light_"+e),r=Promise.resolve(u),t.cache.add(i,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){let t=this,i=this.parser,o=i.json.nodes[e],l=(o.extensions&&o.extensions[this.name]||{}).light;return l===void 0?null:this._loadLight(l).then(function(c){return i._getNodeRef(t.cache,l,c)})}},t1=class{constructor(){this.name=Ft.KHR_MATERIALS_UNLIT}getMaterialType(){return Yn}extendParams(e,t,i){let r=[];e.color=new Sn(1,1,1),e.opacity=1;let o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){let s=o.baseColorFactor;e.color.fromArray(s),e.opacity=s[3]}o.baseColorTexture!==void 0&&r.push(i.assignTexture(e,"map",o.baseColorTexture,Xa))}return Promise.all(r)}},n1=class{constructor(e){this.parser=e,this.name=Ft.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let o=r.extensions[this.name].emissiveStrength;return o!==void 0&&(t.emissiveIntensity=o),Promise.resolve()}},i1=class{constructor(e){this.parser=e,this.name=Ft.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vo}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let o=[],s=r.extensions[this.name];if(s.clearcoatFactor!==void 0&&(t.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&o.push(i.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&o.push(i.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(o.push(i.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){let l=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ln(l,l)}return Promise.all(o)}},r1=class{constructor(e){this.parser=e,this.name=Ft.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vo}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let o=[],s=r.extensions[this.name];return s.iridescenceFactor!==void 0&&(t.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&o.push(i.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(t.iridescenceIOR=s.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&o.push(i.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(o)}},o1=class{constructor(e){this.parser=e,this.name=Ft.KHR_MATERIALS_SHEEN}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vo}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let o=[];t.sheenColor=new Sn(0,0,0),t.sheenRoughness=0,t.sheen=1;let s=r.extensions[this.name];return s.sheenColorFactor!==void 0&&t.sheenColor.fromArray(s.sheenColorFactor),s.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&o.push(i.assignTexture(t,"sheenColorMap",s.sheenColorTexture,Xa)),s.sheenRoughnessTexture!==void 0&&o.push(i.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(o)}},s1=class{constructor(e){this.parser=e,this.name=Ft.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vo}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let o=[],s=r.extensions[this.name];return s.transmissionFactor!==void 0&&(t.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&o.push(i.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(o)}},a1=class{constructor(e){this.parser=e,this.name=Ft.KHR_MATERIALS_VOLUME}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vo}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let o=[],s=r.extensions[this.name];t.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&o.push(i.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;let l=s.attenuationColor||[1,1,1];return t.attenuationColor=new Sn(l[0],l[1],l[2]),Promise.all(o)}},l1=class{constructor(e){this.parser=e,this.name=Ft.KHR_MATERIALS_IOR}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vo}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let o=r.extensions[this.name];return t.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}},c1=class{constructor(e){this.parser=e,this.name=Ft.KHR_MATERIALS_SPECULAR}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Vo}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let o=[],s=r.extensions[this.name];t.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&o.push(i.assignTexture(t,"specularIntensityMap",s.specularTexture));let l=s.specularColorFactor||[1,1,1];return t.specularColor=new Sn(l[0],l[1],l[2]),s.specularColorTexture!==void 0&&o.push(i.assignTexture(t,"specularColorMap",s.specularColorTexture,Xa)),Promise.all(o)}},u1=class{constructor(e){this.parser=e,this.name=Ft.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,i=t.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;let o=r.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,s)}},p1=class{constructor(e){this.parser=e,this.name=Ft.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,i=this.parser,r=i.json,o=r.textures[e];if(!o.extensions||!o.extensions[t])return null;let s=o.extensions[t],l=r.images[s.source],c=i.textureLoader;if(l.uri){let u=i.options.manager.getHandler(l.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return i.loadTextureImage(e,s.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},d1=class{constructor(e){this.parser=e,this.name=Ft.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let t=this.name,i=this.parser,r=i.json,o=r.textures[e];if(!o.extensions||!o.extensions[t])return null;let s=o.extensions[t],l=r.images[s.source],c=i.textureLoader;if(l.uri){let u=i.options.manager.getHandler(l.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return i.loadTextureImage(e,s.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},h1=class{constructor(e){this.name=Ft.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){let r=i.extensions[this.name],o=this.parser.getDependency("buffer",r.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(l){let c=r.byteOffset||0,u=r.byteLength||0,p=r.count,d=r.byteStride,h=new Uint8Array(l,c,u);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(p,d,h,r.mode,r.filter).then(function(A){return A.buffer}):s.ready.then(function(){let A=new ArrayBuffer(p*d);return s.decodeGltfBuffer(new Uint8Array(A),p,d,h,r.mode,r.filter),A})})}else return null}},m1=class{constructor(e){this.name=Ft.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){let t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;let r=t.meshes[i.mesh];for(let u of r.primitives)if(u.mode!==$i.TRIANGLES&&u.mode!==$i.TRIANGLE_STRIP&&u.mode!==$i.TRIANGLE_FAN&&u.mode!==void 0)return null;let s=i.extensions[this.name].attributes,l=[],c={};for(let u in s)l.push(this.parser.getDependency("accessor",s[u]).then(p=>(c[u]=p,c[u])));return l.length<1?null:(l.push(this.parser.createNodeMesh(e)),Promise.all(l).then(u=>{let p=u.pop(),d=p.isGroup?p.children:[p],h=u[0].count,A=[];for(let g of d){let F=new vt,b=new Se,R=new it,P=new Se(1,1,1),L=new _d(g.geometry,g.material,h);for(let S=0;S<h;S++)c.TRANSLATION&&b.fromBufferAttribute(c.TRANSLATION,S),c.ROTATION&&R.fromBufferAttribute(c.ROTATION,S),c.SCALE&&P.fromBufferAttribute(c.SCALE,S),L.setMatrixAt(S,F.compose(b,R,P));for(let S in c)S!=="TRANSLATION"&&S!=="ROTATION"&&S!=="SCALE"&&g.geometry.setAttribute(S,c[S]);pt.prototype.copy.call(L,g),this.parser.assignFinalMaterial(L),A.push(L)}return p.isGroup?(p.clear(),p.add(...A),p):A[0]}))}},ly="glTF",qu=12,ry={JSON:1313821514,BIN:5130562},f1=class{constructor(e){this.name=Ft.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,qu),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==ly)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-qu,o=new DataView(e,qu),s=0;for(;s<r;){let l=o.getUint32(s,!0);s+=4;let c=o.getUint32(s,!0);if(s+=4,c===ry.JSON){let u=new Uint8Array(e,qu+s,l);this.content=i.decode(u)}else if(c===ry.BIN){let u=qu+s;this.body=e.slice(u,u+l)}s+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},g1=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ft.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let i=this.json,r=this.dracoLoader,o=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,l={},c={},u={};for(let p in s){let d=A1[p]||p.toLowerCase();l[d]=s[p]}for(let p in e.attributes){let d=A1[p]||p.toLowerCase();if(s[p]!==void 0){let h=i.accessors[e.attributes[p]],A=Ll[h.componentType];u[d]=A.name,c[d]=h.normalized===!0}}return t.getDependency("bufferView",o).then(function(p){return new Promise(function(d){r.decodeDracoFile(p,function(h){for(let A in h.attributes){let g=h.attributes[A],F=c[A];F!==void 0&&(g.normalized=F)}d(h)},l,u)})})}},x1=class{constructor(){this.name=Ft.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},w1=class{constructor(){this.name=Ft.KHR_MESH_QUANTIZATION}},km=class extends Fb{constructor(e,t,i,r){super(e,t,i,r)}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,o=e*r*3+r;for(let s=0;s!==r;s++)t[s]=i[o+s];return t}interpolate_(e,t,i,r){let o=this.resultBuffer,s=this.sampleValues,l=this.valueSize,c=l*2,u=l*3,p=r-t,d=(i-t)/p,h=d*d,A=h*d,g=e*u,F=g-u,b=-2*A+3*h,R=A-h,P=1-b,L=R-h+d;for(let S=0;S!==l;S++){let x=s[F+S+l],v=s[F+S+c]*p,M=s[g+S+l],O=s[g+S]*p;o[S]=P*x+L*v+b*M+R*O}return o}},yce=new it,F1=class extends km{interpolate_(e,t,i,r){let o=super.interpolate_(e,t,i,r);return yce.fromArray(o).normalize().toArray(o),o}},$i={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ll={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},oy={9728:kd,9729:Qc,9984:Db,9985:Tb,9986:Mb,9987:Dx},sy={33071:cb,33648:kb,10497:Dd},$w={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},A1={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ls={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Tce={CUBICSPLINE:void 0,LINEAR:kx,STEP:Ab},Jw={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Ece(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new Lx({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Rs})),n.DefaultMaterial}function pa(n,e,t){for(let i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function cs(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function kce(n,e,t){let i=!1,r=!1,o=!1;for(let u=0,p=e.length;u<p;u++){let d=e[u];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(r=!0),d.COLOR_0!==void 0&&(o=!0),i&&r&&o)break}if(!i&&!r&&!o)return Promise.resolve(n);let s=[],l=[],c=[];for(let u=0,p=e.length;u<p;u++){let d=e[u];if(i){let h=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):n.attributes.position;s.push(h)}if(r){let h=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):n.attributes.normal;l.push(h)}if(o){let h=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):n.attributes.color;c.push(h)}}return Promise.all([Promise.all(s),Promise.all(l),Promise.all(c)]).then(function(u){let p=u[0],d=u[1],h=u[2];return i&&(n.morphAttributes.position=p),r&&(n.morphAttributes.normal=d),o&&(n.morphAttributes.color=h),n.morphTargetsRelative=!0,n})}function Mce(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){let t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,r=t.length;i<r;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Dce(n){let e,t=n.extensions&&n.extensions[Ft.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Zw(t.attributes):e=n.indices+":"+Zw(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,r=n.targets.length;i<r;i++)e+=":"+Zw(n.targets[i]);return e}function Zw(n){let e="",t=Object.keys(n).sort();for(let i=0,r=t.length;i<r;i++)e+=t[i]+":"+n[t[i]]+";";return e}function v1(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Cce(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}var Lce=new vt,b1=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new _ce,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=!1,o=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,o=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||r&&o<98?this.textureLoader=new zb(this.options.manager):this.textureLoader=new xb(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Tx(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let i=this,r=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(s){let l={scene:s[0][r.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:r.asset,parser:i,userData:{}};pa(o,l,r),cs(l,r),Promise.all(i._invokeAll(function(c){return c.afterRoot&&c.afterRoot(l)})).then(function(){e(l)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let r=0,o=t.length;r<o;r++){let s=t[r].joints;for(let l=0,c=s.length;l<c;l++)e[s[l]].isBone=!0}for(let r=0,o=e.length;r<o;r++){let s=e[r];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(i[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;let r=i.clone(),o=(s,l)=>{let c=this.associations.get(s);c!=null&&this.associations.set(l,c);for(let[u,p]of s.children.entries())o(p,l.children[u])};return o(i,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){let r=e(t[i]);if(r)return r}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let i=[];for(let r=0;r<t.length;r++){let o=e(t[r]);o&&i.push(o)}return i}getDependency(e,t){let i=e+":"+t,r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(o){return o.loadNode&&o.loadNode(t)});break;case"mesh":r=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(i,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){let i=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(o,s){return i.getDependency(e,s)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Ft.KHR_BINARY_GLTF].body);let r=this.options;return new Promise(function(o,s){i.load(yd.resolveURL(t.uri,r.path),o,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){let r=t.byteLength||0,o=t.byteOffset||0;return i.slice(o,o+r)})}loadAccessor(e){let t=this,i=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){let s=$w[r.type],l=Ll[r.componentType],c=r.normalized===!0,u=new l(r.count*s);return Promise.resolve(new lo(u,s,c))}let o=[];return r.bufferView!==void 0?o.push(this.getDependency("bufferView",r.bufferView)):o.push(null),r.sparse!==void 0&&(o.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(o).then(function(s){let l=s[0],c=$w[r.type],u=Ll[r.componentType],p=u.BYTES_PER_ELEMENT,d=p*c,h=r.byteOffset||0,A=r.bufferView!==void 0?i.bufferViews[r.bufferView].byteStride:void 0,g=r.normalized===!0,F,b;if(A&&A!==d){let R=Math.floor(h/A),P="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+R+":"+r.count,L=t.cache.get(P);L||(F=new u(l,R*A,r.count*A/p),L=new Ex(F,A/p),t.cache.add(P,L)),b=new dr(L,c,h%A/p,g)}else l===null?F=new u(r.count*c):F=new u(l,h,r.count*c),b=new lo(F,c,g);if(r.sparse!==void 0){let R=$w.SCALAR,P=Ll[r.sparse.indices.componentType],L=r.sparse.indices.byteOffset||0,S=r.sparse.values.byteOffset||0,x=new P(s[1],L,r.sparse.count*R),v=new u(s[2],S,r.sparse.count*c);l!==null&&(b=new lo(b.array.slice(),b.itemSize,b.normalized));for(let M=0,O=x.length;M<O;M++){let B=x[M];if(b.setX(B,v[M*c]),c>=2&&b.setY(B,v[M*c+1]),c>=3&&b.setZ(B,v[M*c+2]),c>=4&&b.setW(B,v[M*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return b})}loadTexture(e){let t=this.json,i=this.options,o=t.textures[e].source,s=t.images[o],l=this.textureLoader;if(s.uri){let c=i.manager.getHandler(s.uri);c!==null&&(l=c)}return this.loadTextureImage(e,o,l)}loadTextureImage(e,t,i){let r=this,o=this.json,s=o.textures[e],l=o.images[t],c=(l.uri||l.bufferView)+":"+s.sampler;if(this.textureCache[c])return this.textureCache[c];let u=this.loadImageSource(t,i).then(function(p){p.flipY=!1,p.name=s.name||l.name||"",p.name===""&&typeof l.uri=="string"&&l.uri.startsWith("data:image/")===!1&&(p.name=l.uri);let h=(o.samplers||{})[s.sampler]||{};return p.magFilter=oy[h.magFilter]||Qc,p.minFilter=oy[h.minFilter]||Dx,p.wrapS=sy[h.wrapS]||Dd,p.wrapT=sy[h.wrapT]||Dd,r.associations.set(p,{textures:e}),p}).catch(function(){return null});return this.textureCache[c]=u,u}loadImageSource(e,t){let i=this,r=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());let s=r.images[e],l=self.URL||self.webkitURL,c=s.uri||"",u=!1;if(s.bufferView!==void 0)c=i.getDependency("bufferView",s.bufferView).then(function(d){u=!0;let h=new Blob([d],{type:s.mimeType});return c=l.createObjectURL(h),c});else if(s.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let p=Promise.resolve(c).then(function(d){return new Promise(function(h,A){let g=h;t.isImageBitmapLoader===!0&&(g=function(F){let b=new Vs(F);b.needsUpdate=!0,h(b)}),t.load(yd.resolveURL(d,o.path),g,void 0,A)})}).then(function(d){return u===!0&&l.revokeObjectURL(c),d.userData.mimeType=s.mimeType||Cce(s.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),d});return this.sourceCache[e]=p,p}assignTexture(e,t,i,r){let o=this;return this.getDependency("texture",i.index).then(function(s){if(!s)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(s=s.clone(),s.channel=i.texCoord),o.extensions[Ft.KHR_TEXTURE_TRANSFORM]){let l=i.extensions!==void 0?i.extensions[Ft.KHR_TEXTURE_TRANSFORM]:void 0;if(l){let c=o.associations.get(s);s=o.extensions[Ft.KHR_TEXTURE_TRANSFORM].extendTexture(s,l),o.associations.set(s,c)}}return r!==void 0&&(s.colorSpace=r),e[t]=s,s})}assignFinalMaterial(e){let t=e.geometry,i=e.material,r=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,s=t.attributes.normal===void 0;if(e.isPoints){let l="PointsMaterial:"+i.uuid,c=this.cache.get(l);c||(c=new Rb,Td.prototype.copy.call(c,i),c.color.copy(i.color),c.map=i.map,c.sizeAttenuation=!1,this.cache.add(l,c)),i=c}else if(e.isLine){let l="LineBasicMaterial:"+i.uuid,c=this.cache.get(l);c||(c=new Mx,Td.prototype.copy.call(c,i),c.color.copy(i.color),c.map=i.map,this.cache.add(l,c)),i=c}if(r||o||s){let l="ClonedMaterial:"+i.uuid+":";r&&(l+="derivative-tangents:"),o&&(l+="vertex-colors:"),s&&(l+="flat-shading:");let c=this.cache.get(l);c||(c=i.clone(),o&&(c.vertexColors=!0),s&&(c.flatShading=!0),r&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(l,c),this.associations.set(c,this.associations.get(i))),i=c}e.material=i}getMaterialType(){return Lx}loadMaterial(e){let t=this,i=this.json,r=this.extensions,o=i.materials[e],s,l={},c=o.extensions||{},u=[];if(c[Ft.KHR_MATERIALS_UNLIT]){let d=r[Ft.KHR_MATERIALS_UNLIT];s=d.getMaterialType(),u.push(d.extendParams(l,o,t))}else{let d=o.pbrMetallicRoughness||{};if(l.color=new Sn(1,1,1),l.opacity=1,Array.isArray(d.baseColorFactor)){let h=d.baseColorFactor;l.color.fromArray(h),l.opacity=h[3]}d.baseColorTexture!==void 0&&u.push(t.assignTexture(l,"map",d.baseColorTexture,Xa)),l.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,l.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(l,"metalnessMap",d.metallicRoughnessTexture)),u.push(t.assignTexture(l,"roughnessMap",d.metallicRoughnessTexture))),s=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,l)})))}o.doubleSided===!0&&(l.side=bd);let p=o.alphaMode||Jw.OPAQUE;if(p===Jw.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,p===Jw.MASK&&(l.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&s!==Yn&&(u.push(t.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new ln(1,1),o.normalTexture.scale!==void 0)){let d=o.normalTexture.scale;l.normalScale.set(d,d)}return o.occlusionTexture!==void 0&&s!==Yn&&(u.push(t.assignTexture(l,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&s!==Yn&&(l.emissive=new Sn().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&s!==Yn&&u.push(t.assignTexture(l,"emissiveMap",o.emissiveTexture,Xa)),Promise.all(u).then(function(){let d=new s(l);return o.name&&(d.name=o.name),cs(d,o),t.associations.set(d,{materials:e}),o.extensions&&pa(r,d,o),d})}createUniqueName(e){let t=Ib.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){let t=this,i=this.extensions,r=this.primitiveCache;function o(l){return i[Ft.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,t).then(function(c){return ay(c,l,t)})}let s=[];for(let l=0,c=e.length;l<c;l++){let u=e[l],p=Dce(u),d=r[p];if(d)s.push(d.promise);else{let h;u.extensions&&u.extensions[Ft.KHR_DRACO_MESH_COMPRESSION]?h=o(u):h=ay(new Yc,u,t),r[p]={primitive:u,promise:h},s.push(h)}}return Promise.all(s)}loadMesh(e){let t=this,i=this.json,r=this.extensions,o=i.meshes[e],s=o.primitives,l=[];for(let c=0,u=s.length;c<u;c++){let p=s[c].material===void 0?Ece(this.cache):this.getDependency("material",s[c].material);l.push(p)}return l.push(t.loadGeometries(s)),Promise.all(l).then(function(c){let u=c.slice(0,c.length-1),p=c[c.length-1],d=[];for(let A=0,g=p.length;A<g;A++){let F=p[A],b=s[A],R,P=u[A];if(b.mode===$i.TRIANGLES||b.mode===$i.TRIANGLE_STRIP||b.mode===$i.TRIANGLE_FAN||b.mode===void 0)R=o.isSkinnedMesh===!0?new Wb(F,P):new qn(F,P),R.isSkinnedMesh===!0&&R.normalizeSkinWeights(),b.mode===$i.TRIANGLE_STRIP?R.geometry=Qw(R.geometry,Ld):b.mode===$i.TRIANGLE_FAN&&(R.geometry=Qw(R.geometry,Jc));else if(b.mode===$i.LINES)R=new _b(F,P);else if(b.mode===$i.LINE_STRIP)R=new vb(F,P);else if(b.mode===$i.LINE_LOOP)R=new Sb(F,P);else if(b.mode===$i.POINTS)R=new Pb(F,P);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+b.mode);Object.keys(R.geometry.morphAttributes).length>0&&Mce(R,o),R.name=t.createUniqueName(o.name||"mesh_"+e),cs(R,o),b.extensions&&pa(r,R,b),t.assignFinalMaterial(R),d.push(R)}for(let A=0,g=d.length;A<g;A++)t.associations.set(d[A],{meshes:e,primitives:A});if(d.length===1)return o.extensions&&pa(r,d[0],o),d[0];let h=new Ga;o.extensions&&pa(r,h,o),t.associations.set(h,{meshes:e});for(let A=0,g=d.length;A<g;A++)h.add(d[A]);return h})}loadCamera(e){let t,i=this.json.cameras[e],r=i[i.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new Bs(Ed.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):i.type==="orthographic"&&(t=new Md(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),cs(t,i),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],i=[];for(let r=0,o=t.joints.length;r<o;r++)i.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(r){let o=r.pop(),s=r,l=[],c=[];for(let u=0,p=s.length;u<p;u++){let d=s[u];if(d){l.push(d);let h=new vt;o!==null&&h.fromArray(o.array,u*16),c.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[u])}return new Nb(l,c)})}loadAnimation(e){let i=this.json.animations[e],r=i.name?i.name:"animation_"+e,o=[],s=[],l=[],c=[],u=[];for(let p=0,d=i.channels.length;p<d;p++){let h=i.channels[p],A=i.samplers[h.sampler],g=h.target,F=g.node,b=i.parameters!==void 0?i.parameters[A.input]:A.input,R=i.parameters!==void 0?i.parameters[A.output]:A.output;g.node!==void 0&&(o.push(this.getDependency("node",F)),s.push(this.getDependency("accessor",b)),l.push(this.getDependency("accessor",R)),c.push(A),u.push(g))}return Promise.all([Promise.all(o),Promise.all(s),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(p){let d=p[0],h=p[1],A=p[2],g=p[3],F=p[4],b=[];for(let R=0,P=d.length;R<P;R++){let L=d[R],S=h[R],x=A[R],v=g[R],M=F[R];if(L===void 0)continue;L.updateMatrix();let O;switch(ls[M.path]){case ls.weights:O=Cb;break;case ls.rotation:O=Px;break;case ls.position:case ls.scale:default:O=Gb;break}let B=L.name?L.name:L.uuid,X=v.interpolation!==void 0?Tce[v.interpolation]:kx,V=[];ls[M.path]===ls.weights?L.traverse(function(ce){ce.morphTargetInfluences&&V.push(ce.name?ce.name:ce.uuid)}):V.push(B);let J=x.array;if(x.normalized){let ce=v1(J.constructor),G=new Float32Array(J.length);for(let Y=0,K=J.length;Y<K;Y++)G[Y]=J[Y]*ce;J=G}for(let ce=0,G=V.length;ce<G;ce++){let Y=new O(V[ce]+"."+ls[M.path],S.array,J,X);v.interpolation==="CUBICSPLINE"&&(Y.createInterpolant=function(se){let $=this instanceof Px?F1:km;return new $(this.times,this.values,this.getValueSize()/3,se)},Y.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),b.push(Y)}}return new ob(r,void 0,b)})}createNodeMesh(e){let t=this.json,i=this,r=t.nodes[e];return r.mesh===void 0?null:i.getDependency("mesh",r.mesh).then(function(o){let s=i._getNodeRef(i.meshCache,r.mesh,o);return r.weights!==void 0&&s.traverse(function(l){if(l.isMesh)for(let c=0,u=r.weights.length;c<u;c++)l.morphTargetInfluences[c]=r.weights[c]}),s})}loadNode(e){let t=this.json,i=this,r=t.nodes[e],o=i._loadNodeShallow(e),s=[],l=r.children||[];for(let u=0,p=l.length;u<p;u++)s.push(i.getDependency("node",l[u]));let c=r.skin===void 0?Promise.resolve(null):i.getDependency("skin",r.skin);return Promise.all([o,Promise.all(s),c]).then(function(u){let p=u[0],d=u[1],h=u[2];h!==null&&p.traverse(function(A){A.isSkinnedMesh&&A.bind(h,Lce)});for(let A=0,g=d.length;A<g;A++)p.add(d[A]);return p})}_loadNodeShallow(e){let t=this.json,i=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];let o=t.nodes[e],s=o.name?r.createUniqueName(o.name):"",l=[],c=r._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return c&&l.push(c),o.camera!==void 0&&l.push(r.getDependency("camera",o.camera).then(function(u){return r._getNodeRef(r.cameraCache,o.camera,u)})),r._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){l.push(u)}),this.nodeCache[e]=Promise.all(l).then(function(u){let p;if(o.isBone===!0?p=new ab:u.length>1?p=new Ga:u.length===1?p=u[0]:p=new pt,p!==u[0])for(let d=0,h=u.length;d<h;d++)p.add(u[d]);if(o.name&&(p.userData.name=o.name,p.name=s),cs(p,o),o.extensions&&pa(i,p,o),o.matrix!==void 0){let d=new vt;d.fromArray(o.matrix),p.applyMatrix4(d)}else o.translation!==void 0&&p.position.fromArray(o.translation),o.rotation!==void 0&&p.quaternion.fromArray(o.rotation),o.scale!==void 0&&p.scale.fromArray(o.scale);return r.associations.has(p)||r.associations.set(p,{}),r.associations.get(p).nodes=e,p}),this.nodeCache[e]}loadScene(e){let t=this.extensions,i=this.json.scenes[e],r=this,o=new Ga;i.name&&(o.name=r.createUniqueName(i.name)),cs(o,i),i.extensions&&pa(t,o,i);let s=i.nodes||[],l=[];for(let c=0,u=s.length;c<u;c++)l.push(r.getDependency("node",s[c]));return Promise.all(l).then(function(c){for(let p=0,d=c.length;p<d;p++)o.add(c[p]);let u=p=>{let d=new Map;for(let[h,A]of r.associations)(h instanceof Td||h instanceof Vs)&&d.set(h,A);return p.traverse(h=>{let A=r.associations.get(h);A!=null&&d.set(h,A)}),d};return r.associations=u(o),o})}};function Pce(n,e,t){let i=e.attributes,r=new Ps;if(i.POSITION!==void 0){let l=t.json.accessors[i.POSITION],c=l.min,u=l.max;if(c!==void 0&&u!==void 0){if(r.set(new Se(c[0],c[1],c[2]),new Se(u[0],u[1],u[2])),l.normalized){let p=v1(Ll[l.componentType]);r.min.multiplyScalar(p),r.max.multiplyScalar(p)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let o=e.targets;if(o!==void 0){let l=new Se,c=new Se;for(let u=0,p=o.length;u<p;u++){let d=o[u];if(d.POSITION!==void 0){let h=t.json.accessors[d.POSITION],A=h.min,g=h.max;if(A!==void 0&&g!==void 0){if(c.setX(Math.max(Math.abs(A[0]),Math.abs(g[0]))),c.setY(Math.max(Math.abs(A[1]),Math.abs(g[1]))),c.setZ(Math.max(Math.abs(A[2]),Math.abs(g[2]))),h.normalized){let F=v1(Ll[h.componentType]);c.multiplyScalar(F)}l.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(l)}n.boundingBox=r;let s=new qa;r.getCenter(s.center),s.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=s}function ay(n,e,t){let i=e.attributes,r=[];function o(s,l){return t.getDependency("accessor",s).then(function(c){n.setAttribute(l,c)})}for(let s in i){let l=A1[s]||s.toLowerCase();l in n.attributes||r.push(o(i[s],l))}if(e.indices!==void 0&&!n.index){let s=t.getDependency("accessor",e.indices).then(function(l){n.setIndex(l)});r.push(s)}return cs(n,e),Pce(n,e,t),Promise.all(r).then(function(){return e.targets!==void 0?kce(n,e.targets,t):n})}var fn={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function cy(n){let e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function Rce(n){if(!n)throw new Error("No basePath supplied");return await cy(`${n}/profilesList.json`)}async function uy(n,e,t=null,i=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");let r=await Rce(e),o;if(n.profiles.some(c=>{let u=r[c];return u&&(o={profileId:c,profilePath:`${e}/${u.path}`,deprecated:!!u.deprecated}),!!o}),!o){if(!t)throw new Error("No matching profile name found");let c=r[t];if(!c)throw new Error(`No matching profile name found and default profile "${t}" missing.`);o={profileId:t,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}}let s=await cy(o.profilePath),l;if(i){let c;if(n.handedness==="any"?c=s.layouts[Object.keys(s.layouts)[0]]:c=s.layouts[n.handedness],!c)throw new Error(`No matching handedness, ${n.handedness}, in profile ${o.profileId}`);c.assetPath&&(l=o.profilePath.replace("profile.json",c.assetPath))}return{profile:s,assetPath:l}}var Ice={xAxis:0,yAxis:0,button:0,state:fn.ComponentState.DEFAULT};function Bce(n=0,e=0){let t=n,i=e;if(Math.sqrt(n*n+e*e)>1){let s=Math.atan2(e,n);t=Math.cos(s),i=Math.sin(s)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:i*.5+.5}}var S1=class{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===fn.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(Ice)}updateFromComponent({xAxis:e,yAxis:t,button:i,state:r}){let{normalizedXAxis:o,normalizedYAxis:s}=Bce(e,t);switch(this.componentProperty){case fn.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?o:.5;break;case fn.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?s:.5;break;case fn.ComponentProperty.BUTTON:this.value=this.states.includes(r)?i:0;break;case fn.ComponentProperty.STATE:this.valueNodeProperty===fn.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},_1=class{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(i=>{let r=new S1(t.visualResponses[i]);this.visualResponses[i]=r}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:fn.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=fn.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){let t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=fn.ComponentState.PRESSED:(t.touched||this.values.button>fn.ButtonTouchThreshold)&&(this.values.state=fn.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===fn.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>fn.AxisTouchThreshold&&(this.values.state=fn.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===fn.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>fn.AxisTouchThreshold&&(this.values.state=fn.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}},Mm=class{constructor(e,t,i){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=i,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(r=>{let o=this.layoutDescription.components[r];this.components[r]=new _1(r,o)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}};var Vce="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Oce="generic-trigger",y1=class extends pt{constructor(){super(...arguments),this.envMap=null,this.motionController=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{Kn(t)&&(nu(t.material)||iu(t.material)||ru(t.material))&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(i=>{let{valueNode:r,minNode:o,maxNode:s}=i;r&&(Nce(i)?r.visible=i.value:Wce(i)&&(r.quaternion.slerpQuaternions(o.quaternion,s.quaternion,i.value),r.position.lerpVectors(o.position,s.position,i.value)))})}))}};function dy(n,e){return n&&n.valueNodeProperty===e}function Nce(n){return dy(n,"visibility")}function Wce(n){return dy(n,"transform")}function Hce(n,e){Object.values(n.components).forEach(t=>{let{type:i,touchPointNodeName:r,visualResponses:o}=t;if(i===fn.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(r),t.touchPointNode){let s=new Ya(.001),l=new Yn({color:255}),c=new qn(s,l);t.touchPointNode.add(c)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(o).forEach(s=>{let{valueNodeName:l,minNodeName:c,maxNodeName:u,valueNodeProperty:p}=s;if(p===fn.VisualResponseProperty.TRANSFORM){if(s.minNode=e.getObjectByName(c),s.maxNode=e.getObjectByName(u),!s.minNode){console.warn(`Could not find ${c} in the model`);return}if(!s.maxNode){console.warn(`Could not find ${u} in the model`);return}}s.valueNode=e.getObjectByName(l),s.valueNode||console.warn(`Could not find ${l} in the model`)})})}function py(n,e){Hce(n.motionController,e),n.envMap&&e.traverse(t=>{Kn(t)&&(nu(t.material)||iu(t.material)||ru(t.material))&&(t.material.envMap=n.envMap,t.material.needsUpdate=!0)}),n.add(e)}var Dm=class{constructor(e=null){this.gltfLoader=e||new us,this.path=Vce,this._assetCache={}}createControllerModel(e,t=null){let i=new y1,r=null;return e.addEventListener("connected",async o=>{let s=o.data;if(!(s.targetRayMode!=="tracked-pointer"||!s.gamepad))try{let{profile:l,assetPath:c}=await uy(s,this.path,t||Oce);i.motionController=new Mm(s,l,c);let u=this._assetCache[i.motionController.assetUrl];if(u)r=u.scene.clone(),py(i,r);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(i.motionController.assetUrl,p=>{this._assetCache[i.motionController.assetUrl]=p,r=p.scene.clone(),py(i,r)},null,()=>{throw new Error(`Asset ${i.motionController.assetUrl} missing or malformed.`)})}}catch(l){console.warn(l)}}),e.addEventListener("disconnected",()=>{ut(i.motionController),i.motionController=null,ut(r),r=null}),i}};var Uce=new Dm,zce=new vt().makeRotationX(-7*en/9),hy=new vt,my=new Map([["none",Dn.MotionController],["left",Dn.MotionControllerLeft],["right",Dn.MotionControllerRight]]),Cm;(function(n){n[n.Trigger=0]="Trigger",n[n.Grip=1]="Grip",n[n.Stick=3]="Stick",n[n.X_A=4]="X_A",n[n.Y_B=5]="Y_B"})(Cm||(Cm={}));var fy=new Map([[Cm.Y_B,tn.Menu],[Cm.X_A,tn.Info]]),Lm=class extends fo{constructor(e,t){if(super("hand",Dn.MotionController,e,new la(e)),this.laser=new Xu(Hd,.75,.002),this._isHand=!1,this.inputSource=null,this._gamepad=new bm,this.delta=new Se,this.newOrigin=new Se,this.quaternion=new it,this.newQuat=new it,this.useHaptics=!0,this.mayTeleport=!0,this.object=ft("PointerHand"+t),this.quaternion.identity(),De(this,De(this.controller=this.env.renderer.xr.getController(t),this.laser),De(this.grip=this.env.renderer.xr.getControllerGrip(t),this.gripModel=Uce.createControllerModel(this.controller)),De(this.hand=this.env.renderer.xr.getHand(t),this.handModel=this.env.handModelFactory.createHandModel(this.hand))),Wa()&&bA()&&!ro){let o=!1;this.controller.traverse(s=>{s.name.toLocaleLowerCase().indexOf("oculus")>=0&&(o=!0)}),o&&this.laser.matrix.copy(zce)}this.gamepad.addEventListener("gamepadaxismaxed",o=>{o.axis===2&&this.env.avatar.snapTurn(o.value)});let i=o=>s=>{fy.has(s.button)&&this.setButton(fy.get(s.button),o)};this.gamepad.addEventListener("gamepadbuttondown",i(!0)),this.gamepad.addEventListener("gamepadbuttonup",i(!1));let r=(o,s)=>()=>this.setButton(o,s);this.controller.addEventListener("selectstart",r(tn.Primary,!0)),this.controller.addEventListener("selectend",r(tn.Primary,!1)),this.controller.addEventListener("squeezestart",r(tn.Secondary,!0)),this.controller.addEventListener("squeezeend",r(tn.Secondary,!1)),this.controller.addEventListener("connected",o=>{o.target===this.controller&&(this.inputSource=o.data,this.gamepad.pad=this.inputSource.gamepad,this._isHand=y(this.inputSource.hand),this.id=my.get(this.handedness),this.grip.visible=!this.isHand,this.controller.visible=!this.isHand,this.hand.visible=this.isHand,this.enabled=!0,this._isActive=!0,this.env.eventSys.checkXRMouse(),this.updateCursorSide())}),this.controller.addEventListener("disconnected",o=>{o.target===this.controller&&(this.inputSource=null,this.gamepad.pad=null,this._isHand=!1,this.id=my.get(this.handedness),this.grip.visible=!1,this.controller.visible=!1,this.hand.visible=!1,this.enabled=!1,this._isActive=!1,this.env.eventSys.checkXRMouse(),this.updateCursorSide())}),Object.seal(this)}vibrate(){this._vibrate()}async _vibrate(){if(this.useHaptics&&this.gamepad.hapticActuators)try{await Promise.all(this.gamepad.hapticActuators.map(e=>e.pulse(.25,125)))}catch{this.useHaptics=!1}}get gamepad(){return this._gamepad}get handedness(){return oe(this.inputSource)?null:this.inputSource.handedness}get isHand(){return this._isHand}get cursor(){return super.cursor}set cursor(e){super.cursor=e,this.updateCursorSide()}updateCursorSide(){this.cursor.side=this.handedness==="left"?1:-1}updatePointerOrientation(){this.laser.getWorldPosition(this.newOrigin),this.laser.getWorldQuaternion(this.newQuat),this.origin.lerp(this.newOrigin,.9),this.quaternion.slerp(this.newQuat,.9),this.delta.copy(this.origin).add(this.direction),this.direction.set(0,0,-1).applyQuaternion(this.quaternion),this.up.set(0,1,0).applyQuaternion(this.quaternion),this.delta.sub(this.direction).sub(this.origin),this.moveDistance+=50*this.delta.length()}onUpdate(){this.gamepad.pad=this.inputSource&&this.inputSource.gamepad||null,super.onUpdate()}get bufferSize(){return super.bufferSize+2+this.handModel.count*64}writeState(e){if(super.writeState(e),e.writeEnum8(this.handedness,Kw),e.writeUint8(this.handModel.count),this.handModel.isTracking)for(let t=0;t<this.handModel.count;++t)this.handModel.getMatrixAt(t,hy),e.writeMatrix512(hy)}};var Pl=class extends fo{constructor(e,t,i,r){super(e,t,i,r),this.position=new ln,this.motion=new ln,this.uv=new ln,this.duv=new ln,this.uvComp=new ln(1,-1),this.uvOff=new ln(-1,1),this.canMoveView=!0;let o=s=>{this._isActive=this.onCheckEvent(s),this._isActive&&this.onReadEvent(s)};this.element=this.env.renderer.domElement,this.element.addEventListener("pointerdown",o),this.element.addEventListener("pointermove",o),this.element.addEventListener("pointerup",o),this.element.addEventListener("pointercancel",o)}onCheckEvent(e){return e.pointerType===this.type}onReadEvent(e){this.updatePointerOrientation()}updatePointerOrientation(){this.element.clientWidth>0&&this.element.clientHeight>0&&(this.uv.copy(this.position),this.uv.x/=this.element.clientWidth,this.uv.y/=this.element.clientHeight,this.uv.multiplyScalar(2).multiply(this.uvComp).add(this.uvOff),this.duv.copy(this.motion),this.duv.x/=this.element.clientWidth,this.duv.y/=this.element.clientHeight,this.duv.multiplyScalar(2).multiply(this.uvComp),this.moveDistance=200*this.duv.length());let e=Xs(this.env.renderer,this.env.camera);this.origin.setFromMatrixPosition(e.matrixWorld),this.direction.set(this.uv.x,this.uv.y,.5).unproject(e).sub(this.origin).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat)}onUpdate(){this.env.avatar.onMove(this,this.uv,this.duv),super.onUpdate(),this.motion.setScalar(0),this.duv.setScalar(0)}};var Rl=class extends Pl{constructor(e,t,i){let r=l=>{l.pointerType===e&&this.pointerID==null&&(this.pointerID=l.pointerId)},o=l=>{l.pointerType===e&&this.pointerID!=null&&(this.pointerID=null)},s=i.renderer.domElement;s.addEventListener("pointerdown",r),s.addEventListener("pointermove",r),super(e,t,i,new Cl(i)),this.pointerID=null,this.lastX=null,this.lastY=null,s.addEventListener("pointerup",o),s.addEventListener("pointercancel",o)}onCheckEvent(e){return super.onCheckEvent(e)&&e.pointerId===this.pointerID}onReadEvent(e){this.position.set(e.offsetX,e.offsetY),e.type==="pointerdown"?this.motion.setScalar(0):(this.motion.x+=e.offsetX-this.lastX,this.motion.y+=e.offsetY-this.lastY),this.lastX=e.offsetX,this.lastY=e.offsetY,super.onReadEvent(e),(e.type==="pointerdown"||e.type==="pointerup"||e.type==="pointercancel")&&this.setButton(e.button,e.type==="pointerdown")}};var Pm=class extends Rl{constructor(e){super("mouse",Dn.Mouse,e),this.allowPointerLock=!1,this.dz=0,this.keyMap=new Map([["`",tn.Info],["ContextMenu",tn.Menu]]),this.element.addEventListener("wheel",t=>{t.preventDefault(),this.dz+=-t.deltaY*.1},{passive:!1}),this.element.addEventListener("contextmenu",t=>{t.preventDefault()}),this.element.addEventListener("pointerdown",t=>{this.onCheckEvent(t)&&(this.allowPointerLock&&!this.isPointerLocked?this.lockPointer():!this.allowPointerLock&&!this.isPointerCaptured&&this.capturePointer())}),this.element.addEventListener("pointerup",t=>{this.onCheckEvent(t)&&(this.allowPointerLock&&this.isPointerLocked?this.unlockPointer():!this.allowPointerLock&&this.isPointerCaptured&&this.releaseCapture())},!0),document.addEventListener("pointerlockchange",()=>{this.cursor.visible=!0}),window.addEventListener("keydown",t=>{this._isActive&&this.keyMap.has(t.key)&&this.setButton(this.keyMap.get(t.key),ao(t))}),window.addEventListener("keyup",t=>{this.keyMap.has(t.key)&&this.setButton(this.keyMap.get(t.key),!1)}),this.mayTeleport=!0,Object.seal(this)}updatePointerOrientation(){this.isPointerLocked&&this.position.set(this.env.renderer.domElement.clientWidth,this.env.renderer.domElement.clientHeight).multiplyScalar(.5),super.updatePointerOrientation()}onUpdate(){super.onUpdate(),this.env.avatar.zoom(this.dz),this.dz=0}get isPointerLocked(){return document.pointerLockElement!=null}get isPointerCaptured(){return this.element.hasPointerCapture(this.pointerID)}get canDragView(){return super.canDragView&&!this.isPointerLocked}get canTeleport(){return super.canTeleport&&this.isPointerLocked}lockPointer(){this.element.requestPointerLock()}unlockPointer(){document.exitPointerLock()}capturePointer(){this.element.setPointerCapture(this.pointerID)}releaseCapture(){this.element.releasePointerCapture(this.pointerID)}vibrate(){}};var Rm=class extends fo{constructor(e){super("nose",Dn.Nose,e,null),this.point=new Se,this.lastPoint=new Se,this.mayTeleport=!1,this.enabled=!0,this._isActive=!0,this.updatePointerOrientation(),this.moveDistance=0,Object.seal(this)}vibrate(){}get canSend(){return!1}updatePointerOrientation(){let e=this.env.camera;e.getWorldPosition(this.origin),e.getWorldDirection(this.direction),this.up.copy(e.up),this.point.copy(this.direction).add(this.origin),this.moveDistance=this.point.distanceTo(this.lastPoint),this.lastPoint.copy(this.point)}};var Im=class extends Rl{constructor(e){super("pen",Dn.Pen,e),Object.seal(this)}vibrate(){}};function jce(n){return n.pointerId}var Bm=class extends Pl{constructor(e){super("touch",Dn.Touch,e,null),this.dz=0,this.lastZ=0,this.points=new Array,this.lastXs=new Map,this.lastYs=new Map,this._canVibrate=null,Object.seal(this)}get enabled(){return super.enabled}set enabled(e){super.enabled=e,qe(this.points)}onReadEvent(e){eF(this.points,e.pointerId,jce);let t=e.type==="pointerdown"||e.type==="pointermove";if(t&&this.points.push(e),this.points.length===2){let r=this.points[0],o=this.points[1],s=o.offsetX-r.offsetX,l=o.offsetY-r.offsetY,c=5*Math.sqrt(s*s+l*l),u=c-this.lastZ;e.type==="pointermove"&&(this.dz+=u),this.lastZ=c}let i=1/this.points.length;if(t){this.position.setScalar(0);for(let r of this.points)if(this.position.x+=i*r.offsetX,this.position.y+=i*r.offsetY,this.lastXs.has(r.pointerId)){let o=this.lastXs.get(r.pointerId),s=this.lastYs.get(r.pointerId),l=r.offsetX-o,c=r.offsetY-s;this.motion.x+=i*l,this.motion.y+=i*c}}if(t?(this.lastXs.set(e.pointerId,e.offsetX),this.lastYs.set(e.pointerId,e.offsetY)):(this.lastXs.delete(e.pointerId),this.lastYs.delete(e.pointerId)),super.onReadEvent(e),e.type!=="pointermove"){let r=0;for(let o=0;o<this.points.length;++o){let s=this.points[o],l=1<<o;s.buttons!==0?r|=l:r&=~l}for(let o=0;o<10;++o){let s=this.isPressed(o),l=1<<o,c=(r&l)!==0;c!==s&&this.setButton(o,c)}e.type==="pointerup"&&setTimeout(()=>this._isActive=!1,10)}}onUpdate(){this.env.avatar.zoom(this.dz),super.onUpdate(),this.dz=0}get canVibrate(){return this._canVibrate===null&&(this._canVibrate="vibrate"in navigator&&Ke(navigator.vibrate)),this._canVibrate}vibrate(){this.canVibrate&&navigator.vibrate(125)}};var Gce=(n,e)=>n.distance-e.distance,Vm=class extends Be{set sortFunction(e){this.customSortFunction=e}get sortFunction(){return this.customSortFunction||Gce}constructor(e){super(),this.env=e,this.raycaster=new Vb,this.hands=new Array,this.hits=new Array,this.queue=new Array,this.targetsFound=new Set,this.targets=new Array,this.customSortFunction=null,this.raycaster.camera=this.env.camera,this.raycaster.layers.set(Jh),this.mouse=new Pm(this.env),this.pen=new Im(this.env),this.touches=new Bm(this.env),this.nose=new Rm(this.env);for(let t=0;t<2;++t)this.hands[t]=new Lm(this.env,t);this.pointers=[this.mouse,this.pen,this.touches,this.nose,...this.hands];for(let t of this.pointers)t.addBubbler(this),t.cursor&&De(this.env.stage,t.cursor);this.checkXRMouse(),Object.seal(this)}checkXRMouse(){let e=0;for(let i of this.hands.values())i.enabled&&++e;let t=e===0;this.mouse.enabled=t,this.pen.enabled=t,this.touches.enabled=t}refreshCursors(){for(let e of this.pointers)e.cursor&&(e.cursor=this.env.cursor3D.clone())}fireRay(e,t){return qe(this.hits),this.raycaster.ray.origin.copy(e),this.raycaster.ray.direction.copy(t),this.raycaster.intersectObjects(this.targets,!1,this.hits),this.hits.sort(this.sortFunction),this.hits[0]||null}update(){for(this.targetsFound.clear(),qe(this.targets),this.queue.push(this.env.scene);this.queue.length>0;){let e=this.queue.shift();e.children.length>0&&this.queue.push(...e.children);let t=Wo(e);t&&!this.targetsFound.has(t)&&(this.targetsFound.add(t),this.targets.push(...t.meshes))}for(let e of this.pointers)e.update()}};var Om=class n extends as{constructor(e,t){super(e),this.cursorSystem=null,this.object=ft("Cursor3D"),this.cursorSystem=t,this.object.matrixAutoUpdate=!1}add(e,t){De(this,t),w_(t,_l),t.visible=e==="default"}get style(){for(let e of this.object.children)if(e.visible)return e.name;return null}set style(e){for(let t of this.object.children)t.visible=t.name===e;if(this.style==null&&this.object.children.length>0){let t=Rn(this.object.children,i=>i.name==="default",i=>i!=null);t!=null&&(t.visible=!0)}this.cursorSystem&&(this.cursorSystem.style="none")}get visible(){return Ka(this)}set visible(e){nn(this,e)}clone(){let e=new n(this.env);for(let t of this.object.children)e.add(t.name,t.clone());return e}};var T1=new it().identity(),gy=new it().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(T1.setFromAxisAngle(new Se(0,1,0),Math.PI/2),gy.setFromAxisAngle(new Se(1,0,0),Math.PI).premultiply(T1));var Xce="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/",Nm=class extends pt{constructor(e,t,i){super(),this.controller=e,this.handedness=t,this.bones=new Map,this.root=null,this.instanceMatrix={needsUpdate:!1},this.oculusBrowserV14Correction=this.handedness==="left"?gy:T1;let r=new us;r.setPath(Xce),r.load(`${this.handedness}.glb`,o=>{this.root=o.scene.children[0],this.add(this.root);let s=this.root.getObjectByProperty("type","SkinnedMesh");s.frustumCulled=!1,s.castShadow=!0,s.receiveShadow=!0,ru(s.material)?s.material=sS(s.material):nu(s.material)&&(s.material=Ws(s.material)),iu(s.material)&&(s.material.color=i,s.material.shininess=.1),ps.forEach(l=>this.addBone(l))})}addBone(e){if(this.root){let t=this.root.getObjectByName(e);t&&this.bones.set(e,t)}}get count(){return this.bones.size}set count(e){}getMatrixAt(e,t){if(0<=e&&e<ps.length){let i=ps[e];this.bones.has(i)&&t.copy(this.bones.get(i).matrix)}}setMatrixAt(e,t){if(0<=e&&e<ps.length){let i=ps[e];if(this.bones.has(i)){let r=this.bones.get(i);r.matrix.copy(t),r.matrix.decompose(r.position,r.quaternion,r.scale)}}}updateMesh(){if(this.controller)for(let[e,t]of this.bones){let i=this.controller.joints[e];i&&i.visible&&(t.position.copy(i.position),t.quaternion.copy(i.quaternion).multiply(this.oculusBrowserV14Correction))}}};var qce=.008,E1=new vt,xy=new Se,wy=new vt().identity(),Fy=new vt().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(wy.makeRotationY(Math.PI/2),Fy.makeRotationY(-Math.PI/2));var Wm=class extends _d{constructor(e,t,i,r){let o;r==="boxes"?o=new Ad(1,1,1):r==="bones"?o=new hb(.5,.75,2.25,10,1).rotateX(-Math.PI/2):o=new Ya(1,10,10);let s=new Is({color:i,shininess:.1});super(o,s,30),this.controller=e,this.instanceMatrix.setUsage(mb),this.castShadow=!0,this.receiveShadow=!0,this.oculusBrowserV14Correction=t==="left"?Fy:wy}updateMesh(){if(this.controller){let e=0;for(let t of ps){let i=this.controller.joints[t];i&&i.visible&&(xy.setScalar(i.jointRadius||qce),E1.compose(i.position,i.quaternion,xy),E1.multiply(this.oculusBrowserV14Correction),this.setMatrixAt(e,E1),e++)}this.count=e}this.instanceMatrix.needsUpdate=!0}};var ps=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],k1=class extends pt{get isTracking(){return!!this.impl}constructor(e,t,i){super(),this.controllerOrHandedness=e,this.color=t,this.profile=i,this.impl=null;let r=null,o=null;Ve(e)?o=e:r=e;let s=()=>this.add(this.impl=this.createModel(r,o));r?(r.addEventListener("connected",l=>{let c=l.data;c.hand&&!this.impl&&(o=c.handedness,s())}),r.addEventListener("disconnected",()=>{let l=this.impl;this.impl=null,o=null,l.removeFromParent(),ut(l)})):o&&s()}createModel(e,t){return this.profile==="mesh"?new Nm(e,t,this.color):new Wm(e,t,this.color,this.profile)}get count(){return this.impl?this.impl.count:0}set count(e){this.impl&&(this.impl.count=e)}getMatrixAt(e,t){this.impl&&this.impl.getMatrixAt(e,t)}setMatrixAt(e,t){this.impl&&this.impl.setMatrixAt(e,t)}updateMesh(){this.impl&&this.impl.updateMesh()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.impl&&this.impl.updateMesh()}},Hm=class{constructor(e,t){this.color=e,this.profile=t}createHandModel(e){return new k1(e,this.color,this.profile)}};var M1=class extends du{constructor(){super(),this.frame=null,Object.seal(this)}set(e,t,i){super.set(e,t),this.frame=i}},Um=class{constructor(e){this.renderer=e,this.tickHandlers=new Array,this.lt=-1,this._isRunning=!1;let t=new M1,i=0;this._onTick=(r,o)=>{this.lt>=0&&(i=r-this.lt,t.set(r,i,o),this.tick(t)),this.lt=r}}get isRunning(){return this._isRunning}restart(){this.stop(),this.start()}addTickHandler(e){this.tickHandlers.push(e)}removeTickHandler(e){Pt(this.tickHandlers,e)}setAnimationLoop(e){this.renderer.setAnimationLoop(e),this._isRunning=y(e)}start(){this.isRunning||this.setAnimationLoop(this._onTick)}stop(){this.isRunning&&(this.setAnimationLoop(null),this.lt=-1)}tick(e){for(let t of this.tickHandlers)t(e)}};var Ay=15,Yce=YS(Ay),zm=class extends Be{constructor(e,t,i,r,o,s=null,l=null,c=null){if(super(),this.styleSheetPath=t,this.fetcher=i,this.layers=new Array,this.layerSortOrder=new Map,this.spectator=new Bs,this.lastViewport=new Ir,this.curViewport=new Ir,this.gltfLoader=new us,this.fadeDepth=0,this.scene=new No,this.stage=ft("Stage"),this.ambient=new Fd(16777215,.5),this.sun=new vd(16777215,.75),this.ground=new gb(Yce,Ay,12632256,8421504),this.foreground=ft("Foreground"),this.loadingBar=new Zh,this.handModelFactory=new Hm(new Sn(12044521),"mesh"),this.screenControl=null,this.enableSpectator=!1,this._xrBinding=null,this._xrMediaBinding=null,this._hasXRMediaLayers=null,this._hasXRCompositionLayers=null,this.layerSorter=vn("descending",p=>this.layerSortOrder.get(p)),this.DEBUG=s||!1,this.defaultAvatarHeight=l||1.75,c=c||60,this.camera=new Bs(c,1,.01,1e3),this.cursor3D=new Om(this),cr(e)&&(e.style.backgroundColor="black",oe(e.parentElement)))throw new Error("The provided canvas must be included in a parent element before constructing the environment.");this.renderer=new Pd({canvas:e,powerPreference:"high-performance",precision:"lowp",antialias:!0,alpha:!0,premultipliedAlpha:!0,depth:!0,logarithmicDepthBuffer:!0,stencil:!1,preserveDrawingBuffer:!1}),this.renderer.domElement.setAttribute("touch-action","none"),this.renderer.domElement.tabIndex=1,this.useNewColorModel=!1,cr(e)&&(this.screenControl=new gm(this.renderer,this.camera,this.renderer.domElement.parentElement,r,o)),this.fader=new $h("ViewFader"),this.worldUISpace=new Uu("WorldUISpace",.2,20,.125),this.avatar=new Qh(this,this.fader),this.eventSys=new Vm(this),this.timer=new Um(this.renderer),this.skybox=new wm(this),this.renderer.xr.enabled=!0,this.sun.name="Sun",this.sun.position.set(0,1,1),this.sun.lookAt(0,0,0),this.sun.layers.enableAll();let u=()=>{this.ground.visible=this.renderer.xr.isPresenting};this.screenControl.addEventListener("sessionstarted",u),this.screenControl.addEventListener("sessionstopped",u),u(),this.ambient.name="Fill",this.ambient.layers.enableAll(),this.loadingBar.object.name="MainLoadingBar",this.loadingBar.object.position.set(0,-.25,-2),this.scene.layers.enableAll(),this.avatar.addFollower(this.worldUISpace),De(this.scene,this.sun,this.ambient,De(this.stage,this.ground,this.camera,this.avatar,...this.eventSys.hands),this.foreground,De(this.worldUISpace,this.loadingBar)),this.timer.addTickHandler(p=>this.update(p)),this._start(),globalThis.env=this}get useNewColorModel(){return yx.enabled}set useNewColorModel(e){yx.enabled=e,this.renderer.outputEncoding=e?Kb:yb}async _start(){y(this.styleSheetPath)&&await this.fetcher.get(this.styleSheetPath).style(),this.timer.start()}get gl(){return this.renderer.getContext()}get referenceSpace(){return this.renderer.xr.getReferenceSpace()}update(e){if(this.dispatchEvent(e),this.screenControl.visible){let t=this.xrSession;this._xrBinding=this.renderer.xr.getBinding(),this.hasXRMediaLayers&&this._xrMediaBinding===null===this.renderer.xr.isPresenting&&(this._xrMediaBinding===null&&y(t)?this._xrMediaBinding=new XRMediaBinding(t):this._xrMediaBinding=null);let i=t&&this.renderer.xr.getBaseLayer();i!==this.baseLayer&&(y(this.baseLayer)&&(this.removeWebXRLayer(this.baseLayer),this.baseLayer=null),y(i)&&(this.baseLayer=i,this.addWebXRLayer(i,0))),this.screenControl.resize(),this.eventSys.update(),this.avatar.update(e.dt),this.worldUISpace.update(this.avatar.height,this.avatar.worldPos,this.avatar.worldHeadingRadians,e.dt),this.fader.update(e.dt),HS(e.dt),this.loadingBar.update(e.sdt),this.preRender(e);let r=Xs(this.renderer,this.camera);if(r!==this.camera){let o=r;o.layers.mask=this.camera.layers.mask;for(let s=0;s<o.cameras.length;++s){let l=o.cameras[s];l.layers.mask=this.camera.layers.mask,l.layers.enable(s+1),o.layers.enable(s+1)}}this.screenControl.render(this.scene,this.camera),this.enableSpectator&&(this.renderer.xr.isPresenting?Wa()&&!ed()&&this.drawSnapshot():(this.lastViewport.copy(this.curViewport),this.renderer.getViewport(this.curViewport)))}}drawSnapshot(){let e=this.renderer.xr.isPresenting,t=null;if(e){let i=Xs(this.renderer,this.camera);this.spectator.projectionMatrix.copy(this.camera.projectionMatrix),this.spectator.position.copy(i.position),this.spectator.quaternion.copy(i.quaternion),t=this.renderer.getRenderTarget(),this.renderer.xr.isPresenting=!1,this.renderer.setRenderTarget(null),this.renderer.setViewport(this.lastViewport)}this.screenControl.render(this.scene,e?this.spectator:this.camera),e&&(this.renderer.setViewport(this.curViewport),this.renderer.setRenderTarget(t),this.renderer.xr.isPresenting=!0)}preRender(e){}async onQuitting(){this.dispatchEvent(new ge("quitting")),window.location.href="/"}get hasAlpha(){return this.renderer.getContextAttributes().alpha}get xrSession(){return this.renderer.xr.getSession()}get xrBinding(){return this._xrBinding}get xrMediaBinding(){return this._xrMediaBinding}get isReadyForLayers(){return this.hasAlpha&&(!ro||_A.major>=15)}get hasXRMediaLayers(){return this._hasXRMediaLayers===null&&(this._hasXRMediaLayers=this.isReadyForLayers&&"XRMediaBinding"in globalThis&&Ke(XRMediaBinding.prototype.createQuadLayer)),this._hasXRMediaLayers}get hasXRCompositionLayers(){return this._hasXRCompositionLayers===null&&(this._hasXRCompositionLayers=this.isReadyForLayers&&"XRWebGLBinding"in globalThis&&Ke(XRWebGLBinding.prototype.createCubeLayer)),this._hasXRCompositionLayers}addWebXRLayer(e,t){this.layerSortOrder.set(e,t),bi(this.layers,e,this.layerSorter),this.updateLayers()}removeWebXRLayer(e){Z0(this.layers,e,this.layerSorter),this.layerSortOrder.delete(e),this.updateLayers()}updateLayers(){let e=this.xrSession;y(e)&&e.updateRenderState({layers:this.layers})}clearScene(){this.dispatchEvent(new ge("sceneclearing")),ut(this.foreground),this.dispatchEvent(new ge("scenecleared"))}async fadeOut(){++this.fadeDepth,this.fadeDepth===1&&(await this.fader.fadeOut(),this.skybox.visible=!1,this.camera.layers.set(_l),this.loadingBar.start(),await this.fader.fadeIn())}async fadeIn(){this.fadeDepth===1&&(await this.fader.fadeOut(),this.camera.layers.set(Jh),this.skybox.visible=!0,await this.fader.fadeIn()),--this.fadeDepth}async withFade(e){try{return await this.fadeOut(),await e()}finally{await this.fadeIn()}}get showWebXRLayers(){return this.fadeDepth===0}set3DCursor(e){let t=e.children.slice(0);for(let i of t)this.cursor3D.add(i.name,i);this.eventSys.refreshCursors(),this.dispatchEvent(new ge("newcursorloaded"))}async load(e,...t){let i=null;ks(e)?t.push(e):i=e;let r=new uo(this,"/models/Cursors.glb",Er,!this.DEBUG);t.push(r),await this.fetcher.assets(i,...t),Ns(r.result.scene,oS),this.set3DCursor(r.result.scene)}loadGltf(e){return this.gltfLoader.loadAsync(e)}};var gt=class extends Be{constructor(...e){super(),this.element=Ae(de("input-range-with-number"),this.rangeInput=rA(Oe(()=>{this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.dispatchEvent(new ge("input"))}),...e),this.numberInput=yi(Oe(()=>{this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber,this.rangeInput.dispatchEvent(new Event("input"))}))),this.numberInput.min=this.rangeInput.min,this.numberInput.max=this.rangeInput.max,this.numberInput.step=this.rangeInput.step,this.numberInput.valueAsNumber=this.rangeInput.valueAsNumber,this.numberInput.disabled=this.rangeInput.disabled,this.numberInput.placeholder=this.rangeInput.placeholder}get value(){return this.rangeInput.value}set value(e){this.rangeInput.value=this.numberInput.value=e}get valueAsNumber(){return this.rangeInput.valueAsNumber}set valueAsNumber(e){this.rangeInput.valueAsNumber=this.numberInput.valueAsNumber=e}get disabled(){return this.rangeInput.disabled}set disabled(e){this.rangeInput.disabled=this.numberInput.disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}};var Yu=class{constructor(e,...t){this.name=e,this.properties=t}};function ds(n,...e){return new Yu(n,...e)}var D1="DefaultPropertyGroup"+In(16),Kce=de("single-item");function vy(n){return n.flatMap(e=>Qce(e).flatMap(pn))}function Qce(n){let e=D1,t=new Array;return n instanceof Yu?(e=n.name,t.push(...n.properties.map(i=>by(e,i)))):t.push(by(e,n)),t}function by(n,e){let t=n===D1?null:qt("groupname",n);if(Wn(e)){let[i,...r]=e,o=Rc(i);for(let s of r)if(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement||s instanceof HTMLSelectElement){s.id.length===0&&(s.id=In(10)),o.htmlFor=s.id;break}return[UF(t,o),tx(t,...r)]}else return(Ve(e)||mt(e)||Ln(e)||_o(e))&&(e=Pp(e)),[tx(t,e)]}function $ce(n){return y(n)&&!kg(n)&&!Dc(n)}var Ji=class n{static find(){return Array.from(n._find())}static*_find(){for(let e of CF(".properties"))yield new n(e)}static create(...e){let t=e.filter($ce),i=e.filter(kg),r=e.filter(Dc),o=vy(t);return new n(HF(de("properties"),...i,...r,...o))}constructor(e){this.element=e,this.groups=new Zt,this.controls=new Array,this._disabled=!1;let t=[...e.children];for(;t.length>0;){let i=t.shift();Po(i)&&this.controls.push(i),i instanceof HTMLElement&&(this.checkGroup(i),t.push(...i.children))}}append(...e){let t=vy(e);Ee(this.element,...t);for(let i of e){let r=i instanceof Yu?i.properties:[i];for(let o of r)if(!Ve(o)){let[s,...l]=Wn(o)?o:[null,o];for(let c of l)Po(c)&&this.controls.push(c)}}for(let i of t)this.checkGroup(i)}checkGroup(e){let t=$t(e),i=t.dataset.groupname;i!==D1&&this.groups.add(i,e),t.parentElement===this.element&&t.tagName==="DD"&&(!t.previousElementSibling||t.previousElementSibling.tagName!=="DT")&&Kce.applyToElement(t)}get disabled(){return this._disabled}set disabled(e){if(e!==this.disabled){this._disabled=e,En(this,e,"disabled");for(let t of this.controls)t.disabled=e}}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}setGroupVisible(e,t){let i=this.groups.get(e);if(i)for(let r of i)Ue(r,t)}getGroupVisible(e){let t=this.groups.get(e);if(t)for(let i of t)return zn(i);return!1}};var jm="micFields"+In(8),C1="camFields"+In(8);function Sy(n,e,t){St(n),Ee(n,bn(Qt(""),"NONE"),...e.map(i=>bn(vF(t&&i.deviceId===t.deviceId),Qt(i.deviceId),i.label)))}var Gm=class extends Mi{constructor(e,t,i,r,o,s=!1){super("Configure devices"),this.devices=t,this.audio=i,this.microphones=r,this.webcams=o,this.micLookup=null,this.camLookup=null,this.spkrLookup=null,this.spkrVolumeControl=null,this.speakers=null,this.cancelButton.style.display="none";let l=new lr("/audio/test-clip.mp3",Si,!s),c=e.assets(l).then(()=>this.audio.createBasicClip("test-audio",l,.5));Ee(this.contentArea,G0("2em"),this.properties=Ji.create(ds(C1,["Webcams",this.webcamSelector=Vi(Oe(async()=>{let u=this.webcamSelector.value,p=this.camLookup.get(u);await this.webcams.setDevice(p)}))]),ds(jm,["Microphones",this.microphoneSelector=Vi(Jt("inline-block"),Oe(async()=>{let u=this.microphoneSelector.value,p=this.micLookup.get(u);await this.microphones.setDevice(p)}))],["Volume",this.micVolumeControl=new gt(at(0),st(100),nt(1),Qt(0),Oe(()=>{this.microphones.gain.setValueAtTime(this.micVolumeControl.valueAsNumber/100,0)}))],["Levels",this.micLevels=qF(Jt("inline-block"))]))),Vr&&(this.properties.append(["Speakers",this.speakers=Vi(Oe(async()=>{let u=this.speakers.value,p=this.spkrLookup.get(u);await this.audio.speakers.setAudioOutputDevice(p)}))]),this.audio.speakers.addEventListener("audiooutputchanged",u=>{this.speakers.value=u.device&&u.device.deviceId||""})),this.properties.append(["Volume",this.spkrVolumeControl=new gt(at(0),st(100),nt(1),Qt(0),Oe(()=>this.audio.destination.volume=this.spkrVolumeControl.valueAsNumber/100))],["",this.testSpkrButton=ka("Test",Ii("Test audio"),xp(vi(.5)),Ye(async()=>{this.testSpkrButton.disabled=!0,await c,await this.audio.playClipThrough("test-audio"),this.testSpkrButton.disabled=!1}))],["Using headphones",this.useHeadphones=Xn(yp(this.audio.useHeadphones),Oe(()=>{this.audio.useHeadphones=this.useHeadphones.checked,Ue(this.headphoneWarning,!this.audio.useHeadphones,"inline-block")}))],this.headphoneWarning=Ae(de("alert","alert-warning"),"\u{1F3A7}\u{1F399}\uFE0F This site has a voice chat feature. Voice chat is best experienced using headphones.")),this.activity=new zu(this.audio.context),this.activity.name="device-settings-dialog-activity",this.activity.addEventListener("activity",u=>{this.isOpen&&(this.micLevels.value=u.level)}),this.microphones.connect(this.activity),this.activity.start(),this.properties.setGroupVisible(jm,!1),Object.seal(this)}get showWebcams(){return this.properties.getGroupVisible(C1)}set showWebcams(e){this.properties.setGroupVisible(C1,e)}get showMicrophones(){return this.properties.getGroupVisible(jm)}set showMicrophones(e){this.properties.setGroupVisible(jm,e)}async onShowing(){if(this.showWebcams||this.showMicrophones){await this.devices.init();let e=await this.devices.getDevices();if(this.showWebcams){let t=e.filter(i=>i.kind==="videoinput");this.camLookup=Cs(t,i=>i.deviceId),Sy(this.webcamSelector,t,this.webcams.device)}if(this.showMicrophones){let t=e.filter(i=>i.kind==="audioinput");this.micLookup=Cs(t,i=>i.deviceId),Sy(this.microphoneSelector,t,this.microphones.device),this.microphones.usingHeadphones=this.useHeadphones.checked,this.microphones.enabled=!0,this.micVolumeControl.valueAsNumber=this.microphones.gain.value*100}}if(Vr){await this.audio.speakers.ready;let e=await this.audio.speakers.getAudioOutputDevices();this.spkrLookup=Cs(e,i=>i.deviceId),St(this.speakers),Ee(this.speakers,...e.map(i=>bn(Qt(i.deviceId),i.label)));let t=await this.audio.speakers.getAudioOutputDevice();t||(t=await this.audio.speakers.getPreferredAudioOutput(),await this.audio.speakers.setAudioOutputDevice(t)),this.speakers.value=t&&t.deviceId||""}this.spkrVolumeControl.valueAsNumber=this.audio.destination.volume*100,this.useHeadphones.checked=this.audio.useHeadphones,Ue(this.headphoneWarning,!this.audio.useHeadphones,"inline-block"),await super.onShowing()}};var L1=class extends ge{constructor(e){super("roomjoined"),this.roomName=e}},P1=class extends ge{constructor(e){super("dialogshowing"),this.showing=e}},Xm=class extends zm{get currentRoom(){return this._currentRoom}constructor(e){if(oe(e))throw new Error("Options are now required");if(oe(e.canvas))throw new Error("options.canvas is required");if(oe(e.fetcher))throw new Error("options.fetcher is required");if(oe(e.dialogFontFamily))throw new Error("options.dialogFontFamily is required");if(oe(e.getAppUrl))throw new Error("options.getAppUrl is required");if(oe(e.uiImagePaths))throw new Error("options.uiImagePaths is required");if(oe(e.buttonFillColor))throw new Error("options.buttonFillColor is required");if(oe(e.labelFillColor))throw new Error("options.labelFillColor is required");super(e.canvas,e.styleSheetPath,e.fetcher,e.enableFullResolution,e.enableAnaglyph,e.DEBUG,e.defaultAvatarHeight,e.defaultFOV),this.envAudioToggleEvt=new ge("environmentaudiotoggled"),this._currentRoom=null,this._testSpaceLayout=!1,this.countTick=0,this.fpses=new Array,this.avgFPS=0,this.screenUISpace=new Mh(e.buttonFillColor),this.compassImage=new Fh,this.clockImage=new Qo(this,"Clock","none",new yh),this.clockImage.sizeMode="fixed-height",this.clockImage.mesh.renderOrder=5,this.statsImage=new Qo(this,"Stats","none",new Th),this.statsImage.sizeMode="fixed-height",this.statsImage.mesh.renderOrder=5,this.infoLabel=new mi(this,"InfoLabel","none",{minHeight:.1,maxHeight:.1,padding:.02,scale:1e3,bgFillColor:e.labelFillColor,textFillColor:"white"}),this.apps=new Kh(this,e.getAppUrl),this.apps.addEventListener("apploaded",t=>{t.app.addEventListener("joinroom",i=>{i.roomName!==this._currentRoom&&(this._currentRoom=i.roomName,this.dispatchEvent(new L1(i.roomName)))})}),this.audio=new gh(e.fetcher,DS),this.graph=new _h(this.audio.context),cr(e.canvas)&&e.canvas.addEventListener("keypress",t=>{ao(t)&&t.key==="`"&&this.graph.showDialog()}),this.audioPlayer=new xl(this.audio.context,this.audio.createSpatializer(!1,!1)),this.videoPlayer=new Hh(this,this.audio.context,this.audio.createSpatializer(!1,!1)),this.videoPlayer.object.visible=!1,this.interactionAudio=new zh(this.audio,this.eventSys),this.microphones=new xh(this.audio.context),this.webcams=new Eh,this.devices=new Gd(this.microphones,this.webcams),this.confirmationDialog=new Yh(this,e.dialogFontFamily),this.devicesDialog=new Gm(this.fetcher,this.devices,this.audio,this.microphones,this.webcams,this.DEBUG),this.uiButtons=new Gh(e.uiImagePaths,20,e.buttonFillColor,e.labelFillColor,this.DEBUG),this.menuButton=new Sl(this.uiButtons,"ui","menu"),this.settingsButton=new Sl(this.uiButtons,"ui","settings"),this.quitButton=new Sl(this.uiButtons,"ui","quit"),this.muteMicButton=new $o(this.uiButtons,"microphone","mute","unmute"),this.muteCamButton=new $o(this.uiButtons,"media","play","pause"),this.muteEnvAudioButton=new $o(this.uiButtons,"environment-audio","mute","unmute"),this.muteEnvAudioButton.active=!0,this.audio.ready.then(()=>this.muteEnvAudioButton.active=!1),this.fullscreenButton=new Gs(this.uiButtons,tt.Fullscreen),this.anaglyphButton=new Gs(this.uiButtons,tt.Anaglyph),this.vrButton=new Gs(this.uiButtons,tt.VR),this.arButton=new Gs(this.uiButtons,tt.AR),hu.isAvailable&&Wc()&&(this.batteryImage=new Qo(this,"Battery","none",new hu),this.batteryImage.sizeMode="fixed-height"),this.xrUI=new Dh,this.subMenu=new Ko(Ae(At("juniperSubMenu")),ft("sub-menu"),"flex"),this.createMenu(),this.screenControl.setUI(this.screenUISpace,this.anaglyphButton,this.fullscreenButton,this.vrButton,this.arButton),y(this.screenControl)&&this.screenControl.addEventListener("sessionstarted",t=>{t.mode===tt.Fullscreen&&this.confirmationDialog.element.parentElement!==this.screenControl.fullscreenElement&&Ee(this.screenControl.fullscreenElement,this.devicesDialog,this.confirmationDialog)}),y(e.watchModelPath)&&(this.watch=new Uh(this,e.watchModelPath)),this.microphones.addEventListener("devicesettingschanged",()=>{this.muteMicButton.active=this.microphones.enabled&&!this.microphones.muted}),this.webcams.addEventListener("devicesettingschanged",()=>{this.muteCamButton.active=this.webcams.enabled}),this.muteMicButton.addEventListener("click",()=>{this.microphones.muted=this.microphones.enabled&&!this.microphones.muted,this.muteMicButton.active=!this.microphones.muted}),this.muteCamButton.addEventListener("click",()=>{this.webcams.enabled=!this.webcams.enabled,this.muteCamButton.active=this.webcams.enabled}),this.muteMicButton.active=this.microphones.enabled&&!this.microphones.muted,this.muteCamButton.active=this.webcams.enabled,Ke(e.createSpeechRecognizer)&&(this.speech=e.createSpeechRecognizer(this.fetcher,this.devicesDialog.activity,this.microphones),this.speech.continuous=!0)}get canvas(){return this.statsImage.image.canvas}get testSpaceLayout(){return this._testSpaceLayout}set testSpaceLayout(e){e!==this.testSpaceLayout&&(this._testSpaceLayout=e)}createMenu(){y(this.batteryImage)&&(this.xrUI.addItem(this.batteryImage,{x:.75,y:-1,width:.2,height:.1}),Ee(this.screenUISpace.topRight,this.batteryImage)),this.xrUI.addItem(this.clockImage,{x:-1,y:1,height:.1}),this.xrUI.addItem(this.statsImage,{x:-1,y:.95,height:.1}),this.xrUI.addItem(this.confirmationDialog,{x:0,y:0,scale:.25}),this.xrUI.addItem(this.menuButton,{x:-1,y:-1,scale:.5}),this.xrUI.addItem(this.infoLabel,{x:0,y:-1.125,scale:.5}),this.xrUI.addItem(this.vrButton,{x:1,y:-1,scale:.5}),this.xrUI.addItem(this.arButton,{x:1,y:-1,scale:.5}),De(this.menuButton,this.subMenu),De(this.worldUISpace,this.xrUI),Ee(this.screenUISpace.topLeft,X0("none"),Ee(this.webcams,Jt("inline-block"),Pn(Xt(50)),Q0("scaleX(-1)"))),this.screenUISpace.topRight.append(...[this.compassImage,this.statsImage].map(e=>e.canvas).filter(cr).map(e=>e)),Ee(this.screenUISpace.bottomCenter,this.infoLabel),Ee(this.screenUISpace.bottomRight,this.vrButton,this.arButton,this.fullscreenButton,this.anaglyphButton),Ee(this.screenUISpace.bottomLeft,Ae(this.menuButton,Jt("flex"),N0("column-reverse"),H0(vi(.25)),this.subMenu)),u_(this.subMenu,this.settingsButton,this.muteCamButton,this.muteMicButton,this.muteEnvAudioButton,this.quitButton),this.settingsButton.addEventListener("click",async()=>{let e=this.screenControl.currentMode,t=this.renderer.xr.isPresenting;t&&await this.screenControl.stop(),await this.devicesDialog.showDialog(),t&&await this.screenControl.start(e)}),this.muteEnvAudioButton.addEventListener("click",()=>{this.muteEnvAudioButton.active=!this.muteEnvAudioButton.active,this.dispatchEvent(this.envAudioToggleEvt)}),this.quitButton.addEventListener("click",()=>this.withConfirmation("Confirm quit","Are you sure you want to quit?",async()=>{this.renderer.xr.isPresenting&&this.screenControl.stop(),await this.onQuitting()})),this.menuButton.addEventListener("click",()=>this.subMenu.visible=!this.subMenu.visible),[this.settingsButton,this.muteCamButton,this.muteMicButton,this.muteEnvAudioButton,this.quitButton].forEach(e=>e.addEventListener("click",()=>this.subMenu.visible=!1)),this.subMenu.visible=!1,this.vrButton.visible=Wa()&&nd()||io(),this.arButton.visible=!1,this.muteCamButton.visible=!1,this.muteMicButton.visible=!1}layoutMenu(){let e=0;for(let t of this.subMenu.object.children)t.visible&&t.position.set(0,++e*.25,0)}preRender(e){super.preRender(e);let{worldPos:t,worldQuat:i}=this.avatar;if(this.audio.setUserPose(this.audio.localUserID,t.x,t.y,t.z,i.x,i.y,i.z,i.w),this.xrUI.visible=this.renderer.xr.isPresenting||this.testSpaceLayout,this.statsImage.isVisible=this.xrUI.visible&&this.DEBUG,this.renderer.xr.isPresenting||this.compassImage.setPitchAndHeading(Lt(this.avatar.worldPitchRadians),Lt(this.avatar.worldHeadingRadians)),this.layoutMenu(),this.DEBUG){let r=Math.round(e.fps);if(this.avgFPS+=r/100,this.fpses.push(r),this.fpses.length>100){let o=this.fpses.shift();this.avgFPS-=o/100}++this.countTick%100===0&&this.statsImage.image.setStats(this.avgFPS,this.renderer.info.render.calls,this.renderer.info.render.triangles)}this.confirmationDialog.update(e.dt)}get environmentAudioMuted(){return this.muteEnvAudioButton.active}async withConfirmation(e,t,i){this.onConfirmationShowing(!0),await this.confirmationDialog.prompt(e,t)&&i(),this.onConfirmationShowing(!1)}onConfirmationShowing(e){c_(this.quitButton,!e),this.dispatchEvent(new P1(e))}async load(e,...t){let i=null;ks(e)?(t.push(e),i=this.loadingBar):i=e,cr(this.renderer.domElement)&&Ee(this.renderer.domElement.parentElement,this.renderer.domElement,...this.screenUISpace.elements);let r=new lr("/audio/footsteps.mp3",Si,!this.DEBUG),o=new lr("/audio/basic_enter.mp3",Si,!this.DEBUG),s=new lr("/audio/basic_exit.mp3",Si,!this.DEBUG),l=new lr("/audio/basic_error.mp3",Si,!this.DEBUG),c=new lr("/audio/vintage_radio_button_pressed.mp3",Si,!this.DEBUG);t.push(...this.uiButtons.assets,r,o,s,l,c),y(this.watch)&&t.push(this.watch.asset),await super.load(i,...t),await sn(this.audio.createBasicClip("footsteps",r,.5),this.interactionAudio.create("enter",o,.25),this.interactionAudio.create("exit",s,.25),this.interactionAudio.create("error",l,.25),this.interactionAudio.create("click",c,1)),this.screenUISpace.show()}};var qm=class{constructor(){this.mouseX=0,this.mouseY=0,this.element=Ae(de("context-menu")),Ue(this.element,!1),window.addEventListener("mousemove",e=>{this.mouseX=e.clientX,this.mouseY=e.clientY})}async cancel(){y(this.currentTask)&&(this.currentTask.resolve("cancel"),await this.currentTask,this.currentTask=null)}async show(e,...t){let i;e instanceof Map?i=e:(i=new Map,t.unshift(e)),y(this.currentTask)&&await this.cancel();let r=new et;this.currentTask=r,St(this.element),Ee(this.element,z0(ui(this.mouseX)),K0(ui(this.mouseY)),...t.map(s=>s instanceof HTMLHRElement?(s.style.width=Xt(100),s):zi(i.has(s)?i.get(s):s.toString(),Ye(this.currentTask.resolver(s),!0)))),Ue(this.element,!0,"grid"),this.mouseY=Math.min(this.mouseY,window.innerHeight-this.element.clientHeight-50),this.element.style.top=ui(this.mouseY);let o=this.currentTask.resolver("cancel");return addEventListener("click",o),this.currentTask.finally(()=>{Ue(this.element,!1),removeEventListener("click",o)}),await r}};var Ku="proportion",ky="index";function Jm(n,...e){return Ae(de("dock",n),...e)}function _y(n){return n instanceof kr&&n.key===Ku}var Il=class{constructor(e,t){this.type=e,this.value=t}};function My(n){return new Il("resizable",n)}function Dy(n){return new Il("rearrangeable",n)}function Cy(n,e){return e instanceof Il&&e.type===n}function Jce(n){return Cy("resizable",n)}function Zce(n){return Cy("rearrangeable",n)}function eue(n){return!(n instanceof Il)}function Ly(n,...e){let t=Lg(e,Jce),i=Lg(e,Zce),r=t&&t.value,o=i&&i.value,s=e.filter(eue),l=[];r&&l.push("resizable"),o&&l.push("rearrangeable");let c=null,u=null,p=null,d=null,h=Jm("panel",At(n),de(...l),pd(V=>{let J=A(V.target);(o&&Qm(J)||r&&Zi(J))&&R(J,V.clientX,V.clientY)}),za(V=>{if(y(c)){let J=A(V.target);r&&p==="sep"?(V.preventDefault(),S(u,c,V.clientX,V.clientY)):o&&p==="cell"&&Zi(J)&&(V.preventDefault(),P(J))}}),Ua(V=>{A(V.target)===c&&Qm(c)&&Zi(d)&&L(u,d),c&&(c.classList.remove("dragging"),c=null,u=null,p=null),d&&(d.classList.remove("targeting"),d=null)}),...s);function A(V){let J=V;for(;y(J)&&!J.classList.contains("dock");)J=J.parentElement;return J}let g=lt.create(),F=lt.create(),b=lt.create();function R(V,J,ce){c=V,u=c.parentElement,p=iue(c),c.classList.add("dragging"),Zi(c)&&lt.set(g,J,ce)}function P(V){d&&(d.classList.remove("targeting"),d=null),d=V,d.classList.add("targeting")}function L(V,J){let ce=J.parentElement,G=Ym(ce)===Ym(J),Y=yy(J);if(!G){let se=Ey(ce);ce=ex(ce,$=>R1(se,$))}let K=ce.children[Y];K!==c.nextElementSibling&&(Mr(ce,V,K),O(!1))}function S(V,J,ce,G){lt.set(F,ce,G),lt.sub(b,F,g);let Y=$m(V),K=b[Y?0:1];if(K!==0){lt.copy(g,F);let se=Y?"clientWidth":"clientHeight",$=0,z=0;V.querySelectorAll(":scope > .dock.group").forEach(m=>{Km(m)||(++z,$+=m[se])});let k=$/z,T=yy(J),N=x(V,T,-1),W=x(V,T,1);if(y(N)&&y(W)){let m=N[se]+K,_=W[se]-K,C=m/k,I=_/k;M(N,C),M(W,I),O(!0)}}}function x(V,J,ce){ce===-1&&--J;let G=V.children[J];for(;y(G)&&!Zi(G)&&Km(G);)J+=ce,G=V.children[J];return Zi(G)&&(G=null),G}function v(V){if(!Zi(V)){let J=localStorage.getItem(n+"."+V.id+":"+Ku)||Zg(V,Ku);return parseFloat(J)||1}return null}function M(V,J){if(!Zi(V)){let ce=J.toString();localStorage.setItem(n+"."+V.id+":"+Ku,ce),qt(Ku,ce).applyToElement(V)}}function O(V){V||(h.querySelectorAll(".dock.sep").forEach(J=>J.remove()),h.querySelectorAll(".dock.cell").forEach(J=>{J.parentElement.childElementCount>1&&ex(J,ce=>Zm(ce))})),Array.from(h.querySelectorAll(".dock.group")).reverse().forEach(J=>{J.childElementCount===0?J.remove():J.childElementCount===1&&I1(J.parentElement)&&J.parentElement.childElementCount===1?J.replaceWith(...J.children):B(J,V)})}function B(V,J){V.childElementCount===1&&B1(V)&&(V.classList.remove("column"),V.classList.add("row"));let ce=Ym(V.parentElement),G=Ym(V),Y=Ey(V),K=$m(V),se=K?Mg:Dg,$=K?Dg:Mg,z=K?As:Cg,k=K?Cg:As,T=o?1:0,N=se(2,-2),W=$(2,-2),m=Co(V,":scope > .dock:not(.sep)").map((I,H)=>{let j=I,q=2*H+T+1;return se(q,q+1).applyToElement(j),W.applyToElement(j),Km(j)?"auto":`${v(j)}fr`});for(let I=m.length+T-1;I>=1-T;--I)vs(m,"min-content",I);let _=z(...m),C=o?k("min-content",yo(1),"min-content"):k("auto");if(Ee(V,_,C),!J){for(let I=V.childElementCount,H=0;H<=I;++H){let j=2*H+T,q=H===0||H===I;(!q||o&&G!==ce)&&Ee(V,Ty(G,H,q,se(j,j+1),W))}if(o&&Y!==ce)for(let I=0;I<2;++I){let H=2*I+1;Ee(V,Ty(Y,I,!0,$(H,H+1),N))}}}let X=0;return h.querySelectorAll(".dock.group").forEach(V=>{V.id="G"+ ++X,M(V,v(V))}),O(!1),h.querySelectorAll(".dock.cell").forEach(V=>{V.querySelector(":scope > .header").draggable=o,V.addEventListener("regrid",()=>O(!1))}),h}function R1(n,...e){return Jm("group",de(n),...e)}function Py(...n){return R1("column",...n)}function Zm(...n){return R1("row",...n)}function yy(n){if(Zi(n)){let e=Zg(n,ky);return oe(e)?null:parseFloat(e)}return null}function tue(n,e){Zi(n)&&qt(ky,e.toFixed(0)).applyToElement(n)}function Ty(n,e,t,...i){let r=[n];t&&r.push("edge");let o=Jm("sep",de(...r),Jg(!t),...i);return tue(o,e),o}function Qu(n,...e){(Ve(n)||_o(n)||mt(n)||Ln(n))&&(n=jF(n));let t=e.filter(_y);e=e.filter(s=>!_y(s));let i=Ae(de("content"),...e),r=ys(de("closer"),jc.emojiStyle,Ye(()=>{MF(i,"grid");let s=zn(i);Ie(r,s?jc.emojiStyle:ad.emojiStyle),o.classList.toggle("closed",!s),o.dispatchEvent(new Event("regrid"))})),o=Jm("cell",...t,r,Ee(n,Jg(!0),de("header")),i);return Zm(o)}function ef(n,e){return y(e)&&e.classList.contains(n)}function nue(n){return ef("panel",n)}function Zi(n){return ef("sep",n)}function Qm(n){return ef("cell",n)}function I1(n){return ef("group",n)}function iue(n){return nue(n)?"panel":Zi(n)?"sep":Qm(n)?"cell":I1(n)?"group":null}function Km(n){if(Qm(n))return n.classList.contains("closed");if(I1(n)){for(let e=0;e<n.childElementCount;++e)if(!Km(n.children[e]))return!1;return!0}else return!!Zi(n)}function Ry(n,e){return y(e)&&e.classList.contains(n)}function B1(n){return Ry("column",n)}function $m(n){return Ry("row",n)}function Ym(n){return $m(n)?"row":B1(n)?"column":null}function Ey(n){return $m(n)?"column":B1(n)?"row":null}var V1=class extends ge{constructor(e){super("tabselected"),this.tabname=e}};function tf(...n){return Je("tab-panel",...n)}var O1=class extends HTMLElement{constructor(){super(),this.buttons=new Map,this.curTab=null,this._disabled=!1,this.eventTarget=new _r(super.addEventListener.bind(this),super.removeEventListener.bind(this),super.dispatchEvent.bind(this)),this.panels=new Map(Co(this,":scope > [data-tab-name]").map(e=>[e.dataset.tabName,e])),this.panelNames=Array.from(this.panels.keys()),this.buttons=new Map(this.panelNames.map(e=>{let t=new V1(e);return[e,ys(e,Ye(()=>{this.select(e),this.dispatchEvent(t)}))]})),this.controls=Ae(de("tabs"),...Array.from(this.buttons.values())),this.inner=Ae(de("panels"))}connectedCallback(){this.append(this.controls,this.inner),this.inner.append(...Array.from(this.panels.values())),this.panelNames.length>0&&this.select(this.panelNames[0])}disconnectedCallback(){this.controls.remove(),this.inner.replaceWith(...Array.from(this.panels.values()))}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get disabled(){return this._disabled}set disabled(e){this._disabled=e;for(let[t,i]of this.panels){let r=this.buttons.get(t);if(r.disabled=e||t===this.curTab,En(i,e,"disabled"),Po(i))i.disabled=e;else{let o=$t(i);Po(o)&&(o.disabled=e)}}}isSelected(e){return this.curTab===e}select(e){if(this.panels.has(e)){this.curTab=e;for(let[t,i]of this.panels){let r=t===this.curTab,o=this.buttons.get(t);o.disabled=r||this.disabled,Ue(i,r)}}}addEventListener(e,t,i){this.eventTarget.addEventListener(e,t,i)}removeEventListener(e,t){this.eventTarget.removeEventListener(e,t)}dispatchEvent(e){return this.eventTarget.dispatchEvent(e)}addBubbler(e){this.eventTarget.addBubbler(e)}removeBubbler(e){this.eventTarget.removeBubbler(e)}addScopedEventListener(e,t,i,r){this.eventTarget.addScopedEventListener(e,t,i,r)}removeScope(e){this.eventTarget.removeScope(e)}clearEventListeners(e){this.eventTarget.clearEventListeners(e)}};customElements.define("tab-panel",O1);var Bl=class extends ge{constructor(){super("refresh")}};var N1=class{constructor(e="controls progress"){let t=Ae(de("progress-bar"),AF("progressbar"),uF(0),cF(0),lF(1),Pn(0));this.element=Ae(de(e),t),this.progress=new W1(t)}clear(){this.progress.clear()}report(e,t,i,r){this.progress.report(e,t,i,r)}attach(e){this.progress.attach(e)}start(e){this.progress.start(e)}end(e){this.progress.end(e)}},W1=class extends Ti{constructor(e,t=!0){super(),this.progressBar=e,this.showMessage=t}report(e,t,i,r){if(super.report(e,t,i,r),e===0)this.progressBar.style.width="0",this.progressBar.setAttribute("aria-valuenow","0");else{let o=(100*this.p).toFixed(1);this.progressBar.style.width=`${o}%`,this.progressBar.setAttribute("aria-valuenow",o)}this.showMessage&&Ie(this.progressBar,i||"")}};function nf(n="controls progress"){return new N1(n)}var Vl=class{constructor(e=.25){this.debounceSeconds=e}timer=null;curTask=null;nextTask=null;throttle(e){y(this.curTask)?this.nextTask=e:(y(this.timer)&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(async()=>{this.timer=null,this.run(e)},this.debounceSeconds*1e3))}async run(e){this.curTask=e(),await this.curTask;let t=this.nextTask;y(t)?(this.nextTask=null,this.run(t)):this.curTask=null}};function Iy(n){return y(n)&&y(n.location)}function By(n){return y(n)&&y(n.transformID)}var hs=Wt("video")("vnd.yarrow.ytdlp+json","ytdlp.json","ytdlp","json"),rf=Wt("image")("vnd.google.streetview.pano");function H1(n){return oe(n)?null:(Ve(n)&&(n=new URL(n,location.href)),n)}function Vy(n){return oe(n)?!1:(n=H1(n),kh(n))}function U1(n){if(oe(n))throw new Error("URL is undefined");if(n=H1(n),kh(n)){let e=Array.from(n.searchParams.keys()).filter(t=>t!=="v"&&t!=="t");for(let t of e)n.searchParams.delete(t)}return n}function ms(n){if(n=H1(n),oe(n))throw new Error("URL is undefined");return n=U1(n),new Gi("/vr/link",location.href).query("q",n.href).toURL()}var Ol=class extends ge{constructor(){super("selecting")}},of=class extends ge{constructor(t){super("urlselected");this.file=t}},Nl=class extends ge{constructor(t){super("filedataselected");this.file=t}},sf=class extends ge{constructor(t,i){super("fileselected");this.file=t;this.mediaType=i}};var z1=class extends ge{constructor(t){super("tagschanged");this.tags=t}},af=Pn(Xt(100)),Wl=class extends Be{element;_tags=new Array;newTagName;addTagButton;removeTagButton;tagsList;constructor(e,t,i,r){super(),this.element=Ae(Jt("grid"),U0("row"),Pn(vi(10))),Ve(e)?(this.newTagName=ni(At("newTagName"),Tp(e),af),this.addTagButton=ar(At("addTagButton"),af,"Add"),this.removeTagButton=OF(At("removeTagButton"),af,"Remove"),this.tagsList=Vi(At("tagsList"),xF(!0),af)):(this.newTagName=e,this.addTagButton=t,this.removeTagButton=i,this.tagsList=r,this.newTagName.replaceWith(this.element)),Ee(this.element,this.newTagName,this.addTagButton,this.tagsList,this.removeTagButton),this.addTagButton.disabled=!0,this.removeTagButton.disabled=!0,this.newTagName.addEventListener("input",()=>{this.addTagButton.disabled=this.newTagName.value.length===0});let o=()=>{this.newTagName.value.length>0&&this.updateTags(this.newTagName.value.toLocaleLowerCase(),null)};this.addTagButton.addEventListener("click",o),this.newTagName.addEventListener("keydown",cd(o)),this.tagsList.addEventListener("input",()=>{this.removeTagButton.disabled=this.tagsList.selectedIndex===-1}),this.removeTagButton.addEventListener("click",()=>{if(this.tagsList.selectedIndex>-1){let s=this.tagsList.selectedOptions[0].value;this.updateTags(null,s)}})}updateTags(e,t){let i=new Array;e!==null&&(e=e.trim().toLocaleLowerCase(),e.length>0&&bi(i,e,vn(pn),"set"));for(let r=0;r<this.tagsList.options.length;++r)this.tagsList.options[r].value!==t&&bi(i,e,vn(pn),"set");this.tags=i,this.dispatchEvent(new z1(i))}get tags(){return this._tags}set tags(e){un(this._tags,...e),this._tags.sort(),St(this.tagsList),this.tagsList.append(...e.map(t=>bn(Qt(t),t))),this.newTagName.value="",this.addTagButton.disabled=this.removeTagButton.disabled=!0}};function rue(n){return new Blob([n.href],{type:Ec.value})}var lf=class extends Be{constructor(t,i){super();this.fetcher=t;this.element=Ae(Ji.create(["File",this.urlInput=oA(bt("Paste in URL to file"),Lo(!0)),this.loadingIndicator=Dr(Jt("none"),OA.emojiStyle),this.selectionMessage=Ae()],["Copyright",this.copyrightInput=ni(At("copyright"),Do("copyright"),Lo(!0))],["Copyright date",this.copyrightDateInput=Ip(At("copyrightDate"),Do("copyrightDate"),Lo(!0))],["Tags",this.tagPicker=new Wl(i)]),this.uploadProgress=nf("progress"));let r=()=>this.refresh();this.urlInput.addEventListener("input",r),this.copyrightInput.addEventListener("input",r),this.copyrightDateInput.addEventListener("input",r);let o=new Vl(1);this.urlInput.addEventListener("input",()=>{if(this.urlInput.value.length>0&&!/^[a-z]+:\/\//.test(this.urlInput.value)){let{selectionStart:s,selectionEnd:l,selectionDirection:c}=this.urlInput,u="https://";this.urlInput.value=u+this.urlInput.value,this.urlInput.setSelectionRange(s+u.length,l+u.length,c)}this.hasURL&&(this.checkingURL=!0,Ue(this.loadingIndicator,!0,"inline-block"),o.throttle(async()=>{try{if(this.dispatchEvent(new Ol),this.selectedURL=new URL(this.urlInput.value),Vy(this.selectedURL)){this.selectedURL=U1(this.selectedURL),this.urlInput.value=this.selectedURL.href;let s=this.selectedType=hs.value,l=ms(this.selectedURL),c=await this.fetcher.get(l).object().then(We),u=this.selectedName=c.title,p=this.copyrightInput.value=c.uploader,d=c.upload_date.substring(0,4),h=c.upload_date.substring(4,6),A=c.upload_date.substring(6,8),g=this.copyrightDateInput.valueAsDate=new Date(`${d}/${h}/${A}`),F={filePath:l.href,mediaType:s,name:u,copyright:p,copyrightDate:g,size:null,sizeString:"--",id:null,tagsString:null,metadata:c};this.dispatchEvent(new Nl(F))}else{let s=await this.fetcher.head(ms(this.selectedURL)).exec(),l=this.selectedURL.pathname.split("/");this.copyrightInput.value=this.selectedURL.hostname,this.copyrightDateInput.valueAsDate=s.date,this.selectedName=s.fileName||l[l.length-1],this.selectedType=s.contentType,this.dispatchEvent(new of(this.selectedURL))}this.checkingURL=!1,this.refresh()}catch{this.selectedType=null,this.checkingURL=!1,this.refresh("Not a valid target")}})),this.refresh()})}element;urlInput;loadingIndicator;selectionMessage;copyrightInput;copyrightDateInput;tagPicker;uploadProgress;selectedType=null;selectedURL=null;typeFilters=new Array;accept=null;selectedName=null;checkingURL=!1;clearFileSelection(t){this.uploadProgress.clear(),this.selectedType=null,this.urlInput.value=null,this.copyrightInput.value=null,this.copyrightDateInput.value=null,this.tagPicker.tags=t,this.refresh()}addMessage(t){Ee(this.selectionMessage,Ae(t))}refresh(t){St(this.selectionMessage),Ve(t)?this.addMessage(t):this.hasURL&&!this.checkingURL&&!this.hasType?this.addMessage("No file found at give location"):this.hasType&&!this.hasCorrectType&&this.addMessage(`Unexpected file type: ${this.selectedType}. Expected: ${this.accept}`),this.hasCopyright||this.addMessage("Copyright holder is required"),this.hasCopyrightDate||this.addMessage("Copyright date is required"),Ue(this.loadingIndicator,this.checkingURL),this.dispatchEvent(new Bl)}setTypeFilters(...t){un(this.typeFilters,...t),this.accept=bs(t)}isExpectedType(t){return oe(t)?!1:this.typeFilters.length===0?!0:this.typeFilters.map(i=>i.matches(t)).reduce((i,r)=>i||r,!1)}get tagString(){return this.tagPicker.tags.join()}get hasURL(){return this.urlInput.validity.valid}get hasFile(){return y(this.selectedURL)}get hasType(){return y(this.selectedType)}get hasCorrectType(){return this.isExpectedType(this.selectedType)}get hasCopyright(){return this.copyrightInput.value.length>0}get hasCopyrightDate(){return this.copyrightDateInput.validity.valid}get requirementsMet(){return this.hasURL&&this.hasFile&&this.hasCorrectType&&this.hasCopyright&&this.hasCopyrightDate}async upload(){try{let t=new FormData,i=rue(this.selectedURL);return t.set("FormFile",i,this.selectedName),t.set("AltContentType",this.selectedType),t.set("Copyright",this.copyrightInput.value),t.set("CopyrightDate",this.copyrightDateInput.valueAsDate.toDateString()),t.set("TagString",this.tagString),await this.fetcher.post("/editor/files/create").body(t).progress(this.uploadProgress).object().then(We)}catch(t){throw console.error(t),t}}};function da(n){let e=n;for(;e&&e.tagName!=="TD"&&e.tagName!=="TH";)e=e.parentElement;if(e){let t=e.parentElement,i=0;for(let r of t.children){if(r===e)return i;r instanceof HTMLTableCellElement&&(i+=r.colSpan)}}return-1}function Hl(n,e){let t=0;mt(n)?t=n:e=n;let i=!0;return(...r)=>{i&&(i=!1,setTimeout(()=>{i=!0,e(...r)},t))}}function Hy(n){if(/^\d{4}-\d\d?-\d\d?$/.test(n)){let e=n.split("-"),t=e.shift();e.push(t),n=e.join("/")}return new Date(n)}function Oy(n){return n.classList.contains("range-start")}function oue(n){return n.classList.contains("range-end")}function j1(n,e){return n instanceof HTMLInputElement&&(n.type.startsWith("date")||n.type.startsWith("time")||n.type.startsWith("month")||n.type.startsWith("week"))?e&&Hy(e)||null:n instanceof HTMLInputElement&&(n.type==="number"||n.type==="range")?e&&parseFloat(e)||null:e&&e.toLocaleLowerCase()||null}function Ny(n,e){let t=Array.from(n.querySelectorAll("input"));if(t.length===0){let i=n.textContent.trim();return[j1(e,i)]}else return t.map(i=>j1(i,i.value))}var Wy=[10,25,50,100],sue=vn(pn),cf=class n{static create(e){let t=Ra(),i=Ra(),r=0,o=0;for(let c of e.columns){let u=null;if(r>0)--r;else{let p=Rc(c.header);c.filter&&(u=In(10),p.htmlFor=u);let d=Pa(p);y(c.headerColSpan)&&(d.colSpan=c.headerColSpan,r=c.headerColSpan-1),t.appendChild(d)}if(o>0)--o;else if(c.filter){let p=c.filter;u&&(p.id=u),c.header&&p instanceof HTMLInputElement&&(p.placeholder="Filter by "+c.header);let d=Pa(p);y(c.filterColSpan)&&(d.colSpan=c.filterColSpan,o=c.filterColSpan-1),i.appendChild(d)}}let s=da(t.lastElementChild)-1;for(;da(i.lastElementChild)<s;)i.appendChild(Pa());for(i.appendChild(Pa(NF(de("btn","btn-secondary"),"Reset"))),s=da(i.lastElementChild);s>da(t.lastElementChild);)t.appendChild(Pa());let l=new n($F(de("table","table-responsive","table-hover","table-striped","summary"),qt("resourcename",e.resourceName),tA(t,i),JF()));return e.columns.forEach((c,u)=>l.setCellMapper(u,c.getCellValue)),l.setPageSizes(e.pageSizes||Wy),l}get pageIndex(){return this._pageIndex}set pageIndex(e){this._pageIndex=e,localStorage.setItem(this.pageIndexKey,e.toString())}get pageSize(){return this._pageSize}set pageSize(e){this._pageSize=e,localStorage.setItem(this.pageSizeKey,e.toString())}constructor(e){this.element=e,this.ranges=new Map,this.valueCache=new Map,this.resetButton=null,this.cellMappers=new Map,this.pageSizes=[0,...Wy],this.update=Hl(this._update.bind(this)),this.resourceName=this.element.dataset.resourcename,this.pageIndexKey=`${this.resourceName}-page-index`,this.pageSizeKey=`${this.resourceName}-page-size`,this.rows=Co(this.element,"tbody > tr"),this.ranges=new Map,this.element.tHead?(this.filterElements=Co(this.element.tHead,"input,select"),this.resetButton=this.element.tHead.querySelector("button[type=reset]")):this.filterElements=[],this.colCount=Math.max(...Co(this.element,"tr").map(t=>t.children.length)),this.noContentMessageElement=Ra(Rp($g(this.colCount),"No content")),this.paginator=Rp($g(this.colCount),de("multi")),this.columnIndices=new Map,this.resetButton&&this.resetButton.addEventListener("click",()=>{this.valueCache.clear();for(let t of this.filterElements)this.deleteValue(t),t.value="";this.update()}),this.element.tFoot||(this.element.tFoot=eA()),Ee(this.element.tFoot,this.noContentMessageElement,...this.element.tFoot.children,Ra(this.paginator));for(let t of this.filterElements){let i=da(t);if(this.columnIndices.set(t,i),t.addEventListener("input",this.update.bind(null,t)),this.restoreValue(t),Oy(t)||oue(t)){this.ranges.has(i)||this.ranges.set(i,[null,null]);let r=this.ranges.get(i),o=Oy(t)?0:1;r[o]=t}}for(let t of this.element.querySelectorAll("input"))t.classList.add("form-control","form-control-sm");for(let t of this.element.querySelectorAll("select"))t.classList.add("custom-select","custom-select-sm");if(this.pageIndex=parseFloat(localStorage.getItem(this.pageIndexKey)||"0"),this.pageSize=parseFloat(localStorage.getItem(this.pageSizeKey)||"10"),y(this.element.dataset.pagesizes)&&this.element.dataset.pagesizes.length>0){let t=this.element.dataset.pagesizes.split(",").map(i=>parseFloat(i.trim())).filter(pn);this.setPageSizes(t)}else this.update()}setPageSizes(e){if(oe(e)||e.length===0)throw new Error("Need at least one page size");un(this.pageSizes,0,...e),this.pageSize=this.pageSizes[1],this.update()}setCellMapper(e,t){this.cellMappers.set(e,t)}clear(){qe(this.rows);for(let e of this.element.tBodies)St(e);this._update()}setValues(...e){let t=e.map(i=>{let r=Ra();for(let o=0;o<this.colCount;++o){let s=Rp();this.cellMappers.has(o)&&Ee(s,this.cellMappers.get(o)(i,r)),r.appendChild(s)}return this.rows.push(r),r});un(this.rows,...t);for(let i of this.element.tBodies)St(i);Ee(this.contentRoot,...this.rows),this._update()}select(e){let t=null;for(let i=0;i<this.rows.length;++i){let r=this.rows[i],o=r===e;En(r,o,"selected"),o&&(t=i)}t!==null&&(this.pageIndex=Math.floor(t/this.pageSize)*this.pageSize,this.update())}get noContentMessage(){return PF(this.noContentMessageElement)}set noContentMessage(e){Ie(this.noContentMessageElement,e)}get contentRoot(){return this.element.tBodies[0]}makeKey(e){return`yarrow:${this.resourceName}:${e.id}`}saveValue(e,t){let i=this.makeKey(e);t?localStorage.setItem(i,t.toString()):localStorage.removeItem(i)}deleteValue(e){let t=this.makeKey(e);localStorage.removeItem(t)}restoreValue(e){let t=this.makeKey(e),i=localStorage.getItem(t);if(!y(i))e.value="";else if(e instanceof HTMLSelectElement)e.value=i,this.valueCache.set(e,e.value);else if(e.type.startsWith("date")){let r=Hy(i);e.valueAsDate=r,this.valueCache.set(e,r)}else if(e.type==="number"||e.type==="range"){let r=parseFloat(i);e.valueAsNumber=r,this.valueCache.set(e,r)}else e.value=i,this.valueCache.set(e,e.value)}isRange(e){let t=da(e);return this.ranges.has(t)}_update(e=null){if(y(e)){let L=j1(e,e.value);this.saveValue(e,L),L?this.valueCache.set(e,L):this.valueCache.delete(e)}this.resetButton&&(Ro(this.resetButton,this.valueCache.size>0,"Reset","Clear out filters"),En(this.resetButton,this.valueCache.size>0,"btn-secondary"),En(this.resetButton,this.valueCache.size===0,"btn-outline-secondary"));let t=0;for(let L=0;L<this.rows.length;++L){let S=this.rows[L],x=!0;for(let v=0;v<this.filterElements.length&&x;++v){let M=this.filterElements[v],O=this.columnIndices.get(M);if(this.isRange(M)){let[B,X]=this.ranges.get(O),V=this.valueCache.get(B),J=this.valueCache.get(X),ce=S.children[O],G=Ny(ce,B),Y=null;if(y(V)&&y(J)?Y=G.map(K=>V<=K&&K<=J):y(V)?Y=G.map(K=>V<=K):y(J)&&(Y=G.map(K=>K<=J)),Y){let K=Y.reduce((se,$)=>se||$,!1);x&&=K}}else{let B=this.valueCache.get(M);if(B){let X=S.children[O],ce=Ny(X,M).map(G=>oe(G)?!0:_o(G)?B.getTime()===G.getTime():mt(G)?G===B:B==="XXX_NONE_XXX"?G.length===0||G==="NONE":M.classList.contains("exact")?G.toLocaleLowerCase()===B:G.toLocaleLowerCase().indexOf(B)>-1).reduce((G,Y)=>G||Y,!1);x&&=ce}}}x&&++t,S.style.display=x?"":"none"}let i=Math.ceil(t/this.pageSize),r=Math.max(0,i-1),o=Math.min(r,Math.floor(this.pageIndex/this.pageSize));this.pageIndex=o*this.pageSize;let s=Math.min(r,o+1),l=Math.max(0,o-1),c=o*this.pageSize,u=c+this.pageSize,p=this.rows.filter(L=>L.style.display!=="none");for(let L=0;L<p.length;++L)(L<c||u<=L)&&(p[L].style.display="none");this.noContentMessageElement.style.display=t===0?"":"none",St(this.paginator);let d=[],h=L=>{let S=vp(d,L,sue);S<0&&bi(d,L,S)};h(0),h(o),h(l),h(s),h(r);let A=r*this.pageSize,g=Math.max(0,this.pageIndex-this.pageSize),F=(L,S)=>{let x;return S?x=VF(L):x=Dr(Aa(ui(5),ui(10)),L),this.paginator.append(x),x},b=(L,S)=>{let x=0<=S&&S<=A&&S!==this.pageIndex,v=F(L,x);x&&v.addEventListener("click",()=>{this.pageIndex=S,this.update()})},R=L=>{let S=L!==this.pageSize,x=F(L.toString(),S);S&&x.addEventListener("click",()=>{this.pageSize=L,this.update()})};b("<",g);let P=-1;for(let L of d){let S=L-P;P=L,S>1&&F("...",!1),b((L+1).toFixed(0),L*this.pageSize)}if(b(">",u),F("|",!1),F(`${t} filtered items of ${this.rows.length} results`,!1),this.pageSizes.length>2){F("|",!1),F("Items per page:",!1);for(let L=1;L<this.pageSizes.length;++L)this.rows.length>this.pageSizes[L-1]&&R(this.pageSizes[L])}}};var G1=class extends ge{constructor(){super("searching")}},X1=class extends ge{constructor(){super("searchcomplete")}},uf=class extends Be{constructor(t,i){super();this.fetcher=t;this.table=cf.create({resourceName:"file-picker",columns:[{header:"ID",filter:yi(),getCellValue:r=>r.id.toFixed(0)},{header:"Name",filter:ni(),getCellValue:r=>r.name},{header:"Type",filter:this.typeSelector=Vi(),getCellValue:r=>r.mediaType},{header:"Tags",filter:ni(Tp(i)),getCellValue:r=>r.tagsString},{header:"Size",getCellValue:r=>r.sizeString},{getCellValue:(r,o)=>{let s=jn("Select",Ye(()=>this.selectFile(s,r)));return this.selectors.push(s),this.rows.set(s,o),s}}]})}table;typeSelector;get element(){return this.table.element}typeFilters=new Array;selectors=new Array;rows=new Map;_selectedFile=null;tagFilter=null;typeFilter=null;get selectedFile(){return this._selectedFile}get hasFile(){return y(this._selectedFile)}upload(){return Promise.resolve(this.selectedFile)}get requirementsMet(){return this.hasFile}setTypeFilters(...t){un(this.typeFilters,...t),this.typeFilter=bs(this.typeFilters),St(this.typeSelector),Ee(this.typeSelector,bn(Qt(""),"--"),...this.typeFilters.map(i=>bn(Qt(i.value),i.value)))}clearFileSelection(t){this.tagFilter=t.join(),this.selectFile(null,null)}search(t){return this.tagFilter=t,this.update()}async update(){this.dispatchEvent(new G1),qe(this.selectors),this.rows.clear();let t={typeFilter:this.typeFilter,tagFilter:this.tagFilter};this.table.noContentMessage="Searching...",this.table.clear();let i=await this.fetcher.post("/Editor/Files/Search").body(t,Jr).object().then(We);this.table.noContentMessage="No content.",this.table.setValues(...i),this.dispatchEvent(new X1)}selectFile(t,i){this._selectedFile=i;for(let r of this.selectors){let o=this.rows.get(r),s=t===r;En(o,s,"selected"),r.disabled=s}this._selectedFile&&(this.dispatchEvent(new Ol),this.dispatchEvent(new Nl(this._selectedFile)))}};var pf=di("Juniper:TSLib:MediaTypeDB",()=>{let n=new Map;function e(s){if(!s)return console.warn("Couldn't guess media type. Must provide a valid fileName."),[];let l=s.lastIndexOf(".");if(l===-1)return console.warn("Couldn't guess media type. FileName has no extension."),[];let c=s.substring(l);return c?c[0]=="."&&(c=c.substring(1)):c="unknown",n.has(c)?n.get(c):[new Eo("unknown",c,[c])]}function t(s,l){if(!l&&s.indexOf(".")>-1){let c=e(s);c.length>0&&(l=c[0].value)}return l}function i(s){let l=!1,c=s.__getValueUnsafe();if(s=di("Juniper.MediaTypes:"+c,()=>(l=!0,s)),l)for(let u of s.__getExtensionsUnsafe()){n.has(u)||n.set(u,new Array);let p=n.get(u);p.indexOf(s)<0&&p.push(s)}return s}let r={normalizeFileType:t};function o(s){Object.values(s).forEach(i)}return o(Pg),o(Rg),o(Ig),o(Bg),o(Vg),o(Og),o(Ng),o(Wg),o(zg),o(Yg),o(Kg),o(Qg),r});var q1=class extends ge{constructor(e){super("input"),this.files=e}},df=class extends Be{get dragTarget(){return this._dragTarget}set dragTarget(e){e!==this.dragTarget&&(this.dragTarget&&(this.dragTarget.removeEventListener("dragover",this.onDragOver),this.dragTarget.removeEventListener("dragend",this.onDragEnd),this.dragTarget.removeEventListener("dragleave",this.onDragEnd),this.dragTarget.removeEventListener("drop",this.onDrop)),this._dragTarget=e,this.dragTarget&&Ee(this.dragTarget,za(this.onDragOver),dv(this.onDragEnd),Ua(this.onDragEnd),dd(this.onDrop)))}constructor(e,t,i,r=null){super(),this.file=i,this.typeFilters=new Array,this.element=null,this._dragTarget=null;let o=c=>Array.from(c).filter(u=>this.typeFilters.length===0||this.typeFilters.filter(p=>p.matches(u.type)).length>0),s=c=>Array.from(c).filter(u=>u.kind=="file"&&(this.typeFilters.length===0||this.typeFilters.filter(p=>p.matches(u.type)).length>0));this.onDragOver=c=>{this.enabled&&(s(c.dataTransfer.items).length>0?Ie(this.element,"Drop file..."):Ie(this.element,"No files matching expected type(s)")),c.preventDefault()},this.onDragEnd=c=>{this.enabled&&Ie(this.element,e),c.preventDefault()},this.onDrop=c=>{this.enabled&&l(c.dataTransfer.files),this.onDragEnd(c)};let l=c=>{let u=o(c);u.length>0&&this.dispatchEvent(new q1(u))};this.file.style.display="none",this.file.insertAdjacentElement("afterend",this.element=zi(de("btn",`btn-${t}`),Ye(()=>this.show()),e)),this.dragTarget=r||this.element,this.file.addEventListener("input",()=>l(this.file.files)),this.setTypeFilters(),this.enabled=!0}show(){this.file.showPicker?this.file.showPicker():this.file.click()}setTypeFilters(...e){un(this.typeFilters,...e),this.file.accept=bs(e)}isExpectedType(e){return oe(e)?!1:this.typeFilters.length===0?!0:this.typeFilters.map(t=>t.matches(e)).reduce((t,i)=>t||i,!1)}get accept(){return this.file.accept}get enabled(){return!this.file.disabled}set enabled(e){this.file.disabled=!e,this.element.disabled=!e}get disabled(){return!this.enabled}set disabled(e){this.enabled=!e}get files(){return this.file.files}clear(){this.file.value=null}};var hf=class extends Be{constructor(t,i){super();this.fetcher=t;this.element=Ae(Ji.create(["File",this.picker=new df("Upload new file","primary",iA(Lo(!0))),this.selectionMessage=Ae()],["Copyright",this.copyrightInput=ni(At("copyright"),Do("copyright"),Lo(!0))],["Copyright date",this.copyrightDateInput=Ip(At("copyrightDate"),Do("copyrightDate"),Lo(!0))],["Tags",this.tagPicker=new Wl(i)]),this.uploadProgress=nf("progress")),this.picker.dragTarget=this.element,this.picker.addEventListener("input",async o=>{o.files.length>0&&(this.selectedFile=o.files[0],this.selectedType=this.selectedFile.type,(oe(this.selectedType)||this.selectedType.length===0)&&(this.selectedType=pf.normalizeFileType(this.selectedFile.name,this.selectedType)),this.refresh(),this.dispatchEvent(new sf(this.selectedFile,this.selectedType)))});let r=this.refresh.bind(this);this.copyrightInput.addEventListener("input",r),this.copyrightDateInput.addEventListener("input",r)}element;picker;selectionMessage;copyrightInput;copyrightDateInput;tagPicker;uploadProgress;selectedFile=null;selectedType=null;setTypeFilters(...t){this.picker.setTypeFilters(...t)}get accept(){return this.picker.accept}addMessage(t){Ee(this.selectionMessage,Ae(t))}refresh(){St(this.selectionMessage),this.hasType&&!this.hasCorrectType&&this.addMessage(`Unexpected file type: ${this.selectedType}. Expected: ${this.picker.accept}`),this.hasCopyright||this.addMessage("Copyright holder is required"),this.hasCopyrightDate||this.addMessage("Copyright date is required"),this.dispatchEvent(new Bl)}clearFileSelection(t){this.uploadProgress.clear(),this.selectedType=null,this.picker.clear(),this.copyrightInput.value=null,this.copyrightDateInput.value=null,this.tagPicker.tags=t,this.refresh()}get tagString(){return this.tagPicker.tags.join(",")}get hasFile(){return y(this.selectedFile)}get hasType(){return y(this.selectedType)}get hasCorrectType(){return this.picker.isExpectedType(this.selectedType)}get hasCopyright(){return this.copyrightInput.value.length>0}get hasCopyrightDate(){return this.copyrightDateInput.validity.valid}get requirementsMet(){return this.hasFile&&this.hasCorrectType&&this.hasCopyright&&this.hasCopyrightDate}upload(){let t=new FormData;return t.set("FormFile",this.selectedFile,this.selectedFile.name),t.set("Copyright",this.copyrightInput.value),t.set("CopyrightDate",this.copyrightDateInput.valueAsDate.toDateString()),t.set("TagString",this.tagString),this.fetcher.post("/editor/files/create").body(t).progress(this.uploadProgress).object().then(We)}};var $u=class extends zs{constructor(){super("Cancellation!")}},go=class{constructor(){this._cancelled=!1}get cancelled(){return this._cancelled}check(){if(this.cancelled)throw new $u}cancel(){this._cancelled=!0}};var mf=D0(qy(),1);var K1="2.16.105";var Ju=di("Juniper:PdfReady",()=>new et(!1)),Fr=class extends Hr{static async prepare(e,t,i,r,o){let s=null;if(r instanceof go?s=r:o=r,s=s||new go,!Ju.started){Ju.start(),console.info(`PDF.js v${K1}`);let l=new Gi(e,location.href);l.query("v",K1),e=l.toString(),mf.GlobalWorkerOptions.workerSrc=await t.get(e).useCache(!i).progress(o).file().then(We),s.check(),Ju.resolve()}await Ju,s.check()}get curPageIndex(){return this._curPageIndex}get curPageNumber(){return this.curPageIndex+1}get canGoBack(){return this._curPageIndex>0}get canGoForward(){return this._curPageIndex<this.numPages-1}constructor(e,t){super(1,1),this.viewportParams=t,this.pdf=null,this._curPageIndex=null,this.ready=this.load(e)}async load(e){await Ju;let t=mf.getDocument(e);if(this.pdf=await t.promise,this.pdf.numPages===0)throw new Error("No pages found in PDF")}async getPage(e){if(await this.ready,e=ri(e,0,this.pdf.numPages-1),e!==this._curPageIndex){this._curPageIndex=e;let t=await this.pdf.getPage(e+1),i=t.getViewport(this.viewportParams);Oa(this.g,i.width,i.height),await t.render({canvasContext:this.g,viewport:i,intent:"print"}).promise,this.dispatchEvent(this.redrawnEvt)}}get numPages(){return this.pdf?this.pdf.numPages:null}onRedraw(){return!1}};function Zu(n){return new URL(URL.createObjectURL(n))}function Yy(n){let e=new Map;for(let[t,i]of n)e.set(i,t);return e}function lue(n){return n!=="B"&&n[1]==="i"}function Ky(n){return n!=="B"&&!Ky(n)}var Qy=new Map([[1,"KiB"],[2,"MiB"],[3,"GiB"],[4,"TiB"]]),$y=new Map([[1,"KB"],[2,"MB"],[3,"GB"],[4,"TB"]]),cue=Yy(Qy),uue=Yy($y),pue=new Map([[2,Qy],[10,$y]]);function Jy(n,e=10){let t=n<0;n=Math.abs(n);let i=e===2?1024:1e3,r=Math.min(4,Math.floor(Math.log(n)/Math.log(i))),o=Math.pow(i,r);2*n>=i*o&&r<4&&(r++,o*=i);let s;r===0?s="B":(s=pue.get(e).get(r),n/=o);let l=n%1===0;return`${t?"-":""}${n.toFixed(l?0:2)} ${s}`}function Zy(n,e){if(e==="B")return n;{let t,i;lue(e)?(t=1024,i=cue.get(e)):Ky(e)?(t=1e3,i=uue.get(e)):yt(e);let r=Math.pow(t,i);return n*r}}function due(n,e){Ue(Gr,!0,"block"),Ue(nT,!e,"block"),Ue(iT,e,"block");let t=n.src.match(/\/file\/(\d+)$/);if(e&&t){let i=parseInt(t[1],10);iT.src=`/Editor/PhotosphereViewer?FileID=${i}`}else nT.src=n.src}function eT(){Gr.style.display="none"}var tT=new WeakSet;function rT(){let n=document.querySelectorAll(".thumbnail");for(let e of n)tT.has(e)||(e.addEventListener("click",()=>due(e,e.classList.contains("photosphere"))),tT.add(e))}var oT="33D0371F-B096-473D-AEE3-B17F5392CCEC",Gr=document.getElementById(oT);Gr||(Gr=Ae(At(oT),de("thumbnail-view"),Jt("none"),Gn(Ii("Thumbnail")),Ca(Ii("Preview"))));var nT=Gr.querySelector("img"),iT=Gr.querySelector("iframe");Gr.parentElement||(Ee(document.body,Gr),Gr.addEventListener("pointerleave",eT),Gr.addEventListener("click",eT));var hue=Sa("audio","*"),mue=Sa("image","*"),fue=Sa("text","*"),gue=Sa("video","*"),ff=class{constructor(e,t,i){this.element=e;this.fetcher=t;this.audioSys=i;Fr.prepare(Ls("pdfjs"),t,!0),this.yt=new Al(this.fetcher,ms);let r=this.audioSys;if(r instanceof sl){let s=new hl(r.destination);this.vid=new mu(r,s),this.aud=new xl(r,s)}else this.vid=new mu(r.audio.context,r.audio.noSpatializer),this.aud=r.audioPlayer,r=r.audio.context;let o=this.element.dataset.json;if(y(o)){let s=JSON.parse(o);this.setFile(s,...s.tagsString.split(",").map(l=>l.trim().toLowerCase()))}}_hasFile;yt;vid;aud;get hasFile(){return this._hasFile}showLoading(){this.setElement(Ae("Loading"),"Loading","Loading",null)}async setFile(e,...t){this.showLoading();let i=null,r=null,o=null,s=null,l=null;if(e instanceof URL){let u=await this.fetcher.get(ms(e)).file();i=u.content,o=u.fileName??e.href,r=u.contentType,s=u.contentLength}else e instanceof File?(i=URL.createObjectURL(e),o=e.name,r=e.type,s=e.size):(i=e.filePath,o=e.name,r=e.mediaType,s=e.size,l=e.metadata);(oe(r)||r.length===0)&&(r=pf.normalizeFileType(o,r));let c=null;if(hs.matches(r)){let u=await this.yt.loadData(l||i);oe(u.videos)||u.videos.length===0?c=await this.aud.load(u):c=await this.vid.load(u)}else Hg.matches(r)||Ec.matches(r)?c=this.makeIFrame(i):Zr.matches(r)?c=await this.makePDF(i):hue.matches(r)?c=this.makeAudio(i):gue.matches(r)?c=this.makeVideo(i):mue.matches(r)?c=this.makeImage(i):fue.matches(r)||_a.matches(r)||sr.matches(r)?c=await this.makeText(i):c=await this.makeUnknown(i);this.setElement(c,r,o,s,...t)}clear(){St(this),this._hasFile=!1}makeAudio(e){return Ui(_i(!0),Un(e))}makeVideo(e){return Es(_i(!0),Un(e))}async makeText(e){let t=await this.fetcher.get(e).text().then(We);return Cr(t)}async makePDF(e){let t=new Fr(e,{scale:1.44});await t.getPage(0);let i=await no(t.canvas,Tr),r=Zu(i);return Gn(de("thumbnail","image"),Un(r))}makeImage(e){return Gn(de("thumbnail","image"),Un(e))}makeUnknown(e){return Ae(`Cannot preview file at path: ${e}`)}makeIFrame(e){return Ca(Un(e))}setElement(e,t,i,r,...o){e=$t(e),this._hasFile=e.tagName!=="DIV",St(this),Ee(this,Pp(i),Ae(r&&`${t}: ${Jy(r)}`||""),Ee(e,de(...o))),(e.tagName==="IMG"||e.tagName==="CANVAS")&&rT()}};var gf="existingTags",xf=class extends Mi{constructor(t,i){super("File Upload");this.fetcher=t;this.element.classList.add("file-picker"),this.preview=new ff(Ae(Ct("preview")),this.fetcher,i),Ee(this.contentArea,this.existingTags=WF(At(gf)),this.tabs=tf(Ae(qt("tab-name","Upload new file"),this.uploadTab=new hf(this.fetcher,gf)),Ae(qt("tab-name","Link to file"),this.linkTab=new lf(this.fetcher,gf)),Ae(qt("tab-name","Pick existing file"),this.selectTab=new uf(this.fetcher,gf))),this.preview);let r=()=>this.refresh(),o=()=>this.preview.showLoading(),s=l=>this.preview.setFile(l.file,...this.tags);this.uploadTab.addEventListener("refresh",r),this.linkTab.addEventListener("refresh",r),this.linkTab.addEventListener("selecting",o),this.selectTab.addEventListener("selecting",o),this.uploadTab.addEventListener("fileselected",s),this.linkTab.addEventListener("filedataselected",s),this.linkTab.addEventListener("urlselected",s),this.selectTab.addEventListener("filedataselected",l=>{r(),s(l)}),this.selectTab.addEventListener("searching",()=>{this.confirmButton.disabled=!0,this.cancelButton.disabled=!0}),this.selectTab.addEventListener("searchcomplete",()=>{this.confirmButton.disabled=!this.canConfirm,this.cancelButton.disabled=!1}),this.tabs.addEventListener("tabselected",this.clearFileSelection.bind(this)),this.getTags()}preview;tags=new Array;tabs;existingTags;uploadTab;linkTab;selectTab;_selectedFile=null;get selectedFile(){return this._selectedFile}setTags(...t){un(this.tags,...t),this.tags.sort()}setTypeFilters(...t){this.uploadTab.setTypeFilters(...t),this.linkTab.setTypeFilters(...t),this.selectTab.setTypeFilters(...t)}async getTags(){let t=await this.fetcher.get("/editor/files/tags").object().then(We);St(this.existingTags),this.existingTags.append(...t.map(i=>bn(Qt(i),i)))}clearFileSelection(){this.preview.clear(),this.uploadTab.clearFileSelection(this.tags),this.linkTab.clearFileSelection(this.tags),this.selectTab.clearFileSelection(this.tags)}onShown(){super.onShown(),this.clearFileSelection(),this.tabs.select("upload-file"),this.selectTab.search(this.tags.join())}async onConfirm(){this.confirmButton.disabled=!0,this._selectedFile=await this.currentTab.upload(),super.onConfirm()}onClosed(){this.clearFileSelection(),this.preview.clear(),this.getTags(),super.onClosed()}get isUploading(){return this.tabs.isSelected("upload-file")}get isLinking(){return this.tabs.isSelected("link-file")}get isSelecting(){return this.tabs.isSelected("pick-file")}get currentTab(){return this.isUploading&&this.uploadTab||this.isLinking&&this.linkTab||this.isSelecting&&this.selectTab}get canConfirm(){return this.currentTab.requirementsMet}refresh(){let t=this.canConfirm?"Confirm":this.isUploading?"Upload requirements not met":this.isLinking?"Link requirements not met":"No file choice made";Ro(this.confirmButton,this.canConfirm,t,t)}};var er=class extends pt{data;M=new vt;constructor(e){super(),this.data=e,this.name=e.name,this.M.fromArray(e.matrix),this.M.decompose(this.position,this.quaternion,this.scale)}get transformID(){return this.data.id}};var wf=class extends Be{constructor(){super(),this.event=new ge("quitting");let e=()=>this.dispatchEvent(this.event);window.addEventListener("beforeunload",e),window.addEventListener("unload",e),window.addEventListener("pagehide",e)}};var xue=298.257223563,sT=6378137,wue=.9996,Fue=5e5,Ff=1/xue,Af=1-Ff,_t=Ff/(2-Ff),Aue=sT/(1+_t)*(1+_t*_t/4+_t*_t*_t*_t/64),ep=Math.sqrt(1-Af*Af),Wi=1-Af*Af,vue=ep*ep/(1-ep*ep),bue=1-Wi*(.25+Wi*(3/64+5*Wi/256)),Sue=Wi*(3/8+Wi*(3/32+45*Wi/1024)),_ue=Wi*Wi*(15/256+Wi*45/1024),yue=Wi*Wi*Wi*(35/3072),Tue=[_t/2-2*_t*_t/3+37*_t*_t*_t/96,_t*_t/48+_t*_t*_t/15,17*_t*_t*_t/480],Eue=[2*_t-2*_t*_t/3,7*_t*_t/3-8*_t*_t*_t/5,56*_t*_t*_t/15],Bt={FalseNorthing:1e7,equatorialRadius:sT,pointScaleFactor:wue,E0:Fue,A:Aue,flattening:Ff,e:ep,esq:Wi,e0sq:vue,alpha1:bue,alpha2:Sue,alpha3:_ue,alpha4:yue,beta:Tue,delta:Eue};var Ul=class n{static centroid(e){let t=new Map;e.forEach(l=>t.set(l.zone,(t.get(l.zone)||0)+1));let i=0,r=0;for(let[l,c]of t)c>r&&(i=l,r=c);let o=1/e.length,s=e.map(l=>l.rezone(i).toVec3()).reduce((l,c)=>Rt.scaleAndAdd(l,l,c,o),Rt.create());return new n().fromVec3(s,i).toLatLng().toUTM()}get easting(){return this._easting}get northing(){return this._northing}get altitude(){return this._altitude}get zone(){return this._zone}get hemisphere(){return this.northing>=0?"northern":"southern"}constructor(e,t,i,r){ci(e)?(this._easting=e.easting,this._northing=e.northing,this._altitude=e.altitude,this._zone=e.zone):(this._easting=e||0,this._northing=t||0,this._altitude=i||0,this._zone=r||0)}toJSON(){return JSON.stringify({easting:this.easting,northing:this.northing,altitude:this.altitude,zone:this.zone,hemisphere:this.hemisphere})}toString(){return`(${this.easting}, ${this.northing}, ${this.altitude}) zone ${this.zone}`}equals(e){return y(e)&&this.hemisphere==e.hemisphere&&this.easting==e.easting&&this.northing==e.northing&&this.altitude==e.altitude&&this.zone==e.zone}static A(e,t,i){let r=3+6*(i-1)-180;return je(t-r)*e}static getZoneWidthAtLatitude(e){let t=je(e),i=Math.sin(t),r=Math.cos(t),o=i/r,s=Bt.e*i,l=Bt.equatorialRadius/Math.sqrt(1-s*s),c=o*o,u=Bt.e0sq*r*r,p=c*c,d=je(3)*r,h=d*d,A=1-c+u,g=5-18*c+p+72*u-58*Bt.e0sq,F=A/6+h*g/120,b=1+h*F;return 2*Bt.pointScaleFactor*l*d*b}fromLatLng(e){let t=je(e.lat),i=Math.sin(t),r=Math.cos(t),o=2*r,s=o*i,l=o*r-1,c=2*l,u=c*s,p=c*l-1,d=u*l+p*s,h=i/r,A=Bt.e*i,g=Bt.equatorialRadius/Math.sqrt(1-A*A),F=Bt.equatorialRadius*(t*Bt.alpha1-s*Bt.alpha2+u*Bt.alpha3-d*Bt.alpha4),b=1+(e.lng+180)/6|0,R=n.A(r,e.lng,b),P=R*R,L=h*h,S=Bt.e0sq*r*r,x=L*L,v=1-L+S,M=5-18*L+x+72*S-58*Bt.e0sq,O=P*M/120,B=v/6+O,X=1+P*B,V=Bt.pointScaleFactor*g*R*X+Bt.E0,J=5-L+9*S+4*S*S,ce=61-58*L+x+600*S-330*Bt.e0sq,G=J/24+P*ce/720,Y=.5+P*G,K=F+g*h*P*Y,se=Bt.pointScaleFactor*K;return this._easting=V,this._northing=se,this._altitude=e.alt,this._zone=b,this}rezone(e){if(!(1<=e&&e<=60))throw new Error(`Zones must be on the range [1, 60]. Given: ${e}`);if(e!==this.zone){let t=e-this.zone,i=this.toLatLng(),r=n.getZoneWidthAtLatitude(i.lat);return new n(this.easting-r*t,this.northing,this.altitude,e)}else return this}toLatLng(){return new wi().fromUTM(this)}toVec2(){let e=lt.create();return lt.set(e,this.easting,-this.northing),e}fromVec2(e,t){return this._easting=e[0],this._northing=-e[1],this._altitude=0,this._zone=t,this}toVec3(){let e=Rt.create();return Rt.set(e,this.easting,this.altitude,-this.northing),e}fromVec3(e,t){return this._easting=e[0],this._altitude=e[1],this._northing=-e[2],this._zone=t,this}copy(e){return this._easting=e.easting,this._northing=e.northing,this._altitude=e.altitude,this._zone=e.zone,this}clone(){return new n(this)}};var wi=class n{static centroid(e){let t=1/e.length,i=e.map(r=>r.toVec3()).reduce((r,o)=>Rt.scaleAndAdd(r,r,o,t),Rt.create());return new n().fromVec3(i)}get alt(){return this._alt}get lat(){return this._lat}get lng(){return this._lng}constructor(e,t,i){ci(e)?(this._lat=e.lat,this._lng=e.lng,this._alt=e.alt):(this._lat=e||0,this._lng=t||0,this._alt=i)}toJSON(){return JSON.stringify({lat:this.lat,lng:this.lng,alt:this.alt})}static parseDMS(e){let t=e.split(" ");if(t.length==3){let i=t[0],r=parseInt(t[1],10),o=parseFloat(t[2]);if((i=="N"||i=="S"||i=="E"||i=="W")&&Number.isInteger(r)&&Number.isFinite(o)){let s=r+o/60;return(i=="S"||i=="W")&&(s*=-1),s}}return Number.NaN}static parseDMSPair(e){let t=e.split(",");if(t.length==2){let i=n.parseDMS(t[0]),r=n.parseDMS(t[1]);if(!Number.isNaN(i)&&!Number.isNaN(r))return new n(i,r)}return null}static parseDecimal(e){let t=e.split(",");if(t.length==2){let i=parseFloat(t[0].trim()),r=parseFloat(t[1].trim());if(Number.isFinite(i)&&Number.isFinite(r))return new n(i,r)}return null}static parse(e){let t=n.parseDecimal(e),i=n.parseDMSPair(e);return t||i}toDMS(e,t=!0){let i=n.toDMS(this.lat,"S","N",e),r=n.toDMS(this.lng,"W","E",e);if(this.alt&&t){let o=`${this.alt.toFixed(e)}m`;return`<${i}, ${r}> alt ${o}`}else return`<${i}, ${r}>`}toDMSArray(e,t=!1){let i=[n.toDMS(this.lat,"S","N",e),n.toDMS(this.lng,"W","E",e)];return this.alt&&t&&i.push(`${this.alt.toFixed(e)}m`),i}static toDMS(e,t,i,r){let o=e<0?t:i;e=Math.abs(e);let s=Math.floor(e),l=(e-s)*60,c=Math.floor(l),p=((l-c)*60).toFixed(r);for(;p.indexOf(".")<=1;)p=`0${p}`;return`${o} ${s.toFixed(0)}\xB0 ${c.toFixed(0)}' ${p}"`}toString(e){return e=e||6,`(${this.lat.toFixed(e)}\xB0, ${this.lng.toFixed(e)}\xB0)`}equals(e){return ci(e)&&this.lat==e.lat&&this.lng==e.lng&&this.alt==e.alt}compareTo(e){if(oe(e))return-1;{let t=this.lat-e.lat,i=this.lng-e.lng,r=(this.alt||0)-(e.alt||0);return t==0&&i==0?r:t==0?i:t}}distance(e){let t=this.toUTM(),i=e.toUTM().rezone(t.zone),r=i.easting-t.easting,o=i.northing-t.northing;return Math.sqrt(r*r+o*o)}fromUTM(e){let t=e.hemisphere==="southern"&&e.northing>=0?Bt.FalseNorthing:0,i=(e.northing-t)/(Bt.pointScaleFactor*Bt.A),r=(e.easting-Bt.E0)/(Bt.pointScaleFactor*Bt.A),o=i,s=r;for(let d=1;d<=3;++d){let h=Bt.beta[d-1],A=2*d*i,g=2*d*r,F=Math.sin(A),b=Math.cosh(g),R=Math.cos(A),P=Math.sinh(g);o-=h*F*b,s-=h*R*P}let l=Math.asin(Math.sin(o)/Math.cosh(s)),c=l;for(let d=1;d<=3;++d)c+=Bt.delta[d-1]*Math.sin(2*d*l);let u=e.zone*6-183,p=Math.atan(Math.sinh(s)/Math.cos(o));for(this._lat=Lt(c),this._lng=u+Lt(p);this._lng<-180;)this._lng+=360;for(;this._lng>180;)this._lng-=360;return this._alt=e.altitude,this}toUTM(){return new Ul().fromLatLng(this)}toVec2(){let e=lt.create();return lt.set(e,this.lng,this.lat),e}fromVec2(e){return this._lng=e[0],this._lat=e[1],this._alt=void 0,this}toVec3(){let e=Rt.create();return Rt.set(e,this.lng,this.alt,this.lat),e}fromVec3(e){return this._lng=e[0],this._alt=e[1],this._lat=e[2],this}toArray(){return[this._lng,this._alt,this._lat]}fromArray(e){return this.fromVec3(e)}copy(e){return this._lat=e.lat,this._lng=e.lng,this._alt=e.alt,this}clone(){return new n(this)}};function xo(n,e,t){let i=e.map(()=>1),r=Et(n,i);return Promise.all(e.map(async(o,s)=>{let l=r[s];l.start();let c=await t(o,l,s);return l.end(),c}))}var Q1=class extends ge{constructor(e,t){super("itemevicted"),this.key=e,this.value=t}},vf=class extends Be{constructor(e){super(),this.size=e,this.map=new Map,this.usage=new Array,this.removed=new Map}set(e,t){for(this.usage.push(e);this.usage.length>this.size;){let i=this.usage.shift();y(i)&&(this.removed.set(i,this.map.get(i)),this.map.delete(i))}this.removed.delete(e);for(let[i,r]of this.removed)this.dispatchEvent(new Q1(i,r));return this.removed.clear(),this.map.set(e,t)}has(e){return this.map.has(e)}get(e){return this.map.get(e)}delete(e){return this.map.has(e)?(Pt(this.usage,e),this.map.delete(e)):!1}clear(){qe(this.usage),this.map.clear()}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}};var tp=2,zl=2048,jl=new Rr,Xr;(function(n){n[n.Low=90]="Low",n[n.Medium=60]="Medium",n[n.High=45]="High",n[n.Fine=30]="Fine"})(Xr||(Xr={}));var kue=new Map([[Xr.Low,4],[Xr.Medium,8],[Xr.High,3],[Xr.Fine,2]]),aT=[[an,0,0,1],[-an,0,2,1],[0,an,1,0],[0,-an,1,2],[en,0,3,1],[0,0,1,1]],bf=class{constructor(e,t){this.fetcher=e,this.fixWatermarks=t,this.baseURL=null,this.isDebug=!1,this.disposed=!1,this.canvas=ur(zl,zl),this.renderer=new Pd({canvas:this.canvas,alpha:!1,antialias:!1,depth:!0,logarithmicDepthBuffer:!1,powerPreference:"low-power",precision:"lowp",stencil:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1}),this.camera=new Bs(90),this.photosphere=new Ga,this.scene=De(new No,new Fd(16777215,1),this.camera,this.photosphere),this.geometry=new Oo(1,1,1,1)}init(e,t){this.baseURL=e,this.isDebug=t}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){for(let e of this.scene.children)ut(e);Tt(this.renderer)}async renderFaces(e,t,i){this.clear(),await this.loadFrames(t,i,e);let r=await Promise.all(aT.map(async([o,s,l,c])=>{let u=wr.rotations[c][l];jl.set(s,o,u,"YXZ"),this.camera.setRotationFromEuler(jl),this.renderer.render(this.scene,this.camera);let p=await no(this.renderer.domElement,yr.value,1);return URL.createObjectURL(p)}));return this.clear(),r}async renderCubeMap(e,t,i){this.clear();let r=ur(zl*4,zl*3),o=r.getContext("2d",{alpha:!1});await this.loadFrames(t,i,e);for(let[c,u,p,d]of aT)jl.set(u,c,0,"YXZ"),this.camera.setRotationFromEuler(jl),this.renderer.render(this.scene,this.camera),o.drawImage(this.renderer.domElement,p*zl,d*zl);let s=await no(r,yr.value,1),l=URL.createObjectURL(s);return this.clear(),l}getImageAngles(e){let t=new Array,i=e,r=this.fixWatermarks?kue.get(i):0;for(let o=-90+i;o<90;o+=i)for(let s=-180;s<180;s+=i)t.push([s,o,i+r,tp]);return t.push([0,-90,i+r,tp]),t.push([0,90,i+r,tp]),this.fixWatermarks&&(t.push([0,-90,i,.5*tp]),t.push([0,90,i,.5*tp])),t}async loadFrames(e,t,i){let r=this.getImageAngles(e);await xo(t,r,(o,s)=>this.loadFrame(i,...o,s))}async loadFrame(e,t,i,r,o,s){let l=.5*je(r),c=Math.tan(l),u=.5*o/c,p=e(r,t,i),d=await this.fetcher.get(p,this.baseURL).progress(s).useCache(!this.isDebug).canvas().then(We),h=new Vs(d),A=new Yn({map:h,side:bd}),g=hr(`frame-${r}-${t}-${i}`,this.geometry,A);h.needsUpdate=!0,A.needsUpdate=!0,jl.set(je(i),-je(t),0,"YXZ"),g.scale.setScalar(o),g.quaternion.setFromEuler(jl),g.position.set(0,0,-u).applyQuaternion(g.quaternion),De(this.photosphere,g)}clear(){for(let e of this.photosphere.children)ut(e);this.photosphere.clear()}};var Sf=class n extends ct{constructor(e,t,...i){super(e,t),this.width=null,this.alts=i}random(){let e=Math.floor(Math.random()*this.alts.length);if(e<0)return null;let t=this.alts[e];return t instanceof n?t.random():t}contains(e){if(super.contains(e))return!0;for(let t of this.alts)if(t.contains(e))return!0;return!1}};var lT=new Sf("Keycap Digits","Keycap Digits",HA,UA,zA,jA,GA,XA,qA,YA,KA,QA,$A);var Mue=new ge("play"),Due=new ge("stop"),si=.1,cT=new Map(lT.alts.map((n,e)=>[n.value,e.toString()])),Gl=class extends Ti{constructor(e,t,i,r,o,s,l){super(),this.data=i,this.volume=s,this.player=l,this.playButton=null,this.pauseButton=null,this.stopButton=null,this.replayButton=null,this.clickPlay=null,this.disposed=!1,o=cT.get(o)||o||"",this.object=ft(`playback-${r}`),this.textLabel=new mi(e,`playback-${r}-label`,"none",{minHeight:si,minWidth:4*si,maxWidth:4*si,padding:.02,scale:1e3,bgFillColor:t.labelFillColor,textFillColor:"white"}),this.textLabel.image.value=o,this.textLabel.image.addEventListener("redrawn",()=>this.repositionLabel()),this.progressBar=new Ei(4*si,.025,.01,Ud),this.progressBar.visible=!1,this.clickPlay=async()=>{this.player.data!==this.data&&await this.player.load(this.data,this),this.player.volume=this.volume,await this.player.play()},this.load(t,l)}dispose(){this.disposed||(this.data===this.player.data&&this.player.clear(),ut(this.object),this.disposed=!0)}repositionLabel(){this.textLabel.position.y=-(si+this.textLabel.objectHeight)/2}async load(e,t){let[i,r,o,s]=await sn(e.getMeshButton("media","play",si),e.getMeshButton("media","pause",si),e.getMeshButton("media","stop",si),e.getMeshButton("media","replay",si));De(this,this.playButton=i,this.pauseButton=r,this.stopButton=o,this.replayButton=s,this.progressBar,this.textLabel),this.playButton.object.position.x=-1.5*si,this.pauseButton.object.position.x=-.5*si,this.stopButton.object.position.x=.5*si,this.replayButton.object.position.x=1.5*si,this.progressBar.position.y=-si/2,this.progressBar.position.z=.01,this.repositionLabel();let l=()=>{let d=t.data===this.data;this.playButton.disabled=d&&(t.playbackState==="loading"||t.playbackState==="playing"||t.playbackState==="errored")||!d&&t.playbackState==="loading",this.pauseButton.disabled=!d||t.playbackState==="loading"||t.playbackState!=="playing",this.replayButton.disabled=this.stopButton.disabled=!d||t.playbackState==="loading"||t.playbackState==="stopped"||t.playbackState==="errored",(!d||t.playbackState==="loading"||t.playbackState==="stopped")&&(this.progressBar.visible=!1)};l();let c=d=>h=>{h.source.data===this.data&&d(h)},u=c(l);t.addEventListener("loading",l),t.addEventListener("loaded",u),t.addEventListener("played",u),t.addEventListener("paused",u),t.addEventListener("stopped",l),t.addEventListener("progress",c(d=>this.report(d.value,d.total))),t.addEventListener("played",c(()=>this.dispatchEvent(Mue))),t.addEventListener("stopped",c(()=>this.dispatchEvent(Due)));let p=(d,h)=>{d.addEventListener("click",h)};p(this.playButton,this.clickPlay),p(this.pauseButton,()=>t.pause()),p(this.stopButton,()=>t.stop()),p(this.replayButton,()=>t.restart())}get label(){return y(this.textLabel.image)?this.textLabel.image.value:null}set label(e){e=cT.get(e)||e,this.textLabel.image.value=e}report(e,t,i,r){super.report(e,t,i,r);let o=this.p*4*si;this.progressBar.position.x=.5*(o-4*si),this.progressBar.scale.x=o,this.progressBar.visible=e>0}};var _f=new Se,Xl=class{constructor(e,t,i,r){this.scenario=e;this.parent=t;this.player=i;this.zone=r.zone,this.minDistance=r.minDistance,this.maxDistance=r.maxDistance,this.spatialize=r.spatialize,this.effect=r.effect,this.label=r.label,this.volume=r.volume,this.enabled=r.enabled,this.transformID=r.transformID,this.key=r.key,this.scenarioID=r.scenarioID,this.fileID=r.fileID,this.fileName=r.fileName,this.filePath=r.filePath,this.fileTagString=r.fileTagString,this.mediaType=r.mediaType,this.trueMediaType=r.trueMediaType,this.copyright=r.copyright,this.copyrightDate=r.copyrightDate}scenarioID;key;fileID;filePath;fileTagString;mediaType;trueMediaType;copyright;copyrightDate;spatialize;transformID;zone;minDistance;maxDistance;effect;label;volume;enabled;fileName;clip=null;controls=null;error=null;get effects(){return oe(this.effect)?[]:this.effect.split(",").map(e=>e.trim()).filter(e=>e.length>0)}async load(e){if(y(this.error))return Promise.resolve();this.disposed=!1;try{this.spatialize?(this.clip=await this.scenario.env.audio.createClip(this.transformID.toString(),this.filePath,this.spatialize,this.spatialize,this.spatialize,this.spatialize,this.volume,this.effects,e),this.clip.spatializer.setAudioProperties(this.minDistance,this.maxDistance,this.scenario.env.audio.algorithm),this.updateAudioPosition()):(De(this.parent,this.controls=new Gl(this.scenario.env,this.scenario.env.uiButtons,this.filePath,`${this.fileName}(${this.transformID})`,this.label,this.volume,this.player)),this.controls.addScopedEventListener(this,"play",()=>{this.scenario.log("play audio",{id:this.transformID})}),this.controls.addScopedEventListener(this,"stop",()=>{this.scenario.log("stop audio",{id:this.transformID})}))}catch(t){this.error=t,this.dispose()}}async reload(e){let t=this.clip&&this.clip.playbackState==="playing";this.dispose(),this.player.cacheBust(this.filePath),await this.load(e),t&&this.clip.play()}updateAudioPosition(){this.parent.getWorldPosition(_f),this.scenario.env.audio.setClipPosition(this.transformID.toString(),_f.x,_f.y,_f.z)}disposed=!1;dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){y(this.clip)&&(this.scenario.env.audio.removeClip(this.transformID.toString()),this.clip=null),y(this.controls)&&(this.controls.removeScope(this),this.controls.object.removeFromParent(),this.controls.dispose(),this.controls=null)}play(){return y(this.error)?Promise.resolve():y(this.clip)?this.clip.play():this.controls.clickPlay()}reset(){y(this.error)||(y(this.clip)?this.clip.stop():this.player.stop())}};var uT=` ${WA.textStyle} `,Cue=new pt,np=class n extends Ti{constructor(t,i,r,o,s){super();this.env=t;this.transform=i;this.from=r;this.to=o;s=s||uT,this.icon=new js(this.env,"navButton",s,CA),this.icon.addEventListener("click",l=>{this.enabled&&this.dispatchEvent(l)}),this.transform.scale.setScalar(.5),this.progressBar=new Ei(this.icon.image.width,.025,.01,Ud),this.progressBar.position.y=-this.icon.image.height/2,this.progressBar.position.z=.01,De(this.transform,De(this.icon,this.progressBar))}icon;progressBar;get object(){return this.transform}get fromStationID(){return this.from.transformID}get toStationID(){return this.to.transformID}get transformID(){return this.transform&&this.transform.transformID}report(t,i,r,o){super.report(t,i,r,o);let s=this.icon.image.width*this.p;this.progressBar.position.x=.5*(s-this.icon.image.width),this.progressBar.scale.x=s}get label(){return this.icon.image.value}set label(t){this.icon.image.value=this.icon.image.value=t||uT}get enabled(){return!this.icon.disabled}set enabled(t){this.icon.disabled=!t,this.progressBar.visible=!t}static calcMatrix(t,i,r,o=null){o=o||Cue;let s=o.parent;return s&&s.remove(o),o.position.copy(i.position),o.position.sub(t.position),o.position.y=0,o.position.normalize(),o.position.multiplyScalar(1.5),o.position.y+=1,o.lookAt(0,r,0),o.updateMatrix(),s&&De(s,o),o.matrix}resetPosition(){n.calcMatrix(this.from,this.to,this.env.defaultAvatarHeight,this.object)}};var $1=class extends ge{constructor(e){super("dwell"),this.dwellTimeSeconds=e}},qr=class extends Be{constructor(e=1,t=.25){super(),this.minTimeSeconds=e,this.graceTimeSeconds=t,this.startTime=null,this.graceTimer=null,Object.seal(this)}start(){this.stopGrace(),this.startTime===null&&(this.startTime=performance.now())}stopGrace(){this.graceTimer!==null&&(clearTimeout(this.graceTimer),this.graceTimer=null)}stop(){this.startTime!==null&&(this.graceTimer=setTimeout(()=>{this.graceTimer=null;let e=(performance.now()-this.startTime)/1e3;this.startTime=null,e>this.minTimeSeconds&&this.dispatchEvent(new $1(e))},this.graceTimeSeconds*1e3))}};var pT=di("Yarrow:Model:modelTemplateTasks",()=>new Map),ql=class extends pt{constructor(t,i,r){super();this.scenario=t;this.name=`model-${i.fileName}`,this.key=i.key,this.scenarioID=i.scenarioID,this.fileID=i.fileID,this.fileName=i.fileName,this.filePath=i.filePath,this.fileTagString=i.fileTagString,this.transformID=i.transformID,this.mediaType=i.mediaType,this.trueMediaType=i.trueMediaType,this.copyright=i.copyright,this.copyrightDate=i.copyrightDate,this.target=new Qn(this),De(r,this),Object.seal(this)}model=null;key;scenarioID;fileID;fileName;filePath;fileTagString;mediaType;trueMediaType;copyright;copyrightDate;transformID;target;error=null;disposed=!1;dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){y(this.model)&&(this.model.removeFromParent(),ut(this.model),this.model=null)}async load(t){if(y(this.error))return Promise.resolve();this.disposed=!1;let i=pT.get(this.filePath);if(!i){let s=new uo(this.scenario.env,this.filePath,this.mediaType,!this.scenario.env.DEBUG);i=s.then(l=>{try{Ns(l.scene,Ws)}catch(c){this.error=c}return l}),pT.set(this.filePath,i),this.scenario.env.fetcher.assets(t,s)}let r=await i,o=new qr;o.addEventListener("dwell",s=>{this.scenario.log("model viewed",{id:this.transformID,time:s.dwellTimeSeconds})}),this.model=r.scene.clone(!0),this.model.traverse(s=>{Kn(s)&&this.target.addMesh(s)}),this.target.addEventListener("enter",s=>{s.pointer.type==="nose"&&o.start()}),this.target.addEventListener("exit",s=>{s.pointer.type==="nose"&&o.stop()}),De(this,this.model)}async reload(t){this.dispose(),this.error=null,await this.load(t)}get size(){return this.parent.scale.x}set size(t){this.parent.scale.setScalar(t)}get rotationX(){return Lt(this.parent.rotation.x)}get rotationY(){return Lt(this.parent.rotation.y)}get rotationZ(){return Lt(this.parent.rotation.z)}};var hT=1e3,Lue=1e3/hT,dT=new Se,J1=.15,Z1=.1,Pue={minHeight:Z1,maxHeight:Z1,minWidth:Z1,padding:.02,scale:1e3,bgFillColor:Ha,textFillColor:"white"},Yl=class n extends pt{constructor(t,i,r){super();this.scenario=t;this.followObj=this.scenario.env.worldUISpace,this.onClick=()=>this.toggle(),this.key=i.key,this.scenarioID=i.scenarioID,this.fileID=i.fileID,this.fileName=i.fileName,this.filePath=i.filePath,this.fileTagString=i.fileTagString,this.mediaType=i.mediaType,this.trueMediaType=i.trueMediaType,this.copyright=i.copyright,this.copyrightDate=i.copyrightDate,this.transformID=i.transformID,this.name=`sign-${i.fileName}`,this.originPoint.copy(this.position),this.originRotation.copy(this.quaternion),De(r,this),this._alwaysVisible=i.alwaysVisible,this._isCallout=i.isCallout,this.start=-1,this.end=0,this.t=1,this.direction=-1,this.target=new Qn(this),this.scenario.addScopedEventListener(this,"present",o=>{this.direction!==-1&&o.source!==this&&this.toggle()})}image;start;end;t;direction;key;scenarioID;fileID;fileName;filePath;fileTagString;mediaType;trueMediaType;copyright;copyrightDate;transformID;followObj;onClick;target;static offsetMatrix=new vt().makeTranslation(0,0,-1.5);originPoint=new Se;originRotation=new it;_isCallout=!1;wasCallout=null;_alwaysVisible=!1;wasAlwaysVisible=null;opacity=1;lastOpacity=null;file=null;pdf=null;zoomInButton=null;zoomOutButton=null;prevButton=null;pageLabel=null;nextButton=null;error=null;disposed=!1;dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){this.scenario.removeScope(this),y(this.image)&&(this.image.dispose(),this.image=null),this.removeButton(this.zoomInButton),this.zoomInButton=null,this.removeButton(this.zoomOutButton),this.zoomOutButton=null,this.removeButton(this.prevButton),this.prevButton=null,this.removeButton(this.nextButton),this.nextButton=null,this.removeButton(this.pageLabel),this.pageLabel=null,this.pdf=null}removeButton(t){y(t)&&(t instanceof Be&&t.removeScope(this),Os(t)&&(t.object.removeFromParent(),ut(t)))}async load(t){if(y(this.error))return Promise.resolve();this.disposed=!1;try{let[i,r,o]=await sn(this.scenario.env.fetcher.get(this.filePath).progress(t).file(),this.scenario.env.uiButtons.getMeshButton("zoom","in",J1),this.scenario.env.uiButtons.getMeshButton("zoom","out",J1));if(this.file=i,this.zoomInButton=r,this.zoomInButton.addScopedEventListener(this,"click",this.onClick),this.zoomInButton.object.visible=this.isCallout,this.zoomOutButton=o,this.zoomOutButton.addScopedEventListener(this,"click",this.onClick),this.zoomOutButton.object.visible=!1,De(this,this.zoomInButton,this.zoomOutButton),Zr.matches(this.file.contentType)){this.pdf=new Fr(this.file.content,{scale:2});let[l,c]=await sn(this.scenario.env.uiButtons.getMeshButton("arrow","left",.1),this.scenario.env.uiButtons.getMeshButton("arrow","right",.1));De(this,this.prevButton=l,this.pageLabel=new mi(this.scenario.env,"label-"+this.transformID,"none",Pue,{side:Rs}),this.nextButton=c),this.prevButton.addScopedEventListener(this,"click",()=>this.loadImage(this.pdf.curPageIndex-1)),this.nextButton.addScopedEventListener(this,"click",()=>this.loadImage(this.pdf.curPageIndex+1))}De(this,this.image=new xr(this.scenario.env,`Sign(${this.key}) ${i.fileName}`,"dynamic"));let s=new qr;s.addEventListener("dwell",l=>{this.scenario.log("sign viewed",{id:this.transformID,time:l.dwellTimeSeconds})}),this.target.clickable=!0,this.target.addEventListener("click",this.onClick),this.target.addEventListener("enter",l=>{l.pointer.type==="nose"&&s.start()}),this.target.addEventListener("exit",l=>{l.pointer.type==="nose"&&s.stop()}),await this.loadImage(0)}catch(i){this.error=i,this.dispose()}}async reload(t){this.dispose(),this.error=null,await this.load(t)}async loadImage(t){this.pdf&&(this.prevButton.disabled=!0,this.nextButton.disabled=!0);let i=await this.getFrame(t);if(this.image.setTextureMap(i),this.image.objectWidth=1,this.pdf){let r=this.image.objectHeight/2;this.prevButton.object.visible=this.pageLabel.object.visible=this.nextButton.object.visible=this.hasPages,this.hasPages&&(this.prevButton.object.position.set(-.5,-r,.1),this.pageLabel.position.set(0,-r,.1),this.nextButton.object.position.set(.5,-r,.1),this.prevButton.disabled=!this.pdf.canGoBack,this.pageLabel.image.value=`${this.pdf.curPageNumber} of ${this.pdf.numPages}`,this.nextButton.disabled=!this.pdf.canGoForward)}}async getFrame(t){return this.pdf?(this.scenario.log("view sign page",{id:this.transformID,page:t}),await this.pdf.getPage(t),this.pdf.canvas):await this.scenario.env.fetcher.get(this.file.content).image().then(We)}get isCallout(){return this._isCallout}set isCallout(t){this._isCallout=t,this.update(0)}get hasPages(){return this.pdf&&this.pdf.numPages>1}get alwaysVisible(){return this._alwaysVisible}set alwaysVisible(t){this._alwaysVisible=t,this.update(0)}get isClickable(){return this.isCallout||!this.alwaysVisible}get showZoomIn(){return this.isClickable&&this.direction===-1&&this.t>=this.end}get showZoomOut(){return this.isClickable&&this.direction===1&&this.t>=this.end}toggle(){if(!y(this.error)&&this.isClickable){if(this.direction!==1){this.scenario.log("expand sign",{id:this.transformID}),this.target.addMesh(this.image.mesh),this.direction=1;let i=new Kl(this);this.scenario.dispatchEvent(i)}else this.target.removeMesh(this.image.mesh),this.direction=-1;let t=Math.max(0,this.end-this.t);this.start=performance.now(),this.end=this.start+hT,this.t=this.start+t}}reset(){y(this.error)||(this.isClickable&&(this.start=-1,this.t=0,this.end=0,this.direction=-1),y(this.image)&&this.image.removeWebXRLayer())}invMatrix=new vt;dumpScale=new Se;update(t){if(y(this.error)||!y(this.parent))return;if(y(this.zoomInButton)&&(this.zoomInButton.object.visible=this.showZoomIn,this.zoomOutButton.object.visible=this.showZoomOut,this.isCallout!==this.wasCallout||this.alwaysVisible!==this.wasAlwaysVisible)){let s=this.image.objectWidth/2,l=this.image.objectHeight/2;this.zoomInButton.object.visible=this.isClickable,this.zoomOutButton.object.visible=!1,this.alwaysVisible?this.zoomInButton.object.position.set(s,l,.1):this.zoomInButton.object.position.set(0,0,0),this.zoomOutButton.object.position.set(s,l,.1),this.wasCallout=this.isCallout,this.wasAlwaysVisible=this.alwaysVisible}this.t+=Lue*t;let i=qc(this.t,this.start,this.end),r=ri(i,0,1),o=this.direction===1?1-r:r;this.isCallout&&(this.invMatrix.copy(this.parent.matrixWorld).invert().multiply(this.followObj.matrixWorld).multiply(n.offsetMatrix).decompose(this.position,this.quaternion,this.dumpScale),this.position.lerp(this.originPoint,o),this.quaternion.slerp(this.originRotation,o)),y(this.zoomInButton)&&(this.zoomInButton.object.lookAt(this.scenario.env.avatar.worldPos),this.zoomInButton.object.getWorldPosition(dT),this.zoomInButton.size=this.zoomOutButton.size=J1*dT.sub(this.scenario.env.avatar.worldPos).length()/(3*this.size),this.zoomOutButton.object.matrix.copy(this.zoomInButton.object.matrix)),this.alwaysVisible?this.opacity=1:this.opacity=this.alwaysVisible?1:1-o,this.opacity!==this.lastOpacity&&(this.image.mesh.material.opacity=this.opacity,this.image.mesh.material.transparent=this.opacity<1,this.image.mesh.material.needsUpdate=!0,this.image.mesh.visible=0<this.opacity&&this.opacity<1||!(this.scenario.env.showWebXRLayers&&this.scenario.env.hasXRCompositionLayers),this.image.webXRLayerType=this.opacity===1?"dynamic":"none",y(this.pdf)&&(this.prevButton.object.visible=this.pageLabel.object.visible=this.nextButton.object.visible=this.hasPages&&this.opacity===1),this.lastOpacity=this.opacity)}get size(){return this.parent.scale.x}set size(t){this.parent.scale.setScalar(t)}get rotationX(){return Lt(this.parent.rotation.x)}get rotationY(){return Lt(this.parent.rotation.y)}get rotationZ(){return Lt(this.parent.rotation.z)}};var Ql=class{constructor(e,t){this.scenario=e;this.key=t.key,this.scenarioID=t.scenarioID,this.transformID=t.transformID,this.fileID=t.fileID,this.fileName=t.fileName,this.filePath=t.filePath,this.fileTagString=t.fileTagString,this.mediaType=t.mediaType,this.trueMediaType=t.trueMediaType,this.copyright=t.copyright,this.copyrightDate=t.copyrightDate,this.location=t.location,this.zone=t.zone,this.label=t.label,this.rotation=t.rotation}key;scenarioID;transformID;fileID;filePath;fileTagString;mediaType;trueMediaType;copyright;copyrightDate;location;zone;label;rotation;fileName;async reload(e){this.scenario.evict(this),this.scenario.curStation===this&&await this.scenario.env.withFade(async()=>{this.scenario.env.skybox.clear(),await this.scenario.showStation(this,!1,e)})}};var gT=1e3,Rue=1e3/gT,mT=new Se,fT=.15,e0=.2,Iue={minHeight:e0,maxHeight:e0,minWidth:e0,padding:.04,scale:1e3,bgFillColor:"white",textFillColor:"black",bgStrokeColor:Ha,bgStrokeSize:.01},$l=class n extends pt{constructor(t,i,r){super();this.scenario=t;this.followObj=this.scenario.env.worldUISpace,this.onClick=()=>this.toggle(),this.key=i.key,this.scenarioID=i.scenarioID,this.fileID=i.fileID,this.fileName=i.fileName,this.filePath=i.filePath,this.fileTagString=i.fileTagString,this.mediaType=i.mediaType,this.trueMediaType=i.trueMediaType,this.copyright=i.copyright,this.copyrightDate=i.copyrightDate,this.transformID=i.transformID,this.name=`text-${i.fileName}`,this.originPoint.copy(this.position),this.originRotation.copy(this.quaternion),De(r,this),this._alwaysVisible=i.alwaysVisible,this._isCallout=i.isCallout,this.start=-1,this.end=0,this.t=1,this.direction=-1,this.target=new Qn(this),this.scenario.addScopedEventListener(this,"present",o=>{this.direction!==-1&&o.source!==this&&this.toggle()})}image;start;end;t;direction;key;scenarioID;fileID;fileName;filePath;fileTagString;mediaType;trueMediaType;copyright;copyrightDate;transformID;get text(){return this.image.image.value}set text(t){this.image.image.value=t}followObj;onClick;target;static offsetMatrix=new vt().makeTranslation(0,0,-1.5);originPoint=new Se;originRotation=new it;_isCallout=!1;wasCallout=null;_alwaysVisible=!1;wasAlwaysVisible=null;opacity=1;lastOpacity=null;zoomInButton=null;error=null;disposed=!1;dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){this.scenario.removeScope(this),y(this.image)&&(this.image.dispose(),this.image=null),this.removeButton(this.zoomInButton),this.zoomInButton=null}removeButton(t){y(t)&&(t instanceof Be&&t.removeScope(this),Os(t)&&(t.object.removeFromParent(),ut(t)))}async load(t){if(y(this.error))return Promise.resolve();this.disposed=!1;try{let[i,r]=await sn(this.scenario.env.fetcher.get(this.filePath).progress(t).text(),this.scenario.env.uiButtons.getMeshButton("zoom","info",fT));this.zoomInButton=r,this.zoomInButton.addScopedEventListener(this,"click",this.onClick),this.zoomInButton.object.visible=this.isCallout,De(this,this.zoomInButton),De(this,this.image=new mi(this.scenario.env,`Text(${this.key}) ${i.fileName}`,"dynamic",Iue));let o=new qr;o.addEventListener("dwell",s=>{this.scenario.log("text viewed",{id:this.transformID,time:s.dwellTimeSeconds})}),this.target.clickable=!0,this.target.addEventListener("click",this.onClick),this.target.addEventListener("enter",s=>{s.pointer.type==="nose"&&o.start()}),this.target.addEventListener("exit",s=>{s.pointer.type==="nose"&&o.stop()}),this.image.image.value=i.content}catch(i){this.error=i,this.dispose()}}async reload(t){this.dispose(),this.error=null,await this.load(t)}get isCallout(){return this._isCallout}set isCallout(t){this._isCallout=t,this.update(0)}get alwaysVisible(){return this._alwaysVisible}set alwaysVisible(t){this._alwaysVisible=t,this.update(0)}get isClickable(){return this.isCallout||!this.alwaysVisible}get showZoomIn(){return this.isClickable&&this.direction===-1&&this.t>=this.end}toggle(){if(!y(this.error)&&this.isClickable){if(this.direction!==1){this.scenario.log("expand text",{id:this.transformID}),this.target.addMesh(this.image.mesh),this.direction=1;let i=new Kl(this);this.scenario.dispatchEvent(i)}else this.target.removeMesh(this.image.mesh),this.direction=-1;let t=Math.max(0,this.end-this.t);this.start=performance.now(),this.end=this.start+gT,this.t=this.start+t}}reset(){y(this.error)||(this.isClickable&&(this.start=-1,this.t=0,this.end=0,this.direction=-1),y(this.image)&&this.image.removeWebXRLayer())}invMatrix=new vt;dumpScale=new Se;update(t){if(y(this.error)||!y(this.parent))return;if(y(this.zoomInButton)&&(this.zoomInButton.object.visible=this.showZoomIn,this.isCallout!==this.wasCallout||this.alwaysVisible!==this.wasAlwaysVisible)){let s=this.image.objectWidth/2,l=this.image.objectHeight/2;this.zoomInButton.object.visible=this.isClickable,this.alwaysVisible?this.zoomInButton.object.position.set(s,l,.1):this.zoomInButton.object.position.set(0,0,0),this.wasCallout=this.isCallout,this.wasAlwaysVisible=this.alwaysVisible}this.t+=Rue*t;let i=qc(this.t,this.start,this.end),r=ri(i,0,1),o=this.direction===1?1-r:r;this.isCallout&&(this.invMatrix.copy(this.parent.matrixWorld).invert().multiply(this.followObj.matrixWorld).multiply(n.offsetMatrix).decompose(this.position,this.quaternion,this.dumpScale),this.position.lerp(this.originPoint,o),this.quaternion.slerp(this.originRotation,o)),y(this.zoomInButton)&&(this.zoomInButton.object.lookAt(this.scenario.env.avatar.worldPos),this.zoomInButton.object.getWorldPosition(mT),this.zoomInButton.size=fT*mT.sub(this.scenario.env.avatar.worldPos).length()/(3*this.size)),this.alwaysVisible?this.opacity=1:this.opacity=this.alwaysVisible?1:1-o,this.opacity!==this.lastOpacity&&(this.image.mesh.material.opacity=this.opacity,this.image.mesh.material.transparent=this.opacity<1,this.image.mesh.material.needsUpdate=!0,this.image.mesh.visible=0<this.opacity&&this.opacity<1||!(this.scenario.env.showWebXRLayers&&this.scenario.env.hasXRCompositionLayers),this.image.webXRLayerType=this.opacity===1?"dynamic":"none",this.lastOpacity=this.opacity)}get size(){return this.parent.scale.x}set size(t){this.parent.scale.setScalar(t)}get rotationX(){return Lt(this.parent.rotation.x)}get rotationY(){return Lt(this.parent.rotation.y)}get rotationZ(){return Lt(this.parent.rotation.z)}};var Jl=class extends pt{constructor(t,i,r,o,s){super();this.scenario=t;this.proxy=i;this.player=o;this.label=s.label,this.volume=s.volume,this.enabled=s.enabled,this.transformID=s.transformID,this.key=s.key,this.scenarioID=s.scenarioID,this.fileID=s.fileID,this.fileName=s.fileName,this.filePath=s.filePath,this.fileTagString=s.fileTagString,this.mediaType=s.mediaType,this.trueMediaType=s.trueMediaType,this.copyright=s.copyright,this.copyrightDate=s.copyrightDate,this.sphereEncodingName=s.sphereEncodingName,this.stereoLayoutName=s.stereoLayoutName,this.name="video-"+s.fileName,De(r,De(this,this.thumbnail=new xr(this.scenario.env,"thumbnail-"+s.fileName,"static"))),this.size=r.scale.x,r.scale.setScalar(1),this.target=new Qn(this),Object.seal(this)}transformID;key;scenarioID;fileID;filePath;fileTagString;mediaType;trueMediaType;copyright;copyrightDate;fileName;label;volume;enabled;sphereEncodingName;stereoLayoutName;controls=null;data=null;error=null;thumbnail;target;disposed=!1;dispose(){this.disposed||(this.onDisposing(),this.disposed=!0)}onDisposing(){y(this.thumbnail)&&this.thumbnail.dispose(),y(this.controls)&&(this.controls.removeScope(this),this.controls.dispose())}async load(t){if(y(this.error))return Promise.resolve();try{let i=Et(t,[10,1]);if(hs.matches(this.mediaType)){this.data=await this.proxy.loadData(this.filePath,i.shift());let l=await this.scenario.env.fetcher.get(this.data.thumbnail.url).image(this.data.thumbnail.contentType).then(We);this.thumbnail.setTextureMap(l),this.thumbnail.objectWidth=1,this.thumbnail.mesh.renderOrder=4}let r=this.label||this.data&&this.data.title&&this.data.title.substring(0,25)||this.fileName;De(this,De(this.controls=new Gl(this.scenario.env,this.scenario.env.uiButtons,this.data||this.filePath,this.filePath,r,this.volume,this.player))),this.controls.object.renderOrder=5,this.controls.object.position.y=-this.thumbnail.objectHeight/2,this.controls.object.position.z=.01;let o=l=>()=>{this.thumbnail.visible=!l,this.player.object.visible=l,l?(this.scenario.log("play video",{id:this.transformID}),De(this,this.player),this.player.setStereoParameters(this.sphereEncodingName,this.stereoLayoutName),this.player.object.position.set(0,0,0),this.player.object.quaternion.identity(),this.target.addMeshes(...this.player.meshes)):(this.scenario.log("stop video",{id:this.transformID}),this.target.removeMeshes(...this.player.meshes))};this.controls.addScopedEventListener(this,"play",o(!0)),this.controls.addScopedEventListener(this,"stop",o(!1));let s=new qr;s.addEventListener("dwell",l=>{this.scenario.log("video viewed",{id:this.transformID,time:l.dwellTimeSeconds})}),this.target.addEventListener("enter",l=>{l.pointer.type==="nose"&&s.start()}),this.target.addEventListener("exit",l=>{l.pointer.type==="nose"&&s.stop()}),this.disposed=!1}catch(i){this.error=i,this.dispose()}}async reload(t){this.dispose(),await this.load(t)}reset(){y(this.error)||(this.player.stop(),y(this.thumbnail)&&this.thumbnail.removeWebXRLayer())}get size(){return this.scale.x}set size(t){this.scale.x=this.scale.y=t}get rotationX(){return Lt(this.parent.rotation.x)}get rotationY(){return Lt(this.parent.rotation.y)}get rotationZ(){return Lt(this.parent.rotation.z)}};function xT(n,e,t,i){return`/Editor/Google/StreetView/Image/${n}/${e}/${t}/${i}/`}var yf=class extends bf{constructor(e){super(e,!0)}loadFiles(e,t,i){return this.renderFaces(xT.bind(null,e),t,i)}loadFile(e,t,i){return this.renderCubeMap(xT.bind(null,e),t,i)}async loadImages(e,t,i){let r=await this.loadFiles(e,t,i);return await Promise.all(r.map(Va))}async loadCanvas(e,t,i){let r=await this.loadFile(e,t,i),o=await Va(r);return zp(o)}};var Tf=class extends Hc{canvases;init(e,t){this.callMethod("init",[e,t])}propogateEvent(e){yt(e.eventName)}loadFiles(e,t,i){return this.callMethod("loadFiles",[e,t],i)}loadFile(e,t,i){return this.callMethod("loadFile",[e,t],i)}async loadImages(e,t,i){let r=await this.loadFiles(e,t,i);return await Promise.all(r.map(Va))}async loadCanvas(e,t,i){let r=await this.loadFile(e,t,i),o=await Va(r);return zp(o)}};var Ef=class extends Uc{constructor(e,t){e.workers!==1&&(e.workers=1),super(e,t)}get canvases(){return this.peekWorker().canvases}init(e,t){for(let i of this.workers)i.init(e,t)}loadImages(e,t,i){return this.nextWorker().loadImages(e,t,i)}loadCanvas(e,t,i){return this.nextWorker().loadCanvas(e,t,i)}};async function wT(n,e,t){let i=null;if(Ln(e)?t=e:i=e,i=i||new go,!ed()&&t){let r=await n.get(IA("three")).text().then(We);i.check();let o=await n.get(RA("photosphere-capture")).text().then(We);i.check();let s=r+o,l=new Blob([s],{type:sr.value}),c=URL.createObjectURL(l);return new Ef({scriptPath:c},Tf)}else return n=n||sd(!1),new yf(n)}var t0=class extends ge{constructor(t){super("navigate");this.station=t}},Kl=class extends Event{source;constructor(e){super("present"),this.source=e,Object.seal(this)}},ip=class extends Be{constructor(t,i,r){super();this.env=t;this.dataLogger=i;this.data=r;this.imgCache.addEventListener("itemevicted",l=>{Np(l.value)&&l.value.close()}),this.yt=new Al(this.env.fetcher,ms),y(r.origin)&&(this._originLL=new wi(r.origin)),this.startStationID=r.startStationID,this.startRotation=r.startRotation,this.transforms=r.transforms,this.connections=r.connections,this.env.addScopedEventListener(this,"environmentaudiotoggled",()=>{this.environmentAudioMuted=t.environmentAudioMuted});let o=!1,s=()=>{o||(o=!0,this.logLeaveStation(),this.log("leave scenario",{id:this.id}))};this.env.addScopedEventListener(this,"quitting",s),this.windowQuitter.addScopedEventListener(this,"quitting",s),this.env.addScopedEventListener(this,"sceneclearing",()=>{this.pauseCurrentAudioZone(),this.curZone=null}),this.env.avatar.addScopedEventListener(this,"avatarreset",()=>{this.moveToStation(this.curStation)})}yt;transforms;connections;stations=new Array;signs=new Array;videos=new Array;texts=new Array;audios=new Array;models=new Array;get isEmpty(){return this.stations.length===0&&this.connections.length===0&&this.signs.length===0&&this.videos.length===0&&this.texts.length===0&&this.audios.length===0&&this.models.length===0}signsByStation=new Zt;videosByStation=new Zt;textsByStation=new Zt;audiosByStation=new Zt;modelsByStation=new Zt;curConnections=new Bn;transformsByTransformID=new Map;zonedClips=new Zt;playbackButtons=new Map;videosReady=null;cancellationToken=null;rig;curStationID=null;curZone=null;startStationID;startRotation;rootTransformID=null;get rootTransform(){return this.transformsByTransformID.get(this.rootTransformID)}__originLL=null;get _originLL(){return this.__originLL}set _originLL(t){this.__originLL=t,y(t)?this._originUTM=this.originLL.toUTM():this._originUTM=null}get originLL(){return this._originLL}_originUTM=null;get originUTM(){return this._originUTM}get id(){return this.data.id}get name(){return this.data.name}get version(){return this.data.version}get published(){return this.data.published}get roomName(){return this.data.roomName}windowQuitter=new wf;async loadAssets(t){this.cancellationToken=new go,this.clearCache(),this.rig=await wT(this.env.fetcher,this.cancellationToken),this.rig.init(location.href,this.env.DEBUG),t=t||this.env.loadingBar;let[i,r]=Et(t,[1,100]);await Fr.prepare(Ls("pdfjs"),this.env.fetcher,this.env.DEBUG,i);for(let l of this.data.transforms)this.addTransformData(l);for(let l of this.data.transforms)if(l.parentTransformID===0)this.rootTransformID=l.id;else{let c=this.getTransform(l.parentTransformID),u=this.getTransform(l.id);c.attach(u)}let[o,s]=Et(r,[10,1]);this.videosReady=xo(s,this.data.videoClips,(l,c)=>this.createVideo(l,c).catch(u=>{if(u instanceof $u)console.warn("Late load cancellation occured");else throw u})).then(()=>null),await Bc(o,[[this.data.stations.length,l=>xo(l,this.data.stations,(c,u)=>this.createStation(c,u))],[this.data.signs.length,l=>xo(l,this.data.signs,(c,u)=>this.createSign(c,u))],[this.data.models.length,l=>xo(l,this.data.models,(c,u)=>this.createModel(c,u))],[this.data.audioTracks.length,l=>xo(l,this.data.audioTracks,(c,u)=>this.createAudio(c,u))],[this.data.texts.length,l=>xo(l,this.data.texts,(c,u)=>this.createText(c,u))]]);for(let l of this.data.connections)this.createConnection(l);this.env.addScopedEventListener(this,"update",l=>this.update(l))}disposed=!1;dispose(){if(!this.disposed){this.cancellationToken&&this.cancellationToken.cancel(),this.env.infoLabel.image.clear(),this.pauseCurrentAudioZone(),this.env.removeScope(this),this.env.avatar.removeScope(this);for(let i of this.audios)i.dispose();for(let i of this.signs)i.dispose();for(let i of this.models)i.dispose();for(let i of this.videos)i.dispose();for(let i of this.texts)i.dispose();let t=this.transformsByTransformID.get(this.rootTransformID);t.removeFromParent(),ut(t),this.transformsByTransformID.clear(),this.signsByStation.clear(),this.audiosByStation.clear(),this.videosByStation.clear(),this.textsByStation.clear(),this.modelsByStation.clear(),this.zonedClips.clear(),qe(this.audios),qe(this.videos),qe(this.texts),qe(this.signs),qe(this.models),this.windowQuitter.removeScope(this),this.disposed=!0}}get avatarHeightOffset(){return this.env.avatar.height-this.env.defaultAvatarHeight}update(t){let i=this.signsByStation.get(this.curStation);for(let o of i)o.update(t.dt);let r=this.textsByStation.get(this.curStation);for(let o of r)o.update(t.dt)}_muteEnvAudio=!1;get environmentAudioMuted(){return this._muteEnvAudio}set environmentAudioMuted(t){t!==this.environmentAudioMuted&&(this._muteEnvAudio=t,this.environmentAudioMuted?this.pauseCurrentAudioZone():this.playCurrentAudioZone())}addTransformData(t){let i=new er(t);return this.transformsByTransformID.set(i.transformID,i),i}getTransform(t){return this.transformsByTransformID.get(t)}getStation(t){return Rn(this.stations,i=>i.transformID===t)}get curStation(){return this.getStation(this.curStationID)}get startStation(){return this.getStation(this.startStationID)}async createStation(t,i){i&&i.end();let r=new Ql(this,t);return this.stations.push(r),r}async createConnection(t){try{let i=this.getStation(t.fromStationID),r=this.getStation(t.toStationID),o=this.getTransform(i.transformID),s=this.getTransform(r.transformID),l=this.getTransform(t.transformID);if(oe(l)){t.transformID=-this.transforms.length;let u={id:t.transformID,name:`nav-icon-from-${o.name}-to-${s.name}`,matrix:np.calcMatrix(o,s,this.env.defaultAvatarHeight).toArray(),parentTransformID:i.transformID};this.transforms.push(u),l=this.addTransformData(u),De(o,l)}let c=new np(this.env,l,o,s,t.label);return c.addEventListener("click",()=>{this.dispatchEvent(new t0(r)),this.showStation(r,!0,this.env.loadingBar)}),this.curConnections.add(i,r,c),c}catch(i){return console.error({task:"createConnection",err:i,data:t}),null}}async createSign(t,i){let r=this.getTransform(t.transformID),o=new Yl(this,t,r);this.signs.push(o),await o.load(i),this.cancellationToken.check();let s=this.findStation(o);return this.signsByStation.add(s,o),o}async createModel(t,i){let r=this.getTransform(t.transformID),o=new ql(this,t,r);this.models.push(o),await o.load(i),this.cancellationToken.check();let s=this.findStation(o);return this.modelsByStation.add(s,o),o}async createAudio(t,i){let r=this.getTransform(t.transformID),o=new Xl(this,r,this.env.audioPlayer,t);this.audios.push(o);let s=this.findStation(o.parent);return this.audiosByStation.add(s,o),await o.load(i),this.cancellationToken.check(),y(o.controls)&&(this.playbackButtons.set(o.parent,o.controls),oe(o.error)&&(o.controls.addEventListener("play",()=>this.pauseCurrentAudioZone()),o.controls.addEventListener("stop",()=>this.playCurrentAudioZone()))),y(o.clip)&&this.zonedClips.add(o.zone,o.clip),o}async createVideo(t,i){let r=this.getTransform(t.transformID),o=new Jl(this,this.yt,r,this.env.videoPlayer,t);this.videos.push(o),await o.load(i),this.cancellationToken.check(),this.playbackButtons.set(o.parent,o.controls);let s=this.findStation(o.parent);return this.videosByStation.add(s,o),oe(o.error)&&(o.controls.addEventListener("play",()=>this.pauseCurrentAudioZone()),o.controls.addEventListener("stop",()=>this.playCurrentAudioZone())),o}async createText(t,i){let r=this.getTransform(t.transformID),o=new $l(this,t,r);this.texts.push(o),await o.load(i),this.cancellationToken.check();let s=this.findStation(o);return this.textsByStation.add(s,o),o}getConnectionLabel(t,i){if(oe(t)||oe(i))return null;for(let r of this.connections)if(r.fromStationID===t.transformID&&r.toStationID===i.transformID)return r.label;return null}getStationByObject(t){return t instanceof er?this.getStation(t.transformID):null}findStation(t){let i=this.getStationByObject(t);for(;!i&&t!=null;)t=t.parent,i=this.getStationByObject(t);return i}getStationCenter(t){let i=new Se,r=this.getTransform(t.transformID);return r&&r.getWorldPosition(i),i.y+=this.env.defaultAvatarHeight,i}get visible(){return y(this.rootTransform.parent)}set visible(t){if(t!==this.visible)if(t){if(this.curStationID=null,this.rootTransform==null)throw new Error("No root transform");De(this.env.foreground,this.rootTransform);for(let i of this.stations){let r=this.getTransform(i.transformID);r.visible=!1}}else this.env.foreground.remove(this.rootTransform)}async showStart(t){if(this.visible=!0,this.startStationID==null)throw new Error("Scenario has no starting point");this.log("start scenario",{id:this.id}),await this.showStation(this.startStation,!1,t),this.env.avatar.setHeadingImmediate(this.startRotation)}async showStation(t,i,r){if(this.logLeaveStation(),this.log("show station",{id:t.transformID}),this.curStationID){let l=this.getStation(this.curStationID);this.resetStationAssets(l)}r=r||this.env.loadingBar,this.curStationID=t.transformID;let o=i?this.env.audio.playClipThrough("footsteps"):Promise.resolve(),s=await this.isCached(t.filePath);this.env.loadingBar.enabled=!s,await this.env.withFade(async()=>{this.env.skybox.rotation=t.rotation;let l=await this.getImage(t.filePath,r);l.length===6?await this.env.skybox.setImages(t.filePath,l):await this.env.skybox.setImage(t.filePath,l[0]),this.moveToStation(t);for(let p of this.stations){let d=this.getTransform(p.transformID);d.visible=p.transformID===t.transformID}let c=this.curConnections.get(t),u=this.getConnectedStations(t);for(let p of u)this.prefetchConnectedStation(c,p);this.resetStationAssets(t),this.env.infoLabel.image.value=t.label||t.fileName,await sn(this.playAudioZone(t.zone),o)}),this.env.loadingBar.enabled=!1}logLeaveStation(){this.curStationID&&this.log("leave station",{id:this.curStationID})}moveToStation(t){y(t)&&(this.getTransform(t.transformID).getWorldPosition(this.env.stage.position),this.env.stage.position.y-=this.avatarHeightOffset)}resetStationAssets(t){let i=this.signsByStation.get(t);for(let l of i)l.reset();let r=this.audiosByStation.get(t);for(let l of r)l.reset();let o=this.videosByStation.get(t);for(let l of o)l.reset();let s=this.textsByStation.get(t);for(let l of s)l.reset()}imgCache=new vf(10);imgTasks=new Map;evict(t){this.imgCache.delete(t.filePath),this.imgTasks.delete(t.filePath)}async prefetchConnectedStation(t,i){let r=t.get(i);r.enabled=!1,this.imgCache.has(i.filePath)||await this.getImage(i.filePath,r),r.enabled=!0}getImage(t,i){if(this.imgCache.has(t))return Promise.resolve(this.imgCache.get(t));if(this.imgTasks.has(t))return this.imgTasks.get(t);let r=this.getImages(t,i).then(o=>(this.imgCache.set(t,o),this.imgTasks.delete(t),o));return this.imgTasks.set(t,r),r}async getImages(t,i){let{contentType:r}=await this.env.fetcher.head(t).exec();if(r===rf.value){let o=await this.env.fetcher.get(t).text().then(We);return await this.rig.loadImages(o,Xr.High,i)}else return[await this.env.fetcher.get(t).useCache(!this.env.DEBUG).image().then(We)]}async isCached(t){return await this.imgCache.has(t)}clearCache(){this.imgCache.clear()}getConnectedStations(t){return t&&this.connections.filter(i=>i.fromStationID===t.transformID).map(i=>this.getStation(i.toStationID))}async playAudioZone(t){if(t!==this.curZone){let i=new Map,r=new Map;for(let o of this.zonedClips.get(this.curZone))i.set(o.audio,o),o.disable();for(let o of this.zonedClips.get(t))i.has(o.audio)?i.delete(o.audio):r.set(o.audio,o),o.enable();for(let o of i.values())o.pause();await Promise.all(Array.from(r.values()).map(o=>o.play())),this.curZone=t}}pauseCurrentAudioZone(){let t=this.zonedClips.get(this.curZone),i=new Map;for(let r of t)i.set(r.audio,r),r.disable();for(let r of i.values())r.pause()}async playCurrentAudioZone(){if(!this.environmentAudioMuted){let t=this.zonedClips.get(this.curZone),i=new Map;for(let r of t)r.enable(),i.set(r.audio,r);await Promise.all(Array.from(i.values()).map(r=>r.play()))}}log(t,i){this.dataLogger.log(t,i)}error(t,i,r){this.dataLogger.error(t,i,r)}};var kf=class extends Vc{constructor(e){super(e,Jr)}async getResult(e,t){let[i,r]=Et(t,[1,89]);return await e.get(this.path).progress(i).object().then(We).then(async o=>{let s=this.createScenario(o);return await s.loadAssets(r),s})}};var Mf=1e-6,rp=typeof Float32Array<"u"?Float32Array:Array,n0=Math.random;var NWe=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var fs={};ti(fs,{add:()=>Hue,angle:()=>cpe,bezier:()=>tpe,ceil:()=>Uue,clone:()=>Vue,copy:()=>Nue,create:()=>FT,cross:()=>Jue,dist:()=>xpe,distance:()=>_T,div:()=>gpe,divide:()=>ST,dot:()=>ET,equals:()=>hpe,exactEquals:()=>dpe,floor:()=>zue,forEach:()=>vpe,fromValues:()=>Oue,hermite:()=>epe,inverse:()=>Que,len:()=>Fpe,length:()=>AT,lerp:()=>Zue,max:()=>Gue,min:()=>jue,mul:()=>fpe,multiply:()=>bT,negate:()=>Kue,normalize:()=>$ue,random:()=>npe,rotateX:()=>spe,rotateY:()=>ape,rotateZ:()=>lpe,round:()=>Xue,scale:()=>que,scaleAndAdd:()=>Yue,set:()=>Wue,sqrDist:()=>wpe,sqrLen:()=>Ape,squaredDistance:()=>yT,squaredLength:()=>TT,str:()=>ppe,sub:()=>mpe,subtract:()=>vT,transformMat3:()=>rpe,transformMat4:()=>ipe,transformQuat:()=>ope,zero:()=>upe});function FT(){var n=new rp(3);return rp!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Vue(n){var e=new rp(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function AT(n){var e=n[0],t=n[1],i=n[2];return Math.hypot(e,t,i)}function Oue(n,e,t){var i=new rp(3);return i[0]=n,i[1]=e,i[2]=t,i}function Nue(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function Wue(n,e,t,i){return n[0]=e,n[1]=t,n[2]=i,n}function Hue(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function vT(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function bT(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n}function ST(n,e,t){return n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n}function Uue(n,e){return n[0]=Math.ceil(e[0]),n[1]=Math.ceil(e[1]),n[2]=Math.ceil(e[2]),n}function zue(n,e){return n[0]=Math.floor(e[0]),n[1]=Math.floor(e[1]),n[2]=Math.floor(e[2]),n}function jue(n,e,t){return n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.min(e[2],t[2]),n}function Gue(n,e,t){return n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n}function Xue(n,e){return n[0]=Math.round(e[0]),n[1]=Math.round(e[1]),n[2]=Math.round(e[2]),n}function que(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function Yue(n,e,t,i){return n[0]=e[0]+t[0]*i,n[1]=e[1]+t[1]*i,n[2]=e[2]+t[2]*i,n}function _T(n,e){var t=e[0]-n[0],i=e[1]-n[1],r=e[2]-n[2];return Math.hypot(t,i,r)}function yT(n,e){var t=e[0]-n[0],i=e[1]-n[1],r=e[2]-n[2];return t*t+i*i+r*r}function TT(n){var e=n[0],t=n[1],i=n[2];return e*e+t*t+i*i}function Kue(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function Que(n,e){return n[0]=1/e[0],n[1]=1/e[1],n[2]=1/e[2],n}function $ue(n,e){var t=e[0],i=e[1],r=e[2],o=t*t+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n}function ET(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Jue(n,e,t){var i=e[0],r=e[1],o=e[2],s=t[0],l=t[1],c=t[2];return n[0]=r*c-o*l,n[1]=o*s-i*c,n[2]=i*l-r*s,n}function Zue(n,e,t,i){var r=e[0],o=e[1],s=e[2];return n[0]=r+i*(t[0]-r),n[1]=o+i*(t[1]-o),n[2]=s+i*(t[2]-s),n}function epe(n,e,t,i,r,o){var s=o*o,l=s*(2*o-3)+1,c=s*(o-2)+o,u=s*(o-1),p=s*(3-2*o);return n[0]=e[0]*l+t[0]*c+i[0]*u+r[0]*p,n[1]=e[1]*l+t[1]*c+i[1]*u+r[1]*p,n[2]=e[2]*l+t[2]*c+i[2]*u+r[2]*p,n}function tpe(n,e,t,i,r,o){var s=1-o,l=s*s,c=o*o,u=l*s,p=3*o*l,d=3*c*s,h=c*o;return n[0]=e[0]*u+t[0]*p+i[0]*d+r[0]*h,n[1]=e[1]*u+t[1]*p+i[1]*d+r[1]*h,n[2]=e[2]*u+t[2]*p+i[2]*d+r[2]*h,n}function npe(n,e){e=e||1;var t=n0()*2*Math.PI,i=n0()*2-1,r=Math.sqrt(1-i*i)*e;return n[0]=Math.cos(t)*r,n[1]=Math.sin(t)*r,n[2]=i*e,n}function ipe(n,e,t){var i=e[0],r=e[1],o=e[2],s=t[3]*i+t[7]*r+t[11]*o+t[15];return s=s||1,n[0]=(t[0]*i+t[4]*r+t[8]*o+t[12])/s,n[1]=(t[1]*i+t[5]*r+t[9]*o+t[13])/s,n[2]=(t[2]*i+t[6]*r+t[10]*o+t[14])/s,n}function rpe(n,e,t){var i=e[0],r=e[1],o=e[2];return n[0]=i*t[0]+r*t[3]+o*t[6],n[1]=i*t[1]+r*t[4]+o*t[7],n[2]=i*t[2]+r*t[5]+o*t[8],n}function ope(n,e,t){var i=t[0],r=t[1],o=t[2],s=t[3],l=e[0],c=e[1],u=e[2],p=r*u-o*c,d=o*l-i*u,h=i*c-r*l,A=r*h-o*d,g=o*p-i*h,F=i*d-r*p,b=s*2;return p*=b,d*=b,h*=b,A*=2,g*=2,F*=2,n[0]=l+p+A,n[1]=c+d+g,n[2]=u+h+F,n}function spe(n,e,t,i){var r=[],o=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function ape(n,e,t,i){var r=[],o=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function lpe(n,e,t,i){var r=[],o=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function cpe(n,e){var t=n[0],i=n[1],r=n[2],o=e[0],s=e[1],l=e[2],c=Math.sqrt(t*t+i*i+r*r),u=Math.sqrt(o*o+s*s+l*l),p=c*u,d=p&&ET(n,e)/p;return Math.acos(Math.min(Math.max(d,-1),1))}function upe(n){return n[0]=0,n[1]=0,n[2]=0,n}function ppe(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function dpe(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}function hpe(n,e){var t=n[0],i=n[1],r=n[2],o=e[0],s=e[1],l=e[2];return Math.abs(t-o)<=Mf*Math.max(1,Math.abs(t),Math.abs(o))&&Math.abs(i-s)<=Mf*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-l)<=Mf*Math.max(1,Math.abs(r),Math.abs(l))}var mpe=vT,fpe=bT,gpe=ST,xpe=_T,wpe=yT,Fpe=AT,Ape=TT,vpe=function(){var n=FT();return function(e,t,i,r,o,s){var l,c;for(t||(t=3),i||(i=0),r?c=Math.min(r*t+i,e.length):c=e.length,l=i;l<c;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],o(n,n,s),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2];return e}}();function tr(n,e,t,...i){for(let r of i)(!(r in e)||n)&&(e[r]=t[r])}function Zl(n){return n instanceof ql}function ec(n){return n instanceof Yl}function tc(n){return n instanceof Jl}function nc(n){return n instanceof $l}function ic(n){return n instanceof Xl}function wo(n){return ic(n)&&n.spatialize}function i0(n){return ic(n)&&!n.spatialize}function gn(n){return Ve(n)}function Hi(n){return n instanceof oc}function Mt(n){return y(n)&&n instanceof Ql}function Ar(n){return y(n)&&!Zl(n)&&!ec(n)&&!tc(n)&&!nc(n)&&!ic(n)&&!Mt(n)&&!gn(n)&&!Hi(n)&&y(n.fromStationID)&&y(n.toStationID)}function Fo(n){if(oe(n))return null;if(gn(n))return"zone";if(Mt(n))return"station";if(ic(n))return n.spatialize?"ambientAudio":"audio";if(tc(n))return"video";if(nc(n))return"text";if(ec(n))return"sign";if(Zl(n))return"model";if(Ar(n))return"connection";if(Hi(n))return"scenario";yt(n)}var gs=class extends ge{constructor(t,i){super(t);this.asset=i}},On=class extends gs{constructor(t,i){super("assetselected",t);this.isContextMenu=i}},ha=class extends gs{constructor(e){super("assetupdated",e)}},Df=class extends gs{constructor(t,i){super("assetrename",t);this.newName=i}},Cf=class extends gs{constructor(e){super("assetdelete",e)}},Lf=class extends gs{constructor(e){super("assetreset",e)}},Pf=class extends gs{constructor(e){super("assetviewfile",e)}},Rf=new Map([["scenario",sv.emojiStyle],["zone",uv.emojiStyle],["station",xx.emojiStyle],["ambientAudio",ev.emojiStyle],["connection",NA.emojiStyle],["sign",cv.emojiStyle],["audio",nv.emojiStyle],["video",tv.emojiStyle],["text",av.emojiStyle],["model",rv.emojiStyle]]),rc=new Map([["zone","Zone"],["station","Station"],["ambientAudio","Environment Audio"],["sign","Sign"],["audio","Voice Over"],["video","Video Clip"],["text","Text"],["model","3D Model"],["connection","Station Connection"]]),Ao=new Map([["delete",ov.emojiStyle+" Delete"],["readonly",JA.emojiStyle+" Cannot edit published scenario"]]);for(let[n,e]of rc)Ao.set(n,Rf.get(n)+" "+e);var JWe=Array.from(Rf.keys()),kT=Array.from(rc.keys());function If(n){return`/images/markers/${n}.png`}var op=class extends ge{constructor(t,i){super("transformmoved");this.object=t;this.transform=i}},nr=class extends Be{constructor(t,i,r,o){super();this.scenario=t;this.assets=i;this.assetsByStation=r;this.assetName=o}saveTransformThrottled(t,i){this.scenario.transformAdapter.saveMatrixThrottled(i),this.dispatchEvent(new op(t,i))}async saveTransform(t,i){await this.scenario.transformAdapter.saveMatrix(i),this.dispatchEvent(new op(t,i))}async createTransformAndSaveAsset(t,i,r){let o=await this.scenario.postFor("Create",this.assetName,t,i).then(We),s=this.scenario.addTransformData(o.transform);this.scenario.getTransform(o.transform.parentTransformID).attach(s);let c=await this.createAsset(o,r);return r.end(),c}async createEditorAssets(t){if(!this.scenario.fileMarkers.has(t.transformID)){let i=this.scenario.getTransform(t.transformID),r=y(t.error)?"error-":"",o=await this.scenario.createMarker(t,t.transformID,t.fileName,If(r+this.getMarkerImagePath(t)));y(o)&&(o.addListener("click",()=>this.onMarkerSelected(t,!1)),o.addListener("contextmenu",()=>this.onMarkerSelected(t,!0)),this.scenario.published||(o.setDraggable(!0),o.setCursor("move"),o.addListener("dragend",s=>{let l=this.scenario.getTransformPosition(t.transformID);this.moveTransformThrottled(t,i,s.latLng.lat(),s.latLng.lng(),l.alt),this.scenario.dispatchEvent(new ha(t))})))}}onTransformMoved(t,i){this.scenario.transformAdapter.updateMarker(i,t),this.scenario.dispatchEvent(new ha(t)),this.dispatchEvent(new op(t,i))}moveTransformThrottled(t,i,r,o,s){this.scenario.moveTransformByGeoThrottled(i,r,o,s),this.onTransformMoved(t,i)}async moveTransform(t,i,r,o,s){await this.scenario.moveTransformByGeo(i,r,o,s),this.onTransformMoved(t,i)}resetThrottled(t,i){let r=this.scenario.getTransform(t.transformID);r.position.set(0,i,-2),r.quaternion.identity(),this.saveTransformThrottled(t,r),this.scenario.transformAdapter.updateMarker(r,t)}async reset(t,i){let r=this.scenario.getTransform(t.transformID);r.position.set(0,i,-2),r.quaternion.identity(),await this.saveTransform(t,r),this.scenario.transformAdapter.updateMarker(r,t)}async delete(t){let i=this.scenario.fileMarkers.get(t.transformID),r=this.scenario.getTransform(t.transformID),o=r&&this.scenario.findStation(r);await this.scenario.post("Delete",this.assetName,t.key),Pt(this.assets,t),this.assetsByStation.remove(o,t),y(r)&&await this.scenario.removeTransform(r),y(i)&&(i.setMap(null),this.scenario.fileMarkers.delete(t.transformID)),t.dispose()}};function MT(n){let e=null,t=n.getLabel();return Ve(t)?e=t:e=t.text,e}var Bf=class{constructor(e){this.scenario=e}async create(e,t,i,r,o,s){let l=new wi(i,r,o);await this.scenario.resolveOrigin(l);let c=this.scenario.latLngToVector(l),u=new vt().makeTranslation(c.x,c.y,c.z),p=await this.scenario.transformAdapter.create(this.scenario.rootTransform.transformID,t,u.toArray()),d=this.scenario.addTransformData(p);this.scenario.rootTransform.attach(d);let h={transformID:d.transformID,fileID:e,rotation:[0,0,0,1],latitude:i,longitude:r,altitude:o},[A,g]=Bp(s,2),F=await this.scenario.postFor("Add","Stations",h,A).then(We),b=await this.scenario.createStation(F,g);return oe(this.scenario.startStationID)&&(this.scenario.startStationID=b.transformID),this.scenario.stations.push(b),b}async markStart(e){let t=this.scenario.startStation,i=t&&this.scenario.fileMarkers.get(t.transformID);await this.scenario.post("MarkStart","Stations",e.transformID),this.scenario.startStationID=e.transformID,t=this.scenario.startStation;let r=t&&this.scenario.fileMarkers.get(this.scenario.startStation.transformID);if(y(i)){let o=MT(i);o=o.substring(so.emojiStyle.length),i.setLabel(o)}if(y(r)){let o=MT(r);o=so.emojiStyle+o,r.setLabel(o)}}setStartRotation(e,t){this.scenario.startStation===e&&(this.scenario.startRotation=t,this.scenario.throttle(`updateScenarioStartRotation::${this.scenario.id}`,()=>this.scenario.post("SetStartRotation","Stations",t)))}async createEditorAssets(e){await this.createMarker(e)}async createMarker(e){let t=this.scenario.fileMarkers.get(e.transformID);t&&t.setMap(null);let i=e.fileName;e.transformID===this.scenario.startStationID&&(i=so.emojiStyle+i),t=await this.scenario.createMarker(e,e.transformID,i,If(bpe)),y(t)&&(t.addListener("click",()=>this.onMarkerSelected(e,!1)),t.addListener("contextmenu",()=>this.onMarkerSelected(e,!0)),this.scenario.published||(t.setDraggable(!0),t.setCursor("move"),t.addListener("drag",r=>{for(let[o,s,l]of this.scenario.lines.entries())if(o===e.transformID||s===e.transformID){let c=l.getPath(),u=o===e.transformID?0:1;c.setAt(u,r.latLng)}}),t.addListener("dragend",async r=>{this.scenario.dispatchEvent(new r0(e,Lr(r.latLng))),this.scenario.dispatchEvent(new ha(e))})))}onMarkerSelected(e,t){this.scenario.dispatchEvent(new sp(e)),this.scenario.dispatchEvent(new On(e,t))}moveThrottled(e,t,i,r,o){let s=this.setMoveData(o,e,t,i,r);this.scenario.moveTransformByGeoThrottled(s,t,i,r),this.getMoveData(e,s)}async move(e,t,i,r,o){let s=this.setMoveData(o,e,t,i,r);await this.scenario.moveTransformByGeo(s,t,i,r),this.getMoveData(e,s)}getMoveData(e,t){e.transformID===this.scenario.curStationID&&t.getWorldPosition(this.scenario.env.stage.position)}setMoveData(e,t,i,r,o){return e?this.updateThrottled(t,{latitude:i,longitude:r,altitude:o,rotation:[0,0,0,1]}):this.updateThrottled(t,{latitude:i,longitude:r,altitude:o}),this.scenario.getTransform(t.transformID)}updateThrottled(e,t){this.setUpdateData(t,e),this.scenario.throttle(`updateStation::${e.transformID}`,()=>this.scenario.post("Update","Stations",t)),this.getUpdateData(e,t)}async update(e,t){this.setUpdateData(t,e),await this.scenario.post("Update","Stations",t),this.getUpdateData(e,t)}copy(e,t,i){tr(e,t,i,"fileName","zone","rotation","label")}setUpdateData(e,t){e.stationID=t.key,this.copy(!1,e,t),"latitude"in e||(e.latitude=t.location.lat),"longitude"in e||(e.longitude=t.location.lng),"altitude"in e||(e.altitude=t.location.alt)}getUpdateData(e,t){this.copy(!0,e,t),e.location.lat=t.latitude,e.location.lng=t.longitude,e.location.alt=t.altitude,this.scenario.fileMarkers.get(e.transformID).setLabel(t.fileName),this.scenario.refreshZones(),this.scenario.env.skybox.rotation=e.rotation,this.scenario.curStation===e&&(this.scenario.env.infoLabel.image.value=e.label||e.fileName)}async delete(e){let t=this.scenario.getTransform(e.transformID),i=this.scenario.fileMarkers.get(e.transformID),r=this.scenario.connections.filter(s=>s.fromStationID===e.transformID||s.toStationID===e.transformID),o=this.scenario.startStationID;if(this.scenario.startStationID=await this.scenario.postFor("Delete","Stations",e.transformID).then(We),this.scenario.startStationID!==o&&this.scenario.startStationID){let s=this.scenario.startStation,l=this.scenario.fileMarkers.get(s.transformID);y(l)&&l.setLabel(so.emojiStyle+s.fileName)}e.transformID===this.scenario.curStationID&&(this.scenario.curStationID=null);for(let s of r){let l=this.scenario.getStation(s.fromStationID),c=this.scenario.getStation(s.toStationID);await this.scenario.connectionAdapter.disconnect(l,c)}i.setMap(null),this.scenario.fileMarkers.delete(e.transformID),Pt(this.scenario.stations,e),await this.scenario.removeTransform(t)}},bpe="globe",sp=class extends ge{constructor(t){super("stationselected");this.station=t}},r0=class extends ge{constructor(t,i){super("stationmarkermoved");this.station=t;this.latLng=i}};var ir=class extends ge{constructor(t,i){super(`${t}selected`);this.subType=t;this.object=i}};var Spe="sound",_pe="disc",o0=class extends ir{constructor(t){super("audio",t);this.audio=t}},Vf=class extends nr{constructor(e){super(e,e.audios,e.audiosByStation,"AudioTracks"),this.addEventListener("transformmoved",t=>{t.object.spatialize&&t.object.updateAudioPosition()})}createAsset(e,t){return this.scenario.createAudio(e.audioTrack,t)}create(e,t,i){let[r,o]=Et(i,[2,1]),s=e||this.scenario.rootTransform,l={fileID:t.id,spatialize:s!==e,parentTransformID:s.transformID};return this.createTransformAndSaveAsset(l,r,o)}getMarkerImagePath(e){return e.spatialize?_pe:Spe}onMarkerSelected(e,t){this.scenario.dispatchEvent(new o0(e)),this.scenario.dispatchEvent(new On(e,t))}changeElevationThrottled(e,t){let{transform:i,latLng:r}=this.setChangeElevationData(e);this.moveTransformThrottled(e,i,r.lat(),r.lng(),t)}async changeElevation(e,t){let{transform:i,latLng:r}=this.setChangeElevationData(e);await this.moveTransform(e,i,r.lat(),r.lng(),t)}setChangeElevationData(e){let i=this.scenario.fileMarkers.get(e.transformID).getPosition();return{transform:this.scenario.getTransform(e.transformID),latLng:i}}async createEditorAssets(e){await super.createEditorAssets(e),e.spatialize&&e.zone===this.scenario.curZone&&e.play()}resetThrottled(e,t){let i=e.spatialize?0:t;super.resetThrottled(e,i)}async reset(e,t){let i=e.spatialize?0:t;await super.reset(e,i)}updateThrottled(e,t){this.setUpdateData(t,e),this.scenario.throttle(`updateAudioTrack::${t.id}`,()=>this.scenario.post("Update","AudioTracks",t)),this.getUpdateData(e,t)}async update(e,t){this.setUpdateData(t,e),await this.scenario.post("Update","AudioTracks",t),this.getUpdateData(e,t)}copy(e,t,i){tr(e,t,i,"fileName","enabled","label","minDistance","maxDistance","volume","zone","effect")}setUpdateData(e,t){e.id=t.key,this.copy(!1,e,t)}getUpdateData(e,t){this.copy(!0,e,t),y(e.controls)&&(e.controls.volume=t.volume,e.controls.label=t.label);let i=this.scenario.env.audio.getClip(e.transformID.toString());y(i)&&(i.volume=t.volume,i.spatializer.setAudioProperties(t.minDistance,t.maxDistance,this.scenario.env.audio.algorithm),i.setEffects(t.effect),t.enabled&&t.zone===this.scenario.curZone?i.playbackState!=="playing"&&i.play():i.playbackState!=="stopped"&&i.stop())}getStation(e){let t=e&&this.scenario.getTransform(e.transformID);return t&&this.scenario.findStation(t)}async delete(e){let{zone:t,clip:i}=e;await super.delete(e),e.spatialize&&this.scenario.zonedClips.remove(t,i)}};var Of=class{constructor(e){this.scenario=e}async createEditorAssets(e){if(e.transformID<0){let s=this.scenario.getTransform(e.transformID),l=s.data,c=await this.scenario.transformAdapter.create(l.parentTransformID,l.name,l.matrix);this.scenario.transformsByTransformID.delete(l.id),this.scenario.transformsByTransformID.set(c.id,s),e.transformID=c.id,s.data.id=c.id,await this.update(e,e.label),await this.reset(e)}let t=this.scenario.getStation(e.fromStationID),i=this.scenario.getStation(e.toStationID),r=[t,i].map(s=>s.location),o=this.scenario.createLine(r);this.scenario.lines.add(t.transformID,i.transformID,o)}getConnectableStations(e){let t=e&&this.scenario.connections.filter(i=>i.fromStationID===e.transformID).map(i=>i.toStationID);return e&&this.scenario.stations.filter(i=>i.transformID!==e.transformID&&t.indexOf(i.transformID)===-1)}findConnection(e,t){for(let i of this.scenario.connections)if(i.fromStationID==e.transformID&&i.toStationID==t.transformID)return i;return null}async create(e,t){let i={fromStationID:e.transformID,toStationID:t.transformID},r={fromStationID:t.transformID,toStationID:e.transformID};await sn(this.createConnectionHalf(i),this.createConnectionHalf(r))}async createConnectionHalf(e){await this.scenario.post("Create","Connections",e);let t=await this.scenario.createConnection(e);this.scenario.connections.push(e),await this.scenario.transformAdapter.saveMatrix(t.transform)}async reset(e){let t=this.scenario.getStation(e.fromStationID),i=this.scenario.getStation(e.toStationID),o=this.scenario.curConnections.get(t).get(i);o.resetPosition(),await this.scenario.transformAdapter.saveMatrix(o.transform)}updateThrottled(e,t){let i=this.setConnectionUpdateData(e,t);this.scenario.throttle(`updateConnectionLabel::${e.fromStationID} -> ${e.toStationID}`,()=>this.scenario.post("Update","Connections",i))}async update(e,t){let i=this.setConnectionUpdateData(e,t);await this.scenario.post("Update","Connections",i)}setConnectionUpdateData(e,t){e.label=t;let i=this.scenario.getStation(e.fromStationID),r=this.scenario.curConnections.get(i);if(r){let o=this.scenario.getStation(e.toStationID),s=r.get(o);s.label=t}return{transformID:e.transformID,fromStationID:e.fromStationID,toStationID:e.toStationID,label:t}}async disconnect(e,t){await sn(this.scenario.post("Delete","Connections",{fromStationID:e.transformID,toStationID:t.transformID}),this.removeConnection(e,t),this.removeConnection(t,e))}async removeConnection(e,t){let i=this.findConnection(e,t);Pt(this.scenario.connections,i);let r=this.scenario.lines.get(e.transformID,t.transformID);r&&(r.setMap(null),this.scenario.lines.delete(t.transformID,t.transformID));let o=this.scenario.curConnections.get(e,t);o&&(await this.scenario.removeTransform(o.transform),this.scenario.curConnections.delete(e,t),ut(o))}};var ype="joy",s0=class extends ir{constructor(e){super("model",e)}},Nf=class extends nr{constructor(e){super(e,e.models,e.modelsByStation,"Models")}createAsset(e,t){return this.scenario.createModel(e.model,t)}create(e,t,i){let[r,o]=Et(i,[2,1]),s=e||this.scenario.rootTransform,l={fileID:t.id,parentTransformID:s.transformID};return this.createTransformAndSaveAsset(l,r,o)}getMarkerImagePath(){return ype}onMarkerSelected(e,t){this.scenario.dispatchEvent(new s0(e)),this.scenario.dispatchEvent(new On(e,t))}setSize(e,t){let i=this.scenario.getTransform(e.transformID);e.size=t,this.saveTransformThrottled(e,i)}setRotation(e,t,i,r){let o=this.scenario.getTransform(e.transformID);o.rotation.set(je(t),je(i),je(r),"XYZ"),this.saveTransformThrottled(e,o)}getStation(e){let t=e&&this.scenario.getTransform(e.transformID);return t&&this.scenario.findStation(t)}async update(e,t){this.setUpdateData(t,e),await this.scenario.post("Update","Models",t),this.getUpdateData(e,t)}updateThrottled(e,t){this.setUpdateData(t,e),this.scenario.throttle(`updateModel::${t.id}`,()=>this.scenario.post("Update","Models",t)),this.getUpdateData(e,t)}copy(e,t,i){tr(e,t,i,"fileName")}getUpdateData(e,t){this.copy(!0,e,t)}setUpdateData(e,t){e.id=t.key,this.copy(!1,e,t)}};var Tpe="painting",a0=class extends ir{constructor(e){super("sign",e)}},Wf=class extends nr{constructor(e){super(e,e.signs,e.signsByStation,"Signs")}async loadSignImage(e,t){let i=await this.scenario.env.fetcher.get(e.filePath).progress(t).file();if(Zr.matches(i.contentType)){let r=new Fr(i.content,{scale:2});return await r.getPage(0),r.canvas}else return await this.scenario.env.fetcher.get(i.content).image().then(We)}createAsset(e,t){return this.scenario.createSign(e.sign,t)}async create(e,t,i){let[r,o,s]=Et(i,[1,2,1]),l=await this.loadSignImage(t,r),c={parentTransformID:(e||this.scenario.rootTransform).transformID,fileID:t.id,imageWidth:l.width,imageHeight:l.height};return await this.createTransformAndSaveAsset(c,o,s)}getMarkerImagePath(){return Tpe}onMarkerSelected(e,t){this.scenario.dispatchEvent(new a0(e)),this.scenario.dispatchEvent(new On(e,t))}resetThrottled(e,t){let i=e.image.imageWidth/oo,r=Yo(i);e.size=r,super.resetThrottled(e,t)}async reset(e,t){let i=e.image.imageWidth/oo,r=Yo(i);e.size=r,await super.resetThrottled(e,t)}async update(e,t){this.setUpdateData(t,e),await this.scenario.post("Update","Signs",t),this.getUpdateData(e,t)}updateThrottled(e,t){this.setUpdateData(t,e),this.scenario.throttle(`updateSign::${t.id}`,()=>this.scenario.post("Update","Signs",t)),this.getUpdateData(e,t)}copy(e,t,i){tr(e,t,i,"fileName","isCallout","alwaysVisible")}setUpdateData(e,t){e.id=t.key,this.copy(!1,e,t)}getUpdateData(e,t){this.copy(!0,e,t)}setSize(e,t){e.size=t;let i=this.scenario.getTransform(e.transformID);this.saveTransformThrottled(e,i)}setRotation(e,t,i,r){let o=this.scenario.getTransform(e.transformID);o.rotation.set(je(t),je(i),je(r),"XYZ"),this.saveTransformThrottled(e,o)}getStation(e){let t=e&&this.scenario.getTransform(e.transformID);return t&&this.scenario.findStation(t)}};var Epe="pad",l0=class extends ir{constructor(e){super("text",e)}},Hf=class extends nr{constructor(e){super(e,e.texts,e.textsByStation,"Texts")}createAsset(e,t){return this.scenario.createText(e.text,t)}async create(e,t,i){let[r,o]=Et(i,[1,1]),s={parentTransformID:(e||this.scenario.rootTransform).transformID,fileID:t.id};return await this.createTransformAndSaveAsset(s,r,o)}getMarkerImagePath(){return Epe}onMarkerSelected(e,t){this.scenario.dispatchEvent(new l0(e)),this.scenario.dispatchEvent(new On(e,t))}resetThrottled(e,t){let i=e.image.imageWidth/oo,r=Yo(i);e.size=r,super.resetThrottled(e,t)}async reset(e,t){let i=e.image.imageWidth/oo,r=Yo(i);e.size=r,await super.resetThrottled(e,t)}async update(e,t){this.setUpdateData(t,e),await this.scenario.post("Update","Texts",t),this.getUpdateData(e,t)}updateThrottled(e,t){this.setUpdateData(t,e),this.scenario.throttle(`updateText::${t.id}`,()=>this.scenario.post("Update","Texts",t)),this.getUpdateData(e,t)}copy(e,t,i){tr(e,t,i,"text","fileName","isCallout","alwaysVisible")}setUpdateData(e,t){e.id=t.key,this.copy(!1,e,t)}getUpdateData(e,t){this.copy(!0,e,t)}setSize(e,t){e.size=t;let i=this.scenario.getTransform(e.transformID);this.saveTransformThrottled(e,i)}setRotation(e,t,i,r){let o=this.scenario.getTransform(e.transformID);o.rotation.set(je(t),je(i),je(r),"XYZ"),this.saveTransformThrottled(e,o)}getStation(e){let t=e&&this.scenario.getTransform(e.transformID);return t&&this.scenario.findStation(t)}};var Uf=class extends ge{constructor(t){super("objectmoved");this.object=t}};var zf=class{constructor(e){this.scenario=e}async create(e,t,i){let r={parentTransformID:e,name:t,matrix:i};return await this.scenario.postFor("Create","Transforms",r).then(We)}getChangedMatrices(e){let t=[e];return e.traverse(i=>{i instanceof er&&(i.updateMatrixWorld(),t.push(i))}),t.map(i=>({transformID:i.transformID,matrix:i.matrixWorld.toArray()}))}saveMatrixThrottled(e){let t=this.getChangedMatrices(e);for(let i of t)this.scenario.throttle(`saveTransformPosition::${i.transformID}`,()=>this.scenario.post("Move","Transforms",i))}async saveMatrix(e){let t=this.getChangedMatrices(e);await Promise.all(t.map(i=>this.scenario.post("Move","Transforms",i)))}updateMarker(e,t){if(y(t)){let i=this.scenario.getTransformPosition(e.transformID);this.scenario.fileMarkers.get(e.transformID).setPosition(pr(i)),this.scenario.dispatchEvent(new Uf(t))}}};var kpe="clapper",c0=class extends ir{constructor(e){super("video",e)}},jf=class extends nr{constructor(e){super(e,e.videos,e.videosByStation,"VideoClips")}createAsset(e,t){return this.scenario.createVideo(e.videoClip,t)}create(e,t,i){let[r,o]=Et(i,[2,1]),s={fileID:t.id,parentTransformID:e.transformID};return this.createTransformAndSaveAsset(s,r,o)}getMarkerImagePath(){return kpe}onMarkerSelected(e,t){this.scenario.dispatchEvent(new c0(e)),this.scenario.dispatchEvent(new On(e,t))}saveTransformThrottled(e,t){t.scale.setScalar(e.size),super.saveTransformThrottled(e,t),t.scale.setScalar(1)}setSphereEncodingAndLayout(e,t,i){return this.scenario.env.videoPlayer.isSupported(t,i)?(this.updateThrottled(e,{sphereEncodingName:t,stereoLayoutName:i}),!0):!1}setSize(e,t){e.size=t;let i=this.scenario.getTransform(e.transformID);this.saveTransformThrottled(e,i)}setRotation(e,t,i,r){let o=this.scenario.getTransform(e.transformID);o.rotation.set(je(t),je(i),je(r),"XYZ"),this.saveTransformThrottled(e,o)}updateThrottled(e,t){this.setUpdateData(t,e),this.scenario.throttle(`updateVideo::${t.id}`,()=>this.scenario.post("Update","VideoClips",t)),this.getUpdateData(e,t)}async update(e,t){this.setUpdateData(t,e),await this.scenario.post("Update","VideoClips",t),this.getUpdateData(e,t)}copy(e,t,i){tr(e,t,i,"fileName","sphereEncodingName","stereoLayoutName","enabled","label","volume")}setUpdateData(e,t){e.id=t.key,this.copy(!1,e,t)}getUpdateData(e,t){this.copy(!0,e,t),y(e.controls)&&(e.controls.volume=t.volume,e.controls.label=t.label);let i=this.scenario.env.audio.getClip(e.transformID.toString());y(i)&&(i.volume=t.volume)}getStation(e){let t=e&&this.scenario.getTransform(e.transformID);return t&&this.scenario.findStation(t)}};var oc=class extends ip{constructor(t,i,r,o){super(t,r,i);this.map=o;this.versions=i.versions}throttlers=new Map;versions;fileMarkers=new Map;lines=new Bn;zones=new Array;transformAdapter=new zf(this);stationAdapter=new Bf(this);connectionAdapter=new Of(this);signAdapter=new Wf(this);audioAdapter=new Vf(this);videoAdapter=new jf(this);textAdapter=new Hf(this);modelAdapter=new Nf(this);dispose(){for(let t of this.fileMarkers.values())t.setMap(null);this.fileMarkers.clear();for(let t of this.lines.values())t.setMap(null);this.lines.clear(),super.dispose()}throttle(t,i){this.throttlers.has(t)||this.throttlers.set(t,new Vl),this.throttlers.get(t).throttle(i)}refreshZones(){let t=new Array;for(let r of this.stations)y(r.zone)&&bi(t,r.zone,vn(pn),"set");for(let r of this.audios)y(r.zone)&&bi(t,r.zone,vn(pn),"set");let i=t.length!==this.zones.length||!t.every((r,o)=>r===this.zones[o]);un(this.zones,...t),i&&this.dispatchEvent(new ge("zonesupdated"))}async loadAssets(t){await super.loadAssets(t),this.refreshZones()}toggleMarkers(){for(let t of this.fileMarkers.values())t.setVisible(!t.getVisible())}makeOnlyStationsSelectable(t){let i=t.map(r=>r.key);for(let[r,o]of this.fileMarkers.entries()){let s=i.indexOf(r)>-1;o.setOpacity(s?1:.5),o.setClickable(s)}}makeAllMarkersSelectable(){for(let t of this.fileMarkers.values())t.setOpacity(1),t.setClickable(!0)}async createStation(t,i){let r=await super.createStation(t,i);return this.cancellationToken.check(),y(r)&&(await this.stationAdapter.createEditorAssets(r),this.cancellationToken.check()),r}async createConnection(t){let i=super.createConnection(t);return y(i)&&(await this.connectionAdapter.createEditorAssets(t),this.cancellationToken.check()),i}async createAudio(t,i){let r=await super.createAudio(t,i);return this.cancellationToken.check(),y(r)&&(await this.audioAdapter.createEditorAssets(r),this.cancellationToken.check()),r}async createSign(t,i){let r=await super.createSign(t,i);return this.cancellationToken.check(),y(r)&&(await this.signAdapter.createEditorAssets(r),this.cancellationToken.check()),r}async createVideo(t,i){let r=await super.createVideo(t,i);return this.cancellationToken.check(),y(r)&&(await this.videoAdapter.createEditorAssets(r),this.cancellationToken.check()),r}async createText(t,i){let r=await super.createText(t,i);return this.cancellationToken.check(),y(r)&&(await this.textAdapter.createEditorAssets(r),this.cancellationToken.check()),r}async createModel(t,i){let r=await super.createModel(t,i);return this.cancellationToken.check(),y(r)&&(await this.modelAdapter.createEditorAssets(r),this.cancellationToken.check()),r}makePost(t,i,r,o){return this.env.fetcher.post(`/Editor/Scenarios/${i}/${this.id}`).query("handler",t).body(r,Jr).progress(o)}postFor(t,i,r,o){return this.makePost(t,i,r,o).object()}post(t,i,r,o){return this.makePost(t,i,r,o).exec()}async publish(){await this.post("Publish","Layout"),this.data.published=!0}fork(){return this.postFor("Fork","Layout")}async resolveOrigin(t){oe(this._originLL)&&await this.setOrigin(t)}async setOrigin(t){oe(t)?(this._originLL=null,await this.post("SetOrigin","Layout",null)):(this._originLL=new wi(t),await this.post("SetOrigin","Layout",{lat:this._originLL.lat,lng:this._originLL.lng,alt:this._originLL.alt}))}vectorToLatLng(t){let i=this.originUTM.toVec3(),r=fs.fromValues(t.x,t.y,t.z),o=fs.add(fs.create(),i,r);return new Ul().fromVec3(o,this.originUTM.zone).toLatLng()}latLngToVector(t){let i=this.originUTM.toVec3(),o=t.toUTM().rezone(this.originUTM.zone).toVec3(),s=fs.sub(fs.create(),o,i);return new Se().fromArray(s)}moveTransformByGeoThrottled(t,i,r,o){this.setMoveTransforByGeoData(i,r,o,t),this.transformAdapter.saveMatrixThrottled(t)}async moveTransformByGeo(t,i,r,o){this.setMoveTransforByGeoData(i,r,o,t),await this.transformAdapter.saveMatrix(t)}setMoveTransforByGeoData(t,i,r,o){let s=new wi(t,i,r),l=this.latLngToVector(s);nS(o,l)}async createMarker(t,i,r,o){if(oe(this.map))return null;let s=null;Iy(t)?s=t.location:By(t)&&(s=this.getTransformPosition(t.transformID));let l=await this.map.createMarker(s,r,o);return l.addListener("click",()=>this.map.setTarget(Lr(l.getPosition()))),this.fileMarkers.set(i,l),l}createLine(t){return oe(this.map)?null:this.map.createLine(t)}getTransformPosition(t){let i=this.getTransform(t);if(oe(i))throw new Error("Couldn't find transform");let r=i.getWorldPosition(new Se);return this.vectorToLatLng(r)}findAssetForTransform(t,i){for(let r of i)if(r.transformID===t)return r;return null}getAssetForTransform(t){return this.findAssetForTransform(t.transformID,this.stations)||this.findAssetForTransform(t.transformID,this.audios)||this.findAssetForTransform(t.transformID,this.videos)||this.findAssetForTransform(t.transformID,this.texts)||this.findAssetForTransform(t.transformID,this.signs)||this.findAssetForTransform(t.transformID,this.models)||this.findAssetForTransform(t.transformID,this.connections)}async removeTransform(t){t.parent.remove(t),ut(t);let i=new Array(t);t.traverse(r=>{r instanceof er&&i.push(r)});for(let r of i){let o=r.transformID;this.transformsByTransformID.delete(o);let s=this.getStation(o);if(s){this.signsByStation.delete(s),this.modelsByStation.delete(s),this.audiosByStation.delete(s),this.videosByStation.delete(s),this.textsByStation.delete(s),this.curConnections.delete(s);let l=new Array;for(let[c,u]of this.curConnections.entries())u===s&&l.push(c);for(let c of l)this.curConnections.delete(c,s)}}y(this.originLL)&&this.isEmpty&&await this.setOrigin(null)}async showStation(t,i,r){await super.showStation(t,i,r),this.dispatchEvent(new On(t,!1))}async showStationNow(t){this.visible=!0,this.curStation!==t&&(await this.showStation(t,!1),this.dispatchEvent(new sp(t)))}log(){}};var Gf=class extends kf{constructor(t,i,r,o){super(`/editor/scenarios/layout/${o}`);this.env=t;this.dataLogger=i;this.map=r}createScenario(t){return new oc(this.env,t,this.dataLogger,this.map)}};function Xf(n,e,t){let i=s=>y(s)&&y(t)&&t(s),r=new sc(null),o=new Map;for(let s of n){let l=new sc(s);o.set(s,l)}for(let s of o.values()){let l=e(s.value);(l!=null&&o.has(l)?o.get(l):r).connectSorted(s,i)}return r}var sc=class extends tl{get depth(){let e=0,t=this.parent;for(;y(t);)++e,t=t.parent;return e}removeFromParent(){for(;this.parent;)this.parent.disconnectFrom(this)}connectTo(e){e.removeFromParent(),super.connectTo(e)}connectAt(e,t){e.removeFromParent(),super.connectAt(e,t)}connectSorted(e,t){e.removeFromParent(),super.connectSorted(e,t)}get parent(){return this._reverse.length===0?null:this._reverse[0]}get children(){return this._forward}get isRoot(){return this._isEntryPoint}get isChild(){return!this._isEntryPoint}get isLeaf(){return this._isExitPoint}get hasChildren(){return!this._isExitPoint}};var Mpe=aA(`
.tree-view-node-children {
    padding-left: 1.25em;
}

.tree-view-node {
    white-space: pre;
    color: black;
    cursor: default;
}

    .tree-view-node:hover > .tree-view-node-label {
        background-color: rgb(127, 127, 127, 0.125);
    }

.tree-view-node-label[draggable=true] {
    cursor: grab;
}

.tree-view-node.disabled, .tree-view-node.disabled > .tree-view-node-label[draggable=true] {
    cursor: not-allowed;
}

    .tree-view-node.disabled > .tree-view-node-label, .tree-view-node.filtered > .tree-view-node-label {
        opacity: 0.5;
    }

    .tree-view-node.disabled:hover > .tree-view-node-label {
        background-color: unset;
    }

.tree-view-node.selected > .tree-view-node-label {
    background-color: rgb(221, 255, 255);
}

.tree-view-node.selected.disabled > .tree-view-node-label {
    background-color: lightgrey;
}

.tree-view-node .drag-buffer {
    width: 100%;
    height: 0.3em;
}

.tree-view-node.highlighted {
    background-color: rgb(221, 255, 221);
}

.tree-view-node .drag-buffer.highlighted {
    background-color: rgb(200 200 200);
}

.tree-view-node-collapser, .tree-view-node-adder {
    font-family: monospace;
    font-size: 80%;
    color: rgb(119, 119, 119);
    border: none;
    background-color: transparent;
}`),u0=class extends ge{constructor(e){super("click"),this.node=e}},ma=class extends ge{constructor(e){super("select"),this.node=e}},qf=class extends ge{get finished(){return this._finished}constructor(e,t){super(e),this.parent=t,this._finished=new et}complete(){this._finished.resolve()}},p0=class extends qf{constructor(e){super("add",e)}},ap=class extends qf{constructor(e){super("contextmenu",e)}},lp=class extends HTMLElement{static create(e,t,i,r,o,s,l,c){let u=document.createElement("tree-view-node");return u.node=e,u.defaultLabel=t,u._getLabel=i,u._getDescription=r,u._canChangeOrder=o,u._getChildDescription=s,u._canHaveChildren=l,u.createElement=c,u}get node(){return this._node}set node(e){this._node=e}constructor(){super(),this.eventTarget=new _r(super.addEventListener.bind(this),super.removeEventListener.bind(this),super.dispatchEvent.bind(this)),this.refresh=Hl(()=>this.onRefresh());let e=t=>Ye(i=>{this.disabled||(i.preventDefault(),i.stopPropagation(),t(i))});this.root=Ae(de("tree-view-node"),this.upper=Ae(de("drag-buffer","top")),this.infoView=Ae(de("tree-view-node-label"),e(()=>{this.selected||this._select(!0)}),pv(t=>{!this.disabled&&this.canHaveChildren&&(t.preventDefault(),t.stopPropagation(),this.open=!this.open)}),this.collapser=ys(de("tree-view-node-collapser"),Ye(t=>{this.canHaveChildren?(t.preventDefault(),t.stopPropagation(),this.open=!this.open):this._select(!0)})),this.labeler=Dr(ud(async t=>{this.disabled||await this._launchMenu(t,new ap(this))}))),this.subView=Ae(de("tree-view-node-children"),this.childTreeNodes=Ae(),this.adder=ys(de("tree-view-node-adder"),e(async t=>{this.canHaveChildren&&await this._launchMenu(t,new p0(this))}),ZA.emojiStyle)),this.lower=Ae(de("drag-buffer","bottom")))}connectedCallback(){this.attachShadow({mode:"closed"}).append(Mpe.cloneNode(),this.root),this.infoView.draggable=this.canChangeOrder,Ie(this.labeler,this.label),this.adder.title=this.adderTitle,this.setAttribute("open",""),this.open=this.node.isRoot,this.refresh()}addEventListener(e,t,i){this.eventTarget.addEventListener(e,t,i)}removeEventListener(e,t){this.eventTarget.removeEventListener(e,t)}dispatchEvent(e){return this.eventTarget.dispatchEvent(e)}addBubbler(e){this.eventTarget.addBubbler(e)}removeBubbler(e){this.eventTarget.removeBubbler(e)}addScopedEventListener(e,t,i,r){this.eventTarget.addScopedEventListener(e,t,i,r)}removeScope(e){this.eventTarget.removeScope(e)}clearEventListeners(e){this.eventTarget.clearEventListeners(e)}async _launchMenu(e,t){e.preventDefault(),e.stopPropagation(),this.adder.disabled=!0;try{this.dispatchEvent(t),await t.finished}catch{t.complete()}finally{this.adder.disabled=!1}}onRefresh(){this.node.isRoot!==(this.adder.parentElement===this.subView)&&(this.node.isRoot?this.subView.append(this.adder):this.infoView.append(this.adder));let e=this.canHaveChildren&&this.node.hasChildren&&this.node.isChild;Ea(this.collapser,this.collapserTitle),Ie(this.collapser,e?this.open?jc.emojiStyle:ad.emojiStyle:VA.emojiStyle),this.collapser.style.opacity=e?"1":"0",Ie(this.labeler,this.label),Ea(this.adder,this.adderTitle),Ue(this.adder,this.canHaveChildren,"inline-block"),Ue(this.upper,this.node.isChild&&this.canChangeOrder&&oe(this.previousSibling)),Ue(this.lower,this.node.isChild&&this.canChangeOrder),this.collapser.disabled=this.disabled&&!this.specialSelectMode||this.node.isRoot,this.adder.disabled=this.disabled||this.specialSelectMode}get specialSelectMode(){return this.adder.classList.contains("disabled")}set specialSelectMode(e){e!==this.specialSelectMode&&(this.adder.classList.toggle("disabled"),this.refresh())}get canHaveChildren(){return this._canHaveChildren(this.node)}get label(){return y(this.node.value)?this._getLabel(this.node.value):this.defaultLabel}get description(){return y(this.node.value)?this._getDescription(this.node.value):null}get childDescription(){return y(this.node.value)?this._getChildDescription(this.node.value):null}get canChangeOrder(){return y(this.node.value)&&this._canChangeOrder(this.node.value)}get collapserTitle(){return this.canHaveChildren?this.open?"Collapse "+this.description:"Expand "+this.description:"Select "+this.description}get adderTitle(){return"Add "+this.childDescription}get disabled(){return this.hasAttribute("disabled")}set disabled(e){e!==this.disabled&&(e?this.setAttribute("disabled",""):this.removeAttribute("disabled"),this.root.classList.toggle("disabled",e),this.refresh())}get filtered(){return this.hasAttribute("filtered")}set _filtered(e){e!==this.filtered&&(e?this.setAttribute("filtered",""):this.removeAttribute("filtered"),this.root.classList.toggle("filtered",e))}get selected(){return this.hasAttribute("selected")}set _selected(e){e!==this.selected&&(e?this.setAttribute("selected",""):this.removeAttribute("selected"),this.root.classList.toggle("selected",e))}get highlighted(){return this.root.classList.contains("highlighted")?0:this.upper.classList.contains("highlighted")?-1:this.lower.classList.contains("highlighted")?1:null}set highlighted(e){e!==this.highlighted&&(this.root.classList.remove("highlighted"),this.upper.classList.remove("highlighted"),this.lower.classList.remove("highlighted"),e===0?this.root.classList.add("highlighted"):e===-1?this.upper.classList.add("highlighted"):e===1&&this.lower.classList.add("highlighted"))}get open(){return this.hasAttribute("open")}set open(e){e!==this.open&&(e?this.setAttribute("open",""):this.removeAttribute("open"),Ue(this.subView,e),this.refresh())}add(e){this.open=!0;let t=new sc(e);this.node.connectTo(t),this.createElement(t),this.refresh()}_select(e){if(this.dispatchEvent(new u0(this.node)),!this.selected){let t=new ma(this.node);e||t.stopPropagation(),this.dispatchEvent(t)}}scrollIntoView(e){oe(e)&&(e={}),Ln(e)||(oe(e.behavior)&&(e.behavior="smooth"),oe(e.block)&&(e.block="center"),oe(e.inline)&&(e.inline="nearest")),super.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}};customElements.define("tree-view-node",lp);var d0=class extends ge{constructor(e,t){super("itemselected"),this.item=e,this.items=t}};function DT(...n){return Je("select",gF("select-list"),...n)}function m0(n,e){return new kr(n,Kf(e),!1,"select")}function CT(n){return m0("valueField",n)}function LT(n){return m0("labelField",n)}function PT(n){return m0("sortKeyField",n)}function Kf(n){if(oe(n)||n.length===0)return null;let e=null;return Ve(n)?e=t=>(ci(t)&&n in t&&(e=i=>i[n]),e?e(t):null):e=n,t=>oe(t)?null:e(t)}function Yf(n){return oe(n)?null:Ve(n)?n:"toString"in n&&Ke(n.toString)?n.toString():null}var h0=class extends HTMLSelectElement{constructor(){super(),this.valueToOption=new Map,this.optionToItem=new Map,this._values=[],this._getValue=Yf,this._getLabel=Yf,this._getSortKey=null,this.noSelection=null,this.noSelectionText=null,this.eventTarget=new _r(super.addEventListener.bind(this),super.removeEventListener.bind(this),super.dispatchEvent.bind(this)),this.addEventListener("input",()=>this.dispatchEvent(new d0(this.selectedItem,this.selectedItems)))}connectedCallback(){for(let e of this.getAttributeNames())this.setAttribute(e,this.getAttribute(e))}setAttribute(e,t){switch(e.toLowerCase()){case"valuefield":this.valueField=Kf(t);break;case"labelfield":this.labelField=Kf(t);break;case"sortkeyfield":this.sortKeyField=vn(Kf(t));break;case"placeholder":this.placeholder=t;break;default:super.setAttribute(e,t)}}removeAttribute(e){switch(e.toLowerCase()){case"valuefield":this.valueField=null;break;case"labelfield":this.labelField=null;break;case"sortkeyfield":this.sortKeyField=null;break;case"placeholder":this.placeholder=null;break;default:super.removeAttribute(e)}}get valueField(){return this._getValue}set valueField(e){e!==this.valueField&&(super.removeAttribute("getValue"),this._getValue=e||Yf,this.render())}get labelField(){return this._getLabel}set labelField(e){e!==this.labelField&&(super.removeAttribute("getLabel"),this._getLabel=e||Yf,this.render())}get sortKeyField(){return this._getSortKey}set sortKeyField(e){e!==this.sortKeyField&&(this.removeAttribute("getSortKey"),this._getSortKey=e,this.render())}get placeholder(){return this.noSelectionText}set placeholder(e){e!==this.placeholder&&(this.noSelectionText=e,this.noSelectionText?this.noSelection=bn(mF(!0),pF(!0),e):this.noSelection=null,this.render())}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get count(){return this._values&&this._values.length||0}get emptySelectionEnabled(){return!oe(this.noSelection)}get data(){return this._values}set data(e){if(e=e||null,e!==this._values){let t=this.selectedItem;un(this._values,...e),this.render(),this.selectedItem=t}}get selectedOption(){return this.selectedOptions.item(0)}set selectedOption(e){for(let t=0;t<this.options.length;++t){let i=this.options[t];i.selected=i===e}}get makeValue(){return this.valueField||this.labelField}get makeLabel(){return this.labelField||this.valueField}get values(){return Array.from(this.selectedOptions).map(e=>e.value)}set values(e){let t=new Set(e);for(let i of this.options)i.selected=t.has(i.value||i.innerHTML)}get selectedItem(){return this.optionToItem.get(this.selectedOption)}set selectedItem(e){this.makeValue&&(this.selectedOption=this.valueToOption.get(this.makeValue(e)))}get selectedItems(){return Array.from(this.selectedOptions).map(e=>this.optionToItem.get(e))}set selectedItems(e){this.values=e.map(t=>this.makeValue(t))}render(){if(St(this),this.valueToOption.clear(),this.optionToItem.clear(),this.makeValue&&((this.count===0||this.emptySelectionEnabled)&&this.mapOption(null,this.noSelection),this.count>0)){let e=[...this.data];this.sortKeyField&&e.sort(this.sortKeyField);for(let t of e){let i=bn(Qt(this.makeValue(t)),this.makeLabel(t));this.mapOption(t,i)}}}mapOption(e,t){this.append(t),this.valueToOption.set(this.makeValue(e),t),this.optionToItem.set(t,e)}addEventListener(e,t,i){this.eventTarget.addEventListener(e,t,i)}removeEventListener(e,t){this.eventTarget.removeEventListener(e,t)}dispatchEvent(e){return this.eventTarget.dispatchEvent(e)}addBubbler(e){this.eventTarget.addBubbler(e)}removeBubbler(e){this.eventTarget.removeBubbler(e)}addScopedEventListener(e,t,i,r){this.eventTarget.addScopedEventListener(e,t,i,r)}removeScope(e){this.eventTarget.removeScope(e)}clearEventListeners(e){this.eventTarget.clearEventListeners(e)}};customElements.define("select-list",h0,{extends:"select"});var cp=class extends ge{constructor(e,t){super(e),this.node=t}},f0=class extends cp{constructor(e){super("delete",e)}},g0=class extends cp{constructor(e,t){super("moved",e),this.newIndex=t}},x0=class extends cp{constructor(e,t){super("reparented",e),this.newParent=t}},Qf=class extends Be{constructor(e,...t){super(),this.filterTypeInput=null,this.elements=new Array,this.nodes2Elements=new Map,this.htmlElements2Nodes=new Map,this.htmlElements2Elements=new Map,this._rootNode=null,this.locked=!1,this._disabled=!1,this.typeFilter=null,this.nameFilter=null,this.readonly=!1,this.createElement=this.createElement.bind(this),this.options=Object.assign({defaultLabel:null,getOrder:null,replaceElement:null,canReorder:Sp,additionalProperties:[]},e);let i=this.options.canReorder;if(y(i)&&(this.options.canReorder=r=>!this.readonly&&i(r)),oe(this.options.canParent)&&(this.options.canParent=this.options.canHaveChildren),this._canChangeOrder=Ke(this.options.getOrder),this.element=Ae(de("tree-view"),...t,this.filters=Ji.create(de("tree-view-controls"),...this.options.additionalProperties),Ae(de("tree-view-controls"),this.collapseButton=jn(Ye(()=>this.collapseAll()),"Collapse all"),this.expandButton=jn(Ye(()=>this.expandAll()),"Expand all")),Ae(de("tree-view-inner"),_F(0),ud(async r=>{if(!this.disabled){let o=this.nodes2Elements.get(this.rootNode);await o._launchMenu(r,new ap(o))}}),Ye(r=>{if(!this.disabled&&!r.defaultPrevented){for(let o of this.elements)if(o.selected){this.selectedNode=null,this.dispatchEvent(new ma(null));return}}}),hv(r=>{if(ao(r)){let o=this.selectedElement;if(o){if(r.key==="Delete")this.dispatchEvent(new f0(o.node));else if(r.key==="ArrowUp"){let s=Pc(o);if(s>0){let l=o.parentElement.children[s-1];this.htmlElements2Elements.get(l)._select(!0)}else if(o.node.isChild&&o.node.parent.isChild){let l=o.node.parent;this.nodes2Elements.get(l)._select(!0)}}else if(r.key==="ArrowDown"){let s=Pc(o);if(s<o.parentElement.childElementCount-1){let l=o.parentElement.children[s+1];this.htmlElements2Elements.get(l)._select(!0)}else if(o.node.isChild){let l=o.node.parent,c=this.nodes2Elements.get(l),u=Pc(c),p=c.parentElement.children[u+1];p&&this.htmlElements2Elements.get(p)._select(!0)}}else if(r.key==="ArrowRight"){if(o.node.hasChildren)if(o.open){let s=o.childTreeNodes.children[0];s&&this.htmlElements2Elements.get(s)._select(!0)}else o.open=!0}else if(r.key==="ArrowLeft"){let s=this.selectedElement;s.open?s.open=!1:s.node.isChild&&s.node.parent.isChild&&this.nodes2Elements.get(s.node.parent)._select(!0)}}else if(this.children.children.length>0){let s=this.nodes2Elements.get(this.rootNode),l=null;r.key==="ArrowUp"?l=s.childTreeNodes.children[s.childTreeNodes.children.length-1]:r.key==="ArrowDown"&&(l=s.childTreeNodes.children[0]),l&&this.htmlElements2Elements.get(l)._select(!0)}}}),this.children=Ae(de("tree-view-children")))),(this.options.showNameFilter||y(this.options.typeFilters))&&(this.options.showNameFilter&&this.filters.append(["Name",this.filterNameInput=ni(de("form-control"),bt("Filter by name"),ko("off"),Oe(()=>{this.nameFilter=this.filterNameInput.value.toLocaleLowerCase(),this.nameFilter.length===0&&(this.nameFilter=null),this.refreshFilter()}))]),y(this.options.typeFilters)&&(this.filters.append(["Type",this.filterTypeInput=DT(CT(r=>r),LT(this.options.typeFilters.getTypeLabel),PT(this.options.typeFilters.getTypeLabel),bt("Filter by type"))]),this.filterTypeInput.data=this.options.typeFilters.getTypes(),this.filterTypeInput.addEventListener("itemselected",r=>{this.typeFilter=r.item,this.refreshFilter()})),this.filters.append(Ma("Clear filter",Ye(()=>this.clearFilter())))),this.canChangeOrder){let r=null,o=null,s=null,l=0,c=null,u=()=>{s&&clearTimeout(s),c=null,o&&(o.highlighted=null,o=null),l=0};Ee(this.children,pd(p=>{u(),r=this.findElement(p.target),r.style.opacity="0.5"}),za(p=>{let d=p.target,h=d!==c,A=this.findElement(d);h&&(u(),c=d),A&&this.canReparent(A,r,d)&&(o=A,d===A.upper?l=-1:d===A.lower?l=1:l=0,o.highlighted=l,h&&l===0&&!A.open&&(s=setTimeout(()=>A.open=!0,1e3)),p.preventDefault())}),dd(p=>{this.canReparent(o,r,c)&&(p.preventDefault(),this.reparentNode(r.node,o.node,l)),u()}),Ua(()=>{r&&(r.style.opacity="1"),u()}))}this.options.replaceElement&&Mp(this.options.replaceElement,this)}clearFilter(){y(this.filterNameInput)&&(this.filterNameInput.value="",this.nameFilter=null),y(this.filterTypeInput)&&(this.filterTypeInput.selectedItem=null,this.typeFilter=null),this.refreshFilter()}refreshFilter(){let e=new Set;for(let t of this.rootNode.depthFirst()){let i=oe(this.nameFilter)||y(t.value)&&this.options.getLabel(t.value).toLocaleLowerCase().indexOf(this.nameFilter)>=0,r=oe(this.typeFilter)||y(t.value)&&this.options.typeFilters.getTypeFor(t.value)===this.typeFilter,o=i&&r,s=o||e.has(t),l=this.nodes2Elements.get(t);Ue(l,s,"block"),l._filtered=e.has(t)&&!o,l.open=!0,s&&y(t.parent)&&e.add(t.parent)}y(this.selectedElement)&&this.selectedElement.scrollIntoView()}canReparent(e,t,i){return!this.readonly&&y(e)&&y(t)&&(e.canHaveChildren&&this.options.canParent(e.node,t.node)||i===e.upper||i===e.lower)&&!t.node.contains(e.node)&&t.node.parent!==e.node}get canChangeOrder(){return!this.readonly&&this._canChangeOrder}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get disabled(){return this._disabled}set disabled(e){this.expandButton.disabled=this.collapseButton.disabled=this.filters.disabled=this._disabled=e;for(let t of this.elements)t.disabled=e}async withLock(e){let t=this.enabled;if(this.enabled)try{await e()}finally{this.enabled=t}}findAll(e){return Array.from(this.rootNode.searchAll(t=>e(t.value)))}enableOnlyValues(e){for(let t of this.elements)t.disabled=e.indexOf(t.node.value)===-1,t.specialSelectMode=!0}enableAllElements(){for(let e of this.elements)e.disabled=!1,e.specialSelectMode=!1}get values(){return this.rootNode.children.flatMap(e=>Array.from(e.breadthFirst())).map(e=>e.value)}set values(e){this.rootNode=Xf(e,this.options.getParent,this.options.getOrder)}get rootNode(){return this._rootNode}set rootNode(e){if(e!==this.rootNode){this.locked=!0;for(let t of this.elements)t.removeScope(this),t.removeBubbler(this);if(St(this.children),qe(this.elements),this.nodes2Elements.clear(),this.htmlElements2Nodes.clear(),this.htmlElements2Elements.clear(),this._rootNode=e,this.rootNode){for(let i of this.rootNode.breadthFirst())this.createElement(i);let t=this.nodes2Elements.get(this.rootNode);Ee(this.children,t)}this.locked=!1;for(let t of this.elements)t.canHaveChildren&&this.reorderChildren(t);this.rootNode&&this.nodes2Elements.get(this.rootNode).refresh()}}clear(){this.rootNode=null}get selectedValue(){let e=this.selectedNode;return e?e.value:null}findNode(e){return this.rootNode.find(e)}set selectedValue(e){e!==this.selectedValue&&(this.selectedNode=this.rootNode.find(e))}get selectedNode(){let e=this.selectedElement;return e?e.node:null}set selectedNode(e){e!==this.selectedNode&&(this.selectedElement=this.nodes2Elements.get(e))}get selectedElement(){for(let e of this.elements)if(e.selected)return e;return null}set selectedElement(e){if(y(e)){e._select(!1);let t=e;for(;y(t);)t.open=!0,t=this.nodes2Elements.get(t.node.parent);e.scrollIntoView()}else e=this.selectedElement,y(e)&&(e._selected=!1),this.dispatchEvent(new ma(null))}findElement(e){let t=e;for(;t!==null;){let i=this.htmlElements2Elements.get(t);if(y(i))return i;if(t=t.parentElement,t===this.children)return null}return null}reorderChildren(e){if(!this.locked&&this.canChangeOrder){let t=e.childTreeNodes.children.length;for(let i=0;i<t;++i){let r=e.childTreeNodes.children[i],o=this.htmlElements2Nodes.get(r),s=this.nodes2Elements.get(o);this.options.getOrder(o.value)!==i&&this.dispatchEvent(new g0(o,i)),s.refresh()}e.refresh()}}createElement(e){let t=lp.create(e,this.options.defaultLabel,this.options.getLabel,this.options.getDescription,this.options.canReorder,this.options.getChildDescription,this.options.canHaveChildren,this.createElement);t.addScopedEventListener(this,"select",r=>{for(let o of this.elements)o._selected=o.node===r.node}),t.addBubbler(this),this.elements.push(t),this.nodes2Elements.set(e,t),this.htmlElements2Nodes.set(t,e),this.htmlElements2Elements.set(t,t);let i=e.parent;if(i){let r=this.nodes2Elements.get(i);if(r)if(!this.canChangeOrder)Ee(r.childTreeNodes,t);else{let o=this.options.getOrder(e.value),s=Number.MAX_SAFE_INTEGER,l=null;for(let u of i.children)if(u!==e){let p=this.options.getOrder(u.value);p>o&&p<s&&(l=u,s=p)}let c=this.nodes2Elements.has(l)&&this.nodes2Elements.get(l)||null;Mr(r.childTreeNodes,t,c),this.reorderChildren(r)}}return t}addValue(e){let t=this.options.getParent(e),i=oe(t)?this.rootNode:this.rootNode.find(t);this.nodes2Elements.get(i).add(e)}updateNode(e){let t=this.nodes2Elements.get(e);t&&t.refresh()}reparentNode(e,t,i){let r=e.parent,o=this.nodes2Elements.get(e),s=this.nodes2Elements.get(r),l=this.nodes2Elements.get(t),c=null;if(i!==0){if(c=l,t=t.parent,l=this.nodes2Elements.get(t),i===1){let u=Pc(c)+1,p=l.childTreeNodes.children[u];c=this.htmlElements2Elements.get(p)}}else if(this.canChangeOrder){let u=this.options.getOrder(e.value);for(let p=0;p<t.children.length&&c===null;++p){let d=t.children[p];this.options.getOrder(d.value)>u&&(c=this.nodes2Elements.get(d))}}Mr(l.childTreeNodes,o,c),l!==s?(t.connectTo(e),this.reorderChildren(s),this.reorderChildren(l),this.dispatchEvent(new x0(e,t))):this.reorderChildren(s),l.open=!0}removeValue(e){this.removeNode(this.rootNode.find(e))}removeNode(e){let t=this.nodes2Elements.get(e);t.selected&&this.dispatchEvent(new ma(null));let i=this.nodes2Elements.get(e.parent);t.removeScope(this),t.removeBubbler(this),t.remove(),e.removeFromParent(),Pt(this.elements,t),this.nodes2Elements.delete(e),this.htmlElements2Nodes.delete(t),this.htmlElements2Elements.delete(t),this.reorderChildren(i)}collapseAll(){for(let e of this.elements)e.node.isChild&&e.canHaveChildren&&(e.open=!1)}expandAll(e=null){for(let t of this.elements)t.node.isChild&&t.canHaveChildren&&(oe(e)||t.node.depth<=e)&&(t.open=!0)}};var $f=class extends Qf{_scenario=null;constructor(...e){super({showNameFilter:!0,typeFilters:{getTypes:()=>kT,getTypeLabel:t=>rc.get(t),getTypeFor:t=>Fo(t)},getLabel:t=>{let i=Fo(t),r=this.getAssetName(t);if(oe(r))return wx.emojiStyle+"N/A";let o=Rf.get(i);return this.isStartStation(t)&&(o+=so.emojiStyle),o+" "+r},getParent:t=>this.getAssetParent(t),getOrder:t=>this.getAssetOrder(t),getDescription:t=>Fo(t)||"N/A",canReorder:t=>gn(t)||Mt(t)||wo(t),getChildDescription:t=>oe(t)&&"scenario"||Hi(t)&&"zone"||gn(t)&&"station/ambient audio"||Mt(t)&&"connection/sign/audio/video/text/model",canHaveChildren:t=>Hi(t.value)||gn(t.value)||Mt(t.value),canParent:(t,i)=>Hi(t.value)&&gn(i.value)||gn(t.value)&&(Mt(i.value)||wo(i.value))||Mt(t.value)&&(i0(i.value)||tc(i.value)||ec(i.value)||nc(i.value)||Zl(i.value)||Ar(i.value))},...e)}getAssetName(e){let t=Fo(e);if(oe(t))return null;let i="";if(Hi(e))i+=e.name;else if(gn(e))i+=e||"Default",e===""&&(i+=iv.emojiStyle);else if(Mt(e)||wo(e)||ec(e)||ic(e)||tc(e)||nc(e)||Zl(e))i+=e.fileName;else if(Ar(e)){if(e.label&&e.label!==" \u2B06\uFE0E\uFE0E ")i+=e.label;else if(this.scenario){let r=this.scenario.getStation(e.toStationID);r?i+=r.fileName:i+="XXX BROKEN CONNECTION XXX"}}return i}get scenario(){return this._scenario}set scenario(e){if(e!==this.scenario&&(this.clear(),this._scenario=e,this.readonly=!this.scenario||this.scenario.published,y(this.scenario))){let t=[this.scenario,...this.scenario.zones.map(r=>r||""),...this.scenario.stations,...this.scenario.audios,...this.scenario.videos,...this.scenario.texts,...this.scenario.signs,...this.scenario.models,...this.scenario.connections];this.scenario.zones.length===0&&vs(t,"",0);let i=Xf(t,r=>this.getAssetParent(r),r=>this.getAssetOrder(r)).children[0];i.removeFromParent(),this.rootNode=i,this.expandAll(1)}}getAssetParent(e){if(oe(e)||Hi(e))return null;if(gn(e))return this.scenario;if(Mt(e)||wo(e))return e.zone;{let t=this.scenario.getTransform(e.transformID);return this.scenario.findStation(t)}}getAssetOrder(e){return Hi(e)&&-1||gn(e)&&(e===""?0:1)||Mt(e)&&(this.isStartStation(e)?2:3)||wo(e)&&4||i0(e)&&5||ec(e)&&6||tc(e)&&7||nc(e)&&8||Zl(e)&&9}isStartStation(e){return Mt(e)&&y(this.scenario)&&this.scenario.startStationID===e.transformID}};var Jf=class extends Mi{iframe;constructor(){super("File detail"),Ue(this.cancelButton,!1),Ie(this.confirmButton,"Close"),Ee(this.contentArea,this.iframe=Ca(V0("none"),Pn(vi(40)),To(vi(50)),Ii("File detail")))}async showFile(e){this.iframe.src=`/Editor/Files/Detail/${e}?hideBanner`,await this.showDialog()}};function RT(n){return n instanceof dt||n instanceof kr}function Dpe(n){return!RT(n)}var Zf=class{constructor(...e){let t=e.filter(RT),i=e.filter(Dpe);this.element=Ae(de("scroll-panel"),...t,Ae(de("scroll-panel-inner"),...i))}};function IT(n,...e){return Ee(document.createElement("tip-box"),At(n),nA(bF("tips-slot"),...e.map(t=>XF(t))))}var Cpe=ZF(nx(QF("Tips:"),KF(Do("tips-slot")))),w0=class extends HTMLElement{constructor(){super(),this.eventTarget=new _r(super.addEventListener.bind(this),super.removeEventListener.bind(this),super.dispatchEvent.bind(this))}connectedCallback(){let e=`Juniper:Widgets:TipBox:${this.id}`,t=this.attachShadow({mode:"closed"}),i=Cpe.content.cloneNode(!0);t.appendChild(i);let r=nx(FF(t,"details"),wF(localStorage.getItem(e)!=="closed"),xv(()=>localStorage.setItem(e,r.open?"open":"closed")))}addEventListener(e,t,i){this.eventTarget.addEventListener(e,t,i)}removeEventListener(e,t){this.eventTarget.removeEventListener(e,t)}dispatchEvent(e){return this.eventTarget.dispatchEvent(e)}addBubbler(e){this.eventTarget.addBubbler(e)}removeBubbler(e){this.eventTarget.removeBubbler(e)}addScopedEventListener(e,t,i,r){this.eventTarget.addScopedEventListener(e,t,i,r)}removeScope(e){this.eventTarget.removeScope(e)}clearEventListeners(e){this.eventTarget.clearEventListeners(e)}};customElements.define("tip-box",w0);var ac=class extends Be{_element=null;_enabled=!0;refresh;constructor(){super(),this.refresh=Hl(()=>this.onRefresh())}get visible(){return zn(this.element)}set visible(e){Ue(this.element,e)}get element(){return this._element}get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.refresh())}get disabled(){return!this.enabled}set disabled(e){this.enabled=!e}};var lc=class extends ac{constructor(t,i){super();this.title=t;this._element=Ae(Ct("section"),this.scrollPanel=new Zf(this.properties=Ji.create()),this.assetControls=Ae(Ct("controls"))),y(i)&&i.length>0&&Mr(this.element,IT(t+"Tips",...i),this.scrollPanel)}_scenario=null;scrollPanel;properties;assetControls;addProperties(...t){this.properties.append(...t)}addAssetControls(...t){for(let i=t.length-1;i>=0;--i)Mr(this.assetControls,t[i],this.assetControls.children[0])}get scenario(){return this._scenario}set scenario(t){if(t!==this.scenario){let i=this.scenario;this._scenario=t,this.onScenarioChanged(i)}}get hasScenario(){return!!this.scenario}get canEdit(){return this.enabled&&this.hasScenario}onRefresh(){let t=new Array;for(let i=0;i<this.element.childElementCount;++i)this.element.children[i]===this.scrollPanel.element?t.push(yo(1)):t.push("auto");this.element.style.gridTemplateRows=t.join(" "),this.properties.disabled=!this.canEdit}};var F0="renameWarning",cc=class extends lc{_value=null;nameInput;renameWarningText;deleteButton;constructor(e,t,i=!0){super(e,t),this.addProperties(["Name",this.nameInput=ni(de("form-control"),bt(e+" name"))],ds(F0,Ae(Ct("alert alert-warning"),`Cannot rename ${e} to `,this.renameWarningText=Dr()))),this.addAssetControls(this.deleteButton=Lp("Delete "+e,Ye(()=>this.dispatchEvent(new Cf(this.value)))));let r=()=>{this.refresh(),this.canRename&&this.dispatchEvent(new Df(this.value,this.nameInput.value))};i?this.nameInput.addEventListener("input",r):(this.nameInput.addEventListener("change",r),mv(r).applyToElement(this.nameInput)),this.properties.setGroupVisible(F0,!1)}onScenarioChanged(e){this._value=null,this.refreshValues()}get value(){return this._value}set value(e){e!==this.value&&(this._value=e,this.refreshValues())}get hasValue(){return y(this.value)}get canEdit(){return super.canEdit&&this.hasValue&&this.hasScenario&&!this.scenario.published}get canDelete(){return this.canEdit}get name(){return this.nameInput.value}get nameChanged(){return this.getValueName(this.value)!==this.name}get canRename(){return this.canEdit&&this.nameChanged&&this.name.trim().length>0}onValueChanged(){this.hasValue?this.nameInput.value=this.getValueName(this.value):this.nameInput.value=null}refreshValues(){this.onValueChanged(),this.refresh()}onRefresh(){super.onRefresh(),Ie(this.renameWarningText,`'${this.name}'`),this.properties.setGroupVisible(F0,this.canEdit&&this.nameChanged&&!this.canRename),this.nameInput.disabled=!this.canEdit,this.deleteButton.disabled=!this.canDelete}};var uc=class extends cc{resetButton;constructor(e,t,i){super(e,i),this.addAssetControls(this.resetButton=Lp(t,Ye(()=>this.dispatchEvent(new Lf(this.value))))),Ee(this.element)}onRefresh(){super.onRefresh(),this.resetButton.disabled=!this.canEdit}getTransformModes(e){return[Ne.Orbit,Ne.RotateGlobalSpace,Ne.RotateObjectSpace,Ne.RotateViewSpace,Ne.Resize,Ne.MoveGlobalSpace,Ne.MoveObjectSpace,Ne.MoveViewSpace]}updateTransformView(e){if(e===this.value&&this.refreshValues(),!Ar(e)){let t=this.scenario.getTransform(e.transformID);this.scenario.transformAdapter.updateMarker(t,e)}}saveTransform(e){let t=this.scenario.getTransform(e.transformID);return this.scenario.transformAdapter.saveMatrix(t)}};var ai=class extends uc{constructor(t,i,r,o,s,l){super(t,i,l);this.filePicker=r;this.fileTypes=o;this.fileTags=s;this.addAssetControls(this.detailButton=jn("View File Detail",Ye(()=>this.dispatchEvent(new Pf(this.value)))))}detailButton;async reloadFile(){await this.scenario.env.fetcher.evict(this.value.filePath),await this.value.reload(this.scenario.env.loadingBar)}onRefresh(){super.onRefresh(),this.detailButton.disabled=!this.canEdit}async createValue(t,i){if(!this.validateParent(t))throw new Error("Incorrect parent type.");let r=await this.getFile(t);return y(r)?await this.onFileSelection(t,r,i):null}async getFile(t){return this.filePicker.setTypeFilters(...this.fileTypes),this.filePicker.setTags(...this.fileTags),await this.filePicker.showDialog()&&y(this.filePicker.selectedFile)?this.filePicker.selectedFile:null}};var eg=class extends ai{labelInput;enabledInput;volumeInput;constructor(e){super("Audio","Reset Audio",e,[Si,kc],["voiceover"],["Upload MP3 or WEBA files"]);let t=()=>{this.scenario.audioAdapter.updateThrottled(this.value,{enabled:this.trackEnabled,label:this.label,volume:this.volume})};this.addProperties(["Enabled",this.enabledInput=Xn(Oe(t))],["Label",this.labelInput=Cr(bt("Enter label"),de("form-control"),Ta("soft"),ko("off"),qt("lpignore","true"),Oe(t))],["Volume",this.volumeInput=new gt(de("form-control"),at(0),st(100),nt(1),bt("Volume"),Oe(t))]),Object.seal(this),this.refreshValues()}getValueName(e){return e.fileName}renameValue(e,t){this.scenario.audioAdapter.updateThrottled(e,{fileName:t})}async resetValue(e){await this.scenario.audioAdapter.reset(e,this.scenario.env.defaultAvatarHeight)}deleteValue(e){return this.scenario.audioAdapter.delete(e)}validateParent(e){return Mt(e)}onFileSelection(e,t,i){return this.scenario.audioAdapter.create(e,t,i)}get canEdit(){return super.canEdit&&oe(this.value.error)}get label(){return this.labelInput.value}set label(e){this.labelInput.value=e}get volume(){return wd(this.volumeInput.value)}set volume(e){this.volumeInput.value=xd(e)}get trackEnabled(){return this.enabledInput.indeterminate?null:this.enabledInput.checked}set trackEnabled(e){this.enabledInput.indeterminate=oe(e),this.enabledInput.checked=y(e)&&e}onValueChanged(){super.onValueChanged(),this.hasValue?(this.label=this.value.label,this.volume=this.value.volume,this.trackEnabled=this.value.enabled):(this.label="",this.volume=null,this.trackEnabled=null)}onRefresh(){super.onRefresh(),this.labelInput.disabled=this.volumeInput.disabled=this.enabledInput.disabled=!this.canEdit}};var rr=class{constructor(...e){let i=e.filter(kF).map((r,o)=>o===0?yo(1):"auto");this.element=Ae(de("group-panel"),As(...i),...e),Object.seal(this)}};var A0=class extends ge{constructor(t){super("connectionstarted");this.connectables=t}},tg=class extends uc{toStationSelection=new et(!1);toStationName;selectStationButton;fromStation=null;toStation=null;constructor(){super("Connection","Reset Connection"),this.addProperties(["To Station",new rr(fp(ui(5)),this.toStationName=Ut(),this.selectStationButton=Ma("Select",Ye(()=>this.dispatchEvent(new On(this.toStation,!1)))))]),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.cancelConnection()}),Object.seal(this),this.refreshValues()}getValueName(e){return e.label||""}renameValue(e,t){this.scenario.connectionAdapter.updateThrottled(e,t)}async resetValue(e){await this.scenario.connectionAdapter.reset(e)}get isConnecting(){return this.toStationSelection.running}connectTo(e){this.isConnecting&&this.toStationSelection.resolve(e)}cancelConnection(){this.isConnecting&&this.toStationSelection.resolve(null)}async createValue(e){this.toStationSelection.restart();let t=this.scenario.connectionAdapter.getConnectableStations(e);this.dispatchEvent(new A0(t));let i=await this.toStationSelection;return this.dispatchEvent(new ge("connectionending")),oe(i)?(console.warn("Station connection selection cancelled"),null):t.indexOf(i)===-1?(console.warn(`Invalid connection: "${e.fileName}" -> "${i.fileName}"`),null):(await this.scenario.connectionAdapter.create(e,i),this.scenario.connectionAdapter.findConnection(e,i))}async deleteValue(e){let t=this.scenario.getStation(e.fromStationID),i=this.scenario.getStation(e.toStationID);await this.scenario.connectionAdapter.disconnect(t,i)}get hasFromStation(){return!!this.fromStation}get hasToStation(){return!!this.toStation}get canEdit(){return super.canEdit&&this.hasFromStation&&this.hasToStation}onValueChanged(){super.onValueChanged(),this.hasValue?(this.fromStation=this.scenario.getStation(this.value.fromStationID),this.toStation=this.scenario.getStation(this.value.toStationID)):(this.fromStation=null,this.toStation=null),Ie(this.toStationName,this.hasToStation?this.toStation.fileName:"N/A")}onRefresh(){super.onRefresh(),this.selectStationButton.disabled=this.disabled||!this.hasToStation}};function BT(n){return n*.01}function VT(n){return n*100}var ng=class extends ai{constructor(t,i){super("Environment Audio","Reset",t,[Si,kc],["ambient"],["Center the map on an empty space","Upload MP3 or WEBA files"]);this.mapView=i;let r=()=>{this.scenario.audioAdapter.updateThrottled(this.value,{enabled:this.trackEnabled,volume:this.volume,effect:this.effect,minDistance:this.minDistance,maxDistance:this.maxDistance}),this.refreshOverlay()};this.addProperties(["Enabled",this.enabledInput=Xn(Oe(r))],["Latitude",this.latitudeBox=Ut()],["Longitude",this.longitudeBox=Ut()],["Elevation",new rr(this.elevationInput=yi(de("form-control"),Oe(()=>this.scenario.audioAdapter.changeElevationThrottled(this.value,this.elevation)),bt("Elevation"),nt(.001)),this.resetButton)],["Volume",this.volumeInput=new gt(de("form-control"),at(0),st(500),bt("Volume"),Oe(r))],["Effect",this.effectInput=Vi(de("custom-select"),Oe(r))],["Min dist",this.minDistanceInput=yi(de("form-control"),at(0),st(1e3),nt(.01),bt("Minimum distance"),Oe(r))],["Max dist",this.maxDistanceInput=yi(de("form-control"),at(0),st(1e3),nt(.01),bt("Maximum distance"),Oe(r))]),Ee(this.effectInput,bn("NONE"),...Array.from(dh.keys()).map(o=>bn(o,Qt(o)))),Object.seal(this),this.refreshValues()}volumeInput;latitudeBox;longitudeBox;elevationInput;minDistanceInput;maxDistanceInput;enabledInput;effectInput;getTransformModes(){return[Ne.MoveGlobalSpace,Ne.MoveObjectSpace,Ne.MoveViewSpace,Ne.RotateGlobalSpace,Ne.RotateObjectSpace,Ne.RotateViewSpace]}updateTransformView(t){super.updateTransformView(t),t.updateAudioPosition()}getValueName(t){return t.fileName}renameValue(t,i){this.scenario.audioAdapter.updateThrottled(t,{fileName:i})}async resetValue(t){let r=this.scenario.fileMarkers.get(t.transformID).getPosition(),o=await this.mapView.getElevation(Lr(r));await this.scenario.audioAdapter.changeElevation(t,o)}deleteValue(t){return this.scenario.audioAdapter.delete(t)}validateParent(t){return gn(t)}async onFileSelection(t,i,r){let o=await this.mapView.getCenter();await this.scenario.resolveOrigin(o);let s=await this.scenario.audioAdapter.create(null,i,r);await this.scenario.audioAdapter.update(s,{zone:t});let l=this.scenario.getTransform(s.transformID);return await this.scenario.moveTransformByGeo(l,o.lat,o.lng,o.alt),this.scenario.transformAdapter.updateMarker(l,s),s}get canEdit(){return super.canEdit&&oe(this.value.error)}get elevation(){return this.hasValue?this.elevationInput.valueAsNumber:null}set elevation(t){y(t)&&(t=Oh(Math.round(Vh(t)))),t!==this.elevation&&y(t)&&(this.elevationInput.valueAsNumber=t)}get volume(){return BT(this.volumeInput.valueAsNumber)}set volume(t){this.volumeInput.valueAsNumber=Math.round(VT(t))}get minDistance(){return Ht(this.minDistanceInput.value)}set minDistance(t){this.minDistanceInput.value=It(t,2)}get maxDistance(){return Ht(this.maxDistanceInput.value)}set maxDistance(t){this.maxDistanceInput.value=It(t,2)}get effect(){return this.effectInput.selectedIndex===0?null:this.effectInput.value}set effect(t){t?this.effectInput.value=t:this.effectInput.selectedIndex=0}get trackEnabled(){return this.enabledInput.indeterminate?null:this.enabledInput.checked}set trackEnabled(t){this.enabledInput.indeterminate=oe(t),this.enabledInput.checked=y(t)&&t}get canMove(){return this.canEdit&&this.scenario.stations.length>0}rangeOverlay=null;onValueChanged(){if(super.onValueChanged(),this.hasValue){let t=this.scenario.getTransformPosition(this.value.transformID),[i,r]=new wi(t).toDMSArray(2);Ie(this.latitudeBox,i),Ie(this.longitudeBox,r),this.elevation=t.alt,this.trackEnabled=this.value.enabled,this.volume=this.value.volume,this.minDistance=this.value.minDistance,this.maxDistance=this.value.maxDistance,this.effect=this.value.effect}else Ie(this.latitudeBox,"N/A"),Ie(this.longitudeBox,"N/A"),this.elevation=null,this.trackEnabled=null,this.volume=null,this.minDistance=null,this.maxDistance=null,this.effect=null;this.refreshOverlay()}lock=!1;async refreshOverlay(){if(!this.lock){if(this.lock=!0,y(this.rangeOverlay)&&this.rangeOverlay.setMap(null),this.hasValue){let{maxDistance:t,minDistance:i}=this.value,r=this.scenario.getTransformPosition(this.value.transformID),o=500,s=o/5,l=ur(2*o,2*o),c=10*t,u=i*o/c,p=t*o/c,d=l.getContext("2d"),h=d.createRadialGradient(o,o,0,o,o,o);for(let A=0;A<=s;++A){let g=A/s,F=g*c,R=this.value.clip.spatializer.getGainAtDistance(F)*this.value.volume,P=mp(hp(30),Xt(100),Xt(50),R);h.addColorStop(g,P)}d.fillStyle=h,d.beginPath(),d.arc(o,o,o,0,Vn),d.fill(),d.lineWidth=1,d.strokeStyle=mp(hp(30),Xt(100),Xt(37.5),1),d.beginPath(),d.arc(o,o,u,0,Vn),d.stroke(),d.lineWidth=2,d.strokeStyle=mp(hp(30),Xt(100),Xt(25),1),d.beginPath(),d.arc(o,o,p,0,Vn),d.stroke(),this.rangeOverlay=await this.mapView.createOverlay(r,c,c,l)}this.lock=!1}}onRefresh(){super.onRefresh(),this.volumeInput.disabled=this.minDistanceInput.disabled=this.maxDistanceInput.disabled=this.enabledInput.disabled=this.effectInput.disabled=!this.canEdit,this.elevationInput.disabled=!this.canMove}};function Lpe(n,e,t,i){function r(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function l(p){try{u(i.next(p))}catch(d){s(d)}}function c(p){try{u(i.throw(p))}catch(d){s(d)}}function u(p){p.done?o(p.value):r(p.value).then(l,c)}u((i=i.apply(n,e||[])).next())})}var Ppe=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var i,r,o;if(Array.isArray(e)){if(i=e.length,i!=t.length)return!1;for(r=i;r--!==0;)if(!n(e[r],t[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(o=Object.keys(e),i=o.length,i!==Object.keys(t).length)return!1;for(r=i;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,o[r]))return!1;for(r=i;r--!==0;){var s=o[r];if(!n(e[s],t[s]))return!1}return!0}return e!==e&&t!==t},OT="__googleMapsScriptId",pc;(function(n){n[n.INITIALIZED=0]="INITIALIZED",n[n.LOADING=1]="LOADING",n[n.SUCCESS=2]="SUCCESS",n[n.FAILURE=3]="FAILURE"})(pc||(pc={}));var ig=class n{constructor({apiKey:e,authReferrerPolicy:t,channel:i,client:r,id:o=OT,language:s,libraries:l=[],mapIds:c,nonce:u,region:p,retries:d=3,url:h="https://maps.googleapis.com/maps/api/js",version:A}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=e,this.authReferrerPolicy=t,this.channel=i,this.client=r,this.id=o||OT,this.language=s,this.libraries=l,this.mapIds=c,this.nonce=u,this.region=p,this.retries=d,this.url=h,this.version=A,n.instance){if(!Ppe(this.options,n.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(n.instance.options)}`);return n.instance}n.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?pc.FAILURE:this.done?pc.SUCCESS:this.loading?pc.LOADING:pc.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+="?callback=__googleMapsCallback",this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){let e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((e,t)=>{this.loadCallback(i=>{i?t(i.error):e(window.google)})})}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,t;if(document.getElementById(this.id)){this.callback();return}let i={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(i).forEach(o=>!i[o]&&delete i[o]),!((t=(e=window?.google)===null||e===void 0?void 0:e.maps)===null||t===void 0)&&t.importLibrary||(o=>{let s,l,c,u="The Google Maps JavaScript API",p="google",d="importLibrary",h="__ib__",A=document,g=window;g=g[p]||(g[p]={});let F=g.maps||(g.maps={}),b=new Set,R=new URLSearchParams,P=()=>s||(s=new Promise((L,S)=>Lpe(this,void 0,void 0,function*(){var x;yield l=A.createElement("script"),l.id=this.id,R.set("libraries",[...b]+"");for(c in o)R.set(c.replace(/[A-Z]/g,v=>"_"+v[0].toLowerCase()),o[c]);R.set("callback",p+".maps."+h),l.src=this.url+"?"+R,F[h]=L,l.onerror=()=>s=S(Error(u+" could not load.")),l.nonce=this.nonce||((x=A.querySelector("script[nonce]"))===null||x===void 0?void 0:x.nonce)||"",A.head.append(l)})));F[d]?console.warn(u+" only loads once. Ignoring:",o):F[d]=(L,...S)=>b.add(L)&&P().then(()=>F[d](L,...S))})(i);let r=this.libraries.map(o=>this.importLibrary(o));r.length||r.push(this.importLibrary("core")),Promise.all(r).then(()=>this.callback(),o=>{let s=new ErrorEvent("error",{error:o});this.loadErrorCallback(s)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){let t=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${t} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},t)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader.This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading||(this.loading=!0,this.setScript())}}};var dc=class{constructor(e,t,i){this.callback=null,this.promise=new Promise((r,o)=>{this.callback=(...s)=>{e(...s)?r(t(...s)):o(i(...s))}})}get[Symbol.toStringTag](){return this.promise.toString()}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}};var v0=(n,e)=>e===google.maps.places.PlacesServiceStatus.OK,b0=(n,e)=>n,S0=(n,e)=>e,rg=class{constructor(e){this.places=e}nearbySearch(e){let t=new dc(v0,b0,S0);return this.places.nearbySearch(e,t.callback),t}textSearch(e){let t=new dc(v0,b0,S0);return this.places.textSearch(e,t.callback),t}findPlaceFromQuery(e){let t=new dc(v0,b0,S0);return this.places.findPlaceFromQuery(e,t.callback),t}};var og=class extends Be{constructor(e){super(),this.streetView=e,this.publicChangedEvt=new ge("positionchanged"),this.privateChangedEvt=new ge("_positionchanged"),this.firePublicEvt=!0,this.streetView.addListener("position_changed",()=>{this.dispatchEvent(this.privateChangedEvt),this.firePublicEvt&&(this.visible=!0,this.dispatchEvent(this.publicChangedEvt))})}async hasChanged(e){let t=Kt(this,"_positionchanged",3e3);this.streetView.setPano(e),await t}async searchPano(e){let t=e!==this.streetView.getPano();await this.setPano(e),t&&this.dispatchEvent(this.publicChangedEvt)}async setPano(e){if(this.firePublicEvt=!1,e=e||null,this.visible=!!e,e!==this.streetView.getPano()&&e)try{await this.hasChanged(e)}catch{console.warn("TIMEOUT"),this.visible=!1}this.firePublicEvt=!0}close(){this.streetView.setPano(null),this.visible=!1}getPano(){return this.visible?this.streetView.getPano():null}getLocation(){return this.streetView.getLocation()}get visible(){return this.streetView.getVisible()}set visible(e){this.streetView.setVisible(e)}};var sg=class{constructor(e){this.fetcher=e}getGSV(e){return this.fetcher.get(`/Editor/Photospheres/${e.toFixed(0)}`).object()}searchGSV(e){return this.fetcher.get(`/Editor/Photospheres/Search/${e}`).object()}requestGSV(e){return this.fetcher.get(`/Editor/Google/StreetView/Metadata/${e}/`).object()}async uploadGSV(e,t,i,r,o,s,l,c){let u=new FormData;return u.append("FormFile",e,t),u.append("Pano",i),u.append("Latitude",r.toFixed(10)),u.append("Longitude",o.toFixed(10)),u.append("Copyright",s),u.append("Date",l),await this.fetcher.post("/Editor/Photospheres/Create/").body(u).progress(c).object()}async replaceGSV(e,t,i,r,o,s,l,c,u){let p=new FormData;p.append("FormFile",t,i),p.append("Pano",r),p.append("Latitude",o.toFixed(10)),p.append("Longitude",s.toFixed(10)),p.append("Copyright",l),p.append("Date",c);let d=await this.fetcher.post(`/Editor/Photospheres/Update/${e}`).body(p).progress(u).exec();return zt(d,()=>e)}};var ag=class extends Mi{results;constructor(){super("Map results"),this.element.classList.add("places-results"),Ue(this.confirmButton,!1),Ee(this.contentArea,Ae(Ct("table"),Ae(Ct("table-head"),Ae(Ct("table-row"),Ae(Ct("table-cell")),Ae(Ct("table-cell"),"Name"),Ae(Ct("table-cell"),"Address"),Ae(Ct("table-cell")))),this.results=Ae(Ct("table-body"),Ae(Ct("table-row"),Ae(Ct("table-cell"),"Searching...")))))}async selectResult(e){let t=null;return St(this.results),Ee(this.results,...e.map(i=>Ae(Ct("table-row"),Ae(Ct("table-cell"),Gn(Ct("thumbnail"),Ii("Place icon"),Un(i.icon))),Ae(Ct("table-cell"),i.name),Ae(Ct("table-cell"),i.formatted_address),Ae(Ct("table-cell"),jn("Select",Ye(()=>{t=i,this.confirmButton.click()})))))),await this.showDialog()?t:null}};var Rpe=Zy(9,"MiB"),_0=class extends ge{constructor(){super("capturestart")}},lg=class extends ge{constructor(t){super("capturecomplete");this.metadata=t}},cg=class extends ac{constructor(t,i,r){super();this.fetcher=t;this.streetViewContainer=i;this.env=r;this.files=new sg(this.fetcher),this._element=Ae(Ct("map"),Pn(Xt(100)),To(Xt(100)),new rr(this.searchBox=ni(At("mapSearch"),de("form-control"),bt("Search map and Street View"),Fx(cd(()=>this.search(this.searchBox.value,!0))),Oe(()=>this.searchButton.disabled=this.searchBox.value.length===0)),this.searchButton=jn(GF("search-location"),Ii("Search"),Ye(()=>this.search(this.searchBox.value,!0))),this.toggleMarkersButton=Ma("Hide Labels",Ye(()=>{this.markersVisible=!this.markersVisible,Ie(this.toggleMarkersButton,this.markersVisible?"Hide Labels":"Show Labels"),this.scenario.toggleMarkers()}))),new rr(this.sphereNameInput=ni(At("sphereName"),de("form-control"),bt("Enter station name"),Oe(()=>this.refresh())),this.copyrightLabel=Ut(At("streetViewCopyright"),Aa(ui(5))),this.addButton=jn("Add",Ye(()=>this.addStreetView())),this.captureButton=jn(At("streetViewCaptureButton"),"Capture",Ye(()=>this.captureStreetView(!1)))),this.mapContainer=Ae(Ct("detail"),At("mapView"))),Object.seal(this)}resultsDialog=new ag;searchBox;searchButton;toggleMarkersButton;mapContainer;addButton;captureButton;sphereNameInput;copyrightLabel;files;map=null;elevation=null;places=null;targetMarker=null;markersVisible=!0;_scenario=null;_metadata=null;streetView=null;get zoom(){return this.map&&this.map.getZoom()}set zoom(t){this.map&&this.map.setZoom(t)}async getCenter(){if(oe(this.map))return;let t=Lr(this.map.getCenter());return y(t)&&(t.alt=await this.getElevation(t)),t}async getElevation(t){let i=await this.elevation.getElevationForLocations({locations:[pr(t)]});return i.results.length>0?i.results[0].elevation:0}setTarget(t){if(this.map&&this.targetMarker)if(t){let i=pr(t);this.targetMarker.setMap(this.map),this.targetMarker.setPosition(i),this.panTo(i)}else this.targetMarker.setMap(null)}panTo(t){this.map&&(t instanceof google.maps.LatLng&&(t=Lr(t)),this.map.panTo(t))}fitBounds(...t){let i=new google.maps.LatLngBounds;t.map(pr).forEach(r=>i.extend(r)),this.map.fitBounds(i)}async load(t){t&&t.start();let i=await this.fetcher.get("/Editor/Google/APIKey/").object().then(We);await new ig({apiKey:i,version:"weekly",libraries:["drawing","places"]}).load(),this.map=new google.maps.Map(this.mapContainer,{zoom:12,streetView:new google.maps.StreetViewPanorama(this.streetViewContainer,{addressControl:!1,clickToGo:!0,fullscreenControl:!0,motionTracking:!1})}),this.elevation=new google.maps.ElevationService,this.streetView=new og(this.map.getStreetView()),this.streetView.addEventListener("positionchanged",()=>{this.search(this.streetView.getPano(),!1)}),this.places=new rg(new google.maps.places.PlacesService(this.map)),this.targetMarker=new google.maps.Marker({icon:{url:"/images/markers/up-arrow.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(16,0)},clickable:!1,draggable:!1,optimized:!1}),t&&t.end()}closeStreetView(){this.streetView.close()}async search(t,i){if(this.map&&this.places&&this.streetView){this.enabled=!1;try{let r=await this.files.searchGSV(t).then(We)||await this.files.requestGSV(t).then(We);if(y(r)&&r.status!=="ZERO_RESULTS")await this.setMetadata(r);else{let o=await this.places.textSearch({query:t,bounds:this.map.getBounds()}),s=await this.selectResult(o);if(s)this.setTarget(Lr(s.geometry.location));else throw"No results"}}catch(r){let o=`ERROR: ${r}`;i&&(this.searchBox.value=o)}this.enabled=!0}}async selectResult(t){return t.length===0?null:t.length===1?t[0]:await this.resultsDialog.selectResult(t)}async createOverlay(t,i,r,o){if(Wp(o)){let h=await no(o,Tr);o=Zu(h)}o instanceof URL&&(o=o.href);let s=new google.maps.LatLng(pr(t)),l=google.maps.geometry.spherical.computeOffset(s,r,0),c=google.maps.geometry.spherical.computeOffset(s,i,90),u=google.maps.geometry.spherical.computeOffset(s,r,180),p=google.maps.geometry.spherical.computeOffset(s,i,270),d={north:l.lat(),east:c.lng(),south:u.lat(),west:p.lng()};return new google.maps.GroundOverlay(o,d,{map:this.map})}async createMarker(t,i,r){if(Wp(r)){let s=await no(r,Tr);r=Zu(s)}r instanceof URL&&(r=r.href);let o={map:this.map,position:pr(t),label:i,icon:r};return new google.maps.Marker(o)}createLine(t){return new google.maps.Polyline({map:this.map,path:t.map(pr),geodesic:!0,strokeColor:"red",strokeOpacity:1,strokeWeight:2})}async loadMetadataForFile(t){await this.setMetadata(await this.getMetadataForFile(t))}getMetadataForFile(t){return this.files.getGSV(t).then(We)}get pano(){return this.metadata&&this.metadata.pano_id||null}get hasPano(){return this.pano&&this.pano.length>0}get metadata(){return this._metadata}async setMetadata(t){if(t!==this.metadata){this._metadata=t,await this.streetView.setPano(this.pano),this.dispatchEvent(new ge("streetviewopened"));let i=this.hasPano&&this.streetView.getLocation(),r=i&&(i.shortDescription||i.description),o=t&&t.fileName;this.sphereName=r||o||null,this.searchBox.value=this.hasPano?this.metadata.pano_id:"";let s="";if(this.hasMetadata){let l=new Date(this.metadata.date);s=`${this.metadata.copyright}, ${l.toLocaleDateString()}`}Ie(this.copyrightLabel,s),this.refresh()}}get scenario(){return this._scenario}set scenario(t){this._scenario=t,this.refresh()}get hasScenario(){return y(this.scenario)}get sphereName(){return this.sphereNameInput.value}set sphereName(t){t!==this.sphereName&&(this.sphereNameInput.value=t,this.refresh())}get enabled(){return super.enabled&&this.hasScenario&&!this.scenario.published}set enabled(t){super.enabled=t}get canCapture(){return this.enabled&&this.hasPano&&this.sphereNameInput.value.length>0}get hasMetadata(){return y(this.metadata)}get isCaptured(){return this.hasMetadata&&this.metadata.fileID>0}get canAdd(){return this.enabled&&this.isCaptured&&this.scenario.stations.filter(t=>t.fileID===this.metadata.fileID).length===0}get canSetName(){return this.enabled&&this.hasPano&&!this.isCaptured}addStreetView(){this.canAdd&&this.dispatchEvent(new lg(this.metadata))}async captureStreetView(t){this.canCapture&&(this.dispatchEvent(new _0),await this.env.withFade(async()=>{let i,r;if(t)r=new Blob([this.pano],{type:rf.value}),i=this.env.loadingBar;else{let[s,l,c]=Et(this.env.loadingBar,[15,1,5]);i=c;let u=await this.scenario.rig.loadCanvas(this.pano,Xr.High,s);for(let p=1;p>=.5&&(l.report(2*(1-p),1,"encoding"),r=await no(u,yr,p),!(r.size<=Rpe));p-=.05);l.end("encoding")}let o=this.isCaptured?this.files.replaceGSV.bind(this.files,this.metadata.fileID):this.files.uploadGSV.bind(this.files);this.metadata.fileName=this.sphereName,this.metadata.fileID=await o(r,this.metadata.fileName,this.metadata.pano_id,this.metadata.location.lat,this.metadata.location.lng,this.metadata.copyright,this.metadata.date,i).then(We),this.metadata.filePath=`/vr/file/${this.metadata.fileID.toFixed(0)}`,this.scenario.clearCache(),this.env.loadingBar.end("done")}),this.dispatchEvent(new lg(this.metadata)))}onRefresh(){this.searchButton.disabled=this.disabled||this.searchBox.value.length===0,this.searchBox.disabled=this.disabled,this.sphereNameInput.disabled=!this.canSetName,this.addButton.disabled=!this.canAdd,En(this.captureButton,this.isCaptured,"btn-danger"),En(this.captureButton,!this.isCaptured,"btn-primary"),Ro(this.captureButton,this.canCapture,this.isCaptured?"Recapture":"Capture",this.isCaptured?"Download photosphere again and replace it":"Download photosphere")}};var ug=class extends ai{sizeInput;rotationXInput;rotationYInput;rotationZInput;constructor(e){super("Model","Reset Model",e,[Er,Mc],["model"],["Upload GLTF or GLB files","Make sure 3D models are authored in units of meters"]);let t=async()=>this.scenario.modelAdapter.setRotation(this.value,this.rotationX,this.rotationY,this.rotationZ);this.addProperties(["Size",this.sizeInput=new gt(de("form-control"),at(0),st(10),nt(.1),bt("Size"),Oe(()=>this.scenario.modelAdapter.setSize(this.value,this.size)))],["Pitch",this.rotationXInput=new gt(de("form-control"),at(-180),st(180),nt(.1),Oe(t))],["Yaw",this.rotationYInput=new gt(de("form-control"),at(-180),st(180),nt(.1),Oe(t))],["Roll",this.rotationZInput=new gt(at(-180),st(180),nt(.1),Oe(t))]),Object.seal(this),this.refreshValues()}getValueName(e){return e.fileName}renameValue(e,t){this.scenario.modelAdapter.updateThrottled(e,{fileName:t})}async resetValue(e){await this.scenario.modelAdapter.reset(e,this.scenario.env.defaultAvatarHeight)}deleteValue(e){return this.scenario.modelAdapter.delete(e)}validateParent(e){return Mt(e)}onFileSelection(e,t,i){return this.scenario.modelAdapter.create(e,t,i)}get canEdit(){return super.canEdit&&oe(this.value.error)}get size(){return Ht(this.sizeInput.value)}set size(e){this.sizeInput.value=It(e,3)}get rotationX(){return Ht(this.rotationXInput.value)}set rotationX(e){this.rotationXInput.value=It(e)}get rotationY(){return Ht(this.rotationYInput.value)}set rotationY(e){this.rotationYInput.value=It(e)}get rotationZ(){return Ht(this.rotationZInput.value)}set rotationZ(e){this.rotationZInput.value=It(e)}onValueChanged(){super.onValueChanged(),this.hasValue?(this.size=this.value.size,this.rotationX=this.value.rotationX,this.rotationY=this.value.rotationY,this.rotationZ=this.value.rotationZ):(this.size=null,this.rotationX=null,this.rotationY=null,this.rotationZ=null)}onRefresh(){super.onRefresh(),this.sizeInput.disabled=this.rotationXInput.disabled=this.rotationYInput.disabled=this.rotationZInput.disabled=!this.canEdit}};var y0=class extends ge{constructor(t){super("loadscenario");this.scenarioID=t}},T0=class extends ge{constructor(t){super("forkscenario");this.scenarioID=t}},E0=class extends ge{constructor(t){super("publishscenario");this.scenarioID=t}},pg=class extends lc{nameBox;versionBox;isPublishedBox;latitudeBox;longitudeBox;zonesCountBox;stationsCountBox;voiceOversCountBox;videosCountBox;textsCountBox;signsCountBox;modelsCountBox;connectionsCountBox;editOrPublishButton;previousVersionsBox;constructor(){super("Scenario"),this.addProperties(["Name",this.nameBox=Ut()],["Version",this.versionBox=Ut()],["Published",this.isPublishedBox=Ut()],["Latitude",this.latitudeBox=Ut()],["Longitude",this.longitudeBox=Ut()],["Zones",this.zonesCountBox=Ut()],["Stations",this.stationsCountBox=Ut()],["Voice overs",this.voiceOversCountBox=Ut()],["Videos",this.videosCountBox=Ut()],["Texts",this.textsCountBox=Ut()],["Signs",this.signsCountBox=Ut()],["3D Models",this.modelsCountBox=Ut()],["Connections",this.connectionsCountBox=Ut()],["",this.editOrPublishButton=ar("",Ye(()=>{this.hasScenario&&(this.scenario.published?this.dispatchEvent(new T0(this.scenario.id)):this.dispatchEvent(new E0(this.scenario.id)))}))],["Other versions",this.previousVersionsBox=Ut()]),Object.seal(this),Object.assign(window,{scenarios:this}),this.refresh()}onScenarioChanged(e){let t=this.hasScenario?this.scenario.published?"Create new version":"Publish":"No scenario available",i=this.hasScenario&&this.scenario.published,r=this.hasScenario&&!this.scenario.published;Ro(this.editOrPublishButton,this.hasScenario,t,t),En(this.editOrPublishButton,i,"btn-danger"),En(this.editOrPublishButton,r,"btn-primary"),St(this.previousVersionsBox),this.hasScenario?(Ie(this.nameBox,this.scenario.name),Ie(this.versionBox,this.scenario.version.toFixed(0)),Ie(this.isPublishedBox,this.scenario.published?"Yes":"No"),Ee(this.previousVersionsBox,...this.scenario.versions.filter(o=>o.version!==this.scenario.version).map(o=>ar(`${o.version} (${o.published?"Published":"Not published"})`,Ye(()=>this.dispatchEvent(new y0(o.id))))))):(Ie(this.nameBox,"N/A"),Ie(this.versionBox,"N/A"),Ie(this.isPublishedBox,"N/A")),this.previousVersionsBox.childElementCount===0&&Ie(this.previousVersionsBox,"N/A")}get value(){return this.scenario}set value(e){this.scenario=e}get hasValue(){return this.hasScenario}onRefresh(){if(super.onRefresh(),this.hasScenario)if(Ie(this.zonesCountBox,this.value.zones.length.toFixed(0)),Ie(this.stationsCountBox,this.value.stations.length.toFixed(0)),Ie(this.voiceOversCountBox,this.value.audios.filter(e=>!e.spatialize).length.toFixed(0)),Ie(this.videosCountBox,this.value.videos.length.toFixed(0)),Ie(this.textsCountBox,this.value.texts.length.toFixed(0)),Ie(this.signsCountBox,this.value.signs.length.toFixed(0)),Ie(this.modelsCountBox,this.value.models.length.toFixed(0)),Ie(this.connectionsCountBox,(this.value.connections.length/2).toFixed(0)),y(this.value.originLL)){let[e,t]=this.value.originLL.toDMSArray(2);Ie(this.latitudeBox,e),Ie(this.longitudeBox,t)}else Ie(this.latitudeBox,"???"),Ie(this.longitudeBox,"???");else Ie(this.zonesCountBox,"N/A"),Ie(this.stationsCountBox,"N/A"),Ie(this.voiceOversCountBox,"N/A"),Ie(this.videosCountBox,"N/A"),Ie(this.textsCountBox,"N/A"),Ie(this.signsCountBox,"N/A"),Ie(this.modelsCountBox,"N/A"),Ie(this.connectionsCountBox,"N/A"),Ie(this.latitudeBox,"N/A"),Ie(this.longitudeBox,"N/A")}};var dg=class extends ai{isCalloutInput;alwaysVisibleInput;sizeInput;rotationXInput;rotationYInput;rotationZInput;constructor(e){super("Sign","Reset Sign",e,[yr,Tr,Zr],["sign"],["Upload PNG, JPEG, or PDF files","Signs should be authored at the dimensions they would appear in the real world.",`PNG or JPEG files should be authored at ${oo} pixels per inch, e.g. a ${gx} in wide sign should be ${kA} px wide.`,"Callout signs will not be visible in the app until the user clicks on the expand icon."]);let t=async()=>this.scenario.signAdapter.setRotation(this.value,this.rotationX,this.rotationY,this.rotationZ);this.addProperties(["Width",this.sizeInput=new gt(de("form-control"),at(0),st(10),nt(.1),bt("Size"),Oe(()=>this.scenario.signAdapter.setSize(this.value,this.size)))],["Is Callout",this.isCalloutInput=Xn(Oe(async()=>{await this.scenario.signAdapter.update(this.value,{isCallout:this.isCalloutInput.checked}),this.refreshValues()}))],["Always Visible",this.alwaysVisibleInput=Xn(Oe(async()=>{await this.scenario.signAdapter.update(this.value,{alwaysVisible:this.alwaysVisibleInput.checked}),this.refreshValues()}))],["Pitch",this.rotationXInput=new gt(de("form-control"),at(-180),st(180),nt(.1),Oe(t))],["Yaw",this.rotationYInput=new gt(de("form-control"),at(-180),st(180),nt(.1),Oe(t))],["Roll",this.rotationZInput=new gt(de("form-control"),at(-180),st(180),nt(.1),Oe(t))]),Object.seal(this),this.refresh()}getValueName(e){return e.fileName}renameValue(e,t){this.scenario.signAdapter.updateThrottled(e,{fileName:t})}async resetValue(e){await this.scenario.signAdapter.reset(e,this.scenario.env.defaultAvatarHeight)}deleteValue(e){return this.scenario.signAdapter.delete(e)}validateParent(e){return Mt(e)}onFileSelection(e,t,i){return this.scenario.signAdapter.create(e,t,i)}get canEdit(){return super.canEdit&&oe(this.value.error)}get size(){return Ht(this.sizeInput.value)}set size(e){this.sizeInput.value=It(e,3)}get isCallout(){return this.isCalloutInput.indeterminate?null:this.isCalloutInput.checked}set isCallout(e){this.isCalloutInput.indeterminate=oe(e),this.isCalloutInput.checked=y(e)&&e}get alwaysVisible(){return this.alwaysVisibleInput.indeterminate?null:this.alwaysVisibleInput.checked}set alwaysVisible(e){this.alwaysVisibleInput.indeterminate=oe(e),this.alwaysVisibleInput.checked=y(e)&&e}get rotationX(){return Ht(this.rotationXInput.value)}set rotationX(e){this.rotationXInput.value=It(e)}get rotationY(){return Ht(this.rotationYInput.value)}set rotationY(e){this.rotationYInput.value=It(e)}get rotationZ(){return Ht(this.rotationZInput.value)}set rotationZ(e){this.rotationZInput.value=It(e)}onValueChanged(){super.onValueChanged(),this.hasValue?(this.size=this.value.size,this.isCallout=this.value.isCallout,this.alwaysVisible=this.value.alwaysVisible,this.rotationX=this.value.rotationX,this.rotationY=this.value.rotationY,this.rotationZ=this.value.rotationZ):(this.size=null,this.isCallout=null,this.alwaysVisible=null,this.rotationX=null,this.rotationY=null,this.rotationZ=null)}onRefresh(){super.onRefresh(),this.sizeInput.disabled=this.isCalloutInput.disabled=this.alwaysVisibleInput.disabled=this.rotationXInput.disabled=this.rotationYInput.disabled=this.rotationZInput.disabled=!this.canEdit}};var hg=class extends ge{constructor(t,i){super(t);this.station=i}},k0=class extends hg{constructor(e){super("stationmarkstart",e)}},M0=class extends hg{constructor(e){super("createconnection",e)}},NT="googleMetadataGroup",WT="startStationRotationGroup",mg=class extends ai{constructor(t,i){super("Station","Reset",t,[yr],["photosphere"],["Avoid crowded areas","Avoid photospheres with objects in arms-reach"]);this.mapView=i;let r=()=>{this.stationTransformDummy.quaternion.copy(this.rotationQuat),this.saveRotation()};this.addProperties(ds(NT,["Google Pano ID",new rr(this.googlePanoIDBox=Ut(Ap("hidden"),$0("nowrap"),Y0("ellipsis"),wp(vi(10))),this.viewStreetViewButton=jn("View",Ye(()=>{this.mapView.setMetadata(this.metadata)})))]),ds(WT,["Start rotation",this.startRotationBox=new gt(de("form-control"),at(0),st(360),nt(.1),bt("degrees"),Oe(()=>{this.isStartStation&&(this.scenario.stationAdapter.setStartRotation(this.value,je(this.startRotationBox.valueAsNumber)),this.scenario.env.avatar.setHeadingImmediate(this.scenario.startRotation))}))]),["Label",this.labelInput=Cr(de("form-control"),bt("Enter label"),Ta("soft"),ko("off"),qt("lpignore","true"),Oe(()=>this.scenario.stationAdapter.updateThrottled(this.value,{label:this.label})))],["Latitude",this.latitudeBox=Ut()],["Longitude",this.longitudeBox=Ut()],["Elevation",new rr(this.elevationInput=yi("Reset",de("form-control"),Oe(()=>this.scenario.stationAdapter.moveThrottled(this.value,this.value.location.lat,this.value.location.lng,this.elevation,!1)),bt("Elevation"),nt(.001)),this.resetButton)],["Pitch",this.rotationXInput=new gt(de("form-control"),at(-180),st(180),nt(.1),Oe(r))],["Yaw",this.rotationYInput=new gt(de("form-control"),at(-180),st(180),nt(.1),Oe(r))],["Roll",this.rotationZInput=new gt(de("form-control"),at(-180),st(180),nt(.1),Oe(r))]),Mr(this.element,Ae(Ct("controls"),this.markStartButton=jn("Mark Start",Ye(()=>this.dispatchEvent(new k0(this.value)))),this.connectButton=jn("Connect",Ye(()=>this.dispatchEvent(new M0(this.value))))),this.scrollPanel),Object.seal(this),this.refreshValues()}markStartButton;elevationInput;googlePanoIDBox;latitudeBox;longitudeBox;viewStreetViewButton;connectButton;startRotationBox;rotationXInput;rotationYInput;rotationZInput;labelInput;stationTransformDummy=new pt;_metadata=null;updateRotationFromTransformer(){this.rotationQuat=this.scenario.env.skybox.rotation=this.stationTransformDummy.quaternion}saveRotation(){this.scenario.stationAdapter.updateThrottled(this.value,{rotation:this.rotationArray})}getTransformModes(){return[Ne.RotateViewSpace,Ne.RotateGlobalSpace,Ne.RotateObjectSpace]}onScenarioChanged(t){y(t)&&(this.stationTransformDummy.removeFromParent(),t.removeScope(this)),y(this.scenario)&&(this.scenario.env.worldUISpace.add(this.stationTransformDummy),this.stationTransformDummy.position.z=-3,this.scenario.addScopedEventListener(this,"stationmarkermoved",async i=>{let r=await this.mapView.getElevation(i.latLng);await this.scenario.stationAdapter.move(i.station,i.latLng.lat,i.latLng.lng,r,!1),i.station===this.value&&this.refreshValues()}))}getValueName(t){return t.fileName}renameValue(t,i){this.scenario.stationAdapter.updateThrottled(t,{fileName:i})}async resetValue(t){let i=await this.mapView.getElevation(t.location);await this.scenario.stationAdapter.move(t,t.location.lat,t.location.lng,i,!0)}deleteValue(t){return this.scenario.stationAdapter.delete(t)}validateParent(t){return gn(t)}async onFileSelection(t,i,r){let o=await this.mapView.getCenter();await this.scenario.resolveOrigin(o);let s=await this.scenario.stationAdapter.create(i.id,i.name,o.lat,o.lng,o.alt,r);return await this.scenario.stationAdapter.update(s,{zone:t}),s}get metadata(){return this._metadata}set metadata(t){t!==this.metadata&&(this._metadata=t,this.refresh())}get hasMetadata(){return y(this.metadata)}get label(){return this.hasValue?this.labelInput.value:null}set label(t){this.labelInput.value=t}get elevation(){return this.hasValue?this.elevationInput.valueAsNumber:null}set elevation(t){y(t)&&(t=Oh(Math.round(Vh(t)))),t!==this.elevation&&(this.elevationInput.valueAsNumber=t)}get rotationEuler(){return new Rr().set(je(this.rotationX),je(this.rotationY),je(this.rotationZ),"XYZ")}set rotationEuler(t){this.rotationX=Lt(t.x),this.rotationY=Lt(t.y),this.rotationZ=Lt(t.z)}get rotationQuat(){return new it().setFromEuler(this.rotationEuler)}set rotationQuat(t){this.rotationEuler=new Rr().setFromQuaternion(t)}get rotationArray(){return this.rotationQuat.toArray()}set rotationArray(t){this.rotationQuat=new it().fromArray(t)}get rotationX(){return Ht(this.rotationXInput.value)}set rotationX(t){this.rotationXInput.value=It(t)}get rotationY(){return Ht(this.rotationYInput.value)}set rotationY(t){this.rotationYInput.value=It(t)}get rotationZ(){return Ht(this.rotationZInput.value)}set rotationZ(t){this.rotationZInput.value=It(t)}get isStartStation(){return this.hasScenario&&this.hasValue&&this.scenario.startStation===this.value}get canMarkStartStation(){return this.canEdit&&!this.isStartStation}onValueChanged(){if(super.onValueChanged(),this.hasValue){let[t,i]=new wi(this.value.location).toDMSArray(2);Ie(this.latitudeBox,t),Ie(this.longitudeBox,i),this.label=this.value.label,this.elevation=this.value.location.alt,this.rotationArray=this.value.rotation,this.mapView.getMetadataForFile(this.value.fileID).then(r=>this.metadata=r)}else Ie(this.latitudeBox,"N/A"),Ie(this.longitudeBox,"N/A"),this.label=null,this.elevation=null,this.rotationX=null,this.rotationY=null,this.rotationZ=null,this.metadata=null}onRefresh(){super.onRefresh(),this.properties.setGroupVisible(NT,this.hasMetadata),this.hasMetadata&&(Ie(this.googlePanoIDBox,this.metadata.pano_id),Ea(this.googlePanoIDBox,this.metadata.pano_id)),this.properties.setGroupVisible(WT,this.isStartStation),this.isStartStation&&(this.startRotationBox.value=It(Lt(this.scenario.startRotation),1)),this.markStartButton.disabled=!this.canMarkStartStation,this.viewStreetViewButton.disabled=this.startRotationBox.disabled=this.labelInput.disabled=this.elevationInput.disabled=this.rotationXInput.disabled=this.rotationYInput.disabled=this.rotationZInput.disabled=this.connectButton.disabled=!this.canEdit}};var fg=class extends ai{textInput;isCalloutInput;alwaysVisibleInput;sizeInput;rotationXInput;rotationYInput;rotationZInput;constructor(e){super("Text","Reset Text",e,[eo],["text"],["Upload TXT files","Text item will not be visible in the app until the user clicks on the expand icon."]);let t=async()=>this.scenario.textAdapter.setRotation(this.value,this.rotationX,this.rotationY,this.rotationZ);this.addProperties(["Text",this.textInput=Cr(Oe(async()=>{this.hasValue&&(await this.scenario.textAdapter.updateThrottled(this.value,{text:this.textInput.value}),this.refreshValues())}))],["Width",this.sizeInput=new gt(de("form-control"),at(0),st(10),nt(.1),bt("Size"),Oe(()=>this.scenario.textAdapter.setSize(this.value,this.size)))],["Is Callout",this.isCalloutInput=Xn(Oe(async()=>{await this.scenario.textAdapter.update(this.value,{isCallout:this.isCalloutInput.checked}),this.refreshValues()}))],["Always Visible",this.alwaysVisibleInput=Xn(Oe(async()=>{await this.scenario.textAdapter.update(this.value,{alwaysVisible:this.alwaysVisibleInput.checked}),this.refreshValues()}))],["Pitch",this.rotationXInput=new gt(de("form-control"),at(-180),st(180),nt(.1),Oe(t))],["Yaw",this.rotationYInput=new gt(de("form-control"),at(-180),st(180),nt(.1),Oe(t))],["Roll",this.rotationZInput=new gt(de("form-control"),at(-180),st(180),nt(.1),Oe(t))]),Object.seal(this),this.refresh()}getValueName(e){return e.fileName}renameValue(e,t){this.scenario.textAdapter.updateThrottled(e,{fileName:t})}async resetValue(e){await this.scenario.textAdapter.reset(e,this.scenario.env.defaultAvatarHeight)}deleteValue(e){return this.scenario.textAdapter.delete(e)}validateParent(e){return Mt(e)}async getFile(e){let t=new FormData,i=this.scenario.textsByStation.get(e)||[],r=new Set(i.map(l=>l.fileName)),o=null;for(let l=0;o===null;++l)o=`Text Label ${l}`,r.has(o)&&(o=null);o=eo.addExtension(o);let s=new File(["<Enter text>"],o,{type:eo.value});return t.set("FormFile",s,o),t.set("Copyright","Diplomatic Language Services"),t.set("CopyrightDate",new Date(Date.now()).toDateString()),t.set("TagString","text"),this.scenario.env.fetcher.post("/editor/files/create").body(t).object().then(We)}onFileSelection(e,t,i){return this.scenario.textAdapter.create(e,t,i)}get canEdit(){return super.canEdit&&oe(this.value.error)}get text(){return this.textInput.value}set text(e){this.textInput.value=e}get size(){return Ht(this.sizeInput.value)}set size(e){this.sizeInput.value=It(e,3)}get isCallout(){return this.isCalloutInput.indeterminate?null:this.isCalloutInput.checked}set isCallout(e){this.isCalloutInput.indeterminate=oe(e),this.isCalloutInput.checked=y(e)&&e}get alwaysVisible(){return this.alwaysVisibleInput.indeterminate?null:this.alwaysVisibleInput.checked}set alwaysVisible(e){this.alwaysVisibleInput.indeterminate=oe(e),this.alwaysVisibleInput.checked=y(e)&&e}get rotationX(){return Ht(this.rotationXInput.value)}set rotationX(e){this.rotationXInput.value=It(e)}get rotationY(){return Ht(this.rotationYInput.value)}set rotationY(e){this.rotationYInput.value=It(e)}get rotationZ(){return Ht(this.rotationZInput.value)}set rotationZ(e){this.rotationZInput.value=It(e)}onValueChanged(){super.onValueChanged(),this.hasValue?(this.text=this.value.text,this.size=this.value.size,this.isCallout=this.value.isCallout,this.alwaysVisible=this.value.alwaysVisible,this.rotationX=this.value.rotationX,this.rotationY=this.value.rotationY,this.rotationZ=this.value.rotationZ):(this.text=null,this.size=null,this.isCallout=null,this.alwaysVisible=null,this.rotationX=null,this.rotationY=null,this.rotationZ=null)}onRefresh(){super.onRefresh(),this.textInput.disabled=this.sizeInput.disabled=this.isCalloutInput.disabled=this.alwaysVisibleInput.disabled=this.rotationXInput.disabled=this.rotationYInput.disabled=this.rotationZInput.disabled=!this.canEdit}};var gg=class extends ai{enabledInput;labelInput;volumeInput;sphereEncodingInput;stereoLayoutInput;sizeInput;rotationXInput;rotationYInput;rotationZInput;constructor(e){super("Video","Reset Video",e,[jg,Gg,qg,hs],["video"],["Link to videos hosted on YouTube, or","Upload WEBM, MP4, or MPG files."]);let t=()=>{this.scenario.videoAdapter.setSphereEncodingAndLayout(this.value,this.sphereEncoding,this.stereoLayout)||(this.sphereEncoding=this.value.sphereEncodingName,this.stereoLayout=this.value.stereoLayoutName)},i=()=>{this.scenario.videoAdapter.updateThrottled(this.value,{enabled:this.clipEnabled,label:this.label,volume:this.volume})},r=()=>{this.scenario.videoAdapter.setRotation(this.value,this.rotationX,this.rotationY,this.rotationZ)};this.addProperties(["Enabled",this.enabledInput=Xn(Oe(i))],["Label",this.labelInput=Cr(de("form-control"),bt("Enter label"),Ta("soft"),ko("off"),qt("lpignore","true"),Oe(i))],["Volume",this.volumeInput=new gt(de("form-control"),at(0),st(100),nt(1),bt("Volume"),Oe(i))],["Type",this.sphereEncodingInput=Vi(de("custom-select"),Oe(t),...ZS.map(o=>bn(o,Qt(o))))],["Layout",this.stereoLayoutInput=Vi(de("custom-select"),Oe(t),...e_.map(o=>bn(o,Qt(o))))],["Width",this.sizeInput=new gt(de("form-control"),at(0),st(10),nt(.1),bt("Size"),Oe(()=>this.scenario.videoAdapter.setSize(this.value,this.size)))],["Pitch",this.rotationXInput=new gt(de("form-control"),at(-180),st(180),nt(.1),Oe(r))],["Yaw",this.rotationYInput=new gt(de("form-control"),at(-180),st(180),nt(.1),Oe(r))],["Roll",this.rotationZInput=new gt(de("form-control"),at(-180),st(180),nt(.1),Oe(r))]),Object.seal(this),this.refreshValues()}getValueName(e){return e.fileName}renameValue(e,t){this.scenario.videoAdapter.updateThrottled(e,{fileName:t})}async resetValue(e){await this.scenario.videoAdapter.reset(e,this.scenario.env.defaultAvatarHeight)}deleteValue(e){return this.scenario.videoAdapter.delete(e)}validateParent(e){return Mt(e)}onFileSelection(e,t,i){return this.scenario.videoAdapter.create(e,t,i)}get canEdit(){return super.canEdit&&oe(this.value.error)}get clipEnabled(){return this.enabledInput.indeterminate?null:this.enabledInput.checked}set clipEnabled(e){this.enabledInput.indeterminate=oe(e),this.enabledInput.checked=y(e)&&e}get label(){return this.labelInput.value}set label(e){this.labelInput.value=e}get volume(){return wd(this.volumeInput.value)}set volume(e){this.volumeInput.value=xd(e)}get sphereEncoding(){return this.sphereEncodingInput.value}set sphereEncoding(e){this.sphereEncodingInput.value=e}get stereoLayout(){return this.stereoLayoutInput.value}set stereoLayout(e){this.stereoLayoutInput.value=e}get size(){return Ht(this.sizeInput.value)}set size(e){this.sizeInput.value=It(e,3)}get rotationX(){return Ht(this.rotationXInput.value)}set rotationX(e){this.rotationXInput.value=It(e)}get rotationY(){return Ht(this.rotationYInput.value)}set rotationY(e){this.rotationYInput.value=It(e)}get rotationZ(){return Ht(this.rotationZInput.value)}set rotationZ(e){this.rotationZInput.value=It(e)}onValueChanged(){super.onValueChanged(),this.hasValue?(this.clipEnabled=this.value.enabled,this.label=this.value.label,this.volume=this.value.volume,this.sphereEncoding=this.value.sphereEncodingName,this.stereoLayout=this.value.stereoLayoutName,this.size=this.value.size,this.rotationX=this.value.rotationX,this.rotationY=this.value.rotationY,this.rotationZ=this.value.rotationZ):(this.clipEnabled=null,this.label=null,this.volume=null,this.sphereEncoding=null,this.stereoLayout=null,this.size=null,this.rotationX=null,this.rotationY=null,this.rotationZ=null)}onRefresh(){super.onRefresh(),this.sizeInput.disabled=this.rotationXInput.disabled=this.rotationYInput.disabled=this.rotationZInput.disabled=this.sphereEncodingInput.disabled=this.stereoLayoutInput.disabled=!this.canEdit}};function HT(n){return/^default$/i.test(n)}var xg=class extends cc{constructor(){super("Zone",["Use zones to group environment audio and stations","Environment audio will only be played when the user is in a station grouped in the same zone as the audio","The Default zone cannot be renamed or deleted","Empty zones won't be saved"],!1),Object.seal(this),Object.assign(window,{zones:this}),this.refreshValues()}getValueName(e){return e||"Default"}deleteValue(e){return this.renameValue(e,""),Promise.resolve()}renameValue(e,t){this.scenario.audios.filter(i=>i.spatialize&&i.zone===e).forEach(i=>this.scenario.audioAdapter.updateThrottled(i,{zone:t})),this.scenario.stations.filter(i=>i.zone===e).forEach(i=>this.scenario.stationAdapter.updateThrottled(i,{zone:t})),this.scenario.refreshZones()}createValue(){let e=0,t=null;do t=e===0?"New Zone":`New Zone - ${e}`,++e;while(this.scenario.zones.indexOf(t)>-1);return this.scenario.zones.push(t),Promise.resolve(t)}get canEdit(){return super.canEdit&&!HT(this.getValueName(this.value))}get canRename(){return super.canRename&&this.name.length>0&&!HT(this.name.toLowerCase())}};var Ipe=/\/\d+\/?$/,wg=class{constructor(e,t){this.logger=t;let i=Da(At("frontBuffer")),r=Ae(At("appContainer"),i);this.env=new Xm({canvas:i,fetcher:e,dialogFontFamily:od.fontFamily,getAppUrl:PA,uiImagePaths:LA(),buttonFillColor:Ha,labelFillColor:MA,defaultFOV:75,enableFullResolution:EA,DEBUG:!0,watchModelPath:"/models/watch1.glb"}),this.transformer=new zd(this.env),this.transformer.addEventListener("moving",()=>{if(this.transformer.target===this.stationView.stationTransformDummy)this.stationView.updateRotationFromTransformer();else if(this.transformer.target instanceof er){let F=this.scenario.getAssetForTransform(this.transformer.target);y(F)&&this.getViewFor(F).updateTransformView(F)}}),this.transformer.addEventListener("moved",()=>{if(this.transformer.target===this.stationView.stationTransformDummy)this.stationView.updateRotationFromTransformer(),this.stationView.saveRotation();else if(this.transformer.target instanceof er){let F=this.scenario.getAssetForTransform(this.transformer.target);if(y(F)){let b=this.getViewFor(F);this.withLock(()=>b.saveTransform(F))}}}),Ee(this.env.subMenu,...this.transformer.modeButtons),this.env.foreground.add(this.transformer.object);let o=Ae(At("streetViewPreview"));this.mapView=new cg(e,o,this.env);let s=new xf(e,this.env);this.stationView=new mg(s,this.mapView);let l=new Map([["station",this.stationView],["ambientAudio",new ng(s,this.mapView)],["audio",new eg(s)],["video",new gg(s)],["text",new fg(s)],["sign",new dg(s)],["model",new ug(s)]]),c=new Map([...Array.from(l.entries()),["connection",this.connectionView=new tg]]),u=new Map([...Array.from(c.entries()),["zone",new xg]]);this.propertyViews=new Map([...Array.from(u.entries()),["scenario",this.scenarioView=new pg]]),this.scenarioView.addEventListener("loadscenario",F=>this.withLock(async()=>{this.scenario=null,await this.loadScenario(F.scenarioID)})),this.scenarioView.addEventListener("forkscenario",()=>this.withLock(async()=>{let F=this.scenario;this.scenario=null;let b=await F.fork().then(We);await this.loadScenario(b)})),this.scenarioView.addEventListener("publishscenario",F=>this.withLock(async()=>{let b=this.scenario;this.scenario=null,await b.publish(),await this.loadScenario(F.scenarioID)}));let p=F=>{this.withLock(async()=>{let b=F.asset,R=this.getViewFor(b);await this.fileDetailDialog.showFile(b.fileID),await R.reloadFile()})};for(let F of l.values())F.addEventListener("assetviewfile",p);let d=F=>{this.withLock(async()=>{let b=Fo(F.asset),R=c.get(b);await R.resetValue(F.asset),R.refreshValues()})};for(let F of c.values())F.addEventListener("assetreset",d);let h=F=>{this.deleteAsset(F.asset)},A=F=>{let{newName:b,asset:R}=F;if(b!==R)if(this.getViewFor(R).renameValue(R,b),gn(R)){let L=this.assetsList.findNode(R),S=this.assetsList.findNode(b);oe(S)&&(this.assetsList.addValue(b),S=this.assetsList.findNode(b)),this.moveZoneChildren(L,S),this.assetsList.removeNode(L)}else{let L=this.assetsList.findNode(R);this.assetsList.updateNode(L)}};for(let F of u.values())F.addEventListener("assetdelete",h),F.addEventListener("assetrename",A);Ee(document.body,this.contextMenu=new qm),this.element=Ly("Yarrow.Editor2",My(!0),Dy(!0),de("editor"),Zm(Py(qt("proportion",2),Qu("Assets",this.assetsList=new $f),Qu("Properties",...this.propertyViews.values())),Qu("Map",qt("proportion",3),this.mapView),Qu(Dr(".",O0("transparent")),Ap("visible"),qt("proportion",6),this.viewTabs=tf(Ae(qt("tab-name","Preview"),r),Ae(qt("tab-name","Google StreetView"),o)))));for(let F of this.propertyViews.values())F.visible=!1;this.scenarioView.visible=!0,this.assetsList.addEventListener("select",F=>{this.selectValue(y(F.node)&&y(F.node.value)?F.node.value:this.scenario)}),Xh(this.env.quitButton),Xh(this.env.settingsButton),Xh(this.env.muteEnvAudioButton);let g=async F=>{await this.onMenu(F.parent.node,F.type==="contextmenu"),F.complete()};this.assetsList.addEventListener("add",g),this.assetsList.addEventListener("contextmenu",g),this.assetsList.addEventListener("delete",F=>{this.deleteAsset(F.node.value)}),this.assetsList.addEventListener("reparented",F=>{F.node.parent&&gn(F.node.parent.value)&&(wo(F.node.value)?this.scenario.audioAdapter.updateThrottled(F.node.value,{zone:F.node.parent.value}):Mt(F.node.value)&&this.scenario.stationAdapter.updateThrottled(F.node.value,{zone:F.node.parent.value}))}),this.stationView.addEventListener("stationmarkstart",F=>{this.withLock(async()=>{let b=this.scenario.startStation;await this.scenario.stationAdapter.markStart(F.station);let R=this.assetsList.findNode(b),P=this.assetsList.findNode(F.station);this.assetsList.updateNode(R),this.assetsList.updateNode(P)})}),this.stationView.addEventListener("createconnection",F=>{this.withLock(()=>this.createAsset("connection",F.station))}),this.connectionView.addEventListener("assetselected",F=>{F.isContextMenu||this.selectValue(F.asset)}),this.connectionView.addEventListener("connectionstarted",F=>{this.assetsList.enabled=!0,this.assetsList.enableOnlyValues(F.connectables),this.scenario.makeOnlyStationsSelectable(F.connectables)}),this.connectionView.addEventListener("connectionending",()=>{this.scenario.makeAllMarkersSelectable(),this.assetsList.enableAllElements(),this.assetsList.enabled=!1}),this.mapView.addEventListener("capturestart",()=>{this.disabled=!0,this.viewTabs.select("appContainer")}),this.mapView.addEventListener("capturecomplete",F=>{this.withLock(async()=>{let b=await this.mapView.getElevation(F.metadata.location),R=await this.scenario.stationAdapter.create(F.metadata.fileID,F.metadata.fileName,F.metadata.location.lat,F.metadata.location.lng,b);this.assetsList.addValue(R),await this.selectValue(R)})}),this.mapView.addEventListener("streetviewopened",()=>{this.viewTabs.select("streetview")}),this.viewTabs.addEventListener("tabselected",F=>{F.tabname!=="streetview"&&this.mapView.closeStreetView()}),this.withLock(()=>this.load())}element;fileDetailDialog=new Jf;env;transformer;assetsList;scenarioView;stationView;connectionView;mapView;propertyViews;viewTabs;contextMenu;_scenario=null;_disabled=!1;moveZoneChildren(e,t){for(let i of e.children)this.assetsList.reparentNode(i,t,0)}deleteAsset(e){return Hi(e)?Promise.reject("Can't delete the scenario"):this.withLock(async()=>{let t=Fo(e),i=this.getView(t),r=this.assetsList.findNode(e),o=r.parent,s=rc.get(t);if(await this.env.confirmationDialog.prompt(lv.emojiStyle+" Confirm Delete",`Are you sure you want to delete ${s}: ${this.assetsList.getAssetName(e)}`)){if(i.value=null,gn(e)){let c=this.assetsList.findNode("");this.moveZoneChildren(r,c)}else if(Mt(e)){let c=this.assetsList.findAll(u=>Ar(u)&&u.toStationID===e.transformID);for(let u of c)this.assetsList.removeNode(u)}else if(Ar(e)){let c=this.assetsList.findAll(u=>Ar(u)&&u.toStationID===e.fromStationID&&u.fromStationID==e.toStationID);for(let u of c)this.assetsList.removeNode(u)}let l=this.assetsList.selectedNode===r;this.assetsList.removeNode(r),await i.deleteValue(e),l&&await this.selectNode(o)}})}async getSelection(e,t){if(this.connectionView.cancelConnection(),this.scenario.published)return await this.contextMenu.show(Ao,"readonly");{let i=e.value;return e.isRoot||Hi(i)?t?await this.contextMenu.show(Ao,"zone"):"zone":gn(i)?t&&i!==""?await this.contextMenu.show(Ao,"ambientAudio","station",ix(),"delete"):await this.contextMenu.show(Ao,"ambientAudio","station"):Mt(i)?t?await this.contextMenu.show(Ao,"audio","sign","video","text","model","connection",ix(),"delete"):await this.contextMenu.show(Ao,"audio","sign","video","text","model","connection"):t?await this.contextMenu.show(Ao,"delete"):"cancel"}}async onMenu(e,t){await this.contextMenu.cancel(),await this.withLock(async()=>{let i=await this.getSelection(e,t),r=e.value;i==="cancel"||i==="readonly"?console.warn("Cancelled"):i==="delete"?await this.deleteAsset(r):await this.createAsset(i,r)})}async createAsset(e,t){e==="connection"&&await this.selectValue(t);let r=await this.getView(e).createValue(t,this.env.loadingBar);if(y(r))if(this.assetsList.addValue(r),Ar(r)){if(!Mt(t))throw new Error("Connections must be created for Stations only");let o=this.scenario.getStation(r.toStationID),s=this.scenario.connectionAdapter.findConnection(o,t);this.assetsList.addValue(s),await this.selectValue(o)}else await this.selectValue(r)}async load(){let e=document.location.pathname.split("/");if(e.length===0)throw new Error("Illegal path");let t=e[e.length-1];if(!/^\d+$/.test(t))throw new Error("Illegal ID");let i=Et(this.env.loadingBar,[1,9]),r=parseFloat(t);await this.mapView.load(i[0]),await this.loadScenario(r,i[1])}async loadScenario(e,t){t=t||this.env.loadingBar;let i=new Gi(location.href).pathPop(Ipe).pathPush(e.toString()).toString();history.replaceState(null,null,i);let r=new Gf(this.env,this.logger,this.mapView,e);await this.env.load(t,r),this.scenario=r.result,this.env.menuButton.disabled=this.scenario.published}get scenario(){return this._scenario}set scenario(e){let t=this.scenario;y(t)&&t.removeScope(this),this.assetsList.scenario=this.mapView.scenario=this._scenario=e;for(let i of this.propertyViews.values())i.scenario=e;y(t)&&t.dispose(),y(this.scenario)&&(this.scenario.addScopedEventListener(this,"assetselected",async i=>{if(i.isContextMenu){let r=this.assetsList.findNode(i.asset);await this.onMenu(r,!0)}else this.selectValue(i.asset)}),this.scenario.addScopedEventListener(this,"assetupdated",i=>{i.asset===this.assetsList.selectedValue&&this.getViewFor(i.asset).refreshValues()}),this.showScenario())}showScenario(){this.scenario.stations.length>1?this.mapView.fitBounds(...this.scenario.stations.map(e=>e.location)):y(this.scenario.originLL)?this.mapView.panTo(pr(this.scenario.originLL)):this.scenario.stations.length>0?(this.mapView.zoom=15,this.scenario.startStation?this.mapView.panTo(this.scenario.startStation.location):this.mapView.panTo(this.scenario.stations[0].location)):this.withLock(async()=>{await this.mapView.search(this.scenario.name,!1)})}get disabled(){return this._disabled}set disabled(e){this._disabled=e,this.mapView.disabled=this.assetsList.disabled=e;for(let t of this.propertyViews.values())t.disabled=e}async withLock(e){this.disabled=!0;try{await e()}finally{this.disabled=!1}}getView(e){return this.propertyViews.get(e)}getViewFor(e){let t=Fo(e);return this.getView(t)}async selectValue(e){let t=this.assetsList.findNode(e);await this.selectNode(t)}selecting=!1;async selectNode(e){if(this.connectionView.isConnecting)y(e)&&Mt(e.value)&&this.connectionView.connectTo(e.value);else if(!this.selecting){this.selecting=!0;try{await this.withLock(async()=>{this.transformer.setTarget(null),this.assetsList.selectedNode=e;for(let t of this.propertyViews.values())t.visible=!1;if(y(e)&&y(e.value)){let t=e.value,i=this.getViewFor(t);if(i.visible=!0,i.value=t,Hi(t))this.showScenario();else if(gn(t))this.transformer.setTarget(null),this.mapView.setTarget(null);else{let r=this.scenario.getTransform(t.transformID);if(!wo(t)){let s=this.scenario.findStation(r);this.viewTabs.select("appContainer"),this.mapView.closeStreetView(),await this.scenario.showStationNow(s);let l=this.getViewFor(t);Mt(t)?(this.stationView.stationTransformDummy.quaternion.fromArray(s.rotation),this.transformer.setTarget(this.stationView.stationTransformDummy,l.getTransformModes(t))):this.transformer.setTarget(r,l.getTransformModes(t))}let o=this.scenario.getTransformPosition(t.transformID);this.mapView.setTarget(o),Mt(t)||this.env.avatar.lookAt(r)}}})}finally{this.selecting=!1}}}};var UT=sd(),Bpe=BA(UT),zT=new wg(UT,Bpe);Ee(Dp("#layoutForm"),Pn(Xt(100)),To(Xt(100)),zT);Object.assign(window,{editor:zT});
