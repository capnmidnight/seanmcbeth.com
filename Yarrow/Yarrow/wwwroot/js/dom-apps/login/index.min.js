function gt(o,t,e){return typeof o===t||o instanceof e}function y(o){return gt(o,"function",Function)}function g(o){return gt(o,"string",String)}function rt(o){return gt(o,"boolean",Boolean)}function U(o){return gt(o,"number",Number)}function it(o){return i(o)&&gt(o,"object",Object)}function st(o){return o instanceof Array}function j(o,t){throw new Error((t||"Unexpected object: ")+o)}function u(o){return o==null}function i(o){return!u(o)}function Ie(o){return o instanceof Uint8Array||o instanceof Uint8ClampedArray||o instanceof Int8Array||o instanceof Uint16Array||o instanceof Int16Array||o instanceof Uint32Array||o instanceof Int32Array||o instanceof Float32Array||o instanceof Float64Array||"BigUint64Array"in globalThis&&o instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&o instanceof globalThis.BigInt64Array}function je(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function z(o){return o.splice(0)}function Ee(o,t){for(let e=0;e<o.length;++e)if(o[e]!==t[e])return e;return-1}function $(o,t){let e=o.indexOf(t);return e>-1?(ie(o,e),!0):!1}function ie(o,t){return o.splice(t,1)[0]}function vt(o){return o}function Pe(){return!0}function Oe(){return!1}var pt=class{constructor(){this.listeners=new Map,this.listenerOptions=new Map,this.bubblers=new Set,this.scopes=new WeakMap}addBubbler(t){this.bubblers.add(t)}removeBubbler(t){this.bubblers.delete(t)}addScopedEventListener(t,e,n,r){this.scopes.has(t)||this.scopes.set(t,[]),this.scopes.get(t).push([e,n]),this.addEventListener(e,n,r)}removeScope(t){let e=this.scopes.get(t);if(e){this.scopes.delete(t);for(let[n,r]of e)this.removeEventListener(n,r)}}addEventListener(t,e,n){let r=this.listeners.get(t);r||(r=new Array,this.listeners.set(t,r)),r.find(s=>s===e)||(r.push(e),n&&this.listenerOptions.set(e,n))}removeEventListener(t,e){let n=this.listeners.get(t);n&&this.removeListener(n,e)}clearEventListeners(t){for(let[e,n]of this.listeners)if(u(t)||t===e){for(let r of n)this.removeEventListener(t,r);z(n),this.listeners.delete(e)}}removeListener(t,e){let n=t.findIndex(r=>r===e);n>=0&&(ie(t,n),this.listenerOptions.has(e)&&this.listenerOptions.delete(e))}dispatchEvent(t){let e=this.listeners.get(t.type);if(e)for(let n of e){let r=this.listenerOptions.get(n);i(r)&&!rt(r)&&r.once&&this.removeListener(e,n),y(n)?n.call(this,t):n.handleEvent(t)}if(t.defaultPrevented)return!1;for(let n of this.bubblers)if(!n.dispatchEvent(t))return!1;return!0}};var k=class{constructor(t=!0){this.autoStart=t,this.onThens=new Array,this.onCatches=new Array,this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",this.resolve=e=>{if(this.running){this._result=e,this._resultState="resolved";for(let n of this.onThens)n(e);this.clear(),this._executionState="finished"}},this.reject=e=>{if(this.running){this._error=e,this._resultState="errored";for(let n of this.onCatches)n(e);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){z(this.onThens),z(this.onCatches)}start(){this._executionState="running"}resolver(t){return()=>this.resolve(t)}resolveOn(t,e,n){let r=this.resolver(n);t.addEventListener(e,r),this.finally(()=>t.removeEventListener(e,r))}get result(){if(i(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((t,e)=>{this.finished?this.errored?e(this.error):t(this.result):(this.onThens.push(t),this.onCatches.push(e))})}then(t,e){return this.project().then(t,e)}catch(t){return this.project().catch(t)}finally(t){return this.project().finally(t)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(t){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",t&&this.start()}};function De(o,t){return"on"+t in o}function L(o,t,e,...n){u(n)&&(n=[]);let r;if(g(e)?n.unshift(e):U(e)&&(r=e),!(o instanceof pt)){if(!De(o,t))throw new Error(`Target does not have a ${t} rejection event`);for(let c of n)if(!De(o,c))throw new Error(`Target does not have a ${c} rejection event`)}let s=new k;if(U(r)){let c=setTimeout(s.reject,r,`'${t}' has timed out.`);s.finally(clearTimeout.bind(globalThis,c))}let p=(c,d)=>{o.addEventListener(c,d),s.finally(()=>o.removeEventListener(c,d))};p(t,c=>s.resolve(c));let a=c=>s.reject(c);for(let c of n)p(c,a);return s}function W(o){return o.then(Pe).catch(Oe)}var Re=/([^\/]+)\/(.+)/,Fo=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/;var At=class o{constructor(t,e,n){this._type=t,this._fullSubType=e,this._primaryExtension=null,this.depMessage=null;let r=new Map;this._parameters=r;let s=this._fullSubType.match(Fo);this._tree=s[1],this._subType=s[2],this._suffix=s[3];let p=s[4];if(this._value=this._fullValue=this._type+"/",i(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,i(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),i(p)){let a=p.split(";").map(c=>c.trim()).filter(c=>c.length>0).map(c=>c.split("="));for(let[c,...d]of a){let l=d.join("=");r.set(c,l);let v=`; ${c}=${l}`;this._fullValue+=v,c!=="q"&&(this._value+=v)}}this._extensions=n||[],this._primaryExtension=this._extensions[0]||null}static parse(t){if(!t)return null;let e=t.match(Re);if(!e)return null;let n=e[1],r=e[2];return new o(n,r)}deprecate(t){return this.depMessage=t,this}check(){i(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(t){if(u(t))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let e=null,n=null;if(g(t)){let r=t.match(Re);if(!r)return!1;e=r[1],n=r[2]}else e=t.typeName,n=t._fullSubType;return this.typeName===e&&(this._fullSubType==="*"||this._fullSubType===n)}withParameter(t,e){let n=`${this._fullSubType}; ${t}=${e}`;return new o(this.typeName,n,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}toFileSystemAPIAccepts(){return{[this.value]:this.extensions.map(t=>"."+t)}}addExtension(t){if(!t)throw new Error("File name is not defined");return this.primaryExtension&&(t=o.removeExtension(t),t=`${t}.${this.primaryExtension}`),t}static removeExtension(t){let e=t.lastIndexOf(".");return e>-1&&(t=t.substring(0,e)),t}};function No(o,t,...e){return new At(o,t,e)}function E(o){return No.bind(null,o)}var It=E("application");var ct=It("javascript","js");var se=It("json","json");var Be=It("json; charset=UTF-8","json");var pe=It("wasm","wasm");var ce=E("text");var bt=ce("css","css");var jt=ce("plain","txt","text","conf","def","list","log","in");var Le=ce("xml");var zo="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function ae(o,t){if(o<0)throw new Error("Length must be greater than 0");u(t)&&(t=zo);let e="";for(let n=0;n<o;++n){let r=Math.floor(Math.random()*t.length);e+=t[r]}return e}var Fe=new Map,Et=class{constructor(t,e,n,...r){this.key=t,this.value=e,this.bySetAttribute=n,this.tags=r.map(s=>s.toLocaleUpperCase()),Object.freeze(this)}applyToElement(t){if(this.tags.length>0&&this.tags.indexOf(t.tagName)===-1){let e=Fe.get(t.tagName);e||Fe.set(t.tagName,e=new Set),e.has(this.key)||(e.add(this.key),console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`))}this.bySetAttribute?t.setAttribute(this.key,this.value.toString()):this.key in t?t[this.key]=this.value:this.value===!1?t.removeAttribute(this.key):this.value===!0?t.setAttribute(this.key,""):y(this.value)?this.value(t):t.setAttribute(this.key,this.value.toString())}};function Pt(o,t,e,...n){return new Et(o,t,e,...n)}function Ne(o){return o instanceof Et}function ze(o){return Pt("height",o,!1,"canvas","embed","iframe","img","input","object","video")}function le(o){return Pt("rel",o,!1,"a","area","link")}function Ot(o){return g(o)||(o=o.value),Pt("type",o,!1,"button","input","command","embed","link","object","script","source","style","menu")}function Ge(o){return Pt("width",o,!1,"canvas","embed","iframe","img","input","object","video")}function We(o){return`${o}px`}function Dt(...o){return`rgb(${o.join(", ")})`}function Je(o){return it(o)?o.element instanceof Element:!1}function at(o){return Je(o)?o.element:g(o)?O(o):o}function Go(o){return it(o)&&"applyToElement"in o&&y(o.applyToElement)}function J(o,t,e=""){o=at(o),t?(o.style.removeProperty("display"),getComputedStyle(o).display==="none"&&(o.style.display=e||"block")):o.style.display="none"}function Wo(o,...t){let e=o instanceof Element||o instanceof ShadowRoot?o:g(o)?document.querySelector(o):o.element,n=e instanceof HTMLTemplateElement?e.content:e;for(let r of t)i(r)&&(r instanceof Node?n.appendChild(r):Je(r)?n.appendChild(at(r)):Go(r)?e instanceof ShadowRoot||r.applyToElement(e):n.appendChild(document.createTextNode(r.toLocaleString())));return e}function O(o){return document.querySelector(o)}function wt(o){return O(o)}function lt(o){return O(o)}function qe(o){return O(o)}function Rt(o,...t){let e=null,n=t.filter(Ne).filter(r=>r.key==="id"||r.key==="query");for(let r of n)r.key==="query"?(e=r.value,$(t,r)):r.key==="id"&&(e=document.getElementById(r.value),e&&$(t,r));return e&&e.tagName!==o.toUpperCase()&&console.warn(`Expected a "${o.toUpperCase()}" element but found a "${e.tagName}".`),e||(e=document.createElement(o)),Wo(e,...t),e}function Jo(o){for(o=at(o);o.lastChild;)o.lastChild.remove()}function de(o,t){o=at(o),Jo(o),o.append(Ho(t))}function qo(o,t){o=at(o),o.title=t}function me(o,t,e,n,r){o=at(o);let s=null,p=null,a=null;rt(t)?(p=t,a=e,r=n):(s=t,p=e,a=n),o.disabled=!p,a&&de(o,a),r&&qo(o,r),s&&(o.classList.toggle("btn-"+s,p),o.classList.toggle("btn-outline-"+s,!p))}function He(...o){return Rt("canvas",...o)}function xe(...o){return Rt("img",...o)}function Ue(...o){return Rt("link",...o)}function $e(...o){return Rt("script",...o)}function Ho(o){return document.createTextNode(o)}var dt=class extends Event{get type(){return super.type}constructor(t,e){super(t,e)}},K=class extends pt{addBubbler(t){super.addBubbler(t)}removeBubbler(t){super.removeBubbler(t)}addScopedEventListener(t,e,n,r){super.addScopedEventListener(t,e,n,r)}addEventListener(t,e,n){super.addEventListener(t,e,n)}removeEventListener(t,e){super.removeEventListener(t,e)}clearEventListeners(t){return super.clearEventListeners(t)}};var Bt=class extends K{constructor(){super(),this.event=new dt("quitting");let t=()=>this.dispatchEvent(this.event);window.addEventListener("beforeunload",t),window.addEventListener("unload",t),window.addEventListener("pagehide",t)}};function Lt(...o){return Promise.all(o)}function Ft(o){if(o.status>=400)throw new Error("Resource could not be retrieved: "+o.requestPath);return o}function mt(o){let{content:t}=Ft(o);return t}var Vt=class extends K{constructor(){super(...arguments),this.attached=new Array,this.soFar=null,this.total=null,this.msg=null,this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(t,e,n,r){this.soFar=t,this.total=e,this.msg=n,this.est=r;for(let s of this.attached)s.report(t,e,n,r)}attach(t){this.attached.push(t),t.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(t){this.report(0,1,t||"starting")}end(t){this.report(1,1,t||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,z(this.attached)}};var yt=class extends Vt{constructor(t,e){super(),this.i=t,this.prog=e}report(t,e,n,r){super.report(t,e,n,r),this.prog.update(this.i,t,e,n)}};var Nt=class{constructor(t){this.prog=t,this.weightTotal=0,this.subProgressCallbacks=new Array,this.subProgressWeights=new Array,this.subProgressValues=new Array,this.start=performance.now();for(let e=0;e<this.subProgressWeights.length;++e)this.subProgressValues[e]=0,this.subProgressCallbacks[e]=new yt(e,this)}addSubProgress(t){t=t||1,this.weightTotal+=t,this.subProgressWeights.push(t),this.subProgressValues.push(0);let e=new yt(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(e),e}update(t,e,n,r){if(this.prog){this.subProgressValues[t]=e/n;let s=0;for(let d=0;d<this.subProgressWeights.length;++d)s+=this.subProgressValues[d]*this.subProgressWeights[d];let p=performance.now(),a=p-this.start,c=this.start-p+a*this.weightTotal/s;this.prog.report(s,this.weightTotal,r,c)}}};function St(o,t){return new ue(t,o).subProgressCallbacks}function kt(o,t){let e=new Array(t);for(let n=0;n<t;++n)e[n]=1;return St(o,e)}var ue=class extends Nt{constructor(t,e){super(e);for(let n of t)this.addSubProgress(n)}};function Ke(){return"location"in globalThis?new URL(globalThis.location.href).searchParams.get("testUserNumber"):null}function Ye(){let o=Ke();return i(o)}function _e(){let o=Ke();return i(o)?parseInt(o,10):1}var zt;(function(o){o.None="None",o.Fullscreen="Fullscreen",o.VR="VR",o.AR="AR",o.Anaglyph="Anaglyph",o.FullscreenAnaglyph="FullscreenAnaglyph"})(zt||(zt={}));var Ze=Math.PI,pi=.5*Ze,ci=2*Ze;var Uo=864e13,ai=-Uo;function Qe(o,t,e){return(1-e)*o+e*t}var fe=class extends dt{constructor(){super("update"),this.t=0,this.dt=0,this.sdt=0,this.fps=0}set(t,e){this.t=t,this.dt=e,this.sdt=Qe(this.sdt,e,.01),e>0&&(this.fps=1e3/e)}},Gt=class extends fe{constructor(){super(),Object.seal(this)}};var Wt=class{constructor(t){this.timer=null,this.lt=-1,this.tickHandlers=new Array,this._targetFPS=null,this.targetFPS=t;let e=new Gt,n=0;this.onTick=r=>{this.lt>=0&&(n=r-this.lt,e.set(r,n),this.tick(e)),this.lt=r}}get targetFPS(){return this._targetFPS}set targetFPS(t){this._targetFPS=t}addTickHandler(t){this.tickHandlers.push(t)}removeTickHandler(t){$(this.tickHandlers,t)}tick(t){for(let e of this.tickHandlers)e(t)}restart(){this.stop(),this.start()}get isRunning(){return this.timer!=null}stop(){this.timer=null,this.lt=-1}get targetFrameTime(){return 1e3/this.targetFPS}};var Jt=class extends Wt{constructor(t){super(t)}start(){this.timer=setInterval(()=>this.onTick(performance.now()),this.targetFrameTime)}stop(){this.timer&&(clearInterval(this.timer),super.stop())}get targetFPS(){return super.targetFPS}set targetFPS(t){super.targetFPS=t,this.isRunning&&this.restart()}};function he(o){return i(o)&&o.length>0?parseFloat(o):null}var xt=class{constructor(t,e){this._url=null,this._base=void 0,this._protocol=null,this._host=null,this._hostName=null,this._userName=null,this._password=null,this._port=null,this._pathName=null,this._hash=null,this._query=new Map,t!==void 0&&(this._url=new URL(t,e),this.rehydrate())}rehydrate(){i(this._protocol)&&this._protocol!==this._url.protocol&&(this._url.protocol=this._protocol),i(this._host)&&this._host!==this._url.host&&(this._url.host=this._host),i(this._hostName)&&this._hostName!==this._url.hostname&&(this._url.hostname=this._hostName),i(this._userName)&&this._userName!==this._url.username&&(this._url.username=this._userName),i(this._password)&&this._password!==this._url.password&&(this._url.password=this._password),i(this._port)&&this._port.toFixed(0)!==this._url.port&&(this._url.port=this._port.toFixed(0)),i(this._pathName)&&this._pathName!==this._url.pathname&&(this._url.pathname=this._pathName),i(this._hash)&&this._hash!==this._url.hash&&(this._url.hash=this._hash);for(let[t,e]of this._query)this._url.searchParams.set(t,e);this._protocol=this._url.protocol,this._host=this._url.host,this._hostName=this._url.hostname,this._userName=this._url.username,this._password=this._url.password,this._port=he(this._url.port),this._pathName=this._url.pathname,this._hash=this._url.hash,this._url.searchParams.forEach((t,e)=>this._query.set(e,t))}refresh(){if(this._url===null){if(i(this._protocol)&&(i(this._host)||i(this._hostName))){if(i(this._host))return this._url=new URL(`${this._protocol}//${this._host}`,this._base),this._port=he(this._url.port),this.rehydrate(),!1;if(i(this._hostName))return this._url=new URL(`${this._protocol}//${this._hostName}`,this._base),this.rehydrate(),!1}else if(i(this._pathName)&&i(this._base))return this._url=new URL(this._pathName,this._base),this.rehydrate(),!1}return i(this._url)}base(t){if(this._url!==null)throw new Error("Cannot redefine base after defining the protocol and domain");return this._base=t,this.refresh(),this}protocol(t){return this._protocol=t,this.refresh()&&(this._url.protocol=t),this}host(t){return this._host=t,this.refresh()&&(this._url.host=t,this._hostName=this._url.hostname,this._port=he(this._url.port)),this}hostName(t){return this._hostName=t,this.refresh()&&(this._url.hostname=t,this._host=`${this._url.hostname}:${this._url.port}`),this}port(t){return this._port=t,this.refresh()&&(this._url.port=t.toFixed(0),this._host=`${this._url.hostname}:${this._url.port}`),this}userName(t){return this._userName=t,this.refresh()&&(this._url.username=t),this}password(t){return this._password=t,this.refresh()&&(this._url.password=t),this}path(t){return this._pathName=t,this.refresh()&&(this._url.pathname=t),this}pathPop(t){return t=t||/\/[^/]+\/?$/,this.path(this._pathName.replace(t,""))}pathPush(t){let e=this._pathName;return e.endsWith("/")||(e+="/"),e+=t,this.path(e)}query(t,e){return this._query.set(t,e),this.refresh()&&this._url.searchParams.set(t,e),this}hash(t){return this._hash=t,this.refresh()&&(this._url.hash=t),this}toURL(){return this._url}toString(){return this._url.href}[Symbol.toStringTag](){return this.toString()}};function $o(){return/^mac/i.test(navigator.platform)}function to(){return/iP(ad|hone|od)/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||$o()&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>2}function eo(){return/Mobile VR/.test(navigator.userAgent)||/Pico Neo 3 Link/.test(navigator.userAgent)||Xt}var Ko=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,qt=navigator.userAgent.match(Ko),Xt=!!qt,bi=Xt&&{major:parseFloat(qt[1]),minor:parseFloat(qt[2]),patch:parseFloat(qt[3])},wi=Xt&&/pacific/i.test(navigator.userAgent),Vi=Xt&&/quest/i.test(navigator.userAgent),yi=Xt&&/quest 2/i.test(navigator.userAgent);var Yo="Worker"in globalThis;var oo="0.150.1";async function no(o,t){let e=new Array(t.length),n=new Array(t.length);for(let p=0;p<t.length;++p){let a=t[p];e[p]=a[0],n[p]=a[1]}let r=St(o,e),s=new Array(t.length);for(let p=0;p<t.length;++p)s[p]=n[p](r[p]);return await Promise.all(s)}function io(o){return i(o)&&y(o.then)&&y(o.catch)&&y(o.finally)&&y(o.fetch)&&y(o.getSize)}var ro=class{get result(){if(i(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}constructor(t,e){this.path=t,this.type=e,this._result=null,this._error=null,this._started=!1,this._finished=!1,this.resolve=null,this.reject=null,this.promise=new Promise((n,r)=>{this.resolve=s=>{this._result=s,this._finished=!0,n(s)},this.reject=s=>{this._error=s,this._finished=!0,r(s)}})}async getSize(t){try{let{contentLength:e}=await t.head(this.path).accept(this.type).exec();return[this,e||1]}catch(e){return console.warn(e),[this,1]}}async fetch(t,e){try{let n=await this.getResult(t,e);this.resolve(n)}catch(n){this.reject(n)}}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};function ge(o,...t){if(!it(o))return!1;o=o;for(let e of t){if(!(e in o))return!1;let n=o[e];if(!y(n))return!1}return!0}function Qo(o){return ge(o,"dispose")}function tn(o){return ge(o,"destroy")}function en(o){return ge(o,"close")}function q(o){Qo(o)&&o.dispose(),en(o)&&o.close(),tn(o)&&o.destroy()}function so(o,t){try{return t(o)}finally{q(o)}}var Gi="HTMLCanvasElement"in globalThis,Wi="HTMLImageElement"in globalThis,ve=!1,ut=!ve&&"OffscreenCanvas"in globalThis,Ji=!ve&&"createImageBitmap"in globalThis;function on(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var qi=ut&&on();function nn(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var Hi=ut&&nn();function po(o,t){return new OffscreenCanvas(o,t)}function co(o,t){return He(Ge(o),ze(t))}function Ae(o,t){let e=o.getContext("2d");if(u(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function ao(o){let t=new k,e=setInterval(()=>{o()&&(clearInterval(e),t.resolve())},100);return t}async function A(o,t){let{status:e,requestPath:n,responsePath:r,content:s,contentType:p,contentLength:a,fileName:c,headers:d,date:l}=o;return{status:e,requestPath:n,responsePath:r,content:i(t)?await t(s):void 0,contentType:p,contentLength:a,fileName:c,headers:d,date:l}}var be=null;function lo(o){return be===null&&(be=new Audio),be.canPlayType(o)!==""}var Ht=class{constructor(t,e,n,r=!1){this.fetcher=t,this.method=e,this.path=n,this.useBLOBs=r,this.prog=null,this.request={method:e,path:this.path.href,body:null,headers:null,timeout:null,withCredentials:!1,useCache:!1,retryCount:3}}retries(t){return this.request.retryCount=t,this}query(t,e){return this.path.searchParams.set(t,e),this.request.path=this.path.href,this}header(t,e){return this.request.headers===null&&(this.request.headers=new Map),this.request.headers.set(t.toLowerCase(),e),this}headers(t){for(let[e,n]of t.entries())this.header(e,n);return this}timeout(t){return this.request.timeout=t,this}progress(t){return this.prog=t,this}body(t,e){if(i(t)){let n=new Set,r=new Array;r.push(t);let s=!1;for(;!s&&r.length>0;){let p=r.shift();if(p&&!n.has(p))if(n.add(p),p instanceof Blob){s=!0;break}else g(p)||r.push(...Object.values(p))}if(s){let p=new FormData,a=new Map,c=new Set;for(let[d,l]of Object.entries(t))if(l instanceof Blob){let v=d+".name",m=t[v];g(m)&&(a.set(l,m),c.add(v))}for(let[d,l]of Object.entries(t))c.has(d)||(l instanceof Blob?p.append(d,l,a.get(l)):g(l)?p.append(d,l):i(l)&&y(l.toString)?p.append(d,l.toString()):console.warn("Can't serialize value to formdata",d,l));t=p,e=void 0}this.request.body=t,this.content(e)}return this}withCredentials(){return this.request.withCredentials=!0,this}useCache(t=!0){return this.request.useCache=t,this}media(t,e){i(e)&&(g(e)||(e=e.value),this.header(t,e))}content(t){this.media("content-type",t)}accept(t){return this.media("accept",t),this}blob(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBlob(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBlob(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);j(this.method)}buffer(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBuffer(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBuffer(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);j(this.method)}async file(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return await this.fetcher.sendObjectGetFile(this.request,this.prog);if(this.method==="GET"){if(this.useBLOBs)return await this.fetcher.sendNothingGetFile(this.request,this.prog);{let e=await this.fetcher.sendNothingGetNothing(this.request);return A(e,()=>this.request.path)}}else{if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);j(this.method)}}text(t){if(this.accept(t||jt),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetText(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetText(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);j(this.method)}object(t){if(this.accept(t||se),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetObject(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetObject(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);j(this.method)}xml(t){if(this.accept(t||Le),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetXml(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetXml(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);j(this.method)}imageBitmap(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetImageBitmap(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetImageBitmap(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);j(this.method)}exec(){if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetNothing(this.request,this.prog);if(this.method==="GET")throw new Error("GET requests should expect a response type");if(this.method==="HEAD"||this.method==="OPTIONS")return this.fetcher.sendNothingGetNothing(this.request);j(this.method)}async audioBlob(t){if(i(t)&&(g(t)||(t=t.value),!lo(t)))throw new Error(`Probably can't play file of type "${t}" at path: ${this.request.path}`);let e=await this.blob(t);if(lo(e.contentType))return e;throw new Error(`Cannot play file of type "${e.contentType}" at path: ${this.request.path}`)}async audioBuffer(t,e){return A(await this.audioBlob(e),async n=>await t.decodeAudioData(await n.arrayBuffer()))}async htmlElement(t,e,n){let r=await this.file(n),s=L(t,e,"error");return t instanceof HTMLLinkElement?t.href=r.content:t.src=r.content,await s,await A(r,()=>t)}image(t){return this.htmlElement(xe(),"load",t)}async htmlCanvas(t){let e=co(1,1);if(this.method==="GET")if(ut){this.accept(t);let n=await this.fetcher.drawImageToCanvas(this.request,e.transferControlToOffscreen(),this.prog);return await A(n,()=>e)}else{let n=await this.image(t);return await A(n,r=>(e.width=r.width,e.height=r.height,Ae(e,r),q(r),e))}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);j(this.method)}}canvas(t){return ut?this.offscreenCanvas(t):this.htmlCanvas(t)}async offscreenCanvas(t){if(!ut)throw new Error("This system does not support OffscreenCanvas");if(this.method==="GET"){let e=await this.image(t);return await A(e,n=>{let r=po(n.width,n.height);return Ae(r,n),q(n),r})}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);j(this.method)}}async style(){let t=Ue(Ot(bt),le("stylesheet"));document.head.append(t);let e=await this.htmlElement(t,"load",bt);return A(e)}async getScript(){let t=$e(Ot(ct));document.head.append(t);let e=await this.htmlElement(t,"load",ct);return A(e)}async script(t){let e=null,n=this.request.path;if(!t)e=await this.getScript();else if(!t()){let r=ao(t);e=await this.getScript(),await r}return this.prog&&this.prog.end(n),e}async module(){let t=this.request.path,e=await this.file(ct),n=await import(e.content);return this.prog&&this.prog.end(t),A(e,()=>n)}async wasm(t){let e=await this.buffer(pe);if(!pe.matches(e.contentType))throw new Error(`Server did not respond with WASM file. Was: ${e.contentType}`);let n=await WebAssembly.compile(e.content),r=await WebAssembly.instantiate(n,t);return A(e,()=>r.exports)}async worker(t="module"){let e=this.request.path,n=await this.file(ct);this.prog=null,this.request.timeout=null;let r=new Worker(n.content,{type:t});return this.prog&&this.prog.end(e),A(n,()=>r)}};var Ut=class{constructor(t,e=!1){this.service=t,this.useBLOBs=e;{let n=lt("input[name=__RequestVerificationToken]");n&&this.service.setRequestVerificationToken(n.value)}}clearCache(){return this.service.clearCache()}evict(t,e){return this.service.evict(new URL(t,e||location.href).href)}request(t,e,n){return new Ht(this.service,t,new URL(e,n||location.href),this.useBLOBs)}head(t,e){return this.request("HEAD",t,e)}options(t,e){return this.request("OPTIONS",t,e)}get(t,e){return this.request("GET",t,e)}post(t,e){return this.request("POST",t,e)}put(t,e){return this.request("PUT",t,e)}patch(t,e){return this.request("PATCH",t,e)}delete(t,e){return this.request("DELETE",t,e)}async assets(t,e,...n){u(n)&&(n=[]),n.unshift(e);let r;io(t)?n.unshift(t):i(t)&&(r=t),n=n.filter(i);let s=await Promise.all(n.map(a=>a.getSize(this))),p=new Map(s);await no(r,n.map(a=>[p.get(a),c=>a.fetch(this,c)]))}};var $t=class{constructor(t){this.impl=t,this.defaultPostHeaders=new Map}setRequestVerificationToken(t){this.defaultPostHeaders.set("RequestVerificationToken",t)}clearCache(){return this.impl.clearCache()}evict(t){return this.impl.evict(t)}sendNothingGetNothing(t){return this.impl.sendNothingGetNothing(t)}sendNothingGetBlob(t,e){return this.impl.sendNothingGetSomething("blob",t,e)}sendObjectGetBlob(t,e){return this.impl.sendSomethingGetSomething("blob",t,this.defaultPostHeaders,e)}sendNothingGetBuffer(t,e){return this.impl.sendNothingGetSomething("arraybuffer",t,e)}sendObjectGetBuffer(t,e){return this.impl.sendSomethingGetSomething("arraybuffer",t,this.defaultPostHeaders,e)}sendNothingGetText(t,e){return this.impl.sendNothingGetSomething("text",t,e)}sendObjectGetText(t,e){return this.impl.sendSomethingGetSomething("text",t,this.defaultPostHeaders,e)}sendNothingGetObject(t,e){return this.impl.sendNothingGetSomething("json",t,e)}sendObjectGetObject(t,e){return this.impl.sendSomethingGetSomething("json",t,this.defaultPostHeaders,e)}sendObjectGetNothing(t,e){return this.impl.sendSomethingGetSomething("",t,this.defaultPostHeaders,e)}drawImageToCanvas(t,e,n){return this.impl.drawImageToCanvas(t,e,n)}async sendNothingGetFile(t,e){return A(await this.sendNothingGetBlob(t,e),URL.createObjectURL)}async sendObjectGetFile(t,e){return A(await this.sendObjectGetBlob(t,e),URL.createObjectURL)}async sendNothingGetXml(t,e){return A(await this.impl.sendNothingGetSomething("document",t,e),n=>n.documentElement)}async sendObjectGetXml(t,e){return A(await this.impl.sendSomethingGetSomething("document",t,this.defaultPostHeaders,e),n=>n.documentElement)}async sendNothingGetImageBitmap(t,e){return A(await this.sendNothingGetBlob(t,e),createImageBitmap)}async sendObjectGetImageBitmap(t,e){return A(await this.sendObjectGetBlob(t,e),createImageBitmap)}};function mo(o,t,e){return new Map(o.map(n=>[t(n),e(n)]))}function xo(o,t){return mo(o,t,vt)}var H=class{constructor(t){if(this.items=new Map,this.defaultItems=new Array,i(t))for(let[e,n]of t)this.add(e,n)}add(t,...e){for(let n of e)if(u(t))this.defaultItems.push(n);else{let r=this.items.get(t);u(r)&&this.items.set(t,r=[]),r.push(n)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let t of this.defaultItems)yield t;for(let t of this.items.values())for(let e of t)yield e}has(t){return i(t)?this.items.has(t):this.defaultItems.length>0}get(t){return u(t)?this.defaultItems:this.items.get(t)||[]}count(t){if(u(t))return this.defaultItems.length;let e=this.get(t);return i(e)?e.length:0}get size(){let t=this.defaultItems.length;for(let e of this.items.values())t+=e.length;return t}delete(t){return u(t)?z(this.defaultItems).length>0:this.items.delete(t)}remove(t,e){if(u(t))$(this.defaultItems,e);else{let n=this.items.get(t);i(n)&&($(n,e),n.length===0&&this.items.delete(t))}}clear(){this.items.clear(),z(this.defaultItems)}};var Y=class{constructor(t){if(this.items=new Map,i(t))for(let[e,n,r]of t)this.add(e,n,r)}add(t,e,n){let r=this.items.get(t);return u(r)&&this.items.set(t,r=new Map),r.set(e,n),this}*entries(){for(let[t,e]of this.items)for(let[n,r]of e)yield[t,n,r]}keys(t){return u(t)?this.items.keys():this.items.get(t).keys()}*values(){for(let t of this.items.values())for(let e of t.values())yield e}has(t,e){return this.items.has(t)&&(u(e)||this.items.get(t).has(e))}get(t,e){return u(e)?this.items.get(t):this.items.has(t)?this.items.get(t).get(e):null}count(t){return this.items.has(t)?this.items.get(t).size:null}get size(){let t=0;for(let e of this.items.values())t+=e.size;return t}delete(t,e){if(u(e))return this.items.delete(t);if(this.items.has(t)){let n=this.items.get(t),r=n.delete(e);return n.size===0&&this.items.delete(t),r}else return!1}clear(){this.items.clear()}};var Kt=class o{static delete(t){let e=indexedDB.deleteDatabase(t),n=L(e,"success","error","blocked");return W(n)}static async open(t,...e){let n=xo(e,b=>b.name),r=new Y(e.filter(b=>i(b.indexes)).flatMap(b=>b.indexes.map(M=>[b.name,M.name,M]))),s=new Array,p=new Array,a=new Array,c=new H,d=new H,l=null,v=indexedDB.open(t);if(await W(L(v,"success","error","blocked"))){let b=v.result;l=b.version;let M=new Array;for(let S of b.objectStoreNames)n.has(S)||p.push(S);for(let S of n.keys())b.objectStoreNames.contains(S)?M.push(S):s.push(S);if(M.length>0){let S=b.transaction(M),V=L(S,"complete","error","abort"),P=W(V);for(let h of M){let G=S.objectStore(h),x=n.get(h);i(x.options)&&G.keyPath!==x.options.keyPath&&(p.push(h),s.push(h));for(let X of G.indexNames)r.has(h,X)||(a.indexOf(h)===-1&&a.push(h),d.add(h,X));if(r.has(h))for(let X of r.get(h).keys())if(!G.indexNames.contains(X))a.indexOf(h)===-1&&a.push(h),c.add(h,X);else{let F=r.get(h,X),T=G.index(X);(g(F.keyPath)!==g(T.keyPath)||g(F.keyPath)&&g(T.keyPath)&&F.keyPath!==T.keyPath||st(F.keyPath)&&st(T.keyPath)&&Ee(F.keyPath,T.keyPath))&&(a.indexOf(h)===-1&&a.push(h),d.add(h,X),c.add(h,X))}}S.commit(),await P}q(b)}else{l=0,s.push(...n.keys());for(let b of e)if(i(b.indexes))for(let M of b.indexes)c.add(b.name,M.name)}(s.length>0||p.length>0||c.size>0||d.size>0)&&++l;let m=new k,_=i(l)?indexedDB.open(t,l):indexedDB.open(t),C=L(_,"success","error","blocked"),ot=W(m),nt=W(C),Q=m.resolver(!1);if(_.addEventListener("success",Q),_.addEventListener("upgradeneeded",()=>{let b=L(_.transaction,"complete","error","abort"),M=_.result;for(let V of p)M.deleteObjectStore(V);let S=new Map;for(let V of s){let P=n.get(V),h=M.createObjectStore(V,P.options);S.set(V,h)}for(let V of a){let P=_.transaction.objectStore(V);S.set(V,P)}for(let[V,P]of S){for(let h of d.get(V))P.deleteIndex(h);for(let h of c.get(V)){let G=r.get(V,h);P.createIndex(h,G.keyPath,G.options)}}W(b).then(m.resolve).catch(m.reject).finally(()=>_.removeEventListener("success",Q))}),!await ot)throw m.error;if(!await nt)throw C.error;return new o(_.result)}constructor(t){this.db=t}dispose(){q(this.db)}get name(){return this.db.name}get version(){return this.db.version}get storeNames(){return Array.from(this.db.objectStoreNames)}getStore(t){return new we(this.db,t)}},we=class{constructor(t,e){this.db=t,this.storeName=e}async request(t,e){let n=this.db.transaction(this.storeName,e),r=L(n,"complete","error"),s=n.objectStore(this.storeName),p=t(s),a=L(p,"success","error");if(!await W(a))throw n.abort(),a.error;if(n.commit(),!await W(r))throw r.error;return p.result}add(t,e){return this.request(n=>n.add(t,e),"readwrite")}clear(){return this.request(t=>t.clear(),"readwrite")}getCount(t){return this.request(e=>e.count(t),"readonly")}async has(t){return await this.getCount(t)>0}delete(t){return this.request(e=>e.delete(t),"readwrite")}get(t){return this.request(e=>e.get(t),"readonly")}getAll(){return this.request(t=>t.getAll(),"readonly")}getAllKeys(){return this.request(t=>t.getAllKeys(),"readonly")}getKey(t){return this.request(e=>e.getKey(t),"readonly")}openCursor(t,e){return this.request(n=>n.openCursor(t,e),"readonly")}openKeyCursor(t,e){return this.request(n=>n.openKeyCursor(t,e),"readonly")}put(t,e){return this.request(n=>n.put(t,e),"readwrite")}};function uo(o,...t){for(let e of t)if(i(e))for(let[n,r]of e)o.set(n,r);return o}var Ve=class extends k{constructor(t){super(!1),this.milliseconds=t,this._timer=null}start(){super.start(),this._timer=setTimeout(()=>{this._timer=null,this.resolve()},this.milliseconds)}reset(){super.reset(),i(this._timer)&&(clearTimeout(this._timer),this._timer=null)}};function _o(o){let t=new Ve(o);return t.start(),t}function Yt(o,t){return async()=>{let e=null,n=500;for(let r=0;r<=o;++r)try{return r>0&&(await _o(n),n*=2),await t()}catch(s){e=s}throw e}}function rn(o){return g(o)||Ie(o)||o instanceof Blob||o instanceof FormData||je(o)||"Document"in globalThis&&o instanceof Document}function Zt(o,t,e,n,r,s){let p=!s;s&&s.then(()=>p=!0);let a=!1,c=r,d=new k;e.addEventListener("loadstart",()=>{p&&!a&&n&&n.start(o)}),e.addEventListener("progress",v=>{if(p&&!a){let m=v;n&&n.report(m.loaded,Math.max(m.loaded,m.total),o),m.loaded===m.total&&(c=!0,a&&d.resolve())}}),e.addEventListener("load",()=>{p&&!a&&(n&&n.end(o),a=!0,c&&d.resolve())});let l=v=>()=>{p&&d.reject(`${v} (${t.status})`)};return e.addEventListener("error",l("error")),e.addEventListener("abort",l("abort")),e.addEventListener("timeout",l("timeout")),d}function ye(o,t,e,n,r,s){if(o.open(t,e),o.responseType="blob",o.timeout=n,r)for(let[p,a]of r)o.setRequestHeader(p,a);i(s)?o.send(s):o.send()}function Qt(o,t,e){if(!o.has(t))return null;let n=o.get(t);try{let r=e(n);return o.delete(t),r}catch(r){console.warn(t,r)}return null}var sn=/filename=\"(.+)\"(;|$)/,pn="Juniper:Fetcher:Cache",te=class{constructor(){this.cache=null,this.store=null,this.tasks=new Y,this.cacheReady=this.openCache()}async drawImageToCanvas(t,e,n){let r=await this.sendNothingGetSomething("blob",t,n),s=r.content;return so(await createImageBitmap(s,{imageOrientation:"from-image"}),p=>(e.width=p.width,e.height=p.height,e.getContext("2d").drawImage(p,0,0),A(r)))}async openCache(){let t={keyPath:"requestPath"};this.cache=await Kt.open(pn,{name:"files",options:t}),this.store=await this.cache.getStore("files")}async clearCache(){await this.cacheReady,await this.store.clear()}async evict(t){await this.cacheReady,this.store.has(t)&&await this.store.delete(t)}async readResponseHeaders(t,e){let n=e.getAllResponseHeaders().split(/[\r\n]+/).map(m=>m.trim()).filter(m=>m.length>0).map(m=>{let _=m.split(": "),C=_.shift().toLowerCase(),ot=_.join(": ");return[C,ot]}),r=new H(n),s=Array.from(r.keys()).map(m=>[m,r.get(m).join(", ")]),p=new Map(s),a=Qt(p,"content-type",vt),c=Qt(p,"content-length",parseFloat),d=Qt(p,"date",m=>new Date(m)),l=Qt(p,"content-disposition",m=>{if(i(m)){let _=m.match(sn);if(i(_))return _[1]}return null});return{status:e.status,requestPath:t,responsePath:e.responseURL,content:void 0,contentType:a,contentLength:c,fileName:l,date:d,headers:p}}async readResponse(t,e){let{responsePath:n,status:r,contentType:s,contentLength:p,fileName:a,date:c,headers:d}=await this.readResponseHeaders(t,e),l={requestPath:t,responsePath:n,status:r,contentType:s,contentLength:p,fileName:a,date:c,headers:d,content:e.response};return i(l.content)&&(l.contentType=l.contentType||l.content.type,l.contentLength=l.contentLength||l.content.size),l}async decodeContent(t,e){return A(e,async n=>{if(t==="")return null;if(u(e.contentType)){let r=Array.from(e.headers.entries()).map(s=>s.join(": ")).join(`
  `);throw new Error(`No content type found in headers: 
  `+r)}else{if(t==="blob")return n;if(t==="arraybuffer")return await n.arrayBuffer();if(t==="json"){let r=await n.text();return r.length>0?JSON.parse(r):null}else if(t==="document"){let r=new DOMParser;if(e.contentType==="application/xhtml+xml"||e.contentType==="text/html"||e.contentType==="application/xml"||e.contentType==="image/svg+xml"||e.contentType==="text/xml")return r.parseFromString(await n.text(),e.contentType);throw new Error("Couldn't parse document")}else{if(t==="text")return await n.text();j(t)}}})}async withCachedTask(t,e){return t.method!=="GET"&&t.method!=="HEAD"&&t.method!=="OPTIONS"?await e():(this.tasks.has(t.method,t.path)||this.tasks.add(t.method,t.path,e().finally(()=>this.tasks.delete(t.method,t.path))),this.tasks.get(t.method,t.path))}sendNothingGetNothing(t){return this.withCachedTask(t,Yt(t.retryCount,async()=>{let e=new XMLHttpRequest,n=Zt(`requesting: ${t.path}`,e,e,null,!0);return ye(e,t.method,t.path,t.timeout,t.headers),await n,await this.readResponseHeaders(t.path,e)}))}sendNothingGetSomething(t,e,n){return this.withCachedTask(e,Yt(e.retryCount,async()=>{let r=null,s=e.useCache&&e.method==="GET";s&&(i(n)&&n.start(),await this.cacheReady,r=await this.store.get(e.path));let p=u(r);if(p){let c=new XMLHttpRequest,d=Zt(`requesting: ${e.path}`,c,c,n,!0);ye(c,e.method,e.path,e.timeout,e.headers),await d,r=await this.readResponse(e.path,c),s&&await this.store.add(r)}let a=await this.decodeContent(t,r);return p&&i(n)&&n.end(),a}))}sendSomethingGetSomething(t,e,n,r){let s=null,p=uo(new Map,n,e.headers),a=null;if(i(p)){let _=new Array;for(let C of p.keys())C.toLowerCase()==="content-type"&&_.push(C);if(_.length>0){e.body instanceof FormData||(a=p.get(_[0]),_.shift());for(let C of _)p.delete(C)}}rn(e.body)&&!g(e.body)||g(e.body)&&jt.matches(a)?s=e.body:i(e.body)&&(s=JSON.stringify(e.body));let c=i(s),d=kt(r,c?2:1),[l,v]=d,m=async()=>{let _=new XMLHttpRequest,C=c?Zt("uploading",_,_.upload,l,!1):Promise.resolve(),ot=Zt("saving",_,_,v,!0,C);ye(_,e.method,e.path,e.timeout,p,s),await C,await ot;let nt=await this.readResponse(e.path,_);return await this.decodeContent(t,nt)};return Yt(e.retryCount,m)()}};var fo=new URL(globalThis.location.href),D=fo.searchParams.has("DEBUG")&&!fo.searchParams.has("RELEASE");function ho(o,t){let e=globalThis,n=e[o];if(u(n)){if(u(t))throw new Error(`No value ${o} found`);n=t(),e[o]=n}return n}var cn="The quick brown fox jumps over the lazy dog",go=ho("juniper::loadedFonts",()=>[]);function an(o){let t=[];return o.fontStyle&&o.fontStyle!=="normal"&&t.push(o.fontStyle),o.fontVariant&&o.fontVariant!=="normal"&&t.push(o.fontVariant),o.fontWeight&&o.fontWeight!=="normal"&&t.push(o.fontWeight),t.push(We(o.fontSize)),t.push(o.fontFamily),t.join(" ")}async function ee(o,t=null,e){if(g(o)||(o=an(o)),go.indexOf(o)===-1){t=t||cn,e&&e.start(o);let n=await document.fonts.load(o,t);e&&e.end(o),n.length===0?console.warn(`Failed to load font "${o}". If this is a system font, just set the object's \`value\` property, instead of calling \`loadFontAndSetText\`.`):go.push(o)}}var vo="3.7.24";var oe=class{constructor(t){this.log=t}error(t,e,n){console.error(t,e,n),this.log("error",{page:t,operation:e,exception:n})}};var Se=D?ae(10):vo;var Ao=!1,bo="/Multiplayer",dn=50,mn=12,oc=dn*mn;var ke={images:{backButton:"/images/back-button.jpg",defaultButton:"/images/back-button.jpg",title:"/images/menu-title.jpg",logo:{back:"/images/main-logo.png"}},font:{fontFamily:"Lato",fontSize:20,fontWeight:"bold"}},_t={fontFamily:"Lato",fontSize:20},xn={fontFamily:"Segoe UI Emoji",fontSize:20};async function wo(){await Lt(ee(_t),ee(xn),ee(ke.font))}var Vo=Dt(30,67,136),yo=Dt(78,77,77),So={fontFamily:_t.fontFamily,fontSize:_t.fontSize,textFillColor:"white"},nc=Object.assign({},So,{bgFillColor:Dt(0,120,215),bgStrokeColor:"black",bgStrokeSize:.02,padding:{top:.025,left:.05,bottom:.025,right:.05},minHeight:.2,maxHeight:.2,scale:300}),rc=Object.assign({},So,{textStrokeColor:"black",textStrokeSize:.01,minHeight:.25,maxHeight:.25});function ko(){let o=new H([["arrow","arrow-up"],["arrow","arrow-down"],["arrow","arrow-left"],["arrow","arrow-right"],["chat","user"],["chat","chat"],["ui","menu"],["ui","settings"],["ui","quit"],["ui","lobby"],["zoom","zoom-in"],["zoom","zoom-out"],["zoom","zoom-info"],["environment-audio","environment-audio-mute"],["environment-audio","environment-audio-unmute"],["headphones","headphones-unmuted"],["headphones","headphones-muted"],["microphone","microphone-mute"],["microphone","microphone-unmute"],["volume","volume-muted"],["volume","volume-low"],["volume","volume-medium"],["volume","volume-high"],["media","media-pause"],["media","media-play"],["media","media-stop"],["media","media-replay"],["ar","ar-enter"],["ar","ar-exit"],["vr","vr-enter"],["vr","vr-exit"],["fullscreen","fullscreen-enter"],["fullscreen","fullscreen-exit"]]),t=new Y;for(let[e,n]of o.entries())for(let r of n)t.add(e,r.replace(e+"-",""),`/images/ui/${r}.png`);return t}var un=D?".js":".min.js",_n=D?".css":".min.css";function Xo(o,t){return`/js/${t}/index${o}?v=${Se}`}function To(o){return Xo(un,o)}function fn(o){return Xo(_n,o)}function Xe(o){return To("vr-apps/"+o)}function Mo(o){return fn("vr-apps/"+o)}function Co(o){return To("libs/"+o)}function Io(o){let t=null,e=Promise.resolve(),n=async(r,s)=>{t=await o.post("/").body({reportID:t,key:r,value:s},Be).object().then(mt)};return new oe((r,s)=>{e=e.then(()=>n(r,s))})}function jo(o=!0){let t=new $t(new te);return new Ut(t,!D)}var Tt=jo(!1),Z=Io(Tt);try{let tt=function(){let f=i(x),w=T!==null&&T.length>0,I=T==="Instructor",R=T==="Student",N=m.value.toLocaleUpperCase().length>0,et=v.value.length>0;J(C,to()),J(o,!w),J(t,w&&T!=="Explore","grid"),J(p,R,""),J(a,I,""),de(s,I?"Create Session":"Join Session");let ht=f?"":" (loading)";me(r,f,"Explore alone"+ht,"Explore lesson content without teleconferencing features"+ht);let re=f?et?N?Mt?"ing...":"":" (meeting ID required)":N?" (user name required)":" (user name and meeting ID required)":" (loading)";me(_,f&&T!=="Explore"&&et&&N&&!Mt,"Connect"+re,re||"Join session")},Ct=function(f){return async()=>{T=f,tt(),S.resolve()}},Lo=function(){if(_.addEventListener("click",ne),i(e)&&e.addEventListener("click",Ct("Student")),i(n)&&n.addEventListener("click",Ct("Instructor")),r.addEventListener("click",Ct("Explore")),Ce(v),Ce(m),v.value.length===0&&(v.value=localStorage.getItem(M)),Q){let I=/^(.+?) *\d+$/,R=v.value.match(I),B=R&&R[1]||"Test";v.value=`${B} ${_e()}`,m.value="TEST",Ct("Student")()}v.addEventListener("input",()=>tt()),m.addEventListener("input",()=>tt()),i(e)&&(e.disabled=!1),i(n)&&(n.disabled=!1);let w=new URL(location.href).searchParams.get("m");w&&(m.value=w.toUpperCase())},Ce=function(f){function w(){f.value=f.value.trim().replace(/\s+/g," ")}f.addEventListener("blur",w),f.addEventListener("keydown",I=>{I.key==="Enter"&&w()})},o=O("#selectUserTypeForm"),t=O("#loginForm"),e=wt("#studentButton"),n=wt("#instructorButton"),r=wt("#exploreButton"),s=O("#joinSessionMessage"),p=O("#studentMeetingIDHelpBlock"),a=O("#instructorMeetingIDHelpBlock"),c=O("#appContainer"),d=O("#heroImage"),l=lt("#scenarioID"),v=lt("#userName"),m=lt("#meetingID"),_=wt("#connectButton"),C=O("#iOSError"),nt=oo.match(/\d+\.(\d+)\.\d+/)[1],Q=Ye(),b=_e(),M="login:userName",S=new k,V=new k,P=new Jt(.5),h=/\/\d+\/?$/,G=new Bt,x=null,X=null,F=null,T=null,ft=Se,Te=ft,Mt=!1;D&&Object.assign(window,{setVersion:f=>Te=f}),P.addTickHandler(Po),J(c,!1),Lo(),tt(),Eo().catch(Z.error.bind(Z,"Login","loadEverything"));async function Eo(){ft=await Me(),P.start(),await wo(),await Tt.get(Co("three")).useCache(!D).module().then(Ft),THREE.REVISION!==nt&&console.warn(`After loading Three.js, version was ${THREE.REVISION}, but expected ${nt}`);let{default:f}=await Tt.get(Xe("environment")).useCache(!D).module().then(mt);x=new f({canvas:qe("#frontBuffer"),fetcher:Tt,dialogFontFamily:_t.fontFamily,getAppUrl:Xe,uiImagePaths:ko(),buttonFillColor:Vo,labelFillColor:yo,enableFullResolution:Ao,DEBUG:D,styleSheetPath:Mo("environment"),watchModelPath:"/models/watch1.glb"}),D?x.apps.cacheBustString=ft+"&DEBUG":x.apps.cacheBustString=ft,x.apps.addEventListener("apploaded",B=>{B.appName==="menu"?(F=B.app,F.addEventListener("select",async N=>{await x.withFade(async()=>{F.hide();let et=x.apps.app("yarrow");et.param("dataLogger",Z),et.param("scenarioID",N.scenarioID);let ht=kt(x.loadingBar,2);await(await et.load(ht.shift())).show(ht.shift())})}),F.addEventListener("lobby",async()=>{await x.withFade(async()=>{X&&X.quit(),await F.show(x.loadingBar)})})):B.appName==="yarrow"&&(X=B.app,X.addEventListener("shown",async()=>{P.stop();let N=new xt(location.href).pathPop(h).pathPush(X.scenarioID.toString()).toString();history.replaceState(null,null,N)}),X.addEventListener("quit",async()=>{P.start();let N=new xt(location.href).pathPop(h).toString();history.replaceState(null,null,N)}))}),tt();let[w,I,R]=St(x.loadingBar,[1,2,1]);await x.fadeOut(),await Lt(x.load(w),Oo(I),Bo(R)),Q&&ne()}async function Me(){return D||!navigator.onLine?Te:await Tt.get("/vr/version").text().then(mt)}async function Po(){try{await Me()!==ft&&location.reload()}catch{}}async function Oo(f){let w=parseFloat(l.value),I=Number.isInteger(w),R=kt(f,I?2:1),B=[Ro(R.shift())];I&&B.push(Do(w,R.shift())),await(await Promise.all(B)).pop().show(),await x.fadeIn()}async function Do(f,w){return await x.apps.app("yarrow").param("scenarioID",f).param("dataLogger",Z).load(w)}async function Ro(f){return await x.apps.app("menu").param("config",ke).load(f)}async function Bo(f){try{await S,x.devicesDialog.showWebcams=T!=="Explore",T==="Explore"?(ne(),f.end("skip")):(v.focus(),await(await x.apps.app("tele").param("nameTagFont",_t).param("hub",bo).param("dataLogger",Z).load(f)).show()),V.resolve()}catch(w){V.reject(w)}}async function ne(){let f=()=>Z.log("quitting");x.addEventListener("quitting",f),G.addEventListener("quitting",f),Mt=!0,tt(),await x.audio.ready,await V;let w=x.apps.isLoaded("tele");if(x.devicesDialog.showMicrophones||=w,(x.devicesDialog.showMicrophones||x.devicesDialog.showWebcams)&&(Q&&b!==1&&x.microphones.gain.setValueAtTime(0,0),await x.devicesDialog.showDialog()),J(d,!1),J(c,!0),w){let I=v.value,R=m.value.toLocaleUpperCase();localStorage.setItem(M,I);let B=new xt(location.href).query("m",R).toString();history.replaceState(null,null,B),await x.apps.get("tele").setConferenceInfo(T,I,R),Mt=!1,tt()}else Z.log("explore");eo()?x.screenControl.start(zt.VR):x.renderer.domElement.focus(),x.speech&&(x.speech.speakerCulture="en-US",(!Q||b===1)&&x.speech.start())}}catch(o){Z.error("Login","Top level",o)}
