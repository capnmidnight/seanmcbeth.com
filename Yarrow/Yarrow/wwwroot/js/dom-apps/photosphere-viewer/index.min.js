var wd=Object.create;var Tc=Object.defineProperty;var Fd=Object.getOwnPropertyDescriptor;var Ad=Object.getOwnPropertyNames;var _d=Object.getPrototypeOf,Sd=Object.prototype.hasOwnProperty;var Td=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var vd=(n,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ad(e))!Sd.call(n,r)&&r!==t&&Tc(n,r,{get:()=>e[r],enumerable:!(o=Fd(e,r))||o.enumerable});return n};var kd=(n,e,t)=>(t=n!=null?wd(_d(n)):{},vd(e||!n||!n.__esModule?Tc(t,"default",{value:n,enumerable:!0}):t,n));var Ou=Td((da,ha)=>{(function(n,e){typeof da=="object"&&typeof ha<"u"?ha.exports=e():typeof define=="function"&&define.amd?define(e):n.CardboardVRDisplay=e()})(da,function(){"use strict";var n=function(){function a(p){this.value=p}function c(p){var d,m;function f(v,F){return new Promise(function(S,b){var P={key:v,arg:F,resolve:S,reject:b,next:null};m?m=m.next=P:(d=m=P,w(v,F))})}function w(v,F){try{var S=p[v](F),b=S.value;b instanceof a?Promise.resolve(b.value).then(function(P){w("next",P)},function(P){w("throw",P)}):k(S.done?"return":"normal",S.value)}catch(P){k("throw",P)}}function k(v,F){switch(v){case"return":d.resolve({value:F,done:!0});break;case"throw":d.reject(F);break;default:d.resolve({value:F,done:!1});break}d=d.next,d?w(d.key,d.arg):m=null}this._invoke=f,typeof p.return!="function"&&(this.return=void 0)}return typeof Symbol=="function"&&Symbol.asyncIterator&&(c.prototype[Symbol.asyncIterator]=function(){return this}),c.prototype.next=function(p){return this._invoke("next",p)},c.prototype.throw=function(p){return this._invoke("throw",p)},c.prototype.return=function(p){return this._invoke("return",p)},{wrap:function(p){return function(){return new c(p.apply(this,arguments))}},await:function(p){return new a(p)}}}(),e=function(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")},t=function(){function a(c,p){for(var d=0;d<p.length;d++){var m=p[d];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(c,m.key,m)}}return function(c,p,d){return p&&a(c.prototype,p),d&&a(c,d),c}}(),o=function(){function a(c,p){var d=[],m=!0,f=!1,w=void 0;try{for(var k=c[Symbol.iterator](),v;!(m=(v=k.next()).done)&&(d.push(v.value),!(p&&d.length===p));m=!0);}catch(F){f=!0,w=F}finally{try{!m&&k.return&&k.return()}finally{if(f)throw w}}return d}return function(c,p){if(Array.isArray(c))return c;if(Symbol.iterator in Object(c))return a(c,p);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=.001,i=1,s=function(c,p){return"data:"+c+","+encodeURIComponent(p)},l=function(c,p,d){return c+(p-c)*d},u=function(){var a=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return a}}(),h=function(){var a=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return a}}(),x=function(){var a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return a}}(),g=function(){var a=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return a}}(),A=function(){var a=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),c=a?parseInt(a[1],10):null;return function(){return c}}(),_=function(){var a=!1;return a=u()&&x()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return a}}(),M=function(){var a=!1;if(A()===65){var c=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(c){var p=c[1].split("."),d=o(p,4),m=d[0],f=d[1],w=d[2],k=d[3];a=parseInt(w,10)===3325&&parseInt(k,10)<148}}return function(){return a}}(),B=function(){var a=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return a}}(),y=function(){var c=window.orientation==90||window.orientation==-90;return B()?!c:c},V=function(c){return!(isNaN(c)||c<=r||c>i)},I=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},L=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},D=function(c){if(h())return!1;if(c.requestFullscreen)c.requestFullscreen();else if(c.webkitRequestFullscreen)c.webkitRequestFullscreen();else if(c.mozRequestFullScreen)c.mozRequestFullScreen();else if(c.msRequestFullscreen)c.msRequestFullscreen();else return!1;return!0},O=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},C=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},R=function(c,p,d,m){var f=c.createShader(c.VERTEX_SHADER);c.shaderSource(f,p),c.compileShader(f);var w=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(w,d),c.compileShader(w);var k=c.createProgram();c.attachShader(k,f),c.attachShader(k,w);for(var v in m)c.bindAttribLocation(k,m[v],v);return c.linkProgram(k),c.deleteShader(f),c.deleteShader(w),k},j=function(c,p){for(var d={},m=c.getProgramParameter(p,c.ACTIVE_UNIFORMS),f="",w=0;w<m;w++){var k=c.getActiveUniform(p,w);f=k.name.replace("[0]",""),d[f]=c.getUniformLocation(p,f)}return d},ie=function(c,p,d,m,f,w,k){var v=1/(p-d),F=1/(m-f),S=1/(w-k);return c[0]=-2*v,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*F,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*S,c[11]=0,c[12]=(p+d)*v,c[13]=(f+m)*F,c[14]=(k+w)*S,c[15]=1,c},Q=function(){var c=!1;return function(p){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(p)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(p.substr(0,4)))&&(c=!0)}(navigator.userAgent||navigator.vendor||window.opera),c},Y=function(c,p){for(var d in p)p.hasOwnProperty(d)&&(c[d]=p[d]);return c},le=function(c){if(u()){var p=c.style.width,d=c.style.height;c.style.width=parseInt(p)+1+"px",c.style.height=parseInt(d)+"px",setTimeout(function(){c.style.width=p,c.style.height=d},100)}window.canvas=c},Ee=function(){var a=Math.PI/180,c=Math.PI*.25;function p(F,S,b,P){var H=Math.tan(S?S.upDegrees*a:c),G=Math.tan(S?S.downDegrees*a:c),z=Math.tan(S?S.leftDegrees*a:c),U=Math.tan(S?S.rightDegrees*a:c),X=2/(z+U),re=2/(H+G);return F[0]=X,F[1]=0,F[2]=0,F[3]=0,F[4]=0,F[5]=re,F[6]=0,F[7]=0,F[8]=-((z-U)*X*.5),F[9]=(H-G)*re*.5,F[10]=P/(b-P),F[11]=-1,F[12]=0,F[13]=0,F[14]=P*b/(b-P),F[15]=0,F}function d(F,S,b){var P=S[0],H=S[1],G=S[2],z=S[3],U=P+P,X=H+H,re=G+G,ge=P*U,be=P*X,pe=P*re,Le=H*X,je=H*re,qe=G*re,Qe=z*U,Ke=z*X,Rt=z*re;return F[0]=1-(Le+qe),F[1]=be+Rt,F[2]=pe-Ke,F[3]=0,F[4]=be-Rt,F[5]=1-(ge+qe),F[6]=je+Qe,F[7]=0,F[8]=pe+Ke,F[9]=je-Qe,F[10]=1-(ge+Le),F[11]=0,F[12]=b[0],F[13]=b[1],F[14]=b[2],F[15]=1,F}function m(F,S,b){var P=b[0],H=b[1],G=b[2],z,U,X,re,ge,be,pe,Le,je,qe,Qe,Ke;return S===F?(F[12]=S[0]*P+S[4]*H+S[8]*G+S[12],F[13]=S[1]*P+S[5]*H+S[9]*G+S[13],F[14]=S[2]*P+S[6]*H+S[10]*G+S[14],F[15]=S[3]*P+S[7]*H+S[11]*G+S[15]):(z=S[0],U=S[1],X=S[2],re=S[3],ge=S[4],be=S[5],pe=S[6],Le=S[7],je=S[8],qe=S[9],Qe=S[10],Ke=S[11],F[0]=z,F[1]=U,F[2]=X,F[3]=re,F[4]=ge,F[5]=be,F[6]=pe,F[7]=Le,F[8]=je,F[9]=qe,F[10]=Qe,F[11]=Ke,F[12]=z*P+ge*H+je*G+S[12],F[13]=U*P+be*H+qe*G+S[13],F[14]=X*P+pe*H+Qe*G+S[14],F[15]=re*P+Le*H+Ke*G+S[15]),F}function f(F,S){var b=S[0],P=S[1],H=S[2],G=S[3],z=S[4],U=S[5],X=S[6],re=S[7],ge=S[8],be=S[9],pe=S[10],Le=S[11],je=S[12],qe=S[13],Qe=S[14],Ke=S[15],Rt=b*U-P*z,no=b*X-H*z,oo=b*re-G*z,ro=P*X-H*U,io=P*re-G*U,so=H*re-G*X,ao=ge*qe-be*je,co=ge*Qe-pe*je,lo=ge*Ke-Le*je,uo=be*Qe-pe*qe,po=be*Ke-Le*qe,ho=pe*Ke-Le*Qe,Te=Rt*ho-no*po+oo*uo+ro*lo-io*co+so*ao;return Te?(Te=1/Te,F[0]=(U*ho-X*po+re*uo)*Te,F[1]=(H*po-P*ho-G*uo)*Te,F[2]=(qe*so-Qe*io+Ke*ro)*Te,F[3]=(pe*io-be*so-Le*ro)*Te,F[4]=(X*lo-z*ho-re*co)*Te,F[5]=(b*ho-H*lo+G*co)*Te,F[6]=(Qe*oo-je*so-Ke*no)*Te,F[7]=(ge*so-pe*oo+Le*no)*Te,F[8]=(z*po-U*lo+re*ao)*Te,F[9]=(P*lo-b*po-G*ao)*Te,F[10]=(je*io-qe*oo+Ke*Rt)*Te,F[11]=(be*oo-ge*io-Le*Rt)*Te,F[12]=(U*co-z*uo-X*ao)*Te,F[13]=(b*uo-P*co+H*ao)*Te,F[14]=(qe*no-je*ro-Qe*Rt)*Te,F[15]=(ge*ro-be*no+pe*Rt)*Te,F):null}var w=new Float32Array([0,0,0,1]),k=new Float32Array([0,0,0]);function v(F,S,b,P,H,G){p(F,P||null,G.depthNear,G.depthFar);var z=b.orientation||w,U=b.position||k;d(S,z,U),H&&m(S,S,H),f(S,S)}return function(F,S,b){return!F||!S?!1:(F.pose=S,F.timestamp=S.timestamp,v(F.leftProjectionMatrix,F.leftViewMatrix,S,b._getFieldOfView("left"),b._getEyeOffset("left"),b),v(F.rightProjectionMatrix,F.rightViewMatrix,S,b._getFieldOfView("right"),b._getEyeOffset("right"),b),!0)}}(),oe=function(){var c=window.self!==window.top,p=ut(document.referrer),d=ut(window.location.href);return c&&p!==d},ut=function(c){var p,d=c.indexOf("://");d!==-1?p=d+3:p=0;var m=c.indexOf("/",p);return m===-1&&(m=c.length),c.substring(0,m)},dr=function(c){if(c.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var p=2*Math.acos(c.w);return p},Zn=function(){var a={};return function(c,p){a[c]===void 0&&(console.warn("webvr-polyfill: "+p),a[c]=!0)}}(),Tt=function(c,p){var d=p?"Please use "+p+" instead.":"";Zn(c,c+" has been deprecated. This may not work on native WebVR displays. "+d)};function Hp(a,c,p){if(!c){p(a);return}for(var d=[],m=null,f=0;f<c.length;++f){var w=c[f];switch(w){case a.TEXTURE_BINDING_2D:case a.TEXTURE_BINDING_CUBE_MAP:var k=c[++f];if(k<a.TEXTURE0||k>a.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),d.push(null,null);break}m||(m=a.getParameter(a.ACTIVE_TEXTURE)),a.activeTexture(k),d.push(a.getParameter(w),null);break;case a.ACTIVE_TEXTURE:m=a.getParameter(a.ACTIVE_TEXTURE),d.push(null);break;default:d.push(a.getParameter(w));break}}p(a);for(var f=0;f<c.length;++f){var w=c[f],v=d[f];switch(w){case a.ACTIVE_TEXTURE:break;case a.ARRAY_BUFFER_BINDING:a.bindBuffer(a.ARRAY_BUFFER,v);break;case a.COLOR_CLEAR_VALUE:a.clearColor(v[0],v[1],v[2],v[3]);break;case a.COLOR_WRITEMASK:a.colorMask(v[0],v[1],v[2],v[3]);break;case a.CURRENT_PROGRAM:a.useProgram(v);break;case a.ELEMENT_ARRAY_BUFFER_BINDING:a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,v);break;case a.FRAMEBUFFER_BINDING:a.bindFramebuffer(a.FRAMEBUFFER,v);break;case a.RENDERBUFFER_BINDING:a.bindRenderbuffer(a.RENDERBUFFER,v);break;case a.TEXTURE_BINDING_2D:var k=c[++f];if(k<a.TEXTURE0||k>a.TEXTURE31)break;a.activeTexture(k),a.bindTexture(a.TEXTURE_2D,v);break;case a.TEXTURE_BINDING_CUBE_MAP:var k=c[++f];if(k<a.TEXTURE0||k>a.TEXTURE31)break;a.activeTexture(k),a.bindTexture(a.TEXTURE_CUBE_MAP,v);break;case a.VIEWPORT:a.viewport(v[0],v[1],v[2],v[3]);break;case a.BLEND:case a.CULL_FACE:case a.DEPTH_TEST:case a.SCISSOR_TEST:case a.STENCIL_TEST:v?a.enable(w):a.disable(w);break;default:console.log("No GL restore behavior for 0x"+w.toString(16));break}m&&a.activeTexture(m)}}var $n=Hp,Np=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),Gp=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function pt(a,c,p,d){this.gl=a,this.cardboardUI=c,this.bufferScale=p,this.dirtySubmitFrameBindings=d,this.ctxAttribs=a.getContextAttributes(),this.instanceExt=a.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=a.drawingBufferWidth,this.bufferHeight=a.drawingBufferHeight,this.realBindFramebuffer=a.bindFramebuffer,this.realEnable=a.enable,this.realDisable=a.disable,this.realColorMask=a.colorMask,this.realClearColor=a.clearColor,this.realViewport=a.viewport,u()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(a.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(a.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=R(a,Np,Gp,this.attribs),this.uniforms=j(a,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.indexCount=0,this.renderTarget=a.createTexture(),this.framebuffer=a.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=a.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=a.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=a.createRenderbuffer()),this.patch(),this.onResize()}pt.prototype.destroy=function(){var a=this.gl;this.unpatch(),a.deleteProgram(this.program),a.deleteBuffer(this.vertexBuffer),a.deleteBuffer(this.indexBuffer),a.deleteTexture(this.renderTarget),a.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&a.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&a.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&a.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},pt.prototype.onResize=function(){var a=this.gl,c=this,p=[a.RENDERBUFFER_BINDING,a.TEXTURE_BINDING_2D,a.TEXTURE0];$n(a,p,function(d){c.realBindFramebuffer.call(d,d.FRAMEBUFFER,null),c.scissorTest&&c.realDisable.call(d,d.SCISSOR_TEST),c.realColorMask.call(d,!0,!0,!0,!0),c.realViewport.call(d,0,0,d.drawingBufferWidth,d.drawingBufferHeight),c.realClearColor.call(d,0,0,0,1),d.clear(d.COLOR_BUFFER_BIT),c.realBindFramebuffer.call(d,d.FRAMEBUFFER,c.framebuffer),d.bindTexture(d.TEXTURE_2D,c.renderTarget),d.texImage2D(d.TEXTURE_2D,0,c.ctxAttribs.alpha?d.RGBA:d.RGB,c.bufferWidth,c.bufferHeight,0,c.ctxAttribs.alpha?d.RGBA:d.RGB,d.UNSIGNED_BYTE,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c.renderTarget,0),c.ctxAttribs.depth&&c.ctxAttribs.stencil?(d.bindRenderbuffer(d.RENDERBUFFER,c.depthStencilBuffer),d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_STENCIL,c.bufferWidth,c.bufferHeight),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,c.depthStencilBuffer)):c.ctxAttribs.depth?(d.bindRenderbuffer(d.RENDERBUFFER,c.depthBuffer),d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_COMPONENT16,c.bufferWidth,c.bufferHeight),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c.depthBuffer)):c.ctxAttribs.stencil&&(d.bindRenderbuffer(d.RENDERBUFFER,c.stencilBuffer),d.renderbufferStorage(d.RENDERBUFFER,d.STENCIL_INDEX8,c.bufferWidth,c.bufferHeight),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.STENCIL_ATTACHMENT,d.RENDERBUFFER,c.stencilBuffer)),!d.checkFramebufferStatus(d.FRAMEBUFFER)===d.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),c.realBindFramebuffer.call(d,d.FRAMEBUFFER,c.lastBoundFramebuffer),c.scissorTest&&c.realEnable.call(d,d.SCISSOR_TEST),c.realColorMask.apply(d,c.colorMask),c.realViewport.apply(d,c.viewport),c.realClearColor.apply(d,c.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},pt.prototype.patch=function(){if(!this.isPatched){var a=this,c=this.gl.canvas,p=this.gl;u()||(c.width=I()*this.bufferScale,c.height=L()*this.bufferScale,Object.defineProperty(c,"width",{configurable:!0,enumerable:!0,get:function(){return a.bufferWidth},set:function(m){a.bufferWidth=m,a.realCanvasWidth.set.call(c,m),a.onResize()}}),Object.defineProperty(c,"height",{configurable:!0,enumerable:!0,get:function(){return a.bufferHeight},set:function(m){a.bufferHeight=m,a.realCanvasHeight.set.call(c,m),a.onResize()}})),this.lastBoundFramebuffer=p.getParameter(p.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(p.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(d,m){a.lastBoundFramebuffer=m||a.framebuffer,a.realBindFramebuffer.call(p,d,a.lastBoundFramebuffer)},this.cullFace=p.getParameter(p.CULL_FACE),this.depthTest=p.getParameter(p.DEPTH_TEST),this.blend=p.getParameter(p.BLEND),this.scissorTest=p.getParameter(p.SCISSOR_TEST),this.stencilTest=p.getParameter(p.STENCIL_TEST),p.enable=function(d){switch(d){case p.CULL_FACE:a.cullFace=!0;break;case p.DEPTH_TEST:a.depthTest=!0;break;case p.BLEND:a.blend=!0;break;case p.SCISSOR_TEST:a.scissorTest=!0;break;case p.STENCIL_TEST:a.stencilTest=!0;break}a.realEnable.call(p,d)},p.disable=function(d){switch(d){case p.CULL_FACE:a.cullFace=!1;break;case p.DEPTH_TEST:a.depthTest=!1;break;case p.BLEND:a.blend=!1;break;case p.SCISSOR_TEST:a.scissorTest=!1;break;case p.STENCIL_TEST:a.stencilTest=!1;break}a.realDisable.call(p,d)},this.colorMask=p.getParameter(p.COLOR_WRITEMASK),p.colorMask=function(d,m,f,w){a.colorMask[0]=d,a.colorMask[1]=m,a.colorMask[2]=f,a.colorMask[3]=w,a.realColorMask.call(p,d,m,f,w)},this.clearColor=p.getParameter(p.COLOR_CLEAR_VALUE),p.clearColor=function(d,m,f,w){a.clearColor[0]=d,a.clearColor[1]=m,a.clearColor[2]=f,a.clearColor[3]=w,a.realClearColor.call(p,d,m,f,w)},this.viewport=p.getParameter(p.VIEWPORT),p.viewport=function(d,m,f,w){a.viewport[0]=d,a.viewport[1]=m,a.viewport[2]=f,a.viewport[3]=w,a.realViewport.call(p,d,m,f,w)},this.isPatched=!0,le(c)}},pt.prototype.unpatch=function(){if(this.isPatched){var a=this.gl,c=this.gl.canvas;u()||(Object.defineProperty(c,"width",this.realCanvasWidth),Object.defineProperty(c,"height",this.realCanvasHeight)),c.width=this.bufferWidth,c.height=this.bufferHeight,a.bindFramebuffer=this.realBindFramebuffer,a.enable=this.realEnable,a.disable=this.realDisable,a.colorMask=this.realColorMask,a.clearColor=this.realClearColor,a.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&a.bindFramebuffer(a.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){le(c)},1)}},pt.prototype.setTextureBounds=function(a,c){a||(a=[0,0,.5,1]),c||(c=[.5,0,.5,1]),this.viewportOffsetScale[0]=a[0],this.viewportOffsetScale[1]=a[1],this.viewportOffsetScale[2]=a[2],this.viewportOffsetScale[3]=a[3],this.viewportOffsetScale[4]=c[0],this.viewportOffsetScale[5]=c[1],this.viewportOffsetScale[6]=c[2],this.viewportOffsetScale[7]=c[3]},pt.prototype.submitFrame=function(){var a=this.gl,c=this,p=[];if(this.dirtySubmitFrameBindings||p.push(a.CURRENT_PROGRAM,a.ARRAY_BUFFER_BINDING,a.ELEMENT_ARRAY_BUFFER_BINDING,a.TEXTURE_BINDING_2D,a.TEXTURE0),$n(a,p,function(m){c.realBindFramebuffer.call(m,m.FRAMEBUFFER,null);var f=0,w=0;c.instanceExt&&(f=m.getVertexAttrib(c.attribs.position,c.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),w=m.getVertexAttrib(c.attribs.texCoord,c.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),c.cullFace&&c.realDisable.call(m,m.CULL_FACE),c.depthTest&&c.realDisable.call(m,m.DEPTH_TEST),c.blend&&c.realDisable.call(m,m.BLEND),c.scissorTest&&c.realDisable.call(m,m.SCISSOR_TEST),c.stencilTest&&c.realDisable.call(m,m.STENCIL_TEST),c.realColorMask.call(m,!0,!0,!0,!0),c.realViewport.call(m,0,0,m.drawingBufferWidth,m.drawingBufferHeight),(c.ctxAttribs.alpha||u())&&(c.realClearColor.call(m,0,0,0,1),m.clear(m.COLOR_BUFFER_BIT)),m.useProgram(c.program),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,c.indexBuffer),m.bindBuffer(m.ARRAY_BUFFER,c.vertexBuffer),m.enableVertexAttribArray(c.attribs.position),m.enableVertexAttribArray(c.attribs.texCoord),m.vertexAttribPointer(c.attribs.position,2,m.FLOAT,!1,20,0),m.vertexAttribPointer(c.attribs.texCoord,3,m.FLOAT,!1,20,8),c.instanceExt&&(f!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.position,0),w!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.texCoord,0)),m.activeTexture(m.TEXTURE0),m.uniform1i(c.uniforms.diffuse,0),m.bindTexture(m.TEXTURE_2D,c.renderTarget),m.uniform4fv(c.uniforms.viewportOffsetScale,c.viewportOffsetScale),m.drawElements(m.TRIANGLES,c.indexCount,m.UNSIGNED_SHORT,0),c.cardboardUI&&c.cardboardUI.renderNoState(),c.realBindFramebuffer.call(c.gl,m.FRAMEBUFFER,c.framebuffer),c.ctxAttribs.preserveDrawingBuffer||(c.realClearColor.call(m,0,0,0,0),m.clear(m.COLOR_BUFFER_BIT)),c.dirtySubmitFrameBindings||c.realBindFramebuffer.call(m,m.FRAMEBUFFER,c.lastBoundFramebuffer),c.cullFace&&c.realEnable.call(m,m.CULL_FACE),c.depthTest&&c.realEnable.call(m,m.DEPTH_TEST),c.blend&&c.realEnable.call(m,m.BLEND),c.scissorTest&&c.realEnable.call(m,m.SCISSOR_TEST),c.stencilTest&&c.realEnable.call(m,m.STENCIL_TEST),c.realColorMask.apply(m,c.colorMask),c.realViewport.apply(m,c.viewport),(c.ctxAttribs.alpha||!c.ctxAttribs.preserveDrawingBuffer)&&c.realClearColor.apply(m,c.clearColor),c.instanceExt&&(f!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.position,f),w!=0&&c.instanceExt.vertexAttribDivisorANGLE(c.attribs.texCoord,w))}),u()){var d=a.canvas;(d.width!=c.bufferWidth||d.height!=c.bufferHeight)&&(c.bufferWidth=d.width,c.bufferHeight=d.height,c.onResize())}},pt.prototype.updateDeviceInfo=function(a){var c=this.gl,p=this,d=[c.ARRAY_BUFFER_BINDING,c.ELEMENT_ARRAY_BUFFER_BINDING];$n(c,d,function(m){var f=p.computeMeshVertices_(p.meshWidth,p.meshHeight,a);if(m.bindBuffer(m.ARRAY_BUFFER,p.vertexBuffer),m.bufferData(m.ARRAY_BUFFER,f,m.STATIC_DRAW),!p.indexCount){var w=p.computeMeshIndices_(p.meshWidth,p.meshHeight);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,p.indexBuffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,w,m.STATIC_DRAW),p.indexCount=w.length}})},pt.prototype.computeMeshVertices_=function(a,c,p){for(var d=new Float32Array(2*a*c*5),m=p.getLeftEyeVisibleTanAngles(),f=p.getLeftEyeNoLensTanAngles(),w=p.getLeftEyeVisibleScreenRect(f),k=0,v=0;v<2;v++){for(var F=0;F<c;F++)for(var S=0;S<a;S++,k++){var b=S/(a-1),P=F/(c-1),H=b,G=P,z=l(m[0],m[2],b),U=l(m[3],m[1],P),X=Math.sqrt(z*z+U*U),re=p.distortion.distortInverse(X),ge=z*re/X,be=U*re/X;b=(ge-f[0])/(f[2]-f[0]),P=(be-f[3])/(f[1]-f[3]),b=(w.x+b*w.width-.5)*2,P=(w.y+P*w.height-.5)*2,d[k*5+0]=b,d[k*5+1]=P,d[k*5+2]=H,d[k*5+3]=G,d[k*5+4]=v}var pe=m[2]-m[0];m[0]=-(pe+m[0]),m[2]=pe-m[2],pe=f[2]-f[0],f[0]=-(pe+f[0]),f[2]=pe-f[2],w.x=1-(w.x+w.width)}return d},pt.prototype.computeMeshIndices_=function(a,c){for(var p=new Uint16Array(2*(a-1)*(c-1)*6),d=a/2,m=c/2,f=0,w=0,k=0;k<2;k++)for(var v=0;v<c;v++)for(var F=0;F<a;F++,f++)F==0||v==0||(F<=d==v<=m?(p[w++]=f,p[w++]=f-a-1,p[w++]=f-a,p[w++]=f-a-1,p[w++]=f,p[w++]=f-1):(p[w++]=f-1,p[w++]=f-a,p[w++]=f,p[w++]=f-a,p[w++]=f-1,p[w++]=f-a-1));return p},pt.prototype.getOwnPropertyDescriptor_=function(a,c){var p=Object.getOwnPropertyDescriptor(a,c);return(p.get===void 0||p.set===void 0)&&(p.configurable=!0,p.enumerable=!0,p.get=function(){return this.getAttribute(c)},p.set=function(d){this.setAttribute(c,d)}),p};var Xp=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),Up=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),xc=Math.PI/180,Yi=60,fc=12,gc=20,Zi=1,wc=.75,Fc=.3125,zp=4,$t=28,$i=1.5;function en(a){this.gl=a,this.attribs={position:0},this.program=R(a,Xp,Up,this.attribs),this.uniforms=j(a,this.program),this.vertexBuffer=a.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}en.prototype.destroy=function(){var a=this.gl;this.listener&&a.canvas.removeEventListener("click",this.listener,!1),a.deleteProgram(this.program),a.deleteBuffer(this.vertexBuffer)},en.prototype.listen=function(a,c){var p=this.gl.canvas;this.listener=function(d){var m=p.clientWidth/2,f=$t*$i;d.clientX>m-f&&d.clientX<m+f&&d.clientY>p.clientHeight-f?a(d):d.clientX<f&&d.clientY<f&&c(d)},p.addEventListener("click",this.listener,!1)},en.prototype.onResize=function(){var a=this.gl,c=this,p=[a.ARRAY_BUFFER_BINDING];$n(a,p,function(d){var m=[],f=d.drawingBufferWidth/2,w=Math.max(screen.width,screen.height)*window.devicePixelRatio,k=d.drawingBufferWidth/w,v=k*window.devicePixelRatio,F=zp*v/2,S=$t*$i*v,b=$t*v/2,P=($t*$i-$t)*v;m.push(f-F,S),m.push(f-F,d.drawingBufferHeight),m.push(f+F,S),m.push(f+F,d.drawingBufferHeight),c.gearOffset=m.length/2;function H(re,ge){var be=(90-re)*xc,pe=Math.cos(be),Le=Math.sin(be);m.push(Fc*pe*b+f,Fc*Le*b+b),m.push(ge*pe*b+f,ge*Le*b+b)}for(var G=0;G<=6;G++){var z=G*Yi;H(z,Zi),H(z+fc,Zi),H(z+gc,wc),H(z+(Yi-gc),wc),H(z+(Yi-fc),Zi)}c.gearVertexCount=m.length/2-c.gearOffset,c.arrowOffset=m.length/2;function U(re,ge){m.push(P+re,d.drawingBufferHeight-P-ge)}var X=F/Math.sin(45*xc);U(0,b),U(b,0),U(b+X,X),U(X,b+X),U(X,b-X),U(0,b),U(b,b*2),U(b+X,b*2-X),U(X,b-X),U(0,b),U(X,b-F),U($t*v,b-F),U(X,b+F),U($t*v,b+F),c.arrowVertexCount=m.length/2-c.arrowOffset,d.bindBuffer(d.ARRAY_BUFFER,c.vertexBuffer),d.bufferData(d.ARRAY_BUFFER,new Float32Array(m),d.STATIC_DRAW)})},en.prototype.render=function(){var a=this.gl,c=this,p=[a.CULL_FACE,a.DEPTH_TEST,a.BLEND,a.SCISSOR_TEST,a.STENCIL_TEST,a.COLOR_WRITEMASK,a.VIEWPORT,a.CURRENT_PROGRAM,a.ARRAY_BUFFER_BINDING];$n(a,p,function(d){d.disable(d.CULL_FACE),d.disable(d.DEPTH_TEST),d.disable(d.BLEND),d.disable(d.SCISSOR_TEST),d.disable(d.STENCIL_TEST),d.colorMask(!0,!0,!0,!0),d.viewport(0,0,d.drawingBufferWidth,d.drawingBufferHeight),c.renderNoState()})},en.prototype.renderNoState=function(){var a=this.gl;a.useProgram(this.program),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.enableVertexAttribArray(this.attribs.position),a.vertexAttribPointer(this.attribs.position,2,a.FLOAT,!1,8,0),a.uniform4f(this.uniforms.color,1,1,1,1),ie(this.projMat,0,a.drawingBufferWidth,0,a.drawingBufferHeight,.1,1024),a.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),a.drawArrays(a.TRIANGLE_STRIP,0,4),a.drawArrays(a.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),a.drawArrays(a.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function hr(a){this.coefficients=a}hr.prototype.distortInverse=function(a){for(var c=0,p=1,d=a-this.distort(c);Math.abs(p-c)>1e-4;){var m=a-this.distort(p),f=p-m*((p-c)/(m-d));c=p,p=f,d=m}return p},hr.prototype.distort=function(a){for(var c=a*a,p=0,d=0;d<this.coefficients.length;d++)p=c*(p+this.coefficients[d]);return(p+1)*a};var mt=Math.PI/180,xt=180/Math.PI,ue=function(c,p,d){this.x=c||0,this.y=p||0,this.z=d||0};ue.prototype={constructor:ue,set:function(c,p,d){return this.x=c,this.y=p,this.z=d,this},copy:function(c){return this.x=c.x,this.y=c.y,this.z=c.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var c=this.length();if(c!==0){var p=1/c;this.multiplyScalar(p)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(c){this.x*=c,this.y*=c,this.z*=c},applyQuaternion:function(c){var p=this.x,d=this.y,m=this.z,f=c.x,w=c.y,k=c.z,v=c.w,F=v*p+w*m-k*d,S=v*d+k*p-f*m,b=v*m+f*d-w*p,P=-f*p-w*d-k*m;return this.x=F*v+P*-f+S*-k-b*-w,this.y=S*v+P*-w+b*-f-F*-k,this.z=b*v+P*-k+F*-w-S*-f,this},dot:function(c){return this.x*c.x+this.y*c.y+this.z*c.z},crossVectors:function(c,p){var d=c.x,m=c.y,f=c.z,w=p.x,k=p.y,v=p.z;return this.x=m*v-f*k,this.y=f*w-d*v,this.z=d*k-m*w,this}};var Z=function(c,p,d,m){this.x=c||0,this.y=p||0,this.z=d||0,this.w=m!==void 0?m:1};Z.prototype={constructor:Z,set:function(c,p,d,m){return this.x=c,this.y=p,this.z=d,this.w=m,this},copy:function(c){return this.x=c.x,this.y=c.y,this.z=c.z,this.w=c.w,this},setFromEulerXYZ:function(c,p,d){var m=Math.cos(c/2),f=Math.cos(p/2),w=Math.cos(d/2),k=Math.sin(c/2),v=Math.sin(p/2),F=Math.sin(d/2);return this.x=k*f*w+m*v*F,this.y=m*v*w-k*f*F,this.z=m*f*F+k*v*w,this.w=m*f*w-k*v*F,this},setFromEulerYXZ:function(c,p,d){var m=Math.cos(c/2),f=Math.cos(p/2),w=Math.cos(d/2),k=Math.sin(c/2),v=Math.sin(p/2),F=Math.sin(d/2);return this.x=k*f*w+m*v*F,this.y=m*v*w-k*f*F,this.z=m*f*F-k*v*w,this.w=m*f*w+k*v*F,this},setFromAxisAngle:function(c,p){var d=p/2,m=Math.sin(d);return this.x=c.x*m,this.y=c.y*m,this.z=c.z*m,this.w=Math.cos(d),this},multiply:function(c){return this.multiplyQuaternions(this,c)},multiplyQuaternions:function(c,p){var d=c.x,m=c.y,f=c.z,w=c.w,k=p.x,v=p.y,F=p.z,S=p.w;return this.x=d*S+w*k+m*F-f*v,this.y=m*S+w*v+f*k-d*F,this.z=f*S+w*F+d*v-m*k,this.w=w*S-d*k-m*v-f*F,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var c=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return c===0?(this.x=0,this.y=0,this.z=0,this.w=1):(c=1/c,this.x=this.x*c,this.y=this.y*c,this.z=this.z*c,this.w=this.w*c),this},slerp:function(c,p){if(p===0)return this;if(p===1)return this.copy(c);var d=this.x,m=this.y,f=this.z,w=this.w,k=w*c.w+d*c.x+m*c.y+f*c.z;if(k<0?(this.w=-c.w,this.x=-c.x,this.y=-c.y,this.z=-c.z,k=-k):this.copy(c),k>=1)return this.w=w,this.x=d,this.y=m,this.z=f,this;var v=Math.acos(k),F=Math.sqrt(1-k*k);if(Math.abs(F)<.001)return this.w=.5*(w+this.w),this.x=.5*(d+this.x),this.y=.5*(m+this.y),this.z=.5*(f+this.z),this;var S=Math.sin((1-p)*v)/F,b=Math.sin(p*v)/F;return this.w=w*S+this.w*b,this.x=d*S+this.x*b,this.y=m*S+this.y*b,this.z=f*S+this.z*b,this},setFromUnitVectors:function(){var a,c,p=1e-6;return function(d,m){return a===void 0&&(a=new ue),c=d.dot(m)+1,c<p?(c=0,Math.abs(d.x)>Math.abs(d.z)?a.set(-d.y,d.x,0):a.set(0,-d.z,d.y)):a.crossVectors(d,m),this.x=a.x,this.y=a.y,this.z=a.z,this.w=c,this.normalize(),this}}()};function es(a){this.width=a.width||I(),this.height=a.height||L(),this.widthMeters=a.widthMeters,this.heightMeters=a.heightMeters,this.bevelMeters=a.bevelMeters}var jp=new es({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),qp=new es({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),ts={CardboardV1:new ns({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new ns({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function _e(a,c){this.viewer=ts.CardboardV2,this.updateDeviceParams(a),this.distortion=new hr(this.viewer.distortionCoefficients);for(var p=0;p<c.length;p++){var d=c[p];ts[d.id]=new ns(d)}}_e.prototype.updateDeviceParams=function(a){this.device=this.determineDevice_(a)||this.device},_e.prototype.getDevice=function(){return this.device},_e.prototype.setViewer=function(a){this.viewer=a,this.distortion=new hr(this.viewer.distortionCoefficients)},_e.prototype.determineDevice_=function(a){if(!a)return u()?(console.warn("Using fallback iOS device measurements."),qp):(console.warn("Using fallback Android device measurements."),jp);var c=.0254,p=c/a.xdpi,d=c/a.ydpi,m=I(),f=L();return new es({widthMeters:p*m,heightMeters:d*f,bevelMeters:a.bevelMm*.001})},_e.prototype.getDistortedFieldOfViewLeftEye=function(){var a=this.viewer,c=this.device,p=this.distortion,d=a.screenLensDistance,m=(c.widthMeters-a.interLensDistance)/2,f=a.interLensDistance/2,w=a.baselineLensDistance-c.bevelMeters,k=c.heightMeters-w,v=xt*Math.atan(p.distort(m/d)),F=xt*Math.atan(p.distort(f/d)),S=xt*Math.atan(p.distort(w/d)),b=xt*Math.atan(p.distort(k/d));return{leftDegrees:Math.min(v,a.fov),rightDegrees:Math.min(F,a.fov),downDegrees:Math.min(S,a.fov),upDegrees:Math.min(b,a.fov)}},_e.prototype.getLeftEyeVisibleTanAngles=function(){var a=this.viewer,c=this.device,p=this.distortion,d=Math.tan(-mt*a.fov),m=Math.tan(mt*a.fov),f=Math.tan(mt*a.fov),w=Math.tan(-mt*a.fov),k=c.widthMeters/4,v=c.heightMeters/2,F=a.baselineLensDistance-c.bevelMeters-v,S=a.interLensDistance/2-k,b=-F,P=a.screenLensDistance,H=p.distort((S-k)/P),G=p.distort((b+v)/P),z=p.distort((S+k)/P),U=p.distort((b-v)/P),X=new Float32Array(4);return X[0]=Math.max(d,H),X[1]=Math.min(m,G),X[2]=Math.min(f,z),X[3]=Math.max(w,U),X},_e.prototype.getLeftEyeNoLensTanAngles=function(){var a=this.viewer,c=this.device,p=this.distortion,d=new Float32Array(4),m=p.distortInverse(Math.tan(-mt*a.fov)),f=p.distortInverse(Math.tan(mt*a.fov)),w=p.distortInverse(Math.tan(mt*a.fov)),k=p.distortInverse(Math.tan(-mt*a.fov)),v=c.widthMeters/4,F=c.heightMeters/2,S=a.baselineLensDistance-c.bevelMeters-F,b=a.interLensDistance/2-v,P=-S,H=a.screenLensDistance,G=(b-v)/H,z=(P+F)/H,U=(b+v)/H,X=(P-F)/H;return d[0]=Math.max(m,G),d[1]=Math.min(f,z),d[2]=Math.min(w,U),d[3]=Math.max(k,X),d},_e.prototype.getLeftEyeVisibleScreenRect=function(a){var c=this.viewer,p=this.device,d=c.screenLensDistance,m=(p.widthMeters-c.interLensDistance)/2,f=c.baselineLensDistance-p.bevelMeters,w=(a[0]*d+m)/p.widthMeters,k=(a[1]*d+f)/p.heightMeters,v=(a[2]*d+m)/p.widthMeters,F=(a[3]*d+f)/p.heightMeters;return{x:w,y:F,width:v-w,height:k-F}},_e.prototype.getFieldOfViewLeftEye=function(a){return a?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},_e.prototype.getFieldOfViewRightEye=function(a){var c=this.getFieldOfViewLeftEye(a);return{leftDegrees:c.rightDegrees,rightDegrees:c.leftDegrees,upDegrees:c.upDegrees,downDegrees:c.downDegrees}},_e.prototype.getUndistortedFieldOfViewLeftEye=function(){var a=this.getUndistortedParams_();return{leftDegrees:xt*Math.atan(a.outerDist),rightDegrees:xt*Math.atan(a.innerDist),downDegrees:xt*Math.atan(a.bottomDist),upDegrees:xt*Math.atan(a.topDist)}},_e.prototype.getUndistortedViewportLeftEye=function(){var a=this.getUndistortedParams_(),c=this.viewer,p=this.device,d=c.screenLensDistance,m=p.widthMeters/d,f=p.heightMeters/d,w=p.width/m,k=p.height/f,v=Math.round((a.eyePosX-a.outerDist)*w),F=Math.round((a.eyePosY-a.bottomDist)*k);return{x:v,y:F,width:Math.round((a.eyePosX+a.innerDist)*w)-v,height:Math.round((a.eyePosY+a.topDist)*k)-F}},_e.prototype.getUndistortedParams_=function(){var a=this.viewer,c=this.device,p=this.distortion,d=a.screenLensDistance,m=a.interLensDistance/2/d,f=c.widthMeters/d,w=c.heightMeters/d,k=f/2-m,v=(a.baselineLensDistance-c.bevelMeters)/d,F=a.fov,S=p.distortInverse(Math.tan(mt*F)),b=Math.min(k,S),P=Math.min(m,S),H=Math.min(v,S),G=Math.min(w-v,S);return{outerDist:b,innerDist:P,topDist:G,bottomDist:H,eyePosX:k,eyePosY:v}};function ns(a){this.id=a.id,this.label=a.label,this.fov=a.fov,this.interLensDistance=a.interLensDistance,this.baselineLensDistance=a.baselineLensDistance,this.screenLensDistance=a.screenLensDistance,this.distortionCoefficients=a.distortionCoefficients,this.inverseCoefficients=a.inverseCoefficients}_e.Viewers=ts;var Qp=1,Kp="2019-11-09T17:36:14Z",Jp=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],Yp={format:Qp,last_updated:Kp,devices:Jp};function eo(a,c){if(this.dpdb=Yp,this.recalculateDeviceParams_(),a){this.onDeviceParamsUpdated=c;var p=new XMLHttpRequest,d=this;p.open("GET",a,!0),p.addEventListener("load",function(){d.loading=!1,p.status>=200&&p.status<=299?(d.dpdb=JSON.parse(p.response),d.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),p.send()}}eo.prototype.getDeviceParams=function(){return this.deviceParams},eo.prototype.recalculateDeviceParams_=function(){var a=this.calcDeviceParams_();a?(this.deviceParams=a,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},eo.prototype.calcDeviceParams_=function(){var a=this.dpdb;if(!a)return console.error("DPDB not available."),null;if(a.format!=1)return console.error("DPDB has unexpected format version."),null;if(!a.devices||!a.devices.length)return console.error("DPDB does not have a devices section."),null;var c=navigator.userAgent||navigator.vendor||window.opera,p=I(),d=L();if(!a.devices)return console.error("DPDB has no devices section."),null;for(var m=0;m<a.devices.length;m++){var f=a.devices[m];if(!f.rules){console.warn("Device["+m+"] has no rules section.");continue}if(f.type!="ios"&&f.type!="android"){console.warn("Device["+m+"] has invalid type.");continue}if(u()==(f.type=="ios")){for(var w=!1,k=0;k<f.rules.length;k++){var v=f.rules[k];if(this.ruleMatches_(v,c,p,d)){w=!0;break}}if(w){var F=f.dpi[0]||f.dpi,S=f.dpi[1]||f.dpi;return new Zp({xdpi:F,ydpi:S,bevelMm:f.bw})}}}return console.warn("No DPDB device match."),null},eo.prototype.ruleMatches_=function(a,c,p,d){if(!a.ua&&!a.res||(a.ua&&a.ua.substring(0,2)==="SM"&&(a.ua=a.ua.substring(0,7)),a.ua&&c.indexOf(a.ua)<0))return!1;if(a.res){if(!a.res[0]||!a.res[1])return!1;var m=a.res[0],f=a.res[1];if(Math.min(p,d)!=Math.min(m,f)||Math.max(p,d)!=Math.max(m,f))return!1}return!0};function Zp(a){this.xdpi=a.xdpi,this.ydpi=a.ydpi,this.bevelMm=a.bevelMm}function to(a,c){this.set(a,c)}to.prototype.set=function(a,c){this.sample=a,this.timestampS=c},to.prototype.copy=function(a){this.set(a.sample,a.timestampS)};function tn(a,c){this.kFilter=a,this.isDebug=c,this.currentAccelMeasurement=new to,this.currentGyroMeasurement=new to,this.previousGyroMeasurement=new to,u()?this.filterQ=new Z(-1,0,0,1):this.filterQ=new Z(1,0,0,1),this.previousFilterQ=new Z,this.previousFilterQ.copy(this.filterQ),this.accelQ=new Z,this.isOrientationInitialized=!1,this.estimatedGravity=new ue,this.measuredGravity=new ue,this.gyroIntegralQ=new Z}tn.prototype.addAccelMeasurement=function(a,c){this.currentAccelMeasurement.set(a,c)},tn.prototype.addGyroMeasurement=function(a,c){this.currentGyroMeasurement.set(a,c);var p=c-this.previousGyroMeasurement.timestampS;V(p)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},tn.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var a=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,c=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,a);this.gyroIntegralQ.multiply(c),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(c);var p=new Z;p.copy(this.filterQ),p.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(p),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var d=new Z;d.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),d.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",xt*dr(d),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var m=new Z;m.copy(this.filterQ),m.multiply(d),this.filterQ.slerp(m,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},tn.prototype.getOrientation=function(){return this.filterQ},tn.prototype.accelToQuaternion_=function(a){var c=new ue;c.copy(a),c.normalize();var p=new Z;return p.setFromUnitVectors(new ue(0,0,-1),c),p.inverse(),p},tn.prototype.gyroToQuaternionDelta_=function(a,c){var p=new Z,d=new ue;return d.copy(a),d.normalize(),p.setFromAxisAngle(d,a.length()*c),p};function Ac(a,c){this.predictionTimeS=a,this.isDebug=c,this.previousQ=new Z,this.previousTimestampS=null,this.deltaQ=new Z,this.outQ=new Z}Ac.prototype.getPrediction=function(a,c,p){if(!this.previousTimestampS)return this.previousQ.copy(a),this.previousTimestampS=p,a;var d=new ue;d.copy(c),d.normalize();var m=c.length();if(m<mt*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(xt*m).toFixed(1)),this.outQ.copy(a),this.previousQ.copy(a),this.outQ;var f=m*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(d,f),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(a),this.previousTimestampS=p,this.outQ};function $e(a,c,p,d){this.yawOnly=p,this.accelerometer=new ue,this.gyroscope=new ue,this.filter=new tn(a,d),this.posePredictor=new Ac(c,d),this.isFirefoxAndroid=g(),this.isIOS=u();var m=A();this.isDeviceMotionInRadians=!this.isIOS&&m&&m<66,this.isWithoutDeviceMotion=M()||_(),this.filterToWorldQ=new Z,u()?this.filterToWorldQ.setFromAxisAngle(new ue(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new ue(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new Z,this.worldToScreenQ=new Z,this.originalPoseAdjustQ=new Z,this.originalPoseAdjustQ.setFromAxisAngle(new ue(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),y()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new Z,this.orientationOut_=new Float32Array(4),this.start()}$e.prototype.getPosition=function(){return null},$e.prototype.getOrientation=function(){var a=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var m=new Z().setFromAxisAngle(new ue(0,0,-1),0),f=new Z;return window.orientation===-90?f.setFromAxisAngle(new ue(0,1,0),Math.PI/-2):f.setFromAxisAngle(new ue(0,1,0),Math.PI/2),m.multiply(f)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var m=new Z;return m.setFromAxisAngle(new ue(1,0,0),-Math.PI/2),m}(),a=this._deviceOrientationQ;var p=new Z;return p.copy(a),p.multiply(this.deviceOrientationFilterToWorldQ),p.multiply(this.resetQ),p.multiply(this.worldToScreenQ),p.multiplyQuaternions(this.deviceOrientationFixQ,p),this.yawOnly&&(p.x=0,p.z=0,p.normalize()),this.orientationOut_[0]=p.x,this.orientationOut_[1]=p.y,this.orientationOut_[2]=p.z,this.orientationOut_[3]=p.w,this.orientationOut_}else{var c=this.filter.getOrientation();a=this.posePredictor.getPrediction(c,this.gyroscope,this.previousTimestampS)}var p=new Z;return p.copy(this.filterToWorldQ),p.multiply(this.resetQ),p.multiply(a),p.multiply(this.worldToScreenQ),this.yawOnly&&(p.x=0,p.z=0,p.normalize()),this.orientationOut_[0]=p.x,this.orientationOut_[1]=p.y,this.orientationOut_[2]=p.z,this.orientationOut_[3]=p.w,this.orientationOut_},$e.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),y()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},$e.prototype.onDeviceOrientation_=function(a){this._deviceOrientationQ=this._deviceOrientationQ||new Z;var c=a.alpha,p=a.beta,d=a.gamma;c=(c||0)*Math.PI/180,p=(p||0)*Math.PI/180,d=(d||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(p,c,-d)},$e.prototype.onDeviceMotion_=function(a){this.updateDeviceMotion_(a)},$e.prototype.updateDeviceMotion_=function(a){var c=a.accelerationIncludingGravity,p=a.rotationRate,d=a.timeStamp/1e3,m=d-this.previousTimestampS;if(m<0){Zn("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=d;return}else if(m<=r||m>i){Zn("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=d;return}this.accelerometer.set(-c.x,-c.y,-c.z),p&&(B()?this.gyroscope.set(-p.beta,p.alpha,p.gamma):this.gyroscope.set(p.alpha,p.beta,p.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,d)),this.filter.addAccelMeasurement(this.accelerometer,d),this.previousTimestampS=d},$e.prototype.onOrientationChange_=function(a){this.setScreenTransform_()},$e.prototype.onMessage_=function(a){var c=a.data;if(!(!c||!c.type)){var p=c.type.toLowerCase();p==="devicemotion"&&this.updateDeviceMotion_(c.deviceMotionEvent)}},$e.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new ue(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new ue(0,0,1),Math.PI/2);break;case 180:break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},$e.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),u()&&oe()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},$e.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var $p=60,ed=new ue(1,0,0),td=new ue(0,0,1),os=new Z;os.setFromAxisAngle(ed,-Math.PI/2),os.multiply(new Z().setFromAxisAngle(td,Math.PI/2));var nd=function(){function a(c){e(this,a),this.config=c,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new Z,this._outQ=new Z,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return t(a,[{key:"init",value:function(){var p=null;try{p=new RelativeOrientationSensor({frequency:$p,referenceFrame:"screen"}),p.addEventListener("error",this._onSensorError)}catch(d){this.errors.push(d),d.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):d.name==="ReferenceError"?this.useDeviceMotion():console.error(d)}p&&(this.api="sensor",this.sensor=p,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new $e(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var p=this.sensor.quaternion;this._sensorQ.set(p[0],p[1],p[2],p[3]);var d=this._outQ;return d.copy(os),d.multiply(this._sensorQ),this.config.YAW_ONLY&&(d.x=d.z=0,d.normalize()),this._out[0]=d.x,this._out[1]=d.y,this._out[2]=d.z,this._out[3]=d.w,this._out}},{key:"_onSensorError",value:function(p){this.errors.push(p.error),p.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):p.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(p.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),a}(),od="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function nn(){this.loadIcon_();var a=document.createElement("div"),w=a.style;w.position="fixed",w.top=0,w.right=0,w.bottom=0,w.left=0,w.backgroundColor="gray",w.fontFamily="sans-serif",w.zIndex=1e6;var c=document.createElement("img");c.src=this.icon;var w=c.style;w.marginLeft="25%",w.marginTop="25%",w.width="50%",a.appendChild(c);var p=document.createElement("div"),w=p.style;w.textAlign="center",w.fontSize="16px",w.lineHeight="24px",w.margin="24px 25%",w.width="50%",p.innerHTML="Place your phone into your Cardboard viewer.",a.appendChild(p);var d=document.createElement("div"),w=d.style;w.backgroundColor="#CFD8DC",w.position="fixed",w.bottom=0,w.width="100%",w.height="48px",w.padding="14px 24px",w.boxSizing="border-box",w.color="#656A6B",a.appendChild(d);var m=document.createElement("div");m.style.float="left",m.innerHTML="No Cardboard viewer?";var f=document.createElement("a");f.href="https://www.google.com/get/cardboard/get-cardboard/",f.innerHTML="get one",f.target="_blank";var w=f.style;w.float="right",w.fontWeight=600,w.textTransform="uppercase",w.borderLeft="1px solid gray",w.paddingLeft="24px",w.textDecoration="none",w.color="#656A6B",d.appendChild(m),d.appendChild(f),this.overlay=a,this.text=p,this.hide()}nn.prototype.show=function(a){!a&&!this.overlay.parentElement?document.body.appendChild(this.overlay):a&&(this.overlay.parentElement&&this.overlay.parentElement!=a&&this.overlay.parentElement.removeChild(this.overlay),a.appendChild(this.overlay)),this.overlay.style.display="block";var c=this.overlay.querySelector("img"),p=c.style;y()?(p.width="20%",p.marginLeft="40%",p.marginTop="3%"):(p.width="50%",p.marginLeft="25%",p.marginTop="25%")},nn.prototype.hide=function(){this.overlay.style.display="none"},nn.prototype.showTemporarily=function(a,c){this.show(c),this.timer=setTimeout(this.hide.bind(this),a)},nn.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},nn.prototype.update=function(){this.disableShowTemporarily(),!y()&&Q()?this.show():this.hide()},nn.prototype.loadIcon_=function(){this.icon=s("image/svg+xml",od)};var rd="CardboardV1",_c="WEBVR_CARDBOARD_VIEWER",id="webvr-polyfill-viewer-selector";function et(a){try{this.selectedKey=localStorage.getItem(_c)}catch(c){console.error("Failed to load viewer profile: %s",c)}this.selectedKey||(this.selectedKey=a||rd),this.dialog=this.createDialog_(_e.Viewers),this.root=null,this.onChangeCallbacks_=[]}et.prototype.show=function(a){this.root=a,a.appendChild(this.dialog);var c=this.dialog.querySelector("#"+this.selectedKey);c.checked=!0,this.dialog.style.display="block"},et.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},et.prototype.getCurrentViewer=function(){return _e.Viewers[this.selectedKey]},et.prototype.getSelectedKey_=function(){var a=this.dialog.querySelector("input[name=field]:checked");return a?a.id:null},et.prototype.onChange=function(a){this.onChangeCallbacks_.push(a)},et.prototype.fireOnChange_=function(a){for(var c=0;c<this.onChangeCallbacks_.length;c++)this.onChangeCallbacks_[c](a)},et.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!_e.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(_e.Viewers[this.selectedKey]);try{localStorage.setItem(_c,this.selectedKey)}catch(a){console.error("Failed to save viewer profile: %s",a)}this.hide()},et.prototype.createDialog_=function(a){var c=document.createElement("div");c.classList.add(id),c.style.display="none";var p=document.createElement("div"),f=p.style;f.position="fixed",f.left=0,f.top=0,f.width="100%",f.height="100%",f.background="rgba(0, 0, 0, 0.3)",p.addEventListener("click",this.hide.bind(this));var d=280,m=document.createElement("div"),f=m.style;f.boxSizing="border-box",f.position="fixed",f.top="24px",f.left="50%",f.marginLeft=-d/2+"px",f.width=d+"px",f.padding="24px",f.overflow="hidden",f.background="#fafafa",f.fontFamily="'Roboto', sans-serif",f.boxShadow="0px 5px 20px #666",m.appendChild(this.createH1_("Select your viewer"));for(var w in a)m.appendChild(this.createChoice_(w,a[w].label));return m.appendChild(this.createButton_("Save",this.onSave_.bind(this))),c.appendChild(p),c.appendChild(m),c},et.prototype.createH1_=function(a){var c=document.createElement("h1"),p=c.style;return p.color="black",p.fontSize="20px",p.fontWeight="bold",p.marginTop=0,p.marginBottom="24px",c.innerHTML=a,c},et.prototype.createChoice_=function(a,c){var p=document.createElement("div");p.style.marginTop="8px",p.style.color="black";var d=document.createElement("input");d.style.fontSize="30px",d.setAttribute("id",a),d.setAttribute("type","radio"),d.setAttribute("value",a),d.setAttribute("name","field");var m=document.createElement("label");return m.style.marginLeft="4px",m.setAttribute("for",a),m.innerHTML=c,p.appendChild(d),p.appendChild(m),p},et.prototype.createButton_=function(a,c){var p=document.createElement("button");p.innerHTML=a;var d=p.style;return d.float="right",d.textTransform="uppercase",d.color="#1094f7",d.fontSize="14px",d.letterSpacing=0,d.border=0,d.background="none",d.marginTop="16px",p.addEventListener("click",c),p};var sd=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ad(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function cd(a,c){return c={exports:{}},a(c,c.exports),c.exports}var ld=cd(function(a,c){(function(d,m){a.exports=m()})(sd,function(){return function(p){var d={};function m(f){if(d[f])return d[f].exports;var w=d[f]={i:f,l:!1,exports:{}};return p[f].call(w.exports,w,w.exports,m),w.l=!0,w.exports}return m.m=p,m.c=d,m.d=function(f,w,k){m.o(f,w)||Object.defineProperty(f,w,{configurable:!1,enumerable:!0,get:k})},m.n=function(f){var w=f&&f.__esModule?function(){return f.default}:function(){return f};return m.d(w,"a",w),w},m.o=function(f,w){return Object.prototype.hasOwnProperty.call(f,w)},m.p="",m(m.s=0)}([function(p,d,m){"use strict";var f=function(){function S(b,P){for(var H=0;H<P.length;H++){var G=P[H];G.enumerable=G.enumerable||!1,G.configurable=!0,"value"in G&&(G.writable=!0),Object.defineProperty(b,G.key,G)}}return function(b,P,H){return P&&S(b.prototype,P),H&&S(b,H),b}}();function w(S,b){if(!(S instanceof b))throw new TypeError("Cannot call a class as a function")}var k=m(1),v=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,F=function(){function S(){w(this,S),v?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",k),this.noSleepVideo.addEventListener("timeupdate",function(b){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return f(S,[{key:"enable",value:function(){v?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){v?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),S}();p.exports=F},function(p,d,m){"use strict";p.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),ud=ad(ld),pd=1e3,dd=[0,0,.5,1],hd=[.5,0,.5,1],md=window.requestAnimationFrame,xd=window.cancelAnimationFrame;function fd(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function Sc(a){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:a.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:a.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:a.canPresent},maxLayers:{writable:!1,enumerable:!0,value:a.maxLayers},hasOrientation:{enumerable:!0,get:function(){return Tt("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),a.hasOrientation}}})}function se(a){a=a||{};var c="wakelock"in a?a.wakelock:!0;this.isPolyfilled=!0,this.displayId=pd++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return Tt("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new Sc({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,c&&Q()&&(this.wakelock_=new ud)}se.prototype.getFrameData=function(a){return Ee(a,this._getPose(),this)},se.prototype.getPose=function(){return Tt("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},se.prototype.resetPose=function(){return Tt("VRDisplay.prototype.resetPose"),this._resetPose()},se.prototype.getImmediatePose=function(){return Tt("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},se.prototype.requestAnimationFrame=function(a){return md(a)},se.prototype.cancelAnimationFrame=function(a){return xd(a)},se.prototype.wrapForFullscreen=function(a){if(u())return a;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var c=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",c.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==a)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=a,this.originalParent_=a.parentElement,this.originalParent_||document.body.appendChild(a),!this.fullscreenWrapper_.parentElement){var p=this.fullscreenElement_.parentElement;p.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),p.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var d=this;function m(){if(d.fullscreenElement_){var f=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];d.fullscreenElement_.setAttribute("style",f.join("; ")+";")}}return m(),this.fullscreenWrapper_},se.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var a=this.fullscreenElement_;this.fullscreenElementCachedStyle_?a.setAttribute("style",this.fullscreenElementCachedStyle_):a.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var c=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(a),this.originalParent_===c?c.insertBefore(a,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(a),c.removeChild(this.fullscreenWrapper_),a}},se.prototype.requestPresent=function(a){var c=this.isPresenting,p=this;return a instanceof Array||(Tt("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),a=[a]),new Promise(function(d,m){if(!p.capabilities.canPresent){m(new Error("VRDisplay is not capable of presenting."));return}if(a.length==0||a.length>p.capabilities.maxLayers){m(new Error("Invalid number of layers."));return}var f=a[0];if(!f.source){d();return}var w=f.leftBounds||dd,k=f.rightBounds||hd;if(c){var v=p.layer_;v.source!==f.source&&(v.source=f.source);for(var F=0;F<4;F++)v.leftBounds[F]=w[F],v.rightBounds[F]=k[F];p.wrapForFullscreen(p.layer_.source),p.updatePresent_(),d();return}if(p.layer_={predistorted:f.predistorted,source:f.source,leftBounds:w.slice(0),rightBounds:k.slice(0)},p.waitingForPresent_=!1,p.layer_&&p.layer_.source){var S=p.wrapForFullscreen(p.layer_.source),b=function(){var G=C();p.isPresenting=S===G,p.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(z){console.error("screen.orientation.lock() failed due to",z.message)}),p.waitingForPresent_=!1,p.beginPresent_(),d()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),p.removeFullscreenWrapper(),p.disableWakeLock(),p.endPresent_(),p.removeFullscreenListeners_()),p.fireVRDisplayPresentChange_()},P=function(){p.waitingForPresent_&&(p.removeFullscreenWrapper(),p.removeFullscreenListeners_(),p.disableWakeLock(),p.waitingForPresent_=!1,p.isPresenting=!1,m(new Error("Unable to present.")))};p.addFullscreenListeners_(S,b,P),D(S)?(p.enableWakeLock(),p.waitingForPresent_=!0):(u()||h())&&(p.enableWakeLock(),p.isPresenting=!0,p.beginPresent_(),p.fireVRDisplayPresentChange_(),d())}!p.waitingForPresent_&&!u()&&(O(),m(new Error("Unable to present.")))})},se.prototype.exitPresent=function(){var a=this.isPresenting,c=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(p,d){a?(!O()&&u()&&(c.endPresent_(),c.fireVRDisplayPresentChange_()),h()&&(c.removeFullscreenWrapper(),c.removeFullscreenListeners_(),c.endPresent_(),c.fireVRDisplayPresentChange_()),p()):d(new Error("Was not presenting to VRDisplay."))})},se.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},se.prototype.fireVRDisplayPresentChange_=function(){var a=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(a)},se.prototype.fireVRDisplayConnect_=function(){var a=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(a)},se.prototype.addFullscreenListeners_=function(a,c,p){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=a,this.fullscreenChangeHandler_=c,this.fullscreenErrorHandler_=p,c&&(document.fullscreenEnabled?a.addEventListener("fullscreenchange",c,!1):document.webkitFullscreenEnabled?a.addEventListener("webkitfullscreenchange",c,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",c,!1):document.msFullscreenEnabled&&a.addEventListener("msfullscreenchange",c,!1)),p&&(document.fullscreenEnabled?a.addEventListener("fullscreenerror",p,!1):document.webkitFullscreenEnabled?a.addEventListener("webkitfullscreenerror",p,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",p,!1):document.msFullscreenEnabled&&a.addEventListener("msfullscreenerror",p,!1))},se.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var a=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var c=this.fullscreenChangeHandler_;a.removeEventListener("fullscreenchange",c,!1),a.removeEventListener("webkitfullscreenchange",c,!1),document.removeEventListener("mozfullscreenchange",c,!1),a.removeEventListener("msfullscreenchange",c,!1)}if(this.fullscreenErrorHandler_){var p=this.fullscreenErrorHandler_;a.removeEventListener("fullscreenerror",p,!1),a.removeEventListener("webkitfullscreenerror",p,!1),document.removeEventListener("mozfullscreenerror",p,!1),a.removeEventListener("msfullscreenerror",p,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},se.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},se.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},se.prototype.beginPresent_=function(){},se.prototype.endPresent_=function(){},se.prototype.submitFrame=function(a){},se.prototype.getEyeParameters=function(a){return null};var gd={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},mr={LEFT:"left",RIGHT:"right"};function Se(a){var c=Y({},gd);a=Y(c,a||{}),se.call(this,{wakelock:a.MOBILE_WAKE_LOCK}),this.config=a,this.displayName="Cardboard VRDisplay",this.capabilities=new Sc({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new nd(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new eo(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new _e(this.dpdb_.getDeviceParams(),a.ADDITIONAL_VIEWERS),this.viewerSelector_=new et(a.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new nn),u()&&window.addEventListener("resize",this.onResize_.bind(this))}return Se.prototype=Object.create(se.prototype),Se.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},Se.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},Se.prototype._getFieldOfView=function(a){var c;if(a==mr.LEFT)c=this.deviceInfo_.getFieldOfViewLeftEye();else if(a==mr.RIGHT)c=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",a),null;return c},Se.prototype._getEyeOffset=function(a){var c;if(a==mr.LEFT)c=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(a==mr.RIGHT)c=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",a),null;return c},Se.prototype.getEyeParameters=function(a){var c=this._getEyeOffset(a),p=this._getFieldOfView(a),d={offset:c,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(d,"fieldOfView",{enumerable:!0,get:function(){return Tt("VRFieldOfView","VRFrameData's projection matrices"),p}}),d},Se.prototype.onDeviceParamsUpdated_=function(a){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(a),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},Se.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},Se.prototype.beginPresent_=function(){var a=this.layer_.source.getContext("webgl");a||(a=this.layer_.source.getContext("experimental-webgl")),a||(a=this.layer_.source.getContext("webgl2")),a&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(a.canvas.width=I()*this.bufferScale_,a.canvas.height=L()*this.bufferScale_,this.cardboardUI_=new en(a)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new en(a)),this.distorter_=new pt(a,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(c){this.viewerSelector_.show(this.layer_.source.parentElement),c.stopPropagation(),c.preventDefault()}.bind(this),function(c){this.exitPresent(),c.stopPropagation(),c.preventDefault()}.bind(this)),this.rotateInstructions_&&(y()&&Q()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},Se.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},Se.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},Se.prototype.submitFrame=function(a){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var c=this.layer_.source.getContext("webgl");c||(c=this.layer_.source.getContext("experimental-webgl")),c||(c=this.layer_.source.getContext("webgl2"));var p=c.canvas;(p.width!=this.lastWidth||p.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=p.width,this.lastHeight=p.height,this.cardboardUI_.render()}},Se.prototype.onOrientationChange_=function(a){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},Se.prototype.onResize_=function(a){if(this.layer_){var c=this.layer_.source.getContext("webgl");c||(c=this.layer_.source.getContext("experimental-webgl")),c||(c=this.layer_.source.getContext("webgl2"));var p=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];c.canvas.setAttribute("style",p.join("; ")+";"),le(c.canvas)}},Se.prototype.onViewerChanged_=function(a){this.deviceInfo_.setViewer(a),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},Se.prototype.fireVRDisplayDeviceParamsChange_=function(){var a=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(a)},Se.VRFrameData=fd,Se.VRDisplay=se,Se})});function mo(n,e,t){return typeof n===e||n instanceof t}function ee(n){return mo(n,"function",Function)}function J(n){return mo(n,"string",String)}function Bn(n){return mo(n,"boolean",Boolean)}function Re(n){return mo(n,"number",Number)}function Md(n){return N(n)||!Number.isFinite(n)||Number.isNaN(n)}function on(n){return Re(n)&&!Md(n)}function rn(n){return E(n)&&mo(n,"object",Object)}function tt(n){return n instanceof Array}function Pe(n,e){throw new Error((e||"Unexpected object: ")+n)}function N(n){return n==null}function E(n){return!N(n)}function vc(n){return n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Int8Array||n instanceof Uint16Array||n instanceof Int16Array||n instanceof Uint32Array||n instanceof Int32Array||n instanceof Float32Array||n instanceof Float64Array||"BigUint64Array"in globalThis&&n instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&n instanceof globalThis.BigInt64Array}function kc(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Mc(n){return rn(n)&&"compareTo"in n&&ee(n.compareTo)}function xr(n,...e){let t=null;J(n)?t=n:(t="ascending",e.unshift(n));let o=t==="ascending"?1:-1;return Object.assign((i,s)=>{if(i===s)return 0;for(let l of e){let u=N(i)?null:l(i),h=N(s)?null:l(s),x=u===h?0:J(u)&&J(h)?o*u.localeCompare(h):Mc(u)&&Mc(h)?o*u.compareTo(h):t==="ascending"&&u>h||t==="descending"&&u<h?1:-1;if(x!==0)return x}return 0},{direction:t})}function Ec(n,e,t,o="search"){let r=0,i=n.length-1;for(;r<=i;){let s=r+i>>1,l=t(n[s],e);if(l===0){if(o!=="search"){let u=o==="append"?1:-1;for(u>0&&(s+=u);0<=s&&s<n.length&&(l=t(n[s],e))===0;)s+=u;u<0&&(s-=u)}return s}else l<0?r=s-l:i=s-l}return-r-1}function rs(n,e,t,o="search"){let r=o!=="set";o==="set"&&(o="search");let i=null;if(Re(t)?i=t:i=Ec(n,e,t,o),i<0)i=-i-1;else if(!r)return-1;return Ed(n,e,i),i}function bc(n,e,t){let o=Ec(n,e,t);return o>=0?(xo(n,o),o):-1}function ye(n){return n.splice(0)}function is(n,e){for(let t=0;t<n.length;++t)if(n[t]!==e[t])return t;return-1}function Ed(n,e,t){n.splice(t,0,e)}function nt(n,e){let t=n.indexOf(e);return t>-1?(xo(n,t),!0):!1}function bd(n,e){for(let t=n.length-1;t>=0;--t)if(e(n[t]))return xo(n,t);return null}function yc(n,e,t){return bd(n,o=>t(o)===e)}function xo(n,e){return n.splice(e,1)[0]}function yd(n,e,t){let o=n?0:e.length-1,r=n?e.length:-1,i=n?1:-1;for(let s of t)for(let l=o;l!=r;l+=i){let u=e[l];if(s(u))return u}return null}function fr(n,...e){return yd(!0,n,e)}function sn(n){return n}function Dc(){return!0}function Cc(){return!1}var Ln=class{constructor(){this.listeners=new Map,this.listenerOptions=new Map,this.bubblers=new Set,this.scopes=new WeakMap}addBubbler(e){this.bubblers.add(e)}removeBubbler(e){this.bubblers.delete(e)}addScopedEventListener(e,t,o,r){this.scopes.has(e)||this.scopes.set(e,[]),this.scopes.get(e).push([t,o]),this.addEventListener(t,o,r)}removeScope(e){let t=this.scopes.get(e);if(t){this.scopes.delete(e);for(let[o,r]of t)this.removeEventListener(o,r)}}addEventListener(e,t,o){let r=this.listeners.get(e);r||(r=new Array,this.listeners.set(e,r)),r.find(i=>i===t)||(r.push(t),o&&this.listenerOptions.set(t,o))}removeEventListener(e,t){let o=this.listeners.get(e);o&&this.removeListener(o,t)}clearEventListeners(e){for(let[t,o]of this.listeners)if(N(e)||e===t){for(let r of o)this.removeEventListener(e,r);ye(o),this.listeners.delete(t)}}removeListener(e,t){let o=e.findIndex(r=>r===t);o>=0&&(xo(e,o),this.listenerOptions.has(t)&&this.listenerOptions.delete(t))}dispatchEvent(e){let t=this.listeners.get(e.type);if(t)for(let o of t){let r=this.listenerOptions.get(o);E(r)&&!Bn(r)&&r.once&&this.removeListener(t,o),ee(o)?o.call(this,e):o.handleEvent(e)}if(e.defaultPrevented)return!1;for(let o of this.bubblers)if(!o.dispatchEvent(e))return!1;return!0}};var Ie=class{constructor(e=!0){this.autoStart=e,this.onThens=new Array,this.onCatches=new Array,this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",this.resolve=t=>{if(this.running){this._result=t,this._resultState="resolved";for(let o of this.onThens)o(t);this.clear(),this._executionState="finished"}},this.reject=t=>{if(this.running){this._error=t,this._resultState="errored";for(let o of this.onCatches)o(t);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){ye(this.onThens),ye(this.onCatches)}start(){this._executionState="running"}resolver(e){return()=>this.resolve(e)}resolveOn(e,t,o){let r=this.resolver(o);e.addEventListener(t,r),this.finally(()=>e.removeEventListener(t,r))}get result(){if(E(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((e,t)=>{this.finished?this.errored?t(this.error):e(this.result):(this.onThens.push(e),this.onCatches.push(t))})}then(e,t){return this.project().then(e,t)}catch(e){return this.project().catch(e)}finally(e){return this.project().finally(e)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(e){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",e&&this.start()}};function Bc(n,e){return"on"+e in n}function ot(n,e,t,...o){N(o)&&(o=[]);let r;if(J(t)?o.unshift(t):Re(t)&&(r=t),!(n instanceof Ln)){if(!Bc(n,e))throw new Error(`Target does not have a ${e} rejection event`);for(let u of o)if(!Bc(n,u))throw new Error(`Target does not have a ${u} rejection event`)}let i=new Ie;if(Re(r)){let u=setTimeout(i.reject,r,`'${e}' has timed out.`);i.finally(clearTimeout.bind(globalThis,u))}let s=(u,h)=>{n.addEventListener(u,h),i.finally(()=>n.removeEventListener(u,h))};s(e,u=>i.resolve(u));let l=u=>i.reject(u);for(let u of o)s(u,l);return i}function vt(n){return n.then(Dc).catch(Cc)}var Lc=/([^\/]+)\/(.+)/,Dd=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/;var fo=class n{constructor(e,t,o){this._type=e,this._fullSubType=t,this._primaryExtension=null,this.depMessage=null;let r=new Map;this._parameters=r;let i=this._fullSubType.match(Dd);this._tree=i[1],this._subType=i[2],this._suffix=i[3];let s=i[4];if(this._value=this._fullValue=this._type+"/",E(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,E(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),E(s)){let l=s.split(";").map(u=>u.trim()).filter(u=>u.length>0).map(u=>u.split("="));for(let[u,...h]of l){let x=h.join("=");r.set(u,x);let g=`; ${u}=${x}`;this._fullValue+=g,u!=="q"&&(this._value+=g)}}this._extensions=o||[],this._primaryExtension=this._extensions[0]||null}static parse(e){if(!e)return null;let t=e.match(Lc);if(!t)return null;let o=t[1],r=t[2];return new n(o,r)}deprecate(e){return this.depMessage=e,this}check(){E(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(e){if(N(e))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let t=null,o=null;if(J(e)){let r=e.match(Lc);if(!r)return!1;t=r[1],o=r[2]}else t=e.typeName,o=e._fullSubType;return this.typeName===t&&(this._fullSubType==="*"||this._fullSubType===o)}withParameter(e,t){let o=`${this._fullSubType}; ${e}=${t}`;return new n(this.typeName,o,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}toFileSystemAPIAccepts(){return{[this.value]:this.extensions.map(e=>"."+e)}}addExtension(e){if(!e)throw new Error("File name is not defined");return this.primaryExtension&&(e=n.removeExtension(e),e=`${e}.${this.primaryExtension}`),e}static removeExtension(e){let t=e.lastIndexOf(".");return t>-1&&(e=e.substring(0,t)),e}};function Cd(n,e,...t){return new fo(n,e,t)}function We(n){return Cd.bind(null,n)}var ss=We("application");var Rn=ss("javascript","js");var as=ss("json","json");var cs=ss("wasm","wasm");var Rc=We("model");var go=Rc("gltf-binary","glb"),Pc=Rc("gltf+json","gltf");var ls=We("text");var wo=ls("css","css");var gr=ls("plain","txt","text","conf","def","list","log","in");var Ic=ls("xml");var Bd="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function us(n,e){if(n<0)throw new Error("Length must be greater than 0");N(e)&&(e=Bd);let t="";for(let o=0;o<n;++o){let r=Math.floor(Math.random()*e.length);t+=e[r]}return t}var Vc=new Map,wr=class{constructor(e,t,o,...r){this.key=e,this.value=t,this.bySetAttribute=o,this.tags=r.map(i=>i.toLocaleUpperCase()),Object.freeze(this)}applyToElement(e){if(this.tags.length>0&&this.tags.indexOf(e.tagName)===-1){let t=Vc.get(e.tagName);t||Vc.set(e.tagName,t=new Set),t.has(this.key)||(t.add(this.key),console.warn(`Element ${e.tagName} does not support Attribute ${this.key}`))}this.bySetAttribute?e.setAttribute(this.key,this.value.toString()):this.key in e?e[this.key]=this.value:this.value===!1?e.removeAttribute(this.key):this.value===!0?e.setAttribute(this.key,""):ee(this.value)?this.value(e):e.setAttribute(this.key,this.value.toString())}};function Fr(n,e,t,...o){return new wr(n,e,t,...o)}function Wc(n){return n instanceof wr}function Oc(n){return Fr("height",n,!1,"canvas","embed","iframe","img","input","object","video")}function ps(n){return Fr("rel",n,!1,"a","area","link")}function Ar(n){return J(n)||(n=n.value),Fr("type",n,!1,"button","input","command","embed","link","object","script","source","style","menu")}function Hc(n){return Fr("width",n,!1,"canvas","embed","iframe","img","input","object","video")}function _r(...n){return`rgb(${n.join(", ")})`}function Nc(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}function Gc(n){return rn(n)?n.element instanceof Element:!1}function ds(n){return Gc(n)?n.element:J(n)?xs(n):n}function Ld(n){return rn(n)&&"applyToElement"in n&&ee(n.applyToElement)}function hs(n,e,t=""){n=ds(n),e?(n.style.removeProperty("display"),getComputedStyle(n).display==="none"&&(n.style.display=t||"block")):n.style.display="none"}function ms(n){return n=ds(n),n.style.display!=="none"}function Xc(n,...e){let t=n instanceof Element||n instanceof ShadowRoot?n:J(n)?document.querySelector(n):n.element,o=t instanceof HTMLTemplateElement?t.content:t;for(let r of e)E(r)&&(r instanceof Node?o.appendChild(r):Gc(r)?o.appendChild(ds(r)):Ld(r)?t instanceof ShadowRoot||r.applyToElement(t):o.appendChild(document.createTextNode(r.toLocaleString())));return t}function xs(n){return document.querySelector(n)}function Uc(n){return xs(n)}function zc(n){return xs(n)}function Sr(n,...e){let t=null,o=e.filter(Wc).filter(r=>r.key==="id"||r.key==="query");for(let r of o)r.key==="query"?(t=r.value,nt(e,r)):r.key==="id"&&(t=document.getElementById(r.value),t&&nt(e,r));return t&&t.tagName!==n.toUpperCase()&&console.warn(`Expected a "${n.toUpperCase()}" element but found a "${t.tagName}".`),t||(t=document.createElement(n)),Xc(t,...e),t}function jc(...n){return Sr("canvas",...n)}function fs(...n){return Sr("img",...n)}function qc(...n){return Sr("link",...n)}function Qc(...n){return Sr("script",...n)}function Kc(n){if(n.status>=400)throw new Error("Resource could not be retrieved: "+n.requestPath);return n}function Fo(n){let{content:e}=Kc(n);return e}function gs(n,...e){if(!rn(n))return!1;n=n;for(let t of e){if(!(t in n))return!1;let o=n[t];if(!ee(o))return!1}return!0}function Rd(n){return gs(n,"dispose")}function Pd(n){return gs(n,"destroy")}function Id(n){return gs(n,"close")}function Xe(n){Rd(n)&&n.dispose(),Id(n)&&n.close(),Pd(n)&&n.destroy()}function Jc(n,e){try{return e(n)}finally{Xe(n)}}var Yc="HTMLCanvasElement"in globalThis,Df="HTMLImageElement"in globalThis,ws=!1,an=!ws&&"OffscreenCanvas"in globalThis,Cf=!ws&&"createImageBitmap"in globalThis;function Ao(n){return Yc&&n instanceof HTMLCanvasElement}function Zc(n){return an&&n instanceof OffscreenCanvas}function Vd(n){return Ao(n)||Zc(n)}function Wd(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var Od=an&&Wd(),Tr=Od&&Fs||Yc&&As||null;function Hd(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var Bf=an&&Hd();function Fs(n,e){return new OffscreenCanvas(n,e)}function As(n,e){return jc(Hc(n),Oc(e))}function _s(n,e){let t=n.getContext("2d");if(N(t))throw new Error("Could not create 2d context for canvas");t.drawImage(e,0,0)}function cn(n){Vd(n)?n.width=n.height=0:Xe(n)}var me=class extends Event{get type(){return super.type}constructor(e,t){super(e,t)}},ce=class extends Ln{addBubbler(e){super.addBubbler(e)}removeBubbler(e){super.removeBubbler(e)}addScopedEventListener(e,t,o,r){super.addScopedEventListener(e,t,o,r)}addEventListener(e,t,o){super.addEventListener(e,t,o)}removeEventListener(e,t){super.removeEventListener(e,t)}clearEventListeners(e){return super.clearEventListeners(e)}};function _o(n){return E(n)&&ee(n.then)&&ee(n.catch)&&ee(n.finally)&&ee(n.fetch)&&ee(n.getSize)}var Ss=class{get result(){if(E(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}constructor(e,t){this.path=e,this.type=t,this._result=null,this._error=null,this._started=!1,this._finished=!1,this.resolve=null,this.reject=null,this.promise=new Promise((o,r)=>{this.resolve=i=>{this._result=i,this._finished=!0,o(i)},this.reject=i=>{this._error=i,this._finished=!0,r(i)}})}async getSize(e){try{let{contentLength:t}=await e.head(this.path).accept(this.type).exec();return[this,t||1]}catch(t){return console.warn(t),[this,1]}}async fetch(e,t){try{let o=await this.getResult(e,t);this.resolve(o)}catch(o){this.reject(o)}}get[Symbol.toStringTag](){return this.promise.toString()}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}};var vr=class extends Ss{constructor(e,t,o){let r;Bn(t)?o=t:r=t,super(e,r),this.useCache=!!o}getResult(e,t){return this.getRequest(e,t).then(Fo)}getRequest(e,t){let o=e.get(this.path).useCache(this.useCache).progress(t);return this.getResponse(o)}};function $c(){return"chrome"in globalThis&&!navigator.userAgent.match("CriOS")}function el(){return"InstallTrigger"in globalThis}function tl(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function Nd(){return/^mac/i.test(navigator.platform)}function Gd(){return/iP(ad|hone|od)/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||Nd()&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>2}function So(){return/Mobile VR/.test(navigator.userAgent)||/Pico Neo 3 Link/.test(navigator.userAgent)||kt}function Mr(){return"xr"in navigator&&"isSessionSupported"in navigator.xr}function Ts(){return"getVRDisplays"in navigator}function nl(){return Mr()||Ts()}function vs(){return/Android/.test(navigator.userAgent)||/BlackBerry/.test(navigator.userAgent)||/(UC Browser |UCWEB)/.test(navigator.userAgent)||Gd()||So()}function Er(){return!vs()}var Xd=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,kr=navigator.userAgent.match(Xd),kt=!!kr,ol=kt&&{major:parseFloat(kr[1]),minor:parseFloat(kr[2]),patch:parseFloat(kr[3])},Hf=kt&&/pacific/i.test(navigator.userAgent),Nf=kt&&/quest/i.test(navigator.userAgent),Gf=kt&&/quest 2/i.test(navigator.userAgent);var Ud="Worker"in globalThis;var rl=304.79999999999995,Uf=rl*3,zd=10*100,jd=rl*16.5,qd=jd*40,zf=zd*1e3,jf=qd*8,il=2.54*4,sl=il*3,qf=sl*3,Qd=sl*16.5,Kd=Qd*40,Qf=100*1e3,Kf=Kd*8,ks=4*3,Jd=ks*3,Ms=100/2.54,Yd=ks*16.5,Zd=Yd*40,Jf=Ms*1e3,Yf=Zd*8,Zf=3*3,$d=100/il,eh=3*16.5,th=eh*40,$f=$d*1e3,eg=th*8,Es=Ms/ks,nh=16.5*40,tg=Es*1e3,ng=nh*8,oh=Ms/Jd,rh=16.5/3,ih=rh*40,og=oh*1e3,rg=ih*8,al=16.5/Es,cl=al*40,ig=cl*8,sg=1e3/al,ag=40*8,sh=1e3/cl,cg=8/sh;function ll(n){return n/Es}var{ACESFilmicToneMapping:ug,AddEquation:pg,AddOperation:dg,AdditiveAnimationBlendMode:hg,AdditiveBlending:mg,AlphaFormat:xg,AlwaysDepth:fg,AlwaysStencilFunc:gg,AmbientLight:ul,AmbientLightProbe:wg,AnimationClip:pl,AnimationLoader:Fg,AnimationMixer:Ag,AnimationObjectGroup:_g,AnimationUtils:Sg,ArcCurve:Tg,ArrayCamera:vg,ArrowHelper:kg,Audio:Mg,AudioAnalyser:Eg,AudioContext:bg,AudioListener:yg,AudioLoader:Dg,AxesHelper:Cg,BackSide:dl,BasicDepthPacking:Bg,BasicShadowMap:Lg,Bone:hl,BooleanKeyframeTrack:Rg,Box2:Pg,Box3:ln,Box3Helper:Ig,BoxBufferGeometry:Vg,BoxGeometry:br,BoxHelper:Wg,BufferAttribute:To,BufferGeometry:bs,BufferGeometryLoader:Og,ByteType:Hg,Cache:Ng,Camera:Gg,CameraHelper:Xg,CanvasTexture:Ug,CapsuleBufferGeometry:zg,CapsuleGeometry:jg,CatmullRomCurve3:qg,CineonToneMapping:Qg,CircleBufferGeometry:Kg,CircleGeometry:Jg,ClampToEdgeWrapping:ml,Clock:Yg,Color:we,ColorKeyframeTrack:Zg,ColorManagement:ys,CompressedArrayTexture:$g,CompressedTexture:ew,CompressedTextureLoader:tw,ConeBufferGeometry:nw,ConeGeometry:ow,CubeCamera:xl,CubeReflectionMapping:rw,CubeRefractionMapping:iw,CubeTexture:fl,CubeTextureLoader:sw,CubeUVReflectionMapping:aw,CubicBezierCurve:cw,CubicBezierCurve3:lw,CubicInterpolant:uw,CullFaceBack:pw,CullFaceFront:dw,CullFaceFrontBack:hw,CullFaceNone:mw,Curve:xw,CurvePath:fw,CustomBlending:gw,CustomToneMapping:ww,CylinderBufferGeometry:Fw,CylinderGeometry:gl,Cylindrical:Aw,Data3DTexture:_w,DataArrayTexture:Sw,DataTexture:Tw,DataTextureLoader:vw,DataUtils:kw,DecrementStencilOp:Mw,DecrementWrapStencilOp:Ew,DefaultLoadingManager:bw,DepthFormat:yw,DepthStencilFormat:Dw,DepthTexture:Cw,DirectionalLight:yr,DirectionalLightHelper:Bw,DiscreteInterpolant:Lw,DisplayP3ColorSpace:Rw,DodecahedronBufferGeometry:Pw,DodecahedronGeometry:Iw,DoubleSide:wl,DstAlphaFactor:Vw,DstColorFactor:Ww,DynamicCopyUsage:Ow,DynamicDrawUsage:Fl,DynamicReadUsage:Hw,EdgesGeometry:Nw,EllipseCurve:Gw,EqualDepth:Xw,EqualStencilFunc:Uw,EquirectangularReflectionMapping:zw,EquirectangularRefractionMapping:jw,Euler:Al,EventDispatcher:qw,ExtrudeBufferGeometry:Qw,ExtrudeGeometry:Kw,FileLoader:Ds,Float16BufferAttribute:Jw,Float32BufferAttribute:Dr,Float64BufferAttribute:Yw,FloatType:Zw,Fog:$w,FogExp2:eF,FramebufferTexture:tF,FrontSide:Cs,Frustum:nF,GLBufferAttribute:oF,GLSL1:rF,GLSL3:iF,GreaterDepth:sF,GreaterEqualDepth:aF,GreaterEqualStencilFunc:cF,GreaterStencilFunc:lF,GridHelper:_l,Group:Cr,HalfFloatType:uF,HemisphereLight:pF,HemisphereLightHelper:dF,HemisphereLightProbe:hF,IcosahedronBufferGeometry:mF,IcosahedronGeometry:xF,ImageBitmapLoader:Sl,ImageLoader:fF,ImageUtils:gF,IncrementStencilOp:wF,IncrementWrapStencilOp:FF,InstancedBufferAttribute:ah,InstancedBufferGeometry:Tl,InstancedInterleavedBuffer:vo,InstancedMesh:Br,Int16BufferAttribute:AF,Int32BufferAttribute:_F,Int8BufferAttribute:SF,IntType:TF,InterleavedBuffer:Bs,InterleavedBufferAttribute:dt,Interpolant:vl,InterpolateDiscrete:kl,InterpolateLinear:Ls,InterpolateSmooth:vF,InvertStencilOp:kF,KeepStencilOp:MF,KeyframeTrack:EF,LOD:bF,LatheBufferGeometry:yF,LatheGeometry:DF,Layers:CF,LessDepth:BF,LessEqualDepth:LF,LessEqualStencilFunc:RF,LessStencilFunc:PF,Light:IF,LightProbe:VF,Line:Ml,Line3:El,LineBasicMaterial:Rs,LineCurve:WF,LineCurve3:OF,LineDashedMaterial:HF,LineLoop:bl,LineSegments:yl,LinearEncoding:Dl,LinearFilter:ko,LinearInterpolant:NF,LinearMipMapLinearFilter:GF,LinearMipMapNearestFilter:XF,LinearMipmapLinearFilter:Ps,LinearMipmapNearestFilter:Cl,LinearSRGBColorSpace:UF,LinearToneMapping:zF,Loader:Bl,LoaderUtils:Lr,LoadingManager:jF,LoopOnce:qF,LoopPingPong:QF,LoopRepeat:KF,LuminanceAlphaFormat:JF,LuminanceFormat:YF,MOUSE:ZF,Material:Rr,MaterialLoader:$F,MathUtils:Pr,Matrix3:Is,Matrix4:de,MaxEquation:e1,Mesh:rt,MeshBasicMaterial:it,MeshDepthMaterial:t1,MeshDistanceMaterial:n1,MeshLambertMaterial:o1,MeshMatcapMaterial:r1,MeshNormalMaterial:i1,MeshPhongMaterial:Pn,MeshPhysicalMaterial:Pt,MeshStandardMaterial:Vs,MeshToonMaterial:s1,MinEquation:a1,MirroredRepeatWrapping:Ll,MixOperation:c1,MultiplyBlending:l1,MultiplyOperation:u1,NearestFilter:Ir,NearestMipMapLinearFilter:p1,NearestMipMapNearestFilter:d1,NearestMipmapLinearFilter:Rl,NearestMipmapNearestFilter:Pl,NeverDepth:h1,NeverStencilFunc:m1,NoBlending:x1,NoColorSpace:f1,NoToneMapping:g1,NormalAnimationBlendMode:w1,NormalBlending:F1,NotEqualDepth:A1,NotEqualStencilFunc:_1,NumberKeyframeTrack:Il,Object3D:De,ObjectLoader:S1,ObjectSpaceNormalMap:T1,OctahedronBufferGeometry:v1,OctahedronGeometry:k1,OneFactor:M1,OneMinusDstAlphaFactor:E1,OneMinusDstColorFactor:b1,OneMinusSrcAlphaFactor:y1,OneMinusSrcColorFactor:D1,OrthographicCamera:Vr,PCFShadowMap:C1,PCFSoftShadowMap:B1,PMREMGenerator:L1,Path:R1,PerspectiveCamera:Mo,Plane:P1,PlaneBufferGeometry:I1,PlaneGeometry:Wr,PlaneHelper:V1,PointLight:Vl,PointLightHelper:W1,Points:Wl,PointsMaterial:Ol,PolarGridHelper:O1,PolyhedronBufferGeometry:H1,PolyhedronGeometry:N1,PositionalAudio:G1,PropertyBinding:Hl,PropertyMixer:X1,QuadraticBezierCurve:U1,QuadraticBezierCurve3:z1,Quaternion:te,QuaternionKeyframeTrack:Ws,QuaternionLinearInterpolant:j1,RED_GREEN_RGTC2_Format:q1,RED_RGTC1_Format:Q1,REVISION:K1,RGBADepthPacking:J1,RGBAFormat:Nl,RGBAIntegerFormat:Y1,RGBA_ASTC_10x10_Format:Z1,RGBA_ASTC_10x5_Format:$1,RGBA_ASTC_10x6_Format:e0,RGBA_ASTC_10x8_Format:t0,RGBA_ASTC_12x10_Format:n0,RGBA_ASTC_12x12_Format:o0,RGBA_ASTC_4x4_Format:r0,RGBA_ASTC_5x4_Format:i0,RGBA_ASTC_5x5_Format:s0,RGBA_ASTC_6x5_Format:a0,RGBA_ASTC_6x6_Format:c0,RGBA_ASTC_8x5_Format:l0,RGBA_ASTC_8x6_Format:u0,RGBA_ASTC_8x8_Format:p0,RGBA_BPTC_Format:d0,RGBA_ETC2_EAC_Format:h0,RGBA_PVRTC_2BPPV1_Format:m0,RGBA_PVRTC_4BPPV1_Format:x0,RGBA_S3TC_DXT1_Format:f0,RGBA_S3TC_DXT3_Format:g0,RGBA_S3TC_DXT5_Format:w0,RGB_ETC1_Format:F0,RGB_ETC2_Format:A0,RGB_PVRTC_2BPPV1_Format:_0,RGB_PVRTC_4BPPV1_Format:S0,RGB_S3TC_DXT1_Format:T0,RGFormat:v0,RGIntegerFormat:k0,RawShaderMaterial:M0,Ray:E0,Raycaster:Gl,RectAreaLight:b0,RedFormat:y0,RedIntegerFormat:D0,ReinhardToneMapping:C0,RepeatWrapping:Or,ReplaceStencilOp:B0,ReverseSubtractEquation:L0,RingBufferGeometry:R0,RingGeometry:P0,SIGNED_RED_GREEN_RGTC2_Format:I0,SIGNED_RED_RGTC1_Format:V0,SRGBColorSpace:In,Scene:Vn,ShaderChunk:W0,ShaderLib:Eo,ShaderMaterial:Hr,ShadowMaterial:O0,Shape:H0,ShapeBufferGeometry:N0,ShapeGeometry:G0,ShapePath:X0,ShapeUtils:U0,ShortType:z0,Skeleton:Xl,SkeletonHelper:j0,SkinnedMesh:Ul,Source:q0,Sphere:Wn,SphereBufferGeometry:Q0,SphereGeometry:Nr,Spherical:K0,SphericalHarmonics3:J0,SplineCurve:Y0,SpotLight:zl,SpotLightHelper:Z0,Sprite:$0,SpriteMaterial:ch,SrcAlphaFactor:eA,SrcAlphaSaturateFactor:tA,SrcColorFactor:nA,StaticCopyUsage:oA,StaticDrawUsage:rA,StaticReadUsage:iA,StereoCamera:jl,StreamCopyUsage:sA,StreamDrawUsage:aA,StreamReadUsage:cA,StringKeyframeTrack:lA,SubtractEquation:uA,SubtractiveBlending:pA,TOUCH:dA,TangentSpaceNormalMap:hA,TetrahedronBufferGeometry:mA,TetrahedronGeometry:xA,Texture:Gr,TextureLoader:ql,TorusBufferGeometry:fA,TorusGeometry:gA,TorusKnotBufferGeometry:wA,TorusKnotGeometry:FA,Triangle:AA,TriangleFanDrawMode:bo,TriangleStripDrawMode:Xr,TrianglesDrawMode:Ql,TubeBufferGeometry:_A,TubeGeometry:SA,TwoPassDoubleSide:TA,UVMapping:vA,Uint16BufferAttribute:kA,Uint32BufferAttribute:MA,Uint8BufferAttribute:EA,Uint8ClampedBufferAttribute:bA,Uniform:yA,UniformsGroup:DA,UniformsLib:yo,UniformsUtils:Os,UnsignedByteType:CA,UnsignedInt248Type:BA,UnsignedIntType:LA,UnsignedShort4444Type:RA,UnsignedShort5551Type:PA,UnsignedShortType:IA,VSMShadowMap:VA,Vector2:ve,Vector3:W,Vector4:ft,VectorKeyframeTrack:Kl,VideoTexture:lh,WebGL1Renderer:WA,WebGL3DRenderTarget:OA,WebGLArrayRenderTarget:HA,WebGLCubeRenderTarget:Jl,WebGLMultipleRenderTargets:NA,WebGLRenderTarget:Hs,WebGLRenderer:Yl,WebGLUtils:GA,WireframeGeometry:Zl,WrapAroundEnding:XA,ZeroCurvatureEnding:UA,ZeroFactor:zA,ZeroSlopeEnding:jA,ZeroStencilOp:qA,_SRGBAFormat:QA,sRGBEncoding:$l}=THREE;async function ae(n,e){let{status:t,requestPath:o,responsePath:r,content:i,contentType:s,contentLength:l,fileName:u,headers:h,date:x}=n;return{status:t,requestPath:o,responsePath:r,content:E(e)?await e(i):void 0,contentType:s,contentLength:l,fileName:u,headers:h,date:x}}var Do=class extends vr{constructor(e,t,o,r){if(!go.matches(o)&&!Pc.matches(o))throw new Error("Only GLTF model types are currently supported");super(t,o,r),this.env=e}async getResponse(e){let t=await e.file();return ae(t,o=>this.env.loadGltf(o))}};var It=class extends ce{constructor(){super(...arguments),this.attached=new Array,this.soFar=null,this.total=null,this.msg=null,this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(e,t,o,r){this.soFar=e,this.total=t,this.msg=o,this.est=r;for(let i of this.attached)i.report(e,t,o,r)}attach(e){this.attached.push(e),e.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(e){this.report(0,1,e||"starting")}end(e){this.report(1,1,e||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,ye(this.attached)}};function Ur(n){return!(n.shiftKey||n.altKey||n.ctrlKey||n.metaKey)}var eu=["change","click","contextmenu","dblclick","mouseup","pointerup","reset","submit","touchend"];function tu(n,e=!1){let t=async o=>{if(o.isTrusted){if(!e)for(let r of eu)window.removeEventListener(r,t);n()}};for(let o of eu)window.addEventListener(o,t)}var Je=Math.PI,zr=.5*Je,Mt=2*Je;var uh=864e13,d_=-uh;function Vt(n){return(n%Mt+Mt)%Mt}function un(n,e,t){return Math.min(t,Math.max(e,n))}function gt(n){return n*Mt/360}function nu(n){return n*360/Mt}function ou(...n){let e=Number.MAX_VALUE;for(let t of n)Math.abs(t)<e&&(e=t);return e}function ru(n,e,t){return(1-t)*n+t*e}function iu(n){return Math.abs(n)>1e-4?n:0}var Co=new W;function Bo(n){return Co.copy(n),Co.y=0,Co.normalize(),Vt(Math.atan2(Co.x,Co.z))}function su(n){return Vt(Math.asin(n.y))}var Fe;(function(n){n[n.Primary=0]="Primary",n[n.Secondary=1]="Secondary",n[n.Menu=2]="Menu",n[n.Info=3]="Info"})(Fe||(Fe={}));function Et(n){return E(n)&&n.isMesh}function Ns(n){return E(n)&&n.isMaterial}function Gs(n,e){return Ns(e)&&e.type===n}function Lo(n){return Gs("MeshStandardMaterial",n)}function Ro(n){return Gs("MeshPhongMaterial",n)}function Po(n){return Gs("MeshPhysicalMaterial",n)}function au(n){return E(n)&&n.isObject3D}function cu(n){return E(n)&&n.isQuaternion}function lu(n){return E(n)&&n.isEuler}function ph(n){return E(n)&&au(n.object)}function ht(n){return ph(n)?n.object:n}function wt(n,e){return n=ht(n),n.visible=e,e}function On(n){return n=ht(n),n.visible}function Xs(n){if(!n)return!1;for(n=ht(n);n;){if(!n.visible)return!1;n=n.parent}return!0}function ne(n,...e){let t=e.filter(E).map(ht);return t.length>0&&ht(n).add(...t),n}function Oe(n,...e){let t=new De;return t.name=n,ne(t,...e),t}function pn(n,e){return n.xr.isPresenting?n.xr.getCamera():e}function uu(n,e,t,o){let r=n.elements;e.set(r[4],r[5],r[6]),t.set(-r[8],-r[9],-r[10]),o.set(r[12],r[13],r[14]),e.normalize(),t.normalize()}function dh(n){return n===DeviceOrientationEvent&&"requestPermission"in n&&ee(n.requestPermission)}var xe;(function(n){n.None="none",n.MouseFPS="mousefirstperson",n.MouseDrag="mousedrag",n.ScreenEdge="mouseedge",n.Touch="touchswipe",n.Gamepad="gamepad"})(xe||(xe={}));var Us=class extends me{constructor(){super("avatarreset")}},jr=class extends ce{set disableVertical(e){this._disableVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set invertVertical(e){this._invertVertical=e,this.axisControl.x=this._disableVertical?0:this._invertVertical?1:-1}set disableHorizontal(e){this._disableHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}set invertHorizontal(e){this._invertHorizontal=e,this.axisControl.y=this._disableHorizontal?0:this._invertHorizontal?1:-1}get height(){return this.head.position.y}get object(){return this.head}get worldHeadingRadians(){return this._worldHeadingRadians}get worldPitchRadians(){return this._worldPitchRadians}get fov(){return this.env.camera.fov}set fov(e){e!==this.fov&&(this.env.camera.fov=e,this.env.camera.updateProjectionMatrix())}get stage(){return this.head.parent}constructor(e,t){super(),this.env=e,this.avatarResetEvt=new Us,this.controlMode=xe.None,this.snapTurnRadians=gt(30),this.sensitivities=new Map([[xe.MouseDrag,100],[xe.MouseFPS,-100],[xe.Touch,50],[xe.Gamepad,1]]),this.B=new W(0,0,1),this.F=new W,this.U=new W,this.P=new W,this.M=new de,this.E=new Al,this.Q1=new te,this.Q2=new te,this.Q3=new te(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this.Q4=new te,this.motion=new ve,this.rotStage=new de,this.axisControl=new ve(0,0),this.deviceQ=new te().identity(),this.uv=new ve,this.duv=new ve,this.move=new W,this.move2=new W,this.radialAcceleration=new ve(1.5,1.5),this.radialSpeed=new ve(1,1),this.radialEdgeFactor=3/4,this.minFOVDegrees=15,this.maxFOVDegrees=120,this.minPitchRadians=gt(-85),this.maxPitchRadians=gt(85),this.followers=new Array,this.dz=0,this._headingRadians=0,this._pitchRadians=0,this._rollRadians=0,this.headX=0,this.headZ=0,this._worldHeadingRadians=0,this._worldPitchRadians=0,this.fwrd=!1,this.back=!1,this.left=!1,this.rght=!1,this.fwrd2=!1,this.back2=!1,this.left2=!1,this.rght2=!1,this.up=!1,this.down=!1,this.grow=!1,this.shrk=!1,this._keyboardControlEnabled=!1,this.worldPos=new W,this.worldQuat=new te,this.lockMovement=!1,this.fovZoomEnabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.onDeviceOrientationChangeEvent=null,this.onScreenOrientationChangeEvent=null,this.motionEnabled=!1,this.pointersToSend=new Array,this.disableHorizontal=!1,this.disableVertical=!1,this.invertHorizontal=!1,this.invertVertical=!0,this._height=this.env.defaultAvatarHeight,this.head=Oe("Head",t);let o=!1,r=(i,s)=>{if(i==="w"&&(this.fwrd=s),i==="s"&&(this.back=s),i==="a"&&(this.left=s),i==="d"&&(this.rght=s),i==="e"&&(this.up=s),i==="q"&&(this.down=s),i==="ArrowUp"&&(this.fwrd2=s),i==="ArrowDown"&&(this.back2=s),i==="ArrowLeft"&&(this.left2=s),i==="ArrowRight"&&(this.rght2=s),i==="r"&&(this.grow=s),i==="f"&&(this.shrk=s),i==="Home"){let l=o;o=s,l&&!o&&(this.reset(),this.dispatchEvent(this.avatarResetEvt))}};this.onKeyDown=i=>r(i.key,Ur(i)),this.onKeyUp=i=>r(i.key,!1),this.keyboardControlEnabled=!0,matchMedia("(pointer: coarse)").matches?this.controlMode=xe.Touch:matchMedia("(pointer: fine)").matches&&(this.controlMode=xe.MouseDrag),globalThis.isSecureContext&&vs()&&!So()&&(this.onDeviceOrientationChangeEvent=i=>{this.deviceOrientation=i},this.onScreenOrientationChangeEvent=()=>{"screen"in globalThis&&"orientation"in screen?this.screenOrientation=screen.orientation.angle:"window"in globalThis&&"orientation"in globalThis.window&&(this.screenOrientation=globalThis.window.orientation||0)},tl?tu(()=>this.startMotionControl()):this.startMotionControl())}snapTurn(e){this.setHeading(this.headingRadians-this.snapTurnRadians*e)}get keyboardControlEnabled(){return this._keyboardControlEnabled}set keyboardControlEnabled(e){this._keyboardControlEnabled!==e&&(this._keyboardControlEnabled=e,this._keyboardControlEnabled?(this.env.renderer.domElement.addEventListener("keydown",this.onKeyDown),this.env.renderer.domElement.addEventListener("keyup",this.onKeyUp)):(this.env.renderer.domElement.removeEventListener("keydown",this.onKeyDown),this.env.renderer.domElement.removeEventListener("keyup",this.onKeyUp)))}addFollower(e){this.followers.push(e)}onMove(e,t,o){this.setMode(e),e.canMoveView&&this.controlMode!==xe.None&&this.gestureSatisfied(e)&&(this.uv.copy(t),this.duv.copy(o))}setMode(e){e.type==="remote"||e.type==="nose"||(e.type==="hand"?this.controlMode=xe.None:e.type==="gamepad"?this.controlMode=xe.Gamepad:e.rayTarget&&e.rayTarget.draggable&&!this.env.eventSys.mouse.isPointerLocked&&e.isPressed(Fe.Primary)?this.controlMode=xe.ScreenEdge:e.type==="touch"||e.type==="pen"?this.controlMode=xe.Touch:e.type==="mouse"?this.controlMode=this.env.eventSys.mouse.isPointerLocked?xe.MouseFPS:xe.MouseDrag:Pe(e.type))}gestureSatisfied(e){return this.controlMode===xe.None?!1:this.controlMode===xe.Gamepad||this.controlMode===xe.MouseFPS||this.controlMode===xe.ScreenEdge||e.isPressed(Fe.Primary)}get name(){return this.object.name}set name(e){this.object.name=e}get headingRadians(){return this._headingRadians}setHeading(e){this._headingRadians=Vt(e)}get pitchRadians(){return this._pitchRadians}setPitch(e,t,o){this._pitchRadians=Vt(e+Je)-Je,this._pitchRadians=un(this._pitchRadians,t,o)}get rollRadians(){return this._rollRadians}setRoll(e){this._rollRadians=Vt(e)}setHeadingImmediate(e){this.setHeading(e),this.updateOrientation(),this.resetFollowers()}setOrientationImmediate(e,t){this.setHeading(e),this._pitchRadians=Vt(t),this.updateOrientation()}zoom(e){this.dz=e}update(e){e*=.001;let t=this.deviceOrientation;if(t&&on(t.alpha)&&on(t.beta)&&on(t.gamma)){let o=gt(t.alpha)+this.alphaOffset,r=gt(t.beta),i=gt(t.gamma),s=this.screenOrientation?gt(this.screenOrientation):0;this.E.set(r,o,-i,"YXZ"),this.Q2.setFromAxisAngle(this.B,-s),this.Q4.setFromEuler(this.E).multiply(this.Q3).multiply(this.Q2),this.deviceQ.slerp(this.Q4,.8)}if(!this.lockMovement){if(this.fovZoomEnabled&&Math.abs(this.dz)>0){let r=Math.pow(.95,5e3*e);this.dz=iu(r*this.dz),this.fov=un(this.env.camera.fov-this.dz,this.minFOVDegrees,this.maxFOVDegrees)}if(this.controlMode===xe.ScreenEdge)this.uv.manhattanLength()>0&&(this.motion.set(this.scaleRadialComponent(-this.uv.x,this.radialSpeed.x,this.radialAcceleration.x),this.scaleRadialComponent(this.uv.y,this.radialSpeed.y,this.radialAcceleration.y)).multiplyScalar(e),this.setHeading(this.headingRadians+this.motion.x),this.setPitch(this.pitchRadians+this.motion.y,this.minPitchRadians,this.maxPitchRadians),this.setRoll(0));else if(this.sensitivities.has(this.controlMode)&&this.duv.manhattanLength()>0){let r=this.sensitivities.get(this.controlMode)||1;this.motion.copy(this.duv).multiplyScalar(r*e).multiply(this.axisControl),this.setHeading(this.headingRadians+this.motion.x),this.setPitch(this.pitchRadians+this.motion.y,this.minPitchRadians,this.maxPitchRadians),this.setRoll(0)}if(this.Q1.setFromAxisAngle(this.stage.up,this.worldHeadingRadians),this.fwrd||this.back||this.left||this.rght||this.up||this.down){let r=(this.left?1:0)+(this.rght?-1:0),i=(this.down?1:0)+(this.up?-1:0),s=(this.fwrd?1:0)+(this.back?-1:0);this.move.set(r,i,s);let l=this.move.length();l>0&&(this.move.multiplyScalar(e/l).applyQuaternion(this.Q1),this.stage.position.add(this.move))}if(this.fwrd2||this.back2||this.left2||this.rght2){let r=(this.left2?1:0)+(this.rght2?-1:0),i=(this.fwrd2?1:0)+(this.back2?-1:0);this.move2.set(r,0,i);let s=this.move2.length();s>0&&(this.move2.multiplyScalar(e/s).applyQuaternion(this.Q1),this.headX+=this.move2.x,this.headZ+=this.move2.z)}if(this.grow||this.shrk){let r=(this.shrk?-1:0)+(this.grow?1:0);this._height+=r*e,this._height=un(this._height,1,2)}this.updateOrientation();let o=Math.pow(.95,100*e);this.duv.multiplyScalar(o),this.duv.manhattanLength()<=1e-4&&this.duv.setScalar(0)}}scaleRadialComponent(e,t,o){let r=Math.abs(e);return Math.sign(e)*Math.pow(Math.max(0,r-this.radialEdgeFactor)/(1-this.radialEdgeFactor),o)*t}lookAt(e){e.getWorldPosition(this.P),this.P.sub(this.worldPos);let t=3*zr-Math.atan2(this.P.z,this.P.x),o=Math.atan2(this.P.y,this.P.length());this.setOrientationImmediate(t,o)}updateOrientation(){let e=pn(this.env.renderer,this.env.camera);this.rotStage.makeRotationY(this._headingRadians),this.stage.matrix.makeTranslation(this.stage.position.x,this.stage.position.y,this.stage.position.z).multiply(this.rotStage),this.stage.matrix.decompose(this.stage.position,this.stage.quaternion,this.stage.scale),this.env.renderer.xr.isPresenting?(this.M.copy(this.stage.matrixWorld).invert(),this.head.position.copy(e.position).applyMatrix4(this.M),this.head.quaternion.copy(this.stage.quaternion).invert().multiply(e.quaternion)):(this.head.position.set(this.headX,this._height,this.headZ),this.E.set(this._pitchRadians,0,this._rollRadians,"XYZ"),this.head.quaternion.setFromEuler(this.E).premultiply(this.deviceQ)),this.env.camera.position.copy(this.head.position),this.env.camera.quaternion.copy(this.head.quaternion),this.head.getWorldPosition(this.worldPos),this.head.getWorldQuaternion(this.worldQuat),this.F.set(0,0,-1).applyQuaternion(this.worldQuat),this._worldHeadingRadians=Bo(this.F),this._worldPitchRadians=su(this.F),uu(this.head.matrixWorld,this.U,this.F,this.P)}reset(){this.stage.position.setScalar(0),this.setHeadingImmediate(0)}resetFollowers(){for(let e of this.followers)e.reset(this.height,this.worldPos,this.worldHeadingRadians)}async getPermission(){return"DeviceOrientationEvent"in window?dh(DeviceOrientationEvent)?await DeviceOrientationEvent.requestPermission():"granted":"not-supported"}async startMotionControl(){if(!this.motionEnabled){this.onScreenOrientationChangeEvent();let e=await this.getPermission();this.motionEnabled=e==="granted",this.motionEnabled&&("ScreenOrientation"in window?screen.orientation.addEventListener("change",this.onScreenOrientationChangeEvent):window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}}stopMotionControl(){this.motionEnabled&&("ScreenOrientation"in window?screen.orientation.removeEventListener("change",this.onScreenOrientationChangeEvent):window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.motionEnabled=!1)}dispose(){this.stopMotionControl()}get bufferSize(){return 133}writeState(e){ye(this.pointersToSend);let t=this.env.avatar.bufferSize;for(let o of this.env.eventSys.pointers)o.canSend&&(t+=o.bufferSize,this.pointersToSend.push(o));e.length=t,e.position=0,e.writeFloat32(this.height),e.writeMatrix512(this.stage.matrix),e.writeMatrix512(this.head.matrixWorld),e.writeUint8(this.pointersToSend.length);for(let o of this.pointersToSend)o.writeState(e)}};function pu(n){let e=n.attributes.position,t=n.attributes.normal,o=n.attributes.uv;for(let r=0;r<t.count;++r){let i=r*t.itemSize,s=r*t.itemSize+1,l=r*t.itemSize+2,u=t.array[i],h=t.array[s],x=t.array[l],g=Math.abs(u),A=Math.abs(h),_=Math.abs(x),M=e.array[i],B=e.array[s],y=e.array[l],V=Math.abs(M),I=Math.abs(B),L=Math.abs(y),D=r*o.itemSize,O=r*o.itemSize+1,C=o.array[D],R=o.array[O],j=0,ie=g,Q=V;A>ie&&(j=1,ie=A,Q=I),_>ie&&(j=2,ie=_,Q=L),j===0?M<0?(C=-y,R=B):(C=y,R=B):j===1?B<0?(C=M,R=-y):(C=M,R=y):y<0?(C=M,R=B):(C=-M,R=B),C=(C/Q+1)/8,R=(R/Q+1)/6,j===0?M<0?(C+=0,R+=1/3):(C+=.5,R+=1/3):j===1?B<0?(C+=.25,R+=0):(C+=.25,R+=2/3):y<0?(C+=.25,R+=1/3):(C+=.75,R+=1/3);let Y=o.array;Y[D]=C,Y[O]=R}}var Io=new br(1,1,1,1,1,1);Io.name="CubeGeom";Io.computeBoundingBox();Io.computeBoundingSphere();var du=Io.clone();du.name="InvertedCubeGeom";pu(du);var Ft=class extends rt{constructor(e,t,o,r){super(Io,r),this.scale.set(e,t,o)}};function hu(n,e,t,o,r){let i=new Ft(e,t,o,r);return i.name=n,i}function Hn(n,e){let t=globalThis,o=t[n];if(N(o)){if(N(e))throw new Error(`No value ${n} found`);o=e(),t[n]=o}return o}yo.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new ve(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};Eo.line={uniforms:Os.merge([yo.common,yo.fog,yo.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var bt=class extends Hr{constructor(e){super({type:"LineMaterial",uniforms:Os.clone(Eo.line.uniforms),vertexShader:Eo.line.vertexShader,fragmentShader:Eo.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}};bt.prototype.isLineMaterial=!0;var zs=Hn("Juniper:Three:Materials",()=>new Map);function hh(n,e){e in n&&delete n[e]}function qr(n,e,t){let o=`${n}_${Object.keys(t).map(r=>`${r}:${t[r]}`).join(",")}`;return zs.has(o)||(hh(t,"name"),zs.set(o,new e(t))),zs.get(o)}function mh(n){return Object.assign(n,{transparent:!0})}function mu(n){return qr("solid",it,n)}function js(n){return qr("solidTransparent",it,mh(n))}function qs(n){return qr("lit",Pn,n)}function xu(n){return qr("line2",bt,n)}function Qs(n,e){let t=new Set;n.traverse(o=>{if(Et(o)&&Ns(o.material)){let r=o.material,i=e(r);r!==i&&(t.add(r),o.material=i)}});for(let o of t)cn(o)}function fu(n){if(n.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let e={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,dithering:n.dithering,envMap:n.envMap,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.emissiveMap||n.map,name:n.name+"-Standard-To-Basic",opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,shadowSide:n.shadowSide,side:n.side,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[t,o]of Object.entries(e))N(o)&&delete e[t];return new it(e)}function Ks(n){if(n.type!=="MeshStandardMaterial")throw new Error("Input material is not MeshStandardMaterial");let e={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,bumpMap:n.bumpMap,bumpScale:n.bumpScale,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,displacementBias:n.displacementBias,displacementMap:n.displacementMap,displacementScale:n.displacementScale,dithering:n.dithering,emissive:n.emissive,emissiveIntensity:n.emissiveIntensity,emissiveMap:n.emissiveMap,envMap:n.envMap,flatShading:n.flatShading,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.map,name:n.name+"-Standard-To-Phong",normalMap:n.normalMap,normalMapType:n.normalMapType,normalScale:n.normalScale,opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,shadowSide:n.shadowSide,side:n.side,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[t,o]of Object.entries(e))N(o)&&delete e[t];return new Pn(e)}function gu(n){if(n.type!=="MeshPhysicalMaterial")throw new Error("Input material is not MeshPhysicalMaterial");let e={alphaMap:n.alphaMap,alphaTest:n.alphaTest,alphaToCoverage:n.alphaToCoverage,aoMap:n.aoMap,aoMapIntensity:n.aoMapIntensity,blendDst:n.blendDst,blendDstAlpha:n.blendDstAlpha,blendEquation:n.blendEquation,blendEquationAlpha:n.blendEquationAlpha,blending:n.blending,blendSrc:n.blendSrc,blendSrcAlpha:n.blendSrcAlpha,bumpMap:n.bumpMap,bumpScale:n.bumpScale,clipIntersection:n.clipIntersection,clippingPlanes:n.clippingPlanes,clipShadows:n.clipShadows,color:n.color,colorWrite:n.colorWrite,depthFunc:n.depthFunc,depthTest:n.depthTest,depthWrite:n.depthWrite,displacementBias:n.displacementBias,displacementMap:n.displacementMap,displacementScale:n.displacementScale,dithering:n.dithering,emissive:n.emissive,emissiveIntensity:n.emissiveIntensity,emissiveMap:n.emissiveMap,envMap:n.envMap,flatShading:n.flatShading,fog:n.fog,lightMap:n.lightMap,lightMapIntensity:n.lightMapIntensity,map:n.map,name:n.name+"-Standard-To-Phong",normalMap:n.normalMap,normalMapType:n.normalMapType,normalScale:n.normalScale,opacity:n.opacity,polygonOffset:n.polygonOffset,polygonOffsetFactor:n.polygonOffsetFactor,polygonOffsetUnits:n.polygonOffsetUnits,precision:n.precision,premultipliedAlpha:n.premultipliedAlpha,reflectivity:n.reflectivity,shadowSide:n.shadowSide,shininess:n.sheen,side:n.side,specular:n.specularColor,specularMap:n.specularColorMap,stencilFail:n.stencilFail,stencilFunc:n.stencilFunc,stencilFuncMask:n.stencilFuncMask,stencilRef:n.stencilRef,stencilWrite:n.stencilWrite,stencilWriteMask:n.stencilWriteMask,stencilZFail:n.stencilZFail,stencilZPass:n.stencilZPass,toneMapped:n.toneMapped,transparent:n.transparent,userData:n.userData,vertexColors:n.vertexColors,visible:n.visible,wireframe:n.wireframe,wireframeLinecap:n.wireframeLinecap,wireframeLinejoin:n.wireframeLinejoin,wireframeLinewidth:n.wireframeLinewidth};for(let[t,o]of Object.entries(e))N(o)&&delete e[t];return new Pn(e)}var xh=12632256,Js=16777215;var Ys=qs({color:xh}),wu=qs({color:Js});var Qr=class{constructor(e,t=.15){this.opacity=1,this.direction=0,this.task=new Ie(!1),this.material=js({name:"FaderMaterial",color:0,side:dl}),this.object=hu(e,1,1,1,this.material),this.object.renderOrder=Number.MAX_SAFE_INTEGER,this.speed=1/t,this.object.layers.enableAll()}async start(e){this.direction=e,this.task.restart(),await this.task}async fadeOut(){this.direction!=1&&await this.start(1)}async fadeIn(){this.direction!=-1&&await this.start(-1)}update(e){if(this.direction!==0){let t=this.direction*this.speed*e/1e3;0<=this.opacity&&this.opacity<=1&&(this.opacity+=t),(this.direction===1&&this.opacity>=1||this.direction===-1&&this.opacity<=0)&&(this.opacity=un(this.opacity,0,1),this.direction=0,this.task.resolve())}this.material.opacity=this.opacity,this.material.transparent=this.opacity<1,this.material.needsUpdate=!0}};var Kr=0;var Nn=3;function Fu(n,e){n=ht(n),n.traverse(t=>t.layers.set(e))}function Au(n,e){n=ht(n),n.traverse(t=>t.layers.enable(e))}function st(n,e,t,o,r,i){let s=new Ft(o,r,i,wu);return s.position.set(n,e,t),s}var fh=.1,Jr=class extends It{constructor(){super(),this.value=0,this.targetValue=0,this.object=Oe("LoadingBar"),this._enabled=!0,this.valueBar=new Ft(0,1,1,Ys),this.valueBar.scale.set(0,1,1);let e=Oe("ValueBarContainer");e.scale.set(1,.1,.1),ne(this,ne(e,this.valueBar),st(-.5,0,-.05,.01,.1,.01),st(-.5,0,.05,.01,.1,.01),st(.5,0,-.05,.01,.1,.01),st(.5,0,.05,.01,.1,.01),st(-.5,-.05,0,.01,.01,.1),st(.5,-.05,0,.01,.01,.1),st(-.5,.05,0,.01,.01,.1),st(.5,.05,0,.01,.01,.1),st(0,-.05,-.05,1,.01,.01),st(0,.05,-.05,1,.01,.01),st(0,-.05,.05,1,.01,.01),st(0,.05,.05,1,.01,.01)),Fu(this,Nn)}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,wt(this,On(this)||this.enabled))}report(e,t,o){super.report(e,t,o),this.targetValue=this.p}update(e){this.object.parent.visible&&(this.value=Math.min(this.targetValue,this.value+fh*e),this.valueBar.scale.set(this.value,1,1),this.valueBar.position.x=this.value/2-.5,wt(this,this.enabled&&this.value>0))}};if(!Zs()){let n=Element.prototype,e=Document.prototype;"webkitRequestFullscreen"in n?(n.requestFullscreen=n.webkitRequestFullscreen,e.exitFullscreen=e.webkitRequestFullscreen,Object.defineProperties(e,{fullscreenEnabled:{get:function(){return this.webkitFullscreenEnabled}},fullscreenElement:{get:function(){return this.webkitFullscreenElement}}})):"mozRequestFullScreen"in n?(n.requestFullscreen=n.mozRequestFullScreen,e.exitFullscreen=e.mozCancelFullScreen,Object.defineProperties(e,{fullscreenEnabled:{get:function(){return this.mozFullScreenEnabled}},fullscreenElement:{get:function(){return this.mozFullScreenElement}}})):"msRequestFullscreen"in n&&(n.requestFullscreen=n.msRequestFullscreen,e.exitFullscreen=e.msExitFullscreen,Object.defineProperties(e,{fullscreenEnabled:{get:function(){return this.msFullscreenEnabled}},fullscreenElement:{get:function(){return this.msFullscreenElement}}}))}function Zs(){return"requestFullscreen"in HTMLElement.prototype}var gh=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},Yr=gh;var Vo=Symbol("@@webxr-polyfill/EventTarget"),yt=class{constructor(){this[Vo]={listeners:new Map}}addEventListener(e,t){if(typeof e!="string")throw new Error("`type` must be a string");if(typeof t!="function")throw new Error("`listener` must be a function");let o=this[Vo].listeners.get(e)||[];o.push(t),this[Vo].listeners.set(e,o)}removeEventListener(e,t){if(typeof e!="string")throw new Error("`type` must be a string");if(typeof t!="function")throw new Error("`listener` must be a function");let o=this[Vo].listeners.get(e)||[];for(let r=o.length;r>=0;r--)o[r]===t&&o.pop()}dispatchEvent(e,t){let o=this[Vo].listeners.get(e)||[],r=[];for(let i=0;i<o.length;i++)r[i]=o[i];for(let i of r)i(t);typeof this[`on${e}`]=="function"&&this[`on${e}`](t)}};var ke=typeof Float32Array<"u"?Float32Array:Array;var A2=Math.PI/180;function At(){let n=new ke(16);return ke!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function _u(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Wt(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function dn(n,e){let t=e[0],o=e[1],r=e[2],i=e[3],s=e[4],l=e[5],u=e[6],h=e[7],x=e[8],g=e[9],A=e[10],_=e[11],M=e[12],B=e[13],y=e[14],V=e[15],I=t*l-o*s,L=t*u-r*s,D=t*h-i*s,O=o*u-r*l,C=o*h-i*l,R=r*h-i*u,j=x*B-g*M,ie=x*y-A*M,Q=x*V-_*M,Y=g*y-A*B,le=g*V-_*B,Ee=A*V-_*y,oe=I*Ee-L*le+D*Y+O*Q-C*ie+R*j;return oe?(oe=1/oe,n[0]=(l*Ee-u*le+h*Y)*oe,n[1]=(r*le-o*Ee-i*Y)*oe,n[2]=(B*R-y*C+V*O)*oe,n[3]=(A*C-g*R-_*O)*oe,n[4]=(u*Q-s*Ee-h*ie)*oe,n[5]=(t*Ee-r*Q+i*ie)*oe,n[6]=(y*D-M*R-V*L)*oe,n[7]=(x*R-A*D+_*L)*oe,n[8]=(s*le-l*Q+h*j)*oe,n[9]=(o*Q-t*le-i*j)*oe,n[10]=(M*C-B*D+V*I)*oe,n[11]=(g*D-x*C-_*I)*oe,n[12]=(l*ie-s*Y-u*j)*oe,n[13]=(t*Y-o*ie+r*j)*oe,n[14]=(B*L-M*O-y*I)*oe,n[15]=(x*O-g*L+A*I)*oe,n):null}function Dt(n,e,t){let o=e[0],r=e[1],i=e[2],s=e[3],l=e[4],u=e[5],h=e[6],x=e[7],g=e[8],A=e[9],_=e[10],M=e[11],B=e[12],y=e[13],V=e[14],I=e[15],L=t[0],D=t[1],O=t[2],C=t[3];return n[0]=L*o+D*l+O*g+C*B,n[1]=L*r+D*u+O*A+C*y,n[2]=L*i+D*h+O*_+C*V,n[3]=L*s+D*x+O*M+C*I,L=t[4],D=t[5],O=t[6],C=t[7],n[4]=L*o+D*l+O*g+C*B,n[5]=L*r+D*u+O*A+C*y,n[6]=L*i+D*h+O*_+C*V,n[7]=L*s+D*x+O*M+C*I,L=t[8],D=t[9],O=t[10],C=t[11],n[8]=L*o+D*l+O*g+C*B,n[9]=L*r+D*u+O*A+C*y,n[10]=L*i+D*h+O*_+C*V,n[11]=L*s+D*x+O*M+C*I,L=t[12],D=t[13],O=t[14],C=t[15],n[12]=L*o+D*l+O*g+C*B,n[13]=L*r+D*u+O*A+C*y,n[14]=L*i+D*h+O*_+C*V,n[15]=L*s+D*x+O*M+C*I,n}function Ot(n,e,t){let o=e[0],r=e[1],i=e[2],s=e[3],l=o+o,u=r+r,h=i+i,x=o*l,g=o*u,A=o*h,_=r*u,M=r*h,B=i*h,y=s*l,V=s*u,I=s*h;return n[0]=1-(_+B),n[1]=g+I,n[2]=A-V,n[3]=0,n[4]=g-I,n[5]=1-(x+B),n[6]=M+y,n[7]=0,n[8]=A+V,n[9]=M-y,n[10]=1-(x+_),n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n}function Zr(n,e){return n[0]=e[12],n[1]=e[13],n[2]=e[14],n}function $r(n,e){let t=e[0]+e[5]+e[10],o=0;return t>0?(o=Math.sqrt(t+1)*2,n[3]=.25*o,n[0]=(e[6]-e[9])/o,n[1]=(e[8]-e[2])/o,n[2]=(e[1]-e[4])/o):e[0]>e[5]&&e[0]>e[10]?(o=Math.sqrt(1+e[0]-e[5]-e[10])*2,n[3]=(e[6]-e[9])/o,n[0]=.25*o,n[1]=(e[1]+e[4])/o,n[2]=(e[8]+e[2])/o):e[5]>e[10]?(o=Math.sqrt(1+e[5]-e[0]-e[10])*2,n[3]=(e[8]-e[2])/o,n[0]=(e[1]+e[4])/o,n[1]=.25*o,n[2]=(e[6]+e[9])/o):(o=Math.sqrt(1+e[10]-e[0]-e[5])*2,n[3]=(e[1]-e[4])/o,n[0]=(e[8]+e[2])/o,n[1]=(e[6]+e[9])/o,n[2]=.25*o),n}function ei(n,e,t,o,r){let i=1/Math.tan(e/2),s;return n[0]=i/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,r!=null&&r!==1/0?(s=1/(o-r),n[10]=(r+o)*s,n[14]=2*r*o*s):(n[10]=-1,n[14]=-2*o),n}function Ye(){let n=new ke(3);return ke!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function $s(n){var e=new ke(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function wh(n){let e=n[0],t=n[1],o=n[2];return Math.sqrt(e*e+t*t+o*o)}function Ue(n,e,t){let o=new ke(3);return o[0]=n,o[1]=e,o[2]=t,o}function ea(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function Gn(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function ta(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function ti(n,e){let t=e[0],o=e[1],r=e[2],i=t*t+o*o+r*r;return i>0&&(i=1/Math.sqrt(i),n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i),n}function Ho(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function ni(n,e,t){let o=e[0],r=e[1],i=e[2],s=t[0],l=t[1],u=t[2];return n[0]=r*u-i*l,n[1]=i*s-o*u,n[2]=o*l-r*s,n}function mn(n,e,t){let o=t[0],r=t[1],i=t[2],s=t[3],l=e[0],u=e[1],h=e[2],x=r*h-i*u,g=i*l-o*h,A=o*u-r*l,_=r*A-i*g,M=i*x-o*A,B=o*g-r*x,y=s*2;return x*=y,g*=y,A*=y,_*=2,M*=2,B*=2,n[0]=l+x+_,n[1]=u+g+M,n[2]=h+A+B,n}function Tu(n,e){let t=Ue(n[0],n[1],n[2]),o=Ue(e[0],e[1],e[2]);ti(t,t),ti(o,o);let r=Ho(t,o);return r>1?0:r<-1?Math.PI:Math.acos(r)}var vu=wh;var _2=function(){let n=Ye();return function(e,t,o,r,i,s){let l,u;for(t||(t=3),o||(o=0),r?u=Math.min(r*t+o,e.length):u=e.length,l=o;l<u;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],i(n,n,s),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2];return e}}();function ku(){let n=new ke(9);return ke!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Ah(){let n=new ke(4);return ke!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Mu(n){let e=new ke(4);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function Eu(n,e,t,o){let r=new ke(4);return r[0]=n,r[1]=e,r[2]=t,r[3]=o,r}function bu(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function yu(n,e){let t=e[0],o=e[1],r=e[2],i=e[3],s=t*t+o*o+r*r+i*i;return s>0&&(s=1/Math.sqrt(s),n[0]=t*s,n[1]=o*s,n[2]=r*s,n[3]=i*s),n}var S2=function(){let n=Ah();return function(e,t,o,r,i,s){let l,u;for(t||(t=4),o||(o=0),r?u=Math.min(r*t+o,e.length):u=e.length,l=o;l<u;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],n[3]=e[l+3],i(n,n,s),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2],e[l+3]=n[3];return e}}();function Ze(){let n=new ke(4);return ke!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Sh(n,e,t){t=t*.5;let o=Math.sin(t);return n[0]=o*e[0],n[1]=o*e[1],n[2]=o*e[2],n[3]=Math.cos(t),n}function na(n,e,t){let o=e[0],r=e[1],i=e[2],s=e[3],l=t[0],u=t[1],h=t[2],x=t[3];return n[0]=o*x+s*l+r*h-i*u,n[1]=r*x+s*u+i*l-o*h,n[2]=i*x+s*h+o*u-r*l,n[3]=s*x-o*l-r*u-i*h,n}function Xn(n,e,t,o){let r=e[0],i=e[1],s=e[2],l=e[3],u=t[0],h=t[1],x=t[2],g=t[3],A,_,M,B,y;return _=r*u+i*h+s*x+l*g,_<0&&(_=-_,u=-u,h=-h,x=-x,g=-g),1-_>1e-6?(A=Math.acos(_),M=Math.sin(A),B=Math.sin((1-o)*A)/M,y=Math.sin(o*A)/M):(B=1-o,y=o),n[0]=B*r+y*u,n[1]=B*i+y*h,n[2]=B*s+y*x,n[3]=B*l+y*g,n}function oa(n,e){let t=e[0],o=e[1],r=e[2],i=e[3],s=t*t+o*o+r*r+i*i,l=s?1/s:0;return n[0]=-t*l,n[1]=-o*l,n[2]=-r*l,n[3]=i*l,n}function Th(n,e){let t=e[0]+e[4]+e[8],o;if(t>0)o=Math.sqrt(t+1),n[3]=.5*o,o=.5/o,n[0]=(e[5]-e[7])*o,n[1]=(e[6]-e[2])*o,n[2]=(e[1]-e[3])*o;else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);let i=(r+1)%3,s=(r+2)%3;o=Math.sqrt(e[r*3+r]-e[i*3+i]-e[s*3+s]+1),n[r]=.5*o,o=.5/o,n[3]=(e[i*3+s]-e[s*3+i])*o,n[i]=(e[i*3+r]+e[r*3+i])*o,n[s]=(e[s*3+r]+e[r*3+s])*o}return n}function Du(n,e,t,o){let r=.5*Math.PI/180;e*=r,t*=r,o*=r;let i=Math.sin(e),s=Math.cos(e),l=Math.sin(t),u=Math.cos(t),h=Math.sin(o),x=Math.cos(o);return n[0]=i*u*x-s*l*h,n[1]=s*l*x+i*u*h,n[2]=s*u*h-i*l*x,n[3]=s*u*x+i*l*h,n}var ra=Mu,Cu=Eu,ri=bu;var No=yu;var B2=function(){let n=Ye(),e=Ue(1,0,0),t=Ue(0,1,0);return function(o,r,i){let s=Ho(r,i);return s<-.999999?(ni(n,e,r),vu(n)<1e-6&&ni(n,t,r),ti(n,n),Sh(o,n,Math.PI),o):s>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(ni(n,r,i),o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=1+s,No(o,o))}}(),L2=function(){let n=Ze(),e=Ze();return function(t,o,r,i,s,l){return Xn(n,o,s,l),Xn(e,r,i,l),Xn(t,n,e,2*l*(1-l)),t}}(),R2=function(){let n=ku();return function(e,t,o,r){return n[0]=o[0],n[3]=o[1],n[6]=o[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],No(e,Th(e,n))}}();var $=Symbol("@@webxr-polyfill/XRRigidTransform"),xn=class n{constructor(){if(this[$]={matrix:null,position:null,orientation:null,inverse:null},arguments.length===0)this[$].matrix=Wt(new Float32Array(16));else if(arguments.length===1)arguments[0]instanceof Float32Array?this[$].matrix=arguments[0]:(this[$].position=this._getPoint(arguments[0]),this[$].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(arguments.length===2)this[$].position=this._getPoint(arguments[0]),this[$].orientation=this._getPoint(arguments[1]);else throw new Error("Too many arguments!");if(this[$].matrix){let e=Ye();Zr(e,this[$].matrix),this[$].position=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2]});let t=Ze();$r(t,this[$].matrix),this[$].orientation=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2],w:t[3]})}else this[$].matrix=Wt(new Float32Array(16)),Ot(this[$].matrix,Cu(this[$].orientation.x,this[$].orientation.y,this[$].orientation.z,this[$].orientation.w),Ue(this[$].position.x,this[$].position.y,this[$].position.z))}_getPoint(e){return e instanceof DOMPointReadOnly?e:DOMPointReadOnly.fromPoint(e)}get matrix(){return this[$].matrix}get position(){return this[$].position}get orientation(){return this[$].orientation}get inverse(){if(this[$].inverse===null){let e=Wt(new Float32Array(16));dn(e,this[$].matrix),this[$].inverse=new n(e),this[$].inverse[$].inverse=this}return this[$].inverse}};var he=Symbol("@@webxr-polyfill/XRSpace");var at=class{constructor(e=null,t=null){this[he]={specialType:e,inputSource:t,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[he].specialType}get _inputSource(){return this[he].inputSource}_ensurePoseUpdated(e,t){t!=this[he].lastFrameId&&(this[he].lastFrameId=t,this._onPoseUpdate(e))}_onPoseUpdate(e){this[he].specialType=="viewer"&&(this._baseMatrix=e.getBasePoseMatrix())}set _baseMatrix(e){this[he].baseMatrix=e,this[he].inverseBaseMatrix=null}get _baseMatrix(){return this[he].baseMatrix||this[he].inverseBaseMatrix&&(this[he].baseMatrix=new Float32Array(16),dn(this[he].baseMatrix,this[he].inverseBaseMatrix)),this[he].baseMatrix}set _inverseBaseMatrix(e){this[he].inverseBaseMatrix=e,this[he].baseMatrix=null}get _inverseBaseMatrix(){return this[he].inverseBaseMatrix||this[he].baseMatrix&&(this[he].inverseBaseMatrix=new Float32Array(16),dn(this[he].inverseBaseMatrix,this[he].baseMatrix)),this[he].inverseBaseMatrix}_getSpaceRelativeTransform(e){if(!this._inverseBaseMatrix||!e._baseMatrix)return null;let t=new Float32Array(16);return Dt(t,this._inverseBaseMatrix,e._baseMatrix),new xn(t)}};var vh=1.6,Ht=Symbol("@@webxr-polyfill/XRReferenceSpace"),Go=["viewer","local","local-floor","bounded-floor","unbounded"];function kh(n){return n==="bounded-floor"||n==="local-floor"}var Nt=class n extends at{constructor(e,t=null){if(!Go.includes(e))throw new Error(`XRReferenceSpaceType must be one of ${Go}`);if(super(e),e==="bounded-floor"&&!t)throw new Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");kh(e)&&!t&&(t=Wt(new Float32Array(16)),t[13]=vh),this._inverseBaseMatrix=t||Wt(new Float32Array(16)),this[Ht]={type:e,transform:t,originOffset:Wt(new Float32Array(16))}}_transformBasePoseMatrix(e,t){Dt(e,this._inverseBaseMatrix,t)}_originOffsetMatrix(){return this[Ht].originOffset}_adjustForOriginOffset(e){let t=new Float32Array(16);dn(t,this[Ht].originOffset),Dt(e,t,e)}_getSpaceRelativeTransform(e){let t=super._getSpaceRelativeTransform(e);return this._adjustForOriginOffset(t.matrix),new XRRigidTransform(t.matrix)}getOffsetReferenceSpace(e){let t=new n(this[Ht].type,this[Ht].transform,this[Ht].bounds);return Dt(t[Ht].originOffset,this[Ht].originOffset,e.matrix),t}};var He=Symbol("@@webxr-polyfill/XR"),Mh=["inline","immersive-vr","immersive-ar"],Eh={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},bh=`Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode
or navigator.xr.requestSession('inline') prior to requesting an immersive
session. This is a limitation specific to the WebXR Polyfill and does not apply
to native implementations of the API.`,Xo=class extends yt{constructor(e){super(),this[He]={device:null,devicePromise:e,immersiveSession:null,inlineSessions:new Set},e.then(t=>{this[He].device=t})}async isSessionSupported(e){return this[He].device||await this[He].devicePromise,e!="inline"?Promise.resolve(this[He].device.isSessionSupported(e)):Promise.resolve(!0)}async requestSession(e,t){if(!this[He].device){if(e!="inline")throw new Error(bh);await this[He].devicePromise}if(!Mh.includes(e))throw new TypeError(`The provided value '${e}' is not a valid enum value of type XRSessionMode`);let o=Eh[e],r=o.requiredFeatures.concat(t&&t.requiredFeatures?t.requiredFeatures:[]),i=o.optionalFeatures.concat(t&&t.optionalFeatures?t.optionalFeatures:[]),s=new Set,l=!1;for(let g of r)this[He].device.isFeatureSupported(g)?s.add(g):(console.error(`The required feature '${g}' is not supported`),l=!0);if(l)throw new DOMException("Session does not support some required features","NotSupportedError");for(let g of i)this[He].device.isFeatureSupported(g)?s.add(g):console.log(`The optional feature '${g}' is not supported`);let u=await this[He].device.requestSession(e,s),h=new XRSession(this[He].device,e,u);e=="inline"?this[He].inlineSessions.add(h):this[He].immersiveSession=h;let x=()=>{e=="inline"?this[He].inlineSessions.delete(h):this[He].immersiveSession=null,h.removeEventListener("end",x)};return h.addEventListener("end",x),h}};var sa;if("performance"in Yr)sa=()=>performance.now();else{let n=Date.now();sa=()=>Date.now()-n}var ii=sa;var aa=Symbol("@@webxr-polyfill/XRPose"),fn=class{constructor(e,t){this[aa]={transform:e,emulatedPosition:t}}get transform(){return this[aa].transform}get emulatedPosition(){return this[aa].emulatedPosition}};var Bu=Symbol("@@webxr-polyfill/XRViewerPose"),gn=class extends fn{constructor(e,t,o=!1){super(e,o),this[Bu]={views:t}}get views(){return this[Bu].views}};var Uo=Symbol("@@webxr-polyfill/XRViewport"),wn=class{constructor(e){this[Uo]={target:e}}get x(){return this[Uo].target.x}get y(){return this[Uo].target.y}get width(){return this[Uo].target.width}get height(){return this[Uo].target.height}};var Lu=["left","right","none"],Gt=Symbol("@@webxr-polyfill/XRView"),Fn=class{constructor(e,t,o,r){if(!Lu.includes(o))throw new Error(`XREye must be one of: ${Lu}`);let i=Object.create(null),s=new wn(i);this[Gt]={device:e,eye:o,viewport:s,temp:i,sessionId:r,transform:t}}get eye(){return this[Gt].eye}get projectionMatrix(){return this[Gt].device.getProjectionMatrix(this.eye)}get transform(){return this[Gt].transform}_getViewport(e){if(this[Gt].device.getViewport(this[Gt].sessionId,this.eye,e,this[Gt].temp))return this[Gt].viewport}};var Ae=Symbol("@@webxr-polyfill/XRFrame"),Ru="XRFrame access outside the callback that produced it is invalid.",yh="getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.",Dh=0,Xt=class{constructor(e,t,o){this[Ae]={id:++Dh,active:!1,animationFrame:!1,device:e,session:t,sessionId:o}}get session(){return this[Ae].session}getViewerPose(e){if(!this[Ae].animationFrame)throw new DOMException(yh,"InvalidStateError");if(!this[Ae].active)throw new DOMException(Ru,"InvalidStateError");let t=this[Ae].device,o=this[Ae].session;o[T].viewerSpace._ensurePoseUpdated(t,this[Ae].id),e._ensurePoseUpdated(t,this[Ae].id);let r=e._getSpaceRelativeTransform(o[T].viewerSpace),i=[];for(let l of o[T].viewSpaces){l._ensurePoseUpdated(t,this[Ae].id);let u=e._getSpaceRelativeTransform(l),h=new Fn(t,u,l.eye,this[Ae].sessionId);i.push(h)}return new gn(r,i,!1)}getPose(e,t){if(!this[Ae].active)throw new DOMException(Ru,"InvalidStateError");let o=this[Ae].device;if(e._specialType==="target-ray"||e._specialType==="grip")return o.getInputPose(e._inputSource,t,e._specialType);{e._ensurePoseUpdated(o,this[Ae].id),t._ensurePoseUpdated(o,this[Ae].id);let r=t._getSpaceRelativeTransform(e);return r?new XRPose(r,!1):null}return null}};var zo=Symbol("@@webxr-polyfill/XRRenderState"),Ch=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null}),Ut=class{constructor(e={}){let t=Object.assign({},Ch,e);this[zo]={config:t}}get depthNear(){return this[zo].config.depthNear}get depthFar(){return this[zo].config.depthFar}get inlineVerticalFieldOfView(){return this[zo].config.inlineVerticalFieldOfView}get baseLayer(){return this[zo].config.baseLayer}};var si=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),jo=Symbol("@@webxr-polyfill/xr-compatible");var An=Symbol("@@webxr-polyfill/XRWebGLLayer"),Bh=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),qo=class{constructor(e,t,o={}){let r=Object.assign({},Bh,o);if(!(e instanceof _n))throw new Error("session must be a XRSession");if(e.ended)throw new Error("InvalidStateError");if(t[si]&&t[jo]!==!0)throw new Error("InvalidStateError");let i=t.getParameter(t.FRAMEBUFFER_BINDING);this[An]={context:t,config:r,framebuffer:i,session:e}}get context(){return this[An].context}get antialias(){return this[An].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return this[An].framebuffer}get framebufferWidth(){return this[An].context.drawingBufferWidth}get framebufferHeight(){return this[An].context.drawingBufferHeight}get _session(){return this[An].session}getViewport(e){return e._getViewport(this)}static getNativeFramebufferScaleFactor(e){if(!e)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return e[T].ended?0:1}};var ca=Symbol("@@webxr-polyfill/XRInputSourceEvent"),Sn=class n extends Event{constructor(e,t){super(e,t),this[ca]={frame:t.frame,inputSource:t.inputSource},Object.setPrototypeOf(this,n.prototype)}get frame(){return this[ca].frame}get inputSource(){return this[ca].inputSource}};var Pu=Symbol("@@webxr-polyfill/XRSessionEvent"),zt=class n extends Event{constructor(e,t){super(e,t),this[Pu]={session:t.session},Object.setPrototypeOf(this,n.prototype)}get session(){return this[Pu].session}};var ai=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),Tn=class n extends Event{constructor(e,t){super(e,t),this[ai]={session:t.session,added:t.added,removed:t.removed},Object.setPrototypeOf(this,n.prototype)}get session(){return this[ai].session}get added(){return this[ai].added}get removed(){return this[ai].removed}};var T=Symbol("@@webxr-polyfill/XRSession"),Qo=class extends at{constructor(e){super(e)}get eye(){return this._specialType}_onPoseUpdate(e){this._inverseBaseMatrix=e.getBaseViewMatrix(this._specialType)}},_n=class extends yt{constructor(e,t,o){super();let r=t!="inline",i=new Ut({inlineVerticalFieldOfView:r?null:Math.PI*.5});this[T]={device:e,mode:t,immersive:r,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:o,activeRenderState:i,pendingRenderState:null,viewerSpace:new Nt("viewer"),viewSpaces:[],currentInputSources:[]},r?this[T].viewSpaces.push(new Qo("left"),new Qo("right")):this[T].viewSpaces.push(new Qo("none")),this[T].onDeviceFrame=()=>{if(this[T].ended||this[T].suspended||(this[T].deviceFrameHandle=null,this[T].startDeviceFrameLoop(),this[T].pendingRenderState!==null&&(this[T].activeRenderState=new Ut(this[T].pendingRenderState),this[T].pendingRenderState=null,this[T].activeRenderState.baseLayer&&this[T].device.onBaseLayerSet(this[T].id,this[T].activeRenderState.baseLayer)),this[T].activeRenderState.baseLayer===null))return;let s=new Xt(e,this,this[T].id),l=this[T].currentFrameCallbacks=this[T].frameCallbacks;this[T].frameCallbacks=[],s[Ae].active=!0,s[Ae].animationFrame=!0,this[T].device.onFrameStart(this[T].id,this[T].activeRenderState),this._checkInputSourcesChange();let u=ii();for(let h=0;h<l.length;h++)try{!l[h].cancelled&&typeof l[h].callback=="function"&&l[h].callback(u,s)}catch(x){console.error(x)}this[T].currentFrameCallbacks=null,s[Ae].active=!1,this[T].device.onFrameEnd(this[T].id)},this[T].startDeviceFrameLoop=()=>{this[T].deviceFrameHandle===null&&(this[T].deviceFrameHandle=this[T].device.requestAnimationFrame(this[T].onDeviceFrame))},this[T].stopDeviceFrameLoop=()=>{let s=this[T].deviceFrameHandle;s!==null&&(this[T].device.cancelAnimationFrame(s),this[T].deviceFrameHandle=null)},this[T].onPresentationEnd=s=>{if(s!==this[T].id){this[T].suspended=!1,this[T].startDeviceFrameLoop(),this.dispatchEvent("focus",{session:this});return}this[T].ended=!0,this[T].stopDeviceFrameLoop(),e.removeEventListener("@@webxr-polyfill/vr-present-end",this[T].onPresentationEnd),e.removeEventListener("@@webxr-polyfill/vr-present-start",this[T].onPresentationStart),e.removeEventListener("@@webxr-polyfill/input-select-start",this[T].onSelectStart),e.removeEventListener("@@webxr-polyfill/input-select-end",this[T].onSelectEnd),this.dispatchEvent("end",new zt("end",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-end",this[T].onPresentationEnd),this[T].onPresentationStart=s=>{s!==this[T].id&&(this[T].suspended=!0,this[T].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-start",this[T].onPresentationStart),this[T].onSelectStart=s=>{s.sessionId===this[T].id&&this[T].dispatchInputSourceEvent("selectstart",s.inputSource)},e.addEventListener("@@webxr-polyfill/input-select-start",this[T].onSelectStart),this[T].onSelectEnd=s=>{s.sessionId===this[T].id&&(this[T].dispatchInputSourceEvent("selectend",s.inputSource),this[T].dispatchInputSourceEvent("select",s.inputSource))},e.addEventListener("@@webxr-polyfill/input-select-end",this[T].onSelectEnd),this[T].onSqueezeStart=s=>{s.sessionId===this[T].id&&this[T].dispatchInputSourceEvent("squeezestart",s.inputSource)},e.addEventListener("@@webxr-polyfill/input-squeeze-start",this[T].onSqueezeStart),this[T].onSqueezeEnd=s=>{s.sessionId===this[T].id&&(this[T].dispatchInputSourceEvent("squeezeend",s.inputSource),this[T].dispatchInputSourceEvent("squeeze",s.inputSource))},e.addEventListener("@@webxr-polyfill/input-squeeze-end",this[T].onSqueezeEnd),this[T].dispatchInputSourceEvent=(s,l)=>{let u=new Xt(e,this,this[T].id),h=new Sn(s,{frame:u,inputSource:l});u[Ae].active=!0,this.dispatchEvent(s,h),u[Ae].active=!1},this[T].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[T].activeRenderState}get environmentBlendMode(){return this[T].device.environmentBlendMode||"opaque"}async requestReferenceSpace(e){if(this[T].ended)return;if(!Go.includes(e))throw new TypeError(`XRReferenceSpaceType must be one of ${Go}`);if(!this[T].device.doesSessionSupportReferenceSpace(this[T].id,e))throw new DOMException(`The ${e} reference space is not supported by this session.`,"NotSupportedError");if(e==="viewer")return this[T].viewerSpace;let t=await this[T].device.requestFrameOfReferenceTransform(e);if(e==="bounded-floor")throw t?this[T].device.requestStageBounds()?new DOMException(`The WebXR polyfill does not support the ${e} reference space yet.`,"NotSupportedError"):new DOMException(`${e} XRReferenceSpace not supported by this device.`,"NotSupportedError"):new DOMException(`${e} XRReferenceSpace not supported by this device.`,"NotSupportedError");return new Nt(e,t)}requestAnimationFrame(e){if(this[T].ended)return;let t=++this[T].frameHandle;return this[T].frameCallbacks.push({handle:t,callback:e,cancelled:!1}),t}cancelAnimationFrame(e){let t=this[T].frameCallbacks,o=t.findIndex(r=>r&&r.handle===e);o>-1&&(t[o].cancelled=!0,t.splice(o,1)),t=this[T].currentFrameCallbacks,t&&(o=t.findIndex(r=>r&&r.handle===e),o>-1&&(t[o].cancelled=!0))}get inputSources(){return this[T].device.getInputSources()}async end(){if(!this[T].ended)return this[T].immersive&&(this[T].ended=!0,this[T].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[T].onPresentationStart),this[T].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[T].onPresentationEnd),this[T].device.removeEventListener("@@webxr-polyfill/input-select-start",this[T].onSelectStart),this[T].device.removeEventListener("@@webxr-polyfill/input-select-end",this[T].onSelectEnd),this.dispatchEvent("end",new zt("end",{session:this}))),this[T].stopDeviceFrameLoop(),this[T].device.endSession(this[T].id)}updateRenderState(e){if(this[T].ended){let o="Can't call updateRenderState on an XRSession that has already ended.";throw new Error(o)}if(e.baseLayer&&e.baseLayer._session!==this){let o="Called updateRenderState with a base layer that was created by a different session.";throw new Error(o)}if(e.inlineVerticalFieldOfView!==null&&e.inlineVerticalFieldOfView!==void 0)if(this[T].immersive){let o="inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.";throw new Error(o)}else e.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,e.inlineVerticalFieldOfView));if(this[T].pendingRenderState===null){let o=this[T].activeRenderState;this[T].pendingRenderState={depthNear:o.depthNear,depthFar:o.depthFar,inlineVerticalFieldOfView:o.inlineVerticalFieldOfView,baseLayer:o.baseLayer}}Object.assign(this[T].pendingRenderState,e)}_checkInputSourcesChange(){let e=[],t=[],o=this.inputSources,r=this[T].currentInputSources;for(let i of o)r.includes(i)||e.push(i);for(let i of r)o.includes(i)||t.push(i);(e.length>0||t.length>0)&&this.dispatchEvent("inputsourceschange",new Tn("inputsourceschange",{session:this,added:e,removed:t})),this[T].currentInputSources.length=0;for(let i of o)this[T].currentInputSources.push(i)}};var jt=Symbol("@@webxr-polyfill/XRInputSource"),vn=class{constructor(e){this[jt]={impl:e,gripSpace:new at("grip",this),targetRaySpace:new at("target-ray",this)}}get handedness(){return this[jt].impl.handedness}get targetRayMode(){return this[jt].impl.targetRayMode}get gripSpace(){let e=this[jt].impl.targetRayMode;return e==="gaze"||e==="screen"?null:this[jt].gripSpace}get targetRaySpace(){return this[jt].targetRaySpace}get profiles(){return this[jt].impl.profiles}get gamepad(){return this[jt].impl.gamepad}};var la=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),Ko=class n extends Event{constructor(e,t){super(e,t),this[la]={referenceSpace:t.referenceSpace,transform:t.transform||null},Object.setPrototypeOf(this,n.prototype)}get referenceSpace(){return this[la].referenceSpace}get transform(){return this[la].transform}};var ci={XRSystem:Xo,XRSession:_n,XRSessionEvent:zt,XRFrame:Xt,XRView:Fn,XRViewport:wn,XRViewerPose:gn,XRWebGLLayer:qo,XRSpace:at,XRReferenceSpace:Nt,XRReferenceSpaceEvent:Ko,XRInputSource:vn,XRInputSourceEvent:Sn,XRInputSourcesChangeEvent:Tn,XRRenderState:Ut,XRRigidTransform:xn,XRPose:fn};var ua=n=>typeof n.prototype.makeXRCompatible=="function"?!1:(n.prototype.makeXRCompatible=function(){return this[jo]=!0,Promise.resolve()},!0),pa=n=>{let e=n.prototype.getContext;n.prototype.getContext=function(t,o){let r=e.call(this,t,o);return r&&(r[si]=!0,o&&"xrCompatible"in o&&(r[jo]=o.xrCompatible)),r}};var Iu=n=>!!(n.ImageBitmapRenderingContext&&n.createImageBitmap),Vu=n=>{var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(n.navigator.userAgent||n.navigator.vendor||n.opera),e},Wu=n=>{n.style.display="block",n.style.position="absolute",n.style.width=n.style.height="1px",n.style.top=n.style.left="0px"};var Ku=kd(Ou());var kn=class extends yt{constructor(e){super(),this.global=e,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(e,t){throw new Error("Not implemented")}isSessionSupported(e){throw new Error("Not implemented")}isFeatureSupported(e){throw new Error("Not implemented")}async requestSession(e,t){throw new Error("Not implemented")}requestAnimationFrame(e){throw new Error("Not implemented")}onFrameStart(e){throw new Error("Not implemented")}onFrameEnd(e){throw new Error("Not implemented")}doesSessionSupportReferenceSpace(e,t){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(e,t){}cancelAnimationFrame(e){throw new Error("Not implemented")}endSession(e){throw new Error("Not implemented")}getViewport(e,t,o,r){throw new Error("Not implemented")}getProjectionMatrix(e){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(e){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(e,t,o){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}};var Lh={mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},Rh={mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},Ph={mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},Hu={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},Ih={mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[Math.PI*-.08,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},Vh={mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},Wh={mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},ma={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},Oh={"Daydream Controller":Lh,"Gear VR Controller":Vh,"HTC Vive Focus Controller":Rh,"Oculus Go Controller":Ph,"Oculus Touch (Right)":Hu,"Oculus Touch (Left)":Hu,"OpenVR Gamepad":Ih,"Spatial Controller (Spatial Interaction Source) 045E-065A":ma,"Spatial Controller (Spatial Interaction Source) 045E-065D":Wh,"Windows Mixed Reality (Right)":ma,"Windows Mixed Reality (Left)":ma},Nu=Oh;var Gu=Ue(.155,-.465,-.15),Hh=Ue(-.155,-.465,-.15),Nh=Ue(0,0,-.25),Gh=Ue(0,0,.05),Xu=Ue(-.08,.14,.08),Uu=.4,Xh=.4,Uh=.61,zh=.175,jh=.12,qh=.87,zu=180/Math.PI;function Qh(n,e,t){function o(u,h,x){return u<h?h:u>x?x:u}var r=e[0]*e[0],i=e[1]*e[1],s=e[2]*e[2],l=e[3]*e[3];if(t==="XYZ")n[0]=Math.atan2(2*(e[0]*e[3]-e[1]*e[2]),l-r-i+s),n[1]=Math.asin(o(2*(e[0]*e[2]+e[1]*e[3]),-1,1)),n[2]=Math.atan2(2*(e[2]*e[3]-e[0]*e[1]),l+r-i-s);else if(t==="YXZ")n[0]=Math.asin(o(2*(e[0]*e[3]-e[1]*e[2]),-1,1)),n[1]=Math.atan2(2*(e[0]*e[2]+e[1]*e[3]),l-r-i+s),n[2]=Math.atan2(2*(e[0]*e[1]+e[2]*e[3]),l-r+i-s);else if(t==="ZXY")n[0]=Math.asin(o(2*(e[0]*e[3]+e[1]*e[2]),-1,1)),n[1]=Math.atan2(2*(e[1]*e[3]-e[2]*e[0]),l-r-i+s),n[2]=Math.atan2(2*(e[2]*e[3]-e[0]*e[1]),l-r+i-s);else if(t==="ZYX")n[0]=Math.atan2(2*(e[0]*e[3]+e[2]*e[1]),l-r-i+s),n[1]=Math.asin(o(2*(e[1]*e[3]-e[0]*e[2]),-1,1)),n[2]=Math.atan2(2*(e[0]*e[1]+e[2]*e[3]),l+r-i-s);else if(t==="YZX")n[0]=Math.atan2(2*(e[0]*e[3]-e[2]*e[1]),l-r+i-s),n[1]=Math.atan2(2*(e[1]*e[3]-e[0]*e[2]),l+r-i-s),n[2]=Math.asin(o(2*(e[0]*e[1]+e[2]*e[3]),-1,1));else if(t==="XZY")n[0]=Math.atan2(2*(e[0]*e[3]+e[1]*e[2]),l-r+i-s),n[1]=Math.atan2(2*(e[0]*e[2]+e[1]*e[3]),l+r-i-s),n[2]=Math.asin(o(2*(e[2]*e[3]-e[0]*e[1]),-1,1));else{console.log("No order given for quaternion to euler conversion.");return}}var Jo=class{constructor(){this.hand="right",this.headElbowOffset=Gu,this.controllerQ=Ze(),this.lastControllerQ=Ze(),this.headQ=Ze(),this.headPos=Ye(),this.elbowPos=Ye(),this.wristPos=Ye(),this.time=null,this.lastTime=null,this.rootQ=Ze(),this.position=Ye()}setHandedness(e){this.hand!=e&&(this.hand=e,this.hand=="left"?this.headElbowOffset=Hh:this.headElbowOffset=Gu)}update(e,t){this.time=ii(),e&&(ri(this.lastControllerQ,this.controllerQ),ri(this.controllerQ,e)),t&&(Zr(this.headPos,t),$r(this.headQ,t));let o=this.getHeadYawOrientation_(),r=this.quatAngle_(this.lastControllerQ,this.controllerQ),i=(this.time-this.lastTime)/1e3;r/i>Uh?Xn(this.rootQ,this.rootQ,o,Math.min(r/zh,1)):ri(this.rootQ,o);let l=Ue(0,0,-1);mn(l,l,this.controllerQ);let u=Ho(l,[0,1,0]),h=this.clamp_((u-jh)/qh,0,1),x=ra(this.rootQ);oa(x,x),na(x,x,this.controllerQ);let g=this.elbowPos;ea(g,this.headPos),Gn(g,g,this.headElbowOffset);let A=$s(Xu);ta(A,A,h),Gn(g,g,A);let M=this.quatAngle_(x,Ze())*zu,B=1-Math.pow(M/180,4);sssss;let y=Uu,V=1-Uu,I=B*(y+V*h*Xh),L=Ze();Xn(L,L,x,I);let D=oa(Ze(),L),O=ra(x);na(O,O,D);let C=this.wristPos;ea(C,Gh),mn(C,C,L),Gn(C,C,Nh),mn(C,C,O),Gn(C,C,g);let R=$s(Xu);ta(R,R,h),Gn(this.position,this.wristPos,R),mn(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let e=Ye();return Qh(e,this.headQ,"YXZ"),Du(Ze(),0,e[1]*zu,0)}clamp_(e,t,o){return Math.min(Math.max(e,t),o)}quatAngle_(e,t){let o=[0,0,-1],r=[0,0,-1];return mn(o,o,e),mn(r,r,t),Tu(o,r)}};var Ve=Symbol("@@webxr-polyfill/XRRemappedGamepad"),ju={pressed:!1,touched:!1,value:0};Object.freeze(ju);var xa=class{constructor(e,t,o){if(o||(o={}),o.userAgentOverrides){for(let h in o.userAgentOverrides)if(navigator.userAgent.includes(h)){let x=o.userAgentOverrides[h];for(let g in x)g in o?Object.assign(o[g],x[g]):o[g]=x[g];break}}let r=new Array(o.axes&&o.axes.length?o.axes.length:e.axes.length),i=new Array(o.buttons&&o.buttons.length?o.buttons.length:e.buttons.length),s=null;if(o.gripTransform){let h=o.gripTransform.orientation||[0,0,0,1];s=At(),Ot(s,No(h,h),o.gripTransform.position||[0,0,0])}let l=null;if(o.targetRayTransform){let h=o.targetRayTransform.orientation||[0,0,0,1];l=At(),Ot(l,No(h,h),o.targetRayTransform.position||[0,0,0])}let u=o.profiles;o.displayProfiles&&t.displayName in o.displayProfiles&&(u=o.displayProfiles[t.displayName]),this[Ve]={gamepad:e,map:o,profiles:u||[e.id],mapping:o.mapping||e.mapping,axes:r,buttons:i,gripTransform:s,targetRayTransform:l},this._update()}_update(){let e=this[Ve].gamepad,t=this[Ve].map,o=this[Ve].axes;for(let i=0;i<o.length;++i)t.axes&&i in t.axes?t.axes[i]===null?o[i]=0:o[i]=e.axes[t.axes[i]]:o[i]=e.axes[i];if(t.axes&&t.axes.invert)for(let i of t.axes.invert)i<o.length&&(o[i]*=-1);let r=this[Ve].buttons;for(let i=0;i<r.length;++i)t.buttons&&i in t.buttons?t.buttons[i]===null?r[i]=ju:r[i]=e.buttons[t.buttons[i]]:r[i]=e.buttons[i]}get id(){return""}get _profiles(){return this[Ve].profiles}get index(){return-1}get connected(){return this[Ve].gamepad.connected}get timestamp(){return this[Ve].gamepad.timestamp}get mapping(){return this[Ve].mapping}get axes(){return this[Ve].axes}get buttons(){return this[Ve].buttons}get hapticActuators(){return this[Ve].gamepad.hapticActuators}},Yo=class{constructor(e,t,o=0,r=-1){this.polyfill=e,this.display=t,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new vn(this),this.lastPosition=Ye(),this.emulatedPosition=!1,this.basePoseMatrix=At(),this.outputMatrix=At(),this.primaryButtonIndex=o,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=r,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(e){this.nativeGamepad!==e&&(this.nativeGamepad=e,e?this.gamepad=new xa(e,this.display,Nu[e.id]):this.gamepad=null),this.handedness=e.hand===""?"none":e.hand,this.gamepad&&this.gamepad._update(),e.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!e.pose.hasPosition):e.hand===""&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let e=this.nativeGamepad.pose,t=e.position,o=e.orientation;if(!t&&!o)return;t?(this.lastPosition[0]=t[0],this.lastPosition[1]=t[1],this.lastPosition[2]=t[2]):e.hasPosition?t=this.lastPosition:(this.armModel||(this.armModel=new Jo),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(o,this.polyfill.getBasePoseMatrix()),t=this.armModel.getPosition()),Ot(this.basePoseMatrix,o,t)}else _u(this.basePoseMatrix,this.polyfill.getBasePoseMatrix());return this.basePoseMatrix}getXRPose(e,t){switch(this.updateBasePoseMatrix(),t){case"target-ray":e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[Ve].targetRayTransform&&Dt(this.outputMatrix,this.outputMatrix,this.gamepad[Ve].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[Ve].gripTransform&&Dt(this.outputMatrix,this.outputMatrix,this.gamepad[Ve].gripTransform);break;default:return null}return e._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}};var cT=Symbol("@@webxr-polyfill/WebVRDevice"),Zo=!1,qu={highRefreshRate:!0},Qu={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},Kh=0,fa=class{constructor(e,t,o={}){if(this.mode=e,this.enabledFeatures=t,this.outputContext=null,this.immersive=e=="immersive-vr"||e=="immersive-ar",this.ended=null,this.baseLayer=null,this.id=++Kh,this.modifiedCanvasLayer=!1,this.outputContext&&!Zo){let r=o.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(r)}}},Mn=class extends kn{constructor(e,t){let{canPresent:o}=t.capabilities;super(e),this.display=t,this.frame=new e.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=o,this.baseModelMatrix=At(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),e.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=e.navigator&&"getGamepads"in e.navigator,this.HAS_BITMAP_SUPPORT=Iu(e)}get depthNear(){return this.display.depthNear}set depthNear(e){this.display.depthNear=e}get depthFar(){return this.display.depthFar}set depthFar(e){this.display.depthFar=e}onBaseLayerSet(e,t){let o=this.sessions.get(e),r=t.context.canvas;if(o.immersive){let i=this.display.getEyeParameters("left"),s=this.display.getEyeParameters("right");r.width=Math.max(i.renderWidth,s.renderWidth)*2,r.height=Math.max(i.renderHeight,s.renderHeight),this.display.requestPresent([{source:r,attributes:qu}]).then(()=>{!Zo&&!this.global.document.body.contains(r)&&(o.modifiedCanvasLayer=!0,this.global.document.body.appendChild(r),Wu(r)),o.baseLayer=t})}else o.baseLayer=t}isSessionSupported(e){return!(e=="immersive-ar"||e=="immersive-vr"&&this.canPresent===!1)}isFeatureSupported(e){switch(e){case"viewer":return!0;case"local":return!0;case"local-floor":return!0;case"bounded":return!1;case"unbounded":return!1;default:return!1}}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();let o=e=="immersive-vr";if(o){let i=this.global.document.createElement("canvas");if(!Zo){let s=i.getContext("webgl")}await this.display.requestPresent([{source:i,attributes:qu}])}let r=new fa(e,t,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(r.id,r),o&&(this.immersiveSession=r,this.dispatchEvent("@@webxr-polyfill/vr-present-start",r.id)),Promise.resolve(r.id)}requestAnimationFrame(e){return this.display.requestAnimationFrame(e)}getPrimaryButtonIndex(e){let t=0,o=e.id.toLowerCase();for(let r in Qu)if(o.includes(r)){t=Qu[r];break}return Math.min(t,e.buttons.length-1)}onFrameStart(e,t){this.display.depthNear=t.depthNear,this.display.depthFar=t.depthFar,this.display.getFrameData(this.frame);let o=this.sessions.get(e);if(o.immersive&&this.CAN_USE_GAMEPAD){let r=this.gamepadInputSources;this.gamepadInputSources={};let i=this.global.navigator.getGamepads();for(let s=0;s<i.length;++s){let l=i[s];if(l&&l.displayId>0){let u=r[s];if(u||(u=new Yo(this,this.display,this.getPrimaryButtonIndex(l))),u.updateFromGamepad(l),this.gamepadInputSources[s]=u,u.primaryButtonIndex!=-1){let h=l.buttons[u.primaryButtonIndex].pressed;h&&!u.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:o.id,inputSource:u.inputSource}):!h&&u.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:o.id,inputSource:u.inputSource}),u.primaryActionPressed=h}if(u.primarySqueezeButtonIndex!=-1){let h=l.buttons[u.primarySqueezeButtonIndex].pressed;h&&!u.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:o.id,inputSource:u.inputSource}):!h&&u.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:o.id,inputSource:u.inputSource}),u.primarySqueezeActionPressed=h}}}}if(!Zo&&!o.immersive&&o.baseLayer){let r=o.baseLayer.context.canvas;ei(this.frame.leftProjectionMatrix,t.inlineVerticalFieldOfView,r.width/r.height,t.depthNear,t.depthFar)}}onFrameEnd(e){let t=this.sessions.get(e);if(!(t.ended||!t.baseLayer)){if(t.outputContext&&!(t.immersive&&!this.display.capabilities.hasExternalDisplay)){let o=t.immersive&&this.display.capabilities.hasExternalDisplay,r=t.baseLayer.context.canvas,i=o?r.width/2:r.width,s=r.height;if(!Zo){let l=t.outputContext.canvas,u=l.width,h=l.height,x=t.renderContext;this.HAS_BITMAP_SUPPORT?r.transferToImageBitmap?x.transferFromImageBitmap(r.transferToImageBitmap()):this.global.createImageBitmap(r,0,0,i,s,{resizeWidth:u,resizeHeight:h}).then(g=>x.transferFromImageBitmap(g)):x.drawImage(r,0,0,i,s,0,0,u,h)}}t.immersive&&t.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(e){this.display.cancelAnimationFrame(e)}async endSession(e){let t=this.sessions.get(e);if(!t.ended){if(t.immersive)return this.display.exitPresent();t.ended=!0}}doesSessionSupportReferenceSpace(e,t){let o=this.sessions.get(e);return o.ended?!1:o.enabledFeatures.has(t)}requestStageBounds(){if(this.display.stageParameters){let e=this.display.stageParameters.sizeX,t=this.display.stageParameters.sizeZ,o=[];return o.push(-e/2),o.push(-t/2),o.push(e/2),o.push(-t/2),o.push(e/2),o.push(t/2),o.push(-e/2),o.push(t/2),o}return null}async requestFrameOfReferenceTransform(e,t){return(e==="local-floor"||e==="bounded-floor")&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(e){if(e==="left")return this.frame.leftProjectionMatrix;if(e==="right")return this.frame.rightProjectionMatrix;if(e==="none")return this.frame.leftProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(e,t,o,r){let i=this.sessions.get(e),{width:s,height:l}=o.context.canvas;if(!i.immersive)return r.x=r.y=0,r.width=s,r.height=l,!0;if(t==="left"||t==="none")r.x=0;else if(t==="right")r.x=s/2;else return!1;return r.y=0,r.width=s/2,r.height=l,!0}getBasePoseMatrix(){let{position:e,orientation:t}=this.frame.pose;return!e&&!t?this.baseModelMatrix:(e||(e=this.tempVec3,e[0]=e[1]=e[2]=0),Ot(this.baseModelMatrix,t,e),this.baseModelMatrix)}getBaseViewMatrix(e){if(e==="left"||e==="none")return this.frame.leftViewMatrix;if(e==="right")return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let e=[];for(let t in this.gamepadInputSources)e.push(this.gamepadInputSources[t].inputSource);return e}getInputPose(e,t,o){if(!t)return null;for(let r in this.gamepadInputSources){let i=this.gamepadInputSources[r];if(i.inputSource===e)return i.getXRPose(t,o)}return null}onWindowResize(){}onVRDisplayPresentChange(e){this.display.isPresenting||this.sessions.forEach(t=>{if(t.immersive&&!t.ended){if(t.modifiedCanvasLayer){let o=t.baseLayer.context.canvas;document.body.removeChild(o),o.setAttribute("style","")}this.immersiveSession===t&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",t.id)}})}};var $o=class extends Mn{constructor(e,t){let o=new Ku.default(t||{});super(e,o),this.display=o,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}};var Jh=!1,Yh=0,ga=class{constructor(e,t){this.mode=e,this.enabledFeatures=t,this.ended=null,this.baseLayer=null,this.id=++Yh}},er=class extends kn{constructor(e){super(e),this.sessions=new Map,this.projectionMatrix=At(),this.identityMatrix=At()}onBaseLayerSet(e,t){let o=this.sessions.get(e);o.baseLayer=t}isSessionSupported(e){return e=="inline"}isFeatureSupported(e){switch(e){case"viewer":return!0;default:return!1}}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();let o=new ga(e,t);return this.sessions.set(o.id,o),Promise.resolve(o.id)}requestAnimationFrame(e){return window.requestAnimationFrame(e)}cancelAnimationFrame(e){window.cancelAnimationFrame(e)}onFrameStart(e,t){if(Jh)return;let o=this.sessions.get(e);if(o.baseLayer){let r=o.baseLayer.context.canvas;ei(this.projectionMatrix,t.inlineVerticalFieldOfView,r.width/r.height,t.depthNear,t.depthFar)}}onFrameEnd(e){}async endSession(e){let t=this.sessions.get(e);t.ended=!0}doesSessionSupportReferenceSpace(e,t){let o=this.sessions.get(e);return o.ended?!1:o.enabledFeatures.has(t)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(e,t){return null}getProjectionMatrix(e){return this.projectionMatrix}getViewport(e,t,o,r){let i=this.sessions.get(e),{width:s,height:l}=o.context.canvas;return r.x=r.y=0,r.width=s,r.height=l,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(e){return this.identityMatrix}getInputSources(){return[]}getInputPose(e,t,o){return null}onWindowResize(){}};var Zh=async function(n){let e=null;if("getVRDisplays"in n.navigator)try{let t=await n.navigator.getVRDisplays();t&&t.length&&(e=new Mn(n,t[0]))}catch{}return e},Ju=async function(n,e){if(e.webvr){let o=await Zh(n);if(o)return o}let t=Vu(n);return t&&e.cardboard||!t&&e.allowCardboardOnDesktop?(n.VRFrameData||(n.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new $o(n,e.cardboardConfig)):new er(n)};var $h={global:Yr,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},li=["navigator","HTMLCanvasElement","WebGLRenderingContext"],tr=class{constructor(e={}){this.config=Object.freeze(Object.assign({},$h,e)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}_injectPolyfill(e){if(!li.every(t=>!!e[t]))throw new Error(`Global must have the following attributes : ${li}`);for(let t of Object.keys(ci))e[t]!==void 0?console.warn(`${t} already defined on global.`):e[t]=ci[t];ua(e.WebGLRenderingContext)&&(pa(e.HTMLCanvasElement),e.OffscreenCanvas&&pa(e.OffscreenCanvas),e.WebGL2RenderingContext&&ua(e.WebGL2RenderingContext),window.isSecureContext||console.warn(`WebXR Polyfill Warning:
This page is not running in a secure context (https:// or localhost)!
This means that although the page may be able to use the WebXR Polyfill it will
not be able to use native WebXR implementations, and as such will not be able to
access dedicated VR or AR hardware, and will not be able to take advantage of
any performance improvements a native WebXR implementation may offer. Please
host this content on a secure origin for the best user experience.
`)),this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let e=Ju(this.global,this.config);this.xr=new ci.XRSystem(e),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(e){if(!li.every(t=>!!e[t]))throw new Error(`Global must have the following attributes : ${li}`);if(e.navigator.xr&&"supportsSession"in e.navigator.xr&&!("isSessionSupported"in e.navigator.xr)){let t=e.navigator.xr.supportsSession;e.navigator.xr.isSessionSupported=function(o){return t.call(this,o).then(()=>!0).catch(()=>!1)},e.navigator.xr.supportsSession=function(o){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),t.call(this,o)}}}};var K;(function(n){n.None="None",n.Fullscreen="Fullscreen",n.VR="VR",n.AR="AR",n.Anaglyph="Anaglyph",n.FullscreenAnaglyph="FullscreenAnaglyph"})(K||(K={}));var ui=class{constructor(e,t=512,o=512){this.colorMatrixLeft=new Is().fromArray([.4561,-.0400822,-.0152161,.500484,-.0378246,-.0205971,.176381,-.0157589,-.00546856]),this.colorMatrixRight=new Is().fromArray([-.0434706,.378476,-.0721527,-.0879388,.73364,-.112961,-.00155529,-.0184503,1.2264]);let r=new Vr(-1,1,1,-1,0,1),i=new Vn,s=new jl;s.eyeSep=.07;let l={minFilter:ko,magFilter:Ir,format:Nl},u=new Hs(t,o,l),h=new Hs(t,o,l),x=new Hr({uniforms:{mapLeft:{value:u.texture},mapRight:{value:h.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = vec2( uv.x, uv.y );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;","float lin( float c ) {","	return c <= 0.04045 ? c * 0.0773993808 :","			pow( c * 0.9478672986 + 0.0521327014, 2.4 );","}","vec4 lin( vec4 c ) {","	return vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );","}","float dev( float c ) {","	return c <= 0.0031308 ? c * 12.92","			: pow( c, 0.41666 ) * 1.055 - 0.055;","}","void main() {","	vec2 uv = vUv;","	vec4 colorL = lin( texture2D( mapLeft, uv ) );","	vec4 colorR = lin( texture2D( mapRight, uv ) );","	vec3 color = clamp(","			colorMatrixLeft * colorL.rgb +","			colorMatrixRight * colorR.rgb, 0., 1. );","	gl_FragColor = vec4(","			dev( color.r ), dev( color.g ), dev( color.b ),","			max( colorL.a, colorR.a ) );","}"].join(`
`)}),g=new rt(new Wr(2,2),x);i.add(g),this.setSize=function(A,_){e.setSize(A,_);let M=e.getPixelRatio();u.setSize(A*M,_*M),h.setSize(A*M,_*M)},this.render=function(A,_){let M=e.getRenderTarget();A.matrixWorldAutoUpdate===!0&&A.updateMatrixWorld(),_.parent===null&&_.matrixWorldAutoUpdate===!0&&_.updateMatrixWorld(),s.update(_),e.setRenderTarget(u),e.clear(),e.render(A,s.cameraL),e.setRenderTarget(h),e.clear(),e.render(A,s.cameraR),e.setRenderTarget(null),e.render(i,r),e.setRenderTarget(M)},this.dispose=function(){u.dispose(),h.dispose(),g.geometry.dispose(),g.material.dispose()}}};navigator.xr||(console.info("Polyfilling WebXR API"),new tr);var di=class extends me{constructor(e,t,o,r,i){super(e),this.mode=t,this.session=o,this.referenceSpaceType=r,this.sessionMode=i}},nr=class extends di{constructor(e,t,o,r){super("sessionstarted",e,t,o,r)}},or=class extends di{constructor(e,t,o,r){super("sessionstopped",e,t,o,r)}},pi=new Map([[K.VR,{referenceSpaceType:"local-floor",sessionMode:"immersive-vr"}],[K.AR,{referenceSpaceType:"local-floor",sessionMode:"immersive-ar"}]]),hi=class extends ce{constructor(e,t,o,r,i){super(),this.renderer=e,this.camera=t,this.fullscreenElement=o,this.enableFullResolution=r,this.enableAnaglyph=i,this._currentMode=K.None,this.buttons=new Map,this.currentSession=null,this.screenUI=null,this.wasVisible=new Map,this.lastFOV=50,this.addEventListener("sessionstarted",s=>{s.sessionMode==="inline"&&(this.lastFOV=this.camera.fov,this.camera.fov=nu(s.session.renderState.inlineVerticalFieldOfView))}),this.addEventListener("sessionstopped",s=>{s.sessionMode==="inline"&&(this.camera.fov=this.lastFOV)}),this.renderer.xr.addEventListener("sessionstart",()=>this.onSessionStarted()),this.renderer.xr.addEventListener("sessionend",()=>this.onSessionEnded()),this.anaglyph=new ui(this.renderer),this.refresh()}setUI(e,t,o,r,i){this.screenUI=e;for(let s of[t,o,r,i])s&&this.buttons.set(s.mode,s);for(let s of this.buttons.values())this.wasVisible.set(s,s.visible),s.addEventListener("click",this.toggleMode.bind(this,s.mode));t.available=this.enableAnaglyph,o.available=!So()&&Zs(),r.available=nl(),i.available=Mr(),this.refresh()}get visible(){return ms(this.renderer.domElement)}set visible(e){hs(this.renderer.domElement,e),this.screenUI&&(e?this.screenUI.show():this.screenUI.hide())}get currentMode(){return this._currentMode}resize(){if(!this.renderer.xr.isPresenting){this.renderer.domElement.style.width="",this.renderer.domElement.style.height="";let{clientWidth:e,clientHeight:t,width:o,height:r}=this.renderer.domElement,i=Math.floor(e*devicePixelRatio),s=Math.floor(t*devicePixelRatio);e>0&&t>0&&(o!==i||r!==s)&&(this.renderer.setPixelRatio(devicePixelRatio),this.renderer.setSize(e,t,!1),this.anaglyph.setSize(e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix())}}getMetrics(){let e=this.renderer.domElement.clientWidth,t=this.renderer.domElement.clientHeight,o=this.renderer.getPixelRatio(),r=this.camera.fov;return{width:e,height:t,pixelRatio:o,fov:r}}setMetrics(e,t,o,r){this.renderer.setPixelRatio(o),this.renderer.setSize(e,t,!1),this.camera.aspect=e/t,this.camera.fov=r,this.camera.updateProjectionMatrix()}async refresh(){let e=Array.from(this.buttons.values()).filter(t=>t.available&&t.mode!==K.Fullscreen&&t.mode!==K.Anaglyph);await Promise.all(e.map(async t=>{let o=pi.get(t.mode);if(t.available=E(o),t.available){let r=navigator.xr&&await navigator.xr.isSessionSupported(o.sessionMode),i=!Mr()&&Ts()&&o.sessionMode==="immersive-vr"&&o.referenceSpaceType==="local-floor";t.available=r||i}}))}async toggleMode(e){if(e===K.None)throw new Error("Cannot toggle 'None' Screen Mode");if(e===K.VR||e===K.AR)await this.toggleXR(e);else{let t=e.indexOf("Fullscreen")>=0,o=e.indexOf("Anaglyph")>=0,r=this.currentMode.indexOf("Fullscreen")>=0,i=this.currentMode.indexOf("Anaglyph")>=0;t?await this.toggleFullscreen(i):this.setActive(o!==i?r?K.FullscreenAnaglyph:K.Anaglyph:r?K.Fullscreen:K.None)}}async start(e){let t=e;(e===K.Anaglyph&&this.currentMode===K.Fullscreen||e===K.Fullscreen&&this.currentMode===K.Anaglyph)&&(t=K.FullscreenAnaglyph),t!==this.currentMode&&(await this.toggleMode(this.currentMode),await this.toggleMode(e))}async stop(){await this.toggleMode(this.currentMode)}get isFullscreen(){return"fullscreenElement"in document&&E(document.fullscreenElement)||"fullscreen"in document&&document.fullscreen}async startFullscreen(e){this.isFullscreen||(await this.fullscreenElement.requestFullscreen({navigationUI:"show"}),e?(this.setActive(K.FullscreenAnaglyph),this.dispatchEvent(new nr(K.FullscreenAnaglyph,null,null,null))):(this.setActive(K.Fullscreen),this.dispatchEvent(new nr(K.Fullscreen,null,null,null))))}async stopFullscreen(e){this.isFullscreen&&(await document.exitFullscreen(),e?(this.setActive(K.Anaglyph),this.dispatchEvent(new or(K.FullscreenAnaglyph,null,null,null))):(this.setActive(K.None),this.dispatchEvent(new or(K.Fullscreen,null,null,null))))}async toggleFullscreen(e){this.isFullscreen?await this.stopFullscreen(e):await this.startFullscreen(e)}async toggleXR(e){let t=pi.get(e);if(E(t)){if(this.currentSession)this.currentSession.end();else if(navigator.xr){this.camera.position.setScalar(0),this.camera.quaternion.identity();try{let o=await navigator.xr.requestSession(t.sessionMode,{optionalFeatures:["local-floor","bounded-floor","high-refresh-rate","hand-tracking","layers"]});if(this.setActive(e),this.currentSession=o,this.renderer.xr.setReferenceSpaceType(t.referenceSpaceType),this.enableFullResolution&&"XRWebGLLayer"in window&&"getNativeFramebufferScaleFactor"in XRWebGLLayer){let r=XRWebGLLayer.getNativeFramebufferScaleFactor(o);this.renderer.xr.setFramebufferScaleFactor(r)}this.renderer.xr.setSession(o)}catch(o){console.error(`Couldn't start session type '${t.sessionMode}'. Reason: ${o&&o.message||o||"UNKNOWN"}`)}}}}onSessionStarted(){let e=this.currentMode,t=pi.get(this.currentMode),o=this.currentSession;if(o.supportedFrameRates){let r=Math.max(...o.supportedFrameRates);console.log("Changing framerate to",r),o.updateTargetFrameRate(r)}this.dispatchEvent(new nr(e,o,t.referenceSpaceType,t.sessionMode))}onSessionEnded(){let e=this.currentMode,t=pi.get(this.currentMode),o=this.currentSession;this.currentSession=null,this.renderer.xr.setSession(null),this.setActive(K.None),this.dispatchEvent(new or(e,o,t.referenceSpaceType,t.sessionMode))}setActive(e){for(let t of this.buttons.values())t.active=t.mode===e,t.visible=this.wasVisible.get(t)&&(e!==K.VR&&e!==K.AR||t.mode===e);this._currentMode=e}render(e,t){this.renderer.clear(),this.currentMode===K.Anaglyph||this.currentMode===K.FullscreenAnaglyph?this.anaglyph.render(e,t):this.renderer.render(e,t)}};var Ne;(function(n){n[n.None=-1]="None",n[n.Left=0]="Left",n[n.Right=1]="Right",n[n.Up=2]="Up",n[n.Down=3]="Down",n[n.Back=4]="Back",n[n.Front=5]="Front"})(Ne||(Ne={}));var wa=Hn("Juniper:ScaledItems",()=>new Map);var em=.005;function Yu(n){n*=em;for(let e of wa.values())e.updateScaling(n)}function Zu(n){let e=wa.get(n);e&&(wa.delete(n),Xe(e))}function ze(n){let e=new Array,t=new Set;for(e.push(n);e.length>0;){let o=e.shift();o&&!t.has(o)&&(t.add(o),o.isMesh&&e.push(o.material,o.geometry),o.isMaterial&&e.push(...Object.values(o)),o.isObject3D&&(e.push(...o.children),o.clear(),Zu(o)),tt(o)&&e.push(...o),cn(o))}t.clear()}var $u=new W(0,1,0),Ge=2048,Un=Ge/2,tm=[1,0,2,3,4,5],Ct={rows:3,columns:4,indices:[[Ne.None,Ne.Up,Ne.None,Ne.None],[Ne.Left,Ne.Front,Ne.Right,Ne.Back],[Ne.None,Ne.Down,Ne.None,Ne.None]],rotations:[[0,Je,0,0],[0,0,0,0],[0,Je,0,0]]},mi=new we(0),xi=class{get envMap(){return this._cube}constructor(e){this.env=e,this.rt=new Jl(Ge),this.rtScene=new Vn,this.rtCamera=new xl(.01,10,this.rt),this._rotation=new te,this.layerRotation=new te().identity(),this.stageRotation=new te().identity(),this.canvases=new Array(6),this.contexts=new Array(6),this.layerOrientation=null,this.images=null,this.curImagePath=null,this.layer=null,this.wasVisible=!1,this.stageHeading=0,this.rotationNeedsUpdate=!1,this.imageNeedsUpdate=!1,this.useWebXRLayers=!0,this.wasWebXRLayerAvailable=null,this.visible=!0,this.onNeedsRedraw=()=>this.imageNeedsUpdate=!0,this.env.scene.background=mi;for(let t=0;t<this.canvases.length;++t){let o=this.canvases[t]=Tr(Ge,Ge);this.contexts[t]=o.getContext("2d",{alpha:!1})}for(let t=0;t<Ct.rows;++t){let o=Ct.indices[t],r=Ct.rotations[t];for(let i=0;i<Ct.columns;++i){let s=o[i];if(s>-1){let l=this.contexts[s],u=r[i];u>0&&(u%2,l.translate(Un,Un),l.rotate(u),l.translate(-Un,-Un))}}}this.rt.texture.name="SkyboxOutput",this.rtScene.add(this.rtCamera),this.flipped=Tr(Ge,Ge),this.flipper=this.flipped.getContext("2d",{alpha:!1}),this.flipper.fillStyle=mi.getHexString(),this.flipper.scale(-1,1),this.flipper.translate(-Ge,0),this.setImages("",this.canvases),this.env.addScopedEventListener(this,"update",t=>this.checkWebXRLayer(t.frame)),Object.seal(this)}clear(){this.setImage(null,null)}setImage(e,t){return e!==this.curImagePath?E(t)?(this.sliceImage(t),this.setImages(e,this.canvases)):this.setImages(e,null):null}sliceImage(e){let t=e.width/Ct.columns,o=e.height/Ct.rows;for(let r=0;r<Ct.rows;++r){let i=Ct.indices[r];for(let s=0;s<Ct.columns;++s){let l=i[s];l>-1&&this.contexts[l].drawImage(e,s*t,r*o,t,o,0,0,Ge,Ge)}}return this.canvases}setImages(e,t){if((e!==this.curImagePath||t!==this.images)&&(this.curImagePath=e,t!==this.images)){if(E(this._cube)&&(ze(this._cube),this._cube=null),E(this.images))for(let o of this.images)ze(o);this.images=t,E(this.images)?(this.rtScene.background=this._cube=new fl(this.images),this._cube.name="SkyboxInput"):this.rtScene.background=mi}return this.updateImages(),this._cube}updateImages(){this._cube.needsUpdate=!0,this.imageNeedsUpdate=!0}get rotation(){return this._rotation}set rotation(e){let{x:t,y:o,z:r,w:i}=this._rotation;if(cu(e))this._rotation.copy(e);else if(lu(e))this._rotation.setFromEuler(e);else if(tt(e))if(e.length===4&&Re(e[0])&&Re(e[1])&&Re(e[2])&&Re(e[3]))this._rotation.fromArray(e);else throw new Error("Skybox rotation was not a valid array format. Needs an array of 4 numbers.");else on(e)?this._rotation.setFromAxisAngle($u,e):(E(e)&&console.warn("Skybox rotation must be a THREE.Quaternion, THREE.Euler, number[] (representing a Quaternion), or a number (representing rotation about the Y-axis)."),this._rotation.identity());this.rotationNeedsUpdate=this._rotation.x!==t||this._rotation.y!==o||this._rotation.z!==r||this._rotation.w!==i}checkWebXRLayer(e){if(this._cube){let t=this.useWebXRLayers&&this.env.hasXRCompositionLayers&&E(e)&&E(this.env.xrBinding),o=t!==this.wasWebXRLayerAvailable;if(o){if(t){let r=this.env.renderer.xr.getReferenceSpace();this.layer=this.env.xrBinding.createCubeLayer({space:r,layout:"mono",isStatic:!1,viewPixelWidth:Ge,viewPixelHeight:Ge,orientation:this.layerOrientation}),this.layer.addEventListener("redraw",this.onNeedsRedraw),this.env.addWebXRLayer(this.layer,Number.MAX_VALUE)}else this.layer&&(this.env.removeWebXRLayer(this.layer),this.layer.removeEventListener("redraw",this.onNeedsRedraw),cn(this.layer),this.layer=null);this.imageNeedsUpdate=!0}if(!this.layer||!o){let r=this.visible!==this.wasVisible,i=this.env.avatar.headingRadians!==this.stageHeading;if(this.imageNeedsUpdate=this.imageNeedsUpdate||r||this.layer&&this.layer.needsRedraw,this.rotationNeedsUpdate=this.rotationNeedsUpdate||i,this.env.scene.background=this.layer?null:this.visible?this.rt.texture:mi,this.rotationNeedsUpdate&&(this.layerRotation.copy(this.rotation).invert(),this.stageRotation.setFromAxisAngle($u,this.env.avatar.headingRadians).premultiply(this.layerRotation),this.layerOrientation=new DOMPointReadOnly(this.stageRotation.x,this.stageRotation.y,this.stageRotation.z,this.stageRotation.w),this.layer?this.layer.orientation=this.layerOrientation:(this.rtCamera.quaternion.copy(this.layerRotation),this.imageNeedsUpdate=!0)),this.imageNeedsUpdate)if(this.layer){let s=this.env.renderer.getContext(),l=this.env.xrBinding.getSubImage(this.layer,e),u=this._cube.images;this.flipper.fillRect(0,0,Ge,Ge),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.bindTexture(s.TEXTURE_CUBE_MAP,l.colorTexture);for(let h=0;h<u.length;++h){if(this.visible){let x=u[tm[h]];this.flipper.drawImage(x,0,0,x.width,x.height,0,0,Ge,Ge)}s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.flipped)}s.bindTexture(s.TEXTURE_CUBE_MAP,null)}else this.rtCamera.update(this.env.renderer,this.rtScene);this.stageHeading=this.env.avatar.headingRadians,this.imageNeedsUpdate=!1,this.rotationNeedsUpdate=!1,this.wasVisible=this.visible}this.wasWebXRLayerAvailable=t}}};var zn=new W,ep=0,nm=new W,fi=new W,Fa=new W,gi=new te,tp=0,om=0;function rm(n,e){let t=n-e,o=t+Mt,r=t-Mt;return ou(t,o,r)}var rr=class extends De{constructor(e,t,o,r,i=1){super(),this.minDistance=t,this.heightOffset=r,this.speed=i,this.name=e,this.lerp=this.minHeadingRadians>0||this.minDistance>0,this.maxDistance=this.minDistance*5,this.minHeadingRadians=gt(o),this.maxHeadingRadians=Je-this.minHeadingRadians,Object.seal(this)}copy(e,t=!0){return super.copy(e,t),this.name=e.name+ ++om,this.lerp=e.lerp,this.maxDistance=e.maxDistance,this.minHeadingRadians=e.minHeadingRadians,this.maxHeadingRadians=e.maxHeadingRadians,this}update(e,t,o,r){r*=.001,this.clampTo(this.lerp,e,t,this.minDistance,this.maxDistance,o,this.minHeadingRadians,this.maxHeadingRadians,r)}reset(e,t,o){this.clampTo(!1,e,t,0,0,o,0,0,0)}clampTo(e,t,o,r,i,s,l,u,h){zn.copy(o),zn.y-=this.heightOffset*t,ep=s,this.getWorldPosition(fi),this.getWorldDirection(Fa),Fa.negate(),tp=Bo(Fa),gi.identity();let x=!e,g=!e;if(e){let A=nm.copy(zn).sub(fi).length();r<A&&(A<i&&zn.lerpVectors(fi,zn,this.speed*h),x=!0);let _=rm(ep,tp),M=Math.abs(_);l<M&&(M<u?gi.setFromAxisAngle(this.up,_*this.speed*h):gi.setFromAxisAngle(this.up,_),g=!0)}(x||g)&&(x&&this.position.add(zn.sub(fi)),g&&this.quaternion.multiply(gi))}};var wi=class extends me{constructor(e,t){super(e),this.button=t}},Aa=class extends wi{constructor(e){super("gamepadbuttonup",e)}},_a=class extends wi{constructor(e){super("gamepadbuttondown",e)}},Sa=class extends me{constructor(e,t,o){super(e),this.axis=t,this.value=o}},Ta=class extends Sa{constructor(e,t){super("gamepadaxismaxed",e,t)}},Fi=class extends ce{constructor(){super(),this.lastAxisValues=new Array,this.btnDownEvts=new Array,this.btnUpEvts=new Array,this.wasPressed=new Array,this.axisMaxEvts=new Array,this.wasAxisMaxed=new Array,this.sticks=new Array,this.axisThresholdMax=.9,this.axisThresholdMin=.1,this._pad=null,Object.seal(this)}get displayId(){if("displayId"in this.pad)return this.pad.displayId}get pad(){return this._pad}set pad(e){if(this._pad=e,this.pad){if(this.btnUpEvts.length===0){for(let t=0;t<e.buttons.length;++t)this.btnDownEvts[t]=new _a(t),this.btnUpEvts[t]=new Aa(t),this.wasPressed[t]=!1;for(let t=0;t<e.axes.length;++t)this.axisMaxEvts[t]=new Ta(t,0),this.wasAxisMaxed[t]=!1,t%2===0&&t<e.axes.length-1&&(this.sticks[t/2]={x:0,y:0}),this.lastAxisValues[t]=e.axes[t]}for(let t=0;t<this.pad.buttons.length;++t){let o=this.wasPressed[t],r=this.pad.buttons[t].pressed;r!==o&&(this.wasPressed[t]=r,this.dispatchEvent((r?this.btnDownEvts:this.btnUpEvts)[t]))}for(let t=0;t<this.pad.axes.length;++t){let o=this.wasAxisMaxed[t],r=this.pad.axes[t],i=Math.sign(r),s=Math.abs(r),l=s>=this.axisThresholdMax,u=s<=this.axisThresholdMin,h=i*(l?1:u?0:s);l&&!o&&(this.axisMaxEvts[t].value=h,this.dispatchEvent(this.axisMaxEvts[t])),this.wasAxisMaxed[t]=l,this.lastAxisValues[t]=h}for(let t=0;t<this.axes.length-1;t+=2){let o=this.sticks[t/2];o.x=this.axes[t],o.y=this.axes[t+1]}}}get id(){return this.pad?this.pad.id:null}get index(){return this.pad?this.pad.index:null}get connected(){return this.pad&&this.pad.connected}get mapping(){return this.pad?this.pad.mapping:null}get timestamp(){return this.pad?this.pad.timestamp:null}get hand(){return this.pad?this.pad.hand:null}get pose(){return this.pad?this.pad.pose:null}get buttons(){return this.pad?this.pad.buttons:null}get axes(){return this.pad?this.pad.axes:null}get hapticActuators(){return this.pad?this.pad.hapticActuators:null}get vibrationActuator(){return this.pad?this.pad.vibrationActuator:null}};var Ai=class extends me{constructor(){super("update"),this.t=0,this.dt=0,this.sdt=0,this.fps=0}set(e,t){this.t=e,this.dt=t,this.sdt=ru(this.sdt,t,.01),t>0&&(this.fps=1e3/t)}};var Me;(function(n){n[n.LocalUser=0]="LocalUser",n[n.Mouse=1]="Mouse",n[n.Pen=2]="Pen",n[n.Touch=3]="Touch",n[n.Gamepad=4]="Gamepad",n[n.MotionController=5]="MotionController",n[n.MotionControllerLeft=6]="MotionControllerLeft",n[n.MotionControllerRight=7]="MotionControllerRight",n[n.Nose=8]="Nose",n[n.RemoteUser=9]="RemoteUser"})(Me||(Me={}));var jn=new W;function va(n,e,t,o){jn.crossVectors(e,n),n.crossVectors(jn,e),jn.normalize(),n.normalize(),e.normalize(),o.set(jn.x,n.x,-e.x,t.x,jn.y,n.y,-e.y,t.y,jn.z,n.z,-e.z,t.z,0,0,0,1)}var qn=class{constructor(){this._visible=!0,this._style="default"}get style(){return this._style}set style(e){this._style=e}get visible(){return this._visible}set visible(e){this._visible=e}};var qt=class extends qn{get side(){return this._side}set side(e){this._side=e}get object(){return this._object}set object(e){this._object=e}constructor(e){super(),this.env=e,this._object=null,this.T=new W,this.V=new W,this.Q=new te,this._side=-1,this.f=new W,this.up=new W,this.right=new W}get position(){return this.object.position}update(e,t,o,r,i,s,l,u,h,x,g){o&&o.face?(this.position.copy(o.point),o.object.getWorldQuaternion(this.Q),this.T.copy(o.face.normal).applyQuaternion(this.Q),this.V.copy(this.T).multiplyScalar(.02),this.position.add(this.V),this.V.copy(this.T).multiplyScalar(10).add(this.position)):(s?this.position.copy(x).multiplyScalar(2).add(h).sub(this.env.avatar.worldPos).normalize().multiplyScalar(i).add(this.env.avatar.worldPos):(this.V.copy(h).add(t).sub(e).multiplyScalar(2),this.position.copy(x).multiplyScalar(i).add(this.V).add(this.env.avatar.worldPos)),this.V.copy(this.env.avatar.worldPos)),this.lookAt(this.position,this.V),this.style=!r||r.navigable&&!u?l?g?"grabbing":"grab":"default":r.enabled?r.draggable?g?"grabbing":"move":r.navigable?"cell":r.clickable?"pointer":"default":"not-allowed"}lookAt(e,t){this.f.copy(t).sub(e).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat),this.right.crossVectors(this.up,this.f),this.up.crossVectors(this.f,this.right),va(this.up,this.f,e,this.object.matrixWorld),this.object.matrix.copy(this.object.parent.matrixWorld).invert().multiply(this.object.matrixWorld),this.object.matrix.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.scale.x*=this.side,this.object.matrix.compose(this.object.position,this.object.quaternion,this.object.scale)}};var En=class extends qt{constructor(e){super(e),this.material=mu({name:"CursorMat",color:16776960}),this.object=new Ft(.01,.01,.01,this.material)}get style(){return this._currentStyle}set style(e){if(this._currentStyle=e,Et(this.object)&&!tt(this.object.material))switch(this._currentStyle){case"pointer":this.material.color=new we(65280),this.material.needsUpdate=!0;break;case"not-allowed":this.material.color=new we(16711680),this.material.needsUpdate=!0;break;case"move":this.material.color=new we(255),this.material.needsUpdate=!0;break;case"grab":this.material.color=new we(16711935),this.material.needsUpdate=!0;break;case"grabbing":this.material.color=new we(65535),this.material.needsUpdate=!0;break;default:this._currentStyle="default",this.material.color=new we(16776960),this.material.needsUpdate=!0;break}}get visible(){return On(this)}set visible(e){wt(this,e)}};var np=new ln,_i=new W,bn=class extends Tl{constructor(){super(),this.type="LineSegmentsGeometry";let e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],o=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(o),this.setAttribute("position",new Dr(e,3)),this.setAttribute("uv",new Dr(t,2))}applyMatrix4(e){let t=this.attributes.instanceStart,o=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),o.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let o=new vo(t,6,1);return this.setAttribute("instanceStart",new dt(o,3,0)),this.setAttribute("instanceEnd",new dt(o,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let o=new vo(t,6,1);return this.setAttribute("instanceColorStart",new dt(o,3,0)),this.setAttribute("instanceColorEnd",new dt(o,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new Zl(e.geometry)),this}fromLineSegments(e){let t=e.geometry;if(t.isGeometry){console.error("LineSegmentsGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else t.isBufferGeometry&&this.setPositions(t.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ln);let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),np.setFromBufferAttribute(t),this.boundingBox.union(np))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Wn),this.boundingBox===null&&this.computeBoundingBox();let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){let o=this.boundingSphere.center;this.boundingBox.getCenter(o);let r=0;for(let i=0,s=e.count;i<s;i++)_i.fromBufferAttribute(e,i),r=Math.max(r,o.distanceToSquared(_i)),_i.fromBufferAttribute(t,i),r=Math.max(r,o.distanceToSquared(_i));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}};bn.prototype.isLineSegmentsGeometry=!0;var op=new W,rp=new W,Ce=new ft,Be=new ft,_t=new ft,ka=new W,Ma=new de,ct=new El,ip=new W,Bt=new ln,Si=new Wn,St=new ft;function sp(n,e,t,o){return St.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),St.multiplyScalar(1/St.w),St.x=t/o.width,St.y=t/o.height,St.applyMatrix4(n.projectionMatrixInverse),St.multiplyScalar(1/St.w),Math.abs(Math.max(St.x,St.y))}var ir=class extends rt{constructor(e=new bn,t=new bt({color:Math.random()*16777215})){super(e,t),this.type="LineSegments2"}computeLineDistances(){let e=this.geometry,t=e.attributes.instanceStart,o=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let s=0,l=0,u=t.count;s<u;s++,l+=2)op.fromBufferAttribute(t,s),rp.fromBufferAttribute(o,s),r[l]=l===0?0:r[l-1],r[l+1]=r[l]+op.distanceTo(rp);let i=new vo(r,2,1);return e.setAttribute("instanceDistanceStart",new dt(i,1,0)),e.setAttribute("instanceDistanceEnd",new dt(i,1,1)),this}raycast(e,t){e.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');let o=e.params.Line2!==void 0&&e.params.Line2.threshold||0,r=e.ray,i=e.camera,s=i.projectionMatrix,l=this.matrixWorld,u=this.geometry,h=this.material,x=h.resolution,g=h.linewidth+o,A=u.attributes.instanceStart,_=u.attributes.instanceEnd,M=-i.near;u.boundingSphere===null&&u.computeBoundingSphere(),Si.copy(u.boundingSphere).applyMatrix4(l);let B=Math.max(i.near,Si.distanceToPoint(r.origin)),y=sp(i,B,g,x);if(Si.radius+=y,e.ray.intersectsSphere(Si)===!1)return;u.boundingBox===null&&u.computeBoundingBox(),Bt.copy(u.boundingBox).applyMatrix4(l);let V=Math.max(i.near,Bt.distanceToPoint(r.origin)),I=sp(i,V,g,x);if(Bt.max.x+=I,Bt.max.y+=I,Bt.max.z+=I,Bt.min.x-=I,Bt.min.y-=I,Bt.min.z-=I,e.ray.intersectsBox(Bt)!==!1){r.at(1,_t),_t.w=1,_t.applyMatrix4(i.matrixWorldInverse),_t.applyMatrix4(s),_t.multiplyScalar(1/_t.w),_t.x*=x.x/2,_t.y*=x.y/2,_t.z=0,ka.copy(_t),Ma.multiplyMatrices(i.matrixWorldInverse,l);for(let D=0,O=A.count;D<O;D++){Ce.fromBufferAttribute(A,D),Be.fromBufferAttribute(_,D),Ce.w=1,Be.w=1,Ce.applyMatrix4(Ma),Be.applyMatrix4(Ma);var L=Ce.z>M&&Be.z>M;if(L)continue;if(Ce.z>M){let Q=Ce.z-Be.z,Y=(Ce.z-M)/Q;Ce.lerp(Be,Y)}else if(Be.z>M){let Q=Be.z-Ce.z,Y=(Be.z-M)/Q;Be.lerp(Ce,Y)}Ce.applyMatrix4(s),Be.applyMatrix4(s),Ce.multiplyScalar(1/Ce.w),Be.multiplyScalar(1/Be.w),Ce.x*=x.x/2,Ce.y*=x.y/2,Be.x*=x.x/2,Be.y*=x.y/2,ct.start.copy(Ce),ct.start.z=0,ct.end.copy(Be),ct.end.z=0;let C=ct.closestPointToPointParameter(ka,!0);ct.at(C,ip);let R=Pr.lerp(Ce.z,Be.z,C),j=R>=-1&&R<=1,ie=ka.distanceTo(ip)<g*.5;if(j&&ie){ct.start.fromBufferAttribute(A,D),ct.end.fromBufferAttribute(_,D),ct.start.applyMatrix4(l),ct.end.applyMatrix4(l);let Q=new W,Y=new W;r.distanceSqToSegment(ct.start,ct.end,Y,Q),t.push({point:Y,pointOnLine:Q,distance:r.origin.distanceTo(Y),object:this,face:null,faceIndex:D,uv:null,uv2:null})}}}}};ir.prototype.isLineSegments2=!0;var yn=class extends bn{constructor(){super(),this.type="LineGeometry"}setPositions(e){for(var t=e.length-3,o=new Float32Array(2*t),r=0;r<t;r+=3)o[2*r]=e[r],o[2*r+1]=e[r+1],o[2*r+2]=e[r+2],o[2*r+3]=e[r+3],o[2*r+4]=e[r+4],o[2*r+5]=e[r+5];return super.setPositions(o),this}setColors(e){for(var t=e.length-3,o=new Float32Array(2*t),r=0;r<t;r+=3)o[2*r]=e[r],o[2*r+1]=e[r+1],o[2*r+2]=e[r+2],o[2*r+3]=e[r+3],o[2*r+4]=e[r+4],o[2*r+5]=e[r+5];return super.setColors(o),this}fromLine(e){var t=e.geometry;if(t.isGeometry){console.error("LineGeometry no longer supports Geometry. Use BufferGeometry instead.");return}else t.isBufferGeometry&&this.setPositions(t.attributes.position.array);return this}};yn.prototype.isLineGeometry=!0;var sr=class extends ir{constructor(e=new yn,t=new bt({color:Math.random()*16777215})){super(e,t),this.type="Line2"}};sr.prototype.isLine2=!0;var ap=new yn;ap.setPositions([0,0,0,0,0,-1]);var ar=class extends De{constructor(e,t,o){super(),this._length=1,this.line=new sr(ap,xu({color:e,transparent:t<1,opacity:t,linewidth:o})),this.line.computeLineDistances(),ne(this,this.line)}get length(){return this._length}set length(e){this._length=e,this.line.scale.set(1,1,e)}};var Ti=class extends qn{constructor(e){super(),this.element=e,this._hidden=!1,this.visible=!0,this.style="default",document.addEventListener("pointerlockchange",()=>{this._hidden=!!document.pointerLockElement,this.refresh()})}get style(){return super.style}set style(e){super.style=e,this.refresh()}get visible(){return super.visible&&!this._hidden}set visible(e){super.visible=e,this.refresh()}refresh(){this.element.style.cursor=this.visible?this.style:"none"}};var Qn=class extends qt{constructor(e){super(e),this.xr=e.cursor3D&&e.cursor3D.clone()||new En(this.env),this.system=new Ti(this.env.renderer.domElement),this.xr.side=this.side,this.visible=!1,Object.seal(this)}get object(){return this.xr.object}get side(){return this.xr.side}set side(e){this.xr.side=e}get cursor(){return this.xr}set cursor(e){this.xr=e,this._refresh()}get style(){return this.system.style}get visible(){return super.visible}set visible(e){super.visible=e,this._refresh()}set style(e){this.system.style=e,this.xr.style=e,this._refresh()}_refresh(){let e=this.env.eventSys&&this.env.eventSys.mouse&&this.env.eventSys.mouse.isPointerLocked,t=this.env.renderer.xr.isPresenting||e;wt(this.xr,this.visible&&t),this.system.visible=this.visible&&!t}lookAt(e,t){this.xr.lookAt(e,t)}};var vi="Juniper:ThreeJS:EventSystem:RayTarget",Ea=class extends ce{constructor(e){super(),this.object=e,this.meshes=new Array,this._disabled=!1,this._clickable=!1,this._draggable=!1,this._navigable=!1,this.object.userData[vi]=this}addMesh(e){return e.userData[vi]=this,this.meshes.push(e),this}removeMesh(e){return nt(this.meshes,e)&&delete e.userData[vi],this}addMeshes(...e){for(let t of e)this.addMesh(t);return this}removeMeshes(...e){for(let t of e)this.removeMesh(t);return this}get disabled(){return this._disabled}set disabled(e){this._disabled=e}get enabled(){return!this.disabled}set enabled(e){this.disabled=!e}get clickable(){return this._clickable}set clickable(e){this._clickable=e}get draggable(){return this._draggable}set draggable(e){this._draggable=e}get navigable(){return this._navigable}set navigable(e){this._navigable=e}};function im(n){return n instanceof Ea}function cr(n){let e=null;return n&&(im(n)?e=n:(n=ht(n),n&&(e=n.userData[vi])),e&&!Xs(e)&&(e=null)),e}var ki=class extends me{constructor(e,t){super(e),this.pointer=t,this._hit=null,this._point=null,this._distance=Number.POSITIVE_INFINITY,this._rayTarget=null,Object.seal(this)}set(e,t){e!==this.hit&&(this._hit=e,e?(this._point=e.point,this._distance=e.distance):(this._point=null,this._distance=Number.POSITIVE_INFINITY)),this._rayTarget=t}get hit(){return this._hit}get rayTarget(){return this._rayTarget}get point(){return this._point}get distance(){return this._distance}};var sm=5,am=new W,Lt=class extends ce{constructor(e,t,o,r){super(),this.type=e,this.id=t,this.env=o,this.origin=new W,this.direction=new W,this.up=new W(0,1,0),this.canMoveView=!1,this.mayTeleport=!1,this.buttons=0,this._isActive=!1,this.moveDistance=0,this.pointerEvents=new Map,this.lastButtons=0,this.canClick=!1,this.dragDistance=0,this._enabled=!1,this._cursor=null,this._curHit=null,this._curTarget=null,this._hoveredHit=null,this._hoveredTarget=null,this._cursor=r,this.cursor&&(this.cursor.visible=!1)}get isActive(){return this._isActive}get canSend(){return this.enabled&&this.isActive}get curHit(){return this._curHit}get curTarget(){return this._curTarget}get hoveredHit(){return this._hoveredHit}set hoveredHit(e){if(e!==this.hoveredHit){let t=cr(e);this._hoveredHit=e,this._hoveredTarget=t}}get name(){return Me[this.id]}get rayTarget(){return this._hoveredTarget}get cursor(){return this._cursor}set cursor(e){if(e!==this.cursor){let t=this.cursor,o=this.cursor&&this.cursor.object&&this.cursor.object.name||"cursor",r=t&&t.object&&t.object.parent;r&&t.object.removeFromParent(),e&&(e.object.name=o,t instanceof Qn?(t.cursor=e,r&&ne(r,t)):(this._cursor=e,t&&(r&&ne(r,e),e.style=t.style,e.visible=t.visible)))}}get needsUpdate(){return this.enabled&&this._isActive}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.cursor&&(this.cursor.visible=e)}setButton(e,t){this.lastButtons=this.buttons;let o=1<<e;if(t?this.buttons|=o:this.buttons&=~o,t)this.canClick=!0,this.dragDistance=0,this.env.avatar.setMode(this),this.setEventState("down");else{if(this.canClick){let r=this.buttons;this.buttons=this.lastButtons,this.setEventState("click"),this.buttons=r}this.setEventState("up")}}isPressed(e){let t=1<<e;return(this.buttons&t)!==0}wasPressed(e){let t=1<<e;return(this.lastButtons&t)!==0}fireRay(e,t){let o=this.env.eventSys.fireRay(e,t);if(o!==this.curHit){let r=cr(o);this._curHit=o,this._curTarget=r}}getEvent(e){this.pointerEvents.has(e)||this.pointerEvents.set(e,new ki(e,this));let t=this.pointerEvents.get(e);if(this.hoveredHit?t.set(this.hoveredHit,this.rayTarget):this.curHit?t.set(this.curHit,this.curTarget):t.set(null,null),t.hit){let o=this.curHit||this.hoveredHit;o&&t.hit!==o&&(t.hit.uv=o.uv)}return t}update(){this.needsUpdate&&this.onUpdate()}onUpdate(){this.updatePointerOrientation();let e=this.isPressed(Fe.Primary);(this.moveDistance>0||e)&&(e&&(this.dragDistance+=this.moveDistance,this.dragDistance>sm&&(this.canClick=!1)),this.setEventState("move")),this.moveDistance=0}setEventState(e){if(this.fireRay(this.origin,this.direction),this.curTarget===this.rayTarget)this.hoveredHit=this.curHit;else{let o=this.isPressed(Fe.Primary),r=this.wasPressed(Fe.Primary);if(e==="move"&&!o||e==="down"&&o&&!r||e==="up"&&!o&&r){if(this.rayTarget){let u=this.getEvent("up");this.rayTarget.dispatchEvent(u);let h=this.getEvent("exit");this.dispatchEvent(h),this.rayTarget.dispatchEvent(h)}if(this.hoveredHit=this.curHit,this.rayTarget){let u=this.getEvent("enter");this.dispatchEvent(u),this.rayTarget.dispatchEvent(u)}}this.hoveredHit&&this.hoveredHit.point.copy(this.direction).multiplyScalar(this.hoveredHit.distance).add(this.origin)}let t=this.getEvent(e);this.dispatchEvent(t),t.rayTarget&&(e!=="click"||t.rayTarget.clickable||t.rayTarget.navigable)&&(e==="click"&&t.rayTarget.clickable&&this.vibrate(),t.rayTarget.enabled&&t.rayTarget.dispatchEvent(t)),this.updateCursor(this.env.avatar.worldPos,am,!0,2)}get canDragView(){return this.canMoveView}get canTeleport(){return this.mayTeleport}updateCursor(e,t,o,r){this.cursor&&this.cursor.update(e,t,this.hoveredHit||this.curHit,this.rayTarget||this.curTarget,r,o,this.canDragView,this.canTeleport,this.origin,this.direction,this.isPressed(Fe.Primary))}get bufferSize(){return 37}writeState(e){e.writeUint8(this.id),e.writeVector48(this.origin),e.writeVector48(this.direction),e.writeVector48(this.up)}};var cm=.2,xM=.5*cm-.025;var cp=new Wr(1,1,1,1);cp.name="PlaneGeom";var _M=new de,SM=new W,TM=new ft,vM=new te;var KM=new W;var tE=Hn("juniper::loadedFonts",()=>[]);var $E={fontFamily:Nc(),fontSize:20,fontWeight:"bold",textFillColor:"white",textStrokeColor:"black",textStrokeSize:.01,padding:{top:.025,right:.05,bottom:.025,left:.05},maxHeight:.2};var ba=["none","right","left"],Rb=xr(sn);function ya(n,e){if(e===Ql)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===bo||e===Xr){let t=n.getIndex();if(t===null){let s=[],l=n.getAttribute("position");if(l!==void 0){for(let u=0;u<l.count;u++)s.push(u);n.setIndex(s),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}let o=t.count-2,r=[];if(e===bo)for(let s=1;s<=o;s++)r.push(t.getX(0)),r.push(t.getX(s)),r.push(t.getX(s+1));else for(let s=0;s<o;s++)s%2===0?(r.push(t.getX(s)),r.push(t.getX(s+1)),r.push(t.getX(s+2))):(r.push(t.getX(s+2)),r.push(t.getX(s+1)),r.push(t.getX(s)));r.length/3!==o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let i=n.clone();return i.setIndex(r),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}var Jt=class extends Bl{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Ia(t)}),this.register(function(t){return new Xa(t)}),this.register(function(t){return new Ua(t)}),this.register(function(t){return new za(t)}),this.register(function(t){return new Wa(t)}),this.register(function(t){return new Oa(t)}),this.register(function(t){return new Ha(t)}),this.register(function(t){return new Na(t)}),this.register(function(t){return new Pa(t)}),this.register(function(t){return new Ga(t)}),this.register(function(t){return new Va(t)}),this.register(function(t){return new La(t)}),this.register(function(t){return new ja(t)}),this.register(function(t){return new qa(t)})}load(e,t,o,r){let i=this,s;this.resourcePath!==""?s=this.resourcePath:this.path!==""?s=this.path:s=Lr.extractUrlBase(e),this.manager.itemStart(e);let l=function(h){r?r(h):console.error(h),i.manager.itemError(e),i.manager.itemEnd(e)},u=new Ds(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(h){try{i.parse(h,s,function(x){t(x),i.manager.itemEnd(e)},l)}catch(x){l(x)}},o,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,o,r){let i,s={},l={},u=new TextDecoder;if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(u.decode(new Uint8Array(e,0,4))===hp){try{s[q.KHR_BINARY_GLTF]=new Qa(e)}catch(g){r&&r(g);return}i=JSON.parse(s[q.KHR_BINARY_GLTF].content)}else i=JSON.parse(u.decode(e));else i=e;if(i.asset===void 0||i.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let h=new tc(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let x=0;x<this.pluginCallbacks.length;x++){let g=this.pluginCallbacks[x](h);l[g.name]=g,s[g.name]=!0}if(i.extensionsUsed)for(let x=0;x<i.extensionsUsed.length;++x){let g=i.extensionsUsed[x],A=i.extensionsRequired||[];switch(g){case q.KHR_MATERIALS_UNLIT:s[g]=new Ra;break;case q.KHR_DRACO_MESH_COMPRESSION:s[g]=new Ka(i,this.dracoLoader);break;case q.KHR_TEXTURE_TRANSFORM:s[g]=new Ja;break;case q.KHR_MESH_QUANTIZATION:s[g]=new Ya;break;default:A.indexOf(g)>=0&&l[g]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+g+'".')}}h.setExtensions(s),h.setPlugins(l),h.parse(o,r)}parseAsync(e,t){let o=this;return new Promise(function(r,i){o.parse(e,t,r,i)})}};function dm(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}var q={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"},La=class{constructor(e){this.parser=e,this.name=q.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let o=0,r=t.length;o<r;o++){let i=t[o];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){let t=this.parser,o="light:"+e,r=t.cache.get(o);if(r)return r;let i=t.json,u=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e],h,x=new we(16777215);u.color!==void 0&&x.fromArray(u.color);let g=u.range!==void 0?u.range:0;switch(u.type){case"directional":h=new yr(x),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new Vl(x),h.distance=g;break;case"spot":h=new zl(x),h.distance=g,u.spot=u.spot||{},u.spot.innerConeAngle=u.spot.innerConeAngle!==void 0?u.spot.innerConeAngle:0,u.spot.outerConeAngle=u.spot.outerConeAngle!==void 0?u.spot.outerConeAngle:Math.PI/4,h.angle=u.spot.outerConeAngle,h.penumbra=1-u.spot.innerConeAngle/u.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+u.type)}return h.position.set(0,0,0),h.decay=2,Kt(h,u),u.intensity!==void 0&&(h.intensity=u.intensity),h.name=t.createUniqueName(u.name||"light_"+e),r=Promise.resolve(h),t.cache.add(o,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){let t=this,o=this.parser,i=o.json.nodes[e],l=(i.extensions&&i.extensions[this.name]||{}).light;return l===void 0?null:this._loadLight(l).then(function(u){return o._getNodeRef(t.cache,l,u)})}},Ra=class{constructor(){this.name=q.KHR_MATERIALS_UNLIT}getMaterialType(){return it}extendParams(e,t,o){let r=[];e.color=new we(1,1,1),e.opacity=1;let i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){let s=i.baseColorFactor;e.color.fromArray(s),e.opacity=s[3]}i.baseColorTexture!==void 0&&r.push(o.assignTexture(e,"map",i.baseColorTexture,In))}return Promise.all(r)}},Pa=class{constructor(e){this.parser=e,this.name=q.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}},Ia=class{constructor(e){this.parser=e,this.name=q.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Pt}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];if(s.clearcoatFactor!==void 0&&(t.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&i.push(o.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&i.push(o.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(i.push(o.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){let l=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ve(l,l)}return Promise.all(i)}},Va=class{constructor(e){this.parser=e,this.name=q.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Pt}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];return s.iridescenceFactor!==void 0&&(t.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&i.push(o.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(t.iridescenceIOR=s.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&i.push(o.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(i)}},Wa=class{constructor(e){this.parser=e,this.name=q.KHR_MATERIALS_SHEEN}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Pt}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[];t.sheenColor=new we(0,0,0),t.sheenRoughness=0,t.sheen=1;let s=r.extensions[this.name];return s.sheenColorFactor!==void 0&&t.sheenColor.fromArray(s.sheenColorFactor),s.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&i.push(o.assignTexture(t,"sheenColorMap",s.sheenColorTexture,In)),s.sheenRoughnessTexture!==void 0&&i.push(o.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(i)}},Oa=class{constructor(e){this.parser=e,this.name=q.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Pt}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];return s.transmissionFactor!==void 0&&(t.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&i.push(o.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(i)}},Ha=class{constructor(e){this.parser=e,this.name=q.KHR_MATERIALS_VOLUME}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Pt}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];t.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&i.push(o.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;let l=s.attenuationColor||[1,1,1];return t.attenuationColor=new we(l[0],l[1],l[2]),Promise.all(i)}},Na=class{constructor(e){this.parser=e,this.name=q.KHR_MATERIALS_IOR}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Pt}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}},Ga=class{constructor(e){this.parser=e,this.name=q.KHR_MATERIALS_SPECULAR}getMaterialType(e){let o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Pt}extendMaterialParams(e,t){let o=this.parser,r=o.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];t.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&i.push(o.assignTexture(t,"specularIntensityMap",s.specularTexture));let l=s.specularColorFactor||[1,1,1];return t.specularColor=new we(l[0],l[1],l[2]),s.specularColorTexture!==void 0&&i.push(o.assignTexture(t,"specularColorMap",s.specularColorTexture,In)),Promise.all(i)}},Xa=class{constructor(e){this.parser=e,this.name=q.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,o=t.json,r=o.textures[e];if(!r.extensions||!r.extensions[this.name])return null;let i=r.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(o.extensionsRequired&&o.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,s)}},Ua=class{constructor(e){this.parser=e,this.name=q.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,o=this.parser,r=o.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;let s=i.extensions[t],l=r.images[s.source],u=o.textureLoader;if(l.uri){let h=o.options.manager.getHandler(l.uri);h!==null&&(u=h)}return this.detectSupport().then(function(h){if(h)return o.loadTextureImage(e,s.source,u);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return o.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},za=class{constructor(e){this.parser=e,this.name=q.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let t=this.name,o=this.parser,r=o.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;let s=i.extensions[t],l=r.images[s.source],u=o.textureLoader;if(l.uri){let h=o.options.manager.getHandler(l.uri);h!==null&&(u=h)}return this.detectSupport().then(function(h){if(h)return o.loadTextureImage(e,s.source,u);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return o.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},ja=class{constructor(e){this.name=q.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,o=t.bufferViews[e];if(o.extensions&&o.extensions[this.name]){let r=o.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(l){let u=r.byteOffset||0,h=r.byteLength||0,x=r.count,g=r.byteStride,A=new Uint8Array(l,u,h);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(x,g,A,r.mode,r.filter).then(function(_){return _.buffer}):s.ready.then(function(){let _=new ArrayBuffer(x*g);return s.decodeGltfBuffer(new Uint8Array(_),x,g,A,r.mode,r.filter),_})})}else return null}},qa=class{constructor(e){this.name=q.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){let t=this.parser.json,o=t.nodes[e];if(!o.extensions||!o.extensions[this.name]||o.mesh===void 0)return null;let r=t.meshes[o.mesh];for(let h of r.primitives)if(h.mode!==lt.TRIANGLES&&h.mode!==lt.TRIANGLE_STRIP&&h.mode!==lt.TRIANGLE_FAN&&h.mode!==void 0)return null;let s=o.extensions[this.name].attributes,l=[],u={};for(let h in s)l.push(this.parser.getDependency("accessor",s[h]).then(x=>(u[h]=x,u[h])));return l.length<1?null:(l.push(this.parser.createNodeMesh(e)),Promise.all(l).then(h=>{let x=h.pop(),g=x.isGroup?x.children:[x],A=h[0].count,_=[];for(let M of g){let B=new de,y=new W,V=new te,I=new W(1,1,1),L=new Br(M.geometry,M.material,A);for(let D=0;D<A;D++)u.TRANSLATION&&y.fromBufferAttribute(u.TRANSLATION,D),u.ROTATION&&V.fromBufferAttribute(u.ROTATION,D),u.SCALE&&I.fromBufferAttribute(u.SCALE,D),L.setMatrixAt(D,B.compose(y,V,I));for(let D in u)D!=="TRANSLATION"&&D!=="ROTATION"&&D!=="SCALE"&&M.geometry.setAttribute(D,u[D]);De.prototype.copy.call(L,M),this.parser.assignFinalMaterial(L),_.push(L)}return x.isGroup?(x.clear(),x.add(..._),x):_[0]}))}},hp="glTF",lr=12,lp={JSON:1313821514,BIN:5130562},Qa=class{constructor(e){this.name=q.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,lr),o=new TextDecoder;if(this.header={magic:o.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==hp)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-lr,i=new DataView(e,lr),s=0;for(;s<r;){let l=i.getUint32(s,!0);s+=4;let u=i.getUint32(s,!0);if(s+=4,u===lp.JSON){let h=new Uint8Array(e,lr+s,l);this.content=o.decode(h)}else if(u===lp.BIN){let h=lr+s;this.body=e.slice(h,h+l)}s+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},Ka=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=q.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let o=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,l={},u={},h={};for(let x in s){let g=$a[x]||x.toLowerCase();l[g]=s[x]}for(let x in e.attributes){let g=$a[x]||x.toLowerCase();if(s[x]!==void 0){let A=o.accessors[e.attributes[x]],_=Kn[A.componentType];h[g]=_.name,u[g]=A.normalized===!0}}return t.getDependency("bufferView",i).then(function(x){return new Promise(function(g){r.decodeDracoFile(x,function(A){for(let _ in A.attributes){let M=A.attributes[_],B=u[_];B!==void 0&&(M.normalized=B)}g(A)},l,h)})})}},Ja=class{constructor(){this.name=q.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},Ya=class{constructor(){this.name=q.KHR_MESH_QUANTIZATION}},Mi=class extends vl{constructor(e,t,o,r){super(e,t,o,r)}copySampleValue_(e){let t=this.resultBuffer,o=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let s=0;s!==r;s++)t[s]=o[i+s];return t}interpolate_(e,t,o,r){let i=this.resultBuffer,s=this.sampleValues,l=this.valueSize,u=l*2,h=l*3,x=r-t,g=(o-t)/x,A=g*g,_=A*g,M=e*h,B=M-h,y=-2*_+3*A,V=_-A,I=1-y,L=V-A+g;for(let D=0;D!==l;D++){let O=s[B+D+l],C=s[B+D+u]*x,R=s[M+D+l],j=s[M+D]*x;i[D]=I*O+L*C+y*R+V*j}return i}},hm=new te,Za=class extends Mi{interpolate_(e,t,o,r){let i=super.interpolate_(e,t,o,r);return hm.fromArray(i).normalize().toArray(i),i}},lt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Kn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},up={9728:Ir,9729:ko,9984:Pl,9985:Cl,9986:Rl,9987:Ps},pp={33071:ml,33648:Ll,10497:Or},Da={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$a={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Qt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},mm={CUBICSPLINE:void 0,LINEAR:Ls,STEP:kl},Ca={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function xm(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new Vs({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Cs})),n.DefaultMaterial}function Dn(n,e,t){for(let o in t.extensions)n[o]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[o]=t.extensions[o])}function Kt(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function fm(n,e,t){let o=!1,r=!1,i=!1;for(let h=0,x=e.length;h<x;h++){let g=e[h];if(g.POSITION!==void 0&&(o=!0),g.NORMAL!==void 0&&(r=!0),g.COLOR_0!==void 0&&(i=!0),o&&r&&i)break}if(!o&&!r&&!i)return Promise.resolve(n);let s=[],l=[],u=[];for(let h=0,x=e.length;h<x;h++){let g=e[h];if(o){let A=g.POSITION!==void 0?t.getDependency("accessor",g.POSITION):n.attributes.position;s.push(A)}if(r){let A=g.NORMAL!==void 0?t.getDependency("accessor",g.NORMAL):n.attributes.normal;l.push(A)}if(i){let A=g.COLOR_0!==void 0?t.getDependency("accessor",g.COLOR_0):n.attributes.color;u.push(A)}}return Promise.all([Promise.all(s),Promise.all(l),Promise.all(u)]).then(function(h){let x=h[0],g=h[1],A=h[2];return o&&(n.morphAttributes.position=x),r&&(n.morphAttributes.normal=g),i&&(n.morphAttributes.color=A),n.morphTargetsRelative=!0,n})}function gm(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,o=e.weights.length;t<o;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){let t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let o=0,r=t.length;o<r;o++)n.morphTargetDictionary[t[o]]=o}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function wm(n){let e,t=n.extensions&&n.extensions[q.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Ba(t.attributes):e=n.indices+":"+Ba(n.attributes)+":"+n.mode,n.targets!==void 0)for(let o=0,r=n.targets.length;o<r;o++)e+=":"+Ba(n.targets[o]);return e}function Ba(n){let e="",t=Object.keys(n).sort();for(let o=0,r=t.length;o<r;o++)e+=t[o]+":"+n[t[o]]+";";return e}function ec(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Fm(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}var Am=new de,tc=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new dm,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let o=!1,r=!1,i=-1;typeof navigator<"u"&&(o=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,i=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||o||r&&i<98?this.textureLoader=new ql(this.options.manager):this.textureLoader=new Sl(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ds(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let o=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([o.getDependencies("scene"),o.getDependencies("animation"),o.getDependencies("camera")])}).then(function(s){let l={scene:s[0][r.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:r.asset,parser:o,userData:{}};Dn(i,l,r),Kt(l,r),Promise.all(o._invokeAll(function(u){return u.afterRoot&&u.afterRoot(l)})).then(function(){e(l)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],o=this.json.meshes||[];for(let r=0,i=t.length;r<i;r++){let s=t[r].joints;for(let l=0,u=s.length;l<u;l++)e[s[l]].isBone=!0}for(let r=0,i=e.length;r<i;r++){let s=e[r];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(o[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,o){if(e.refs[t]<=1)return o;let r=o.clone(),i=(s,l)=>{let u=this.associations.get(s);u!=null&&this.associations.set(l,u);for(let[h,x]of s.children.entries())i(x,l.children[h])};return i(o,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let o=0;o<t.length;o++){let r=e(t[o]);if(r)return r}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let o=[];for(let r=0;r<t.length;r++){let i=e(t[r]);i&&o.push(i)}return o}getDependency(e,t){let o=e+":"+t,r=this.cache.get(o);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(i){return i.loadNode&&i.loadNode(t)});break;case"mesh":r=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(o,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){let o=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(i,s){return o.getDependency(e,s)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],o=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[q.KHR_BINARY_GLTF].body);let r=this.options;return new Promise(function(i,s){o.load(Lr.resolveURL(t.uri,r.path),i,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(o){let r=t.byteLength||0,i=t.byteOffset||0;return o.slice(i,i+r)})}loadAccessor(e){let t=this,o=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){let s=Da[r.type],l=Kn[r.componentType],u=r.normalized===!0,h=new l(r.count*s);return Promise.resolve(new To(h,s,u))}let i=[];return r.bufferView!==void 0?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),r.sparse!==void 0&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then(function(s){let l=s[0],u=Da[r.type],h=Kn[r.componentType],x=h.BYTES_PER_ELEMENT,g=x*u,A=r.byteOffset||0,_=r.bufferView!==void 0?o.bufferViews[r.bufferView].byteStride:void 0,M=r.normalized===!0,B,y;if(_&&_!==g){let V=Math.floor(A/_),I="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+V+":"+r.count,L=t.cache.get(I);L||(B=new h(l,V*_,r.count*_/x),L=new Bs(B,_/x),t.cache.add(I,L)),y=new dt(L,u,A%_/x,M)}else l===null?B=new h(r.count*u):B=new h(l,A,r.count*u),y=new To(B,u,M);if(r.sparse!==void 0){let V=Da.SCALAR,I=Kn[r.sparse.indices.componentType],L=r.sparse.indices.byteOffset||0,D=r.sparse.values.byteOffset||0,O=new I(s[1],L,r.sparse.count*V),C=new h(s[2],D,r.sparse.count*u);l!==null&&(y=new To(y.array.slice(),y.itemSize,y.normalized));for(let R=0,j=O.length;R<j;R++){let ie=O[R];if(y.setX(ie,C[R*u]),u>=2&&y.setY(ie,C[R*u+1]),u>=3&&y.setZ(ie,C[R*u+2]),u>=4&&y.setW(ie,C[R*u+3]),u>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return y})}loadTexture(e){let t=this.json,o=this.options,i=t.textures[e].source,s=t.images[i],l=this.textureLoader;if(s.uri){let u=o.manager.getHandler(s.uri);u!==null&&(l=u)}return this.loadTextureImage(e,i,l)}loadTextureImage(e,t,o){let r=this,i=this.json,s=i.textures[e],l=i.images[t],u=(l.uri||l.bufferView)+":"+s.sampler;if(this.textureCache[u])return this.textureCache[u];let h=this.loadImageSource(t,o).then(function(x){x.flipY=!1,x.name=s.name||l.name||"",x.name===""&&typeof l.uri=="string"&&l.uri.startsWith("data:image/")===!1&&(x.name=l.uri);let A=(i.samplers||{})[s.sampler]||{};return x.magFilter=up[A.magFilter]||ko,x.minFilter=up[A.minFilter]||Ps,x.wrapS=pp[A.wrapS]||Or,x.wrapT=pp[A.wrapT]||Or,r.associations.set(x,{textures:e}),x}).catch(function(){return null});return this.textureCache[u]=h,h}loadImageSource(e,t){let o=this,r=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(g=>g.clone());let s=r.images[e],l=self.URL||self.webkitURL,u=s.uri||"",h=!1;if(s.bufferView!==void 0)u=o.getDependency("bufferView",s.bufferView).then(function(g){h=!0;let A=new Blob([g],{type:s.mimeType});return u=l.createObjectURL(A),u});else if(s.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let x=Promise.resolve(u).then(function(g){return new Promise(function(A,_){let M=A;t.isImageBitmapLoader===!0&&(M=function(B){let y=new Gr(B);y.needsUpdate=!0,A(y)}),t.load(Lr.resolveURL(g,i.path),M,void 0,_)})}).then(function(g){return h===!0&&l.revokeObjectURL(u),g.userData.mimeType=s.mimeType||Fm(s.uri),g}).catch(function(g){throw console.error("THREE.GLTFLoader: Couldn't load texture",u),g});return this.sourceCache[e]=x,x}assignTexture(e,t,o,r){let i=this;return this.getDependency("texture",o.index).then(function(s){if(!s)return null;if(o.texCoord!==void 0&&o.texCoord>0&&(s=s.clone(),s.channel=o.texCoord),i.extensions[q.KHR_TEXTURE_TRANSFORM]){let l=o.extensions!==void 0?o.extensions[q.KHR_TEXTURE_TRANSFORM]:void 0;if(l){let u=i.associations.get(s);s=i.extensions[q.KHR_TEXTURE_TRANSFORM].extendTexture(s,l),i.associations.set(s,u)}}return r!==void 0&&(s.colorSpace=r),e[t]=s,s})}assignFinalMaterial(e){let t=e.geometry,o=e.material,r=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,s=t.attributes.normal===void 0;if(e.isPoints){let l="PointsMaterial:"+o.uuid,u=this.cache.get(l);u||(u=new Ol,Rr.prototype.copy.call(u,o),u.color.copy(o.color),u.map=o.map,u.sizeAttenuation=!1,this.cache.add(l,u)),o=u}else if(e.isLine){let l="LineBasicMaterial:"+o.uuid,u=this.cache.get(l);u||(u=new Rs,Rr.prototype.copy.call(u,o),u.color.copy(o.color),u.map=o.map,this.cache.add(l,u)),o=u}if(r||i||s){let l="ClonedMaterial:"+o.uuid+":";r&&(l+="derivative-tangents:"),i&&(l+="vertex-colors:"),s&&(l+="flat-shading:");let u=this.cache.get(l);u||(u=o.clone(),i&&(u.vertexColors=!0),s&&(u.flatShading=!0),r&&(u.normalScale&&(u.normalScale.y*=-1),u.clearcoatNormalScale&&(u.clearcoatNormalScale.y*=-1)),this.cache.add(l,u),this.associations.set(u,this.associations.get(o))),o=u}e.material=o}getMaterialType(){return Vs}loadMaterial(e){let t=this,o=this.json,r=this.extensions,i=o.materials[e],s,l={},u=i.extensions||{},h=[];if(u[q.KHR_MATERIALS_UNLIT]){let g=r[q.KHR_MATERIALS_UNLIT];s=g.getMaterialType(),h.push(g.extendParams(l,i,t))}else{let g=i.pbrMetallicRoughness||{};if(l.color=new we(1,1,1),l.opacity=1,Array.isArray(g.baseColorFactor)){let A=g.baseColorFactor;l.color.fromArray(A),l.opacity=A[3]}g.baseColorTexture!==void 0&&h.push(t.assignTexture(l,"map",g.baseColorTexture,In)),l.metalness=g.metallicFactor!==void 0?g.metallicFactor:1,l.roughness=g.roughnessFactor!==void 0?g.roughnessFactor:1,g.metallicRoughnessTexture!==void 0&&(h.push(t.assignTexture(l,"metalnessMap",g.metallicRoughnessTexture)),h.push(t.assignTexture(l,"roughnessMap",g.metallicRoughnessTexture))),s=this._invokeOne(function(A){return A.getMaterialType&&A.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(A){return A.extendMaterialParams&&A.extendMaterialParams(e,l)})))}i.doubleSided===!0&&(l.side=wl);let x=i.alphaMode||Ca.OPAQUE;if(x===Ca.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,x===Ca.MASK&&(l.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&s!==it&&(h.push(t.assignTexture(l,"normalMap",i.normalTexture)),l.normalScale=new ve(1,1),i.normalTexture.scale!==void 0)){let g=i.normalTexture.scale;l.normalScale.set(g,g)}return i.occlusionTexture!==void 0&&s!==it&&(h.push(t.assignTexture(l,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&s!==it&&(l.emissive=new we().fromArray(i.emissiveFactor)),i.emissiveTexture!==void 0&&s!==it&&h.push(t.assignTexture(l,"emissiveMap",i.emissiveTexture,In)),Promise.all(h).then(function(){let g=new s(l);return i.name&&(g.name=i.name),Kt(g,i),t.associations.set(g,{materials:e}),i.extensions&&Dn(r,g,i),g})}createUniqueName(e){let t=Hl.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){let t=this,o=this.extensions,r=this.primitiveCache;function i(l){return o[q.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,t).then(function(u){return dp(u,l,t)})}let s=[];for(let l=0,u=e.length;l<u;l++){let h=e[l],x=wm(h),g=r[x];if(g)s.push(g.promise);else{let A;h.extensions&&h.extensions[q.KHR_DRACO_MESH_COMPRESSION]?A=i(h):A=dp(new bs,h,t),r[x]={primitive:h,promise:A},s.push(A)}}return Promise.all(s)}loadMesh(e){let t=this,o=this.json,r=this.extensions,i=o.meshes[e],s=i.primitives,l=[];for(let u=0,h=s.length;u<h;u++){let x=s[u].material===void 0?xm(this.cache):this.getDependency("material",s[u].material);l.push(x)}return l.push(t.loadGeometries(s)),Promise.all(l).then(function(u){let h=u.slice(0,u.length-1),x=u[u.length-1],g=[];for(let _=0,M=x.length;_<M;_++){let B=x[_],y=s[_],V,I=h[_];if(y.mode===lt.TRIANGLES||y.mode===lt.TRIANGLE_STRIP||y.mode===lt.TRIANGLE_FAN||y.mode===void 0)V=i.isSkinnedMesh===!0?new Ul(B,I):new rt(B,I),V.isSkinnedMesh===!0&&V.normalizeSkinWeights(),y.mode===lt.TRIANGLE_STRIP?V.geometry=ya(V.geometry,Xr):y.mode===lt.TRIANGLE_FAN&&(V.geometry=ya(V.geometry,bo));else if(y.mode===lt.LINES)V=new yl(B,I);else if(y.mode===lt.LINE_STRIP)V=new Ml(B,I);else if(y.mode===lt.LINE_LOOP)V=new bl(B,I);else if(y.mode===lt.POINTS)V=new Wl(B,I);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(V.geometry.morphAttributes).length>0&&gm(V,i),V.name=t.createUniqueName(i.name||"mesh_"+e),Kt(V,i),y.extensions&&Dn(r,V,y),t.assignFinalMaterial(V),g.push(V)}for(let _=0,M=g.length;_<M;_++)t.associations.set(g[_],{meshes:e,primitives:_});if(g.length===1)return i.extensions&&Dn(r,g[0],i),g[0];let A=new Cr;i.extensions&&Dn(r,A,i),t.associations.set(A,{meshes:e});for(let _=0,M=g.length;_<M;_++)A.add(g[_]);return A})}loadCamera(e){let t,o=this.json.cameras[e],r=o[o.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return o.type==="perspective"?t=new Mo(Pr.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):o.type==="orthographic"&&(t=new Vr(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),o.name&&(t.name=this.createUniqueName(o.name)),Kt(t,o),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],o=[];for(let r=0,i=t.joints.length;r<i;r++)o.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?o.push(this.getDependency("accessor",t.inverseBindMatrices)):o.push(null),Promise.all(o).then(function(r){let i=r.pop(),s=r,l=[],u=[];for(let h=0,x=s.length;h<x;h++){let g=s[h];if(g){l.push(g);let A=new de;i!==null&&A.fromArray(i.array,h*16),u.push(A)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[h])}return new Xl(l,u)})}loadAnimation(e){let o=this.json.animations[e],r=o.name?o.name:"animation_"+e,i=[],s=[],l=[],u=[],h=[];for(let x=0,g=o.channels.length;x<g;x++){let A=o.channels[x],_=o.samplers[A.sampler],M=A.target,B=M.node,y=o.parameters!==void 0?o.parameters[_.input]:_.input,V=o.parameters!==void 0?o.parameters[_.output]:_.output;M.node!==void 0&&(i.push(this.getDependency("node",B)),s.push(this.getDependency("accessor",y)),l.push(this.getDependency("accessor",V)),u.push(_),h.push(M))}return Promise.all([Promise.all(i),Promise.all(s),Promise.all(l),Promise.all(u),Promise.all(h)]).then(function(x){let g=x[0],A=x[1],_=x[2],M=x[3],B=x[4],y=[];for(let V=0,I=g.length;V<I;V++){let L=g[V],D=A[V],O=_[V],C=M[V],R=B[V];if(L===void 0)continue;L.updateMatrix();let j;switch(Qt[R.path]){case Qt.weights:j=Il;break;case Qt.rotation:j=Ws;break;case Qt.position:case Qt.scale:default:j=Kl;break}let ie=L.name?L.name:L.uuid,Q=C.interpolation!==void 0?mm[C.interpolation]:Ls,Y=[];Qt[R.path]===Qt.weights?L.traverse(function(Ee){Ee.morphTargetInfluences&&Y.push(Ee.name?Ee.name:Ee.uuid)}):Y.push(ie);let le=O.array;if(O.normalized){let Ee=ec(le.constructor),oe=new Float32Array(le.length);for(let ut=0,dr=le.length;ut<dr;ut++)oe[ut]=le[ut]*Ee;le=oe}for(let Ee=0,oe=Y.length;Ee<oe;Ee++){let ut=new j(Y[Ee]+"."+Qt[R.path],D.array,le,Q);C.interpolation==="CUBICSPLINE"&&(ut.createInterpolant=function(Zn){let Tt=this instanceof Ws?Za:Mi;return new Tt(this.times,this.values,this.getValueSize()/3,Zn)},ut.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),y.push(ut)}}return new pl(r,void 0,y)})}createNodeMesh(e){let t=this.json,o=this,r=t.nodes[e];return r.mesh===void 0?null:o.getDependency("mesh",r.mesh).then(function(i){let s=o._getNodeRef(o.meshCache,r.mesh,i);return r.weights!==void 0&&s.traverse(function(l){if(l.isMesh)for(let u=0,h=r.weights.length;u<h;u++)l.morphTargetInfluences[u]=r.weights[u]}),s})}loadNode(e){let t=this.json,o=this,r=t.nodes[e],i=o._loadNodeShallow(e),s=[],l=r.children||[];for(let h=0,x=l.length;h<x;h++)s.push(o.getDependency("node",l[h]));let u=r.skin===void 0?Promise.resolve(null):o.getDependency("skin",r.skin);return Promise.all([i,Promise.all(s),u]).then(function(h){let x=h[0],g=h[1],A=h[2];A!==null&&x.traverse(function(_){_.isSkinnedMesh&&_.bind(A,Am)});for(let _=0,M=g.length;_<M;_++)x.add(g[_]);return x})}_loadNodeShallow(e){let t=this.json,o=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];let i=t.nodes[e],s=i.name?r.createUniqueName(i.name):"",l=[],u=r._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return u&&l.push(u),i.camera!==void 0&&l.push(r.getDependency("camera",i.camera).then(function(h){return r._getNodeRef(r.cameraCache,i.camera,h)})),r._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){l.push(h)}),this.nodeCache[e]=Promise.all(l).then(function(h){let x;if(i.isBone===!0?x=new hl:h.length>1?x=new Cr:h.length===1?x=h[0]:x=new De,x!==h[0])for(let g=0,A=h.length;g<A;g++)x.add(h[g]);if(i.name&&(x.userData.name=i.name,x.name=s),Kt(x,i),i.extensions&&Dn(o,x,i),i.matrix!==void 0){let g=new de;g.fromArray(i.matrix),x.applyMatrix4(g)}else i.translation!==void 0&&x.position.fromArray(i.translation),i.rotation!==void 0&&x.quaternion.fromArray(i.rotation),i.scale!==void 0&&x.scale.fromArray(i.scale);return r.associations.has(x)||r.associations.set(x,{}),r.associations.get(x).nodes=e,x}),this.nodeCache[e]}loadScene(e){let t=this.extensions,o=this.json.scenes[e],r=this,i=new Cr;o.name&&(i.name=r.createUniqueName(o.name)),Kt(i,o),o.extensions&&Dn(t,i,o);let s=o.nodes||[],l=[];for(let u=0,h=s.length;u<h;u++)l.push(r.getDependency("node",s[u]));return Promise.all(l).then(function(u){for(let x=0,g=u.length;x<g;x++)i.add(u[x]);let h=x=>{let g=new Map;for(let[A,_]of r.associations)(A instanceof Rr||A instanceof Gr)&&g.set(A,_);return x.traverse(A=>{let _=r.associations.get(A);_!=null&&g.set(A,_)}),g};return r.associations=h(i),i})}};function _m(n,e,t){let o=e.attributes,r=new ln;if(o.POSITION!==void 0){let l=t.json.accessors[o.POSITION],u=l.min,h=l.max;if(u!==void 0&&h!==void 0){if(r.set(new W(u[0],u[1],u[2]),new W(h[0],h[1],h[2])),l.normalized){let x=ec(Kn[l.componentType]);r.min.multiplyScalar(x),r.max.multiplyScalar(x)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let i=e.targets;if(i!==void 0){let l=new W,u=new W;for(let h=0,x=i.length;h<x;h++){let g=i[h];if(g.POSITION!==void 0){let A=t.json.accessors[g.POSITION],_=A.min,M=A.max;if(_!==void 0&&M!==void 0){if(u.setX(Math.max(Math.abs(_[0]),Math.abs(M[0]))),u.setY(Math.max(Math.abs(_[1]),Math.abs(M[1]))),u.setZ(Math.max(Math.abs(_[2]),Math.abs(M[2]))),A.normalized){let B=ec(Kn[A.componentType]);u.multiplyScalar(B)}l.max(u)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(l)}n.boundingBox=r;let s=new Wn;r.getCenter(s.center),s.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=s}function dp(n,e,t){let o=e.attributes,r=[];function i(s,l){return t.getDependency("accessor",s).then(function(u){n.setAttribute(l,u)})}for(let s in o){let l=$a[s]||s.toLowerCase();l in n.attributes||r.push(i(o[s],l))}if(e.indices!==void 0&&!n.index){let s=t.getDependency("accessor",e.indices).then(function(l){n.setIndex(l)});r.push(s)}return Kt(n,e),_m(n,e,t),Promise.all(r).then(function(){return e.targets!==void 0?fm(n,e.targets,t):n})}var fe={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function mp(n){let e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function Sm(n){if(!n)throw new Error("No basePath supplied");return await mp(`${n}/profilesList.json`)}async function xp(n,e,t=null,o=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");let r=await Sm(e),i;if(n.profiles.some(u=>{let h=r[u];return h&&(i={profileId:u,profilePath:`${e}/${h.path}`,deprecated:!!h.deprecated}),!!i}),!i){if(!t)throw new Error("No matching profile name found");let u=r[t];if(!u)throw new Error(`No matching profile name found and default profile "${t}" missing.`);i={profileId:t,profilePath:`${e}/${u.path}`,deprecated:!!u.deprecated}}let s=await mp(i.profilePath),l;if(o){let u;if(n.handedness==="any"?u=s.layouts[Object.keys(s.layouts)[0]]:u=s.layouts[n.handedness],!u)throw new Error(`No matching handedness, ${n.handedness}, in profile ${i.profileId}`);u.assetPath&&(l=i.profilePath.replace("profile.json",u.assetPath))}return{profile:s,assetPath:l}}var Tm={xAxis:0,yAxis:0,button:0,state:fe.ComponentState.DEFAULT};function vm(n=0,e=0){let t=n,o=e;if(Math.sqrt(n*n+e*e)>1){let s=Math.atan2(e,n);t=Math.cos(s),o=Math.sin(s)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:o*.5+.5}}var nc=class{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===fe.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(Tm)}updateFromComponent({xAxis:e,yAxis:t,button:o,state:r}){let{normalizedXAxis:i,normalizedYAxis:s}=vm(e,t);switch(this.componentProperty){case fe.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?i:.5;break;case fe.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?s:.5;break;case fe.ComponentProperty.BUTTON:this.value=this.states.includes(r)?o:0;break;case fe.ComponentProperty.STATE:this.valueNodeProperty===fe.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},oc=class{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(o=>{let r=new nc(t.visualResponses[o]);this.visualResponses[o]=r}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:fe.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=fe.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){let t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=fe.ComponentState.PRESSED:(t.touched||this.values.button>fe.ButtonTouchThreshold)&&(this.values.state=fe.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===fe.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>fe.AxisTouchThreshold&&(this.values.state=fe.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===fe.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>fe.AxisTouchThreshold&&(this.values.state=fe.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}},Ei=class{constructor(e,t,o){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=o,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(r=>{let i=this.layoutDescription.components[r];this.components[r]=new oc(r,i)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}};var km="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Mm="generic-trigger",rc=class extends De{constructor(){super(...arguments),this.envMap=null,this.motionController=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{Et(t)&&(Lo(t.material)||Ro(t.material)||Po(t.material))&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(o=>{let{valueNode:r,minNode:i,maxNode:s}=o;r&&(Em(o)?r.visible=o.value:bm(o)&&(r.quaternion.slerpQuaternions(i.quaternion,s.quaternion,o.value),r.position.lerpVectors(i.position,s.position,o.value)))})}))}};function gp(n,e){return n&&n.valueNodeProperty===e}function Em(n){return gp(n,"visibility")}function bm(n){return gp(n,"transform")}function ym(n,e){Object.values(n.components).forEach(t=>{let{type:o,touchPointNodeName:r,visualResponses:i}=t;if(o===fe.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(r),t.touchPointNode){let s=new Nr(.001),l=new it({color:255}),u=new rt(s,l);t.touchPointNode.add(u)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(i).forEach(s=>{let{valueNodeName:l,minNodeName:u,maxNodeName:h,valueNodeProperty:x}=s;if(x===fe.VisualResponseProperty.TRANSFORM){if(s.minNode=e.getObjectByName(u),s.maxNode=e.getObjectByName(h),!s.minNode){console.warn(`Could not find ${u} in the model`);return}if(!s.maxNode){console.warn(`Could not find ${h} in the model`);return}}s.valueNode=e.getObjectByName(l),s.valueNode||console.warn(`Could not find ${l} in the model`)})})}function fp(n,e){ym(n.motionController,e),n.envMap&&e.traverse(t=>{Et(t)&&(Lo(t.material)||Ro(t.material)||Po(t.material))&&(t.material.envMap=n.envMap,t.material.needsUpdate=!0)}),n.add(e)}var bi=class{constructor(e=null){this.gltfLoader=e||new Jt,this.path=km,this._assetCache={}}createControllerModel(e,t=null){let o=new rc,r=null;return e.addEventListener("connected",async i=>{let s=i.data;if(!(s.targetRayMode!=="tracked-pointer"||!s.gamepad))try{let{profile:l,assetPath:u}=await xp(s,this.path,t||Mm);o.motionController=new Ei(s,l,u);let h=this._assetCache[o.motionController.assetUrl];if(h)r=h.scene.clone(),fp(o,r);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(o.motionController.assetUrl,x=>{this._assetCache[o.motionController.assetUrl]=x,r=x.scene.clone(),fp(o,r)},null,()=>{throw new Error(`Asset ${o.motionController.assetUrl} missing or malformed.`)})}}catch(l){console.warn(l)}}),e.addEventListener("disconnected",()=>{ze(o.motionController),o.motionController=null,ze(r),r=null}),o}};var Dm=new bi,Cm=new de().makeRotationX(-7*Je/9),wp=new de,Fp=new Map([["none",Me.MotionController],["left",Me.MotionControllerLeft],["right",Me.MotionControllerRight]]),yi;(function(n){n[n.Trigger=0]="Trigger",n[n.Grip=1]="Grip",n[n.Stick=3]="Stick",n[n.X_A=4]="X_A",n[n.Y_B=5]="Y_B"})(yi||(yi={}));var Ap=new Map([[yi.Y_B,Fe.Menu],[yi.X_A,Fe.Info]]),Di=class extends Lt{constructor(e,t){if(super("hand",Me.MotionController,e,new En(e)),this.laser=new ar(Js,.75,.002),this._isHand=!1,this.inputSource=null,this._gamepad=new Fi,this.delta=new W,this.newOrigin=new W,this.quaternion=new te,this.newQuat=new te,this.useHaptics=!0,this.mayTeleport=!0,this.object=Oe("PointerHand"+t),this.quaternion.identity(),ne(this,ne(this.controller=this.env.renderer.xr.getController(t),this.laser),ne(this.grip=this.env.renderer.xr.getControllerGrip(t),this.gripModel=Dm.createControllerModel(this.controller)),ne(this.hand=this.env.renderer.xr.getHand(t),this.handModel=this.env.handModelFactory.createHandModel(this.hand))),Er()&&$c()&&!kt){let i=!1;this.controller.traverse(s=>{s.name.toLocaleLowerCase().indexOf("oculus")>=0&&(i=!0)}),i&&this.laser.matrix.copy(Cm)}this.gamepad.addEventListener("gamepadaxismaxed",i=>{i.axis===2&&this.env.avatar.snapTurn(i.value)});let o=i=>s=>{Ap.has(s.button)&&this.setButton(Ap.get(s.button),i)};this.gamepad.addEventListener("gamepadbuttondown",o(!0)),this.gamepad.addEventListener("gamepadbuttonup",o(!1));let r=(i,s)=>()=>this.setButton(i,s);this.controller.addEventListener("selectstart",r(Fe.Primary,!0)),this.controller.addEventListener("selectend",r(Fe.Primary,!1)),this.controller.addEventListener("squeezestart",r(Fe.Secondary,!0)),this.controller.addEventListener("squeezeend",r(Fe.Secondary,!1)),this.controller.addEventListener("connected",i=>{i.target===this.controller&&(this.inputSource=i.data,this.gamepad.pad=this.inputSource.gamepad,this._isHand=E(this.inputSource.hand),this.id=Fp.get(this.handedness),this.grip.visible=!this.isHand,this.controller.visible=!this.isHand,this.hand.visible=this.isHand,this.enabled=!0,this._isActive=!0,this.env.eventSys.checkXRMouse(),this.updateCursorSide())}),this.controller.addEventListener("disconnected",i=>{i.target===this.controller&&(this.inputSource=null,this.gamepad.pad=null,this._isHand=!1,this.id=Fp.get(this.handedness),this.grip.visible=!1,this.controller.visible=!1,this.hand.visible=!1,this.enabled=!1,this._isActive=!1,this.env.eventSys.checkXRMouse(),this.updateCursorSide())}),Object.seal(this)}vibrate(){this._vibrate()}async _vibrate(){if(this.useHaptics&&this.gamepad.hapticActuators)try{await Promise.all(this.gamepad.hapticActuators.map(e=>e.pulse(.25,125)))}catch{this.useHaptics=!1}}get gamepad(){return this._gamepad}get handedness(){return N(this.inputSource)?null:this.inputSource.handedness}get isHand(){return this._isHand}get cursor(){return super.cursor}set cursor(e){super.cursor=e,this.updateCursorSide()}updateCursorSide(){this.cursor.side=this.handedness==="left"?1:-1}updatePointerOrientation(){this.laser.getWorldPosition(this.newOrigin),this.laser.getWorldQuaternion(this.newQuat),this.origin.lerp(this.newOrigin,.9),this.quaternion.slerp(this.newQuat,.9),this.delta.copy(this.origin).add(this.direction),this.direction.set(0,0,-1).applyQuaternion(this.quaternion),this.up.set(0,1,0).applyQuaternion(this.quaternion),this.delta.sub(this.direction).sub(this.origin),this.moveDistance+=50*this.delta.length()}onUpdate(){this.gamepad.pad=this.inputSource&&this.inputSource.gamepad||null,super.onUpdate()}get bufferSize(){return super.bufferSize+2+this.handModel.count*64}writeState(e){if(super.writeState(e),e.writeEnum8(this.handedness,ba),e.writeUint8(this.handModel.count),this.handModel.isTracking)for(let t=0;t<this.handModel.count;++t)this.handModel.getMatrixAt(t,wp),e.writeMatrix512(wp)}};var Jn=class extends Lt{constructor(e,t,o,r){super(e,t,o,r),this.position=new ve,this.motion=new ve,this.uv=new ve,this.duv=new ve,this.uvComp=new ve(1,-1),this.uvOff=new ve(-1,1),this.canMoveView=!0;let i=s=>{this._isActive=this.onCheckEvent(s),this._isActive&&this.onReadEvent(s)};this.element=this.env.renderer.domElement,this.element.addEventListener("pointerdown",i),this.element.addEventListener("pointermove",i),this.element.addEventListener("pointerup",i),this.element.addEventListener("pointercancel",i)}onCheckEvent(e){return e.pointerType===this.type}onReadEvent(e){this.updatePointerOrientation()}updatePointerOrientation(){this.element.clientWidth>0&&this.element.clientHeight>0&&(this.uv.copy(this.position),this.uv.x/=this.element.clientWidth,this.uv.y/=this.element.clientHeight,this.uv.multiplyScalar(2).multiply(this.uvComp).add(this.uvOff),this.duv.copy(this.motion),this.duv.x/=this.element.clientWidth,this.duv.y/=this.element.clientHeight,this.duv.multiplyScalar(2).multiply(this.uvComp),this.moveDistance=200*this.duv.length());let e=pn(this.env.renderer,this.env.camera);this.origin.setFromMatrixPosition(e.matrixWorld),this.direction.set(this.uv.x,this.uv.y,.5).unproject(e).sub(this.origin).normalize(),this.up.set(0,1,0).applyQuaternion(this.env.avatar.worldQuat)}onUpdate(){this.env.avatar.onMove(this,this.uv,this.duv),super.onUpdate(),this.motion.setScalar(0),this.duv.setScalar(0)}};var Yn=class extends Jn{constructor(e,t,o){let r=l=>{l.pointerType===e&&this.pointerID==null&&(this.pointerID=l.pointerId)},i=l=>{l.pointerType===e&&this.pointerID!=null&&(this.pointerID=null)},s=o.renderer.domElement;s.addEventListener("pointerdown",r),s.addEventListener("pointermove",r),super(e,t,o,new Qn(o)),this.pointerID=null,this.lastX=null,this.lastY=null,s.addEventListener("pointerup",i),s.addEventListener("pointercancel",i)}onCheckEvent(e){return super.onCheckEvent(e)&&e.pointerId===this.pointerID}onReadEvent(e){this.position.set(e.offsetX,e.offsetY),e.type==="pointerdown"?this.motion.setScalar(0):(this.motion.x+=e.offsetX-this.lastX,this.motion.y+=e.offsetY-this.lastY),this.lastX=e.offsetX,this.lastY=e.offsetY,super.onReadEvent(e),(e.type==="pointerdown"||e.type==="pointerup"||e.type==="pointercancel")&&this.setButton(e.button,e.type==="pointerdown")}};var Ci=class extends Yn{constructor(e){super("mouse",Me.Mouse,e),this.allowPointerLock=!1,this.dz=0,this.keyMap=new Map([["`",Fe.Info],["ContextMenu",Fe.Menu]]),this.element.addEventListener("wheel",t=>{t.preventDefault(),this.dz+=-t.deltaY*.1},{passive:!1}),this.element.addEventListener("contextmenu",t=>{t.preventDefault()}),this.element.addEventListener("pointerdown",t=>{this.onCheckEvent(t)&&(this.allowPointerLock&&!this.isPointerLocked?this.lockPointer():!this.allowPointerLock&&!this.isPointerCaptured&&this.capturePointer())}),this.element.addEventListener("pointerup",t=>{this.onCheckEvent(t)&&(this.allowPointerLock&&this.isPointerLocked?this.unlockPointer():!this.allowPointerLock&&this.isPointerCaptured&&this.releaseCapture())},!0),document.addEventListener("pointerlockchange",()=>{this.cursor.visible=!0}),window.addEventListener("keydown",t=>{this._isActive&&this.keyMap.has(t.key)&&this.setButton(this.keyMap.get(t.key),Ur(t))}),window.addEventListener("keyup",t=>{this.keyMap.has(t.key)&&this.setButton(this.keyMap.get(t.key),!1)}),this.mayTeleport=!0,Object.seal(this)}updatePointerOrientation(){this.isPointerLocked&&this.position.set(this.env.renderer.domElement.clientWidth,this.env.renderer.domElement.clientHeight).multiplyScalar(.5),super.updatePointerOrientation()}onUpdate(){super.onUpdate(),this.env.avatar.zoom(this.dz),this.dz=0}get isPointerLocked(){return document.pointerLockElement!=null}get isPointerCaptured(){return this.element.hasPointerCapture(this.pointerID)}get canDragView(){return super.canDragView&&!this.isPointerLocked}get canTeleport(){return super.canTeleport&&this.isPointerLocked}lockPointer(){this.element.requestPointerLock()}unlockPointer(){document.exitPointerLock()}capturePointer(){this.element.setPointerCapture(this.pointerID)}releaseCapture(){this.element.releasePointerCapture(this.pointerID)}vibrate(){}};var Bi=class extends Lt{constructor(e){super("nose",Me.Nose,e,null),this.point=new W,this.lastPoint=new W,this.mayTeleport=!1,this.enabled=!0,this._isActive=!0,this.updatePointerOrientation(),this.moveDistance=0,Object.seal(this)}vibrate(){}get canSend(){return!1}updatePointerOrientation(){let e=this.env.camera;e.getWorldPosition(this.origin),e.getWorldDirection(this.direction),this.up.copy(e.up),this.point.copy(this.direction).add(this.origin),this.moveDistance=this.point.distanceTo(this.lastPoint),this.lastPoint.copy(this.point)}};var Li=class extends Yn{constructor(e){super("pen",Me.Pen,e),Object.seal(this)}vibrate(){}};function Bm(n){return n.pointerId}var Ri=class extends Jn{constructor(e){super("touch",Me.Touch,e,null),this.dz=0,this.lastZ=0,this.points=new Array,this.lastXs=new Map,this.lastYs=new Map,this._canVibrate=null,Object.seal(this)}get enabled(){return super.enabled}set enabled(e){super.enabled=e,ye(this.points)}onReadEvent(e){yc(this.points,e.pointerId,Bm);let t=e.type==="pointerdown"||e.type==="pointermove";if(t&&this.points.push(e),this.points.length===2){let r=this.points[0],i=this.points[1],s=i.offsetX-r.offsetX,l=i.offsetY-r.offsetY,u=5*Math.sqrt(s*s+l*l),h=u-this.lastZ;e.type==="pointermove"&&(this.dz+=h),this.lastZ=u}let o=1/this.points.length;if(t){this.position.setScalar(0);for(let r of this.points)if(this.position.x+=o*r.offsetX,this.position.y+=o*r.offsetY,this.lastXs.has(r.pointerId)){let i=this.lastXs.get(r.pointerId),s=this.lastYs.get(r.pointerId),l=r.offsetX-i,u=r.offsetY-s;this.motion.x+=o*l,this.motion.y+=o*u}}if(t?(this.lastXs.set(e.pointerId,e.offsetX),this.lastYs.set(e.pointerId,e.offsetY)):(this.lastXs.delete(e.pointerId),this.lastYs.delete(e.pointerId)),super.onReadEvent(e),e.type!=="pointermove"){let r=0;for(let i=0;i<this.points.length;++i){let s=this.points[i],l=1<<i;s.buttons!==0?r|=l:r&=~l}for(let i=0;i<10;++i){let s=this.isPressed(i),l=1<<i,u=(r&l)!==0;u!==s&&this.setButton(i,u)}e.type==="pointerup"&&setTimeout(()=>this._isActive=!1,10)}}onUpdate(){this.env.avatar.zoom(this.dz),super.onUpdate(),this.dz=0}get canVibrate(){return this._canVibrate===null&&(this._canVibrate="vibrate"in navigator&&ee(navigator.vibrate)),this._canVibrate}vibrate(){this.canVibrate&&navigator.vibrate(125)}};var Lm=(n,e)=>n.distance-e.distance,Pi=class extends ce{set sortFunction(e){this.customSortFunction=e}get sortFunction(){return this.customSortFunction||Lm}constructor(e){super(),this.env=e,this.raycaster=new Gl,this.hands=new Array,this.hits=new Array,this.queue=new Array,this.targetsFound=new Set,this.targets=new Array,this.customSortFunction=null,this.raycaster.camera=this.env.camera,this.raycaster.layers.set(Kr),this.mouse=new Ci(this.env),this.pen=new Li(this.env),this.touches=new Ri(this.env),this.nose=new Bi(this.env);for(let t=0;t<2;++t)this.hands[t]=new Di(this.env,t);this.pointers=[this.mouse,this.pen,this.touches,this.nose,...this.hands];for(let t of this.pointers)t.addBubbler(this),t.cursor&&ne(this.env.stage,t.cursor);this.checkXRMouse(),Object.seal(this)}checkXRMouse(){let e=0;for(let o of this.hands.values())o.enabled&&++e;let t=e===0;this.mouse.enabled=t,this.pen.enabled=t,this.touches.enabled=t}refreshCursors(){for(let e of this.pointers)e.cursor&&(e.cursor=this.env.cursor3D.clone())}fireRay(e,t){return ye(this.hits),this.raycaster.ray.origin.copy(e),this.raycaster.ray.direction.copy(t),this.raycaster.intersectObjects(this.targets,!1,this.hits),this.hits.sort(this.sortFunction),this.hits[0]||null}update(){for(this.targetsFound.clear(),ye(this.targets),this.queue.push(this.env.scene);this.queue.length>0;){let e=this.queue.shift();e.children.length>0&&this.queue.push(...e.children);let t=cr(e);t&&!this.targetsFound.has(t)&&(this.targetsFound.add(t),this.targets.push(...t.meshes))}for(let e of this.pointers)e.update()}};var Ii=class n extends qt{constructor(e,t){super(e),this.cursorSystem=null,this.object=Oe("Cursor3D"),this.cursorSystem=t,this.object.matrixAutoUpdate=!1}add(e,t){ne(this,t),Au(t,Nn),t.visible=e==="default"}get style(){for(let e of this.object.children)if(e.visible)return e.name;return null}set style(e){for(let t of this.object.children)t.visible=t.name===e;if(this.style==null&&this.object.children.length>0){let t=fr(this.object.children,o=>o.name==="default",o=>o!=null);t!=null&&(t.visible=!0)}this.cursorSystem&&(this.cursorSystem.style="none")}get visible(){return On(this)}set visible(e){wt(this,e)}clone(){let e=new n(this.env);for(let t of this.object.children)e.add(t.name,t.clone());return e}};var ic=new te().identity(),_p=new te().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(ic.setFromAxisAngle(new W(0,1,0),Math.PI/2),_p.setFromAxisAngle(new W(1,0,0),Math.PI).premultiply(ic));var Rm="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/",Vi=class extends De{constructor(e,t,o){super(),this.controller=e,this.handedness=t,this.bones=new Map,this.root=null,this.instanceMatrix={needsUpdate:!1},this.oculusBrowserV14Correction=this.handedness==="left"?_p:ic;let r=new Jt;r.setPath(Rm),r.load(`${this.handedness}.glb`,i=>{this.root=i.scene.children[0],this.add(this.root);let s=this.root.getObjectByProperty("type","SkinnedMesh");s.frustumCulled=!1,s.castShadow=!0,s.receiveShadow=!0,Po(s.material)?s.material=gu(s.material):Lo(s.material)&&(s.material=Ks(s.material)),Ro(s.material)&&(s.material.color=o,s.material.shininess=.1),Yt.forEach(l=>this.addBone(l))})}addBone(e){if(this.root){let t=this.root.getObjectByName(e);t&&this.bones.set(e,t)}}get count(){return this.bones.size}set count(e){}getMatrixAt(e,t){if(0<=e&&e<Yt.length){let o=Yt[e];this.bones.has(o)&&t.copy(this.bones.get(o).matrix)}}setMatrixAt(e,t){if(0<=e&&e<Yt.length){let o=Yt[e];if(this.bones.has(o)){let r=this.bones.get(o);r.matrix.copy(t),r.matrix.decompose(r.position,r.quaternion,r.scale)}}}updateMesh(){if(this.controller)for(let[e,t]of this.bones){let o=this.controller.joints[e];o&&o.visible&&(t.position.copy(o.position),t.quaternion.copy(o.quaternion).multiply(this.oculusBrowserV14Correction))}}};var Pm=.008,sc=new de,Sp=new W,Tp=new de().identity(),vp=new de().identity();/OculusBrowser\/14\./.test(navigator.userAgent)&&(Tp.makeRotationY(Math.PI/2),vp.makeRotationY(-Math.PI/2));var Wi=class extends Br{constructor(e,t,o,r){let i;r==="boxes"?i=new br(1,1,1):r==="bones"?i=new gl(.5,.75,2.25,10,1).rotateX(-Math.PI/2):i=new Nr(1,10,10);let s=new Pn({color:o,shininess:.1});super(i,s,30),this.controller=e,this.instanceMatrix.setUsage(Fl),this.castShadow=!0,this.receiveShadow=!0,this.oculusBrowserV14Correction=t==="left"?vp:Tp}updateMesh(){if(this.controller){let e=0;for(let t of Yt){let o=this.controller.joints[t];o&&o.visible&&(Sp.setScalar(o.jointRadius||Pm),sc.compose(o.position,o.quaternion,Sp),sc.multiply(this.oculusBrowserV14Correction),this.setMatrixAt(e,sc),e++)}this.count=e}this.instanceMatrix.needsUpdate=!0}};var Yt=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],ac=class extends De{get isTracking(){return!!this.impl}constructor(e,t,o){super(),this.controllerOrHandedness=e,this.color=t,this.profile=o,this.impl=null;let r=null,i=null;J(e)?i=e:r=e;let s=()=>this.add(this.impl=this.createModel(r,i));r?(r.addEventListener("connected",l=>{let u=l.data;u.hand&&!this.impl&&(i=u.handedness,s())}),r.addEventListener("disconnected",()=>{let l=this.impl;this.impl=null,i=null,l.removeFromParent(),ze(l)})):i&&s()}createModel(e,t){return this.profile==="mesh"?new Vi(e,t,this.color):new Wi(e,t,this.color,this.profile)}get count(){return this.impl?this.impl.count:0}set count(e){this.impl&&(this.impl.count=e)}getMatrixAt(e,t){this.impl&&this.impl.getMatrixAt(e,t)}setMatrixAt(e,t){this.impl&&this.impl.setMatrixAt(e,t)}updateMesh(){this.impl&&this.impl.updateMesh()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.impl&&this.impl.updateMesh()}},Oi=class{constructor(e,t){this.color=e,this.profile=t}createHandModel(e){return new ac(e,this.color,this.profile)}};var cc=class extends Ai{constructor(){super(),this.frame=null,Object.seal(this)}set(e,t,o){super.set(e,t),this.frame=o}},Hi=class{constructor(e){this.renderer=e,this.tickHandlers=new Array,this.lt=-1,this._isRunning=!1;let t=new cc,o=0;this._onTick=(r,i)=>{this.lt>=0&&(o=r-this.lt,t.set(r,o,i),this.tick(t)),this.lt=r}}get isRunning(){return this._isRunning}restart(){this.stop(),this.start()}addTickHandler(e){this.tickHandlers.push(e)}removeTickHandler(e){nt(this.tickHandlers,e)}setAnimationLoop(e){this.renderer.setAnimationLoop(e),this._isRunning=E(e)}start(){this.isRunning||this.setAnimationLoop(this._onTick)}stop(){this.isRunning&&(this.setAnimationLoop(null),this.lt=-1)}tick(e){for(let t of this.tickHandlers)t(e)}};var kp=15,Im=ll(kp),Ni=class extends ce{constructor(e,t,o,r,i,s=null,l=null,u=null){if(super(),this.styleSheetPath=t,this.fetcher=o,this.layers=new Array,this.layerSortOrder=new Map,this.spectator=new Mo,this.lastViewport=new ft,this.curViewport=new ft,this.gltfLoader=new Jt,this.fadeDepth=0,this.scene=new Vn,this.stage=Oe("Stage"),this.ambient=new ul(16777215,.5),this.sun=new yr(16777215,.75),this.ground=new _l(Im,kp,12632256,8421504),this.foreground=Oe("Foreground"),this.loadingBar=new Jr,this.handModelFactory=new Oi(new we(12044521),"mesh"),this.screenControl=null,this.enableSpectator=!1,this._xrBinding=null,this._xrMediaBinding=null,this._hasXRMediaLayers=null,this._hasXRCompositionLayers=null,this.layerSorter=xr("descending",x=>this.layerSortOrder.get(x)),this.DEBUG=s||!1,this.defaultAvatarHeight=l||1.75,u=u||60,this.camera=new Mo(u,1,.01,1e3),this.cursor3D=new Ii(this),Ao(e)&&(e.style.backgroundColor="black",N(e.parentElement)))throw new Error("The provided canvas must be included in a parent element before constructing the environment.");this.renderer=new Yl({canvas:e,powerPreference:"high-performance",precision:"lowp",antialias:!0,alpha:!0,premultipliedAlpha:!0,depth:!0,logarithmicDepthBuffer:!0,stencil:!1,preserveDrawingBuffer:!1}),this.renderer.domElement.setAttribute("touch-action","none"),this.renderer.domElement.tabIndex=1,this.useNewColorModel=!1,Ao(e)&&(this.screenControl=new hi(this.renderer,this.camera,this.renderer.domElement.parentElement,r,i)),this.fader=new Qr("ViewFader"),this.worldUISpace=new rr("WorldUISpace",.2,20,.125),this.avatar=new jr(this,this.fader),this.eventSys=new Pi(this),this.timer=new Hi(this.renderer),this.skybox=new xi(this),this.renderer.xr.enabled=!0,this.sun.name="Sun",this.sun.position.set(0,1,1),this.sun.lookAt(0,0,0),this.sun.layers.enableAll();let h=()=>{this.ground.visible=this.renderer.xr.isPresenting};this.screenControl.addEventListener("sessionstarted",h),this.screenControl.addEventListener("sessionstopped",h),h(),this.ambient.name="Fill",this.ambient.layers.enableAll(),this.loadingBar.object.name="MainLoadingBar",this.loadingBar.object.position.set(0,-.25,-2),this.scene.layers.enableAll(),this.avatar.addFollower(this.worldUISpace),ne(this.scene,this.sun,this.ambient,ne(this.stage,this.ground,this.camera,this.avatar,...this.eventSys.hands),this.foreground,ne(this.worldUISpace,this.loadingBar)),this.timer.addTickHandler(x=>this.update(x)),this._start(),globalThis.env=this}get useNewColorModel(){return ys.enabled}set useNewColorModel(e){ys.enabled=e,this.renderer.outputEncoding=e?$l:Dl}async _start(){E(this.styleSheetPath)&&await this.fetcher.get(this.styleSheetPath).style(),this.timer.start()}get gl(){return this.renderer.getContext()}get referenceSpace(){return this.renderer.xr.getReferenceSpace()}update(e){if(this.dispatchEvent(e),this.screenControl.visible){let t=this.xrSession;this._xrBinding=this.renderer.xr.getBinding(),this.hasXRMediaLayers&&this._xrMediaBinding===null===this.renderer.xr.isPresenting&&(this._xrMediaBinding===null&&E(t)?this._xrMediaBinding=new XRMediaBinding(t):this._xrMediaBinding=null);let o=t&&this.renderer.xr.getBaseLayer();o!==this.baseLayer&&(E(this.baseLayer)&&(this.removeWebXRLayer(this.baseLayer),this.baseLayer=null),E(o)&&(this.baseLayer=o,this.addWebXRLayer(o,0))),this.screenControl.resize(),this.eventSys.update(),this.avatar.update(e.dt),this.worldUISpace.update(this.avatar.height,this.avatar.worldPos,this.avatar.worldHeadingRadians,e.dt),this.fader.update(e.dt),Yu(e.dt),this.loadingBar.update(e.sdt),this.preRender(e);let r=pn(this.renderer,this.camera);if(r!==this.camera){let i=r;i.layers.mask=this.camera.layers.mask;for(let s=0;s<i.cameras.length;++s){let l=i.cameras[s];l.layers.mask=this.camera.layers.mask,l.layers.enable(s+1),i.layers.enable(s+1)}}this.screenControl.render(this.scene,this.camera),this.enableSpectator&&(this.renderer.xr.isPresenting?Er()&&!el()&&this.drawSnapshot():(this.lastViewport.copy(this.curViewport),this.renderer.getViewport(this.curViewport)))}}drawSnapshot(){let e=this.renderer.xr.isPresenting,t=null;if(e){let o=pn(this.renderer,this.camera);this.spectator.projectionMatrix.copy(this.camera.projectionMatrix),this.spectator.position.copy(o.position),this.spectator.quaternion.copy(o.quaternion),t=this.renderer.getRenderTarget(),this.renderer.xr.isPresenting=!1,this.renderer.setRenderTarget(null),this.renderer.setViewport(this.lastViewport)}this.screenControl.render(this.scene,e?this.spectator:this.camera),e&&(this.renderer.setViewport(this.curViewport),this.renderer.setRenderTarget(t),this.renderer.xr.isPresenting=!0)}preRender(e){}async onQuitting(){this.dispatchEvent(new me("quitting")),window.location.href="/"}get hasAlpha(){return this.renderer.getContextAttributes().alpha}get xrSession(){return this.renderer.xr.getSession()}get xrBinding(){return this._xrBinding}get xrMediaBinding(){return this._xrMediaBinding}get isReadyForLayers(){return this.hasAlpha&&(!kt||ol.major>=15)}get hasXRMediaLayers(){return this._hasXRMediaLayers===null&&(this._hasXRMediaLayers=this.isReadyForLayers&&"XRMediaBinding"in globalThis&&ee(XRMediaBinding.prototype.createQuadLayer)),this._hasXRMediaLayers}get hasXRCompositionLayers(){return this._hasXRCompositionLayers===null&&(this._hasXRCompositionLayers=this.isReadyForLayers&&"XRWebGLBinding"in globalThis&&ee(XRWebGLBinding.prototype.createCubeLayer)),this._hasXRCompositionLayers}addWebXRLayer(e,t){this.layerSortOrder.set(e,t),rs(this.layers,e,this.layerSorter),this.updateLayers()}removeWebXRLayer(e){bc(this.layers,e,this.layerSorter),this.layerSortOrder.delete(e),this.updateLayers()}updateLayers(){let e=this.xrSession;E(e)&&e.updateRenderState({layers:this.layers})}clearScene(){this.dispatchEvent(new me("sceneclearing")),ze(this.foreground),this.dispatchEvent(new me("scenecleared"))}async fadeOut(){++this.fadeDepth,this.fadeDepth===1&&(await this.fader.fadeOut(),this.skybox.visible=!1,this.camera.layers.set(Nn),this.loadingBar.start(),await this.fader.fadeIn())}async fadeIn(){this.fadeDepth===1&&(await this.fader.fadeOut(),this.camera.layers.set(Kr),this.skybox.visible=!0,await this.fader.fadeIn()),--this.fadeDepth}async withFade(e){try{return await this.fadeOut(),await e()}finally{await this.fadeIn()}}get showWebXRLayers(){return this.fadeDepth===0}set3DCursor(e){let t=e.children.slice(0);for(let o of t)this.cursor3D.add(o.name,o);this.eventSys.refreshCursors(),this.dispatchEvent(new me("newcursorloaded"))}async load(e,...t){let o=null;_o(e)?t.push(e):o=e;let r=new Do(this,"/models/Cursors.glb",go,!this.DEBUG);t.push(r),await this.fetcher.assets(o,...t),Qs(r.result.scene,fu),this.set3DCursor(r.result.scene)}loadGltf(e){return this.gltfLoader.loadAsync(e)}};var ur=class extends It{constructor(e,t){super(),this.i=e,this.prog=t}report(e,t,o,r){super.report(e,t,o,r),this.prog.update(this.i,e,t,o)}};var Gi=class{constructor(e){this.prog=e,this.weightTotal=0,this.subProgressCallbacks=new Array,this.subProgressWeights=new Array,this.subProgressValues=new Array,this.start=performance.now();for(let t=0;t<this.subProgressWeights.length;++t)this.subProgressValues[t]=0,this.subProgressCallbacks[t]=new ur(t,this)}addSubProgress(e){e=e||1,this.weightTotal+=e,this.subProgressWeights.push(e),this.subProgressValues.push(0);let t=new ur(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(t),t}update(e,t,o,r){if(this.prog){this.subProgressValues[e]=t/o;let i=0;for(let h=0;h<this.subProgressWeights.length;++h)i+=this.subProgressValues[h]*this.subProgressWeights[h];let s=performance.now(),l=s-this.start,u=this.start-s+l*this.weightTotal/i;this.prog.report(i,this.weightTotal,r,u)}}};function uc(n,e){return new lc(e,n).subProgressCallbacks}function Mp(n,e){let t=new Array(e);for(let o=0;o<e;++o)t[o]=1;return uc(n,t)}var lc=class extends Gi{constructor(e,t){super(t);for(let o of e)this.addSubProgress(o)}};async function Ep(n,e){let t=new Array(e.length),o=new Array(e.length);for(let s=0;s<e.length;++s){let l=e[s];t[s]=l[0],o[s]=l[1]}let r=uc(n,t),i=new Array(e.length);for(let s=0;s<e.length;++s)i[s]=o[s](r[s]);return await Promise.all(i)}function bp(n){let e=new Ie,t=setInterval(()=>{n()&&(clearInterval(t),e.resolve())},100);return e}var pc=null;function yp(n){return pc===null&&(pc=new Audio),pc.canPlayType(n)!==""}var Xi=class{constructor(e,t,o,r=!1){this.fetcher=e,this.method=t,this.path=o,this.useBLOBs=r,this.prog=null,this.request={method:t,path:this.path.href,body:null,headers:null,timeout:null,withCredentials:!1,useCache:!1,retryCount:3}}retries(e){return this.request.retryCount=e,this}query(e,t){return this.path.searchParams.set(e,t),this.request.path=this.path.href,this}header(e,t){return this.request.headers===null&&(this.request.headers=new Map),this.request.headers.set(e.toLowerCase(),t),this}headers(e){for(let[t,o]of e.entries())this.header(t,o);return this}timeout(e){return this.request.timeout=e,this}progress(e){return this.prog=e,this}body(e,t){if(E(e)){let o=new Set,r=new Array;r.push(e);let i=!1;for(;!i&&r.length>0;){let s=r.shift();if(s&&!o.has(s))if(o.add(s),s instanceof Blob){i=!0;break}else J(s)||r.push(...Object.values(s))}if(i){let s=new FormData,l=new Map,u=new Set;for(let[h,x]of Object.entries(e))if(x instanceof Blob){let g=h+".name",A=e[g];J(A)&&(l.set(x,A),u.add(g))}for(let[h,x]of Object.entries(e))u.has(h)||(x instanceof Blob?s.append(h,x,l.get(x)):J(x)?s.append(h,x):E(x)&&ee(x.toString)?s.append(h,x.toString()):console.warn("Can't serialize value to formdata",h,x));e=s,t=void 0}this.request.body=e,this.content(t)}return this}withCredentials(){return this.request.withCredentials=!0,this}useCache(e=!0){return this.request.useCache=e,this}media(e,t){E(t)&&(J(t)||(t=t.value),this.header(e,t))}content(e){this.media("content-type",e)}accept(e){return this.media("accept",e),this}blob(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBlob(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBlob(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Pe(this.method)}buffer(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBuffer(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBuffer(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Pe(this.method)}async file(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return await this.fetcher.sendObjectGetFile(this.request,this.prog);if(this.method==="GET"){if(this.useBLOBs)return await this.fetcher.sendNothingGetFile(this.request,this.prog);{let t=await this.fetcher.sendNothingGetNothing(this.request);return ae(t,()=>this.request.path)}}else{if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Pe(this.method)}}text(e){if(this.accept(e||gr),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetText(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetText(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Pe(this.method)}object(e){if(this.accept(e||as),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetObject(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetObject(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Pe(this.method)}xml(e){if(this.accept(e||Ic),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetXml(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetXml(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Pe(this.method)}imageBitmap(e){if(this.accept(e),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetImageBitmap(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetImageBitmap(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Pe(this.method)}exec(){if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetNothing(this.request,this.prog);if(this.method==="GET")throw new Error("GET requests should expect a response type");if(this.method==="HEAD"||this.method==="OPTIONS")return this.fetcher.sendNothingGetNothing(this.request);Pe(this.method)}async audioBlob(e){if(E(e)&&(J(e)||(e=e.value),!yp(e)))throw new Error(`Probably can't play file of type "${e}" at path: ${this.request.path}`);let t=await this.blob(e);if(yp(t.contentType))return t;throw new Error(`Cannot play file of type "${t.contentType}" at path: ${this.request.path}`)}async audioBuffer(e,t){return ae(await this.audioBlob(t),async o=>await e.decodeAudioData(await o.arrayBuffer()))}async htmlElement(e,t,o){let r=await this.file(o),i=ot(e,t,"error");return e instanceof HTMLLinkElement?e.href=r.content:e.src=r.content,await i,await ae(r,()=>e)}image(e){return this.htmlElement(fs(),"load",e)}async htmlCanvas(e){let t=As(1,1);if(this.method==="GET")if(an){this.accept(e);let o=await this.fetcher.drawImageToCanvas(this.request,t.transferControlToOffscreen(),this.prog);return await ae(o,()=>t)}else{let o=await this.image(e);return await ae(o,r=>(t.width=r.width,t.height=r.height,_s(t,r),Xe(r),t))}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Pe(this.method)}}canvas(e){return an?this.offscreenCanvas(e):this.htmlCanvas(e)}async offscreenCanvas(e){if(!an)throw new Error("This system does not support OffscreenCanvas");if(this.method==="GET"){let t=await this.image(e);return await ae(t,o=>{let r=Fs(o.width,o.height);return _s(r,o),Xe(o),r})}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);Pe(this.method)}}async style(){let e=qc(Ar(wo),ps("stylesheet"));document.head.append(e);let t=await this.htmlElement(e,"load",wo);return ae(t)}async getScript(){let e=Qc(Ar(Rn));document.head.append(e);let t=await this.htmlElement(e,"load",Rn);return ae(t)}async script(e){let t=null,o=this.request.path;if(!e)t=await this.getScript();else if(!e()){let r=bp(e);t=await this.getScript(),await r}return this.prog&&this.prog.end(o),t}async module(){let e=this.request.path,t=await this.file(Rn),o=await import(t.content);return this.prog&&this.prog.end(e),ae(t,()=>o)}async wasm(e){let t=await this.buffer(cs);if(!cs.matches(t.contentType))throw new Error(`Server did not respond with WASM file. Was: ${t.contentType}`);let o=await WebAssembly.compile(t.content),r=await WebAssembly.instantiate(o,e);return ae(t,()=>r.exports)}async worker(e="module"){let t=this.request.path,o=await this.file(Rn);this.prog=null,this.request.timeout=null;let r=new Worker(o.content,{type:e});return this.prog&&this.prog.end(t),ae(o,()=>r)}};var Ui=class{constructor(e,t=!1){this.service=e,this.useBLOBs=t;{let o=Uc("input[name=__RequestVerificationToken]");o&&this.service.setRequestVerificationToken(o.value)}}clearCache(){return this.service.clearCache()}evict(e,t){return this.service.evict(new URL(e,t||location.href).href)}request(e,t,o){return new Xi(this.service,e,new URL(t,o||location.href),this.useBLOBs)}head(e,t){return this.request("HEAD",e,t)}options(e,t){return this.request("OPTIONS",e,t)}get(e,t){return this.request("GET",e,t)}post(e,t){return this.request("POST",e,t)}put(e,t){return this.request("PUT",e,t)}patch(e,t){return this.request("PATCH",e,t)}delete(e,t){return this.request("DELETE",e,t)}async assets(e,t,...o){N(o)&&(o=[]),o.unshift(t);let r;_o(e)?o.unshift(e):E(e)&&(r=e),o=o.filter(E);let i=await Promise.all(o.map(l=>l.getSize(this))),s=new Map(i);await Ep(r,o.map(l=>[s.get(l),u=>l.fetch(this,u)]))}};var zi=class{constructor(e){this.impl=e,this.defaultPostHeaders=new Map}setRequestVerificationToken(e){this.defaultPostHeaders.set("RequestVerificationToken",e)}clearCache(){return this.impl.clearCache()}evict(e){return this.impl.evict(e)}sendNothingGetNothing(e){return this.impl.sendNothingGetNothing(e)}sendNothingGetBlob(e,t){return this.impl.sendNothingGetSomething("blob",e,t)}sendObjectGetBlob(e,t){return this.impl.sendSomethingGetSomething("blob",e,this.defaultPostHeaders,t)}sendNothingGetBuffer(e,t){return this.impl.sendNothingGetSomething("arraybuffer",e,t)}sendObjectGetBuffer(e,t){return this.impl.sendSomethingGetSomething("arraybuffer",e,this.defaultPostHeaders,t)}sendNothingGetText(e,t){return this.impl.sendNothingGetSomething("text",e,t)}sendObjectGetText(e,t){return this.impl.sendSomethingGetSomething("text",e,this.defaultPostHeaders,t)}sendNothingGetObject(e,t){return this.impl.sendNothingGetSomething("json",e,t)}sendObjectGetObject(e,t){return this.impl.sendSomethingGetSomething("json",e,this.defaultPostHeaders,t)}sendObjectGetNothing(e,t){return this.impl.sendSomethingGetSomething("",e,this.defaultPostHeaders,t)}drawImageToCanvas(e,t,o){return this.impl.drawImageToCanvas(e,t,o)}async sendNothingGetFile(e,t){return ae(await this.sendNothingGetBlob(e,t),URL.createObjectURL)}async sendObjectGetFile(e,t){return ae(await this.sendObjectGetBlob(e,t),URL.createObjectURL)}async sendNothingGetXml(e,t){return ae(await this.impl.sendNothingGetSomething("document",e,t),o=>o.documentElement)}async sendObjectGetXml(e,t){return ae(await this.impl.sendSomethingGetSomething("document",e,this.defaultPostHeaders,t),o=>o.documentElement)}async sendNothingGetImageBitmap(e,t){return ae(await this.sendNothingGetBlob(e,t),createImageBitmap)}async sendObjectGetImageBitmap(e,t){return ae(await this.sendObjectGetBlob(e,t),createImageBitmap)}};function Dp(n,e,t){return new Map(n.map(o=>[e(o),t(o)]))}function Cp(n,e){return Dp(n,e,sn)}var Zt=class{constructor(e){if(this.items=new Map,this.defaultItems=new Array,E(e))for(let[t,o]of e)this.add(t,o)}add(e,...t){for(let o of t)if(N(e))this.defaultItems.push(o);else{let r=this.items.get(e);N(r)&&this.items.set(e,r=[]),r.push(o)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let e of this.defaultItems)yield e;for(let e of this.items.values())for(let t of e)yield t}has(e){return E(e)?this.items.has(e):this.defaultItems.length>0}get(e){return N(e)?this.defaultItems:this.items.get(e)||[]}count(e){if(N(e))return this.defaultItems.length;let t=this.get(e);return E(t)?t.length:0}get size(){let e=this.defaultItems.length;for(let t of this.items.values())e+=t.length;return e}delete(e){return N(e)?ye(this.defaultItems).length>0:this.items.delete(e)}remove(e,t){if(N(e))nt(this.defaultItems,t);else{let o=this.items.get(e);E(o)&&(nt(o,t),o.length===0&&this.items.delete(e))}}clear(){this.items.clear(),ye(this.defaultItems)}};var Cn=class{constructor(e){if(this.items=new Map,E(e))for(let[t,o,r]of e)this.add(t,o,r)}add(e,t,o){let r=this.items.get(e);return N(r)&&this.items.set(e,r=new Map),r.set(t,o),this}*entries(){for(let[e,t]of this.items)for(let[o,r]of t)yield[e,o,r]}keys(e){return N(e)?this.items.keys():this.items.get(e).keys()}*values(){for(let e of this.items.values())for(let t of e.values())yield t}has(e,t){return this.items.has(e)&&(N(t)||this.items.get(e).has(t))}get(e,t){return N(t)?this.items.get(e):this.items.has(e)?this.items.get(e).get(t):null}count(e){return this.items.has(e)?this.items.get(e).size:null}get size(){let e=0;for(let t of this.items.values())e+=t.size;return e}delete(e,t){if(N(t))return this.items.delete(e);if(this.items.has(e)){let o=this.items.get(e),r=o.delete(t);return o.size===0&&this.items.delete(e),r}else return!1}clear(){this.items.clear()}};var ji=class n{static delete(e){let t=indexedDB.deleteDatabase(e),o=ot(t,"success","error","blocked");return vt(o)}static async open(e,...t){let o=Cp(t,I=>I.name),r=new Cn(t.filter(I=>E(I.indexes)).flatMap(I=>I.indexes.map(L=>[I.name,L.name,L]))),i=new Array,s=new Array,l=new Array,u=new Zt,h=new Zt,x=null,g=indexedDB.open(e);if(await vt(ot(g,"success","error","blocked"))){let I=g.result;x=I.version;let L=new Array;for(let D of I.objectStoreNames)o.has(D)||s.push(D);for(let D of o.keys())I.objectStoreNames.contains(D)?L.push(D):i.push(D);if(L.length>0){let D=I.transaction(L),O=ot(D,"complete","error","abort"),C=vt(O);for(let R of L){let j=D.objectStore(R),ie=o.get(R);E(ie.options)&&j.keyPath!==ie.options.keyPath&&(s.push(R),i.push(R));for(let Q of j.indexNames)r.has(R,Q)||(l.indexOf(R)===-1&&l.push(R),h.add(R,Q));if(r.has(R))for(let Q of r.get(R).keys())if(!j.indexNames.contains(Q))l.indexOf(R)===-1&&l.push(R),u.add(R,Q);else{let Y=r.get(R,Q),le=j.index(Q);(J(Y.keyPath)!==J(le.keyPath)||J(Y.keyPath)&&J(le.keyPath)&&Y.keyPath!==le.keyPath||tt(Y.keyPath)&&tt(le.keyPath)&&is(Y.keyPath,le.keyPath))&&(l.indexOf(R)===-1&&l.push(R),h.add(R,Q),u.add(R,Q))}}D.commit(),await C}Xe(I)}else{x=0,i.push(...o.keys());for(let I of t)if(E(I.indexes))for(let L of I.indexes)u.add(I.name,L.name)}(i.length>0||s.length>0||u.size>0||h.size>0)&&++x;let A=new Ie,_=E(x)?indexedDB.open(e,x):indexedDB.open(e),M=ot(_,"success","error","blocked"),B=vt(A),y=vt(M),V=A.resolver(!1);if(_.addEventListener("success",V),_.addEventListener("upgradeneeded",()=>{let I=ot(_.transaction,"complete","error","abort"),L=_.result;for(let O of s)L.deleteObjectStore(O);let D=new Map;for(let O of i){let C=o.get(O),R=L.createObjectStore(O,C.options);D.set(O,R)}for(let O of l){let C=_.transaction.objectStore(O);D.set(O,C)}for(let[O,C]of D){for(let R of h.get(O))C.deleteIndex(R);for(let R of u.get(O)){let j=r.get(O,R);C.createIndex(R,j.keyPath,j.options)}}vt(I).then(A.resolve).catch(A.reject).finally(()=>_.removeEventListener("success",V))}),!await B)throw A.error;if(!await y)throw M.error;return new n(_.result)}constructor(e){this.db=e}dispose(){Xe(this.db)}get name(){return this.db.name}get version(){return this.db.version}get storeNames(){return Array.from(this.db.objectStoreNames)}getStore(e){return new dc(this.db,e)}},dc=class{constructor(e,t){this.db=e,this.storeName=t}async request(e,t){let o=this.db.transaction(this.storeName,t),r=ot(o,"complete","error"),i=o.objectStore(this.storeName),s=e(i),l=ot(s,"success","error");if(!await vt(l))throw o.abort(),l.error;if(o.commit(),!await vt(r))throw r.error;return s.result}add(e,t){return this.request(o=>o.add(e,t),"readwrite")}clear(){return this.request(e=>e.clear(),"readwrite")}getCount(e){return this.request(t=>t.count(e),"readonly")}async has(e){return await this.getCount(e)>0}delete(e){return this.request(t=>t.delete(e),"readwrite")}get(e){return this.request(t=>t.get(e),"readonly")}getAll(){return this.request(e=>e.getAll(),"readonly")}getAllKeys(){return this.request(e=>e.getAllKeys(),"readonly")}getKey(e){return this.request(t=>t.getKey(e),"readonly")}openCursor(e,t){return this.request(o=>o.openCursor(e,t),"readonly")}openKeyCursor(e,t){return this.request(o=>o.openKeyCursor(e,t),"readonly")}put(e,t){return this.request(o=>o.put(e,t),"readwrite")}};function Bp(n,...e){for(let t of e)if(E(t))for(let[o,r]of t)n.set(o,r);return n}var hc=class extends Ie{constructor(e){super(!1),this.milliseconds=e,this._timer=null}start(){super.start(),this._timer=setTimeout(()=>{this._timer=null,this.resolve()},this.milliseconds)}reset(){super.reset(),E(this._timer)&&(clearTimeout(this._timer),this._timer=null)}};function Lp(n){let e=new hc(n);return e.start(),e}function qi(n,e){return async()=>{let t=null,o=500;for(let r=0;r<=n;++r)try{return r>0&&(await Lp(o),o*=2),await e()}catch(i){t=i}throw t}}function Vm(n){return J(n)||vc(n)||n instanceof Blob||n instanceof FormData||kc(n)||"Document"in globalThis&&n instanceof Document}function Qi(n,e,t,o,r,i){let s=!i;i&&i.then(()=>s=!0);let l=!1,u=r,h=new Ie;t.addEventListener("loadstart",()=>{s&&!l&&o&&o.start(n)}),t.addEventListener("progress",g=>{if(s&&!l){let A=g;o&&o.report(A.loaded,Math.max(A.loaded,A.total),n),A.loaded===A.total&&(u=!0,l&&h.resolve())}}),t.addEventListener("load",()=>{s&&!l&&(o&&o.end(n),l=!0,u&&h.resolve())});let x=g=>()=>{s&&h.reject(`${g} (${e.status})`)};return t.addEventListener("error",x("error")),t.addEventListener("abort",x("abort")),t.addEventListener("timeout",x("timeout")),h}function mc(n,e,t,o,r,i){if(n.open(e,t),n.responseType="blob",n.timeout=o,r)for(let[s,l]of r)n.setRequestHeader(s,l);E(i)?n.send(i):n.send()}function Ki(n,e,t){if(!n.has(e))return null;let o=n.get(e);try{let r=t(o);return n.delete(e),r}catch(r){console.warn(e,r)}return null}var Wm=/filename=\"(.+)\"(;|$)/,Om="Juniper:Fetcher:Cache",Ji=class{constructor(){this.cache=null,this.store=null,this.tasks=new Cn,this.cacheReady=this.openCache()}async drawImageToCanvas(e,t,o){let r=await this.sendNothingGetSomething("blob",e,o),i=r.content;return Jc(await createImageBitmap(i,{imageOrientation:"from-image"}),s=>(t.width=s.width,t.height=s.height,t.getContext("2d").drawImage(s,0,0),ae(r)))}async openCache(){let e={keyPath:"requestPath"};this.cache=await ji.open(Om,{name:"files",options:e}),this.store=await this.cache.getStore("files")}async clearCache(){await this.cacheReady,await this.store.clear()}async evict(e){await this.cacheReady,this.store.has(e)&&await this.store.delete(e)}async readResponseHeaders(e,t){let o=t.getAllResponseHeaders().split(/[\r\n]+/).map(A=>A.trim()).filter(A=>A.length>0).map(A=>{let _=A.split(": "),M=_.shift().toLowerCase(),B=_.join(": ");return[M,B]}),r=new Zt(o),i=Array.from(r.keys()).map(A=>[A,r.get(A).join(", ")]),s=new Map(i),l=Ki(s,"content-type",sn),u=Ki(s,"content-length",parseFloat),h=Ki(s,"date",A=>new Date(A)),x=Ki(s,"content-disposition",A=>{if(E(A)){let _=A.match(Wm);if(E(_))return _[1]}return null});return{status:t.status,requestPath:e,responsePath:t.responseURL,content:void 0,contentType:l,contentLength:u,fileName:x,date:h,headers:s}}async readResponse(e,t){let{responsePath:o,status:r,contentType:i,contentLength:s,fileName:l,date:u,headers:h}=await this.readResponseHeaders(e,t),x={requestPath:e,responsePath:o,status:r,contentType:i,contentLength:s,fileName:l,date:u,headers:h,content:t.response};return E(x.content)&&(x.contentType=x.contentType||x.content.type,x.contentLength=x.contentLength||x.content.size),x}async decodeContent(e,t){return ae(t,async o=>{if(e==="")return null;if(N(t.contentType)){let r=Array.from(t.headers.entries()).map(i=>i.join(": ")).join(`
  `);throw new Error(`No content type found in headers: 
  `+r)}else{if(e==="blob")return o;if(e==="arraybuffer")return await o.arrayBuffer();if(e==="json"){let r=await o.text();return r.length>0?JSON.parse(r):null}else if(e==="document"){let r=new DOMParser;if(t.contentType==="application/xhtml+xml"||t.contentType==="text/html"||t.contentType==="application/xml"||t.contentType==="image/svg+xml"||t.contentType==="text/xml")return r.parseFromString(await o.text(),t.contentType);throw new Error("Couldn't parse document")}else{if(e==="text")return await o.text();Pe(e)}}})}async withCachedTask(e,t){return e.method!=="GET"&&e.method!=="HEAD"&&e.method!=="OPTIONS"?await t():(this.tasks.has(e.method,e.path)||this.tasks.add(e.method,e.path,t().finally(()=>this.tasks.delete(e.method,e.path))),this.tasks.get(e.method,e.path))}sendNothingGetNothing(e){return this.withCachedTask(e,qi(e.retryCount,async()=>{let t=new XMLHttpRequest,o=Qi(`requesting: ${e.path}`,t,t,null,!0);return mc(t,e.method,e.path,e.timeout,e.headers),await o,await this.readResponseHeaders(e.path,t)}))}sendNothingGetSomething(e,t,o){return this.withCachedTask(t,qi(t.retryCount,async()=>{let r=null,i=t.useCache&&t.method==="GET";i&&(E(o)&&o.start(),await this.cacheReady,r=await this.store.get(t.path));let s=N(r);if(s){let u=new XMLHttpRequest,h=Qi(`requesting: ${t.path}`,u,u,o,!0);mc(u,t.method,t.path,t.timeout,t.headers),await h,r=await this.readResponse(t.path,u),i&&await this.store.add(r)}let l=await this.decodeContent(e,r);return s&&E(o)&&o.end(),l}))}sendSomethingGetSomething(e,t,o,r){let i=null,s=Bp(new Map,o,t.headers),l=null;if(E(s)){let _=new Array;for(let M of s.keys())M.toLowerCase()==="content-type"&&_.push(M);if(_.length>0){t.body instanceof FormData||(l=s.get(_[0]),_.shift());for(let M of _)s.delete(M)}}Vm(t.body)&&!J(t.body)||J(t.body)&&gr.matches(l)?i=t.body:E(t.body)&&(i=JSON.stringify(t.body));let u=E(i),h=Mp(r,u?2:1),[x,g]=h,A=async()=>{let _=new XMLHttpRequest,M=u?Qi("uploading",_,_.upload,x,!1):Promise.resolve(),B=Qi("saving",_,_,g,!0,M);mc(_,t.method,t.path,t.timeout,s,i),await M,await B;let y=await this.readResponse(t.path,_);return await this.decodeContent(e,y)};return qi(t.retryCount,A)()}};var Rp=new URL(globalThis.location.href),pr=Rp.searchParams.has("DEBUG")&&!Rp.searchParams.has("RELEASE");var Pp="3.7.24";var Nm=pr?us(10):Pp;var Gm=50,Xm=12,tC=Gm*Xm;var Ip={fontFamily:"Lato",fontSize:20};var nC=_r(30,67,136),oC=_r(78,77,77),Vp={fontFamily:Ip.fontFamily,fontSize:Ip.fontSize,textFillColor:"white"},rC=Object.assign({},Vp,{bgFillColor:_r(0,120,215),bgStrokeColor:"black",bgStrokeSize:.02,padding:{top:.025,left:.05,bottom:.025,right:.05},minHeight:.2,maxHeight:.2,scale:300}),iC=Object.assign({},Vp,{textStrokeColor:"black",textStrokeSize:.01,minHeight:.25,maxHeight:.25});var Um=pr?".css":".min.css";function zm(n,e){return`/js/${e}/index${n}?v=${Nm}`}function jm(n){return zm(Um,n)}function Wp(n){return jm("dom-apps/"+n)}function Op(n=!0){let e=new zi(new Ji);return new Ui(e,!pr)}(async function(){let e=new URL(location.href).searchParams.get("FileID"),t=Op(),o=new Ni(zc("#frontBuffer"),Wp("photosphere-viewer"),t,!1,!1);await o.withFade(async()=>{let r=`/vr/file/${e}`,i=await t.get(r).progress(o.loadingBar).image().then(Fo);await o.skybox.setImage(r,i)})})();
