function B(t,o,e){return typeof t===o||t instanceof e}function X(t){return B(t,"function",Function)}function f(t){return B(t,"string",String)}function N(t){return B(t,"boolean",Boolean)}function b(t){return B(t,"number",Number)}function L(t){return a(t)&&B(t,"object",Object)}function tt(t){return t instanceof Date}function A(t){return t==null}function a(t){return!A(t)}function ft(t){return L(t)&&"compareTo"in t&&X(t.compareTo)}function At(t,...o){let e=null;f(t)?e=t:(e="ascending",o.unshift(t));let n=e==="ascending"?1:-1;return Object.assign((i,s)=>{if(i===s)return 0;for(let l of o){let c=A(i)?null:l(i),x=A(s)?null:l(s),u=c===x?0:f(c)&&f(x)?n*c.localeCompare(x):ft(c)&&ft(x)?n*c.compareTo(x):e==="ascending"&&c>x||e==="descending"&&c<x?1:-1;if(u!==0)return u}return 0},{direction:e})}function ot(t,o,e,n="search"){let r=0,i=t.length-1;for(;r<=i;){let s=r+i>>1,l=e(t[s],o);if(l===0){if(n!=="search"){let c=n==="append"?1:-1;for(c>0&&(s+=c);0<=s&&s<t.length&&(l=e(t[s],o))===0;)s+=c;c<0&&(s-=c)}return s}else l<0?r=s-l:i=s-l}return-r-1}function vt(t,o,e,n="search"){let r=n!=="set";n==="set"&&(n="search");let i=null;if(b(e)?i=e:i=ot(t,o,e,n),i<0)i=-i-1;else if(!r)return-1;return $t(t,o,i),i}function C(t){return t.splice(0)}function $t(t,o,e){t.splice(e,0,o)}function et(t,o){let e=t.indexOf(o);return e>-1?(gt(t,e),!0):!1}function gt(t,o){return t.splice(o,1)[0]}function nt(t,...o){t.splice(0,t.length,...o)}function z(t){return t}var rt=class{constructor(o=!0){this.autoStart=o,this.onThens=new Array,this.onCatches=new Array,this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",this.resolve=e=>{if(this.running){this._result=e,this._resultState="resolved";for(let n of this.onThens)n(e);this.clear(),this._executionState="finished"}},this.reject=e=>{if(this.running){this._error=e,this._resultState="errored";for(let n of this.onCatches)n(e);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){C(this.onThens),C(this.onCatches)}start(){this._executionState="running"}resolver(o){return()=>this.resolve(o)}resolveOn(o,e,n){let r=this.resolver(n);o.addEventListener(e,r),this.finally(()=>o.removeEventListener(e,r))}get result(){if(a(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((o,e)=>{this.finished?this.errored?e(this.error):o(this.result):(this.onThens.push(o),this.onCatches.push(e))})}then(o,e){return this.project().then(o,e)}catch(o){return this.project().catch(o)}finally(o){return this.project().finally(o)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(o){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",o&&this.start()}};var Ht="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function it(t,o){if(t<0)throw new Error("Length must be greater than 0");A(o)&&(o=Ht);let e="";for(let n=0;n<t;++n){let r=Math.floor(Math.random()*o.length);e+=o[r]}return e}var ht=new Map,J=class{constructor(o,e,n,...r){this.key=o,this.value=e,this.bySetAttribute=n,this.tags=r.map(i=>i.toLocaleUpperCase()),Object.freeze(this)}applyToElement(o){if(this.tags.length>0&&this.tags.indexOf(o.tagName)===-1){let e=ht.get(o.tagName);e||ht.set(o.tagName,e=new Set),e.has(this.key)||(e.add(this.key),console.warn(`Element ${o.tagName} does not support Attribute ${this.key}`))}this.bySetAttribute?o.setAttribute(this.key,this.value.toString()):this.key in o?o[this.key]=this.value:this.value===!1?o.removeAttribute(this.key):this.value===!0?o.setAttribute(this.key,""):X(this.value)?this.value(o):o.setAttribute(this.key,this.value.toString())}};function q(t,o,e,...n){return new J(t,o,e,...n)}function Vt(t){return t instanceof J}function I(...t){return t=t.filter(z),q("CLASS_LIST",o=>o.classList.add(...t),!1)}function pt(t){return q("colspan",t,!1,"td","th")}function bt(t,o){return q("data-"+t.toLowerCase(),o,!0)}function G(t,o){let e=null;f(t)?(e=document,o=t):e=t;let n=e.querySelectorAll(o);return Array.from(n)}function ct(t){return f(t)||(t=t.value),q("type",t,!1,"button","input","command","embed","link","object","script","source","style","menu")}function xt(t){return`${t}px`}var st=class{constructor(o){this._value=o}get value(){return this._value}toString(){return this.value}};var at=class extends st{constructor(o,e,n){super(n),this._name=o,this.sep=e}get name(){return this._name}toString(){return this.name+this.sep+this.value+";"}};var lt=class extends at{constructor(o,e){super(o,": ",e)}},dt=class extends lt{constructor(o,e){super(o.replace(/[A-Z]/g,n=>`-${n.toLocaleLowerCase()}`),e.toString()),this.key=o,this.priority=""}applyToElement(o){o.style[this.key]=this.value+this.priority}important(){return this.priority=" !important",this}get value(){return super.value+this.priority}};function wt(...t){return new dt("padding",t.join(" "))}function yt(t){return L(t)?t.element instanceof Element:!1}function k(t){return yt(t)?t.element:f(t)?Kt(t):t}function Ut(t){return L(t)&&"applyToElement"in t&&X(t.applyToElement)}function F(t,...o){let e=t instanceof Element||t instanceof ShadowRoot?t:f(t)?document.querySelector(t):t.element,n=e instanceof HTMLTemplateElement?e.content:e;for(let r of o)a(r)&&(r instanceof Node?n.appendChild(r):yt(r)?n.appendChild(k(r)):Ut(r)?e instanceof ShadowRoot||r.applyToElement(e):n.appendChild(document.createTextNode(r.toLocaleString())));return e}function Kt(t){return document.querySelector(t)}function St(t){return Array.from(document.querySelectorAll(t))}function g(t,...o){let e=null,n=o.filter(Vt).filter(r=>r.key==="id"||r.key==="query");for(let r of n)r.key==="query"?(e=r.value,et(o,r)):r.key==="id"&&(e=document.getElementById(r.value),e&&et(o,r));return e&&e.tagName!==t.toUpperCase()&&console.warn(`Expected a "${t.toUpperCase()}" element but found a "${e.tagName}".`),e||(e=document.createElement(t)),F(e,...o),e}function W(t){for(t=k(t);t.lastChild;)t.lastChild.remove()}function mt(t,o){t=k(t),W(t),t.append(Qt(o))}function Xt(t){return t=k(t),t.innerText}function Yt(t,o){t=k(t),t.title=o}function $(t,o,e){t=k(t);let n=a(e),r=n&&t.classList.contains(e);n&&r!==o&&t.classList.toggle(e)}function kt(t,o,e,n,r){t=k(t);let i=null,s=null,l=null;N(o)?(s=o,l=e,r=n):(i=o,s=e,l=n),t.disabled=!s,l&&mt(t,l),r&&Yt(t,r),i&&(t.classList.toggle("btn-"+i,s),t.classList.toggle("btn-outline-"+i,!s))}function Mt(...t){return g("button",...t)}function Zt(...t){return Mt(...t,ct("button"))}function Ct(...t){return Zt(...t,I("btn","btn-sm","btn-outline-secondary"))}function It(...t){return Mt(...t,ct("reset"))}function Tt(...t){return g("label",...t)}function jt(...t){return g("span",...t)}function Pt(...t){return g("table",...t)}function Et(...t){return g("tbody",...t)}function H(...t){return g("td",...t)}function Dt(...t){return g("tfoot",...t)}function T(...t){return g("th",...t)}function Ot(...t){return g("thead",...t)}function j(...t){return g("tr",...t)}function Qt(t){return document.createTextNode(t)}function M(t){let o=t;for(;o&&o.tagName!=="TD"&&o.tagName!=="TH";)o=o.parentElement;if(o){let e=o.parentElement,n=0;for(let r of e.children){if(r===o)return n;r instanceof HTMLTableCellElement&&(n+=r.colSpan)}}return-1}function Rt(t,o){let e=0;b(t)?e=t:o=t;let n=!0;return(...r)=>{n&&(n=!1,setTimeout(()=>{n=!0,o(...r)},e))}}function Ft(t){if(/^\d{4}-\d\d?-\d\d?$/.test(t)){let o=t.split("-"),e=o.shift();o.push(e),t=o.join("/")}return new Date(t)}function Bt(t){return t.classList.contains("range-start")}function to(t){return t.classList.contains("range-end")}function _t(t,o){return t instanceof HTMLInputElement&&(t.type.startsWith("date")||t.type.startsWith("time")||t.type.startsWith("month")||t.type.startsWith("week"))?o&&Ft(o)||null:t instanceof HTMLInputElement&&(t.type==="number"||t.type==="range")?o&&parseFloat(o)||null:o&&o.toLocaleLowerCase()||null}function Lt(t,o){let e=Array.from(t.querySelectorAll("input"));if(e.length===0){let n=t.textContent.trim();return[_t(o,n)]}else return e.map(n=>_t(n,n.value))}var zt=[10,25,50,100],oo=At(z),U=class t{static create(o){let e=j(),n=j(),r=0,i=0;for(let c of o.columns){let x=null;if(r>0)--r;else{let u=Tt(c.header);c.filter&&(x=it(10),u.htmlFor=x);let h=T(u);a(c.headerColSpan)&&(h.colSpan=c.headerColSpan,r=c.headerColSpan-1),e.appendChild(h)}if(i>0)--i;else if(c.filter){let u=c.filter;x&&(u.id=x),c.header&&u instanceof HTMLInputElement&&(u.placeholder="Filter by "+c.header);let h=T(u);a(c.filterColSpan)&&(h.colSpan=c.filterColSpan,i=c.filterColSpan-1),n.appendChild(h)}}let s=M(e.lastElementChild)-1;for(;M(n.lastElementChild)<s;)n.appendChild(T());for(n.appendChild(T(It(I("btn","btn-secondary"),"Reset"))),s=M(n.lastElementChild);s>M(e.lastElementChild);)e.appendChild(T());let l=new t(Pt(I("table","table-responsive","table-hover","table-striped","summary"),bt("resourcename",o.resourceName),Ot(e,n),Et()));return o.columns.forEach((c,x)=>l.setCellMapper(x,c.getCellValue)),l.setPageSizes(o.pageSizes||zt),l}get pageIndex(){return this._pageIndex}set pageIndex(o){this._pageIndex=o,localStorage.setItem(this.pageIndexKey,o.toString())}get pageSize(){return this._pageSize}set pageSize(o){this._pageSize=o,localStorage.setItem(this.pageSizeKey,o.toString())}constructor(o){this.element=o,this.ranges=new Map,this.valueCache=new Map,this.resetButton=null,this.cellMappers=new Map,this.pageSizes=[0,...zt],this.update=Rt(this._update.bind(this)),this.resourceName=this.element.dataset.resourcename,this.pageIndexKey=`${this.resourceName}-page-index`,this.pageSizeKey=`${this.resourceName}-page-size`,this.rows=G(this.element,"tbody > tr"),this.ranges=new Map,this.element.tHead?(this.filterElements=G(this.element.tHead,"input,select"),this.resetButton=this.element.tHead.querySelector("button[type=reset]")):this.filterElements=[],this.colCount=Math.max(...G(this.element,"tr").map(e=>e.children.length)),this.noContentMessageElement=j(H(pt(this.colCount),"No content")),this.paginator=H(pt(this.colCount),I("multi")),this.columnIndices=new Map,this.resetButton&&this.resetButton.addEventListener("click",()=>{this.valueCache.clear();for(let e of this.filterElements)this.deleteValue(e),e.value="";this.update()}),this.element.tFoot||(this.element.tFoot=Dt()),F(this.element.tFoot,this.noContentMessageElement,...this.element.tFoot.children,j(this.paginator));for(let e of this.filterElements){let n=M(e);if(this.columnIndices.set(e,n),e.addEventListener("input",this.update.bind(null,e)),this.restoreValue(e),Bt(e)||to(e)){this.ranges.has(n)||this.ranges.set(n,[null,null]);let r=this.ranges.get(n),i=Bt(e)?0:1;r[i]=e}}for(let e of this.element.querySelectorAll("input"))e.classList.add("form-control","form-control-sm");for(let e of this.element.querySelectorAll("select"))e.classList.add("custom-select","custom-select-sm");if(this.pageIndex=parseFloat(localStorage.getItem(this.pageIndexKey)||"0"),this.pageSize=parseFloat(localStorage.getItem(this.pageSizeKey)||"10"),a(this.element.dataset.pagesizes)&&this.element.dataset.pagesizes.length>0){let e=this.element.dataset.pagesizes.split(",").map(n=>parseFloat(n.trim())).filter(z);this.setPageSizes(e)}else this.update()}setPageSizes(o){if(A(o)||o.length===0)throw new Error("Need at least one page size");nt(this.pageSizes,0,...o),this.pageSize=this.pageSizes[1],this.update()}setCellMapper(o,e){this.cellMappers.set(o,e)}clear(){C(this.rows);for(let o of this.element.tBodies)W(o);this._update()}setValues(...o){let e=o.map(n=>{let r=j();for(let i=0;i<this.colCount;++i){let s=H();this.cellMappers.has(i)&&F(s,this.cellMappers.get(i)(n,r)),r.appendChild(s)}return this.rows.push(r),r});nt(this.rows,...e);for(let n of this.element.tBodies)W(n);F(this.contentRoot,...this.rows),this._update()}select(o){let e=null;for(let n=0;n<this.rows.length;++n){let r=this.rows[n],i=r===o;$(r,i,"selected"),i&&(e=n)}e!==null&&(this.pageIndex=Math.floor(e/this.pageSize)*this.pageSize,this.update())}get noContentMessage(){return Xt(this.noContentMessageElement)}set noContentMessage(o){mt(this.noContentMessageElement,o)}get contentRoot(){return this.element.tBodies[0]}makeKey(o){return`yarrow:${this.resourceName}:${o.id}`}saveValue(o,e){let n=this.makeKey(o);e?localStorage.setItem(n,e.toString()):localStorage.removeItem(n)}deleteValue(o){let e=this.makeKey(o);localStorage.removeItem(e)}restoreValue(o){let e=this.makeKey(o),n=localStorage.getItem(e);if(!a(n))o.value="";else if(o instanceof HTMLSelectElement)o.value=n,this.valueCache.set(o,o.value);else if(o.type.startsWith("date")){let r=Ft(n);o.valueAsDate=r,this.valueCache.set(o,r)}else if(o.type==="number"||o.type==="range"){let r=parseFloat(n);o.valueAsNumber=r,this.valueCache.set(o,r)}else o.value=n,this.valueCache.set(o,o.value)}isRange(o){let e=M(o);return this.ranges.has(e)}_update(o=null){if(a(o)){let p=_t(o,o.value);this.saveValue(o,p),p?this.valueCache.set(o,p):this.valueCache.delete(o)}this.resetButton&&(kt(this.resetButton,this.valueCache.size>0,"Reset","Clear out filters"),$(this.resetButton,this.valueCache.size>0,"btn-secondary"),$(this.resetButton,this.valueCache.size===0,"btn-outline-secondary"));let e=0;for(let p=0;p<this.rows.length;++p){let d=this.rows[p],m=!0;for(let E=0;E<this.filterElements.length&&m;++E){let D=this.filterElements[E],Y=this.columnIndices.get(D);if(this.isRange(D)){let[V,Z]=this.ranges.get(Y),O=this.valueCache.get(V),R=this.valueCache.get(Z),Q=d.children[Y],_=Lt(Q,V),S=null;if(a(O)&&a(R)?S=_.map(w=>O<=w&&w<=R):a(O)?S=_.map(w=>O<=w):a(R)&&(S=_.map(w=>w<=R)),S){let w=S.reduce((qt,Gt)=>qt||Gt,!1);m&&=w}}else{let V=this.valueCache.get(D);if(V){let Z=d.children[Y],Q=Lt(Z,D).map(_=>A(_)?!0:tt(_)?V.getTime()===_.getTime():b(_)?_===V:V==="XXX_NONE_XXX"?_.length===0||_==="NONE":D.classList.contains("exact")?_.toLocaleLowerCase()===V:_.toLocaleLowerCase().indexOf(V)>-1).reduce((_,S)=>_||S,!1);m&&=Q}}}m&&++e,d.style.display=m?"":"none"}let n=Math.ceil(e/this.pageSize),r=Math.max(0,n-1),i=Math.min(r,Math.floor(this.pageIndex/this.pageSize));this.pageIndex=i*this.pageSize;let s=Math.min(r,i+1),l=Math.max(0,i-1),c=i*this.pageSize,x=c+this.pageSize,u=this.rows.filter(p=>p.style.display!=="none");for(let p=0;p<u.length;++p)(p<c||x<=p)&&(u[p].style.display="none");this.noContentMessageElement.style.display=e===0?"":"none",W(this.paginator);let h=[],P=p=>{let d=ot(h,p,oo);d<0&&vt(h,p,d)};P(0),P(i),P(l),P(s),P(r);let Wt=r*this.pageSize,Nt=Math.max(0,this.pageIndex-this.pageSize),y=(p,d)=>{let m;return d?m=Ct(p):m=jt(wt(xt(5),xt(10)),p),this.paginator.append(m),m},K=(p,d)=>{let m=0<=d&&d<=Wt&&d!==this.pageIndex,E=y(p,m);m&&E.addEventListener("click",()=>{this.pageIndex=d,this.update()})},Jt=p=>{let d=p!==this.pageSize,m=y(p.toString(),d);d&&m.addEventListener("click",()=>{this.pageSize=p,this.update()})};K("<",Nt);let ut=-1;for(let p of h){let d=p-ut;ut=p,d>1&&y("...",!1),K((p+1).toFixed(0),p*this.pageSize)}if(K(">",x),y("|",!1),y(`${e} filtered items of ${this.rows.length} results`,!1),this.pageSizes.length>2){y("|",!1),y("Items per page:",!1);for(let p=1;p<this.pageSizes.length;++p)this.rows.length>this.pageSizes[p-1]&&Jt(this.pageSizes[p])}}};var eo=St("table.summary");for(let t of eo)new U(t);
