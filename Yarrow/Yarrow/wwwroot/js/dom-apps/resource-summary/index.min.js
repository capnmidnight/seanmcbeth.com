var F=class extends Error{constructor(n,r=null){super(n);this.innerError=r}};function W(e){return e}function z(e,t,n){return typeof e===t||e instanceof n}function j(e){return z(e,"function",Function)}function L(e){return z(e,"string",String)}function O(e){return z(e,"boolean",Boolean)}function P(e){return z(e,"number",Number)}function J(e){return u(e)&&z(e,"object",Object)}function Q(e){return e instanceof Date}function S(e){return e==null}function u(e){return!S(e)}function Fe(e){return e}function ze(e,t,n){let r=0,o=e.length,l=Math.floor((r+o)/2),f=!1;for(;r<o&&l<e.length;){let C=e[l],a=S(C)?null:n(C);u(a)&&t<a?o=l:(t===a&&(f=!0),r=l+1),l=Math.floor((r+o)/2)}return f||(l+=.5),l}function je(e,t,n){n=n||Fe;let r=n(t);return ze(e,r,n)}function V(e){return e.splice(0)}function Oe(e,t,n){e.splice(n,0,t)}function Z(e,...t){e.splice(0,e.length,...t)}function pe(e,t,n,r){let o;return j(n)?o=n:O(n)&&(r=n),S(r)&&(r=!0),Ne(e,t,o,r)}function Ne(e,t,n,r){let o=je(e,t,n),l=o%1===0;return o=o|0,(!l||r)&&Oe(e,t,o),o}var ee=class{constructor(t=!0){this.autoStart=t;this.onThens=new Array;this.onCatches=new Array;this._result=void 0;this._error=void 0;this._executionState="waiting";this._resultState="none";this.resolve=n=>{if(this.running){this._result=n,this._resultState="resolved";for(let r of this.onThens)r(n);this.clear(),this._executionState="finished"}},this.reject=n=>{if(this.running){this._error=n,this._resultState="errored";for(let r of this.onCatches)r(n);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){V(this.onThens),V(this.onCatches)}start(){this._executionState="running"}resolver(t){return()=>this.resolve(t)}resolveOn(t,n,r){let o=this.resolver(r);t.addEventListener(n,o),this.finally(()=>t.removeEventListener(n,o))}get result(){if(u(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((t,n)=>{this.finished?this.errored?n(this.error):t(this.result):(this.onThens.push(t),this.onCatches.push(n))})}then(t,n){return this.project().then(t,n)}catch(t){return this.project().catch(t)}finally(t){return this.project().finally(t)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(t){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",t&&this.start()}};var y=class{constructor(t,n,r,...o){this.key=t;this.value=n;this.bySetAttribute=r;this.tags=o.map(l=>l.toLocaleUpperCase()),Object.freeze(this)}applyToElement(t){let n=this.key.startsWith("data-");if(!(this.tags.length===0||this.tags.indexOf(t.tagName)>-1||n))console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`);else if(n){let o=this.key.substring(5);t.dataset[o]=this.value}else if(this.key==="style")Object.assign(t.style,this.value);else if(this.key==="classList"){let o=this.value.filter(W);o.length>0&&o.forEach(l=>t.classList.add(l))}else this.bySetAttribute?t.setAttribute(this.key,this.value):this.key in t?t[this.key]=this.value:this.value===!1?t.removeAttribute(this.key):this.value===!0?t.setAttribute(this.key,""):t.setAttribute(this.key,this.value)}};function B(...e){return new y("classList",e,!1)}function te(e){return new y("colspan",e,!1,"td","th")}function fe(e,t){return new y("data-"+e.toLowerCase(),t,!1)}function ne(e){return L(e)||(e=e.value),new y("type",e,!1,"button","input","command","embed","link","object","script","source","style","menu")}function ae(e){return`${e}px`}var re=class{constructor(t){this._value=t}get value(){return this._value}toString(){return this.value}};var oe=class extends re{constructor(n,r,o){super(o);this._name=n;this.sep=r}get name(){return this._name}toString(){return this.name+this.sep+this.value+";"}};var ie=class extends oe{constructor(t,n){super(t,": ",n)}},le=class extends ie{constructor(n,r){super(n.replace(/[A-Z]/g,o=>`-${o.toLocaleLowerCase()}`),r.toString());this.key=n;this.priority=""}applyToElement(n){n.style[this.key]=this.value+this.priority}important(){return this.priority=" !important",this}get value(){return super.value+this.priority}};function Se(...e){return new le("padding",e.join(" "))}function me(e){return J(e)?e.element instanceof Element:!1}function w(e){return me(e)?e.element:L(e)?We(e):e}function Ke(e){return J(e)&&"applyToElement"in e&&j(e.applyToElement)}function N(e,...t){e=w(e);for(let n of t)u(n)&&(n instanceof Node?e.append(n):me(n)?e.append(w(n)):Ke(n)?n.applyToElement(e):e.append(document.createTextNode(n.toLocaleString())));return e}function We(e){return document.querySelector(e)}function de(e){return Array.from(document.querySelectorAll(e))}function d(e,...t){let n=null;for(let r of t)if(r instanceof y&&r.key==="id"){n=document.getElementById(r.value);break}return n==null&&(n=document.createElement(e)),N(n,...t),n}function K(e){for(e=w(e);e.lastChild;)e.lastChild.remove()}function ue(e,t){e=w(e),K(e),e.append(Ue(t))}function ge(e){return e=w(e),e.innerText}function $e(e,t){e=w(e),e.title=t}function $(e,t,n){e=w(e);let r=u(n),o=r&&e.classList.contains(n);r&&o!==t&&e.classList.toggle(n)}function xe(e,t,n,r){e=w(e),e.disabled=!t,ue(e,n),$e(e,r)}function Ce(...e){return d("button",...e)}function _e(...e){return Ce(...e,ne("button"))}function he(...e){return _e(...e,B("btn","btn-sm","btn-outline-secondary"))}function be(...e){return Ce(...e,ne("reset"))}function ye(...e){return d("label",...e)}function we(...e){return d("span",...e)}function Ee(...e){return d("table",...e)}function Te(...e){return d("tbody",...e)}function _(...e){return d("td",...e)}function Pe(...e){return d("tfoot",...e)}function k(...e){return d("th",...e)}function ve(...e){return d("thead",...e)}function M(...e){return d("tr",...e)}function Ue(e){return document.createTextNode(e)}function v(e){let t=e;for(;t&&t.tagName!=="TD"&&t.tagName!=="TH";)t=t.parentElement;if(t){let n=t.parentElement,r=0;for(let o of n.children){if(o===t)return r;o instanceof HTMLTableCellElement&&(r+=o.colSpan)}}return-1}function Le(e,t){let n=0;P(e)?n=e:t=e;let r=!0;return(...o)=>{r&&(r=!1,setTimeout(()=>{r=!0,t(...o)},n))}}var qe="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function Ve(e,t){if(e<0)throw new Error("Length must be greater than 0");S(t)&&(t=qe);let n="";for(let r=0;r<e;++r){let o=Math.floor(Math.random()*t.length);n+=t[o]}return n}function Ie(e){if(/^\d{4}-\d\d?-\d\d?$/.test(e)){var t=e.split("-"),n=t.shift();t.push(n),e=t.join("/")}return new Date(e)}function Be(e){return e.classList.contains("range-start")}function Xe(e){return e.classList.contains("range-end")}function se(e,t){return e instanceof HTMLInputElement&&(e.type.startsWith("date")||e.type.startsWith("time")||e.type.startsWith("month")||e.type.startsWith("week"))?t&&Ie(t)||null:e instanceof HTMLInputElement&&(e.type==="number"||e.type==="range")?t&&parseFloat(t)||null:t&&t.toLocaleLowerCase()||null}function ke(e,t){let n=Array.from(e.querySelectorAll("input"));if(n.length===0){let r=e.textContent.trim();return[se(t,r)]}else return n.map(r=>se(r,r.value))}var Me=[10,25,50,100],I=class{constructor(t){this.element=t;this.ranges=new Map;this.valueCache=new Map;this.resetButton=null;this.cellMappers=new Map;this.pageSizes=[0,...Me];this.update=Le(this._update.bind(this)),this.resourceName=this.element.dataset.resourcename,this.pageIndexKey=`${this.resourceName}-page-index`,this.pageSizeKey=`${this.resourceName}-page-size`,this.rows=Array.from(this.element.querySelectorAll("tbody > tr")),this.ranges=new Map,this.element.tHead?(this.filterElements=[...this.element.tHead.querySelectorAll("input,select")],this.resetButton=this.element.tHead.querySelector("button[type=reset]")):this.filterElements=[],this.colCount=Math.max(...Array.from(this.element.querySelectorAll("tr")).map(n=>n.children.length)),this.noContentMessageElement=M(_(te(this.colCount),"No content")),this.paginator=_(te(this.colCount),B("multi")),this.columnIndices=new Map,this.resetButton&&this.resetButton.addEventListener("click",()=>{this.valueCache.clear();for(let n of this.filterElements)this.deleteValue(n),n.value="";this.update()}),this.element.tFoot||(this.element.tFoot=Pe()),N(this.element.tFoot,this.noContentMessageElement,...this.element.tFoot.children,M(this.paginator));for(let n of this.filterElements){let r=v(n);if(this.columnIndices.set(n,r),n.addEventListener("input",this.update.bind(null,n)),this.restoreValue(n),Be(n)||Xe(n)){this.ranges.has(r)||this.ranges.set(r,[null,null]);let o=this.ranges.get(r),l=Be(n)?0:1;o[l]=n}}for(let n of this.element.querySelectorAll("input"))n.classList.add("form-control","form-control-sm");for(let n of this.element.querySelectorAll("select"))n.classList.add("custom-select","custom-select-sm");if(this.pageIndex=parseFloat(localStorage.getItem(this.pageIndexKey)||"0"),this.pageSize=parseFloat(localStorage.getItem(this.pageSizeKey)||"10"),u(this.element.dataset.pagesizes)&&this.element.dataset.pagesizes.length>0){let n=this.element.dataset.pagesizes.split(",").map(r=>parseFloat(r.trim())).filter(W);this.setPageSizes(n)}else this.update()}static create(t){let n=M(),r=M(),o=0,l=0;for(let a of t.columns){let g=null;if(o>0)--o;else{let m=ye(a.header);a.filter&&(g=Ve(10),m.htmlFor=g);let h=k(m);u(a.headerColSpan)&&(h.colSpan=a.headerColSpan,o=a.headerColSpan-1),n.appendChild(h)}if(l>0)--l;else if(a.filter){let m=a.filter;g&&(m.id=g),a.header&&m instanceof HTMLInputElement&&(m.placeholder="Filter by "+a.header);let h=k(m);u(a.filterColSpan)&&(h.colSpan=a.filterColSpan,l=a.filterColSpan-1),r.appendChild(h)}}let f=v(n.lastElementChild)-1;for(;v(r.lastElementChild)<f;)r.appendChild(k());for(r.appendChild(k(be(B("btn","btn-secondary"),"Reset"))),f=v(r.lastElementChild);f>v(n.lastElementChild);)n.appendChild(k());let C=new I(Ee(B("table","table-responsive","table-hover","table-striped","summary"),fe("resourcename",t.resourceName),ve(n,r),Te()));return t.columns.forEach((a,g)=>C.setCellMapper(g,a.getCellValue)),C.setPageSizes(t.pageSizes||Me),C}get pageIndex(){return this._pageIndex}set pageIndex(t){this._pageIndex=t,localStorage.setItem(this.pageIndexKey,t.toString())}get pageSize(){return this._pageSize}set pageSize(t){this._pageSize=t,localStorage.setItem(this.pageSizeKey,t.toString())}setPageSizes(t){if(S(t)||t.length===0)throw new F("Need at least one page size");Z(this.pageSizes,0,...t),this.pageSize=this.pageSizes[1],this.update()}setCellMapper(t,n){this.cellMappers.set(t,n)}clear(){V(this.rows);for(let t of this.element.tBodies)K(t);this._update()}setValues(...t){let n=t.map(r=>{let o=M();for(let l=0;l<this.colCount;++l){let f=_();this.cellMappers.has(l)&&N(f,this.cellMappers.get(l)(r,o)),o.appendChild(f)}return this.rows.push(o),o});Z(this.rows,...n);for(let r of this.element.tBodies)K(r);N(this.contentRoot,...this.rows),this._update()}select(t){let n=null;for(let r=0;r<this.rows.length;++r){let o=this.rows[r],l=o===t;$(o,l,"selected"),l&&(n=r)}n!==null&&(this.pageIndex=Math.floor(n/this.pageSize)*this.pageSize,this.update())}get noContentMessage(){return ge(this.noContentMessageElement)}set noContentMessage(t){ue(this.noContentMessageElement,t)}get contentRoot(){return this.element.tBodies[0]}makeKey(t){return`yarrow:${this.resourceName}:${t.id}`}saveValue(t,n){let r=this.makeKey(t);n?localStorage.setItem(r,n.toString()):localStorage.removeItem(r)}deleteValue(t){let n=this.makeKey(t);localStorage.removeItem(n)}restoreValue(t){let n=this.makeKey(t),r=localStorage.getItem(n);if(!u(r))t.value="";else if(t instanceof HTMLSelectElement)t.value=r,this.valueCache.set(t,t.value);else if(t.type.startsWith("date")){let o=Ie(r);t.valueAsDate=o,this.valueCache.set(t,o)}else if(t.type==="number"||t.type==="range"){let o=parseFloat(r);t.valueAsNumber=o,this.valueCache.set(t,o)}else t.value=r,this.valueCache.set(t,t.value)}isRange(t){let n=v(t);return this.ranges.has(n)}_update(t=null){if(u(t)){let i=se(t,t.value);this.saveValue(t,i),i?this.valueCache.set(t,i):this.valueCache.delete(t)}this.resetButton&&(xe(this.resetButton,this.valueCache.size>0,"Reset","Clear out filters"),$(this.resetButton,this.valueCache.size>0,"btn-secondary"),$(this.resetButton,this.valueCache.size===0,"btn-outline-secondary"));let n=0;for(let i=0;i<this.rows.length;++i){let s=this.rows[i],c=!0;for(let H=0;H<this.filterElements.length&&c;++H){let A=this.filterElements[H],q=this.columnIndices.get(A);if(this.isRange(A)){let[x,X]=this.ranges.get(q),G=this.valueCache.get(x),D=this.valueCache.get(X),Y=s.children[q],p=ke(Y,x),T=null;if(u(G)&&u(D)?T=p.map(b=>G<=b&&b<=D):u(G)?T=p.map(b=>G<=b):u(D)&&(T=p.map(b=>b<=D)),T){let b=T.reduce((Ge,De)=>Ge||De,!1);c&&=b}}else{let x=this.valueCache.get(A);if(x){let X=s.children[q],Y=ke(X,A).map(p=>S(p)?!0:Q(p)?x.getTime()===p.getTime():P(p)?p===x:x==="XXX_NONE_XXX"?p.length===0||p==="NONE":A.classList.contains("exact")?p.toLocaleLowerCase()===x:p.toLocaleLowerCase().indexOf(x)>-1).reduce((p,T)=>p||T,!1);c&&=Y}}}c&&++n,s.style.display=c?"":"none"}let r=Math.ceil(n/this.pageSize),o=Math.max(0,r-1),l=Math.min(o,Math.floor(this.pageIndex/this.pageSize));this.pageIndex=l*this.pageSize;let f=Math.min(o,l+1),C=Math.max(0,l-1),a=l*this.pageSize,g=a+this.pageSize,m=this.rows.filter(i=>i.style.display!=="none");for(let i=0;i<m.length;++i)(i<a||g<=i)&&(m[i].style.display="none");this.noContentMessageElement.style.display=n===0?"":"none",K(this.paginator);let h=[],R=i=>pe(h,i,!1);R(0),R(l),R(C),R(f),R(o);let Re=o*this.pageSize,He=Math.max(0,this.pageIndex-this.pageSize),E=(i,s)=>{let c;return s?c=he(i):c=we(Se(ae(5),ae(10)),i),this.paginator.append(c),c},U=(i,s)=>{let c=0<=s&&s<=Re&&s!==this.pageIndex,H=E(i,c);c&&H.addEventListener("click",()=>{this.pageIndex=s,this.update()})},Ae=i=>{let s=i!==this.pageSize,c=E(i.toString(),s);s&&c.addEventListener("click",()=>{this.pageSize=i,this.update()})};U("<",He);let ce=-1;for(let i of h){let s=i-ce;ce=i,s>1&&E("...",!1),U((i+1).toFixed(0),i*this.pageSize)}if(U(">",g),E("|",!1),E(`${n} filtered items of ${this.rows.length} results`,!1),this.pageSizes.length>2){E("|",!1),E("Items per page:",!1);for(let i=1;i<this.pageSizes.length;++i)this.rows.length>this.pageSizes[i-1]&&Ae(this.pageSizes[i])}}};var Ye=de("table.summary");for(let e of Ye)new I(e);
