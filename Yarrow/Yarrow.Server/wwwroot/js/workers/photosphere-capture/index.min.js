function ot(o,t,e){return typeof o===t||o instanceof e}function v(o){return ot(o,"function",Function)}function _(o){return ot(o,"string",String)}function nt(o){return ot(o,"boolean",Boolean)}function E(o){return ot(o,"number",Number)}function W(o){return c(o)&&ot(o,"object",Object)}function I(o){return o instanceof Array}function w(o,t){throw new Error((t||"Unexpected object: ")+o)}function m(o){return o==null}function c(o){return!m(o)}function ge(o){return o instanceof Uint8Array||o instanceof Uint8ClampedArray||o instanceof Int8Array||o instanceof Uint16Array||o instanceof Int16Array||o instanceof Uint32Array||o instanceof Int32Array||o instanceof Float32Array||o instanceof Float64Array||"BigUint64Array"in globalThis&&o instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&o instanceof globalThis.BigInt64Array}function ve(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function P(o){return o.splice(0)}function Ae(o,t){for(let e=0;e<o.length;++e)if(o[e]!==t[e])return e;return-1}function z(o,t){let e=o.indexOf(t);return e>-1?(Wt(o,e),!0):!1}function Wt(o,t){return o.splice(t,1)[0]}function Co(o,t,e){let n=o?0:t.length-1,r=o?t.length:-1,s=o?1:-1;for(let i of e)for(let p=n;p!=r;p+=s){let a=t[p];if(i(a))return a}return null}function be(o,...t){return Co(!0,o,t)}var U=class{constructor(){this.listeners=new Map,this.listenerOptions=new Map,this.bubblers=new Set,this.scopes=new WeakMap}addBubbler(t){this.bubblers.add(t)}removeBubbler(t){this.bubblers.delete(t)}addScopedEventListener(t,e,n,r){this.scopes.has(t)||this.scopes.set(t,[]),this.scopes.get(t).push([e,n]),this.addEventListener(e,n,r)}removeScope(t){let e=this.scopes.get(t);if(e){this.scopes.delete(t);for(let[n,r]of e)this.removeEventListener(n,r)}}addEventListener(t,e,n){let r=this.listeners.get(t);r||(r=new Array,this.listeners.set(t,r)),r.find(s=>s===e)||(r.push(e),n&&this.listenerOptions.set(e,n))}removeEventListener(t,e){let n=this.listeners.get(t);n&&this.removeListener(n,e)}clearEventListeners(t){for(let[e,n]of this.listeners)if(m(t)||t===e){for(let r of n)this.removeEventListener(t,r);P(n),this.listeners.delete(e)}}removeListener(t,e){let n=t.findIndex(r=>r===e);n>=0&&(Wt(t,n),this.listenerOptions.has(e)&&this.listenerOptions.delete(e))}dispatchEvent(t){let e=this.listeners.get(t.type);if(e)for(let n of e){let r=this.listenerOptions.get(n);c(r)&&!nt(r)&&r.once&&this.removeListener(e,n),v(n)?n.call(this,t):n.handleEvent(t)}if(t.defaultPrevented)return!1;for(let n of this.bubblers)if(!n.dispatchEvent(t))return!1;return!0}};var D=class extends U{addBubbler(t){super.addBubbler(t)}removeBubbler(t){super.removeBubbler(t)}addScopedEventListener(t,e,n,r){super.addScopedEventListener(t,e,n,r)}addEventListener(t,e,n){super.addEventListener(t,e,n)}removeEventListener(t,e){super.removeEventListener(t,e)}clearEventListeners(t){return super.clearEventListeners(t)}};var H=class extends D{constructor(){super(...arguments),this.attached=new Array,this.soFar=null,this.total=null,this.msg=null,this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(t,e,n,r){this.soFar=t,this.total=e,this.msg=n,this.est=r;for(let s of this.attached)s.report(t,e,n,r)}attach(t){this.attached.push(t),t.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(t){this.report(0,1,t||"starting")}end(t){this.report(1,1,t||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,P(this.attached)}};var zt=class extends H{constructor(t,e){super(),this.server=t,this.taskID=e}report(t,e,n,r){let s={type:"progress",taskID:this.taskID,soFar:t,total:e,msg:n,est:r};this.server.postMessage(s)}},mt=class{constructor(t){this.self=t,this.methods=new Map,this.self.addEventListener("message",e=>{let n=e.data;this.callMethod(n)})}postMessage(t,e){c(e)?this.self.postMessage(t,e):this.self.postMessage(t)}callMethod(t){let e=this.methods.get(t.methodName);if(e)try{I(t.params)?e(t.taskID,...t.params):c(t.params)?e(t.taskID,t.params):e(t.taskID)}catch(n){this.onError(t.taskID,`method invocation error: ${t.methodName}(${n.message||n})`)}else this.onError(t.taskID,`method not found: ${t.methodName}`)}onError(t,e){let n={type:"error",taskID:t,errorMessage:e};this.postMessage(n)}onReturn(t,e,n){let r=null;if(e===void 0?r={type:"return",taskID:t}:r={type:"return",taskID:t,returnValue:e},c(n)){let s=n(e);this.postMessage(r,s)}else this.postMessage(r)}addMethodInternal(t,e,n){if(this.methods.has(t))throw new Error(`${t} method has already been mapped.`);this.methods.set(t,async(r,...s)=>{let i=new zt(this,r);try{let p=await e(...s,i);this.onReturn(r,p,n)}catch(p){console.error(p),this.onError(r,p.message||p)}})}addFunction(t,e,n){this.addMethodInternal(t,e,n)}addVoidFunction(t,e){this.addMethodInternal(t,e)}addMethod(t,e,n,r){this.addFunction(e,n.bind(t),r)}addVoidMethod(t,e,n){this.addVoidFunction(e,n.bind(t))}addEvent(t,e,n,r){t.addEventListener(e,s=>{let i=null;if(c(n)?i={type:"event",eventName:e,data:n(s)}:i={type:"event",eventName:e},i.data!==void 0&&c(r)){let p=r(i.data);this.postMessage(i,p)}else this.postMessage(i)})}};function rt(o){return o}function we(){return!0}function Ve(){return!1}var V=class{constructor(t=!0){this.autoStart=t,this.onThens=new Array,this.onCatches=new Array,this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",this.resolve=e=>{if(this.running){this._result=e,this._resultState="resolved";for(let n of this.onThens)n(e);this.clear(),this._executionState="finished"}},this.reject=e=>{if(this.running){this._error=e,this._resultState="errored";for(let n of this.onCatches)n(e);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){P(this.onThens),P(this.onCatches)}start(){this._executionState="running"}resolver(t){return()=>this.resolve(t)}resolveOn(t,e,n){let r=this.resolver(n);t.addEventListener(e,r),this.finally(()=>t.removeEventListener(e,r))}get result(){if(c(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((t,e)=>{this.finished?this.errored?e(this.error):t(this.result):(this.onThens.push(t),this.onCatches.push(e))})}then(t,e){return this.project().then(t,e)}catch(t){return this.project().catch(t)}finally(t){return this.project().finally(t)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(t){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",t&&this.start()}};function ye(o,t){return"on"+t in o}function T(o,t,e,...n){m(n)&&(n=[]);let r;if(_(e)?n.unshift(e):E(e)&&(r=e),!(o instanceof U)){if(!ye(o,t))throw new Error(`Target does not have a ${t} rejection event`);for(let a of n)if(!ye(o,a))throw new Error(`Target does not have a ${a} rejection event`)}let s=new V;if(E(r)){let a=setTimeout(s.reject,r,`'${t}' has timed out.`);s.finally(clearTimeout.bind(globalThis,a))}let i=(a,d)=>{o.addEventListener(a,d),s.finally(()=>o.removeEventListener(a,d))};i(t,a=>s.resolve(a));let p=a=>s.reject(a);for(let a of n)i(a,p);return s}function O(o){return o.then(we).catch(Ve)}var Se=/([^\/]+)\/(.+)/,Mo=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/;var J=class o{constructor(t,e,n){this._type=t,this._fullSubType=e,this._primaryExtension=null,this.depMessage=null;let r=new Map;this._parameters=r;let s=this._fullSubType.match(Mo);this._tree=s[1],this._subType=s[2],this._suffix=s[3];let i=s[4];if(this._value=this._fullValue=this._type+"/",c(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,c(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),c(i)){let p=i.split(";").map(a=>a.trim()).filter(a=>a.length>0).map(a=>a.split("="));for(let[a,...d]of p){let l=d.join("=");r.set(a,l);let h=`; ${a}=${l}`;this._fullValue+=h,a!=="q"&&(this._value+=h)}}this._extensions=n||[],this._primaryExtension=this._extensions[0]||null}static parse(t){if(!t)return null;let e=t.match(Se);if(!e)return null;let n=e[1],r=e[2];return new o(n,r)}deprecate(t){return this.depMessage=t,this}check(){c(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(t){if(m(t))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let e=null,n=null;if(_(t)){let r=t.match(Se);if(!r)return!1;e=r[1],n=r[2]}else e=t.typeName,n=t._fullSubType;return this.typeName===e&&(this._fullSubType==="*"||this._fullSubType===n)}withParameter(t,e){let n=`${this._fullSubType}; ${t}=${e}`;return new o(this.typeName,n,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}toFileSystemAPIAccepts(){return{[this.value]:this.extensions.map(t=>"."+t)}}addExtension(t){if(!t)throw new Error("File name is not defined");return this.primaryExtension&&(t=o.removeExtension(t),t=`${t}.${this.primaryExtension}`),t}static removeExtension(t){let e=t.lastIndexOf(".");return e>-1&&(t=t.substring(0,e)),t}};function To(o,t,...e){return new J(o,t,e)}function y(o){return To.bind(null,o)}var Ut=y("application");var q=Ut("javascript","js");var Ht=Ut("json","json");var Jt=Ut("wasm","wasm");var Xo=y("image");var qt=Xo("jpeg","jpeg","jpg","jpe");var $t=y("text");var it=$t("css","css");var xt=$t("plain","txt","text","conf","def","list","log","in");var ke=$t("xml");var Io="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";function Kt(o,t){if(o<0)throw new Error("Length must be greater than 0");m(t)&&(t=Io);let e="";for(let n=0;n<o;++n){let r=Math.floor(Math.random()*t.length);e+=t[r]}return e}var Ce=new Map,ut=class{constructor(t,e,n,...r){this.key=t,this.value=e,this.bySetAttribute=n,this.tags=r.map(s=>s.toLocaleUpperCase()),Object.freeze(this)}applyToElement(t){if(this.tags.length>0&&this.tags.indexOf(t.tagName)===-1){let e=Ce.get(t.tagName);e||Ce.set(t.tagName,e=new Set),e.has(this.key)||(e.add(this.key),console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`))}this.bySetAttribute?t.setAttribute(this.key,this.value.toString()):this.key in t?t[this.key]=this.value:this.value===!1?t.removeAttribute(this.key):this.value===!0?t.setAttribute(this.key,""):v(this.value)?this.value(t):t.setAttribute(this.key,this.value.toString())}};function st(o,t,e,...n){return new ut(o,t,e,...n)}function Me(o){return o instanceof ut}function Te(o){return st("height",o,!1,"canvas","embed","iframe","img","input","object","video")}function Qt(o){return st("rel",o,!1,"a","area","link")}function Po(o){return o instanceof URL&&(o=o.href),o}function Xe(o){return st("src",Po(o),!1,"audio","embed","iframe","img","input","script","source","track","video")}function _t(o){return _(o)||(o=o.value),st("type",o,!1,"button","input","command","embed","link","object","script","source","style","menu")}function Ie(o){return st("width",o,!1,"canvas","embed","iframe","img","input","object","video")}function ft(...o){return`rgb(${o.join(", ")})`}function Pe(o){return W(o)?o.element instanceof Element:!1}function Eo(o){return Pe(o)?o.element:_(o)?jo(o):o}function Ro(o){return W(o)&&"applyToElement"in o&&v(o.applyToElement)}function Oo(o,...t){let e=o instanceof Element||o instanceof ShadowRoot?o:_(o)?document.querySelector(o):o.element,n=e instanceof HTMLTemplateElement?e.content:e;for(let r of t)c(r)&&(r instanceof Node?n.appendChild(r):Pe(r)?n.appendChild(Eo(r)):Ro(r)?e instanceof ShadowRoot||r.applyToElement(e):n.appendChild(document.createTextNode(r.toLocaleString())));return e}function jo(o){return document.querySelector(o)}function ht(o,...t){let e=null,n=t.filter(Me).filter(r=>r.key==="id"||r.key==="query");for(let r of n)r.key==="query"?(e=r.value,z(t,r)):r.key==="id"&&(e=document.getElementById(r.value),e&&z(t,r));return e&&e.tagName!==o.toUpperCase()&&console.warn(`Expected a "${o.toUpperCase()}" element but found a "${e.tagName}".`),e||(e=document.createElement(o)),Oo(e,...t),e}function Ee(...o){return ht("canvas",...o)}function gt(...o){return ht("img",...o)}function Re(...o){return ht("link",...o)}function Oe(...o){return ht("script",...o)}var pt=class extends H{constructor(t,e){super(),this.i=t,this.prog=e}report(t,e,n,r){super.report(t,e,n,r),this.prog.update(this.i,t,e,n)}};var vt=class{constructor(t){this.prog=t,this.weightTotal=0,this.subProgressCallbacks=new Array,this.subProgressWeights=new Array,this.subProgressValues=new Array,this.start=performance.now();for(let e=0;e<this.subProgressWeights.length;++e)this.subProgressValues[e]=0,this.subProgressCallbacks[e]=new pt(e,this)}addSubProgress(t){t=t||1,this.weightTotal+=t,this.subProgressWeights.push(t),this.subProgressValues.push(0);let e=new pt(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(e),e}update(t,e,n,r){if(this.prog){this.subProgressValues[t]=e/n;let s=0;for(let d=0;d<this.subProgressWeights.length;++d)s+=this.subProgressValues[d]*this.subProgressWeights[d];let i=performance.now(),p=i-this.start,a=this.start-i+p*this.weightTotal/s;this.prog.report(s,this.weightTotal,r,a)}}};function at(o,t){return new Zt(t,o).subProgressCallbacks}function je(o,t){let e=new Array(t);for(let n=0;n<t;++n)e[n]=1;return at(o,e)}var Zt=class extends vt{constructor(t,e){super(e);for(let n of t)this.addSubProgress(n)}};async function De(o,t){let e=new Array(t.length),n=new Array(t.length);for(let i=0;i<t.length;++i){let p=t[i];e[i]=p[0],n[i]=p[1]}let r=at(o,e),s=new Array(t.length);for(let i=0;i<t.length;++i)s[i]=n[i](r[i]);return await Promise.all(s)}function Be(o){if(o.status>=400)throw new Error("Resource could not be retrieved: "+o.requestPath);return o}function At(o){let{content:t}=Be(o);return t}function Fe(o){return c(o)&&v(o.then)&&v(o.catch)&&v(o.finally)&&v(o.fetch)&&v(o.getSize)}var Le=class{get result(){if(c(this.error))throw this.error;return this._result}get error(){return this._error}get started(){return this._started}get finished(){return this._finished}constructor(t,e){this.path=t,this.type=e,this._result=null,this._error=null,this._started=!1,this._finished=!1,this.resolve=null,this.reject=null,this.promise=new Promise((n,r)=>{this.resolve=s=>{this._result=s,this._finished=!0,n(s)},this.reject=s=>{this._error=s,this._finished=!0,r(s)}})}async getSize(t){try{let{contentLength:e}=await t.head(this.path).accept(this.type).exec();return[this,e||1]}catch(e){return console.warn(e),[this,1]}}async fetch(t,e){try{let n=await this.getResult(t,e);this.resolve(n)}catch(n){this.reject(n)}}get[Symbol.toStringTag](){return this.promise.toString()}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}};function Yt(o,...t){if(!W(o))return!1;o=o;for(let e of t){if(!(e in o))return!1;let n=o[e];if(!v(n))return!1}return!0}function Do(o){return Yt(o,"dispose")}function Bo(o){return Yt(o,"destroy")}function Lo(o){return Yt(o,"close")}function S(o){Do(o)&&o.dispose(),Lo(o)&&o.close(),Bo(o)&&o.destroy()}function Ge(o,t){try{return t(o)}finally{S(o)}}var te=!1,G=!te&&"OffscreenCanvas"in globalThis,fi=!te&&"createImageBitmap"in globalThis;function Ne(o){return!1}function We(o){return G&&o instanceof OffscreenCanvas}function Fo(o){return Ne(o)||We(o)}function Go(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var No=G&&Go(),bt=No&&ee||!1||null;function Wo(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var hi=G&&Wo();function ee(o,t){return new OffscreenCanvas(o,t)}function oe(o,t){throw new Error("HTML Canvas is not supported in workers")}function wt(o,t){let e=o.getContext("2d");if(m(e))throw new Error("Could not create 2d context for canvas");e.drawImage(t,0,0)}function ze(o){throw new Error("HTML Canvas is not supported in workers")}async function ne(o){throw new Error("HTML Image is not supported in workers")}function re(o,t,e){if(t instanceof J&&(t=t.value),We(o))return o.convertToBlob({type:t,quality:e});if(Ne(o)){let n=new V;return o.toBlob(n.resolve,t,e),n}else throw new Error("Cannot save image from canvas")}function ie(o){Fo(o)?o.width=o.height=0:S(o)}function Ue(o){let t=new V,e=setInterval(()=>{o()&&(clearInterval(e),t.resolve())},100);return t}async function g(o,t){let{status:e,requestPath:n,responsePath:r,content:s,contentType:i,contentLength:p,fileName:a,headers:d,date:l}=o;return{status:e,requestPath:n,responsePath:r,content:c(t)?await t(s):void 0,contentType:i,contentLength:p,fileName:a,headers:d,date:l}}var se=null;function He(o){return se===null&&(se=new Audio),se.canPlayType(o)!==""}var Vt=class{constructor(t,e,n,r=!1){this.fetcher=t,this.method=e,this.path=n,this.useBLOBs=r,this.prog=null,this.request={method:e,path:this.path.href,body:null,headers:null,timeout:null,withCredentials:!1,useCache:!1,retryCount:3}}retries(t){return this.request.retryCount=t,this}query(t,e){return this.path.searchParams.set(t,e),this.request.path=this.path.href,this}header(t,e){return this.request.headers===null&&(this.request.headers=new Map),this.request.headers.set(t.toLowerCase(),e),this}headers(t){for(let[e,n]of t.entries())this.header(e,n);return this}timeout(t){return this.request.timeout=t,this}progress(t){return this.prog=t,this}body(t,e){if(c(t)){let n=new Set,r=new Array;r.push(t);let s=!1;for(;!s&&r.length>0;){let i=r.shift();if(i&&!n.has(i))if(n.add(i),i instanceof Blob){s=!0;break}else _(i)||r.push(...Object.values(i))}if(s){let i=new FormData,p=new Map,a=new Set;for(let[d,l]of Object.entries(t))if(l instanceof Blob){let h=d+".name",x=t[h];_(x)&&(p.set(l,x),a.add(h))}for(let[d,l]of Object.entries(t))a.has(d)||(l instanceof Blob?i.append(d,l,p.get(l)):_(l)?i.append(d,l):c(l)&&v(l.toString)?i.append(d,l.toString()):console.warn("Can't serialize value to formdata",d,l));t=i,e=void 0}this.request.body=t,this.content(e)}return this}withCredentials(){return this.request.withCredentials=!0,this}useCache(t=!0){return this.request.useCache=t,this}media(t,e){c(e)&&(_(e)||(e=e.value),this.header(t,e))}content(t){this.media("content-type",t)}accept(t){return this.media("accept",t),this}blob(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBlob(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBlob(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);w(this.method)}buffer(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetBuffer(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetBuffer(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);w(this.method)}async file(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return await this.fetcher.sendObjectGetFile(this.request,this.prog);if(this.method==="GET"){if(this.useBLOBs)return await this.fetcher.sendNothingGetFile(this.request,this.prog);{let e=await this.fetcher.sendNothingGetNothing(this.request);return g(e,()=>this.request.path)}}else{if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);w(this.method)}}text(t){if(this.accept(t||xt),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetText(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetText(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);w(this.method)}object(t){if(this.accept(t||Ht),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetObject(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetObject(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);w(this.method)}xml(t){if(this.accept(t||ke),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetXml(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetXml(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);w(this.method)}imageBitmap(t){if(this.accept(t),this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetImageBitmap(this.request,this.prog);if(this.method==="GET")return this.fetcher.sendNothingGetImageBitmap(this.request,this.prog);if(this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);w(this.method)}exec(){if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE")return this.fetcher.sendObjectGetNothing(this.request,this.prog);if(this.method==="GET")throw new Error("GET requests should expect a response type");if(this.method==="HEAD"||this.method==="OPTIONS")return this.fetcher.sendNothingGetNothing(this.request);w(this.method)}async audioBlob(t){if(c(t)&&(_(t)||(t=t.value),!He(t)))throw new Error(`Probably can't play file of type "${t}" at path: ${this.request.path}`);let e=await this.blob(t);if(He(e.contentType))return e;throw new Error(`Cannot play file of type "${e.contentType}" at path: ${this.request.path}`)}async audioBuffer(t,e){return g(await this.audioBlob(e),async n=>await t.decodeAudioData(await n.arrayBuffer()))}async htmlElement(t,e,n){let r=await this.file(n),s=T(t,e,"error");return t instanceof HTMLLinkElement?t.href=r.content:t.src=r.content,await s,await g(r,()=>t)}image(t){return this.htmlElement(gt(),"load",t)}async htmlCanvas(t){throw new Error("HTMLCanvasElement not supported in Workers.")}canvas(t){return G?this.offscreenCanvas(t):this.htmlCanvas(t)}async offscreenCanvas(t){if(!G)throw new Error("This system does not support OffscreenCanvas");if(this.method==="GET"){let e=await this.imageBitmap(t);return await g(e,n=>{let r=ee(n.width,n.height);return wt(r,n),S(n),r})}else{if(this.method==="POST"||this.method==="PUT"||this.method==="PATCH"||this.method==="DELETE"||this.method==="HEAD"||this.method==="OPTIONS")throw new Error(`${this.method} responses do not contain bodies`);w(this.method)}}async style(){let t=Re(_t(it),Qt("stylesheet"));document.head.append(t);let e=await this.htmlElement(t,"load",it);return g(e)}async getScript(){let t=Oe(_t(q));document.head.append(t);let e=await this.htmlElement(t,"load",q);return g(e)}async script(t){let e=null,n=this.request.path;if(!t)e=await this.getScript();else if(!t()){let r=Ue(t);e=await this.getScript(),await r}return this.prog&&this.prog.end(n),e}async module(){let t=this.request.path,e=await this.file(q),n=await import(e.content);return this.prog&&this.prog.end(t),g(e,()=>n)}async wasm(t){let e=await this.buffer(Jt);if(!Jt.matches(e.contentType))throw new Error(`Server did not respond with WASM file. Was: ${e.contentType}`);let n=await WebAssembly.compile(e.content),r=await WebAssembly.instantiate(n,t);return g(e,()=>r.exports)}async worker(t="module"){let e=this.request.path,n=await this.file(q);this.prog=null,this.request.timeout=null;let r=new Worker(n.content,{type:t});return this.prog&&this.prog.end(e),g(n,()=>r)}};var yt=class{constructor(t,e=!1){this.service=t,this.useBLOBs=e}clearCache(){return this.service.clearCache()}evict(t,e){return this.service.evict(new URL(t,e||location.href).href)}request(t,e,n){return new Vt(this.service,t,new URL(e,n||location.href),this.useBLOBs)}head(t,e){return this.request("HEAD",t,e)}options(t,e){return this.request("OPTIONS",t,e)}get(t,e){return this.request("GET",t,e)}post(t,e){return this.request("POST",t,e)}put(t,e){return this.request("PUT",t,e)}patch(t,e){return this.request("PATCH",t,e)}delete(t,e){return this.request("DELETE",t,e)}async assets(t,e,...n){m(n)&&(n=[]),n.unshift(e);let r;Fe(t)?n.unshift(t):c(t)&&(r=t),n=n.filter(c);let s=await Promise.all(n.map(p=>p.getSize(this))),i=new Map(s);await De(r,n.map(p=>[i.get(p),a=>p.fetch(this,a)]))}};var St=class{constructor(t){this.impl=t,this.defaultPostHeaders=new Map}setRequestVerificationToken(t){this.defaultPostHeaders.set("RequestVerificationToken",t)}clearCache(){return this.impl.clearCache()}evict(t){return this.impl.evict(t)}sendNothingGetNothing(t){return this.impl.sendNothingGetNothing(t)}sendNothingGetBlob(t,e){return this.impl.sendNothingGetSomething("blob",t,e)}sendObjectGetBlob(t,e){return this.impl.sendSomethingGetSomething("blob",t,this.defaultPostHeaders,e)}sendNothingGetBuffer(t,e){return this.impl.sendNothingGetSomething("arraybuffer",t,e)}sendObjectGetBuffer(t,e){return this.impl.sendSomethingGetSomething("arraybuffer",t,this.defaultPostHeaders,e)}sendNothingGetText(t,e){return this.impl.sendNothingGetSomething("text",t,e)}sendObjectGetText(t,e){return this.impl.sendSomethingGetSomething("text",t,this.defaultPostHeaders,e)}sendNothingGetObject(t,e){return this.impl.sendNothingGetSomething("json",t,e)}sendObjectGetObject(t,e){return this.impl.sendSomethingGetSomething("json",t,this.defaultPostHeaders,e)}sendObjectGetNothing(t,e){return this.impl.sendSomethingGetSomething("",t,this.defaultPostHeaders,e)}drawImageToCanvas(t,e,n){return this.impl.drawImageToCanvas(t,e,n)}async sendNothingGetFile(t,e){return g(await this.sendNothingGetBlob(t,e),URL.createObjectURL)}async sendObjectGetFile(t,e){return g(await this.sendObjectGetBlob(t,e),URL.createObjectURL)}async sendNothingGetXml(t,e){return g(await this.impl.sendNothingGetSomething("document",t,e),n=>n.documentElement)}async sendObjectGetXml(t,e){return g(await this.impl.sendSomethingGetSomething("document",t,this.defaultPostHeaders,e),n=>n.documentElement)}async sendNothingGetImageBitmap(t,e){return g(await this.sendNothingGetBlob(t,e),createImageBitmap)}async sendObjectGetImageBitmap(t,e){return g(await this.sendObjectGetBlob(t,e),createImageBitmap)}};function Je(o,t,e){return new Map(o.map(n=>[t(n),e(n)]))}function qe(o,t){return Je(o,t,rt)}var B=class{constructor(t){if(this.items=new Map,this.defaultItems=new Array,c(t))for(let[e,n]of t)this.add(e,n)}add(t,...e){for(let n of e)if(m(t))this.defaultItems.push(n);else{let r=this.items.get(t);m(r)&&this.items.set(t,r=[]),r.push(n)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let t of this.defaultItems)yield t;for(let t of this.items.values())for(let e of t)yield e}has(t){return c(t)?this.items.has(t):this.defaultItems.length>0}get(t){return m(t)?this.defaultItems:this.items.get(t)||[]}count(t){if(m(t))return this.defaultItems.length;let e=this.get(t);return c(e)?e.length:0}get size(){let t=this.defaultItems.length;for(let e of this.items.values())t+=e.length;return t}delete(t){return m(t)?P(this.defaultItems).length>0:this.items.delete(t)}remove(t,e){if(m(t))z(this.defaultItems,e);else{let n=this.items.get(t);c(n)&&(z(n,e),n.length===0&&this.items.delete(t))}}clear(){this.items.clear(),P(this.defaultItems)}};var N=class{constructor(t){if(this.items=new Map,c(t))for(let[e,n,r]of t)this.add(e,n,r)}add(t,e,n){let r=this.items.get(t);return m(r)&&this.items.set(t,r=new Map),r.set(e,n),this}*entries(){for(let[t,e]of this.items)for(let[n,r]of e)yield[t,n,r]}keys(t){return m(t)?this.items.keys():this.items.get(t).keys()}*values(){for(let t of this.items.values())for(let e of t.values())yield e}has(t,e){return this.items.has(t)&&(m(e)||this.items.get(t).has(e))}get(t,e){return m(e)?this.items.get(t):this.items.has(t)?this.items.get(t).get(e):null}count(t){return this.items.has(t)?this.items.get(t).size:null}get size(){let t=0;for(let e of this.items.values())t+=e.size;return t}delete(t,e){if(m(e))return this.items.delete(t);if(this.items.has(t)){let n=this.items.get(t),r=n.delete(e);return n.size===0&&this.items.delete(t),r}else return!1}clear(){this.items.clear()}};var kt=class o{static delete(t){let e=indexedDB.deleteDatabase(t),n=T(e,"success","error","blocked");return O(n)}static async open(t,...e){let n=qe(e,b=>b.name),r=new N(e.filter(b=>c(b.indexes)).flatMap(b=>b.indexes.map(X=>[b.name,X.name,X]))),s=new Array,i=new Array,p=new Array,a=new B,d=new B,l=null,h=indexedDB.open(t);if(await O(T(h,"success","error","blocked"))){let b=h.result;l=b.version;let X=new Array;for(let C of b.objectStoreNames)n.has(C)||i.push(C);for(let C of n.keys())b.objectStoreNames.contains(C)?X.push(C):s.push(C);if(X.length>0){let C=b.transaction(X),M=T(C,"complete","error","abort"),j=O(M);for(let f of X){let F=C.objectStore(f),he=n.get(f);c(he.options)&&F.keyPath!==he.options.keyPath&&(i.push(f),s.push(f));for(let R of F.indexNames)r.has(f,R)||(p.indexOf(f)===-1&&p.push(f),d.add(f,R));if(r.has(f))for(let R of r.get(f).keys())if(!F.indexNames.contains(R))p.indexOf(f)===-1&&p.push(f),a.add(f,R);else{let tt=r.get(f,R),et=F.index(R);(_(tt.keyPath)!==_(et.keyPath)||_(tt.keyPath)&&_(et.keyPath)&&tt.keyPath!==et.keyPath||I(tt.keyPath)&&I(et.keyPath)&&Ae(tt.keyPath,et.keyPath))&&(p.indexOf(f)===-1&&p.push(f),d.add(f,R),a.add(f,R))}}C.commit(),await j}S(b)}else{l=0,s.push(...n.keys());for(let b of e)if(c(b.indexes))for(let X of b.indexes)a.add(b.name,X.name)}(s.length>0||i.length>0||a.size>0||d.size>0)&&++l;let x=new V,u=c(l)?indexedDB.open(t,l):indexedDB.open(t),A=T(u,"success","error","blocked"),Y=O(x),Nt=O(A),fe=x.resolver(!1);if(u.addEventListener("success",fe),u.addEventListener("upgradeneeded",()=>{let b=T(u.transaction,"complete","error","abort"),X=u.result;for(let M of i)X.deleteObjectStore(M);let C=new Map;for(let M of s){let j=n.get(M),f=X.createObjectStore(M,j.options);C.set(M,f)}for(let M of p){let j=u.transaction.objectStore(M);C.set(M,j)}for(let[M,j]of C){for(let f of d.get(M))j.deleteIndex(f);for(let f of a.get(M)){let F=r.get(M,f);j.createIndex(f,F.keyPath,F.options)}}O(b).then(x.resolve).catch(x.reject).finally(()=>u.removeEventListener("success",fe))}),!await Y)throw x.error;if(!await Nt)throw A.error;return new o(u.result)}constructor(t){this.db=t}dispose(){S(this.db)}get name(){return this.db.name}get version(){return this.db.version}get storeNames(){return Array.from(this.db.objectStoreNames)}getStore(t){return new pe(this.db,t)}},pe=class{constructor(t,e){this.db=t,this.storeName=e}async request(t,e){let n=this.db.transaction(this.storeName,e),r=T(n,"complete","error"),s=n.objectStore(this.storeName),i=t(s),p=T(i,"success","error");if(!await O(p))throw n.abort(),p.error;if(n.commit(),!await O(r))throw r.error;return i.result}add(t,e){return this.request(n=>n.add(t,e),"readwrite")}clear(){return this.request(t=>t.clear(),"readwrite")}getCount(t){return this.request(e=>e.count(t),"readonly")}async has(t){return await this.getCount(t)>0}delete(t){return this.request(e=>e.delete(t),"readwrite")}get(t){return this.request(e=>e.get(t),"readonly")}getAll(){return this.request(t=>t.getAll(),"readonly")}getAllKeys(){return this.request(t=>t.getAllKeys(),"readonly")}getKey(t){return this.request(e=>e.getKey(t),"readonly")}openCursor(t,e){return this.request(n=>n.openCursor(t,e),"readonly")}openKeyCursor(t,e){return this.request(n=>n.openKeyCursor(t,e),"readonly")}put(t,e){return this.request(n=>n.put(t,e),"readwrite")}};function $e(o,...t){for(let e of t)if(c(e))for(let[n,r]of e)o.set(n,r);return o}var ae=class extends V{constructor(t){super(!1),this.milliseconds=t,this._timer=null}start(){super.start(),this._timer=setTimeout(()=>{this._timer=null,this.resolve()},this.milliseconds)}reset(){super.reset(),c(this._timer)&&(clearTimeout(this._timer),this._timer=null)}};function Ke(o){let t=new ae(o);return t.start(),t}function Ct(o,t){return async()=>{let e=null,n=500;for(let r=0;r<=o;++r)try{return r>0&&(await Ke(n),n*=2),await t()}catch(s){e=s}throw e}}function zo(o){return _(o)||ge(o)||o instanceof Blob||o instanceof FormData||ve(o)||"Document"in globalThis&&o instanceof Document}function Mt(o,t,e,n,r,s){let i=!s;s&&s.then(()=>i=!0);let p=!1,a=r,d=new V;e.addEventListener("loadstart",()=>{i&&!p&&n&&n.start(o)}),e.addEventListener("progress",h=>{if(i&&!p){let x=h;n&&n.report(x.loaded,Math.max(x.loaded,x.total),o),x.loaded===x.total&&(a=!0,p&&d.resolve())}}),e.addEventListener("load",()=>{i&&!p&&(n&&n.end(o),p=!0,a&&d.resolve())});let l=h=>()=>{i&&d.reject(`${h} (${t.status})`)};return e.addEventListener("error",l("error")),e.addEventListener("abort",l("abort")),e.addEventListener("timeout",l("timeout")),d}function ce(o,t,e,n,r,s){if(o.open(t,e),o.responseType="blob",o.timeout=n,r)for(let[i,p]of r)o.setRequestHeader(i,p);c(s)?o.send(s):o.send()}function Tt(o,t,e){if(!o.has(t))return null;let n=o.get(t);try{let r=e(n);return o.delete(t),r}catch(r){console.warn(t,r)}return null}var Uo=/filename=\"(.+)\"(;|$)/,Ho="Juniper:Fetcher:Cache",Xt=class{constructor(){this.cache=null,this.store=null,this.tasks=new N,this.cacheReady=this.openCache()}async drawImageToCanvas(t,e,n){let r=await this.sendNothingGetSomething("blob",t,n),s=r.content;return Ge(await createImageBitmap(s,{imageOrientation:"from-image"}),i=>(e.width=i.width,e.height=i.height,e.getContext("2d").drawImage(i,0,0),g(r)))}async openCache(){let t={keyPath:"requestPath"};this.cache=await kt.open(Ho,{name:"files",options:t}),this.store=await this.cache.getStore("files")}async clearCache(){await this.cacheReady,await this.store.clear()}async evict(t){await this.cacheReady,this.store.has(t)&&await this.store.delete(t)}async readResponseHeaders(t,e){let n=e.getAllResponseHeaders().split(/[\r\n]+/).map(x=>x.trim()).filter(x=>x.length>0).map(x=>{let u=x.split(": "),A=u.shift().toLowerCase(),Y=u.join(": ");return[A,Y]}),r=new B(n),s=Array.from(r.keys()).map(x=>[x,r.get(x).join(", ")]),i=new Map(s),p=Tt(i,"content-type",rt),a=Tt(i,"content-length",parseFloat),d=Tt(i,"date",x=>new Date(x)),l=Tt(i,"content-disposition",x=>{if(c(x)){let u=x.match(Uo);if(c(u))return u[1]}return null});return{status:e.status,requestPath:t,responsePath:e.responseURL,content:void 0,contentType:p,contentLength:a,fileName:l,date:d,headers:i}}async readResponse(t,e){let{responsePath:n,status:r,contentType:s,contentLength:i,fileName:p,date:a,headers:d}=await this.readResponseHeaders(t,e),l={requestPath:t,responsePath:n,status:r,contentType:s,contentLength:i,fileName:p,date:a,headers:d,content:e.response};return c(l.content)&&(l.contentType=l.contentType||l.content.type,l.contentLength=l.contentLength||l.content.size),l}async decodeContent(t,e){return g(e,async n=>{if(t==="")return null;if(m(e.contentType)){let r=Array.from(e.headers.entries()).map(s=>s.join(": ")).join(`
  `);throw new Error(`No content type found in headers: 
  `+r)}else{if(t==="blob")return n;if(t==="arraybuffer")return await n.arrayBuffer();if(t==="json"){let r=await n.text();return r.length>0?JSON.parse(r):null}else if(t==="document"){let r=new DOMParser;if(e.contentType==="application/xhtml+xml"||e.contentType==="text/html"||e.contentType==="application/xml"||e.contentType==="image/svg+xml"||e.contentType==="text/xml")return r.parseFromString(await n.text(),e.contentType);throw new Error("Couldn't parse document")}else{if(t==="text")return await n.text();w(t)}}})}async withCachedTask(t,e){return t.method!=="GET"&&t.method!=="HEAD"&&t.method!=="OPTIONS"?await e():(this.tasks.has(t.method,t.path)||this.tasks.add(t.method,t.path,e().finally(()=>this.tasks.delete(t.method,t.path))),this.tasks.get(t.method,t.path))}sendNothingGetNothing(t){return this.withCachedTask(t,Ct(t.retryCount,async()=>{let e=new XMLHttpRequest,n=Mt(`requesting: ${t.path}`,e,e,null,!0);return ce(e,t.method,t.path,t.timeout,t.headers),await n,await this.readResponseHeaders(t.path,e)}))}sendNothingGetSomething(t,e,n){return this.withCachedTask(e,Ct(e.retryCount,async()=>{let r=null,s=e.useCache&&e.method==="GET";s&&(c(n)&&n.start(),await this.cacheReady,r=await this.store.get(e.path));let i=m(r);if(i){let a=new XMLHttpRequest,d=Mt(`requesting: ${e.path}`,a,a,n,!0);ce(a,e.method,e.path,e.timeout,e.headers),await d,r=await this.readResponse(e.path,a),s&&await this.store.add(r)}let p=await this.decodeContent(t,r);return i&&c(n)&&n.end(),p}))}sendSomethingGetSomething(t,e,n,r){let s=null,i=$e(new Map,n,e.headers),p=null;if(c(i)){let u=new Array;for(let A of i.keys())A.toLowerCase()==="content-type"&&u.push(A);if(u.length>0){e.body instanceof FormData||(p=i.get(u[0]),u.shift());for(let A of u)i.delete(A)}}zo(e.body)&&!_(e.body)||_(e.body)&&xt.matches(p)?s=e.body:c(e.body)&&(s=JSON.stringify(e.body));let a=c(s),d=je(r,a?2:1),[l,h]=d,x=async()=>{let u=new XMLHttpRequest,A=a?Mt("uploading",u,u.upload,l,!1):Promise.resolve(),Y=Mt("saving",u,u,h,!0,A);ce(u,e.method,e.path,e.timeout,i,s),await A,await Y;let Nt=await this.readResponse(e.path,u);return await this.decodeContent(t,Nt)};return Ct(e.retryCount,x)()}};function le(o){return c(o)&&v(o.report)&&v(o.attach)&&v(o.end)}var Jo=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,It=navigator.userAgent.match(Jo),Pt=!!It,Ms=Pt&&{major:parseFloat(It[1]),minor:parseFloat(It[2]),patch:parseFloat(It[3])},Ts=Pt&&/pacific/i.test(navigator.userAgent),Xs=Pt&&/quest/i.test(navigator.userAgent),Is=Pt&&/quest 2/i.test(navigator.userAgent);var de="Worker"in globalThis;var Et=class extends D{constructor(t){super(),this.worker=t,this.invocations=new Map,this.tasks=new Array,this.taskCounter=0,de||console.warn("Workers are not supported on this system."),this.worker.addEventListener("message",e=>{let n=e.data;switch(n.type){case"event":this.propogateEvent(n);break;case"progress":this.progressReport(n);break;case"return":this.methodReturned(n);break;case"error":this.invocationError(n);break;default:w(n)}})}postMessage(t,e){t.type!=="methodCall"&&w(t.type),e?this.worker.postMessage(t,e):this.worker.postMessage(t)}dispose(){this.worker.terminate()}progressReport(t){let e=this.invocations.get(t.taskID);if(e){let{prog:n}=e;n&&n.report(t.soFar,t.total,t.msg,t.est)}}methodReturned(t){let e=this.removeInvocation(t.taskID),{task:n}=e;n.resolve(t.returnValue)}invocationError(t){let e=this.removeInvocation(t.taskID),{task:n,methodName:r}=e;n.reject(new Error(`${r} failed. Reason: ${t.errorMessage}`))}removeInvocation(t){let e=this.invocations.get(t);return this.invocations.delete(t),e}callMethod(t,e,n,r){if(!de)return Promise.reject(new Error("Workers are not supported on this system."));let s=null,i=null;le(e)&&(r=e,e=null,n=null),le(n)&&!r&&(r=n,n=null),I(e)&&(s=e),I(n)&&(i=n);let p=this.taskCounter++,a=be(this.tasks,h=>h.finished);a?a.reset():(a=new V,this.tasks.push(a));let d={methodName:t,task:a,prog:r};this.invocations.set(p,d);let l=null;return c(e)?l={type:"methodCall",taskID:p,methodName:t,params:s}:l={type:"methodCall",taskID:p,methodName:t},this.postMessage(l,i),a}};var Rt=class extends D{constructor(t,e){super(),this.scriptPath=t.scriptPath;let n=-1,r=t.workers,s=null;if(E(r)?n=r:c(r)?(this.taskCounter=r.curTaskCounter,s=r.workers,n=s.length):n=navigator.hardwareConcurrency||4,n<1)throw new Error("Worker pool size must be a postive integer greater than 0");if(this.workers=new Array(n),m(s)){this.taskCounter=0;for(let i=0;i<n;++i)this.workers[i]=new e(new Worker(this.scriptPath,{type:"module"}))}else for(let i=0;i<n;++i)this.workers[i]=new e(s[i]);for(let i of this.workers)i.addBubbler(this)}dispose(){this.workers.forEach(S),P(this.workers)}nextWorker(){let t=this.peekWorker();return this.taskCounter++,t}peekWorker(){return this.workers[this.taskCounter%this.workers.length]}};function qo(o){return o==="application/xhtml+xml"||o==="application/xml"||o==="image/svg+xml"||o==="text/html"||o==="text/xml"}function Qe(o){let{status:t,requestPath:e,responsePath:n,content:r,contentType:s,contentLength:i,fileName:p,headers:a,date:d}=o;if(!qo(s))throw new Error(`Content-Type ${s} is not one supported by the DOM parser.`);let h=new TextDecoder().decode(r),u=new DOMParser().parseFromString(h,s);return{status:t,requestPath:e,responsePath:n,content:u.documentElement,contentType:s,contentLength:i,fileName:p,date:d,headers:a}}function Ze(o){let{status:t,requestPath:e,responsePath:n,content:r,contentType:s,contentLength:i,fileName:p,headers:a,date:d}=o,l=new Blob([r],{type:s});return{status:t,requestPath:e,responsePath:n,content:l,contentType:s,contentLength:i,fileName:p,date:d,headers:a}}function Ye(o){return o={method:o.method,path:o.path,timeout:o.timeout,headers:o.headers,withCredentials:o.withCredentials,useCache:o.useCache,retryCount:o.retryCount},o}function $o(o){return o={method:o.method,path:o.path,body:o.body,timeout:o.timeout,headers:o.headers,withCredentials:o.withCredentials,useCache:o.useCache,retryCount:o.retryCount},o}var Ot=class extends Et{setRequestVerificationToken(t){this.callMethod("setRequestVerificationToken",[t])}clearCache(){return this.callMethod("clearCache")}evict(t){return this.callMethod("evict",[t])}propogateEvent(t){}makeRequest(t,e,n){return this.callMethod(t,[Ye(e)],n)}makeRequestWithBody(t,e,n){return this.callMethod(t,[$o(e)],n)}sendNothingGetNothing(t){return this.makeRequest("sendNothingGetNothing",t,null)}sendNothingGetBuffer(t,e){return this.makeRequest("sendNothingGetBuffer",t,e)}sendNothingGetText(t,e){return this.makeRequest("sendNothingGetText",t,e)}sendNothingGetObject(t,e){return this.makeRequest("sendNothingGetObject",t,e)}sendNothingGetFile(t,e){return this.makeRequest("sendNothingGetFile",t,e)}sendNothingGetImageBitmap(t,e){return this.makeRequest("sendNothingGetImageBitmap",t,e)}sendObjectGetNothing(t,e){return this.makeRequestWithBody("sendObjectGetNothing",t,e)}sendObjectGetBuffer(t,e){return this.makeRequestWithBody("sendObjectGetBuffer",t,e)}sendObjectGetText(t,e){return this.makeRequestWithBody("sendObjectGetText",t,e)}sendObjectGetObject(t,e){return this.makeRequestWithBody("sendObjectGetObject",t,e)}sendObjectGetFile(t,e){return this.makeRequestWithBody("sendObjectGetFile",t,e)}sendObjectGetImageBitmap(t,e){return this.makeRequestWithBody("sendObjectGetImageBitmap",t,e)}drawImageToCanvas(t,e,n){return this.callMethod("drawImageToCanvas",[Ye(t),e],[e],n)}sendNothingGetBlob(t,e){return this.sendNothingGetBuffer(t,e).then(Ze)}sendNothingGetXml(t,e){return this.sendNothingGetBuffer(t,e).then(Qe)}sendObjectGetBlob(t,e){return this.sendObjectGetBuffer(t,e).then(Ze)}sendObjectGetXml(t,e){return this.sendObjectGetBuffer(t,e).then(Qe)}};var jt=class extends Rt{constructor(t,e){super(t,Ot),this.fetcher=e}getFetcher(t){return t instanceof FormData?this.fetcher:this.nextWorker()}setRequestVerificationToken(t){this.fetcher.setRequestVerificationToken(t);for(let e of this.workers)e.setRequestVerificationToken(t)}async clearCache(){await Promise.all(this.workers.map(t=>t.clearCache()))}async evict(t){await Promise.all(this.workers.map(e=>e.evict(t)))}sendNothingGetNothing(t){return this.nextWorker().sendNothingGetNothing(t)}sendNothingGetBlob(t,e){return this.nextWorker().sendNothingGetBlob(t,e)}sendNothingGetBuffer(t,e){return this.nextWorker().sendNothingGetBuffer(t,e)}sendNothingGetFile(t,e){return this.nextWorker().sendNothingGetFile(t,e)}sendNothingGetText(t,e){return this.nextWorker().sendNothingGetText(t,e)}sendNothingGetObject(t,e){return this.nextWorker().sendNothingGetObject(t,e)}sendNothingGetXml(t,e){return this.nextWorker().sendNothingGetXml(t,e)}sendNothingGetImageBitmap(t,e){return this.nextWorker().sendNothingGetImageBitmap(t,e)}drawImageToCanvas(t,e,n){return this.nextWorker().drawImageToCanvas(t,e,n)}sendObjectGetBlob(t,e){return this.getFetcher(t.body).sendObjectGetBlob(t,e)}sendObjectGetBuffer(t,e){return this.getFetcher(t.body).sendObjectGetBuffer(t,e)}sendObjectGetFile(t,e){return this.getFetcher(t.body).sendObjectGetFile(t,e)}sendObjectGetText(t,e){return this.getFetcher(t.body).sendObjectGetText(t,e)}sendObjectGetNothing(t,e){return this.getFetcher(t.body).sendObjectGetNothing(t,e)}sendObjectGetObject(t,e){return this.getFetcher(t.body).sendObjectGetObject(t,e)}sendObjectGetXml(t,e){return this.getFetcher(t.body).sendObjectGetXml(t,e)}sendObjectGetImageBitmap(t,e){return this.getFetcher(t.body).sendObjectGetImageBitmap(t,e)}};var to=new URL(globalThis.location.href),ct=to.searchParams.has("DEBUG")&&!to.searchParams.has("RELEASE");function Dt(o,t){let e=globalThis,n=e[o];if(m(n)){if(m(t))throw new Error(`No value ${o} found`);n=t(),e[o]=n}return n}var cp=Dt("juniper::loadedFonts",()=>[]);var eo="3.7.24";var Qo=ct?Kt(10):eo;var Zo=50,Yo=12,Ip=Zo*Yo;var oo={fontFamily:"Lato",fontSize:20};var Pp=ft(30,67,136),Ep=ft(78,77,77),no={fontFamily:oo.fontFamily,fontSize:oo.fontSize,textFillColor:"white"},Rp=Object.assign({},no,{bgFillColor:ft(0,120,215),bgStrokeColor:"black",bgStrokeSize:.02,padding:{top:.025,left:.05,bottom:.025,right:.05},minHeight:.2,maxHeight:.2,scale:300}),Op=Object.assign({},no,{textStrokeColor:"black",textStrokeSize:.01,minHeight:.25,maxHeight:.25});var tn=ct?".js":".min.js";function en(o,t){return`/js/${t}/index${o}?v=${Qo}`}function on(o){return en(tn,o)}function ro(o){return on("workers/"+o)}function io(o=!0){let t=new St(new Xt);return o&&(t=new jt({scriptPath:ro("fetcher")},t)),new yt(t,!ct)}var L=Math.PI,lt=.5*L,rn=2*L;var sn=864e13,Up=-sn;function Bt(o){return o*rn/360}function so(o,t,e){let n=t.map(()=>1),r=at(o,n);return Promise.all(t.map(async(s,i)=>{let p=r[i];p.start();let a=await e(s,p,i);return p.end(),a}))}var{ACESFilmicToneMapping:$p,AddEquation:Kp,AddOperation:Qp,AdditiveAnimationBlendMode:Zp,AdditiveBlending:Yp,AlphaFormat:ta,AlwaysDepth:ea,AlwaysStencilFunc:oa,AmbientLight:po,AmbientLightProbe:na,AnimationClip:ra,AnimationLoader:ia,AnimationMixer:sa,AnimationObjectGroup:pa,AnimationUtils:aa,ArcCurve:ca,ArrayCamera:la,ArrowHelper:da,Audio:ma,AudioAnalyser:xa,AudioContext:ua,AudioListener:_a,AudioLoader:fa,AxesHelper:ha,BackSide:ga,BasicDepthPacking:va,BasicShadowMap:Aa,Bone:ba,BooleanKeyframeTrack:wa,Box2:Va,Box3:ya,Box3Helper:Sa,BoxBufferGeometry:ka,BoxGeometry:Ca,BoxHelper:Ma,BufferAttribute:Ta,BufferGeometry:Xa,BufferGeometryLoader:Ia,ByteType:Pa,Cache:Ea,Camera:Ra,CameraHelper:Oa,CanvasTexture:ja,CapsuleBufferGeometry:Da,CapsuleGeometry:Ba,CatmullRomCurve3:La,CineonToneMapping:Fa,CircleBufferGeometry:Ga,CircleGeometry:Na,ClampToEdgeWrapping:Wa,Clock:za,Color:ao,ColorKeyframeTrack:Ua,ColorManagement:Ha,CompressedArrayTexture:Ja,CompressedTexture:qa,CompressedTextureLoader:$a,ConeBufferGeometry:Ka,ConeGeometry:Qa,CubeCamera:pn,CubeReflectionMapping:Za,CubeRefractionMapping:Ya,CubeTexture:an,CubeTextureLoader:tc,CubeUVReflectionMapping:ec,CubicBezierCurve:oc,CubicBezierCurve3:nc,CubicInterpolant:rc,CullFaceBack:ic,CullFaceFront:sc,CullFaceFrontBack:pc,CullFaceNone:ac,Curve:cc,CurvePath:lc,CustomBlending:dc,CustomToneMapping:mc,CylinderBufferGeometry:xc,CylinderGeometry:uc,Cylindrical:_c,Data3DTexture:fc,DataArrayTexture:hc,DataTexture:gc,DataTextureLoader:vc,DataUtils:Ac,DecrementStencilOp:bc,DecrementWrapStencilOp:wc,DefaultLoadingManager:Vc,DepthFormat:yc,DepthStencilFormat:Sc,DepthTexture:kc,DirectionalLight:Cc,DirectionalLightHelper:Mc,DiscreteInterpolant:Tc,DisplayP3ColorSpace:Xc,DodecahedronBufferGeometry:Ic,DodecahedronGeometry:Pc,DoubleSide:co,DstAlphaFactor:Ec,DstColorFactor:Rc,DynamicCopyUsage:Oc,DynamicDrawUsage:jc,DynamicReadUsage:Dc,EdgesGeometry:Bc,EllipseCurve:Lc,EqualDepth:Fc,EqualStencilFunc:Gc,EquirectangularReflectionMapping:Nc,EquirectangularRefractionMapping:Wc,Euler:lo,EventDispatcher:zc,ExtrudeBufferGeometry:Uc,ExtrudeGeometry:Hc,FileLoader:Jc,Float16BufferAttribute:qc,Float32BufferAttribute:$c,Float64BufferAttribute:Kc,FloatType:Qc,Fog:Zc,FogExp2:Yc,FramebufferTexture:tl,FrontSide:el,Frustum:ol,GLBufferAttribute:nl,GLSL1:rl,GLSL3:il,GreaterDepth:sl,GreaterEqualDepth:pl,GreaterEqualStencilFunc:al,GreaterStencilFunc:cl,GridHelper:ll,Group:mo,HalfFloatType:dl,HemisphereLight:ml,HemisphereLightHelper:xl,HemisphereLightProbe:ul,IcosahedronBufferGeometry:_l,IcosahedronGeometry:fl,ImageBitmapLoader:hl,ImageLoader:gl,ImageUtils:vl,IncrementStencilOp:Al,IncrementWrapStencilOp:bl,InstancedBufferAttribute:wl,InstancedBufferGeometry:Vl,InstancedInterleavedBuffer:yl,InstancedMesh:Sl,Int16BufferAttribute:kl,Int32BufferAttribute:Cl,Int8BufferAttribute:Ml,IntType:Tl,InterleavedBuffer:Xl,InterleavedBufferAttribute:Il,Interpolant:Pl,InterpolateDiscrete:El,InterpolateLinear:Rl,InterpolateSmooth:Ol,InvertStencilOp:jl,KeepStencilOp:Dl,KeyframeTrack:Bl,LOD:Ll,LatheBufferGeometry:Fl,LatheGeometry:Gl,Layers:Nl,LessDepth:Wl,LessEqualDepth:zl,LessEqualStencilFunc:Ul,LessStencilFunc:Hl,Light:Jl,LightProbe:ql,Line:$l,Line3:Kl,LineBasicMaterial:Ql,LineCurve:Zl,LineCurve3:Yl,LineDashedMaterial:td,LineLoop:ed,LineSegments:od,LinearEncoding:nd,LinearFilter:rd,LinearInterpolant:id,LinearMipMapLinearFilter:sd,LinearMipMapNearestFilter:pd,LinearMipmapLinearFilter:ad,LinearMipmapNearestFilter:cd,LinearSRGBColorSpace:ld,LinearToneMapping:dd,Loader:md,LoaderUtils:xd,LoadingManager:ud,LoopOnce:_d,LoopPingPong:fd,LoopRepeat:hd,LuminanceAlphaFormat:gd,LuminanceFormat:vd,MOUSE:Ad,Material:bd,MaterialLoader:wd,MathUtils:Vd,Matrix3:yd,Matrix4:Sd,MaxEquation:kd,Mesh:xo,MeshBasicMaterial:uo,MeshDepthMaterial:Cd,MeshDistanceMaterial:Md,MeshLambertMaterial:Td,MeshMatcapMaterial:Xd,MeshNormalMaterial:Id,MeshPhongMaterial:Pd,MeshPhysicalMaterial:Ed,MeshStandardMaterial:Rd,MeshToonMaterial:Od,MinEquation:jd,MirroredRepeatWrapping:Dd,MixOperation:Bd,MultiplyBlending:Ld,MultiplyOperation:Fd,NearestFilter:Gd,NearestMipMapLinearFilter:Nd,NearestMipMapNearestFilter:Wd,NearestMipmapLinearFilter:zd,NearestMipmapNearestFilter:Ud,NeverDepth:Hd,NeverStencilFunc:Jd,NoBlending:qd,NoColorSpace:$d,NoToneMapping:Kd,NormalAnimationBlendMode:Qd,NormalBlending:Zd,NotEqualDepth:Yd,NotEqualStencilFunc:tm,NumberKeyframeTrack:em,Object3D:cn,ObjectLoader:om,ObjectSpaceNormalMap:nm,OctahedronBufferGeometry:rm,OctahedronGeometry:im,OneFactor:sm,OneMinusDstAlphaFactor:pm,OneMinusDstColorFactor:am,OneMinusSrcAlphaFactor:cm,OneMinusSrcColorFactor:lm,OrthographicCamera:dm,PCFShadowMap:mm,PCFSoftShadowMap:xm,PMREMGenerator:um,Path:_m,PerspectiveCamera:_o,Plane:fm,PlaneBufferGeometry:hm,PlaneGeometry:fo,PlaneHelper:gm,PointLight:vm,PointLightHelper:Am,Points:bm,PointsMaterial:wm,PolarGridHelper:Vm,PolyhedronBufferGeometry:ym,PolyhedronGeometry:Sm,PositionalAudio:km,PropertyBinding:Cm,PropertyMixer:Mm,QuadraticBezierCurve:Tm,QuadraticBezierCurve3:Xm,Quaternion:ln,QuaternionKeyframeTrack:Im,QuaternionLinearInterpolant:Pm,RED_GREEN_RGTC2_Format:Em,RED_RGTC1_Format:Rm,REVISION:Om,RGBADepthPacking:jm,RGBAFormat:Dm,RGBAIntegerFormat:Bm,RGBA_ASTC_10x10_Format:Lm,RGBA_ASTC_10x5_Format:Fm,RGBA_ASTC_10x6_Format:Gm,RGBA_ASTC_10x8_Format:Nm,RGBA_ASTC_12x10_Format:Wm,RGBA_ASTC_12x12_Format:zm,RGBA_ASTC_4x4_Format:Um,RGBA_ASTC_5x4_Format:Hm,RGBA_ASTC_5x5_Format:Jm,RGBA_ASTC_6x5_Format:qm,RGBA_ASTC_6x6_Format:$m,RGBA_ASTC_8x5_Format:Km,RGBA_ASTC_8x6_Format:Qm,RGBA_ASTC_8x8_Format:Zm,RGBA_BPTC_Format:Ym,RGBA_ETC2_EAC_Format:tx,RGBA_PVRTC_2BPPV1_Format:ex,RGBA_PVRTC_4BPPV1_Format:ox,RGBA_S3TC_DXT1_Format:nx,RGBA_S3TC_DXT3_Format:rx,RGBA_S3TC_DXT5_Format:ix,RGB_ETC1_Format:sx,RGB_ETC2_Format:px,RGB_PVRTC_2BPPV1_Format:ax,RGB_PVRTC_4BPPV1_Format:cx,RGB_S3TC_DXT1_Format:lx,RGFormat:dx,RGIntegerFormat:mx,RawShaderMaterial:xx,Ray:ux,Raycaster:_x,RectAreaLight:fx,RedFormat:hx,RedIntegerFormat:gx,ReinhardToneMapping:vx,RepeatWrapping:Ax,ReplaceStencilOp:bx,ReverseSubtractEquation:wx,RingBufferGeometry:Vx,RingGeometry:yx,SIGNED_RED_GREEN_RGTC2_Format:Sx,SIGNED_RED_RGTC1_Format:kx,SRGBColorSpace:Cx,Scene:me,ShaderChunk:Mx,ShaderLib:Tx,ShaderMaterial:Xx,ShadowMaterial:Ix,Shape:Px,ShapeBufferGeometry:Ex,ShapeGeometry:Rx,ShapePath:Ox,ShapeUtils:jx,ShortType:Dx,Skeleton:Bx,SkeletonHelper:Lx,SkinnedMesh:Fx,Source:Gx,Sphere:Nx,SphereBufferGeometry:Wx,SphereGeometry:zx,Spherical:Ux,SphericalHarmonics3:Hx,SplineCurve:Jx,SpotLight:qx,SpotLightHelper:$x,Sprite:Kx,SpriteMaterial:Qx,SrcAlphaFactor:Zx,SrcAlphaSaturateFactor:Yx,SrcColorFactor:tu,StaticCopyUsage:eu,StaticDrawUsage:ou,StaticReadUsage:nu,StereoCamera:ru,StreamCopyUsage:iu,StreamDrawUsage:su,StreamReadUsage:pu,StringKeyframeTrack:au,SubtractEquation:cu,SubtractiveBlending:lu,TOUCH:du,TangentSpaceNormalMap:mu,TetrahedronBufferGeometry:xu,TetrahedronGeometry:uu,Texture:ho,TextureLoader:_u,TorusBufferGeometry:fu,TorusGeometry:hu,TorusKnotBufferGeometry:gu,TorusKnotGeometry:vu,Triangle:Au,TriangleFanDrawMode:bu,TriangleStripDrawMode:wu,TrianglesDrawMode:Vu,TubeBufferGeometry:yu,TubeGeometry:Su,TwoPassDoubleSide:ku,UVMapping:Cu,Uint16BufferAttribute:Mu,Uint32BufferAttribute:Tu,Uint8BufferAttribute:Xu,Uint8ClampedBufferAttribute:Iu,Uniform:Pu,UniformsGroup:Eu,UniformsLib:Ru,UniformsUtils:Ou,UnsignedByteType:ju,UnsignedInt248Type:Du,UnsignedIntType:Bu,UnsignedShort4444Type:Lu,UnsignedShort5551Type:Fu,UnsignedShortType:Gu,VSMShadowMap:Nu,Vector2:Wu,Vector3:go,Vector4:zu,VectorKeyframeTrack:Uu,VideoTexture:Hu,WebGL1Renderer:Ju,WebGL3DRenderTarget:qu,WebGLArrayRenderTarget:$u,WebGLCubeRenderTarget:dn,WebGLMultipleRenderTargets:Ku,WebGLRenderTarget:Qu,WebGLRenderer:vo,WebGLUtils:Zu,WireframeGeometry:Yu,WrapAroundEnding:t_,ZeroCurvatureEnding:e_,ZeroFactor:o_,ZeroSlopeEnding:n_,ZeroStencilOp:r_,_SRGBAFormat:i_,sRGBEncoding:s_}=THREE;function Ao(o){return c(o)&&o.isObject3D}function mn(o){return c(o)&&Ao(o.object)}function xe(o){return mn(o)?o.object:o}function ue(o,...t){let e=t.filter(c).map(xe);return e.length>0&&xe(o).add(...e),o}function bo(o,t,e){let n=new xo(t,e);return n.name=o,n}var wo=Dt("Juniper:ScaledItems",()=>new Map);function Vo(o){let t=wo.get(o);t&&(wo.delete(o),S(t))}function Lt(o){let t=new Array,e=new Set;for(t.push(o);t.length>0;){let n=t.shift();n&&!e.has(n)&&(e.add(n),n.isMesh&&t.push(n.material,n.geometry),n.isMaterial&&t.push(...Object.values(n)),n.isObject3D&&(t.push(...n.children),n.clear(),Vo(n)),I(n)&&t.push(...n),ie(n))}e.clear()}var k;(function(o){o[o.None=-1]="None",o[o.Left=0]="Left",o[o.Right=1]="Right",o[o.Up=2]="Up",o[o.Down=3]="Down",o[o.Back=4]="Back",o[o.Front=5]="Front"})(k||(k={}));var G_=new go(0,1,0),xn=2048,N_=xn/2;var yo={rows:3,columns:4,indices:[[k.None,k.Up,k.None,k.None],[k.Left,k.Front,k.Right,k.Back],[k.None,k.Down,k.None,k.None]],rotations:[[0,L,0,0],[0,0,0,0],[0,L,0,0]]},W_=new ao(0);var dt=2,$=2048,K=new lo,Q;(function(o){o[o.Low=90]="Low",o[o.Medium=60]="Medium",o[o.High=45]="High",o[o.Fine=30]="Fine"})(Q||(Q={}));var un=new Map([[Q.Low,4],[Q.Medium,8],[Q.High,3],[Q.Fine,2]]),So=[[lt,0,0,1],[-lt,0,2,1],[0,lt,1,0],[0,-lt,1,2],[L,0,3,1],[0,0,1,1]],Ft=class{constructor(t,e){this.fetcher=t,this.fixWatermarks=e,this.baseURL=null,this.isDebug=!1,this.disposed=!1,this.canvas=bt($,$),this.renderer=new vo({canvas:this.canvas,alpha:!1,antialias:!1,depth:!0,logarithmicDepthBuffer:!1,powerPreference:"low-power",precision:"lowp",stencil:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1}),this.camera=new _o(90),this.photosphere=new mo,this.scene=ue(new me,new po(16777215,1),this.camera,this.photosphere),this.geometry=new fo(1,1,1,1)}init(t,e){this.baseURL=t,this.isDebug=e}dispose(){this.disposed||(this.disposed=!0,this.onDisposing())}onDisposing(){for(let t of this.scene.children)Lt(t);S(this.renderer)}async renderFaces(t,e,n){this.clear(),await this.loadFrames(e,n,t);let r=await Promise.all(So.map(async([s,i,p,a])=>{let d=yo.rotations[a][p];K.set(i,s,d,"YXZ"),this.camera.setRotationFromEuler(K),this.renderer.render(this.scene,this.camera);let l=await re(this.renderer.domElement,qt.value,1);return URL.createObjectURL(l)}));return this.clear(),r}async renderCubeMap(t,e,n){this.clear();let r=bt($*4,$*3),s=r.getContext("2d",{alpha:!1});await this.loadFrames(e,n,t);for(let[a,d,l,h]of So)K.set(d,a,0,"YXZ"),this.camera.setRotationFromEuler(K),this.renderer.render(this.scene,this.camera),s.drawImage(this.renderer.domElement,l*$,h*$);let i=await re(r,qt.value,1),p=URL.createObjectURL(i);return this.clear(),p}getImageAngles(t){let e=new Array,n=t,r=this.fixWatermarks?un.get(n):0;for(let s=-90+n;s<90;s+=n)for(let i=-180;i<180;i+=n)e.push([i,s,n+r,dt]);return e.push([0,-90,n+r,dt]),e.push([0,90,n+r,dt]),this.fixWatermarks&&(e.push([0,-90,n,.5*dt]),e.push([0,90,n,.5*dt])),e}async loadFrames(t,e,n){let r=this.getImageAngles(t);await so(e,r,(s,i)=>this.loadFrame(n,...s,i))}async loadFrame(t,e,n,r,s,i){let p=.5*Bt(r),a=Math.tan(p),d=.5*s/a,l=t(r,e,n),h=await this.fetcher.get(l,this.baseURL).progress(i).useCache(!this.isDebug).canvas().then(At),x=new ho(h),u=new uo({map:x,side:co}),A=bo(`frame-${r}-${e}-${n}`,this.geometry,u);x.needsUpdate=!0,u.needsUpdate=!0,K.set(Bt(n),-Bt(e),0,"YXZ"),A.scale.setScalar(s),A.quaternion.setFromEuler(K),A.position.set(0,0,-d).applyQuaternion(A.quaternion),ue(this.photosphere,A)}clear(){for(let t of this.photosphere.children)Lt(t);this.photosphere.clear()}};function ko(o,t,e,n){return`/Editor/Google/StreetView/Image/${o}/${t}/${e}/${n}/`}var Gt=class extends Ft{constructor(t){super(t,!0)}loadFiles(t,e,n){return this.renderFaces(ko.bind(null,t),e,n)}loadFile(t,e,n){return this.renderCubeMap(ko.bind(null,t),e,n)}async loadImages(t,e,n){let r=await this.loadFiles(t,e,n);return await Promise.all(r.map(ne))}async loadCanvas(t,e,n){let r=await this.loadFile(t,e,n),s=await ne(r);return ze(s)}};var _e=new mt(self),_n=io(!1),Z=new Gt(_n);_e.addVoidMethod(Z,"init",Z.init);_e.addMethod(Z,"loadFile",Z.loadFile);_e.addMethod(Z,"loadFiles",Z.loadFiles);
