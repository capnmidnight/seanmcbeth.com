var Rt=Object.defineProperty;var Dt=(e,t)=>{for(var o in t)Rt(e,o,{get:t[o],enumerable:!0})};function Q(e,t,o){return typeof e===t||e instanceof o}function v(e){return Q(e,"function",Function)}function m(e){return Q(e,"string",String)}function L(e){return l(e)&&Q(e,"object",Object)}function u(e){return e==null}function l(e){return!u(e)}var lt=new Map,I=class{constructor(t,o,n,...r){this.key=t;this.value=o;this.bySetAttribute=n;this.tags=r.map(s=>s.toLocaleUpperCase()),Object.freeze(this)}tags;applyToElement(t){if(this.tags.length>0&&this.tags.indexOf(t.tagName)===-1){let o=lt.get(t.tagName);o||lt.set(t.tagName,o=new Set),o.has(this.key)||(o.add(this.key),console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`))}this.bySetAttribute?t.setAttribute(this.key,this.value.toString()):this.key in t?t[this.key]=this.value:this.value===!1?t.removeAttribute(this.key):this.value===!0?t.setAttribute(this.key,""):v(this.value)?this.value(t):t.setAttribute(this.key,this.value.toString())}};function tt(e,t,o,...n){return new I(e,t,o,...n)}function mt(e){return e instanceof I}function xt(e){return tt("height",e,!1,"canvas","embed","iframe","img","input","object","video")}function ut(e){return tt("id",e,!1)}function _t(e){return tt("width",e,!1,"canvas","embed","iframe","img","input","object","video")}function j(e){return e.splice(0)}function ot(e,t){let o=e.indexOf(t);return o>-1?(ft(e,o),!0):!1}function ft(e,t){return e.splice(t,1)[0]}var nt=class{constructor(t=!0){this.autoStart=t,this.onThens=new Array,this.onCatches=new Array,this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",this.resolve=o=>{if(this.running){this._result=o,this._resultState="resolved";for(let n of this.onThens)n(o);this.clear(),this._executionState="finished"}},this.reject=o=>{if(this.running){this._error=o,this._resultState="errored";for(let n of this.onCatches)n(o);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){j(this.onThens),j(this.onCatches)}start(){this._executionState="running"}resolver(t){return()=>this.resolve(t)}resolveOn(t,o,n){let r=this.resolver(n);t.addEventListener(o,r),this.finally(()=>t.removeEventListener(o,r))}get result(){if(l(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((t,o)=>{this.finished?this.errored?o(this.error):t(this.result):(this.onThens.push(t),this.onCatches.push(o))})}then(t,o){return this.project().then(t,o)}catch(t){return this.project().catch(t)}finally(t){return this.project().finally(t)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(t){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",t&&this.start()}};function gt(e){return L(e)?e.element instanceof Element:!1}function Ot(e){return gt(e)?e.element:m(e)?Ft(e):e}function Bt(e){return L(e)&&"applyToElement"in e&&v(e.applyToElement)}function Gt(e,...t){let o=e instanceof Element||e instanceof ShadowRoot?e:m(e)?document.querySelector(e):e.element,n=o instanceof HTMLTemplateElement?o.content:o;for(let r of t)l(r)&&(r instanceof Node?n.appendChild(r):gt(r)?n.appendChild(Ot(r)):Bt(r)?o instanceof ShadowRoot||r.applyToElement(o):n.appendChild(document.createTextNode(r.toLocaleString())));return o}function Ft(e){return document.querySelector(e)}function zt(e,...t){let o=null,n=t.filter(mt).filter(r=>r.key==="id"||r.key==="query");for(let r of n)r.key==="query"?(o=r.value,ot(t,r)):r.key==="id"&&(o=document.getElementById(r.value),o&&ot(t,r));return o&&o.tagName!==e.toUpperCase()&&console.warn(`Expected a "${e.toUpperCase()}" element but found a "${o.tagName}".`),o||(o=document.createElement(e)),Gt(o,...t),o}function R(...e){return zt("canvas",...e)}var rt=1e-6,S=typeof Float32Array<"u"?Float32Array:Array,vt=Math.random;var bn=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var i={};Dt(i,{add:()=>$t,angle:()=>ue,ceil:()=>Ut,clone:()=>Wt,copy:()=>qt,create:()=>At,cross:()=>se,dist:()=>Ce,distance:()=>Ct,div:()=>Ve,divide:()=>Vt,dot:()=>ie,equals:()=>ve,exactEquals:()=>ge,floor:()=>Kt,forEach:()=>Se,fromValues:()=>Nt,inverse:()=>ne,len:()=>Ae,length:()=>wt,lerp:()=>pe,max:()=>Zt,min:()=>Yt,mul:()=>be,multiply:()=>bt,negate:()=>oe,normalize:()=>re,random:()=>ae,rotate:()=>xe,round:()=>Qt,scale:()=>te,scaleAndAdd:()=>ee,set:()=>Jt,sqrDist:()=>ye,sqrLen:()=>we,squaredDistance:()=>yt,squaredLength:()=>St,str:()=>fe,sub:()=>he,subtract:()=>ht,transformMat2:()=>ce,transformMat2d:()=>le,transformMat3:()=>de,transformMat4:()=>me,zero:()=>_e});function At(){var e=new S(2);return S!=Float32Array&&(e[0]=0,e[1]=0),e}function Wt(e){var t=new S(2);return t[0]=e[0],t[1]=e[1],t}function Nt(e,t){var o=new S(2);return o[0]=e,o[1]=t,o}function qt(e,t){return e[0]=t[0],e[1]=t[1],e}function Jt(e,t,o){return e[0]=t,e[1]=o,e}function $t(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e}function ht(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e}function bt(e,t,o){return e[0]=t[0]*o[0],e[1]=t[1]*o[1],e}function Vt(e,t,o){return e[0]=t[0]/o[0],e[1]=t[1]/o[1],e}function Ut(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Kt(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Yt(e,t,o){return e[0]=Math.min(t[0],o[0]),e[1]=Math.min(t[1],o[1]),e}function Zt(e,t,o){return e[0]=Math.max(t[0],o[0]),e[1]=Math.max(t[1],o[1]),e}function Qt(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function te(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e}function ee(e,t,o,n){return e[0]=t[0]+o[0]*n,e[1]=t[1]+o[1]*n,e}function Ct(e,t){var o=t[0]-e[0],n=t[1]-e[1];return Math.hypot(o,n)}function yt(e,t){var o=t[0]-e[0],n=t[1]-e[1];return o*o+n*n}function wt(e){var t=e[0],o=e[1];return Math.hypot(t,o)}function St(e){var t=e[0],o=e[1];return t*t+o*o}function oe(e,t){return e[0]=-t[0],e[1]=-t[1],e}function ne(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function re(e,t){var o=t[0],n=t[1],r=o*o+n*n;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e}function ie(e,t){return e[0]*t[0]+e[1]*t[1]}function se(e,t,o){var n=t[0]*o[1]-t[1]*o[0];return e[0]=e[1]=0,e[2]=n,e}function pe(e,t,o,n){var r=t[0],s=t[1];return e[0]=r+n*(o[0]-r),e[1]=s+n*(o[1]-s),e}function ae(e,t){t=t||1;var o=vt()*2*Math.PI;return e[0]=Math.cos(o)*t,e[1]=Math.sin(o)*t,e}function ce(e,t,o){var n=t[0],r=t[1];return e[0]=o[0]*n+o[2]*r,e[1]=o[1]*n+o[3]*r,e}function le(e,t,o){var n=t[0],r=t[1];return e[0]=o[0]*n+o[2]*r+o[4],e[1]=o[1]*n+o[3]*r+o[5],e}function de(e,t,o){var n=t[0],r=t[1];return e[0]=o[0]*n+o[3]*r+o[6],e[1]=o[1]*n+o[4]*r+o[7],e}function me(e,t,o){var n=t[0],r=t[1];return e[0]=o[0]*n+o[4]*r+o[12],e[1]=o[1]*n+o[5]*r+o[13],e}function xe(e,t,o,n){var r=t[0]-o[0],s=t[1]-o[1],a=Math.sin(n),p=Math.cos(n);return e[0]=r*p-s*a+o[0],e[1]=r*a+s*p+o[1],e}function ue(e,t){var o=e[0],n=e[1],r=t[0],s=t[1],a=Math.sqrt(o*o+n*n)*Math.sqrt(r*r+s*s),p=a&&(o*r+n*s)/a;return Math.acos(Math.min(Math.max(p,-1),1))}function _e(e){return e[0]=0,e[1]=0,e}function fe(e){return"vec2("+e[0]+", "+e[1]+")"}function ge(e,t){return e[0]===t[0]&&e[1]===t[1]}function ve(e,t){var o=e[0],n=e[1],r=t[0],s=t[1];return Math.abs(o-r)<=rt*Math.max(1,Math.abs(o),Math.abs(r))&&Math.abs(n-s)<=rt*Math.max(1,Math.abs(n),Math.abs(s))}var Ae=wt,he=ht,be=bt,Ve=Vt,Ce=Ct,ye=yt,we=St,Se=function(){var e=At();return function(t,o,n,r,s,a){var p,_;for(o||(o=2),n||(n=0),r?_=Math.min(r*o+n,t.length):_=t.length,p=n;p<_;p+=o)e[0]=t[p],e[1]=t[p+1],s(e,e,a),t[p]=e[0],t[p+1]=e[1];return t}}();var D=class{constructor(t){this.target=t}position=i.create();predict(t){t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,t.canvas.width,t.canvas.height),i.set(this.position,t.canvas.width,t.canvas.height),i.scale(this.position,this.position,.5),i.scaleAndAdd(this.position,this.position,this.target.position,-1);let o=i.len(this.target.velocity);o>0&&i.scaleAndAdd(this.position,this.position,this.target.velocity,-1/Math.pow(o,.25)),t.translate(this.position[0],this.position[1])}prepare(t,o){t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle="rgba(0, 0, 0, 0.75)",t.fillRect(0,0,t.canvas.width,t.canvas.height),i.set(this.position,t.canvas.width,t.canvas.height),i.scale(this.position,this.position,.5),i.scaleAndAdd(this.position,this.position,this.target.position,-o),t.translate(this.position[0],this.position[1]),t.scale(o,o)}};var O=class{keySet=new Set;constructor(){window.addEventListener("keydown",t=>{this.keySet.add(t.key)}),window.addEventListener("keyup",t=>{this.keySet.delete(t.key)})}has(t){return this.keySet.has(t)}get shift(){return this.keySet.has("Shift")?1:0}get vertical(){return this.keySet.has("ArrowUp")?1:this.keySet.has("ArrowDown")?-1:0}get horizontal(){return this.keySet.has("ArrowRight")?1:this.keySet.has("ArrowLeft")?-1:0}};var B=class{constructor(t,o){this.camera=t;this.drawables=o}buffer=R(_t(256),xt(128));g=this.buffer.getContext("2d");draw(t){this.g.save(),this.camera.prepare(this.g,.001);for(let o of this.drawables)o.drawMini(this.g);this.g.restore(),t.save(),t.strokeStyle="rgba(255, 255, 255, 0.25)",t.lineWidth=1,t.translate(10,10),t.drawImage(this.buffer,0,0),t.strokeRect(0,0,this.buffer.width,this.buffer.height),t.restore()}};var A=i.create();var Ee=1,h=i.create(),G=class{bodies;constructor(...t){this.bodies=t}update(t){for(let o of this.bodies)i.copy(o.gravity,A);for(let o=0;o<this.bodies.length-1;++o){let n=this.bodies[o];for(let r=o+1;r<this.bodies.length;++r){let s=this.bodies[r];i.sub(h,n.position,s.position);let a=i.sqrLen(h);if(a>0){i.normalize(h,h);let p=Ee*n.mass*s.mass/a;i.scaleAndAdd(n.gravity,n.gravity,h,-p/n.mass),i.scaleAndAdd(s.gravity,s.gravity,h,p/s.mass)}}}}};var E=class{constructor(t,o,n){this.mass=t;this.radius=o;this.atmoRadius=n;this.atmoRadius>0&&(this.atmoRadius+=this.radius)}gravity=i.create();velocity=i.create();position=i.create();update(t){i.scaleAndAdd(this.velocity,this.velocity,this.gravity,t),i.scaleAndAdd(this.position,this.position,this.velocity,t)}draw(t){t.save(),t.strokeStyle="white",t.fillStyle="black",t.lineWidth=10,this.drawMajor(t,1),t.stroke(),this.atmoRadius>0&&(t.lineWidth=.5,t.beginPath(),t.arc(this.position[0],this.position[1],this.atmoRadius,0,2*Math.PI),t.stroke()),t.restore()}drawMajor(t,o){t.beginPath(),t.arc(this.position[0],this.position[1],this.radius*o,0,2*Math.PI),t.fill()}drawMini(t){t.save(),t.fillStyle="white",this.drawMajor(t,50),t.restore()}};var it=5,Pe=5,ke=1e3,Me=-.05,F=class{constructor(t){this.keyboard=t}enginePower=0;turnRate=0;drag=0;mass=1;rotation=0;shake=i.create();acceleration=i.create();gravity=i.create();velocity=i.create();position=i.create();update(t){this.turnRate=this.keyboard.horizontal,this.enginePower=Math.max(-.5,this.keyboard.vertical)+this.keyboard.shift*7,this.rotation+=Pe*this.turnRate*t,i.set(this.acceleration,1,0),i.rotate(this.acceleration,this.acceleration,A,this.rotation),i.scale(this.acceleration,this.acceleration,ke*this.enginePower*t),i.set(this.shake,0,Math.random()*2-1),i.rotate(this.shake,this.shake,A,this.rotation);let o=Math.pow(i.len(this.acceleration),.3333);i.scaleAndAdd(this.shake,A,this.shake,o),i.scaleAndAdd(this.acceleration,this.acceleration,this.velocity,Me*this.drag),i.add(this.acceleration,this.acceleration,this.gravity),i.scaleAndAdd(this.velocity,this.velocity,this.acceleration,t),i.scaleAndAdd(this.position,this.position,this.velocity,t)}draw(t){t.save(),t.fillStyle="black",t.strokeStyle="white",t.lineWidth=.25,t.translate(this.position[0]+this.shake[0],this.position[1]+this.shake[1]),t.rotate(this.rotation),t.scale(it,it),t.beginPath(),t.moveTo(1.75,0),t.lineTo(-1,1.25),t.lineTo(-.5,0),this.enginePower>0&&(t.lineTo(-this.enginePower+.4*Math.random(),.2+.4*Math.random()),t.lineTo(-.7+.1*Math.random(),0+.1*Math.random()),t.lineTo(-this.enginePower-.4*Math.random(),-.2-.4*Math.random()),t.lineTo(-.5,0)),t.lineTo(-1,-1.25),t.closePath(),t.stroke(),t.restore()}drawMini(t){t.save(),t.fillStyle="yellow";let o=it*200;t.fillRect(this.position[0]-.5*o,this.position[1]-.5*o,o,o),t.restore()}};var Te=.5*(Math.sqrt(3)-1),P=(3-Math.sqrt(3))/6,Bn=1/3,Gn=1/6,Fn=(Math.sqrt(5)-1)/4,zn=(5-Math.sqrt(5))/20,Et=e=>Math.floor(e)|0,Pt=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function kt(e=Math.random){let t=Xe(e),o=new Float64Array(t).map(r=>Pt[r%12*2]),n=new Float64Array(t).map(r=>Pt[r%12*2+1]);return function(s,a){let p=0,_=0,pt=0,at=(s+a)*Te,N=Et(s+at),q=Et(a+at),ct=(N+q)*P,It=N-ct,jt=q-ct,f=s-It,g=a-jt,T,X;f>g?(T=1,X=0):(T=0,X=1);let J=f-T+P,$=g-X+P,U=f-1+2*P,K=g-1+2*P,Y=N&255,Z=q&255,b=.5-f*f-g*g;if(b>=0){let d=Y+t[Z],y=o[d],w=n[d];b*=b,p=b*b*(y*f+w*g)}let V=.5-J*J-$*$;if(V>=0){let d=Y+T+t[Z+X],y=o[d],w=n[d];V*=V,_=V*V*(y*J+w*$)}let C=.5-U*U-K*K;if(C>=0){let d=Y+1+t[Z+1],y=o[d],w=n[d];C*=C,pt=C*C*(y*U+w*K)}return 70*(p+_+pt)}}function Xe(e){let o=new Uint8Array(512);for(let n=0;n<512/2;n++)o[n]=n;for(let n=0;n<512/2-1;n++){let r=n+~~(e()*(256-n)),s=o[n];o[n]=o[r],o[r]=s}for(let n=256;n<512;n++)o[n]=o[n-256];return o}var x=10,z=class{constructor(t){this.target=t}noise=kt(Math.random);draw(t){t.save(),t.fillStyle="white";for(let o=0;o<t.canvas.height;o+=x){let n=o-x*Math.round(this.target.position[1]/x);for(let r=0;r<t.canvas.width;r+=x){let s=r-x*Math.round(this.target.position[0]/x);this.noise(x*s,x*n)>.9&&t.fillRect(s,n,2,2)}}t.restore()}drawMini(t){}};function Mt(e){let t=!1;function o(){e.width=devicePixelRatio*e.clientWidth,e.height=devicePixelRatio*e.clientHeight,t=!1}new ResizeObserver(r=>{for(let s of r)s.target===e&&(t||(t=!0,queueMicrotask(o)))}).observe(e)}function Tt(e){let t=0;requestAnimationFrame(n=>{n*=.001,t=n,requestAnimationFrame(o)});function o(n){n*=.001;let r=n-t;t=n,requestAnimationFrame(o),e(r,n)}}var Xt=R(ut("frontBuffer")),k=Xt.getContext("2d"),Le=new O,H=new F(Le),st=new D(H),W=new E(1e7,10,0),M=new E(1e6,50,50),Ie=new z(st),je=new G(W,M,H),Re=[je,W,M,H],Lt=[Ie,W,M,H],De=new B(st,Lt);i.set(W.position,500,100);i.set(M.position,-500,-150);i.set(M.velocity,200,-100);Mt(Xt);Tt(e=>{k.save();for(let t of Re)t.update(e);st.predict(k);for(let t of Lt)t.draw(k);k.restore(),De.draw(k)});
