function G(n,o,t){return typeof n===o||n instanceof t}function O(n){return G(n,"function",Function)}function g(n){return G(n,"string",String)}function ho(n){return G(n,"boolean",Boolean)}function B(n){return G(n,"number",Number)}function so(n){return s(n)&&G(n,"object",Object)}function I(n){return n instanceof Array}function co(n,o){throw new Error((o||"Unexpected object: ")+n)}function f(n){return n==null}function s(n){return!f(n)}function Vo(n){return n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Int8Array||n instanceof Uint16Array||n instanceof Int16Array||n instanceof Uint32Array||n instanceof Int32Array||n instanceof Float32Array||n instanceof Float64Array||"BigUint64Array"in globalThis&&n instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&n instanceof globalThis.BigInt64Array}function bo(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function X(n){return n.splice(0)}function yo(n,o){for(let t=0;t<n.length;++t)if(n[t]!==o[t])return t;return-1}function ao(n,o){let t=n.indexOf(o);return t>-1?(lo(n,t),!0):!1}function lo(n,o){return n.splice(o,1)[0]}function q(n){return n}function Xo(){return!0}function wo(){return!1}function ko(n,o,t){return new Map(n.map(e=>[o(e),t(e)]))}function Mo(n,o){return ko(n,o,q)}var P=class{constructor(o){if(this.items=new Map,this.defaultItems=new Array,s(o))for(let[t,e]of o)this.add(t,e)}add(o,...t){for(let e of t)if(f(o))this.defaultItems.push(e);else{let p=this.items.get(o);f(p)&&this.items.set(o,p=[]),p.push(e)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let o of this.defaultItems)yield o;for(let o of this.items.values())for(let t of o)yield t}has(o){return s(o)?this.items.has(o):this.defaultItems.length>0}get(o){return f(o)?this.defaultItems:this.items.get(o)||[]}count(o){if(f(o))return this.defaultItems.length;let t=this.get(o);return s(t)?t.length:0}get size(){let o=this.defaultItems.length;for(let t of this.items.values())o+=t.length;return o}delete(o){return f(o)?X(this.defaultItems).length>0:this.items.delete(o)}remove(o,t){if(f(o))ao(this.defaultItems,t);else{let e=this.items.get(o);s(e)&&(ao(e,t),e.length===0&&this.items.delete(o))}}clear(){this.items.clear(),X(this.defaultItems)}};var D=class{constructor(o){if(this.items=new Map,s(o))for(let[t,e,p]of o)this.add(t,e,p)}add(o,t,e){let p=this.items.get(o);return f(p)&&this.items.set(o,p=new Map),p.set(t,e),this}*entries(){for(let[o,t]of this.items)for(let[e,p]of t)yield[o,e,p]}keys(o){return f(o)?this.items.keys():this.items.get(o).keys()}*values(){for(let o of this.items.values())for(let t of o.values())yield t}has(o,t){return this.items.has(o)&&(f(t)||this.items.get(o).has(t))}get(o,t){return f(t)?this.items.get(o):this.items.has(o)?this.items.get(o).get(t):null}count(o){return this.items.has(o)?this.items.get(o).size:null}get size(){let o=0;for(let t of this.items.values())o+=t.size;return o}delete(o,t){if(f(t))return this.items.delete(o);if(this.items.has(o)){let e=this.items.get(o),p=e.delete(t);return e.size===0&&this.items.delete(o),p}else return!1}clear(){this.items.clear()}};var E=class{constructor(){this.listeners=new Map,this.listenerOptions=new Map,this.bubblers=new Set,this.scopes=new WeakMap}addBubbler(o){this.bubblers.add(o)}removeBubbler(o){this.bubblers.delete(o)}addScopedEventListener(o,t,e,p){this.scopes.has(o)||this.scopes.set(o,[]),this.scopes.get(o).push([t,e]),this.addEventListener(t,e,p)}removeScope(o){let t=this.scopes.get(o);if(t){this.scopes.delete(o);for(let[e,p]of t)this.removeEventListener(e,p)}}addEventListener(o,t,e){let p=this.listeners.get(o);p||(p=new Array,this.listeners.set(o,p)),p.find(i=>i===t)||(p.push(t),e&&this.listenerOptions.set(t,e))}removeEventListener(o,t){let e=this.listeners.get(o);e&&this.removeListener(e,t)}clearEventListeners(o){for(let[t,e]of this.listeners)if(f(o)||o===t){for(let p of e)this.removeEventListener(o,p);X(e),this.listeners.delete(t)}}removeListener(o,t){let e=o.findIndex(p=>p===t);e>=0&&(lo(o,e),this.listenerOptions.has(t)&&this.listenerOptions.delete(t))}dispatchEvent(o){let t=this.listeners.get(o.type);if(t)for(let e of t){let p=this.listenerOptions.get(e);s(p)&&!ho(p)&&p.once&&this.removeListener(t,e),O(e)?e.call(this,o):e.handleEvent(o)}if(o.defaultPrevented)return!1;for(let e of this.bubblers)if(!e.dispatchEvent(o))return!1;return!0}};var w=class{constructor(o=!0){this.autoStart=o,this.onThens=new Array,this.onCatches=new Array,this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",this.resolve=t=>{if(this.running){this._result=t,this._resultState="resolved";for(let e of this.onThens)e(t);this.clear(),this._executionState="finished"}},this.reject=t=>{if(this.running){this._error=t,this._resultState="errored";for(let e of this.onCatches)e(t);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){X(this.onThens),X(this.onCatches)}start(){this._executionState="running"}resolver(o){return()=>this.resolve(o)}resolveOn(o,t,e){let p=this.resolver(e);o.addEventListener(t,p),this.finally(()=>o.removeEventListener(t,p))}get result(){if(s(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((o,t)=>{this.finished?this.errored?t(this.error):o(this.result):(this.onThens.push(o),this.onCatches.push(t))})}then(o,t){return this.project().then(o,t)}catch(o){return this.project().catch(o)}finally(o){return this.project().finally(o)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(o){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",o&&this.start()}};function So(n,o){return"on"+o in n}function T(n,o,t,...e){f(e)&&(e=[]);let p;if(g(t)?e.unshift(t):B(t)&&(p=t),!(n instanceof E)){if(!So(n,o))throw new Error(`Target does not have a ${o} rejection event`);for(let c of e)if(!So(n,c))throw new Error(`Target does not have a ${c} rejection event`)}let i=new w;if(B(p)){let c=setTimeout(i.reject,p,`'${o}' has timed out.`);i.finally(clearTimeout.bind(globalThis,c))}let r=(c,l)=>{n.addEventListener(c,l),i.finally(()=>n.removeEventListener(c,l))};r(o,c=>i.resolve(c));let a=c=>i.reject(c);for(let c of e)r(c,a);return i}function S(n){return n.then(Xo).catch(wo)}function mo(n,...o){if(!so(n))return!1;n=n;for(let t of o){if(!(t in n))return!1;let e=n[t];if(!O(e))return!1}return!0}function Do(n){return mo(n,"dispose")}function Eo(n){return mo(n,"destroy")}function Ro(n){return mo(n,"close")}function W(n){Do(n)&&n.dispose(),Ro(n)&&n.close(),Eo(n)&&n.destroy()}function Co(n,o){try{return o(n)}finally{W(n)}}var U=class n{static delete(o){let t=indexedDB.deleteDatabase(o),e=T(t,"success","error","blocked");return S(e)}static async open(o,...t){let e=Mo(t,u=>u.name),p=new D(t.filter(u=>s(u.indexes)).flatMap(u=>u.indexes.map(y=>[u.name,y.name,y]))),i=new Array,r=new Array,a=new Array,c=new P,l=new P,d=null,V=indexedDB.open(o);if(await S(T(V,"success","error","blocked"))){let u=V.result;d=u.version;let y=new Array;for(let v of u.objectStoreNames)e.has(v)||r.push(v);for(let v of e.keys())u.objectStoreNames.contains(v)?y.push(v):i.push(v);if(y.length>0){let v=u.transaction(y),A=T(v,"complete","error","abort"),C=S(A);for(let x of y){let j=v.objectStore(x),go=e.get(x);s(go.options)&&j.keyPath!==go.options.keyPath&&(r.push(x),i.push(x));for(let M of j.indexNames)p.has(x,M)||(a.indexOf(x)===-1&&a.push(x),l.add(x,M));if(p.has(x))for(let M of p.get(x).keys())if(!j.indexNames.contains(M))a.indexOf(x)===-1&&a.push(x),c.add(x,M);else{let z=p.get(x,M),L=j.index(M);(g(z.keyPath)!==g(L.keyPath)||g(z.keyPath)&&g(L.keyPath)&&z.keyPath!==L.keyPath||I(z.keyPath)&&I(L.keyPath)&&yo(z.keyPath,L.keyPath))&&(a.indexOf(x)===-1&&a.push(x),l.add(x,M),c.add(x,M))}}v.commit(),await C}W(u)}else{d=0,i.push(...e.keys());for(let u of t)if(s(u.indexes))for(let y of u.indexes)c.add(u.name,y.name)}(i.length>0||r.length>0||c.size>0||l.size>0)&&++d;let m=new w,_=s(d)?indexedDB.open(o,d):indexedDB.open(o),b=T(_,"success","error","blocked"),N=S(m),ro=S(b),Ao=m.resolver(!1);if(_.addEventListener("success",Ao),_.addEventListener("upgradeneeded",()=>{let u=T(_.transaction,"complete","error","abort"),y=_.result;for(let A of r)y.deleteObjectStore(A);let v=new Map;for(let A of i){let C=e.get(A),x=y.createObjectStore(A,C.options);v.set(A,x)}for(let A of a){let C=_.transaction.objectStore(A);v.set(A,C)}for(let[A,C]of v){for(let x of l.get(A))C.deleteIndex(x);for(let x of c.get(A)){let j=p.get(A,x);C.createIndex(x,j.keyPath,j.options)}}S(u).then(m.resolve).catch(m.reject).finally(()=>_.removeEventListener("success",Ao))}),!await N)throw m.error;if(!await ro)throw b.error;return new n(_.result)}constructor(o){this.db=o}dispose(){W(this.db)}get name(){return this.db.name}get version(){return this.db.version}get storeNames(){return Array.from(this.db.objectStoreNames)}getStore(o){return new _o(this.db,o)}},_o=class{constructor(o,t){this.db=o,this.storeName=t}async request(o,t){let e=this.db.transaction(this.storeName,t),p=T(e,"complete","error"),i=e.objectStore(this.storeName),r=o(i),a=T(r,"success","error");if(!await S(a))throw e.abort(),a.error;if(e.commit(),!await S(p))throw p.error;return r.result}add(o,t){return this.request(e=>e.add(o,t),"readwrite")}clear(){return this.request(o=>o.clear(),"readwrite")}getCount(o){return this.request(t=>t.count(o),"readonly")}async has(o){return await this.getCount(o)>0}delete(o){return this.request(t=>t.delete(o),"readwrite")}get(o){return this.request(t=>t.get(o),"readonly")}getAll(){return this.request(o=>o.getAll(),"readonly")}getAllKeys(){return this.request(o=>o.getAllKeys(),"readonly")}getKey(o){return this.request(t=>t.getKey(o),"readonly")}openCursor(o,t){return this.request(e=>e.openCursor(o,t),"readonly")}openKeyCursor(o,t){return this.request(e=>e.openKeyCursor(o,t),"readonly")}put(o,t){return this.request(e=>e.put(o,t),"readwrite")}};function To(n,...o){for(let t of o)if(s(t))for(let[e,p]of t)n.set(e,p);return n}var xo=class extends w{constructor(o){super(!1),this.milliseconds=o,this._timer=null}start(){super.start(),this._timer=setTimeout(()=>{this._timer=null,this.resolve()},this.milliseconds)}reset(){super.reset(),s(this._timer)&&(clearTimeout(this._timer),this._timer=null)}};function jo(n){let o=new xo(n);return o.start(),o}function H(n,o){return async()=>{let t=null,e=500;for(let p=0;p<=n;++p)try{return p>0&&(await jo(e),e*=2),await o()}catch(i){t=i}throw t}}var R=class extends E{addBubbler(o){super.addBubbler(o)}removeBubbler(o){super.removeBubbler(o)}addScopedEventListener(o,t,e,p){super.addScopedEventListener(o,t,e,p)}addEventListener(o,t,e){super.addEventListener(o,t,e)}removeEventListener(o,t){super.removeEventListener(o,t)}clearEventListeners(o){return super.clearEventListeners(o)}};var F=class extends R{constructor(){super(...arguments),this.attached=new Array,this.soFar=null,this.total=null,this.msg=null,this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(o,t,e,p){this.soFar=o,this.total=t,this.msg=e,this.est=p;for(let i of this.attached)i.report(o,t,e,p)}attach(o){this.attached.push(o),o.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(o){this.report(0,1,o||"starting")}end(o){this.report(1,1,o||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,X(this.attached)}};var J=class extends F{constructor(o,t){super(),this.i=o,this.prog=t}report(o,t,e,p){super.report(o,t,e,p),this.prog.update(this.i,o,t,e)}};var K=class{constructor(o){this.prog=o,this.weightTotal=0,this.subProgressCallbacks=new Array,this.subProgressWeights=new Array,this.subProgressValues=new Array,this.start=performance.now();for(let t=0;t<this.subProgressWeights.length;++t)this.subProgressValues[t]=0,this.subProgressCallbacks[t]=new J(t,this)}addSubProgress(o){o=o||1,this.weightTotal+=o,this.subProgressWeights.push(o),this.subProgressValues.push(0);let t=new J(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(t),t}update(o,t,e,p){if(this.prog){this.subProgressValues[o]=t/e;let i=0;for(let l=0;l<this.subProgressWeights.length;++l)i+=this.subProgressValues[l]*this.subProgressWeights[l];let r=performance.now(),a=r-this.start,c=this.start-r+a*this.weightTotal/i;this.prog.report(i,this.weightTotal,p,c)}}};function Fo(n,o){return new fo(o,n).subProgressCallbacks}function Po(n,o){let t=new Array(o);for(let e=0;e<o;++e)t[e]=1;return Fo(n,t)}var fo=class extends K{constructor(o,t){super(t);for(let e of o)this.addSubProgress(e)}};async function k(n,o){let{status:t,requestPath:e,responsePath:p,content:i,contentType:r,contentLength:a,fileName:c,headers:l,date:d}=n;return{status:t,requestPath:e,responsePath:p,content:s(o)?await o(i):void 0,contentType:r,contentLength:a,fileName:c,headers:l,date:d}}var Oo=/([^\/]+)\/(.+)/,No=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/;var Z=class n{constructor(o,t,e){this._type=o,this._fullSubType=t,this._primaryExtension=null,this.depMessage=null;let p=new Map;this._parameters=p;let i=this._fullSubType.match(No);this._tree=i[1],this._subType=i[2],this._suffix=i[3];let r=i[4];if(this._value=this._fullValue=this._type+"/",s(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,s(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),s(r)){let a=r.split(";").map(c=>c.trim()).filter(c=>c.length>0).map(c=>c.split("="));for(let[c,...l]of a){let d=l.join("=");p.set(c,d);let V=`; ${c}=${d}`;this._fullValue+=V,c!=="q"&&(this._value+=V)}}this._extensions=e||[],this._primaryExtension=this._extensions[0]||null}static parse(o){if(!o)return null;let t=o.match(Oo);if(!t)return null;let e=t[1],p=t[2];return new n(e,p)}deprecate(o){return this.depMessage=o,this}check(){s(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(o){if(f(o))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let t=null,e=null;if(g(o)){let p=o.match(Oo);if(!p)return!1;t=p[1],e=p[2]}else t=o.typeName,e=o._fullSubType;return this.typeName===t&&(this._fullSubType==="*"||this._fullSubType===e)}withParameter(o,t){let e=`${this._fullSubType}; ${o}=${t}`;return new n(this.typeName,e,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}toFileSystemAPIAccepts(){return{[this.value]:this.extensions.map(o=>"."+o)}}addExtension(o){if(!o)throw new Error("File name is not defined");return this.primaryExtension&&(o=n.removeExtension(o),o=`${o}.${this.primaryExtension}`),o}static removeExtension(o){let t=o.lastIndexOf(".");return t>-1&&(o=o.substring(0,t)),o}};function zo(n,o,...t){return new Z(n,o,t)}function h(n){return zo.bind(null,n)}var Lo=h("text");var Io=Lo("plain","txt","text","conf","def","list","log","in");function Go(n){return g(n)||Vo(n)||n instanceof Blob||n instanceof FormData||bo(n)||"Document"in globalThis&&n instanceof Document}function Q(n,o,t,e,p,i){let r=!i;i&&i.then(()=>r=!0);let a=!1,c=p,l=new w;t.addEventListener("loadstart",()=>{r&&!a&&e&&e.start(n)}),t.addEventListener("progress",V=>{if(r&&!a){let m=V;e&&e.report(m.loaded,Math.max(m.loaded,m.total),n),m.loaded===m.total&&(c=!0,a&&l.resolve())}}),t.addEventListener("load",()=>{r&&!a&&(e&&e.end(n),a=!0,c&&l.resolve())});let d=V=>()=>{r&&l.reject(`${V} (${o.status})`)};return t.addEventListener("error",d("error")),t.addEventListener("abort",d("abort")),t.addEventListener("timeout",d("timeout")),l}function uo(n,o,t,e,p,i){if(n.open(o,t),n.responseType="blob",n.timeout=e,p)for(let[r,a]of p)n.setRequestHeader(r,a);s(i)?n.send(i):n.send()}function Y(n,o,t){if(!n.has(o))return null;let e=n.get(o);try{let p=t(e);return n.delete(o),p}catch(p){console.warn(o,p)}return null}var Bo=/filename=\"(.+)\"(;|$)/,Wo="Juniper:Fetcher:Cache",$=class{constructor(){this.cache=null,this.store=null,this.tasks=new D,this.cacheReady=this.openCache()}async drawImageToCanvas(o,t,e){let p=await this.sendNothingGetSomething("blob",o,e),i=p.content;return Co(await createImageBitmap(i,{imageOrientation:"from-image"}),r=>(t.width=r.width,t.height=r.height,t.getContext("2d").drawImage(r,0,0),k(p)))}async openCache(){let o={keyPath:"requestPath"};this.cache=await U.open(Wo,{name:"files",options:o}),this.store=await this.cache.getStore("files")}async clearCache(){await this.cacheReady,await this.store.clear()}async evict(o){await this.cacheReady,this.store.has(o)&&await this.store.delete(o)}async readResponseHeaders(o,t){let e=t.getAllResponseHeaders().split(/[\r\n]+/).map(m=>m.trim()).filter(m=>m.length>0).map(m=>{let _=m.split(": "),b=_.shift().toLowerCase(),N=_.join(": ");return[b,N]}),p=new P(e),i=Array.from(p.keys()).map(m=>[m,p.get(m).join(", ")]),r=new Map(i),a=Y(r,"content-type",q),c=Y(r,"content-length",parseFloat),l=Y(r,"date",m=>new Date(m)),d=Y(r,"content-disposition",m=>{if(s(m)){let _=m.match(Bo);if(s(_))return _[1]}return null});return{status:t.status,requestPath:o,responsePath:t.responseURL,content:void 0,contentType:a,contentLength:c,fileName:d,date:l,headers:r}}async readResponse(o,t){let{responsePath:e,status:p,contentType:i,contentLength:r,fileName:a,date:c,headers:l}=await this.readResponseHeaders(o,t),d={requestPath:o,responsePath:e,status:p,contentType:i,contentLength:r,fileName:a,date:c,headers:l,content:t.response};return s(d.content)&&(d.contentType=d.contentType||d.content.type,d.contentLength=d.contentLength||d.content.size),d}async decodeContent(o,t){return k(t,async e=>{if(o==="")return null;if(f(t.contentType)){let p=Array.from(t.headers.entries()).map(i=>i.join(": ")).join(`
  `);throw new Error(`No content type found in headers: 
  `+p)}else{if(o==="blob")return e;if(o==="arraybuffer")return await e.arrayBuffer();if(o==="json"){let p=await e.text();return p.length>0?JSON.parse(p):null}else if(o==="document"){let p=new DOMParser;if(t.contentType==="application/xhtml+xml"||t.contentType==="text/html"||t.contentType==="application/xml"||t.contentType==="image/svg+xml"||t.contentType==="text/xml")return p.parseFromString(await e.text(),t.contentType);throw new Error("Couldn't parse document")}else{if(o==="text")return await e.text();co(o)}}})}async withCachedTask(o,t){return o.method!=="GET"&&o.method!=="HEAD"&&o.method!=="OPTIONS"?await t():(this.tasks.has(o.method,o.path)||this.tasks.add(o.method,o.path,t().finally(()=>this.tasks.delete(o.method,o.path))),this.tasks.get(o.method,o.path))}sendNothingGetNothing(o){return this.withCachedTask(o,H(o.retryCount,async()=>{let t=new XMLHttpRequest,e=Q(`requesting: ${o.path}`,t,t,null,!0);return uo(t,o.method,o.path,o.timeout,o.headers),await e,await this.readResponseHeaders(o.path,t)}))}sendNothingGetSomething(o,t,e){return this.withCachedTask(t,H(t.retryCount,async()=>{let p=null,i=t.useCache&&t.method==="GET";i&&(s(e)&&e.start(),await this.cacheReady,p=await this.store.get(t.path));let r=f(p);if(r){let c=new XMLHttpRequest,l=Q(`requesting: ${t.path}`,c,c,e,!0);uo(c,t.method,t.path,t.timeout,t.headers),await l,p=await this.readResponse(t.path,c),i&&await this.store.add(p)}let a=await this.decodeContent(o,p);return r&&s(e)&&e.end(),a}))}sendSomethingGetSomething(o,t,e,p){let i=null,r=To(new Map,e,t.headers),a=null;if(s(r)){let _=new Array;for(let b of r.keys())b.toLowerCase()==="content-type"&&_.push(b);if(_.length>0){t.body instanceof FormData||(a=r.get(_[0]),_.shift());for(let b of _)r.delete(b)}}Go(t.body)&&!g(t.body)||g(t.body)&&Io.matches(a)?i=t.body:s(t.body)&&(i=JSON.stringify(t.body));let c=s(i),l=Po(p,c?2:1),[d,V]=l,m=async()=>{let _=new XMLHttpRequest,b=c?Q("uploading",_,_.upload,d,!1):Promise.resolve(),N=Q("saving",_,_,V,!0,b);uo(_,t.method,t.path,t.timeout,r,i),await b,await N;let ro=await this.readResponse(t.path,_);return await this.decodeContent(o,ro)};return H(t.retryCount,m)()}};var Jo=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,oo=navigator.userAgent.match(Jo),to=!!oo,Qe=to&&{major:parseFloat(oo[1]),minor:parseFloat(oo[2]),patch:parseFloat(oo[3])},Ye=to&&/pacific/i.test(navigator.userAgent),$e=to&&/quest/i.test(navigator.userAgent),on=to&&/quest 2/i.test(navigator.userAgent);var qo="Worker"in globalThis;var vo=class extends F{constructor(o,t){super(),this.server=o,this.taskID=t}report(o,t,e,p){let i={type:"progress",taskID:this.taskID,soFar:o,total:t,msg:e,est:p};this.server.postMessage(i)}},eo=class{constructor(o){this.self=o,this.methods=new Map,this.self.addEventListener("message",t=>{let e=t.data;this.callMethod(e)})}postMessage(o,t){s(t)?this.self.postMessage(o,t):this.self.postMessage(o)}callMethod(o){let t=this.methods.get(o.methodName);if(t)try{I(o.params)?t(o.taskID,...o.params):s(o.params)?t(o.taskID,o.params):t(o.taskID)}catch(e){this.onError(o.taskID,`method invocation error: ${o.methodName}(${e.message||e})`)}else this.onError(o.taskID,`method not found: ${o.methodName}`)}onError(o,t){let e={type:"error",taskID:o,errorMessage:t};this.postMessage(e)}onReturn(o,t,e){let p=null;if(t===void 0?p={type:"return",taskID:o}:p={type:"return",taskID:o,returnValue:t},s(e)){let i=e(t);this.postMessage(p,i)}else this.postMessage(p)}addMethodInternal(o,t,e){if(this.methods.has(o))throw new Error(`${o} method has already been mapped.`);this.methods.set(o,async(p,...i)=>{let r=new vo(this,p);try{let a=await t(...i,r);this.onReturn(p,a,e)}catch(a){console.error(a),this.onError(p,a.message||a)}})}addFunction(o,t,e){this.addMethodInternal(o,t,e)}addVoidFunction(o,t){this.addMethodInternal(o,t)}addMethod(o,t,e,p){this.addFunction(t,e.bind(o),p)}addVoidMethod(o,t,e){this.addVoidFunction(t,e.bind(o))}addEvent(o,t,e,p){o.addEventListener(t,i=>{let r=null;if(s(e)?r={type:"event",eventName:t,data:e(i)}:r={type:"event",eventName:t},r.data!==void 0&&s(p)){let a=p(r.data);this.postMessage(r,a)}else this.postMessage(r)})}};var no=class{constructor(o){this.impl=o,this.defaultPostHeaders=new Map}setRequestVerificationToken(o){this.defaultPostHeaders.set("RequestVerificationToken",o)}clearCache(){return this.impl.clearCache()}evict(o){return this.impl.evict(o)}sendNothingGetNothing(o){return this.impl.sendNothingGetNothing(o)}sendNothingGetBlob(o,t){return this.impl.sendNothingGetSomething("blob",o,t)}sendObjectGetBlob(o,t){return this.impl.sendSomethingGetSomething("blob",o,this.defaultPostHeaders,t)}sendNothingGetBuffer(o,t){return this.impl.sendNothingGetSomething("arraybuffer",o,t)}sendObjectGetBuffer(o,t){return this.impl.sendSomethingGetSomething("arraybuffer",o,this.defaultPostHeaders,t)}sendNothingGetText(o,t){return this.impl.sendNothingGetSomething("text",o,t)}sendObjectGetText(o,t){return this.impl.sendSomethingGetSomething("text",o,this.defaultPostHeaders,t)}sendNothingGetObject(o,t){return this.impl.sendNothingGetSomething("json",o,t)}sendObjectGetObject(o,t){return this.impl.sendSomethingGetSomething("json",o,this.defaultPostHeaders,t)}sendObjectGetNothing(o,t){return this.impl.sendSomethingGetSomething("",o,this.defaultPostHeaders,t)}drawImageToCanvas(o,t,e){return this.impl.drawImageToCanvas(o,t,e)}async sendNothingGetFile(o,t){return k(await this.sendNothingGetBlob(o,t),URL.createObjectURL)}async sendObjectGetFile(o,t){return k(await this.sendObjectGetBlob(o,t),URL.createObjectURL)}async sendNothingGetXml(o,t){return k(await this.impl.sendNothingGetSomething("document",o,t),e=>e.documentElement)}async sendObjectGetXml(o,t){return k(await this.impl.sendSomethingGetSomething("document",o,this.defaultPostHeaders,t),e=>e.documentElement)}async sendNothingGetImageBitmap(o,t){return k(await this.sendNothingGetBlob(o,t),createImageBitmap)}async sendObjectGetImageBitmap(o,t){return k(await this.sendObjectGetBlob(o,t),createImageBitmap)}};var io=class extends eo{constructor(o,t){super(o);let e=new no(t);Uo(this,e)}};function po(n){return[n.content]}function Uo(n,o){n.addVoidMethod(o,"setRequestVerificationToken",o.setRequestVerificationToken),n.addMethod(o,"clearCache",o.clearCache),n.addMethod(o,"evict",o.evict),n.addMethod(o,"sendNothingGetNothing",o.sendNothingGetNothing),n.addMethod(o,"sendNothingGetBuffer",o.sendNothingGetBuffer,po),n.addMethod(o,"sendNothingGetImageBitmap",o.sendNothingGetImageBitmap,po),n.addMethod(o,"sendNothingGetObject",o.sendNothingGetObject),n.addMethod(o,"sendNothingGetFile",o.sendNothingGetFile),n.addMethod(o,"sendNothingGetText",o.sendNothingGetText),n.addMethod(o,"sendObjectGetNothing",o.sendObjectGetNothing),n.addMethod(o,"sendObjectGetImageBitmap",o.sendObjectGetImageBitmap,po),n.addMethod(o,"sendObjectGetBuffer",o.sendObjectGetBuffer,po),n.addMethod(o,"sendObjectGetObject",o.sendObjectGetObject),n.addMethod(o,"sendObjectGetFile",o.sendObjectGetFile),n.addMethod(o,"sendObjectGetText",o.sendObjectGetText),n.addMethod(o,"drawImageToCanvas",o.drawImageToCanvas)}globalThis.server=new io(globalThis,new $);
