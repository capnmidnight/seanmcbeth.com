function B(e,o,t){return typeof e===o||e instanceof t}function O(e){return B(e,"function",Function)}function g(e){return B(e,"string",String)}function Vo(e){return B(e,"boolean",Boolean)}function G(e){return B(e,"number",Number)}function ao(e){return s(e)&&B(e,"object",Object)}function I(e){return e instanceof Array}function lo(e,o){throw new Error((o||"Unexpected object: ")+e)}function f(e){return e==null}function s(e){return!f(e)}function bo(e){return e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Uint32Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||"BigUint64Array"in globalThis&&e instanceof globalThis.BigUint64Array||"BigInt64Array"in globalThis&&e instanceof globalThis.BigInt64Array}function yo(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function X(e){return e.splice(0)}function Xo(e,o){for(let t=0;t<e.length;++t)if(e[t]!==o[t])return t;return-1}function mo(e,o){let t=e.indexOf(o);return t>-1?(_o(e,t),!0):!1}function _o(e,o){return e.splice(o,1)[0]}function U(e){return e}function wo(){return!0}function ko(){return!1}function Mo(e,o,t){return new Map(e.map((n,p)=>[o(n,p),t(n,p)]))}function So(e,o,t){return typeof e===o||e instanceof t}function Co(e){return So(e,"string",String)}function H(e){return Lo(e)&&So(e,"object",Object)}function To(e){return e==null}function Lo(e){return!To(e)}function jo(e,o){return Mo(e,o,U)}var P=class{constructor(o){if(this.items=new Map,this.defaultItems=new Array,s(o))for(let[t,n]of o)this.add(t,n)}add(o,...t){for(let n of t)if(f(o))this.defaultItems.push(n);else{let p=this.items.get(o);f(p)&&this.items.set(o,p=[]),p.push(n)}return this}entries(){return this.items.entries()}[Symbol.iterator](){return this.entries()}keys(){return this.items.keys()}*values(){for(let o of this.defaultItems)yield o;for(let o of this.items.values())for(let t of o)yield t}has(o){return s(o)?this.items.has(o):this.defaultItems.length>0}get(o){return f(o)?this.defaultItems:this.items.get(o)||[]}count(o){if(f(o))return this.defaultItems.length;let t=this.get(o);return s(t)?t.length:0}get size(){let o=this.defaultItems.length;for(let t of this.items.values())o+=t.length;return o}delete(o){return f(o)?X(this.defaultItems).length>0:this.items.delete(o)}remove(o,t){if(f(o))mo(this.defaultItems,t);else{let n=this.items.get(o);s(n)&&(mo(n,t),n.length===0&&this.items.delete(o))}}clear(){this.items.clear(),X(this.defaultItems)}};var D=class{constructor(o){if(this.items=new Map,s(o))for(let[t,n,p]of o)this.add(t,n,p)}add(o,t,n){let p=this.items.get(o);return f(p)&&this.items.set(o,p=new Map),p.set(t,n),this}*entries(){for(let[o,t]of this.items)for(let[n,p]of t)yield[o,n,p]}keys(o){return f(o)?this.items.keys():this.items.get(o).keys()}*values(){for(let o of this.items.values())for(let t of o.values())yield t}has(o,t){return this.items.has(o)&&(f(t)||this.items.get(o).has(t))}get(o,t){return f(t)?this.items.get(o):this.items.has(o)?this.items.get(o).get(t):null}count(o){return this.items.has(o)?this.items.get(o).size:null}get size(){let o=0;for(let t of this.items.values())o+=t.size;return o}delete(o,t){if(f(t))return this.items.delete(o);if(this.items.has(o)){let n=this.items.get(o),p=n.delete(t);return n.size===0&&this.items.delete(o),p}else return!1}clear(){this.items.clear()}};var E=class{constructor(){this.listeners=new Map,this.listenerOptions=new Map,this.bubblers=new Set,this.scopes=new WeakMap}addBubbler(o){this.bubblers.add(o)}removeBubbler(o){this.bubblers.delete(o)}addScopedEventListener(o,t,n,p){this.scopes.has(o)||this.scopes.set(o,[]),this.scopes.get(o).push([t,n]),this.addEventListener(t,n,p)}removeScope(o){let t=this.scopes.get(o);if(t){this.scopes.delete(o);for(let[n,p]of t)this.removeEventListener(n,p)}}addEventListener(o,t,n){let p=this.listeners.get(o);p||(p=new Array,this.listeners.set(o,p)),p.find(i=>i===t)||(p.push(t),n&&this.listenerOptions.set(t,n))}removeEventListener(o,t){let n=this.listeners.get(o);n&&this.removeListener(n,t)}clearEventListeners(o){for(let[t,n]of this.listeners)if(f(o)||o===t){for(let p of n)this.removeEventListener(o,p);X(n),this.listeners.delete(t)}}removeListener(o,t){let n=o.findIndex(p=>p===t);n>=0&&(_o(o,n),this.listenerOptions.has(t)&&this.listenerOptions.delete(t))}dispatchEvent(o){let t=this.listeners.get(o.type);if(t)for(let n of t){let p=this.listenerOptions.get(n);s(p)&&!Vo(p)&&p.once&&this.removeListener(t,n),O(n)?n.call(this,o):n.handleEvent(o)}if(o.defaultPrevented)return!1;for(let n of this.bubblers)if(!n.dispatchEvent(o))return!1;return!0}};var w=class{constructor(o=!0){this.autoStart=o,this.onThens=new Array,this.onCatches=new Array,this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",this.resolve=t=>{if(this.running){this._result=t,this._resultState="resolved";for(let n of this.onThens)n(t);this.clear(),this._executionState="finished"}},this.reject=t=>{if(this.running){this._error=t,this._resultState="errored";for(let n of this.onCatches)n(t);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){X(this.onThens),X(this.onCatches)}start(){this._executionState="running"}resolver(o){return()=>this.resolve(o)}resolveOn(o,t,n){let p=this.resolver(n);o.addEventListener(t,p),this.finally(()=>o.removeEventListener(t,p))}get result(){if(s(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((o,t)=>{this.finished?this.errored?t(this.error):o(this.result):(this.onThens.push(o),this.onCatches.push(t))})}then(o,t){return this.project().then(o,t)}catch(o){return this.project().catch(o)}finally(o){return this.project().finally(o)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(o){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",o&&this.start()}};function Po(e,o){return"on"+o in e}function C(e,o,t,...n){f(n)&&(n=[]);let p;if(g(t)?n.unshift(t):G(t)&&(p=t),!(e instanceof E)){if(!Po(e,o))throw new Error(`Target does not have a ${o} rejection event`);for(let c of n)if(!Po(e,c))throw new Error(`Target does not have a ${c} rejection event`)}let i=new w;if(G(p)){let c=setTimeout(i.reject,p,`'${o}' has timed out.`);i.finally(clearTimeout.bind(globalThis,c))}let r=(c,l)=>{e.addEventListener(c,l),i.finally(()=>e.removeEventListener(c,l))};r(o,c=>i.resolve(c));let a=c=>i.reject(c);for(let c of n)r(c,a);return i}function k(e){return e.then(wo).catch(ko)}function xo(e,...o){if(!ao(e))return!1;e=e;for(let t of o){if(!(t in e))return!1;let n=e[t];if(!O(n))return!1}return!0}function zo(e){return xo(e,"dispose")}function Bo(e){return xo(e,"destroy")}function Go(e){return xo(e,"close")}function W(e){zo(e)&&e.dispose(),Go(e)&&e.close(),Bo(e)&&e.destroy()}function Oo(e,o){try{return o(e)}finally{W(e)}}var K=class{constructor(o,t){this.db=o,this.storeName=t}async request(o,t){let n=this.db.transaction(this.storeName,t),p=C(n,"complete","error"),i=n.objectStore(this.storeName),r=o(i),a=C(r,"success","error");if(!await k(a))throw n.abort(),a.error;if(n.commit(),!await k(p))throw p.error;return r.result}add(o,t){return this.request(n=>n.add(o,t),"readwrite")}clear(){return this.request(o=>o.clear(),"readwrite")}getCount(o){return this.request(t=>t.count(o),"readonly")}async has(o){return await this.getCount(o)>0}delete(o){return this.request(t=>t.delete(o),"readwrite")}get(o){return this.request(t=>t.get(o),"readonly")}getAll(){return this.request(o=>o.getAll(),"readonly")}getAllKeys(){return this.request(o=>o.getAllKeys(),"readonly")}getKey(o){return this.request(t=>t.getKey(o),"readonly")}openCursor(o,t){return this.request(n=>n.openCursor(o,t),"readonly")}openKeyCursor(o,t){return this.request(n=>n.openKeyCursor(o,t),"readonly")}put(o,t){return this.request(n=>n.put(o,t),"readwrite")}};var Z=class e{static delete(o){let t=indexedDB.deleteDatabase(o),n=C(t,"success","error","blocked");return k(n)}static async open(o,...t){let n=jo(t,u=>u.name),p=new D(t.filter(u=>s(u.indexes)).flatMap(u=>u.indexes.map(y=>[u.name,y.name,y]))),i=new Array,r=new Array,a=new Array,c=new P,l=new P,d=null,V=indexedDB.open(o);if(await k(C(V,"success","error","blocked"))){let u=V.result;d=u.version;let y=new Array;for(let v of u.objectStoreNames)n.has(v)||r.push(v);for(let v of n.keys())u.objectStoreNames.contains(v)?y.push(v):i.push(v);if(y.length>0){let v=u.transaction(y),A=C(v,"complete","error","abort"),T=k(A);for(let x of y){let j=v.objectStore(x),ho=n.get(x);s(ho.options)&&j.keyPath!==ho.options.keyPath&&(r.push(x),i.push(x));for(let S of j.indexNames)p.has(x,S)||(a.indexOf(x)===-1&&a.push(x),l.add(x,S));if(p.has(x))for(let S of p.get(x).keys())if(!j.indexNames.contains(S))a.indexOf(x)===-1&&a.push(x),c.add(x,S);else{let L=p.get(x,S),z=j.index(S);(g(L.keyPath)!==g(z.keyPath)||g(L.keyPath)&&g(z.keyPath)&&L.keyPath!==z.keyPath||I(L.keyPath)&&I(z.keyPath)&&Xo(L.keyPath,z.keyPath))&&(a.indexOf(x)===-1&&a.push(x),l.add(x,S),c.add(x,S))}}v.commit(),await T}W(u)}else{d=0,i.push(...n.keys());for(let u of t)if(s(u.indexes))for(let y of u.indexes)c.add(u.name,y.name)}(i.length>0||r.length>0||c.size>0||l.size>0)&&++d;let m=new w,_=s(d)?indexedDB.open(o,d):indexedDB.open(o),b=C(_,"success","error","blocked"),F=k(m),co=k(b),go=m.resolver(!1);if(_.addEventListener("success",go),_.addEventListener("upgradeneeded",()=>{let u=C(_.transaction,"complete","error","abort"),y=_.result;for(let A of r)y.deleteObjectStore(A);let v=new Map;for(let A of i){let T=n.get(A),x=y.createObjectStore(A,T.options);v.set(A,x)}for(let A of a){let T=_.transaction.objectStore(A);v.set(A,T)}for(let[A,T]of v){for(let x of l.get(A))T.deleteIndex(x);for(let x of c.get(A)){let j=p.get(A,x);T.createIndex(x,j.keyPath,j.options)}}k(u).then(m.resolve).catch(m.reject).finally(()=>_.removeEventListener("success",go))}),!await F)throw m.error;if(!await co)throw b.error;return new e(_.result)}constructor(o){this.db=o}dispose(){W(this.db)}get name(){return this.db.name}get version(){return this.db.version}get storeNames(){return Array.from(this.db.objectStoreNames)}getStore(o){return new K(this.db,o)}};function Io(e,...o){for(let t of o)if(s(t))for(let[n,p]of t)e.set(n,p);return e}var fo=class extends w{constructor(o){super(!1),this.milliseconds=o,this._timer=null}start(){super.start(),this._timer=setTimeout(()=>{this._timer=null,this.resolve()},this.milliseconds)}reset(){super.reset(),s(this._timer)&&(clearTimeout(this._timer),this._timer=null)}};function Do(e){let o=new fo(e);return o.start(),o}function Q(e,o){return async()=>{let t=null,n=500;for(let p=0;p<=e;++p)try{return p>0&&(await Do(n),n*=2),await o()}catch(i){t=i}throw t}}var R=class extends E{addBubbler(o){super.addBubbler(o)}removeBubbler(o){super.removeBubbler(o)}addScopedEventListener(o,t,n,p){super.addScopedEventListener(o,t,n,p)}addEventListener(o,t,n){super.addEventListener(o,t,n)}removeEventListener(o,t){super.removeEventListener(o,t)}clearEventListeners(o){return super.clearEventListeners(o)}};var N=class extends R{constructor(){super(...arguments),this.attached=new Array,this.soFar=null,this.total=null,this.msg=null,this.est=null}get p(){return this.total>0?this.soFar/this.total:0}report(o,t,n,p){this.soFar=o,this.total=t,this.msg=n,this.est=p;for(let i of this.attached)i.report(o,t,n,p)}attach(o){this.attached.push(o),o.report(this.soFar,this.total,this.msg,this.est)}clear(){this.report(0,0),this._clear()}start(o){this.report(0,1,o||"starting")}end(o){this.report(1,1,o||"done"),this._clear()}_clear(){this.soFar=null,this.total=null,this.msg=null,this.est=null,X(this.attached)}};var J=class extends N{constructor(o,t){super(),this.i=o,this.prog=t}report(o,t,n,p){super.report(o,t,n,p),this.prog.update(this.i,o,t,n)}};var Y=class{constructor(o){this.prog=o,this.weightTotal=0,this.subProgressCallbacks=new Array,this.subProgressWeights=new Array,this.subProgressValues=new Array,this.start=performance.now();for(let t=0;t<this.subProgressWeights.length;++t)this.subProgressValues[t]=0,this.subProgressCallbacks[t]=new J(t,this)}addSubProgress(o){o=o||1,this.weightTotal+=o,this.subProgressWeights.push(o),this.subProgressValues.push(0);let t=new J(this.subProgressCallbacks.length,this);return this.subProgressCallbacks.push(t),t}update(o,t,n,p){if(this.prog){this.subProgressValues[o]=t/n;let i=0;for(let l=0;l<this.subProgressWeights.length;++l)i+=this.subProgressValues[l]*this.subProgressWeights[l];let r=performance.now(),a=r-this.start,c=this.start-r+a*this.weightTotal/i;this.prog.report(i,this.weightTotal,p,c)}}};function Wo(e,o){return new uo(o,e).subProgressCallbacks}function Eo(e,o){let t=new Array(o);for(let n=0;n<o;++n)t[n]=1;return Wo(e,t)}var uo=class extends Y{constructor(o,t){super(t);for(let n of o)this.addSubProgress(n)}};async function M(e,o){let{status:t,requestPath:n,responsePath:p,content:i,contentType:r,contentLength:a,fileName:c,headers:l,date:d}=e;return{status:t,requestPath:n,responsePath:p,content:s(o)?await o(i):void 0,contentType:r,contentLength:a,fileName:c,headers:l,date:d}}var Ro=/([^\/]+)\/(.+)/,Jo=/(?:([^\.]+)\.)?([^\+;]+)(?:\+([^;]+))?((?:; *([^=]+)=([^;]+))*)/;var $=class e{constructor(o,t,n){this._type=o,this._fullSubType=t,this._primaryExtension=null,this.depMessage=null;let p=new Map;this._parameters=p;let i=this._fullSubType.match(Jo);this._tree=i[1],this._subType=i[2],this._suffix=i[3];let r=i[4];if(this._value=this._fullValue=this._type+"/",s(this._tree)&&(this._value=this._fullValue+=this._tree+"."),this._value=this._fullValue+=this._subType,s(this._suffix)&&(this._value=this._fullValue+="+"+this._suffix),s(r)){let a=r.split(";").map(c=>c.trim()).filter(c=>c.length>0).map(c=>c.split("="));for(let[c,...l]of a){let d=l.join("=");p.set(c,d);let V=`; ${c}=${d}`;this._fullValue+=V,c!=="q"&&(this._value+=V)}}this._extensions=n||[],this._primaryExtension=this._extensions[0]||null}static parse(o){if(!o)return null;let t=o.match(Ro);if(!t)return null;let n=t[1],p=t[2];return new e(n,p)}deprecate(o){return this.depMessage=o,this}check(){s(this.depMessage)&&console.warn(`${this._value} is deprecated ${this.depMessage}`)}matches(o){if(f(o))return!1;if(this.typeName==="*"&&this.subTypeName==="*")return!0;let t=null,n=null;if(g(o)){let p=o.match(Ro);if(!p)return!1;t=p[1],n=p[2]}else t=o.typeName,n=o._fullSubType;return this.typeName===t&&(this._fullSubType==="*"||this._fullSubType===n)}withParameter(o,t){let n=`${this._fullSubType}; ${o}=${t}`;return new e(this.typeName,n,this.extensions)}get typeName(){return this.check(),this._type}get tree(){return this.check(),this._tree}get suffix(){return this._suffix}get subTypeName(){return this.check(),this._subType}get value(){return this.check(),this._value}__getValueUnsafe(){return this._value}get fullValue(){return this.check(),this._fullValue}get parameters(){return this.check(),this._parameters}get extensions(){return this.check(),this._extensions}__getExtensionsUnsafe(){return this._extensions}get primaryExtension(){return this.check(),this._primaryExtension}toString(){return this.parameters.get("q")==="1"?this.value:this.fullValue}toFileSystemAPIAccepts(){return{[this.value]:this.extensions.map(o=>"."+o)}}addExtension(o){if(!o)throw new Error("File name is not defined");return this.primaryExtension&&(o=e.removeExtension(o),o=`${o}.${this.primaryExtension}`),o}static removeExtension(o){let t=o.lastIndexOf(".");return t>-1&&(o=o.substring(0,t)),o}};function qo(e,o,...t){return new $(e,o,t)}function h(e){return qo.bind(null,e)}var Uo=h("text");var No=Uo("plain","txt","text","conf","def","list","log","in");function Ho(e){return g(e)||bo(e)||e instanceof Blob||e instanceof FormData||yo(e)||"Document"in globalThis&&e instanceof Document}function oo(e,o,t,n,p,i){let r=!i;i&&i.then(()=>r=!0);let a=!1,c=p,l=new w;t.addEventListener("loadstart",()=>{r&&!a&&n&&n.start(e)}),t.addEventListener("progress",V=>{if(r&&!a){let m=V;n&&n.report(m.loaded,Math.max(m.loaded,m.total),e),m.loaded===m.total&&(c=!0,a&&l.resolve())}}),t.addEventListener("load",()=>{r&&!a&&(n&&n.end(e),a=!0,c&&l.resolve())});let d=V=>()=>{r&&l.reject(`${V} (${o.status})`)};return t.addEventListener("error",d("error")),t.addEventListener("abort",d("abort")),t.addEventListener("timeout",d("timeout")),l}function vo(e,o,t,n,p,i){if(e.open(o,t),e.responseType="blob",e.timeout=n,p)for(let[r,a]of p)e.setRequestHeader(r,a);s(i)?e.send(i):e.send()}function to(e,o,t){if(!e.has(o))return null;let n=e.get(o);try{let p=t(n);return e.delete(o),p}catch(p){console.warn(o,p)}return null}var Ko=/filename=\"(.+)\"(;|$)/,Zo="Juniper:Fetcher:Cache",eo=class{constructor(){this.cache=null,this.store=null,this.tasks=new D,this.cacheReady=this.openCache()}async drawImageToCanvas(o,t,n){let p=await this.sendNothingGetSomething("blob",o,n),i=p.content;return Oo(await createImageBitmap(i,{imageOrientation:"from-image"}),r=>(t.width=r.width,t.height=r.height,t.getContext("2d").drawImage(r,0,0),M(p)))}async openCache(){let o={keyPath:"requestPath"};this.cache=await Z.open(Zo,{name:"files",options:o}),this.store=await this.cache.getStore("files")}async clearCache(){await this.cacheReady,await this.store.clear()}async evict(o){await this.cacheReady,this.store.has(o)&&await this.store.delete(o)}async readResponseHeaders(o,t){let n=t.getAllResponseHeaders().split(/[\r\n]+/).map(m=>m.trim()).filter(m=>m.length>0).map(m=>{let _=m.split(": "),b=_.shift().toLowerCase(),F=_.join(": ");return[b,F]}),p=new P(n),i=Array.from(p.keys()).map(m=>[m,p.get(m).join(", ")]),r=new Map(i),a=to(r,"content-type",U),c=to(r,"content-length",parseFloat),l=to(r,"date",m=>new Date(m)),d=to(r,"content-disposition",m=>{if(s(m)){let _=m.match(Ko);if(s(_))return _[1]}return null});return{status:t.status,requestPath:o,responsePath:t.responseURL,content:void 0,contentType:a,contentLength:c,fileName:d,date:l,headers:r}}async readResponse(o,t){let{responsePath:n,status:p,contentType:i,contentLength:r,fileName:a,date:c,headers:l}=await this.readResponseHeaders(o,t),d={requestPath:o,responsePath:n,status:p,contentType:i,contentLength:r,fileName:a,date:c,headers:l,content:t.response};return s(d.content)&&(d.contentType=d.contentType||d.content.type,d.contentLength=d.contentLength||d.content.size),d}async decodeContent(o,t){return M(t,async n=>{if(o==="")return null;if(f(t.contentType)){let p=Array.from(t.headers.entries()).map(i=>i.join(": ")).join(`
  `);throw new Error(`No content type found in headers: 
  `+p)}else{if(o==="blob")return n;if(o==="arraybuffer")return await n.arrayBuffer();if(o==="json"){let p=await n.text();return p.length>0?JSON.parse(p):null}else if(o==="document"){let p=new DOMParser;if(t.contentType==="application/xhtml+xml"||t.contentType==="text/html"||t.contentType==="application/xml"||t.contentType==="image/svg+xml"||t.contentType==="text/xml")return p.parseFromString(await n.text(),t.contentType);throw new Error("Couldn't parse document")}else{if(o==="text")return await n.text();lo(o)}}})}async withCachedTask(o,t){return o.method!=="GET"&&o.method!=="HEAD"&&o.method!=="OPTIONS"?await t():(this.tasks.has(o.method,o.path)||this.tasks.add(o.method,o.path,t().finally(()=>this.tasks.delete(o.method,o.path))),this.tasks.get(o.method,o.path))}sendNothingGetNothing(o){return this.withCachedTask(o,Q(o.retryCount,async()=>{let t=new XMLHttpRequest,n=oo(`requesting: ${o.path}`,t,t,null,!0);return vo(t,o.method,o.path,o.timeout,o.headers),await n,await this.readResponseHeaders(o.path,t)}))}sendNothingGetSomething(o,t,n){return this.withCachedTask(t,Q(t.retryCount,async()=>{let p=null,i=t.useCache&&t.method==="GET";i&&(s(n)&&n.start(),await this.cacheReady,p=await this.store.get(t.path));let r=f(p);if(r){let c=new XMLHttpRequest,l=oo(`requesting: ${t.path}`,c,c,n,!0);vo(c,t.method,t.path,t.timeout,t.headers),await l,p=await this.readResponse(t.path,c),i&&await this.store.add(p)}let a=await this.decodeContent(o,p);return r&&s(n)&&n.end(),a}))}sendSomethingGetSomething(o,t,n,p){let i=null,r=Io(new Map,n,t.headers),a=null;if(s(r)){let _=new Array;for(let b of r.keys())b.toLowerCase()==="content-type"&&_.push(b);if(_.length>0){t.body instanceof FormData||(a=r.get(_[0]),_.shift());for(let b of _)r.delete(b)}}Ho(t.body)&&!g(t.body)||g(t.body)&&No.matches(a)?i=t.body:s(t.body)&&(i=JSON.stringify(t.body));let c=s(i),l=Eo(p,c?2:1),[d,V]=l,m=async()=>{let _=new XMLHttpRequest,b=c?oo("uploading",_,_.upload,d,!1):Promise.resolve(),F=oo("saving",_,_,V,!0,b);vo(_,t.method,t.path,t.timeout,r,i),await b,await F;let co=await this.readResponse(t.path,_);return await this.decodeContent(o,co)};return Q(t.retryCount,m)()}};var Qo=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,q=navigator.userAgent.match(Qo),no=!!q,_n=no&&q&&{major:parseFloat(q[1]),minor:parseFloat(q[2]),patch:parseFloat(q[3])}||null,xn=no&&/pacific/i.test(navigator.userAgent),fn=no&&/quest/i.test(navigator.userAgent),un=no&&/quest 2/i.test(navigator.userAgent);var Yo="Worker"in globalThis;function Fo(e,o){let t="$1";Co(e)&&(t=e),H(o)&&"target"in o&&(o=o.target),H(o)&&"message"in o&&(o=o.message),H(o)&&"error"in o&&(o=o.error);let n=JSON.stringify(o);return t=t.replaceAll(/\$1\b/g,n),t}var Ao=class extends N{constructor(o,t){super(),this.server=o,this.taskID=t}report(o,t,n,p){let i={type:"progress",taskID:this.taskID,soFar:o,total:t,msg:n,est:p};this.server.postMessage(i)}},po=class{constructor(o){this.self=o,this.methods=new Map,this.self.addEventListener("message",t=>{let n=t.data;this.callMethod(n)})}postMessage(o,t){s(t)?this.self.postMessage(o,t):this.self.postMessage(o)}callMethod(o){let t=this.methods.get(o.methodName);if(t)try{I(o.params)?t(o.taskID,...o.params):s(o.params)?t(o.taskID,o.params):t(o.taskID)}catch(n){this.onError(o.taskID,`method invocation error: ${o.methodName}($1)`,n)}else this.onError(o.taskID,`method not found: ${o.methodName}`)}onError(o,t,n){let p={type:"error",taskID:o,errorMessage:Fo(t,n)};this.postMessage(p)}onReturn(o,t,n){let p=null;if(t===void 0?p={type:"return",taskID:o}:p={type:"return",taskID:o,returnValue:t},s(n)){let i=n(t);this.postMessage(p,i)}else this.postMessage(p)}addMethodInternal(o,t,n){if(this.methods.has(o))throw new Error(`${o} method has already been mapped.`);this.methods.set(o,async(p,...i)=>{let r=new Ao(this,p);try{let a=await t(...i,r);this.onReturn(p,a,n)}catch(a){console.error(a),this.onError(p,a)}})}addFunction(o,t,n){this.addMethodInternal(o,t,n)}addVoidFunction(o,t){this.addMethodInternal(o,t)}addMethod(o,t,n,p){this.addFunction(t,n.bind(o),p)}addVoidMethod(o,t,n){this.addVoidFunction(t,n.bind(o))}addEvent(o,t,n,p){o.addEventListener(t,i=>{let r=null;if(s(n)?r={type:"event",eventName:t,data:n(i)}:r={type:"event",eventName:t},r.data!==void 0&&s(p)){let a=p(r.data);this.postMessage(r,a)}else this.postMessage(r)})}};var io=class{constructor(o){this.impl=o,this.defaultPostHeaders=new Map}setRequestVerificationToken(o){this.defaultPostHeaders.set("RequestVerificationToken",o)}clearCache(){return this.impl.clearCache()}evict(o){return this.impl.evict(o)}sendNothingGetNothing(o){return this.impl.sendNothingGetNothing(o)}sendNothingGetBlob(o,t){return this.impl.sendNothingGetSomething("blob",o,t)}sendObjectGetBlob(o,t){return this.impl.sendSomethingGetSomething("blob",o,this.defaultPostHeaders,t)}sendNothingGetBuffer(o,t){return this.impl.sendNothingGetSomething("arraybuffer",o,t)}sendObjectGetBuffer(o,t){return this.impl.sendSomethingGetSomething("arraybuffer",o,this.defaultPostHeaders,t)}sendNothingGetText(o,t){return this.impl.sendNothingGetSomething("text",o,t)}sendObjectGetText(o,t){return this.impl.sendSomethingGetSomething("text",o,this.defaultPostHeaders,t)}sendNothingGetObject(o,t){return this.impl.sendNothingGetSomething("json",o,t)}sendObjectGetObject(o,t){return this.impl.sendSomethingGetSomething("json",o,this.defaultPostHeaders,t)}sendObjectGetNothing(o,t){return this.impl.sendSomethingGetSomething("",o,this.defaultPostHeaders,t)}drawImageToCanvas(o,t,n){return this.impl.drawImageToCanvas(o,t,n)}async sendNothingGetFile(o,t){return M(await this.sendNothingGetBlob(o,t),URL.createObjectURL)}async sendObjectGetFile(o,t){return M(await this.sendObjectGetBlob(o,t),URL.createObjectURL)}async sendNothingGetXml(o,t){return M(await this.impl.sendNothingGetSomething("document",o,t),n=>n.documentElement)}async sendObjectGetXml(o,t){return M(await this.impl.sendSomethingGetSomething("document",o,this.defaultPostHeaders,t),n=>n.documentElement)}async sendNothingGetImageBitmap(o,t){return M(await this.sendNothingGetBlob(o,t),createImageBitmap)}async sendObjectGetImageBitmap(o,t){return M(await this.sendObjectGetBlob(o,t),createImageBitmap)}};var so=class extends po{constructor(o,t){super(o);let n=new io(t);$o(this,n)}};function ro(e){return[e.content]}function $o(e,o){e.addVoidMethod(o,"setRequestVerificationToken",o.setRequestVerificationToken),e.addMethod(o,"clearCache",o.clearCache),e.addMethod(o,"evict",o.evict),e.addMethod(o,"sendNothingGetNothing",o.sendNothingGetNothing),e.addMethod(o,"sendNothingGetBuffer",o.sendNothingGetBuffer,ro),e.addMethod(o,"sendNothingGetImageBitmap",o.sendNothingGetImageBitmap,ro),e.addMethod(o,"sendNothingGetObject",o.sendNothingGetObject),e.addMethod(o,"sendNothingGetFile",o.sendNothingGetFile),e.addMethod(o,"sendNothingGetText",o.sendNothingGetText),e.addMethod(o,"sendObjectGetNothing",o.sendObjectGetNothing),e.addMethod(o,"sendObjectGetImageBitmap",o.sendObjectGetImageBitmap,ro),e.addMethod(o,"sendObjectGetBuffer",o.sendObjectGetBuffer,ro),e.addMethod(o,"sendObjectGetObject",o.sendObjectGetObject),e.addMethod(o,"sendObjectGetFile",o.sendObjectGetFile),e.addMethod(o,"sendObjectGetText",o.sendObjectGetText),e.addMethod(o,"drawImageToCanvas",o.drawImageToCanvas)}globalThis.server=new so(globalThis,new eo);
